# Ingredient Unification Fix Plan

## Current Problem

The `src/data/unified/ingredients.ts` file is problematic:

- Extremely large (27,000+ lines)
- Contains duplicate ingredient data
- Causing runtime errors with references to undefined properties
- Blocking the development server from starting properly

## Analysis

1. The unified ingredients file was generated by the
   `scripts/consolidate-ingredients.mjs` script
2. It tries to consolidate all ingredient data from individual files into one
   unified file
3. It's intended to add Kalchm calculations and alchemical properties
4. The file is referenced by the `unifiedNutritionalService.ts`, but this
   dependency can be removed

## Fix Plan

### Step 1: Delete the problematic file

Delete `src/data/unified/ingredients.ts` as it's causing errors and not needed
for core functionality.

### Step 2: Create a minimal replacement

Create a minimal version with just enough structure to satisfy type
requirements:

- Define the `UnifiedIngredient` interface
- Export an empty `unifiedIngredients` object
- Include stub implementations of utility functions

### Step 3: Update dependent services

Modify `src/services/unifiedNutritionalService.ts` to:

- Fall back to using regular ingredient data
- Remove dependencies on the unified ingredients

### Step 4: Document for future regeneration

- Document how to properly regenerate the unified ingredients file after the app
  is stable
- Note that this should be a separate process from the main development workflow

### Future Improvements

1. Optimize the generation script to create smaller, more maintainable files
2. Split unified ingredients into multiple category-specific files
3. Add proper error handling for missing data
4. Implement lazy-loading for the unified data

## Implementation Steps

1. Back up the current unified directory
2. Delete the problematic ingredients.ts file
3. Create the minimal replacement file
4. Update the nutritional service to avoid using the unified ingredients
   directly
5. Run the build and dev server to verify everything works

## Completion Status âœ…

The issue has been fixed by:

1. **Backing up the unified ingredients file**:
   - Created a backup at `./backup-unified/ingredients.ts`

2. **Created a minimal replacement file**:
   - Replaced the 27,000+ line file with a small stub implementation
   - Defined the necessary interfaces and empty objects
   - Added stub utility functions with console warnings

3. **Updated dependent services**:
   - Modified `unifiedNutritionalService.ts` to add fallbacks to regular
     ingredient data
   - Added appropriate error handling for missing data

4. **Verified the fix**:
   - Successfully ran the build process (`yarn build`)
   - Successfully started the dev server (`yarn dev`)
   - No errors related to missing data or undefined properties

The app is now working in dev mode without the issues caused by the large,
problematic unified ingredients file.
