{"file":"/data/data/com.termux/files/home/WhatToEatNext/src/utils/elemental/normalization.ts","mappings":"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","names":[],"sources":["/data/data/com.termux/files/home/WhatToEatNext/src/utils/elemental/normalization.ts"],"sourcesContent":["/**\n * Elemental Normalization Utilities\n *\n * This module provides utilities for normalizing elemental properties for DISPLAY ONLY.\n *\n * IMPORTANT: With the denormalization update, raw elemental values are now the standard\n * for calculations. These utilities should ONLY be used for UI display purposes.\n *\n * For calculations, use raw elemental values directly without normalization.\n * Raw values preserve true energetic intensity information that is lost during normalization.\n *\n * @example\n * // For calculations - use raw values directly\n * const rawProps = { Fire: 5.2, Water: 3.1, Earth: 1.8, Air: 1.2 };\n * const thermodynamics = calculateThermodynamicMetrics(alchemical, rawProps);\n *\n * // For display only - normalize to percentages\n * const displayProps = normalizeForDisplay(rawProps);\n * // Result: { Fire: 0.46, Water: 0.27, Earth: 0.16, Air: 0.11 }\n */\n\nimport type {\n  Element,\n  ElementalProperties,\n  NormalizedElementalProperties,\n  RawElementalProperties,\n} from \"@/types/alchemy\";\nimport {\n  NORMALIZED_DEFAULT_PROPERTIES,\n  VALIDATION_THRESHOLDS,\n} from \"@/constants/elementalCore\";\n\n/**\n * Normalize raw elemental properties to percentages (0.0-1.0) for display\n * Used ONLY for UI display purposes, NOT for calculations\n *\n * @param properties - Raw elemental properties (may have values > 1.0)\n * @returns Normalized elemental properties (sum = 1.0, each value 0.0-1.0)\n *\n * @example\n * const raw = { Fire: 5.2, Water: 3.1, Earth: 1.8, Air: 1.2 };\n * const display = normalizeForDisplay(raw);\n * // Result: { Fire: 0.46, Water: 0.27, Earth: 0.16, Air: 0.11 }\n */\nexport function normalizeForDisplay(\n  properties: RawElementalProperties | ElementalProperties,\n): NormalizedElementalProperties {\n  const total =\n    properties.Fire + properties.Water + properties.Earth + properties.Air;\n\n  if (total === 0) {\n    return { ...NORMALIZED_DEFAULT_PROPERTIES };\n  }\n\n  return {\n    Fire: properties.Fire / total,\n    Water: properties.Water / total,\n    Earth: properties.Earth / total,\n    Air: properties.Air / total,\n  };\n}\n\n/**\n * Get total elemental intensity (sum of all elements)\n * Useful for understanding the overall energetic magnitude of properties\n *\n * @param properties - Raw elemental properties\n * @returns Total intensity (sum of Fire + Water + Earth + Air)\n *\n * @example\n * const props = { Fire: 5.2, Water: 3.1, Earth: 1.8, Air: 1.2 };\n * const total = getTotalIntensity(props);\n * // Result: 11.3\n */\nexport function getTotalIntensity(\n  properties: RawElementalProperties | ElementalProperties,\n): number {\n  return properties.Fire + properties.Water + properties.Earth + properties.Air;\n}\n\n/**\n * Get dominant element by absolute value (not percentage)\n * For raw values, this gives the element with the highest intensity\n *\n * @param properties - Raw or normalized elemental properties\n * @returns The dominant element\n *\n * @example\n * const props = { Fire: 5.2, Water: 3.1, Earth: 1.8, Air: 1.2 };\n * const dominant = getDominantElementByIntensity(props);\n * // Result: \"Fire\"\n */\nexport function getDominantElementByIntensity(\n  properties: RawElementalProperties | ElementalProperties,\n): Element {\n  const entries = Object.entries(properties).filter(([key]) =>\n    [\"Fire\", \"Water\", \"Earth\", \"Air\"].includes(key),\n  ) as [Element, number][];\n  return entries.reduce((a, b) => (a[1] > b[1] ? a : b))[0];\n}\n\n/**\n * Check if properties appear to be normalized (sum ≈ 1.0)\n * Useful for detecting legacy normalized data\n *\n * @param properties - Properties to check\n * @returns True if properties appear to be normalized\n *\n * @example\n * const normalized = { Fire: 0.25, Water: 0.25, Earth: 0.25, Air: 0.25 };\n * const raw = { Fire: 5.2, Water: 3.1, Earth: 1.8, Air: 1.2 };\n *\n * isNormalized(normalized); // true\n * isNormalized(raw); // false\n */\nexport function isNormalized(\n  properties: ElementalProperties | RawElementalProperties,\n): boolean {\n  const total = getTotalIntensity(properties);\n  return (\n    Math.abs(total - 1) <= VALIDATION_THRESHOLDS.NORMALIZATION_SUM_TOLERANCE\n  );\n}\n\n/**\n * Convert normalized properties to raw values using a reference intensity\n *\n * This is useful for backwards compatibility when processing legacy data\n * that was stored as normalized values. The reference intensity determines\n * the scale of the resulting raw values.\n *\n * @param properties - Normalized elemental properties (sum ≈ 1.0)\n * @param referenceIntensity - Target total intensity (default: 4.0)\n * @returns Raw elemental properties scaled to reference intensity\n *\n * @example\n * const normalized = { Fire: 0.45, Water: 0.30, Earth: 0.15, Air: 0.10 };\n * const raw = convertNormalizedToRaw(normalized, 10);\n * // Result: { Fire: 4.5, Water: 3.0, Earth: 1.5, Air: 1.0 }\n */\nexport function convertNormalizedToRaw(\n  properties: NormalizedElementalProperties | ElementalProperties,\n  referenceIntensity = 4.0,\n): RawElementalProperties {\n  const sum = getTotalIntensity(properties);\n\n  // If sum ≈ 1.0, assume normalized and scale\n  if (Math.abs(sum - 1.0) < VALIDATION_THRESHOLDS.NORMALIZATION_SUM_TOLERANCE) {\n    return {\n      Fire: properties.Fire * referenceIntensity,\n      Water: properties.Water * referenceIntensity,\n      Earth: properties.Earth * referenceIntensity,\n      Air: properties.Air * referenceIntensity,\n    };\n  }\n\n  // Otherwise, assume already raw and return as-is\n  return {\n    Fire: properties.Fire,\n    Water: properties.Water,\n    Earth: properties.Earth,\n    Air: properties.Air,\n  };\n}\n\n/**\n * Get relative strength of each element as a multiplier\n * Useful for understanding how much stronger one element is than the average\n *\n * @param properties - Raw elemental properties\n * @returns Object with relative strength multipliers for each element\n *\n * @example\n * const props = { Fire: 8.0, Water: 2.0, Earth: 2.0, Air: 2.0 };\n * const strengths = getRelativeStrengths(props);\n * // Result: { Fire: 2.29, Water: 0.57, Earth: 0.57, Air: 0.57 }\n * // (Fire is 2.29x the average, others are 0.57x)\n */\nexport function getRelativeStrengths(\n  properties: RawElementalProperties | ElementalProperties,\n): Record<Element, number> {\n  const total = getTotalIntensity(properties);\n  const average = total / 4;\n\n  if (average === 0) {\n    return { Fire: 1, Water: 1, Earth: 1, Air: 1 };\n  }\n\n  return {\n    Fire: properties.Fire / average,\n    Water: properties.Water / average,\n    Earth: properties.Earth / average,\n    Air: properties.Air / average,\n  };\n}\n\n/**\n * Format elemental properties for display with percentages\n *\n * @param properties - Raw or normalized elemental properties\n * @returns Object with formatted percentage strings\n *\n * @example\n * const props = { Fire: 5.2, Water: 3.1, Earth: 1.8, Air: 1.2 };\n * const formatted = formatAsPercentages(props);\n * // Result: { Fire: \"46.0%\", Water: \"27.4%\", Earth: \"15.9%\", Air: \"10.6%\" }\n */\nexport function formatAsPercentages(\n  properties: RawElementalProperties | ElementalProperties,\n  decimals = 1,\n): Record<Element, string> {\n  const normalized = normalizeForDisplay(properties);\n\n  return {\n    Fire: `${(normalized.Fire * 100).toFixed(decimals)}%`,\n    Water: `${(normalized.Water * 100).toFixed(decimals)}%`,\n    Earth: `${(normalized.Earth * 100).toFixed(decimals)}%`,\n    Air: `${(normalized.Air * 100).toFixed(decimals)}%`,\n  };\n}\n\n/**\n * Compare two sets of elemental properties by intensity\n *\n * Returns positive values where properties1 is stronger, negative where weaker\n *\n * @param properties1 - First set of elemental properties\n * @param properties2 - Second set of elemental properties\n * @returns Difference object (positive = properties1 stronger)\n *\n * @example\n * const recipe = { Fire: 5.2, Water: 3.1, Earth: 1.8, Air: 1.2 };\n * const user = { Fire: 3.0, Water: 4.0, Earth: 2.0, Air: 1.0 };\n * const diff = compareIntensities(recipe, user);\n * // Result: { Fire: 2.2, Water: -0.9, Earth: -0.2, Air: 0.2 }\n */\nexport function compareIntensities(\n  properties1: RawElementalProperties | ElementalProperties,\n  properties2: RawElementalProperties | ElementalProperties,\n): Record<Element, number> {\n  return {\n    Fire: properties1.Fire - properties2.Fire,\n    Water: properties1.Water - properties2.Water,\n    Earth: properties1.Earth - properties2.Earth,\n    Air: properties1.Air - properties2.Air,\n  };\n}\n\nexport default {\n  normalizeForDisplay,\n  getTotalIntensity,\n  getDominantElementByIntensity,\n  isNormalized,\n  convertNormalizedToRaw,\n  getRelativeStrengths,\n  formatAsPercentages,\n  compareIntensities,\n};\n"],"version":3}