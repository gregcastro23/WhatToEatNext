{"file":"/data/data/com.termux/files/home/WhatToEatNext/src/utils/hierarchicalRecipeCalculations.ts","mappings":"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","names":[],"sources":["/data/data/com.termux/files/home/WhatToEatNext/src/utils/hierarchicalRecipeCalculations.ts"],"sourcesContent":["/**\n * Hierarchical Recipe Property Calculations\n *\n * This module implements the correct hierarchical calculation pipeline for recipes:\n * 1. Aggregate ingredient elemental properties (with quantity scaling)\n * 2. Calculate ESMS from planetary positions (THE ONLY CORRECT METHOD)\n * 3. Aggregate zodiac elemental contributions\n * 4. Apply cooking method transformations\n * 5. Calculate thermodynamic metrics\n *\n * Based on the authoritative alchemizer engine formulas.\n */\n\nimport { calculateKinetics } from \"@/calculations/kinetics\";\nimport type {\n  CookingMethod,\n  ElementalProperties,\n  RawElementalProperties,\n} from \"@/types/alchemy\";\nimport type { RecipeIngredient } from \"@/types/recipe\";\nimport type {\n  QuantityScaledProperties,\n  RecipeComputationOptions,\n  RecipeComputedProperties,\n} from \"@/types/hierarchy\";\nimport type {\n  KineticMetrics /*, KineticsCalculationInput */,\n} from \"@/types/kinetics\";\nimport { ZERO_ELEMENTAL_PROPERTIES } from \"@/constants/elementalCore\";\nimport { calculateThermodynamicMetrics } from \"./monicaKalchmCalculations\";\nimport {\n  aggregateZodiacElementals,\n  calculateAlchemicalFromPlanets,\n  getDominantAlchemicalProperty,\n  getDominantElement,\n} from \"./planetaryAlchemyMapping\";\n\n// ========== COOKING METHOD TRANSFORMATIONS ==========\n\n/**\n * Cooking Method Elemental Modifiers\n *\n * Each cooking method applies specific transformations to elemental properties.\n * Based on the 14 Alchemical Pillars and traditional cooking techniques.\n */\nexport const COOKING_METHOD_MODIFIERS: Record<\n  string,\n  Partial<ElementalProperties>\n> = {\n  // Dry Heat Methods (Fire dominant)\n  grilling: { Fire: 1.4, Water: 0.6, Earth: 0.9, Air: 1.1 },\n  roasting: { Fire: 1.3, Water: 0.7, Earth: 1.0, Air: 1.0 },\n  baking: { Fire: 1.2, Water: 0.8, Earth: 1.1, Air: 0.9 },\n  broiling: { Fire: 1.5, Water: 0.5, Earth: 0.8, Air: 1.2 },\n  searing: { Fire: 1.6, Water: 0.4, Earth: 0.9, Air: 1.1 },\n\n  // Moist Heat Methods (Water dominant)\n  boiling: { Fire: 0.7, Water: 1.3, Earth: 0.8, Air: 1.0 },\n  steaming: { Fire: 0.6, Water: 1.4, Earth: 0.9, Air: 1.1 },\n  poaching: { Fire: 0.5, Water: 1.5, Earth: 1.0, Air: 0.8 },\n  simmering: { Fire: 0.8, Water: 1.2, Earth: 0.9, Air: 1.0 },\n  braising: { Fire: 0.9, Water: 1.1, Earth: 1.0, Air: 0.8 },\n  stewing: { Fire: 0.8, Water: 1.2, Earth: 1.1, Air: 0.7 },\n\n  // Combination Methods\n  \"stir-frying\": { Fire: 1.3, Water: 0.8, Earth: 0.9, Air: 1.2 },\n  sauteing: { Fire: 1.2, Water: 0.8, Earth: 0.9, Air: 1.1 },\n  frying: { Fire: 1.4, Water: 0.6, Earth: 0.9, Air: 1.1 },\n  \"deep-frying\": { Fire: 1.5, Water: 0.5, Earth: 0.8, Air: 1.2 },\n\n  // Fermentation & Preservation (Earth/Water balance)\n  fermenting: { Fire: 0.6, Water: 1.2, Earth: 1.3, Air: 0.9 },\n  pickling: { Fire: 0.7, Water: 1.3, Earth: 1.1, Air: 0.8 },\n  curing: { Fire: 0.5, Water: 0.9, Earth: 1.4, Air: 0.7 },\n  smoking: { Fire: 1.2, Water: 0.6, Earth: 1.0, Air: 1.3 },\n\n  // Mechanical Methods (Air/Earth)\n  blending: { Fire: 0.9, Water: 1.0, Earth: 0.8, Air: 1.3 },\n  pureeing: { Fire: 0.8, Water: 1.1, Earth: 0.7, Air: 1.4 },\n  whisking: { Fire: 0.9, Water: 0.9, Earth: 0.7, Air: 1.5 },\n  kneading: { Fire: 0.8, Water: 1.0, Earth: 1.4, Air: 0.8 },\n  rolling: { Fire: 0.9, Water: 0.9, Earth: 1.3, Air: 0.9 },\n\n  // Raw/Minimal Processing (preserves original balance)\n  raw: { Fire: 1.0, Water: 1.0, Earth: 1.0, Air: 1.0 },\n  chopping: { Fire: 1.0, Water: 0.95, Earth: 1.0, Air: 1.05 },\n  slicing: { Fire: 1.0, Water: 0.95, Earth: 1.0, Air: 1.05 },\n  marinating: { Fire: 0.8, Water: 1.2, Earth: 1.0, Air: 1.0 },\n};\n\n// ========== QUANTITY SCALING ==========\n\n/**\n * Calculate logarithmic quantity scaling factor\n *\n * Uses log(1 + quantity/reference) to model diminishing returns.\n * Small amounts (5-10g) contribute 20-30% of base intensity.\n * Large amounts (500g+) contribute 90-95% but never exceed maximum.\n *\n * @param quantity - Ingredient quantity in grams\n * @param referenceAmount - Reference amount (default: 100g)\n * @returns Scaling factor (0-1)\n */\nexport function calculateQuantityScalingFactor(\n  quantity: number,\n  referenceAmount = 100,\n): number {\n  if (quantity <= 0) return 0;\n  if (referenceAmount <= 0) return 1;\n\n  // Logarithmic scaling: log(1 + q/r) / log(1 + max_expected/r)\n  // For max_expected = 1000g (10x reference), this normalizes to ~0.95\n  const maxExpected = referenceAmount * 10;\n  const scaledValue = Math.log(1 + quantity / referenceAmount);\n  const maxValue = Math.log(1 + maxExpected / referenceAmount);\n\n  return Math.min(1.0, scaledValue / maxValue);\n}\n\n/**\n * Scale ingredient elemental properties by quantity\n *\n * @param baseElementals - Base elemental properties (unscaled)\n * @param quantity - Quantity in grams or standardized units\n * @param unit - Unit of measurement\n * @returns Quantity-scaled properties\n */\nexport function scaleIngredientByQuantity(\n  baseElementals: ElementalProperties,\n  quantity: number,\n  unit: string,\n): QuantityScaledProperties {\n  // Convert to standard grams if needed\n  let quantityInGrams = quantity;\n\n  // Simple unit conversions (can be expanded)\n  const conversionFactors: Record<string, number> = {\n    kg: 1000,\n    g: 1,\n    mg: 0.001,\n    oz: 28.35,\n    lb: 453.59,\n    cup: 240, // Approximate for liquids\n    tbsp: 15,\n    tsp: 5,\n    ml: 1, // Approximate density\n    l: 1000,\n  };\n\n  const factor = conversionFactors[unit.toLowerCase()];\n  if (factor) {\n    quantityInGrams = quantity * factor;\n  }\n\n  const scalingFactor = calculateQuantityScalingFactor(quantityInGrams);\n\n  // Scale each element by the factor\n  const scaled: ElementalProperties = {\n    Fire: baseElementals.Fire * scalingFactor,\n    Water: baseElementals.Water * scalingFactor,\n    Earth: baseElementals.Earth * scalingFactor,\n    Air: baseElementals.Air * scalingFactor,\n  };\n\n  return {\n    base: baseElementals,\n    scaled,\n    quantity: quantityInGrams,\n    unit,\n    scalingFactor,\n  };\n}\n\n// ========== INGREDIENT AGGREGATION ==========\n\n/**\n * Aggregate elemental properties from multiple ingredients\n *\n * Returns RAW elemental values (not normalized).\n * Values represent actual calculated intensity and can exceed 1.0.\n * This preserves information about true energetic intensity of the recipe.\n *\n * For display purposes, use normalizeForDisplay() from @/utils/elemental/normalization\n *\n * @param ingredients - List of recipe ingredients with quantities\n * @returns Raw aggregated elemental properties (sum may be > 1.0)\n */\nexport function aggregateIngredientElementals(\n  ingredients: RecipeIngredient[],\n): RawElementalProperties {\n  if (!ingredients || ingredients.length === 0) {\n    // Return zero state for empty recipes - let caller decide default\n    return { ...ZERO_ELEMENTAL_PROPERTIES };\n  }\n\n  const totals: RawElementalProperties = {\n    Fire: 0,\n    Water: 0,\n    Earth: 0,\n    Air: 0,\n  };\n\n  for (const ingredient of ingredients) {\n    if (!ingredient.elementalProperties) continue;\n\n    // Scale by quantity\n    const scaled = scaleIngredientByQuantity(\n      ingredient.elementalProperties,\n      Number(ingredient.amount) || 1,\n      ingredient.unit || \"g\",\n    );\n\n    // Add to totals (raw aggregation - no normalization)\n    totals.Fire += scaled.scaled.Fire;\n    totals.Water += scaled.scaled.Water;\n    totals.Earth += scaled.scaled.Earth;\n    totals.Air += scaled.scaled.Air;\n  }\n\n  // Return raw totals without normalization\n  // This preserves true intensity information\n  return totals;\n}\n\n// ========== COOKING METHOD TRANSFORMATIONS ==========\n\n/**\n * Apply cooking method transformations to elemental properties\n *\n * Methods are applied sequentially in the order provided.\n * Transformations are multiplicative and preserve raw intensity information.\n *\n * Note: Normalization has been removed. Raw values correctly scale with\n * cooking method modifiers, preserving true intensity differences.\n *\n * @param baseElementals - Base elemental properties (raw or normalized)\n * @param methods - Array of cooking method names or objects\n * @returns Transformed elemental properties (raw values, not normalized)\n */\nexport function applyCookingMethodTransforms(\n  baseElementals: ElementalProperties | RawElementalProperties,\n  methods: Array<string | CookingMethod>,\n): RawElementalProperties {\n  let current: RawElementalProperties = { ...baseElementals };\n\n  for (const method of methods) {\n    const methodName =\n      typeof method === \"string\" ? method : method.name || method.id;\n    const modifiers = COOKING_METHOD_MODIFIERS[methodName.toLowerCase()];\n\n    if (!modifiers) {\n      console.warn(`Unknown cooking method: ${methodName}`);\n      continue;\n    }\n\n    // Apply multiplicative modifiers\n    // Raw values scale correctly without normalization\n    current = {\n      Fire: current.Fire * (modifiers.Fire ?? 1.0),\n      Water: current.Water * (modifiers.Water ?? 1.0),\n      Earth: current.Earth * (modifiers.Earth ?? 1.0),\n      Air: current.Air * (modifiers.Air ?? 1.0),\n    };\n\n    // NOTE: Normalization removed - transformations preserve intensity\n    // For display, use normalizeForDisplay() from @/utils/elemental/normalization\n  }\n\n  return current;\n}\n\n// ========== MAIN RECIPE COMPUTATION FUNCTION ==========\n\n/**\n * Compute complete recipe properties from planetary positions and ingredients\n *\n * This is the main entry point for recipe property calculation.\n * Implements the full hierarchical calculation pipeline.\n *\n * @param ingredients - Recipe ingredients with quantities\n * @param cookingMethods - Cooking methods applied to the recipe\n * @param options - Computation options (must include planetaryPositions)\n * @returns Complete recipe computed properties\n *\n * @throws Error if planetary positions are not provided\n */\nexport function computeRecipeProperties(\n  ingredients: RecipeIngredient[],\n  cookingMethods: Array<string | CookingMethod>,\n  options: RecipeComputationOptions,\n): RecipeComputedProperties {\n  // Validate required options\n  if (!options.planetaryPositions) {\n    throw new Error(\n      \"planetaryPositions are required for recipe property calculation. \" +\n        \"ESMS values cannot be derived without astrological context.\",\n    );\n  }\n\n  const { planetaryPositions, applyCookingMethods: applyMethods = true } =\n    options;\n\n  // Step 1: Aggregate ingredient elementals with quantity scaling\n  const ingredientElementals = aggregateIngredientElementals(ingredients);\n\n  // Step 2: Calculate ESMS from planetary positions (THE CORRECT WAY)\n  const alchemicalProperties =\n    calculateAlchemicalFromPlanets(planetaryPositions);\n\n  // Step 3: Aggregate zodiac elementals from planetary sign positions\n  const zodiacElementals = aggregateZodiacElementals(planetaryPositions);\n\n  // Step 4: Combine ingredient and zodiac elementals (weighted average)\n  // Ingredient elementals get 70% weight, zodiac elementals get 30%\n  const combinedElementals: ElementalProperties = {\n    Fire: ingredientElementals.Fire * 0.7 + zodiacElementals.Fire * 0.3,\n    Water: ingredientElementals.Water * 0.7 + zodiacElementals.Water * 0.3,\n    Earth: ingredientElementals.Earth * 0.7 + zodiacElementals.Earth * 0.3,\n    Air: ingredientElementals.Air * 0.7 + zodiacElementals.Air * 0.3,\n  };\n\n  // Step 5: Apply cooking method transformations if enabled\n  const finalElementals = applyMethods\n    ? applyCookingMethodTransforms(combinedElementals, cookingMethods)\n    : combinedElementals;\n\n  // Step 6: Calculate thermodynamic metrics from ESMS + elementals\n  const thermodynamicMetrics = calculateThermodynamicMetrics(\n    alchemicalProperties,\n    finalElementals,\n  );\n\n  // Step 7: Calculate kinetic properties using P=IV circuit model\n  const kineticProperties = calculateRecipeKinetics(\n    alchemicalProperties,\n    thermodynamicMetrics,\n    planetaryPositions,\n  );\n\n  // Step 8: Identify dominant properties\n  const dominantElement = getDominantElement(finalElementals);\n  const dominantAlchemicalProperty =\n    getDominantAlchemicalProperty(alchemicalProperties);\n\n  // Step 9: Extract cooking method names for metadata\n  const cookingMethodNames = cookingMethods.map((method) =>\n    typeof method === \"string\" ? method : method.name || method.id,\n  );\n\n  // Return complete computed properties\n  return {\n    alchemicalProperties,\n    elementalProperties: finalElementals,\n    thermodynamicProperties: thermodynamicMetrics,\n    kineticProperties,\n    dominantElement,\n    dominantAlchemicalProperty,\n    computationMetadata: {\n      planetaryPositionsUsed: planetaryPositions,\n      cookingMethodsApplied: cookingMethodNames as any,\n      computationTimestamp: new Date(),\n    },\n  };\n}\n\n// ========== KINETIC PROPERTIES CALCULATION ==========\n\n/**\n * Calculate kinetic properties for a recipe using P=IV circuit model\n *\n * The recipe acts as a circuit where:\n * - Charge (Q) = Matter + Substance (recipe density)\n * - Potential (V) = Greg's Energy / Q (energetic potential)\n * - Current (I) = Reactivity × velocity (transformation flow)\n * - Power (P) = I × V (transformation rate)\n *\n * @param alchemicalProperties - ESMS properties from planetary positions\n * @param thermodynamicMetrics - Heat, entropy, reactivity, etc.\n * @param planetaryPositions - Current planetary positions\n * @returns Kinetic metrics for the recipe circuit\n */\nexport function calculateRecipeKinetics(\n  alchemicalProperties: AlchemicalProperties,\n  thermodynamicMetrics: any,\n  planetaryPositions: { [planet: string]: string },\n): KineticMetrics {\n  const { Spirit, Essence, Matter, Substance } = alchemicalProperties;\n  const { heat, entropy, reactivity, gregsEnergy, kalchm, monica } =\n    thermodynamicMetrics;\n\n  // Recipe circuit parameters (30-minute standard time interval)\n  const timeInterval = 1800; // 30 minutes in seconds\n  const dominantPlanet = getDominantPlanet(planetaryPositions);\n\n  // Prepare kinetics calculation input\n  const kineticsInput: any = {\n    // KineticsCalculationInput type not defined\n    currentPlanetaryPositions: planetaryPositions,\n    timeInterval,\n    currentPlanet: dominantPlanet,\n  };\n\n  // Calculate base kinetics from planetary positions\n  const baseKinetics = calculateKinetics(kineticsInput);\n\n  // Recipe-specific adjustments (recipe acts as a circuit component)\n\n  // 1. Recipe charge (Q) = Matter + Substance (recipe mass/density)\n  const recipeCharge = Matter + Substance;\n\n  // 2. Recipe potential difference (V) = Greg's Energy / Q\n  const recipePotential = recipeCharge > 0 ? gregsEnergy / recipeCharge : 0;\n\n  // 3. Recipe current flow (I) = Reactivity × heat rate\n  // Heat acts as velocity proxy in recipe context\n  const recipeCurrent = reactivity * (heat / 100); // Normalized heat contribution\n\n  // 4. Recipe power (P) = I × V (transformation power)\n  const recipePower = recipeCurrent * recipePotential;\n\n  // 5. Recipe force (F) = Power × Inertia (cooking resistance)\n  const recipeInertia = 1 + (Matter + Substance) * 0.1;\n  const recipeForce = recipePower * recipeInertia;\n\n  // 6. Recipe acceleration = Force / Inertia\n  const recipeAcceleration =\n    recipeInertia > 0 ? recipeForce / recipeInertia : 0;\n\n  // 7. Thermal direction based on heat vs entropy balance\n  let thermalDirection: \"heating\" | \"cooling\" | \"stable\";\n  if (heat > entropy * reactivity) {\n    thermalDirection = \"heating\";\n  } else if (entropy > heat) {\n    thermalDirection = \"cooling\";\n  } else {\n    thermalDirection = \"stable\";\n  }\n\n  // 8. Force classification based on power level\n  let forceClassification: \"accelerating\" | \"decelerating\" | \"balanced\";\n  if (recipePower > 2.0) {\n    forceClassification = \"accelerating\";\n  } else if (recipePower < 0.5) {\n    forceClassification = \"decelerating\";\n  } else {\n    forceClassification = \"balanced\";\n  }\n\n  // Return enhanced kinetics with recipe-specific properties\n  return {\n    ...baseKinetics,\n    charge: recipeCharge,\n    potentialDifference: recipePotential,\n    currentFlow: recipeCurrent,\n    power: recipePower,\n    force: {\n      Fire: recipeForce * (Spirit / (Spirit + Essence + Matter + Substance)),\n      Water: recipeForce * (Essence / (Spirit + Essence + Matter + Substance)),\n      Earth: recipeForce * (Matter / (Spirit + Essence + Matter + Substance)),\n      Air: recipeForce * (Substance / (Spirit + Essence + Matter + Substance)),\n    },\n    forceMagnitude: Math.abs(recipeForce),\n    forceClassification,\n    thermalDirection,\n    // Additional recipe-specific kinetics\n    velocity: {\n      Fire: recipeAcceleration * 0.4,\n      Water: recipeAcceleration * 0.3,\n      Earth: recipeAcceleration * 0.2,\n      Air: recipeAcceleration * 0.1,\n    },\n    momentum: {\n      Fire: recipeInertia * recipeAcceleration * 0.4,\n      Water: recipeInertia * recipeAcceleration * 0.3,\n      Earth: recipeInertia * recipeAcceleration * 0.2,\n      Air: recipeInertia * recipeAcceleration * 0.1,\n    },\n    inertia: recipeInertia,\n  };\n}\n\n/**\n * Get the dominant planet from planetary positions\n * Used for kinetics calculation weighting\n */\nfunction getDominantPlanet(planetaryPositions: {\n  [planet: string]: string;\n}): string {\n  // Default to Sun if no clear dominant planet\n  return \"Sun\";\n}\n\n/**\n * Compute recipe properties with default options\n *\n * Convenience function that uses default computation settings.\n *\n * @param ingredients - Recipe ingredients\n * @param cookingMethods - Cooking methods\n * @param planetaryPositions - Required planetary positions\n * @returns Complete recipe computed properties\n */\nexport function computeRecipePropertiesSimple(\n  ingredients: RecipeIngredient[],\n  cookingMethods: Array<string | CookingMethod>,\n  planetaryPositions: { [planet: string]: string },\n): RecipeComputedProperties {\n  return computeRecipeProperties(ingredients, cookingMethods, {\n    planetaryPositions,\n    applyCookingMethods: true,\n    quantityScaling: \"logarithmic\",\n    cacheResults: false,\n  });\n}\n"],"version":3}