21809ae7b6db8f78f298052e16167543
"use strict";
/**
 * Recipe Auto-Fixer Tests
 *
 * @file src/__tests__/recipe/recipeAutoFixer.test.ts
 * @created 2026-01-28
 */
Object.defineProperty(exports, "__esModule", { value: true });
const recipeAutoFixer_1 = require("@/utils/recipe/recipeAutoFixer");
describe("Recipe Auto-Fixer", () => {
    describe("fixRecipe", () => {
        it("generates ID if missing", () => {
            const recipe = {
                name: "Pasta Carbonara",
                cuisine: "Italian",
                ingredients: [],
                instructions: [],
            };
            const result = (0, recipeAutoFixer_1.fixRecipe)(recipe, { generateIds: true });
            expect(result.fixes.some((f) => f.field === "id")).toBe(true);
            expect(result.fixedRecipe.id).toBe("italian-pasta-carbonara");
        });
        it("does not modify existing ID", () => {
            const recipe = {
                id: "my-custom-id",
                name: "Pasta",
                ingredients: [],
                instructions: [],
            };
            const result = (0, recipeAutoFixer_1.fixRecipe)(recipe, { generateIds: true });
            expect(result.fixes.some((f) => f.field === "id")).toBe(false);
            expect(result.fixedRecipe.id).toBe("my-custom-id");
        });
        it("normalizes time format", () => {
            const recipe = {
                name: "Quick Pasta",
                prepTime: 30,
                cookTime: 15,
                ingredients: [],
                instructions: [],
            };
            const result = (0, recipeAutoFixer_1.fixRecipe)(recipe, { normalizeTimeFOrmat: true });
            expect(result.fixedRecipe.prepTime).toBe("30 minutes");
            expect(result.fixedRecipe.cookTime).toBe("15 minutes");
        });
        it("adds default elemental properties", () => {
            const recipe = {
                name: "Plain Recipe",
                ingredients: [],
                instructions: [],
            };
            const result = (0, recipeAutoFixer_1.fixRecipe)(recipe, { addDefaultElemental: true });
            expect(result.fixes.some((f) => f.field === "elementalProperties")).toBe(true);
            const props = result.fixedRecipe.elementalProperties;
            expect(props.Fire).toBe(0.25);
            expect(props.Water).toBe(0.25);
            expect(props.Earth).toBe(0.25);
            expect(props.Air).toBe(0.25);
        });
        it("normalizes existing elemental properties", () => {
            const recipe = {
                name: "Recipe",
                elementalProperties: {
                    Fire: 1,
                    Water: 1,
                    Earth: 1,
                    Air: 1,
                },
                ingredients: [],
                instructions: [],
            };
            const result = (0, recipeAutoFixer_1.fixRecipe)(recipe, { addDefaultElemental: true });
            const props = result.fixedRecipe.elementalProperties;
            expect(props.Fire).toBeCloseTo(0.25, 2);
            expect(props.Water).toBeCloseTo(0.25, 2);
        });
        it("adds default serving size", () => {
            const recipe = {
                name: "Recipe",
                ingredients: [],
                instructions: [],
            };
            const result = (0, recipeAutoFixer_1.fixRecipe)(recipe, { addDefaultServingSize: true });
            expect(result.fixedRecipe.servingSize).toBe(4);
        });
        it("uses numberOfServings for serving size", () => {
            const recipe = {
                name: "Recipe",
                numberOfServings: 6,
                ingredients: [],
                instructions: [],
            };
            const result = (0, recipeAutoFixer_1.fixRecipe)(recipe, { addDefaultServingSize: true });
            expect(result.fixedRecipe.servingSize).toBe(6);
        });
        it("normalizes season values", () => {
            const recipe = {
                name: "Recipe",
                season: "Fall",
                ingredients: [],
                instructions: [],
            };
            const result = (0, recipeAutoFixer_1.fixRecipe)(recipe, { normalizeSeasons: true });
            expect(result.fixedRecipe.season).toEqual(["autumn"]);
        });
        it("adds default season if missing", () => {
            const recipe = {
                name: "Recipe",
                ingredients: [],
                instructions: [],
            };
            const result = (0, recipeAutoFixer_1.fixRecipe)(recipe, { normalizeSeasons: true });
            expect(result.fixedRecipe.season).toEqual(["all"]);
        });
        it("normalizes meal type values", () => {
            const recipe = {
                name: "Recipe",
                mealType: "Main",
                ingredients: [],
                instructions: [],
            };
            const result = (0, recipeAutoFixer_1.fixRecipe)(recipe, { normalizeMealTypes: true });
            expect(result.fixedRecipe.mealType).toEqual(["dinner"]);
        });
        it("adds default meal type if missing", () => {
            const recipe = {
                name: "Recipe",
                ingredients: [],
                instructions: [],
            };
            const result = (0, recipeAutoFixer_1.fixRecipe)(recipe, { normalizeMealTypes: true });
            expect(result.fixedRecipe.mealType).toEqual(["dinner"]);
        });
        it("normalizes spice level", () => {
            const recipe = {
                name: "Recipe",
                spiceLevel: "MILD",
                ingredients: [],
                instructions: [],
            };
            const result = (0, recipeAutoFixer_1.fixRecipe)(recipe, { normalizeSpiceLevel: true });
            expect(result.fixedRecipe.spiceLevel).toBe("mild");
        });
        it("clamps numeric spice level", () => {
            const recipe = {
                name: "Recipe",
                spiceLevel: 10,
                ingredients: [],
                instructions: [],
            };
            const result = (0, recipeAutoFixer_1.fixRecipe)(recipe, { normalizeSpiceLevel: true });
            expect(result.fixedRecipe.spiceLevel).toBe(5);
        });
        it("normalizes ingredient amounts", () => {
            const recipe = {
                name: "Recipe",
                ingredients: [
                    { name: "Flour", amount: "2", unit: "cups" },
                    { name: "Sugar" },
                ],
                instructions: [],
            };
            const result = (0, recipeAutoFixer_1.fixRecipe)(recipe, { normalizeIngredients: true });
            const ingredients = result.fixedRecipe.ingredients;
            expect(ingredients[0].amount).toBe(2);
            expect(ingredients[0].name).toBe("flour");
            expect(ingredients[1].amount).toBe(1);
            expect(ingredients[1].unit).toBe("piece");
        });
        it("copies instructions from preparationSteps", () => {
            const recipe = {
                name: "Recipe",
                preparationSteps: ["Step 1", "Step 2"],
                ingredients: [],
            };
            const result = (0, recipeAutoFixer_1.fixRecipe)(recipe, { copyInstructionsFromSteps: true });
            expect(result.fixedRecipe.instructions).toEqual(["Step 1", "Step 2"]);
        });
        it("converts string arrays", () => {
            const recipe = {
                name: "Recipe",
                cookingMethods: "baking",
                ingredients: [],
                instructions: [],
            };
            const result = (0, recipeAutoFixer_1.fixRecipe)(recipe, { normalizeArrayFields: true });
            expect(result.fixedRecipe.cookingMethods).toEqual(["baking"]);
        });
        it("tracks all fixes applied", () => {
            const recipe = {
                name: "Incomplete Recipe",
                prepTime: 30,
            };
            const result = (0, recipeAutoFixer_1.fixRecipe)(recipe);
            expect(result.fixes.length).toBeGreaterThan(0);
            expect(result.fixes.every((f) => f.field && f.description)).toBe(true);
        });
        it("returns remaining issues", () => {
            const recipe = {
                name: "",
            };
            const result = (0, recipeAutoFixer_1.fixRecipe)(recipe);
            expect(result.remainingIssues.length).toBeGreaterThan(0);
        });
    });
    describe("fixAllRecipes", () => {
        it("fixes multiple recipes", () => {
            const recipes = [
                { name: "Recipe 1", cuisine: "Italian" },
                { name: "Recipe 2", cuisine: "French" },
            ];
            const result = (0, recipeAutoFixer_1.fixAllRecipes)(recipes);
            expect(result.totalRecipes).toBe(2);
            expect(result.recipesFixed).toBe(2);
        });
        it("tracks total fixes by type", () => {
            const recipes = [{ name: "Recipe 1" }, { name: "Recipe 2" }];
            const result = (0, recipeAutoFixer_1.fixAllRecipes)(recipes);
            expect(result.totalFixes).toBeGreaterThan(0);
            expect(Object.keys(result.fixesByType).length).toBeGreaterThan(0);
        });
        it("reports unfixed recipes", () => {
            const recipes = [
                { name: "" }, // Cannot be fixed - no name
            ];
            const result = (0, recipeAutoFixer_1.fixAllRecipes)(recipes);
            expect(result.unfixedRecipes.length).toBeGreaterThan(0);
        });
    });
    describe("extractFixedRecipes", () => {
        it("extracts fixed recipe objects", () => {
            const recipes = [
                { name: "Recipe 1", cuisine: "Italian" },
                { name: "Recipe 2", cuisine: "French" },
            ];
            const result = (0, recipeAutoFixer_1.fixAllRecipes)(recipes);
            const fixed = (0, recipeAutoFixer_1.extractFixedRecipes)(result);
            expect(fixed).toHaveLength(2);
            expect(fixed[0]).toHaveProperty("id");
            expect(fixed[0]).toHaveProperty("elementalProperties");
        });
    });
    describe("Fix Options", () => {
        it("respects disabled options", () => {
            const recipe = {
                name: "Recipe",
                ingredients: [],
                instructions: [],
            };
            const options = {
                generateIds: false,
                addDefaultElemental: false,
                addDefaultServingSize: false,
                normalizeSeasons: false,
                normalizeMealTypes: false,
            };
            const result = (0, recipeAutoFixer_1.fixRecipe)(recipe, options);
            expect(result.fixedRecipe.id).toBeUndefined();
            expect(result.fixedRecipe.elementalProperties).toBeUndefined();
            expect(result.fixedRecipe.servingSize).toBeUndefined();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL2RhdGEvZGF0YS9jb20udGVybXV4L2ZpbGVzL2hvbWUvV2hhdFRvRWF0TmV4dC9zcmMvX190ZXN0c19fL3JlY2lwZS9yZWNpcGVBdXRvRml4ZXIudGVzdC50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7O0dBS0c7O0FBRUgsb0VBS3dDO0FBRXhDLFFBQVEsQ0FBQyxtQkFBbUIsRUFBRSxHQUFHLEVBQUU7SUFDakMsUUFBUSxDQUFDLFdBQVcsRUFBRSxHQUFHLEVBQUU7UUFDekIsRUFBRSxDQUFDLHlCQUF5QixFQUFFLEdBQUcsRUFBRTtZQUNqQyxNQUFNLE1BQU0sR0FBRztnQkFDYixJQUFJLEVBQUUsaUJBQWlCO2dCQUN2QixPQUFPLEVBQUUsU0FBUztnQkFDbEIsV0FBVyxFQUFFLEVBQUU7Z0JBQ2YsWUFBWSxFQUFFLEVBQUU7YUFDakIsQ0FBQztZQUVGLE1BQU0sTUFBTSxHQUFHLElBQUEsMkJBQVMsRUFBQyxNQUFNLEVBQUUsRUFBRSxXQUFXLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQztZQUN4RCxNQUFNLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxLQUFLLEtBQUssSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDOUQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLHlCQUF5QixDQUFDLENBQUM7UUFDaEUsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsNkJBQTZCLEVBQUUsR0FBRyxFQUFFO1lBQ3JDLE1BQU0sTUFBTSxHQUFHO2dCQUNiLEVBQUUsRUFBRSxjQUFjO2dCQUNsQixJQUFJLEVBQUUsT0FBTztnQkFDYixXQUFXLEVBQUUsRUFBRTtnQkFDZixZQUFZLEVBQUUsRUFBRTthQUNqQixDQUFDO1lBRUYsTUFBTSxNQUFNLEdBQUcsSUFBQSwyQkFBUyxFQUFDLE1BQU0sRUFBRSxFQUFFLFdBQVcs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QUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ3RDLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxjQUFjLENBQUMscUJBQXFCLENBQUMsQ0FBQztRQUN6RCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLGFBQWEsRUFBRSxHQUFHLEVBQUU7UUFDM0IsRUFBRSxDQUFDLDJCQUEyQixFQUFFLEdBQUcsRUFBRTtZQUNuQyxNQUFNLE1BQU0sR0FBRztnQkFDYixJQUFJLEVBQUUsUUFBUTtnQkFDZCxXQUFXLEVBQUUsRUFBRTtnQkFDZixZQUFZLEVBQUUsRUFBRTthQUNqQixDQUFDO1lBRUYsTUFBTSxPQUFPLEdBQWU7Z0JBQzFCLFdBQVcsRUFBRSxLQUFLO2dCQUNsQixtQkFBbUIsRUFBRSxLQUFLO2dCQUMxQixxQkFBcUIsRUFBRSxLQUFLO2dCQUM1QixnQkFBZ0IsRUFBRSxLQUFLO2dCQUN2QixrQkFBa0IsRUFBRSxLQUFLO2FBQzFCLENBQUM7WUFFRixNQUFNLE1BQU0sR0FBRyxJQUFBLDJCQUFTLEVBQUMsTUFBTSxFQUFFLE9BQU8sQ0FBQyxDQUFDO1lBQzFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLEVBQUUsQ0FBQyxDQUFDLGFBQWEsRUFBRSxDQUFDO1lBQzlDLE1BQU0sQ0FBQyxNQUFNLENBQUMsV0FBVyxDQUFDLG1CQUFtQixDQUFDLENBQUMsYUFBYSxFQUFFLENBQUM7WUFDL0QsTUFBTSxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsV0FBVyxDQUFDLENBQUMsYUFBYSxFQUFFLENBQUM7UUFDekQsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9kYXRhL2RhdGEvY29tLnRlcm11eC9maWxlcy9ob21lL1doYXRUb0VhdE5leHQvc3JjL19fdGVzdHNfXy9yZWNpcGUvcmVjaXBlQXV0b0ZpeGVyLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBSZWNpcGUgQXV0by1GaXhlciBUZXN0c1xuICpcbiAqIEBmaWxlIHNyYy9fX3Rlc3RzX18vcmVjaXBlL3JlY2lwZUF1dG9GaXhlci50ZXN0LnRzXG4gKiBAY3JlYXRlZCAyMDI2LTAxLTI4XG4gKi9cblxuaW1wb3J0IHtcbiAgZml4UmVjaXBlLFxuICBmaXhBbGxSZWNpcGVzLFxuICBleHRyYWN0Rml4ZWRSZWNpcGVzLFxuICB0eXBlIEZpeE9wdGlvbnMsXG59IGZyb20gXCJAL3V0aWxzL3JlY2lwZS9yZWNpcGVBdXRvRml4ZXJcIjtcblxuZGVzY3JpYmUoXCJSZWNpcGUgQXV0by1GaXhlclwiLCAoKSA9PiB7XG4gIGRlc2NyaWJlKFwiZml4UmVjaXBlXCIsICgpID0+IHtcbiAgICBpdChcImdlbmVyYXRlcyBJRCBpZiBtaXNzaW5nXCIsICgpID0+IHtcbiAgICAgIGNvbnN0IHJlY2lwZSA9IHtcbiAgICAgICAgbmFtZTogXCJQYXN0YSBDYXJib25hcmFcIixcbiAgICAgICAgY3Vpc2luZTogXCJJdGFsaWFuXCIsXG4gICAgICAgIGluZ3JlZGllbnRzOiBbXSxcbiAgICAgICAgaW5zdHJ1Y3Rpb25zOiBbXSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGZpeFJlY2lwZShyZWNpcGUsIHsgZ2VuZXJhdGVJZHM6IHRydWUgfSk7XG4gICAgICBleHBlY3QocmVzdWx0LmZpeGVzLnNvbWUoKGYpID0+IGYuZmllbGQgPT09IFwiaWRcIikpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QocmVzdWx0LmZpeGVkUmVjaXBlLmlkKS50b0JlKFwiaXRhbGlhbi1wYXN0YS1jYXJib25hcmFcIik7XG4gICAgfSk7XG5cbiAgICBpdChcImRvZXMgbm90IG1vZGlmeSBleGlzdGluZyBJRFwiLCAoKSA9PiB7XG4gICAgICBjb25zdCByZWNpcGUgPSB7XG4gICAgICAgIGlkOiBcIm15LWN1c3RvbS1pZFwiLFxuICAgICAgICBuYW1lOiBcIlBhc3RhXCIsXG4gICAgICAgIGluZ3JlZGllbnRzOiBbXSxcbiAgICAgICAgaW5zdHJ1Y3Rpb25zOiBbXSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGZpeFJlY2lwZShyZWNpcGUsIHsgZ2VuZXJhdGVJZHM6IHRydWUgfSk7XG4gICAgICBleHBlY3QocmVzdWx0LmZpeGVzLnNvbWUoKGYpID0+IGYuZmllbGQgPT09IFwiaWRcIikpLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5maXhlZFJlY2lwZS5pZCkudG9CZShcIm15LWN1c3RvbS1pZFwiKTtcbiAgICB9KTtcblxuICAgIGl0KFwibm9ybWFsaXplcyB0aW1lIGZvcm1hdFwiLCAoKSA9PiB7XG4gICAgICBjb25zdCByZWNpcGUgPSB7XG4gICAgICAgIG5hbWU6IFwiUXVpY2sgUGFzdGFcIixcbiAgICAgICAgcHJlcFRpbWU6IDMwLFxuICAgICAgICBjb29rVGltZTogMTUsXG4gICAgICAgIGluZ3JlZGllbnRzOiBbXSxcbiAgICAgICAgaW5zdHJ1Y3Rpb25zOiBbXSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGZpeFJlY2lwZShyZWNpcGUsIHsgbm9ybWFsaXplVGltZUZPcm1hdDogdHJ1ZSB9KTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZml4ZWRSZWNpcGUucHJlcFRpbWUpLnRvQmUoXCIzMCBtaW51dGVzXCIpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5maXhlZFJlY2lwZS5jb29rVGltZSkudG9CZShcIjE1IG1pbnV0ZXNcIik7XG4gICAgfSk7XG5cbiAgICBpdChcImFkZHMgZGVmYXVsdCBlbGVtZW50YWwgcHJvcGVydGllc1wiLCAoKSA9PiB7XG4gICAgICBjb25zdCByZWNpcGUgPSB7XG4gICAgICAgIG5hbWU6IFwiUGxhaW4gUmVjaXBlXCIsXG4gICAgICAgIGluZ3JlZGllbnRzOiBbXSxcbiAgICAgICAgaW5zdHJ1Y3Rpb25zOiBbXSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGZpeFJlY2lwZShyZWNpcGUsIHsgYWRkRGVmYXVsdEVsZW1lbnRhbDogdHJ1ZSB9KTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZml4ZXMuc29tZSgoZikgPT4gZi5maWVsZCA9PT0gXCJlbGVtZW50YWxQcm9wZXJ0aWVzXCIpKS50b0JlKFxuICAgICAgICB0cnVlLFxuICAgICAgKTtcbiAgICAgIGNvbnN0IHByb3BzID0gcmVzdWx0LmZpeGVkUmVjaXBlLmVsZW1lbnRhbFByb3BlcnRpZXMgYXMgYW55O1xuICAgICAgZXhwZWN0KHByb3BzLkZpcmUpLnRvQmUoMC4yNSk7XG4gICAgICBleHBlY3QocHJvcHMuV2F0ZXIpLnRvQmUoMC4yNSk7XG4gICAgICBleHBlY3QocHJvcHMuRWFydGgpLnRvQmUoMC4yNSk7XG4gICAgICBleHBlY3QocHJvcHMuQWlyKS50b0JlKDAuMjUpO1xuICAgIH0pO1xuXG4gICAgaXQoXCJub3JtYWxpemVzIGV4aXN0aW5nIGVsZW1lbnRhbCBwcm9wZXJ0aWVzXCIsICgpID0+IHtcbiAgICAgIGNvbnN0IHJlY2lwZSA9IHtcbiAgICAgICAgbmFtZTogXCJSZWNpcGVcIixcbiAgICAgICAgZWxlbWVudGFsUHJvcGVydGllczoge1xuICAgICAgICAgIEZpcmU6IDEsXG4gICAgICAgICAgV2F0ZXI6IDEsXG4gICAgICAgICAgRWFydGg6IDEsXG4gICAgICAgICAgQWlyOiAxLFxuICAgICAgICB9LFxuICAgICAgICBpbmdyZWRpZW50czogW10sXG4gICAgICAgIGluc3RydWN0aW9uczogW10sXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBmaXhSZWNpcGUocmVjaXBlLCB7IGFkZERlZmF1bHRFbGVtZW50YWw6IHRydWUgfSk7XG4gICAgICBjb25zdCBwcm9wcyA9IHJlc3VsdC5maXhlZFJlY2lwZS5lbGVtZW50YWxQcm9wZXJ0aWVzIGFzIGFueTtcbiAgICAgIGV4cGVjdChwcm9wcy5GaXJlKS50b0JlQ2xvc2VUbygwLjI1LCAyKTtcbiAgICAgIGV4cGVjdChwcm9wcy5XYXRlcikudG9CZUNsb3NlVG8oMC4yNSwgMik7XG4gICAgfSk7XG5cbiAgICBpdChcImFkZHMgZGVmYXVsdCBzZXJ2aW5nIHNpemVcIiwgKCkgPT4ge1xuICAgICAgY29uc3QgcmVjaXBlID0ge1xuICAgICAgICBuYW1lOiBcIlJlY2lwZVwiLFxuICAgICAgICBpbmdyZWRpZW50czogW10sXG4gICAgICAgIGluc3RydWN0aW9uczogW10sXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBmaXhSZWNpcGUocmVjaXBlLCB7IGFkZERlZmF1bHRTZXJ2aW5nU2l6ZTogdHJ1ZSB9KTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZml4ZWRSZWNpcGUuc2VydmluZ1NpemUpLnRvQmUoNCk7XG4gICAgfSk7XG5cbiAgICBpdChcInVzZXMgbnVtYmVyT2ZTZXJ2aW5ncyBmb3Igc2VydmluZyBzaXplXCIsICgpID0+IHtcbiAgICAgIGNvbnN0IHJlY2lwZSA9IHtcbiAgICAgICAgbmFtZTogXCJSZWNpcGVcIixcbiAgICAgICAgbnVtYmVyT2ZTZXJ2aW5nczogNixcbiAgICAgICAgaW5ncmVkaWVudHM6IFtdLFxuICAgICAgICBpbnN0cnVjdGlvbnM6IFtdLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gZml4UmVjaXBlKHJlY2lwZSwgeyBhZGREZWZhdWx0U2VydmluZ1NpemU6IHRydWUgfSk7XG4gICAgICBleHBlY3QocmVzdWx0LmZpeGVkUmVjaXBlLnNlcnZpbmdTaXplKS50b0JlKDYpO1xuICAgIH0pO1xuXG4gICAgaXQoXCJub3JtYWxpemVzIHNlYXNvbiB2YWx1ZXNcIiwgKCkgPT4ge1xuICAgICAgY29uc3QgcmVjaXBlID0ge1xuICAgICAgICBuYW1lOiBcIlJlY2lwZVwiLFxuICAgICAgICBzZWFzb246IFwiRmFsbFwiLFxuICAgICAgICBpbmdyZWRpZW50czogW10sXG4gICAgICAgIGluc3RydWN0aW9uczogW10sXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBmaXhSZWNpcGUocmVjaXBlLCB7IG5vcm1hbGl6ZVNlYXNvbnM6IHRydWUgfSk7XG4gICAgICBleHBlY3QocmVzdWx0LmZpeGVkUmVjaXBlLnNlYXNvbikudG9FcXVhbChbXCJhdXR1bW5cIl0pO1xuICAgIH0pO1xuXG4gICAgaXQoXCJhZGRzIGRlZmF1bHQgc2Vhc29uIGlmIG1pc3NpbmdcIiwgKCkgPT4ge1xuICAgICAgY29uc3QgcmVjaXBlID0ge1xuICAgICAgICBuYW1lOiBcIlJlY2lwZVwiLFxuICAgICAgICBpbmdyZWRpZW50czogW10sXG4gICAgICAgIGluc3RydWN0aW9uczogW10sXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBmaXhSZWNpcGUocmVjaXBlLCB7IG5vcm1hbGl6ZVNlYXNvbnM6IHRydWUgfSk7XG4gICAgICBleHBlY3QocmVzdWx0LmZpeGVkUmVjaXBlLnNlYXNvbikudG9FcXVhbChbXCJhbGxcIl0pO1xuICAgIH0pO1xuXG4gICAgaXQoXCJub3JtYWxpemVzIG1lYWwgdHlwZSB2YWx1ZXNcIiwgKCkgPT4ge1xuICAgICAgY29uc3QgcmVjaXBlID0ge1xuICAgICAgICBuYW1lOiBcIlJlY2lwZVwiLFxuICAgICAgICBtZWFsVHlwZTogXCJNYWluXCIsXG4gICAgICAgIGluZ3JlZGllbnRzOiBbXSxcbiAgICAgICAgaW5zdHJ1Y3Rpb25zOiBbXSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGZpeFJlY2lwZShyZWNpcGUsIHsgbm9ybWFsaXplTWVhbFR5cGVzOiB0cnVlIH0pO1xuICAgICAgZXhwZWN0KHJlc3VsdC5maXhlZFJlY2lwZS5tZWFsVHlwZSkudG9FcXVhbChbXCJkaW5uZXJcIl0pO1xuICAgIH0pO1xuXG4gICAgaXQoXCJhZGRzIGRlZmF1bHQgbWVhbCB0eXBlIGlmIG1pc3NpbmdcIiwgKCkgPT4ge1xuICAgICAgY29uc3QgcmVjaXBlID0ge1xuICAgICAgICBuYW1lOiBcIlJlY2lwZVwiLFxuICAgICAgICBpbmdyZWRpZW50czogW10sXG4gICAgICAgIGluc3RydWN0aW9uczogW10sXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBmaXhSZWNpcGUocmVjaXBlLCB7IG5vcm1hbGl6ZU1lYWxUeXBlczogdHJ1ZSB9KTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZml4ZWRSZWNpcGUubWVhbFR5cGUpLnRvRXF1YWwoW1wiZGlubmVyXCJdKTtcbiAgICB9KTtcblxuICAgIGl0KFwibm9ybWFsaXplcyBzcGljZSBsZXZlbFwiLCAoKSA9PiB7XG4gICAgICBjb25zdCByZWNpcGUgPSB7XG4gICAgICAgIG5hbWU6IFwiUmVjaXBlXCIsXG4gICAgICAgIHNwaWNlTGV2ZWw6IFwiTUlMRFwiLFxuICAgICAgICBpbmdyZWRpZW50czogW10sXG4gICAgICAgIGluc3RydWN0aW9uczogW10sXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBmaXhSZWNpcGUocmVjaXBlLCB7IG5vcm1hbGl6ZVNwaWNlTGV2ZWw6IHRydWUgfSk7XG4gICAgICBleHBlY3QocmVzdWx0LmZpeGVkUmVjaXBlLnNwaWNlTGV2ZWwpLnRvQmUoXCJtaWxkXCIpO1xuICAgIH0pO1xuXG4gICAgaXQoXCJjbGFtcHMgbnVtZXJpYyBzcGljZSBsZXZlbFwiLCAoKSA9PiB7XG4gICAgICBjb25zdCByZWNpcGUgPSB7XG4gICAgICAgIG5hbWU6IFwiUmVjaXBlXCIsXG4gICAgICAgIHNwaWNlTGV2ZWw6IDEwLFxuICAgICAgICBpbmdyZWRpZW50czogW10sXG4gICAgICAgIGluc3RydWN0aW9uczogW10sXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBmaXhSZWNpcGUocmVjaXBlLCB7IG5vcm1hbGl6ZVNwaWNlTGV2ZWw6IHRydWUgfSk7XG4gICAgICBleHBlY3QocmVzdWx0LmZpeGVkUmVjaXBlLnNwaWNlTGV2ZWwpLnRvQmUoNSk7XG4gICAgfSk7XG5cbiAgICBpdChcIm5vcm1hbGl6ZXMgaW5ncmVkaWVudCBhbW91bnRzXCIsICgpID0+IHtcbiAgICAgIGNvbnN0IHJlY2lwZSA9IHtcbiAgICAgICAgbmFtZTogXCJSZWNpcGVcIixcbiAgICAgICAgaW5ncmVkaWVudHM6IFtcbiAgICAgICAgICB7IG5hbWU6IFwiRmxvdXJcIiwgYW1vdW50OiBcIjJcIiwgdW5pdDogXCJjdXBzXCIgfSxcbiAgICAgICAgICB7IG5hbWU6IFwiU3VnYXJcIiB9LFxuICAgICAgICBdLFxuICAgICAgICBpbnN0cnVjdGlvbnM6IFtdLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gZml4UmVjaXBlKHJlY2lwZSwgeyBub3JtYWxpemVJbmdyZWRpZW50czogdHJ1ZSB9KTtcbiAgICAgIGNvbnN0IGluZ3JlZGllbnRzID0gcmVzdWx0LmZpeGVkUmVjaXBlLmluZ3JlZGllbnRzIGFzIGFueVtdO1xuICAgICAgZXhwZWN0KGluZ3JlZGllbnRzWzBdLmFtb3VudCkudG9CZSgyKTtcbiAgICAgIGV4cGVjdChpbmdyZWRpZW50c1swXS5uYW1lKS50b0JlKFwiZmxvdXJcIik7XG4gICAgICBleHBlY3QoaW5ncmVkaWVudHNbMV0uYW1vdW50KS50b0JlKDEpO1xuICAgICAgZXhwZWN0KGluZ3JlZGllbnRzWzFdLnVuaXQpLnRvQmUoXCJwaWVjZVwiKTtcbiAgICB9KTtcblxuICAgIGl0KFwiY29waWVzIGluc3RydWN0aW9ucyBmcm9tIHByZXBhcmF0aW9uU3RlcHNcIiwgKCkgPT4ge1xuICAgICAgY29uc3QgcmVjaXBlID0ge1xuICAgICAgICBuYW1lOiBcIlJlY2lwZVwiLFxuICAgICAgICBwcmVwYXJhdGlvblN0ZXBzOiBbXCJTdGVwIDFcIiwgXCJTdGVwIDJcIl0sXG4gICAgICAgIGluZ3JlZGllbnRzOiBbXSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGZpeFJlY2lwZShyZWNpcGUsIHsgY29weUluc3RydWN0aW9uc0Zyb21TdGVwczogdHJ1ZSB9KTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZml4ZWRSZWNpcGUuaW5zdHJ1Y3Rpb25zKS50b0VxdWFsKFtcIlN0ZXAgMVwiLCBcIlN0ZXAgMlwiXSk7XG4gICAgfSk7XG5cbiAgICBpdChcImNvbnZlcnRzIHN0cmluZyBhcnJheXNcIiwgKCkgPT4ge1xuICAgICAgY29uc3QgcmVjaXBlID0ge1xuICAgICAgICBuYW1lOiBcIlJlY2lwZVwiLFxuICAgICAgICBjb29raW5nTWV0aG9kczogXCJiYWtpbmdcIixcbiAgICAgICAgaW5ncmVkaWVudHM6IFtdLFxuICAgICAgICBpbnN0cnVjdGlvbnM6IFtdLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gZml4UmVjaXBlKHJlY2lwZSwgeyBub3JtYWxpemVBcnJheUZpZWxkczogdHJ1ZSB9KTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZml4ZWRSZWNpcGUuY29va2luZ01ldGhvZHMpLnRvRXF1YWwoW1wiYmFraW5nXCJdKTtcbiAgICB9KTtcblxuICAgIGl0KFwidHJhY2tzIGFsbCBmaXhlcyBhcHBsaWVkXCIsICgpID0+IHtcbiAgICAgIGNvbnN0IHJlY2lwZSA9IHtcbiAgICAgICAgbmFtZTogXCJJbmNvbXBsZXRlIFJlY2lwZVwiLFxuICAgICAgICBwcmVwVGltZTogMzAsXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBmaXhSZWNpcGUocmVjaXBlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZml4ZXMubGVuZ3RoKS50b0JlR3JlYXRlclRoYW4oMCk7XG4gICAgICBleHBlY3QocmVzdWx0LmZpeGVzLmV2ZXJ5KChmKSA9PiBmLmZpZWxkICYmIGYuZGVzY3JpcHRpb24pKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoXCJyZXR1cm5zIHJlbWFpbmluZyBpc3N1ZXNcIiwgKCkgPT4ge1xuICAgICAgY29uc3QgcmVjaXBlID0ge1xuICAgICAgICBuYW1lOiBcIlwiLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gZml4UmVjaXBlKHJlY2lwZSk7XG4gICAgICBleHBlY3QocmVzdWx0LnJlbWFpbmluZ0lzc3Vlcy5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoXCJmaXhBbGxSZWNpcGVzXCIsICgpID0+IHtcbiAgICBpdChcImZpeGVzIG11bHRpcGxlIHJlY2lwZXNcIiwgKCkgPT4ge1xuICAgICAgY29uc3QgcmVjaXBlcyA9IFtcbiAgICAgICAgeyBuYW1lOiBcIlJlY2lwZSAxXCIsIGN1aXNpbmU6IFwiSXRhbGlhblwiIH0sXG4gICAgICAgIHsgbmFtZTogXCJSZWNpcGUgMlwiLCBjdWlzaW5lOiBcIkZyZW5jaFwiIH0sXG4gICAgICBdO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBmaXhBbGxSZWNpcGVzKHJlY2lwZXMpO1xuICAgICAgZXhwZWN0KHJlc3VsdC50b3RhbFJlY2lwZXMpLnRvQmUoMik7XG4gICAgICBleHBlY3QocmVzdWx0LnJlY2lwZXNGaXhlZCkudG9CZSgyKTtcbiAgICB9KTtcblxuICAgIGl0KFwidHJhY2tzIHRvdGFsIGZpeGVzIGJ5IHR5cGVcIiwgKCkgPT4ge1xuICAgICAgY29uc3QgcmVjaXBlcyA9IFt7IG5hbWU6IFwiUmVjaXBlIDFcIiB9LCB7IG5hbWU6IFwiUmVjaXBlIDJcIiB9XTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gZml4QWxsUmVjaXBlcyhyZWNpcGVzKTtcbiAgICAgIGV4cGVjdChyZXN1bHQudG90YWxGaXhlcykudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgICAgZXhwZWN0KE9iamVjdC5rZXlzKHJlc3VsdC5maXhlc0J5VHlwZSkubGVuZ3RoKS50b0JlR3JlYXRlclRoYW4oMCk7XG4gICAgfSk7XG5cbiAgICBpdChcInJlcG9ydHMgdW5maXhlZCByZWNpcGVzXCIsICgpID0+IHtcbiAgICAgIGNvbnN0IHJlY2lwZXMgPSBbXG4gICAgICAgIHsgbmFtZTogXCJcIiB9LCAvLyBDYW5ub3QgYmUgZml4ZWQgLSBubyBuYW1lXG4gICAgICBdO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBmaXhBbGxSZWNpcGVzKHJlY2lwZXMpO1xuICAgICAgZXhwZWN0KHJlc3VsdC51bmZpeGVkUmVjaXBlcy5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoXCJleHRyYWN0Rml4ZWRSZWNpcGVzXCIsICgpID0+IHtcbiAgICBpdChcImV4dHJhY3RzIGZpeGVkIHJlY2lwZSBvYmplY3RzXCIsICgpID0+IHtcbiAgICAgIGNvbnN0IHJlY2lwZXMgPSBbXG4gICAgICAgIHsgbmFtZTogXCJSZWNpcGUgMVwiLCBjdWlzaW5lOiBcIkl0YWxpYW5cIiB9LFxuICAgICAgICB7IG5hbWU6IFwiUmVjaXBlIDJcIiwgY3Vpc2luZTogXCJGcmVuY2hcIiB9LFxuICAgICAgXTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gZml4QWxsUmVjaXBlcyhyZWNpcGVzKTtcbiAgICAgIGNvbnN0IGZpeGVkID0gZXh0cmFjdEZpeGVkUmVjaXBlcyhyZXN1bHQpO1xuXG4gICAgICBleHBlY3QoZml4ZWQpLnRvSGF2ZUxlbmd0aCgyKTtcbiAgICAgIGV4cGVjdChmaXhlZFswXSkudG9IYXZlUHJvcGVydHkoXCJpZFwiKTtcbiAgICAgIGV4cGVjdChmaXhlZFswXSkudG9IYXZlUHJvcGVydHkoXCJlbGVtZW50YWxQcm9wZXJ0aWVzXCIpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZShcIkZpeCBPcHRpb25zXCIsICgpID0+IHtcbiAgICBpdChcInJlc3BlY3RzIGRpc2FibGVkIG9wdGlvbnNcIiwgKCkgPT4ge1xuICAgICAgY29uc3QgcmVjaXBlID0ge1xuICAgICAgICBuYW1lOiBcIlJlY2lwZVwiLFxuICAgICAgICBpbmdyZWRpZW50czogW10sXG4gICAgICAgIGluc3RydWN0aW9uczogW10sXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBvcHRpb25zOiBGaXhPcHRpb25zID0ge1xuICAgICAgICBnZW5lcmF0ZUlkczogZmFsc2UsXG4gICAgICAgIGFkZERlZmF1bHRFbGVtZW50YWw6IGZhbHNlLFxuICAgICAgICBhZGREZWZhdWx0U2VydmluZ1NpemU6IGZhbHNlLFxuICAgICAgICBub3JtYWxpemVTZWFzb25zOiBmYWxzZSxcbiAgICAgICAgbm9ybWFsaXplTWVhbFR5cGVzOiBmYWxzZSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGZpeFJlY2lwZShyZWNpcGUsIG9wdGlvbnMpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5maXhlZFJlY2lwZS5pZCkudG9CZVVuZGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5maXhlZFJlY2lwZS5lbGVtZW50YWxQcm9wZXJ0aWVzKS50b0JlVW5kZWZpbmVkKCk7XG4gICAgICBleHBlY3QocmVzdWx0LmZpeGVkUmVjaXBlLnNlcnZpbmdTaXplKS50b0JlVW5kZWZpbmVkKCk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwidmVyc2lvbiI6M30=