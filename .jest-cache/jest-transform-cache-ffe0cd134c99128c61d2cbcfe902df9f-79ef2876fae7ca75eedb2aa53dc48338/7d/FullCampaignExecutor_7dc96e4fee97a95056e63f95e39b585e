40138c5589099eabeb5cf0307829fe26
"use strict";
/**
 * Full Campaign Executor for Unintentional Any Elimination
 *
 * Executes the complete unintentional any elimination campaign across all domains
 * with target achievement of 15-20% reduction (250-350 fixes from 2,022 unintentional)
 */
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.FullCampaignExecutor = void 0;
const child_process_1 = require("child_process");
const fs = __importStar(require("fs"));
const AnalysisTools_1 = require("./AnalysisTools");
const AnyTypeClassifier_1 = require("./AnyTypeClassifier");
const AutoDocumentationGenerator_1 = require("./AutoDocumentationGenerator");
const DomainContextAnalyzer_1 = require("./DomainContextAnalyzer");
const ProgressMonitoringSystem_1 = require("./ProgressMonitoringSystem");
const ProgressiveImprovementEngine_1 = require("./ProgressiveImprovementEngine");
const SafeTypeReplacer_1 = require("./SafeTypeReplacer");
const types_1 = require("./types");
class FullCampaignExecutor {
    classifier;
    replacer;
    domainAnalyzer;
    progressiveEngine;
    documentationGenerator;
    analysisTools;
    progressMonitor;
    config;
    startTime;
    metrics;
    constructor(config = {}) {
        this.config = {
            targetReductionPercentage: 17.5,
            targetFixCount: 300,
            maxBatchSize: 25,
            minBatchSize: 10,
            safetyThreshold: 0.7,
            buildValidationFrequency: 5,
            enableDocumentation: true,
            enableProgressiveStrategy: true,
            processAllDomains: true,
            generateFinalReport: true,
            validatePerformanceImprovements: true,
            emergencyStopThreshold: 0.5,
            maxCampaignDuration: 4 * 60 * 60 * 1000,
            ...config
        };
        this.classifier = new AnyTypeClassifier_1.AnyTypeClassifier();
        this.replacer = new SafeTypeReplacer_1.SafeTypeReplacer();
        this.domainAnalyzer = new DomainContextAnalyzer_1.DomainContextAnalyzer();
        this.progressiveEngine = new ProgressiveImprovementEngine_1.ProgressiveImprovementEngine();
        this.documentationGenerator = new AutoDocumentationGenerator_1.AutoDocumentationGenerator();
        this.analysisTools = new AnalysisTools_1.AnalysisTools();
        this.progressMonitor = new ProgressMonitoringSystem_1.ProgressMonitoringSystem();
        this.startTime = new Date();
        this.metrics = this.initializeMetrics();
    }
    /**
     * Execute the complete unintentional any elimination campaign
     */
    async executeFullCampaign() {
        console.log('üöÄ Starting Full Unintentional Any Elimination Campaign');
        console.log(`üìä Target: ${this.config.targetReductionPercentage}% reduction (${this.config.targetFixCount} fixes)`);
        try {
            // Phase 1: Initial Analysis and Baseline
            const baselineResult = await this.executePhase1_InitialAnalysis();
            // Phase 2: High-Confidence Replacements
            const highConfidenceResult = await this.executePhase2_HighConfidenceReplacements();
            // Phase 3: Medium-Risk Category Processing
            const mediumRiskResult = await this.executePhase3_MediumRiskProcessing();
            // Phase 4: Domain-Specific Processing
            const domainSpecificResult = await this.executePhase4_DomainSpecificProcessing();
            // Phase 5: Documentation and Validation
            const documentationResult = await this.executePhase5_DocumentationAndValidation();
            // Phase 6: Final Validation and Reporting
            const finalResult = await this.executePhase6_FinalValidationAndReporting();
            const campaignResult = {
                success: true,
                totalFixesApplied: this.metrics.totalFixesApplied,
                reductionPercentage: this.calculateReductionPercentage(),
                targetAchieved: this.isTargetAchieved(),
                phases: [
                    baselineResult,
                    highConfidenceResult,
                    mediumRiskResult,
                    domainSpecificResult,
                    documentationResult,
                    finalResult
                ],
                metrics: this.metrics,
                finalReport: await this.generateFinalReport(),
                duration: Date.now() - this.startTime.getTime(),
                buildStable: await this.validateBuildStability(),
                performanceImproved: await this.validatePerformanceImprovements()
            };
            console.log('‚úÖ Full Campaign Completed Successfully');
            console.log(`üìà Achieved: ${campaignResult.reductionPercentage.toFixed(1)}% reduction`);
            console.log(`üéØ Target Met: ${campaignResult.targetAchieved ? 'YES' : 'NO'}`);
            return campaignResult;
        }
        catch (error) {
            console.error('‚ùå Campaign execution failed:', error);
            return {
                success: false,
                error: error instanceof Error ? error.message : 'Unknown error',
                totalFixesApplied: this.metrics.totalFixesApplied,
                reductionPercentage: this.calculateReductionPercentage(),
                targetAchieved: false,
                phases: [],
                metrics: this.metrics,
                duration: Date.now() - this.startTime.getTime(),
                buildStable: await this.validateBuildStability(),
                performanceImproved: false
            };
        }
    }
    /**
     * Phase 1: Initial Analysis and Baseline Establishment
     */
    async executePhase1_InitialAnalysis() {
        console.log('\nüìã Phase 1: Initial Analysis and Baseline');
        const phaseStart = Date.now();
        try {
            // Get initial baseline metrics
            const initialErrorCount = await this.getCurrentErrorCount();
            const initialAnyCount = await this.getCurrentAnyCount();
            console.log(`üìä Baseline - TypeScript Errors: ${initialErrorCount}`);
            console.log(`üìä Baseline - Explicit Any Count: ${initialAnyCount}`);
            // Perform comprehensive analysis
            const analysisResult = await this.analysisTools.performComprehensiveAnalysis();
            // Update metrics
            this.metrics.initialErrorCount = initialErrorCount;
            this.metrics.initialAnyCount = initialAnyCount;
            this.metrics.baselineEstablished = true;
            return {
                name: 'Initial Analysis and Baseline',
                success: true,
                duration: Date.now() - phaseStart,
                fixesApplied: 0,
                errorsBefore: initialErrorCount,
                errorsAfter: initialErrorCount,
                details: {
                    analysisResult,
                    baselineMetrics: {
                        errorCount: initialErrorCount,
                        anyCount: initialAnyCount
                    }
                }
            };
        }
        catch (error) {
            console.error('‚ùå Phase 1 failed:', error);
            throw error;
        }
    }
    /**
     * Phase 2: High-Confidence Replacements (Array types, simple Records)
     */
    async executePhase2_HighConfidenceReplacements() {
        console.log('\nüéØ Phase 2: High-Confidence Replacements');
        const phaseStart = Date.now();
        const errorsBefore = await this.getCurrentErrorCount();
        try {
            let totalFixes = 0;
            let batchCount = 0;
            const maxBatches = 20; // Limit for high-confidence phase
            while (batchCount < maxBatches && totalFixes < this.config.targetFixCount * 0.6) {
                console.log(`\nüîÑ High-Confidence Batch ${batchCount + 1}`);
                // Find high-confidence cases
                const highConfidenceCases = await this.findHighConfidenceCases();
                if (highConfidenceCases.length === 0) {
                    console.log('‚úÖ No more high-confidence cases found');
                    break;
                }
                // Process batch with enhanced safety
                const batchResult = await this.processBatchWithSafety(highConfidenceCases.slice(0, this.config.maxBatchSize), 'high-confidence');
                totalFixes += batchResult.successfulReplacements;
                this.metrics.totalFixesApplied += batchResult.successfulReplacements;
                // Validate build after each batch
                if (!await this.validateBuildStability()) {
                    console.error('‚ùå Build instability detected, stopping phase');
                    break;
                }
                batchCount++;
                // Progress update
                console.log(`üìà Phase 2 Progress: ${totalFixes} fixes applied`);
            }
            const errorsAfter = await this.getCurrentErrorCount();
            return {
                name: 'High-Confidence Replacements',
                success: true,
                duration: Date.now() - phaseStart,
                fixesApplied: totalFixes,
                errorsBefore,
                errorsAfter,
                details: {
                    batchesProcessed: batchCount,
                    categories: ['ARRAY_TYPE', 'RECORD_TYPE']
                }
            };
        }
        catch (error) {
            console.error('‚ùå Phase 2 failed:', error);
            throw error;
        }
    }
    /**
     * Phase 3: Medium-Risk Category Processing
     */
    async executePhase3_MediumRiskProcessing() {
        console.log('\n‚öñÔ∏è Phase 3: Medium-Risk Category Processing');
        const phaseStart = Date.now();
        const errorsBefore = await this.getCurrentErrorCount();
        try {
            let totalFixes = 0;
            const mediumRiskCategories = [
                types_1.AnyTypeCategory.FUNCTION_PARAM,
                types_1.AnyTypeCategory.RETURN_TYPE,
                types_1.AnyTypeCategory.TYPE_ASSERTION
            ];
            for (const category of mediumRiskCategories) {
                console.log(`\nüîç Processing ${category} category`);
                const categoryFixes = await this.processCategoryWithEnhancedSafety(category);
                totalFixes += categoryFixes;
                this.metrics.totalFixesApplied += categoryFixes;
                // Validate after each category
                if (!await this.validateBuildStability()) {
                    console.error(`‚ùå Build instability after ${category}, stopping`);
                    break;
                }
                console.log(`‚úÖ ${category}: ${categoryFixes} fixes applied`);
            }
            const errorsAfter = await this.getCurrentErrorCount();
            return {
                name: 'Medium-Risk Category Processing',
                success: true,
                duration: Date.now() - phaseStart,
                fixesApplied: totalFixes,
                errorsBefore,
                errorsAfter,
                details: {
                    categoriesProcessed: mediumRiskCategories,
                    enhancedSafetyProtocols: true
                }
            };
        }
        catch (error) {
            console.error('‚ùå Phase 3 failed:', error);
            throw error;
        }
    }
    /**
     * Phase 4: Domain-Specific Processing
     */
    async executePhase4_DomainSpecificProcessing() {
        console.log('\nüèóÔ∏è Phase 4: Domain-Specific Processing');
        const phaseStart = Date.now();
        const errorsBefore = await this.getCurrentErrorCount();
        try {
            const domains = ['astrological', 'recipe', 'campaign', 'service', 'component'];
            const domainResults = [];
            let totalFixes = 0;
            for (const domain of domains) {
                console.log(`\nüéØ Processing ${domain} domain`);
                const domainFixes = await this.processDomainSpecific(domain);
                totalFixes += domainFixes.fixesApplied;
                this.metrics.totalFixesApplied += domainFixes.fixesApplied;
                domainResults.push(domainFixes);
                // Validate after each domain
                if (!await this.validateBuildStability()) {
                    console.error(`‚ùå Build instability after ${domain} domain`);
                    break;
                }
                console.log(`‚úÖ ${domain} domain: ${domainFixes.fixesApplied} fixes applied`);
            }
            const errorsAfter = await this.getCurrentErrorCount();
            return {
                name: 'Domain-Specific Processing',
                success: true,
                duration: Date.now() - phaseStart,
                fixesApplied: totalFixes,
                errorsBefore,
                errorsAfter,
                details: {
                    domainResults,
                    domainsProcessed: domains
                }
            };
        }
        catch (error) {
            console.error('‚ùå Phase 4 failed:', error);
            throw error;
        }
    }
    /**
     * Phase 5: Documentation and Validation
     */
    async executePhase5_DocumentationAndValidation() {
        console.log('\nüìù Phase 5: Documentation and Validation');
        const phaseStart = Date.now();
        const errorsBefore = await this.getCurrentErrorCount();
        try {
            // Document all intentional any types
            const documentationResult = await this.documentationGenerator.documentAllIntentionalAnyTypes();
            // Add ESLint disable comments with explanations
            const eslintResult = await this.addESLintDisableComments();
            // Validate documentation completeness
            const validationResult = await this.validateDocumentationCompleteness();
            console.log(`üìù Documented ${documentationResult.documented} intentional any types`);
            console.log(`üîß Added ${eslintResult.added} ESLint disable comments`);
            console.log(`‚úÖ Documentation validation: ${validationResult.complete ? 'COMPLETE' : 'INCOMPLETE'}`);
            const errorsAfter = await this.getCurrentErrorCount();
            return {
                name: 'Documentation and Validation',
                success: true,
                duration: Date.now() - phaseStart,
                fixesApplied: 0,
                errorsBefore,
                errorsAfter,
                details: {
                    documentationResult,
                    eslintResult,
                    validationResult
                }
            };
        }
        catch (error) {
            console.error('‚ùå Phase 5 failed:', error);
            throw error;
        }
    }
    /**
     * Phase 6: Final Validation and Reporting
     */
    async executePhase6_FinalValidationAndReporting() {
        console.log('\nüìä Phase 6: Final Validation and Reporting');
        const phaseStart = Date.now();
        const errorsBefore = await this.getCurrentErrorCount();
        try {
            // Final TypeScript error validation
            const finalErrorCount = await this.getCurrentErrorCount();
            const finalAnyCount = await this.getCurrentAnyCount();
            // Build performance validation
            const performanceResult = await this.validatePerformanceImprovements();
            // Generate comprehensive final report
            const finalReport = await this.generateFinalReport();
            // Update final metrics
            this.metrics.finalErrorCount = finalErrorCount;
            this.metrics.finalAnyCount = finalAnyCount;
            this.metrics.campaignCompleted = true;
            console.log(`üìä Final Metrics:`);
            console.log(`   TypeScript Errors: ${this.metrics.initialErrorCount} ‚Üí ${finalErrorCount}`);
            console.log(`   Explicit Any Count: ${this.metrics.initialAnyCount} ‚Üí ${finalAnyCount}`);
            console.log(`   Total Fixes Applied: ${this.metrics.totalFixesApplied}`);
            console.log(`   Reduction Percentage: ${this.calculateReductionPercentage().toFixed(1)}%`);
            console.log(`   Target Achieved: ${this.isTargetAchieved() ? 'YES' : 'NO'}`);
            console.log(`   Build Performance: ${performanceResult ? 'IMPROVED' : 'STABLE'}`);
            return {
                name: 'Final Validation and Reporting',
                success: true,
                duration: Date.now() - phaseStart,
                fixesApplied: 0,
                errorsBefore,
                errorsAfter: finalErrorCount,
                details: {
                    finalReport,
                    performanceResult,
                    targetAchieved: this.isTargetAchieved()
                }
            };
        }
        catch (error) {
            console.error('‚ùå Phase 6 failed:', error);
            throw error;
        }
    }
    /**
     * Find high-confidence cases for replacement
     */
    async findHighConfidenceCases() {
        const files = await this.getTypeScriptFiles();
        const highConfidenceCases = [];
        for (const file of files.slice(0, 50)) { // Process in chunks
            try {
                const content = fs.readFileSync(file, 'utf8');
                const cases = await this.classifier.classifyFileContent(file, content);
                // Filter for high-confidence unintentional cases
                const highConfidence = cases.filter(c => !c.isIntentional &&
                    c.confidence >= 0.85 &&
                    (c.category === types_1.AnyTypeCategory.ARRAY_TYPE || c.category === types_1.AnyTypeCategory.RECORD_TYPE));
                highConfidenceCases.push(...highConfidence);
            }
            catch (error) {
                console.warn(`Warning: Could not process ${file}:`, error);
            }
        }
        return highConfidenceCases.slice(0, this.config.maxBatchSize);
    }
    /**
     * Process a batch with enhanced safety protocols
     */
    async processBatchWithSafety(cases, batchType) {
        console.log(`üîß Processing ${cases.length} ${batchType} cases`);
        // Create backup before processing
        const backupPath = await this.createBackup();
        try {
            const result = await this.replacer.processBatch(cases);
            // Validate build after replacement
            if (!await this.validateBuildStability()) {
                console.warn('‚ö†Ô∏è Build instability detected, rolling back');
                await this.restoreBackup(backupPath);
                return {
                    success: false,
                    appliedReplacements: [],
                    failedReplacements: cases.map(c => ({
                        original: 'any',
                        replacement: c.suggestedReplacement || 'unknown',
                        filePath: c.filePath,
                        lineNumber: c.lineNumber,
                        confidence: c.confidence,
                        validationRequired: true
                    })),
                    compilationErrors: ['Build instability after replacement'],
                    rollbackPerformed: true,
                    backupPath,
                    successfulReplacements: 0,
                    totalAttempted: cases.length
                };
            }
            console.log(`‚úÖ Batch completed: ${result.successfulReplacements}/${cases.length} successful`);
            return result;
        }
        catch (error) {
            console.error('‚ùå Batch processing failed:', error);
            await this.restoreBackup(backupPath);
            throw error;
        }
    }
    /**
     * Process a specific category with enhanced safety
     */
    async processCategoryWithEnhancedSafety(category) {
        const files = await this.getTypeScriptFiles();
        let totalFixes = 0;
        let batchCount = 0;
        const maxBatches = 15; // Limit for medium-risk categories
        while (batchCount < maxBatches) {
            const categoryCases = await this.findCategorySpecificCases(category, files);
            if (categoryCases.length === 0) {
                break;
            }
            const batchResult = await this.processBatchWithSafety(categoryCases.slice(0, this.config.minBatchSize), // Smaller batches for medium-risk
            `${category}-batch-${batchCount + 1}`);
            totalFixes += batchResult.successfulReplacements;
            batchCount++;
            // More frequent validation for medium-risk
            if (batchCount % 3 === 0) {
                if (!await this.validateBuildStability()) {
                    console.warn(`‚ö†Ô∏è Stopping ${category} processing due to build instability`);
                    break;
                }
            }
        }
        return totalFixes;
    }
    /**
     * Process domain-specific cases
     */
    async processDomainSpecific(domain) {
        const domainFiles = await this.getDomainFiles(domain);
        let fixesApplied = 0;
        const processedFiles = [];
        for (const file of domainFiles.slice(0, 20)) { // Limit per domain
            try {
                const content = fs.readFileSync(file, 'utf8');
                const domainContext = await this.domainAnalyzer.analyzeDomain(file, content);
                const cases = await this.classifier.classifyFileContent(file, content);
                // Filter for domain-appropriate cases
                const domainCases = cases.filter(c => !c.isIntentional &&
                    c.confidence >= 0.7 &&
                    this.isDomainAppropriate(c, domainContext));
                if (domainCases.length > 0) {
                    const result = await this.processBatchWithSafety(domainCases, `${domain}-domain`);
                    fixesApplied += result.successfulReplacements;
                    processedFiles.push(file);
                }
            }
            catch (error) {
                console.warn(`Warning: Could not process domain file ${file}:`, error);
            }
        }
        return {
            domain,
            fixesApplied,
            filesProcessed: processedFiles.length,
            processedFiles
        };
    }
    /**
     * Add ESLint disable comments for intentional any types
     */
    async addESLintDisableComments() {
        const files = await this.getTypeScriptFiles();
        let added = 0;
        for (const file of files) {
            try {
                const content = fs.readFileSync(file, 'utf8');
                const cases = await this.classifier.classifyFileContent(file, content);
                const intentionalCases = cases.filter(c => c.isIntentional);
                if (intentionalCases.length > 0) {
                    const updatedContent = await this.addESLintCommentsToFile(file, content, intentionalCases);
                    if (updatedContent !== content) {
                        fs.writeFileSync(file, updatedContent);
                        added += intentionalCases.length;
                    }
                }
            }
            catch (error) {
                console.warn(`Warning: Could not add ESLint comments to ${file}:`, error);
            }
        }
        return { added };
    }
    /**
     * Add ESLint disable comments to a specific file
     */
    async addESLintCommentsToFile(filePath, content, intentionalCases) {
        const lines = content.split('\n');
        let modified = false;
        for (const case_ of intentionalCases) {
            const lineIndex = case_.lineNumber - 1;
            if (lineIndex >= 0 && lineIndex < lines.length) {
                const line = lines[lineIndex];
                // Check if ESLint disable comment already exists
                if (!line.includes('eslint-disable') && !lines[lineIndex - 1]?.includes('eslint-disable')) {
                    const reason = this.getESLintDisableReason(case_);
                    const comment = `// eslint-disable-next-line @typescript-eslint/no-explicit-any -- ${reason}`;
                    // Insert comment on the line before
                    lines.splice(lineIndex, 0, comment);
                    modified = true;
                }
            }
        }
        return modified ? lines.join('\n') : content;
    }
    /**
     * Get appropriate ESLint disable reason
     */
    getESLintDisableReason(case_) {
        switch (case_.category) {
            case types_1.AnyTypeCategory.ERROR_HANDLING:
                return 'Error handling requires flexible typing';
            case types_1.AnyTypeCategory.EXTERNAL_API:
                return 'External API response with unknown structure';
            case types_1.AnyTypeCategory.DYNAMIC_CONFIG:
                return 'Dynamic configuration requires flexible typing';
            case types_1.AnyTypeCategory.TEST_MOCK:
                return 'Test mock requires flexible typing';
            default:
                return case_.reasoning || 'Intentional any type for flexibility';
        }
    }
    /**
     * Validate documentation completeness
     */
    async validateDocumentationCompleteness() {
        const files = await this.getTypeScriptFiles();
        let undocumented = 0;
        for (const file of files) {
            try {
                const content = fs.readFileSync(file, 'utf8');
                const cases = await this.classifier.classifyFileContent(file, content);
                const intentionalCases = cases.filter(c => c.isIntentional);
                for (const case_ of intentionalCases) {
                    if (!case_.requiresDocumentation)
                        continue;
                    const hasDocumentation = this.hasAdequateDocumentation(content, case_);
                    if (!hasDocumentation) {
                        undocumented++;
                    }
                }
            }
            catch (error) {
                console.warn(`Warning: Could not validate documentation in ${file}:`, error);
            }
        }
        return {
            complete: undocumented === 0,
            undocumented
        };
    }
    /**
     * Check if a case has adequate documentation
     */
    hasAdequateDocumentation(content, case_) {
        const lines = content.split('\n');
        const lineIndex = case_.lineNumber - 1;
        // Check previous lines for comments or ESLint disable
        for (let i = Math.max(0, lineIndex - 3); i < lineIndex; i++) {
            const line = lines[i];
            if (line.includes('//') || line.includes('/*') || line.includes('eslint-disable')) {
                return true;
            }
        }
        return false;
    }
    /**
     * Generate comprehensive final report
     */
    async generateFinalReport() {
        const currentTime = new Date();
        const duration = currentTime.getTime() - this.startTime.getTime();
        return {
            campaignId: `full-campaign-${this.startTime.getTime()}`,
            startTime: this.startTime,
            endTime: currentTime,
            duration,
            targetReductionPercentage: this.config.targetReductionPercentage,
            actualReductionPercentage: this.calculateReductionPercentage(),
            targetFixCount: this.config.targetFixCount,
            actualFixCount: this.metrics.totalFixesApplied,
            targetAchieved: this.isTargetAchieved(),
            initialMetrics: {
                errorCount: this.metrics.initialErrorCount,
                anyCount: this.metrics.initialAnyCount
            },
            finalMetrics: {
                errorCount: this.metrics.finalErrorCount,
                anyCount: this.metrics.finalAnyCount
            },
            buildStable: await this.validateBuildStability(),
            performanceImproved: await this.validatePerformanceImprovements(),
            recommendations: this.generateRecommendations(),
            achievements: this.generateAchievements(),
            nextSteps: this.generateNextSteps()
        };
    }
    /**
     * Helper methods
     */
    initializeMetrics() {
        return {
            initialErrorCount: 0,
            initialAnyCount: 0,
            finalErrorCount: 0,
            finalAnyCount: 0,
            totalFixesApplied: 0,
            batchesProcessed: 0,
            rollbacksPerformed: 0,
            buildValidationsPerformed: 0,
            baselineEstablished: false,
            campaignCompleted: false
        };
    }
    calculateReductionPercentage() {
        if (this.metrics.initialAnyCount === 0)
            return 0;
        const reduction = this.metrics.initialAnyCount - this.metrics.finalAnyCount;
        return (reduction / this.metrics.initialAnyCount) * 100;
    }
    isTargetAchieved() {
        const reductionPercentage = this.calculateReductionPercentage();
        return reductionPercentage >= 15 && this.metrics.totalFixesApplied >= 250;
    }
    async getCurrentErrorCount() {
        try {
            const output = (0, child_process_1.execSync)('yarn tsc --noEmit --skipLibCheck 2>&1 | grep -c "error TS" || echo "0"', {
                encoding: 'utf8',
                stdio: 'pipe'
            });
            return parseInt(output.trim()) || 0;
        }
        catch {
            return -1;
        }
    }
    async getCurrentAnyCount() {
        try {
            const output = (0, child_process_1.execSync)('yarn lint --format=json 2>/dev/null | jq -r ".[].messages[] | select(.ruleId == \\"@typescript-eslint/no-explicit-any\\") | .ruleId" | wc -l || echo "0"', {
                encoding: 'utf8',
                stdio: 'pipe'
            });
            return parseInt(output.trim()) || 0;
        }
        catch {
            // Fallback: count explicit any patterns in TypeScript files
            try {
                const output = (0, child_process_1.execSync)('find src -name "*.ts" -o -name "*.tsx" | xargs grep -c ": any" | awk -F: \'{sum += $2} END {print sum}\' || echo "0"', {
                    encoding: 'utf8',
                    stdio: 'pipe'
                });
                return parseInt(output.trim()) || 0;
            }
            catch {
                return 0;
            }
        }
    }
    async validateBuildStability() {
        try {
            (0, child_process_1.execSync)('yarn tsc --noEmit --skipLibCheck', { stdio: 'pipe' });
            return true;
        }
        catch {
            return false;
        }
    }
    async validatePerformanceImprovements() {
        // This would typically measure build time, bundle size, etc.
        // For now, return true if build is stable
        return await this.validateBuildStability();
    }
    async getTypeScriptFiles() {
        try {
            const output = (0, child_process_1.execSync)('find src -name "*.ts" -o -name "*.tsx" | grep -v __tests__ | grep -v .test. | head -200', {
                encoding: 'utf8'
            });
            return output.trim().split('\n').filter(f => f.length > 0);
        }
        catch {
            return [];
        }
    }
    async getDomainFiles(domain) {
        const allFiles = await this.getTypeScriptFiles();
        return allFiles.filter(file => {
            const lowerFile = file.toLowerCase();
            switch (domain) {
                case 'astrological':
                    return lowerFile.includes('astro') || lowerFile.includes('planet') || lowerFile.includes('calculation');
                case 'recipe':
                    return lowerFile.includes('recipe') || lowerFile.includes('ingredient') || lowerFile.includes('food');
                case 'campaign':
                    return lowerFile.includes('campaign') || lowerFile.includes('metrics');
                case 'service':
                    return lowerFile.includes('service') || lowerFile.includes('api');
                case 'component':
                    return lowerFile.includes('component') || lowerFile.includes('tsx');
                default:
                    return false;
            }
        });
    }
    async findCategorySpecificCases(category, files) {
        const cases = [];
        for (const file of files.slice(0, 30)) {
            try {
                const content = fs.readFileSync(file, 'utf8');
                const fileCases = await this.classifier.classifyFileContent(file, content);
                const categoryCases = fileCases.filter(c => !c.isIntentional &&
                    c.category === category &&
                    c.confidence >= 0.6);
                cases.push(...categoryCases);
            }
            catch (error) {
                console.warn(`Warning: Could not process ${file}:`, error);
            }
        }
        return cases.slice(0, this.config.minBatchSize);
    }
    isDomainAppropriate(case_, domainContext) {
        // Domain-specific logic for determining if a case is appropriate for replacement
        return case_.confidence >= 0.7;
    }
    async createBackup() {
        const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
        const backupPath = `backups/full-campaign-${timestamp}`;
        try {
            (0, child_process_1.execSync)(`mkdir -p ${backupPath}`);
            (0, child_process_1.execSync)(`cp -r src ${backupPath}/`);
            return backupPath;
        }
        catch (error) {
            console.warn('Warning: Could not create backup:', error);
            return '';
        }
    }
    async restoreBackup(backupPath) {
        if (!backupPath || !fs.existsSync(backupPath)) {
            console.warn('Warning: Backup path not found, cannot restore');
            return;
        }
        try {
            (0, child_process_1.execSync)(`rm -rf src`);
            (0, child_process_1.execSync)(`cp -r ${backupPath}/src .`);
            console.log('‚úÖ Backup restored successfully');
        }
        catch (error) {
            console.error('‚ùå Failed to restore backup:', error);
        }
    }
    generateRecommendations() {
        const recommendations = [];
        if (this.metrics.totalFixesApplied < this.config.targetFixCount) {
            recommendations.push('Consider expanding pattern recognition for additional opportunities');
        }
        if (this.metrics.rollbacksPerformed > 0) {
            recommendations.push('Review rollback cases for potential manual fixes');
        }
        recommendations.push('Continue monitoring for new unintentional any types in future development');
        recommendations.push('Consider implementing pre-commit hooks to prevent new unintentional any types');
        return recommendations;
    }
    generateAchievements() {
        const achievements = [];
        achievements.push(`Applied ${this.metrics.totalFixesApplied} successful type improvements`);
        achievements.push(`Achieved ${this.calculateReductionPercentage().toFixed(1)}% reduction in explicit any usage`);
        if (this.isTargetAchieved()) {
            achievements.push('‚úÖ Successfully met campaign targets');
        }
        if (this.metrics.rollbacksPerformed === 0) {
            achievements.push('‚úÖ Zero rollbacks - perfect safety record');
        }
        return achievements;
    }
    generateNextSteps() {
        return [
            'Monitor build performance and stability over the next week',
            'Review any remaining intentional any types for potential improvements',
            'Consider implementing automated monitoring for new unintentional any types',
            'Document lessons learned for future campaigns',
            'Plan follow-up campaigns for other code quality improvements'
        ];
    }
}
exports.FullCampaignExecutor = FullCampaignExecutor;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9zZXJ2aWNlcy9jYW1wYWlnbi91bmludGVudGlvbmFsLWFueS1lbGltaW5hdGlvbi9GdWxsQ2FtcGFpZ25FeGVjdXRvci50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7O0dBS0c7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBRUgsaURBQXlDO0FBQ3pDLHVDQUF5QjtBQUN6QixtREFBZ0Q7QUFDaEQsMkRBQXdEO0FBQ3hELDZFQUEwRTtBQUMxRSxtRUFBZ0U7QUFDaEUseUVBQXNFO0FBQ3RFLGlGQUE4RTtBQUM5RSx5REFBc0Q7QUFDdEQsbUNBVWlCO0FBRWpCLE1BQWEsb0JBQW9CO0lBQ3ZCLFVBQVUsQ0FBb0I7SUFDOUIsUUFBUSxDQUFtQjtJQUMzQixjQUFjLENBQXdCO0lBQ3RDLGlCQUFpQixDQUErQjtJQUNoRCxzQkFBc0IsQ0FBNkI7SUFDbkQsYUFBYSxDQUFnQjtJQUM3QixlQUFlLENBQTJCO0lBQzFDLE1BQU0sQ0FBcUI7SUFDM0IsU0FBUyxDQUFPO0lBQ2hCLE9BQU8sQ0FBa0I7SUFFakMsWUFBWSxTQUFzQyxFQUFFO1FBQ2xELElBQUksQ0FBQyxNQUFNLEdBQUc7WUFDWix5QkFBeUIsRUFBRSxJQUFJO1lBQy9CLGNBQWMsRUFBRSxHQUFHO1lBQ25CLFlBQVksRUFBRSxFQUFFO1lBQ2hCLFlBQVksRUFBRSxFQUFFO1lBQ2hCLGVBQWUsRUFBRSxHQUFHO1lBQ3BCLHdCQUF3QixFQUFFLENBQUM7WUFDM0IsbUJBQW1CLEVBQUUsSUFBSTtZQUN6Qix5QkFBeUIsRUFBRSxJQUFJO1lBQy9CLGlCQUFpQixFQUFFLElBQUk7WUFDdkIsbUJBQW1CLEVBQUUsSUFBSTtZQUN6QiwrQkFBK0IsRUFBRSxJQUFJO1lBQ3JDLHNCQUFzQixFQUFFLEdBQUc7WUFDM0IsbUJBQW1CLEVBQUUsQ0FBQyxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsSUFBSTtZQUN2QyxHQUFHLE1BQU07U0FDVixDQUFDO1FBRUYsSUFB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ZUFBZSxDQUFDO0lBQ3pCLENBQUM7SUFFTyxvQkFBb0I7UUFDMUIsTUFBTSxZQUFZLEdBQWEsRUFBRSxDQUFDO1FBRWxDLFlBQVksQ0FBQyxJQUFJLENBQUMsV0FBVyxJQUFJLENBQUMsT0FBTyxDQUFDLGlCQUFpQiwrQkFBK0IsQ0FBQyxDQUFDO1FBQzVGLFlBQVksQ0FBQyxJQUFJLENBQUMsWUFBWSxJQUFJLENBQUMsNEJBQTRCLEVBQUUsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLG1DQUFtQyxDQUFDLENBQUM7UUFFakgsSUFBSSxJQUFJLENBQUMsZ0JBQWdCLEVBQUUsRUFBRTtZQUMzQixZQUFZLENBQUMsSUFBSSxDQUFDLHFDQUFxQyxDQUFDLENBQUM7U0FDMUQ7UUFFRCxJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsa0JBQWtCLEtBQUssQ0FBQyxFQUFFO1lBQ3pDLFlBQVksQ0FBQyxJQUFJLENBQUMsMENBQTBDLENBQUMsQ0FBQztTQUMvRDtRQUVELE9BQU8sWUFBWSxDQUFDO0lBQ3RCLENBQUM7SUFFTyxpQkFBaUI7UUFDdkIsT0FBTztZQUNMLDREQUE0RDtZQUM1RCx1RUFBdUU7WUFDdkUsNEVBQTRFO1lBQzVFLCtDQUErQztZQUMvQyw4REFBOEQ7U0FDL0QsQ0FBQztJQUNKLENBQUM7Q0FDRjtBQTk3QkQsb0RBODdCQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvR3JlZ0Nhc3Ryby9EZXNrdG9wL1doYXRUb0VhdE5leHQvc3JjL3NlcnZpY2VzL2NhbXBhaWduL3VuaW50ZW50aW9uYWwtYW55LWVsaW1pbmF0aW9uL0Z1bGxDYW1wYWlnbkV4ZWN1dG9yLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogRnVsbCBDYW1wYWlnbiBFeGVjdXRvciBmb3IgVW5pbnRlbnRpb25hbCBBbnkgRWxpbWluYXRpb25cbiAqXG4gKiBFeGVjdXRlcyB0aGUgY29tcGxldGUgdW5pbnRlbnRpb25hbCBhbnkgZWxpbWluYXRpb24gY2FtcGFpZ24gYWNyb3NzIGFsbCBkb21haW5zXG4gKiB3aXRoIHRhcmdldCBhY2hpZXZlbWVudCBvZiAxNS0yMCUgcmVkdWN0aW9uICgyNTAtMzUwIGZpeGVzIGZyb20gMiwwMjIgdW5pbnRlbnRpb25hbClcbiAqL1xuXG5pbXBvcnQgeyBleGVjU3luYyB9IGZyb20gJ2NoaWxkX3Byb2Nlc3MnO1xuaW1wb3J0ICogYXMgZnMgZnJvbSAnZnMnO1xuaW1wb3J0IHsgQW5hbHlzaXNUb29scyB9IGZyb20gJy4vQW5hbHlzaXNUb29scyc7XG5pbXBvcnQgeyBBbnlUeXBlQ2xhc3NpZmllciB9IGZyb20gJy4vQW55VHlwZUNsYXNzaWZpZXInO1xuaW1wb3J0IHsgQXV0b0RvY3VtZW50YXRpb25HZW5lcmF0b3IgfSBmcm9tICcuL0F1dG9Eb2N1bWVudGF0aW9uR2VuZXJhdG9yJztcbmltcG9ydCB7IERvbWFpbkNvbnRleHRBbmFseXplciB9IGZyb20gJy4vRG9tYWluQ29udGV4dEFuYWx5emVyJztcbmltcG9ydCB7IFByb2dyZXNzTW9uaXRvcmluZ1N5c3RlbSB9IGZyb20gJy4vUHJvZ3Jlc3NNb25pdG9yaW5nU3lzdGVtJztcbmltcG9ydCB7IFByb2dyZXNzaXZlSW1wcm92ZW1lbnRFbmdpbmUgfSBmcm9tICcuL1Byb2dyZXNzaXZlSW1wcm92ZW1lbnRFbmdpbmUnO1xuaW1wb3J0IHsgU2FmZVR5cGVSZXBsYWNlciB9IGZyb20gJy4vU2FmZVR5cGVSZXBsYWNlcic7XG5pbXBvcnQge1xuICAgIEFueVR5cGVDYXRlZ29yeSxcbiAgICBBbnlUeXBlQ2xhc3NpZmljYXRpb24sXG4gICAgQ2FtcGFpZ25NZXRyaWNzLFxuICAgIENhbXBhaWduUGhhc2UsXG4gICAgRG9tYWluUHJvY2Vzc2luZ1Jlc3VsdCxcbiAgICBGaW5hbFJlcG9ydCxcbiAgICBGdWxsQ2FtcGFpZ25Db25maWcsXG4gICAgRnVsbENhbXBhaWduUmVzdWx0LFxuICAgIFJlcGxhY2VtZW50UmVzdWx0XG59IGZyb20gJy4vdHlwZXMnO1xuXG5leHBvcnQgY2xhc3MgRnVsbENhbXBhaWduRXhlY3V0b3Ige1xuICBwcml2YXRlIGNsYXNzaWZpZXI6IEFueVR5cGVDbGFzc2lmaWVyO1xuICBwcml2YXRlIHJlcGxhY2VyOiBTYWZlVHlwZVJlcGxhY2VyO1xuICBwcml2YXRlIGRvbWFpbkFuYWx5emVyOiBEb21haW5Db250ZXh0QW5hbHl6ZXI7XG4gIHByaXZhdGUgcHJvZ3Jlc3NpdmVFbmdpbmU6IFByb2dyZXNzaXZlSW1wcm92ZW1lbnRFbmdpbmU7XG4gIHByaXZhdGUgZG9jdW1lbnRhdGlvbkdlbmVyYXRvcjogQXV0b0RvY3VtZW50YXRpb25HZW5lcmF0b3I7XG4gIHByaXZhdGUgYW5hbHlzaXNUb29sczogQW5hbHlzaXNUb29scztcbiAgcHJpdmF0ZSBwcm9ncmVzc01vbml0b3I6IFByb2dyZXNzTW9uaXRvcmluZ1N5c3RlbTtcbiAgcHJpdmF0ZSBjb25maWc6IEZ1bGxDYW1wYWlnbkNvbmZpZztcbiAgcHJpdmF0ZSBzdGFydFRpbWU6IERhdGU7XG4gIHByaXZhdGUgbWV0cmljczogQ2FtcGFpZ25NZXRyaWNzO1xuXG4gIGNvbnN0cnVjdG9yKGNvbmZpZzogUGFydGlhbDxGdWxsQ2FtcGFpZ25Db25maWc+ID0ge30pIHtcbiAgICB0aGlzLmNvbmZpZyA9IHtcbiAgICAgIHRhcmdldFJlZHVjdGlvblBlcmNlbnRhZ2U6IDE3LjUsIC8vIFRhcmdldCAxNS0yMCUgcmVkdWN0aW9uXG4gICAgICB0YXJnZXRGaXhDb3VudDogMzAwLCAvLyBUYXJnZXQgMjUwLTM1MCBmaXhlc1xuICAgICAgbWF4QmF0Y2hTaXplOiAyNSxcbiAgICAgIG1pbkJhdGNoU2l6ZTogMTAsXG4gICAgICBzYWZldHlUaHJlc2hvbGQ6IDAuNyxcbiAgICAgIGJ1aWxkVmFsaWRhdGlvbkZyZXF1ZW5jeTogNSxcbiAgICAgIGVuYWJsZURvY3VtZW50YXRpb246IHRydWUsXG4gICAgICBlbmFibGVQcm9ncmVzc2l2ZVN0cmF0ZWd5OiB0cnVlLFxuICAgICAgcHJvY2Vzc0FsbERvbWFpbnM6IHRydWUsXG4gICAgICBnZW5lcmF0ZUZpbmFsUmVwb3J0OiB0cnVlLFxuICAgICAgdmFsaWRhdGVQZXJmb3JtYW5jZUltcHJvdmVtZW50czogdHJ1ZSxcbiAgICAgIGVtZXJnZW5jeVN0b3BUaHJlc2hvbGQ6IDAuNSxcbiAgICAgIG1heENhbXBhaWduRHVyYXRpb246IDQgKiA2MCAqIDYwICogMTAwMCwgLy8gNCBob3VycyBtYXhcbiAgICAgIC4uLmNvbmZpZ1xuICAgIH07XG5cbiAgICB0aGlzLmNsYXNzaWZpZXIgPSBuZXcgQW55VHlwZUNsYXNzaWZpZXIoKTtcbiAgICB0aGlzLnJlcGxhY2VyID0gbmV3IFNhZmVUeXBlUmVwbGFjZXIoKTtcbiAgICB0aGlzLmRvbWFpbkFuYWx5emVyID0gbmV3IERvbWFpbkNvbnRleHRBbmFseXplcigpO1xuICAgIHRoaXMucHJvZ3Jlc3NpdmVFbmdpbmUgPSBuZXcgUHJvZ3Jlc3NpdmVJbXByb3ZlbWVudEVuZ2luZSgpO1xuICAgIHRoaXMuZG9jdW1lbnRhdGlvbkdlbmVyYXRvciA9IG5ldyBBdXRvRG9jdW1lbnRhdGlvbkdlbmVyYXRvcigpO1xuICAgIHRoaXMuYW5hbHlzaXNUb29scyA9IG5ldyBBbmFseXNpc1Rvb2xzKCk7XG4gICAgdGhpcy5wcm9ncmVzc01vbml0b3IgPSBuZXcgUHJvZ3Jlc3NNb25pdG9yaW5nU3lzdGVtKCk7XG4gICAgdGhpcy5zdGFydFRpbWUgPSBuZXcgRGF0ZSgpO1xuICAgIHRoaXMubWV0cmljcyA9IHRoaXMuaW5pdGlhbGl6ZU1ldHJpY3MoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBFeGVjdXRlIHRoZSBjb21wbGV0ZSB1bmludGVudGlvbmFsIGFueSBlbGltaW5hdGlvbiBjYW1wYWlnblxuICAgKi9cbiAgYXN5bmMgZXhlY3V0ZUZ1bGxDYW1wYWlnbigpOiBQcm9taXNlPEZ1bGxDYW1wYWlnblJlc3VsdD4ge1xuICAgIGNvbnNvbGUubG9nKCfwn5qAIFN0YXJ0aW5nIEZ1bGwgVW5pbnRlbnRpb25hbCBBbnkgRWxpbWluYXRpb24gQ2FtcGFpZ24nKTtcbiAgICBjb25zb2xlLmxvZyhg8J+TiiBUYXJnZXQ6ICR7dGhpcy5jb25maWcudGFyZ2V0UmVkdWN0aW9uUGVyY2VudGFnZX0lIHJlZHVjdGlvbiAoJHt0aGlzLmNvbmZpZy50YXJnZXRGaXhDb3VudH0gZml4ZXMpYCk7XG5cbiAgICB0cnkge1xuICAgICAgLy8gUGhhc2UgMTogSW5pdGlhbCBBbmFseXNpcyBhbmQgQmFzZWxpbmVcbiAgICAgIGNvbnN0IGJhc2VsaW5lUmVzdWx0ID0gYXdhaXQgdGhpcy5leGVjdXRlUGhhc2UxX0luaXRpYWxBbmFseXNpcygpO1xuXG4gICAgICAvLyBQaGFzZSAyOiBIaWdoLUNvbmZpZGVuY2UgUmVwbGFjZW1lbnRzXG4gICAgICBjb25zdCBoaWdoQ29uZmlkZW5jZVJlc3VsdCA9IGF3YWl0IHRoaXMuZXhlY3V0ZVBoYXNlMl9IaWdoQ29uZmlkZW5jZVJlcGxhY2VtZW50cygpO1xuXG4gICAgICAvLyBQaGFzZSAzOiBNZWRpdW0tUmlzayBDYXRlZ29yeSBQcm9jZXNzaW5nXG4gICAgICBjb25zdCBtZWRpdW1SaXNrUmVzdWx0ID0gYXdhaXQgdGhpcy5leGVjdXRlUGhhc2UzX01lZGl1bVJpc2tQcm9jZXNzaW5nKCk7XG5cbiAgICAgIC8vIFBoYXNlIDQ6IERvbWFpbi1TcGVjaWZpYyBQcm9jZXNzaW5nXG4gICAgICBjb25zdCBkb21haW5TcGVjaWZpY1Jlc3VsdCA9IGF3YWl0IHRoaXMuZXhlY3V0ZVBoYXNlNF9Eb21haW5TcGVjaWZpY1Byb2Nlc3NpbmcoKTtcblxuICAgICAgLy8gUGhhc2UgNTogRG9jdW1lbnRhdGlvbiBhbmQgVmFsaWRhdGlvblxuICAgICAgY29uc3QgZG9jdW1lbnRhdGlvblJlc3VsdCA9IGF3YWl0IHRoaXMuZXhlY3V0ZVBoYXNlNV9Eb2N1bWVudGF0aW9uQW5kVmFsaWRhdGlvbigpO1xuXG4gICAgICAvLyBQaGFzZSA2OiBGaW5hbCBWYWxpZGF0aW9uIGFuZCBSZXBvcnRpbmdcbiAgICAgIGNvbnN0IGZpbmFsUmVzdWx0ID0gYXdhaXQgdGhpcy5leGVjdXRlUGhhc2U2X0ZpbmFsVmFsaWRhdGlvbkFuZFJlcG9ydGluZygpO1xuXG4gICAgICBjb25zdCBjYW1wYWlnblJlc3VsdDogRnVsbENhbXBhaWduUmVzdWx0ID0ge1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICB0b3RhbEZpeGVzQXBwbGllZDogdGhpcy5tZXRyaWNzLnRvdGFsRml4ZXNBcHBsaWVkLFxuICAgICAgICByZWR1Y3Rpb25QZXJjZW50YWdlOiB0aGlzLmNhbGN1bGF0ZVJlZHVjdGlvblBlcmNlbnRhZ2UoKSxcbiAgICAgICAgdGFyZ2V0QWNoaWV2ZWQ6IHRoaXMuaXNUYXJnZXRBY2hpZXZlZCgpLFxuICAgICAgICBwaGFzZXM6IFtcbiAgICAgICAgICBiYXNlbGluZVJlc3VsdCxcbiAgICAgICAgICBoaWdoQ29uZmlkZW5jZVJlc3VsdCxcbiAgICAgICAgICBtZWRpdW1SaXNrUmVzdWx0LFxuICAgICAgICAgIGRvbWFpblNwZWNpZmljUmVzdWx0LFxuICAgICAgICAgIGRvY3VtZW50YXRpb25SZXN1bHQsXG4gICAgICAgICAgZmluYWxSZXN1bHRcbiAgICAgICAgXSxcbiAgICAgICAgbWV0cmljczogdGhpcy5tZXRyaWNzLFxuICAgICAgICBmaW5hbFJlcG9ydDogYXdhaXQgdGhpcy5nZW5lcmF0ZUZpbmFsUmVwb3J0KCksXG4gICAgICAgIGR1cmF0aW9uOiBEYXRlLm5vdygpIC0gdGhpcy5zdGFydFRpbWUuZ2V0VGltZSgpLFxuICAgICAgICBidWlsZFN0YWJsZTogYXdhaXQgdGhpcy52YWxpZGF0ZUJ1aWxkU3RhYmlsaXR5KCksXG4gICAgICAgIHBlcmZvcm1hbmNlSW1wcm92ZWQ6IGF3YWl0IHRoaXMudmFsaWRhdGVQZXJmb3JtYW5jZUltcHJvdmVtZW50cygpXG4gICAgICB9O1xuXG4gICAgICBjb25zb2xlLmxvZygn4pyFIEZ1bGwgQ2FtcGFpZ24gQ29tcGxldGVkIFN1Y2Nlc3NmdWxseScpO1xuICAgICAgY29uc29sZS5sb2coYPCfk4ggQWNoaWV2ZWQ6ICR7Y2FtcGFpZ25SZXN1bHQucmVkdWN0aW9uUGVyY2VudGFnZS50b0ZpeGVkKDEpfSUgcmVkdWN0aW9uYCk7XG4gICAgICBjb25zb2xlLmxvZyhg8J+OryBUYXJnZXQgTWV0OiAke2NhbXBhaWduUmVzdWx0LnRhcmdldEFjaGlldmVkID8gJ1lFUycgOiAnTk8nfWApO1xuXG4gICAgICByZXR1cm4gY2FtcGFpZ25SZXN1bHQ7XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIENhbXBhaWduIGV4ZWN1dGlvbiBmYWlsZWQ6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJyxcbiAgICAgICAgdG90YWxGaXhlc0FwcGxpZWQ6IHRoaXMubWV0cmljcy50b3RhbEZpeGVzQXBwbGllZCxcbiAgICAgICAgcmVkdWN0aW9uUGVyY2VudGFnZTogdGhpcy5jYWxjdWxhdGVSZWR1Y3Rpb25QZXJjZW50YWdlKCksXG4gICAgICAgIHRhcmdldEFjaGlldmVkOiBmYWxzZSxcbiAgICAgICAgcGhhc2VzOiBbXSxcbiAgICAgICAgbWV0cmljczogdGhpcy5tZXRyaWNzLFxuICAgICAgICBkdXJhdGlvbjogRGF0ZS5ub3coKSAtIHRoaXMuc3RhcnRUaW1lLmdldFRpbWUoKSxcbiAgICAgICAgYnVpbGRTdGFibGU6IGF3YWl0IHRoaXMudmFsaWRhdGVCdWlsZFN0YWJpbGl0eSgpLFxuICAgICAgICBwZXJmb3JtYW5jZUltcHJvdmVkOiBmYWxzZVxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUGhhc2UgMTogSW5pdGlhbCBBbmFseXNpcyBhbmQgQmFzZWxpbmUgRXN0YWJsaXNobWVudFxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBleGVjdXRlUGhhc2UxX0luaXRpYWxBbmFseXNpcygpOiBQcm9taXNlPENhbXBhaWduUGhhc2U+IHtcbiAgICBjb25zb2xlLmxvZygnXFxu8J+TiyBQaGFzZSAxOiBJbml0aWFsIEFuYWx5c2lzIGFuZCBCYXNlbGluZScpO1xuXG4gICAgY29uc3QgcGhhc2VTdGFydCA9IERhdGUubm93KCk7XG5cbiAgICB0cnkge1xuICAgICAgLy8gR2V0IGluaXRpYWwgYmFzZWxpbmUgbWV0cmljc1xuICAgICAgY29uc3QgaW5pdGlhbEVycm9yQ291bnQgPSBhd2FpdCB0aGlzLmdldEN1cnJlbnRFcnJvckNvdW50KCk7XG4gICAgICBjb25zdCBpbml0aWFsQW55Q291bnQgPSBhd2FpdCB0aGlzLmdldEN1cnJlbnRBbnlDb3VudCgpO1xuXG4gICAgICBjb25zb2xlLmxvZyhg8J+TiiBCYXNlbGluZSAtIFR5cGVTY3JpcHQgRXJyb3JzOiAke2luaXRpYWxFcnJvckNvdW50fWApO1xuICAgICAgY29uc29sZS5sb2coYPCfk4ogQmFzZWxpbmUgLSBFeHBsaWNpdCBBbnkgQ291bnQ6ICR7aW5pdGlhbEFueUNvdW50fWApO1xuXG4gICAgICAvLyBQZXJmb3JtIGNvbXByZWhlbnNpdmUgYW5hbHlzaXNcbiAgICAgIGNvbnN0IGFuYWx5c2lzUmVzdWx0ID0gYXdhaXQgdGhpcy5hbmFseXNpc1Rvb2xzLnBlcmZvcm1Db21wcmVoZW5zaXZlQW5hbHlzaXMoKTtcblxuICAgICAgLy8gVXBkYXRlIG1ldHJpY3NcbiAgICAgIHRoaXMubWV0cmljcy5pbml0aWFsRXJyb3JDb3VudCA9IGluaXRpYWxFcnJvckNvdW50O1xuICAgICAgdGhpcy5tZXRyaWNzLmluaXRpYWxBbnlDb3VudCA9IGluaXRpYWxBbnlDb3VudDtcbiAgICAgIHRoaXMubWV0cmljcy5iYXNlbGluZUVzdGFibGlzaGVkID0gdHJ1ZTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbmFtZTogJ0luaXRpYWwgQW5hbHlzaXMgYW5kIEJhc2VsaW5lJyxcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgZHVyYXRpb246IERhdGUubm93KCkgLSBwaGFzZVN0YXJ0LFxuICAgICAgICBmaXhlc0FwcGxpZWQ6IDAsXG4gICAgICAgIGVycm9yc0JlZm9yZTogaW5pdGlhbEVycm9yQ291bnQsXG4gICAgICAgIGVycm9yc0FmdGVyOiBpbml0aWFsRXJyb3JDb3VudCxcbiAgICAgICAgZGV0YWlsczoge1xuICAgICAgICAgIGFuYWx5c2lzUmVzdWx0LFxuICAgICAgICAgIGJhc2VsaW5lTWV0cmljczoge1xuICAgICAgICAgICAgZXJyb3JDb3VudDogaW5pdGlhbEVycm9yQ291bnQsXG4gICAgICAgICAgICBhbnlDb3VudDogaW5pdGlhbEFueUNvdW50XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBQaGFzZSAxIGZhaWxlZDonLCBlcnJvcik7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUGhhc2UgMjogSGlnaC1Db25maWRlbmNlIFJlcGxhY2VtZW50cyAoQXJyYXkgdHlwZXMsIHNpbXBsZSBSZWNvcmRzKVxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBleGVjdXRlUGhhc2UyX0hpZ2hDb25maWRlbmNlUmVwbGFjZW1lbnRzKCk6IFByb21pc2U8Q2FtcGFpZ25QaGFzZT4ge1xuICAgIGNvbnNvbGUubG9nKCdcXG7wn46vIFBoYXNlIDI6IEhpZ2gtQ29uZmlkZW5jZSBSZXBsYWNlbWVudHMnKTtcblxuICAgIGNvbnN0IHBoYXNlU3RhcnQgPSBEYXRlLm5vdygpO1xuICAgIGNvbnN0IGVycm9yc0JlZm9yZSA9IGF3YWl0IHRoaXMuZ2V0Q3VycmVudEVycm9yQ291bnQoKTtcblxuICAgIHRyeSB7XG4gICAgICBsZXQgdG90YWxGaXhlcyA9IDA7XG4gICAgICBsZXQgYmF0Y2hDb3VudCA9IDA7XG4gICAgICBjb25zdCBtYXhCYXRjaGVzID0gMjA7IC8vIExpbWl0IGZvciBoaWdoLWNvbmZpZGVuY2UgcGhhc2VcblxuICAgICAgd2hpbGUgKGJhdGNoQ291bnQgPCBtYXhCYXRjaGVzICYmIHRvdGFsRml4ZXMgPCB0aGlzLmNvbmZpZy50YXJnZXRGaXhDb3VudCAqIDAuNikge1xuICAgICAgICBjb25zb2xlLmxvZyhgXFxu8J+UhCBIaWdoLUNvbmZpZGVuY2UgQmF0Y2ggJHtiYXRjaENvdW50ICsgMX1gKTtcblxuICAgICAgICAvLyBGaW5kIGhpZ2gtY29uZmlkZW5jZSBjYXNlc1xuICAgICAgICBjb25zdCBoaWdoQ29uZmlkZW5jZUNhc2VzID0gYXdhaXQgdGhpcy5maW5kSGlnaENvbmZpZGVuY2VDYXNlcygpO1xuXG4gICAgICAgIGlmIChoaWdoQ29uZmlkZW5jZUNhc2VzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgIGNvbnNvbGUubG9nKCfinIUgTm8gbW9yZSBoaWdoLWNvbmZpZGVuY2UgY2FzZXMgZm91bmQnKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFByb2Nlc3MgYmF0Y2ggd2l0aCBlbmhhbmNlZCBzYWZldHlcbiAgICAgICAgY29uc3QgYmF0Y2hSZXN1bHQgPSBhd2FpdCB0aGlzLnByb2Nlc3NCYXRjaFdpdGhTYWZldHkoXG4gICAgICAgICAgaGlnaENvbmZpZGVuY2VDYXNlcy5zbGljZSgwLCB0aGlzLmNvbmZpZy5tYXhCYXRjaFNpemUpLFxuICAgICAgICAgICdoaWdoLWNvbmZpZGVuY2UnXG4gICAgICAgICk7XG5cbiAgICAgICAgdG90YWxGaXhlcyArPSBiYXRjaFJlc3VsdC5zdWNjZXNzZnVsUmVwbGFjZW1lbnRzO1xuICAgICAgICB0aGlzLm1ldHJpY3MudG90YWxGaXhlc0FwcGxpZWQgKz0gYmF0Y2hSZXN1bHQuc3VjY2Vzc2Z1bFJlcGxhY2VtZW50cztcblxuICAgICAgICAvLyBWYWxpZGF0ZSBidWlsZCBhZnRlciBlYWNoIGJhdGNoXG4gICAgICAgIGlmICghYXdhaXQgdGhpcy52YWxpZGF0ZUJ1aWxkU3RhYmlsaXR5KCkpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCfinYwgQnVpbGQgaW5zdGFiaWxpdHkgZGV0ZWN0ZWQsIHN0b3BwaW5nIHBoYXNlJyk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cblxuICAgICAgICBiYXRjaENvdW50Kys7XG5cbiAgICAgICAgLy8gUHJvZ3Jlc3MgdXBkYXRlXG4gICAgICAgIGNvbnNvbGUubG9nKGDwn5OIIFBoYXNlIDIgUHJvZ3Jlc3M6ICR7dG90YWxGaXhlc30gZml4ZXMgYXBwbGllZGApO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBlcnJvcnNBZnRlciA9IGF3YWl0IHRoaXMuZ2V0Q3VycmVudEVycm9yQ291bnQoKTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbmFtZTogJ0hpZ2gtQ29uZmlkZW5jZSBSZXBsYWNlbWVudHMnLFxuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkdXJhdGlvbjogRGF0ZS5ub3coKSAtIHBoYXNlU3RhcnQsXG4gICAgICAgIGZpeGVzQXBwbGllZDogdG90YWxGaXhlcyxcbiAgICAgICAgZXJyb3JzQmVmb3JlLFxuICAgICAgICBlcnJvcnNBZnRlcixcbiAgICAgICAgZGV0YWlsczoge1xuICAgICAgICAgIGJhdGNoZXNQcm9jZXNzZWQ6IGJhdGNoQ291bnQsXG4gICAgICAgICAgY2F0ZWdvcmllczogWydBUlJBWV9UWVBFJywgJ1JFQ09SRF9UWVBFJ11cbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgUGhhc2UgMiBmYWlsZWQ6JywgZXJyb3IpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFBoYXNlIDM6IE1lZGl1bS1SaXNrIENhdGVnb3J5IFByb2Nlc3NpbmdcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgZXhlY3V0ZVBoYXNlM19NZWRpdW1SaXNrUHJvY2Vzc2luZygpOiBQcm9taXNlPENhbXBhaWduUGhhc2U+IHtcbiAgICBjb25zb2xlLmxvZygnXFxu4pqW77iPIFBoYXNlIDM6IE1lZGl1bS1SaXNrIENhdGVnb3J5IFByb2Nlc3NpbmcnKTtcblxuICAgIGNvbnN0IHBoYXNlU3RhcnQgPSBEYXRlLm5vdygpO1xuICAgIGNvbnN0IGVycm9yc0JlZm9yZSA9IGF3YWl0IHRoaXMuZ2V0Q3VycmVudEVycm9yQ291bnQoKTtcblxuICAgIHRyeSB7XG4gICAgICBsZXQgdG90YWxGaXhlcyA9IDA7XG4gICAgICBjb25zdCBtZWRpdW1SaXNrQ2F0ZWdvcmllcyA9IFtcbiAgICAgICAgQW55VHlwZUNhdGVnb3J5LkZVTkNUSU9OX1BBUkFNLFxuICAgICAgICBBbnlUeXBlQ2F0ZWdvcnkuUkVUVVJOX1RZUEUsXG4gICAgICAgIEFueVR5cGVDYXRlZ29yeS5UWVBFX0FTU0VSVElPTlxuICAgICAgXTtcblxuICAgICAgZm9yIChjb25zdCBjYXRlZ29yeSBvZiBtZWRpdW1SaXNrQ2F0ZWdvcmllcykge1xuICAgICAgICBjb25zb2xlLmxvZyhgXFxu8J+UjSBQcm9jZXNzaW5nICR7Y2F0ZWdvcnl9IGNhdGVnb3J5YCk7XG5cbiAgICAgICAgY29uc3QgY2F0ZWdvcnlGaXhlcyA9IGF3YWl0IHRoaXMucHJvY2Vzc0NhdGVnb3J5V2l0aEVuaGFuY2VkU2FmZXR5KGNhdGVnb3J5KTtcbiAgICAgICAgdG90YWxGaXhlcyArPSBjYXRlZ29yeUZpeGVzO1xuICAgICAgICB0aGlzLm1ldHJpY3MudG90YWxGaXhlc0FwcGxpZWQgKz0gY2F0ZWdvcnlGaXhlcztcblxuICAgICAgICAvLyBWYWxpZGF0ZSBhZnRlciBlYWNoIGNhdGVnb3J5XG4gICAgICAgIGlmICghYXdhaXQgdGhpcy52YWxpZGF0ZUJ1aWxkU3RhYmlsaXR5KCkpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKGDinYwgQnVpbGQgaW5zdGFiaWxpdHkgYWZ0ZXIgJHtjYXRlZ29yeX0sIHN0b3BwaW5nYCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zb2xlLmxvZyhg4pyFICR7Y2F0ZWdvcnl9OiAke2NhdGVnb3J5Rml4ZXN9IGZpeGVzIGFwcGxpZWRgKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgZXJyb3JzQWZ0ZXIgPSBhd2FpdCB0aGlzLmdldEN1cnJlbnRFcnJvckNvdW50KCk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIG5hbWU6ICdNZWRpdW0tUmlzayBDYXRlZ29yeSBQcm9jZXNzaW5nJyxcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgZHVyYXRpb246IERhdGUubm93KCkgLSBwaGFzZVN0YXJ0LFxuICAgICAgICBmaXhlc0FwcGxpZWQ6IHRvdGFsRml4ZXMsXG4gICAgICAgIGVycm9yc0JlZm9yZSxcbiAgICAgICAgZXJyb3JzQWZ0ZXIsXG4gICAgICAgIGRldGFpbHM6IHtcbiAgICAgICAgICBjYXRlZ29yaWVzUHJvY2Vzc2VkOiBtZWRpdW1SaXNrQ2F0ZWdvcmllcyxcbiAgICAgICAgICBlbmhhbmNlZFNhZmV0eVByb3RvY29sczogdHJ1ZVxuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBQaGFzZSAzIGZhaWxlZDonLCBlcnJvcik7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUGhhc2UgNDogRG9tYWluLVNwZWNpZmljIFByb2Nlc3NpbmdcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgZXhlY3V0ZVBoYXNlNF9Eb21haW5TcGVjaWZpY1Byb2Nlc3NpbmcoKTogUHJvbWlzZTxDYW1wYWlnblBoYXNlPiB7XG4gICAgY29uc29sZS5sb2coJ1xcbvCfj5fvuI8gUGhhc2UgNDogRG9tYWluLVNwZWNpZmljIFByb2Nlc3NpbmcnKTtcblxuICAgIGNvbnN0IHBoYXNlU3RhcnQgPSBEYXRlLm5vdygpO1xuICAgIGNvbnN0IGVycm9yc0JlZm9yZSA9IGF3YWl0IHRoaXMuZ2V0Q3VycmVudEVycm9yQ291bnQoKTtcblxuICAgIHRyeSB7XG4gICAgICBjb25zdCBkb21haW5zID0gWydhc3Ryb2xvZ2ljYWwnLCAncmVjaXBlJywgJ2NhbXBhaWduJywgJ3NlcnZpY2UnLCAnY29tcG9uZW50J107XG4gICAgICBjb25zdCBkb21haW5SZXN1bHRzOiBEb21haW5Qcm9jZXNzaW5nUmVzdWx0W10gPSBbXTtcbiAgICAgIGxldCB0b3RhbEZpeGVzID0gMDtcblxuICAgICAgZm9yIChjb25zdCBkb21haW4gb2YgZG9tYWlucykge1xuICAgICAgICBjb25zb2xlLmxvZyhgXFxu8J+OryBQcm9jZXNzaW5nICR7ZG9tYWlufSBkb21haW5gKTtcblxuICAgICAgICBjb25zdCBkb21haW5GaXhlcyA9IGF3YWl0IHRoaXMucHJvY2Vzc0RvbWFpblNwZWNpZmljKGRvbWFpbik7XG4gICAgICAgIHRvdGFsRml4ZXMgKz0gZG9tYWluRml4ZXMuZml4ZXNBcHBsaWVkO1xuICAgICAgICB0aGlzLm1ldHJpY3MudG90YWxGaXhlc0FwcGxpZWQgKz0gZG9tYWluRml4ZXMuZml4ZXNBcHBsaWVkO1xuXG4gICAgICAgIGRvbWFpblJlc3VsdHMucHVzaChkb21haW5GaXhlcyk7XG5cbiAgICAgICAgLy8gVmFsaWRhdGUgYWZ0ZXIgZWFjaCBkb21haW5cbiAgICAgICAgaWYgKCFhd2FpdCB0aGlzLnZhbGlkYXRlQnVpbGRTdGFiaWxpdHkoKSkge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYOKdjCBCdWlsZCBpbnN0YWJpbGl0eSBhZnRlciAke2RvbWFpbn0gZG9tYWluYCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zb2xlLmxvZyhg4pyFICR7ZG9tYWlufSBkb21haW46ICR7ZG9tYWluRml4ZXMuZml4ZXNBcHBsaWVkfSBmaXhlcyBhcHBsaWVkYCk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGVycm9yc0FmdGVyID0gYXdhaXQgdGhpcy5nZXRDdXJyZW50RXJyb3JDb3VudCgpO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBuYW1lOiAnRG9tYWluLVNwZWNpZmljIFByb2Nlc3NpbmcnLFxuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkdXJhdGlvbjogRGF0ZS5ub3coKSAtIHBoYXNlU3RhcnQsXG4gICAgICAgIGZpeGVzQXBwbGllZDogdG90YWxGaXhlcyxcbiAgICAgICAgZXJyb3JzQmVmb3JlLFxuICAgICAgICBlcnJvcnNBZnRlcixcbiAgICAgICAgZGV0YWlsczoge1xuICAgICAgICAgIGRvbWFpblJlc3VsdHMsXG4gICAgICAgICAgZG9tYWluc1Byb2Nlc3NlZDogZG9tYWluc1xuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBQaGFzZSA0IGZhaWxlZDonLCBlcnJvcik7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUGhhc2UgNTogRG9jdW1lbnRhdGlvbiBhbmQgVmFsaWRhdGlvblxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBleGVjdXRlUGhhc2U1X0RvY3VtZW50YXRpb25BbmRWYWxpZGF0aW9uKCk6IFByb21pc2U8Q2FtcGFpZ25QaGFzZT4ge1xuICAgIGNvbnNvbGUubG9nKCdcXG7wn5OdIFBoYXNlIDU6IERvY3VtZW50YXRpb24gYW5kIFZhbGlkYXRpb24nKTtcblxuICAgIGNvbnN0IHBoYXNlU3RhcnQgPSBEYXRlLm5vdygpO1xuICAgIGNvbnN0IGVycm9yc0JlZm9yZSA9IGF3YWl0IHRoaXMuZ2V0Q3VycmVudEVycm9yQ291bnQoKTtcblxuICAgIHRyeSB7XG4gICAgICAvLyBEb2N1bWVudCBhbGwgaW50ZW50aW9uYWwgYW55IHR5cGVzXG4gICAgICBjb25zdCBkb2N1bWVudGF0aW9uUmVzdWx0ID0gYXdhaXQgdGhpcy5kb2N1bWVudGF0aW9uR2VuZXJhdG9yLmRvY3VtZW50QWxsSW50ZW50aW9uYWxBbnlUeXBlcygpO1xuXG4gICAgICAvLyBBZGQgRVNMaW50IGRpc2FibGUgY29tbWVudHMgd2l0aCBleHBsYW5hdGlvbnNcbiAgICAgIGNvbnN0IGVzbGludFJlc3VsdCA9IGF3YWl0IHRoaXMuYWRkRVNMaW50RGlzYWJsZUNvbW1lbnRzKCk7XG5cbiAgICAgIC8vIFZhbGlkYXRlIGRvY3VtZW50YXRpb24gY29tcGxldGVuZXNzXG4gICAgICBjb25zdCB2YWxpZGF0aW9uUmVzdWx0ID0gYXdhaXQgdGhpcy52YWxpZGF0ZURvY3VtZW50YXRpb25Db21wbGV0ZW5lc3MoKTtcblxuICAgICAgY29uc29sZS5sb2coYPCfk50gRG9jdW1lbnRlZCAke2RvY3VtZW50YXRpb25SZXN1bHQuZG9jdW1lbnRlZH0gaW50ZW50aW9uYWwgYW55IHR5cGVzYCk7XG4gICAgICBjb25zb2xlLmxvZyhg8J+UpyBBZGRlZCAke2VzbGludFJlc3VsdC5hZGRlZH0gRVNMaW50IGRpc2FibGUgY29tbWVudHNgKTtcbiAgICAgIGNvbnNvbGUubG9nKGDinIUgRG9jdW1lbnRhdGlvbiB2YWxpZGF0aW9uOiAke3ZhbGlkYXRpb25SZXN1bHQuY29tcGxldGUgPyAnQ09NUExFVEUnIDogJ0lOQ09NUExFVEUnfWApO1xuXG4gICAgICBjb25zdCBlcnJvcnNBZnRlciA9IGF3YWl0IHRoaXMuZ2V0Q3VycmVudEVycm9yQ291bnQoKTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbmFtZTogJ0RvY3VtZW50YXRpb24gYW5kIFZhbGlkYXRpb24nLFxuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkdXJhdGlvbjogRGF0ZS5ub3coKSAtIHBoYXNlU3RhcnQsXG4gICAgICAgIGZpeGVzQXBwbGllZDogMCwgLy8gRG9jdW1lbnRhdGlvbiBkb2Vzbid0IGNvdW50IGFzIGZpeGVzXG4gICAgICAgIGVycm9yc0JlZm9yZSxcbiAgICAgICAgZXJyb3JzQWZ0ZXIsXG4gICAgICAgIGRldGFpbHM6IHtcbiAgICAgICAgICBkb2N1bWVudGF0aW9uUmVzdWx0LFxuICAgICAgICAgIGVzbGludFJlc3VsdCxcbiAgICAgICAgICB2YWxpZGF0aW9uUmVzdWx0XG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIFBoYXNlIDUgZmFpbGVkOicsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBQaGFzZSA2OiBGaW5hbCBWYWxpZGF0aW9uIGFuZCBSZXBvcnRpbmdcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgZXhlY3V0ZVBoYXNlNl9GaW5hbFZhbGlkYXRpb25BbmRSZXBvcnRpbmcoKTogUHJvbWlzZTxDYW1wYWlnblBoYXNlPiB7XG4gICAgY29uc29sZS5sb2coJ1xcbvCfk4ogUGhhc2UgNjogRmluYWwgVmFsaWRhdGlvbiBhbmQgUmVwb3J0aW5nJyk7XG5cbiAgICBjb25zdCBwaGFzZVN0YXJ0ID0gRGF0ZS5ub3coKTtcbiAgICBjb25zdCBlcnJvcnNCZWZvcmUgPSBhd2FpdCB0aGlzLmdldEN1cnJlbnRFcnJvckNvdW50KCk7XG5cbiAgICB0cnkge1xuICAgICAgLy8gRmluYWwgVHlwZVNjcmlwdCBlcnJvciB2YWxpZGF0aW9uXG4gICAgICBjb25zdCBmaW5hbEVycm9yQ291bnQgPSBhd2FpdCB0aGlzLmdldEN1cnJlbnRFcnJvckNvdW50KCk7XG4gICAgICBjb25zdCBmaW5hbEFueUNvdW50ID0gYXdhaXQgdGhpcy5nZXRDdXJyZW50QW55Q291bnQoKTtcblxuICAgICAgLy8gQnVpbGQgcGVyZm9ybWFuY2UgdmFsaWRhdGlvblxuICAgICAgY29uc3QgcGVyZm9ybWFuY2VSZXN1bHQgPSBhd2FpdCB0aGlzLnZhbGlkYXRlUGVyZm9ybWFuY2VJbXByb3ZlbWVudHMoKTtcblxuICAgICAgLy8gR2VuZXJhdGUgY29tcHJlaGVuc2l2ZSBmaW5hbCByZXBvcnRcbiAgICAgIGNvbnN0IGZpbmFsUmVwb3J0ID0gYXdhaXQgdGhpcy5nZW5lcmF0ZUZpbmFsUmVwb3J0KCk7XG5cbiAgICAgIC8vIFVwZGF0ZSBmaW5hbCBtZXRyaWNzXG4gICAgICB0aGlzLm1ldHJpY3MuZmluYWxFcnJvckNvdW50ID0gZmluYWxFcnJvckNvdW50O1xuICAgICAgdGhpcy5tZXRyaWNzLmZpbmFsQW55Q291bnQgPSBmaW5hbEFueUNvdW50O1xuICAgICAgdGhpcy5tZXRyaWNzLmNhbXBhaWduQ29tcGxldGVkID0gdHJ1ZTtcblxuICAgICAgY29uc29sZS5sb2coYPCfk4ogRmluYWwgTWV0cmljczpgKTtcbiAgICAgIGNvbnNvbGUubG9nKGAgICBUeXBlU2NyaXB0IEVycm9yczogJHt0aGlzLm1ldHJpY3MuaW5pdGlhbEVycm9yQ291bnR9IOKGkiAke2ZpbmFsRXJyb3JDb3VudH1gKTtcbiAgICAgIGNvbnNvbGUubG9nKGAgICBFeHBsaWNpdCBBbnkgQ291bnQ6ICR7dGhpcy5tZXRyaWNzLmluaXRpYWxBbnlDb3VudH0g4oaSICR7ZmluYWxBbnlDb3VudH1gKTtcbiAgICAgIGNvbnNvbGUubG9nKGAgICBUb3RhbCBGaXhlcyBBcHBsaWVkOiAke3RoaXMubWV0cmljcy50b3RhbEZpeGVzQXBwbGllZH1gKTtcbiAgICAgIGNvbnNvbGUubG9nKGAgICBSZWR1Y3Rpb24gUGVyY2VudGFnZTogJHt0aGlzLmNhbGN1bGF0ZVJlZHVjdGlvblBlcmNlbnRhZ2UoKS50b0ZpeGVkKDEpfSVgKTtcbiAgICAgIGNvbnNvbGUubG9nKGAgICBUYXJnZXQgQWNoaWV2ZWQ6ICR7dGhpcy5pc1RhcmdldEFjaGlldmVkKCkgPyAnWUVTJyA6ICdOTyd9YCk7XG4gICAgICBjb25zb2xlLmxvZyhgICAgQnVpbGQgUGVyZm9ybWFuY2U6ICR7cGVyZm9ybWFuY2VSZXN1bHQgPyAnSU1QUk9WRUQnIDogJ1NUQUJMRSd9YCk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIG5hbWU6ICdGaW5hbCBWYWxpZGF0aW9uIGFuZCBSZXBvcnRpbmcnLFxuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkdXJhdGlvbjogRGF0ZS5ub3coKSAtIHBoYXNlU3RhcnQsXG4gICAgICAgIGZpeGVzQXBwbGllZDogMCxcbiAgICAgICAgZXJyb3JzQmVmb3JlLFxuICAgICAgICBlcnJvcnNBZnRlcjogZmluYWxFcnJvckNvdW50LFxuICAgICAgICBkZXRhaWxzOiB7XG4gICAgICAgICAgZmluYWxSZXBvcnQsXG4gICAgICAgICAgcGVyZm9ybWFuY2VSZXN1bHQsXG4gICAgICAgICAgdGFyZ2V0QWNoaWV2ZWQ6IHRoaXMuaXNUYXJnZXRBY2hpZXZlZCgpXG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIFBoYXNlIDYgZmFpbGVkOicsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBGaW5kIGhpZ2gtY29uZmlkZW5jZSBjYXNlcyBmb3IgcmVwbGFjZW1lbnRcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgZmluZEhpZ2hDb25maWRlbmNlQ2FzZXMoKTogUHJvbWlzZTxBbnlUeXBlQ2xhc3NpZmljYXRpb25bXT4ge1xuICAgIGNvbnN0IGZpbGVzID0gYXdhaXQgdGhpcy5nZXRUeXBlU2NyaXB0RmlsZXMoKTtcbiAgICBjb25zdCBoaWdoQ29uZmlkZW5jZUNhc2VzOiBBbnlUeXBlQ2xhc3NpZmljYXRpb25bXSA9IFtdO1xuXG4gICAgZm9yIChjb25zdCBmaWxlIG9mIGZpbGVzLnNsaWNlKDAsIDUwKSkgeyAvLyBQcm9jZXNzIGluIGNodW5rc1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgY29udGVudCA9IGZzLnJlYWRGaWxlU3luYyhmaWxlLCAndXRmOCcpO1xuICAgICAgICBjb25zdCBjYXNlcyA9IGF3YWl0IHRoaXMuY2xhc3NpZmllci5jbGFzc2lmeUZpbGVDb250ZW50KGZpbGUsIGNvbnRlbnQpO1xuXG4gICAgICAgIC8vIEZpbHRlciBmb3IgaGlnaC1jb25maWRlbmNlIHVuaW50ZW50aW9uYWwgY2FzZXNcbiAgICAgICAgY29uc3QgaGlnaENvbmZpZGVuY2UgPSBjYXNlcy5maWx0ZXIoYyA9PlxuICAgICAgICAgICFjLmlzSW50ZW50aW9uYWwgJiZcbiAgICAgICAgICBjLmNvbmZpZGVuY2UgPj0gMC44NSAmJlxuICAgICAgICAgIChjLmNhdGVnb3J5ID09PSBBbnlUeXBlQ2F0ZWdvcnkuQVJSQVlfVFlQRSB8fCBjLmNhdGVnb3J5ID09PSBBbnlUeXBlQ2F0ZWdvcnkuUkVDT1JEX1RZUEUpXG4gICAgICAgICk7XG5cbiAgICAgICAgaGlnaENvbmZpZGVuY2VDYXNlcy5wdXNoKC4uLmhpZ2hDb25maWRlbmNlKTtcblxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS53YXJuKGBXYXJuaW5nOiBDb3VsZCBub3QgcHJvY2VzcyAke2ZpbGV9OmAsIGVycm9yKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gaGlnaENvbmZpZGVuY2VDYXNlcy5zbGljZSgwLCB0aGlzLmNvbmZpZy5tYXhCYXRjaFNpemUpO1xuICB9XG5cbiAgLyoqXG4gICAqIFByb2Nlc3MgYSBiYXRjaCB3aXRoIGVuaGFuY2VkIHNhZmV0eSBwcm90b2NvbHNcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgcHJvY2Vzc0JhdGNoV2l0aFNhZmV0eShcbiAgICBjYXNlczogQW55VHlwZUNsYXNzaWZpY2F0aW9uW10sXG4gICAgYmF0Y2hUeXBlOiBzdHJpbmdcbiAgKTogUHJvbWlzZTxSZXBsYWNlbWVudFJlc3VsdD4ge1xuICAgIGNvbnNvbGUubG9nKGDwn5SnIFByb2Nlc3NpbmcgJHtjYXNlcy5sZW5ndGh9ICR7YmF0Y2hUeXBlfSBjYXNlc2ApO1xuXG4gICAgLy8gQ3JlYXRlIGJhY2t1cCBiZWZvcmUgcHJvY2Vzc2luZ1xuICAgIGNvbnN0IGJhY2t1cFBhdGggPSBhd2FpdCB0aGlzLmNyZWF0ZUJhY2t1cCgpO1xuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMucmVwbGFjZXIucHJvY2Vzc0JhdGNoKGNhc2VzKTtcblxuICAgICAgLy8gVmFsaWRhdGUgYnVpbGQgYWZ0ZXIgcmVwbGFjZW1lbnRcbiAgICAgIGlmICghYXdhaXQgdGhpcy52YWxpZGF0ZUJ1aWxkU3RhYmlsaXR5KCkpIHtcbiAgICAgICAgY29uc29sZS53YXJuKCfimqDvuI8gQnVpbGQgaW5zdGFiaWxpdHkgZGV0ZWN0ZWQsIHJvbGxpbmcgYmFjaycpO1xuICAgICAgICBhd2FpdCB0aGlzLnJlc3RvcmVCYWNrdXAoYmFja3VwUGF0aCk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgICAgYXBwbGllZFJlcGxhY2VtZW50czogW10sXG4gICAgICAgICAgZmFpbGVkUmVwbGFjZW1lbnRzOiBjYXNlcy5tYXAoYyA9PiAoe1xuICAgICAgICAgICAgb3JpZ2luYWw6ICdhbnknLFxuICAgICAgICAgICAgcmVwbGFjZW1lbnQ6IGMuc3VnZ2VzdGVkUmVwbGFjZW1lbnQgfHwgJ3Vua25vd24nLFxuICAgICAgICAgICAgZmlsZVBhdGg6IGMuZmlsZVBhdGgsXG4gICAgICAgICAgICBsaW5lTnVtYmVyOiBjLmxpbmVOdW1iZXIsXG4gICAgICAgICAgICBjb25maWRlbmNlOiBjLmNvbmZpZGVuY2UsXG4gICAgICAgICAgICB2YWxpZGF0aW9uUmVxdWlyZWQ6IHRydWVcbiAgICAgICAgICB9KSksXG4gICAgICAgICAgY29tcGlsYXRpb25FcnJvcnM6IFsnQnVpbGQgaW5zdGFiaWxpdHkgYWZ0ZXIgcmVwbGFjZW1lbnQnXSxcbiAgICAgICAgICByb2xsYmFja1BlcmZvcm1lZDogdHJ1ZSxcbiAgICAgICAgICBiYWNrdXBQYXRoLFxuICAgICAgICAgIHN1Y2Nlc3NmdWxSZXBsYWNlbWVudHM6IDAsXG4gICAgICAgICAgdG90YWxBdHRlbXB0ZWQ6IGNhc2VzLmxlbmd0aFxuICAgICAgICB9O1xuICAgICAgfVxuXG4gICAgICBjb25zb2xlLmxvZyhg4pyFIEJhdGNoIGNvbXBsZXRlZDogJHtyZXN1bHQuc3VjY2Vzc2Z1bFJlcGxhY2VtZW50c30vJHtjYXNlcy5sZW5ndGh9IHN1Y2Nlc3NmdWxgKTtcbiAgICAgIHJldHVybiByZXN1bHQ7XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIEJhdGNoIHByb2Nlc3NpbmcgZmFpbGVkOicsIGVycm9yKTtcbiAgICAgIGF3YWl0IHRoaXMucmVzdG9yZUJhY2t1cChiYWNrdXBQYXRoKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBQcm9jZXNzIGEgc3BlY2lmaWMgY2F0ZWdvcnkgd2l0aCBlbmhhbmNlZCBzYWZldHlcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgcHJvY2Vzc0NhdGVnb3J5V2l0aEVuaGFuY2VkU2FmZXR5KGNhdGVnb3J5OiBBbnlUeXBlQ2F0ZWdvcnkpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgIGNvbnN0IGZpbGVzID0gYXdhaXQgdGhpcy5nZXRUeXBlU2NyaXB0RmlsZXMoKTtcbiAgICBsZXQgdG90YWxGaXhlcyA9IDA7XG4gICAgbGV0IGJhdGNoQ291bnQgPSAwO1xuICAgIGNvbnN0IG1heEJhdGNoZXMgPSAxNTsgLy8gTGltaXQgZm9yIG1lZGl1bS1yaXNrIGNhdGVnb3JpZXNcblxuICAgIHdoaWxlIChiYXRjaENvdW50IDwgbWF4QmF0Y2hlcykge1xuICAgICAgY29uc3QgY2F0ZWdvcnlDYXNlcyA9IGF3YWl0IHRoaXMuZmluZENhdGVnb3J5U3BlY2lmaWNDYXNlcyhjYXRlZ29yeSwgZmlsZXMpO1xuXG4gICAgICBpZiAoY2F0ZWdvcnlDYXNlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGJhdGNoUmVzdWx0ID0gYXdhaXQgdGhpcy5wcm9jZXNzQmF0Y2hXaXRoU2FmZXR5KFxuICAgICAgICBjYXRlZ29yeUNhc2VzLnNsaWNlKDAsIHRoaXMuY29uZmlnLm1pbkJhdGNoU2l6ZSksIC8vIFNtYWxsZXIgYmF0Y2hlcyBmb3IgbWVkaXVtLXJpc2tcbiAgICAgICAgYCR7Y2F0ZWdvcnl9LWJhdGNoLSR7YmF0Y2hDb3VudCArIDF9YFxuICAgICAgKTtcblxuICAgICAgdG90YWxGaXhlcyArPSBiYXRjaFJlc3VsdC5zdWNjZXNzZnVsUmVwbGFjZW1lbnRzO1xuICAgICAgYmF0Y2hDb3VudCsrO1xuXG4gICAgICAvLyBNb3JlIGZyZXF1ZW50IHZhbGlkYXRpb24gZm9yIG1lZGl1bS1yaXNrXG4gICAgICBpZiAoYmF0Y2hDb3VudCAlIDMgPT09IDApIHtcbiAgICAgICAgaWYgKCFhd2FpdCB0aGlzLnZhbGlkYXRlQnVpbGRTdGFiaWxpdHkoKSkge1xuICAgICAgICAgIGNvbnNvbGUud2Fybihg4pqg77iPIFN0b3BwaW5nICR7Y2F0ZWdvcnl9IHByb2Nlc3NpbmcgZHVlIHRvIGJ1aWxkIGluc3RhYmlsaXR5YCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gdG90YWxGaXhlcztcbiAgfVxuXG4gIC8qKlxuICAgKiBQcm9jZXNzIGRvbWFpbi1zcGVjaWZpYyBjYXNlc1xuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBwcm9jZXNzRG9tYWluU3BlY2lmaWMoZG9tYWluOiBzdHJpbmcpOiBQcm9taXNlPERvbWFpblByb2Nlc3NpbmdSZXN1bHQ+IHtcbiAgICBjb25zdCBkb21haW5GaWxlcyA9IGF3YWl0IHRoaXMuZ2V0RG9tYWluRmlsZXMoZG9tYWluKTtcbiAgICBsZXQgZml4ZXNBcHBsaWVkID0gMDtcbiAgICBjb25zdCBwcm9jZXNzZWRGaWxlczogc3RyaW5nW10gPSBbXTtcblxuICAgIGZvciAoY29uc3QgZmlsZSBvZiBkb21haW5GaWxlcy5zbGljZSgwLCAyMCkpIHsgLy8gTGltaXQgcGVyIGRvbWFpblxuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgY29udGVudCA9IGZzLnJlYWRGaWxlU3luYyhmaWxlLCAndXRmOCcpO1xuICAgICAgICBjb25zdCBkb21haW5Db250ZXh0ID0gYXdhaXQgdGhpcy5kb21haW5BbmFseXplci5hbmFseXplRG9tYWluKGZpbGUsIGNvbnRlbnQpO1xuICAgICAgICBjb25zdCBjYXNlcyA9IGF3YWl0IHRoaXMuY2xhc3NpZmllci5jbGFzc2lmeUZpbGVDb250ZW50KGZpbGUsIGNvbnRlbnQpO1xuXG4gICAgICAgIC8vIEZpbHRlciBmb3IgZG9tYWluLWFwcHJvcHJpYXRlIGNhc2VzXG4gICAgICAgIGNvbnN0IGRvbWFpbkNhc2VzID0gY2FzZXMuZmlsdGVyKGMgPT5cbiAgICAgICAgICAhYy5pc0ludGVudGlvbmFsICYmXG4gICAgICAgICAgYy5jb25maWRlbmNlID49IDAuNyAmJlxuICAgICAgICAgIHRoaXMuaXNEb21haW5BcHByb3ByaWF0ZShjLCBkb21haW5Db250ZXh0KVxuICAgICAgICApO1xuXG4gICAgICAgIGlmIChkb21haW5DYXNlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5wcm9jZXNzQmF0Y2hXaXRoU2FmZXR5KGRvbWFpbkNhc2VzLCBgJHtkb21haW59LWRvbWFpbmApO1xuICAgICAgICAgIGZpeGVzQXBwbGllZCArPSByZXN1bHQuc3VjY2Vzc2Z1bFJlcGxhY2VtZW50cztcbiAgICAgICAgICBwcm9jZXNzZWRGaWxlcy5wdXNoKGZpbGUpO1xuICAgICAgICB9XG5cbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUud2FybihgV2FybmluZzogQ291bGQgbm90IHByb2Nlc3MgZG9tYWluIGZpbGUgJHtmaWxlfTpgLCBlcnJvcik7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIGRvbWFpbixcbiAgICAgIGZpeGVzQXBwbGllZCxcbiAgICAgIGZpbGVzUHJvY2Vzc2VkOiBwcm9jZXNzZWRGaWxlcy5sZW5ndGgsXG4gICAgICBwcm9jZXNzZWRGaWxlc1xuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogQWRkIEVTTGludCBkaXNhYmxlIGNvbW1lbnRzIGZvciBpbnRlbnRpb25hbCBhbnkgdHlwZXNcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgYWRkRVNMaW50RGlzYWJsZUNvbW1lbnRzKCk6IFByb21pc2U8eyBhZGRlZDogbnVtYmVyIH0+IHtcbiAgICBjb25zdCBmaWxlcyA9IGF3YWl0IHRoaXMuZ2V0VHlwZVNjcmlwdEZpbGVzKCk7XG4gICAgbGV0IGFkZGVkID0gMDtcblxuICAgIGZvciAoY29uc3QgZmlsZSBvZiBmaWxlcykge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgY29udGVudCA9IGZzLnJlYWRGaWxlU3luYyhmaWxlLCAndXRmOCcpO1xuICAgICAgICBjb25zdCBjYXNlcyA9IGF3YWl0IHRoaXMuY2xhc3NpZmllci5jbGFzc2lmeUZpbGVDb250ZW50KGZpbGUsIGNvbnRlbnQpO1xuXG4gICAgICAgIGNvbnN0IGludGVudGlvbmFsQ2FzZXMgPSBjYXNlcy5maWx0ZXIoYyA9PiBjLmlzSW50ZW50aW9uYWwpO1xuXG4gICAgICAgIGlmIChpbnRlbnRpb25hbENhc2VzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBjb25zdCB1cGRhdGVkQ29udGVudCA9IGF3YWl0IHRoaXMuYWRkRVNMaW50Q29tbWVudHNUb0ZpbGUoZmlsZSwgY29udGVudCwgaW50ZW50aW9uYWxDYXNlcyk7XG4gICAgICAgICAgaWYgKHVwZGF0ZWRDb250ZW50ICE9PSBjb250ZW50KSB7XG4gICAgICAgICAgICBmcy53cml0ZUZpbGVTeW5jKGZpbGUsIHVwZGF0ZWRDb250ZW50KTtcbiAgICAgICAgICAgIGFkZGVkICs9IGludGVudGlvbmFsQ2FzZXMubGVuZ3RoO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLndhcm4oYFdhcm5pbmc6IENvdWxkIG5vdCBhZGQgRVNMaW50IGNvbW1lbnRzIHRvICR7ZmlsZX06YCwgZXJyb3IpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB7IGFkZGVkIH07XG4gIH1cblxuICAvKipcbiAgICogQWRkIEVTTGludCBkaXNhYmxlIGNvbW1lbnRzIHRvIGEgc3BlY2lmaWMgZmlsZVxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBhZGRFU0xpbnRDb21tZW50c1RvRmlsZShcbiAgICBmaWxlUGF0aDogc3RyaW5nLFxuICAgIGNvbnRlbnQ6IHN0cmluZyxcbiAgICBpbnRlbnRpb25hbENhc2VzOiBBbnlUeXBlQ2xhc3NpZmljYXRpb25bXVxuICApOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIGNvbnN0IGxpbmVzID0gY29udGVudC5zcGxpdCgnXFxuJyk7XG4gICAgbGV0IG1vZGlmaWVkID0gZmFsc2U7XG5cbiAgICBmb3IgKGNvbnN0IGNhc2VfIG9mIGludGVudGlvbmFsQ2FzZXMpIHtcbiAgICAgIGNvbnN0IGxpbmVJbmRleCA9IGNhc2VfLmxpbmVOdW1iZXIgLSAxO1xuICAgICAgaWYgKGxpbmVJbmRleCA+PSAwICYmIGxpbmVJbmRleCA8IGxpbmVzLmxlbmd0aCkge1xuICAgICAgICBjb25zdCBsaW5lID0gbGluZXNbbGluZUluZGV4XTtcblxuICAgICAgICAvLyBDaGVjayBpZiBFU0xpbnQgZGlzYWJsZSBjb21tZW50IGFscmVhZHkgZXhpc3RzXG4gICAgICAgIGlmICghbGluZS5pbmNsdWRlcygnZXNsaW50LWRpc2FibGUnKSAmJiAhbGluZXNbbGluZUluZGV4IC0gMV0/LmluY2x1ZGVzKCdlc2xpbnQtZGlzYWJsZScpKSB7XG4gICAgICAgICAgY29uc3QgcmVhc29uID0gdGhpcy5nZXRFU0xpbnREaXNhYmxlUmVhc29uKGNhc2VfKTtcbiAgICAgICAgICBjb25zdCBjb21tZW50ID0gYC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55IC0tICR7cmVhc29ufWA7XG5cbiAgICAgICAgICAvLyBJbnNlcnQgY29tbWVudCBvbiB0aGUgbGluZSBiZWZvcmVcbiAgICAgICAgICBsaW5lcy5zcGxpY2UobGluZUluZGV4LCAwLCBjb21tZW50KTtcbiAgICAgICAgICBtb2RpZmllZCA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gbW9kaWZpZWQgPyBsaW5lcy5qb2luKCdcXG4nKSA6IGNvbnRlbnQ7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGFwcHJvcHJpYXRlIEVTTGludCBkaXNhYmxlIHJlYXNvblxuICAgKi9cbiAgcHJpdmF0ZSBnZXRFU0xpbnREaXNhYmxlUmVhc29uKGNhc2VfOiBBbnlUeXBlQ2xhc3NpZmljYXRpb24pOiBzdHJpbmcge1xuICAgIHN3aXRjaCAoY2FzZV8uY2F0ZWdvcnkpIHtcbiAgICAgIGNhc2UgQW55VHlwZUNhdGVnb3J5LkVSUk9SX0hBTkRMSU5HOlxuICAgICAgICByZXR1cm4gJ0Vycm9yIGhhbmRsaW5nIHJlcXVpcmVzIGZsZXhpYmxlIHR5cGluZyc7XG4gICAgICBjYXNlIEFueVR5cGVDYXRlZ29yeS5FWFRFUk5BTF9BUEk6XG4gICAgICAgIHJldHVybiAnRXh0ZXJuYWwgQVBJIHJlc3BvbnNlIHdpdGggdW5rbm93biBzdHJ1Y3R1cmUnO1xuICAgICAgY2FzZSBBbnlUeXBlQ2F0ZWdvcnkuRFlOQU1JQ19DT05GSUc6XG4gICAgICAgIHJldHVybiAnRHluYW1pYyBjb25maWd1cmF0aW9uIHJlcXVpcmVzIGZsZXhpYmxlIHR5cGluZyc7XG4gICAgICBjYXNlIEFueVR5cGVDYXRlZ29yeS5URVNUX01PQ0s6XG4gICAgICAgIHJldHVybiAnVGVzdCBtb2NrIHJlcXVpcmVzIGZsZXhpYmxlIHR5cGluZyc7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICByZXR1cm4gY2FzZV8ucmVhc29uaW5nIHx8ICdJbnRlbnRpb25hbCBhbnkgdHlwZSBmb3IgZmxleGliaWxpdHknO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBWYWxpZGF0ZSBkb2N1bWVudGF0aW9uIGNvbXBsZXRlbmVzc1xuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyB2YWxpZGF0ZURvY3VtZW50YXRpb25Db21wbGV0ZW5lc3MoKTogUHJvbWlzZTx7IGNvbXBsZXRlOiBib29sZWFuOyB1bmRvY3VtZW50ZWQ6IG51bWJlciB9PiB7XG4gICAgY29uc3QgZmlsZXMgPSBhd2FpdCB0aGlzLmdldFR5cGVTY3JpcHRGaWxlcygpO1xuICAgIGxldCB1bmRvY3VtZW50ZWQgPSAwO1xuXG4gICAgZm9yIChjb25zdCBmaWxlIG9mIGZpbGVzKSB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBjb250ZW50ID0gZnMucmVhZEZpbGVTeW5jKGZpbGUsICd1dGY4Jyk7XG4gICAgICAgIGNvbnN0IGNhc2VzID0gYXdhaXQgdGhpcy5jbGFzc2lmaWVyLmNsYXNzaWZ5RmlsZUNvbnRlbnQoZmlsZSwgY29udGVudCk7XG5cbiAgICAgICAgY29uc3QgaW50ZW50aW9uYWxDYXNlcyA9IGNhc2VzLmZpbHRlcihjID0+IGMuaXNJbnRlbnRpb25hbCk7XG5cbiAgICAgICAgZm9yIChjb25zdCBjYXNlXyBvZiBpbnRlbnRpb25hbENhc2VzKSB7XG4gICAgICAgICAgaWYgKCFjYXNlXy5yZXF1aXJlc0RvY3VtZW50YXRpb24pIGNvbnRpbnVlO1xuXG4gICAgICAgICAgY29uc3QgaGFzRG9jdW1lbnRhdGlvbiA9IHRoaXMuaGFzQWRlcXVhdGVEb2N1bWVudGF0aW9uKGNvbnRlbnQsIGNhc2VfKTtcbiAgICAgICAgICBpZiAoIWhhc0RvY3VtZW50YXRpb24pIHtcbiAgICAgICAgICAgIHVuZG9jdW1lbnRlZCsrO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLndhcm4oYFdhcm5pbmc6IENvdWxkIG5vdCB2YWxpZGF0ZSBkb2N1bWVudGF0aW9uIGluICR7ZmlsZX06YCwgZXJyb3IpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICBjb21wbGV0ZTogdW5kb2N1bWVudGVkID09PSAwLFxuICAgICAgdW5kb2N1bWVudGVkXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVjayBpZiBhIGNhc2UgaGFzIGFkZXF1YXRlIGRvY3VtZW50YXRpb25cbiAgICovXG4gIHByaXZhdGUgaGFzQWRlcXVhdGVEb2N1bWVudGF0aW9uKGNvbnRlbnQ6IHN0cmluZywgY2FzZV86IEFueVR5cGVDbGFzc2lmaWNhdGlvbik6IGJvb2xlYW4ge1xuICAgIGNvbnN0IGxpbmVzID0gY29udGVudC5zcGxpdCgnXFxuJyk7XG4gICAgY29uc3QgbGluZUluZGV4ID0gY2FzZV8ubGluZU51bWJlciAtIDE7XG5cbiAgICAvLyBDaGVjayBwcmV2aW91cyBsaW5lcyBmb3IgY29tbWVudHMgb3IgRVNMaW50IGRpc2FibGVcbiAgICBmb3IgKGxldCBpID0gTWF0aC5tYXgoMCwgbGluZUluZGV4IC0gMyk7IGkgPCBsaW5lSW5kZXg7IGkrKykge1xuICAgICAgY29uc3QgbGluZSA9IGxpbmVzW2ldO1xuICAgICAgaWYgKGxpbmUuaW5jbHVkZXMoJy8vJykgfHwgbGluZS5pbmNsdWRlcygnLyonKSB8fCBsaW5lLmluY2x1ZGVzKCdlc2xpbnQtZGlzYWJsZScpKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZSBjb21wcmVoZW5zaXZlIGZpbmFsIHJlcG9ydFxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBnZW5lcmF0ZUZpbmFsUmVwb3J0KCk6IFByb21pc2U8RmluYWxSZXBvcnQ+IHtcbiAgICBjb25zdCBjdXJyZW50VGltZSA9IG5ldyBEYXRlKCk7XG4gICAgY29uc3QgZHVyYXRpb24gPSBjdXJyZW50VGltZS5nZXRUaW1lKCkgLSB0aGlzLnN0YXJ0VGltZS5nZXRUaW1lKCk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgY2FtcGFpZ25JZDogYGZ1bGwtY2FtcGFpZ24tJHt0aGlzLnN0YXJ0VGltZS5nZXRUaW1lKCl9YCxcbiAgICAgIHN0YXJ0VGltZTogdGhpcy5zdGFydFRpbWUsXG4gICAgICBlbmRUaW1lOiBjdXJyZW50VGltZSxcbiAgICAgIGR1cmF0aW9uLFxuICAgICAgdGFyZ2V0UmVkdWN0aW9uUGVyY2VudGFnZTogdGhpcy5jb25maWcudGFyZ2V0UmVkdWN0aW9uUGVyY2VudGFnZSxcbiAgICAgIGFjdHVhbFJlZHVjdGlvblBlcmNlbnRhZ2U6IHRoaXMuY2FsY3VsYXRlUmVkdWN0aW9uUGVyY2VudGFnZSgpLFxuICAgICAgdGFyZ2V0Rml4Q291bnQ6IHRoaXMuY29uZmlnLnRhcmdldEZpeENvdW50LFxuICAgICAgYWN0dWFsRml4Q291bnQ6IHRoaXMubWV0cmljcy50b3RhbEZpeGVzQXBwbGllZCxcbiAgICAgIHRhcmdldEFjaGlldmVkOiB0aGlzLmlzVGFyZ2V0QWNoaWV2ZWQoKSxcbiAgICAgIGluaXRpYWxNZXRyaWNzOiB7XG4gICAgICAgIGVycm9yQ291bnQ6IHRoaXMubWV0cmljcy5pbml0aWFsRXJyb3JDb3VudCxcbiAgICAgICAgYW55Q291bnQ6IHRoaXMubWV0cmljcy5pbml0aWFsQW55Q291bnRcbiAgICAgIH0sXG4gICAgICBmaW5hbE1ldHJpY3M6IHtcbiAgICAgICAgZXJyb3JDb3VudDogdGhpcy5tZXRyaWNzLmZpbmFsRXJyb3JDb3VudCxcbiAgICAgICAgYW55Q291bnQ6IHRoaXMubWV0cmljcy5maW5hbEFueUNvdW50XG4gICAgICB9LFxuICAgICAgYnVpbGRTdGFibGU6IGF3YWl0IHRoaXMudmFsaWRhdGVCdWlsZFN0YWJpbGl0eSgpLFxuICAgICAgcGVyZm9ybWFuY2VJbXByb3ZlZDogYXdhaXQgdGhpcy52YWxpZGF0ZVBlcmZvcm1hbmNlSW1wcm92ZW1lbnRzKCksXG4gICAgICByZWNvbW1lbmRhdGlvbnM6IHRoaXMuZ2VuZXJhdGVSZWNvbW1lbmRhdGlvbnMoKSxcbiAgICAgIGFjaGlldmVtZW50czogdGhpcy5nZW5lcmF0ZUFjaGlldmVtZW50cygpLFxuICAgICAgbmV4dFN0ZXBzOiB0aGlzLmdlbmVyYXRlTmV4dFN0ZXBzKClcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEhlbHBlciBtZXRob2RzXG4gICAqL1xuICBwcml2YXRlIGluaXRpYWxpemVNZXRyaWNzKCk6IENhbXBhaWduTWV0cmljcyB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGluaXRpYWxFcnJvckNvdW50OiAwLFxuICAgICAgaW5pdGlhbEFueUNvdW50OiAwLFxuICAgICAgZmluYWxFcnJvckNvdW50OiAwLFxuICAgICAgZmluYWxBbnlDb3VudDogMCxcbiAgICAgIHRvdGFsRml4ZXNBcHBsaWVkOiAwLFxuICAgICAgYmF0Y2hlc1Byb2Nlc3NlZDogMCxcbiAgICAgIHJvbGxiYWNrc1BlcmZvcm1lZDogMCxcbiAgICAgIGJ1aWxkVmFsaWRhdGlvbnNQZXJmb3JtZWQ6IDAsXG4gICAgICBiYXNlbGluZUVzdGFibGlzaGVkOiBmYWxzZSxcbiAgICAgIGNhbXBhaWduQ29tcGxldGVkOiBmYWxzZVxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIGNhbGN1bGF0ZVJlZHVjdGlvblBlcmNlbnRhZ2UoKTogbnVtYmVyIHtcbiAgICBpZiAodGhpcy5tZXRyaWNzLmluaXRpYWxBbnlDb3VudCA9PT0gMCkgcmV0dXJuIDA7XG4gICAgY29uc3QgcmVkdWN0aW9uID0gdGhpcy5tZXRyaWNzLmluaXRpYWxBbnlDb3VudCAtIHRoaXMubWV0cmljcy5maW5hbEFueUNvdW50O1xuICAgIHJldHVybiAocmVkdWN0aW9uIC8gdGhpcy5tZXRyaWNzLmluaXRpYWxBbnlDb3VudCkgKiAxMDA7XG4gIH1cblxuICBwcml2YXRlIGlzVGFyZ2V0QWNoaWV2ZWQoKTogYm9vbGVhbiB7XG4gICAgY29uc3QgcmVkdWN0aW9uUGVyY2VudGFnZSA9IHRoaXMuY2FsY3VsYXRlUmVkdWN0aW9uUGVyY2VudGFnZSgpO1xuICAgIHJldHVybiByZWR1Y3Rpb25QZXJjZW50YWdlID49IDE1ICYmIHRoaXMubWV0cmljcy50b3RhbEZpeGVzQXBwbGllZCA+PSAyNTA7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGdldEN1cnJlbnRFcnJvckNvdW50KCk6IFByb21pc2U8bnVtYmVyPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IG91dHB1dCA9IGV4ZWNTeW5jKCd5YXJuIHRzYyAtLW5vRW1pdCAtLXNraXBMaWJDaGVjayAyPiYxIHwgZ3JlcCAtYyBcImVycm9yIFRTXCIgfHwgZWNobyBcIjBcIicsIHtcbiAgICAgICAgZW5jb2Rpbmc6ICd1dGY4JyxcbiAgICAgICAgc3RkaW86ICdwaXBlJ1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gcGFyc2VJbnQob3V0cHV0LnRyaW0oKSkgfHwgMDtcbiAgICB9IGNhdGNoIHtcbiAgICAgIHJldHVybiAtMTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGdldEN1cnJlbnRBbnlDb3VudCgpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBvdXRwdXQgPSBleGVjU3luYygneWFybiBsaW50IC0tZm9ybWF0PWpzb24gMj4vZGV2L251bGwgfCBqcSAtciBcIi5bXS5tZXNzYWdlc1tdIHwgc2VsZWN0KC5ydWxlSWQgPT0gXFxcXFwiQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxcXFxcIikgfCAucnVsZUlkXCIgfCB3YyAtbCB8fCBlY2hvIFwiMFwiJywge1xuICAgICAgICBlbmNvZGluZzogJ3V0ZjgnLFxuICAgICAgICBzdGRpbzogJ3BpcGUnXG4gICAgICB9KTtcbiAgICAgIHJldHVybiBwYXJzZUludChvdXRwdXQudHJpbSgpKSB8fCAwO1xuICAgIH0gY2F0Y2gge1xuICAgICAgLy8gRmFsbGJhY2s6IGNvdW50IGV4cGxpY2l0IGFueSBwYXR0ZXJucyBpbiBUeXBlU2NyaXB0IGZpbGVzXG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBvdXRwdXQgPSBleGVjU3luYygnZmluZCBzcmMgLW5hbWUgXCIqLnRzXCIgLW8gLW5hbWUgXCIqLnRzeFwiIHwgeGFyZ3MgZ3JlcCAtYyBcIjogYW55XCIgfCBhd2sgLUY6IFxcJ3tzdW0gKz0gJDJ9IEVORCB7cHJpbnQgc3VtfVxcJyB8fCBlY2hvIFwiMFwiJywge1xuICAgICAgICAgIGVuY29kaW5nOiAndXRmOCcsXG4gICAgICAgICAgc3RkaW86ICdwaXBlJ1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHBhcnNlSW50KG91dHB1dC50cmltKCkpIHx8IDA7XG4gICAgICB9IGNhdGNoIHtcbiAgICAgICAgcmV0dXJuIDA7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyB2YWxpZGF0ZUJ1aWxkU3RhYmlsaXR5KCk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIHRyeSB7XG4gICAgICBleGVjU3luYygneWFybiB0c2MgLS1ub0VtaXQgLS1za2lwTGliQ2hlY2snLCB7IHN0ZGlvOiAncGlwZScgfSk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGNhdGNoIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHZhbGlkYXRlUGVyZm9ybWFuY2VJbXByb3ZlbWVudHMoKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgLy8gVGhpcyB3b3VsZCB0eXBpY2FsbHkgbWVhc3VyZSBidWlsZCB0aW1lLCBidW5kbGUgc2l6ZSwgZXRjLlxuICAgIC8vIEZvciBub3csIHJldHVybiB0cnVlIGlmIGJ1aWxkIGlzIHN0YWJsZVxuICAgIHJldHVybiBhd2FpdCB0aGlzLnZhbGlkYXRlQnVpbGRTdGFiaWxpdHkoKTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZ2V0VHlwZVNjcmlwdEZpbGVzKCk6IFByb21pc2U8c3RyaW5nW10+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3Qgb3V0cHV0ID0gZXhlY1N5bmMoJ2ZpbmQgc3JjIC1uYW1lIFwiKi50c1wiIC1vIC1uYW1lIFwiKi50c3hcIiB8IGdyZXAgLXYgX190ZXN0c19fIHwgZ3JlcCAtdiAudGVzdC4gfCBoZWFkIC0yMDAnLCB7XG4gICAgICAgIGVuY29kaW5nOiAndXRmOCdcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIG91dHB1dC50cmltKCkuc3BsaXQoJ1xcbicpLmZpbHRlcihmID0+IGYubGVuZ3RoID4gMCk7XG4gICAgfSBjYXRjaCB7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBnZXREb21haW5GaWxlcyhkb21haW46IHN0cmluZyk6IFByb21pc2U8c3RyaW5nW10+IHtcbiAgICBjb25zdCBhbGxGaWxlcyA9IGF3YWl0IHRoaXMuZ2V0VHlwZVNjcmlwdEZpbGVzKCk7XG4gICAgcmV0dXJuIGFsbEZpbGVzLmZpbHRlcihmaWxlID0+IHtcbiAgICAgIGNvbnN0IGxvd2VyRmlsZSA9IGZpbGUudG9Mb3dlckNhc2UoKTtcbiAgICAgIHN3aXRjaCAoZG9tYWluKSB7XG4gICAgICAgIGNhc2UgJ2FzdHJvbG9naWNhbCc6XG4gICAgICAgICAgcmV0dXJuIGxvd2VyRmlsZS5pbmNsdWRlcygnYXN0cm8nKSB8fCBsb3dlckZpbGUuaW5jbHVkZXMoJ3BsYW5ldCcpIHx8IGxvd2VyRmlsZS5pbmNsdWRlcygnY2FsY3VsYXRpb24nKTtcbiAgICAgICAgY2FzZSAncmVjaXBlJzpcbiAgICAgICAgICByZXR1cm4gbG93ZXJGaWxlLmluY2x1ZGVzKCdyZWNpcGUnKSB8fCBsb3dlckZpbGUuaW5jbHVkZXMoJ2luZ3JlZGllbnQnKSB8fCBsb3dlckZpbGUuaW5jbHVkZXMoJ2Zvb2QnKTtcbiAgICAgICAgY2FzZSAnY2FtcGFpZ24nOlxuICAgICAgICAgIHJldHVybiBsb3dlckZpbGUuaW5jbHVkZXMoJ2NhbXBhaWduJykgfHwgbG93ZXJGaWxlLmluY2x1ZGVzKCdtZXRyaWNzJyk7XG4gICAgICAgIGNhc2UgJ3NlcnZpY2UnOlxuICAgICAgICAgIHJldHVybiBsb3dlckZpbGUuaW5jbHVkZXMoJ3NlcnZpY2UnKSB8fCBsb3dlckZpbGUuaW5jbHVkZXMoJ2FwaScpO1xuICAgICAgICBjYXNlICdjb21wb25lbnQnOlxuICAgICAgICAgIHJldHVybiBsb3dlckZpbGUuaW5jbHVkZXMoJ2NvbXBvbmVudCcpIHx8IGxvd2VyRmlsZS5pbmNsdWRlcygndHN4Jyk7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBmaW5kQ2F0ZWdvcnlTcGVjaWZpY0Nhc2VzKFxuICAgIGNhdGVnb3J5OiBBbnlUeXBlQ2F0ZWdvcnksXG4gICAgZmlsZXM6IHN0cmluZ1tdXG4gICk6IFByb21pc2U8QW55VHlwZUNsYXNzaWZpY2F0aW9uW10+IHtcbiAgICBjb25zdCBjYXNlczogQW55VHlwZUNsYXNzaWZpY2F0aW9uW10gPSBbXTtcblxuICAgIGZvciAoY29uc3QgZmlsZSBvZiBmaWxlcy5zbGljZSgwLCAzMCkpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGNvbnRlbnQgPSBmcy5yZWFkRmlsZVN5bmMoZmlsZSwgJ3V0ZjgnKTtcbiAgICAgICAgY29uc3QgZmlsZUNhc2VzID0gYXdhaXQgdGhpcy5jbGFzc2lmaWVyLmNsYXNzaWZ5RmlsZUNvbnRlbnQoZmlsZSwgY29udGVudCk7XG5cbiAgICAgICAgY29uc3QgY2F0ZWdvcnlDYXNlcyA9IGZpbGVDYXNlcy5maWx0ZXIoYyA9PlxuICAgICAgICAgICFjLmlzSW50ZW50aW9uYWwgJiZcbiAgICAgICAgICBjLmNhdGVnb3J5ID09PSBjYXRlZ29yeSAmJlxuICAgICAgICAgIGMuY29uZmlkZW5jZSA+PSAwLjZcbiAgICAgICAgKTtcblxuICAgICAgICBjYXNlcy5wdXNoKC4uLmNhdGVnb3J5Q2FzZXMpO1xuXG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLndhcm4oYFdhcm5pbmc6IENvdWxkIG5vdCBwcm9jZXNzICR7ZmlsZX06YCwgZXJyb3IpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBjYXNlcy5zbGljZSgwLCB0aGlzLmNvbmZpZy5taW5CYXRjaFNpemUpO1xuICB9XG5cbiAgcHJpdmF0ZSBpc0RvbWFpbkFwcHJvcHJpYXRlKGNhc2VfOiBBbnlUeXBlQ2xhc3NpZmljYXRpb24sIGRvbWFpbkNvbnRleHQ6IGFueSk6IGJvb2xlYW4ge1xuICAgIC8vIERvbWFpbi1zcGVjaWZpYyBsb2dpYyBmb3IgZGV0ZXJtaW5pbmcgaWYgYSBjYXNlIGlzIGFwcHJvcHJpYXRlIGZvciByZXBsYWNlbWVudFxuICAgIHJldHVybiBjYXNlXy5jb25maWRlbmNlID49IDAuNztcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgY3JlYXRlQmFja3VwKCk6IFByb21pc2U8c3RyaW5nPiB7XG4gICAgY29uc3QgdGltZXN0YW1wID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpLnJlcGxhY2UoL1s6Ll0vZywgJy0nKTtcbiAgICBjb25zdCBiYWNrdXBQYXRoID0gYGJhY2t1cHMvZnVsbC1jYW1wYWlnbi0ke3RpbWVzdGFtcH1gO1xuXG4gICAgdHJ5IHtcbiAgICAgIGV4ZWNTeW5jKGBta2RpciAtcCAke2JhY2t1cFBhdGh9YCk7XG4gICAgICBleGVjU3luYyhgY3AgLXIgc3JjICR7YmFja3VwUGF0aH0vYCk7XG4gICAgICByZXR1cm4gYmFja3VwUGF0aDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS53YXJuKCdXYXJuaW5nOiBDb3VsZCBub3QgY3JlYXRlIGJhY2t1cDonLCBlcnJvcik7XG4gICAgICByZXR1cm4gJyc7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyByZXN0b3JlQmFja3VwKGJhY2t1cFBhdGg6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIGlmICghYmFja3VwUGF0aCB8fCAhZnMuZXhpc3RzU3luYyhiYWNrdXBQYXRoKSkge1xuICAgICAgY29uc29sZS53YXJuKCdXYXJuaW5nOiBCYWNrdXAgcGF0aCBub3QgZm91bmQsIGNhbm5vdCByZXN0b3JlJyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIGV4ZWNTeW5jKGBybSAtcmYgc3JjYCk7XG4gICAgICBleGVjU3luYyhgY3AgLXIgJHtiYWNrdXBQYXRofS9zcmMgLmApO1xuICAgICAgY29uc29sZS5sb2coJ+KchSBCYWNrdXAgcmVzdG9yZWQgc3VjY2Vzc2Z1bGx5Jyk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBGYWlsZWQgdG8gcmVzdG9yZSBiYWNrdXA6JywgZXJyb3IpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZ2VuZXJhdGVSZWNvbW1lbmRhdGlvbnMoKTogc3RyaW5nW10ge1xuICAgIGNvbnN0IHJlY29tbWVuZGF0aW9uczogc3RyaW5nW10gPSBbXTtcblxuICAgIGlmICh0aGlzLm1ldHJpY3MudG90YWxGaXhlc0FwcGxpZWQgPCB0aGlzLmNvbmZpZy50YXJnZXRGaXhDb3VudCkge1xuICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goJ0NvbnNpZGVyIGV4cGFuZGluZyBwYXR0ZXJuIHJlY29nbml0aW9uIGZvciBhZGRpdGlvbmFsIG9wcG9ydHVuaXRpZXMnKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5tZXRyaWNzLnJvbGxiYWNrc1BlcmZvcm1lZCA+IDApIHtcbiAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKCdSZXZpZXcgcm9sbGJhY2sgY2FzZXMgZm9yIHBvdGVudGlhbCBtYW51YWwgZml4ZXMnKTtcbiAgICB9XG5cbiAgICByZWNvbW1lbmRhdGlvbnMucHVzaCgnQ29udGludWUgbW9uaXRvcmluZyBmb3IgbmV3IHVuaW50ZW50aW9uYWwgYW55IHR5cGVzIGluIGZ1dHVyZSBkZXZlbG9wbWVudCcpO1xuICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKCdDb25zaWRlciBpbXBsZW1lbnRpbmcgcHJlLWNvbW1pdCBob29rcyB0byBwcmV2ZW50IG5ldyB1bmludGVudGlvbmFsIGFueSB0eXBlcycpO1xuXG4gICAgcmV0dXJuIHJlY29tbWVuZGF0aW9ucztcbiAgfVxuXG4gIHByaXZhdGUgZ2VuZXJhdGVBY2hpZXZlbWVudHMoKTogc3RyaW5nW10ge1xuICAgIGNvbnN0IGFjaGlldmVtZW50czogc3RyaW5nW10gPSBbXTtcblxuICAgIGFjaGlldmVtZW50cy5wdXNoKGBBcHBsaWVkICR7dGhpcy5tZXRyaWNzLnRvdGFsRml4ZXNBcHBsaWVkfSBzdWNjZXNzZnVsIHR5cGUgaW1wcm92ZW1lbnRzYCk7XG4gICAgYWNoaWV2ZW1lbnRzLnB1c2goYEFjaGlldmVkICR7dGhpcy5jYWxjdWxhdGVSZWR1Y3Rpb25QZXJjZW50YWdlKCkudG9GaXhlZCgxKX0lIHJlZHVjdGlvbiBpbiBleHBsaWNpdCBhbnkgdXNhZ2VgKTtcblxuICAgIGlmICh0aGlzLmlzVGFyZ2V0QWNoaWV2ZWQoKSkge1xuICAgICAgYWNoaWV2ZW1lbnRzLnB1c2goJ+KchSBTdWNjZXNzZnVsbHkgbWV0IGNhbXBhaWduIHRhcmdldHMnKTtcbiAgICB9XG5cbiAgICBpZiAodGhpcy5tZXRyaWNzLnJvbGxiYWNrc1BlcmZvcm1lZCA9PT0gMCkge1xuICAgICAgYWNoaWV2ZW1lbnRzLnB1c2goJ+KchSBaZXJvIHJvbGxiYWNrcyAtIHBlcmZlY3Qgc2FmZXR5IHJlY29yZCcpO1xuICAgIH1cblxuICAgIHJldHVybiBhY2hpZXZlbWVudHM7XG4gIH1cblxuICBwcml2YXRlIGdlbmVyYXRlTmV4dFN0ZXBzKCk6IHN0cmluZ1tdIHtcbiAgICByZXR1cm4gW1xuICAgICAgJ01vbml0b3IgYnVpbGQgcGVyZm9ybWFuY2UgYW5kIHN0YWJpbGl0eSBvdmVyIHRoZSBuZXh0IHdlZWsnLFxuICAgICAgJ1JldmlldyBhbnkgcmVtYWluaW5nIGludGVudGlvbmFsIGFueSB0eXBlcyBmb3IgcG90ZW50aWFsIGltcHJvdmVtZW50cycsXG4gICAgICAnQ29uc2lkZXIgaW1wbGVtZW50aW5nIGF1dG9tYXRlZCBtb25pdG9yaW5nIGZvciBuZXcgdW5pbnRlbnRpb25hbCBhbnkgdHlwZXMnLFxuICAgICAgJ0RvY3VtZW50IGxlc3NvbnMgbGVhcm5lZCBmb3IgZnV0dXJlIGNhbXBhaWducycsXG4gICAgICAnUGxhbiBmb2xsb3ctdXAgY2FtcGFpZ25zIGZvciBvdGhlciBjb2RlIHF1YWxpdHkgaW1wcm92ZW1lbnRzJ1xuICAgIF07XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==