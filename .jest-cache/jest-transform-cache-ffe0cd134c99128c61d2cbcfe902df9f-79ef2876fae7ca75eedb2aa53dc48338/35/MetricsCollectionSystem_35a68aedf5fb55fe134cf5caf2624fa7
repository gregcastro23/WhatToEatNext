7d5e19915588310a12312f24d6569ac1
"use strict";
/**
 * Enhanced Metrics Collection System
 * Perfect Codebase Campaign - Real-time Comprehensive Metrics
 * Requirements: 6.1, 6.2, 6.3
 */
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.MetricsCollectionSystem = void 0;
const child_process_1 = require("child_process");
const fs = __importStar(require("fs"));
class MetricsCollectionSystem {
    constructor() {
        this.snapshots = [];
        this.collectionInterval = null;
        this.isCollecting = false;
    }
    /**
     * Start real-time metrics collection
     */
    startRealTimeCollection(intervalMs = 30000) {
        if (this.isCollecting) {
            console.log('📊 Metrics collection already running');
            return;
        }
        this.isCollecting = true;
        console.log(`📊 Starting real-time metrics collection (interval: ${intervalMs}ms)`);
        this.collectionInterval = setInterval(async () => {
            try {
                await this.collectSnapshot();
            }
            catch (error) {
                console.error('❌ Error during metrics collection:', error.message);
            }
        }, intervalMs);
        // Collect initial snapshot
        this.collectSnapshot();
    }
    /**
     * Stop real-time metrics collection
     */
    stopRealTimeCollection() {
        if (this.collectionInterval) {
            clearInterval(this.collectionInterval);
            this.collectionInterval = null;
        }
        this.isCollecting = false;
        console.log('📊 Stopped real-time metrics collection');
    }
    /**
     * Collect comprehensive metrics snapshot
     */
    async collectSnapshot(phase, milestone, notes) {
        const timestamp = new Date();
        const id = `snapshot_${timestamp.getTime()}`;
        console.log('📊 Collecting metrics snapshot...');
        const metrics = await this.collectDetailedMetrics();
        const snapshot = {
            id,
            timestamp,
            metrics,
            phase: phase || 'unknown',
            milestone,
            notes
        };
        this.snapshots.push(snapshot);
        // Keep only recent snapshots to prevent memory issues
        if (this.snapshots.length > 1000) {
            this.snapshots = this.snapshots.slice(-500);
        }
        console.log(`📊 Snapshot collected: ${id}`);
        return snapshot;
    }
    /**
     * Collect detailed metrics with comprehensive analysis
     */
    async collectDetailedMetrics() {
        const [typeScriptMetrics, lintingMetrics, buildMetrics, resourceMetrics, enterpriseSystemCount] = await Promise.all([
            this.collectTypeScriptMetrics(),
            this.collectLintingMetrics(),
            this.collectBuildMetrics(),
            this.collectResourceMetrics(),
            this.getEnterpriseSystemCount()
        ]);
        const trendData = this.calculateTrendData();
        const detailedMetrics = {
            timestamp: new Date(),
            typeScriptErrors: {
                current: typeScriptMetrics.count,
                target: 0,
                reduction: Math.max(0, 86 - typeScriptMetrics.count),
                percentage: typeScriptMetrics.count >= 0 ? Math.round(((86 - typeScriptMetrics.count) / 86) * 100) : 0
            },
            lintingWarnings: {
                current: lintingMetrics.count,
                target: 0,
                reduction: Math.max(0, 4506 - lintingMetrics.count),
                percentage: lintingMetrics.count >= 0 ? Math.round(((4506 - lintingMetrics.count) / 4506) * 100) : 0
            },
            buildPerformance: {
                currentTime: buildMetrics.buildTime,
                targetTime: 10,
                cacheHitRate: buildMetrics.cacheHitRate,
                memoryUsage: buildMetrics.memoryUsage
            },
            enterpriseSystems: {
                current: enterpriseSystemCount,
                target: 200,
                transformedExports: Math.max(0, enterpriseSystemCount - 0)
            },
            errorBreakdown: typeScriptMetrics.breakdown,
            warningBreakdown: lintingMetrics.breakdown,
            buildMetrics,
            resourceMetrics,
            trendData
        };
        return detailedMetrics;
    }
    /**
     * Collect TypeScript error metrics with detailed breakdown
     */
    async collectTypeScriptMetrics() {
        try {
            // Get total error count
            const countOutput = (0, child_process_1.execSync)('yarn tsc --noEmit --skipLibCheck 2>&1 | grep -c "error TS" || echo "0"', {
                encoding: 'utf8',
                stdio: 'pipe'
            });
            const count = parseInt(countOutput.trim()) || 0;
            // Get detailed breakdown by error type
            let breakdown = {};
            if (count > 0) {
                try {
                    const breakdownOutput = (0, child_process_1.execSync)('yarn tsc --noEmit --skipLibCheck 2>&1 | grep -E "error TS" | sed \'s/.*error //\' | cut -d\':\' -f1 | sort | uniq -c | sort -nr', {
                        encoding: 'utf8',
                        stdio: 'pipe'
                    });
                    const lines = breakdownOutput.trim().split('\n').filter(line => line.trim());
                    for (const line of lines) {
                        const match = line.trim().match(/^\s*(\d+)\s+(.+)$/);
                        if (match) {
                            const errorCount = parseInt(match[1]);
                            const errorType = match[2].trim();
                            breakdown[errorType] = errorCount;
                        }
                    }
                }
                catch (error) {
                    console.warn('Could not get TypeScript error breakdown:', error.message);
                }
            }
            return { count, breakdown };
        }
        catch (error) {
            console.warn('Could not collect TypeScript metrics:', error.message);
            return { count: -1, breakdown: {} };
        }
    }
    /**
     * Collect linting warning metrics with categorized breakdown
     */
    async collectLintingMetrics() {
        try {
            // Get total warning count
            const countOutput = (0, child_process_1.execSync)('yarn lint 2>&1 | grep -c "warning" || echo "0"', {
                encoding: 'utf8',
                stdio: 'pipe'
            });
            const count = parseInt(countOutput.trim()) || 0;
            // Get detailed breakdown by warning type
            let breakdown = {};
            if (count > 0) {
                try {
                    const lintOutput = (0, child_process_1.execSync)('yarn lint 2>&1', {
                        encoding: 'utf8',
                        stdio: 'pipe'
                    });
                    const lines = lintOutput.split('\n');
                    for (const line of lines) {
                        // Look for ESLint warning patterns
                        const warningMatch = line.match(/warning\s+(.+?)\s+(@typescript-eslint\/[\w-]+|[\w-]+)/);
                        if (warningMatch) {
                            const ruleType = warningMatch[2];
                            breakdown[ruleType] = (breakdown[ruleType] || 0) + 1;
                        }
                    }
                }
                catch (error) {
                    console.warn('Could not get linting warning breakdown:', error.message);
                }
            }
            return { count, breakdown };
        }
        catch (error) {
            console.warn('Could not collect linting metrics:', error.message);
            return { count: -1, breakdown: {} };
        }
    }
    /**
     * Collect comprehensive build performance metrics
     */
    async collectBuildMetrics() {
        const startTime = Date.now();
        let buildTime = -1;
        let bundleSize = 0;
        let compilationSpeed = 0;
        try {
            // Measure build time
            const buildStart = Date.now();
            (0, child_process_1.execSync)('yarn build', {
                encoding: 'utf8',
                stdio: 'pipe'
            });
            buildTime = (Date.now() - buildStart) / 1000;
            // Calculate compilation speed (rough estimate)
            const sourceFiles = this.countSourceFiles();
            compilationSpeed = sourceFiles / buildTime;
        }
        catch (error) {
            console.warn('Build failed during metrics collection:', error.message);
        }
        try {
            // Get bundle size
            bundleSize = await this.getBundleSize();
        }
        catch (error) {
            console.warn('Could not measure bundle size:', error.message);
        }
        return {
            buildTime,
            bundleSize,
            cacheHitRate: await this.estimateCacheHitRate(),
            memoryUsage: this.getMemoryUsage(),
            cpuUsage: await this.getCpuUsage(),
            diskUsage: await this.getDiskUsage(),
            compilationSpeed
        };
    }
    /**
     * Collect system resource metrics
     */
    async collectResourceMetrics() {
        const nodeMemoryUsage = process.memoryUsage();
        return {
            nodeMemoryUsage,
            systemMemory: await this.getSystemMemory(),
            diskSpace: await this.getDiskSpace()
        };
    }
    /**
     * Calculate trend data based on historical snapshots
     */
    calculateTrendData() {
        if (this.snapshots.length < 2) {
            return {
                errorReductionRate: 0,
                warningReductionRate: 0,
                buildTimeImprovement: 0,
                systemGrowthRate: 0
            };
        }
        const recent = this.snapshots.slice(-10); // Last 10 snapshots
        const timeSpanHours = (recent[recent.length - 1].timestamp.getTime() - recent[0].timestamp.getTime()) / (1000 * 60 * 60);
        if (timeSpanHours === 0) {
            return {
                errorReductionRate: 0,
                warningReductionRate: 0,
                buildTimeImprovement: 0,
                systemGrowthRate: 0
            };
        }
        const errorReduction = recent[0].metrics.typeScriptErrors.current - recent[recent.length - 1].metrics.typeScriptErrors.current;
        const warningReduction = recent[0].metrics.lintingWarnings.current - recent[recent.length - 1].metrics.lintingWarnings.current;
        const buildTimeImprovement = recent[0].metrics.buildPerformance.currentTime - recent[recent.length - 1].metrics.buildPerformance.currentTime;
        const systemGrowth = recent[recent.length - 1].metrics.enterpriseSystems.current - recent[0].metrics.enterpriseSystems.current;
        return {
            errorReductionRate: errorReduction / timeSpanHours,
            warningReductionRate: warningReduction / timeSpanHours,
            buildTimeImprovement: buildTimeImprovement / timeSpanHours,
            systemGrowthRate: systemGrowth / timeSpanHours
        };
    }
    /**
     * Helper methods for metrics collection
     */
    async getEnterpriseSystemCount() {
        try {
            const output = (0, child_process_1.execSync)('grep -r "INTELLIGENCE_SYSTEM" src/ | wc -l', {
                encoding: 'utf8',
                stdio: 'pipe'
            });
            return parseInt(output.trim()) || 0;
        }
        catch (error) {
            return 0;
        }
    }
    async getBundleSize() {
        try {
            const buildDirs = ['.next', 'dist', 'build'];
            let totalSize = 0;
            for (const dir of buildDirs) {
                if (fs.existsSync(dir)) {
                    const output = (0, child_process_1.execSync)(`du -sk ${dir} | cut -f1`, {
                        encoding: 'utf8',
                        stdio: 'pipe'
                    });
                    totalSize += parseInt(output.trim()) || 0;
                }
            }
            return totalSize;
        }
        catch (error) {
            return 0;
        }
    }
    async estimateCacheHitRate() {
        // This is a simplified estimation - in a real implementation,
        // you'd integrate with the actual build system's cache metrics
        return 0.8; // 80% default estimate
    }
    getMemoryUsage() {
        const memUsage = process.memoryUsage();
        return Math.round(memUsage.heapUsed / 1024 / 1024);
    }
    async getCpuUsage() {
        try {
            const output = (0, child_process_1.execSync)('ps -o %cpu -p $$ | tail -1', {
                encoding: 'utf8',
                stdio: 'pipe'
            });
            return parseFloat(output.trim()) || 0;
        }
        catch (error) {
            return 0;
        }
    }
    async getDiskUsage() {
        try {
            const output = (0, child_process_1.execSync)('du -sh . | cut -f1', {
                encoding: 'utf8',
                stdio: 'pipe'
            });
            // Convert to MB (rough estimation)
            const sizeStr = output.trim();
            if (sizeStr.includes('G')) {
                return parseFloat(sizeStr) * 1024;
            }
            else if (sizeStr.includes('M')) {
                return parseFloat(sizeStr);
            }
            return 0;
        }
        catch (error) {
            return 0;
        }
    }
    countSourceFiles() {
        try {
            const output = (0, child_process_1.execSync)('find src -name "*.ts" -o -name "*.tsx" | wc -l', {
                encoding: 'utf8',
                stdio: 'pipe'
            });
            return parseInt(output.trim()) || 0;
        }
        catch (error) {
            return 0;
        }
    }
    async getSystemMemory() {
        try {
            const output = (0, child_process_1.execSync)('free -m | grep Mem', {
                encoding: 'utf8',
                stdio: 'pipe'
            });
            const match = output.match(/Mem:\s+(\d+)\s+(\d+)\s+(\d+)/);
            if (match) {
                const total = parseInt(match[1]);
                const used = parseInt(match[2]);
                const free = parseInt(match[3]);
                return {
                    total,
                    used,
                    free,
                    percentage: Math.round((used / total) * 100)
                };
            }
        }
        catch (error) {
            // Fallback for non-Linux systems
        }
        return {
            total: 0,
            used: 0,
            free: 0,
            percentage: 0
        };
    }
    async getDiskSpace() {
        try {
            const output = (0, child_process_1.execSync)('df -h . | tail -1', {
                encoding: 'utf8',
                stdio: 'pipe'
            });
            const parts = output.trim().split(/\s+/);
            if (parts.length >= 4) {
                const total = this.parseSize(parts[1]);
                const used = this.parseSize(parts[2]);
                const free = this.parseSize(parts[3]);
                return {
                    total,
                    used,
                    free,
                    percentage: Math.round((used / total) * 100)
                };
            }
        }
        catch (error) {
            // Handle error
        }
        return {
            total: 0,
            used: 0,
            free: 0,
            percentage: 0
        };
    }
    parseSize(sizeStr) {
        const num = parseFloat(sizeStr);
        if (sizeStr.includes('G'))
            return num * 1024;
        if (sizeStr.includes('M'))
            return num;
        if (sizeStr.includes('K'))
            return num / 1024;
        return num;
    }
    /**
     * Export methods for external access
     */
    getSnapshots() {
        return [...this.snapshots];
    }
    getLatestSnapshot() {
        return this.snapshots.length > 0 ? this.snapshots[this.snapshots.length - 1] : null;
    }
    async exportSnapshots(filePath) {
        const exportData = {
            timestamp: new Date().toISOString(),
            totalSnapshots: this.snapshots.length,
            snapshots: this.snapshots,
            summary: {
                collectionPeriod: this.snapshots.length > 0 ? {
                    start: this.snapshots[0].timestamp,
                    end: this.snapshots[this.snapshots.length - 1].timestamp
                } : null,
                trends: this.calculateTrendData()
            }
        };
        fs.writeFileSync(filePath, JSON.stringify(exportData, null, 2));
        console.log(`📊 Metrics snapshots exported to: ${filePath}`);
    }
    clearSnapshots() {
        this.snapshots = [];
        console.log('📊 Metrics snapshots cleared');
    }
}
exports.MetricsCollectionSystem = MetricsCollectionSystem;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9zZXJ2aWNlcy9jYW1wYWlnbi9NZXRyaWNzQ29sbGVjdGlvblN5c3RlbS50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7R0FJRzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFSCxpREFBeUM7QUFDekMsdUNBQXlCO0FBMkR6QixNQUFhLHVCQUF1QjtJQUFwQztRQUNVLGNBQVMsR0FBc0IsRUFBRSxDQUFDO1FBQ2xDLHVCQUFrQixHQUEwQixJQUFJLENBQUM7UUFDakQsaUJBQVksR0FBRyxLQUFLLENBQUM7SUF1Zi9CLENBQUM7SUFyZkM7O09BRUc7SUFDSCx1QkFBdUIsQ0FBQyxhQUFxQixLQUFLO1FBQ2hELElBQUksSUFBSSxDQUFDLFlBQVksRUFBRTtZQUNyQixPQUFPLENBQUMsR0FBRyxDQUFDLHVDQUF1QyxDQUFDLENBQUM7WUFDckQsT0FBTztTQUNSO1FBRUQsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUM7UUFDekIsT0FBTyxDQUFDLEdBQUcsQ0FBQyx1REFBdUQsVUFBVSxLQUFLLENBQUMsQ0FBQztRQUVwRixJQUFJLENBQUMsa0JBQWtCLEdBQUcsV0FBVyxDQUFDLEtBQUssSUFBSSxFQUFFO1lBQy9DLElBQUk7Z0JBQ0YsTUFBTSxJQUFJLENBQUMsZUFBZSxFQUFFLENBQUM7YUFDOUI7WUFBQyxPQUFPLEtBQUssRUFBRTtnQkFDZCxPQUFPLENBQUMsS0FBSyxDQUFDLG9DQUFvQyxFQUFFLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQzthQUNwRTtRQUNILENBQUMsRUFBRSxVQUFVLENBQUMsQ0FBQztRQUVmLDJCQUEyQjtRQUMzQixJQUFJLENBQUMsZUFBZSxFQUFFLENBQUM7SUFDekIsQ0FBQztJQUVEOztPQUVHO0lBQ0gsc0JBQXNCO1FBQ3BCLElBQUksSUFBSSxDQUFDLGtCQUFrQixFQUFFO1lBQzNCLGFBQWEsQ0FBQyxJQUFJLENBQUMsa0JBQWtCLENBQUMsQ0FBQztZQUN2QyxJQUFJ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LFNBQVMsR0FBRyxFQUFFLENBQUM7UUFDcEIsT0FBTyxDQUFDLEdBQUcsQ0FBQyw4QkFBOEIsQ0FBQyxDQUFDO0lBQzlDLENBQUM7Q0FDRjtBQTFmRCwwREEwZkMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9zZXJ2aWNlcy9jYW1wYWlnbi9NZXRyaWNzQ29sbGVjdGlvblN5c3RlbS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEVuaGFuY2VkIE1ldHJpY3MgQ29sbGVjdGlvbiBTeXN0ZW1cbiAqIFBlcmZlY3QgQ29kZWJhc2UgQ2FtcGFpZ24gLSBSZWFsLXRpbWUgQ29tcHJlaGVuc2l2ZSBNZXRyaWNzXG4gKiBSZXF1aXJlbWVudHM6IDYuMSwgNi4yLCA2LjNcbiAqL1xuXG5pbXBvcnQgeyBleGVjU3luYyB9IGZyb20gJ2NoaWxkX3Byb2Nlc3MnO1xuaW1wb3J0ICogYXMgZnMgZnJvbSAnZnMnO1xuaW1wb3J0ICogYXMgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCB7XG4gIFByb2dyZXNzTWV0cmljcyxcbiAgRXJyb3JDYXRlZ29yeSxcbiAgVmFsaWRhdGlvblJlc3VsdFxufSBmcm9tICcuLi8uLi90eXBlcy9jYW1wYWlnbic7XG5cbmV4cG9ydCBpbnRlcmZhY2UgRGV0YWlsZWRNZXRyaWNzIGV4dGVuZHMgUHJvZ3Jlc3NNZXRyaWNzIHtcbiAgdGltZXN0YW1wOiBEYXRlO1xuICBlcnJvckJyZWFrZG93bjogUmVjb3JkPHN0cmluZywgbnVtYmVyPjtcbiAgd2FybmluZ0JyZWFrZG93bjogUmVjb3JkPHN0cmluZywgbnVtYmVyPjtcbiAgYnVpbGRNZXRyaWNzOiBCdWlsZE1ldHJpY3M7XG4gIHJlc291cmNlTWV0cmljczogUmVzb3VyY2VNZXRyaWNzO1xuICB0cmVuZERhdGE6IFRyZW5kRGF0YTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBCdWlsZE1ldHJpY3Mge1xuICBidWlsZFRpbWU6IG51bWJlcjtcbiAgYnVuZGxlU2l6ZTogbnVtYmVyO1xuICBjYWNoZUhpdFJhdGU6IG51bWJlcjtcbiAgbWVtb3J5VXNhZ2U6IG51bWJlcjtcbiAgY3B1VXNhZ2U6IG51bWJlcjtcbiAgZGlza1VzYWdlOiBudW1iZXI7XG4gIGNvbXBpbGF0aW9uU3BlZWQ6IG51bWJlcjsgLy8gZmlsZXMgcGVyIHNlY29uZFxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFJlc291cmNlTWV0cmljcyB7XG4gIG5vZGVNZW1vcnlVc2FnZTogTm9kZUpTLk1lbW9yeVVzYWdlO1xuICBzeXN0ZW1NZW1vcnk6IHtcbiAgICB0b3RhbDogbnVtYmVyO1xuICAgIGZyZWU6IG51bWJlcjtcbiAgICB1c2VkOiBudW1iZXI7XG4gICAgcGVyY2VudGFnZTogbnVtYmVyO1xuICB9O1xuICBkaXNrU3BhY2U6IHtcbiAgICB0b3RhbDogbnVtYmVyO1xuICAgIGZyZWU6IG51bWJlcjtcbiAgICB1c2VkOiBudW1iZXI7XG4gICAgcGVyY2VudGFnZTogbnVtYmVyO1xuICB9O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFRyZW5kRGF0YSB7XG4gIGVycm9yUmVkdWN0aW9uUmF0ZTogbnVtYmVyOyAvLyBlcnJvcnMgcmVkdWNlZCBwZXIgaG91clxuICB3YXJuaW5nUmVkdWN0aW9uUmF0ZTogbnVtYmVyOyAvLyB3YXJuaW5ncyByZWR1Y2VkIHBlciBob3VyXG4gIGJ1aWxkVGltZUltcHJvdmVtZW50OiBudW1iZXI7IC8vIHNlY29uZHMgaW1wcm92ZWQgcGVyIGhvdXJcbiAgc3lzdGVtR3Jvd3RoUmF0ZTogbnVtYmVyOyAvLyBlbnRlcnByaXNlIHN5c3RlbXMgYWRkZWQgcGVyIGhvdXJcbn1cblxuZXhwb3J0IGludGVyZmFjZSBNZXRyaWNzU25hcHNob3Qge1xuICBpZDogc3RyaW5nO1xuICB0aW1lc3RhbXA6IERhdGU7XG4gIG1ldHJpY3M6IERldGFpbGVkTWV0cmljcztcbiAgcGhhc2U6IHN0cmluZztcbiAgbWlsZXN0b25lPzogc3RyaW5nO1xuICBub3Rlcz86IHN0cmluZztcbn1cblxuZXhwb3J0IGNsYXNzIE1ldHJpY3NDb2xsZWN0aW9uU3lzdGVtIHtcbiAgcHJpdmF0ZSBzbmFwc2hvdHM6IE1ldHJpY3NTbmFwc2hvdFtdID0gW107XG4gIHByaXZhdGUgY29sbGVjdGlvbkludGVydmFsOiBOb2RlSlMuVGltZW91dCB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIGlzQ29sbGVjdGluZyA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiBTdGFydCByZWFsLXRpbWUgbWV0cmljcyBjb2xsZWN0aW9uXG4gICAqL1xuICBzdGFydFJlYWxUaW1lQ29sbGVjdGlvbihpbnRlcnZhbE1zOiBudW1iZXIgPSAzMDAwMCk6IHZvaWQge1xuICAgIGlmICh0aGlzLmlzQ29sbGVjdGluZykge1xuICAgICAgY29uc29sZS5sb2coJ/Cfk4ogTWV0cmljcyBjb2xsZWN0aW9uIGFscmVhZHkgcnVubmluZycpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuaXNDb2xsZWN0aW5nID0gdHJ1ZTtcbiAgICBjb25zb2xlLmxvZyhg8J+TiiBTdGFydGluZyByZWFsLXRpbWUgbWV0cmljcyBjb2xsZWN0aW9uIChpbnRlcnZhbDogJHtpbnRlcnZhbE1zfW1zKWApO1xuXG4gICAgdGhpcy5jb2xsZWN0aW9uSW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChhc3luYyAoKSA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCB0aGlzLmNvbGxlY3RTbmFwc2hvdCgpO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIGR1cmluZyBtZXRyaWNzIGNvbGxlY3Rpb246JywgZXJyb3IubWVzc2FnZSk7XG4gICAgICB9XG4gICAgfSwgaW50ZXJ2YWxNcyk7XG5cbiAgICAvLyBDb2xsZWN0IGluaXRpYWwgc25hcHNob3RcbiAgICB0aGlzLmNvbGxlY3RTbmFwc2hvdCgpO1xuICB9XG5cbiAgLyoqXG4gICAqIFN0b3AgcmVhbC10aW1lIG1ldHJpY3MgY29sbGVjdGlvblxuICAgKi9cbiAgc3RvcFJlYWxUaW1lQ29sbGVjdGlvbigpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5jb2xsZWN0aW9uSW50ZXJ2YWwpIHtcbiAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5jb2xsZWN0aW9uSW50ZXJ2YWwpO1xuICAgICAgdGhpcy5jb2xsZWN0aW9uSW50ZXJ2YWwgPSBudWxsO1xuICAgIH1cbiAgICB0aGlzLmlzQ29sbGVjdGluZyA9IGZhbHNlO1xuICAgIGNvbnNvbGUubG9nKCfwn5OKIFN0b3BwZWQgcmVhbC10aW1lIG1ldHJpY3MgY29sbGVjdGlvbicpO1xuICB9XG5cbiAgLyoqXG4gICAqIENvbGxlY3QgY29tcHJlaGVuc2l2ZSBtZXRyaWNzIHNuYXBzaG90XG4gICAqL1xuICBhc3luYyBjb2xsZWN0U25hcHNob3QocGhhc2U/OiBzdHJpbmcsIG1pbGVzdG9uZT86IHN0cmluZywgbm90ZXM/OiBzdHJpbmcpOiBQcm9taXNlPE1ldHJpY3NTbmFwc2hvdD4ge1xuICAgIGNvbnN0IHRpbWVzdGFtcCA9IG5ldyBEYXRlKCk7XG4gICAgY29uc3QgaWQgPSBgc25hcHNob3RfJHt0aW1lc3RhbXAuZ2V0VGltZSgpfWA7XG5cbiAgICBjb25zb2xlLmxvZygn8J+TiiBDb2xsZWN0aW5nIG1ldHJpY3Mgc25hcHNob3QuLi4nKTtcblxuICAgIGNvbnN0IG1ldHJpY3MgPSBhd2FpdCB0aGlzLmNvbGxlY3REZXRhaWxlZE1ldHJpY3MoKTtcbiAgICBcbiAgICBjb25zdCBzbmFwc2hvdDogTWV0cmljc1NuYXBzaG90ID0ge1xuICAgICAgaWQsXG4gICAgICB0aW1lc3RhbXAsXG4gICAgICBtZXRyaWNzLFxuICAgICAgcGhhc2U6IHBoYXNlIHx8ICd1bmtub3duJyxcbiAgICAgIG1pbGVzdG9uZSxcbiAgICAgIG5vdGVzXG4gICAgfTtcblxuICAgIHRoaXMuc25hcHNob3RzLnB1c2goc25hcHNob3QpO1xuXG4gICAgLy8gS2VlcCBvbmx5IHJlY2VudCBzbmFwc2hvdHMgdG8gcHJldmVudCBtZW1vcnkgaXNzdWVzXG4gICAgaWYgKHRoaXMuc25hcHNob3RzLmxlbmd0aCA+IDEwMDApIHtcbiAgICAgIHRoaXMuc25hcHNob3RzID0gdGhpcy5zbmFwc2hvdHMuc2xpY2UoLTUwMCk7XG4gICAgfVxuXG4gICAgY29uc29sZS5sb2coYPCfk4ogU25hcHNob3QgY29sbGVjdGVkOiAke2lkfWApO1xuICAgIHJldHVybiBzbmFwc2hvdDtcbiAgfVxuXG4gIC8qKlxuICAgKiBDb2xsZWN0IGRldGFpbGVkIG1ldHJpY3Mgd2l0aCBjb21wcmVoZW5zaXZlIGFuYWx5c2lzXG4gICAqL1xuICBhc3luYyBjb2xsZWN0RGV0YWlsZWRNZXRyaWNzKCk6IFByb21pc2U8RGV0YWlsZWRNZXRyaWNzPiB7XG4gICAgY29uc3QgW1xuICAgICAgdHlwZVNjcmlwdE1ldHJpY3MsXG4gICAgICBsaW50aW5nTWV0cmljcyxcbiAgICAgIGJ1aWxkTWV0cmljcyxcbiAgICAgIHJlc291cmNlTWV0cmljcyxcbiAgICAgIGVudGVycHJpc2VTeXN0ZW1Db3VudFxuICAgIF0gPSBhd2FpdCBQcm9taXNlLmFsbChbXG4gICAgICB0aGlzLmNvbGxlY3RUeXBlU2NyaXB0TWV0cmljcygpLFxuICAgICAgdGhpcy5jb2xsZWN0TGludGluZ01ldHJpY3MoKSxcbiAgICAgIHRoaXMuY29sbGVjdEJ1aWxkTWV0cmljcygpLFxuICAgICAgdGhpcy5jb2xsZWN0UmVzb3VyY2VNZXRyaWNzKCksXG4gICAgICB0aGlzLmdldEVudGVycHJpc2VTeXN0ZW1Db3VudCgpXG4gICAgXSk7XG5cbiAgICBjb25zdCB0cmVuZERhdGEgPSB0aGlzLmNhbGN1bGF0ZVRyZW5kRGF0YSgpO1xuXG4gICAgY29uc3QgZGV0YWlsZWRNZXRyaWNzOiBEZXRhaWxlZE1ldHJpY3MgPSB7XG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAgICB0eXBlU2NyaXB0RXJyb3JzOiB7XG4gICAgICAgIGN1cnJlbnQ6IHR5cGVTY3JpcHRNZXRyaWNzLmNvdW50LFxuICAgICAgICB0YXJnZXQ6IDAsXG4gICAgICAgIHJlZHVjdGlvbjogTWF0aC5tYXgoMCwgODYgLSB0eXBlU2NyaXB0TWV0cmljcy5jb3VudCksXG4gICAgICAgIHBlcmNlbnRhZ2U6IHR5cGVTY3JpcHRNZXRyaWNzLmNvdW50ID49IDAgPyBNYXRoLnJvdW5kKCgoODYgLSB0eXBlU2NyaXB0TWV0cmljcy5jb3VudCkgLyA4NikgKiAxMDApIDogMFxuICAgICAgfSxcbiAgICAgIGxpbnRpbmdXYXJuaW5nczoge1xuICAgICAgICBjdXJyZW50OiBsaW50aW5nTWV0cmljcy5jb3VudCxcbiAgICAgICAgdGFyZ2V0OiAwLFxuICAgICAgICByZWR1Y3Rpb246IE1hdGgubWF4KDAsIDQ1MDYgLSBsaW50aW5nTWV0cmljcy5jb3VudCksXG4gICAgICAgIHBlcmNlbnRhZ2U6IGxpbnRpbmdNZXRyaWNzLmNvdW50ID49IDAgPyBNYXRoLnJvdW5kKCgoNDUwNiAtIGxpbnRpbmdNZXRyaWNzLmNvdW50KSAvIDQ1MDYpICogMTAwKSA6IDBcbiAgICAgIH0sXG4gICAgICBidWlsZFBlcmZvcm1hbmNlOiB7XG4gICAgICAgIGN1cnJlbnRUaW1lOiBidWlsZE1ldHJpY3MuYnVpbGRUaW1lLFxuICAgICAgICB0YXJnZXRUaW1lOiAxMCxcbiAgICAgICAgY2FjaGVIaXRSYXRlOiBidWlsZE1ldHJpY3MuY2FjaGVIaXRSYXRlLFxuICAgICAgICBtZW1vcnlVc2FnZTogYnVpbGRNZXRyaWNzLm1lbW9yeVVzYWdlXG4gICAgICB9LFxuICAgICAgZW50ZXJwcmlzZVN5c3RlbXM6IHtcbiAgICAgICAgY3VycmVudDogZW50ZXJwcmlzZVN5c3RlbUNvdW50LFxuICAgICAgICB0YXJnZXQ6IDIwMCxcbiAgICAgICAgdHJhbnNmb3JtZWRFeHBvcnRzOiBNYXRoLm1heCgwLCBlbnRlcnByaXNlU3lzdGVtQ291bnQgLSAwKVxuICAgICAgfSxcbiAgICAgIGVycm9yQnJlYWtkb3duOiB0eXBlU2NyaXB0TWV0cmljcy5icmVha2Rvd24sXG4gICAgICB3YXJuaW5nQnJlYWtkb3duOiBsaW50aW5nTWV0cmljcy5icmVha2Rvd24sXG4gICAgICBidWlsZE1ldHJpY3MsXG4gICAgICByZXNvdXJjZU1ldHJpY3MsXG4gICAgICB0cmVuZERhdGFcbiAgICB9O1xuXG4gICAgcmV0dXJuIGRldGFpbGVkTWV0cmljcztcbiAgfVxuXG4gIC8qKlxuICAgKiBDb2xsZWN0IFR5cGVTY3JpcHQgZXJyb3IgbWV0cmljcyB3aXRoIGRldGFpbGVkIGJyZWFrZG93blxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBjb2xsZWN0VHlwZVNjcmlwdE1ldHJpY3MoKTogUHJvbWlzZTx7Y291bnQ6IG51bWJlciwgYnJlYWtkb3duOiBSZWNvcmQ8c3RyaW5nLCBudW1iZXI+fT4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBHZXQgdG90YWwgZXJyb3IgY291bnRcbiAgICAgIGNvbnN0IGNvdW50T3V0cHV0ID0gZXhlY1N5bmMoJ3lhcm4gdHNjIC0tbm9FbWl0IC0tc2tpcExpYkNoZWNrIDI+JjEgfCBncmVwIC1jIFwiZXJyb3IgVFNcIiB8fCBlY2hvIFwiMFwiJywge1xuICAgICAgICBlbmNvZGluZzogJ3V0ZjgnLFxuICAgICAgICBzdGRpbzogJ3BpcGUnXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgY29uc3QgY291bnQgPSBwYXJzZUludChjb3VudE91dHB1dC50cmltKCkpIHx8IDA7XG5cbiAgICAgIC8vIEdldCBkZXRhaWxlZCBicmVha2Rvd24gYnkgZXJyb3IgdHlwZVxuICAgICAgbGV0IGJyZWFrZG93bjogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9O1xuICAgICAgXG4gICAgICBpZiAoY291bnQgPiAwKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3QgYnJlYWtkb3duT3V0cHV0ID0gZXhlY1N5bmMoJ3lhcm4gdHNjIC0tbm9FbWl0IC0tc2tpcExpYkNoZWNrIDI+JjEgfCBncmVwIC1FIFwiZXJyb3IgVFNcIiB8IHNlZCBcXCdzLy4qZXJyb3IgLy9cXCcgfCBjdXQgLWRcXCc6XFwnIC1mMSB8IHNvcnQgfCB1bmlxIC1jIHwgc29ydCAtbnInLCB7XG4gICAgICAgICAgICBlbmNvZGluZzogJ3V0ZjgnLFxuICAgICAgICAgICAgc3RkaW86ICdwaXBlJ1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgY29uc3QgbGluZXMgPSBicmVha2Rvd25PdXRwdXQudHJpbSgpLnNwbGl0KCdcXG4nKS5maWx0ZXIobGluZSA9PiBsaW5lLnRyaW0oKSk7XG4gICAgICAgICAgZm9yIChjb25zdCBsaW5lIG9mIGxpbmVzKSB7XG4gICAgICAgICAgICBjb25zdCBtYXRjaCA9IGxpbmUudHJpbSgpLm1hdGNoKC9eXFxzKihcXGQrKVxccysoLispJC8pO1xuICAgICAgICAgICAgaWYgKG1hdGNoKSB7XG4gICAgICAgICAgICAgIGNvbnN0IGVycm9yQ291bnQgPSBwYXJzZUludChtYXRjaFsxXSk7XG4gICAgICAgICAgICAgIGNvbnN0IGVycm9yVHlwZSA9IG1hdGNoWzJdLnRyaW0oKTtcbiAgICAgICAgICAgICAgYnJlYWtkb3duW2Vycm9yVHlwZV0gPSBlcnJvckNvdW50O1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLndhcm4oJ0NvdWxkIG5vdCBnZXQgVHlwZVNjcmlwdCBlcnJvciBicmVha2Rvd246JywgZXJyb3IubWVzc2FnZSk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHsgY291bnQsIGJyZWFrZG93biB9O1xuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUud2FybignQ291bGQgbm90IGNvbGxlY3QgVHlwZVNjcmlwdCBtZXRyaWNzOicsIGVycm9yLm1lc3NhZ2UpO1xuICAgICAgcmV0dXJuIHsgY291bnQ6IC0xLCBicmVha2Rvd246IHt9IH07XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENvbGxlY3QgbGludGluZyB3YXJuaW5nIG1ldHJpY3Mgd2l0aCBjYXRlZ29yaXplZCBicmVha2Rvd25cbiAgICovXG4gIHByaXZhdGUgYXN5bmMgY29sbGVjdExpbnRpbmdNZXRyaWNzKCk6IFByb21pc2U8e2NvdW50OiBudW1iZXIsIGJyZWFrZG93bjogUmVjb3JkPHN0cmluZywgbnVtYmVyPn0+IHtcbiAgICB0cnkge1xuICAgICAgLy8gR2V0IHRvdGFsIHdhcm5pbmcgY291bnRcbiAgICAgIGNvbnN0IGNvdW50T3V0cHV0ID0gZXhlY1N5bmMoJ3lhcm4gbGludCAyPiYxIHwgZ3JlcCAtYyBcIndhcm5pbmdcIiB8fCBlY2hvIFwiMFwiJywge1xuICAgICAgICBlbmNvZGluZzogJ3V0ZjgnLFxuICAgICAgICBzdGRpbzogJ3BpcGUnXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgY29uc3QgY291bnQgPSBwYXJzZUludChjb3VudE91dHB1dC50cmltKCkpIHx8IDA7XG5cbiAgICAgIC8vIEdldCBkZXRhaWxlZCBicmVha2Rvd24gYnkgd2FybmluZyB0eXBlXG4gICAgICBsZXQgYnJlYWtkb3duOiBSZWNvcmQ8c3RyaW5nLCBudW1iZXI+ID0ge307XG4gICAgICBcbiAgICAgIGlmIChjb3VudCA+IDApIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zdCBsaW50T3V0cHV0ID0gZXhlY1N5bmMoJ3lhcm4gbGludCAyPiYxJywge1xuICAgICAgICAgICAgZW5jb2Rpbmc6ICd1dGY4JyxcbiAgICAgICAgICAgIHN0ZGlvOiAncGlwZSdcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIGNvbnN0IGxpbmVzID0gbGludE91dHB1dC5zcGxpdCgnXFxuJyk7XG4gICAgICAgICAgZm9yIChjb25zdCBsaW5lIG9mIGxpbmVzKSB7XG4gICAgICAgICAgICAvLyBMb29rIGZvciBFU0xpbnQgd2FybmluZyBwYXR0ZXJuc1xuICAgICAgICAgICAgY29uc3Qgd2FybmluZ01hdGNoID0gbGluZS5tYXRjaCgvd2FybmluZ1xccysoLis/KVxccysoQHR5cGVzY3JpcHQtZXNsaW50XFwvW1xcdy1dK3xbXFx3LV0rKS8pO1xuICAgICAgICAgICAgaWYgKHdhcm5pbmdNYXRjaCkge1xuICAgICAgICAgICAgICBjb25zdCBydWxlVHlwZSA9IHdhcm5pbmdNYXRjaFsyXTtcbiAgICAgICAgICAgICAgYnJlYWtkb3duW3J1bGVUeXBlXSA9IChicmVha2Rvd25bcnVsZVR5cGVdIHx8IDApICsgMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS53YXJuKCdDb3VsZCBub3QgZ2V0IGxpbnRpbmcgd2FybmluZyBicmVha2Rvd246JywgZXJyb3IubWVzc2FnZSk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHsgY291bnQsIGJyZWFrZG93biB9O1xuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUud2FybignQ291bGQgbm90IGNvbGxlY3QgbGludGluZyBtZXRyaWNzOicsIGVycm9yLm1lc3NhZ2UpO1xuICAgICAgcmV0dXJuIHsgY291bnQ6IC0xLCBicmVha2Rvd246IHt9IH07XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENvbGxlY3QgY29tcHJlaGVuc2l2ZSBidWlsZCBwZXJmb3JtYW5jZSBtZXRyaWNzXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGNvbGxlY3RCdWlsZE1ldHJpY3MoKTogUHJvbWlzZTxCdWlsZE1ldHJpY3M+IHtcbiAgICBjb25zdCBzdGFydFRpbWUgPSBEYXRlLm5vdygpO1xuICAgIGxldCBidWlsZFRpbWUgPSAtMTtcbiAgICBsZXQgYnVuZGxlU2l6ZSA9IDA7XG4gICAgbGV0IGNvbXBpbGF0aW9uU3BlZWQgPSAwO1xuXG4gICAgdHJ5IHtcbiAgICAgIC8vIE1lYXN1cmUgYnVpbGQgdGltZVxuICAgICAgY29uc3QgYnVpbGRTdGFydCA9IERhdGUubm93KCk7XG4gICAgICBleGVjU3luYygneWFybiBidWlsZCcsIHtcbiAgICAgICAgZW5jb2Rpbmc6ICd1dGY4JyxcbiAgICAgICAgc3RkaW86ICdwaXBlJ1xuICAgICAgfSk7XG4gICAgICBidWlsZFRpbWUgPSAoRGF0ZS5ub3coKSAtIGJ1aWxkU3RhcnQpIC8gMTAwMDtcblxuICAgICAgLy8gQ2FsY3VsYXRlIGNvbXBpbGF0aW9uIHNwZWVkIChyb3VnaCBlc3RpbWF0ZSlcbiAgICAgIGNvbnN0IHNvdXJjZUZpbGVzID0gdGhpcy5jb3VudFNvdXJjZUZpbGVzKCk7XG4gICAgICBjb21waWxhdGlvblNwZWVkID0gc291cmNlRmlsZXMgLyBidWlsZFRpbWU7XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS53YXJuKCdCdWlsZCBmYWlsZWQgZHVyaW5nIG1ldHJpY3MgY29sbGVjdGlvbjonLCBlcnJvci5tZXNzYWdlKTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgLy8gR2V0IGJ1bmRsZSBzaXplXG4gICAgICBidW5kbGVTaXplID0gYXdhaXQgdGhpcy5nZXRCdW5kbGVTaXplKCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUud2FybignQ291bGQgbm90IG1lYXN1cmUgYnVuZGxlIHNpemU6JywgZXJyb3IubWVzc2FnZSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIGJ1aWxkVGltZSxcbiAgICAgIGJ1bmRsZVNpemUsXG4gICAgICBjYWNoZUhpdFJhdGU6IGF3YWl0IHRoaXMuZXN0aW1hdGVDYWNoZUhpdFJhdGUoKSxcbiAgICAgIG1lbW9yeVVzYWdlOiB0aGlzLmdldE1lbW9yeVVzYWdlKCksXG4gICAgICBjcHVVc2FnZTogYXdhaXQgdGhpcy5nZXRDcHVVc2FnZSgpLFxuICAgICAgZGlza1VzYWdlOiBhd2FpdCB0aGlzLmdldERpc2tVc2FnZSgpLFxuICAgICAgY29tcGlsYXRpb25TcGVlZFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogQ29sbGVjdCBzeXN0ZW0gcmVzb3VyY2UgbWV0cmljc1xuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBjb2xsZWN0UmVzb3VyY2VNZXRyaWNzKCk6IFByb21pc2U8UmVzb3VyY2VNZXRyaWNzPiB7XG4gICAgY29uc3Qgbm9kZU1lbW9yeVVzYWdlID0gcHJvY2Vzcy5tZW1vcnlVc2FnZSgpO1xuICAgIFxuICAgIHJldHVybiB7XG4gICAgICBub2RlTWVtb3J5VXNhZ2UsXG4gICAgICBzeXN0ZW1NZW1vcnk6IGF3YWl0IHRoaXMuZ2V0U3lzdGVtTWVtb3J5KCksXG4gICAgICBkaXNrU3BhY2U6IGF3YWl0IHRoaXMuZ2V0RGlza1NwYWNlKClcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIENhbGN1bGF0ZSB0cmVuZCBkYXRhIGJhc2VkIG9uIGhpc3RvcmljYWwgc25hcHNob3RzXG4gICAqL1xuICBwcml2YXRlIGNhbGN1bGF0ZVRyZW5kRGF0YSgpOiBUcmVuZERhdGEge1xuICAgIGlmICh0aGlzLnNuYXBzaG90cy5sZW5ndGggPCAyKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBlcnJvclJlZHVjdGlvblJhdGU6IDAsXG4gICAgICAgIHdhcm5pbmdSZWR1Y3Rpb25SYXRlOiAwLFxuICAgICAgICBidWlsZFRpbWVJbXByb3ZlbWVudDogMCxcbiAgICAgICAgc3lzdGVtR3Jvd3RoUmF0ZTogMFxuICAgICAgfTtcbiAgICB9XG5cbiAgICBjb25zdCByZWNlbnQgPSB0aGlzLnNuYXBzaG90cy5zbGljZSgtMTApOyAvLyBMYXN0IDEwIHNuYXBzaG90c1xuICAgIGNvbnN0IHRpbWVTcGFuSG91cnMgPSAocmVjZW50W3JlY2VudC5sZW5ndGggLSAxXS50aW1lc3RhbXAuZ2V0VGltZSgpIC0gcmVjZW50WzBdLnRpbWVzdGFtcC5nZXRUaW1lKCkpIC8gKDEwMDAgKiA2MCAqIDYwKTtcblxuICAgIGlmICh0aW1lU3BhbkhvdXJzID09PSAwKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBlcnJvclJlZHVjdGlvblJhdGU6IDAsXG4gICAgICAgIHdhcm5pbmdSZWR1Y3Rpb25SYXRlOiAwLFxuICAgICAgICBidWlsZFRpbWVJbXByb3ZlbWVudDogMCxcbiAgICAgICAgc3lzdGVtR3Jvd3RoUmF0ZTogMFxuICAgICAgfTtcbiAgICB9XG5cbiAgICBjb25zdCBlcnJvclJlZHVjdGlvbiA9IHJlY2VudFswXS5tZXRyaWNzLnR5cGVTY3JpcHRFcnJvcnMuY3VycmVudCAtIHJlY2VudFtyZWNlbnQubGVuZ3RoIC0gMV0ubWV0cmljcy50eXBlU2NyaXB0RXJyb3JzLmN1cnJlbnQ7XG4gICAgY29uc3Qgd2FybmluZ1JlZHVjdGlvbiA9IHJlY2VudFswXS5tZXRyaWNzLmxpbnRpbmdXYXJuaW5ncy5jdXJyZW50IC0gcmVjZW50W3JlY2VudC5sZW5ndGggLSAxXS5tZXRyaWNzLmxpbnRpbmdXYXJuaW5ncy5jdXJyZW50O1xuICAgIGNvbnN0IGJ1aWxkVGltZUltcHJvdmVtZW50ID0gcmVjZW50WzBdLm1ldHJpY3MuYnVpbGRQZXJmb3JtYW5jZS5jdXJyZW50VGltZSAtIHJlY2VudFtyZWNlbnQubGVuZ3RoIC0gMV0ubWV0cmljcy5idWlsZFBlcmZvcm1hbmNlLmN1cnJlbnRUaW1lO1xuICAgIGNvbnN0IHN5c3RlbUdyb3d0aCA9IHJlY2VudFtyZWNlbnQubGVuZ3RoIC0gMV0ubWV0cmljcy5lbnRlcnByaXNlU3lzdGVtcy5jdXJyZW50IC0gcmVjZW50WzBdLm1ldHJpY3MuZW50ZXJwcmlzZVN5c3RlbXMuY3VycmVudDtcblxuICAgIHJldHVybiB7XG4gICAgICBlcnJvclJlZHVjdGlvblJhdGU6IGVycm9yUmVkdWN0aW9uIC8gdGltZVNwYW5Ib3VycyxcbiAgICAgIHdhcm5pbmdSZWR1Y3Rpb25SYXRlOiB3YXJuaW5nUmVkdWN0aW9uIC8gdGltZVNwYW5Ib3VycyxcbiAgICAgIGJ1aWxkVGltZUltcHJvdmVtZW50OiBidWlsZFRpbWVJbXByb3ZlbWVudCAvIHRpbWVTcGFuSG91cnMsXG4gICAgICBzeXN0ZW1Hcm93dGhSYXRlOiBzeXN0ZW1Hcm93dGggLyB0aW1lU3BhbkhvdXJzXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBIZWxwZXIgbWV0aG9kcyBmb3IgbWV0cmljcyBjb2xsZWN0aW9uXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGdldEVudGVycHJpc2VTeXN0ZW1Db3VudCgpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBvdXRwdXQgPSBleGVjU3luYygnZ3JlcCAtciBcIklOVEVMTElHRU5DRV9TWVNURU1cIiBzcmMvIHwgd2MgLWwnLCB7XG4gICAgICAgIGVuY29kaW5nOiAndXRmOCcsXG4gICAgICAgIHN0ZGlvOiAncGlwZSdcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHBhcnNlSW50KG91dHB1dC50cmltKCkpIHx8IDA7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZ2V0QnVuZGxlU2l6ZSgpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBidWlsZERpcnMgPSBbJy5uZXh0JywgJ2Rpc3QnLCAnYnVpbGQnXTtcbiAgICAgIGxldCB0b3RhbFNpemUgPSAwO1xuXG4gICAgICBmb3IgKGNvbnN0IGRpciBvZiBidWlsZERpcnMpIHtcbiAgICAgICAgaWYgKGZzLmV4aXN0c1N5bmMoZGlyKSkge1xuICAgICAgICAgIGNvbnN0IG91dHB1dCA9IGV4ZWNTeW5jKGBkdSAtc2sgJHtkaXJ9IHwgY3V0IC1mMWAsIHtcbiAgICAgICAgICAgIGVuY29kaW5nOiAndXRmOCcsXG4gICAgICAgICAgICBzdGRpbzogJ3BpcGUnXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgdG90YWxTaXplICs9IHBhcnNlSW50KG91dHB1dC50cmltKCkpIHx8IDA7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRvdGFsU2l6ZTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgcmV0dXJuIDA7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBlc3RpbWF0ZUNhY2hlSGl0UmF0ZSgpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgIC8vIFRoaXMgaXMgYSBzaW1wbGlmaWVkIGVzdGltYXRpb24gLSBpbiBhIHJlYWwgaW1wbGVtZW50YXRpb24sXG4gICAgLy8geW91J2QgaW50ZWdyYXRlIHdpdGggdGhlIGFjdHVhbCBidWlsZCBzeXN0ZW0ncyBjYWNoZSBtZXRyaWNzXG4gICAgcmV0dXJuIDAuODsgLy8gODAlIGRlZmF1bHQgZXN0aW1hdGVcbiAgfVxuXG4gIHByaXZhdGUgZ2V0TWVtb3J5VXNhZ2UoKTogbnVtYmVyIHtcbiAgICBjb25zdCBtZW1Vc2FnZSA9IHByb2Nlc3MubWVtb3J5VXNhZ2UoKTtcbiAgICByZXR1cm4gTWF0aC5yb3VuZChtZW1Vc2FnZS5oZWFwVXNlZCAvIDEwMjQgLyAxMDI0KTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZ2V0Q3B1VXNhZ2UoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3Qgb3V0cHV0ID0gZXhlY1N5bmMoJ3BzIC1vICVjcHUgLXAgJCQgfCB0YWlsIC0xJywge1xuICAgICAgICBlbmNvZGluZzogJ3V0ZjgnLFxuICAgICAgICBzdGRpbzogJ3BpcGUnXG4gICAgICB9KTtcbiAgICAgIHJldHVybiBwYXJzZUZsb2F0KG91dHB1dC50cmltKCkpIHx8IDA7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZ2V0RGlza1VzYWdlKCk6IFByb21pc2U8bnVtYmVyPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IG91dHB1dCA9IGV4ZWNTeW5jKCdkdSAtc2ggLiB8IGN1dCAtZjEnLCB7XG4gICAgICAgIGVuY29kaW5nOiAndXRmOCcsXG4gICAgICAgIHN0ZGlvOiAncGlwZSdcbiAgICAgIH0pO1xuICAgICAgLy8gQ29udmVydCB0byBNQiAocm91Z2ggZXN0aW1hdGlvbilcbiAgICAgIGNvbnN0IHNpemVTdHIgPSBvdXRwdXQudHJpbSgpO1xuICAgICAgaWYgKHNpemVTdHIuaW5jbHVkZXMoJ0cnKSkge1xuICAgICAgICByZXR1cm4gcGFyc2VGbG9hdChzaXplU3RyKSAqIDEwMjQ7XG4gICAgICB9IGVsc2UgaWYgKHNpemVTdHIuaW5jbHVkZXMoJ00nKSkge1xuICAgICAgICByZXR1cm4gcGFyc2VGbG9hdChzaXplU3RyKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiAwO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICByZXR1cm4gMDtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNvdW50U291cmNlRmlsZXMoKTogbnVtYmVyIHtcbiAgICB0cnkge1xuICAgICAgY29uc3Qgb3V0cHV0ID0gZXhlY1N5bmMoJ2ZpbmQgc3JjIC1uYW1lIFwiKi50c1wiIC1vIC1uYW1lIFwiKi50c3hcIiB8IHdjIC1sJywge1xuICAgICAgICBlbmNvZGluZzogJ3V0ZjgnLFxuICAgICAgICBzdGRpbzogJ3BpcGUnXG4gICAgICB9KTtcbiAgICAgIHJldHVybiBwYXJzZUludChvdXRwdXQudHJpbSgpKSB8fCAwO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICByZXR1cm4gMDtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGdldFN5c3RlbU1lbW9yeSgpOiBQcm9taXNlPFJlc291cmNlTWV0cmljc1snc3lzdGVtTWVtb3J5J10+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3Qgb3V0cHV0ID0gZXhlY1N5bmMoJ2ZyZWUgLW0gfCBncmVwIE1lbScsIHtcbiAgICAgICAgZW5jb2Rpbmc6ICd1dGY4JyxcbiAgICAgICAgc3RkaW86ICdwaXBlJ1xuICAgICAgfSk7XG4gICAgICBcbiAgICAgIGNvbnN0IG1hdGNoID0gb3V0cHV0Lm1hdGNoKC9NZW06XFxzKyhcXGQrKVxccysoXFxkKylcXHMrKFxcZCspLyk7XG4gICAgICBpZiAobWF0Y2gpIHtcbiAgICAgICAgY29uc3QgdG90YWwgPSBwYXJzZUludChtYXRjaFsxXSk7XG4gICAgICAgIGNvbnN0IHVzZWQgPSBwYXJzZUludChtYXRjaFsyXSk7XG4gICAgICAgIGNvbnN0IGZyZWUgPSBwYXJzZUludChtYXRjaFszXSk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgdG90YWwsXG4gICAgICAgICAgdXNlZCxcbiAgICAgICAgICBmcmVlLFxuICAgICAgICAgIHBlcmNlbnRhZ2U6IE1hdGgucm91bmQoKHVzZWQgLyB0b3RhbCkgKiAxMDApXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIC8vIEZhbGxiYWNrIGZvciBub24tTGludXggc3lzdGVtc1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICB0b3RhbDogMCxcbiAgICAgIHVzZWQ6IDAsXG4gICAgICBmcmVlOiAwLFxuICAgICAgcGVyY2VudGFnZTogMFxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGdldERpc2tTcGFjZSgpOiBQcm9taXNlPFJlc291cmNlTWV0cmljc1snZGlza1NwYWNlJ10+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3Qgb3V0cHV0ID0gZXhlY1N5bmMoJ2RmIC1oIC4gfCB0YWlsIC0xJywge1xuICAgICAgICBlbmNvZGluZzogJ3V0ZjgnLFxuICAgICAgICBzdGRpbzogJ3BpcGUnXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgY29uc3QgcGFydHMgPSBvdXRwdXQudHJpbSgpLnNwbGl0KC9cXHMrLyk7XG4gICAgICBpZiAocGFydHMubGVuZ3RoID49IDQpIHtcbiAgICAgICAgY29uc3QgdG90YWwgPSB0aGlzLnBhcnNlU2l6ZShwYXJ0c1sxXSk7XG4gICAgICAgIGNvbnN0IHVzZWQgPSB0aGlzLnBhcnNlU2l6ZShwYXJ0c1syXSk7XG4gICAgICAgIGNvbnN0IGZyZWUgPSB0aGlzLnBhcnNlU2l6ZShwYXJ0c1szXSk7XG4gICAgICAgIFxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHRvdGFsLFxuICAgICAgICAgIHVzZWQsXG4gICAgICAgICAgZnJlZSxcbiAgICAgICAgICBwZXJjZW50YWdlOiBNYXRoLnJvdW5kKCh1c2VkIC8gdG90YWwpICogMTAwKVxuICAgICAgICB9O1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAvLyBIYW5kbGUgZXJyb3JcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgdG90YWw6IDAsXG4gICAgICB1c2VkOiAwLFxuICAgICAgZnJlZTogMCxcbiAgICAgIHBlcmNlbnRhZ2U6IDBcbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBwYXJzZVNpemUoc2l6ZVN0cjogc3RyaW5nKTogbnVtYmVyIHtcbiAgICBjb25zdCBudW0gPSBwYXJzZUZsb2F0KHNpemVTdHIpO1xuICAgIGlmIChzaXplU3RyLmluY2x1ZGVzKCdHJykpIHJldHVybiBudW0gKiAxMDI0O1xuICAgIGlmIChzaXplU3RyLmluY2x1ZGVzKCdNJykpIHJldHVybiBudW07XG4gICAgaWYgKHNpemVTdHIuaW5jbHVkZXMoJ0snKSkgcmV0dXJuIG51bSAvIDEwMjQ7XG4gICAgcmV0dXJuIG51bTtcbiAgfVxuXG4gIC8qKlxuICAgKiBFeHBvcnQgbWV0aG9kcyBmb3IgZXh0ZXJuYWwgYWNjZXNzXG4gICAqL1xuICBnZXRTbmFwc2hvdHMoKTogTWV0cmljc1NuYXBzaG90W10ge1xuICAgIHJldHVybiBbLi4udGhpcy5zbmFwc2hvdHNdO1xuICB9XG5cbiAgZ2V0TGF0ZXN0U25hcHNob3QoKTogTWV0cmljc1NuYXBzaG90IHwgbnVsbCB7XG4gICAgcmV0dXJuIHRoaXMuc25hcHNob3RzLmxlbmd0aCA+IDAgPyB0aGlzLnNuYXBzaG90c1t0aGlzLnNuYXBzaG90cy5sZW5ndGggLSAxXSA6IG51bGw7XG4gIH1cblxuICBhc3luYyBleHBvcnRTbmFwc2hvdHMoZmlsZVBhdGg6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IGV4cG9ydERhdGEgPSB7XG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgIHRvdGFsU25hcHNob3RzOiB0aGlzLnNuYXBzaG90cy5sZW5ndGgsXG4gICAgICBzbmFwc2hvdHM6IHRoaXMuc25hcHNob3RzLFxuICAgICAgc3VtbWFyeToge1xuICAgICAgICBjb2xsZWN0aW9uUGVyaW9kOiB0aGlzLnNuYXBzaG90cy5sZW5ndGggPiAwID8ge1xuICAgICAgICAgIHN0YXJ0OiB0aGlzLnNuYXBzaG90c1swXS50aW1lc3RhbXAsXG4gICAgICAgICAgZW5kOiB0aGlzLnNuYXBzaG90c1t0aGlzLnNuYXBzaG90cy5sZW5ndGggLSAxXS50aW1lc3RhbXBcbiAgICAgICAgfSA6IG51bGwsXG4gICAgICAgIHRyZW5kczogdGhpcy5jYWxjdWxhdGVUcmVuZERhdGEoKVxuICAgICAgfVxuICAgIH07XG5cbiAgICBmcy53cml0ZUZpbGVTeW5jKGZpbGVQYXRoLCBKU09OLnN0cmluZ2lmeShleHBvcnREYXRhLCBudWxsLCAyKSk7XG4gICAgY29uc29sZS5sb2coYPCfk4ogTWV0cmljcyBzbmFwc2hvdHMgZXhwb3J0ZWQgdG86ICR7ZmlsZVBhdGh9YCk7XG4gIH1cblxuICBjbGVhclNuYXBzaG90cygpOiB2b2lkIHtcbiAgICB0aGlzLnNuYXBzaG90cyA9IFtdO1xuICAgIGNvbnNvbGUubG9nKCfwn5OKIE1ldHJpY3Mgc25hcHNob3RzIGNsZWFyZWQnKTtcbiAgfVxufSJdLCJ2ZXJzaW9uIjozfQ==