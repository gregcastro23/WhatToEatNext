38961e4c322472b50064b60e5a58fc37
"use strict";
/**
 * Metrics Integration for Unintentional Any Elimination
 * Integrates unintentional any metrics with existing campaign reporting and dashboard systems
 */
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.UnintentionalAnyCampaignScheduler = exports.UnintentionalAnyProgressTracker = void 0;
const child_process_1 = require("child_process");
const fs = __importStar(require("fs"));
const campaign_1 = require("../../../types/campaign");
const ProgressTracker_1 = require("../ProgressTracker");
const AutoDocumentationGenerator_1 = require("./AutoDocumentationGenerator");
const DocumentationQualityAssurance_1 = require("./DocumentationQualityAssurance");
/**
 * Enhanced Progress Tracker with Unintentional Any Metrics
 */
class UnintentionalAnyProgressTracker extends ProgressTracker_1.ProgressTracker {
    documentationGenerator;
    qualityAssurance;
    baselineMetrics;
    metricsHistory = [];
    constructor() {
        super();
        this.documentationGenerator = new AutoDocumentationGenerator_1.AutoDocumentationGenerator();
        this.qualityAssurance = new DocumentationQualityAssurance_1.DocumentationQualityAssurance({
            sourceDirectories: ['src'],
            excludePatterns: [
                'node_modules/**',
                'dist/**',
                'build/**',
                '**/*.test.ts',
                '**/*.test.tsx',
                '**/*.spec.ts',
                '**/*.spec.tsx'
            ]
        });
    }
    /**
     * Get comprehensive unintentional any metrics
     */
    async getUnintentionalAnyMetrics() {
        try {
            // Get explicit-any warning count from linting
            const explicitAnyCount = await this.getExplicitAnyWarningCount();
            // Get documentation report
            const documentationReport = await this.qualityAssurance.performQualityAssurance();
            // Calculate metrics
            const intentionalAnyTypes = documentationReport.totalIntentionalAnyTypes;
            const unintentionalAnyTypes = Math.max(0, explicitAnyCount - intentionalAnyTypes);
            const documentedAnyTypes = Math.round(intentionalAnyTypes * documentationReport.documentationCoverage / 100);
            // Calculate reduction from baseline
            let reductionFromBaseline = 0;
            if (this.baselineMetrics) {
                const baselineTotal = this.baselineMetrics.totalAnyTypes;
                if (baselineTotal > 0) {
                    reductionFromBaseline = ((baselineTotal - explicitAnyCount) / baselineTotal) * 100;
                }
            }
            const metrics = {
                totalAnyTypes: explicitAnyCount,
                intentionalAnyTypes,
                unintentionalAnyTypes,
                documentedAnyTypes,
                documentationCoverage: documentationReport.documentationCoverage,
                reductionFromBaseline,
                targetReduction: 15 // Default target, can be configured
            };
            // Store in history
            this.metricsHistory.push(metrics);
            if (this.metricsHistory.length > 100) {
                this.metricsHistory = this.metricsHistory.slice(-50);
            }
            return metrics;
        }
        catch (error) {
            console.warn(`Warning: Could not get unintentional any metrics: ${error instanceof Error ? error.message : String(error)}`);
            return {
                totalAnyTypes: 0,
                intentionalAnyTypes: 0,
                unintentionalAnyTypes: 0,
                documentedAnyTypes: 0,
                documentationCoverage: 0,
                reductionFromBaseline: 0,
                targetReduction: 15
            };
        }
    }
    /**
     * Get enhanced progress metrics that include unintentional any data
     */
    async getUnintentionalAnyProgressMetrics() {
        const baseMetrics = await this.getProgressMetrics();
        const unintentionalAnyMetrics = await this.getUnintentionalAnyMetrics();
        return {
            ...baseMetrics,
            unintentionalAnyMetrics
        };
    }
    /**
     * Set baseline metrics for comparison
     */
    async setBaselineMetrics() {
        this.baselineMetrics = await this.getUnintentionalAnyMetrics();
        console.log(`ðŸ“Š Baseline metrics set:`, {
            totalAnyTypes: this.baselineMetrics.totalAnyTypes,
            intentionalAnyTypes: this.baselineMetrics.intentionalAnyTypes,
            unintentionalAnyTypes: this.baselineMetrics.unintentionalAnyTypes,
            documentationCoverage: `${this.baselineMetrics.documentationCoverage.toFixed(1)}%`
        });
    }
    /**
     * Get explicit-any warning count from ESLint
     */
    async getExplicitAnyWarningCount() {
        try {
            const output = (0, child_process_1.execSync)('yarn lint 2>&1', {
                encoding: 'utf8',
                stdio: 'pipe'
            });
            // Count @typescript-eslint/no-explicit-any warnings
            const explicitAnyMatches = output.match(/@typescript-eslint\/no-explicit-any/g);
            return explicitAnyMatches ? explicitAnyMatches.length : 0;
        }
        catch (error) {
            // ESLint returns non-zero exit code when warnings/errors are found
            const output = error.stdout || error.message || '';
            const explicitAnyMatches = output.match(/@typescript-eslint\/no-explicit-any/g);
            return explicitAnyMatches ? explicitAnyMatches.length : 0;
        }
    }
    /**
     * Get detailed breakdown of explicit-any warnings by file
     */
    async getExplicitAnyBreakdownByFile() {
        try {
            const output = (0, child_process_1.execSync)('yarn lint 2>&1', {
                encoding: 'utf8',
                stdio: 'pipe'
            });
            const breakdown = {};
            const lines = output.split('\n');
            for (const line of lines) {
                if (line.includes('@typescript-eslint/no-explicit-any')) {
                    const fileMatch = line.match(/^([^:]+):/);
                    if (fileMatch) {
                        const filePath = fileMatch[1];
                        breakdown[filePath] = (breakdown[filePath] || 0) + 1;
                    }
                }
            }
            return breakdown;
        }
        catch (error) {
            const output = error.stdout || error.message || '';
            const breakdown = {};
            const lines = output.split('\n');
            for (const line of lines) {
                if (line.includes('@typescript-eslint/no-explicit-any')) {
                    const fileMatch = line.match(/^([^:]+):/);
                    if (fileMatch) {
                        const filePath = fileMatch[1];
                        breakdown[filePath] = (breakdown[filePath] || 0) + 1;
                    }
                }
            }
            return breakdown;
        }
    }
    /**
     * Generate comprehensive progress report with unintentional any metrics
     */
    async generateUnintentionalAnyProgressReport() {
        const baseReport = await this.generateProgressReport();
        const unintentionalAnyMetrics = await this.getUnintentionalAnyMetrics();
        const fileBreakdown = await this.getExplicitAnyBreakdownByFile();
        // Create unintentional any specific phase reports
        const unintentionalAnyPhases = [
            {
                phaseId: 'unintentional-any-analysis',
                phaseName: 'Unintentional Any Type Analysis',
                startTime: new Date(),
                status: campaign_1.PhaseStatus.COMPLETED,
                metrics: await this.getProgressMetrics(),
                achievements: [
                    `Analyzed ${unintentionalAnyMetrics.totalAnyTypes} any types`,
                    `Identified ${unintentionalAnyMetrics.intentionalAnyTypes} intentional any types`,
                    `Found ${unintentionalAnyMetrics.unintentionalAnyTypes} unintentional any types`
                ],
                issues: unintentionalAnyMetrics.unintentionalAnyTypes > 0 ?
                    [`${unintentionalAnyMetrics.unintentionalAnyTypes} unintentional any types need attention`] : [],
                recommendations: this.generateUnintentionalAnyRecommendations(unintentionalAnyMetrics)
            },
            {
                phaseId: 'unintentional-any-replacement',
                phaseName: 'Unintentional Any Type Replacement',
                startTime: new Date(),
                status: unintentionalAnyMetrics.reductionFromBaseline > 0 ? campaign_1.PhaseStatus.COMPLETED : campaign_1.PhaseStatus.NOT_STARTED,
                metrics: await this.getProgressMetrics(),
                achievements: unintentionalAnyMetrics.reductionFromBaseline > 0 ?
                    [`Achieved ${unintentionalAnyMetrics.reductionFromBaseline.toFixed(1)}% reduction`] : [],
                issues: unintentionalAnyMetrics.reductionFromBaseline < unintentionalAnyMetrics.targetReduction ?
                    [`Reduction ${unintentionalAnyMetrics.reductionFromBaseline.toFixed(1)}% below target ${unintentionalAnyMetrics.targetReduction}%`] : [],
                recommendations: this.generateReplacementRecommendations(unintentionalAnyMetrics)
            },
            {
                phaseId: 'intentional-any-documentation',
                phaseName: 'Intentional Any Type Documentation',
                startTime: new Date(),
                status: unintentionalAnyMetrics.documentationCoverage >= 80 ? campaign_1.PhaseStatus.COMPLETED : campaign_1.PhaseStatus.IN_PROGRESS,
                metrics: await this.getProgressMetrics(),
                achievements: unintentionalAnyMetrics.documentationCoverage >= 80 ?
                    [`Documentation coverage: ${unintentionalAnyMetrics.documentationCoverage.toFixed(1)}%`] : [],
                issues: unintentionalAnyMetrics.documentationCoverage < 80 ?
                    [`Documentation coverage ${unintentionalAnyMetrics.documentationCoverage.toFixed(1)}% below 80%`] : [],
                recommendations: this.generateDocumentationRecommendations(unintentionalAnyMetrics)
            }
        ];
        return {
            ...baseReport,
            unintentionalAnyMetrics,
            unintentionalAnyPhases,
            fileBreakdown,
            metricsHistory: this.getUnintentionalAnyMetricsHistory(),
            improvement: this.calculateUnintentionalAnyImprovement()
        };
    }
    /**
     * Export unintentional any metrics to JSON for external analysis
     */
    async exportUnintentionalAnyMetrics(filePath) {
        try {
            const report = await this.generateUnintentionalAnyProgressReport();
            const exportData = {
                timestamp: new Date().toISOString(),
                report,
                history: this.metricsHistory,
                baseline: this.baselineMetrics,
                fileBreakdown: await this.getExplicitAnyBreakdownByFile()
            };
            fs.writeFileSync(filePath, JSON.stringify(exportData, null, 2));
            console.log(`ðŸ“Š Unintentional Any metrics exported to: ${filePath}`);
        }
        catch (error) {
            throw new Error(`Failed to export unintentional any metrics: ${error instanceof Error ? error.message : String(error)}`);
        }
    }
    /**
     * Create dashboard-compatible metrics for real-time monitoring
     */
    async getDashboardMetrics() {
        const metrics = await this.getUnintentionalAnyMetrics();
        const fileBreakdown = await this.getExplicitAnyBreakdownByFile();
        // Get top files with most any types
        const topFiles = Object.entries(fileBreakdown)
            .sort(([, a], [, b]) => b - a)
            .slice(0, 10)
            .map(([file, count]) => ({ file, count }));
        // Calculate trend
        const trend = this.calculateMetricsTrend();
        return {
            current: metrics,
            trend,
            topFiles,
            alerts: this.generateAlerts(metrics),
            recommendations: this.generateUnintentionalAnyRecommendations(metrics),
            lastUpdated: new Date()
        };
    }
    /**
     * Validate milestone achievement for unintentional any elimination
     */
    async validateUnintentionalAnyMilestone(milestone) {
        const metrics = await this.getUnintentionalAnyMetrics();
        switch (milestone) {
            case 'baseline-established':
                return this.baselineMetrics !== undefined;
            case 'analysis-complete':
                return metrics.totalAnyTypes > 0 && (metrics.intentionalAnyTypes + metrics.unintentionalAnyTypes) > 0;
            case 'target-reduction-achieved':
                return metrics.reductionFromBaseline >= metrics.targetReduction;
            case 'documentation-complete':
                return metrics.documentationCoverage >= 80;
            case 'zero-unintentional-any':
                return metrics.unintentionalAnyTypes === 0;
            default:
                console.warn(`Unknown unintentional any milestone: ${milestone}`);
                return false;
        }
    }
    /**
     * Get metrics history for trend analysis
     */
    getUnintentionalAnyMetricsHistory() {
        return [...this.metricsHistory];
    }
    /**
     * Calculate improvement over time
     */
    calculateUnintentionalAnyImprovement() {
        if (this.metricsHistory.length < 2) {
            return {
                totalAnyTypesReduced: 0,
                unintentionalAnyTypesReduced: 0,
                documentationImproved: 0,
                reductionRate: 0
            };
        }
        const first = this.metricsHistory[0];
        const latest = this.metricsHistory[this.metricsHistory.length - 1];
        return {
            totalAnyTypesReduced: first.totalAnyTypes - latest.totalAnyTypes,
            unintentionalAnyTypesReduced: first.unintentionalAnyTypes - latest.unintentionalAnyTypes,
            documentationImproved: latest.documentationCoverage - first.documentationCoverage,
            reductionRate: latest.reductionFromBaseline
        };
    }
    /**
     * Calculate metrics trend
     */
    calculateMetricsTrend() {
        if (this.metricsHistory.length < 3) {
            return 'stable';
        }
        const recent = this.metricsHistory.slice(-3);
        const totalAnyTrend = recent[2].totalAnyTypes - recent[0].totalAnyTypes;
        const unintentionalTrend = recent[2].unintentionalAnyTypes - recent[0].unintentionalAnyTypes;
        if (totalAnyTrend < -2 || unintentionalTrend < -2) {
            return 'improving';
        }
        else if (totalAnyTrend > 2 || unintentionalTrend > 2) {
            return 'declining';
        }
        else {
            return 'stable';
        }
    }
    /**
     * Generate alerts based on metrics
     */
    generateAlerts(metrics) {
        const alerts = [];
        if (metrics.unintentionalAnyTypes > 100) {
            alerts.push({
                type: 'high-unintentional-any-count',
                severity: 'warning',
                message: `High number of unintentional any types: ${metrics.unintentionalAnyTypes}`,
                recommendation: 'Consider running the unintentional any elimination campaign'
            });
        }
        if (metrics.documentationCoverage < 50) {
            alerts.push({
                type: 'low-documentation-coverage',
                severity: 'error',
                message: `Documentation coverage critically low: ${metrics.documentationCoverage.toFixed(1)}%`,
                recommendation: 'Add documentation to intentional any types'
            });
        }
        if (metrics.reductionFromBaseline < 0) {
            alerts.push({
                type: 'regression-detected',
                severity: 'error',
                message: 'Regression detected: any types have increased from baseline',
                recommendation: 'Review recent changes and consider rollback'
            });
        }
        return alerts;
    }
    /**
     * Generate recommendations based on metrics
     */
    generateUnintentionalAnyRecommendations(metrics) {
        const recommendations = [];
        if (metrics.unintentionalAnyTypes > 50) {
            recommendations.push('Run unintentional any elimination campaign to reduce unintentional any types');
        }
        if (metrics.documentationCoverage < 80) {
            recommendations.push('Add documentation to intentional any types to improve coverage');
        }
        if (metrics.reductionFromBaseline < metrics.targetReduction) {
            recommendations.push(`Increase efforts to reach target reduction of ${metrics.targetReduction}%`);
        }
        if (metrics.totalAnyTypes === 0) {
            recommendations.push('Excellent! Zero any types achieved. Consider setting up monitoring to prevent regression');
        }
        return recommendations;
    }
    /**
     * Generate replacement-specific recommendations
     */
    generateReplacementRecommendations(metrics) {
        const recommendations = [];
        if (metrics.unintentionalAnyTypes > 0) {
            recommendations.push('Continue with progressive replacement of unintentional any types');
        }
        if (metrics.reductionFromBaseline < 10) {
            recommendations.push('Consider increasing confidence threshold for more aggressive replacement');
        }
        if (metrics.reductionFromBaseline >= metrics.targetReduction) {
            recommendations.push('Target reduction achieved! Consider setting a higher target');
        }
        return recommendations;
    }
    /**
     * Generate documentation-specific recommendations
     */
    generateDocumentationRecommendations(metrics) {
        const recommendations = [];
        if (metrics.documentationCoverage < 50) {
            recommendations.push('Critical: Add documentation to intentional any types');
        }
        else if (metrics.documentationCoverage < 80) {
            recommendations.push('Improve documentation coverage to reach 80% target');
        }
        if (metrics.intentionalAnyTypes > 0 && metrics.documentedAnyTypes === 0) {
            recommendations.push('Start documenting intentional any types with explanatory comments');
        }
        return recommendations;
    }
    /**
     * Reset metrics history (for testing or fresh start)
     */
    resetUnintentionalAnyMetricsHistory() {
        this.metricsHistory = [];
        this.baselineMetrics = undefined;
        console.log('ðŸ“Š Unintentional Any metrics history reset');
    }
}
exports.UnintentionalAnyProgressTracker = UnintentionalAnyProgressTracker;
/**
 * Campaign Scheduling Integration
 * Provides compatibility with existing campaign scheduling systems
 */
class UnintentionalAnyCampaignScheduler {
    progressTracker;
    constructor() {
        this.progressTracker = new UnintentionalAnyProgressTracker();
    }
    /**
     * Check if unintentional any elimination campaign should be triggered
     */
    async shouldTriggerCampaign() {
        const metrics = await this.progressTracker.getUnintentionalAnyMetrics();
        // High priority triggers
        if (metrics.unintentionalAnyTypes > 200) {
            return {
                shouldTrigger: true,
                reason: `High number of unintentional any types: ${metrics.unintentionalAnyTypes}`,
                priority: 'high'
            };
        }
        if (metrics.reductionFromBaseline < -5) {
            return {
                shouldTrigger: true,
                reason: 'Regression detected: any types have increased significantly',
                priority: 'high'
            };
        }
        // Medium priority triggers
        if (metrics.unintentionalAnyTypes > 50) {
            return {
                shouldTrigger: true,
                reason: `Moderate number of unintentional any types: ${metrics.unintentionalAnyTypes}`,
                priority: 'medium'
            };
        }
        if (metrics.documentationCoverage < 50) {
            return {
                shouldTrigger: true,
                reason: `Low documentation coverage: ${metrics.documentationCoverage.toFixed(1)}%`,
                priority: 'medium'
            };
        }
        // Low priority triggers
        if (metrics.unintentionalAnyTypes > 10) {
            return {
                shouldTrigger: true,
                reason: `Some unintentional any types present: ${metrics.unintentionalAnyTypes}`,
                priority: 'low'
            };
        }
        return {
            shouldTrigger: false,
            reason: 'No significant unintentional any issues detected',
            priority: 'low'
        };
    }
    /**
     * Resolve conflicts with other campaign priorities
     */
    resolveCampaignConflicts(activeCampaigns, proposedCampaign) {
        const conflictingCampaigns = activeCampaigns.filter(campaign => campaign.includes('typescript') ||
            campaign.includes('linting') ||
            campaign.includes('explicit-any'));
        if (conflictingCampaigns.length === 0) {
            return {
                canProceed: true,
                conflictingCampaigns: [],
                resolution: 'No conflicts detected, can proceed'
            };
        }
        // Check if conflicts can be resolved
        const canResolve = conflictingCampaigns.every(campaign => !campaign.includes('critical') && !campaign.includes('emergency'));
        if (canResolve) {
            return {
                canProceed: true,
                conflictingCampaigns,
                resolution: 'Conflicts can be resolved by coordinating batch processing'
            };
        }
        return {
            canProceed: false,
            conflictingCampaigns,
            resolution: 'Wait for critical campaigns to complete before proceeding'
        };
    }
    /**
     * Get recommended execution time based on system load and other campaigns
     */
    getRecommendedExecutionTime(activeCampaigns, systemLoad) {
        const now = new Date();
        let recommendedTime = new Date(now);
        let reason = '';
        let estimatedDuration = 30; // Default 30 minutes
        if (systemLoad === 'high' || activeCampaigns.length > 2) {
            // Schedule for later when system load is lower
            recommendedTime.setHours(recommendedTime.getHours() + 2);
            reason = 'Scheduled for later due to high system load or active campaigns';
            estimatedDuration = 45;
        }
        else if (systemLoad === 'medium' || activeCampaigns.length > 0) {
            // Schedule for near future
            recommendedTime.setMinutes(recommendedTime.getMinutes() + 30);
            reason = 'Scheduled for near future due to moderate system load';
            estimatedDuration = 35;
        }
        else {
            // Can execute immediately
            reason = 'Can execute immediately - low system load and no conflicts';
            estimatedDuration = 25;
        }
        return {
            recommendedTime,
            reason,
            estimatedDuration
        };
    }
}
exports.UnintentionalAnyCampaignScheduler = UnintentionalAnyCampaignScheduler;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L2JhY2t1cHMvZmlyc3Qtd2F2ZS0yMDI1LTA4LTExVDA1LTE5LTI2LTgxM1ovc3JjL3NlcnZpY2VzL2NhbXBhaWduL3VuaW50ZW50aW9uYWwtYW55LWVsaW1pbmF0aW9uL01ldHJpY3NJbnRlZ3JhdGlvbi50cyIsIm1hcHBpbmdzIjoiO0FBQUE7OztHQUdHOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUVILGlEQUF5QztBQUN6Qyx1Q0FBeUI7QUFFekIsc0RBSWlDO0FBRWpDLHdEQUFxRDtBQU1yRCw2RUFBMEU7QUFDMUUsbUZBQWdGO0FBRWhGOztHQUVHO0FBQ0gsTUFBYSwrQkFBZ0MsU0FBUSxpQ0FBZTtJQUMxRCxzQkFBc0IsQ0FBNkI7SUFDbkQsZ0JBQWdCLENBQWdDO0lBQ2hELGVBQWUsQ0FBMkI7SUFDMUMsY0FBYyxHQUE4QixFQUFFLENBQUM7SUFFdkQ7UUFDRSxLQUFLLEVBQUUsQ0FBQztRQUNSLElBQUksQ0FBQyxzQkFBc0IsR0FBRyxJQUFJLHVEQUEwQixFQUFFLENBQUM7UUFDL0QsSUFBSSxDQUFDLGdCQUFnQixHQUFHLElBQUksNkRBQTZCLENBQUM7WUFDeEQsaUJBQWlCLEVBQUUsQ0FBQyxLQUFLLENBQUM7WUFDMUIsZUFBZSxFQUFFO2dCQUNmLGlCQUFpQjtnQkFDakIsU0FBUztnQkFDVCxVQUFVO2dCQUNWLGNBQWM7Z0JBQ2QsZUFBZTtnQkFDZixjQUFjO2dCQUNkLGVBQWU7YUFDaEI7U0FDRixDQUFDLENBQUM7SUFDTCxDQUFDO0lBRUQ7O09BRUc7SUFDSCxLQUFLLENBQUMsMEJBQTBCO1FBQzlCLElBQUk7WUFDRiw4Q0FBOEM7WUFDOUMsTUFBTSxnQkFBZ0IsR0FBRyxNQUFNLElBQUksQ0FBQywwQkFBMEIsRUFBRSxDQUFDO1lBRWpFLDJCQUEyQjtZQUMzQixNQUFNLG1CQUFtQixHQUFHLE1BQU0sSUFBSSxDQUFDLGdCQUFnQixDQUFDLHVCQUF1QixFQUFFLENBQUM7WUFFbEYsb0JBQW9C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cnMvR3JlZ0Nhc3Ryby9EZXNrdG9wL1doYXRUb0VhdE5leHQvYmFja3Vwcy9maXJzdC13YXZlLTIwMjUtMDgtMTFUMDUtMTktMjYtODEzWi9zcmMvc2VydmljZXMvY2FtcGFpZ24vdW5pbnRlbnRpb25hbC1hbnktZWxpbWluYXRpb24vTWV0cmljc0ludGVncmF0aW9uLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogTWV0cmljcyBJbnRlZ3JhdGlvbiBmb3IgVW5pbnRlbnRpb25hbCBBbnkgRWxpbWluYXRpb25cbiAqIEludGVncmF0ZXMgdW5pbnRlbnRpb25hbCBhbnkgbWV0cmljcyB3aXRoIGV4aXN0aW5nIGNhbXBhaWduIHJlcG9ydGluZyBhbmQgZGFzaGJvYXJkIHN5c3RlbXNcbiAqL1xuXG5pbXBvcnQgeyBleGVjU3luYyB9IGZyb20gJ2NoaWxkX3Byb2Nlc3MnO1xuaW1wb3J0ICogYXMgZnMgZnJvbSAnZnMnO1xuXG5pbXBvcnQge1xuICAgIFBoYXNlUmVwb3J0LFxuICAgIFBoYXNlU3RhdHVzLFxuICAgIFByb2dyZXNzUmVwb3J0XG59IGZyb20gJy4uLy4uLy4uL3R5cGVzL2NhbXBhaWduJztcblxuaW1wb3J0IHsgUHJvZ3Jlc3NUcmFja2VyIH0gZnJvbSAnLi4vUHJvZ3Jlc3NUcmFja2VyJztcbmltcG9ydCB7XG4gICAgVW5pbnRlbnRpb25hbEFueU1ldHJpY3MsXG4gICAgVW5pbnRlbnRpb25hbEFueVByb2dyZXNzTWV0cmljc1xufSBmcm9tICcuL3R5cGVzJztcblxuaW1wb3J0IHsgQXV0b0RvY3VtZW50YXRpb25HZW5lcmF0b3IgfSBmcm9tICcuL0F1dG9Eb2N1bWVudGF0aW9uR2VuZXJhdG9yJztcbmltcG9ydCB7IERvY3VtZW50YXRpb25RdWFsaXR5QXNzdXJhbmNlIH0gZnJvbSAnLi9Eb2N1bWVudGF0aW9uUXVhbGl0eUFzc3VyYW5jZSc7XG5cbi8qKlxuICogRW5oYW5jZWQgUHJvZ3Jlc3MgVHJhY2tlciB3aXRoIFVuaW50ZW50aW9uYWwgQW55IE1ldHJpY3NcbiAqL1xuZXhwb3J0IGNsYXNzIFVuaW50ZW50aW9uYWxBbnlQcm9ncmVzc1RyYWNrZXIgZXh0ZW5kcyBQcm9ncmVzc1RyYWNrZXIge1xuICBwcml2YXRlIGRvY3VtZW50YXRpb25HZW5lcmF0b3I6IEF1dG9Eb2N1bWVudGF0aW9uR2VuZXJhdG9yO1xuICBwcml2YXRlIHF1YWxpdHlBc3N1cmFuY2U6IERvY3VtZW50YXRpb25RdWFsaXR5QXNzdXJhbmNlO1xuICBwcml2YXRlIGJhc2VsaW5lTWV0cmljcz86IFVuaW50ZW50aW9uYWxBbnlNZXRyaWNzO1xuICBwcml2YXRlIG1ldHJpY3NIaXN0b3J5OiBVbmludGVudGlvbmFsQW55TWV0cmljc1tdID0gW107XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLmRvY3VtZW50YXRpb25HZW5lcmF0b3IgPSBuZXcgQXV0b0RvY3VtZW50YXRpb25HZW5lcmF0b3IoKTtcbiAgICB0aGlzLnF1YWxpdHlBc3N1cmFuY2UgPSBuZXcgRG9jdW1lbnRhdGlvblF1YWxpdHlBc3N1cmFuY2Uoe1xuICAgICAgc291cmNlRGlyZWN0b3JpZXM6IFsnc3JjJ10sXG4gICAgICBleGNsdWRlUGF0dGVybnM6IFtcbiAgICAgICAgJ25vZGVfbW9kdWxlcy8qKicsXG4gICAgICAgICdkaXN0LyoqJyxcbiAgICAgICAgJ2J1aWxkLyoqJyxcbiAgICAgICAgJyoqLyoudGVzdC50cycsXG4gICAgICAgICcqKi8qLnRlc3QudHN4JyxcbiAgICAgICAgJyoqLyouc3BlYy50cycsXG4gICAgICAgICcqKi8qLnNwZWMudHN4J1xuICAgICAgXVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBjb21wcmVoZW5zaXZlIHVuaW50ZW50aW9uYWwgYW55IG1ldHJpY3NcbiAgICovXG4gIGFzeW5jIGdldFVuaW50ZW50aW9uYWxBbnlNZXRyaWNzKCk6IFByb21pc2U8VW5pbnRlbnRpb25hbEFueU1ldHJpY3M+IHtcbiAgICB0cnkge1xuICAgICAgLy8gR2V0IGV4cGxpY2l0LWFueSB3YXJuaW5nIGNvdW50IGZyb20gbGludGluZ1xuICAgICAgY29uc3QgZXhwbGljaXRBbnlDb3VudCA9IGF3YWl0IHRoaXMuZ2V0RXhwbGljaXRBbnlXYXJuaW5nQ291bnQoKTtcblxuICAgICAgLy8gR2V0IGRvY3VtZW50YXRpb24gcmVwb3J0XG4gICAgICBjb25zdCBkb2N1bWVudGF0aW9uUmVwb3J0ID0gYXdhaXQgdGhpcy5xdWFsaXR5QXNzdXJhbmNlLnBlcmZvcm1RdWFsaXR5QXNzdXJhbmNlKCk7XG5cbiAgICAgIC8vIENhbGN1bGF0ZSBtZXRyaWNzXG4gICAgICBjb25zdCBpbnRlbnRpb25hbEFueVR5cGVzID0gZG9jdW1lbnRhdGlvblJlcG9ydC50b3RhbEludGVudGlvbmFsQW55VHlwZXM7XG4gICAgICBjb25zdCB1bmludGVudGlvbmFsQW55VHlwZXMgPSBNYXRoLm1heCgwLCBleHBsaWNpdEFueUNvdW50IC0gaW50ZW50aW9uYWxBbnlUeXBlcyk7XG4gICAgICBjb25zdCBkb2N1bWVudGVkQW55VHlwZXMgPSBNYXRoLnJvdW5kKGludGVudGlvbmFsQW55VHlwZXMgKiBkb2N1bWVudGF0aW9uUmVwb3J0LmRvY3VtZW50YXRpb25Db3ZlcmFnZSAvIDEwMCk7XG5cbiAgICAgIC8vIENhbGN1bGF0ZSByZWR1Y3Rpb24gZnJvbSBiYXNlbGluZVxuICAgICAgbGV0IHJlZHVjdGlvbkZyb21CYXNlbGluZSA9IDA7XG4gICAgICBpZiAodGhpcy5iYXNlbGluZU1ldHJpY3MpIHtcbiAgICAgICAgY29uc3QgYmFzZWxpbmVUb3RhbCA9IHRoaXMuYmFzZWxpbmVNZXRyaWNzLnRvdGFsQW55VHlwZXM7XG4gICAgICAgIGlmIChiYXNlbGluZVRvdGFsID4gMCkge1xuICAgICAgICAgIHJlZHVjdGlvbkZyb21CYXNlbGluZSA9ICgoYmFzZWxpbmVUb3RhbCAtIGV4cGxpY2l0QW55Q291bnQpIC8gYmFzZWxpbmVUb3RhbCkgKiAxMDA7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgY29uc3QgbWV0cmljczogVW5pbnRlbnRpb25hbEFueU1ldHJpY3MgPSB7XG4gICAgICAgIHRvdGFsQW55VHlwZXM6IGV4cGxpY2l0QW55Q291bnQsXG4gICAgICAgIGludGVudGlvbmFsQW55VHlwZXMsXG4gICAgICAgIHVuaW50ZW50aW9uYWxBbnlUeXBlcyxcbiAgICAgICAgZG9jdW1lbnRlZEFueVR5cGVzLFxuICAgICAgICBkb2N1bWVudGF0aW9uQ292ZXJhZ2U6IGRvY3VtZW50YXRpb25SZXBvcnQuZG9jdW1lbnRhdGlvbkNvdmVyYWdlLFxuICAgICAgICByZWR1Y3Rpb25Gcm9tQmFzZWxpbmUsXG4gICAgICAgIHRhcmdldFJlZHVjdGlvbjogMTUgLy8gRGVmYXVsdCB0YXJnZXQsIGNhbiBiZSBjb25maWd1cmVkXG4gICAgICB9O1xuXG4gICAgICAvLyBTdG9yZSBpbiBoaXN0b3J5XG4gICAgICB0aGlzLm1ldHJpY3NIaXN0b3J5LnB1c2gobWV0cmljcyk7XG4gICAgICBpZiAodGhpcy5tZXRyaWNzSGlzdG9yeS5sZW5ndGggPiAxMDApIHtcbiAgICAgICAgdGhpcy5tZXRyaWNzSGlzdG9yeSA9IHRoaXMubWV0cmljc0hpc3Rvcnkuc2xpY2UoLTUwKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIG1ldHJpY3M7XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS53YXJuKGBXYXJuaW5nOiBDb3VsZCBub3QgZ2V0IHVuaW50ZW50aW9uYWwgYW55IG1ldHJpY3M6ICR7ZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBTdHJpbmcoZXJyb3IpfWApO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICB0b3RhbEFueVR5cGVzOiAwLFxuICAgICAgICBpbnRlbnRpb25hbEFueVR5cGVzOiAwLFxuICAgICAgICB1bmludGVudGlvbmFsQW55VHlwZXM6IDAsXG4gICAgICAgIGRvY3VtZW50ZWRBbnlUeXBlczogMCxcbiAgICAgICAgZG9jdW1lbnRhdGlvbkNvdmVyYWdlOiAwLFxuICAgICAgICByZWR1Y3Rpb25Gcm9tQmFzZWxpbmU6IDAsXG4gICAgICAgIHRhcmdldFJlZHVjdGlvbjogMTVcbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldCBlbmhhbmNlZCBwcm9ncmVzcyBtZXRyaWNzIHRoYXQgaW5jbHVkZSB1bmludGVudGlvbmFsIGFueSBkYXRhXG4gICAqL1xuICBhc3luYyBnZXRVbmludGVudGlvbmFsQW55UHJvZ3Jlc3NNZXRyaWNzKCk6IFByb21pc2U8VW5pbnRlbnRpb25hbEFueVByb2dyZXNzTWV0cmljcz4ge1xuICAgIGNvbnN0IGJhc2VNZXRyaWNzID0gYXdhaXQgdGhpcy5nZXRQcm9ncmVzc01ldHJpY3MoKTtcbiAgICBjb25zdCB1bmludGVudGlvbmFsQW55TWV0cmljcyA9IGF3YWl0IHRoaXMuZ2V0VW5pbnRlbnRpb25hbEFueU1ldHJpY3MoKTtcblxuICAgIHJldHVybiB7XG4gICAgICAuLi5iYXNlTWV0cmljcyxcbiAgICAgIHVuaW50ZW50aW9uYWxBbnlNZXRyaWNzXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZXQgYmFzZWxpbmUgbWV0cmljcyBmb3IgY29tcGFyaXNvblxuICAgKi9cbiAgYXN5bmMgc2V0QmFzZWxpbmVNZXRyaWNzKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRoaXMuYmFzZWxpbmVNZXRyaWNzID0gYXdhaXQgdGhpcy5nZXRVbmludGVudGlvbmFsQW55TWV0cmljcygpO1xuICAgIGNvbnNvbGUubG9nKGDwn5OKIEJhc2VsaW5lIG1ldHJpY3Mgc2V0OmAsIHtcbiAgICAgIHRvdGFsQW55VHlwZXM6IHRoaXMuYmFzZWxpbmVNZXRyaWNzLnRvdGFsQW55VHlwZXMsXG4gICAgICBpbnRlbnRpb25hbEFueVR5cGVzOiB0aGlzLmJhc2VsaW5lTWV0cmljcy5pbnRlbnRpb25hbEFueVR5cGVzLFxuICAgICAgdW5pbnRlbnRpb25hbEFueVR5cGVzOiB0aGlzLmJhc2VsaW5lTWV0cmljcy51bmludGVudGlvbmFsQW55VHlwZXMsXG4gICAgICBkb2N1bWVudGF0aW9uQ292ZXJhZ2U6IGAke3RoaXMuYmFzZWxpbmVNZXRyaWNzLmRvY3VtZW50YXRpb25Db3ZlcmFnZS50b0ZpeGVkKDEpfSVgXG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGV4cGxpY2l0LWFueSB3YXJuaW5nIGNvdW50IGZyb20gRVNMaW50XG4gICAqL1xuICBhc3luYyBnZXRFeHBsaWNpdEFueVdhcm5pbmdDb3VudCgpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBvdXRwdXQgPSBleGVjU3luYygneWFybiBsaW50IDI+JjEnLCB7XG4gICAgICAgIGVuY29kaW5nOiAndXRmOCcsXG4gICAgICAgIHN0ZGlvOiAncGlwZSdcbiAgICAgIH0pO1xuXG4gICAgICAvLyBDb3VudCBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55IHdhcm5pbmdzXG4gICAgICBjb25zdCBleHBsaWNpdEFueU1hdGNoZXMgPSBvdXRwdXQubWF0Y2goL0B0eXBlc2NyaXB0LWVzbGludFxcL25vLWV4cGxpY2l0LWFueS9nKTtcbiAgICAgIHJldHVybiBleHBsaWNpdEFueU1hdGNoZXMgPyBleHBsaWNpdEFueU1hdGNoZXMubGVuZ3RoIDogMDtcblxuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIC8vIEVTTGludCByZXR1cm5zIG5vbi16ZXJvIGV4aXQgY29kZSB3aGVuIHdhcm5pbmdzL2Vycm9ycyBhcmUgZm91bmRcbiAgICAgIGNvbnN0IG91dHB1dCA9IGVycm9yLnN0ZG91dCB8fCBlcnJvci5tZXNzYWdlIHx8ICcnO1xuICAgICAgY29uc3QgZXhwbGljaXRBbnlNYXRjaGVzID0gb3V0cHV0Lm1hdGNoKC9AdHlwZXNjcmlwdC1lc2xpbnRcXC9uby1leHBsaWNpdC1hbnkvZyk7XG4gICAgICByZXR1cm4gZXhwbGljaXRBbnlNYXRjaGVzID8gZXhwbGljaXRBbnlNYXRjaGVzLmxlbmd0aCA6IDA7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldCBkZXRhaWxlZCBicmVha2Rvd24gb2YgZXhwbGljaXQtYW55IHdhcm5pbmdzIGJ5IGZpbGVcbiAgICovXG4gIGFzeW5jIGdldEV4cGxpY2l0QW55QnJlYWtkb3duQnlGaWxlKCk6IFByb21pc2U8UmVjb3JkPHN0cmluZywgbnVtYmVyPj4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBvdXRwdXQgPSBleGVjU3luYygneWFybiBsaW50IDI+JjEnLCB7XG4gICAgICAgIGVuY29kaW5nOiAndXRmOCcsXG4gICAgICAgIHN0ZGlvOiAncGlwZSdcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBicmVha2Rvd246IFJlY29yZDxzdHJpbmcsIG51bWJlcj4gPSB7fTtcbiAgICAgIGNvbnN0IGxpbmVzID0gb3V0cHV0LnNwbGl0KCdcXG4nKTtcblxuICAgICAgZm9yIChjb25zdCBsaW5lIG9mIGxpbmVzKSB7XG4gICAgICAgIGlmIChsaW5lLmluY2x1ZGVzKCdAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55JykpIHtcbiAgICAgICAgICBjb25zdCBmaWxlTWF0Y2ggPSBsaW5lLm1hdGNoKC9eKFteOl0rKTovKTtcbiAgICAgICAgICBpZiAoZmlsZU1hdGNoKSB7XG4gICAgICAgICAgICBjb25zdCBmaWxlUGF0aCA9IGZpbGVNYXRjaFsxXTtcbiAgICAgICAgICAgIGJyZWFrZG93bltmaWxlUGF0aF0gPSAoYnJlYWtkb3duW2ZpbGVQYXRoXSB8fCAwKSArIDE7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBicmVha2Rvd247XG5cbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICBjb25zdCBvdXRwdXQgPSBlcnJvci5zdGRvdXQgfHwgZXJyb3IubWVzc2FnZSB8fCAnJztcbiAgICAgIGNvbnN0IGJyZWFrZG93bjogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9O1xuICAgICAgY29uc3QgbGluZXMgPSBvdXRwdXQuc3BsaXQoJ1xcbicpO1xuXG4gICAgICBmb3IgKGNvbnN0IGxpbmUgb2YgbGluZXMpIHtcbiAgICAgICAgaWYgKGxpbmUuaW5jbHVkZXMoJ0B0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnknKSkge1xuICAgICAgICAgIGNvbnN0IGZpbGVNYXRjaCA9IGxpbmUubWF0Y2goL14oW146XSspOi8pO1xuICAgICAgICAgIGlmIChmaWxlTWF0Y2gpIHtcbiAgICAgICAgICAgIGNvbnN0IGZpbGVQYXRoID0gZmlsZU1hdGNoWzFdO1xuICAgICAgICAgICAgYnJlYWtkb3duW2ZpbGVQYXRoXSA9IChicmVha2Rvd25bZmlsZVBhdGhdIHx8IDApICsgMTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGJyZWFrZG93bjtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhdGUgY29tcHJlaGVuc2l2ZSBwcm9ncmVzcyByZXBvcnQgd2l0aCB1bmludGVudGlvbmFsIGFueSBtZXRyaWNzXG4gICAqL1xuICBhc3luYyBnZW5lcmF0ZVVuaW50ZW50aW9uYWxBbnlQcm9ncmVzc1JlcG9ydCgpOiBQcm9taXNlPFVuaW50ZW50aW9uYWxBbnlQcm9ncmVzc1JlcG9ydD4ge1xuICAgIGNvbnN0IGJhc2VSZXBvcnQgPSBhd2FpdCB0aGlzLmdlbmVyYXRlUHJvZ3Jlc3NSZXBvcnQoKTtcbiAgICBjb25zdCB1bmludGVudGlvbmFsQW55TWV0cmljcyA9IGF3YWl0IHRoaXMuZ2V0VW5pbnRlbnRpb25hbEFueU1ldHJpY3MoKTtcbiAgICBjb25zdCBmaWxlQnJlYWtkb3duID0gYXdhaXQgdGhpcy5nZXRFeHBsaWNpdEFueUJyZWFrZG93bkJ5RmlsZSgpO1xuXG4gICAgLy8gQ3JlYXRlIHVuaW50ZW50aW9uYWwgYW55IHNwZWNpZmljIHBoYXNlIHJlcG9ydHNcbiAgICBjb25zdCB1bmludGVudGlvbmFsQW55UGhhc2VzOiBQaGFzZVJlcG9ydFtdID0gW1xuICAgICAge1xuICAgICAgICBwaGFzZUlkOiAndW5pbnRlbnRpb25hbC1hbnktYW5hbHlzaXMnLFxuICAgICAgICBwaGFzZU5hbWU6ICdVbmludGVudGlvbmFsIEFueSBUeXBlIEFuYWx5c2lzJyxcbiAgICAgICAgc3RhcnRUaW1lOiBuZXcgRGF0ZSgpLFxuICAgICAgICBzdGF0dXM6IFBoYXNlU3RhdHVzLkNPTVBMRVRFRCxcbiAgICAgICAgbWV0cmljczogYXdhaXQgdGhpcy5nZXRQcm9ncmVzc01ldHJpY3MoKSxcbiAgICAgICAgYWNoaWV2ZW1lbnRzOiBbXG4gICAgICAgICAgYEFuYWx5emVkICR7dW5pbnRlbnRpb25hbEFueU1ldHJpY3MudG90YWxBbnlUeXBlc30gYW55IHR5cGVzYCxcbiAgICAgICAgICBgSWRlbnRpZmllZCAke3VuaW50ZW50aW9uYWxBbnlNZXRyaWNzLmludGVudGlvbmFsQW55VHlwZXN9IGludGVudGlvbmFsIGFueSB0eXBlc2AsXG4gICAgICAgICAgYEZvdW5kICR7dW5pbnRlbnRpb25hbEFueU1ldHJpY3MudW5pbnRlbnRpb25hbEFueVR5cGVzfSB1bmludGVudGlvbmFsIGFueSB0eXBlc2BcbiAgICAgICAgXSxcbiAgICAgICAgaXNzdWVzOiB1bmludGVudGlvbmFsQW55TWV0cmljcy51bmludGVudGlvbmFsQW55VHlwZXMgPiAwID9cbiAgICAgICAgICBbYCR7dW5pbnRlbnRpb25hbEFueU1ldHJpY3MudW5pbnRlbnRpb25hbEFueVR5cGVzfSB1bmludGVudGlvbmFsIGFueSB0eXBlcyBuZWVkIGF0dGVudGlvbmBdIDogW10sXG4gICAgICAgIHJlY29tbWVuZGF0aW9uczogdGhpcy5nZW5lcmF0ZVVuaW50ZW50aW9uYWxBbnlSZWNvbW1lbmRhdGlvbnModW5pbnRlbnRpb25hbEFueU1ldHJpY3MpXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBwaGFzZUlkOiAndW5pbnRlbnRpb25hbC1hbnktcmVwbGFjZW1lbnQnLFxuICAgICAgICBwaGFzZU5hbWU6ICdVbmludGVudGlvbmFsIEFueSBUeXBlIFJlcGxhY2VtZW50JyxcbiAgICAgICAgc3RhcnRUaW1lOiBuZXcgRGF0ZSgpLFxuICAgICAgICBzdGF0dXM6IHVuaW50ZW50aW9uYWxBbnlNZXRyaWNzLnJlZHVjdGlvbkZyb21CYXNlbGluZSA+IDAgPyBQaGFzZVN0YXR1cy5DT01QTEVURUQgOiBQaGFzZVN0YXR1cy5OT1RfU1RBUlRFRCxcbiAgICAgICAgbWV0cmljczogYXdhaXQgdGhpcy5nZXRQcm9ncmVzc01ldHJpY3MoKSxcbiAgICAgICAgYWNoaWV2ZW1lbnRzOiB1bmludGVudGlvbmFsQW55TWV0cmljcy5yZWR1Y3Rpb25Gcm9tQmFzZWxpbmUgPiAwID9cbiAgICAgICAgICBbYEFjaGlldmVkICR7dW5pbnRlbnRpb25hbEFueU1ldHJpY3MucmVkdWN0aW9uRnJvbUJhc2VsaW5lLnRvRml4ZWQoMSl9JSByZWR1Y3Rpb25gXSA6IFtdLFxuICAgICAgICBpc3N1ZXM6IHVuaW50ZW50aW9uYWxBbnlNZXRyaWNzLnJlZHVjdGlvbkZyb21CYXNlbGluZSA8IHVuaW50ZW50aW9uYWxBbnlNZXRyaWNzLnRhcmdldFJlZHVjdGlvbiA/XG4gICAgICAgICAgW2BSZWR1Y3Rpb24gJHt1bmludGVudGlvbmFsQW55TWV0cmljcy5yZWR1Y3Rpb25Gcm9tQmFzZWxpbmUudG9GaXhlZCgxKX0lIGJlbG93IHRhcmdldCAke3VuaW50ZW50aW9uYWxBbnlNZXRyaWNzLnRhcmdldFJlZHVjdGlvbn0lYF0gOiBbXSxcbiAgICAgICAgcmVjb21tZW5kYXRpb25zOiB0aGlzLmdlbmVyYXRlUmVwbGFjZW1lbnRSZWNvbW1lbmRhdGlvbnModW5pbnRlbnRpb25hbEFueU1ldHJpY3MpXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBwaGFzZUlkOiAnaW50ZW50aW9uYWwtYW55LWRvY3VtZW50YXRpb24nLFxuICAgICAgICBwaGFzZU5hbWU6ICdJbnRlbnRpb25hbCBBbnkgVHlwZSBEb2N1bWVudGF0aW9uJyxcbiAgICAgICAgc3RhcnRUaW1lOiBuZXcgRGF0ZSgpLFxuICAgICAgICBzdGF0dXM6IHVuaW50ZW50aW9uYWxBbnlNZXRyaWNzLmRvY3VtZW50YXRpb25Db3ZlcmFnZSA+PSA4MCA/IFBoYXNlU3RhdHVzLkNPTVBMRVRFRCA6IFBoYXNlU3RhdHVzLklOX1BST0dSRVNTLFxuICAgICAgICBtZXRyaWNzOiBhd2FpdCB0aGlzLmdldFByb2dyZXNzTWV0cmljcygpLFxuICAgICAgICBhY2hpZXZlbWVudHM6IHVuaW50ZW50aW9uYWxBbnlNZXRyaWNzLmRvY3VtZW50YXRpb25Db3ZlcmFnZSA+PSA4MCA/XG4gICAgICAgICAgW2BEb2N1bWVudGF0aW9uIGNvdmVyYWdlOiAke3VuaW50ZW50aW9uYWxBbnlNZXRyaWNzLmRvY3VtZW50YXRpb25Db3ZlcmFnZS50b0ZpeGVkKDEpfSVgXSA6IFtdLFxuICAgICAgICBpc3N1ZXM6IHVuaW50ZW50aW9uYWxBbnlNZXRyaWNzLmRvY3VtZW50YXRpb25Db3ZlcmFnZSA8IDgwID9cbiAgICAgICAgICBbYERvY3VtZW50YXRpb24gY292ZXJhZ2UgJHt1bmludGVudGlvbmFsQW55TWV0cmljcy5kb2N1bWVudGF0aW9uQ292ZXJhZ2UudG9GaXhlZCgxKX0lIGJlbG93IDgwJWBdIDogW10sXG4gICAgICAgIHJlY29tbWVuZGF0aW9uczogdGhpcy5nZW5lcmF0ZURvY3VtZW50YXRpb25SZWNvbW1lbmRhdGlvbnModW5pbnRlbnRpb25hbEFueU1ldHJpY3MpXG4gICAgICB9XG4gICAgXTtcblxuICAgIHJldHVybiB7XG4gICAgICAuLi5iYXNlUmVwb3J0LFxuICAgICAgdW5pbnRlbnRpb25hbEFueU1ldHJpY3MsXG4gICAgICB1bmludGVudGlvbmFsQW55UGhhc2VzLFxuICAgICAgZmlsZUJyZWFrZG93bixcbiAgICAgIG1ldHJpY3NIaXN0b3J5OiB0aGlzLmdldFVuaW50ZW50aW9uYWxBbnlNZXRyaWNzSGlzdG9yeSgpLFxuICAgICAgaW1wcm92ZW1lbnQ6IHRoaXMuY2FsY3VsYXRlVW5pbnRlbnRpb25hbEFueUltcHJvdmVtZW50KClcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEV4cG9ydCB1bmludGVudGlvbmFsIGFueSBtZXRyaWNzIHRvIEpTT04gZm9yIGV4dGVybmFsIGFuYWx5c2lzXG4gICAqL1xuICBhc3luYyBleHBvcnRVbmludGVudGlvbmFsQW55TWV0cmljcyhmaWxlUGF0aDogc3RyaW5nKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlcG9ydCA9IGF3YWl0IHRoaXMuZ2VuZXJhdGVVbmludGVudGlvbmFsQW55UHJvZ3Jlc3NSZXBvcnQoKTtcbiAgICAgIGNvbnN0IGV4cG9ydERhdGEgPSB7XG4gICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICByZXBvcnQsXG4gICAgICAgIGhpc3Rvcnk6IHRoaXMubWV0cmljc0hpc3RvcnksXG4gICAgICAgIGJhc2VsaW5lOiB0aGlzLmJhc2VsaW5lTWV0cmljcyxcbiAgICAgICAgZmlsZUJyZWFrZG93bjogYXdhaXQgdGhpcy5nZXRFeHBsaWNpdEFueUJyZWFrZG93bkJ5RmlsZSgpXG4gICAgICB9O1xuXG4gICAgICBmcy53cml0ZUZpbGVTeW5jKGZpbGVQYXRoLCBKU09OLnN0cmluZ2lmeShleHBvcnREYXRhLCBudWxsLCAyKSk7XG4gICAgICBjb25zb2xlLmxvZyhg8J+TiiBVbmludGVudGlvbmFsIEFueSBtZXRyaWNzIGV4cG9ydGVkIHRvOiAke2ZpbGVQYXRofWApO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBleHBvcnQgdW5pbnRlbnRpb25hbCBhbnkgbWV0cmljczogJHtlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IFN0cmluZyhlcnJvcil9YCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBkYXNoYm9hcmQtY29tcGF0aWJsZSBtZXRyaWNzIGZvciByZWFsLXRpbWUgbW9uaXRvcmluZ1xuICAgKi9cbiAgYXN5bmMgZ2V0RGFzaGJvYXJkTWV0cmljcygpOiBQcm9taXNlPFVuaW50ZW50aW9uYWxBbnlEYXNoYm9hcmRNZXRyaWNzPiB7XG4gICAgY29uc3QgbWV0cmljcyA9IGF3YWl0IHRoaXMuZ2V0VW5pbnRlbnRpb25hbEFueU1ldHJpY3MoKTtcbiAgICBjb25zdCBmaWxlQnJlYWtkb3duID0gYXdhaXQgdGhpcy5nZXRFeHBsaWNpdEFueUJyZWFrZG93bkJ5RmlsZSgpO1xuXG4gICAgLy8gR2V0IHRvcCBmaWxlcyB3aXRoIG1vc3QgYW55IHR5cGVzXG4gICAgY29uc3QgdG9wRmlsZXMgPSBPYmplY3QuZW50cmllcyhmaWxlQnJlYWtkb3duKVxuICAgICAgLnNvcnQoKFssIGFdLCBbLCBiXSkgPT4gYiAtIGEpXG4gICAgICAuc2xpY2UoMCwgMTApXG4gICAgICAubWFwKChbZmlsZSwgY291bnRdKSA9PiAoeyBmaWxlLCBjb3VudCB9KSk7XG5cbiAgICAvLyBDYWxjdWxhdGUgdHJlbmRcbiAgICBjb25zdCB0cmVuZCA9IHRoaXMuY2FsY3VsYXRlTWV0cmljc1RyZW5kKCk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgY3VycmVudDogbWV0cmljcyxcbiAgICAgIHRyZW5kLFxuICAgICAgdG9wRmlsZXMsXG4gICAgICBhbGVydHM6IHRoaXMuZ2VuZXJhdGVBbGVydHMobWV0cmljcyksXG4gICAgICByZWNvbW1lbmRhdGlvbnM6IHRoaXMuZ2VuZXJhdGVVbmludGVudGlvbmFsQW55UmVjb21tZW5kYXRpb25zKG1ldHJpY3MpLFxuICAgICAgbGFzdFVwZGF0ZWQ6IG5ldyBEYXRlKClcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIFZhbGlkYXRlIG1pbGVzdG9uZSBhY2hpZXZlbWVudCBmb3IgdW5pbnRlbnRpb25hbCBhbnkgZWxpbWluYXRpb25cbiAgICovXG4gIGFzeW5jIHZhbGlkYXRlVW5pbnRlbnRpb25hbEFueU1pbGVzdG9uZShtaWxlc3RvbmU6IFVuaW50ZW50aW9uYWxBbnlNaWxlc3RvbmUpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICBjb25zdCBtZXRyaWNzID0gYXdhaXQgdGhpcy5nZXRVbmludGVudGlvbmFsQW55TWV0cmljcygpO1xuXG4gICAgc3dpdGNoIChtaWxlc3RvbmUpIHtcbiAgICAgIGNhc2UgJ2Jhc2VsaW5lLWVzdGFibGlzaGVkJzpcbiAgICAgICAgcmV0dXJuIHRoaXMuYmFzZWxpbmVNZXRyaWNzICE9PSB1bmRlZmluZWQ7XG5cbiAgICAgIGNhc2UgJ2FuYWx5c2lzLWNvbXBsZXRlJzpcbiAgICAgICAgcmV0dXJuIG1ldHJpY3MudG90YWxBbnlUeXBlcyA+IDAgJiYgKG1ldHJpY3MuaW50ZW50aW9uYWxBbnlUeXBlcyArIG1ldHJpY3MudW5pbnRlbnRpb25hbEFueVR5cGVzKSA+IDA7XG5cbiAgICAgIGNhc2UgJ3RhcmdldC1yZWR1Y3Rpb24tYWNoaWV2ZWQnOlxuICAgICAgICByZXR1cm4gbWV0cmljcy5yZWR1Y3Rpb25Gcm9tQmFzZWxpbmUgPj0gbWV0cmljcy50YXJnZXRSZWR1Y3Rpb247XG5cbiAgICAgIGNhc2UgJ2RvY3VtZW50YXRpb24tY29tcGxldGUnOlxuICAgICAgICByZXR1cm4gbWV0cmljcy5kb2N1bWVudGF0aW9uQ292ZXJhZ2UgPj0gODA7XG5cbiAgICAgIGNhc2UgJ3plcm8tdW5pbnRlbnRpb25hbC1hbnknOlxuICAgICAgICByZXR1cm4gbWV0cmljcy51bmludGVudGlvbmFsQW55VHlwZXMgPT09IDA7XG5cbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIGNvbnNvbGUud2FybihgVW5rbm93biB1bmludGVudGlvbmFsIGFueSBtaWxlc3RvbmU6ICR7bWlsZXN0b25lfWApO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldCBtZXRyaWNzIGhpc3RvcnkgZm9yIHRyZW5kIGFuYWx5c2lzXG4gICAqL1xuICBnZXRVbmludGVudGlvbmFsQW55TWV0cmljc0hpc3RvcnkoKTogVW5pbnRlbnRpb25hbEFueU1ldHJpY3NbXSB7XG4gICAgcmV0dXJuIFsuLi50aGlzLm1ldHJpY3NIaXN0b3J5XTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDYWxjdWxhdGUgaW1wcm92ZW1lbnQgb3ZlciB0aW1lXG4gICAqL1xuICBwcml2YXRlIGNhbGN1bGF0ZVVuaW50ZW50aW9uYWxBbnlJbXByb3ZlbWVudCgpOiBVbmludGVudGlvbmFsQW55SW1wcm92ZW1lbnQge1xuICAgIGlmICh0aGlzLm1ldHJpY3NIaXN0b3J5Lmxlbmd0aCA8IDIpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHRvdGFsQW55VHlwZXNSZWR1Y2VkOiAwLFxuICAgICAgICB1bmludGVudGlvbmFsQW55VHlwZXNSZWR1Y2VkOiAwLFxuICAgICAgICBkb2N1bWVudGF0aW9uSW1wcm92ZWQ6IDAsXG4gICAgICAgIHJlZHVjdGlvblJhdGU6IDBcbiAgICAgIH07XG4gICAgfVxuXG4gICAgY29uc3QgZmlyc3QgPSB0aGlzLm1ldHJpY3NIaXN0b3J5WzBdO1xuICAgIGNvbnN0IGxhdGVzdCA9IHRoaXMubWV0cmljc0hpc3RvcnlbdGhpcy5tZXRyaWNzSGlzdG9yeS5sZW5ndGggLSAxXTtcblxuICAgIHJldHVybiB7XG4gICAgICB0b3RhbEFueVR5cGVzUmVkdWNlZDogZmlyc3QudG90YWxBbnlUeXBlcyAtIGxhdGVzdC50b3RhbEFueVR5cGVzLFxuICAgICAgdW5pbnRlbnRpb25hbEFueVR5cGVzUmVkdWNlZDogZmlyc3QudW5pbnRlbnRpb25hbEFueVR5cGVzIC0gbGF0ZXN0LnVuaW50ZW50aW9uYWxBbnlUeXBlcyxcbiAgICAgIGRvY3VtZW50YXRpb25JbXByb3ZlZDogbGF0ZXN0LmRvY3VtZW50YXRpb25Db3ZlcmFnZSAtIGZpcnN0LmRvY3VtZW50YXRpb25Db3ZlcmFnZSxcbiAgICAgIHJlZHVjdGlvblJhdGU6IGxhdGVzdC5yZWR1Y3Rpb25Gcm9tQmFzZWxpbmVcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIENhbGN1bGF0ZSBtZXRyaWNzIHRyZW5kXG4gICAqL1xuICBwcml2YXRlIGNhbGN1bGF0ZU1ldHJpY3NUcmVuZCgpOiAnaW1wcm92aW5nJyB8ICdzdGFibGUnIHwgJ2RlY2xpbmluZycge1xuICAgIGlmICh0aGlzLm1ldHJpY3NIaXN0b3J5Lmxlbmd0aCA8IDMpIHtcbiAgICAgIHJldHVybiAnc3RhYmxlJztcbiAgICB9XG5cbiAgICBjb25zdCByZWNlbnQgPSB0aGlzLm1ldHJpY3NIaXN0b3J5LnNsaWNlKC0zKTtcbiAgICBjb25zdCB0b3RhbEFueVRyZW5kID0gcmVjZW50WzJdLnRvdGFsQW55VHlwZXMgLSByZWNlbnRbMF0udG90YWxBbnlUeXBlcztcbiAgICBjb25zdCB1bmludGVudGlvbmFsVHJlbmQgPSByZWNlbnRbMl0udW5pbnRlbnRpb25hbEFueVR5cGVzIC0gcmVjZW50WzBdLnVuaW50ZW50aW9uYWxBbnlUeXBlcztcblxuICAgIGlmICh0b3RhbEFueVRyZW5kIDwgLTIgfHwgdW5pbnRlbnRpb25hbFRyZW5kIDwgLTIpIHtcbiAgICAgIHJldHVybiAnaW1wcm92aW5nJztcbiAgICB9IGVsc2UgaWYgKHRvdGFsQW55VHJlbmQgPiAyIHx8IHVuaW50ZW50aW9uYWxUcmVuZCA+IDIpIHtcbiAgICAgIHJldHVybiAnZGVjbGluaW5nJztcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuICdzdGFibGUnO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZSBhbGVydHMgYmFzZWQgb24gbWV0cmljc1xuICAgKi9cbiAgcHJpdmF0ZSBnZW5lcmF0ZUFsZXJ0cyhtZXRyaWNzOiBVbmludGVudGlvbmFsQW55TWV0cmljcyk6IFVuaW50ZW50aW9uYWxBbnlBbGVydFtdIHtcbiAgICBjb25zdCBhbGVydHM6IFVuaW50ZW50aW9uYWxBbnlBbGVydFtdID0gW107XG5cbiAgICBpZiAobWV0cmljcy51bmludGVudGlvbmFsQW55VHlwZXMgPiAxMDApIHtcbiAgICAgIGFsZXJ0cy5wdXNoKHtcbiAgICAgICAgdHlwZTogJ2hpZ2gtdW5pbnRlbnRpb25hbC1hbnktY291bnQnLFxuICAgICAgICBzZXZlcml0eTogJ3dhcm5pbmcnLFxuICAgICAgICBtZXNzYWdlOiBgSGlnaCBudW1iZXIgb2YgdW5pbnRlbnRpb25hbCBhbnkgdHlwZXM6ICR7bWV0cmljcy51bmludGVudGlvbmFsQW55VHlwZXN9YCxcbiAgICAgICAgcmVjb21tZW5kYXRpb246ICdDb25zaWRlciBydW5uaW5nIHRoZSB1bmludGVudGlvbmFsIGFueSBlbGltaW5hdGlvbiBjYW1wYWlnbidcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGlmIChtZXRyaWNzLmRvY3VtZW50YXRpb25Db3ZlcmFnZSA8IDUwKSB7XG4gICAgICBhbGVydHMucHVzaCh7XG4gICAgICAgIHR5cGU6ICdsb3ctZG9jdW1lbnRhdGlvbi1jb3ZlcmFnZScsXG4gICAgICAgIHNldmVyaXR5OiAnZXJyb3InLFxuICAgICAgICBtZXNzYWdlOiBgRG9jdW1lbnRhdGlvbiBjb3ZlcmFnZSBjcml0aWNhbGx5IGxvdzogJHttZXRyaWNzLmRvY3VtZW50YXRpb25Db3ZlcmFnZS50b0ZpeGVkKDEpfSVgLFxuICAgICAgICByZWNvbW1lbmRhdGlvbjogJ0FkZCBkb2N1bWVudGF0aW9uIHRvIGludGVudGlvbmFsIGFueSB0eXBlcydcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGlmIChtZXRyaWNzLnJlZHVjdGlvbkZyb21CYXNlbGluZSA8IDApIHtcbiAgICAgIGFsZXJ0cy5wdXNoKHtcbiAgICAgICAgdHlwZTogJ3JlZ3Jlc3Npb24tZGV0ZWN0ZWQnLFxuICAgICAgICBzZXZlcml0eTogJ2Vycm9yJyxcbiAgICAgICAgbWVzc2FnZTogJ1JlZ3Jlc3Npb24gZGV0ZWN0ZWQ6IGFueSB0eXBlcyBoYXZlIGluY3JlYXNlZCBmcm9tIGJhc2VsaW5lJyxcbiAgICAgICAgcmVjb21tZW5kYXRpb246ICdSZXZpZXcgcmVjZW50IGNoYW5nZXMgYW5kIGNvbnNpZGVyIHJvbGxiYWNrJ1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGFsZXJ0cztcbiAgfVxuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZSByZWNvbW1lbmRhdGlvbnMgYmFzZWQgb24gbWV0cmljc1xuICAgKi9cbiAgcHJpdmF0ZSBnZW5lcmF0ZVVuaW50ZW50aW9uYWxBbnlSZWNvbW1lbmRhdGlvbnMobWV0cmljczogVW5pbnRlbnRpb25hbEFueU1ldHJpY3MpOiBzdHJpbmdbXSB7XG4gICAgY29uc3QgcmVjb21tZW5kYXRpb25zOiBzdHJpbmdbXSA9IFtdO1xuXG4gICAgaWYgKG1ldHJpY3MudW5pbnRlbnRpb25hbEFueVR5cGVzID4gNTApIHtcbiAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKCdSdW4gdW5pbnRlbnRpb25hbCBhbnkgZWxpbWluYXRpb24gY2FtcGFpZ24gdG8gcmVkdWNlIHVuaW50ZW50aW9uYWwgYW55IHR5cGVzJyk7XG4gICAgfVxuXG4gICAgaWYgKG1ldHJpY3MuZG9jdW1lbnRhdGlvbkNvdmVyYWdlIDwgODApIHtcbiAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKCdBZGQgZG9jdW1lbnRhdGlvbiB0byBpbnRlbnRpb25hbCBhbnkgdHlwZXMgdG8gaW1wcm92ZSBjb3ZlcmFnZScpO1xuICAgIH1cblxuICAgIGlmIChtZXRyaWNzLnJlZHVjdGlvbkZyb21CYXNlbGluZSA8IG1ldHJpY3MudGFyZ2V0UmVkdWN0aW9uKSB7XG4gICAgICByZWNvbW1lbmRhdGlvbnMucHVzaChgSW5jcmVhc2UgZWZmb3J0cyB0byByZWFjaCB0YXJnZXQgcmVkdWN0aW9uIG9mICR7bWV0cmljcy50YXJnZXRSZWR1Y3Rpb259JWApO1xuICAgIH1cblxuICAgIGlmIChtZXRyaWNzLnRvdGFsQW55VHlwZXMgPT09IDApIHtcbiAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKCdFeGNlbGxlbnQhIFplcm8gYW55IHR5cGVzIGFjaGlldmVkLiBDb25zaWRlciBzZXR0aW5nIHVwIG1vbml0b3JpbmcgdG8gcHJldmVudCByZWdyZXNzaW9uJyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlY29tbWVuZGF0aW9ucztcbiAgfVxuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZSByZXBsYWNlbWVudC1zcGVjaWZpYyByZWNvbW1lbmRhdGlvbnNcbiAgICovXG4gIHByaXZhdGUgZ2VuZXJhdGVSZXBsYWNlbWVudFJlY29tbWVuZGF0aW9ucyhtZXRyaWNzOiBVbmludGVudGlvbmFsQW55TWV0cmljcyk6IHN0cmluZ1tdIHtcbiAgICBjb25zdCByZWNvbW1lbmRhdGlvbnM6IHN0cmluZ1tdID0gW107XG5cbiAgICBpZiAobWV0cmljcy51bmludGVudGlvbmFsQW55VHlwZXMgPiAwKSB7XG4gICAgICByZWNvbW1lbmRhdGlvbnMucHVzaCgnQ29udGludWUgd2l0aCBwcm9ncmVzc2l2ZSByZXBsYWNlbWVudCBvZiB1bmludGVudGlvbmFsIGFueSB0eXBlcycpO1xuICAgIH1cblxuICAgIGlmIChtZXRyaWNzLnJlZHVjdGlvbkZyb21CYXNlbGluZSA8IDEwKSB7XG4gICAgICByZWNvbW1lbmRhdGlvbnMucHVzaCgnQ29uc2lkZXIgaW5jcmVhc2luZyBjb25maWRlbmNlIHRocmVzaG9sZCBmb3IgbW9yZSBhZ2dyZXNzaXZlIHJlcGxhY2VtZW50Jyk7XG4gICAgfVxuXG4gICAgaWYgKG1ldHJpY3MucmVkdWN0aW9uRnJvbUJhc2VsaW5lID49IG1ldHJpY3MudGFyZ2V0UmVkdWN0aW9uKSB7XG4gICAgICByZWNvbW1lbmRhdGlvbnMucHVzaCgnVGFyZ2V0IHJlZHVjdGlvbiBhY2hpZXZlZCEgQ29uc2lkZXIgc2V0dGluZyBhIGhpZ2hlciB0YXJnZXQnKTtcbiAgICB9XG5cbiAgICByZXR1cm4gcmVjb21tZW5kYXRpb25zO1xuICB9XG5cbiAgLyoqXG4gICAqIEdlbmVyYXRlIGRvY3VtZW50YXRpb24tc3BlY2lmaWMgcmVjb21tZW5kYXRpb25zXG4gICAqL1xuICBwcml2YXRlIGdlbmVyYXRlRG9jdW1lbnRhdGlvblJlY29tbWVuZGF0aW9ucyhtZXRyaWNzOiBVbmludGVudGlvbmFsQW55TWV0cmljcyk6IHN0cmluZ1tdIHtcbiAgICBjb25zdCByZWNvbW1lbmRhdGlvbnM6IHN0cmluZ1tdID0gW107XG5cbiAgICBpZiAobWV0cmljcy5kb2N1bWVudGF0aW9uQ292ZXJhZ2UgPCA1MCkge1xuICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goJ0NyaXRpY2FsOiBBZGQgZG9jdW1lbnRhdGlvbiB0byBpbnRlbnRpb25hbCBhbnkgdHlwZXMnKTtcbiAgICB9IGVsc2UgaWYgKG1ldHJpY3MuZG9jdW1lbnRhdGlvbkNvdmVyYWdlIDwgODApIHtcbiAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKCdJbXByb3ZlIGRvY3VtZW50YXRpb24gY292ZXJhZ2UgdG8gcmVhY2ggODAlIHRhcmdldCcpO1xuICAgIH1cblxuICAgIGlmIChtZXRyaWNzLmludGVudGlvbmFsQW55VHlwZXMgPiAwICYmIG1ldHJpY3MuZG9jdW1lbnRlZEFueVR5cGVzID09PSAwKSB7XG4gICAgICByZWNvbW1lbmRhdGlvbnMucHVzaCgnU3RhcnQgZG9jdW1lbnRpbmcgaW50ZW50aW9uYWwgYW55IHR5cGVzIHdpdGggZXhwbGFuYXRvcnkgY29tbWVudHMnKTtcbiAgICB9XG5cbiAgICByZXR1cm4gcmVjb21tZW5kYXRpb25zO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlc2V0IG1ldHJpY3MgaGlzdG9yeSAoZm9yIHRlc3Rpbmcgb3IgZnJlc2ggc3RhcnQpXG4gICAqL1xuICByZXNldFVuaW50ZW50aW9uYWxBbnlNZXRyaWNzSGlzdG9yeSgpOiB2b2lkIHtcbiAgICB0aGlzLm1ldHJpY3NIaXN0b3J5ID0gW107XG4gICAgdGhpcy5iYXNlbGluZU1ldHJpY3MgPSB1bmRlZmluZWQ7XG4gICAgY29uc29sZS5sb2coJ/Cfk4ogVW5pbnRlbnRpb25hbCBBbnkgbWV0cmljcyBoaXN0b3J5IHJlc2V0Jyk7XG4gIH1cbn1cblxuLy8gQWRkaXRpb25hbCB0eXBlcyBmb3IgbWV0cmljcyBpbnRlZ3JhdGlvblxuZXhwb3J0IGludGVyZmFjZSBVbmludGVudGlvbmFsQW55UHJvZ3Jlc3NSZXBvcnQgZXh0ZW5kcyBQcm9ncmVzc1JlcG9ydCB7XG4gIHVuaW50ZW50aW9uYWxBbnlNZXRyaWNzOiBVbmludGVudGlvbmFsQW55TWV0cmljcztcbiAgdW5pbnRlbnRpb25hbEFueVBoYXNlczogUGhhc2VSZXBvcnRbXTtcbiAgZmlsZUJyZWFrZG93bjogUmVjb3JkPHN0cmluZywgbnVtYmVyPjtcbiAgbWV0cmljc0hpc3Rvcnk6IFVuaW50ZW50aW9uYWxBbnlNZXRyaWNzW107XG4gIGltcHJvdmVtZW50OiBVbmludGVudGlvbmFsQW55SW1wcm92ZW1lbnQ7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVW5pbnRlbnRpb25hbEFueUltcHJvdmVtZW50IHtcbiAgdG90YWxBbnlUeXBlc1JlZHVjZWQ6IG51bWJlcjtcbiAgdW5pbnRlbnRpb25hbEFueVR5cGVzUmVkdWNlZDogbnVtYmVyO1xuICBkb2N1bWVudGF0aW9uSW1wcm92ZWQ6IG51bWJlcjtcbiAgcmVkdWN0aW9uUmF0ZTogbnVtYmVyO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFVuaW50ZW50aW9uYWxBbnlEYXNoYm9hcmRNZXRyaWNzIHtcbiAgY3VycmVudDogVW5pbnRlbnRpb25hbEFueU1ldHJpY3M7XG4gIHRyZW5kOiAnaW1wcm92aW5nJyB8ICdzdGFibGUnIHwgJ2RlY2xpbmluZyc7XG4gIHRvcEZpbGVzOiBBcnJheTx7IGZpbGU6IHN0cmluZzsgY291bnQ6IG51bWJlciB9PjtcbiAgYWxlcnRzOiBVbmludGVudGlvbmFsQW55QWxlcnRbXTtcbiAgcmVjb21tZW5kYXRpb25zOiBzdHJpbmdbXTtcbiAgbGFzdFVwZGF0ZWQ6IERhdGU7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVW5pbnRlbnRpb25hbEFueUFsZXJ0IHtcbiAgdHlwZTogc3RyaW5nO1xuICBzZXZlcml0eTogJ2luZm8nIHwgJ3dhcm5pbmcnIHwgJ2Vycm9yJztcbiAgbWVzc2FnZTogc3RyaW5nO1xuICByZWNvbW1lbmRhdGlvbjogc3RyaW5nO1xufVxuXG5leHBvcnQgdHlwZSBVbmludGVudGlvbmFsQW55TWlsZXN0b25lID1cbiAgfCAnYmFzZWxpbmUtZXN0YWJsaXNoZWQnXG4gIHwgJ2FuYWx5c2lzLWNvbXBsZXRlJ1xuICB8ICd0YXJnZXQtcmVkdWN0aW9uLWFjaGlldmVkJ1xuICB8ICdkb2N1bWVudGF0aW9uLWNvbXBsZXRlJ1xuICB8ICd6ZXJvLXVuaW50ZW50aW9uYWwtYW55JztcblxuLyoqXG4gKiBDYW1wYWlnbiBTY2hlZHVsaW5nIEludGVncmF0aW9uXG4gKiBQcm92aWRlcyBjb21wYXRpYmlsaXR5IHdpdGggZXhpc3RpbmcgY2FtcGFpZ24gc2NoZWR1bGluZyBzeXN0ZW1zXG4gKi9cbmV4cG9ydCBjbGFzcyBVbmludGVudGlvbmFsQW55Q2FtcGFpZ25TY2hlZHVsZXIge1xuICBwcml2YXRlIHByb2dyZXNzVHJhY2tlcjogVW5pbnRlbnRpb25hbEFueVByb2dyZXNzVHJhY2tlcjtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLnByb2dyZXNzVHJhY2tlciA9IG5ldyBVbmludGVudGlvbmFsQW55UHJvZ3Jlc3NUcmFja2VyKCk7XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2sgaWYgdW5pbnRlbnRpb25hbCBhbnkgZWxpbWluYXRpb24gY2FtcGFpZ24gc2hvdWxkIGJlIHRyaWdnZXJlZFxuICAgKi9cbiAgYXN5bmMgc2hvdWxkVHJpZ2dlckNhbXBhaWduKCk6IFByb21pc2U8e1xuICAgIHNob3VsZFRyaWdnZXI6IGJvb2xlYW47XG4gICAgcmVhc29uOiBzdHJpbmc7XG4gICAgcHJpb3JpdHk6ICdsb3cnIHwgJ21lZGl1bScgfCAnaGlnaCc7XG4gIH0+IHtcbiAgICBjb25zdCBtZXRyaWNzID0gYXdhaXQgdGhpcy5wcm9ncmVzc1RyYWNrZXIuZ2V0VW5pbnRlbnRpb25hbEFueU1ldHJpY3MoKTtcblxuICAgIC8vIEhpZ2ggcHJpb3JpdHkgdHJpZ2dlcnNcbiAgICBpZiAobWV0cmljcy51bmludGVudGlvbmFsQW55VHlwZXMgPiAyMDApIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHNob3VsZFRyaWdnZXI6IHRydWUsXG4gICAgICAgIHJlYXNvbjogYEhpZ2ggbnVtYmVyIG9mIHVuaW50ZW50aW9uYWwgYW55IHR5cGVzOiAke21ldHJpY3MudW5pbnRlbnRpb25hbEFueVR5cGVzfWAsXG4gICAgICAgIHByaW9yaXR5OiAnaGlnaCdcbiAgICAgIH07XG4gICAgfVxuXG4gICAgaWYgKG1ldHJpY3MucmVkdWN0aW9uRnJvbUJhc2VsaW5lIDwgLTUpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHNob3VsZFRyaWdnZXI6IHRydWUsXG4gICAgICAgIHJlYXNvbjogJ1JlZ3Jlc3Npb24gZGV0ZWN0ZWQ6IGFueSB0eXBlcyBoYXZlIGluY3JlYXNlZCBzaWduaWZpY2FudGx5JyxcbiAgICAgICAgcHJpb3JpdHk6ICdoaWdoJ1xuICAgICAgfTtcbiAgICB9XG5cbiAgICAvLyBNZWRpdW0gcHJpb3JpdHkgdHJpZ2dlcnNcbiAgICBpZiAobWV0cmljcy51bmludGVudGlvbmFsQW55VHlwZXMgPiA1MCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc2hvdWxkVHJpZ2dlcjogdHJ1ZSxcbiAgICAgICAgcmVhc29uOiBgTW9kZXJhdGUgbnVtYmVyIG9mIHVuaW50ZW50aW9uYWwgYW55IHR5cGVzOiAke21ldHJpY3MudW5pbnRlbnRpb25hbEFueVR5cGVzfWAsXG4gICAgICAgIHByaW9yaXR5OiAnbWVkaXVtJ1xuICAgICAgfTtcbiAgICB9XG5cbiAgICBpZiAobWV0cmljcy5kb2N1bWVudGF0aW9uQ292ZXJhZ2UgPCA1MCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc2hvdWxkVHJpZ2dlcjogdHJ1ZSxcbiAgICAgICAgcmVhc29uOiBgTG93IGRvY3VtZW50YXRpb24gY292ZXJhZ2U6ICR7bWV0cmljcy5kb2N1bWVudGF0aW9uQ292ZXJhZ2UudG9GaXhlZCgxKX0lYCxcbiAgICAgICAgcHJpb3JpdHk6ICdtZWRpdW0nXG4gICAgICB9O1xuICAgIH1cblxuICAgIC8vIExvdyBwcmlvcml0eSB0cmlnZ2Vyc1xuICAgIGlmIChtZXRyaWNzLnVuaW50ZW50aW9uYWxBbnlUeXBlcyA+IDEwKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzaG91bGRUcmlnZ2VyOiB0cnVlLFxuICAgICAgICByZWFzb246IGBTb21lIHVuaW50ZW50aW9uYWwgYW55IHR5cGVzIHByZXNlbnQ6ICR7bWV0cmljcy51bmludGVudGlvbmFsQW55VHlwZXN9YCxcbiAgICAgICAgcHJpb3JpdHk6ICdsb3cnXG4gICAgICB9O1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICBzaG91bGRUcmlnZ2VyOiBmYWxzZSxcbiAgICAgIHJlYXNvbjogJ05vIHNpZ25pZmljYW50IHVuaW50ZW50aW9uYWwgYW55IGlzc3VlcyBkZXRlY3RlZCcsXG4gICAgICBwcmlvcml0eTogJ2xvdydcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIFJlc29sdmUgY29uZmxpY3RzIHdpdGggb3RoZXIgY2FtcGFpZ24gcHJpb3JpdGllc1xuICAgKi9cbiAgcmVzb2x2ZUNhbXBhaWduQ29uZmxpY3RzKFxuICAgIGFjdGl2ZUNhbXBhaWduczogc3RyaW5nW10sXG4gICAgcHJvcG9zZWRDYW1wYWlnbjogJ3VuaW50ZW50aW9uYWwtYW55LWVsaW1pbmF0aW9uJ1xuICApOiB7XG4gICAgY2FuUHJvY2VlZDogYm9vbGVhbjtcbiAgICBjb25mbGljdGluZ0NhbXBhaWduczogc3RyaW5nW107XG4gICAgcmVzb2x1dGlvbjogc3RyaW5nO1xuICB9IHtcbiAgICBjb25zdCBjb25mbGljdGluZ0NhbXBhaWducyA9IGFjdGl2ZUNhbXBhaWducy5maWx0ZXIoY2FtcGFpZ24gPT5cbiAgICAgIGNhbXBhaWduLmluY2x1ZGVzKCd0eXBlc2NyaXB0JykgfHxcbiAgICAgIGNhbXBhaWduLmluY2x1ZGVzKCdsaW50aW5nJykgfHxcbiAgICAgIGNhbXBhaWduLmluY2x1ZGVzKCdleHBsaWNpdC1hbnknKVxuICAgICk7XG5cbiAgICBpZiAoY29uZmxpY3RpbmdDYW1wYWlnbnMubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBjYW5Qcm9jZWVkOiB0cnVlLFxuICAgICAgICBjb25mbGljdGluZ0NhbXBhaWduczogW10sXG4gICAgICAgIHJlc29sdXRpb246ICdObyBjb25mbGljdHMgZGV0ZWN0ZWQsIGNhbiBwcm9jZWVkJ1xuICAgICAgfTtcbiAgICB9XG5cbiAgICAvLyBDaGVjayBpZiBjb25mbGljdHMgY2FuIGJlIHJlc29sdmVkXG4gICAgY29uc3QgY2FuUmVzb2x2ZSA9IGNvbmZsaWN0aW5nQ2FtcGFpZ25zLmV2ZXJ5KGNhbXBhaWduID0+XG4gICAgICAhY2FtcGFpZ24uaW5jbHVkZXMoJ2NyaXRpY2FsJykgJiYgIWNhbXBhaWduLmluY2x1ZGVzKCdlbWVyZ2VuY3knKVxuICAgICk7XG5cbiAgICBpZiAoY2FuUmVzb2x2ZSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgY2FuUHJvY2VlZDogdHJ1ZSxcbiAgICAgICAgY29uZmxpY3RpbmdDYW1wYWlnbnMsXG4gICAgICAgIHJlc29sdXRpb246ICdDb25mbGljdHMgY2FuIGJlIHJlc29sdmVkIGJ5IGNvb3JkaW5hdGluZyBiYXRjaCBwcm9jZXNzaW5nJ1xuICAgICAgfTtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgY2FuUHJvY2VlZDogZmFsc2UsXG4gICAgICBjb25mbGljdGluZ0NhbXBhaWducyxcbiAgICAgIHJlc29sdXRpb246ICdXYWl0IGZvciBjcml0aWNhbCBjYW1wYWlnbnMgdG8gY29tcGxldGUgYmVmb3JlIHByb2NlZWRpbmcnXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgcmVjb21tZW5kZWQgZXhlY3V0aW9uIHRpbWUgYmFzZWQgb24gc3lzdGVtIGxvYWQgYW5kIG90aGVyIGNhbXBhaWduc1xuICAgKi9cbiAgZ2V0UmVjb21tZW5kZWRFeGVjdXRpb25UaW1lKFxuICAgIGFjdGl2ZUNhbXBhaWduczogc3RyaW5nW10sXG4gICAgc3lzdGVtTG9hZDogJ2xvdycgfCAnbWVkaXVtJyB8ICdoaWdoJ1xuICApOiB7XG4gICAgcmVjb21tZW5kZWRUaW1lOiBEYXRlO1xuICAgIHJlYXNvbjogc3RyaW5nO1xuICAgIGVzdGltYXRlZER1cmF0aW9uOiBudW1iZXI7IC8vIG1pbnV0ZXNcbiAgfSB7XG4gICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcbiAgICBsZXQgcmVjb21tZW5kZWRUaW1lID0gbmV3IERhdGUobm93KTtcbiAgICBsZXQgcmVhc29uID0gJyc7XG4gICAgbGV0IGVzdGltYXRlZER1cmF0aW9uID0gMzA7IC8vIERlZmF1bHQgMzAgbWludXRlc1xuXG4gICAgaWYgKHN5c3RlbUxvYWQgPT09ICdoaWdoJyB8fCBhY3RpdmVDYW1wYWlnbnMubGVuZ3RoID4gMikge1xuICAgICAgLy8gU2NoZWR1bGUgZm9yIGxhdGVyIHdoZW4gc3lzdGVtIGxvYWQgaXMgbG93ZXJcbiAgICAgIHJlY29tbWVuZGVkVGltZS5zZXRIb3VycyhyZWNvbW1lbmRlZFRpbWUuZ2V0SG91cnMoKSArIDIpO1xuICAgICAgcmVhc29uID0gJ1NjaGVkdWxlZCBmb3IgbGF0ZXIgZHVlIHRvIGhpZ2ggc3lzdGVtIGxvYWQgb3IgYWN0aXZlIGNhbXBhaWducyc7XG4gICAgICBlc3RpbWF0ZWREdXJhdGlvbiA9IDQ1O1xuICAgIH0gZWxzZSBpZiAoc3lzdGVtTG9hZCA9PT0gJ21lZGl1bScgfHwgYWN0aXZlQ2FtcGFpZ25zLmxlbmd0aCA+IDApIHtcbiAgICAgIC8vIFNjaGVkdWxlIGZvciBuZWFyIGZ1dHVyZVxuICAgICAgcmVjb21tZW5kZWRUaW1lLnNldE1pbnV0ZXMocmVjb21tZW5kZWRUaW1lLmdldE1pbnV0ZXMoKSArIDMwKTtcbiAgICAgIHJlYXNvbiA9ICdTY2hlZHVsZWQgZm9yIG5lYXIgZnV0dXJlIGR1ZSB0byBtb2RlcmF0ZSBzeXN0ZW0gbG9hZCc7XG4gICAgICBlc3RpbWF0ZWREdXJhdGlvbiA9IDM1O1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBDYW4gZXhlY3V0ZSBpbW1lZGlhdGVseVxuICAgICAgcmVhc29uID0gJ0NhbiBleGVjdXRlIGltbWVkaWF0ZWx5IC0gbG93IHN5c3RlbSBsb2FkIGFuZCBubyBjb25mbGljdHMnO1xuICAgICAgZXN0aW1hdGVkRHVyYXRpb24gPSAyNTtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgcmVjb21tZW5kZWRUaW1lLFxuICAgICAgcmVhc29uLFxuICAgICAgZXN0aW1hdGVkRHVyYXRpb25cbiAgICB9O1xuICB9XG59XG4iXSwidmVyc2lvbiI6M30=