ec6d3dbca61a612da85167698338a657
"use strict";
/**
 * Linting Alerting System with Performance Monitoring
 *
 * Provides real-time alerting for linting regression detection
 * with performance monitoring and automated response capabilities.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.LintingAlertingSystem = void 0;
const child_process_1 = require("child_process");
const fs_1 = require("fs");
class LintingAlertingSystem {
    configFile = '.kiro/metrics/alerting-config.json';
    historyFile = '.kiro/metrics/alerting-history.json';
    suppressionFile = '.kiro/metrics/alert-suppressions.json';
    config;
    lastAlertTime = new Map();
    suppressedAlerts = new Set();
    constructor() {
        this.config = this.loadConfiguration();
        this.loadSuppressions();
    }
    /**
     * Process alerts and trigger appropriate responses
     */
    async processAlerts(alerts, metrics) {
        if (!this.config.enabled) {
            return;
        }
        console.log(`üö® Processing ${alerts.length} alerts...`);
        // Filter alerts based on cooldown and suppression
        const activeAlerts = this.filterActiveAlerts(alerts);
        // Process performance monitoring
        const performanceEvents = await this.monitorPerformance(metrics);
        // Send alerts through configured channels
        for (const alert of activeAlerts) {
            await this.sendAlert(alert);
            this.updateAlertHistory(alert);
        }
        // Process performance events
        for (const event of performanceEvents) {
            await this.processPerformanceEvent(event);
        }
        // Trigger auto-responses if configured
        if (this.config.autoResponse.enabled) {
            await this.triggerAutoResponses(activeAlerts, performanceEvents);
        }
        console.log(`‚úÖ Processed ${activeAlerts.length} active alerts and ${performanceEvents.length} performance events`);
    }
    /**
     * Monitor performance metrics and detect issues
     */
    async monitorPerformance(metrics) {
        if (!this.config.performanceMonitoring.enabled) {
            return [];
        }
        const events = [];
        const thresholds = this.config.performanceMonitoring.thresholds;
        for (const threshold of thresholds) {
            const value = this.getPerformanceMetricValue(metrics, threshold.metric);
            if (this.isThresholdExceeded(value, threshold)) {
                const event = {
                    id: `perf-${threshold.metric}-${Date.now()}`,
                    timestamp: new Date(),
                    type: 'threshold_exceeded',
                    metric: threshold.metric,
                    value,
                    threshold: threshold.threshold,
                    impact: this.calculateImpact(threshold.severity),
                    autoResponseTriggered: false
                };
                events.push(event);
                console.log(`‚ö†Ô∏è Performance threshold exceeded: ${threshold.metric} = ${value} > ${threshold.threshold}`);
            }
        }
        return events;
    }
    /**
     * Send alert through configured channels
     */
    async sendAlert(alert) {
        for (const channel of this.config.channels) {
            if (channel.severityFilter.includes(alert.severity)) {
                await this.sendAlertToChannel(alert, channel);
            }
        }
    }
    /**
     * Send alert to specific channel
     */
    async sendAlertToChannel(alert, channel) {
        try {
            switch (channel.type) {
                case 'console':
                    this.sendConsoleAlert(alert);
                    break;
                case 'file':
                    await this.sendFileAlert(alert, channel.config);
                    break;
                case 'kiro':
                    await this.sendKiroAlert(alert, channel.config);
                    break;
                case 'webhook':
                    await this.sendWebhookAlert(alert, channel.config);
                    break;
            }
        }
        catch (error) {
            console.error(`Failed to send alert to ${channel.type}:`, error);
        }
    }
    /**
     * Send console alert
     */
    sendConsoleAlert(alert) {
        const icon = this.getSeverityIcon(alert.severity);
        const timestamp = alert.timestamp.toISOString();
        console.log(`${icon} [${alert.severity.toUpperCase()}] ${timestamp}`);
        console.log(`   Metric: ${alert.metric}`);
        console.log(`   Value: ${alert.currentValue} (threshold: ${alert.threshold})`);
        console.log(`   Message: ${alert.message}`);
        console.log('');
    }
    /**
     * Send file alert
     */
    async sendFileAlert(alert, config) {
        const alertFile = config.file || '.kiro/metrics/alerts.log';
        const timestamp = alert.timestamp.toISOString();
        const logEntry = `[${timestamp}] ${alert.severity.toUpperCase()}: ${alert.message} (${alert.metric}: ${alert.currentValue}/${alert.threshold})\n`;
        try {
            // Append to file
            (0, child_process_1.execSync)(`echo "${logEntry}" >> "${alertFile}"`);
        }
        catch (error) {
            console.error('Failed to write alert to file:', error);
        }
    }
    /**
     * Send Kiro alert (integration with Kiro system)
     */
    async sendKiroAlert(alert, config) {
        // Create Kiro notification file
        const kiroAlert = {
            id: alert.id,
            timestamp: alert.timestamp,
            type: 'linting_alert',
            severity: alert.severity,
            title: `Linting ${alert.severity.toUpperCase()}: ${alert.metric}`,
            message: alert.message,
            data: {
                metric: alert.metric,
                currentValue: alert.currentValue,
                threshold: alert.threshold
            },
            actions: this.generateKiroActions(alert)
        };
        const kiroFile = '.kiro/notifications/linting-alerts.json';
        (0, fs_1.writeFileSync)(kiroFile, JSON.stringify(kiroAlert, null, 2));
    }
    /**
     * Send webhook alert
     */
    async sendWebhookAlert(alert, config) {
        if (!config.url) {
            console.warn('Webhook URL not configured');
            return;
        }
        const payload = {
            alert_id: alert.id,
            timestamp: alert.timestamp,
            severity: alert.severity,
            metric: alert.metric,
            current_value: alert.currentValue,
            threshold: alert.threshold,
            message: alert.message,
            source: 'linting-excellence-dashboard'
        };
        try {
            // Use curl for webhook (Node.js fetch might not be available)
            const curlCommand = `curl -X POST "${config.url}" \
        -H "Content-Type: application/json" \
        -d '${JSON.stringify(payload)}'`;
            (0, child_process_1.execSync)(curlCommand, { stdio: 'pipe' });
        }
        catch (error) {
            console.error('Failed to send webhook alert:', error);
        }
    }
    /**
     * Process performance event and trigger responses
     */
    async processPerformanceEvent(event) {
        console.log(`üìä Performance event: ${event.type} for ${event.metric}`);
        // Log performance event
        const performanceLog = `.kiro/metrics/performance-events.log`;
        const logEntry = `[${event.timestamp.toISOString()}] ${event.type.toUpperCase()}: ${event.metric} = ${event.value} (threshold: ${event.threshold}, impact: ${event.impact})\n`;
        try {
            (0, child_process_1.execSync)(`echo "${logEntry}" >> "${performanceLog}"`);
        }
        catch (error) {
            console.error('Failed to log performance event:', error);
        }
        // Update performance history
        this.updatePerformanceHistory(event);
    }
    /**
     * Trigger automatic responses based on alerts and performance events
     */
    async triggerAutoResponses(alerts, events) {
        const actions = this.config.autoResponse.actions;
        for (const action of actions) {
            if (this.shouldTriggerAction(action, alerts, events)) {
                await this.executeAutoResponse(action);
            }
        }
    }
    /**
     * Execute automatic response action
     */
    async executeAutoResponse(action) {
        console.log(`ü§ñ Executing auto-response: ${action.action}`);
        try {
            switch (action.action) {
                case 'enableCache':
                    await this.enableLintingCache();
                    break;
                case 'reduceBatchSize':
                    await this.reduceBatchSize(action.parameters.newSize || 10);
                    break;
                case 'skipNonCritical':
                    await this.skipNonCriticalRules();
                    break;
                case 'emergencyStop':
                    await this.emergencyStop();
                    break;
            }
        }
        catch (error) {
            console.error(`Failed to execute auto-response ${action.action}:`, error);
        }
    }
    /**
     * Filter alerts based on cooldown and suppression
     */
    filterActiveAlerts(alerts) {
        return alerts.filter(alert => {
            // Check suppression
            if (this.suppressedAlerts.has(alert.metric)) {
                return false;
            }
            // Check cooldown
            const lastAlert = this.lastAlertTime.get(alert.metric);
            if (lastAlert) {
                const cooldownMs = this.config.regressionDetection.cooldownPeriod * 60 * 1000;
                if (Date.now() - lastAlert.getTime() < cooldownMs) {
                    return false;
                }
            }
            return true;
        });
    }
    /**
     * Generate Kiro-specific actions for alerts
     */
    generateKiroActions(alert) {
        const actions = [];
        if (alert.metric === 'parserErrors' && alert.currentValue > 0) {
            actions.push({
                type: 'command',
                label: 'Fix Parser Errors',
                command: 'yarn tsc --noEmit',
                description: 'Run TypeScript compiler to identify syntax errors'
            });
        }
        if (alert.metric === 'explicitAnyErrors' && alert.currentValue > 100) {
            actions.push({
                type: 'campaign',
                label: 'Start Explicit Any Campaign',
                campaign: 'explicit-any-elimination',
                description: 'Launch systematic explicit any type elimination'
            });
        }
        if (alert.metric === 'importOrderIssues' && alert.currentValue > 50) {
            actions.push({
                type: 'command',
                label: 'Fix Import Order',
                command: 'yarn lint:fix',
                description: 'Automatically organize imports with enhanced rules'
            });
        }
        return actions;
    }
    // Auto-response implementations
    async enableLintingCache() {
        console.log('üöÄ Enabling ESLint caching for improved performance');
        // Cache is already enabled in eslint.config.cjs, this is a no-op
    }
    async reduceBatchSize(newSize) {
        console.log(`üìâ Reducing batch size to ${newSize} for better performance`);
        // This would integrate with campaign system batch processing
    }
    async skipNonCriticalRules() {
        console.log('‚ö° Temporarily skipping non-critical rules for performance');
        // This would create a temporary ESLint config with reduced rules
    }
    async emergencyStop() {
        console.log('üõë Emergency stop triggered - halting linting operations');
        // This would stop any running linting campaigns
    }
    // Helper methods
    loadConfiguration() {
        try {
            if ((0, fs_1.existsSync)(this.configFile)) {
                return JSON.parse((0, fs_1.readFileSync)(this.configFile, 'utf8'));
            }
        }
        catch (error) {
            console.warn('Error loading alerting configuration:', error);
        }
        // Return default configuration
        return {
            enabled: true,
            channels: [
                {
                    type: 'console',
                    config: {},
                    severityFilter: ['warning', 'error', 'critical']
                },
                {
                    type: 'file',
                    config: { file: '.kiro/metrics/alerts.log' },
                    severityFilter: ['error', 'critical']
                },
                {
                    type: 'kiro',
                    config: {},
                    severityFilter: ['critical']
                }
            ],
            regressionDetection: {
                enabled: true,
                sensitivity: 'medium',
                cooldownPeriod: 15 // 15 minutes
            },
            performanceMonitoring: {
                enabled: true,
                thresholds: [
                    {
                        metric: 'duration',
                        threshold: 30000,
                        severity: 'warning',
                        message: 'Linting duration exceeds 30 seconds'
                    },
                    {
                        metric: 'memory',
                        threshold: 512,
                        severity: 'warning',
                        message: 'Memory usage exceeds 512MB'
                    },
                    {
                        metric: 'cacheHitRate',
                        threshold: 0.5,
                        severity: 'warning',
                        message: 'Cache hit rate below 50%'
                    }
                ]
            },
            autoResponse: {
                enabled: true,
                actions: [
                    {
                        trigger: 'performance_degradation',
                        action: 'enableCache',
                        parameters: {}
                    },
                    {
                        trigger: 'memory_exceeded',
                        action: 'reduceBatchSize',
                        parameters: { newSize: 10 }
                    }
                ]
            }
        };
    }
    loadSuppressions() {
        try {
            if ((0, fs_1.existsSync)(this.suppressionFile)) {
                const suppressions = JSON.parse((0, fs_1.readFileSync)(this.suppressionFile, 'utf8'));
                this.suppressedAlerts = new Set(suppressions);
            }
        }
        catch (error) {
            console.warn('Error loading alert suppressions:', error);
        }
    }
    updateAlertHistory(alert) {
        this.lastAlertTime.set(alert.metric, alert.timestamp);
        // Store in history file
        try {
            const history = this.loadAlertHistory();
            history.alerts.push(alert);
            // Keep only last 1000 alerts
            if (history.alerts.length > 1000) {
                history.alerts.splice(0, history.alerts.length - 1000);
            }
            (0, fs_1.writeFileSync)(this.historyFile, JSON.stringify(history, null, 2));
        }
        catch (error) {
            console.error('Error updating alert history:', error);
        }
    }
    updatePerformanceHistory(event) {
        try {
            const history = this.loadAlertHistory();
            history.performanceEvents.push(event);
            // Keep only last 500 performance events
            if (history.performanceEvents.length > 500) {
                history.performanceEvents.splice(0, history.performanceEvents.length - 500);
            }
            (0, fs_1.writeFileSync)(this.historyFile, JSON.stringify(history, null, 2));
        }
        catch (error) {
            console.error('Error updating performance history:', error);
        }
    }
    loadAlertHistory() {
        try {
            if ((0, fs_1.existsSync)(this.historyFile)) {
                return JSON.parse((0, fs_1.readFileSync)(this.historyFile, 'utf8'));
            }
        }
        catch (error) {
            console.warn('Error loading alert history:', error);
        }
        return {
            alerts: [],
            suppressedAlerts: [],
            resolvedAlerts: [],
            performanceEvents: []
        };
    }
    getPerformanceMetricValue(metrics, metric) {
        switch (metric) {
            case 'duration':
                return metrics.performanceMetrics.lintingDuration;
            case 'memory':
                return metrics.performanceMetrics.memoryUsage;
            case 'cacheHitRate':
                return metrics.performanceMetrics.cacheHitRate;
            case 'filesPerSecond':
                return metrics.performanceMetrics.filesProcessed / (metrics.performanceMetrics.lintingDuration / 1000);
            default:
                return 0;
        }
    }
    isThresholdExceeded(value, threshold) {
        if (threshold.metric === 'cacheHitRate') {
            return value < threshold.threshold; // Cache hit rate should be above threshold
        }
        return value > threshold.threshold; // Other metrics should be below threshold
    }
    calculateImpact(severity) {
        switch (severity) {
            case 'critical':
                return 'high';
            case 'error':
                return 'medium';
            default:
                return 'low';
        }
    }
    shouldTriggerAction(action, alerts, events) {
        switch (action.trigger) {
            case 'performance_degradation':
                return events.some(e => e.type === 'threshold_exceeded' && e.impact === 'high');
            case 'memory_exceeded':
                return events.some(e => e.metric === 'memory' && e.type === 'threshold_exceeded');
            case 'critical_alert':
                return alerts.some(a => a.severity === 'critical');
            default:
                return false;
        }
    }
    getSeverityIcon(severity) {
        switch (severity) {
            case 'critical':
                return 'üö®';
            case 'error':
                return '‚ùå';
            case 'warning':
                return '‚ö†Ô∏è';
            case 'info':
                return '‚ÑπÔ∏è';
            default:
                return 'üìã';
        }
    }
}
exports.LintingAlertingSystem = LintingAlertingSystem;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9zZXJ2aWNlcy9saW50aW5nL0xpbnRpbmdBbGVydGluZ1N5c3RlbS50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7O0dBS0c7OztBQUVILGlEQUF5QztBQUN6QywyQkFBNkQ7QUEyRDdELE1BQWEscUJBQXFCO0lBQ2YsVUFBVSxHQUFHLG9DQUFvQyxDQUFDO0lBQ2xELFdBQVcsR0FBRyxxQ0FBcUMsQ0FBQztJQUNwRCxlQUFlLEdBQUcsdUNBQXVDLENBQUM7SUFFbkUsTUFBTSxDQUFpQjtJQUN2QixhQUFhLEdBQXNCLElBQUksR0FBRyxFQUFFLENBQUM7SUFDN0MsZ0JBQWdCLEdBQWdCLElBQUksR0FBRyxFQUFFLENBQUM7SUFFbEQ7UUFDRSxJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1FBQ3ZDLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO0lBQzFCLENBQUM7SUFFRDs7T0FFRztJQUNILEtBQUssQ0FBQyxhQUFhLENBQUMsTUFBZSxFQUFFLE9BQXVCO1FBQzFELElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sRUFBRTtZQUN4QixPQUFPO1NBQ1I7UUFFRCxPQUFPLENBQUMsR0FBRyxDQUFDLGlCQUFpQixNQUFNLENBQUMsTUFBTSxZQUFZLENBQUMsQ0FBQztRQUV4RCxrREFBa0Q7UUFDbEQsTUFBTSxZQUFZLEdBQUcsSUFBSSxDQUFDLGtCQUFrQixDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBRXJELGlDQUFpQztRQUNqQyxNQUFNLGlCQUFpQixHQUFHLE1BQU0sSUFBSSxDQUFDLGtCQUFrQixDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBRWpFLDBDQUEwQztRQUMxQyxLQUFLLE1BQU0sS0FBSyxJQUFJLFlBQVksRUFBRTtZQUNoQyxNQUFNLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDNUIsSUFBSSxDQUFDLGtCQUFrQixDQUFDLEtBQUss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QU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsUUFBUSxLQUFLLFVBQVUsQ0FBQyxDQUFDO1lBQ3JEO2dCQUNFLE9BQU8sS0FBSyxDQUFDO1NBQ2hCO0lBQ0gsQ0FBQztJQUVPLGVBQWUsQ0FBQyxRQUFnQjtRQUN0QyxRQUFRLFFBQVEsRUFBRTtZQUNoQixLQUFLLFVBQVU7Z0JBQ2IsT0FBTyxJQUFJLENBQUM7WUFDZCxLQUFLLE9BQU87Z0JBQ1YsT0FBTyxHQUFHLENBQUM7WUFDYixLQUFLLFNBQVM7Z0JBQ1osT0FBTyxJQUFJLENBQUM7WUFDZCxLQUFLLE1BQU07Z0JBQ1QsT0FBTyxJQUFJLENBQUM7WUFDZDtnQkFDRSxPQUFPLElBQUksQ0FBQztTQUNmO0lBQ0gsQ0FBQztDQUNGO0FBOWhCRCxzREE4aEJDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9HcmVnQ2FzdHJvL0Rlc2t0b3AvV2hhdFRvRWF0TmV4dC9zcmMvc2VydmljZXMvbGludGluZy9MaW50aW5nQWxlcnRpbmdTeXN0ZW0udHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBMaW50aW5nIEFsZXJ0aW5nIFN5c3RlbSB3aXRoIFBlcmZvcm1hbmNlIE1vbml0b3JpbmdcbiAqXG4gKiBQcm92aWRlcyByZWFsLXRpbWUgYWxlcnRpbmcgZm9yIGxpbnRpbmcgcmVncmVzc2lvbiBkZXRlY3Rpb25cbiAqIHdpdGggcGVyZm9ybWFuY2UgbW9uaXRvcmluZyBhbmQgYXV0b21hdGVkIHJlc3BvbnNlIGNhcGFiaWxpdGllcy5cbiAqL1xuXG5pbXBvcnQgeyBleGVjU3luYyB9IGZyb20gJ2NoaWxkX3Byb2Nlc3MnO1xuaW1wb3J0IHsgZXhpc3RzU3luYywgcmVhZEZpbGVTeW5jLCB3cml0ZUZpbGVTeW5jIH0gZnJvbSAnZnMnO1xuXG5pbXBvcnQgeyBBbGVydCwgTGludGluZ01ldHJpY3MgfSBmcm9tICcuL0xpbnRpbmdWYWxpZGF0aW9uRGFzaGJvYXJkJztcblxuZXhwb3J0IGludGVyZmFjZSBBbGVydGluZ0NvbmZpZyB7XG4gIGVuYWJsZWQ6IGJvb2xlYW47XG4gIGNoYW5uZWxzOiBBbGVydENoYW5uZWxbXTtcbiAgcmVncmVzc2lvbkRldGVjdGlvbjoge1xuICAgIGVuYWJsZWQ6IGJvb2xlYW47XG4gICAgc2Vuc2l0aXZpdHk6ICdsb3cnIHwgJ21lZGl1bScgfCAnaGlnaCc7XG4gICAgY29vbGRvd25QZXJpb2Q6IG51bWJlcjsgLy8gbWludXRlc1xuICB9O1xuICBwZXJmb3JtYW5jZU1vbml0b3Jpbmc6IHtcbiAgICBlbmFibGVkOiBib29sZWFuO1xuICAgIHRocmVzaG9sZHM6IFBlcmZvcm1hbmNlVGhyZXNob2xkW107XG4gIH07XG4gIGF1dG9SZXNwb25zZToge1xuICAgIGVuYWJsZWQ6IGJvb2xlYW47XG4gICAgYWN0aW9uczogQXV0b1Jlc3BvbnNlQWN0aW9uW107XG4gIH07XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQWxlcnRDaGFubmVsIHtcbiAgdHlwZTogJ2NvbnNvbGUnIHwgJ2ZpbGUnIHwgJ3dlYmhvb2snIHwgJ2tpcm8nO1xuICBjb25maWc6IFJlY29yZDxzdHJpbmcsIGFueT47XG4gIHNldmVyaXR5RmlsdGVyOiAoJ2luZm8nIHwgJ3dhcm5pbmcnIHwgJ2Vycm9yJyB8ICdjcml0aWNhbCcpW107XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUGVyZm9ybWFuY2VUaHJlc2hvbGQge1xuICBtZXRyaWM6ICdkdXJhdGlvbicgfCAnbWVtb3J5JyB8ICdjYWNoZUhpdFJhdGUnIHwgJ2ZpbGVzUGVyU2Vjb25kJztcbiAgdGhyZXNob2xkOiBudW1iZXI7XG4gIHNldmVyaXR5OiAnd2FybmluZycgfCAnZXJyb3InIHwgJ2NyaXRpY2FsJztcbiAgbWVzc2FnZTogc3RyaW5nO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEF1dG9SZXNwb25zZUFjdGlvbiB7XG4gIHRyaWdnZXI6IHN0cmluZztcbiAgYWN0aW9uOiAnZW5hYmxlQ2FjaGUnIHwgJ3JlZHVjZUJhdGNoU2l6ZScgfCAnc2tpcE5vbkNyaXRpY2FsJyB8ICdlbWVyZ2VuY3lTdG9wJztcbiAgcGFyYW1ldGVyczogUmVjb3JkPHN0cmluZywgYW55Pjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBBbGVydEhpc3Rvcnkge1xuICBhbGVydHM6IEFsZXJ0W107XG4gIHN1cHByZXNzZWRBbGVydHM6IEFsZXJ0W107XG4gIHJlc29sdmVkQWxlcnRzOiBBbGVydFtdO1xuICBwZXJmb3JtYW5jZUV2ZW50czogUGVyZm9ybWFuY2VFdmVudFtdO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFBlcmZvcm1hbmNlRXZlbnQge1xuICBpZDogc3RyaW5nO1xuICB0aW1lc3RhbXA6IERhdGU7XG4gIHR5cGU6ICdkZWdyYWRhdGlvbicgfCAnaW1wcm92ZW1lbnQnIHwgJ3RocmVzaG9sZF9leGNlZWRlZCc7XG4gIG1ldHJpYzogc3RyaW5nO1xuICB2YWx1ZTogbnVtYmVyO1xuICB0aHJlc2hvbGQ6IG51bWJlcjtcbiAgaW1wYWN0OiAnbG93JyB8ICdtZWRpdW0nIHwgJ2hpZ2gnO1xuICBhdXRvUmVzcG9uc2VUcmlnZ2VyZWQ6IGJvb2xlYW47XG59XG5cbmV4cG9ydCBjbGFzcyBMaW50aW5nQWxlcnRpbmdTeXN0ZW0ge1xuICBwcml2YXRlIHJlYWRvbmx5IGNvbmZpZ0ZpbGUgPSAnLmtpcm8vbWV0cmljcy9hbGVydGluZy1jb25maWcuanNvbic7XG4gIHByaXZhdGUgcmVhZG9ubHkgaGlzdG9yeUZpbGUgPSAnLmtpcm8vbWV0cmljcy9hbGVydGluZy1oaXN0b3J5Lmpzb24nO1xuICBwcml2YXRlIHJlYWRvbmx5IHN1cHByZXNzaW9uRmlsZSA9ICcua2lyby9tZXRyaWNzL2FsZXJ0LXN1cHByZXNzaW9ucy5qc29uJztcblxuICBwcml2YXRlIGNvbmZpZzogQWxlcnRpbmdDb25maWc7XG4gIHByaXZhdGUgbGFzdEFsZXJ0VGltZTogTWFwPHN0cmluZywgRGF0ZT4gPSBuZXcgTWFwKCk7XG4gIHByaXZhdGUgc3VwcHJlc3NlZEFsZXJ0czogU2V0PHN0cmluZz4gPSBuZXcgU2V0KCk7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5jb25maWcgPSB0aGlzLmxvYWRDb25maWd1cmF0aW9uKCk7XG4gICAgdGhpcy5sb2FkU3VwcHJlc3Npb25zKCk7XG4gIH1cblxuICAvKipcbiAgICogUHJvY2VzcyBhbGVydHMgYW5kIHRyaWdnZXIgYXBwcm9wcmlhdGUgcmVzcG9uc2VzXG4gICAqL1xuICBhc3luYyBwcm9jZXNzQWxlcnRzKGFsZXJ0czogQWxlcnRbXSwgbWV0cmljczogTGludGluZ01ldHJpY3MpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBpZiAoIXRoaXMuY29uZmlnLmVuYWJsZWQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zb2xlLmxvZyhg8J+aqCBQcm9jZXNzaW5nICR7YWxlcnRzLmxlbmd0aH0gYWxlcnRzLi4uYCk7XG5cbiAgICAvLyBGaWx0ZXIgYWxlcnRzIGJhc2VkIG9uIGNvb2xkb3duIGFuZCBzdXBwcmVzc2lvblxuICAgIGNvbnN0IGFjdGl2ZUFsZXJ0cyA9IHRoaXMuZmlsdGVyQWN0aXZlQWxlcnRzKGFsZXJ0cyk7XG5cbiAgICAvLyBQcm9jZXNzIHBlcmZvcm1hbmNlIG1vbml0b3JpbmdcbiAgICBjb25zdCBwZXJmb3JtYW5jZUV2ZW50cyA9IGF3YWl0IHRoaXMubW9uaXRvclBlcmZvcm1hbmNlKG1ldHJpY3MpO1xuXG4gICAgLy8gU2VuZCBhbGVydHMgdGhyb3VnaCBjb25maWd1cmVkIGNoYW5uZWxzXG4gICAgZm9yIChjb25zdCBhbGVydCBvZiBhY3RpdmVBbGVydHMpIHtcbiAgICAgIGF3YWl0IHRoaXMuc2VuZEFsZXJ0KGFsZXJ0KTtcbiAgICAgIHRoaXMudXBkYXRlQWxlcnRIaXN0b3J5KGFsZXJ0KTtcbiAgICB9XG5cbiAgICAvLyBQcm9jZXNzIHBlcmZvcm1hbmNlIGV2ZW50c1xuICAgIGZvciAoY29uc3QgZXZlbnQgb2YgcGVyZm9ybWFuY2VFdmVudHMpIHtcbiAgICAgIGF3YWl0IHRoaXMucHJvY2Vzc1BlcmZvcm1hbmNlRXZlbnQoZXZlbnQpO1xuICAgIH1cblxuICAgIC8vIFRyaWdnZXIgYXV0by1yZXNwb25zZXMgaWYgY29uZmlndXJlZFxuICAgIGlmICh0aGlzLmNvbmZpZy5hdXRvUmVzcG9uc2UuZW5hYmxlZCkge1xuICAgICAgYXdhaXQgdGhpcy50cmlnZ2VyQXV0b1Jlc3BvbnNlcyhhY3RpdmVBbGVydHMsIHBlcmZvcm1hbmNlRXZlbnRzKTtcbiAgICB9XG5cbiAgICBjb25zb2xlLmxvZyhg4pyFIFByb2Nlc3NlZCAke2FjdGl2ZUFsZXJ0cy5sZW5ndGh9IGFjdGl2ZSBhbGVydHMgYW5kICR7cGVyZm9ybWFuY2VFdmVudHMubGVuZ3RofSBwZXJmb3JtYW5jZSBldmVudHNgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBNb25pdG9yIHBlcmZvcm1hbmNlIG1ldHJpY3MgYW5kIGRldGVjdCBpc3N1ZXNcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgbW9uaXRvclBlcmZvcm1hbmNlKG1ldHJpY3M6IExpbnRpbmdNZXRyaWNzKTogUHJvbWlzZTxQZXJmb3JtYW5jZUV2ZW50W10+IHtcbiAgICBpZiAoIXRoaXMuY29uZmlnLnBlcmZvcm1hbmNlTW9uaXRvcmluZy5lbmFibGVkKSB7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuXG4gICAgY29uc3QgZXZlbnRzOiBQZXJmb3JtYW5jZUV2ZW50W10gPSBbXTtcbiAgICBjb25zdCB0aHJlc2hvbGRzID0gdGhpcy5jb25maWcucGVyZm9ybWFuY2VNb25pdG9yaW5nLnRocmVzaG9sZHM7XG5cbiAgICBmb3IgKGNvbnN0IHRocmVzaG9sZCBvZiB0aHJlc2hvbGRzKSB7XG4gICAgICBjb25zdCB2YWx1ZSA9IHRoaXMuZ2V0UGVyZm9ybWFuY2VNZXRyaWNWYWx1ZShtZXRyaWNzLCB0aHJlc2hvbGQubWV0cmljKTtcblxuICAgICAgaWYgKHRoaXMuaXNUaHJlc2hvbGRFeGNlZWRlZCh2YWx1ZSwgdGhyZXNob2xkKSkge1xuICAgICAgICBjb25zdCBldmVudDogUGVyZm9ybWFuY2VFdmVudCA9IHtcbiAgICAgICAgICBpZDogYHBlcmYtJHt0aHJlc2hvbGQubWV0cmljfS0ke0RhdGUubm93KCl9YCxcbiAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAgICAgICAgdHlwZTogJ3RocmVzaG9sZF9leGNlZWRlZCcsXG4gICAgICAgICAgbWV0cmljOiB0aHJlc2hvbGQubWV0cmljLFxuICAgICAgICAgIHZhbHVlLFxuICAgICAgICAgIHRocmVzaG9sZDogdGhyZXNob2xkLnRocmVzaG9sZCxcbiAgICAgICAgICBpbXBhY3Q6IHRoaXMuY2FsY3VsYXRlSW1wYWN0KHRocmVzaG9sZC5zZXZlcml0eSksXG4gICAgICAgICAgYXV0b1Jlc3BvbnNlVHJpZ2dlcmVkOiBmYWxzZVxuICAgICAgICB9O1xuXG4gICAgICAgIGV2ZW50cy5wdXNoKGV2ZW50KTtcbiAgICAgICAgY29uc29sZS5sb2coYOKaoO+4jyBQZXJmb3JtYW5jZSB0aHJlc2hvbGQgZXhjZWVkZWQ6ICR7dGhyZXNob2xkLm1ldHJpY30gPSAke3ZhbHVlfSA+ICR7dGhyZXNob2xkLnRocmVzaG9sZH1gKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gZXZlbnRzO1xuICB9XG5cbiAgLyoqXG4gICAqIFNlbmQgYWxlcnQgdGhyb3VnaCBjb25maWd1cmVkIGNoYW5uZWxzXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIHNlbmRBbGVydChhbGVydDogQWxlcnQpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBmb3IgKGNvbnN0IGNoYW5uZWwgb2YgdGhpcy5jb25maWcuY2hhbm5lbHMpIHtcbiAgICAgIGlmIChjaGFubmVsLnNldmVyaXR5RmlsdGVyLmluY2x1ZGVzKGFsZXJ0LnNldmVyaXR5KSkge1xuICAgICAgICBhd2FpdCB0aGlzLnNlbmRBbGVydFRvQ2hhbm5lbChhbGVydCwgY2hhbm5lbCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFNlbmQgYWxlcnQgdG8gc3BlY2lmaWMgY2hhbm5lbFxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBzZW5kQWxlcnRUb0NoYW5uZWwoYWxlcnQ6IEFsZXJ0LCBjaGFubmVsOiBBbGVydENoYW5uZWwpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgc3dpdGNoIChjaGFubmVsLnR5cGUpIHtcbiAgICAgICAgY2FzZSAnY29uc29sZSc6XG4gICAgICAgICAgdGhpcy5zZW5kQ29uc29sZUFsZXJ0KGFsZXJ0KTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnZmlsZSc6XG4gICAgICAgICAgYXdhaXQgdGhpcy5zZW5kRmlsZUFsZXJ0KGFsZXJ0LCBjaGFubmVsLmNvbmZpZyk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ2tpcm8nOlxuICAgICAgICAgIGF3YWl0IHRoaXMuc2VuZEtpcm9BbGVydChhbGVydCwgY2hhbm5lbC5jb25maWcpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICd3ZWJob29rJzpcbiAgICAgICAgICBhd2FpdCB0aGlzLnNlbmRXZWJob29rQWxlcnQoYWxlcnQsIGNoYW5uZWwuY29uZmlnKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIHNlbmQgYWxlcnQgdG8gJHtjaGFubmVsLnR5cGV9OmAsIGVycm9yKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU2VuZCBjb25zb2xlIGFsZXJ0XG4gICAqL1xuICBwcml2YXRlIHNlbmRDb25zb2xlQWxlcnQoYWxlcnQ6IEFsZXJ0KTogdm9pZCB7XG4gICAgY29uc3QgaWNvbiA9IHRoaXMuZ2V0U2V2ZXJpdHlJY29uKGFsZXJ0LnNldmVyaXR5KTtcbiAgICBjb25zdCB0aW1lc3RhbXAgPSBhbGVydC50aW1lc3RhbXAudG9JU09TdHJpbmcoKTtcblxuICAgIGNvbnNvbGUubG9nKGAke2ljb259IFske2FsZXJ0LnNldmVyaXR5LnRvVXBwZXJDYXNlKCl9XSAke3RpbWVzdGFtcH1gKTtcbiAgICBjb25zb2xlLmxvZyhgICAgTWV0cmljOiAke2FsZXJ0Lm1ldHJpY31gKTtcbiAgICBjb25zb2xlLmxvZyhgICAgVmFsdWU6ICR7YWxlcnQuY3VycmVudFZhbHVlfSAodGhyZXNob2xkOiAke2FsZXJ0LnRocmVzaG9sZH0pYCk7XG4gICAgY29uc29sZS5sb2coYCAgIE1lc3NhZ2U6ICR7YWxlcnQubWVzc2FnZX1gKTtcbiAgICBjb25zb2xlLmxvZygnJyk7XG4gIH1cblxuICAvKipcbiAgICogU2VuZCBmaWxlIGFsZXJ0XG4gICAqL1xuICBwcml2YXRlIGFzeW5jIHNlbmRGaWxlQWxlcnQoYWxlcnQ6IEFsZXJ0LCBjb25maWc6IFJlY29yZDxzdHJpbmcsIGFueT4pOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBhbGVydEZpbGUgPSBjb25maWcuZmlsZSB8fCAnLmtpcm8vbWV0cmljcy9hbGVydHMubG9nJztcbiAgICBjb25zdCB0aW1lc3RhbXAgPSBhbGVydC50aW1lc3RhbXAudG9JU09TdHJpbmcoKTtcbiAgICBjb25zdCBsb2dFbnRyeSA9IGBbJHt0aW1lc3RhbXB9XSAke2FsZXJ0LnNldmVyaXR5LnRvVXBwZXJDYXNlKCl9OiAke2FsZXJ0Lm1lc3NhZ2V9ICgke2FsZXJ0Lm1ldHJpY306ICR7YWxlcnQuY3VycmVudFZhbHVlfS8ke2FsZXJ0LnRocmVzaG9sZH0pXFxuYDtcblxuICAgIHRyeSB7XG4gICAgICAvLyBBcHBlbmQgdG8gZmlsZVxuICAgICAgZXhlY1N5bmMoYGVjaG8gXCIke2xvZ0VudHJ5fVwiID4+IFwiJHthbGVydEZpbGV9XCJgKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIHdyaXRlIGFsZXJ0IHRvIGZpbGU6JywgZXJyb3IpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTZW5kIEtpcm8gYWxlcnQgKGludGVncmF0aW9uIHdpdGggS2lybyBzeXN0ZW0pXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIHNlbmRLaXJvQWxlcnQoYWxlcnQ6IEFsZXJ0LCBjb25maWc6IFJlY29yZDxzdHJpbmcsIGFueT4pOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAvLyBDcmVhdGUgS2lybyBub3RpZmljYXRpb24gZmlsZVxuICAgIGNvbnN0IGtpcm9BbGVydCA9IHtcbiAgICAgIGlkOiBhbGVydC5pZCxcbiAgICAgIHRpbWVzdGFtcDogYWxlcnQudGltZXN0YW1wLFxuICAgICAgdHlwZTogJ2xpbnRpbmdfYWxlcnQnLFxuICAgICAgc2V2ZXJpdHk6IGFsZXJ0LnNldmVyaXR5LFxuICAgICAgdGl0bGU6IGBMaW50aW5nICR7YWxlcnQuc2V2ZXJpdHkudG9VcHBlckNhc2UoKX06ICR7YWxlcnQubWV0cmljfWAsXG4gICAgICBtZXNzYWdlOiBhbGVydC5tZXNzYWdlLFxuICAgICAgZGF0YToge1xuICAgICAgICBtZXRyaWM6IGFsZXJ0Lm1ldHJpYyxcbiAgICAgICAgY3VycmVudFZhbHVlOiBhbGVydC5jdXJyZW50VmFsdWUsXG4gICAgICAgIHRocmVzaG9sZDogYWxlcnQudGhyZXNob2xkXG4gICAgICB9LFxuICAgICAgYWN0aW9uczogdGhpcy5nZW5lcmF0ZUtpcm9BY3Rpb25zKGFsZXJ0KVxuICAgIH07XG5cbiAgICBjb25zdCBraXJvRmlsZSA9ICcua2lyby9ub3RpZmljYXRpb25zL2xpbnRpbmctYWxlcnRzLmpzb24nO1xuICAgIHdyaXRlRmlsZVN5bmMoa2lyb0ZpbGUsIEpTT04uc3RyaW5naWZ5KGtpcm9BbGVydCwgbnVsbCwgMikpO1xuICB9XG5cbiAgLyoqXG4gICAqIFNlbmQgd2ViaG9vayBhbGVydFxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBzZW5kV2ViaG9va0FsZXJ0KGFsZXJ0OiBBbGVydCwgY29uZmlnOiBSZWNvcmQ8c3RyaW5nLCBhbnk+KTogUHJvbWlzZTx2b2lkPiB7XG4gICAgaWYgKCFjb25maWcudXJsKSB7XG4gICAgICBjb25zb2xlLndhcm4oJ1dlYmhvb2sgVVJMIG5vdCBjb25maWd1cmVkJyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgcGF5bG9hZCA9IHtcbiAgICAgIGFsZXJ0X2lkOiBhbGVydC5pZCxcbiAgICAgIHRpbWVzdGFtcDogYWxlcnQudGltZXN0YW1wLFxuICAgICAgc2V2ZXJpdHk6IGFsZXJ0LnNldmVyaXR5LFxuICAgICAgbWV0cmljOiBhbGVydC5tZXRyaWMsXG4gICAgICBjdXJyZW50X3ZhbHVlOiBhbGVydC5jdXJyZW50VmFsdWUsXG4gICAgICB0aHJlc2hvbGQ6IGFsZXJ0LnRocmVzaG9sZCxcbiAgICAgIG1lc3NhZ2U6IGFsZXJ0Lm1lc3NhZ2UsXG4gICAgICBzb3VyY2U6ICdsaW50aW5nLWV4Y2VsbGVuY2UtZGFzaGJvYXJkJ1xuICAgIH07XG5cbiAgICB0cnkge1xuICAgICAgLy8gVXNlIGN1cmwgZm9yIHdlYmhvb2sgKE5vZGUuanMgZmV0Y2ggbWlnaHQgbm90IGJlIGF2YWlsYWJsZSlcbiAgICAgIGNvbnN0IGN1cmxDb21tYW5kID0gYGN1cmwgLVggUE9TVCBcIiR7Y29uZmlnLnVybH1cIiBcXFxuICAgICAgICAtSCBcIkNvbnRlbnQtVHlwZTogYXBwbGljYXRpb24vanNvblwiIFxcXG4gICAgICAgIC1kICcke0pTT04uc3RyaW5naWZ5KHBheWxvYWQpfSdgO1xuXG4gICAgICBleGVjU3luYyhjdXJsQ29tbWFuZCwgeyBzdGRpbzogJ3BpcGUnIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gc2VuZCB3ZWJob29rIGFsZXJ0OicsIGVycm9yKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUHJvY2VzcyBwZXJmb3JtYW5jZSBldmVudCBhbmQgdHJpZ2dlciByZXNwb25zZXNcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgcHJvY2Vzc1BlcmZvcm1hbmNlRXZlbnQoZXZlbnQ6IFBlcmZvcm1hbmNlRXZlbnQpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zb2xlLmxvZyhg8J+TiiBQZXJmb3JtYW5jZSBldmVudDogJHtldmVudC50eXBlfSBmb3IgJHtldmVudC5tZXRyaWN9YCk7XG5cbiAgICAvLyBMb2cgcGVyZm9ybWFuY2UgZXZlbnRcbiAgICBjb25zdCBwZXJmb3JtYW5jZUxvZyA9IGAua2lyby9tZXRyaWNzL3BlcmZvcm1hbmNlLWV2ZW50cy5sb2dgO1xuICAgIGNvbnN0IGxvZ0VudHJ5ID0gYFske2V2ZW50LnRpbWVzdGFtcC50b0lTT1N0cmluZygpfV0gJHtldmVudC50eXBlLnRvVXBwZXJDYXNlKCl9OiAke2V2ZW50Lm1ldHJpY30gPSAke2V2ZW50LnZhbHVlfSAodGhyZXNob2xkOiAke2V2ZW50LnRocmVzaG9sZH0sIGltcGFjdDogJHtldmVudC5pbXBhY3R9KVxcbmA7XG5cbiAgICB0cnkge1xuICAgICAgZXhlY1N5bmMoYGVjaG8gXCIke2xvZ0VudHJ5fVwiID4+IFwiJHtwZXJmb3JtYW5jZUxvZ31cImApO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gbG9nIHBlcmZvcm1hbmNlIGV2ZW50OicsIGVycm9yKTtcbiAgICB9XG5cbiAgICAvLyBVcGRhdGUgcGVyZm9ybWFuY2UgaGlzdG9yeVxuICAgIHRoaXMudXBkYXRlUGVyZm9ybWFuY2VIaXN0b3J5KGV2ZW50KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBUcmlnZ2VyIGF1dG9tYXRpYyByZXNwb25zZXMgYmFzZWQgb24gYWxlcnRzIGFuZCBwZXJmb3JtYW5jZSBldmVudHNcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgdHJpZ2dlckF1dG9SZXNwb25zZXMoYWxlcnRzOiBBbGVydFtdLCBldmVudHM6IFBlcmZvcm1hbmNlRXZlbnRbXSk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IGFjdGlvbnMgPSB0aGlzLmNvbmZpZy5hdXRvUmVzcG9uc2UuYWN0aW9ucztcblxuICAgIGZvciAoY29uc3QgYWN0aW9uIG9mIGFjdGlvbnMpIHtcbiAgICAgIGlmICh0aGlzLnNob3VsZFRyaWdnZXJBY3Rpb24oYWN0aW9uLCBhbGVydHMsIGV2ZW50cykpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5leGVjdXRlQXV0b1Jlc3BvbnNlKGFjdGlvbik7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEV4ZWN1dGUgYXV0b21hdGljIHJlc3BvbnNlIGFjdGlvblxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBleGVjdXRlQXV0b1Jlc3BvbnNlKGFjdGlvbjogQXV0b1Jlc3BvbnNlQWN0aW9uKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc29sZS5sb2coYPCfpJYgRXhlY3V0aW5nIGF1dG8tcmVzcG9uc2U6ICR7YWN0aW9uLmFjdGlvbn1gKTtcblxuICAgIHRyeSB7XG4gICAgICBzd2l0Y2ggKGFjdGlvbi5hY3Rpb24pIHtcbiAgICAgICAgY2FzZSAnZW5hYmxlQ2FjaGUnOlxuICAgICAgICAgIGF3YWl0IHRoaXMuZW5hYmxlTGludGluZ0NhY2hlKCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ3JlZHVjZUJhdGNoU2l6ZSc6XG4gICAgICAgICAgYXdhaXQgdGhpcy5yZWR1Y2VCYXRjaFNpemUoYWN0aW9uLnBhcmFtZXRlcnMubmV3U2l6ZSB8fCAxMCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ3NraXBOb25Dcml0aWNhbCc6XG4gICAgICAgICAgYXdhaXQgdGhpcy5za2lwTm9uQ3JpdGljYWxSdWxlcygpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdlbWVyZ2VuY3lTdG9wJzpcbiAgICAgICAgICBhd2FpdCB0aGlzLmVtZXJnZW5jeVN0b3AoKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihgRmFpbGVkIHRvIGV4ZWN1dGUgYXV0by1yZXNwb25zZSAke2FjdGlvbi5hY3Rpb259OmAsIGVycm9yKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRmlsdGVyIGFsZXJ0cyBiYXNlZCBvbiBjb29sZG93biBhbmQgc3VwcHJlc3Npb25cbiAgICovXG4gIHByaXZhdGUgZmlsdGVyQWN0aXZlQWxlcnRzKGFsZXJ0czogQWxlcnRbXSk6IEFsZXJ0W10ge1xuICAgIHJldHVybiBhbGVydHMuZmlsdGVyKGFsZXJ0ID0+IHtcbiAgICAgIC8vIENoZWNrIHN1cHByZXNzaW9uXG4gICAgICBpZiAodGhpcy5zdXBwcmVzc2VkQWxlcnRzLmhhcyhhbGVydC5tZXRyaWMpKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cblxuICAgICAgLy8gQ2hlY2sgY29vbGRvd25cbiAgICAgIGNvbnN0IGxhc3RBbGVydCA9IHRoaXMubGFzdEFsZXJ0VGltZS5nZXQoYWxlcnQubWV0cmljKTtcbiAgICAgIGlmIChsYXN0QWxlcnQpIHtcbiAgICAgICAgY29uc3QgY29vbGRvd25NcyA9IHRoaXMuY29uZmlnLnJlZ3Jlc3Npb25EZXRlY3Rpb24uY29vbGRvd25QZXJpb2QgKiA2MCAqIDEwMDA7XG4gICAgICAgIGlmIChEYXRlLm5vdygpIC0gbGFzdEFsZXJ0LmdldFRpbWUoKSA8IGNvb2xkb3duTXMpIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhdGUgS2lyby1zcGVjaWZpYyBhY3Rpb25zIGZvciBhbGVydHNcbiAgICovXG4gIHByaXZhdGUgZ2VuZXJhdGVLaXJvQWN0aW9ucyhhbGVydDogQWxlcnQpOiBBcnJheTxSZWNvcmQ8c3RyaW5nLCB1bmtub3duPj4ge1xuICAgIGNvbnN0IGFjdGlvbnM6IEFycmF5PFJlY29yZDxzdHJpbmcsIHVua25vd24+PiA9IFtdO1xuXG4gICAgaWYgKGFsZXJ0Lm1ldHJpYyA9PT0gJ3BhcnNlckVycm9ycycgJiYgYWxlcnQuY3VycmVudFZhbHVlID4gMCkge1xuICAgICAgYWN0aW9ucy5wdXNoKHtcbiAgICAgICAgdHlwZTogJ2NvbW1hbmQnLFxuICAgICAgICBsYWJlbDogJ0ZpeCBQYXJzZXIgRXJyb3JzJyxcbiAgICAgICAgY29tbWFuZDogJ3lhcm4gdHNjIC0tbm9FbWl0JyxcbiAgICAgICAgZGVzY3JpcHRpb246ICdSdW4gVHlwZVNjcmlwdCBjb21waWxlciB0byBpZGVudGlmeSBzeW50YXggZXJyb3JzJ1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgaWYgKGFsZXJ0Lm1ldHJpYyA9PT0gJ2V4cGxpY2l0QW55RXJyb3JzJyAmJiBhbGVydC5jdXJyZW50VmFsdWUgPiAxMDApIHtcbiAgICAgIGFjdGlvbnMucHVzaCh7XG4gICAgICAgIHR5cGU6ICdjYW1wYWlnbicsXG4gICAgICAgIGxhYmVsOiAnU3RhcnQgRXhwbGljaXQgQW55IENhbXBhaWduJyxcbiAgICAgICAgY2FtcGFpZ246ICdleHBsaWNpdC1hbnktZWxpbWluYXRpb24nLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ0xhdW5jaCBzeXN0ZW1hdGljIGV4cGxpY2l0IGFueSB0eXBlIGVsaW1pbmF0aW9uJ1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgaWYgKGFsZXJ0Lm1ldHJpYyA9PT0gJ2ltcG9ydE9yZGVySXNzdWVzJyAmJiBhbGVydC5jdXJyZW50VmFsdWUgPiA1MCkge1xuICAgICAgYWN0aW9ucy5wdXNoKHtcbiAgICAgICAgdHlwZTogJ2NvbW1hbmQnLFxuICAgICAgICBsYWJlbDogJ0ZpeCBJbXBvcnQgT3JkZXInLFxuICAgICAgICBjb21tYW5kOiAneWFybiBsaW50OmZpeCcsXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnQXV0b21hdGljYWxseSBvcmdhbml6ZSBpbXBvcnRzIHdpdGggZW5oYW5jZWQgcnVsZXMnXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4gYWN0aW9ucztcbiAgfVxuXG4gIC8vIEF1dG8tcmVzcG9uc2UgaW1wbGVtZW50YXRpb25zXG4gIHByaXZhdGUgYXN5bmMgZW5hYmxlTGludGluZ0NhY2hlKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnNvbGUubG9nKCfwn5qAIEVuYWJsaW5nIEVTTGludCBjYWNoaW5nIGZvciBpbXByb3ZlZCBwZXJmb3JtYW5jZScpO1xuICAgIC8vIENhY2hlIGlzIGFscmVhZHkgZW5hYmxlZCBpbiBlc2xpbnQuY29uZmlnLmNqcywgdGhpcyBpcyBhIG5vLW9wXG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHJlZHVjZUJhdGNoU2l6ZShuZXdTaXplOiBudW1iZXIpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zb2xlLmxvZyhg8J+TiSBSZWR1Y2luZyBiYXRjaCBzaXplIHRvICR7bmV3U2l6ZX0gZm9yIGJldHRlciBwZXJmb3JtYW5jZWApO1xuICAgIC8vIFRoaXMgd291bGQgaW50ZWdyYXRlIHdpdGggY2FtcGFpZ24gc3lzdGVtIGJhdGNoIHByb2Nlc3NpbmdcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgc2tpcE5vbkNyaXRpY2FsUnVsZXMoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc29sZS5sb2coJ+KaoSBUZW1wb3JhcmlseSBza2lwcGluZyBub24tY3JpdGljYWwgcnVsZXMgZm9yIHBlcmZvcm1hbmNlJyk7XG4gICAgLy8gVGhpcyB3b3VsZCBjcmVhdGUgYSB0ZW1wb3JhcnkgRVNMaW50IGNvbmZpZyB3aXRoIHJlZHVjZWQgcnVsZXNcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZW1lcmdlbmN5U3RvcCgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zb2xlLmxvZygn8J+bkSBFbWVyZ2VuY3kgc3RvcCB0cmlnZ2VyZWQgLSBoYWx0aW5nIGxpbnRpbmcgb3BlcmF0aW9ucycpO1xuICAgIC8vIFRoaXMgd291bGQgc3RvcCBhbnkgcnVubmluZyBsaW50aW5nIGNhbXBhaWduc1xuICB9XG5cbiAgLy8gSGVscGVyIG1ldGhvZHNcbiAgcHJpdmF0ZSBsb2FkQ29uZmlndXJhdGlvbigpOiBBbGVydGluZ0NvbmZpZyB7XG4gICAgdHJ5IHtcbiAgICAgIGlmIChleGlzdHNTeW5jKHRoaXMuY29uZmlnRmlsZSkpIHtcbiAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UocmVhZEZpbGVTeW5jKHRoaXMuY29uZmlnRmlsZSwgJ3V0ZjgnKSk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUud2FybignRXJyb3IgbG9hZGluZyBhbGVydGluZyBjb25maWd1cmF0aW9uOicsIGVycm9yKTtcbiAgICB9XG5cbiAgICAvLyBSZXR1cm4gZGVmYXVsdCBjb25maWd1cmF0aW9uXG4gICAgcmV0dXJuIHtcbiAgICAgIGVuYWJsZWQ6IHRydWUsXG4gICAgICBjaGFubmVsczogW1xuICAgICAgICB7XG4gICAgICAgICAgdHlwZTogJ2NvbnNvbGUnLFxuICAgICAgICAgIGNvbmZpZzoge30sXG4gICAgICAgICAgc2V2ZXJpdHlGaWx0ZXI6IFsnd2FybmluZycsICdlcnJvcicsICdjcml0aWNhbCddXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICB0eXBlOiAnZmlsZScsXG4gICAgICAgICAgY29uZmlnOiB7IGZpbGU6ICcua2lyby9tZXRyaWNzL2FsZXJ0cy5sb2cnIH0sXG4gICAgICAgICAgc2V2ZXJpdHlGaWx0ZXI6IFsnZXJyb3InLCAnY3JpdGljYWwnXVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgdHlwZTogJ2tpcm8nLFxuICAgICAgICAgIGNvbmZpZzoge30sXG4gICAgICAgICAgc2V2ZXJpdHlGaWx0ZXI6IFsnY3JpdGljYWwnXVxuICAgICAgICB9XG4gICAgICBdLFxuICAgICAgcmVncmVzc2lvbkRldGVjdGlvbjoge1xuICAgICAgICBlbmFibGVkOiB0cnVlLFxuICAgICAgICBzZW5zaXRpdml0eTogJ21lZGl1bScsXG4gICAgICAgIGNvb2xkb3duUGVyaW9kOiAxNSAvLyAxNSBtaW51dGVzXG4gICAgICB9LFxuICAgICAgcGVyZm9ybWFuY2VNb25pdG9yaW5nOiB7XG4gICAgICAgIGVuYWJsZWQ6IHRydWUsXG4gICAgICAgIHRocmVzaG9sZHM6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICBtZXRyaWM6ICdkdXJhdGlvbicsXG4gICAgICAgICAgICB0aHJlc2hvbGQ6IDMwMDAwLCAvLyAzMCBzZWNvbmRzXG4gICAgICAgICAgICBzZXZlcml0eTogJ3dhcm5pbmcnLFxuICAgICAgICAgICAgbWVzc2FnZTogJ0xpbnRpbmcgZHVyYXRpb24gZXhjZWVkcyAzMCBzZWNvbmRzJ1xuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgbWV0cmljOiAnbWVtb3J5JyxcbiAgICAgICAgICAgIHRocmVzaG9sZDogNTEyLCAvLyA1MTIgTUJcbiAgICAgICAgICAgIHNldmVyaXR5OiAnd2FybmluZycsXG4gICAgICAgICAgICBtZXNzYWdlOiAnTWVtb3J5IHVzYWdlIGV4Y2VlZHMgNTEyTUInXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBtZXRyaWM6ICdjYWNoZUhpdFJhdGUnLFxuICAgICAgICAgICAgdGhyZXNob2xkOiAwLjUsIC8vIDUwJVxuICAgICAgICAgICAgc2V2ZXJpdHk6ICd3YXJuaW5nJyxcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdDYWNoZSBoaXQgcmF0ZSBiZWxvdyA1MCUnXG4gICAgICAgICAgfVxuICAgICAgICBdXG4gICAgICB9LFxuICAgICAgYXV0b1Jlc3BvbnNlOiB7XG4gICAgICAgIGVuYWJsZWQ6IHRydWUsXG4gICAgICAgIGFjdGlvbnM6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICB0cmlnZ2VyOiAncGVyZm9ybWFuY2VfZGVncmFkYXRpb24nLFxuICAgICAgICAgICAgYWN0aW9uOiAnZW5hYmxlQ2FjaGUnLFxuICAgICAgICAgICAgcGFyYW1ldGVyczoge31cbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHRyaWdnZXI6ICdtZW1vcnlfZXhjZWVkZWQnLFxuICAgICAgICAgICAgYWN0aW9uOiAncmVkdWNlQmF0Y2hTaXplJyxcbiAgICAgICAgICAgIHBhcmFtZXRlcnM6IHsgbmV3U2l6ZTogMTAgfVxuICAgICAgICAgIH1cbiAgICAgICAgXVxuICAgICAgfVxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIGxvYWRTdXBwcmVzc2lvbnMoKTogdm9pZCB7XG4gICAgdHJ5IHtcbiAgICAgIGlmIChleGlzdHNTeW5jKHRoaXMuc3VwcHJlc3Npb25GaWxlKSkge1xuICAgICAgICBjb25zdCBzdXBwcmVzc2lvbnMgPSBKU09OLnBhcnNlKHJlYWRGaWxlU3luYyh0aGlzLnN1cHByZXNzaW9uRmlsZSwgJ3V0ZjgnKSk7XG4gICAgICAgIHRoaXMuc3VwcHJlc3NlZEFsZXJ0cyA9IG5ldyBTZXQoc3VwcHJlc3Npb25zKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS53YXJuKCdFcnJvciBsb2FkaW5nIGFsZXJ0IHN1cHByZXNzaW9uczonLCBlcnJvcik7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSB1cGRhdGVBbGVydEhpc3RvcnkoYWxlcnQ6IEFsZXJ0KTogdm9pZCB7XG4gICAgdGhpcy5sYXN0QWxlcnRUaW1lLnNldChhbGVydC5tZXRyaWMsIGFsZXJ0LnRpbWVzdGFtcCk7XG5cbiAgICAvLyBTdG9yZSBpbiBoaXN0b3J5IGZpbGVcbiAgICB0cnkge1xuICAgICAgY29uc3QgaGlzdG9yeSA9IHRoaXMubG9hZEFsZXJ0SGlzdG9yeSgpO1xuICAgICAgaGlzdG9yeS5hbGVydHMucHVzaChhbGVydCk7XG5cbiAgICAgIC8vIEtlZXAgb25seSBsYXN0IDEwMDAgYWxlcnRzXG4gICAgICBpZiAoaGlzdG9yeS5hbGVydHMubGVuZ3RoID4gMTAwMCkge1xuICAgICAgICBoaXN0b3J5LmFsZXJ0cy5zcGxpY2UoMCwgaGlzdG9yeS5hbGVydHMubGVuZ3RoIC0gMTAwMCk7XG4gICAgICB9XG5cbiAgICAgIHdyaXRlRmlsZVN5bmModGhpcy5oaXN0b3J5RmlsZSwgSlNPTi5zdHJpbmdpZnkoaGlzdG9yeSwgbnVsbCwgMikpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciB1cGRhdGluZyBhbGVydCBoaXN0b3J5OicsIGVycm9yKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHVwZGF0ZVBlcmZvcm1hbmNlSGlzdG9yeShldmVudDogUGVyZm9ybWFuY2VFdmVudCk6IHZvaWQge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBoaXN0b3J5ID0gdGhpcy5sb2FkQWxlcnRIaXN0b3J5KCk7XG4gICAgICBoaXN0b3J5LnBlcmZvcm1hbmNlRXZlbnRzLnB1c2goZXZlbnQpO1xuXG4gICAgICAvLyBLZWVwIG9ubHkgbGFzdCA1MDAgcGVyZm9ybWFuY2UgZXZlbnRzXG4gICAgICBpZiAoaGlzdG9yeS5wZXJmb3JtYW5jZUV2ZW50cy5sZW5ndGggPiA1MDApIHtcbiAgICAgICAgaGlzdG9yeS5wZXJmb3JtYW5jZUV2ZW50cy5zcGxpY2UoMCwgaGlzdG9yeS5wZXJmb3JtYW5jZUV2ZW50cy5sZW5ndGggLSA1MDApO1xuICAgICAgfVxuXG4gICAgICB3cml0ZUZpbGVTeW5jKHRoaXMuaGlzdG9yeUZpbGUsIEpTT04uc3RyaW5naWZ5KGhpc3RvcnksIG51bGwsIDIpKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgdXBkYXRpbmcgcGVyZm9ybWFuY2UgaGlzdG9yeTonLCBlcnJvcik7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBsb2FkQWxlcnRIaXN0b3J5KCk6IEFsZXJ0SGlzdG9yeSB7XG4gICAgdHJ5IHtcbiAgICAgIGlmIChleGlzdHNTeW5jKHRoaXMuaGlzdG9yeUZpbGUpKSB7XG4gICAgICAgIHJldHVybiBKU09OLnBhcnNlKHJlYWRGaWxlU3luYyh0aGlzLmhpc3RvcnlGaWxlLCAndXRmOCcpKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS53YXJuKCdFcnJvciBsb2FkaW5nIGFsZXJ0IGhpc3Rvcnk6JywgZXJyb3IpO1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICBhbGVydHM6IFtdLFxuICAgICAgc3VwcHJlc3NlZEFsZXJ0czogW10sXG4gICAgICByZXNvbHZlZEFsZXJ0czogW10sXG4gICAgICBwZXJmb3JtYW5jZUV2ZW50czogW11cbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRQZXJmb3JtYW5jZU1ldHJpY1ZhbHVlKG1ldHJpY3M6IExpbnRpbmdNZXRyaWNzLCBtZXRyaWM6IHN0cmluZyk6IG51bWJlciB7XG4gICAgc3dpdGNoIChtZXRyaWMpIHtcbiAgICAgIGNhc2UgJ2R1cmF0aW9uJzpcbiAgICAgICAgcmV0dXJuIG1ldHJpY3MucGVyZm9ybWFuY2VNZXRyaWNzLmxpbnRpbmdEdXJhdGlvbjtcbiAgICAgIGNhc2UgJ21lbW9yeSc6XG4gICAgICAgIHJldHVybiBtZXRyaWNzLnBlcmZvcm1hbmNlTWV0cmljcy5tZW1vcnlVc2FnZTtcbiAgICAgIGNhc2UgJ2NhY2hlSGl0UmF0ZSc6XG4gICAgICAgIHJldHVybiBtZXRyaWNzLnBlcmZvcm1hbmNlTWV0cmljcy5jYWNoZUhpdFJhdGU7XG4gICAgICBjYXNlICdmaWxlc1BlclNlY29uZCc6XG4gICAgICAgIHJldHVybiBtZXRyaWNzLnBlcmZvcm1hbmNlTWV0cmljcy5maWxlc1Byb2Nlc3NlZCAvIChtZXRyaWNzLnBlcmZvcm1hbmNlTWV0cmljcy5saW50aW5nRHVyYXRpb24gLyAxMDAwKTtcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgaXNUaHJlc2hvbGRFeGNlZWRlZCh2YWx1ZTogbnVtYmVyLCB0aHJlc2hvbGQ6IFBlcmZvcm1hbmNlVGhyZXNob2xkKTogYm9vbGVhbiB7XG4gICAgaWYgKHRocmVzaG9sZC5tZXRyaWMgPT09ICdjYWNoZUhpdFJhdGUnKSB7XG4gICAgICByZXR1cm4gdmFsdWUgPCB0aHJlc2hvbGQudGhyZXNob2xkOyAvLyBDYWNoZSBoaXQgcmF0ZSBzaG91bGQgYmUgYWJvdmUgdGhyZXNob2xkXG4gICAgfVxuICAgIHJldHVybiB2YWx1ZSA+IHRocmVzaG9sZC50aHJlc2hvbGQ7IC8vIE90aGVyIG1ldHJpY3Mgc2hvdWxkIGJlIGJlbG93IHRocmVzaG9sZFxuICB9XG5cbiAgcHJpdmF0ZSBjYWxjdWxhdGVJbXBhY3Qoc2V2ZXJpdHk6IHN0cmluZyk6ICdsb3cnIHwgJ21lZGl1bScgfCAnaGlnaCcge1xuICAgIHN3aXRjaCAoc2V2ZXJpdHkpIHtcbiAgICAgIGNhc2UgJ2NyaXRpY2FsJzpcbiAgICAgICAgcmV0dXJuICdoaWdoJztcbiAgICAgIGNhc2UgJ2Vycm9yJzpcbiAgICAgICAgcmV0dXJuICdtZWRpdW0nO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuICdsb3cnO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgc2hvdWxkVHJpZ2dlckFjdGlvbihhY3Rpb246IEF1dG9SZXNwb25zZUFjdGlvbiwgYWxlcnRzOiBBbGVydFtdLCBldmVudHM6IFBlcmZvcm1hbmNlRXZlbnRbXSk6IGJvb2xlYW4ge1xuICAgIHN3aXRjaCAoYWN0aW9uLnRyaWdnZXIpIHtcbiAgICAgIGNhc2UgJ3BlcmZvcm1hbmNlX2RlZ3JhZGF0aW9uJzpcbiAgICAgICAgcmV0dXJuIGV2ZW50cy5zb21lKGUgPT4gZS50eXBlID09PSAndGhyZXNob2xkX2V4Y2VlZGVkJyAmJiBlLmltcGFjdCA9PT0gJ2hpZ2gnKTtcbiAgICAgIGNhc2UgJ21lbW9yeV9leGNlZWRlZCc6XG4gICAgICAgIHJldHVybiBldmVudHMuc29tZShlID0+IGUubWV0cmljID09PSAnbWVtb3J5JyAmJiBlLnR5cGUgPT09ICd0aHJlc2hvbGRfZXhjZWVkZWQnKTtcbiAgICAgIGNhc2UgJ2NyaXRpY2FsX2FsZXJ0JzpcbiAgICAgICAgcmV0dXJuIGFsZXJ0cy5zb21lKGEgPT4gYS5zZXZlcml0eSA9PT0gJ2NyaXRpY2FsJyk7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBnZXRTZXZlcml0eUljb24oc2V2ZXJpdHk6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgc3dpdGNoIChzZXZlcml0eSkge1xuICAgICAgY2FzZSAnY3JpdGljYWwnOlxuICAgICAgICByZXR1cm4gJ/CfmqgnO1xuICAgICAgY2FzZSAnZXJyb3InOlxuICAgICAgICByZXR1cm4gJ+KdjCc7XG4gICAgICBjYXNlICd3YXJuaW5nJzpcbiAgICAgICAgcmV0dXJuICfimqDvuI8nO1xuICAgICAgY2FzZSAnaW5mbyc6XG4gICAgICAgIHJldHVybiAn4oS577iPJztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybiAn8J+Tiyc7XG4gICAgfVxuICB9XG59XG4iXSwidmVyc2lvbiI6M30=