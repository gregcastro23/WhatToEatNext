d067a90d6afd315e364535239e4fe678
"use strict";
/**
 * Memory Management Setup for Jest Tests
 *
 * This file configures memory management, garbage collection hints,
 * and cleanup procedures for the test environment.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.MEMORY_CONFIG = exports.performEmergencyCleanup = exports.TestMemoryMonitor = void 0;
const TestMemoryMonitor_1 = require("./utils/TestMemoryMonitor");
Object.defineProperty(exports, "TestMemoryMonitor", { enumerable: true, get: function () { return TestMemoryMonitor_1.TestMemoryMonitor; } });
// Global memory monitor instance
let globalMemoryMonitor = null;
// Memory management configuration
const MEMORY_CONFIG = {
    // Enable garbage collection hints
    enableGC: true,
    // Memory check frequency (every N tests)
    checkFrequency: 5,
    // Force cleanup after memory-intensive tests
    forceCleanupThreshold: 100,
    // Global memory limit before emergency cleanup
    emergencyCleanupThreshold: 500, // MB
};
exports.MEMORY_CONFIG = MEMORY_CONFIG;
// Test counter for periodic memory checks
let testCounter = 0;
/**
 * Initialize global memory monitoring
 */
function initializeMemoryMonitoring() {
    // Create memory monitor with CI-appropriate settings
    globalMemoryMonitor = process.env.CI
        ? TestMemoryMonitor_1.TestMemoryMonitor.createForCI()
        : TestMemoryMonitor_1.TestMemoryMonitor.createDefault();
    // Set up global test cache if not exists
    if (!global.__TEST_CACHE__) {
        global.__TEST_CACHE__ = new Map();
    }
    // Set up global test references array
    if (!global.__TEST_REFS__) {
        global.__TEST_REFS__ = [];
    }
    console.log('Memory monitoring initialized');
}
/**
 * Perform periodic memory checks
 */
function performPeriodicMemoryCheck() {
    testCounter++;
    if (testCounter % MEMORY_CONFIG.checkFrequency === 0 && globalMemoryMonitor) {
        const memoryCheck = globalMemoryMonitor.checkMemoryUsage(`periodic-check-${testCounter}`);
        if (!memoryCheck.isWithinLimits) {
            console.warn(`Memory check failed at test ${testCounter}:`, memoryCheck.errors);
            // Force cleanup if memory usage is too high
            const currentMemoryMB = memoryCheck.currentUsage.heapUsed / (1024 * 1024);
            if (currentMemoryMB > MEMORY_CONFIG.emergencyCleanupThreshold) {
                console.warn('Emergency memory cleanup triggered');
                performEmergencyCleanup();
            }
        }
    }
}
/**
 * Emergency memory cleanup procedure
 */
function performEmergencyCleanup() {
    if (globalMemoryMonitor) {
        globalMemoryMonitor.cleanup('emergency-cleanup');
    }
    // Clear all global caches
    if (global.__TEST_CACHE__) {
        if (typeof global.__TEST_CACHE__.clear === 'function') {
            global.__TEST_CACHE__.clear();
        }
        else {
            global.__TEST_CACHE__ = new Map();
        }
    }
    // Clear test references
    if (global.__TEST_REFS__) {
        global.__TEST_REFS__.length = 0;
    }
    // Force garbage collection if available
    if (global.gc) {
        try {
            global.gc();
            console.log('Emergency garbage collection performed');
        }
        catch (error) {
            console.warn('Failed to perform emergency garbage collection:', error);
        }
    }
    // Reset Jest modules to free memory
    if (jest && jest.resetModules) {
        jest.resetModules();
    }
}
exports.performEmergencyCleanup = performEmergencyCleanup;
/**
 * Setup memory management hooks
 */
function setupMemoryHooks() {
    // Before each test suite
    beforeAll(async () => {
        if (globalMemoryMonitor) {
            globalMemoryMonitor.takeSnapshot('suite-start');
        }
        // Initialize test-specific memory tracking
        if (!global.__TEST_MEMORY_TRACKING__) {
            global.__TEST_MEMORY_TRACKING__ = {
                suiteStartMemory: process.memoryUsage().heapUsed,
                testCount: 0,
                cleanupCount: 0
            };
        }
    });
    // Before each test
    beforeEach(async () => {
        performPeriodicMemoryCheck();
        // Increment test counter
        if (global.__TEST_MEMORY_TRACKING__) {
            global.__TEST_MEMORY_TRACKING__.testCount++;
        }
        // Clear mocks and reset modules for memory efficiency
        jest.clearAllMocks();
        jest.restoreAllMocks();
        // Clear any lingering DOM elements from previous tests
        if (typeof document !== 'undefined') {
            document.body.innerHTML = '';
        }
        // Take memory snapshot for memory-intensive tests
        if (globalMemoryMonitor) {
            const testName = expect.getState().currentTestName || 'unknown-test';
            if (testName.toLowerCase().includes('memory') ||
                testName.toLowerCase().includes('performance') ||
                testName.toLowerCase().includes('integration') ||
                testName.toLowerCase().includes('campaign')) {
                globalMemoryMonitor.takeSnapshot(`before-${testName}`);
            }
        }
    });
    // After each test
    afterEach(async () => {
        const testName = expect.getState().currentTestName || 'unknown-test';
        if (globalMemoryMonitor) {
            const memoryCheck = globalMemoryMonitor.checkMemoryUsage(`after-${testName}`);
            // Force cleanup for memory-intensive tests or if memory usage is high
            const currentMemoryMB = memoryCheck.currentUsage.heapUsed / (1024 * 1024);
            const shouldForceCleanup = currentMemoryMB > MEMORY_CONFIG.forceCleanupThreshold ||
                testName.toLowerCase().includes('memory') ||
                testName.toLowerCase().includes('integration') ||
                testName.toLowerCase().includes('campaign') ||
                testName.toLowerCase().includes('performance');
            if (shouldForceCleanup) {
                globalMemoryMonitor.cleanup(testName);
                if (global.__TEST_MEMORY_TRACKING__) {
                    global.__TEST_MEMORY_TRACKING__.cleanupCount++;
                }
            }
            // Log warnings if memory usage is concerning
            if (memoryCheck.warnings.length > 0) {
                console.warn(`Memory warnings for test "${testName}":`, memoryCheck.warnings);
            }
            // Emergency cleanup if memory usage is critical
            if (currentMemoryMB > MEMORY_CONFIG.emergencyCleanupThreshold) {
                console.warn(`Emergency cleanup triggered for test "${testName}" (${currentMemoryMB.toFixed(2)}MB)`);
                performEmergencyCleanup();
            }
        }
        // Clear any test-specific global references
        if (global.__TEST_REFS__) {
            global.__TEST_REFS__.length = 0;
        }
        // Clear any test-specific DOM event listeners
        if (typeof window !== 'undefined' && window.removeEventListener) {
            // Remove common event listeners that might leak
            ['resize', 'scroll', 'click', 'keydown', 'keyup'].forEach(eventType => {
                var _a;
                const listeners = ((_a = window._eventListeners) === null || _a === void 0 ? void 0 : _a[eventType]) || [];
                listeners.forEach((listener) => {
                    window.removeEventListener(eventType, listener);
                });
            });
        }
    });
    // After each test suite
    afterAll(async () => {
        if (globalMemoryMonitor) {
            globalMemoryMonitor.takeSnapshot('suite-end');
            // Generate memory report for the suite
            const summary = globalMemoryMonitor.getMemorySummary();
            const memoryIncrease = summary.totalIncrease;
            if (memoryIncrease > 25) { // Reduced threshold from 50MB to 25MB
                const tracking = global.__TEST_MEMORY_TRACKING__;
                console.log('Memory usage summary for test suite:', {
                    initialMemory: `${summary.initialMemory.toFixed(2)}MB`,
                    finalMemory: `${summary.currentMemory.toFixed(2)}MB`,
                    peakMemory: `${summary.peakMemory.toFixed(2)}MB`,
                    totalIncrease: `${memoryIncrease.toFixed(2)}MB`,
                    duration: `${(summary.testDuration / 1000).toFixed(2)}s`,
                    testsRun: (tracking === null || tracking === void 0 ? void 0 : tracking.testCount) || 0,
                    cleanupsPerformed: (tracking === null || tracking === void 0 ? void 0 : tracking.cleanupCount) || 0
                });
            }
            // Perform final cleanup
            globalMemoryMonitor.cleanup('suite-cleanup');
        }
        // Final emergency cleanup if needed
        const finalMemory = process.memoryUsage().heapUsed / (1024 * 1024);
        if (finalMemory > MEMORY_CONFIG.emergencyCleanupThreshold) {
            console.warn(`Final emergency cleanup triggered (${finalMemory.toFixed(2)}MB)`);
            performEmergencyCleanup();
        }
        // Clear suite-level tracking
        if (global.__TEST_MEMORY_TRACKING__) {
            delete global.__TEST_MEMORY_TRACKING__;
        }
    });
}
/**
 * Add garbage collection hints
 */
function addGarbageCollectionHints() {
    // Add global utility for manual garbage collection
    global.forceGC = () => {
        if (global.gc) {
            try {
                global.gc();
                return true;
            }
            catch (error) {
                console.warn('Failed to force garbage collection:', error);
                return false;
            }
        }
        return false;
    };
    // Add memory monitoring utilities to global scope
    global.getMemoryUsage = () => {
        const usage = process.memoryUsage();
        return {
            heapUsed: `${(usage.heapUsed / 1024 / 1024).toFixed(2)}MB`,
            heapTotal: `${(usage.heapTotal / 1024 / 1024).toFixed(2)}MB`,
            external: `${(usage.external / 1024 / 1024).toFixed(2)}MB`,
            arrayBuffers: `${(usage.arrayBuffers / 1024 / 1024).toFixed(2)}MB`
        };
    };
    // Add cleanup utility
    global.cleanupTestMemory = () => {
        if (globalMemoryMonitor) {
            return globalMemoryMonitor.cleanup('manual-cleanup');
        }
        return null;
    };
}
/**
 * Configure process-level memory management
 */
function configureProcessMemory() {
    var _a, _b;
    // Set Node.js memory limits if not already set
    if (!((_a = process.env.NODE_OPTIONS) === null || _a === void 0 ? void 0 : _a.includes('--max-old-space-size'))) {
        // Set reasonable memory limit for tests (2GB)
        process.env.NODE_OPTIONS = (process.env.NODE_OPTIONS || '') + ' --max-old-space-size=2048';
    }
    // Enable garbage collection exposure if not already enabled
    if (!((_b = process.env.NODE_OPTIONS) === null || _b === void 0 ? void 0 : _b.includes('--expose-gc'))) {
        process.env.NODE_OPTIONS = (process.env.NODE_OPTIONS || '') + ' --expose-gc';
    }
    // Handle process memory warnings
    process.on('warning', (warning) => {
        var _a, _b, _c;
        if (warning.name === 'MaxListenersExceededWarning' ||
            ((_a = warning.message) === null || _a === void 0 ? void 0 : _a.includes('memory'))) {
            console.warn('Process memory warning:', warning.message);
            // Trigger emergency cleanup on memory warnings
            if (((_b = warning.message) === null || _b === void 0 ? void 0 : _b.includes('memory')) || ((_c = warning.message) === null || _c === void 0 ? void 0 : _c.includes('heap'))) {
                performEmergencyCleanup();
            }
        }
    });
    // Handle uncaught exceptions that might be memory-related
    process.on('uncaughtException', (error) => {
        var _a, _b;
        if (((_a = error.message) === null || _a === void 0 ? void 0 : _a.includes('out of memory')) ||
            ((_b = error.message) === null || _b === void 0 ? void 0 : _b.includes('heap')) ||
            error.name === 'RangeError') {
            console.error('Memory-related uncaught exception:', error.message);
            performEmergencyCleanup();
        }
    });
}
// Initialize memory management
try {
    initializeMemoryMonitoring();
    setupMemoryHooks();
    addGarbageCollectionHints();
    configureProcessMemory();
    console.log('Memory management setup completed successfully');
}
catch (error) {
    console.error('Failed to initialize memory management:', error);
}
exports.default = {};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9fX3Rlc3RzX18vc2V0dXBNZW1vcnlNYW5hZ2VtZW50LnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7R0FLRzs7O0FBRUgsaUVBQThEO0FBK1U1RCxrR0EvVU8scUNBQWlCLE9BK1VQO0FBN1VuQixpQ0FBaUM7QUFDakMsSUFBSSxtQkFBbUIsR0FBNkIsSUFBSSxDQUFDO0FBRXpELGtDQUFrQztBQUNsQyxNQUFNLGFBQWEsR0FBRztJQUNwQixrQ0FBa0M7SUFDbEMsUUFBUSxFQUFFLElBQUk7SUFDZCx5Q0FBeUM7SUFDekMsY0FBYyxFQUFFLENBQUM7SUFDakIsNkNBQTZDO0lBQzdDLHFCQUFxQixFQUFFLEdBQUc7SUFDMUIsK0NBQStDO0lBQy9DLHlCQUF5QixFQUFFLEdBQUcsRUFBRSxLQUFLO0NBQ3RDLENBQUM7QUFrVUEsc0NBQWE7QUFoVWYsMENBQTBDO0FBQzFDLElBQUksV0FBVyxHQUFHLENBQUMsQ0FBQztBQUVwQjs7R0FFRztBQUNILFNBQVMsMEJBQTBCO0lBQ2pDLHFEQUFxRDtJQUNyRCxtQkFBbUIsR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLEVBQUU7UUFDbEMsQ0FBQyxDQUFDLHFDQUFpQixDQUFDLFdBQVcsRUFBRTtRQUNqQyxDQUFDLENBQUMscUNBQWlCLENBQUMsYUFBYSxFQUFFLENBQUM7SUFFdEMseUNBQXlDO0lBQ3pDLElBQUksQ0FBQyxNQUFNLENBQUMsY0FBYyxFQUFFO1FBQzFCLE1BQU0sQ0FBQyxjQUFjLEdBQUcsSUFBSSxHQUFHLEVBQUUsQ0FBQztLQUNuQztJQUVELHNDQUFzQztJQUN0QyxJQUFJLENBQUMsTUFBTSxDQUFDLGFBQWEsRUFBRTtRQUN6QixNQUFNLENBQUMsYUFBYSxHQUFHLEVBQUUsQ0FBQztLQUMzQjtJQUVELE9BQU8sQ0FBQyxHQUFHLENBQUMsK0JBQStCLENBQUMsQ0FBQztBQUMvQyxDQUFDO0FBRUQ7O0dBRUc7QUFDSCxTQUFTLDBCQUEwQjtJQUNqQyxX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QixLQUFLLENBQUMsSUFBSSxLQUFLLFlBQVksRUFBRTtZQUMvQixPQUFPLENBQUMsS0FBSyxDQUFDLG9DQUFvQyxFQUFFLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUNuRSx1QkFBdUIsRUFBRSxDQUFDO1NBQzNCO0lBQ0gsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDO0FBRUQsK0JBQStCO0FBQy9CLElBQUk7SUFDRiwwQkFBMEIsRUFBRSxDQUFDO0lBQzdCLGdCQUFnQixFQUFFLENBQUM7SUFDbkIseUJBQXlCLEVBQUUsQ0FBQztJQUM1QixzQkFBc0IsRUFBRSxDQUFDO0lBRXpCLE9BQU8sQ0FBQyxHQUFHLENBQUMsZ0RBQWdELENBQUMsQ0FBQztDQUMvRDtBQUFDLE9BQU8sS0FBSyxFQUFFO0lBQ2QsT0FBTyxDQUFDLEtBQUssQ0FBQyx5Q0FBeUMsRUFBRSxLQUFLLENBQUMsQ0FBQztDQUNqRTtBQTRCRCxrQkFBZSxFQUFFLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9fX3Rlc3RzX18vc2V0dXBNZW1vcnlNYW5hZ2VtZW50LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogTWVtb3J5IE1hbmFnZW1lbnQgU2V0dXAgZm9yIEplc3QgVGVzdHNcbiAqIFxuICogVGhpcyBmaWxlIGNvbmZpZ3VyZXMgbWVtb3J5IG1hbmFnZW1lbnQsIGdhcmJhZ2UgY29sbGVjdGlvbiBoaW50cyxcbiAqIGFuZCBjbGVhbnVwIHByb2NlZHVyZXMgZm9yIHRoZSB0ZXN0IGVudmlyb25tZW50LlxuICovXG5cbmltcG9ydCB7IFRlc3RNZW1vcnlNb25pdG9yIH0gZnJvbSAnLi91dGlscy9UZXN0TWVtb3J5TW9uaXRvcic7XG5cbi8vIEdsb2JhbCBtZW1vcnkgbW9uaXRvciBpbnN0YW5jZVxubGV0IGdsb2JhbE1lbW9yeU1vbml0b3I6IFRlc3RNZW1vcnlNb25pdG9yIHwgbnVsbCA9IG51bGw7XG5cbi8vIE1lbW9yeSBtYW5hZ2VtZW50IGNvbmZpZ3VyYXRpb25cbmNvbnN0IE1FTU9SWV9DT05GSUcgPSB7XG4gIC8vIEVuYWJsZSBnYXJiYWdlIGNvbGxlY3Rpb24gaGludHNcbiAgZW5hYmxlR0M6IHRydWUsXG4gIC8vIE1lbW9yeSBjaGVjayBmcmVxdWVuY3kgKGV2ZXJ5IE4gdGVzdHMpXG4gIGNoZWNrRnJlcXVlbmN5OiA1LFxuICAvLyBGb3JjZSBjbGVhbnVwIGFmdGVyIG1lbW9yeS1pbnRlbnNpdmUgdGVzdHNcbiAgZm9yY2VDbGVhbnVwVGhyZXNob2xkOiAxMDAsIC8vIE1CXG4gIC8vIEdsb2JhbCBtZW1vcnkgbGltaXQgYmVmb3JlIGVtZXJnZW5jeSBjbGVhbnVwXG4gIGVtZXJnZW5jeUNsZWFudXBUaHJlc2hvbGQ6IDUwMCwgLy8gTUJcbn07XG5cbi8vIFRlc3QgY291bnRlciBmb3IgcGVyaW9kaWMgbWVtb3J5IGNoZWNrc1xubGV0IHRlc3RDb3VudGVyID0gMDtcblxuLyoqXG4gKiBJbml0aWFsaXplIGdsb2JhbCBtZW1vcnkgbW9uaXRvcmluZ1xuICovXG5mdW5jdGlvbiBpbml0aWFsaXplTWVtb3J5TW9uaXRvcmluZygpOiB2b2lkIHtcbiAgLy8gQ3JlYXRlIG1lbW9yeSBtb25pdG9yIHdpdGggQ0ktYXBwcm9wcmlhdGUgc2V0dGluZ3NcbiAgZ2xvYmFsTWVtb3J5TW9uaXRvciA9IHByb2Nlc3MuZW52LkNJIFxuICAgID8gVGVzdE1lbW9yeU1vbml0b3IuY3JlYXRlRm9yQ0koKVxuICAgIDogVGVzdE1lbW9yeU1vbml0b3IuY3JlYXRlRGVmYXVsdCgpO1xuXG4gIC8vIFNldCB1cCBnbG9iYWwgdGVzdCBjYWNoZSBpZiBub3QgZXhpc3RzXG4gIGlmICghZ2xvYmFsLl9fVEVTVF9DQUNIRV9fKSB7XG4gICAgZ2xvYmFsLl9fVEVTVF9DQUNIRV9fID0gbmV3IE1hcCgpO1xuICB9XG5cbiAgLy8gU2V0IHVwIGdsb2JhbCB0ZXN0IHJlZmVyZW5jZXMgYXJyYXlcbiAgaWYgKCFnbG9iYWwuX19URVNUX1JFRlNfXykge1xuICAgIGdsb2JhbC5fX1RFU1RfUkVGU19fID0gW107XG4gIH1cblxuICBjb25zb2xlLmxvZygnTWVtb3J5IG1vbml0b3JpbmcgaW5pdGlhbGl6ZWQnKTtcbn1cblxuLyoqXG4gKiBQZXJmb3JtIHBlcmlvZGljIG1lbW9yeSBjaGVja3NcbiAqL1xuZnVuY3Rpb24gcGVyZm9ybVBlcmlvZGljTWVtb3J5Q2hlY2soKTogdm9pZCB7XG4gIHRlc3RDb3VudGVyKys7XG4gIFxuICBpZiAodGVzdENvdW50ZXIgJSBNRU1PUllfQ09ORklHLmNoZWNrRnJlcXVlbmN5ID09PSAwICYmIGdsb2JhbE1lbW9yeU1vbml0b3IpIHtcbiAgICBjb25zdCBtZW1vcnlDaGVjayA9IGdsb2JhbE1lbW9yeU1vbml0b3IuY2hlY2tNZW1vcnlVc2FnZShgcGVyaW9kaWMtY2hlY2stJHt0ZXN0Q291bnRlcn1gKTtcbiAgICBcbiAgICBpZiAoIW1lbW9yeUNoZWNrLmlzV2l0aGluTGltaXRzKSB7XG4gICAgICBjb25zb2xlLndhcm4oYE1lbW9yeSBjaGVjayBmYWlsZWQgYXQgdGVzdCAke3Rlc3RDb3VudGVyfTpgLCBtZW1vcnlDaGVjay5lcnJvcnMpO1xuICAgICAgXG4gICAgICAvLyBGb3JjZSBjbGVhbnVwIGlmIG1lbW9yeSB1c2FnZSBpcyB0b28gaGlnaFxuICAgICAgY29uc3QgY3VycmVudE1lbW9yeU1CID0gbWVtb3J5Q2hlY2suY3VycmVudFVzYWdlLmhlYXBVc2VkIC8gKDEwMjQgKiAxMDI0KTtcbiAgICAgIGlmIChjdXJyZW50TWVtb3J5TUIgPiBNRU1PUllfQ09ORklHLmVtZXJnZW5jeUNsZWFudXBUaHJlc2hvbGQpIHtcbiAgICAgICAgY29uc29sZS53YXJuKCdFbWVyZ2VuY3kgbWVtb3J5IGNsZWFudXAgdHJpZ2dlcmVkJyk7XG4gICAgICAgIHBlcmZvcm1FbWVyZ2VuY3lDbGVhbnVwKCk7XG4gICAgICB9XG4gICAgfVxuICB9XG59XG5cbi8qKlxuICogRW1lcmdlbmN5IG1lbW9yeSBjbGVhbnVwIHByb2NlZHVyZVxuICovXG5mdW5jdGlvbiBwZXJmb3JtRW1lcmdlbmN5Q2xlYW51cCgpOiB2b2lkIHtcbiAgaWYgKGdsb2JhbE1lbW9yeU1vbml0b3IpIHtcbiAgICBnbG9iYWxNZW1vcnlNb25pdG9yLmNsZWFudXAoJ2VtZXJnZW5jeS1jbGVhbnVwJyk7XG4gIH1cbiAgXG4gIC8vIENsZWFyIGFsbCBnbG9iYWwgY2FjaGVzXG4gIGlmIChnbG9iYWwuX19URVNUX0NBQ0hFX18pIHtcbiAgICBpZiAodHlwZW9mIGdsb2JhbC5fX1RFU1RfQ0FDSEVfXy5jbGVhciA9PT0gJ2Z1bmN0aW9uJykge1xuICAgICAgZ2xvYmFsLl9fVEVTVF9DQUNIRV9fLmNsZWFyKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGdsb2JhbC5fX1RFU1RfQ0FDSEVfXyA9IG5ldyBNYXAoKTtcbiAgICB9XG4gIH1cbiAgXG4gIC8vIENsZWFyIHRlc3QgcmVmZXJlbmNlc1xuICBpZiAoZ2xvYmFsLl9fVEVTVF9SRUZTX18pIHtcbiAgICBnbG9iYWwuX19URVNUX1JFRlNfXy5sZW5ndGggPSAwO1xuICB9XG4gIFxuICAvLyBGb3JjZSBnYXJiYWdlIGNvbGxlY3Rpb24gaWYgYXZhaWxhYmxlXG4gIGlmIChnbG9iYWwuZ2MpIHtcbiAgICB0cnkge1xuICAgICAgZ2xvYmFsLmdjKCk7XG4gICAgICBjb25zb2xlLmxvZygnRW1lcmdlbmN5IGdhcmJhZ2UgY29sbGVjdGlvbiBwZXJmb3JtZWQnKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS53YXJuKCdGYWlsZWQgdG8gcGVyZm9ybSBlbWVyZ2VuY3kgZ2FyYmFnZSBjb2xsZWN0aW9uOicsIGVycm9yKTtcbiAgICB9XG4gIH1cbiAgXG4gIC8vIFJlc2V0IEplc3QgbW9kdWxlcyB0byBmcmVlIG1lbW9yeVxuICBpZiAoamVzdCAmJiBqZXN0LnJlc2V0TW9kdWxlcykge1xuICAgIGplc3QucmVzZXRNb2R1bGVzKCk7XG4gIH1cbn1cblxuLyoqXG4gKiBTZXR1cCBtZW1vcnkgbWFuYWdlbWVudCBob29rc1xuICovXG5mdW5jdGlvbiBzZXR1cE1lbW9yeUhvb2tzKCk6IHZvaWQge1xuICAvLyBCZWZvcmUgZWFjaCB0ZXN0IHN1aXRlXG4gIGJlZm9yZUFsbChhc3luYyAoKSA9PiB7XG4gICAgaWYgKGdsb2JhbE1lbW9yeU1vbml0b3IpIHtcbiAgICAgIGdsb2JhbE1lbW9yeU1vbml0b3IudGFrZVNuYXBzaG90KCdzdWl0ZS1zdGFydCcpO1xuICAgIH1cbiAgICBcbiAgICAvLyBJbml0aWFsaXplIHRlc3Qtc3BlY2lmaWMgbWVtb3J5IHRyYWNraW5nXG4gICAgaWYgKCFnbG9iYWwuX19URVNUX01FTU9SWV9UUkFDS0lOR19fKSB7XG4gICAgICBnbG9iYWwuX19URVNUX01FTU9SWV9UUkFDS0lOR19fID0ge1xuICAgICAgICBzdWl0ZVN0YXJ0TWVtb3J5OiBwcm9jZXNzLm1lbW9yeVVzYWdlKCkuaGVhcFVzZWQsXG4gICAgICAgIHRlc3RDb3VudDogMCxcbiAgICAgICAgY2xlYW51cENvdW50OiAwXG4gICAgICB9O1xuICAgIH1cbiAgfSk7XG5cbiAgLy8gQmVmb3JlIGVhY2ggdGVzdFxuICBiZWZvcmVFYWNoKGFzeW5jICgpID0+IHtcbiAgICBwZXJmb3JtUGVyaW9kaWNNZW1vcnlDaGVjaygpO1xuICAgIFxuICAgIC8vIEluY3JlbWVudCB0ZXN0IGNvdW50ZXJcbiAgICBpZiAoZ2xvYmFsLl9fVEVTVF9NRU1PUllfVFJBQ0tJTkdfXykge1xuICAgICAgZ2xvYmFsLl9fVEVTVF9NRU1PUllfVFJBQ0tJTkdfXy50ZXN0Q291bnQrKztcbiAgICB9XG4gICAgXG4gICAgLy8gQ2xlYXIgbW9ja3MgYW5kIHJlc2V0IG1vZHVsZXMgZm9yIG1lbW9yeSBlZmZpY2llbmN5XG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG4gICAgamVzdC5yZXN0b3JlQWxsTW9ja3MoKTtcbiAgICBcbiAgICAvLyBDbGVhciBhbnkgbGluZ2VyaW5nIERPTSBlbGVtZW50cyBmcm9tIHByZXZpb3VzIHRlc3RzXG4gICAgaWYgKHR5cGVvZiBkb2N1bWVudCAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIGRvY3VtZW50LmJvZHkuaW5uZXJIVE1MID0gJyc7XG4gICAgfVxuICAgIFxuICAgIC8vIFRha2UgbWVtb3J5IHNuYXBzaG90IGZvciBtZW1vcnktaW50ZW5zaXZlIHRlc3RzXG4gICAgaWYgKGdsb2JhbE1lbW9yeU1vbml0b3IpIHtcbiAgICAgIGNvbnN0IHRlc3ROYW1lID0gZXhwZWN0LmdldFN0YXRlKCkuY3VycmVudFRlc3ROYW1lIHx8ICd1bmtub3duLXRlc3QnO1xuICAgICAgaWYgKHRlc3ROYW1lLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoJ21lbW9yeScpIHx8IFxuICAgICAgICAgIHRlc3ROYW1lLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoJ3BlcmZvcm1hbmNlJykgfHxcbiAgICAgICAgICB0ZXN0TmFtZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKCdpbnRlZ3JhdGlvbicpIHx8XG4gICAgICAgICAgdGVzdE5hbWUudG9Mb3dlckNhc2UoKS5pbmNsdWRlcygnY2FtcGFpZ24nKSkge1xuICAgICAgICBnbG9iYWxNZW1vcnlNb25pdG9yLnRha2VTbmFwc2hvdChgYmVmb3JlLSR7dGVzdE5hbWV9YCk7XG4gICAgICB9XG4gICAgfVxuICB9KTtcblxuICAvLyBBZnRlciBlYWNoIHRlc3RcbiAgYWZ0ZXJFYWNoKGFzeW5jICgpID0+IHtcbiAgICBjb25zdCB0ZXN0TmFtZSA9IGV4cGVjdC5nZXRTdGF0ZSgpLmN1cnJlbnRUZXN0TmFtZSB8fCAndW5rbm93bi10ZXN0JztcbiAgICBcbiAgICBpZiAoZ2xvYmFsTWVtb3J5TW9uaXRvcikge1xuICAgICAgY29uc3QgbWVtb3J5Q2hlY2sgPSBnbG9iYWxNZW1vcnlNb25pdG9yLmNoZWNrTWVtb3J5VXNhZ2UoYGFmdGVyLSR7dGVzdE5hbWV9YCk7XG4gICAgICBcbiAgICAgIC8vIEZvcmNlIGNsZWFudXAgZm9yIG1lbW9yeS1pbnRlbnNpdmUgdGVzdHMgb3IgaWYgbWVtb3J5IHVzYWdlIGlzIGhpZ2hcbiAgICAgIGNvbnN0IGN1cnJlbnRNZW1vcnlNQiA9IG1lbW9yeUNoZWNrLmN1cnJlbnRVc2FnZS5oZWFwVXNlZCAvICgxMDI0ICogMTAyNCk7XG4gICAgICBjb25zdCBzaG91bGRGb3JjZUNsZWFudXAgPSBjdXJyZW50TWVtb3J5TUIgPiBNRU1PUllfQ09ORklHLmZvcmNlQ2xlYW51cFRocmVzaG9sZCB8fCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVzdE5hbWUudG9Mb3dlckNhc2UoKS5pbmNsdWRlcygnbWVtb3J5JykgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGVzdE5hbWUudG9Mb3dlckNhc2UoKS5pbmNsdWRlcygnaW50ZWdyYXRpb24nKSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXN0TmFtZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKCdjYW1wYWlnbicpIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlc3ROYW1lLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoJ3BlcmZvcm1hbmNlJyk7XG4gICAgICBcbiAgICAgIGlmIChzaG91bGRGb3JjZUNsZWFudXApIHtcbiAgICAgICAgZ2xvYmFsTWVtb3J5TW9uaXRvci5jbGVhbnVwKHRlc3ROYW1lKTtcbiAgICAgICAgXG4gICAgICAgIGlmIChnbG9iYWwuX19URVNUX01FTU9SWV9UUkFDS0lOR19fKSB7XG4gICAgICAgICAgZ2xvYmFsLl9fVEVTVF9NRU1PUllfVFJBQ0tJTkdfXy5jbGVhbnVwQ291bnQrKztcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBMb2cgd2FybmluZ3MgaWYgbWVtb3J5IHVzYWdlIGlzIGNvbmNlcm5pbmdcbiAgICAgIGlmIChtZW1vcnlDaGVjay53YXJuaW5ncy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGNvbnNvbGUud2FybihgTWVtb3J5IHdhcm5pbmdzIGZvciB0ZXN0IFwiJHt0ZXN0TmFtZX1cIjpgLCBtZW1vcnlDaGVjay53YXJuaW5ncyk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIEVtZXJnZW5jeSBjbGVhbnVwIGlmIG1lbW9yeSB1c2FnZSBpcyBjcml0aWNhbFxuICAgICAgaWYgKGN1cnJlbnRNZW1vcnlNQiA+IE1FTU9SWV9DT05GSUcuZW1lcmdlbmN5Q2xlYW51cFRocmVzaG9sZCkge1xuICAgICAgICBjb25zb2xlLndhcm4oYEVtZXJnZW5jeSBjbGVhbnVwIHRyaWdnZXJlZCBmb3IgdGVzdCBcIiR7dGVzdE5hbWV9XCIgKCR7Y3VycmVudE1lbW9yeU1CLnRvRml4ZWQoMil9TUIpYCk7XG4gICAgICAgIHBlcmZvcm1FbWVyZ2VuY3lDbGVhbnVwKCk7XG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIC8vIENsZWFyIGFueSB0ZXN0LXNwZWNpZmljIGdsb2JhbCByZWZlcmVuY2VzXG4gICAgaWYgKGdsb2JhbC5fX1RFU1RfUkVGU19fKSB7XG4gICAgICBnbG9iYWwuX19URVNUX1JFRlNfXy5sZW5ndGggPSAwO1xuICAgIH1cbiAgICBcbiAgICAvLyBDbGVhciBhbnkgdGVzdC1zcGVjaWZpYyBET00gZXZlbnQgbGlzdGVuZXJzXG4gICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnICYmIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKSB7XG4gICAgICAvLyBSZW1vdmUgY29tbW9uIGV2ZW50IGxpc3RlbmVycyB0aGF0IG1pZ2h0IGxlYWtcbiAgICAgIFsncmVzaXplJywgJ3Njcm9sbCcsICdjbGljaycsICdrZXlkb3duJywgJ2tleXVwJ10uZm9yRWFjaChldmVudFR5cGUgPT4ge1xuICAgICAgICBjb25zdCBsaXN0ZW5lcnMgPSAod2luZG93IGFzIGFueSkuX2V2ZW50TGlzdGVuZXJzPy5bZXZlbnRUeXBlXSB8fCBbXTtcbiAgICAgICAgbGlzdGVuZXJzLmZvckVhY2goKGxpc3RlbmVyOiBhbnkpID0+IHtcbiAgICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcihldmVudFR5cGUsIGxpc3RlbmVyKTtcbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xuXG4gIC8vIEFmdGVyIGVhY2ggdGVzdCBzdWl0ZVxuICBhZnRlckFsbChhc3luYyAoKSA9PiB7XG4gICAgaWYgKGdsb2JhbE1lbW9yeU1vbml0b3IpIHtcbiAgICAgIGdsb2JhbE1lbW9yeU1vbml0b3IudGFrZVNuYXBzaG90KCdzdWl0ZS1lbmQnKTtcbiAgICAgIFxuICAgICAgLy8gR2VuZXJhdGUgbWVtb3J5IHJlcG9ydCBmb3IgdGhlIHN1aXRlXG4gICAgICBjb25zdCBzdW1tYXJ5ID0gZ2xvYmFsTWVtb3J5TW9uaXRvci5nZXRNZW1vcnlTdW1tYXJ5KCk7XG4gICAgICBjb25zdCBtZW1vcnlJbmNyZWFzZSA9IHN1bW1hcnkudG90YWxJbmNyZWFzZTtcbiAgICAgIFxuICAgICAgaWYgKG1lbW9yeUluY3JlYXNlID4gMjUpIHsgLy8gUmVkdWNlZCB0aHJlc2hvbGQgZnJvbSA1ME1CIHRvIDI1TUJcbiAgICAgICAgY29uc3QgdHJhY2tpbmcgPSBnbG9iYWwuX19URVNUX01FTU9SWV9UUkFDS0lOR19fO1xuICAgICAgICBjb25zb2xlLmxvZygnTWVtb3J5IHVzYWdlIHN1bW1hcnkgZm9yIHRlc3Qgc3VpdGU6Jywge1xuICAgICAgICAgIGluaXRpYWxNZW1vcnk6IGAke3N1bW1hcnkuaW5pdGlhbE1lbW9yeS50b0ZpeGVkKDIpfU1CYCxcbiAgICAgICAgICBmaW5hbE1lbW9yeTogYCR7c3VtbWFyeS5jdXJyZW50TWVtb3J5LnRvRml4ZWQoMil9TUJgLFxuICAgICAgICAgIHBlYWtNZW1vcnk6IGAke3N1bW1hcnkucGVha01lbW9yeS50b0ZpeGVkKDIpfU1CYCxcbiAgICAgICAgICB0b3RhbEluY3JlYXNlOiBgJHttZW1vcnlJbmNyZWFzZS50b0ZpeGVkKDIpfU1CYCxcbiAgICAgICAgICBkdXJhdGlvbjogYCR7KHN1bW1hcnkudGVzdER1cmF0aW9uIC8gMTAwMCkudG9GaXhlZCgyKX1zYCxcbiAgICAgICAgICB0ZXN0c1J1bjogdHJhY2tpbmc/LnRlc3RDb3VudCB8fCAwLFxuICAgICAgICAgIGNsZWFudXBzUGVyZm9ybWVkOiB0cmFja2luZz8uY2xlYW51cENvdW50IHx8IDBcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIFBlcmZvcm0gZmluYWwgY2xlYW51cFxuICAgICAgZ2xvYmFsTWVtb3J5TW9uaXRvci5jbGVhbnVwKCdzdWl0ZS1jbGVhbnVwJyk7XG4gICAgfVxuICAgIFxuICAgIC8vIEZpbmFsIGVtZXJnZW5jeSBjbGVhbnVwIGlmIG5lZWRlZFxuICAgIGNvbnN0IGZpbmFsTWVtb3J5ID0gcHJvY2Vzcy5tZW1vcnlVc2FnZSgpLmhlYXBVc2VkIC8gKDEwMjQgKiAxMDI0KTtcbiAgICBpZiAoZmluYWxNZW1vcnkgPiBNRU1PUllfQ09ORklHLmVtZXJnZW5jeUNsZWFudXBUaHJlc2hvbGQpIHtcbiAgICAgIGNvbnNvbGUud2FybihgRmluYWwgZW1lcmdlbmN5IGNsZWFudXAgdHJpZ2dlcmVkICgke2ZpbmFsTWVtb3J5LnRvRml4ZWQoMil9TUIpYCk7XG4gICAgICBwZXJmb3JtRW1lcmdlbmN5Q2xlYW51cCgpO1xuICAgIH1cbiAgICBcbiAgICAvLyBDbGVhciBzdWl0ZS1sZXZlbCB0cmFja2luZ1xuICAgIGlmIChnbG9iYWwuX19URVNUX01FTU9SWV9UUkFDS0lOR19fKSB7XG4gICAgICBkZWxldGUgZ2xvYmFsLl9fVEVTVF9NRU1PUllfVFJBQ0tJTkdfXztcbiAgICB9XG4gIH0pO1xufVxuXG4vKipcbiAqIEFkZCBnYXJiYWdlIGNvbGxlY3Rpb24gaGludHNcbiAqL1xuZnVuY3Rpb24gYWRkR2FyYmFnZUNvbGxlY3Rpb25IaW50cygpOiB2b2lkIHtcbiAgLy8gQWRkIGdsb2JhbCB1dGlsaXR5IGZvciBtYW51YWwgZ2FyYmFnZSBjb2xsZWN0aW9uXG4gIGdsb2JhbC5mb3JjZUdDID0gKCkgPT4ge1xuICAgIGlmIChnbG9iYWwuZ2MpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGdsb2JhbC5nYygpO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUud2FybignRmFpbGVkIHRvIGZvcmNlIGdhcmJhZ2UgY29sbGVjdGlvbjonLCBlcnJvcik7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9O1xuICBcbiAgLy8gQWRkIG1lbW9yeSBtb25pdG9yaW5nIHV0aWxpdGllcyB0byBnbG9iYWwgc2NvcGVcbiAgZ2xvYmFsLmdldE1lbW9yeVVzYWdlID0gKCkgPT4ge1xuICAgIGNvbnN0IHVzYWdlID0gcHJvY2Vzcy5tZW1vcnlVc2FnZSgpO1xuICAgIHJldHVybiB7XG4gICAgICBoZWFwVXNlZDogYCR7KHVzYWdlLmhlYXBVc2VkIC8gMTAyNCAvIDEwMjQpLnRvRml4ZWQoMil9TUJgLFxuICAgICAgaGVhcFRvdGFsOiBgJHsodXNhZ2UuaGVhcFRvdGFsIC8gMTAyNCAvIDEwMjQpLnRvRml4ZWQoMil9TUJgLFxuICAgICAgZXh0ZXJuYWw6IGAkeyh1c2FnZS5leHRlcm5hbCAvIDEwMjQgLyAxMDI0KS50b0ZpeGVkKDIpfU1CYCxcbiAgICAgIGFycmF5QnVmZmVyczogYCR7KHVzYWdlLmFycmF5QnVmZmVycyAvIDEwMjQgLyAxMDI0KS50b0ZpeGVkKDIpfU1CYFxuICAgIH07XG4gIH07XG4gIFxuICAvLyBBZGQgY2xlYW51cCB1dGlsaXR5XG4gIGdsb2JhbC5jbGVhbnVwVGVzdE1lbW9yeSA9ICgpID0+IHtcbiAgICBpZiAoZ2xvYmFsTWVtb3J5TW9uaXRvcikge1xuICAgICAgcmV0dXJuIGdsb2JhbE1lbW9yeU1vbml0b3IuY2xlYW51cCgnbWFudWFsLWNsZWFudXAnKTtcbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG4gIH07XG59XG5cbi8qKlxuICogQ29uZmlndXJlIHByb2Nlc3MtbGV2ZWwgbWVtb3J5IG1hbmFnZW1lbnRcbiAqL1xuZnVuY3Rpb24gY29uZmlndXJlUHJvY2Vzc01lbW9yeSgpOiB2b2lkIHtcbiAgLy8gU2V0IE5vZGUuanMgbWVtb3J5IGxpbWl0cyBpZiBub3QgYWxyZWFkeSBzZXRcbiAgaWYgKCFwcm9jZXNzLmVudi5OT0RFX09QVElPTlM/LmluY2x1ZGVzKCctLW1heC1vbGQtc3BhY2Utc2l6ZScpKSB7XG4gICAgLy8gU2V0IHJlYXNvbmFibGUgbWVtb3J5IGxpbWl0IGZvciB0ZXN0cyAoMkdCKVxuICAgIHByb2Nlc3MuZW52Lk5PREVfT1BUSU9OUyA9IChwcm9jZXNzLmVudi5OT0RFX09QVElPTlMgfHwgJycpICsgJyAtLW1heC1vbGQtc3BhY2Utc2l6ZT0yMDQ4JztcbiAgfVxuICBcbiAgLy8gRW5hYmxlIGdhcmJhZ2UgY29sbGVjdGlvbiBleHBvc3VyZSBpZiBub3QgYWxyZWFkeSBlbmFibGVkXG4gIGlmICghcHJvY2Vzcy5lbnYuTk9ERV9PUFRJT05TPy5pbmNsdWRlcygnLS1leHBvc2UtZ2MnKSkge1xuICAgIHByb2Nlc3MuZW52Lk5PREVfT1BUSU9OUyA9IChwcm9jZXNzLmVudi5OT0RFX09QVElPTlMgfHwgJycpICsgJyAtLWV4cG9zZS1nYyc7XG4gIH1cbiAgXG4gIC8vIEhhbmRsZSBwcm9jZXNzIG1lbW9yeSB3YXJuaW5nc1xuICBwcm9jZXNzLm9uKCd3YXJuaW5nJywgKHdhcm5pbmcpID0+IHtcbiAgICBpZiAod2FybmluZy5uYW1lID09PSAnTWF4TGlzdGVuZXJzRXhjZWVkZWRXYXJuaW5nJyB8fCBcbiAgICAgICAgd2FybmluZy5tZXNzYWdlPy5pbmNsdWRlcygnbWVtb3J5JykpIHtcbiAgICAgIGNvbnNvbGUud2FybignUHJvY2VzcyBtZW1vcnkgd2FybmluZzonLCB3YXJuaW5nLm1lc3NhZ2UpO1xuICAgICAgXG4gICAgICAvLyBUcmlnZ2VyIGVtZXJnZW5jeSBjbGVhbnVwIG9uIG1lbW9yeSB3YXJuaW5nc1xuICAgICAgaWYgKHdhcm5pbmcubWVzc2FnZT8uaW5jbHVkZXMoJ21lbW9yeScpIHx8IHdhcm5pbmcubWVzc2FnZT8uaW5jbHVkZXMoJ2hlYXAnKSkge1xuICAgICAgICBwZXJmb3JtRW1lcmdlbmN5Q2xlYW51cCgpO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG4gIFxuICAvLyBIYW5kbGUgdW5jYXVnaHQgZXhjZXB0aW9ucyB0aGF0IG1pZ2h0IGJlIG1lbW9yeS1yZWxhdGVkXG4gIHByb2Nlc3Mub24oJ3VuY2F1Z2h0RXhjZXB0aW9uJywgKGVycm9yKSA9PiB7XG4gICAgaWYgKGVycm9yLm1lc3NhZ2U/LmluY2x1ZGVzKCdvdXQgb2YgbWVtb3J5JykgfHwgXG4gICAgICAgIGVycm9yLm1lc3NhZ2U/LmluY2x1ZGVzKCdoZWFwJykgfHxcbiAgICAgICAgZXJyb3IubmFtZSA9PT0gJ1JhbmdlRXJyb3InKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdNZW1vcnktcmVsYXRlZCB1bmNhdWdodCBleGNlcHRpb246JywgZXJyb3IubWVzc2FnZSk7XG4gICAgICBwZXJmb3JtRW1lcmdlbmN5Q2xlYW51cCgpO1xuICAgIH1cbiAgfSk7XG59XG5cbi8vIEluaXRpYWxpemUgbWVtb3J5IG1hbmFnZW1lbnRcbnRyeSB7XG4gIGluaXRpYWxpemVNZW1vcnlNb25pdG9yaW5nKCk7XG4gIHNldHVwTWVtb3J5SG9va3MoKTtcbiAgYWRkR2FyYmFnZUNvbGxlY3Rpb25IaW50cygpO1xuICBjb25maWd1cmVQcm9jZXNzTWVtb3J5KCk7XG4gIFxuICBjb25zb2xlLmxvZygnTWVtb3J5IG1hbmFnZW1lbnQgc2V0dXAgY29tcGxldGVkIHN1Y2Nlc3NmdWxseScpO1xufSBjYXRjaCAoZXJyb3IpIHtcbiAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGluaXRpYWxpemUgbWVtb3J5IG1hbmFnZW1lbnQ6JywgZXJyb3IpO1xufVxuXG4vLyBFeHBvcnQgdXRpbGl0aWVzIGZvciB1c2UgaW4gdGVzdHNcbmV4cG9ydCB7XG4gIFRlc3RNZW1vcnlNb25pdG9yLFxuICBwZXJmb3JtRW1lcmdlbmN5Q2xlYW51cCxcbiAgTUVNT1JZX0NPTkZJR1xufTtcblxuLy8gR2xvYmFsIHR5cGUgZGVjbGFyYXRpb25zXG5kZWNsYXJlIGdsb2JhbCB7XG4gIHZhciBmb3JjZUdDOiAoKSA9PiBib29sZWFuO1xuICB2YXIgZ2V0TWVtb3J5VXNhZ2U6ICgpID0+IHtcbiAgICBoZWFwVXNlZDogc3RyaW5nO1xuICAgIGhlYXBUb3RhbDogc3RyaW5nO1xuICAgIGV4dGVybmFsOiBzdHJpbmc7XG4gICAgYXJyYXlCdWZmZXJzOiBzdHJpbmc7XG4gIH07XG4gIHZhciBjbGVhbnVwVGVzdE1lbW9yeTogKCkgPT4gYW55O1xuICB2YXIgX19URVNUX0NBQ0hFX186IE1hcDxzdHJpbmcsIGFueT4gfCB7IGNsZWFyOiAoKSA9PiB2b2lkIH07XG4gIHZhciBfX1RFU1RfUkVGU19fOiBhbnlbXTtcbiAgdmFyIF9fVEVTVF9NRU1PUllfVFJBQ0tJTkdfXzoge1xuICAgIHN1aXRlU3RhcnRNZW1vcnk6IG51bWJlcjtcbiAgICB0ZXN0Q291bnQ6IG51bWJlcjtcbiAgICBjbGVhbnVwQ291bnQ6IG51bWJlcjtcbiAgfTtcbn1cblxuZXhwb3J0IGRlZmF1bHQge307Il0sInZlcnNpb24iOjN9