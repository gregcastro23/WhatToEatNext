55cecbbf65a69d2644ffa12cd4e38d84
"use strict";
/**
 * Linting Alerting System with Performance Monitoring
 *
 * Provides real-time alerting for linting regression detection
 * with performance monitoring and automated response capabilities.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.LintingAlertingSystem = void 0;
const child_process_1 = require("child_process");
const fs_1 = require("fs");
class LintingAlertingSystem {
    configFile = '.kiro/metrics/alerting-config.json';
    historyFile = '.kiro/metrics/alerting-history.json';
    suppressionFile = '.kiro/metrics/alert-suppressions.json';
    config;
    lastAlertTime = new Map();
    suppressedAlerts = new Set();
    constructor() {
        this.config = this.loadConfiguration();
        this.loadSuppressions();
    }
    /**
     * Process alerts and trigger appropriate responses
     */
    async processAlerts(alerts, metrics) {
        if (!this.config.enabled) {
            return;
        }
        console.log(`üö® Processing ${alerts.length} alerts...`);
        // Filter alerts based on cooldown and suppression
        const activeAlerts = this.filterActiveAlerts(alerts);
        // Process performance monitoring
        const performanceEvents = await this.monitorPerformance(metrics);
        // Send alerts through configured channels
        for (const alert of activeAlerts) {
            await this.sendAlert(alert);
            this.updateAlertHistory(alert);
        }
        // Process performance events
        for (const event of performanceEvents) {
            await this.processPerformanceEvent(event);
        }
        // Trigger auto-responses if configured
        if (this.config.autoResponse.enabled) {
            await this.triggerAutoResponses(activeAlerts, performanceEvents);
        }
        console.log(`‚úÖ Processed ${activeAlerts.length} active alerts and ${performanceEvents.length} performance events`);
    }
    /**
     * Monitor performance metrics and detect issues
     */
    async monitorPerformance(metrics) {
        if (!this.config.performanceMonitoring.enabled) {
            return [];
        }
        const events = [];
        const thresholds = this.config.performanceMonitoring.thresholds;
        for (const threshold of thresholds) {
            const value = this.getPerformanceMetricValue(metrics, threshold.metric);
            if (this.isThresholdExceeded(value, threshold)) {
                const event = {
                    id: `perf-${threshold.metric}-${Date.now()}`,
                    timestamp: new Date(),
                    type: 'threshold_exceeded',
                    metric: threshold.metric,
                    value,
                    threshold: threshold.threshold,
                    impact: this.calculateImpact(threshold.severity),
                    autoResponseTriggered: false,
                };
                events.push(event);
                console.log(`‚ö†Ô∏è Performance threshold exceeded: ${threshold.metric} = ${value} > ${threshold.threshold}`);
            }
        }
        return events;
    }
    /**
     * Send alert through configured channels
     */
    async sendAlert(alert) {
        for (const channel of this.config.channels) {
            if (channel.severityFilter.includes(alert.severity)) {
                await this.sendAlertToChannel(alert, channel);
            }
        }
    }
    /**
     * Send alert to specific channel
     */
    async sendAlertToChannel(alert, channel) {
        try {
            switch (channel.type) {
                case 'console':
                    this.sendConsoleAlert(alert);
                    break;
                case 'file':
                    await this.sendFileAlert(alert, channel.config);
                    break;
                case 'kiro':
                    await this.sendKiroAlert(alert, channel.config);
                    break;
                case 'webhook':
                    await this.sendWebhookAlert(alert, channel.config);
                    break;
            }
        }
        catch (error) {
            console.error(`Failed to send alert to ${channel.type}:`, error);
        }
    }
    /**
     * Send console alert
     */
    sendConsoleAlert(alert) {
        const icon = this.getSeverityIcon(alert.severity);
        const timestamp = alert.timestamp.toISOString();
        console.log(`${icon} [${alert.severity.toUpperCase()}] ${timestamp}`);
        console.log(`   Metric: ${alert.metric}`);
        console.log(`   Value: ${alert.currentValue} (threshold: ${alert.threshold})`);
        console.log(`   Message: ${alert.message}`);
        console.log('');
    }
    /**
     * Send file alert
     */
    async sendFileAlert(alert, config) {
        const alertFile = config.file || '.kiro/metrics/alerts.log';
        const timestamp = alert.timestamp.toISOString();
        const logEntry = `[${timestamp}] ${alert.severity.toUpperCase()}: ${alert.message} (${alert.metric}: ${alert.currentValue}/${alert.threshold})\n`;
        try {
            // Append to file
            (0, child_process_1.execSync)(`echo "${logEntry}" >> "${alertFile}"`);
        }
        catch (error) {
            console.error('Failed to write alert to file:', error);
        }
    }
    /**
     * Send Kiro alert (integration with Kiro system)
     */
    async sendKiroAlert(alert, config) {
        // Create Kiro notification file
        const kiroAlert = {
            id: alert.id,
            timestamp: alert.timestamp,
            type: 'linting_alert',
            severity: alert.severity,
            title: `Linting ${alert.severity.toUpperCase()}: ${alert.metric}`,
            message: alert.message,
            data: {
                metric: alert.metric,
                currentValue: alert.currentValue,
                threshold: alert.threshold,
            },
            actions: this.generateKiroActions(alert),
        };
        const kiroFile = '.kiro/notifications/linting-alerts.json';
        (0, fs_1.writeFileSync)(kiroFile, JSON.stringify(kiroAlert, null, 2));
    }
    /**
     * Send webhook alert
     */
    async sendWebhookAlert(alert, config) {
        if (!config.url) {
            console.warn('Webhook URL not configured');
            return;
        }
        const payload = {
            alert_id: alert.id,
            timestamp: alert.timestamp,
            severity: alert.severity,
            metric: alert.metric,
            current_value: alert.currentValue,
            threshold: alert.threshold,
            message: alert.message,
            source: 'linting-excellence-dashboard',
        };
        try {
            // Use curl for webhook (Node.js fetch might not be available)
            const curlCommand = `curl -X POST "${config.url}" \
        -H "Content-Type: application/json" \
        -d '${JSON.stringify(payload)}'`;
            (0, child_process_1.execSync)(curlCommand, { stdio: 'pipe' });
        }
        catch (error) {
            console.error('Failed to send webhook alert:', error);
        }
    }
    /**
     * Process performance event and trigger responses
     */
    async processPerformanceEvent(event) {
        console.log(`üìä Performance event: ${event.type} for ${event.metric}`);
        // Log performance event
        const performanceLog = `.kiro/metrics/performance-events.log`;
        const logEntry = `[${event.timestamp.toISOString()}] ${event.type.toUpperCase()}: ${event.metric} = ${event.value} (threshold: ${event.threshold}, impact: ${event.impact})\n`;
        try {
            (0, child_process_1.execSync)(`echo "${logEntry}" >> "${performanceLog}"`);
        }
        catch (error) {
            console.error('Failed to log performance event:', error);
        }
        // Update performance history
        this.updatePerformanceHistory(event);
    }
    /**
     * Trigger automatic responses based on alerts and performance events
     */
    async triggerAutoResponses(alerts, events) {
        const actions = this.config.autoResponse.actions;
        for (const action of actions) {
            if (this.shouldTriggerAction(action, alerts, events)) {
                await this.executeAutoResponse(action);
            }
        }
    }
    /**
     * Execute automatic response action
     */
    async executeAutoResponse(action) {
        console.log(`ü§ñ Executing auto-response: ${action.action}`);
        try {
            switch (action.action) {
                case 'enableCache':
                    await this.enableLintingCache();
                    break;
                case 'reduceBatchSize':
                    await this.reduceBatchSize(action.parameters.newSize || 10);
                    break;
                case 'skipNonCritical':
                    await this.skipNonCriticalRules();
                    break;
                case 'emergencyStop':
                    await this.emergencyStop();
                    break;
            }
        }
        catch (error) {
            console.error(`Failed to execute auto-response ${action.action}:`, error);
        }
    }
    /**
     * Filter alerts based on cooldown and suppression
     */
    filterActiveAlerts(alerts) {
        return alerts.filter(alert => {
            // Check suppression
            if (this.suppressedAlerts.has(alert.metric)) {
                return false;
            }
            // Check cooldown
            const lastAlert = this.lastAlertTime.get(alert.metric);
            if (lastAlert) {
                const cooldownMs = this.config.regressionDetection.cooldownPeriod * 60 * 1000;
                if (Date.now() - lastAlert.getTime() < cooldownMs) {
                    return false;
                }
            }
            return true;
        });
    }
    /**
     * Generate Kiro-specific actions for alerts
     */
    generateKiroActions(alert) {
        const actions = [];
        if (alert.metric === 'parserErrors' && alert.currentValue > 0) {
            actions.push({
                type: 'command',
                label: 'Fix Parser Errors',
                command: 'yarn tsc --noEmit',
                description: 'Run TypeScript compiler to identify syntax errors',
            });
        }
        if (alert.metric === 'explicitAnyErrors' && alert.currentValue > 100) {
            actions.push({
                type: 'campaign',
                label: 'Start Explicit Any Campaign',
                campaign: 'explicit-any-elimination',
                description: 'Launch systematic explicit any type elimination',
            });
        }
        if (alert.metric === 'importOrderIssues' && alert.currentValue > 50) {
            actions.push({
                type: 'command',
                label: 'Fix Import Order',
                command: 'yarn lint:fix',
                description: 'Automatically organize imports with enhanced rules',
            });
        }
        return actions;
    }
    // Auto-response implementations
    async enableLintingCache() {
        console.log('üöÄ Enabling ESLint caching for improved performance');
        // Cache is already enabled in eslint.config.cjs, this is a no-op
    }
    async reduceBatchSize(newSize) {
        console.log(`üìâ Reducing batch size to ${newSize} for better performance`);
        // This would integrate with campaign system batch processing
    }
    async skipNonCriticalRules() {
        console.log('‚ö° Temporarily skipping non-critical rules for performance');
        // This would create a temporary ESLint config with reduced rules
    }
    async emergencyStop() {
        console.log('üõë Emergency stop triggered - halting linting operations');
        // This would stop any running linting campaigns
    }
    // Helper methods
    loadConfiguration() {
        try {
            if ((0, fs_1.existsSync)(this.configFile)) {
                return JSON.parse((0, fs_1.readFileSync)(this.configFile, 'utf8'));
            }
        }
        catch (error) {
            console.warn('Error loading alerting configuration:', error);
        }
        // Return default configuration
        return {
            enabled: true,
            channels: [
                {
                    type: 'console',
                    config: {},
                    severityFilter: ['warning', 'error', 'critical'],
                },
                {
                    type: 'file',
                    config: { file: '.kiro/metrics/alerts.log' },
                    severityFilter: ['error', 'critical'],
                },
                {
                    type: 'kiro',
                    config: {},
                    severityFilter: ['critical'],
                },
            ],
            regressionDetection: {
                enabled: true,
                sensitivity: 'medium',
                cooldownPeriod: 15, // 15 minutes
            },
            performanceMonitoring: {
                enabled: true,
                thresholds: [
                    {
                        metric: 'duration',
                        threshold: 30000,
                        severity: 'warning',
                        message: 'Linting duration exceeds 30 seconds',
                    },
                    {
                        metric: 'memory',
                        threshold: 512,
                        severity: 'warning',
                        message: 'Memory usage exceeds 512MB',
                    },
                    {
                        metric: 'cacheHitRate',
                        threshold: 0.5,
                        severity: 'warning',
                        message: 'Cache hit rate below 50%',
                    },
                ],
            },
            autoResponse: {
                enabled: true,
                actions: [
                    {
                        trigger: 'performance_degradation',
                        action: 'enableCache',
                        parameters: {},
                    },
                    {
                        trigger: 'memory_exceeded',
                        action: 'reduceBatchSize',
                        parameters: { newSize: 10 },
                    },
                ],
            },
        };
    }
    loadSuppressions() {
        try {
            if ((0, fs_1.existsSync)(this.suppressionFile)) {
                const suppressions = JSON.parse((0, fs_1.readFileSync)(this.suppressionFile, 'utf8'));
                this.suppressedAlerts = new Set(suppressions);
            }
        }
        catch (error) {
            console.warn('Error loading alert suppressions:', error);
        }
    }
    updateAlertHistory(alert) {
        this.lastAlertTime.set(alert.metric, alert.timestamp);
        // Store in history file
        try {
            const history = this.loadAlertHistory();
            history.alerts.push(alert);
            // Keep only last 1000 alerts
            if (history.alerts.length > 1000) {
                history.alerts.splice(0, history.alerts.length - 1000);
            }
            (0, fs_1.writeFileSync)(this.historyFile, JSON.stringify(history, null, 2));
        }
        catch (error) {
            console.error('Error updating alert history:', error);
        }
    }
    updatePerformanceHistory(event) {
        try {
            const history = this.loadAlertHistory();
            history.performanceEvents.push(event);
            // Keep only last 500 performance events
            if (history.performanceEvents.length > 500) {
                history.performanceEvents.splice(0, history.performanceEvents.length - 500);
            }
            (0, fs_1.writeFileSync)(this.historyFile, JSON.stringify(history, null, 2));
        }
        catch (error) {
            console.error('Error updating performance history:', error);
        }
    }
    loadAlertHistory() {
        try {
            if ((0, fs_1.existsSync)(this.historyFile)) {
                return JSON.parse((0, fs_1.readFileSync)(this.historyFile, 'utf8'));
            }
        }
        catch (error) {
            console.warn('Error loading alert history:', error);
        }
        return {
            alerts: [],
            suppressedAlerts: [],
            resolvedAlerts: [],
            performanceEvents: [],
        };
    }
    getPerformanceMetricValue(metrics, metric) {
        switch (metric) {
            case 'duration':
                return metrics.performanceMetrics.lintingDuration;
            case 'memory':
                return metrics.performanceMetrics.memoryUsage;
            case 'cacheHitRate':
                return metrics.performanceMetrics.cacheHitRate;
            case 'filesPerSecond':
                return (metrics.performanceMetrics.filesProcessed /
                    (metrics.performanceMetrics.lintingDuration / 1000));
            default:
                return 0;
        }
    }
    isThresholdExceeded(value, threshold) {
        if (threshold.metric === 'cacheHitRate') {
            return value < threshold.threshold; // Cache hit rate should be above threshold
        }
        return value > threshold.threshold; // Other metrics should be below threshold
    }
    calculateImpact(severity) {
        switch (severity) {
            case 'critical':
                return 'high';
            case 'error':
                return 'medium';
            default:
                return 'low';
        }
    }
    shouldTriggerAction(action, alerts, events) {
        switch (action.trigger) {
            case 'performance_degradation':
                return events.some(e => e.type === 'threshold_exceeded' && e.impact === 'high');
            case 'memory_exceeded':
                return events.some(e => e.metric === 'memory' && e.type === 'threshold_exceeded');
            case 'critical_alert':
                return alerts.some(a => a.severity === 'critical');
            default:
                return false;
        }
    }
    getSeverityIcon(severity) {
        switch (severity) {
            case 'critical':
                return 'üö®';
            case 'error':
                return '‚ùå';
            case 'warning':
                return '‚ö†Ô∏è';
            case 'info':
                return '‚ÑπÔ∏è';
            default:
                return 'üìã';
        }
    }
}
exports.LintingAlertingSystem = LintingAlertingSystem;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L2JhY2t1cHMvY29uc2VydmF0aXZlLXdhdmUtMjAyNS0wOC0xMVQwNS0yMS0zMy00MTBaL3NyYy9zZXJ2aWNlcy9saW50aW5nL0xpbnRpbmdBbGVydGluZ1N5c3RlbS50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7O0dBS0c7OztBQUVILGlEQUF5QztBQUN6QywyQkFBNkQ7QUEyRDdELE1BQWEscUJBQXFCO0lBQ2YsVUFBVSxHQUFHLG9DQUFvQyxDQUFDO0lBQ2xELFdBQVcsR0FBRyxxQ0FBcUMsQ0FBQztJQUNwRCxlQUFlLEdBQUcsdUNBQXVDLENBQUM7SUFFbkUsTUFBTSxDQUFpQjtJQUN2QixhQUFhLEdBQXNCLElBQUksR0FBRyxFQUFFLENBQUM7SUFDN0MsZ0JBQWdCLEdBQWdCLElBQUksR0FBRyxFQUFFLENBQUM7SUFFbEQ7UUFDRSxJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1FBQ3ZDLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO0lBQzFCLENBQUM7SUFFRDs7T0FFRztJQUNILEtBQUssQ0FBQyxhQUFhLENBQUMsTUFBZSxFQUFFLE9BQXVCO1FBQzFELElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sRUFBRTtZQUN4QixPQUFPO1NBQ1I7UUFFRCxPQUFPLENBQUMsR0FBRyxDQUFDLGlCQUFpQixNQUFNLENBQUMsTUFBTSxZQUFZLENBQUMsQ0FBQztRQUV4RCxrREFBa0Q7UUFDbEQsTUFBTSxZQUFZLEdBQUcsSUFBSSxDQUFDLGtCQUFrQixDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBRXJELGlDQUFpQztRQUNqQyxNQUFNLGlCQUFpQixHQUFHLE1BQU0sSUFBSSxDQUFDLGtCQUFrQixDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBRWpFLDBDQUEwQztRQUMxQyxLQUFLLE1BQU0sS0FBSyxJQUFJLFlBQVksRUFBRTtZQUNoQyxNQUFNLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDNUIsSUFBSSxDQUFDLGtCQUFrQixDQUFDLEtBQUssQ0FBQyxDQUFDO1NBQ2hDO1FBRUQsNkJBQTZCO1FBQzdCLEtBQUssTUFBTSxLQUFLLElBQUksaUJBQWlCLEVBQUU7WUFDckMsTUFBTSxJQUFJLENBQUMsdUJBQXVCLENBQUMsS0FBSyxDQUFDLENBQUM7U0FDM0M7UUFFRCx1Q0FBdUM7UUFDdkMsSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQyxPQUFPLEVBQUU7WUFDcEMsTUFBTSxJQUFJLENBQUMsb0JBQW9CLENBQUMsWUFBWSxFQUFFLGlCQUFpQixDQUFDLENBQUM7U0FDbEU7UUFFRCxPQUFPLENBQUMsR0FBRyxDQUNULGVBQWUsWUFBWSxDQUFDLE1BQU0sc0JBQXNCLGlCQUFpQixDQUFDLE1BQU0scUJBQXFCLENBQ3RHLENBQUM7SUFDSixDQUFDO0lBRUQ7O09BRUc7SUFDSyxLQUFLLENBQUMsa0JBQWtCLENBQUMsT0FBdUI7UUFDdEQsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMscUJBQXFCLENBQUMsT0FBTyxFQUFFO1lBQzlDLE9BQU8sRUFBRSxDQUFDO1NBQ1g7UUFFRCxNQUFNLE1BQU0sR0FBdUIsRUFBRSxDQUFDO1FBQ3RDLE1BQU0sVUFBVSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMscUJBQXFCLENBQUMsVUFBVSxDQUFDO1FBRWhFLEtBQUssTUFBTSxTQUFTLElBQUksVUFBVSxFQUFFO1lBQ2xDLE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyx5QkFBeUIsQ0FBQyxPQUFPLEVBQUUsU0FBUyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBRXhFLElBQUksSUFBSSxDQUFDLG1CQUFtQixDQUFDLEtBQUssRUFBRSxTQUFTLENBQUMsRUFBRTtnQkFDOUMsTUFBTSxLQUFLLEdBQXFCO29CQUM5QixFQUFFLEVBQUUsUUFBUSxTQUFTLENBQUMsTUFBTSxJQUFJLElBQUksQ0FBQyxHQUFHLEVBQUUsRUFBRTtvQkFDNUMsU0FBUyxFQUFFLElBQUksSUFBSSxFQUFFO29CQUNyQixJQUFJLEVBQUUsb0JBQW9CO29CQUMxQixNQUFNLEVBQUUsU0FBUyxDQUFDLE1BQU07b0JBQ3hCLEtBQUs7b0JBQ0wsU0FBUyxFQUFFLFNBQVMsQ0FBQyxTQUFTO29CQUM5QixNQUFNLEVBQUUsSUFBSSxDQUFDLGVBQWUsQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDO29CQUNoRCxxQkFBcUIsRUFBRSxLQUFLO2lCQUM3QixDQUFDO2dCQUVGLE1BQU0sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7Z0JBQ25CLE9BQU8sQ0FBQyxHQUFHLENBQ1Qsc0NBQXNDLFNBQVMsQ0FBQyxNQUFNLE1BQU0sS0FBSyxNQUFNLFNBQVMsQ0FBQyxTQUFTLEVBQUUsQ0FDN0YsQ0FBQzthQUNIO1NBQ0Y7UUFFRCxPQUFPLE1BQU0sQ0FBQztJQUNoQixDQUFDO0lBRUQ7O09BRUc7SUFDSyxLQUFLLENBQUMsU0FBUyxDQUFDLEtBQVk7UUFDbEMsS0FBSyxNQUFNLE9BQU8sSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsRUFBRTtZQUMxQyxJQUFJLE9BQU8sQ0FBQyxjQUFjLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsRUFBRTtnQkFDbkQsTUFBTSxJQUFJLENBQUMsa0JBQWtCLENBQUMsS0FBSyxFQUFFLE9BQU8sQ0FBQyxDQUFDO2FBQy9DO1NBQ0Y7SUFDSCxDQUFDO0lBRUQ7O09BRUc7SUFDSyxLQUFLLENBQUMsa0JBQWtCLENBQUMsS0FBWSxFQUFFLE9BQXFCO1FBQ2xFLElBQUk7WUFDRixRQUFRLE9BQU8sQ0FBQyxJQUFJLEVBQUU7Z0JBQ3BCLEtBQUssU0FBUztvQkFDWixJQUFJLENBQUMsZ0JBQWdCLENBQUMsS0FBSyxDQUFDLENBQUM7b0JBQzdCLE1BQU07Z0JBQ1IsS0FBSyxNQUFNO29CQUNULE1BQU0sSUFBSSxDQUFDLGFBQWEsQ0FBQyxLQUFLLEVBQUUsT0FBTyxDQUFDLE1BQU0sQ0FBQyxDQUFDO29CQUNoRCxNQUFNO2dCQUNSLEtBQUssTUFBTTtvQkFDVCxNQUFNLElBQUksQ0FBQyxhQUFhLENBQUMsS0FBSyxFQUFFLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQztvQkFDaEQsTUFBTTtnQkFDUixLQUFLLFNBQVM7b0JBQ1osTUFBTSxJQUFJLENBQUMsZ0JBQWdCLENBQUMsS0FBSyxFQUFFLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQztvQkFDbkQsTUFBTTthQUNUO1NBQ0Y7UUFBQyxPQUFPLEtBQUssRUFBRTtZQUNkLE9BQU8sQ0FBQyxLQUFLLENBQUMsMkJBQTJCLE9BQU8sQ0FBQyxJQUFJLEdBQUcsRUFBRSxLQUFLLENBQUMsQ0FBQztTQUNsRTtJQUNILENBQUM7SUFFRDs7T0FFRztJQUNLLGdCQUFnQixDQUFDLEtBQVk7UUFDbkMsTUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLGVBQWUsQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDbEQsTUFBTSxTQUFTLEdBQUcsS0FBSyxDQUFDLFNBQVMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUVoRCxPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsSUFBSSxLQUFLLEtBQUssQ0FBQyxRQUFRLENBQUMsV0FBVyxFQUFFLEtBQUssU0FBUyxFQUFFLENBQUMsQ0FBQztRQUN0RSxPQUFPLENBQUMsR0FBRyxDQUFDLGNBQWMsS0FBSyxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUM7UUFDMUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxhQUFhLEtBQUssQ0FBQyxZQUFZLGdCQUFnQixLQUFLLENBQUMsU0FBUyxHQUFHLENBQUMsQ0FBQztRQUMvRSxPQUFPLENBQUMsR0FBRyxDQUFDLGVBQWUsS0FBSyxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUM7UUFDNUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQztJQUNsQixDQUFDO0lBRUQ7O09BRUc7SUFDSyxLQUFLLENBQUMsYUFBYSxDQUFDLEtBQVksRUFBRSxNQUEyQjtRQUNuRSxNQUFNLFNBQVMsR0FBRyxNQUFNLENBQUMsSUFBSSxJQUFJLDBCQUEwQixDQUFDO1FBQzVELE1BQU0sU0FBUyxHQUFHLEtBQUssQ0FBQyxTQUFTLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDaEQsTUFBTSxRQUFRLEdBQUcsSUFBSSxTQUFTLEtBQUssS0FBSyxDQUFDLFFBQVEsQ0FBQyxXQUFXLEVBQUUsS0FBSyxLQUFLLENBQUMsT0FBTyxLQUFLLEtBQUssQ0FBQyxNQUFNLEtBQUssS0FBSyxDQUFDLFlBQVksSUFBSSxLQUFLLENBQUMsU0FBUyxLQUFLLENBQUM7UUFFbEosSUFBSTtZQUNGLGlCQUFpQjtZQUNqQixJQUFBLHdCQUFRLEVBQUMsU0FBUyxRQUFRLFNBQVMsU0FBUyxHQUFHLENBQUMsQ0FBQztTQUNsRDtRQUFDLE9BQU8sS0FBSyxFQUFFO1lBQ2QsT0FBTyxDQUFDLEtBQUssQ0FBQyxnQ0FBZ0MsRUFBRSxLQUFLLENBQUMsQ0FBQztTQUN4RDtJQUNILENBQUM7SUFFRDs7T0FFRztJQUNLLEtBQUssQ0FBQyxhQUFhLENBQUMsS0FBWSxFQUFFLE1BQTJCO1FBQ25FLGdDQUFnQztRQUNoQyxNQUFNLFNBQVMsR0FBRztZQUNoQixFQUFFLEVBQUUsS0FBSyxDQUFDLEVBQUU7WUFDWixTQUFTLEVBQUUsS0FBSyxDQUFDLFNBQVM7WUFDMUIsSUFBSSxFQUFFLGVBQWU7WUFDckIsUUFBUSxFQUFFLEtBQUssQ0FBQyxRQUFRO1lBQ3hCLEtBQUssRUFBRSxXQUFXLEtBQUssQ0FBQyxRQUFRLENBQUMsV0FBVyxFQUFFLEtBQUssS0FBSyxDQUFDLE1BQU0sRUFBRTtZQUNqRSxPQUFPLEVBQUUsS0FBSyxDQUFDLE9BQU87WUFDdEIsSUFBSSxFQUFFO2dCQUNKLE1BQU0sRUFBRSxLQUFLLENBQUMsTUFBTTtnQkFDcEIsWUFBWSxFQUFFLEtBQUssQ0FBQyxZQUFZO2dCQUNoQyxTQUFTLEVBQUUsS0FBSyxDQUFDLFNBQVM7YUFDM0I7WUFDRCxPQUFPLEVBQUUsSUFBSSxDQUFDLG1CQUFtQixDQUFDLEtBQUssQ0FBQztTQUN6QyxDQUFDO1FBRUYsTUFBTSxRQUFRLEdBQUcseUNBQXlDLENBQUM7UUFDM0QsSUFBQSxrQkFBYSxFQUFDLFFBQVEsRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLFNBQVMsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUM5RCxDQUFDO0lBRUQ7O09BRUc7SUFDSyxLQUFLLENBQUMsZ0JBQWdCLENBQUMsS0FBWSxFQUFFLE1BQTJCO1FBQ3RFLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxFQUFFO1lBQ2YsT0FBTyxDQUFDLElBQUksQ0FBQyw0QkFBNEIsQ0FBQyxDQUFDO1lBQzNDLE9BQU87U0FDUjtRQUVELE1BQU0sT0FBTyxHQUFHO1lBQ2QsUUFBUSxFQUFFLEtBQUssQ0FBQyxFQUFFO1lBQ2xCLFNBQVMsRUFBRSxLQUFLLENBQUMsU0FBUztZQUMxQixRQUFRLEVBQUUsS0FBSyxDQUFDLFFBQVE7WUFDeEIsTUFBTSxFQUFFLEtBQUssQ0FBQyxNQUFNO1lBQ3BCLGFBQWEsRUFBRSxLQUFLLENBQUMsWUFBWTtZQUNqQyxTQUFTLEVBQUUsS0FBSyxDQUFDLFNBQVM7WUFDMUIsT0FBTyxFQUFFLEtBQUssQ0FBQyxPQUFPO1lBQ3RCLE1BQU0sRUFBRSw4QkFBOEI7U0FDdkMsQ0FBQztRQUVGLElBQUk7WUFDRiw4REFBOEQ7WUFDOUQsTUFBTSxXQUFXLEdBQUcsaUJBQWlCLE1BQU0sQ0FBQyxHQUFHOztjQUV2QyxJQUFJLENBQUMsU0FBUyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUM7WUFFbkMsSUFBQSx3QkFBUSxFQUFDLFdBQVcsRUFBRSxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsQ0FBQyxDQUFDO1NBQzFDO1FBQUMsT0FBTyxLQUFLLEVBQUU7WUFDZCxPQUFPLENBQUMsS0FBSyxDQUFDLCtCQUErQixFQUFFLEtBQUssQ0FBQyxDQUFDO1NBQ3ZEO0lBQ0gsQ0FBQztJQUVEOztPQUVHO0lBQ0ssS0FBSyxDQUFDLHVCQUF1QixDQUFDLEtBQXVCO1FBQzNELE9BQU8sQ0FBQyxHQUFHLENBQUMseUJBQXlCLEtBQUssQ0FBQyxJQUFJLFFBQVEsS0FBSyxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUM7UUFFdkUsd0JBQXdCO1FBQ3hCLE1BQU0sY0FBYyxHQUFHLHNDQUFzQyxDQUFDO1FBQzlELE1BQU0sUUFBUSxHQUFHLElBQUksS0FBSyxDQUFDLFNBQVMsQ0FBQyxXQUFXLEVBQUUsS0FBSyxLQUFLLENBQUMsSUFBSSxDQUFDLFdBQVcsRUFBRSxLQUFLLEtBQUssQ0FBQyxNQUFNLE1BQU0sS0FBSyxDQUFDLEtBQUssZ0JBQWdCLEtBQUssQ0FBQyxTQUFTLGFBQWEsS0FBSyxDQUFDLE1BQU0sS0FBSyxDQUFDO1FBRS9LLElBQUk7WUFDRixJQUFBLHdCQUFRLEVBQUMsU0FBUyxRQUFRLFNBQVMsY0FBYyxHQUFHLENBQUMsQ0FBQztTQUN2RDtRQUFDLE9BQU8sS0FBSyxFQUFFO1lBQ2QsT0FBTyxDQUFDLEtBQUssQ0FBQyxrQ0FBa0MsRUFBRSxLQUFLLENBQUMsQ0FBQztTQUMxRDtRQUVELDZCQUE2QjtRQUM3QixJQUFJLENBQUMsd0JBQXdCLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDdkMsQ0FBQztJQUVEOztPQUVHO0lBQ0ssS0FBSyxDQUFDLG9CQUFvQixDQUFDLE1BQWUsRUFBRSxNQUEwQjtRQUM1RSxNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQyxPQUFPLENBQUM7UUFFakQsS0FBSyxNQUFNLE1BQU0sSUFBSSxPQUFPLEVBQUU7WUFDNUIsSUFBSSxJQUFJLENBQUMsbUJBQW1CLENBQUMsTUFBTSxFQUFFLE1BQU0sRUFBRSxNQUFNLENBQUMsRUFBRTtnQkFDcEQsTUFBTSxJQUFJLENBQUMsbUJBQW1CLENBQUMsTUFBTSxDQUFDLENBQUM7YUFDeEM7U0FDRjtJQUNILENBQUM7SUFFRDs7T0FFRztJQUNLLEtBQUssQ0FBQyxtQkFBbUIsQ0FBQyxNQUEwQjtRQUMxRCxPQUFPLENBQUMsR0FBRyxDQUFDLCtCQUErQixNQUFNLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQztRQUU1RCxJQUFJO1lBQ0YsUUFBUSxNQUFNLENBQUMsTUFBTSxFQUFFO2dCQUNyQixLQUFLLGFBQWE7b0JBQ2hCLE1BQU0sSUFBSSxDQUFDLGtCQUFrQixFQUFFLENBQUM7b0JBQ2hDLE1BQU07Z0JBQ1IsS0FBSyxpQkFBaUI7b0JBQ3BCLE1BQU0sSUFBSSxDQUFDLGVBQWUsQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLE9BQU8sSUFBSSxFQUFFLENBQUMsQ0FBQztvQkFDNUQsTUFBTTtnQkFDUixLQUFLLGlCQUFpQjtvQkFDcEIsTUFBTSxJQUFJLENBQUMsb0JBQW9CLEVBQUUsQ0FBQztvQkFDbEMsTUFBTTtnQkFDUixLQUFLLGVBQWU7b0JBQ2xCLE1BQU0sSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO29CQUMzQixNQUFNO2FBQ1Q7U0FDRjtRQUFDLE9BQU8sS0FBSyxFQUFFO1lBQ2QsT0FBTyxDQUFDLEtBQUssQ0FBQyxtQ0FBbUMsTUFBTSxDQUFDLE1BQU0sR0FBRyxFQUFFLEtBQUssQ0FBQyxDQUFDO1NBQzNFO0lBQ0gsQ0FBQztJQUVEOztPQUVHO0lBQ0ssa0JBQWtCLENBQUMsTUFBZTtRQUN4QyxPQUFPLE1BQU0sQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUFDLEVBQUU7WUFDM0Isb0JBQW9CO1lBQ3BCLElBQUksSUFBSSxDQUFDLGdCQUFnQixDQUFDLEdBQUcsQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLEVBQUU7Z0JBQzNDLE9BQU8sS0FBSyxDQUFDO2FBQ2Q7WUFFRCxpQkFBaUI7WUFDakIsTUFBTSxTQUFTLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1lBQ3ZELElBQUksU0FBUyxFQUFFO2dCQUNiLE1BQU0sVUFBVSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsbUJBQW1CLENBQUMsY0FBYyxHQUFHLEVBQUUsR0FBRyxJQUFJLENBQUM7Z0JBQzlFLElBQUksSUFBSSxDQUFDLEdBQUcsRUFBRSxHQUFHLFNBQVMsQ0FBQyxPQUFPLEVBQUUsR0FBRyxVQUFVLEVBQUU7b0JBQ2pELE9BQU8sS0FBSyxDQUFDO2lCQUNkO2FBQ0Y7WUFFRCxPQUFPLElBQUksQ0FBQztRQUNkLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVEOztPQUVHO0lBQ0ssbUJBQW1CLENBQUMsS0FBWTtRQUN0QyxNQUFNLE9BQU8sR0FBbUMsRUFBRSxDQUFDO1FBRW5ELElBQUksS0FBSyxDQUFDLE1BQU0sS0FBSyxjQUFjLElBQUksS0FBSyxDQUFDLFlBQVksR0FBRyxDQUFDLEVBQUU7WUFDN0QsT0FBTyxDQUFDLElBQUksQ0FBQztnQkFDWCxJQUFJLEVBQUUsU0FBUztnQkFDZixLQUFLLEVBQUUsbUJBQW1CO2dCQUMxQixPQUFPLEVBQUUsbUJBQW1CO2dCQUM1QixXQUFXLEVBQUUsbURBQW1EO2FBQ2pFLENBQUMsQ0FBQztTQUNKO1FBRUQsSUFBSSxLQUFLLENBQUMsTUFBTSxLQUFLLG1CQUFtQixJQUFJLEtBQUssQ0FBQyxZQUFZLEdBQUcsR0FBRyxFQUFFO1lBQ3BFLE9BQU8sQ0FBQyxJQUFJLENBQUM7Z0JBQ1gsSUFBSSxFQUFFLFVBQVU7Z0JBQ2hCLEtBQUssRUFBRSw2QkFBNkI7Z0JBQ3BDLFFBQVEsRUFBRSwwQkFBMEI7Z0JBQ3BDLFdBQVcsRUFBRSxpREFBaUQ7YUFDL0QsQ0FBQyxDQUFDO1NBQ0o7UUFFRCxJQUFJLEtBQUssQ0FBQyxNQUFNLEtBQUssbUJBQW1CLElBQUksS0FBSyxDQUFDLFlBQVksR0FBRyxFQUFFLEVBQUU7WUFDbkUsT0FBTyxDQUFDLElBQUksQ0FBQztnQkFDWCxJQUFJLEVBQUUsU0FBUztnQkFDZixLQUFLLEVBQUUsa0JBQWtCO2dCQUN6QixPQUFPLEVBQUUsZUFBZTtnQkFDeEIsV0FBVyxFQUFFLG9EQUFvRDthQUNsRSxDQUFDLENBQUM7U0FDSjtRQUVELE9BQU8sT0FBTyxDQUFDO0lBQ2pCLENBQUM7SUFFRCxnQ0FBZ0M7SUFDeEIsS0FBSyxDQUFDLGtCQUFrQjtRQUM5QixPQUFPLENBQUMsR0FBRyxDQUFDLHFEQUFxRCxDQUFDLENBQUM7UUFDbkUsaUVBQWlFO0lBQ25FLENBQUM7SUFFTyxLQUFLLENBQUMsZUFBZSxDQUFDLE9BQWU7UUFDM0MsT0FBTyxDQUFDLEdBQUcsQ0FBQyw2QkFBNkIsT0FBTyx5QkFBeUIsQ0FBQyxDQUFDO1FBQzNFLDZEQUE2RDtJQUMvRCxDQUFDO0lBRU8sS0FBSyxDQUFDLG9CQUFvQjtRQUNoQyxPQUFPLENBQUMsR0FBRyxDQUFDLDJEQUEyRCxDQUFDLENBQUM7UUFDekUsaUVBQWlFO0lBQ25FLENBQUM7SUFFTyxLQUFLLENBQUMsYUFBYTtRQUN6QixPQUFPLENBQUMsR0FBRyxDQUFDLDBEQUEwRCxDQUFDLENBQUM7UUFDeEUsZ0RBQWdEO0lBQ2xELENBQUM7SUFFRCxpQkFBaUI7SUFDVCxpQkFBaUI7UUFDdkIsSUFBSTtZQUNGLElBQUksSUFBQSxlQUFVLEVBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxFQUFFO2dCQUMvQixPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBQSxpQkFBWSxFQUFDLElBQUksQ0FBQyxVQUFVLEVBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQzthQUMxRDtTQUNGO1FBQUMsT0FBTyxLQUFLLEVBQUU7WUFDZCxPQUFPLENBQUMsSUFBSSxDQUFDLHVDQUF1QyxFQUFFLEtBQUssQ0FBQyxDQUFDO1NBQzlEO1FBRUQsK0JBQStCO1FBQy9CLE9BQU87WUFDTCxPQUFPLEVBQUUsSUFBSTtZQUNiLFFBQVEsRUFBRTtnQkFDUjtvQkFDRSxJQUFJLEVBQUUsU0FBUztvQkFDZixNQUFNLEVBQUUsRUFBRTtvQkFDVixjQUFjLEVBQUUsQ0FBQyxTQUFTLEVBQUUsT0FBTyxFQUFFLFVBQVUsQ0FBQztpQkFDakQ7Z0JBQ0Q7b0JBQ0UsSUFBSSxFQUFFLE1BQU07b0JBQ1osTUFBTSxFQUFFLEVBQUUsSUFBSSxFQUFFLDBCQUEwQixFQUFFO29CQUM1QyxjQUFjLEVBQUUsQ0FBQyxPQUFPLEVBQUUsVUFBVSxDQUFDO2lCQUN0QztnQkFDRDtvQkFDRSxJQUFJLEVBQUUsTUFBTTtvQkFDWixNQUFNLEVBQUUsRUFBRTtvQkFDVixjQUFjLEVBQUUsQ0FBQyxVQUFVLENBQUM7aUJBQzdCO2FBQ0Y7WUFDRCxtQkFBbUIsRUFBRTtnQkFDbkIsT0FBTyxFQUFFLElBQUk7Z0JBQ2IsV0FBVyxFQUFFLFFBQVE7Z0JBQ3JCLGNBQWMsRUFBRSxFQUFFLEVBQUUsYUFBYTthQUNsQztZQUNELHFCQUFxQixFQUFFO2dCQUNyQixPQUFPLEVBQUUsSUFBSTtnQkFDYixVQUFVLEVBQUU7b0JBQ1Y7d0JBQ0UsTUFBTSxFQUFFLFVBQVU7d0JBQ2xCLFNBQVMsRUFBRSxLQUFLO3dCQUNoQixRQUFRLEVBQUUsU0FBUzt3QkFDbkIsT0FBTyxFQUFFLHFDQUFxQztxQkFDL0M7b0JBQ0Q7d0JBQ0UsTUFBTSxFQUFFLFFBQVE7d0JBQ2hCLFNBQVMsRUFBRSxHQUFHO3dCQUNkLFFBQVEsRUFBRSxTQUFTO3dCQUNuQixPQUFPLEVBQUUsNEJBQTRCO3FCQUN0QztvQkFDRDt3QkFDRSxNQUFNLEVBQUUsY0FBYzt3QkFDdEIsU0FBUyxFQUFFLEdBQUc7d0JBQ2QsUUFBUSxFQUFFLFNBQVM7d0JBQ25CLE9BQU8sRUFBRSwwQkFBMEI7cUJBQ3BDO2lCQUNGO2FBQ0Y7WUFDRCxZQUFZLEVBQUU7Z0JBQ1osT0FBTyxFQUFFLElBQUk7Z0JBQ2IsT0FBTyxFQUFFO29CQUNQO3dCQUNFLE9BQU8sRUFBRSx5QkFBeUI7d0JBQ2xDLE1BQU0sRUFBRSxhQUFhO3dCQUNyQixVQUFVLEVBQUUsRUFBRTtxQkFDZjtvQkFDRDt3QkFDRSxPQUFPLEVBQUUsaUJBQWlCO3dCQUMxQixNQUFNLEVBQUUsaUJBQWlCO3dCQUN6QixVQUFVLEVBQUUsRUFBRSxPQUFPLEVBQUUsRUFBRSxFQUFFO3FCQUM1QjtpQkFDRjthQUNGO1NBQ0YsQ0FBQztJQUNKLENBQUM7SUFFTyxnQkFBZ0I7UUFDdEIsSUFBSTtZQUNGLElBQUksSUFBQSxlQUFVLEVBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxFQUFFO2dCQUNwQyxNQUFNLFlBQVksR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUEsaUJBQVksRUFBQyxJQUFJLENBQUMsZUFBZSxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUM7Z0JBQzVFLElBQUksQ0FBQyxnQkFBZ0IsR0FBRyxJQUFJLEdBQUcsQ0FBQyxZQUFZLENBQUMsQ0FBQzthQUMvQztTQUNGO1FBQUMsT0FBTyxLQUFLLEVBQUU7WUFDZCxPQUFPLENBQUMsSUFBSSxDQUFDLG1DQUFtQyxFQUFFLEtBQUssQ0FBQyxDQUFDO1NBQzFEO0lBQ0gsQ0FBQztJQUVPLGtCQUFrQixDQUFDLEtBQVk7UUFDckMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLE1BQU0sRUFBRSxLQUFLLENBQUMsU0FBUyxDQUFDLENBQUM7UUFFdEQsd0JBQXdCO1FBQ3hCLElBQUk7WUFDRixNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztZQUN4QyxPQUFPLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUUzQiw2QkFBNkI7WUFDN0IsSUFBSSxPQUFPLENBQUMsTUFBTSxDQUFDLE1BQU0sR0FBRyxJQUFJLEVBQUU7Z0JBQ2hDLE9BQU8sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxPQUFPLENBQUMsTUFBTSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsQ0FBQzthQUN4RDtZQUVELElBQUEsa0JBQWEsRUFBQyxJQUFJLENBQUMsV0FBVyxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO1NBQ25FO1FBQUMsT0FBTyxLQUFLLEVBQUU7WUFDZCxPQUFPLENBQUMsS0FBSyxDQUFDLCtCQUErQixFQUFFLEtBQUssQ0FBQyxDQUFDO1NBQ3ZEO0lBQ0gsQ0FBQztJQUVPLHdCQUF3QixDQUFDLEtBQXVCO1FBQ3RELElBQUk7WUFDRixNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztZQUN4QyxPQUFPLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBRXRDLHdDQUF3QztZQUN4QyxJQUFJLE9BQU8sQ0FBQyxpQkFBaUIsQ0FBQyxNQUFNLEdBQUcsR0FBRyxFQUFFO2dCQUMxQyxPQUFPLENBQUMsaUJBQWlCLENBQUMsTUFBTSxDQUFDLENBQUMsRUFBRSxPQUFPLENBQUMsaUJBQWlCLENBQUMsTUFBTSxHQUFHLEdBQUcsQ0FBQyxDQUFDO2FBQzdFO1lBRUQsSUFBQSxrQkFBYSxFQUFDLElBQUksQ0FBQyxXQUFXLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxPQUFPLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDbkU7UUFBQyxPQUFPLEtBQUssRUFBRTtZQUNkLE9BQU8sQ0FBQyxLQUFLLENBQUMscUNBQXFDLEVBQUUsS0FBSyxDQUFDLENBQUM7U0FDN0Q7SUFDSCxDQUFDO0lBRU8sZ0JBQWdCO1FBQ3RCLElBQUk7WUFDRixJQUFJLElBQUEsZUFBVSxFQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsRUFBRTtnQkFDaEMsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUEsaUJBQVksRUFBQyxJQUFJLENBQUMsV0FBVyxFQUFFLE1BQU0sQ0FBQyxDQUFDLENBQUM7YUFDM0Q7U0FDRjtRQUFDLE9BQU8sS0FBSyxFQUFFO1lBQ2QsT0FBTyxDQUFDLElBQUksQ0FBQyw4QkFBOEIsRUFBRSxLQUFLLENBQUMsQ0FBQztTQUNyRDtRQUVELE9BQU87WUFDTCxNQUFNLEVBQUUsRUFBRTtZQUNWLGdCQUFnQixFQUFFLEVBQUU7WUFDcEIsY0FBYyxFQUFFLEVBQUU7WUFDbEIsaUJBQWlCLEVBQUUsRUFBRTtTQUN0QixDQUFDO0lBQ0osQ0FBQztJQUVPLHlCQUF5QixDQUFDLE9BQXVCLEVBQUUsTUFBYztRQUN2RSxRQUFRLE1BQU0sRUFBRTtZQUNkLEtBQUssVUFBVTtnQkFDYixPQUFPLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQyxlQUFlLENBQUM7WUFDcEQsS0FBSyxRQUFRO2dCQUNYLE9BQU8sT0FBTyxDQUFDLGtCQUFrQixDQUFDLFdBQVcsQ0FBQztZQUNoRCxLQUFLLGNBQWM7Z0JBQ2pCLE9BQU8sT0FBTyxDQUFDLGtCQUFrQixDQUFDLFlBQVksQ0FBQztZQUNqRCxLQUFLLGdCQUFnQjtnQkFDbkIsT0FBTyxDQUNMLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQyxjQUFjO29CQUN6QyxDQUFDLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQyxlQUFlLEdBQUcsSUFBSSxDQUFDLENBQ3BELENBQUM7WUFDSjtnQkFDRSxPQUFPLENBQUMsQ0FBQztTQUNaO0lBQ0gsQ0FBQztJQUVPLG1CQUFtQixDQUFDLEtBQWEsRUFBRSxTQUErQjtRQUN4RSxJQUFJLFNBQVMsQ0FBQyxNQUFNLEtBQUssY0FBYyxFQUFFO1lBQ3ZDLE9BQU8sS0FBSyxHQUFHLFNBQVMsQ0FBQyxTQUFTLENBQUMsQ0FBQywyQ0FBMkM7U0FDaEY7UUFDRCxPQUFPLEtBQUssR0FBRyxTQUFTLENBQUMsU0FBUyxDQUFDLENBQUMsMENBQTBDO0lBQ2hGLENBQUM7SUFFTyxlQUFlLENBQUMsUUFBZ0I7UUFDdEMsUUFBUSxRQUFRLEVBQUU7WUFDaEIsS0FBSyxVQUFVO2dCQUNiLE9BQU8sTUFBTSxDQUFDO1lBQ2hCLEtBQUssT0FBTztnQkFDVixPQUFPLFFBQVEsQ0FBQztZQUNsQjtnQkFDRSxPQUFPLEtBQUssQ0FBQztTQUNoQjtJQUNILENBQUM7SUFFTyxtQkFBbUIsQ0FDekIsTUFBMEIsRUFDMUIsTUFBZSxFQUNmLE1BQTBCO1FBRTFCLFFBQVEsTUFBTSxDQUFDLE9BQU8sRUFBRTtZQUN0QixLQUFLLHlCQUF5QjtnQkFDNUIsT0FBTyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLElBQUksS0FBSyxvQkFBb0IsSUFBSSxDQUFDLENBQUMsTUFBTSxLQUFLLE1BQU0sQ0FBQyxDQUFDO1lBQ2xGLEtBQUssaUJBQWlCO2dCQUNwQixPQUFPLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsTUFBTSxLQUFLLFFBQVEsSUFBSSxDQUFDLENBQUMsSUFBSSxLQUFLLG9CQUFvQixDQUFDLENBQUM7WUFDcEYsS0FBSyxnQkFBZ0I7Z0JBQ25CLE9BQU8sTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxRQUFRLEtBQUssVUFBVSxDQUFDLENBQUM7WUFDckQ7Z0JBQ0UsT0FBTyxLQUFLLENBQUM7U0FDaEI7SUFDSCxDQUFDO0lBRU8sZUFBZSxDQUFDLFFBQWdCO1FBQ3RDLFFBQVEsUUFBUSxFQUFFO1lBQ2hCLEtBQUssVUFBVTtnQkFDYixPQUFPLElBQUksQ0FBQztZQUNkLEtBQUssT0FBTztnQkFDVixPQUFPLEdBQUcsQ0FBQztZQUNiLEtBQUssU0FBUztnQkFDWixPQUFPLElBQUksQ0FBQztZQUNkLEtBQUssTUFBTTtnQkFDVCxPQUFPLElBQUksQ0FBQztZQUNkO2dCQUNFLE9BQU8sSUFBSSxDQUFDO1NBQ2Y7SUFDSCxDQUFDO0NBQ0Y7QUF6aUJELHNEQXlpQkMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L2JhY2t1cHMvY29uc2VydmF0aXZlLXdhdmUtMjAyNS0wOC0xMVQwNS0yMS0zMy00MTBaL3NyYy9zZXJ2aWNlcy9saW50aW5nL0xpbnRpbmdBbGVydGluZ1N5c3RlbS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIExpbnRpbmcgQWxlcnRpbmcgU3lzdGVtIHdpdGggUGVyZm9ybWFuY2UgTW9uaXRvcmluZ1xuICpcbiAqIFByb3ZpZGVzIHJlYWwtdGltZSBhbGVydGluZyBmb3IgbGludGluZyByZWdyZXNzaW9uIGRldGVjdGlvblxuICogd2l0aCBwZXJmb3JtYW5jZSBtb25pdG9yaW5nIGFuZCBhdXRvbWF0ZWQgcmVzcG9uc2UgY2FwYWJpbGl0aWVzLlxuICovXG5cbmltcG9ydCB7IGV4ZWNTeW5jIH0gZnJvbSAnY2hpbGRfcHJvY2Vzcyc7XG5pbXBvcnQgeyBleGlzdHNTeW5jLCByZWFkRmlsZVN5bmMsIHdyaXRlRmlsZVN5bmMgfSBmcm9tICdmcyc7XG5cbmltcG9ydCB7IEFsZXJ0LCBMaW50aW5nTWV0cmljcyB9IGZyb20gJy4vTGludGluZ1ZhbGlkYXRpb25EYXNoYm9hcmQnO1xuXG5leHBvcnQgaW50ZXJmYWNlIEFsZXJ0aW5nQ29uZmlnIHtcbiAgZW5hYmxlZDogYm9vbGVhbjtcbiAgY2hhbm5lbHM6IEFsZXJ0Q2hhbm5lbFtdO1xuICByZWdyZXNzaW9uRGV0ZWN0aW9uOiB7XG4gICAgZW5hYmxlZDogYm9vbGVhbjtcbiAgICBzZW5zaXRpdml0eTogJ2xvdycgfCAnbWVkaXVtJyB8ICdoaWdoJztcbiAgICBjb29sZG93blBlcmlvZDogbnVtYmVyOyAvLyBtaW51dGVzXG4gIH07XG4gIHBlcmZvcm1hbmNlTW9uaXRvcmluZzoge1xuICAgIGVuYWJsZWQ6IGJvb2xlYW47XG4gICAgdGhyZXNob2xkczogUGVyZm9ybWFuY2VUaHJlc2hvbGRbXTtcbiAgfTtcbiAgYXV0b1Jlc3BvbnNlOiB7XG4gICAgZW5hYmxlZDogYm9vbGVhbjtcbiAgICBhY3Rpb25zOiBBdXRvUmVzcG9uc2VBY3Rpb25bXTtcbiAgfTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBBbGVydENoYW5uZWwge1xuICB0eXBlOiAnY29uc29sZScgfCAnZmlsZScgfCAnd2ViaG9vaycgfCAna2lybyc7XG4gIGNvbmZpZzogUmVjb3JkPHN0cmluZywgYW55PjtcbiAgc2V2ZXJpdHlGaWx0ZXI6ICgnaW5mbycgfCAnd2FybmluZycgfCAnZXJyb3InIHwgJ2NyaXRpY2FsJylbXTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBQZXJmb3JtYW5jZVRocmVzaG9sZCB7XG4gIG1ldHJpYzogJ2R1cmF0aW9uJyB8ICdtZW1vcnknIHwgJ2NhY2hlSGl0UmF0ZScgfCAnZmlsZXNQZXJTZWNvbmQnO1xuICB0aHJlc2hvbGQ6IG51bWJlcjtcbiAgc2V2ZXJpdHk6ICd3YXJuaW5nJyB8ICdlcnJvcicgfCAnY3JpdGljYWwnO1xuICBtZXNzYWdlOiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQXV0b1Jlc3BvbnNlQWN0aW9uIHtcbiAgdHJpZ2dlcjogc3RyaW5nO1xuICBhY3Rpb246ICdlbmFibGVDYWNoZScgfCAncmVkdWNlQmF0Y2hTaXplJyB8ICdza2lwTm9uQ3JpdGljYWwnIHwgJ2VtZXJnZW5jeVN0b3AnO1xuICBwYXJhbWV0ZXJzOiBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEFsZXJ0SGlzdG9yeSB7XG4gIGFsZXJ0czogQWxlcnRbXTtcbiAgc3VwcHJlc3NlZEFsZXJ0czogQWxlcnRbXTtcbiAgcmVzb2x2ZWRBbGVydHM6IEFsZXJ0W107XG4gIHBlcmZvcm1hbmNlRXZlbnRzOiBQZXJmb3JtYW5jZUV2ZW50W107XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUGVyZm9ybWFuY2VFdmVudCB7XG4gIGlkOiBzdHJpbmc7XG4gIHRpbWVzdGFtcDogRGF0ZTtcbiAgdHlwZTogJ2RlZ3JhZGF0aW9uJyB8ICdpbXByb3ZlbWVudCcgfCAndGhyZXNob2xkX2V4Y2VlZGVkJztcbiAgbWV0cmljOiBzdHJpbmc7XG4gIHZhbHVlOiBudW1iZXI7XG4gIHRocmVzaG9sZDogbnVtYmVyO1xuICBpbXBhY3Q6ICdsb3cnIHwgJ21lZGl1bScgfCAnaGlnaCc7XG4gIGF1dG9SZXNwb25zZVRyaWdnZXJlZDogYm9vbGVhbjtcbn1cblxuZXhwb3J0IGNsYXNzIExpbnRpbmdBbGVydGluZ1N5c3RlbSB7XG4gIHByaXZhdGUgcmVhZG9ubHkgY29uZmlnRmlsZSA9ICcua2lyby9tZXRyaWNzL2FsZXJ0aW5nLWNvbmZpZy5qc29uJztcbiAgcHJpdmF0ZSByZWFkb25seSBoaXN0b3J5RmlsZSA9ICcua2lyby9tZXRyaWNzL2FsZXJ0aW5nLWhpc3RvcnkuanNvbic7XG4gIHByaXZhdGUgcmVhZG9ubHkgc3VwcHJlc3Npb25GaWxlID0gJy5raXJvL21ldHJpY3MvYWxlcnQtc3VwcHJlc3Npb25zLmpzb24nO1xuXG4gIHByaXZhdGUgY29uZmlnOiBBbGVydGluZ0NvbmZpZztcbiAgcHJpdmF0ZSBsYXN0QWxlcnRUaW1lOiBNYXA8c3RyaW5nLCBEYXRlPiA9IG5ldyBNYXAoKTtcbiAgcHJpdmF0ZSBzdXBwcmVzc2VkQWxlcnRzOiBTZXQ8c3RyaW5nPiA9IG5ldyBTZXQoKTtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLmNvbmZpZyA9IHRoaXMubG9hZENvbmZpZ3VyYXRpb24oKTtcbiAgICB0aGlzLmxvYWRTdXBwcmVzc2lvbnMoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQcm9jZXNzIGFsZXJ0cyBhbmQgdHJpZ2dlciBhcHByb3ByaWF0ZSByZXNwb25zZXNcbiAgICovXG4gIGFzeW5jIHByb2Nlc3NBbGVydHMoYWxlcnRzOiBBbGVydFtdLCBtZXRyaWNzOiBMaW50aW5nTWV0cmljcyk6IFByb21pc2U8dm9pZD4ge1xuICAgIGlmICghdGhpcy5jb25maWcuZW5hYmxlZCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnNvbGUubG9nKGDwn5qoIFByb2Nlc3NpbmcgJHthbGVydHMubGVuZ3RofSBhbGVydHMuLi5gKTtcblxuICAgIC8vIEZpbHRlciBhbGVydHMgYmFzZWQgb24gY29vbGRvd24gYW5kIHN1cHByZXNzaW9uXG4gICAgY29uc3QgYWN0aXZlQWxlcnRzID0gdGhpcy5maWx0ZXJBY3RpdmVBbGVydHMoYWxlcnRzKTtcblxuICAgIC8vIFByb2Nlc3MgcGVyZm9ybWFuY2UgbW9uaXRvcmluZ1xuICAgIGNvbnN0IHBlcmZvcm1hbmNlRXZlbnRzID0gYXdhaXQgdGhpcy5tb25pdG9yUGVyZm9ybWFuY2UobWV0cmljcyk7XG5cbiAgICAvLyBTZW5kIGFsZXJ0cyB0aHJvdWdoIGNvbmZpZ3VyZWQgY2hhbm5lbHNcbiAgICBmb3IgKGNvbnN0IGFsZXJ0IG9mIGFjdGl2ZUFsZXJ0cykge1xuICAgICAgYXdhaXQgdGhpcy5zZW5kQWxlcnQoYWxlcnQpO1xuICAgICAgdGhpcy51cGRhdGVBbGVydEhpc3RvcnkoYWxlcnQpO1xuICAgIH1cblxuICAgIC8vIFByb2Nlc3MgcGVyZm9ybWFuY2UgZXZlbnRzXG4gICAgZm9yIChjb25zdCBldmVudCBvZiBwZXJmb3JtYW5jZUV2ZW50cykge1xuICAgICAgYXdhaXQgdGhpcy5wcm9jZXNzUGVyZm9ybWFuY2VFdmVudChldmVudCk7XG4gICAgfVxuXG4gICAgLy8gVHJpZ2dlciBhdXRvLXJlc3BvbnNlcyBpZiBjb25maWd1cmVkXG4gICAgaWYgKHRoaXMuY29uZmlnLmF1dG9SZXNwb25zZS5lbmFibGVkKSB7XG4gICAgICBhd2FpdCB0aGlzLnRyaWdnZXJBdXRvUmVzcG9uc2VzKGFjdGl2ZUFsZXJ0cywgcGVyZm9ybWFuY2VFdmVudHMpO1xuICAgIH1cblxuICAgIGNvbnNvbGUubG9nKFxuICAgICAgYOKchSBQcm9jZXNzZWQgJHthY3RpdmVBbGVydHMubGVuZ3RofSBhY3RpdmUgYWxlcnRzIGFuZCAke3BlcmZvcm1hbmNlRXZlbnRzLmxlbmd0aH0gcGVyZm9ybWFuY2UgZXZlbnRzYCxcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIE1vbml0b3IgcGVyZm9ybWFuY2UgbWV0cmljcyBhbmQgZGV0ZWN0IGlzc3Vlc1xuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBtb25pdG9yUGVyZm9ybWFuY2UobWV0cmljczogTGludGluZ01ldHJpY3MpOiBQcm9taXNlPFBlcmZvcm1hbmNlRXZlbnRbXT4ge1xuICAgIGlmICghdGhpcy5jb25maWcucGVyZm9ybWFuY2VNb25pdG9yaW5nLmVuYWJsZWQpIHtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG5cbiAgICBjb25zdCBldmVudHM6IFBlcmZvcm1hbmNlRXZlbnRbXSA9IFtdO1xuICAgIGNvbnN0IHRocmVzaG9sZHMgPSB0aGlzLmNvbmZpZy5wZXJmb3JtYW5jZU1vbml0b3JpbmcudGhyZXNob2xkcztcblxuICAgIGZvciAoY29uc3QgdGhyZXNob2xkIG9mIHRocmVzaG9sZHMpIHtcbiAgICAgIGNvbnN0IHZhbHVlID0gdGhpcy5nZXRQZXJmb3JtYW5jZU1ldHJpY1ZhbHVlKG1ldHJpY3MsIHRocmVzaG9sZC5tZXRyaWMpO1xuXG4gICAgICBpZiAodGhpcy5pc1RocmVzaG9sZEV4Y2VlZGVkKHZhbHVlLCB0aHJlc2hvbGQpKSB7XG4gICAgICAgIGNvbnN0IGV2ZW50OiBQZXJmb3JtYW5jZUV2ZW50ID0ge1xuICAgICAgICAgIGlkOiBgcGVyZi0ke3RocmVzaG9sZC5tZXRyaWN9LSR7RGF0ZS5ub3coKX1gLFxuICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgICAgICB0eXBlOiAndGhyZXNob2xkX2V4Y2VlZGVkJyxcbiAgICAgICAgICBtZXRyaWM6IHRocmVzaG9sZC5tZXRyaWMsXG4gICAgICAgICAgdmFsdWUsXG4gICAgICAgICAgdGhyZXNob2xkOiB0aHJlc2hvbGQudGhyZXNob2xkLFxuICAgICAgICAgIGltcGFjdDogdGhpcy5jYWxjdWxhdGVJbXBhY3QodGhyZXNob2xkLnNldmVyaXR5KSxcbiAgICAgICAgICBhdXRvUmVzcG9uc2VUcmlnZ2VyZWQ6IGZhbHNlLFxuICAgICAgICB9O1xuXG4gICAgICAgIGV2ZW50cy5wdXNoKGV2ZW50KTtcbiAgICAgICAgY29uc29sZS5sb2coXG4gICAgICAgICAgYOKaoO+4jyBQZXJmb3JtYW5jZSB0aHJlc2hvbGQgZXhjZWVkZWQ6ICR7dGhyZXNob2xkLm1ldHJpY30gPSAke3ZhbHVlfSA+ICR7dGhyZXNob2xkLnRocmVzaG9sZH1gLFxuICAgICAgICApO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBldmVudHM7XG4gIH1cblxuICAvKipcbiAgICogU2VuZCBhbGVydCB0aHJvdWdoIGNvbmZpZ3VyZWQgY2hhbm5lbHNcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgc2VuZEFsZXJ0KGFsZXJ0OiBBbGVydCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGZvciAoY29uc3QgY2hhbm5lbCBvZiB0aGlzLmNvbmZpZy5jaGFubmVscykge1xuICAgICAgaWYgKGNoYW5uZWwuc2V2ZXJpdHlGaWx0ZXIuaW5jbHVkZXMoYWxlcnQuc2V2ZXJpdHkpKSB7XG4gICAgICAgIGF3YWl0IHRoaXMuc2VuZEFsZXJ0VG9DaGFubmVsKGFsZXJ0LCBjaGFubmVsKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU2VuZCBhbGVydCB0byBzcGVjaWZpYyBjaGFubmVsXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIHNlbmRBbGVydFRvQ2hhbm5lbChhbGVydDogQWxlcnQsIGNoYW5uZWw6IEFsZXJ0Q2hhbm5lbCk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICBzd2l0Y2ggKGNoYW5uZWwudHlwZSkge1xuICAgICAgICBjYXNlICdjb25zb2xlJzpcbiAgICAgICAgICB0aGlzLnNlbmRDb25zb2xlQWxlcnQoYWxlcnQpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdmaWxlJzpcbiAgICAgICAgICBhd2FpdCB0aGlzLnNlbmRGaWxlQWxlcnQoYWxlcnQsIGNoYW5uZWwuY29uZmlnKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAna2lybyc6XG4gICAgICAgICAgYXdhaXQgdGhpcy5zZW5kS2lyb0FsZXJ0KGFsZXJ0LCBjaGFubmVsLmNvbmZpZyk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ3dlYmhvb2snOlxuICAgICAgICAgIGF3YWl0IHRoaXMuc2VuZFdlYmhvb2tBbGVydChhbGVydCwgY2hhbm5lbC5jb25maWcpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKGBGYWlsZWQgdG8gc2VuZCBhbGVydCB0byAke2NoYW5uZWwudHlwZX06YCwgZXJyb3IpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTZW5kIGNvbnNvbGUgYWxlcnRcbiAgICovXG4gIHByaXZhdGUgc2VuZENvbnNvbGVBbGVydChhbGVydDogQWxlcnQpOiB2b2lkIHtcbiAgICBjb25zdCBpY29uID0gdGhpcy5nZXRTZXZlcml0eUljb24oYWxlcnQuc2V2ZXJpdHkpO1xuICAgIGNvbnN0IHRpbWVzdGFtcCA9IGFsZXJ0LnRpbWVzdGFtcC50b0lTT1N0cmluZygpO1xuXG4gICAgY29uc29sZS5sb2coYCR7aWNvbn0gWyR7YWxlcnQuc2V2ZXJpdHkudG9VcHBlckNhc2UoKX1dICR7dGltZXN0YW1wfWApO1xuICAgIGNvbnNvbGUubG9nKGAgICBNZXRyaWM6ICR7YWxlcnQubWV0cmljfWApO1xuICAgIGNvbnNvbGUubG9nKGAgICBWYWx1ZTogJHthbGVydC5jdXJyZW50VmFsdWV9ICh0aHJlc2hvbGQ6ICR7YWxlcnQudGhyZXNob2xkfSlgKTtcbiAgICBjb25zb2xlLmxvZyhgICAgTWVzc2FnZTogJHthbGVydC5tZXNzYWdlfWApO1xuICAgIGNvbnNvbGUubG9nKCcnKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZW5kIGZpbGUgYWxlcnRcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgc2VuZEZpbGVBbGVydChhbGVydDogQWxlcnQsIGNvbmZpZzogUmVjb3JkPHN0cmluZywgYW55Pik6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IGFsZXJ0RmlsZSA9IGNvbmZpZy5maWxlIHx8ICcua2lyby9tZXRyaWNzL2FsZXJ0cy5sb2cnO1xuICAgIGNvbnN0IHRpbWVzdGFtcCA9IGFsZXJ0LnRpbWVzdGFtcC50b0lTT1N0cmluZygpO1xuICAgIGNvbnN0IGxvZ0VudHJ5ID0gYFske3RpbWVzdGFtcH1dICR7YWxlcnQuc2V2ZXJpdHkudG9VcHBlckNhc2UoKX06ICR7YWxlcnQubWVzc2FnZX0gKCR7YWxlcnQubWV0cmljfTogJHthbGVydC5jdXJyZW50VmFsdWV9LyR7YWxlcnQudGhyZXNob2xkfSlcXG5gO1xuXG4gICAgdHJ5IHtcbiAgICAgIC8vIEFwcGVuZCB0byBmaWxlXG4gICAgICBleGVjU3luYyhgZWNobyBcIiR7bG9nRW50cnl9XCIgPj4gXCIke2FsZXJ0RmlsZX1cImApO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gd3JpdGUgYWxlcnQgdG8gZmlsZTonLCBlcnJvcik7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFNlbmQgS2lybyBhbGVydCAoaW50ZWdyYXRpb24gd2l0aCBLaXJvIHN5c3RlbSlcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgc2VuZEtpcm9BbGVydChhbGVydDogQWxlcnQsIGNvbmZpZzogUmVjb3JkPHN0cmluZywgYW55Pik6IFByb21pc2U8dm9pZD4ge1xuICAgIC8vIENyZWF0ZSBLaXJvIG5vdGlmaWNhdGlvbiBmaWxlXG4gICAgY29uc3Qga2lyb0FsZXJ0ID0ge1xuICAgICAgaWQ6IGFsZXJ0LmlkLFxuICAgICAgdGltZXN0YW1wOiBhbGVydC50aW1lc3RhbXAsXG4gICAgICB0eXBlOiAnbGludGluZ19hbGVydCcsXG4gICAgICBzZXZlcml0eTogYWxlcnQuc2V2ZXJpdHksXG4gICAgICB0aXRsZTogYExpbnRpbmcgJHthbGVydC5zZXZlcml0eS50b1VwcGVyQ2FzZSgpfTogJHthbGVydC5tZXRyaWN9YCxcbiAgICAgIG1lc3NhZ2U6IGFsZXJ0Lm1lc3NhZ2UsXG4gICAgICBkYXRhOiB7XG4gICAgICAgIG1ldHJpYzogYWxlcnQubWV0cmljLFxuICAgICAgICBjdXJyZW50VmFsdWU6IGFsZXJ0LmN1cnJlbnRWYWx1ZSxcbiAgICAgICAgdGhyZXNob2xkOiBhbGVydC50aHJlc2hvbGQsXG4gICAgICB9LFxuICAgICAgYWN0aW9uczogdGhpcy5nZW5lcmF0ZUtpcm9BY3Rpb25zKGFsZXJ0KSxcbiAgICB9O1xuXG4gICAgY29uc3Qga2lyb0ZpbGUgPSAnLmtpcm8vbm90aWZpY2F0aW9ucy9saW50aW5nLWFsZXJ0cy5qc29uJztcbiAgICB3cml0ZUZpbGVTeW5jKGtpcm9GaWxlLCBKU09OLnN0cmluZ2lmeShraXJvQWxlcnQsIG51bGwsIDIpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZW5kIHdlYmhvb2sgYWxlcnRcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgc2VuZFdlYmhvb2tBbGVydChhbGVydDogQWxlcnQsIGNvbmZpZzogUmVjb3JkPHN0cmluZywgYW55Pik6IFByb21pc2U8dm9pZD4ge1xuICAgIGlmICghY29uZmlnLnVybCkge1xuICAgICAgY29uc29sZS53YXJuKCdXZWJob29rIFVSTCBub3QgY29uZmlndXJlZCcpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IHBheWxvYWQgPSB7XG4gICAgICBhbGVydF9pZDogYWxlcnQuaWQsXG4gICAgICB0aW1lc3RhbXA6IGFsZXJ0LnRpbWVzdGFtcCxcbiAgICAgIHNldmVyaXR5OiBhbGVydC5zZXZlcml0eSxcbiAgICAgIG1ldHJpYzogYWxlcnQubWV0cmljLFxuICAgICAgY3VycmVudF92YWx1ZTogYWxlcnQuY3VycmVudFZhbHVlLFxuICAgICAgdGhyZXNob2xkOiBhbGVydC50aHJlc2hvbGQsXG4gICAgICBtZXNzYWdlOiBhbGVydC5tZXNzYWdlLFxuICAgICAgc291cmNlOiAnbGludGluZy1leGNlbGxlbmNlLWRhc2hib2FyZCcsXG4gICAgfTtcblxuICAgIHRyeSB7XG4gICAgICAvLyBVc2UgY3VybCBmb3Igd2ViaG9vayAoTm9kZS5qcyBmZXRjaCBtaWdodCBub3QgYmUgYXZhaWxhYmxlKVxuICAgICAgY29uc3QgY3VybENvbW1hbmQgPSBgY3VybCAtWCBQT1NUIFwiJHtjb25maWcudXJsfVwiIFxcXG4gICAgICAgIC1IIFwiQ29udGVudC1UeXBlOiBhcHBsaWNhdGlvbi9qc29uXCIgXFxcbiAgICAgICAgLWQgJyR7SlNPTi5zdHJpbmdpZnkocGF5bG9hZCl9J2A7XG5cbiAgICAgIGV4ZWNTeW5jKGN1cmxDb21tYW5kLCB7IHN0ZGlvOiAncGlwZScgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBzZW5kIHdlYmhvb2sgYWxlcnQ6JywgZXJyb3IpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBQcm9jZXNzIHBlcmZvcm1hbmNlIGV2ZW50IGFuZCB0cmlnZ2VyIHJlc3BvbnNlc1xuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBwcm9jZXNzUGVyZm9ybWFuY2VFdmVudChldmVudDogUGVyZm9ybWFuY2VFdmVudCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnNvbGUubG9nKGDwn5OKIFBlcmZvcm1hbmNlIGV2ZW50OiAke2V2ZW50LnR5cGV9IGZvciAke2V2ZW50Lm1ldHJpY31gKTtcblxuICAgIC8vIExvZyBwZXJmb3JtYW5jZSBldmVudFxuICAgIGNvbnN0IHBlcmZvcm1hbmNlTG9nID0gYC5raXJvL21ldHJpY3MvcGVyZm9ybWFuY2UtZXZlbnRzLmxvZ2A7XG4gICAgY29uc3QgbG9nRW50cnkgPSBgWyR7ZXZlbnQudGltZXN0YW1wLnRvSVNPU3RyaW5nKCl9XSAke2V2ZW50LnR5cGUudG9VcHBlckNhc2UoKX06ICR7ZXZlbnQubWV0cmljfSA9ICR7ZXZlbnQudmFsdWV9ICh0aHJlc2hvbGQ6ICR7ZXZlbnQudGhyZXNob2xkfSwgaW1wYWN0OiAke2V2ZW50LmltcGFjdH0pXFxuYDtcblxuICAgIHRyeSB7XG4gICAgICBleGVjU3luYyhgZWNobyBcIiR7bG9nRW50cnl9XCIgPj4gXCIke3BlcmZvcm1hbmNlTG9nfVwiYCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBsb2cgcGVyZm9ybWFuY2UgZXZlbnQ6JywgZXJyb3IpO1xuICAgIH1cblxuICAgIC8vIFVwZGF0ZSBwZXJmb3JtYW5jZSBoaXN0b3J5XG4gICAgdGhpcy51cGRhdGVQZXJmb3JtYW5jZUhpc3RvcnkoZXZlbnQpO1xuICB9XG5cbiAgLyoqXG4gICAqIFRyaWdnZXIgYXV0b21hdGljIHJlc3BvbnNlcyBiYXNlZCBvbiBhbGVydHMgYW5kIHBlcmZvcm1hbmNlIGV2ZW50c1xuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyB0cmlnZ2VyQXV0b1Jlc3BvbnNlcyhhbGVydHM6IEFsZXJ0W10sIGV2ZW50czogUGVyZm9ybWFuY2VFdmVudFtdKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgYWN0aW9ucyA9IHRoaXMuY29uZmlnLmF1dG9SZXNwb25zZS5hY3Rpb25zO1xuXG4gICAgZm9yIChjb25zdCBhY3Rpb24gb2YgYWN0aW9ucykge1xuICAgICAgaWYgKHRoaXMuc2hvdWxkVHJpZ2dlckFjdGlvbihhY3Rpb24sIGFsZXJ0cywgZXZlbnRzKSkge1xuICAgICAgICBhd2FpdCB0aGlzLmV4ZWN1dGVBdXRvUmVzcG9uc2UoYWN0aW9uKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRXhlY3V0ZSBhdXRvbWF0aWMgcmVzcG9uc2UgYWN0aW9uXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGV4ZWN1dGVBdXRvUmVzcG9uc2UoYWN0aW9uOiBBdXRvUmVzcG9uc2VBY3Rpb24pOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zb2xlLmxvZyhg8J+kliBFeGVjdXRpbmcgYXV0by1yZXNwb25zZTogJHthY3Rpb24uYWN0aW9ufWApO1xuXG4gICAgdHJ5IHtcbiAgICAgIHN3aXRjaCAoYWN0aW9uLmFjdGlvbikge1xuICAgICAgICBjYXNlICdlbmFibGVDYWNoZSc6XG4gICAgICAgICAgYXdhaXQgdGhpcy5lbmFibGVMaW50aW5nQ2FjaGUoKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAncmVkdWNlQmF0Y2hTaXplJzpcbiAgICAgICAgICBhd2FpdCB0aGlzLnJlZHVjZUJhdGNoU2l6ZShhY3Rpb24ucGFyYW1ldGVycy5uZXdTaXplIHx8IDEwKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnc2tpcE5vbkNyaXRpY2FsJzpcbiAgICAgICAgICBhd2FpdCB0aGlzLnNraXBOb25Dcml0aWNhbFJ1bGVzKCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ2VtZXJnZW5jeVN0b3AnOlxuICAgICAgICAgIGF3YWl0IHRoaXMuZW1lcmdlbmN5U3RvcCgpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKGBGYWlsZWQgdG8gZXhlY3V0ZSBhdXRvLXJlc3BvbnNlICR7YWN0aW9uLmFjdGlvbn06YCwgZXJyb3IpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBGaWx0ZXIgYWxlcnRzIGJhc2VkIG9uIGNvb2xkb3duIGFuZCBzdXBwcmVzc2lvblxuICAgKi9cbiAgcHJpdmF0ZSBmaWx0ZXJBY3RpdmVBbGVydHMoYWxlcnRzOiBBbGVydFtdKTogQWxlcnRbXSB7XG4gICAgcmV0dXJuIGFsZXJ0cy5maWx0ZXIoYWxlcnQgPT4ge1xuICAgICAgLy8gQ2hlY2sgc3VwcHJlc3Npb25cbiAgICAgIGlmICh0aGlzLnN1cHByZXNzZWRBbGVydHMuaGFzKGFsZXJ0Lm1ldHJpYykpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuXG4gICAgICAvLyBDaGVjayBjb29sZG93blxuICAgICAgY29uc3QgbGFzdEFsZXJ0ID0gdGhpcy5sYXN0QWxlcnRUaW1lLmdldChhbGVydC5tZXRyaWMpO1xuICAgICAgaWYgKGxhc3RBbGVydCkge1xuICAgICAgICBjb25zdCBjb29sZG93bk1zID0gdGhpcy5jb25maWcucmVncmVzc2lvbkRldGVjdGlvbi5jb29sZG93blBlcmlvZCAqIDYwICogMTAwMDtcbiAgICAgICAgaWYgKERhdGUubm93KCkgLSBsYXN0QWxlcnQuZ2V0VGltZSgpIDwgY29vbGRvd25Ncykge1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZSBLaXJvLXNwZWNpZmljIGFjdGlvbnMgZm9yIGFsZXJ0c1xuICAgKi9cbiAgcHJpdmF0ZSBnZW5lcmF0ZUtpcm9BY3Rpb25zKGFsZXJ0OiBBbGVydCk6IEFycmF5PFJlY29yZDxzdHJpbmcsIHVua25vd24+PiB7XG4gICAgY29uc3QgYWN0aW9uczogQXJyYXk8UmVjb3JkPHN0cmluZywgdW5rbm93bj4+ID0gW107XG5cbiAgICBpZiAoYWxlcnQubWV0cmljID09PSAncGFyc2VyRXJyb3JzJyAmJiBhbGVydC5jdXJyZW50VmFsdWUgPiAwKSB7XG4gICAgICBhY3Rpb25zLnB1c2goe1xuICAgICAgICB0eXBlOiAnY29tbWFuZCcsXG4gICAgICAgIGxhYmVsOiAnRml4IFBhcnNlciBFcnJvcnMnLFxuICAgICAgICBjb21tYW5kOiAneWFybiB0c2MgLS1ub0VtaXQnLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ1J1biBUeXBlU2NyaXB0IGNvbXBpbGVyIHRvIGlkZW50aWZ5IHN5bnRheCBlcnJvcnMnLFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgaWYgKGFsZXJ0Lm1ldHJpYyA9PT0gJ2V4cGxpY2l0QW55RXJyb3JzJyAmJiBhbGVydC5jdXJyZW50VmFsdWUgPiAxMDApIHtcbiAgICAgIGFjdGlvbnMucHVzaCh7XG4gICAgICAgIHR5cGU6ICdjYW1wYWlnbicsXG4gICAgICAgIGxhYmVsOiAnU3RhcnQgRXhwbGljaXQgQW55IENhbXBhaWduJyxcbiAgICAgICAgY2FtcGFpZ246ICdleHBsaWNpdC1hbnktZWxpbWluYXRpb24nLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ0xhdW5jaCBzeXN0ZW1hdGljIGV4cGxpY2l0IGFueSB0eXBlIGVsaW1pbmF0aW9uJyxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGlmIChhbGVydC5tZXRyaWMgPT09ICdpbXBvcnRPcmRlcklzc3VlcycgJiYgYWxlcnQuY3VycmVudFZhbHVlID4gNTApIHtcbiAgICAgIGFjdGlvbnMucHVzaCh7XG4gICAgICAgIHR5cGU6ICdjb21tYW5kJyxcbiAgICAgICAgbGFiZWw6ICdGaXggSW1wb3J0IE9yZGVyJyxcbiAgICAgICAgY29tbWFuZDogJ3lhcm4gbGludDpmaXgnLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ0F1dG9tYXRpY2FsbHkgb3JnYW5pemUgaW1wb3J0cyB3aXRoIGVuaGFuY2VkIHJ1bGVzJyxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHJldHVybiBhY3Rpb25zO1xuICB9XG5cbiAgLy8gQXV0by1yZXNwb25zZSBpbXBsZW1lbnRhdGlvbnNcbiAgcHJpdmF0ZSBhc3luYyBlbmFibGVMaW50aW5nQ2FjaGUoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc29sZS5sb2coJ/CfmoAgRW5hYmxpbmcgRVNMaW50IGNhY2hpbmcgZm9yIGltcHJvdmVkIHBlcmZvcm1hbmNlJyk7XG4gICAgLy8gQ2FjaGUgaXMgYWxyZWFkeSBlbmFibGVkIGluIGVzbGludC5jb25maWcuY2pzLCB0aGlzIGlzIGEgbm8tb3BcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgcmVkdWNlQmF0Y2hTaXplKG5ld1NpemU6IG51bWJlcik6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnNvbGUubG9nKGDwn5OJIFJlZHVjaW5nIGJhdGNoIHNpemUgdG8gJHtuZXdTaXplfSBmb3IgYmV0dGVyIHBlcmZvcm1hbmNlYCk7XG4gICAgLy8gVGhpcyB3b3VsZCBpbnRlZ3JhdGUgd2l0aCBjYW1wYWlnbiBzeXN0ZW0gYmF0Y2ggcHJvY2Vzc2luZ1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBza2lwTm9uQ3JpdGljYWxSdWxlcygpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zb2xlLmxvZygn4pqhIFRlbXBvcmFyaWx5IHNraXBwaW5nIG5vbi1jcml0aWNhbCBydWxlcyBmb3IgcGVyZm9ybWFuY2UnKTtcbiAgICAvLyBUaGlzIHdvdWxkIGNyZWF0ZSBhIHRlbXBvcmFyeSBFU0xpbnQgY29uZmlnIHdpdGggcmVkdWNlZCBydWxlc1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBlbWVyZ2VuY3lTdG9wKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnNvbGUubG9nKCfwn5uRIEVtZXJnZW5jeSBzdG9wIHRyaWdnZXJlZCAtIGhhbHRpbmcgbGludGluZyBvcGVyYXRpb25zJyk7XG4gICAgLy8gVGhpcyB3b3VsZCBzdG9wIGFueSBydW5uaW5nIGxpbnRpbmcgY2FtcGFpZ25zXG4gIH1cblxuICAvLyBIZWxwZXIgbWV0aG9kc1xuICBwcml2YXRlIGxvYWRDb25maWd1cmF0aW9uKCk6IEFsZXJ0aW5nQ29uZmlnIHtcbiAgICB0cnkge1xuICAgICAgaWYgKGV4aXN0c1N5bmModGhpcy5jb25maWdGaWxlKSkge1xuICAgICAgICByZXR1cm4gSlNPTi5wYXJzZShyZWFkRmlsZVN5bmModGhpcy5jb25maWdGaWxlLCAndXRmOCcpKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS53YXJuKCdFcnJvciBsb2FkaW5nIGFsZXJ0aW5nIGNvbmZpZ3VyYXRpb246JywgZXJyb3IpO1xuICAgIH1cblxuICAgIC8vIFJldHVybiBkZWZhdWx0IGNvbmZpZ3VyYXRpb25cbiAgICByZXR1cm4ge1xuICAgICAgZW5hYmxlZDogdHJ1ZSxcbiAgICAgIGNoYW5uZWxzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICB0eXBlOiAnY29uc29sZScsXG4gICAgICAgICAgY29uZmlnOiB7fSxcbiAgICAgICAgICBzZXZlcml0eUZpbHRlcjogWyd3YXJuaW5nJywgJ2Vycm9yJywgJ2NyaXRpY2FsJ10sXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICB0eXBlOiAnZmlsZScsXG4gICAgICAgICAgY29uZmlnOiB7IGZpbGU6ICcua2lyby9tZXRyaWNzL2FsZXJ0cy5sb2cnIH0sXG4gICAgICAgICAgc2V2ZXJpdHlGaWx0ZXI6IFsnZXJyb3InLCAnY3JpdGljYWwnXSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHR5cGU6ICdraXJvJyxcbiAgICAgICAgICBjb25maWc6IHt9LFxuICAgICAgICAgIHNldmVyaXR5RmlsdGVyOiBbJ2NyaXRpY2FsJ10sXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgICAgcmVncmVzc2lvbkRldGVjdGlvbjoge1xuICAgICAgICBlbmFibGVkOiB0cnVlLFxuICAgICAgICBzZW5zaXRpdml0eTogJ21lZGl1bScsXG4gICAgICAgIGNvb2xkb3duUGVyaW9kOiAxNSwgLy8gMTUgbWludXRlc1xuICAgICAgfSxcbiAgICAgIHBlcmZvcm1hbmNlTW9uaXRvcmluZzoge1xuICAgICAgICBlbmFibGVkOiB0cnVlLFxuICAgICAgICB0aHJlc2hvbGRzOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgbWV0cmljOiAnZHVyYXRpb24nLFxuICAgICAgICAgICAgdGhyZXNob2xkOiAzMDAwMCwgLy8gMzAgc2Vjb25kc1xuICAgICAgICAgICAgc2V2ZXJpdHk6ICd3YXJuaW5nJyxcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdMaW50aW5nIGR1cmF0aW9uIGV4Y2VlZHMgMzAgc2Vjb25kcycsXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBtZXRyaWM6ICdtZW1vcnknLFxuICAgICAgICAgICAgdGhyZXNob2xkOiA1MTIsIC8vIDUxMiBNQlxuICAgICAgICAgICAgc2V2ZXJpdHk6ICd3YXJuaW5nJyxcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdNZW1vcnkgdXNhZ2UgZXhjZWVkcyA1MTJNQicsXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBtZXRyaWM6ICdjYWNoZUhpdFJhdGUnLFxuICAgICAgICAgICAgdGhyZXNob2xkOiAwLjUsIC8vIDUwJVxuICAgICAgICAgICAgc2V2ZXJpdHk6ICd3YXJuaW5nJyxcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdDYWNoZSBoaXQgcmF0ZSBiZWxvdyA1MCUnLFxuICAgICAgICAgIH0sXG4gICAgICAgIF0sXG4gICAgICB9LFxuICAgICAgYXV0b1Jlc3BvbnNlOiB7XG4gICAgICAgIGVuYWJsZWQ6IHRydWUsXG4gICAgICAgIGFjdGlvbnM6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICB0cmlnZ2VyOiAncGVyZm9ybWFuY2VfZGVncmFkYXRpb24nLFxuICAgICAgICAgICAgYWN0aW9uOiAnZW5hYmxlQ2FjaGUnLFxuICAgICAgICAgICAgcGFyYW1ldGVyczoge30sXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICB0cmlnZ2VyOiAnbWVtb3J5X2V4Y2VlZGVkJyxcbiAgICAgICAgICAgIGFjdGlvbjogJ3JlZHVjZUJhdGNoU2l6ZScsXG4gICAgICAgICAgICBwYXJhbWV0ZXJzOiB7IG5ld1NpemU6IDEwIH0sXG4gICAgICAgICAgfSxcbiAgICAgICAgXSxcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgbG9hZFN1cHByZXNzaW9ucygpOiB2b2lkIHtcbiAgICB0cnkge1xuICAgICAgaWYgKGV4aXN0c1N5bmModGhpcy5zdXBwcmVzc2lvbkZpbGUpKSB7XG4gICAgICAgIGNvbnN0IHN1cHByZXNzaW9ucyA9IEpTT04ucGFyc2UocmVhZEZpbGVTeW5jKHRoaXMuc3VwcHJlc3Npb25GaWxlLCAndXRmOCcpKTtcbiAgICAgICAgdGhpcy5zdXBwcmVzc2VkQWxlcnRzID0gbmV3IFNldChzdXBwcmVzc2lvbnMpO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLndhcm4oJ0Vycm9yIGxvYWRpbmcgYWxlcnQgc3VwcHJlc3Npb25zOicsIGVycm9yKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHVwZGF0ZUFsZXJ0SGlzdG9yeShhbGVydDogQWxlcnQpOiB2b2lkIHtcbiAgICB0aGlzLmxhc3RBbGVydFRpbWUuc2V0KGFsZXJ0Lm1ldHJpYywgYWxlcnQudGltZXN0YW1wKTtcblxuICAgIC8vIFN0b3JlIGluIGhpc3RvcnkgZmlsZVxuICAgIHRyeSB7XG4gICAgICBjb25zdCBoaXN0b3J5ID0gdGhpcy5sb2FkQWxlcnRIaXN0b3J5KCk7XG4gICAgICBoaXN0b3J5LmFsZXJ0cy5wdXNoKGFsZXJ0KTtcblxuICAgICAgLy8gS2VlcCBvbmx5IGxhc3QgMTAwMCBhbGVydHNcbiAgICAgIGlmIChoaXN0b3J5LmFsZXJ0cy5sZW5ndGggPiAxMDAwKSB7XG4gICAgICAgIGhpc3RvcnkuYWxlcnRzLnNwbGljZSgwLCBoaXN0b3J5LmFsZXJ0cy5sZW5ndGggLSAxMDAwKTtcbiAgICAgIH1cblxuICAgICAgd3JpdGVGaWxlU3luYyh0aGlzLmhpc3RvcnlGaWxlLCBKU09OLnN0cmluZ2lmeShoaXN0b3J5LCBudWxsLCAyKSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHVwZGF0aW5nIGFsZXJ0IGhpc3Rvcnk6JywgZXJyb3IpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgdXBkYXRlUGVyZm9ybWFuY2VIaXN0b3J5KGV2ZW50OiBQZXJmb3JtYW5jZUV2ZW50KTogdm9pZCB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGhpc3RvcnkgPSB0aGlzLmxvYWRBbGVydEhpc3RvcnkoKTtcbiAgICAgIGhpc3RvcnkucGVyZm9ybWFuY2VFdmVudHMucHVzaChldmVudCk7XG5cbiAgICAgIC8vIEtlZXAgb25seSBsYXN0IDUwMCBwZXJmb3JtYW5jZSBldmVudHNcbiAgICAgIGlmIChoaXN0b3J5LnBlcmZvcm1hbmNlRXZlbnRzLmxlbmd0aCA+IDUwMCkge1xuICAgICAgICBoaXN0b3J5LnBlcmZvcm1hbmNlRXZlbnRzLnNwbGljZSgwLCBoaXN0b3J5LnBlcmZvcm1hbmNlRXZlbnRzLmxlbmd0aCAtIDUwMCk7XG4gICAgICB9XG5cbiAgICAgIHdyaXRlRmlsZVN5bmModGhpcy5oaXN0b3J5RmlsZSwgSlNPTi5zdHJpbmdpZnkoaGlzdG9yeSwgbnVsbCwgMikpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciB1cGRhdGluZyBwZXJmb3JtYW5jZSBoaXN0b3J5OicsIGVycm9yKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGxvYWRBbGVydEhpc3RvcnkoKTogQWxlcnRIaXN0b3J5IHtcbiAgICB0cnkge1xuICAgICAgaWYgKGV4aXN0c1N5bmModGhpcy5oaXN0b3J5RmlsZSkpIHtcbiAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UocmVhZEZpbGVTeW5jKHRoaXMuaGlzdG9yeUZpbGUsICd1dGY4JykpO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLndhcm4oJ0Vycm9yIGxvYWRpbmcgYWxlcnQgaGlzdG9yeTonLCBlcnJvcik7XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIGFsZXJ0czogW10sXG4gICAgICBzdXBwcmVzc2VkQWxlcnRzOiBbXSxcbiAgICAgIHJlc29sdmVkQWxlcnRzOiBbXSxcbiAgICAgIHBlcmZvcm1hbmNlRXZlbnRzOiBbXSxcbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRQZXJmb3JtYW5jZU1ldHJpY1ZhbHVlKG1ldHJpY3M6IExpbnRpbmdNZXRyaWNzLCBtZXRyaWM6IHN0cmluZyk6IG51bWJlciB7XG4gICAgc3dpdGNoIChtZXRyaWMpIHtcbiAgICAgIGNhc2UgJ2R1cmF0aW9uJzpcbiAgICAgICAgcmV0dXJuIG1ldHJpY3MucGVyZm9ybWFuY2VNZXRyaWNzLmxpbnRpbmdEdXJhdGlvbjtcbiAgICAgIGNhc2UgJ21lbW9yeSc6XG4gICAgICAgIHJldHVybiBtZXRyaWNzLnBlcmZvcm1hbmNlTWV0cmljcy5tZW1vcnlVc2FnZTtcbiAgICAgIGNhc2UgJ2NhY2hlSGl0UmF0ZSc6XG4gICAgICAgIHJldHVybiBtZXRyaWNzLnBlcmZvcm1hbmNlTWV0cmljcy5jYWNoZUhpdFJhdGU7XG4gICAgICBjYXNlICdmaWxlc1BlclNlY29uZCc6XG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgbWV0cmljcy5wZXJmb3JtYW5jZU1ldHJpY3MuZmlsZXNQcm9jZXNzZWQgL1xuICAgICAgICAgIChtZXRyaWNzLnBlcmZvcm1hbmNlTWV0cmljcy5saW50aW5nRHVyYXRpb24gLyAxMDAwKVxuICAgICAgICApO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuIDA7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBpc1RocmVzaG9sZEV4Y2VlZGVkKHZhbHVlOiBudW1iZXIsIHRocmVzaG9sZDogUGVyZm9ybWFuY2VUaHJlc2hvbGQpOiBib29sZWFuIHtcbiAgICBpZiAodGhyZXNob2xkLm1ldHJpYyA9PT0gJ2NhY2hlSGl0UmF0ZScpIHtcbiAgICAgIHJldHVybiB2YWx1ZSA8IHRocmVzaG9sZC50aHJlc2hvbGQ7IC8vIENhY2hlIGhpdCByYXRlIHNob3VsZCBiZSBhYm92ZSB0aHJlc2hvbGRcbiAgICB9XG4gICAgcmV0dXJuIHZhbHVlID4gdGhyZXNob2xkLnRocmVzaG9sZDsgLy8gT3RoZXIgbWV0cmljcyBzaG91bGQgYmUgYmVsb3cgdGhyZXNob2xkXG4gIH1cblxuICBwcml2YXRlIGNhbGN1bGF0ZUltcGFjdChzZXZlcml0eTogc3RyaW5nKTogJ2xvdycgfCAnbWVkaXVtJyB8ICdoaWdoJyB7XG4gICAgc3dpdGNoIChzZXZlcml0eSkge1xuICAgICAgY2FzZSAnY3JpdGljYWwnOlxuICAgICAgICByZXR1cm4gJ2hpZ2gnO1xuICAgICAgY2FzZSAnZXJyb3InOlxuICAgICAgICByZXR1cm4gJ21lZGl1bSc7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICByZXR1cm4gJ2xvdyc7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzaG91bGRUcmlnZ2VyQWN0aW9uKFxuICAgIGFjdGlvbjogQXV0b1Jlc3BvbnNlQWN0aW9uLFxuICAgIGFsZXJ0czogQWxlcnRbXSxcbiAgICBldmVudHM6IFBlcmZvcm1hbmNlRXZlbnRbXSxcbiAgKTogYm9vbGVhbiB7XG4gICAgc3dpdGNoIChhY3Rpb24udHJpZ2dlcikge1xuICAgICAgY2FzZSAncGVyZm9ybWFuY2VfZGVncmFkYXRpb24nOlxuICAgICAgICByZXR1cm4gZXZlbnRzLnNvbWUoZSA9PiBlLnR5cGUgPT09ICd0aHJlc2hvbGRfZXhjZWVkZWQnICYmIGUuaW1wYWN0ID09PSAnaGlnaCcpO1xuICAgICAgY2FzZSAnbWVtb3J5X2V4Y2VlZGVkJzpcbiAgICAgICAgcmV0dXJuIGV2ZW50cy5zb21lKGUgPT4gZS5tZXRyaWMgPT09ICdtZW1vcnknICYmIGUudHlwZSA9PT0gJ3RocmVzaG9sZF9leGNlZWRlZCcpO1xuICAgICAgY2FzZSAnY3JpdGljYWxfYWxlcnQnOlxuICAgICAgICByZXR1cm4gYWxlcnRzLnNvbWUoYSA9PiBhLnNldmVyaXR5ID09PSAnY3JpdGljYWwnKTtcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGdldFNldmVyaXR5SWNvbihzZXZlcml0eTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICBzd2l0Y2ggKHNldmVyaXR5KSB7XG4gICAgICBjYXNlICdjcml0aWNhbCc6XG4gICAgICAgIHJldHVybiAn8J+aqCc7XG4gICAgICBjYXNlICdlcnJvcic6XG4gICAgICAgIHJldHVybiAn4p2MJztcbiAgICAgIGNhc2UgJ3dhcm5pbmcnOlxuICAgICAgICByZXR1cm4gJ+KaoO+4jyc7XG4gICAgICBjYXNlICdpbmZvJzpcbiAgICAgICAgcmV0dXJuICfihLnvuI8nO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuICfwn5OLJztcbiAgICB9XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==