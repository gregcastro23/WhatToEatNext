76cec12588bdfe77b8f2e842b60c2fed
"use strict";
/**
 * Campaign Controller Core
 * Perfect Codebase Campaign - Main Controller Implementation
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.CampaignController = void 0;
const campaign_1 = require("../../types/campaign");
class CampaignController {
    config;
    currentPhase = null;
    safetyEvents = [];
    constructor(config) {
        this.config = config;
    }
    /**
     * Execute a specific campaign phase
     */
    async executePhase(phase) {
        const startTime = Date.now();
        this.currentPhase = phase;
        this.addSafetyEvent({
            type: campaign_1.SafetyEventType.CHECKPOINT_CREATED,
            timestamp: new Date(),
            description: `Starting phase: ${phase.name}`,
            severity: campaign_1.SafetyEventSeverity.INFO,
            action: 'PHASE_START'
        });
        try {
            // Create safety checkpoint before phase execution
            const checkpointId = await this.createSafetyCheckpoint(`Pre-phase checkpoint: ${phase.name}`);
            // Initialize phase metrics
            const initialMetrics = await this.getCurrentMetrics();
            // Execute phase tools in sequence
            let filesProcessed = 0;
            let errorsFixed = 0;
            const warningsFixed = 0;
            for (const tool of phase.tools) {
                const toolResult = await this.executeTool(tool);
                filesProcessed += toolResult.filesProcessed.length;
                errorsFixed += toolResult.changesApplied;
                // Validate after each tool execution
                const validation = await this.validatePhaseProgress(phase);
                if (!validation.success && this.config.safetySettings.automaticRollbackEnabled) {
                    await this.rollbackToCheckpoint(checkpointId);
                    throw new Error(`Tool execution failed: ${validation.errors.join(', ')}`);
                }
            }
            // Get final metrics and calculate improvement
            const finalMetrics = await this.getCurrentMetrics();
            const metricsImprovement = this.calculateMetricsImprovement(initialMetrics, finalMetrics);
            const executionTime = Date.now() - startTime;
            const result = {
                phaseId: phase.id,
                success: true,
                metricsImprovement,
                filesProcessed,
                errorsFixed,
                warningsFixed,
                executionTime,
                safetyEvents: [...this.safetyEvents]
            };
            this.addSafetyEvent({
                type: campaign_1.SafetyEventType.CHECKPOINT_CREATED,
                timestamp: new Date(),
                description: `Phase completed successfully: ${phase.name}`,
                severity: campaign_1.SafetyEventSeverity.INFO,
                action: 'PHASE_COMPLETE'
            });
            return result;
        }
        catch (error) {
            this.addSafetyEvent({
                type: campaign_1.SafetyEventType.BUILD_FAILURE,
                timestamp: new Date(),
                description: `Phase execution failed: ${error.message}`,
                severity: campaign_1.SafetyEventSeverity.ERROR,
                action: 'PHASE_FAILED'
            });
            const executionTime = Date.now() - startTime;
            return {
                phaseId: phase.id,
                success: false,
                metricsImprovement: {
                    typeScriptErrorsReduced: 0,
                    lintingWarningsReduced: 0,
                    buildTimeImproved: 0,
                    enterpriseSystemsAdded: 0
                },
                filesProcessed: 0,
                errorsFixed: 0,
                warningsFixed: 0,
                executionTime,
                safetyEvents: [...this.safetyEvents]
            };
        }
    }
    /**
     * Validate phase completion against success criteria
     */
    async validatePhaseCompletion(phase) {
        try {
            const currentMetrics = await this.getCurrentMetrics();
            const errors = [];
            const warnings = [];
            // Check TypeScript errors if specified
            if (phase.successCriteria.typeScriptErrors !== undefined) {
                if (currentMetrics.typeScriptErrors.current > phase.successCriteria.typeScriptErrors) {
                    errors.push(`TypeScript errors: ${currentMetrics.typeScriptErrors.current} > ${phase.successCriteria.typeScriptErrors}`);
                }
            }
            // Check linting warnings if specified
            if (phase.successCriteria.lintingWarnings !== undefined) {
                if (currentMetrics.lintingWarnings.current > phase.successCriteria.lintingWarnings) {
                    errors.push(`Linting warnings: ${currentMetrics.lintingWarnings.current} > ${phase.successCriteria.lintingWarnings}`);
                }
            }
            // Check build time if specified
            if (phase.successCriteria.buildTime !== undefined) {
                if (currentMetrics.buildPerformance.currentTime > phase.successCriteria.buildTime) {
                    warnings.push(`Build time: ${currentMetrics.buildPerformance.currentTime}s > ${phase.successCriteria.buildTime}s`);
                }
            }
            // Check enterprise systems if specified
            if (phase.successCriteria.enterpriseSystems !== undefined) {
                if (currentMetrics.enterpriseSystems.current < phase.successCriteria.enterpriseSystems) {
                    errors.push(`Enterprise systems: ${currentMetrics.enterpriseSystems.current} < ${phase.successCriteria.enterpriseSystems}`);
                }
            }
            // Run custom validation if provided
            if (phase.successCriteria.customValidation) {
                const customResult = await phase.successCriteria.customValidation();
                if (!customResult) {
                    errors.push('Custom validation failed');
                }
            }
            return {
                success: errors.length === 0,
                errors,
                warnings,
                metrics: currentMetrics
            };
        }
        catch (error) {
            return {
                success: false,
                errors: [`Validation error: ${error.message}`],
                warnings: []
            };
        }
    }
    /**
     * Create a safety checkpoint with current state
     */
    async createSafetyCheckpoint(description) {
        // This will be implemented by the SafetyProtocol class
        // For now, return a mock checkpoint ID
        const checkpointId = `checkpoint_${Date.now()}`;
        this.addSafetyEvent({
            type: campaign_1.SafetyEventType.CHECKPOINT_CREATED,
            timestamp: new Date(),
            description: `Safety checkpoint created: ${description}`,
            severity: campaign_1.SafetyEventSeverity.INFO,
            action: 'CHECKPOINT_CREATE'
        });
        return checkpointId;
    }
    /**
     * Rollback to a specific checkpoint
     */
    async rollbackToCheckpoint(checkpointId) {
        this.addSafetyEvent({
            type: campaign_1.SafetyEventType.ROLLBACK_TRIGGERED,
            timestamp: new Date(),
            description: `Rolling back to checkpoint: ${checkpointId}`,
            severity: campaign_1.SafetyEventSeverity.WARNING,
            action: 'ROLLBACK'
        });
        // This will be implemented by the SafetyProtocol class
        // For now, just log the rollback attempt
        console.log(`Rollback to checkpoint ${checkpointId} requested`);
    }
    /**
     * Get current progress metrics
     */
    async getProgressMetrics() {
        return this.getCurrentMetrics();
    }
    /**
     * Generate comprehensive phase report
     */
    async generatePhaseReport(phase) {
        const currentMetrics = await this.getCurrentMetrics();
        const validation = await this.validatePhaseCompletion(phase);
        return {
            phaseId: phase.id,
            phaseName: phase.name,
            startTime: new Date(),
            status: validation.success ? campaign_1.PhaseStatus.COMPLETED : campaign_1.PhaseStatus.IN_PROGRESS,
            metrics: currentMetrics,
            achievements: this.generateAchievements(phase, currentMetrics),
            issues: validation.errors,
            recommendations: this.generateRecommendations(phase, validation)
        };
    }
    /**
     * Load and validate campaign configuration
     */
    static async loadConfiguration(configPath) {
        // Default configuration based on the design document
        const defaultConfig = {
            phases: [
                {
                    id: 'phase1',
                    name: 'TypeScript Error Elimination',
                    description: 'Eliminate all TypeScript compilation errors',
                    tools: [
                        {
                            scriptPath: 'scripts/typescript-fixes/fix-typescript-errors-enhanced-v3.js',
                            parameters: { maxFiles: 15, autoFix: true, validateSafety: true },
                            batchSize: 15,
                            safetyLevel: 'MAXIMUM'
                        }
                    ],
                    successCriteria: {
                        typeScriptErrors: 0
                    },
                    safetyCheckpoints: []
                },
                {
                    id: 'phase2',
                    name: 'Linting Excellence Achievement',
                    description: 'Eliminate all linting warnings',
                    tools: [
                        {
                            scriptPath: 'scripts/typescript-fixes/fix-explicit-any-systematic.js',
                            parameters: { maxFiles: 25, autoFix: true },
                            batchSize: 25,
                            safetyLevel: 'HIGH'
                        }
                    ],
                    successCriteria: {
                        lintingWarnings: 0
                    },
                    safetyCheckpoints: []
                }
            ],
            safetySettings: {
                maxFilesPerBatch: 25,
                buildValidationFrequency: 5,
                testValidationFrequency: 10,
                corruptionDetectionEnabled: true,
                automaticRollbackEnabled: true,
                stashRetentionDays: 7
            },
            progressTargets: {
                typeScriptErrors: 0,
                lintingWarnings: 0,
                buildTime: 10,
                enterpriseSystems: 200
            },
            toolConfiguration: {
                enhancedErrorFixer: 'scripts/typescript-fixes/fix-typescript-errors-enhanced-v3.js',
                explicitAnyFixer: 'scripts/typescript-fixes/fix-explicit-any-systematic.js',
                unusedVariablesFixer: 'scripts/typescript-fixes/fix-unused-variables-enhanced.js',
                consoleStatementFixer: 'scripts/lint-fixes/fix-console-statements-only.js'
            }
        };
        // If configPath is provided, load from file
        // For now, return default configuration
        return defaultConfig;
    }
    // Private helper methods
    async executeTool(tool) {
        // Mock implementation - will be replaced by actual script execution
        return {
            filesProcessed: [],
            changesApplied: 0,
            success: true
        };
    }
    async validatePhaseProgress(phase) {
        // Mock implementation - will be replaced by actual validation
        return {
            success: true,
            errors: [],
            warnings: []
        };
    }
    async getCurrentMetrics() {
        // This will be implemented by the ProgressTracker class
        // For now, return mock metrics
        return {
            typeScriptErrors: {
                current: 86,
                target: 0,
                reduction: 0,
                percentage: 0
            },
            lintingWarnings: {
                current: 4506,
                target: 0,
                reduction: 0,
                percentage: 0
            },
            buildPerformance: {
                currentTime: 8.5,
                targetTime: 10,
                cacheHitRate: 0.8,
                memoryUsage: 45
            },
            enterpriseSystems: {
                current: 0,
                target: 200,
                transformedExports: 0
            }
        };
    }
    calculateMetricsImprovement(initial, final) {
        return {
            typeScriptErrorsReduced: initial.typeScriptErrors.current - final.typeScriptErrors.current,
            lintingWarningsReduced: initial.lintingWarnings.current - final.lintingWarnings.current,
            buildTimeImproved: initial.buildPerformance.currentTime - final.buildPerformance.currentTime,
            enterpriseSystemsAdded: final.enterpriseSystems.current - initial.enterpriseSystems.current
        };
    }
    generateAchievements(phase, metrics) {
        const achievements = [];
        if (metrics.typeScriptErrors.current === 0) {
            achievements.push('Zero TypeScript errors achieved');
        }
        if (metrics.lintingWarnings.current === 0) {
            achievements.push('Zero linting warnings achieved');
        }
        if (metrics.buildPerformance.currentTime <= 10) {
            achievements.push('Build time under 10 seconds maintained');
        }
        return achievements;
    }
    generateRecommendations(phase, validation) {
        const recommendations = [];
        if (validation.errors.length > 0) {
            recommendations.push('Address validation errors before proceeding');
        }
        if (validation.warnings.length > 0) {
            recommendations.push('Consider addressing warnings for optimal performance');
        }
        return recommendations;
    }
    addSafetyEvent(event) {
        this.safetyEvents.push(event);
        // Keep only recent events to prevent memory issues
        if (this.safetyEvents.length > 1000) {
            this.safetyEvents = this.safetyEvents.slice(-500);
        }
    }
}
exports.CampaignController = CampaignController;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9zZXJ2aWNlcy9jYW1wYWlnbi9DYW1wYWlnbkNvbnRyb2xsZXIudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7R0FHRzs7O0FBRUgsbURBYThCO0FBRTlCLE1BQWEsa0JBQWtCO0lBQ3JCLE1BQU0sQ0FBaUI7SUFDdkIsWUFBWSxHQUF5QixJQUFJLENBQUM7SUFDMUMsWUFBWSxHQUFrQixFQUFFLENBQUM7SUFFekMsWUFBWSxNQUFzQjtRQUNoQyxJQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztJQUN2QixDQUFDO0lBRUQ7O09BRUc7SUFDSCxLQUFLLENBQUMsWUFBWSxDQUFDLEtBQW9CO1FBQ3JDLE1BQU0sU0FBUyxHQUFHLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQztRQUM3QixJQUFJLENBQUMsWUFBWSxHQUFHLEtBQUssQ0FBQztRQUUxQixJQUFJLENBQUMsY0FBYyxDQUFDO1lBQ2xCLElBQUksRUFBRSwwQkFBZSxDQUFDLGtCQUFrQjtZQUN4QyxTQUFTLEVBQUUsSUFBSSxJQUFJLEVBQUU7WUFDckIsV0FBVyxFQUFFLG1CQUFtQixLQUFLLENBQUMsSUFBSSxFQUFFO1lBQzVDLFFBQVEsRUFBRSw4QkFBbUIsQ0FBQyxJQUFJO1lBQ2xDLE1BQU0sRUFBRSxhQUFhO1NBQ3RCLENBQUMsQ0FBQztRQUVILElBQUk7WUFDRixrREFBa0Q7WUFDbEQsTUFBTSxZQUFZLEdBQUcsTUFBTSxJQUFJLENBQUMsc0JBQXNCLENBQ3BELHlCQUF5QixLQUFLLENBQUMsSUFBSSxFQUFFLENBQ3RDLENBQUM7WUFFRiwyQkFBMkI7WUFDM0IsTUFBTSxjQUFjLEdBQUcsTUFBTSxJQUFJLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztZQUV0RCxrQ0FBa0M7WUFDbEMsSUFBSSxjQUFjLEdBQUcsQ0FBQyxDQUFDO1lBQ3ZCLElBQUksV0FBVyxHQUFHLENBQUMsQ0FBQztZQUNwQixNQUFNLGFBQWEsR0FBRyxDQUFDLENBQUM7WUFFeEIs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SSxDQUFDLGlDQUFpQyxDQUFDLENBQUM7U0FDdEQ7UUFFRCxJQUFJLE9BQU8sQ0FBQyxlQUFlLENBQUMsT0FBTyxLQUFLLENBQUMsRUFBRTtZQUN6QyxZQUFZLENBQUMsSUFBSSxDQUFDLGdDQUFnQyxDQUFDLENBQUM7U0FDckQ7UUFFRCxJQUFJLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxXQUFXLElBQUksRUFBRSxFQUFFO1lBQzlDLFlBQVksQ0FBQyxJQUFJLENBQUMsd0NBQXdDLENBQUMsQ0FBQztTQUM3RDtRQUVELE9BQU8sWUFBWSxDQUFDO0lBQ3RCLENBQUM7SUFFTyx1QkFBdUIsQ0FBQyxLQUFvQixFQUFFLFVBQTRCO1FBQ2hGLE1BQU0sZUFBZSxHQUFhLEVBQUUsQ0FBQztRQUVyQyxJQUFJLFVBQVUsQ0FBQyxNQUFNLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtZQUNoQyxlQUFlLENBQUMsSUFBSSxDQUFDLDZDQUE2QyxDQUFDLENBQUM7U0FDckU7UUFFRCxJQUFJLFVBQVUsQ0FBQyxRQUFRLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtZQUNsQyxlQUFlLENBQUMsSUFBSSxDQUFDLHNEQUFzRCxDQUFDLENBQUM7U0FDOUU7UUFFRCxPQUFPLGVBQWUsQ0FBQztJQUN6QixDQUFDO0lBRU8sY0FBYyxDQUFDLEtBQWtCO1FBQ3ZDLElBQUksQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBRTlCLG1EQUFtRDtRQUNuRCxJQUFJLElBQUksQ0FBQyxZQUFZLENBQUMsTUFBTSxHQUFHLElBQUksRUFBRTtZQUNuQyxJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQyxZQUFZLENBQUMsS0FBSyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUM7U0FDbkQ7SUFDSCxDQUFDO0NBQ0Y7QUF6WkQsZ0RBeVpDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9HcmVnQ2FzdHJvL0Rlc2t0b3AvV2hhdFRvRWF0TmV4dC9zcmMvc2VydmljZXMvY2FtcGFpZ24vQ2FtcGFpZ25Db250cm9sbGVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ2FtcGFpZ24gQ29udHJvbGxlciBDb3JlXG4gKiBQZXJmZWN0IENvZGViYXNlIENhbXBhaWduIC0gTWFpbiBDb250cm9sbGVyIEltcGxlbWVudGF0aW9uXG4gKi9cblxuaW1wb3J0IHtcbiAgQ2FtcGFpZ25Db25maWcsXG4gIENhbXBhaWduUGhhc2UsXG4gIFBoYXNlUmVzdWx0LFxuICBQcm9ncmVzc01ldHJpY3MsXG4gIFZhbGlkYXRpb25SZXN1bHQsXG4gIENoZWNrcG9pbnRJZCxcbiAgUGhhc2VSZXBvcnQsXG4gIFBoYXNlU3RhdHVzLFxuICBTYWZldHlFdmVudCxcbiAgU2FmZXR5RXZlbnRUeXBlLFxuICBTYWZldHlFdmVudFNldmVyaXR5LFxuICBNZXRyaWNzSW1wcm92ZW1lbnRcbn0gZnJvbSAnLi4vLi4vdHlwZXMvY2FtcGFpZ24nO1xuXG5leHBvcnQgY2xhc3MgQ2FtcGFpZ25Db250cm9sbGVyIHtcbiAgcHJpdmF0ZSBjb25maWc6IENhbXBhaWduQ29uZmlnO1xuICBwcml2YXRlIGN1cnJlbnRQaGFzZTogQ2FtcGFpZ25QaGFzZSB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIHNhZmV0eUV2ZW50czogU2FmZXR5RXZlbnRbXSA9IFtdO1xuXG4gIGNvbnN0cnVjdG9yKGNvbmZpZzogQ2FtcGFpZ25Db25maWcpIHtcbiAgICB0aGlzLmNvbmZpZyA9IGNvbmZpZztcbiAgfVxuXG4gIC8qKlxuICAgKiBFeGVjdXRlIGEgc3BlY2lmaWMgY2FtcGFpZ24gcGhhc2VcbiAgICovXG4gIGFzeW5jIGV4ZWN1dGVQaGFzZShwaGFzZTogQ2FtcGFpZ25QaGFzZSk6IFByb21pc2U8UGhhc2VSZXN1bHQ+IHtcbiAgICBjb25zdCBzdGFydFRpbWUgPSBEYXRlLm5vdygpO1xuICAgIHRoaXMuY3VycmVudFBoYXNlID0gcGhhc2U7XG4gICAgXG4gICAgdGhpcy5hZGRTYWZldHlFdmVudCh7XG4gICAgICB0eXBlOiBTYWZldHlFdmVudFR5cGUuQ0hFQ0tQT0lOVF9DUkVBVEVELFxuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuICAgICAgZGVzY3JpcHRpb246IGBTdGFydGluZyBwaGFzZTogJHtwaGFzZS5uYW1lfWAsXG4gICAgICBzZXZlcml0eTogU2FmZXR5RXZlbnRTZXZlcml0eS5JTkZPLFxuICAgICAgYWN0aW9uOiAnUEhBU0VfU1RBUlQnXG4gICAgfSk7XG5cbiAgICB0cnkge1xuICAgICAgLy8gQ3JlYXRlIHNhZmV0eSBjaGVja3BvaW50IGJlZm9yZSBwaGFzZSBleGVjdXRpb25cbiAgICAgIGNvbnN0IGNoZWNrcG9pbnRJZCA9IGF3YWl0IHRoaXMuY3JlYXRlU2FmZXR5Q2hlY2twb2ludChcbiAgICAgICAgYFByZS1waGFzZSBjaGVja3BvaW50OiAke3BoYXNlLm5hbWV9YFxuICAgICAgKTtcblxuICAgICAgLy8gSW5pdGlhbGl6ZSBwaGFzZSBtZXRyaWNzXG4gICAgICBjb25zdCBpbml0aWFsTWV0cmljcyA9IGF3YWl0IHRoaXMuZ2V0Q3VycmVudE1ldHJpY3MoKTtcbiAgICAgIFxuICAgICAgLy8gRXhlY3V0ZSBwaGFzZSB0b29scyBpbiBzZXF1ZW5jZVxuICAgICAgbGV0IGZpbGVzUHJvY2Vzc2VkID0gMDtcbiAgICAgIGxldCBlcnJvcnNGaXhlZCA9IDA7XG4gICAgICBjb25zdCB3YXJuaW5nc0ZpeGVkID0gMDtcblxuICAgICAgZm9yIChjb25zdCB0b29sIG9mIHBoYXNlLnRvb2xzKSB7XG4gICAgICAgIGNvbnN0IHRvb2xSZXN1bHQgPSBhd2FpdCB0aGlzLmV4ZWN1dGVUb29sKHRvb2wpO1xuICAgICAgICBmaWxlc1Byb2Nlc3NlZCArPSB0b29sUmVzdWx0LmZpbGVzUHJvY2Vzc2VkLmxlbmd0aDtcbiAgICAgICAgZXJyb3JzRml4ZWQgKz0gdG9vbFJlc3VsdC5jaGFuZ2VzQXBwbGllZDtcbiAgICAgICAgXG4gICAgICAgIC8vIFZhbGlkYXRlIGFmdGVyIGVhY2ggdG9vbCBleGVjdXRpb25cbiAgICAgICAgY29uc3QgdmFsaWRhdGlvbiA9IGF3YWl0IHRoaXMudmFsaWRhdGVQaGFzZVByb2dyZXNzKHBoYXNlKTtcbiAgICAgICAgaWYgKCF2YWxpZGF0aW9uLnN1Y2Nlc3MgJiYgdGhpcy5jb25maWcuc2FmZXR5U2V0dGluZ3MuYXV0b21hdGljUm9sbGJhY2tFbmFibGVkKSB7XG4gICAgICAgICAgYXdhaXQgdGhpcy5yb2xsYmFja1RvQ2hlY2twb2ludChjaGVja3BvaW50SWQpO1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgVG9vbCBleGVjdXRpb24gZmFpbGVkOiAke3ZhbGlkYXRpb24uZXJyb3JzLmpvaW4oJywgJyl9YCk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gR2V0IGZpbmFsIG1ldHJpY3MgYW5kIGNhbGN1bGF0ZSBpbXByb3ZlbWVudFxuICAgICAgY29uc3QgZmluYWxNZXRyaWNzID0gYXdhaXQgdGhpcy5nZXRDdXJyZW50TWV0cmljcygpO1xuICAgICAgY29uc3QgbWV0cmljc0ltcHJvdmVtZW50ID0gdGhpcy5jYWxjdWxhdGVNZXRyaWNzSW1wcm92ZW1lbnQoaW5pdGlhbE1ldHJpY3MsIGZpbmFsTWV0cmljcyk7XG5cbiAgICAgIGNvbnN0IGV4ZWN1dGlvblRpbWUgPSBEYXRlLm5vdygpIC0gc3RhcnRUaW1lO1xuXG4gICAgICBjb25zdCByZXN1bHQ6IFBoYXNlUmVzdWx0ID0ge1xuICAgICAgICBwaGFzZUlkOiBwaGFzZS5pZCxcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgbWV0cmljc0ltcHJvdmVtZW50LFxuICAgICAgICBmaWxlc1Byb2Nlc3NlZCxcbiAgICAgICAgZXJyb3JzRml4ZWQsXG4gICAgICAgIHdhcm5pbmdzRml4ZWQsXG4gICAgICAgIGV4ZWN1dGlvblRpbWUsXG4gICAgICAgIHNhZmV0eUV2ZW50czogWy4uLnRoaXMuc2FmZXR5RXZlbnRzXVxuICAgICAgfTtcblxuICAgICAgdGhpcy5hZGRTYWZldHlFdmVudCh7XG4gICAgICAgIHR5cGU6IFNhZmV0eUV2ZW50VHlwZS5DSEVDS1BPSU5UX0NSRUFURUQsXG4gICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgICAgZGVzY3JpcHRpb246IGBQaGFzZSBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5OiAke3BoYXNlLm5hbWV9YCxcbiAgICAgICAgc2V2ZXJpdHk6IFNhZmV0eUV2ZW50U2V2ZXJpdHkuSU5GTyxcbiAgICAgICAgYWN0aW9uOiAnUEhBU0VfQ09NUExFVEUnXG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIHJlc3VsdDtcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmFkZFNhZmV0eUV2ZW50KHtcbiAgICAgICAgdHlwZTogU2FmZXR5RXZlbnRUeXBlLkJVSUxEX0ZBSUxVUkUsXG4gICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgICAgZGVzY3JpcHRpb246IGBQaGFzZSBleGVjdXRpb24gZmFpbGVkOiAkeyhlcnJvciBhcyBFcnJvcikubWVzc2FnZX1gLFxuICAgICAgICBzZXZlcml0eTogU2FmZXR5RXZlbnRTZXZlcml0eS5FUlJPUixcbiAgICAgICAgYWN0aW9uOiAnUEhBU0VfRkFJTEVEJ1xuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IGV4ZWN1dGlvblRpbWUgPSBEYXRlLm5vdygpIC0gc3RhcnRUaW1lO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBwaGFzZUlkOiBwaGFzZS5pZCxcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIG1ldHJpY3NJbXByb3ZlbWVudDoge1xuICAgICAgICAgIHR5cGVTY3JpcHRFcnJvcnNSZWR1Y2VkOiAwLFxuICAgICAgICAgIGxpbnRpbmdXYXJuaW5nc1JlZHVjZWQ6IDAsXG4gICAgICAgICAgYnVpbGRUaW1lSW1wcm92ZWQ6IDAsXG4gICAgICAgICAgZW50ZXJwcmlzZVN5c3RlbXNBZGRlZDogMFxuICAgICAgICB9LFxuICAgICAgICBmaWxlc1Byb2Nlc3NlZDogMCxcbiAgICAgICAgZXJyb3JzRml4ZWQ6IDAsXG4gICAgICAgIHdhcm5pbmdzRml4ZWQ6IDAsXG4gICAgICAgIGV4ZWN1dGlvblRpbWUsXG4gICAgICAgIHNhZmV0eUV2ZW50czogWy4uLnRoaXMuc2FmZXR5RXZlbnRzXVxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVmFsaWRhdGUgcGhhc2UgY29tcGxldGlvbiBhZ2FpbnN0IHN1Y2Nlc3MgY3JpdGVyaWFcbiAgICovXG4gIGFzeW5jIHZhbGlkYXRlUGhhc2VDb21wbGV0aW9uKHBoYXNlOiBDYW1wYWlnblBoYXNlKTogUHJvbWlzZTxWYWxpZGF0aW9uUmVzdWx0PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGN1cnJlbnRNZXRyaWNzID0gYXdhaXQgdGhpcy5nZXRDdXJyZW50TWV0cmljcygpO1xuICAgICAgY29uc3QgZXJyb3JzOiBzdHJpbmdbXSA9IFtdO1xuICAgICAgY29uc3Qgd2FybmluZ3M6IHN0cmluZ1tdID0gW107XG5cbiAgICAgIC8vIENoZWNrIFR5cGVTY3JpcHQgZXJyb3JzIGlmIHNwZWNpZmllZFxuICAgICAgaWYgKHBoYXNlLnN1Y2Nlc3NDcml0ZXJpYS50eXBlU2NyaXB0RXJyb3JzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgaWYgKGN1cnJlbnRNZXRyaWNzLnR5cGVTY3JpcHRFcnJvcnMuY3VycmVudCA+IHBoYXNlLnN1Y2Nlc3NDcml0ZXJpYS50eXBlU2NyaXB0RXJyb3JzKSB7XG4gICAgICAgICAgZXJyb3JzLnB1c2goXG4gICAgICAgICAgICBgVHlwZVNjcmlwdCBlcnJvcnM6ICR7Y3VycmVudE1ldHJpY3MudHlwZVNjcmlwdEVycm9ycy5jdXJyZW50fSA+ICR7cGhhc2Uuc3VjY2Vzc0NyaXRlcmlhLnR5cGVTY3JpcHRFcnJvcnN9YFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gQ2hlY2sgbGludGluZyB3YXJuaW5ncyBpZiBzcGVjaWZpZWRcbiAgICAgIGlmIChwaGFzZS5zdWNjZXNzQ3JpdGVyaWEubGludGluZ1dhcm5pbmdzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgaWYgKGN1cnJlbnRNZXRyaWNzLmxpbnRpbmdXYXJuaW5ncy5jdXJyZW50ID4gcGhhc2Uuc3VjY2Vzc0NyaXRlcmlhLmxpbnRpbmdXYXJuaW5ncykge1xuICAgICAgICAgIGVycm9ycy5wdXNoKFxuICAgICAgICAgICAgYExpbnRpbmcgd2FybmluZ3M6ICR7Y3VycmVudE1ldHJpY3MubGludGluZ1dhcm5pbmdzLmN1cnJlbnR9ID4gJHtwaGFzZS5zdWNjZXNzQ3JpdGVyaWEubGludGluZ1dhcm5pbmdzfWBcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIENoZWNrIGJ1aWxkIHRpbWUgaWYgc3BlY2lmaWVkXG4gICAgICBpZiAocGhhc2Uuc3VjY2Vzc0NyaXRlcmlhLmJ1aWxkVGltZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGlmIChjdXJyZW50TWV0cmljcy5idWlsZFBlcmZvcm1hbmNlLmN1cnJlbnRUaW1lID4gcGhhc2Uuc3VjY2Vzc0NyaXRlcmlhLmJ1aWxkVGltZSkge1xuICAgICAgICAgIHdhcm5pbmdzLnB1c2goXG4gICAgICAgICAgICBgQnVpbGQgdGltZTogJHtjdXJyZW50TWV0cmljcy5idWlsZFBlcmZvcm1hbmNlLmN1cnJlbnRUaW1lfXMgPiAke3BoYXNlLnN1Y2Nlc3NDcml0ZXJpYS5idWlsZFRpbWV9c2BcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIENoZWNrIGVudGVycHJpc2Ugc3lzdGVtcyBpZiBzcGVjaWZpZWRcbiAgICAgIGlmIChwaGFzZS5zdWNjZXNzQ3JpdGVyaWEuZW50ZXJwcmlzZVN5c3RlbXMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBpZiAoY3VycmVudE1ldHJpY3MuZW50ZXJwcmlzZVN5c3RlbXMuY3VycmVudCA8IHBoYXNlLnN1Y2Nlc3NDcml0ZXJpYS5lbnRlcnByaXNlU3lzdGVtcykge1xuICAgICAgICAgIGVycm9ycy5wdXNoKFxuICAgICAgICAgICAgYEVudGVycHJpc2Ugc3lzdGVtczogJHtjdXJyZW50TWV0cmljcy5lbnRlcnByaXNlU3lzdGVtcy5jdXJyZW50fSA8ICR7cGhhc2Uuc3VjY2Vzc0NyaXRlcmlhLmVudGVycHJpc2VTeXN0ZW1zfWBcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIFJ1biBjdXN0b20gdmFsaWRhdGlvbiBpZiBwcm92aWRlZFxuICAgICAgaWYgKHBoYXNlLnN1Y2Nlc3NDcml0ZXJpYS5jdXN0b21WYWxpZGF0aW9uKSB7XG4gICAgICAgIGNvbnN0IGN1c3RvbVJlc3VsdCA9IGF3YWl0IHBoYXNlLnN1Y2Nlc3NDcml0ZXJpYS5jdXN0b21WYWxpZGF0aW9uKCk7XG4gICAgICAgIGlmICghY3VzdG9tUmVzdWx0KSB7XG4gICAgICAgICAgZXJyb3JzLnB1c2goJ0N1c3RvbSB2YWxpZGF0aW9uIGZhaWxlZCcpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGVycm9ycy5sZW5ndGggPT09IDAsXG4gICAgICAgIGVycm9ycyxcbiAgICAgICAgd2FybmluZ3MsXG4gICAgICAgIG1ldHJpY3M6IGN1cnJlbnRNZXRyaWNzXG4gICAgICB9O1xuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcnM6IFtgVmFsaWRhdGlvbiBlcnJvcjogJHsoZXJyb3IgYXMgRXJyb3IpLm1lc3NhZ2V9YF0sXG4gICAgICAgIHdhcm5pbmdzOiBbXVxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIGEgc2FmZXR5IGNoZWNrcG9pbnQgd2l0aCBjdXJyZW50IHN0YXRlXG4gICAqL1xuICBhc3luYyBjcmVhdGVTYWZldHlDaGVja3BvaW50KGRlc2NyaXB0aW9uOiBzdHJpbmcpOiBQcm9taXNlPENoZWNrcG9pbnRJZD4ge1xuICAgIC8vIFRoaXMgd2lsbCBiZSBpbXBsZW1lbnRlZCBieSB0aGUgU2FmZXR5UHJvdG9jb2wgY2xhc3NcbiAgICAvLyBGb3Igbm93LCByZXR1cm4gYSBtb2NrIGNoZWNrcG9pbnQgSURcbiAgICBjb25zdCBjaGVja3BvaW50SWQgPSBgY2hlY2twb2ludF8ke0RhdGUubm93KCl9YDtcbiAgICBcbiAgICB0aGlzLmFkZFNhZmV0eUV2ZW50KHtcbiAgICAgIHR5cGU6IFNhZmV0eUV2ZW50VHlwZS5DSEVDS1BPSU5UX0NSRUFURUQsXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAgICBkZXNjcmlwdGlvbjogYFNhZmV0eSBjaGVja3BvaW50IGNyZWF0ZWQ6ICR7ZGVzY3JpcHRpb259YCxcbiAgICAgIHNldmVyaXR5OiBTYWZldHlFdmVudFNldmVyaXR5LklORk8sXG4gICAgICBhY3Rpb246ICdDSEVDS1BPSU5UX0NSRUFURSdcbiAgICB9KTtcblxuICAgIHJldHVybiBjaGVja3BvaW50SWQ7XG4gIH1cblxuICAvKipcbiAgICogUm9sbGJhY2sgdG8gYSBzcGVjaWZpYyBjaGVja3BvaW50XG4gICAqL1xuICBhc3luYyByb2xsYmFja1RvQ2hlY2twb2ludChjaGVja3BvaW50SWQ6IENoZWNrcG9pbnRJZCk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRoaXMuYWRkU2FmZXR5RXZlbnQoe1xuICAgICAgdHlwZTogU2FmZXR5RXZlbnRUeXBlLlJPTExCQUNLX1RSSUdHRVJFRCxcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgIGRlc2NyaXB0aW9uOiBgUm9sbGluZyBiYWNrIHRvIGNoZWNrcG9pbnQ6ICR7Y2hlY2twb2ludElkfWAsXG4gICAgICBzZXZlcml0eTogU2FmZXR5RXZlbnRTZXZlcml0eS5XQVJOSU5HLFxuICAgICAgYWN0aW9uOiAnUk9MTEJBQ0snXG4gICAgfSk7XG5cbiAgICAvLyBUaGlzIHdpbGwgYmUgaW1wbGVtZW50ZWQgYnkgdGhlIFNhZmV0eVByb3RvY29sIGNsYXNzXG4gICAgLy8gRm9yIG5vdywganVzdCBsb2cgdGhlIHJvbGxiYWNrIGF0dGVtcHRcbiAgICBjb25zb2xlLmxvZyhgUm9sbGJhY2sgdG8gY2hlY2twb2ludCAke2NoZWNrcG9pbnRJZH0gcmVxdWVzdGVkYCk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGN1cnJlbnQgcHJvZ3Jlc3MgbWV0cmljc1xuICAgKi9cbiAgYXN5bmMgZ2V0UHJvZ3Jlc3NNZXRyaWNzKCk6IFByb21pc2U8UHJvZ3Jlc3NNZXRyaWNzPiB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0Q3VycmVudE1ldHJpY3MoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZSBjb21wcmVoZW5zaXZlIHBoYXNlIHJlcG9ydFxuICAgKi9cbiAgYXN5bmMgZ2VuZXJhdGVQaGFzZVJlcG9ydChwaGFzZTogQ2FtcGFpZ25QaGFzZSk6IFByb21pc2U8UGhhc2VSZXBvcnQ+IHtcbiAgICBjb25zdCBjdXJyZW50TWV0cmljcyA9IGF3YWl0IHRoaXMuZ2V0Q3VycmVudE1ldHJpY3MoKTtcbiAgICBjb25zdCB2YWxpZGF0aW9uID0gYXdhaXQgdGhpcy52YWxpZGF0ZVBoYXNlQ29tcGxldGlvbihwaGFzZSk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgcGhhc2VJZDogcGhhc2UuaWQsXG4gICAgICBwaGFzZU5hbWU6IHBoYXNlLm5hbWUsXG4gICAgICBzdGFydFRpbWU6IG5ldyBEYXRlKCksIC8vIFRoaXMgc2hvdWxkIGJlIHRyYWNrZWQgcHJvcGVybHlcbiAgICAgIHN0YXR1czogdmFsaWRhdGlvbi5zdWNjZXNzID8gUGhhc2VTdGF0dXMuQ09NUExFVEVEIDogUGhhc2VTdGF0dXMuSU5fUFJPR1JFU1MsXG4gICAgICBtZXRyaWNzOiBjdXJyZW50TWV0cmljcyxcbiAgICAgIGFjaGlldmVtZW50czogdGhpcy5nZW5lcmF0ZUFjaGlldmVtZW50cyhwaGFzZSwgY3VycmVudE1ldHJpY3MpLFxuICAgICAgaXNzdWVzOiB2YWxpZGF0aW9uLmVycm9ycyxcbiAgICAgIHJlY29tbWVuZGF0aW9uczogdGhpcy5nZW5lcmF0ZVJlY29tbWVuZGF0aW9ucyhwaGFzZSwgdmFsaWRhdGlvbilcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIExvYWQgYW5kIHZhbGlkYXRlIGNhbXBhaWduIGNvbmZpZ3VyYXRpb25cbiAgICovXG4gIHN0YXRpYyBhc3luYyBsb2FkQ29uZmlndXJhdGlvbihjb25maWdQYXRoPzogc3RyaW5nKTogUHJvbWlzZTxDYW1wYWlnbkNvbmZpZz4ge1xuICAgIC8vIERlZmF1bHQgY29uZmlndXJhdGlvbiBiYXNlZCBvbiB0aGUgZGVzaWduIGRvY3VtZW50XG4gICAgY29uc3QgZGVmYXVsdENvbmZpZzogQ2FtcGFpZ25Db25maWcgPSB7XG4gICAgICBwaGFzZXM6IFtcbiAgICAgICAge1xuICAgICAgICAgIGlkOiAncGhhc2UxJyxcbiAgICAgICAgICBuYW1lOiAnVHlwZVNjcmlwdCBFcnJvciBFbGltaW5hdGlvbicsXG4gICAgICAgICAgZGVzY3JpcHRpb246ICdFbGltaW5hdGUgYWxsIFR5cGVTY3JpcHQgY29tcGlsYXRpb24gZXJyb3JzJyxcbiAgICAgICAgICB0b29sczogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBzY3JpcHRQYXRoOiAnc2NyaXB0cy90eXBlc2NyaXB0LWZpeGVzL2ZpeC10eXBlc2NyaXB0LWVycm9ycy1lbmhhbmNlZC12My5qcycsXG4gICAgICAgICAgICAgIHBhcmFtZXRlcnM6IHsgbWF4RmlsZXM6IDE1LCBhdXRvRml4OiB0cnVlLCB2YWxpZGF0ZVNhZmV0eTogdHJ1ZSB9LFxuICAgICAgICAgICAgICBiYXRjaFNpemU6IDE1LFxuICAgICAgICAgICAgICBzYWZldHlMZXZlbDogJ01BWElNVU0nIGFzIGFueVxuICAgICAgICAgICAgfVxuICAgICAgICAgIF0sXG4gICAgICAgICAgc3VjY2Vzc0NyaXRlcmlhOiB7XG4gICAgICAgICAgICB0eXBlU2NyaXB0RXJyb3JzOiAwXG4gICAgICAgICAgfSxcbiAgICAgICAgICBzYWZldHlDaGVja3BvaW50czogW11cbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIGlkOiAncGhhc2UyJyxcbiAgICAgICAgICBuYW1lOiAnTGludGluZyBFeGNlbGxlbmNlIEFjaGlldmVtZW50JyxcbiAgICAgICAgICBkZXNjcmlwdGlvbjogJ0VsaW1pbmF0ZSBhbGwgbGludGluZyB3YXJuaW5ncycsXG4gICAgICAgICAgdG9vbHM6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgc2NyaXB0UGF0aDogJ3NjcmlwdHMvdHlwZXNjcmlwdC1maXhlcy9maXgtZXhwbGljaXQtYW55LXN5c3RlbWF0aWMuanMnLFxuICAgICAgICAgICAgICBwYXJhbWV0ZXJzOiB7IG1heEZpbGVzOiAyNSwgYXV0b0ZpeDogdHJ1ZSB9LFxuICAgICAgICAgICAgICBiYXRjaFNpemU6IDI1LFxuICAgICAgICAgICAgICBzYWZldHlMZXZlbDogJ0hJR0gnIGFzIGFueVxuICAgICAgICAgICAgfVxuICAgICAgICAgIF0sXG4gICAgICAgICAgc3VjY2Vzc0NyaXRlcmlhOiB7XG4gICAgICAgICAgICBsaW50aW5nV2FybmluZ3M6IDBcbiAgICAgICAgICB9LFxuICAgICAgICAgIHNhZmV0eUNoZWNrcG9pbnRzOiBbXVxuICAgICAgICB9XG4gICAgICBdLFxuICAgICAgc2FmZXR5U2V0dGluZ3M6IHtcbiAgICAgICAgbWF4RmlsZXNQZXJCYXRjaDogMjUsXG4gICAgICAgIGJ1aWxkVmFsaWRhdGlvbkZyZXF1ZW5jeTogNSxcbiAgICAgICAgdGVzdFZhbGlkYXRpb25GcmVxdWVuY3k6IDEwLFxuICAgICAgICBjb3JydXB0aW9uRGV0ZWN0aW9uRW5hYmxlZDogdHJ1ZSxcbiAgICAgICAgYXV0b21hdGljUm9sbGJhY2tFbmFibGVkOiB0cnVlLFxuICAgICAgICBzdGFzaFJldGVudGlvbkRheXM6IDdcbiAgICAgIH0sXG4gICAgICBwcm9ncmVzc1RhcmdldHM6IHtcbiAgICAgICAgdHlwZVNjcmlwdEVycm9yczogMCxcbiAgICAgICAgbGludGluZ1dhcm5pbmdzOiAwLFxuICAgICAgICBidWlsZFRpbWU6IDEwLFxuICAgICAgICBlbnRlcnByaXNlU3lzdGVtczogMjAwXG4gICAgICB9LFxuICAgICAgdG9vbENvbmZpZ3VyYXRpb246IHtcbiAgICAgICAgZW5oYW5jZWRFcnJvckZpeGVyOiAnc2NyaXB0cy90eXBlc2NyaXB0LWZpeGVzL2ZpeC10eXBlc2NyaXB0LWVycm9ycy1lbmhhbmNlZC12My5qcycsXG4gICAgICAgIGV4cGxpY2l0QW55Rml4ZXI6ICdzY3JpcHRzL3R5cGVzY3JpcHQtZml4ZXMvZml4LWV4cGxpY2l0LWFueS1zeXN0ZW1hdGljLmpzJyxcbiAgICAgICAgdW51c2VkVmFyaWFibGVzRml4ZXI6ICdzY3JpcHRzL3R5cGVzY3JpcHQtZml4ZXMvZml4LXVudXNlZC12YXJpYWJsZXMtZW5oYW5jZWQuanMnLFxuICAgICAgICBjb25zb2xlU3RhdGVtZW50Rml4ZXI6ICdzY3JpcHRzL2xpbnQtZml4ZXMvZml4LWNvbnNvbGUtc3RhdGVtZW50cy1vbmx5LmpzJ1xuICAgICAgfVxuICAgIH07XG5cbiAgICAvLyBJZiBjb25maWdQYXRoIGlzIHByb3ZpZGVkLCBsb2FkIGZyb20gZmlsZVxuICAgIC8vIEZvciBub3csIHJldHVybiBkZWZhdWx0IGNvbmZpZ3VyYXRpb25cbiAgICByZXR1cm4gZGVmYXVsdENvbmZpZztcbiAgfVxuXG4gIC8vIFByaXZhdGUgaGVscGVyIG1ldGhvZHNcblxuICBwcml2YXRlIGFzeW5jIGV4ZWN1dGVUb29sKHRvb2w6IGFueSk6IFByb21pc2U8YW55PiB7XG4gICAgLy8gTW9jayBpbXBsZW1lbnRhdGlvbiAtIHdpbGwgYmUgcmVwbGFjZWQgYnkgYWN0dWFsIHNjcmlwdCBleGVjdXRpb25cbiAgICByZXR1cm4ge1xuICAgICAgZmlsZXNQcm9jZXNzZWQ6IFtdLFxuICAgICAgY2hhbmdlc0FwcGxpZWQ6IDAsXG4gICAgICBzdWNjZXNzOiB0cnVlXG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgdmFsaWRhdGVQaGFzZVByb2dyZXNzKHBoYXNlOiBDYW1wYWlnblBoYXNlKTogUHJvbWlzZTxWYWxpZGF0aW9uUmVzdWx0PiB7XG4gICAgLy8gTW9jayBpbXBsZW1lbnRhdGlvbiAtIHdpbGwgYmUgcmVwbGFjZWQgYnkgYWN0dWFsIHZhbGlkYXRpb25cbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIGVycm9yczogW10sXG4gICAgICB3YXJuaW5nczogW11cbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBnZXRDdXJyZW50TWV0cmljcygpOiBQcm9taXNlPFByb2dyZXNzTWV0cmljcz4ge1xuICAgIC8vIFRoaXMgd2lsbCBiZSBpbXBsZW1lbnRlZCBieSB0aGUgUHJvZ3Jlc3NUcmFja2VyIGNsYXNzXG4gICAgLy8gRm9yIG5vdywgcmV0dXJuIG1vY2sgbWV0cmljc1xuICAgIHJldHVybiB7XG4gICAgICB0eXBlU2NyaXB0RXJyb3JzOiB7XG4gICAgICAgIGN1cnJlbnQ6IDg2LFxuICAgICAgICB0YXJnZXQ6IDAsXG4gICAgICAgIHJlZHVjdGlvbjogMCxcbiAgICAgICAgcGVyY2VudGFnZTogMFxuICAgICAgfSxcbiAgICAgIGxpbnRpbmdXYXJuaW5nczoge1xuICAgICAgICBjdXJyZW50OiA0NTA2LFxuICAgICAgICB0YXJnZXQ6IDAsXG4gICAgICAgIHJlZHVjdGlvbjogMCxcbiAgICAgICAgcGVyY2VudGFnZTogMFxuICAgICAgfSxcbiAgICAgIGJ1aWxkUGVyZm9ybWFuY2U6IHtcbiAgICAgICAgY3VycmVudFRpbWU6IDguNSxcbiAgICAgICAgdGFyZ2V0VGltZTogMTAsXG4gICAgICAgIGNhY2hlSGl0UmF0ZTogMC44LFxuICAgICAgICBtZW1vcnlVc2FnZTogNDVcbiAgICAgIH0sXG4gICAgICBlbnRlcnByaXNlU3lzdGVtczoge1xuICAgICAgICBjdXJyZW50OiAwLFxuICAgICAgICB0YXJnZXQ6IDIwMCxcbiAgICAgICAgdHJhbnNmb3JtZWRFeHBvcnRzOiAwXG4gICAgICB9XG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgY2FsY3VsYXRlTWV0cmljc0ltcHJvdmVtZW50KFxuICAgIGluaXRpYWw6IFByb2dyZXNzTWV0cmljcyxcbiAgICBmaW5hbDogUHJvZ3Jlc3NNZXRyaWNzXG4gICk6IE1ldHJpY3NJbXByb3ZlbWVudCB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGVTY3JpcHRFcnJvcnNSZWR1Y2VkOiBpbml0aWFsLnR5cGVTY3JpcHRFcnJvcnMuY3VycmVudCAtIGZpbmFsLnR5cGVTY3JpcHRFcnJvcnMuY3VycmVudCxcbiAgICAgIGxpbnRpbmdXYXJuaW5nc1JlZHVjZWQ6IGluaXRpYWwubGludGluZ1dhcm5pbmdzLmN1cnJlbnQgLSBmaW5hbC5saW50aW5nV2FybmluZ3MuY3VycmVudCxcbiAgICAgIGJ1aWxkVGltZUltcHJvdmVkOiBpbml0aWFsLmJ1aWxkUGVyZm9ybWFuY2UuY3VycmVudFRpbWUgLSBmaW5hbC5idWlsZFBlcmZvcm1hbmNlLmN1cnJlbnRUaW1lLFxuICAgICAgZW50ZXJwcmlzZVN5c3RlbXNBZGRlZDogZmluYWwuZW50ZXJwcmlzZVN5c3RlbXMuY3VycmVudCAtIGluaXRpYWwuZW50ZXJwcmlzZVN5c3RlbXMuY3VycmVudFxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIGdlbmVyYXRlQWNoaWV2ZW1lbnRzKHBoYXNlOiBDYW1wYWlnblBoYXNlLCBtZXRyaWNzOiBQcm9ncmVzc01ldHJpY3MpOiBzdHJpbmdbXSB7XG4gICAgY29uc3QgYWNoaWV2ZW1lbnRzOiBzdHJpbmdbXSA9IFtdO1xuICAgIFxuICAgIGlmIChtZXRyaWNzLnR5cGVTY3JpcHRFcnJvcnMuY3VycmVudCA9PT0gMCkge1xuICAgICAgYWNoaWV2ZW1lbnRzLnB1c2goJ1plcm8gVHlwZVNjcmlwdCBlcnJvcnMgYWNoaWV2ZWQnKTtcbiAgICB9XG4gICAgXG4gICAgaWYgKG1ldHJpY3MubGludGluZ1dhcm5pbmdzLmN1cnJlbnQgPT09IDApIHtcbiAgICAgIGFjaGlldmVtZW50cy5wdXNoKCdaZXJvIGxpbnRpbmcgd2FybmluZ3MgYWNoaWV2ZWQnKTtcbiAgICB9XG4gICAgXG4gICAgaWYgKG1ldHJpY3MuYnVpbGRQZXJmb3JtYW5jZS5jdXJyZW50VGltZSA8PSAxMCkge1xuICAgICAgYWNoaWV2ZW1lbnRzLnB1c2goJ0J1aWxkIHRpbWUgdW5kZXIgMTAgc2Vjb25kcyBtYWludGFpbmVkJyk7XG4gICAgfVxuICAgIFxuICAgIHJldHVybiBhY2hpZXZlbWVudHM7XG4gIH1cblxuICBwcml2YXRlIGdlbmVyYXRlUmVjb21tZW5kYXRpb25zKHBoYXNlOiBDYW1wYWlnblBoYXNlLCB2YWxpZGF0aW9uOiBWYWxpZGF0aW9uUmVzdWx0KTogc3RyaW5nW10ge1xuICAgIGNvbnN0IHJlY29tbWVuZGF0aW9uczogc3RyaW5nW10gPSBbXTtcbiAgICBcbiAgICBpZiAodmFsaWRhdGlvbi5lcnJvcnMubGVuZ3RoID4gMCkge1xuICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goJ0FkZHJlc3MgdmFsaWRhdGlvbiBlcnJvcnMgYmVmb3JlIHByb2NlZWRpbmcnKTtcbiAgICB9XG4gICAgXG4gICAgaWYgKHZhbGlkYXRpb24ud2FybmluZ3MubGVuZ3RoID4gMCkge1xuICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goJ0NvbnNpZGVyIGFkZHJlc3Npbmcgd2FybmluZ3MgZm9yIG9wdGltYWwgcGVyZm9ybWFuY2UnKTtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHJlY29tbWVuZGF0aW9ucztcbiAgfVxuXG4gIHByaXZhdGUgYWRkU2FmZXR5RXZlbnQoZXZlbnQ6IFNhZmV0eUV2ZW50KTogdm9pZCB7XG4gICAgdGhpcy5zYWZldHlFdmVudHMucHVzaChldmVudCk7XG4gICAgXG4gICAgLy8gS2VlcCBvbmx5IHJlY2VudCBldmVudHMgdG8gcHJldmVudCBtZW1vcnkgaXNzdWVzXG4gICAgaWYgKHRoaXMuc2FmZXR5RXZlbnRzLmxlbmd0aCA+IDEwMDApIHtcbiAgICAgIHRoaXMuc2FmZXR5RXZlbnRzID0gdGhpcy5zYWZldHlFdmVudHMuc2xpY2UoLTUwMCk7XG4gICAgfVxuICB9XG59Il0sInZlcnNpb24iOjN9