0da59e725579b3a894533aa353eccae2
"use strict";
/**
 * Comprehensive Validation Framework for Unused Variable Elimination
 *
 * This framework implements comprehensive validation to ensure build stability
 * and quality assurance throughout the unused variable elimination process.
 *
 * Features:
 * - Zero TypeScript compilation error maintenance
 * - Test suite validation after each batch
 * - React component functionality preservation checks
 * - Service integration validation
 * - Quality assurance reporting
 */
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.ComprehensiveValidationFramework = void 0;
const child_process_1 = require("child_process");
const fs_1 = __importDefault(require("fs"));
const path_1 = __importDefault(require("path"));
class ComprehensiveValidationFramework {
    config;
    validationHistory = new Map();
    constructor(config = {}) {
        this.config = {
            enableTypeScriptValidation: true,
            enableTestSuiteValidation: true,
            enableComponentValidation: true,
            enableServiceValidation: true,
            enableBuildValidation: true,
            testTimeout: 30000,
            compilationTimeout: 45000,
            maxRetries: 2,
            logLevel: 'info',
            ...config
        };
    }
    /**
     * Perform comprehensive validation after batch processing
     */
    async performComprehensiveValidation(processedFiles, batchId) {
        const startTime = Date.now();
        this.log('info', `üîç Starting comprehensive validation for batch ${batchId}`);
        this.log('info', `üìã Validating ${processedFiles.length} processed files`);
        const validationResults = [];
        let overallPassed = true;
        let qualityScore = 100;
        try {
            // 1. TypeScript Compilation Validation (Critical)
            if (this.config.enableTypeScriptValidation) {
                const tsResult = await this.validateTypeScriptCompilation(batchId);
                validationResults.push(tsResult);
                if (!tsResult.passed) {
                    overallPassed = false;
                    qualityScore -= 40; // Major penalty for compilation errors
                }
            }
            // 2. Test Suite Validation (High Priority)
            if (this.config.enableTestSuiteValidation) {
                const testResult = await this.validateTestSuite(processedFiles, batchId);
                validationResults.push(testResult);
                if (!testResult.passed) {
                    overallPassed = false;
                    qualityScore -= 25; // Significant penalty for test failures
                }
            }
            // 3. React Component Functionality Validation (High Priority)
            if (this.config.enableComponentValidation) {
                const componentResults = await this.validateReactComponents(processedFiles, batchId);
                validationResults.push(...componentResults);
                const failedComponents = componentResults.filter(r => !r.passed);
                if (failedComponents.length > 0) {
                    overallPassed = false;
                    qualityScore -= Math.min(20, failedComponents.length * 5);
                }
            }
            // 4. Service Integration Validation (Medium Priority)
            if (this.config.enableServiceValidation) {
                const serviceResults = await this.validateServiceIntegration(processedFiles, batchId);
                validationResults.push(...serviceResults);
                const failedServices = serviceResults.filter(r => !r.passed);
                if (failedServices.length > 0) {
                    qualityScore -= Math.min(15, failedServices.length * 3);
                }
            }
            // 5. Build System Validation (Medium Priority)
            if (this.config.enableBuildValidation) {
                const buildResult = await this.validateBuildSystem(batchId);
                validationResults.push(buildResult);
                if (!buildResult.passed) {
                    qualityScore -= 10; // Minor penalty for build issues
                }
            }
            // Calculate summary
            const summary = this.calculateValidationSummary(validationResults, startTime);
            // Determine if rollback is required
            const requiresRollback = this.shouldRequireRollback(validationResults);
            // Store validation history
            this.storeValidationHistory(batchId, validationResults);
            const result = {
                overallPassed,
                validationResults,
                summary,
                requiresRollback,
                qualityScore: Math.max(0, qualityScore)
            };
            this.log('info', `‚úÖ Comprehensive validation completed`);
            this.log('info', `üìä Overall Result: ${overallPassed ? 'PASSED' : 'FAILED'}`);
            this.log('info', `üéØ Quality Score: ${result.qualityScore}/100`);
            return result;
        }
        catch (error) {
            this.log('error', `‚ùå Comprehensive validation failed: ${error}`);
            return {
                overallPassed: false,
                validationResults: [{
                        passed: false,
                        validationType: 'framework-error',
                        errors: [`Validation framework error: ${error}`],
                        warnings: [],
                        recommendations: ['Review validation framework configuration'],
                        executionTime: Date.now() - startTime,
                        retryCount: 0,
                        details: { error: error.toString() }
                    }],
                summary: {
                    totalValidations: 1,
                    passedValidations: 0,
                    failedValidations: 1,
                    warningsCount: 0,
                    totalExecutionTime: Date.now() - startTime,
                    criticalIssues: ['Validation framework failure'],
                    recommendations: ['Review validation framework configuration']
                },
                requiresRollback: true,
                qualityScore: 0
            };
        }
    }
    /**
     * Validate TypeScript compilation with zero error requirement
     */
    async validateTypeScriptCompilation(batchId) {
        const startTime = Date.now();
        const result = {
            passed: false,
            validationType: 'typescript-compilation',
            errors: [],
            warnings: [],
            recommendations: [],
            executionTime: 0,
            retryCount: 0,
            details: {}
        };
        this.log('debug', 'üîç Validating TypeScript compilation...');
        for (let retry = 0; retry <= this.config.maxRetries; retry++) {
            try {
                result.retryCount = retry;
                // Run TypeScript compilation with detailed error reporting
                const output = (0, child_process_1.execSync)('yarn tsc --noEmit --skipLibCheck --pretty', {
                    encoding: 'utf8',
                    timeout: this.config.compilationTimeout,
                    stdio: 'pipe'
                });
                // If we get here, compilation succeeded
                result.passed = true;
                result.details.compilationOutput = 'No errors found';
                this.log('debug', '‚úÖ TypeScript compilation passed');
                break;
            }
            catch (error) {
                const errorOutput = error.stdout || error.stderr || error.message;
                // Parse TypeScript errors
                const errorLines = errorOutput.split('\n').filter(line => line.trim());
                const errorCount = errorLines.filter(line => /error TS\d+:/.test(line)).length;
                result.errors.push(`TypeScript compilation failed with ${errorCount} errors`);
                result.details.errorOutput = errorOutput;
                result.details.errorCount = errorCount;
                // Extract specific error types for analysis
                const errorTypes = this.extractTypeScriptErrorTypes(errorOutput);
                result.details.errorTypes = errorTypes;
                if (retry < this.config.maxRetries) {
                    this.log('warn', `‚ö†Ô∏è TypeScript compilation failed (attempt ${retry + 1}), retrying...`);
                    await this.delay(1000); // Wait 1 second before retry
                }
                else {
                    this.log('error', `‚ùå TypeScript compilation failed after ${retry + 1} attempts`);
                    result.recommendations.push('Review TypeScript errors and fix compilation issues');
                    result.recommendations.push('Consider rolling back changes if errors are critical');
                }
            }
        }
        result.executionTime = Date.now() - startTime;
        return result;
    }
    /**
     * Validate test suite execution
     */
    async validateTestSuite(processedFiles, batchId) {
        const startTime = Date.now();
        const result = {
            passed: false,
            validationType: 'test-suite',
            errors: [],
            warnings: [],
            recommendations: [],
            executionTime: 0,
            retryCount: 0,
            details: {}
        };
        this.log('debug', 'üß™ Validating test suite...');
        try {
            // Find related test files for processed files
            const relatedTestFiles = this.findRelatedTestFiles(processedFiles);
            result.details.relatedTestFiles = relatedTestFiles;
            if (relatedTestFiles.length === 0) {
                result.passed = true;
                result.warnings.push('No related test files found for processed files');
                result.recommendations.push('Consider adding tests for modified components');
                this.log('debug', '‚ö†Ô∏è No related test files found');
            }
            else {
                // Run tests with memory management
                const testCommand = `NODE_OPTIONS='--expose-gc --max-old-space-size=2048' yarn test --run --passWithNoTests --testPathPattern="${relatedTestFiles.join('|')}"`;
                const output = (0, child_process_1.execSync)(testCommand, {
                    encoding: 'utf8',
                    timeout: this.config.testTimeout,
                    stdio: 'pipe'
                });
                // Parse test results
                const testResults = this.parseTestResults(output);
                result.details.testResults = testResults;
                if (testResults.failed === 0) {
                    result.passed = true;
                    this.log('debug', `‚úÖ All ${testResults.passed} tests passed`);
                }
                else {
                    result.errors.push(`${testResults.failed} tests failed`);
                    result.recommendations.push('Review and fix failing tests');
                    this.log('error', `‚ùå ${testResults.failed} tests failed`);
                }
            }
        }
        catch (error) {
            result.errors.push(`Test suite validation failed: ${error.message}`);
            result.details.error = error.toString();
            result.recommendations.push('Review test configuration and dependencies');
            this.log('error', `‚ùå Test suite validation failed: ${error}`);
        }
        result.executionTime = Date.now() - startTime;
        return result;
    }
    /**
     * Validate React component functionality preservation
     */
    async validateReactComponents(processedFiles, batchId) {
        const results = [];
        // Filter for React component files
        const componentFiles = processedFiles.filter(file => /\.(tsx|jsx)$/.test(file) &&
            /\/components\//.test(file));
        this.log('debug', `üîç Validating ${componentFiles.length} React components...`);
        for (const componentFile of componentFiles) {
            const result = await this.validateSingleComponent(componentFile, batchId);
            results.push(result);
        }
        return results;
    }
    /**
     * Validate a single React component
     */
    async validateSingleComponent(componentPath, batchId) {
        const startTime = Date.now();
        const result = {
            passed: true,
            validationType: 'react-component',
            errors: [],
            warnings: [],
            recommendations: [],
            executionTime: 0,
            retryCount: 0,
            details: { componentPath }
        };
        try {
            const componentInfo = await this.analyzeComponent(componentPath);
            result.details.componentInfo = componentInfo;
            // Check if component can still be imported
            const importValidation = await this.validateComponentImport(componentPath);
            if (!importValidation.success) {
                result.passed = false;
                result.errors.push(`Component import failed: ${importValidation.error}`);
            }
            // Check if component exports are intact
            const exportValidation = await this.validateComponentExports(componentPath, componentInfo);
            if (!exportValidation.success) {
                result.passed = false;
                result.errors.push(`Component exports validation failed: ${exportValidation.error}`);
            }
            // Check if component props interface is preserved
            if (componentInfo.propsInterface) {
                const propsValidation = await this.validateComponentProps(componentPath, componentInfo.propsInterface);
                if (!propsValidation.success) {
                    result.warnings.push(`Props interface may have been affected: ${propsValidation.warning}`);
                }
            }
            // Check if component has tests and they still pass
            if (componentInfo.hasTests) {
                const testValidation = await this.validateComponentTests(componentPath);
                if (!testValidation.success) {
                    result.warnings.push(`Component tests may be affected: ${testValidation.warning}`);
                }
            }
            else {
                result.recommendations.push('Consider adding tests for this component');
            }
            if (result.passed) {
                this.log('debug', `‚úÖ Component ${componentInfo.componentName} validation passed`);
            }
            else {
                this.log('error', `‚ùå Component ${componentInfo.componentName} validation failed`);
            }
        }
        catch (error) {
            result.passed = false;
            result.errors.push(`Component validation failed: ${error}`);
            this.log('error', `‚ùå Component validation failed for ${componentPath}: ${error}`);
        }
        result.executionTime = Date.now() - startTime;
        return result;
    }
    /**
     * Validate service integration functionality
     */
    async validateServiceIntegration(processedFiles, batchId) {
        const results = [];
        // Filter for service files
        const serviceFiles = processedFiles.filter(file => /\/services\//.test(file) ||
            /Service\.ts$/.test(file) ||
            /Client\.ts$/.test(file));
        this.log('debug', `üîç Validating ${serviceFiles.length} service integrations...`);
        for (const serviceFile of serviceFiles) {
            const result = await this.validateSingleService(serviceFile, batchId);
            results.push(result);
        }
        return results;
    }
    /**
     * Validate a single service
     */
    async validateSingleService(servicePath, batchId) {
        const startTime = Date.now();
        const result = {
            passed: true,
            validationType: 'service-integration',
            errors: [],
            warnings: [],
            recommendations: [],
            executionTime: 0,
            retryCount: 0,
            details: { servicePath }
        };
        try {
            const serviceInfo = await this.analyzeService(servicePath);
            result.details.serviceInfo = serviceInfo;
            // Check if service can still be imported
            const importValidation = await this.validateServiceImport(servicePath);
            if (!importValidation.success) {
                result.passed = false;
                result.errors.push(`Service import failed: ${importValidation.error}`);
            }
            // Check if API endpoints are still functional (basic syntax check)
            if (serviceInfo.apiEndpoints.length > 0) {
                const endpointValidation = await this.validateApiEndpoints(servicePath, serviceInfo.apiEndpoints);
                if (!endpointValidation.success) {
                    result.warnings.push(`API endpoints may be affected: ${endpointValidation.warning}`);
                }
            }
            // Check if exported methods are intact
            const methodValidation = await this.validateServiceMethods(servicePath, serviceInfo.exportedMethods);
            if (!methodValidation.success) {
                result.passed = false;
                result.errors.push(`Service methods validation failed: ${methodValidation.error}`);
            }
            if (result.passed) {
                this.log('debug', `‚úÖ Service ${serviceInfo.serviceName} validation passed`);
            }
            else {
                this.log('error', `‚ùå Service ${serviceInfo.serviceName} validation failed`);
            }
        }
        catch (error) {
            result.passed = false;
            result.errors.push(`Service validation failed: ${error}`);
            this.log('error', `‚ùå Service validation failed for ${servicePath}: ${error}`);
        }
        result.executionTime = Date.now() - startTime;
        return result;
    }
    /**
     * Validate build system functionality
     */
    async validateBuildSystem(batchId) {
        const startTime = Date.now();
        const result = {
            passed: false,
            validationType: 'build-system',
            errors: [],
            warnings: [],
            recommendations: [],
            executionTime: 0,
            retryCount: 0,
            details: {}
        };
        this.log('debug', 'üèóÔ∏è Validating build system...');
        try {
            // Test Next.js build process (dry run)
            const buildOutput = (0, child_process_1.execSync)('yarn next build --dry-run', {
                encoding: 'utf8',
                timeout: 60000,
                stdio: 'pipe'
            });
            result.passed = true;
            result.details.buildOutput = typeof buildOutput === 'string' ? buildOutput : buildOutput.toString();
            this.log('debug', '‚úÖ Build system validation passed');
        }
        catch (error) {
            result.errors.push(`Build system validation failed: ${error.message}`);
            result.details.buildError = error.toString();
            result.recommendations.push('Review build configuration and dependencies');
            this.log('error', `‚ùå Build system validation failed: ${error}`);
        }
        result.executionTime = Date.now() - startTime;
        return result;
    }
    // Helper methods for analysis and validation
    async analyzeComponent(componentPath) {
        const content = fs_1.default.readFileSync(componentPath, 'utf8');
        const relativePath = path_1.default.relative(process.cwd(), componentPath);
        const componentName = path_1.default.basename(componentPath, path_1.default.extname(componentPath));
        // Find test file
        const testPath = componentPath.replace(/\.(tsx|jsx)$/, '.test.$1');
        const hasTests = fs_1.default.existsSync(testPath);
        // Extract exports (simplified)
        const exportMatches = content.match(/export\s+(?:const|function|class)\s+(\w+)/g) || [];
        const exportedFunctions = exportMatches.map(match => {
            const nameMatch = match.match(/export\s+(?:const|function|class)\s+(\w+)/);
            return nameMatch ? nameMatch[1] : '';
        }).filter(Boolean);
        // Extract imports (simplified)
        const importMatches = content.match(/import\s+.*?\s+from\s+['"]([^'"]+)['"]/g) || [];
        const importedDependencies = importMatches.map(match => {
            const pathMatch = match.match(/from\s+['"]([^'"]+)['"]/);
            return pathMatch ? pathMatch[1] : '';
        }).filter(Boolean);
        // Extract props interface (simplified)
        const propsInterfaceMatch = content.match(/interface\s+(\w*Props)\s*{/);
        const propsInterface = propsInterfaceMatch ? propsInterfaceMatch[1] : undefined;
        // Extract state variables (simplified)
        const stateMatches = content.match(/const\s+\[(\w+),\s*set\w+\]\s*=\s*useState/g) || [];
        const stateVariables = stateMatches.map(match => {
            const nameMatch = match.match(/const\s+\[(\w+),/);
            return nameMatch ? nameMatch[1] : '';
        }).filter(Boolean);
        return {
            componentPath: relativePath,
            componentName,
            hasTests,
            exportedFunctions,
            importedDependencies,
            propsInterface,
            stateVariables
        };
    }
    async analyzeService(servicePath) {
        const content = fs_1.default.readFileSync(servicePath, 'utf8');
        const relativePath = path_1.default.relative(process.cwd(), servicePath);
        const serviceName = path_1.default.basename(servicePath, path_1.default.extname(servicePath));
        // Extract API endpoints (simplified)
        const apiMatches = content.match(/['"`]\/api\/[^'"`]+['"`]/g) || [];
        const apiEndpoints = apiMatches.map(match => match.replace(/['"`]/g, ''));
        // Extract exported methods (simplified)
        const exportMatches = content.match(/export\s+(?:const|function|class)\s+(\w+)/g) || [];
        const exportedMethods = exportMatches.map(match => {
            const nameMatch = match.match(/export\s+(?:const|function|class)\s+(\w+)/);
            return nameMatch ? nameMatch[1] : '';
        }).filter(Boolean);
        // Extract dependencies (simplified)
        const importMatches = content.match(/import\s+.*?\s+from\s+['"]([^'"]+)['"]/g) || [];
        const dependencies = importMatches.map(match => {
            const pathMatch = match.match(/from\s+['"]([^'"]+)['"]/);
            return pathMatch ? pathMatch[1] : '';
        }).filter(Boolean);
        // Extract configuration keys (simplified)
        const configMatches = content.match(/process\.env\.(\w+)/g) || [];
        const configurationKeys = configMatches.map(match => {
            const keyMatch = match.match(/process\.env\.(\w+)/);
            return keyMatch ? keyMatch[1] : '';
        }).filter(Boolean);
        return {
            servicePath: relativePath,
            serviceName,
            apiEndpoints,
            exportedMethods,
            dependencies,
            configurationKeys
        };
    }
    async validateComponentImport(componentPath) {
        try {
            // This is a simplified check - in a real implementation, you might use TypeScript compiler API
            const content = fs_1.default.readFileSync(componentPath, 'utf8');
            // Check for basic syntax errors that would prevent import
            if (content.includes('export default') || content.includes('export {') || content.includes('export const')) {
                return { success: true };
            }
            else {
                return { success: false, error: 'No exports found in component' };
            }
        }
        catch (error) {
            return { success: false, error: `Failed to read component: ${error}` };
        }
    }
    async validateComponentExports(componentPath, componentInfo) {
        try {
            const content = fs_1.default.readFileSync(componentPath, 'utf8');
            // Check if previously identified exports are still present
            for (const exportedFunction of componentInfo.exportedFunctions) {
                if (!content.includes(exportedFunction)) {
                    return { success: false, error: `Exported function ${exportedFunction} not found` };
                }
            }
            return { success: true };
        }
        catch (error) {
            return { success: false, error: `Failed to validate exports: ${error}` };
        }
    }
    async validateComponentProps(componentPath, propsInterface) {
        try {
            const content = fs_1.default.readFileSync(componentPath, 'utf8');
            if (!content.includes(propsInterface)) {
                return { success: false, warning: `Props interface ${propsInterface} not found` };
            }
            return { success: true };
        }
        catch (error) {
            return { success: false, warning: `Failed to validate props: ${error}` };
        }
    }
    async validateComponentTests(componentPath) {
        try {
            const testPath = componentPath.replace(/\.(tsx|jsx)$/, '.test.$1');
            if (!fs_1.default.existsSync(testPath)) {
                return { success: false, warning: 'Test file not found' };
            }
            // This is a simplified check - in a real implementation, you might run the specific test
            return { success: true };
        }
        catch (error) {
            return { success: false, warning: `Failed to validate tests: ${error}` };
        }
    }
    async validateServiceImport(servicePath) {
        try {
            const content = fs_1.default.readFileSync(servicePath, 'utf8');
            // Check for basic syntax errors that would prevent import
            if (content.includes('export')) {
                return { success: true };
            }
            else {
                return { success: false, error: 'No exports found in service' };
            }
        }
        catch (error) {
            return { success: false, error: `Failed to read service: ${error}` };
        }
    }
    async validateApiEndpoints(servicePath, endpoints) {
        try {
            const content = fs_1.default.readFileSync(servicePath, 'utf8');
            // Check if API endpoints are still referenced
            for (const endpoint of endpoints) {
                if (!content.includes(endpoint)) {
                    return { success: false, warning: `API endpoint ${endpoint} not found` };
                }
            }
            return { success: true };
        }
        catch (error) {
            return { success: false, warning: `Failed to validate API endpoints: ${error}` };
        }
    }
    async validateServiceMethods(servicePath, methods) {
        try {
            const content = fs_1.default.readFileSync(servicePath, 'utf8');
            // Check if previously identified methods are still present
            for (const method of methods) {
                if (!content.includes(method)) {
                    return { success: false, error: `Service method ${method} not found` };
                }
            }
            return { success: true };
        }
        catch (error) {
            return { success: false, error: `Failed to validate service methods: ${error}` };
        }
    }
    findRelatedTestFiles(processedFiles) {
        const testFiles = [];
        for (const file of processedFiles) {
            // Look for corresponding test files
            const testPatterns = [
                file.replace(/\.(ts|tsx|js|jsx)$/, '.test.$1'),
                file.replace(/\.(ts|tsx|js|jsx)$/, '.spec.$1'),
                file.replace(/\/([^/]+)\.(ts|tsx|js|jsx)$/, '/__tests__/$1.test.$2')
            ];
            for (const testPattern of testPatterns) {
                if (fs_1.default.existsSync(testPattern)) {
                    testFiles.push(testPattern);
                    break;
                }
            }
        }
        return testFiles;
    }
    parseTestResults(output) {
        // Parse Jest output (simplified)
        // Handle both string and Buffer types
        const outputStr = typeof output === 'string' ? output : output.toString();
        const passedMatch = outputStr.match(/(\d+) passed/);
        const failedMatch = outputStr.match(/(\d+) failed/);
        const passed = passedMatch ? parseInt(passedMatch[1]) : 0;
        const failed = failedMatch ? parseInt(failedMatch[1]) : 0;
        const total = passed + failed;
        return { passed, failed, total };
    }
    extractTypeScriptErrorTypes(errorOutput) {
        const errorTypes = {};
        const errorMatches = errorOutput.match(/error TS(\d+):/g) || [];
        for (const match of errorMatches) {
            const errorCode = match.match(/TS(\d+)/)?.[1];
            if (errorCode) {
                errorTypes[`TS${errorCode}`] = (errorTypes[`TS${errorCode}`] || 0) + 1;
            }
        }
        return errorTypes;
    }
    calculateValidationSummary(validationResults, startTime) {
        const totalValidations = validationResults.length;
        const passedValidations = validationResults.filter(r => r.passed).length;
        const failedValidations = totalValidations - passedValidations;
        const warningsCount = validationResults.reduce((sum, r) => sum + r.warnings.length, 0);
        const totalExecutionTime = Date.now() - startTime;
        const criticalIssues = [];
        const recommendations = [];
        for (const result of validationResults) {
            if (!result.passed && result.validationType === 'typescript-compilation') {
                criticalIssues.push('TypeScript compilation errors detected');
            }
            if (!result.passed && result.validationType === 'test-suite') {
                criticalIssues.push('Test suite failures detected');
            }
            recommendations.push(...result.recommendations);
        }
        return {
            totalValidations,
            passedValidations,
            failedValidations,
            warningsCount,
            totalExecutionTime,
            criticalIssues: [...new Set(criticalIssues)],
            recommendations: [...new Set(recommendations)]
        };
    }
    shouldRequireRollback(validationResults) {
        // Require rollback for critical failures
        return validationResults.some(result => !result.passed && (result.validationType === 'typescript-compilation' ||
            (result.validationType === 'test-suite' && result.errors.length > 0) ||
            (result.validationType === 'react-component' && result.errors.length > 0)));
    }
    storeValidationHistory(batchId, validationResults) {
        const existing = this.validationHistory.get(batchId) || [];
        this.validationHistory.set(batchId, [...existing, ...validationResults]);
    }
    /**
     * Get validation history for analysis
     */
    getValidationHistory() {
        return new Map(this.validationHistory);
    }
    /**
     * Generate validation report
     */
    generateValidationReport(batchId) {
        const history = batchId
            ? this.validationHistory.get(batchId) || []
            : Array.from(this.validationHistory.values()).flat();
        if (history.length === 0) {
            return 'No validation history available';
        }
        const report = [
            '# Validation Report',
            `Generated: ${new Date().toISOString()}`,
            batchId ? `Batch ID: ${batchId}` : 'All Batches',
            '',
            '## Summary',
            `Total Validations: ${history.length}`,
            `Passed: ${history.filter(r => r.passed).length}`,
            `Failed: ${history.filter(r => !r.passed).length}`,
            `Average Execution Time: ${(history.reduce((sum, r) => sum + r.executionTime, 0) / history.length).toFixed(2)}ms`,
            '',
            '## Validation Results'
        ];
        for (const result of history) {
            report.push(`### ${result.validationType} - ${result.passed ? 'PASSED' : 'FAILED'}`);
            report.push(`Execution Time: ${result.executionTime}ms`);
            if (result.errors.length > 0) {
                report.push('**Errors:**');
                result.errors.forEach(error => report.push(`- ${error}`));
            }
            if (result.warnings.length > 0) {
                report.push('**Warnings:**');
                result.warnings.forEach(warning => report.push(`- ${warning}`));
            }
            if (result.recommendations.length > 0) {
                report.push('**Recommendations:**');
                result.recommendations.forEach(rec => report.push(`- ${rec}`));
            }
            report.push('');
        }
        return report.join('\n');
    }
    async delay(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }
    log(level, message) {
        const levels = { debug: 0, info: 1, warn: 2, error: 3 };
        const configLevel = levels[this.config.logLevel];
        const messageLevel = levels[level];
        if (messageLevel >= configLevel) {
            const timestamp = new Date().toISOString();
            const prefix = level.toUpperCase().padEnd(5);
            console.log(`[${timestamp}] ${prefix} ${message}`);
        }
    }
}
exports.ComprehensiveValidationFramework = ComprehensiveValidationFramework;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9zY3JpcHRzL3ZhbGlkYXRpb24vQ29tcHJlaGVuc2l2ZVZhbGlkYXRpb25GcmFtZXdvcmsudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7Ozs7Ozs7Ozs7R0FZRzs7Ozs7O0FBRUgsaURBQXlDO0FBQ3pDLDRDQUFvQjtBQUNwQixnREFBd0I7QUE4RHhCLE1BQWEsZ0NBQWdDO0lBQ25DLE1BQU0sQ0FBbUI7SUFDekIsaUJBQWlCLEdBQW9DLElBQUksR0FBRyxFQUFFLENBQUM7SUFFdkUsWUFBWSxTQUFvQyxFQUFFO1FBQ2hELElBQUksQ0FBQyxNQUFNLEdBQUc7WUFDWiwwQkFBMEIsRUFBRSxJQUFJO1lBQ2hDLHlCQUF5QixFQUFFLElBQUk7WUFDL0IseUJBQXlCLEVBQUUsSUFBSTtZQUMvQix1QkFBdUIsRUFBRSxJQUFJO1lBQzdCLHFCQUFxQixFQUFFLElBQUk7WUFDM0IsV0FBVyxFQUFFLEtBQUs7WUFDbEIsa0JBQWtCLEVBQUUsS0FBSztZQUN6QixVQUFVLEVBQUUsQ0FBQztZQUNiLFFBQVEsRUFBRSxNQUFNO1lBQ2hCLEdBQUcsTUFBTTtTQUNWLENBQUM7SUFDSixDQUFDO0lBRUQ7O09BRUc7SUFDSCxLQUFLLENBQUMsOEJBQThCLENBQ2xDLGNBQXdCLEVBQ3hCLE9BQWU7UUFFZixNQUFNLFNBQVMsR0FBRyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUM7UUFDN0IsSUFBSSxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsa0RBQWtELE9BQU8sRUFBRSxDQUFDLENBQUM7UUFDOUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsaUJBQWlCLGNBQWMsQ0FBQyxNQUFNLGtCQUFrQixDQUFDLENBQUM7UUFFM0UsTUFBTSxpQkFBaUIsR0FBdUIsRUFBRSxDQUFDO1FBQ2pELElBQUksYUFBYSxHQUFHLElBQUksQ0FBQztRQUN6QixJQUFJLFlBQVksR0FBRyxHQUFHLENBQUM7UUFFdkIsSUFBSTtZQUNGLGtEQUFr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IiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9HcmVnQ2FzdHJvL0Rlc2t0b3AvV2hhdFRvRWF0TmV4dC9zcmMvc2NyaXB0cy92YWxpZGF0aW9uL0NvbXByZWhlbnNpdmVWYWxpZGF0aW9uRnJhbWV3b3JrLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29tcHJlaGVuc2l2ZSBWYWxpZGF0aW9uIEZyYW1ld29yayBmb3IgVW51c2VkIFZhcmlhYmxlIEVsaW1pbmF0aW9uXG4gKlxuICogVGhpcyBmcmFtZXdvcmsgaW1wbGVtZW50cyBjb21wcmVoZW5zaXZlIHZhbGlkYXRpb24gdG8gZW5zdXJlIGJ1aWxkIHN0YWJpbGl0eVxuICogYW5kIHF1YWxpdHkgYXNzdXJhbmNlIHRocm91Z2hvdXQgdGhlIHVudXNlZCB2YXJpYWJsZSBlbGltaW5hdGlvbiBwcm9jZXNzLlxuICpcbiAqIEZlYXR1cmVzOlxuICogLSBaZXJvIFR5cGVTY3JpcHQgY29tcGlsYXRpb24gZXJyb3IgbWFpbnRlbmFuY2VcbiAqIC0gVGVzdCBzdWl0ZSB2YWxpZGF0aW9uIGFmdGVyIGVhY2ggYmF0Y2hcbiAqIC0gUmVhY3QgY29tcG9uZW50IGZ1bmN0aW9uYWxpdHkgcHJlc2VydmF0aW9uIGNoZWNrc1xuICogLSBTZXJ2aWNlIGludGVncmF0aW9uIHZhbGlkYXRpb25cbiAqIC0gUXVhbGl0eSBhc3N1cmFuY2UgcmVwb3J0aW5nXG4gKi9cblxuaW1wb3J0IHsgZXhlY1N5bmMgfSBmcm9tICdjaGlsZF9wcm9jZXNzJztcbmltcG9ydCBmcyBmcm9tICdmcyc7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcblxuZXhwb3J0IGludGVyZmFjZSBWYWxpZGF0aW9uQ29uZmlnIHtcbiAgZW5hYmxlVHlwZVNjcmlwdFZhbGlkYXRpb246IGJvb2xlYW47XG4gIGVuYWJsZVRlc3RTdWl0ZVZhbGlkYXRpb246IGJvb2xlYW47XG4gIGVuYWJsZUNvbXBvbmVudFZhbGlkYXRpb246IGJvb2xlYW47XG4gIGVuYWJsZVNlcnZpY2VWYWxpZGF0aW9uOiBib29sZWFuO1xuICBlbmFibGVCdWlsZFZhbGlkYXRpb246IGJvb2xlYW47XG4gIHRlc3RUaW1lb3V0OiBudW1iZXI7XG4gIGNvbXBpbGF0aW9uVGltZW91dDogbnVtYmVyO1xuICBtYXhSZXRyaWVzOiBudW1iZXI7XG4gIGxvZ0xldmVsOiAnZGVidWcnIHwgJ2luZm8nIHwgJ3dhcm4nIHwgJ2Vycm9yJztcbn1cblxuZXhwb3J0IGludGVyZmFjZSBWYWxpZGF0aW9uUmVzdWx0IHtcbiAgcGFzc2VkOiBib29sZWFuO1xuICB2YWxpZGF0aW9uVHlwZTogc3RyaW5nO1xuICBlcnJvcnM6IHN0cmluZ1tdO1xuICB3YXJuaW5nczogc3RyaW5nW107XG4gIHJlY29tbWVuZGF0aW9uczogc3RyaW5nW107XG4gIGV4ZWN1dGlvblRpbWU6IG51bWJlcjtcbiAgcmV0cnlDb3VudDogbnVtYmVyO1xuICBkZXRhaWxzOiBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIENvbXByZWhlbnNpdmVWYWxpZGF0aW9uUmVzdWx0IHtcbiAgb3ZlcmFsbFBhc3NlZDogYm9vbGVhbjtcbiAgdmFsaWRhdGlvblJlc3VsdHM6IFZhbGlkYXRpb25SZXN1bHRbXTtcbiAgc3VtbWFyeTogVmFsaWRhdGlvblN1bW1hcnk7XG4gIHJlcXVpcmVzUm9sbGJhY2s6IGJvb2xlYW47XG4gIHF1YWxpdHlTY29yZTogbnVtYmVyO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFZhbGlkYXRpb25TdW1tYXJ5IHtcbiAgdG90YWxWYWxpZGF0aW9uczogbnVtYmVyO1xuICBwYXNzZWRWYWxpZGF0aW9uczogbnVtYmVyO1xuICBmYWlsZWRWYWxpZGF0aW9uczogbnVtYmVyO1xuICB3YXJuaW5nc0NvdW50OiBudW1iZXI7XG4gIHRvdGFsRXhlY3V0aW9uVGltZTogbnVtYmVyO1xuICBjcml0aWNhbElzc3Vlczogc3RyaW5nW107XG4gIHJlY29tbWVuZGF0aW9uczogc3RyaW5nW107XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ29tcG9uZW50VmFsaWRhdGlvbkluZm8ge1xuICBjb21wb25lbnRQYXRoOiBzdHJpbmc7XG4gIGNvbXBvbmVudE5hbWU6IHN0cmluZztcbiAgaGFzVGVzdHM6IGJvb2xlYW47XG4gIGV4cG9ydGVkRnVuY3Rpb25zOiBzdHJpbmdbXTtcbiAgaW1wb3J0ZWREZXBlbmRlbmNpZXM6IHN0cmluZ1tdO1xuICBwcm9wc0ludGVyZmFjZT86IHN0cmluZztcbiAgc3RhdGVWYXJpYWJsZXM6IHN0cmluZ1tdO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFNlcnZpY2VWYWxpZGF0aW9uSW5mbyB7XG4gIHNlcnZpY2VQYXRoOiBzdHJpbmc7XG4gIHNlcnZpY2VOYW1lOiBzdHJpbmc7XG4gIGFwaUVuZHBvaW50czogc3RyaW5nW107XG4gIGV4cG9ydGVkTWV0aG9kczogc3RyaW5nW107XG4gIGRlcGVuZGVuY2llczogc3RyaW5nW107XG4gIGNvbmZpZ3VyYXRpb25LZXlzOiBzdHJpbmdbXTtcbn1cblxuZXhwb3J0IGNsYXNzIENvbXByZWhlbnNpdmVWYWxpZGF0aW9uRnJhbWV3b3JrIHtcbiAgcHJpdmF0ZSBjb25maWc6IFZhbGlkYXRpb25Db25maWc7XG4gIHByaXZhdGUgdmFsaWRhdGlvbkhpc3Rvcnk6IE1hcDxzdHJpbmcsIFZhbGlkYXRpb25SZXN1bHRbXT4gPSBuZXcgTWFwKCk7XG5cbiAgY29uc3RydWN0b3IoY29uZmlnOiBQYXJ0aWFsPFZhbGlkYXRpb25Db25maWc+ID0ge30pIHtcbiAgICB0aGlzLmNvbmZpZyA9IHtcbiAgICAgIGVuYWJsZVR5cGVTY3JpcHRWYWxpZGF0aW9uOiB0cnVlLFxuICAgICAgZW5hYmxlVGVzdFN1aXRlVmFsaWRhdGlvbjogdHJ1ZSxcbiAgICAgIGVuYWJsZUNvbXBvbmVudFZhbGlkYXRpb246IHRydWUsXG4gICAgICBlbmFibGVTZXJ2aWNlVmFsaWRhdGlvbjogdHJ1ZSxcbiAgICAgIGVuYWJsZUJ1aWxkVmFsaWRhdGlvbjogdHJ1ZSxcbiAgICAgIHRlc3RUaW1lb3V0OiAzMDAwMCxcbiAgICAgIGNvbXBpbGF0aW9uVGltZW91dDogNDUwMDAsXG4gICAgICBtYXhSZXRyaWVzOiAyLFxuICAgICAgbG9nTGV2ZWw6ICdpbmZvJyxcbiAgICAgIC4uLmNvbmZpZ1xuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogUGVyZm9ybSBjb21wcmVoZW5zaXZlIHZhbGlkYXRpb24gYWZ0ZXIgYmF0Y2ggcHJvY2Vzc2luZ1xuICAgKi9cbiAgYXN5bmMgcGVyZm9ybUNvbXByZWhlbnNpdmVWYWxpZGF0aW9uKFxuICAgIHByb2Nlc3NlZEZpbGVzOiBzdHJpbmdbXSxcbiAgICBiYXRjaElkOiBzdHJpbmdcbiAgKTogUHJvbWlzZTxDb21wcmVoZW5zaXZlVmFsaWRhdGlvblJlc3VsdD4ge1xuICAgIGNvbnN0IHN0YXJ0VGltZSA9IERhdGUubm93KCk7XG4gICAgdGhpcy5sb2coJ2luZm8nLCBg8J+UjSBTdGFydGluZyBjb21wcmVoZW5zaXZlIHZhbGlkYXRpb24gZm9yIGJhdGNoICR7YmF0Y2hJZH1gKTtcbiAgICB0aGlzLmxvZygnaW5mbycsIGDwn5OLIFZhbGlkYXRpbmcgJHtwcm9jZXNzZWRGaWxlcy5sZW5ndGh9IHByb2Nlc3NlZCBmaWxlc2ApO1xuXG4gICAgY29uc3QgdmFsaWRhdGlvblJlc3VsdHM6IFZhbGlkYXRpb25SZXN1bHRbXSA9IFtdO1xuICAgIGxldCBvdmVyYWxsUGFzc2VkID0gdHJ1ZTtcbiAgICBsZXQgcXVhbGl0eVNjb3JlID0gMTAwO1xuXG4gICAgdHJ5IHtcbiAgICAgIC8vIDEuIFR5cGVTY3JpcHQgQ29tcGlsYXRpb24gVmFsaWRhdGlvbiAoQ3JpdGljYWwpXG4gICAgICBpZiAodGhpcy5jb25maWcuZW5hYmxlVHlwZVNjcmlwdFZhbGlkYXRpb24pIHtcbiAgICAgICAgY29uc3QgdHNSZXN1bHQgPSBhd2FpdCB0aGlzLnZhbGlkYXRlVHlwZVNjcmlwdENvbXBpbGF0aW9uKGJhdGNoSWQpO1xuICAgICAgICB2YWxpZGF0aW9uUmVzdWx0cy5wdXNoKHRzUmVzdWx0KTtcbiAgICAgICAgaWYgKCF0c1Jlc3VsdC5wYXNzZWQpIHtcbiAgICAgICAgICBvdmVyYWxsUGFzc2VkID0gZmFsc2U7XG4gICAgICAgICAgcXVhbGl0eVNjb3JlIC09IDQwOyAvLyBNYWpvciBwZW5hbHR5IGZvciBjb21waWxhdGlvbiBlcnJvcnNcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyAyLiBUZXN0IFN1aXRlIFZhbGlkYXRpb24gKEhpZ2ggUHJpb3JpdHkpXG4gICAgICBpZiAodGhpcy5jb25maWcuZW5hYmxlVGVzdFN1aXRlVmFsaWRhdGlvbikge1xuICAgICAgICBjb25zdCB0ZXN0UmVzdWx0ID0gYXdhaXQgdGhpcy52YWxpZGF0ZVRlc3RTdWl0ZShwcm9jZXNzZWRGaWxlcywgYmF0Y2hJZCk7XG4gICAgICAgIHZhbGlkYXRpb25SZXN1bHRzLnB1c2godGVzdFJlc3VsdCk7XG4gICAgICAgIGlmICghdGVzdFJlc3VsdC5wYXNzZWQpIHtcbiAgICAgICAgICBvdmVyYWxsUGFzc2VkID0gZmFsc2U7XG4gICAgICAgICAgcXVhbGl0eVNjb3JlIC09IDI1OyAvLyBTaWduaWZpY2FudCBwZW5hbHR5IGZvciB0ZXN0IGZhaWx1cmVzXG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gMy4gUmVhY3QgQ29tcG9uZW50IEZ1bmN0aW9uYWxpdHkgVmFsaWRhdGlvbiAoSGlnaCBQcmlvcml0eSlcbiAgICAgIGlmICh0aGlzLmNvbmZpZy5lbmFibGVDb21wb25lbnRWYWxpZGF0aW9uKSB7XG4gICAgICAgIGNvbnN0IGNvbXBvbmVudFJlc3VsdHMgPSBhd2FpdCB0aGlzLnZhbGlkYXRlUmVhY3RDb21wb25lbnRzKHByb2Nlc3NlZEZpbGVzLCBiYXRjaElkKTtcbiAgICAgICAgdmFsaWRhdGlvblJlc3VsdHMucHVzaCguLi5jb21wb25lbnRSZXN1bHRzKTtcbiAgICAgICAgY29uc3QgZmFpbGVkQ29tcG9uZW50cyA9IGNvbXBvbmVudFJlc3VsdHMuZmlsdGVyKHIgPT4gIXIucGFzc2VkKTtcbiAgICAgICAgaWYgKGZhaWxlZENvbXBvbmVudHMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIG92ZXJhbGxQYXNzZWQgPSBmYWxzZTtcbiAgICAgICAgICBxdWFsaXR5U2NvcmUgLT0gTWF0aC5taW4oMjAsIGZhaWxlZENvbXBvbmVudHMubGVuZ3RoICogNSk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gNC4gU2VydmljZSBJbnRlZ3JhdGlvbiBWYWxpZGF0aW9uIChNZWRpdW0gUHJpb3JpdHkpXG4gICAgICBpZiAodGhpcy5jb25maWcuZW5hYmxlU2VydmljZVZhbGlkYXRpb24pIHtcbiAgICAgICAgY29uc3Qgc2VydmljZVJlc3VsdHMgPSBhd2FpdCB0aGlzLnZhbGlkYXRlU2VydmljZUludGVncmF0aW9uKHByb2Nlc3NlZEZpbGVzLCBiYXRjaElkKTtcbiAgICAgICAgdmFsaWRhdGlvblJlc3VsdHMucHVzaCguLi5zZXJ2aWNlUmVzdWx0cyk7XG4gICAgICAgIGNvbnN0IGZhaWxlZFNlcnZpY2VzID0gc2VydmljZVJlc3VsdHMuZmlsdGVyKHIgPT4gIXIucGFzc2VkKTtcbiAgICAgICAgaWYgKGZhaWxlZFNlcnZpY2VzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBxdWFsaXR5U2NvcmUgLT0gTWF0aC5taW4oMTUsIGZhaWxlZFNlcnZpY2VzLmxlbmd0aCAqIDMpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIDUuIEJ1aWxkIFN5c3RlbSBWYWxpZGF0aW9uIChNZWRpdW0gUHJpb3JpdHkpXG4gICAgICBpZiAodGhpcy5jb25maWcuZW5hYmxlQnVpbGRWYWxpZGF0aW9uKSB7XG4gICAgICAgIGNvbnN0IGJ1aWxkUmVzdWx0ID0gYXdhaXQgdGhpcy52YWxpZGF0ZUJ1aWxkU3lzdGVtKGJhdGNoSWQpO1xuICAgICAgICB2YWxpZGF0aW9uUmVzdWx0cy5wdXNoKGJ1aWxkUmVzdWx0KTtcbiAgICAgICAgaWYgKCFidWlsZFJlc3VsdC5wYXNzZWQpIHtcbiAgICAgICAgICBxdWFsaXR5U2NvcmUgLT0gMTA7IC8vIE1pbm9yIHBlbmFsdHkgZm9yIGJ1aWxkIGlzc3Vlc1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIENhbGN1bGF0ZSBzdW1tYXJ5XG4gICAgICBjb25zdCBzdW1tYXJ5ID0gdGhpcy5jYWxjdWxhdGVWYWxpZGF0aW9uU3VtbWFyeSh2YWxpZGF0aW9uUmVzdWx0cywgc3RhcnRUaW1lKTtcblxuICAgICAgLy8gRGV0ZXJtaW5lIGlmIHJvbGxiYWNrIGlzIHJlcXVpcmVkXG4gICAgICBjb25zdCByZXF1aXJlc1JvbGxiYWNrID0gdGhpcy5zaG91bGRSZXF1aXJlUm9sbGJhY2sodmFsaWRhdGlvblJlc3VsdHMpO1xuXG4gICAgICAvLyBTdG9yZSB2YWxpZGF0aW9uIGhpc3RvcnlcbiAgICAgIHRoaXMuc3RvcmVWYWxpZGF0aW9uSGlzdG9yeShiYXRjaElkLCB2YWxpZGF0aW9uUmVzdWx0cyk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdDogQ29tcHJlaGVuc2l2ZVZhbGlkYXRpb25SZXN1bHQgPSB7XG4gICAgICAgIG92ZXJhbGxQYXNzZWQsXG4gICAgICAgIHZhbGlkYXRpb25SZXN1bHRzLFxuICAgICAgICBzdW1tYXJ5LFxuICAgICAgICByZXF1aXJlc1JvbGxiYWNrLFxuICAgICAgICBxdWFsaXR5U2NvcmU6IE1hdGgubWF4KDAsIHF1YWxpdHlTY29yZSlcbiAgICAgIH07XG5cbiAgICAgIHRoaXMubG9nKCdpbmZvJywgYOKchSBDb21wcmVoZW5zaXZlIHZhbGlkYXRpb24gY29tcGxldGVkYCk7XG4gICAgICB0aGlzLmxvZygnaW5mbycsIGDwn5OKIE92ZXJhbGwgUmVzdWx0OiAke292ZXJhbGxQYXNzZWQgPyAnUEFTU0VEJyA6ICdGQUlMRUQnfWApO1xuICAgICAgdGhpcy5sb2coJ2luZm8nLCBg8J+OryBRdWFsaXR5IFNjb3JlOiAke3Jlc3VsdC5xdWFsaXR5U2NvcmV9LzEwMGApO1xuXG4gICAgICByZXR1cm4gcmVzdWx0O1xuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRoaXMubG9nKCdlcnJvcicsIGDinYwgQ29tcHJlaGVuc2l2ZSB2YWxpZGF0aW9uIGZhaWxlZDogJHtlcnJvcn1gKTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgb3ZlcmFsbFBhc3NlZDogZmFsc2UsXG4gICAgICAgIHZhbGlkYXRpb25SZXN1bHRzOiBbe1xuICAgICAgICAgIHBhc3NlZDogZmFsc2UsXG4gICAgICAgICAgdmFsaWRhdGlvblR5cGU6ICdmcmFtZXdvcmstZXJyb3InLFxuICAgICAgICAgIGVycm9yczogW2BWYWxpZGF0aW9uIGZyYW1ld29yayBlcnJvcjogJHtlcnJvcn1gXSxcbiAgICAgICAgICB3YXJuaW5nczogW10sXG4gICAgICAgICAgcmVjb21tZW5kYXRpb25zOiBbJ1JldmlldyB2YWxpZGF0aW9uIGZyYW1ld29yayBjb25maWd1cmF0aW9uJ10sXG4gICAgICAgICAgZXhlY3V0aW9uVGltZTogRGF0ZS5ub3coKSAtIHN0YXJ0VGltZSxcbiAgICAgICAgICByZXRyeUNvdW50OiAwLFxuICAgICAgICAgIGRldGFpbHM6IHsgZXJyb3I6IGVycm9yLnRvU3RyaW5nKCkgfVxuICAgICAgICB9XSxcbiAgICAgICAgc3VtbWFyeToge1xuICAgICAgICAgIHRvdGFsVmFsaWRhdGlvbnM6IDEsXG4gICAgICAgICAgcGFzc2VkVmFsaWRhdGlvbnM6IDAsXG4gICAgICAgICAgZmFpbGVkVmFsaWRhdGlvbnM6IDEsXG4gICAgICAgICAgd2FybmluZ3NDb3VudDogMCxcbiAgICAgICAgICB0b3RhbEV4ZWN1dGlvblRpbWU6IERhdGUubm93KCkgLSBzdGFydFRpbWUsXG4gICAgICAgICAgY3JpdGljYWxJc3N1ZXM6IFsnVmFsaWRhdGlvbiBmcmFtZXdvcmsgZmFpbHVyZSddLFxuICAgICAgICAgIHJlY29tbWVuZGF0aW9uczogWydSZXZpZXcgdmFsaWRhdGlvbiBmcmFtZXdvcmsgY29uZmlndXJhdGlvbiddXG4gICAgICAgIH0sXG4gICAgICAgIHJlcXVpcmVzUm9sbGJhY2s6IHRydWUsXG4gICAgICAgIHF1YWxpdHlTY29yZTogMFxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVmFsaWRhdGUgVHlwZVNjcmlwdCBjb21waWxhdGlvbiB3aXRoIHplcm8gZXJyb3IgcmVxdWlyZW1lbnRcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgdmFsaWRhdGVUeXBlU2NyaXB0Q29tcGlsYXRpb24oYmF0Y2hJZDogc3RyaW5nKTogUHJvbWlzZTxWYWxpZGF0aW9uUmVzdWx0PiB7XG4gICAgY29uc3Qgc3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICBjb25zdCByZXN1bHQ6IFZhbGlkYXRpb25SZXN1bHQgPSB7XG4gICAgICBwYXNzZWQ6IGZhbHNlLFxuICAgICAgdmFsaWRhdGlvblR5cGU6ICd0eXBlc2NyaXB0LWNvbXBpbGF0aW9uJyxcbiAgICAgIGVycm9yczogW10sXG4gICAgICB3YXJuaW5nczogW10sXG4gICAgICByZWNvbW1lbmRhdGlvbnM6IFtdLFxuICAgICAgZXhlY3V0aW9uVGltZTogMCxcbiAgICAgIHJldHJ5Q291bnQ6IDAsXG4gICAgICBkZXRhaWxzOiB7fVxuICAgIH07XG5cbiAgICB0aGlzLmxvZygnZGVidWcnLCAn8J+UjSBWYWxpZGF0aW5nIFR5cGVTY3JpcHQgY29tcGlsYXRpb24uLi4nKTtcblxuICAgIGZvciAobGV0IHJldHJ5ID0gMDsgcmV0cnkgPD0gdGhpcy5jb25maWcubWF4UmV0cmllczsgcmV0cnkrKykge1xuICAgICAgdHJ5IHtcbiAgICAgICAgcmVzdWx0LnJldHJ5Q291bnQgPSByZXRyeTtcblxuICAgICAgICAvLyBSdW4gVHlwZVNjcmlwdCBjb21waWxhdGlvbiB3aXRoIGRldGFpbGVkIGVycm9yIHJlcG9ydGluZ1xuICAgICAgICBjb25zdCBvdXRwdXQgPSBleGVjU3luYygneWFybiB0c2MgLS1ub0VtaXQgLS1za2lwTGliQ2hlY2sgLS1wcmV0dHknLCB7XG4gICAgICAgICAgZW5jb2Rpbmc6ICd1dGY4JyxcbiAgICAgICAgICB0aW1lb3V0OiB0aGlzLmNvbmZpZy5jb21waWxhdGlvblRpbWVvdXQsXG4gICAgICAgICAgc3RkaW86ICdwaXBlJ1xuICAgICAgICB9KTtcblxuICAgICAgICAvLyBJZiB3ZSBnZXQgaGVyZSwgY29tcGlsYXRpb24gc3VjY2VlZGVkXG4gICAgICAgIHJlc3VsdC5wYXNzZWQgPSB0cnVlO1xuICAgICAgICByZXN1bHQuZGV0YWlscy5jb21waWxhdGlvbk91dHB1dCA9ICdObyBlcnJvcnMgZm91bmQnO1xuICAgICAgICB0aGlzLmxvZygnZGVidWcnLCAn4pyFIFR5cGVTY3JpcHQgY29tcGlsYXRpb24gcGFzc2VkJyk7XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICAgIGNvbnN0IGVycm9yT3V0cHV0ID0gZXJyb3Iuc3Rkb3V0IHx8IGVycm9yLnN0ZGVyciB8fCBlcnJvci5tZXNzYWdlO1xuXG4gICAgICAgIC8vIFBhcnNlIFR5cGVTY3JpcHQgZXJyb3JzXG4gICAgICAgIGNvbnN0IGVycm9yTGluZXMgPSBlcnJvck91dHB1dC5zcGxpdCgnXFxuJykuZmlsdGVyKGxpbmUgPT4gbGluZS50cmltKCkpO1xuICAgICAgICBjb25zdCBlcnJvckNvdW50ID0gZXJyb3JMaW5lcy5maWx0ZXIobGluZSA9PiAvZXJyb3IgVFNcXGQrOi8udGVzdChsaW5lKSkubGVuZ3RoO1xuXG4gICAgICAgIHJlc3VsdC5lcnJvcnMucHVzaChgVHlwZVNjcmlwdCBjb21waWxhdGlvbiBmYWlsZWQgd2l0aCAke2Vycm9yQ291bnR9IGVycm9yc2ApO1xuICAgICAgICByZXN1bHQuZGV0YWlscy5lcnJvck91dHB1dCA9IGVycm9yT3V0cHV0O1xuICAgICAgICByZXN1bHQuZGV0YWlscy5lcnJvckNvdW50ID0gZXJyb3JDb3VudDtcblxuICAgICAgICAvLyBFeHRyYWN0IHNwZWNpZmljIGVycm9yIHR5cGVzIGZvciBhbmFseXNpc1xuICAgICAgICBjb25zdCBlcnJvclR5cGVzID0gdGhpcy5leHRyYWN0VHlwZVNjcmlwdEVycm9yVHlwZXMoZXJyb3JPdXRwdXQpO1xuICAgICAgICByZXN1bHQuZGV0YWlscy5lcnJvclR5cGVzID0gZXJyb3JUeXBlcztcblxuICAgICAgICBpZiAocmV0cnkgPCB0aGlzLmNvbmZpZy5tYXhSZXRyaWVzKSB7XG4gICAgICAgICAgdGhpcy5sb2coJ3dhcm4nLCBg4pqg77iPIFR5cGVTY3JpcHQgY29tcGlsYXRpb24gZmFpbGVkIChhdHRlbXB0ICR7cmV0cnkgKyAxfSksIHJldHJ5aW5nLi4uYCk7XG4gICAgICAgICAgYXdhaXQgdGhpcy5kZWxheSgxMDAwKTsgLy8gV2FpdCAxIHNlY29uZCBiZWZvcmUgcmV0cnlcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLmxvZygnZXJyb3InLCBg4p2MIFR5cGVTY3JpcHQgY29tcGlsYXRpb24gZmFpbGVkIGFmdGVyICR7cmV0cnkgKyAxfSBhdHRlbXB0c2ApO1xuICAgICAgICAgIHJlc3VsdC5yZWNvbW1lbmRhdGlvbnMucHVzaCgnUmV2aWV3IFR5cGVTY3JpcHQgZXJyb3JzIGFuZCBmaXggY29tcGlsYXRpb24gaXNzdWVzJyk7XG4gICAgICAgICAgcmVzdWx0LnJlY29tbWVuZGF0aW9ucy5wdXNoKCdDb25zaWRlciByb2xsaW5nIGJhY2sgY2hhbmdlcyBpZiBlcnJvcnMgYXJlIGNyaXRpY2FsJyk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXN1bHQuZXhlY3V0aW9uVGltZSA9IERhdGUubm93KCkgLSBzdGFydFRpbWU7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIC8qKlxuICAgKiBWYWxpZGF0ZSB0ZXN0IHN1aXRlIGV4ZWN1dGlvblxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyB2YWxpZGF0ZVRlc3RTdWl0ZShwcm9jZXNzZWRGaWxlczogc3RyaW5nW10sIGJhdGNoSWQ6IHN0cmluZyk6IFByb21pc2U8VmFsaWRhdGlvblJlc3VsdD4ge1xuICAgIGNvbnN0IHN0YXJ0VGltZSA9IERhdGUubm93KCk7XG4gICAgY29uc3QgcmVzdWx0OiBWYWxpZGF0aW9uUmVzdWx0ID0ge1xuICAgICAgcGFzc2VkOiBmYWxzZSxcbiAgICAgIHZhbGlkYXRpb25UeXBlOiAndGVzdC1zdWl0ZScsXG4gICAgICBlcnJvcnM6IFtdLFxuICAgICAgd2FybmluZ3M6IFtdLFxuICAgICAgcmVjb21tZW5kYXRpb25zOiBbXSxcbiAgICAgIGV4ZWN1dGlvblRpbWU6IDAsXG4gICAgICByZXRyeUNvdW50OiAwLFxuICAgICAgZGV0YWlsczoge31cbiAgICB9O1xuXG4gICAgdGhpcy5sb2coJ2RlYnVnJywgJ/Cfp6ogVmFsaWRhdGluZyB0ZXN0IHN1aXRlLi4uJyk7XG5cbiAgICB0cnkge1xuICAgICAgLy8gRmluZCByZWxhdGVkIHRlc3QgZmlsZXMgZm9yIHByb2Nlc3NlZCBmaWxlc1xuICAgICAgY29uc3QgcmVsYXRlZFRlc3RGaWxlcyA9IHRoaXMuZmluZFJlbGF0ZWRUZXN0RmlsZXMocHJvY2Vzc2VkRmlsZXMpO1xuICAgICAgcmVzdWx0LmRldGFpbHMucmVsYXRlZFRlc3RGaWxlcyA9IHJlbGF0ZWRUZXN0RmlsZXM7XG5cbiAgICAgIGlmIChyZWxhdGVkVGVzdEZpbGVzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXN1bHQucGFzc2VkID0gdHJ1ZTtcbiAgICAgICAgcmVzdWx0Lndhcm5pbmdzLnB1c2goJ05vIHJlbGF0ZWQgdGVzdCBmaWxlcyBmb3VuZCBmb3IgcHJvY2Vzc2VkIGZpbGVzJyk7XG4gICAgICAgIHJlc3VsdC5yZWNvbW1lbmRhdGlvbnMucHVzaCgnQ29uc2lkZXIgYWRkaW5nIHRlc3RzIGZvciBtb2RpZmllZCBjb21wb25lbnRzJyk7XG4gICAgICAgIHRoaXMubG9nKCdkZWJ1ZycsICfimqDvuI8gTm8gcmVsYXRlZCB0ZXN0IGZpbGVzIGZvdW5kJyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBSdW4gdGVzdHMgd2l0aCBtZW1vcnkgbWFuYWdlbWVudFxuICAgICAgICBjb25zdCB0ZXN0Q29tbWFuZCA9IGBOT0RFX09QVElPTlM9Jy0tZXhwb3NlLWdjIC0tbWF4LW9sZC1zcGFjZS1zaXplPTIwNDgnIHlhcm4gdGVzdCAtLXJ1biAtLXBhc3NXaXRoTm9UZXN0cyAtLXRlc3RQYXRoUGF0dGVybj1cIiR7cmVsYXRlZFRlc3RGaWxlcy5qb2luKCd8Jyl9XCJgO1xuXG4gICAgICAgIGNvbnN0IG91dHB1dCA9IGV4ZWNTeW5jKHRlc3RDb21tYW5kLCB7XG4gICAgICAgICAgZW5jb2Rpbmc6ICd1dGY4JyxcbiAgICAgICAgICB0aW1lb3V0OiB0aGlzLmNvbmZpZy50ZXN0VGltZW91dCxcbiAgICAgICAgICBzdGRpbzogJ3BpcGUnXG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIFBhcnNlIHRlc3QgcmVzdWx0c1xuICAgICAgICBjb25zdCB0ZXN0UmVzdWx0cyA9IHRoaXMucGFyc2VUZXN0UmVzdWx0cyhvdXRwdXQpO1xuICAgICAgICByZXN1bHQuZGV0YWlscy50ZXN0UmVzdWx0cyA9IHRlc3RSZXN1bHRzO1xuXG4gICAgICAgIGlmICh0ZXN0UmVzdWx0cy5mYWlsZWQgPT09IDApIHtcbiAgICAgICAgICByZXN1bHQucGFzc2VkID0gdHJ1ZTtcbiAgICAgICAgICB0aGlzLmxvZygnZGVidWcnLCBg4pyFIEFsbCAke3Rlc3RSZXN1bHRzLnBhc3NlZH0gdGVzdHMgcGFzc2VkYCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmVzdWx0LmVycm9ycy5wdXNoKGAke3Rlc3RSZXN1bHRzLmZhaWxlZH0gdGVzdHMgZmFpbGVkYCk7XG4gICAgICAgICAgcmVzdWx0LnJlY29tbWVuZGF0aW9ucy5wdXNoKCdSZXZpZXcgYW5kIGZpeCBmYWlsaW5nIHRlc3RzJyk7XG4gICAgICAgICAgdGhpcy5sb2coJ2Vycm9yJywgYOKdjCAke3Rlc3RSZXN1bHRzLmZhaWxlZH0gdGVzdHMgZmFpbGVkYCk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIHJlc3VsdC5lcnJvcnMucHVzaChgVGVzdCBzdWl0ZSB2YWxpZGF0aW9uIGZhaWxlZDogJHtlcnJvci5tZXNzYWdlfWApO1xuICAgICAgcmVzdWx0LmRldGFpbHMuZXJyb3IgPSBlcnJvci50b1N0cmluZygpO1xuICAgICAgcmVzdWx0LnJlY29tbWVuZGF0aW9ucy5wdXNoKCdSZXZpZXcgdGVzdCBjb25maWd1cmF0aW9uIGFuZCBkZXBlbmRlbmNpZXMnKTtcbiAgICAgIHRoaXMubG9nKCdlcnJvcicsIGDinYwgVGVzdCBzdWl0ZSB2YWxpZGF0aW9uIGZhaWxlZDogJHtlcnJvcn1gKTtcbiAgICB9XG5cbiAgICByZXN1bHQuZXhlY3V0aW9uVGltZSA9IERhdGUubm93KCkgLSBzdGFydFRpbWU7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIC8qKlxuICAgKiBWYWxpZGF0ZSBSZWFjdCBjb21wb25lbnQgZnVuY3Rpb25hbGl0eSBwcmVzZXJ2YXRpb25cbiAgICovXG4gIHByaXZhdGUgYXN5bmMgdmFsaWRhdGVSZWFjdENvbXBvbmVudHMocHJvY2Vzc2VkRmlsZXM6IHN0cmluZ1tdLCBiYXRjaElkOiBzdHJpbmcpOiBQcm9taXNlPFZhbGlkYXRpb25SZXN1bHRbXT4ge1xuICAgIGNvbnN0IHJlc3VsdHM6IFZhbGlkYXRpb25SZXN1bHRbXSA9IFtdO1xuXG4gICAgLy8gRmlsdGVyIGZvciBSZWFjdCBjb21wb25lbnQgZmlsZXNcbiAgICBjb25zdCBjb21wb25lbnRGaWxlcyA9IHByb2Nlc3NlZEZpbGVzLmZpbHRlcihmaWxlID0+XG4gICAgICAvXFwuKHRzeHxqc3gpJC8udGVzdChmaWxlKSAmJlxuICAgICAgL1xcL2NvbXBvbmVudHNcXC8vLnRlc3QoZmlsZSlcbiAgICApO1xuXG4gICAgdGhpcy5sb2coJ2RlYnVnJywgYPCflI0gVmFsaWRhdGluZyAke2NvbXBvbmVudEZpbGVzLmxlbmd0aH0gUmVhY3QgY29tcG9uZW50cy4uLmApO1xuXG4gICAgZm9yIChjb25zdCBjb21wb25lbnRGaWxlIG9mIGNvbXBvbmVudEZpbGVzKSB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLnZhbGlkYXRlU2luZ2xlQ29tcG9uZW50KGNvbXBvbmVudEZpbGUsIGJhdGNoSWQpO1xuICAgICAgcmVzdWx0cy5wdXNoKHJlc3VsdCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc3VsdHM7XG4gIH1cblxuICAvKipcbiAgICogVmFsaWRhdGUgYSBzaW5nbGUgUmVhY3QgY29tcG9uZW50XG4gICAqL1xuICBwcml2YXRlIGFzeW5jIHZhbGlkYXRlU2luZ2xlQ29tcG9uZW50KGNvbXBvbmVudFBhdGg6IHN0cmluZywgYmF0Y2hJZDogc3RyaW5nKTogUHJvbWlzZTxWYWxpZGF0aW9uUmVzdWx0PiB7XG4gICAgY29uc3Qgc3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICBjb25zdCByZXN1bHQ6IFZhbGlkYXRpb25SZXN1bHQgPSB7XG4gICAgICBwYXNzZWQ6IHRydWUsXG4gICAgICB2YWxpZGF0aW9uVHlwZTogJ3JlYWN0LWNvbXBvbmVudCcsXG4gICAgICBlcnJvcnM6IFtdLFxuICAgICAgd2FybmluZ3M6IFtdLFxuICAgICAgcmVjb21tZW5kYXRpb25zOiBbXSxcbiAgICAgIGV4ZWN1dGlvblRpbWU6IDAsXG4gICAgICByZXRyeUNvdW50OiAwLFxuICAgICAgZGV0YWlsczogeyBjb21wb25lbnRQYXRoIH1cbiAgICB9O1xuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGNvbXBvbmVudEluZm8gPSBhd2FpdCB0aGlzLmFuYWx5emVDb21wb25lbnQoY29tcG9uZW50UGF0aCk7XG4gICAgICByZXN1bHQuZGV0YWlscy5jb21wb25lbnRJbmZvID0gY29tcG9uZW50SW5mbztcblxuICAgICAgLy8gQ2hlY2sgaWYgY29tcG9uZW50IGNhbiBzdGlsbCBiZSBpbXBvcnRlZFxuICAgICAgY29uc3QgaW1wb3J0VmFsaWRhdGlvbiA9IGF3YWl0IHRoaXMudmFsaWRhdGVDb21wb25lbnRJbXBvcnQoY29tcG9uZW50UGF0aCk7XG4gICAgICBpZiAoIWltcG9ydFZhbGlkYXRpb24uc3VjY2Vzcykge1xuICAgICAgICByZXN1bHQucGFzc2VkID0gZmFsc2U7XG4gICAgICAgIHJlc3VsdC5lcnJvcnMucHVzaChgQ29tcG9uZW50IGltcG9ydCBmYWlsZWQ6ICR7aW1wb3J0VmFsaWRhdGlvbi5lcnJvcn1gKTtcbiAgICAgIH1cblxuICAgICAgLy8gQ2hlY2sgaWYgY29tcG9uZW50IGV4cG9ydHMgYXJlIGludGFjdFxuICAgICAgY29uc3QgZXhwb3J0VmFsaWRhdGlvbiA9IGF3YWl0IHRoaXMudmFsaWRhdGVDb21wb25lbnRFeHBvcnRzKGNvbXBvbmVudFBhdGgsIGNvbXBvbmVudEluZm8pO1xuICAgICAgaWYgKCFleHBvcnRWYWxpZGF0aW9uLnN1Y2Nlc3MpIHtcbiAgICAgICAgcmVzdWx0LnBhc3NlZCA9IGZhbHNlO1xuICAgICAgICByZXN1bHQuZXJyb3JzLnB1c2goYENvbXBvbmVudCBleHBvcnRzIHZhbGlkYXRpb24gZmFpbGVkOiAke2V4cG9ydFZhbGlkYXRpb24uZXJyb3J9YCk7XG4gICAgICB9XG5cbiAgICAgIC8vIENoZWNrIGlmIGNvbXBvbmVudCBwcm9wcyBpbnRlcmZhY2UgaXMgcHJlc2VydmVkXG4gICAgICBpZiAoY29tcG9uZW50SW5mby5wcm9wc0ludGVyZmFjZSkge1xuICAgICAgICBjb25zdCBwcm9wc1ZhbGlkYXRpb24gPSBhd2FpdCB0aGlzLnZhbGlkYXRlQ29tcG9uZW50UHJvcHMoY29tcG9uZW50UGF0aCwgY29tcG9uZW50SW5mby5wcm9wc0ludGVyZmFjZSk7XG4gICAgICAgIGlmICghcHJvcHNWYWxpZGF0aW9uLnN1Y2Nlc3MpIHtcbiAgICAgICAgICByZXN1bHQud2FybmluZ3MucHVzaChgUHJvcHMgaW50ZXJmYWNlIG1heSBoYXZlIGJlZW4gYWZmZWN0ZWQ6ICR7cHJvcHNWYWxpZGF0aW9uLndhcm5pbmd9YCk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gQ2hlY2sgaWYgY29tcG9uZW50IGhhcyB0ZXN0cyBhbmQgdGhleSBzdGlsbCBwYXNzXG4gICAgICBpZiAoY29tcG9uZW50SW5mby5oYXNUZXN0cykge1xuICAgICAgICBjb25zdCB0ZXN0VmFsaWRhdGlvbiA9IGF3YWl0IHRoaXMudmFsaWRhdGVDb21wb25lbnRUZXN0cyhjb21wb25lbnRQYXRoKTtcbiAgICAgICAgaWYgKCF0ZXN0VmFsaWRhdGlvbi5zdWNjZXNzKSB7XG4gICAgICAgICAgcmVzdWx0Lndhcm5pbmdzLnB1c2goYENvbXBvbmVudCB0ZXN0cyBtYXkgYmUgYWZmZWN0ZWQ6ICR7dGVzdFZhbGlkYXRpb24ud2FybmluZ31gKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVzdWx0LnJlY29tbWVuZGF0aW9ucy5wdXNoKCdDb25zaWRlciBhZGRpbmcgdGVzdHMgZm9yIHRoaXMgY29tcG9uZW50Jyk7XG4gICAgICB9XG5cbiAgICAgIGlmIChyZXN1bHQucGFzc2VkKSB7XG4gICAgICAgIHRoaXMubG9nKCdkZWJ1ZycsIGDinIUgQ29tcG9uZW50ICR7Y29tcG9uZW50SW5mby5jb21wb25lbnROYW1lfSB2YWxpZGF0aW9uIHBhc3NlZGApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5sb2coJ2Vycm9yJywgYOKdjCBDb21wb25lbnQgJHtjb21wb25lbnRJbmZvLmNvbXBvbmVudE5hbWV9IHZhbGlkYXRpb24gZmFpbGVkYCk7XG4gICAgICB9XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgcmVzdWx0LnBhc3NlZCA9IGZhbHNlO1xuICAgICAgcmVzdWx0LmVycm9ycy5wdXNoKGBDb21wb25lbnQgdmFsaWRhdGlvbiBmYWlsZWQ6ICR7ZXJyb3J9YCk7XG4gICAgICB0aGlzLmxvZygnZXJyb3InLCBg4p2MIENvbXBvbmVudCB2YWxpZGF0aW9uIGZhaWxlZCBmb3IgJHtjb21wb25lbnRQYXRofTogJHtlcnJvcn1gKTtcbiAgICB9XG5cbiAgICByZXN1bHQuZXhlY3V0aW9uVGltZSA9IERhdGUubm93KCkgLSBzdGFydFRpbWU7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIC8qKlxuICAgKiBWYWxpZGF0ZSBzZXJ2aWNlIGludGVncmF0aW9uIGZ1bmN0aW9uYWxpdHlcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgdmFsaWRhdGVTZXJ2aWNlSW50ZWdyYXRpb24ocHJvY2Vzc2VkRmlsZXM6IHN0cmluZ1tdLCBiYXRjaElkOiBzdHJpbmcpOiBQcm9taXNlPFZhbGlkYXRpb25SZXN1bHRbXT4ge1xuICAgIGNvbnN0IHJlc3VsdHM6IFZhbGlkYXRpb25SZXN1bHRbXSA9IFtdO1xuXG4gICAgLy8gRmlsdGVyIGZvciBzZXJ2aWNlIGZpbGVzXG4gICAgY29uc3Qgc2VydmljZUZpbGVzID0gcHJvY2Vzc2VkRmlsZXMuZmlsdGVyKGZpbGUgPT5cbiAgICAgIC9cXC9zZXJ2aWNlc1xcLy8udGVzdChmaWxlKSB8fFxuICAgICAgL1NlcnZpY2VcXC50cyQvLnRlc3QoZmlsZSkgfHxcbiAgICAgIC9DbGllbnRcXC50cyQvLnRlc3QoZmlsZSlcbiAgICApO1xuXG4gICAgdGhpcy5sb2coJ2RlYnVnJywgYPCflI0gVmFsaWRhdGluZyAke3NlcnZpY2VGaWxlcy5sZW5ndGh9IHNlcnZpY2UgaW50ZWdyYXRpb25zLi4uYCk7XG5cbiAgICBmb3IgKGNvbnN0IHNlcnZpY2VGaWxlIG9mIHNlcnZpY2VGaWxlcykge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy52YWxpZGF0ZVNpbmdsZVNlcnZpY2Uoc2VydmljZUZpbGUsIGJhdGNoSWQpO1xuICAgICAgcmVzdWx0cy5wdXNoKHJlc3VsdCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlc3VsdHM7XG4gIH1cblxuICAvKipcbiAgICogVmFsaWRhdGUgYSBzaW5nbGUgc2VydmljZVxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyB2YWxpZGF0ZVNpbmdsZVNlcnZpY2Uoc2VydmljZVBhdGg6IHN0cmluZywgYmF0Y2hJZDogc3RyaW5nKTogUHJvbWlzZTxWYWxpZGF0aW9uUmVzdWx0PiB7XG4gICAgY29uc3Qgc3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICBjb25zdCByZXN1bHQ6IFZhbGlkYXRpb25SZXN1bHQgPSB7XG4gICAgICBwYXNzZWQ6IHRydWUsXG4gICAgICB2YWxpZGF0aW9uVHlwZTogJ3NlcnZpY2UtaW50ZWdyYXRpb24nLFxuICAgICAgZXJyb3JzOiBbXSxcbiAgICAgIHdhcm5pbmdzOiBbXSxcbiAgICAgIHJlY29tbWVuZGF0aW9uczogW10sXG4gICAgICBleGVjdXRpb25UaW1lOiAwLFxuICAgICAgcmV0cnlDb3VudDogMCxcbiAgICAgIGRldGFpbHM6IHsgc2VydmljZVBhdGggfVxuICAgIH07XG5cbiAgICB0cnkge1xuICAgICAgY29uc3Qgc2VydmljZUluZm8gPSBhd2FpdCB0aGlzLmFuYWx5emVTZXJ2aWNlKHNlcnZpY2VQYXRoKTtcbiAgICAgIHJlc3VsdC5kZXRhaWxzLnNlcnZpY2VJbmZvID0gc2VydmljZUluZm87XG5cbiAgICAgIC8vIENoZWNrIGlmIHNlcnZpY2UgY2FuIHN0aWxsIGJlIGltcG9ydGVkXG4gICAgICBjb25zdCBpbXBvcnRWYWxpZGF0aW9uID0gYXdhaXQgdGhpcy52YWxpZGF0ZVNlcnZpY2VJbXBvcnQoc2VydmljZVBhdGgpO1xuICAgICAgaWYgKCFpbXBvcnRWYWxpZGF0aW9uLnN1Y2Nlc3MpIHtcbiAgICAgICAgcmVzdWx0LnBhc3NlZCA9IGZhbHNlO1xuICAgICAgICByZXN1bHQuZXJyb3JzLnB1c2goYFNlcnZpY2UgaW1wb3J0IGZhaWxlZDogJHtpbXBvcnRWYWxpZGF0aW9uLmVycm9yfWApO1xuICAgICAgfVxuXG4gICAgICAvLyBDaGVjayBpZiBBUEkgZW5kcG9pbnRzIGFyZSBzdGlsbCBmdW5jdGlvbmFsIChiYXNpYyBzeW50YXggY2hlY2spXG4gICAgICBpZiAoc2VydmljZUluZm8uYXBpRW5kcG9pbnRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgY29uc3QgZW5kcG9pbnRWYWxpZGF0aW9uID0gYXdhaXQgdGhpcy52YWxpZGF0ZUFwaUVuZHBvaW50cyhzZXJ2aWNlUGF0aCwgc2VydmljZUluZm8uYXBpRW5kcG9pbnRzKTtcbiAgICAgICAgaWYgKCFlbmRwb2ludFZhbGlkYXRpb24uc3VjY2Vzcykge1xuICAgICAgICAgIHJlc3VsdC53YXJuaW5ncy5wdXNoKGBBUEkgZW5kcG9pbnRzIG1heSBiZSBhZmZlY3RlZDogJHtlbmRwb2ludFZhbGlkYXRpb24ud2FybmluZ31gKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBDaGVjayBpZiBleHBvcnRlZCBtZXRob2RzIGFyZSBpbnRhY3RcbiAgICAgIGNvbnN0IG1ldGhvZFZhbGlkYXRpb24gPSBhd2FpdCB0aGlzLnZhbGlkYXRlU2VydmljZU1ldGhvZHMoc2VydmljZVBhdGgsIHNlcnZpY2VJbmZvLmV4cG9ydGVkTWV0aG9kcyk7XG4gICAgICBpZiAoIW1ldGhvZFZhbGlkYXRpb24uc3VjY2Vzcykge1xuICAgICAgICByZXN1bHQucGFzc2VkID0gZmFsc2U7XG4gICAgICAgIHJlc3VsdC5lcnJvcnMucHVzaChgU2VydmljZSBtZXRob2RzIHZhbGlkYXRpb24gZmFpbGVkOiAke21ldGhvZFZhbGlkYXRpb24uZXJyb3J9YCk7XG4gICAgICB9XG5cbiAgICAgIGlmIChyZXN1bHQucGFzc2VkKSB7XG4gICAgICAgIHRoaXMubG9nKCdkZWJ1ZycsIGDinIUgU2VydmljZSAke3NlcnZpY2VJbmZvLnNlcnZpY2VOYW1lfSB2YWxpZGF0aW9uIHBhc3NlZGApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5sb2coJ2Vycm9yJywgYOKdjCBTZXJ2aWNlICR7c2VydmljZUluZm8uc2VydmljZU5hbWV9IHZhbGlkYXRpb24gZmFpbGVkYCk7XG4gICAgICB9XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgcmVzdWx0LnBhc3NlZCA9IGZhbHNlO1xuICAgICAgcmVzdWx0LmVycm9ycy5wdXNoKGBTZXJ2aWNlIHZhbGlkYXRpb24gZmFpbGVkOiAke2Vycm9yfWApO1xuICAgICAgdGhpcy5sb2coJ2Vycm9yJywgYOKdjCBTZXJ2aWNlIHZhbGlkYXRpb24gZmFpbGVkIGZvciAke3NlcnZpY2VQYXRofTogJHtlcnJvcn1gKTtcbiAgICB9XG5cbiAgICByZXN1bHQuZXhlY3V0aW9uVGltZSA9IERhdGUubm93KCkgLSBzdGFydFRpbWU7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIC8qKlxuICAgKiBWYWxpZGF0ZSBidWlsZCBzeXN0ZW0gZnVuY3Rpb25hbGl0eVxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyB2YWxpZGF0ZUJ1aWxkU3lzdGVtKGJhdGNoSWQ6IHN0cmluZyk6IFByb21pc2U8VmFsaWRhdGlvblJlc3VsdD4ge1xuICAgIGNvbnN0IHN0YXJ0VGltZSA9IERhdGUubm93KCk7XG4gICAgY29uc3QgcmVzdWx0OiBWYWxpZGF0aW9uUmVzdWx0ID0ge1xuICAgICAgcGFzc2VkOiBmYWxzZSxcbiAgICAgIHZhbGlkYXRpb25UeXBlOiAnYnVpbGQtc3lzdGVtJyxcbiAgICAgIGVycm9yczogW10sXG4gICAgICB3YXJuaW5nczogW10sXG4gICAgICByZWNvbW1lbmRhdGlvbnM6IFtdLFxuICAgICAgZXhlY3V0aW9uVGltZTogMCxcbiAgICAgIHJldHJ5Q291bnQ6IDAsXG4gICAgICBkZXRhaWxzOiB7fVxuICAgIH07XG5cbiAgICB0aGlzLmxvZygnZGVidWcnLCAn8J+Pl++4jyBWYWxpZGF0aW5nIGJ1aWxkIHN5c3RlbS4uLicpO1xuXG4gICAgdHJ5IHtcbiAgICAgIC8vIFRlc3QgTmV4dC5qcyBidWlsZCBwcm9jZXNzIChkcnkgcnVuKVxuICAgICAgY29uc3QgYnVpbGRPdXRwdXQgPSBleGVjU3luYygneWFybiBuZXh0IGJ1aWxkIC0tZHJ5LXJ1bicsIHtcbiAgICAgICAgZW5jb2Rpbmc6ICd1dGY4JyxcbiAgICAgICAgdGltZW91dDogNjAwMDAsIC8vIDEgbWludXRlIHRpbWVvdXQgZm9yIGJ1aWxkIHZhbGlkYXRpb25cbiAgICAgICAgc3RkaW86ICdwaXBlJ1xuICAgICAgfSk7XG5cbiAgICAgIHJlc3VsdC5wYXNzZWQgPSB0cnVlO1xuICAgICAgcmVzdWx0LmRldGFpbHMuYnVpbGRPdXRwdXQgPSB0eXBlb2YgYnVpbGRPdXRwdXQgPT09ICdzdHJpbmcnID8gYnVpbGRPdXRwdXQgOiBidWlsZE91dHB1dC50b1N0cmluZygpO1xuICAgICAgdGhpcy5sb2coJ2RlYnVnJywgJ+KchSBCdWlsZCBzeXN0ZW0gdmFsaWRhdGlvbiBwYXNzZWQnKTtcblxuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIHJlc3VsdC5lcnJvcnMucHVzaChgQnVpbGQgc3lzdGVtIHZhbGlkYXRpb24gZmFpbGVkOiAke2Vycm9yLm1lc3NhZ2V9YCk7XG4gICAgICByZXN1bHQuZGV0YWlscy5idWlsZEVycm9yID0gZXJyb3IudG9TdHJpbmcoKTtcbiAgICAgIHJlc3VsdC5yZWNvbW1lbmRhdGlvbnMucHVzaCgnUmV2aWV3IGJ1aWxkIGNvbmZpZ3VyYXRpb24gYW5kIGRlcGVuZGVuY2llcycpO1xuICAgICAgdGhpcy5sb2coJ2Vycm9yJywgYOKdjCBCdWlsZCBzeXN0ZW0gdmFsaWRhdGlvbiBmYWlsZWQ6ICR7ZXJyb3J9YCk7XG4gICAgfVxuXG4gICAgcmVzdWx0LmV4ZWN1dGlvblRpbWUgPSBEYXRlLm5vdygpIC0gc3RhcnRUaW1lO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICAvLyBIZWxwZXIgbWV0aG9kcyBmb3IgYW5hbHlzaXMgYW5kIHZhbGlkYXRpb25cblxuICBwcml2YXRlIGFzeW5jIGFuYWx5emVDb21wb25lbnQoY29tcG9uZW50UGF0aDogc3RyaW5nKTogUHJvbWlzZTxDb21wb25lbnRWYWxpZGF0aW9uSW5mbz4ge1xuICAgIGNvbnN0IGNvbnRlbnQgPSBmcy5yZWFkRmlsZVN5bmMoY29tcG9uZW50UGF0aCwgJ3V0ZjgnKTtcbiAgICBjb25zdCByZWxhdGl2ZVBhdGggPSBwYXRoLnJlbGF0aXZlKHByb2Nlc3MuY3dkKCksIGNvbXBvbmVudFBhdGgpO1xuICAgIGNvbnN0IGNvbXBvbmVudE5hbWUgPSBwYXRoLmJhc2VuYW1lKGNvbXBvbmVudFBhdGgsIHBhdGguZXh0bmFtZShjb21wb25lbnRQYXRoKSk7XG5cbiAgICAvLyBGaW5kIHRlc3QgZmlsZVxuICAgIGNvbnN0IHRlc3RQYXRoID0gY29tcG9uZW50UGF0aC5yZXBsYWNlKC9cXC4odHN4fGpzeCkkLywgJy50ZXN0LiQxJyk7XG4gICAgY29uc3QgaGFzVGVzdHMgPSBmcy5leGlzdHNTeW5jKHRlc3RQYXRoKTtcblxuICAgIC8vIEV4dHJhY3QgZXhwb3J0cyAoc2ltcGxpZmllZClcbiAgICBjb25zdCBleHBvcnRNYXRjaGVzID0gY29udGVudC5tYXRjaCgvZXhwb3J0XFxzKyg/OmNvbnN0fGZ1bmN0aW9ufGNsYXNzKVxccysoXFx3KykvZykgfHwgW107XG4gICAgY29uc3QgZXhwb3J0ZWRGdW5jdGlvbnMgPSBleHBvcnRNYXRjaGVzLm1hcChtYXRjaCA9PiB7XG4gICAgICBjb25zdCBuYW1lTWF0Y2ggPSBtYXRjaC5tYXRjaCgvZXhwb3J0XFxzKyg/OmNvbnN0fGZ1bmN0aW9ufGNsYXNzKVxccysoXFx3KykvKTtcbiAgICAgIHJldHVybiBuYW1lTWF0Y2ggPyBuYW1lTWF0Y2hbMV0gOiAnJztcbiAgICB9KS5maWx0ZXIoQm9vbGVhbik7XG5cbiAgICAvLyBFeHRyYWN0IGltcG9ydHMgKHNpbXBsaWZpZWQpXG4gICAgY29uc3QgaW1wb3J0TWF0Y2hlcyA9IGNvbnRlbnQubWF0Y2goL2ltcG9ydFxccysuKj9cXHMrZnJvbVxccytbJ1wiXShbXidcIl0rKVsnXCJdL2cpIHx8IFtdO1xuICAgIGNvbnN0IGltcG9ydGVkRGVwZW5kZW5jaWVzID0gaW1wb3J0TWF0Y2hlcy5tYXAobWF0Y2ggPT4ge1xuICAgICAgY29uc3QgcGF0aE1hdGNoID0gbWF0Y2gubWF0Y2goL2Zyb21cXHMrWydcIl0oW14nXCJdKylbJ1wiXS8pO1xuICAgICAgcmV0dXJuIHBhdGhNYXRjaCA/IHBhdGhNYXRjaFsxXSA6ICcnO1xuICAgIH0pLmZpbHRlcihCb29sZWFuKTtcblxuICAgIC8vIEV4dHJhY3QgcHJvcHMgaW50ZXJmYWNlIChzaW1wbGlmaWVkKVxuICAgIGNvbnN0IHByb3BzSW50ZXJmYWNlTWF0Y2ggPSBjb250ZW50Lm1hdGNoKC9pbnRlcmZhY2VcXHMrKFxcdypQcm9wcylcXHMqey8pO1xuICAgIGNvbnN0IHByb3BzSW50ZXJmYWNlID0gcHJvcHNJbnRlcmZhY2VNYXRjaCA/IHByb3BzSW50ZXJmYWNlTWF0Y2hbMV0gOiB1bmRlZmluZWQ7XG5cbiAgICAvLyBFeHRyYWN0IHN0YXRlIHZhcmlhYmxlcyAoc2ltcGxpZmllZClcbiAgICBjb25zdCBzdGF0ZU1hdGNoZXMgPSBjb250ZW50Lm1hdGNoKC9jb25zdFxccytcXFsoXFx3KyksXFxzKnNldFxcdytcXF1cXHMqPVxccyp1c2VTdGF0ZS9nKSB8fCBbXTtcbiAgICBjb25zdCBzdGF0ZVZhcmlhYmxlcyA9IHN0YXRlTWF0Y2hlcy5tYXAobWF0Y2ggPT4ge1xuICAgICAgY29uc3QgbmFtZU1hdGNoID0gbWF0Y2gubWF0Y2goL2NvbnN0XFxzK1xcWyhcXHcrKSwvKTtcbiAgICAgIHJldHVybiBuYW1lTWF0Y2ggPyBuYW1lTWF0Y2hbMV0gOiAnJztcbiAgICB9KS5maWx0ZXIoQm9vbGVhbik7XG5cbiAgICByZXR1cm4ge1xuICAgICAgY29tcG9uZW50UGF0aDogcmVsYXRpdmVQYXRoLFxuICAgICAgY29tcG9uZW50TmFtZSxcbiAgICAgIGhhc1Rlc3RzLFxuICAgICAgZXhwb3J0ZWRGdW5jdGlvbnMsXG4gICAgICBpbXBvcnRlZERlcGVuZGVuY2llcyxcbiAgICAgIHByb3BzSW50ZXJmYWNlLFxuICAgICAgc3RhdGVWYXJpYWJsZXNcbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBhbmFseXplU2VydmljZShzZXJ2aWNlUGF0aDogc3RyaW5nKTogUHJvbWlzZTxTZXJ2aWNlVmFsaWRhdGlvbkluZm8+IHtcbiAgICBjb25zdCBjb250ZW50ID0gZnMucmVhZEZpbGVTeW5jKHNlcnZpY2VQYXRoLCAndXRmOCcpO1xuICAgIGNvbnN0IHJlbGF0aXZlUGF0aCA9IHBhdGgucmVsYXRpdmUocHJvY2Vzcy5jd2QoKSwgc2VydmljZVBhdGgpO1xuICAgIGNvbnN0IHNlcnZpY2VOYW1lID0gcGF0aC5iYXNlbmFtZShzZXJ2aWNlUGF0aCwgcGF0aC5leHRuYW1lKHNlcnZpY2VQYXRoKSk7XG5cbiAgICAvLyBFeHRyYWN0IEFQSSBlbmRwb2ludHMgKHNpbXBsaWZpZWQpXG4gICAgY29uc3QgYXBpTWF0Y2hlcyA9IGNvbnRlbnQubWF0Y2goL1snXCJgXVxcL2FwaVxcL1teJ1wiYF0rWydcImBdL2cpIHx8IFtdO1xuICAgIGNvbnN0IGFwaUVuZHBvaW50cyA9IGFwaU1hdGNoZXMubWFwKG1hdGNoID0+IG1hdGNoLnJlcGxhY2UoL1snXCJgXS9nLCAnJykpO1xuXG4gICAgLy8gRXh0cmFjdCBleHBvcnRlZCBtZXRob2RzIChzaW1wbGlmaWVkKVxuICAgIGNvbnN0IGV4cG9ydE1hdGNoZXMgPSBjb250ZW50Lm1hdGNoKC9leHBvcnRcXHMrKD86Y29uc3R8ZnVuY3Rpb258Y2xhc3MpXFxzKyhcXHcrKS9nKSB8fCBbXTtcbiAgICBjb25zdCBleHBvcnRlZE1ldGhvZHMgPSBleHBvcnRNYXRjaGVzLm1hcChtYXRjaCA9PiB7XG4gICAgICBjb25zdCBuYW1lTWF0Y2ggPSBtYXRjaC5tYXRjaCgvZXhwb3J0XFxzKyg/OmNvbnN0fGZ1bmN0aW9ufGNsYXNzKVxccysoXFx3KykvKTtcbiAgICAgIHJldHVybiBuYW1lTWF0Y2ggPyBuYW1lTWF0Y2hbMV0gOiAnJztcbiAgICB9KS5maWx0ZXIoQm9vbGVhbik7XG5cbiAgICAvLyBFeHRyYWN0IGRlcGVuZGVuY2llcyAoc2ltcGxpZmllZClcbiAgICBjb25zdCBpbXBvcnRNYXRjaGVzID0gY29udGVudC5tYXRjaCgvaW1wb3J0XFxzKy4qP1xccytmcm9tXFxzK1snXCJdKFteJ1wiXSspWydcIl0vZykgfHwgW107XG4gICAgY29uc3QgZGVwZW5kZW5jaWVzID0gaW1wb3J0TWF0Y2hlcy5tYXAobWF0Y2ggPT4ge1xuICAgICAgY29uc3QgcGF0aE1hdGNoID0gbWF0Y2gubWF0Y2goL2Zyb21cXHMrWydcIl0oW14nXCJdKylbJ1wiXS8pO1xuICAgICAgcmV0dXJuIHBhdGhNYXRjaCA/IHBhdGhNYXRjaFsxXSA6ICcnO1xuICAgIH0pLmZpbHRlcihCb29sZWFuKTtcblxuICAgIC8vIEV4dHJhY3QgY29uZmlndXJhdGlvbiBrZXlzIChzaW1wbGlmaWVkKVxuICAgIGNvbnN0IGNvbmZpZ01hdGNoZXMgPSBjb250ZW50Lm1hdGNoKC9wcm9jZXNzXFwuZW52XFwuKFxcdyspL2cpIHx8IFtdO1xuICAgIGNvbnN0IGNvbmZpZ3VyYXRpb25LZXlzID0gY29uZmlnTWF0Y2hlcy5tYXAobWF0Y2ggPT4ge1xuICAgICAgY29uc3Qga2V5TWF0Y2ggPSBtYXRjaC5tYXRjaCgvcHJvY2Vzc1xcLmVudlxcLihcXHcrKS8pO1xuICAgICAgcmV0dXJuIGtleU1hdGNoID8ga2V5TWF0Y2hbMV0gOiAnJztcbiAgICB9KS5maWx0ZXIoQm9vbGVhbik7XG5cbiAgICByZXR1cm4ge1xuICAgICAgc2VydmljZVBhdGg6IHJlbGF0aXZlUGF0aCxcbiAgICAgIHNlcnZpY2VOYW1lLFxuICAgICAgYXBpRW5kcG9pbnRzLFxuICAgICAgZXhwb3J0ZWRNZXRob2RzLFxuICAgICAgZGVwZW5kZW5jaWVzLFxuICAgICAgY29uZmlndXJhdGlvbktleXNcbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyB2YWxpZGF0ZUNvbXBvbmVudEltcG9ydChjb21wb25lbnRQYXRoOiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgZXJyb3I/OiBzdHJpbmcgfT4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBUaGlzIGlzIGEgc2ltcGxpZmllZCBjaGVjayAtIGluIGEgcmVhbCBpbXBsZW1lbnRhdGlvbiwgeW91IG1pZ2h0IHVzZSBUeXBlU2NyaXB0IGNvbXBpbGVyIEFQSVxuICAgICAgY29uc3QgY29udGVudCA9IGZzLnJlYWRGaWxlU3luYyhjb21wb25lbnRQYXRoLCAndXRmOCcpO1xuXG4gICAgICAvLyBDaGVjayBmb3IgYmFzaWMgc3ludGF4IGVycm9ycyB0aGF0IHdvdWxkIHByZXZlbnQgaW1wb3J0XG4gICAgICBpZiAoY29udGVudC5pbmNsdWRlcygnZXhwb3J0IGRlZmF1bHQnKSB8fCBjb250ZW50LmluY2x1ZGVzKCdleHBvcnQgeycpIHx8IGNvbnRlbnQuaW5jbHVkZXMoJ2V4cG9ydCBjb25zdCcpKSB7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ05vIGV4cG9ydHMgZm91bmQgaW4gY29tcG9uZW50JyB9O1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGBGYWlsZWQgdG8gcmVhZCBjb21wb25lbnQ6ICR7ZXJyb3J9YCB9O1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgdmFsaWRhdGVDb21wb25lbnRFeHBvcnRzKGNvbXBvbmVudFBhdGg6IHN0cmluZywgY29tcG9uZW50SW5mbzogQ29tcG9uZW50VmFsaWRhdGlvbkluZm8pOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgZXJyb3I/OiBzdHJpbmcgfT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBjb250ZW50ID0gZnMucmVhZEZpbGVTeW5jKGNvbXBvbmVudFBhdGgsICd1dGY4Jyk7XG5cbiAgICAgIC8vIENoZWNrIGlmIHByZXZpb3VzbHkgaWRlbnRpZmllZCBleHBvcnRzIGFyZSBzdGlsbCBwcmVzZW50XG4gICAgICBmb3IgKGNvbnN0IGV4cG9ydGVkRnVuY3Rpb24gb2YgY29tcG9uZW50SW5mby5leHBvcnRlZEZ1bmN0aW9ucykge1xuICAgICAgICBpZiAoIWNvbnRlbnQuaW5jbHVkZXMoZXhwb3J0ZWRGdW5jdGlvbikpIHtcbiAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGBFeHBvcnRlZCBmdW5jdGlvbiAke2V4cG9ydGVkRnVuY3Rpb259IG5vdCBmb3VuZGAgfTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogYEZhaWxlZCB0byB2YWxpZGF0ZSBleHBvcnRzOiAke2Vycm9yfWAgfTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHZhbGlkYXRlQ29tcG9uZW50UHJvcHMoY29tcG9uZW50UGF0aDogc3RyaW5nLCBwcm9wc0ludGVyZmFjZTogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IHdhcm5pbmc/OiBzdHJpbmcgfT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBjb250ZW50ID0gZnMucmVhZEZpbGVTeW5jKGNvbXBvbmVudFBhdGgsICd1dGY4Jyk7XG5cbiAgICAgIGlmICghY29udGVudC5pbmNsdWRlcyhwcm9wc0ludGVyZmFjZSkpIHtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIHdhcm5pbmc6IGBQcm9wcyBpbnRlcmZhY2UgJHtwcm9wc0ludGVyZmFjZX0gbm90IGZvdW5kYCB9O1xuICAgICAgfVxuXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCB3YXJuaW5nOiBgRmFpbGVkIHRvIHZhbGlkYXRlIHByb3BzOiAke2Vycm9yfWAgfTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHZhbGlkYXRlQ29tcG9uZW50VGVzdHMoY29tcG9uZW50UGF0aDogc3RyaW5nKTogUHJvbWlzZTx7IHN1Y2Nlc3M6IGJvb2xlYW47IHdhcm5pbmc/OiBzdHJpbmcgfT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCB0ZXN0UGF0aCA9IGNvbXBvbmVudFBhdGgucmVwbGFjZSgvXFwuKHRzeHxqc3gpJC8sICcudGVzdC4kMScpO1xuXG4gICAgICBpZiAoIWZzLmV4aXN0c1N5bmModGVzdFBhdGgpKSB7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCB3YXJuaW5nOiAnVGVzdCBmaWxlIG5vdCBmb3VuZCcgfTtcbiAgICAgIH1cblxuICAgICAgLy8gVGhpcyBpcyBhIHNpbXBsaWZpZWQgY2hlY2sgLSBpbiBhIHJlYWwgaW1wbGVtZW50YXRpb24sIHlvdSBtaWdodCBydW4gdGhlIHNwZWNpZmljIHRlc3RcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIHdhcm5pbmc6IGBGYWlsZWQgdG8gdmFsaWRhdGUgdGVzdHM6ICR7ZXJyb3J9YCB9O1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgdmFsaWRhdGVTZXJ2aWNlSW1wb3J0KHNlcnZpY2VQYXRoOiBzdHJpbmcpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgZXJyb3I/OiBzdHJpbmcgfT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBjb250ZW50ID0gZnMucmVhZEZpbGVTeW5jKHNlcnZpY2VQYXRoLCAndXRmOCcpO1xuXG4gICAgICAvLyBDaGVjayBmb3IgYmFzaWMgc3ludGF4IGVycm9ycyB0aGF0IHdvdWxkIHByZXZlbnQgaW1wb3J0XG4gICAgICBpZiAoY29udGVudC5pbmNsdWRlcygnZXhwb3J0JykpIHtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnTm8gZXhwb3J0cyBmb3VuZCBpbiBzZXJ2aWNlJyB9O1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGBGYWlsZWQgdG8gcmVhZCBzZXJ2aWNlOiAke2Vycm9yfWAgfTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHZhbGlkYXRlQXBpRW5kcG9pbnRzKHNlcnZpY2VQYXRoOiBzdHJpbmcsIGVuZHBvaW50czogc3RyaW5nW10pOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgd2FybmluZz86IHN0cmluZyB9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGNvbnRlbnQgPSBmcy5yZWFkRmlsZVN5bmMoc2VydmljZVBhdGgsICd1dGY4Jyk7XG5cbiAgICAgIC8vIENoZWNrIGlmIEFQSSBlbmRwb2ludHMgYXJlIHN0aWxsIHJlZmVyZW5jZWRcbiAgICAgIGZvciAoY29uc3QgZW5kcG9pbnQgb2YgZW5kcG9pbnRzKSB7XG4gICAgICAgIGlmICghY29udGVudC5pbmNsdWRlcyhlbmRwb2ludCkpIHtcbiAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgd2FybmluZzogYEFQSSBlbmRwb2ludCAke2VuZHBvaW50fSBub3QgZm91bmRgIH07XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgd2FybmluZzogYEZhaWxlZCB0byB2YWxpZGF0ZSBBUEkgZW5kcG9pbnRzOiAke2Vycm9yfWAgfTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHZhbGlkYXRlU2VydmljZU1ldGhvZHMoc2VydmljZVBhdGg6IHN0cmluZywgbWV0aG9kczogc3RyaW5nW10pOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgZXJyb3I/OiBzdHJpbmcgfT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBjb250ZW50ID0gZnMucmVhZEZpbGVTeW5jKHNlcnZpY2VQYXRoLCAndXRmOCcpO1xuXG4gICAgICAvLyBDaGVjayBpZiBwcmV2aW91c2x5IGlkZW50aWZpZWQgbWV0aG9kcyBhcmUgc3RpbGwgcHJlc2VudFxuICAgICAgZm9yIChjb25zdCBtZXRob2Qgb2YgbWV0aG9kcykge1xuICAgICAgICBpZiAoIWNvbnRlbnQuaW5jbHVkZXMobWV0aG9kKSkge1xuICAgICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogYFNlcnZpY2UgbWV0aG9kICR7bWV0aG9kfSBub3QgZm91bmRgIH07XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGBGYWlsZWQgdG8gdmFsaWRhdGUgc2VydmljZSBtZXRob2RzOiAke2Vycm9yfWAgfTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGZpbmRSZWxhdGVkVGVzdEZpbGVzKHByb2Nlc3NlZEZpbGVzOiBzdHJpbmdbXSk6IHN0cmluZ1tdIHtcbiAgICBjb25zdCB0ZXN0RmlsZXM6IHN0cmluZ1tdID0gW107XG5cbiAgICBmb3IgKGNvbnN0IGZpbGUgb2YgcHJvY2Vzc2VkRmlsZXMpIHtcbiAgICAgIC8vIExvb2sgZm9yIGNvcnJlc3BvbmRpbmcgdGVzdCBmaWxlc1xuICAgICAgY29uc3QgdGVzdFBhdHRlcm5zID0gW1xuICAgICAgICBmaWxlLnJlcGxhY2UoL1xcLih0c3x0c3h8anN8anN4KSQvLCAnLnRlc3QuJDEnKSxcbiAgICAgICAgZmlsZS5yZXBsYWNlKC9cXC4odHN8dHN4fGpzfGpzeCkkLywgJy5zcGVjLiQxJyksXG4gICAgICAgIGZpbGUucmVwbGFjZSgvXFwvKFteL10rKVxcLih0c3x0c3h8anN8anN4KSQvLCAnL19fdGVzdHNfXy8kMS50ZXN0LiQyJylcbiAgICAgIF07XG5cbiAgICAgIGZvciAoY29uc3QgdGVzdFBhdHRlcm4gb2YgdGVzdFBhdHRlcm5zKSB7XG4gICAgICAgIGlmIChmcy5leGlzdHNTeW5jKHRlc3RQYXR0ZXJuKSkge1xuICAgICAgICAgIHRlc3RGaWxlcy5wdXNoKHRlc3RQYXR0ZXJuKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB0ZXN0RmlsZXM7XG4gIH1cblxuICBwcml2YXRlIHBhcnNlVGVzdFJlc3VsdHMob3V0cHV0OiBzdHJpbmcgfCBCdWZmZXIpOiB7IHBhc3NlZDogbnVtYmVyOyBmYWlsZWQ6IG51bWJlcjsgdG90YWw6IG51bWJlciB9IHtcbiAgICAvLyBQYXJzZSBKZXN0IG91dHB1dCAoc2ltcGxpZmllZClcbiAgICAvLyBIYW5kbGUgYm90aCBzdHJpbmcgYW5kIEJ1ZmZlciB0eXBlc1xuICAgIGNvbnN0IG91dHB1dFN0ciA9IHR5cGVvZiBvdXRwdXQgPT09ICdzdHJpbmcnID8gb3V0cHV0IDogb3V0cHV0LnRvU3RyaW5nKCk7XG5cbiAgICBjb25zdCBwYXNzZWRNYXRjaCA9IG91dHB1dFN0ci5tYXRjaCgvKFxcZCspIHBhc3NlZC8pO1xuICAgIGNvbnN0IGZhaWxlZE1hdGNoID0gb3V0cHV0U3RyLm1hdGNoKC8oXFxkKykgZmFpbGVkLyk7XG5cbiAgICBjb25zdCBwYXNzZWQgPSBwYXNzZWRNYXRjaCA/IHBhcnNlSW50KHBhc3NlZE1hdGNoWzFdKSA6IDA7XG4gICAgY29uc3QgZmFpbGVkID0gZmFpbGVkTWF0Y2ggPyBwYXJzZUludChmYWlsZWRNYXRjaFsxXSkgOiAwO1xuICAgIGNvbnN0IHRvdGFsID0gcGFzc2VkICsgZmFpbGVkO1xuXG4gICAgcmV0dXJuIHsgcGFzc2VkLCBmYWlsZWQsIHRvdGFsIH07XG4gIH1cblxuICBwcml2YXRlIGV4dHJhY3RUeXBlU2NyaXB0RXJyb3JUeXBlcyhlcnJvck91dHB1dDogc3RyaW5nKTogUmVjb3JkPHN0cmluZywgbnVtYmVyPiB7XG4gICAgY29uc3QgZXJyb3JUeXBlczogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9O1xuICAgIGNvbnN0IGVycm9yTWF0Y2hlcyA9IGVycm9yT3V0cHV0Lm1hdGNoKC9lcnJvciBUUyhcXGQrKTovZykgfHwgW107XG5cbiAgICBmb3IgKGNvbnN0IG1hdGNoIG9mIGVycm9yTWF0Y2hlcykge1xuICAgICAgY29uc3QgZXJyb3JDb2RlID0gbWF0Y2gubWF0Y2goL1RTKFxcZCspLyk/LlsxXTtcbiAgICAgIGlmIChlcnJvckNvZGUpIHtcbiAgICAgICAgZXJyb3JUeXBlc1tgVFMke2Vycm9yQ29kZX1gXSA9IChlcnJvclR5cGVzW2BUUyR7ZXJyb3JDb2RlfWBdIHx8IDApICsgMTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gZXJyb3JUeXBlcztcbiAgfVxuXG4gIHByaXZhdGUgY2FsY3VsYXRlVmFsaWRhdGlvblN1bW1hcnkodmFsaWRhdGlvblJlc3VsdHM6IFZhbGlkYXRpb25SZXN1bHRbXSwgc3RhcnRUaW1lOiBudW1iZXIpOiBWYWxpZGF0aW9uU3VtbWFyeSB7XG4gICAgY29uc3QgdG90YWxWYWxpZGF0aW9ucyA9IHZhbGlkYXRpb25SZXN1bHRzLmxlbmd0aDtcbiAgICBjb25zdCBwYXNzZWRWYWxpZGF0aW9ucyA9IHZhbGlkYXRpb25SZXN1bHRzLmZpbHRlcihyID0+IHIucGFzc2VkKS5sZW5ndGg7XG4gICAgY29uc3QgZmFpbGVkVmFsaWRhdGlvbnMgPSB0b3RhbFZhbGlkYXRpb25zIC0gcGFzc2VkVmFsaWRhdGlvbnM7XG4gICAgY29uc3Qgd2FybmluZ3NDb3VudCA9IHZhbGlkYXRpb25SZXN1bHRzLnJlZHVjZSgoc3VtLCByKSA9PiBzdW0gKyByLndhcm5pbmdzLmxlbmd0aCwgMCk7XG4gICAgY29uc3QgdG90YWxFeGVjdXRpb25UaW1lID0gRGF0ZS5ub3coKSAtIHN0YXJ0VGltZTtcblxuICAgIGNvbnN0IGNyaXRpY2FsSXNzdWVzOiBzdHJpbmdbXSA9IFtdO1xuICAgIGNvbnN0IHJlY29tbWVuZGF0aW9uczogc3RyaW5nW10gPSBbXTtcblxuICAgIGZvciAoY29uc3QgcmVzdWx0IG9mIHZhbGlkYXRpb25SZXN1bHRzKSB7XG4gICAgICBpZiAoIXJlc3VsdC5wYXNzZWQgJiYgcmVzdWx0LnZhbGlkYXRpb25UeXBlID09PSAndHlwZXNjcmlwdC1jb21waWxhdGlvbicpIHtcbiAgICAgICAgY3JpdGljYWxJc3N1ZXMucHVzaCgnVHlwZVNjcmlwdCBjb21waWxhdGlvbiBlcnJvcnMgZGV0ZWN0ZWQnKTtcbiAgICAgIH1cbiAgICAgIGlmICghcmVzdWx0LnBhc3NlZCAmJiByZXN1bHQudmFsaWRhdGlvblR5cGUgPT09ICd0ZXN0LXN1aXRlJykge1xuICAgICAgICBjcml0aWNhbElzc3Vlcy5wdXNoKCdUZXN0IHN1aXRlIGZhaWx1cmVzIGRldGVjdGVkJyk7XG4gICAgICB9XG4gICAgICByZWNvbW1lbmRhdGlvbnMucHVzaCguLi5yZXN1bHQucmVjb21tZW5kYXRpb25zKTtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgdG90YWxWYWxpZGF0aW9ucyxcbiAgICAgIHBhc3NlZFZhbGlkYXRpb25zLFxuICAgICAgZmFpbGVkVmFsaWRhdGlvbnMsXG4gICAgICB3YXJuaW5nc0NvdW50LFxuICAgICAgdG90YWxFeGVjdXRpb25UaW1lLFxuICAgICAgY3JpdGljYWxJc3N1ZXM6IFsuLi5uZXcgU2V0KGNyaXRpY2FsSXNzdWVzKV0sXG4gICAgICByZWNvbW1lbmRhdGlvbnM6IFsuLi5uZXcgU2V0KHJlY29tbWVuZGF0aW9ucyldXG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgc2hvdWxkUmVxdWlyZVJvbGxiYWNrKHZhbGlkYXRpb25SZXN1bHRzOiBWYWxpZGF0aW9uUmVzdWx0W10pOiBib29sZWFuIHtcbiAgICAvLyBSZXF1aXJlIHJvbGxiYWNrIGZvciBjcml0aWNhbCBmYWlsdXJlc1xuICAgIHJldHVybiB2YWxpZGF0aW9uUmVzdWx0cy5zb21lKHJlc3VsdCA9PlxuICAgICAgIXJlc3VsdC5wYXNzZWQgJiYgKFxuICAgICAgICByZXN1bHQudmFsaWRhdGlvblR5cGUgPT09ICd0eXBlc2NyaXB0LWNvbXBpbGF0aW9uJyB8fFxuICAgICAgICAocmVzdWx0LnZhbGlkYXRpb25UeXBlID09PSAndGVzdC1zdWl0ZScgJiYgcmVzdWx0LmVycm9ycy5sZW5ndGggPiAwKSB8fFxuICAgICAgICAocmVzdWx0LnZhbGlkYXRpb25UeXBlID09PSAncmVhY3QtY29tcG9uZW50JyAmJiByZXN1bHQuZXJyb3JzLmxlbmd0aCA+IDApXG4gICAgICApXG4gICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgc3RvcmVWYWxpZGF0aW9uSGlzdG9yeShiYXRjaElkOiBzdHJpbmcsIHZhbGlkYXRpb25SZXN1bHRzOiBWYWxpZGF0aW9uUmVzdWx0W10pOiB2b2lkIHtcbiAgICBjb25zdCBleGlzdGluZyA9IHRoaXMudmFsaWRhdGlvbkhpc3RvcnkuZ2V0KGJhdGNoSWQpIHx8IFtdO1xuICAgIHRoaXMudmFsaWRhdGlvbkhpc3Rvcnkuc2V0KGJhdGNoSWQsIFsuLi5leGlzdGluZywgLi4udmFsaWRhdGlvblJlc3VsdHNdKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdmFsaWRhdGlvbiBoaXN0b3J5IGZvciBhbmFseXNpc1xuICAgKi9cbiAgZ2V0VmFsaWRhdGlvbkhpc3RvcnkoKTogTWFwPHN0cmluZywgVmFsaWRhdGlvblJlc3VsdFtdPiB7XG4gICAgcmV0dXJuIG5ldyBNYXAodGhpcy52YWxpZGF0aW9uSGlzdG9yeSk7XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhdGUgdmFsaWRhdGlvbiByZXBvcnRcbiAgICovXG4gIGdlbmVyYXRlVmFsaWRhdGlvblJlcG9ydChiYXRjaElkPzogc3RyaW5nKTogc3RyaW5nIHtcbiAgICBjb25zdCBoaXN0b3J5ID0gYmF0Y2hJZFxuICAgICAgPyB0aGlzLnZhbGlkYXRpb25IaXN0b3J5LmdldChiYXRjaElkKSB8fCBbXVxuICAgICAgOiBBcnJheS5mcm9tKHRoaXMudmFsaWRhdGlvbkhpc3RvcnkudmFsdWVzKCkpLmZsYXQoKTtcblxuICAgIGlmIChoaXN0b3J5Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuICdObyB2YWxpZGF0aW9uIGhpc3RvcnkgYXZhaWxhYmxlJztcbiAgICB9XG5cbiAgICBjb25zdCByZXBvcnQgPSBbXG4gICAgICAnIyBWYWxpZGF0aW9uIFJlcG9ydCcsXG4gICAgICBgR2VuZXJhdGVkOiAke25ldyBEYXRlKCkudG9JU09TdHJpbmcoKX1gLFxuICAgICAgYmF0Y2hJZCA/IGBCYXRjaCBJRDogJHtiYXRjaElkfWAgOiAnQWxsIEJhdGNoZXMnLFxuICAgICAgJycsXG4gICAgICAnIyMgU3VtbWFyeScsXG4gICAgICBgVG90YWwgVmFsaWRhdGlvbnM6ICR7aGlzdG9yeS5sZW5ndGh9YCxcbiAgICAgIGBQYXNzZWQ6ICR7aGlzdG9yeS5maWx0ZXIociA9PiByLnBhc3NlZCkubGVuZ3RofWAsXG4gICAgICBgRmFpbGVkOiAke2hpc3RvcnkuZmlsdGVyKHIgPT4gIXIucGFzc2VkKS5sZW5ndGh9YCxcbiAgICAgIGBBdmVyYWdlIEV4ZWN1dGlvbiBUaW1lOiAkeyhoaXN0b3J5LnJlZHVjZSgoc3VtLCByKSA9PiBzdW0gKyByLmV4ZWN1dGlvblRpbWUsIDApIC8gaGlzdG9yeS5sZW5ndGgpLnRvRml4ZWQoMil9bXNgLFxuICAgICAgJycsXG4gICAgICAnIyMgVmFsaWRhdGlvbiBSZXN1bHRzJ1xuICAgIF07XG5cbiAgICBmb3IgKGNvbnN0IHJlc3VsdCBvZiBoaXN0b3J5KSB7XG4gICAgICByZXBvcnQucHVzaChgIyMjICR7cmVzdWx0LnZhbGlkYXRpb25UeXBlfSAtICR7cmVzdWx0LnBhc3NlZCA/ICdQQVNTRUQnIDogJ0ZBSUxFRCd9YCk7XG4gICAgICByZXBvcnQucHVzaChgRXhlY3V0aW9uIFRpbWU6ICR7cmVzdWx0LmV4ZWN1dGlvblRpbWV9bXNgKTtcblxuICAgICAgaWYgKHJlc3VsdC5lcnJvcnMubGVuZ3RoID4gMCkge1xuICAgICAgICByZXBvcnQucHVzaCgnKipFcnJvcnM6KionKTtcbiAgICAgICAgcmVzdWx0LmVycm9ycy5mb3JFYWNoKGVycm9yID0+IHJlcG9ydC5wdXNoKGAtICR7ZXJyb3J9YCkpO1xuICAgICAgfVxuXG4gICAgICBpZiAocmVzdWx0Lndhcm5pbmdzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgcmVwb3J0LnB1c2goJyoqV2FybmluZ3M6KionKTtcbiAgICAgICAgcmVzdWx0Lndhcm5pbmdzLmZvckVhY2god2FybmluZyA9PiByZXBvcnQucHVzaChgLSAke3dhcm5pbmd9YCkpO1xuICAgICAgfVxuXG4gICAgICBpZiAocmVzdWx0LnJlY29tbWVuZGF0aW9ucy5sZW5ndGggPiAwKSB7XG4gICAgICAgIHJlcG9ydC5wdXNoKCcqKlJlY29tbWVuZGF0aW9uczoqKicpO1xuICAgICAgICByZXN1bHQucmVjb21tZW5kYXRpb25zLmZvckVhY2gocmVjID0+IHJlcG9ydC5wdXNoKGAtICR7cmVjfWApKTtcbiAgICAgIH1cblxuICAgICAgcmVwb3J0LnB1c2goJycpO1xuICAgIH1cblxuICAgIHJldHVybiByZXBvcnQuam9pbignXFxuJyk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGRlbGF5KG1zOiBudW1iZXIpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIG1zKSk7XG4gIH1cblxuICBwcml2YXRlIGxvZyhsZXZlbDogJ2RlYnVnJyB8ICdpbmZvJyB8ICd3YXJuJyB8ICdlcnJvcicsIG1lc3NhZ2U6IHN0cmluZyk6IHZvaWQge1xuICAgIGNvbnN0IGxldmVscyA9IHsgZGVidWc6IDAsIGluZm86IDEsIHdhcm46IDIsIGVycm9yOiAzIH07XG4gICAgY29uc3QgY29uZmlnTGV2ZWwgPSBsZXZlbHNbdGhpcy5jb25maWcubG9nTGV2ZWxdO1xuICAgIGNvbnN0IG1lc3NhZ2VMZXZlbCA9IGxldmVsc1tsZXZlbF07XG5cbiAgICBpZiAobWVzc2FnZUxldmVsID49IGNvbmZpZ0xldmVsKSB7XG4gICAgICBjb25zdCB0aW1lc3RhbXAgPSBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XG4gICAgICBjb25zdCBwcmVmaXggPSBsZXZlbC50b1VwcGVyQ2FzZSgpLnBhZEVuZCg1KTtcbiAgICAgIGNvbnNvbGUubG9nKGBbJHt0aW1lc3RhbXB9XSAke3ByZWZpeH0gJHttZXNzYWdlfWApO1xuICAgIH1cbiAgfVxufVxuIl0sInZlcnNpb24iOjN9