430c8f52ee1271ac65234828ad8a8cb5
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.ProgressMonitoringSystem = void 0;
const child_process_1 = require("child_process");
const events_1 = require("events");
const fs = __importStar(require("fs"));
const path = __importStar(require("path"));
const AnalysisTools_1 = require("./AnalysisTools");
/**
 * Real-time progress monitoring and alerting system
 * Provides dashboard functionality, safety protocol monitoring, and threshold-based alerts
 */
class ProgressMonitoringSystem extends events_1.EventEmitter {
    analysisTools;
    monitoringInterval = null;
    isMonitoring = false;
    dashboardData = null;
    alertThresholds;
    alertHistory = [];
    buildStabilityHistory = [];
    constructor(alertThresholds) {
        super();
        this.analysisTools = new AnalysisTools_1.AnalysisTools();
        this.alertThresholds = {
            successRateThreshold: 70,
            buildFailureThreshold: 3,
            classificationAccuracyThreshold: 80,
            safetyEventThreshold: 5,
            progressStallThreshold: 24,
            ...alertThresholds
        };
        this.loadAlertHistory();
        this.loadBuildStabilityHistory();
    }
    /**
     * Start real-time progress monitoring
     */
    startMonitoring(intervalMinutes = 5) {
        if (this.isMonitoring) {
            console.log('Progress monitoring is already running');
            return;
        }
        console.log(`Starting progress monitoring with ${intervalMinutes}-minute intervals`);
        this.isMonitoring = true;
        // Initial update
        this.updateDashboard();
        // Set up periodic updates
        this.monitoringInterval = setInterval(async () => {
            try {
                await this.updateDashboard();
                await this.checkAlertConditions();
                await this.monitorBuildStability();
            }
            catch (error) {
                console.error('Error during monitoring update:', error);
                this.emitAlert({
                    type: 'system_error',
                    severity: 'high',
                    message: `Monitoring system error: ${error.message}`,
                    timestamp: new Date(),
                    data: { error: error.message }
                });
            }
        }, intervalMinutes * 60 * 1000);
        this.emit('monitoring_started', { intervalMinutes });
    }
    /**
     * Stop real-time progress monitoring
     */
    stopMonitoring() {
        if (!this.isMonitoring) {
            console.log('Progress monitoring is not running');
            return;
        }
        console.log('Stopping progress monitoring');
        this.isMonitoring = false;
        if (this.monitoringInterval) {
            clearInterval(this.monitoringInterval);
            this.monitoringInterval = null;
        }
        this.emit('monitoring_stopped');
    }
    /**
     * Get current dashboard data
     */
    getDashboardData() {
        return this.dashboardData;
    }
    /**
     * Get real-time progress metrics
     */
    async getProgressMetrics() {
        console.log('Collecting real-time progress metrics...');
        try {
            const currentReport = await this.analysisTools.generateComprehensiveReport();
            const buildStability = await this.getCurrentBuildStability();
            const progress = {
                totalAnyTypes: currentReport.domainDistribution?.totalAnyTypes || 0,
                classifiedIntentional: currentReport.domainDistribution?.intentionalVsUnintentional?.intentional?.count || 0,
                classifiedUnintentional: currentReport.domainDistribution?.intentionalVsUnintentional?.unintentional?.count || 0,
                successfulReplacements: Math.floor((currentReport.summary?.currentSuccessRate || 0) * (currentReport.summary?.totalAnyTypes || 0) / 100),
                documentedIntentional: currentReport.domainDistribution?.intentionalVsUnintentional?.intentional?.count || 0,
                remainingUnintentional: currentReport.domainDistribution?.intentionalVsUnintentional?.unintentional?.count || 0,
                reductionPercentage: this.calculateReductionPercentage(currentReport),
                targetReductionPercentage: 20,
                batchesCompleted: this.getBatchesCompleted(),
                averageSuccessRate: currentReport.summary?.currentSuccessRate || 0,
                // Base ProgressMetrics properties
                errorsFixed: 0,
                warningsFixed: 0,
                filesProcessed: 0,
                buildStable: buildStability.isStable,
                lastUpdate: new Date()
            };
            return progress;
        }
        catch (error) {
            // Return default metrics if analysis fails
            const buildStability = await this.getCurrentBuildStability();
            return {
                totalAnyTypes: 0,
                classifiedIntentional: 0,
                classifiedUnintentional: 0,
                successfulReplacements: 0,
                documentedIntentional: 0,
                remainingUnintentional: 0,
                reductionPercentage: 0,
                targetReductionPercentage: 20,
                batchesCompleted: 0,
                averageSuccessRate: 0,
                errorsFixed: 0,
                warningsFixed: 0,
                filesProcessed: 0,
                buildStable: buildStability.isStable,
                lastUpdate: new Date()
            };
        }
    }
    /**
     * Monitor build stability
     */
    async monitorBuildStability() {
        const stability = await this.getCurrentBuildStability();
        // Add to history
        this.buildStabilityHistory.push(stability);
        // Keep only last 100 records
        if (this.buildStabilityHistory.length > 100) {
            this.buildStabilityHistory = this.buildStabilityHistory.slice(-100);
        }
        // Check for build stability issues
        if (!stability.isStable) {
            this.emitAlert({
                type: 'build_failure',
                severity: 'high',
                message: `Build failure detected: ${stability.errorMessage}`,
                timestamp: new Date(),
                data: {
                    buildTime: stability.buildTime,
                    errorCount: stability.errorCount,
                    errorMessage: stability.errorMessage
                }
            });
        }
        // Check for consecutive build failures
        const recentFailures = this.buildStabilityHistory
            .slice(-this.alertThresholds.buildFailureThreshold)
            .filter(record => !record.isStable);
        if (recentFailures.length >= this.alertThresholds.buildFailureThreshold) {
            this.emitAlert({
                type: 'consecutive_build_failures',
                severity: 'critical',
                message: `${recentFailures.length} consecutive build failures detected`,
                timestamp: new Date(),
                data: {
                    failureCount: recentFailures.length,
                    threshold: this.alertThresholds.buildFailureThreshold
                }
            });
        }
        await this.saveBuildStabilityHistory();
    }
    /**
     * Check alert conditions and emit alerts
     */
    async checkAlertConditions() {
        const progress = await this.getProgressMetrics();
        const currentTime = new Date();
        // Check success rate threshold
        if (progress.averageSuccessRate < this.alertThresholds.successRateThreshold) {
            this.emitAlert({
                type: 'low_success_rate',
                severity: 'medium',
                message: `Success rate (${progress.averageSuccessRate.toFixed(1)}%) below threshold (${this.alertThresholds.successRateThreshold}%)`,
                timestamp: currentTime,
                data: {
                    currentRate: progress.averageSuccessRate,
                    threshold: this.alertThresholds.successRateThreshold
                }
            });
        }
        // Check classification accuracy
        if (this.dashboardData?.accuracyReport.overallAccuracy < this.alertThresholds.classificationAccuracyThreshold) {
            this.emitAlert({
                type: 'low_classification_accuracy',
                severity: 'medium',
                message: `Classification accuracy (${this.dashboardData.accuracyReport.overallAccuracy.toFixed(1)}%) below threshold (${this.alertThresholds.classificationAccuracyThreshold}%)`,
                timestamp: currentTime,
                data: {
                    currentAccuracy: this.dashboardData.accuracyReport.overallAccuracy,
                    threshold: this.alertThresholds.classificationAccuracyThreshold
                }
            });
        }
        // Check for progress stall
        const lastProgressUpdate = this.getLastProgressUpdate();
        if (lastProgressUpdate) {
            const hoursSinceUpdate = (currentTime.getTime() - lastProgressUpdate.getTime()) / (1000 * 60 * 60);
            if (hoursSinceUpdate > this.alertThresholds.progressStallThreshold) {
                this.emitAlert({
                    type: 'progress_stall',
                    severity: 'medium',
                    message: `No progress detected for ${hoursSinceUpdate.toFixed(1)} hours`,
                    timestamp: currentTime,
                    data: {
                        hoursSinceUpdate,
                        threshold: this.alertThresholds.progressStallThreshold,
                        lastUpdate: lastProgressUpdate
                    }
                });
            }
        }
        // Check safety event frequency
        const recentSafetyEvents = this.getRecentSafetyEvents();
        if (recentSafetyEvents.length >= this.alertThresholds.safetyEventThreshold) {
            this.emitAlert({
                type: 'frequent_safety_events',
                severity: 'high',
                message: `${recentSafetyEvents.length} safety events in the last hour`,
                timestamp: currentTime,
                data: {
                    eventCount: recentSafetyEvents.length,
                    threshold: this.alertThresholds.safetyEventThreshold,
                    events: recentSafetyEvents
                }
            });
        }
    }
    /**
     * Handle safety protocol activation
     */
    handleSafetyProtocolActivation(event) {
        console.log(`Safety protocol activated: ${event.type}`);
        this.emitAlert({
            type: 'safety_protocol_activation',
            severity: event.severity === 'critical' ? 'critical' : 'high',
            message: `Safety protocol activated: ${event.description}`,
            timestamp: new Date(),
            data: {
                safetyEvent: event,
                action: event.action,
                affectedFiles: event.affectedFiles || []
            }
        });
        // If it's a critical safety event, consider stopping monitoring temporarily
        if (event.severity === 'critical') {
            this.emit('critical_safety_event', event);
        }
    }
    /**
     * Get alert history
     */
    getAlertHistory(limit) {
        const alerts = [...this.alertHistory].reverse(); // Most recent first
        return limit ? alerts.slice(0, limit) : alerts;
    }
    /**
     * Get build stability history
     */
    getBuildStabilityHistory(limit) {
        const history = [...this.buildStabilityHistory].reverse(); // Most recent first
        return limit ? history.slice(0, limit) : history;
    }
    /**
     * Clear alert history
     */
    clearAlertHistory() {
        this.alertHistory = [];
        this.saveAlertHistory();
        this.emit('alert_history_cleared');
    }
    /**
     * Update alert thresholds
     */
    updateAlertThresholds(newThresholds) {
        this.alertThresholds = { ...this.alertThresholds, ...newThresholds };
        this.emit('alert_thresholds_updated', this.alertThresholds);
    }
    /**
     * Get current alert thresholds
     */
    getAlertThresholds() {
        return { ...this.alertThresholds };
    }
    // Private methods
    async updateDashboard() {
        try {
            console.log('Updating dashboard data...');
            const [analysisReport, progressMetrics, buildStability] = await Promise.all([
                this.analysisTools.generateComprehensiveReport(),
                this.getProgressMetrics(),
                this.getCurrentBuildStability()
            ]);
            this.dashboardData = {
                lastUpdate: new Date(),
                analysisReport,
                progressMetrics,
                buildStability,
                alertSummary: {
                    totalAlerts: this.alertHistory.length,
                    criticalAlerts: this.alertHistory.filter(a => a.severity === 'critical').length,
                    highAlerts: this.alertHistory.filter(a => a.severity === 'high').length,
                    mediumAlerts: this.alertHistory.filter(a => a.severity === 'medium').length,
                    lowAlerts: this.alertHistory.filter(a => a.severity === 'low').length,
                    recentAlerts: this.getRecentAlerts(24) // Last 24 hours
                },
                trendingData: this.calculateTrendingData(),
                systemHealth: this.calculateSystemHealth()
            };
            this.emit('dashboard_updated', this.dashboardData);
        }
        catch (error) {
            console.error('Error updating dashboard:', error);
            throw error;
        }
    }
    async getCurrentBuildStability() {
        const startTime = Date.now();
        try {
            // Run TypeScript compilation check
            (0, child_process_1.execSync)('yarn tsc --noEmit --skipLibCheck', {
                stdio: 'pipe',
                timeout: 30000 // 30 second timeout
            });
            const buildTime = Date.now() - startTime;
            return {
                timestamp: new Date(),
                isStable: true,
                buildTime,
                errorCount: 0,
                errorMessage: null
            };
        }
        catch (error) {
            const buildTime = Date.now() - startTime;
            const errorOutput = error.stdout?.toString() || error.stderr?.toString() || error.message;
            const errorCount = this.countTypeScriptErrors(errorOutput);
            return {
                timestamp: new Date(),
                isStable: false,
                buildTime,
                errorCount,
                errorMessage: errorOutput.substring(0, 500) // Limit error message length
            };
        }
    }
    countTypeScriptErrors(output) {
        const errorMatches = output.match(/error TS\d+:/g);
        return errorMatches ? errorMatches.length : 0;
    }
    calculateReductionPercentage(report) {
        if (!report || !report.domainDistribution)
            return 0;
        // Calculate reduction from baseline (would need historical baseline data)
        // For now, use a simple calculation based on intentional vs unintentional ratio
        const total = report.domainDistribution.totalAnyTypes;
        const unintentional = report.domainDistribution.intentionalVsUnintentional?.unintentional?.count || 0;
        if (total === 0)
            return 0;
        // Assume baseline was 100% unintentional, calculate current reduction
        const currentUnintentionalPercentage = (unintentional / total) * 100;
        return Math.max(0, 100 - currentUnintentionalPercentage);
    }
    getBatchesCompleted() {
        // This would be tracked in actual implementation
        // For now, return a simulated value
        return Math.floor(Math.random() * 50) + 10;
    }
    emitAlert(alert) {
        // Check if this is a duplicate alert (same type within last hour)
        const oneHourAgo = new Date(Date.now() - 60 * 60 * 1000);
        const recentSimilarAlerts = this.alertHistory.filter(a => a.type === alert.type && a.timestamp > oneHourAgo);
        // Only emit if no similar alert in the last hour
        if (recentSimilarAlerts.length === 0) {
            this.alertHistory.push(alert);
            // Keep only last 1000 alerts
            if (this.alertHistory.length > 1000) {
                this.alertHistory = this.alertHistory.slice(-1000);
            }
            this.saveAlertHistory();
            this.emit('alert', alert);
            console.log(`Alert emitted: ${alert.type} (${alert.severity}) - ${alert.message}`);
        }
    }
    getLastProgressUpdate() {
        // This would track actual progress updates in real implementation
        // For now, return a simulated recent update
        return new Date(Date.now() - Math.random() * 2 * 60 * 60 * 1000); // Random time within last 2 hours
    }
    getRecentSafetyEvents() {
        // This would track actual safety events in real implementation
        // For now, return empty array
        return [];
    }
    getRecentAlerts(hours) {
        const cutoffTime = new Date(Date.now() - hours * 60 * 60 * 1000);
        return this.alertHistory.filter(alert => alert.timestamp > cutoffTime);
    }
    calculateTrendingData() {
        // This would calculate actual trending data from historical reports
        // For now, return simulated trending data
        const trends = [];
        const now = new Date();
        for (let i = 7; i >= 0; i--) {
            const date = new Date(now.getTime() - i * 24 * 60 * 60 * 1000);
            trends.push({
                date,
                successRate: 75 + Math.random() * 15,
                totalAnyTypes: 1800 - i * 20 + Math.random() * 10,
                unintentionalCount: 1200 - i * 15 + Math.random() * 8,
                classificationAccuracy: 80 + Math.random() * 15 // 80-95%
            });
        }
        return trends;
    }
    calculateSystemHealth() {
        const recentAlerts = this.getRecentAlerts(24);
        const criticalAlerts = recentAlerts.filter(a => a.severity === 'critical').length;
        const highAlerts = recentAlerts.filter(a => a.severity === 'high').length;
        let healthScore = 100;
        healthScore -= criticalAlerts * 20;
        healthScore -= highAlerts * 10;
        healthScore -= recentAlerts.length * 2;
        healthScore = Math.max(0, Math.min(100, healthScore));
        let status;
        if (healthScore >= 80)
            status = 'healthy';
        else if (healthScore >= 60)
            status = 'warning';
        else
            status = 'critical';
        return {
            score: healthScore,
            status,
            lastCheck: new Date(),
            issues: recentAlerts.filter(a => a.severity === 'critical' || a.severity === 'high').map(a => a.message)
        };
    }
    loadAlertHistory() {
        try {
            const historyPath = path.join(process.cwd(), '.kiro', 'campaign-reports', 'alert-history.json');
            if (fs.existsSync(historyPath)) {
                const historyData = fs.readFileSync(historyPath, 'utf8');
                this.alertHistory = JSON.parse(historyData).map((alert) => ({
                    ...alert,
                    timestamp: new Date(alert.timestamp)
                }));
            }
        }
        catch (error) {
            console.warn('Could not load alert history:', error);
            this.alertHistory = [];
        }
    }
    saveAlertHistory() {
        try {
            const historyDir = path.join(process.cwd(), '.kiro', 'campaign-reports');
            if (!fs.existsSync(historyDir)) {
                fs.mkdirSync(historyDir, { recursive: true });
            }
            const historyPath = path.join(historyDir, 'alert-history.json');
            fs.writeFileSync(historyPath, JSON.stringify(this.alertHistory, null, 2));
        }
        catch (error) {
            console.warn('Could not save alert history:', error);
        }
    }
    loadBuildStabilityHistory() {
        try {
            const historyPath = path.join(process.cwd(), '.kiro', 'campaign-reports', 'build-stability-history.json');
            if (fs.existsSync(historyPath)) {
                const historyData = fs.readFileSync(historyPath, 'utf8');
                this.buildStabilityHistory = JSON.parse(historyData).map((record) => ({
                    ...record,
                    timestamp: new Date(record.timestamp)
                }));
            }
        }
        catch (error) {
            console.warn('Could not load build stability history:', error);
            this.buildStabilityHistory = [];
        }
    }
    async saveBuildStabilityHistory() {
        try {
            const historyDir = path.join(process.cwd(), '.kiro', 'campaign-reports');
            if (!fs.existsSync(historyDir)) {
                fs.mkdirSync(historyDir, { recursive: true });
            }
            const historyPath = path.join(historyDir, 'build-stability-history.json');
            fs.writeFileSync(historyPath, JSON.stringify(this.buildStabilityHistory, null, 2));
        }
        catch (error) {
            console.warn('Could not save build stability history:', error);
        }
    }
}
exports.ProgressMonitoringSystem = ProgressMonitoringSystem;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L2JhY2t1cHMvZmlyc3Qtd2F2ZS0yMDI1LTA4LTExVDA1LTE5LTI2LTgxM1ovc3JjL3NlcnZpY2VzL2NhbXBhaWduL3VuaW50ZW50aW9uYWwtYW55LWVsaW1pbmF0aW9uL1Byb2dyZXNzTW9uaXRvcmluZ1N5c3RlbS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLGlEQUF5QztBQUN6QyxtQ0FBc0M7QUFDdEMsdUNBQXlCO0FBQ3pCLDJDQUE2QjtBQUM3QixtREFBZ0Q7QUFPaEQ7OztHQUdHO0FBQ0gsTUFBYSx3QkFBeUIsU0FBUSxxQkFBWTtJQUNoRCxhQUFhLENBQWdCO0lBQzdCLGtCQUFrQixHQUEwQixJQUFJLENBQUM7SUFDakQsWUFBWSxHQUFHLEtBQUssQ0FBQztJQUNyQixhQUFhLEdBQXlCLElBQUksQ0FBQztJQUMzQyxlQUFlLENBQWtCO0lBQ2pDLFlBQVksR0FBWSxFQUFFLENBQUM7SUFDM0IscUJBQXFCLEdBQTJCLEVBQUUsQ0FBQztJQUUzRCxZQUFZLGVBQTBDO1FBQ3BELEtBQUssRUFBRSxDQUFDO1FBQ1IsSUFBSSxDQUFDLGFBQWEsR0FBRyxJQUFJLDZCQUFhLEVBQUUsQ0FBQztRQUN6QyxJQUFJLENBQUMsZUFBZSxHQUFHO1lBQ3JCLG9CQUFvQixFQUFFLEVBQUU7WUFDeEIscUJBQXFCLEVBQUUsQ0FBQztZQUN4QiwrQkFBK0IsRUFBRSxFQUFFO1lBQ25DLG9CQUFvQixFQUFFLENBQUM7WUFDdkIsc0JBQXNCLEVBQUUsRUFBRTtZQUMxQixHQUFHLGVBQWU7U0FDbkIsQ0FBQztRQUVGLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO1FBQ3hCLElBQUksQ0FBQyx5QkFBeUIsRUFBRSxDQUFDO0lBQ25DLENBQUM7SUFFRDs7T0FFRztJQUNILGVBQWUsQ0FBQyxrQkFBMEIsQ0FBQztRQUN6QyxJQUFJLElBQUksQ0FBQyxZQUFZLEVBQUU7WUFDckIsT0FBTyxDQUFD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LENBQUMsQ0FBQzthQUNMO1NBQ0Y7UUFBQyxPQUFPLEtBQUssRUFBRTtZQUNkLE9BQU8sQ0FBQyxJQUFJLENBQUMseUNBQXlDLEVBQUUsS0FBSyxDQUFDLENBQUM7WUFDL0QsSUFBSSxDQUFDLHFCQUFxQixHQUFHLEVBQUUsQ0FBQztTQUNqQztJQUNILENBQUM7SUFFTyxLQUFLLENBQUMseUJBQXlCO1FBQ3JDLElBQUk7WUFDRixNQUFNLFVBQVUsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUUsRUFBRSxPQUFPLEVBQUUsa0JBQWtCLENBQUMsQ0FBQztZQUN6RSxJQUFJLENBQUMsRUFBRSxDQUFDLFVBQVUsQ0FBQyxVQUFVLENBQUMsRUFBRTtnQkFDOUIsRUFBRSxDQUFDLFNBQVMsQ0FBQyxVQUFVLEVBQUUsRUFBRSxTQUFTLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQzthQUMvQztZQUVELE1BQU0sV0FBVyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFLDhCQUE4QixDQUFDLENBQUM7WUFDMUUsRUFBRSxDQUFDLGFBQWEsQ0FBQyxXQUFXLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMscUJBQXFCLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDcEY7UUFBQyxPQUFPLEtBQUssRUFBRTtZQUNkLE9BQU8sQ0FBQyxJQUFJLENBQUMseUNBQXlDLEVBQUUsS0FBSyxDQUFDLENBQUM7U0FDaEU7SUFDSCxDQUFDO0NBQ0Y7QUE1akJELDREQTRqQkMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L2JhY2t1cHMvZmlyc3Qtd2F2ZS0yMDI1LTA4LTExVDA1LTE5LTI2LTgxM1ovc3JjL3NlcnZpY2VzL2NhbXBhaWduL3VuaW50ZW50aW9uYWwtYW55LWVsaW1pbmF0aW9uL1Byb2dyZXNzTW9uaXRvcmluZ1N5c3RlbS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBleGVjU3luYyB9IGZyb20gJ2NoaWxkX3Byb2Nlc3MnO1xuaW1wb3J0IHsgRXZlbnRFbWl0dGVyIH0gZnJvbSAnZXZlbnRzJztcbmltcG9ydCAqIGFzIGZzIGZyb20gJ2ZzJztcbmltcG9ydCAqIGFzIHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgeyBBbmFseXNpc1Rvb2xzIH0gZnJvbSAnLi9BbmFseXNpc1Rvb2xzJztcbmltcG9ydCB7XG4gICAgQW5hbHlzaXNSZXBvcnQsXG4gICAgVHJlbmRpbmdEYXRhLFxuICAgIFVuaW50ZW50aW9uYWxBbnlQcm9ncmVzc1xufSBmcm9tICcuL3R5cGVzJztcblxuLyoqXG4gKiBSZWFsLXRpbWUgcHJvZ3Jlc3MgbW9uaXRvcmluZyBhbmQgYWxlcnRpbmcgc3lzdGVtXG4gKiBQcm92aWRlcyBkYXNoYm9hcmQgZnVuY3Rpb25hbGl0eSwgc2FmZXR5IHByb3RvY29sIG1vbml0b3JpbmcsIGFuZCB0aHJlc2hvbGQtYmFzZWQgYWxlcnRzXG4gKi9cbmV4cG9ydCBjbGFzcyBQcm9ncmVzc01vbml0b3JpbmdTeXN0ZW0gZXh0ZW5kcyBFdmVudEVtaXR0ZXIge1xuICBwcml2YXRlIGFuYWx5c2lzVG9vbHM6IEFuYWx5c2lzVG9vbHM7XG4gIHByaXZhdGUgbW9uaXRvcmluZ0ludGVydmFsOiBOb2RlSlMuVGltZW91dCB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIGlzTW9uaXRvcmluZyA9IGZhbHNlO1xuICBwcml2YXRlIGRhc2hib2FyZERhdGE6IERhc2hib2FyZERhdGEgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSBhbGVydFRocmVzaG9sZHM6IEFsZXJ0VGhyZXNob2xkcztcbiAgcHJpdmF0ZSBhbGVydEhpc3Rvcnk6IEFsZXJ0W10gPSBbXTtcbiAgcHJpdmF0ZSBidWlsZFN0YWJpbGl0eUhpc3Rvcnk6IEJ1aWxkU3RhYmlsaXR5UmVjb3JkW10gPSBbXTtcblxuICBjb25zdHJ1Y3RvcihhbGVydFRocmVzaG9sZHM/OiBQYXJ0aWFsPEFsZXJ0VGhyZXNob2xkcz4pIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMuYW5hbHlzaXNUb29scyA9IG5ldyBBbmFseXNpc1Rvb2xzKCk7XG4gICAgdGhpcy5hbGVydFRocmVzaG9sZHMgPSB7XG4gICAgICBzdWNjZXNzUmF0ZVRocmVzaG9sZDogNzAsXG4gICAgICBidWlsZEZhaWx1cmVUaHJlc2hvbGQ6IDMsXG4gICAgICBjbGFzc2lmaWNhdGlvbkFjY3VyYWN5VGhyZXNob2xkOiA4MCxcbiAgICAgIHNhZmV0eUV2ZW50VGhyZXNob2xkOiA1LFxuICAgICAgcHJvZ3Jlc3NTdGFsbFRocmVzaG9sZDogMjQsIC8vIGhvdXJzXG4gICAgICAuLi5hbGVydFRocmVzaG9sZHNcbiAgICB9O1xuXG4gICAgdGhpcy5sb2FkQWxlcnRIaXN0b3J5KCk7XG4gICAgdGhpcy5sb2FkQnVpbGRTdGFiaWxpdHlIaXN0b3J5KCk7XG4gIH1cblxuICAvKipcbiAgICogU3RhcnQgcmVhbC10aW1lIHByb2dyZXNzIG1vbml0b3JpbmdcbiAgICovXG4gIHN0YXJ0TW9uaXRvcmluZyhpbnRlcnZhbE1pbnV0ZXM6IG51bWJlciA9IDUpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5pc01vbml0b3JpbmcpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdQcm9ncmVzcyBtb25pdG9yaW5nIGlzIGFscmVhZHkgcnVubmluZycpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnNvbGUubG9nKGBTdGFydGluZyBwcm9ncmVzcyBtb25pdG9yaW5nIHdpdGggJHtpbnRlcnZhbE1pbnV0ZXN9LW1pbnV0ZSBpbnRlcnZhbHNgKTtcbiAgICB0aGlzLmlzTW9uaXRvcmluZyA9IHRydWU7XG5cbiAgICAvLyBJbml0aWFsIHVwZGF0ZVxuICAgIHRoaXMudXBkYXRlRGFzaGJvYXJkKCk7XG5cbiAgICAvLyBTZXQgdXAgcGVyaW9kaWMgdXBkYXRlc1xuICAgIHRoaXMubW9uaXRvcmluZ0ludGVydmFsID0gc2V0SW50ZXJ2YWwoYXN5bmMgKCkgPT4ge1xuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgdGhpcy51cGRhdGVEYXNoYm9hcmQoKTtcbiAgICAgICAgYXdhaXQgdGhpcy5jaGVja0FsZXJ0Q29uZGl0aW9ucygpO1xuICAgICAgICBhd2FpdCB0aGlzLm1vbml0b3JCdWlsZFN0YWJpbGl0eSgpO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZHVyaW5nIG1vbml0b3JpbmcgdXBkYXRlOicsIGVycm9yKTtcbiAgICAgICAgdGhpcy5lbWl0QWxlcnQoe1xuICAgICAgICAgIHR5cGU6ICdzeXN0ZW1fZXJyb3InLFxuICAgICAgICAgIHNldmVyaXR5OiAnaGlnaCcsXG4gICAgICAgICAgbWVzc2FnZTogYE1vbml0b3Jpbmcgc3lzdGVtIGVycm9yOiAke2Vycm9yLm1lc3NhZ2V9YCxcbiAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAgICAgICAgZGF0YTogeyBlcnJvcjogZXJyb3IubWVzc2FnZSB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0sIGludGVydmFsTWludXRlcyAqIDYwICogMTAwMCk7XG5cbiAgICB0aGlzLmVtaXQoJ21vbml0b3Jpbmdfc3RhcnRlZCcsIHsgaW50ZXJ2YWxNaW51dGVzIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFN0b3AgcmVhbC10aW1lIHByb2dyZXNzIG1vbml0b3JpbmdcbiAgICovXG4gIHN0b3BNb25pdG9yaW5nKCk6IHZvaWQge1xuICAgIGlmICghdGhpcy5pc01vbml0b3JpbmcpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdQcm9ncmVzcyBtb25pdG9yaW5nIGlzIG5vdCBydW5uaW5nJyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc29sZS5sb2coJ1N0b3BwaW5nIHByb2dyZXNzIG1vbml0b3JpbmcnKTtcbiAgICB0aGlzLmlzTW9uaXRvcmluZyA9IGZhbHNlO1xuXG4gICAgaWYgKHRoaXMubW9uaXRvcmluZ0ludGVydmFsKSB7XG4gICAgICBjbGVhckludGVydmFsKHRoaXMubW9uaXRvcmluZ0ludGVydmFsKTtcbiAgICAgIHRoaXMubW9uaXRvcmluZ0ludGVydmFsID0gbnVsbDtcbiAgICB9XG5cbiAgICB0aGlzLmVtaXQoJ21vbml0b3Jpbmdfc3RvcHBlZCcpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBjdXJyZW50IGRhc2hib2FyZCBkYXRhXG4gICAqL1xuICBnZXREYXNoYm9hcmREYXRhKCk6IERhc2hib2FyZERhdGEgfCBudWxsIHtcbiAgICByZXR1cm4gdGhpcy5kYXNoYm9hcmREYXRhO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCByZWFsLXRpbWUgcHJvZ3Jlc3MgbWV0cmljc1xuICAgKi9cbiAgYXN5bmMgZ2V0UHJvZ3Jlc3NNZXRyaWNzKCk6IFByb21pc2U8VW5pbnRlbnRpb25hbEFueVByb2dyZXNzPiB7XG4gICAgY29uc29sZS5sb2coJ0NvbGxlY3RpbmcgcmVhbC10aW1lIHByb2dyZXNzIG1ldHJpY3MuLi4nKTtcblxuICAgIHRyeSB7XG4gICAgICBjb25zdCBjdXJyZW50UmVwb3J0ID0gYXdhaXQgdGhpcy5hbmFseXNpc1Rvb2xzLmdlbmVyYXRlQ29tcHJlaGVuc2l2ZVJlcG9ydCgpO1xuICAgICAgY29uc3QgYnVpbGRTdGFiaWxpdHkgPSBhd2FpdCB0aGlzLmdldEN1cnJlbnRCdWlsZFN0YWJpbGl0eSgpO1xuXG4gICAgICBjb25zdCBwcm9ncmVzczogVW5pbnRlbnRpb25hbEFueVByb2dyZXNzID0ge1xuICAgICAgICB0b3RhbEFueVR5cGVzOiBjdXJyZW50UmVwb3J0LmRvbWFpbkRpc3RyaWJ1dGlvbj8udG90YWxBbnlUeXBlcyB8fCAwLFxuICAgICAgICBjbGFzc2lmaWVkSW50ZW50aW9uYWw6IGN1cnJlbnRSZXBvcnQuZG9tYWluRGlzdHJpYnV0aW9uPy5pbnRlbnRpb25hbFZzVW5pbnRlbnRpb25hbD8uaW50ZW50aW9uYWw/LmNvdW50IHx8IDAsXG4gICAgICAgIGNsYXNzaWZpZWRVbmludGVudGlvbmFsOiBjdXJyZW50UmVwb3J0LmRvbWFpbkRpc3RyaWJ1dGlvbj8uaW50ZW50aW9uYWxWc1VuaW50ZW50aW9uYWw/LnVuaW50ZW50aW9uYWw/LmNvdW50IHx8IDAsXG4gICAgICAgIHN1Y2Nlc3NmdWxSZXBsYWNlbWVudHM6IE1hdGguZmxvb3IoKGN1cnJlbnRSZXBvcnQuc3VtbWFyeT8uY3VycmVudFN1Y2Nlc3NSYXRlIHx8IDApICogKGN1cnJlbnRSZXBvcnQuc3VtbWFyeT8udG90YWxBbnlUeXBlcyB8fCAwKSAvIDEwMCksXG4gICAgICAgIGRvY3VtZW50ZWRJbnRlbnRpb25hbDogY3VycmVudFJlcG9ydC5kb21haW5EaXN0cmlidXRpb24/LmludGVudGlvbmFsVnNVbmludGVudGlvbmFsPy5pbnRlbnRpb25hbD8uY291bnQgfHwgMCxcbiAgICAgICAgcmVtYWluaW5nVW5pbnRlbnRpb25hbDogY3VycmVudFJlcG9ydC5kb21haW5EaXN0cmlidXRpb24/LmludGVudGlvbmFsVnNVbmludGVudGlvbmFsPy51bmludGVudGlvbmFsPy5jb3VudCB8fCAwLFxuICAgICAgICByZWR1Y3Rpb25QZXJjZW50YWdlOiB0aGlzLmNhbGN1bGF0ZVJlZHVjdGlvblBlcmNlbnRhZ2UoY3VycmVudFJlcG9ydCksXG4gICAgICAgIHRhcmdldFJlZHVjdGlvblBlcmNlbnRhZ2U6IDIwLCAvLyBUYXJnZXQgMjAlIHJlZHVjdGlvblxuICAgICAgICBiYXRjaGVzQ29tcGxldGVkOiB0aGlzLmdldEJhdGNoZXNDb21wbGV0ZWQoKSxcbiAgICAgICAgYXZlcmFnZVN1Y2Nlc3NSYXRlOiBjdXJyZW50UmVwb3J0LnN1bW1hcnk/LmN1cnJlbnRTdWNjZXNzUmF0ZSB8fCAwLFxuXG4gICAgICAgIC8vIEJhc2UgUHJvZ3Jlc3NNZXRyaWNzIHByb3BlcnRpZXNcbiAgICAgICAgZXJyb3JzRml4ZWQ6IDAsXG4gICAgICAgIHdhcm5pbmdzRml4ZWQ6IDAsXG4gICAgICAgIGZpbGVzUHJvY2Vzc2VkOiAwLFxuICAgICAgICBidWlsZFN0YWJsZTogYnVpbGRTdGFiaWxpdHkuaXNTdGFibGUsXG4gICAgICAgIGxhc3RVcGRhdGU6IG5ldyBEYXRlKClcbiAgICAgIH07XG5cbiAgICAgIHJldHVybiBwcm9ncmVzcztcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgLy8gUmV0dXJuIGRlZmF1bHQgbWV0cmljcyBpZiBhbmFseXNpcyBmYWlsc1xuICAgICAgY29uc3QgYnVpbGRTdGFiaWxpdHkgPSBhd2FpdCB0aGlzLmdldEN1cnJlbnRCdWlsZFN0YWJpbGl0eSgpO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICB0b3RhbEFueVR5cGVzOiAwLFxuICAgICAgICBjbGFzc2lmaWVkSW50ZW50aW9uYWw6IDAsXG4gICAgICAgIGNsYXNzaWZpZWRVbmludGVudGlvbmFsOiAwLFxuICAgICAgICBzdWNjZXNzZnVsUmVwbGFjZW1lbnRzOiAwLFxuICAgICAgICBkb2N1bWVudGVkSW50ZW50aW9uYWw6IDAsXG4gICAgICAgIHJlbWFpbmluZ1VuaW50ZW50aW9uYWw6IDAsXG4gICAgICAgIHJlZHVjdGlvblBlcmNlbnRhZ2U6IDAsXG4gICAgICAgIHRhcmdldFJlZHVjdGlvblBlcmNlbnRhZ2U6IDIwLFxuICAgICAgICBiYXRjaGVzQ29tcGxldGVkOiAwLFxuICAgICAgICBhdmVyYWdlU3VjY2Vzc1JhdGU6IDAsXG4gICAgICAgIGVycm9yc0ZpeGVkOiAwLFxuICAgICAgICB3YXJuaW5nc0ZpeGVkOiAwLFxuICAgICAgICBmaWxlc1Byb2Nlc3NlZDogMCxcbiAgICAgICAgYnVpbGRTdGFibGU6IGJ1aWxkU3RhYmlsaXR5LmlzU3RhYmxlLFxuICAgICAgICBsYXN0VXBkYXRlOiBuZXcgRGF0ZSgpXG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBNb25pdG9yIGJ1aWxkIHN0YWJpbGl0eVxuICAgKi9cbiAgYXN5bmMgbW9uaXRvckJ1aWxkU3RhYmlsaXR5KCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IHN0YWJpbGl0eSA9IGF3YWl0IHRoaXMuZ2V0Q3VycmVudEJ1aWxkU3RhYmlsaXR5KCk7XG5cbiAgICAvLyBBZGQgdG8gaGlzdG9yeVxuICAgIHRoaXMuYnVpbGRTdGFiaWxpdHlIaXN0b3J5LnB1c2goc3RhYmlsaXR5KTtcblxuICAgIC8vIEtlZXAgb25seSBsYXN0IDEwMCByZWNvcmRzXG4gICAgaWYgKHRoaXMuYnVpbGRTdGFiaWxpdHlIaXN0b3J5Lmxlbmd0aCA+IDEwMCkge1xuICAgICAgdGhpcy5idWlsZFN0YWJpbGl0eUhpc3RvcnkgPSB0aGlzLmJ1aWxkU3RhYmlsaXR5SGlzdG9yeS5zbGljZSgtMTAwKTtcbiAgICB9XG5cbiAgICAvLyBDaGVjayBmb3IgYnVpbGQgc3RhYmlsaXR5IGlzc3Vlc1xuICAgIGlmICghc3RhYmlsaXR5LmlzU3RhYmxlKSB7XG4gICAgICB0aGlzLmVtaXRBbGVydCh7XG4gICAgICAgIHR5cGU6ICdidWlsZF9mYWlsdXJlJyxcbiAgICAgICAgc2V2ZXJpdHk6ICdoaWdoJyxcbiAgICAgICAgbWVzc2FnZTogYEJ1aWxkIGZhaWx1cmUgZGV0ZWN0ZWQ6ICR7c3RhYmlsaXR5LmVycm9yTWVzc2FnZX1gLFxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBidWlsZFRpbWU6IHN0YWJpbGl0eS5idWlsZFRpbWUsXG4gICAgICAgICAgZXJyb3JDb3VudDogc3RhYmlsaXR5LmVycm9yQ291bnQsXG4gICAgICAgICAgZXJyb3JNZXNzYWdlOiBzdGFiaWxpdHkuZXJyb3JNZXNzYWdlXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIENoZWNrIGZvciBjb25zZWN1dGl2ZSBidWlsZCBmYWlsdXJlc1xuICAgIGNvbnN0IHJlY2VudEZhaWx1cmVzID0gdGhpcy5idWlsZFN0YWJpbGl0eUhpc3RvcnlcbiAgICAgIC5zbGljZSgtdGhpcy5hbGVydFRocmVzaG9sZHMuYnVpbGRGYWlsdXJlVGhyZXNob2xkKVxuICAgICAgLmZpbHRlcihyZWNvcmQgPT4gIXJlY29yZC5pc1N0YWJsZSk7XG5cbiAgICBpZiAocmVjZW50RmFpbHVyZXMubGVuZ3RoID49IHRoaXMuYWxlcnRUaHJlc2hvbGRzLmJ1aWxkRmFpbHVyZVRocmVzaG9sZCkge1xuICAgICAgdGhpcy5lbWl0QWxlcnQoe1xuICAgICAgICB0eXBlOiAnY29uc2VjdXRpdmVfYnVpbGRfZmFpbHVyZXMnLFxuICAgICAgICBzZXZlcml0eTogJ2NyaXRpY2FsJyxcbiAgICAgICAgbWVzc2FnZTogYCR7cmVjZW50RmFpbHVyZXMubGVuZ3RofSBjb25zZWN1dGl2ZSBidWlsZCBmYWlsdXJlcyBkZXRlY3RlZGAsXG4gICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGZhaWx1cmVDb3VudDogcmVjZW50RmFpbHVyZXMubGVuZ3RoLFxuICAgICAgICAgIHRocmVzaG9sZDogdGhpcy5hbGVydFRocmVzaG9sZHMuYnVpbGRGYWlsdXJlVGhyZXNob2xkXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGF3YWl0IHRoaXMuc2F2ZUJ1aWxkU3RhYmlsaXR5SGlzdG9yeSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrIGFsZXJ0IGNvbmRpdGlvbnMgYW5kIGVtaXQgYWxlcnRzXG4gICAqL1xuICBhc3luYyBjaGVja0FsZXJ0Q29uZGl0aW9ucygpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBwcm9ncmVzcyA9IGF3YWl0IHRoaXMuZ2V0UHJvZ3Jlc3NNZXRyaWNzKCk7XG4gICAgY29uc3QgY3VycmVudFRpbWUgPSBuZXcgRGF0ZSgpO1xuXG4gICAgLy8gQ2hlY2sgc3VjY2VzcyByYXRlIHRocmVzaG9sZFxuICAgIGlmIChwcm9ncmVzcy5hdmVyYWdlU3VjY2Vzc1JhdGUgPCB0aGlzLmFsZXJ0VGhyZXNob2xkcy5zdWNjZXNzUmF0ZVRocmVzaG9sZCkge1xuICAgICAgdGhpcy5lbWl0QWxlcnQoe1xuICAgICAgICB0eXBlOiAnbG93X3N1Y2Nlc3NfcmF0ZScsXG4gICAgICAgIHNldmVyaXR5OiAnbWVkaXVtJyxcbiAgICAgICAgbWVzc2FnZTogYFN1Y2Nlc3MgcmF0ZSAoJHtwcm9ncmVzcy5hdmVyYWdlU3VjY2Vzc1JhdGUudG9GaXhlZCgxKX0lKSBiZWxvdyB0aHJlc2hvbGQgKCR7dGhpcy5hbGVydFRocmVzaG9sZHMuc3VjY2Vzc1JhdGVUaHJlc2hvbGR9JSlgLFxuICAgICAgICB0aW1lc3RhbXA6IGN1cnJlbnRUaW1lLFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgY3VycmVudFJhdGU6IHByb2dyZXNzLmF2ZXJhZ2VTdWNjZXNzUmF0ZSxcbiAgICAgICAgICB0aHJlc2hvbGQ6IHRoaXMuYWxlcnRUaHJlc2hvbGRzLnN1Y2Nlc3NSYXRlVGhyZXNob2xkXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIENoZWNrIGNsYXNzaWZpY2F0aW9uIGFjY3VyYWN5XG4gICAgaWYgKHRoaXMuZGFzaGJvYXJkRGF0YT8uYWNjdXJhY3lSZXBvcnQub3ZlcmFsbEFjY3VyYWN5IDwgdGhpcy5hbGVydFRocmVzaG9sZHMuY2xhc3NpZmljYXRpb25BY2N1cmFjeVRocmVzaG9sZCkge1xuICAgICAgdGhpcy5lbWl0QWxlcnQoe1xuICAgICAgICB0eXBlOiAnbG93X2NsYXNzaWZpY2F0aW9uX2FjY3VyYWN5JyxcbiAgICAgICAgc2V2ZXJpdHk6ICdtZWRpdW0nLFxuICAgICAgICBtZXNzYWdlOiBgQ2xhc3NpZmljYXRpb24gYWNjdXJhY3kgKCR7dGhpcy5kYXNoYm9hcmREYXRhLmFjY3VyYWN5UmVwb3J0Lm92ZXJhbGxBY2N1cmFjeS50b0ZpeGVkKDEpfSUpIGJlbG93IHRocmVzaG9sZCAoJHt0aGlzLmFsZXJ0VGhyZXNob2xkcy5jbGFzc2lmaWNhdGlvbkFjY3VyYWN5VGhyZXNob2xkfSUpYCxcbiAgICAgICAgdGltZXN0YW1wOiBjdXJyZW50VGltZSxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGN1cnJlbnRBY2N1cmFjeTogdGhpcy5kYXNoYm9hcmREYXRhLmFjY3VyYWN5UmVwb3J0Lm92ZXJhbGxBY2N1cmFjeSxcbiAgICAgICAgICB0aHJlc2hvbGQ6IHRoaXMuYWxlcnRUaHJlc2hvbGRzLmNsYXNzaWZpY2F0aW9uQWNjdXJhY3lUaHJlc2hvbGRcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgZm9yIHByb2dyZXNzIHN0YWxsXG4gICAgY29uc3QgbGFzdFByb2dyZXNzVXBkYXRlID0gdGhpcy5nZXRMYXN0UHJvZ3Jlc3NVcGRhdGUoKTtcbiAgICBpZiAobGFzdFByb2dyZXNzVXBkYXRlKSB7XG4gICAgICBjb25zdCBob3Vyc1NpbmNlVXBkYXRlID0gKGN1cnJlbnRUaW1lLmdldFRpbWUoKSAtIGxhc3RQcm9ncmVzc1VwZGF0ZS5nZXRUaW1lKCkpIC8gKDEwMDAgKiA2MCAqIDYwKTtcbiAgICAgIGlmIChob3Vyc1NpbmNlVXBkYXRlID4gdGhpcy5hbGVydFRocmVzaG9sZHMucHJvZ3Jlc3NTdGFsbFRocmVzaG9sZCkge1xuICAgICAgICB0aGlzLmVtaXRBbGVydCh7XG4gICAgICAgICAgdHlwZTogJ3Byb2dyZXNzX3N0YWxsJyxcbiAgICAgICAgICBzZXZlcml0eTogJ21lZGl1bScsXG4gICAgICAgICAgbWVzc2FnZTogYE5vIHByb2dyZXNzIGRldGVjdGVkIGZvciAke2hvdXJzU2luY2VVcGRhdGUudG9GaXhlZCgxKX0gaG91cnNgLFxuICAgICAgICAgIHRpbWVzdGFtcDogY3VycmVudFRpbWUsXG4gICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgaG91cnNTaW5jZVVwZGF0ZSxcbiAgICAgICAgICAgIHRocmVzaG9sZDogdGhpcy5hbGVydFRocmVzaG9sZHMucHJvZ3Jlc3NTdGFsbFRocmVzaG9sZCxcbiAgICAgICAgICAgIGxhc3RVcGRhdGU6IGxhc3RQcm9ncmVzc1VwZGF0ZVxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgc2FmZXR5IGV2ZW50IGZyZXF1ZW5jeVxuICAgIGNvbnN0IHJlY2VudFNhZmV0eUV2ZW50cyA9IHRoaXMuZ2V0UmVjZW50U2FmZXR5RXZlbnRzKCk7XG4gICAgaWYgKHJlY2VudFNhZmV0eUV2ZW50cy5sZW5ndGggPj0gdGhpcy5hbGVydFRocmVzaG9sZHMuc2FmZXR5RXZlbnRUaHJlc2hvbGQpIHtcbiAgICAgIHRoaXMuZW1pdEFsZXJ0KHtcbiAgICAgICAgdHlwZTogJ2ZyZXF1ZW50X3NhZmV0eV9ldmVudHMnLFxuICAgICAgICBzZXZlcml0eTogJ2hpZ2gnLFxuICAgICAgICBtZXNzYWdlOiBgJHtyZWNlbnRTYWZldHlFdmVudHMubGVuZ3RofSBzYWZldHkgZXZlbnRzIGluIHRoZSBsYXN0IGhvdXJgLFxuICAgICAgICB0aW1lc3RhbXA6IGN1cnJlbnRUaW1lLFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgZXZlbnRDb3VudDogcmVjZW50U2FmZXR5RXZlbnRzLmxlbmd0aCxcbiAgICAgICAgICB0aHJlc2hvbGQ6IHRoaXMuYWxlcnRUaHJlc2hvbGRzLnNhZmV0eUV2ZW50VGhyZXNob2xkLFxuICAgICAgICAgIGV2ZW50czogcmVjZW50U2FmZXR5RXZlbnRzXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBIYW5kbGUgc2FmZXR5IHByb3RvY29sIGFjdGl2YXRpb25cbiAgICovXG4gIGhhbmRsZVNhZmV0eVByb3RvY29sQWN0aXZhdGlvbihldmVudDogU2FmZXR5RXZlbnQpOiB2b2lkIHtcbiAgICBjb25zb2xlLmxvZyhgU2FmZXR5IHByb3RvY29sIGFjdGl2YXRlZDogJHtldmVudC50eXBlfWApO1xuXG4gICAgdGhpcy5lbWl0QWxlcnQoe1xuICAgICAgdHlwZTogJ3NhZmV0eV9wcm90b2NvbF9hY3RpdmF0aW9uJyxcbiAgICAgIHNldmVyaXR5OiBldmVudC5zZXZlcml0eSA9PT0gJ2NyaXRpY2FsJyA/ICdjcml0aWNhbCcgOiAnaGlnaCcsXG4gICAgICBtZXNzYWdlOiBgU2FmZXR5IHByb3RvY29sIGFjdGl2YXRlZDogJHtldmVudC5kZXNjcmlwdGlvbn1gLFxuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuICAgICAgZGF0YToge1xuICAgICAgICBzYWZldHlFdmVudDogZXZlbnQsXG4gICAgICAgIGFjdGlvbjogZXZlbnQuYWN0aW9uLFxuICAgICAgICBhZmZlY3RlZEZpbGVzOiBldmVudC5hZmZlY3RlZEZpbGVzIHx8IFtdXG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBJZiBpdCdzIGEgY3JpdGljYWwgc2FmZXR5IGV2ZW50LCBjb25zaWRlciBzdG9wcGluZyBtb25pdG9yaW5nIHRlbXBvcmFyaWx5XG4gICAgaWYgKGV2ZW50LnNldmVyaXR5ID09PSAnY3JpdGljYWwnKSB7XG4gICAgICB0aGlzLmVtaXQoJ2NyaXRpY2FsX3NhZmV0eV9ldmVudCcsIGV2ZW50KTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2V0IGFsZXJ0IGhpc3RvcnlcbiAgICovXG4gIGdldEFsZXJ0SGlzdG9yeShsaW1pdD86IG51bWJlcik6IEFsZXJ0W10ge1xuICAgIGNvbnN0IGFsZXJ0cyA9IFsuLi50aGlzLmFsZXJ0SGlzdG9yeV0ucmV2ZXJzZSgpOyAvLyBNb3N0IHJlY2VudCBmaXJzdFxuICAgIHJldHVybiBsaW1pdCA/IGFsZXJ0cy5zbGljZSgwLCBsaW1pdCkgOiBhbGVydHM7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGJ1aWxkIHN0YWJpbGl0eSBoaXN0b3J5XG4gICAqL1xuICBnZXRCdWlsZFN0YWJpbGl0eUhpc3RvcnkobGltaXQ/OiBudW1iZXIpOiBCdWlsZFN0YWJpbGl0eVJlY29yZFtdIHtcbiAgICBjb25zdCBoaXN0b3J5ID0gWy4uLnRoaXMuYnVpbGRTdGFiaWxpdHlIaXN0b3J5XS5yZXZlcnNlKCk7IC8vIE1vc3QgcmVjZW50IGZpcnN0XG4gICAgcmV0dXJuIGxpbWl0ID8gaGlzdG9yeS5zbGljZSgwLCBsaW1pdCkgOiBoaXN0b3J5O1xuICB9XG5cbiAgLyoqXG4gICAqIENsZWFyIGFsZXJ0IGhpc3RvcnlcbiAgICovXG4gIGNsZWFyQWxlcnRIaXN0b3J5KCk6IHZvaWQge1xuICAgIHRoaXMuYWxlcnRIaXN0b3J5ID0gW107XG4gICAgdGhpcy5zYXZlQWxlcnRIaXN0b3J5KCk7XG4gICAgdGhpcy5lbWl0KCdhbGVydF9oaXN0b3J5X2NsZWFyZWQnKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgYWxlcnQgdGhyZXNob2xkc1xuICAgKi9cbiAgdXBkYXRlQWxlcnRUaHJlc2hvbGRzKG5ld1RocmVzaG9sZHM6IFBhcnRpYWw8QWxlcnRUaHJlc2hvbGRzPik6IHZvaWQge1xuICAgIHRoaXMuYWxlcnRUaHJlc2hvbGRzID0geyAuLi50aGlzLmFsZXJ0VGhyZXNob2xkcywgLi4ubmV3VGhyZXNob2xkcyB9O1xuICAgIHRoaXMuZW1pdCgnYWxlcnRfdGhyZXNob2xkc191cGRhdGVkJywgdGhpcy5hbGVydFRocmVzaG9sZHMpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBjdXJyZW50IGFsZXJ0IHRocmVzaG9sZHNcbiAgICovXG4gIGdldEFsZXJ0VGhyZXNob2xkcygpOiBBbGVydFRocmVzaG9sZHMge1xuICAgIHJldHVybiB7IC4uLnRoaXMuYWxlcnRUaHJlc2hvbGRzIH07XG4gIH1cblxuICAvLyBQcml2YXRlIG1ldGhvZHNcblxuICBwcml2YXRlIGFzeW5jIHVwZGF0ZURhc2hib2FyZCgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgY29uc29sZS5sb2coJ1VwZGF0aW5nIGRhc2hib2FyZCBkYXRhLi4uJyk7XG5cbiAgICAgIGNvbnN0IFtcbiAgICAgICAgYW5hbHlzaXNSZXBvcnQsXG4gICAgICAgIHByb2dyZXNzTWV0cmljcyxcbiAgICAgICAgYnVpbGRTdGFiaWxpdHlcbiAgICAgIF0gPSBhd2FpdCBQcm9taXNlLmFsbChbXG4gICAgICAgIHRoaXMuYW5hbHlzaXNUb29scy5nZW5lcmF0ZUNvbXByZWhlbnNpdmVSZXBvcnQoKSxcbiAgICAgICAgdGhpcy5nZXRQcm9ncmVzc01ldHJpY3MoKSxcbiAgICAgICAgdGhpcy5nZXRDdXJyZW50QnVpbGRTdGFiaWxpdHkoKVxuICAgICAgXSk7XG5cbiAgICAgIHRoaXMuZGFzaGJvYXJkRGF0YSA9IHtcbiAgICAgICAgbGFzdFVwZGF0ZTogbmV3IERhdGUoKSxcbiAgICAgICAgYW5hbHlzaXNSZXBvcnQsXG4gICAgICAgIHByb2dyZXNzTWV0cmljcyxcbiAgICAgICAgYnVpbGRTdGFiaWxpdHksXG4gICAgICAgIGFsZXJ0U3VtbWFyeToge1xuICAgICAgICAgIHRvdGFsQWxlcnRzOiB0aGlzLmFsZXJ0SGlzdG9yeS5sZW5ndGgsXG4gICAgICAgICAgY3JpdGljYWxBbGVydHM6IHRoaXMuYWxlcnRIaXN0b3J5LmZpbHRlcihhID0+IGEuc2V2ZXJpdHkgPT09ICdjcml0aWNhbCcpLmxlbmd0aCxcbiAgICAgICAgICBoaWdoQWxlcnRzOiB0aGlzLmFsZXJ0SGlzdG9yeS5maWx0ZXIoYSA9PiBhLnNldmVyaXR5ID09PSAnaGlnaCcpLmxlbmd0aCxcbiAgICAgICAgICBtZWRpdW1BbGVydHM6IHRoaXMuYWxlcnRIaXN0b3J5LmZpbHRlcihhID0+IGEuc2V2ZXJpdHkgPT09ICdtZWRpdW0nKS5sZW5ndGgsXG4gICAgICAgICAgbG93QWxlcnRzOiB0aGlzLmFsZXJ0SGlzdG9yeS5maWx0ZXIoYSA9PiBhLnNldmVyaXR5ID09PSAnbG93JykubGVuZ3RoLFxuICAgICAgICAgIHJlY2VudEFsZXJ0czogdGhpcy5nZXRSZWNlbnRBbGVydHMoMjQpIC8vIExhc3QgMjQgaG91cnNcbiAgICAgICAgfSxcbiAgICAgICAgdHJlbmRpbmdEYXRhOiB0aGlzLmNhbGN1bGF0ZVRyZW5kaW5nRGF0YSgpLFxuICAgICAgICBzeXN0ZW1IZWFsdGg6IHRoaXMuY2FsY3VsYXRlU3lzdGVtSGVhbHRoKClcbiAgICAgIH07XG5cbiAgICAgIHRoaXMuZW1pdCgnZGFzaGJvYXJkX3VwZGF0ZWQnLCB0aGlzLmRhc2hib2FyZERhdGEpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciB1cGRhdGluZyBkYXNoYm9hcmQ6JywgZXJyb3IpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBnZXRDdXJyZW50QnVpbGRTdGFiaWxpdHkoKTogUHJvbWlzZTxCdWlsZFN0YWJpbGl0eVJlY29yZD4ge1xuICAgIGNvbnN0IHN0YXJ0VGltZSA9IERhdGUubm93KCk7XG5cbiAgICB0cnkge1xuICAgICAgLy8gUnVuIFR5cGVTY3JpcHQgY29tcGlsYXRpb24gY2hlY2tcbiAgICAgIGV4ZWNTeW5jKCd5YXJuIHRzYyAtLW5vRW1pdCAtLXNraXBMaWJDaGVjaycsIHtcbiAgICAgICAgc3RkaW86ICdwaXBlJyxcbiAgICAgICAgdGltZW91dDogMzAwMDAgLy8gMzAgc2Vjb25kIHRpbWVvdXRcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBidWlsZFRpbWUgPSBEYXRlLm5vdygpIC0gc3RhcnRUaW1lO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAgICAgIGlzU3RhYmxlOiB0cnVlLFxuICAgICAgICBidWlsZFRpbWUsXG4gICAgICAgIGVycm9yQ291bnQ6IDAsXG4gICAgICAgIGVycm9yTWVzc2FnZTogbnVsbFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc3QgYnVpbGRUaW1lID0gRGF0ZS5ub3coKSAtIHN0YXJ0VGltZTtcbiAgICAgIGNvbnN0IGVycm9yT3V0cHV0ID0gZXJyb3Iuc3Rkb3V0Py50b1N0cmluZygpIHx8IGVycm9yLnN0ZGVycj8udG9TdHJpbmcoKSB8fCBlcnJvci5tZXNzYWdlO1xuICAgICAgY29uc3QgZXJyb3JDb3VudCA9IHRoaXMuY291bnRUeXBlU2NyaXB0RXJyb3JzKGVycm9yT3V0cHV0KTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuICAgICAgICBpc1N0YWJsZTogZmFsc2UsXG4gICAgICAgIGJ1aWxkVGltZSxcbiAgICAgICAgZXJyb3JDb3VudCxcbiAgICAgICAgZXJyb3JNZXNzYWdlOiBlcnJvck91dHB1dC5zdWJzdHJpbmcoMCwgNTAwKSAvLyBMaW1pdCBlcnJvciBtZXNzYWdlIGxlbmd0aFxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNvdW50VHlwZVNjcmlwdEVycm9ycyhvdXRwdXQ6IHN0cmluZyk6IG51bWJlciB7XG4gICAgY29uc3QgZXJyb3JNYXRjaGVzID0gb3V0cHV0Lm1hdGNoKC9lcnJvciBUU1xcZCs6L2cpO1xuICAgIHJldHVybiBlcnJvck1hdGNoZXMgPyBlcnJvck1hdGNoZXMubGVuZ3RoIDogMDtcbiAgfVxuXG4gIHByaXZhdGUgY2FsY3VsYXRlUmVkdWN0aW9uUGVyY2VudGFnZShyZXBvcnQ6IEFuYWx5c2lzUmVwb3J0IHwgbnVsbCk6IG51bWJlciB7XG4gICAgaWYgKCFyZXBvcnQgfHwgIXJlcG9ydC5kb21haW5EaXN0cmlidXRpb24pIHJldHVybiAwO1xuXG4gICAgLy8gQ2FsY3VsYXRlIHJlZHVjdGlvbiBmcm9tIGJhc2VsaW5lICh3b3VsZCBuZWVkIGhpc3RvcmljYWwgYmFzZWxpbmUgZGF0YSlcbiAgICAvLyBGb3Igbm93LCB1c2UgYSBzaW1wbGUgY2FsY3VsYXRpb24gYmFzZWQgb24gaW50ZW50aW9uYWwgdnMgdW5pbnRlbnRpb25hbCByYXRpb1xuICAgIGNvbnN0IHRvdGFsID0gcmVwb3J0LmRvbWFpbkRpc3RyaWJ1dGlvbi50b3RhbEFueVR5cGVzO1xuICAgIGNvbnN0IHVuaW50ZW50aW9uYWwgPSByZXBvcnQuZG9tYWluRGlzdHJpYnV0aW9uLmludGVudGlvbmFsVnNVbmludGVudGlvbmFsPy51bmludGVudGlvbmFsPy5jb3VudCB8fCAwO1xuXG4gICAgaWYgKHRvdGFsID09PSAwKSByZXR1cm4gMDtcblxuICAgIC8vIEFzc3VtZSBiYXNlbGluZSB3YXMgMTAwJSB1bmludGVudGlvbmFsLCBjYWxjdWxhdGUgY3VycmVudCByZWR1Y3Rpb25cbiAgICBjb25zdCBjdXJyZW50VW5pbnRlbnRpb25hbFBlcmNlbnRhZ2UgPSAodW5pbnRlbnRpb25hbCAvIHRvdGFsKSAqIDEwMDtcbiAgICByZXR1cm4gTWF0aC5tYXgoMCwgMTAwIC0gY3VycmVudFVuaW50ZW50aW9uYWxQZXJjZW50YWdlKTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0QmF0Y2hlc0NvbXBsZXRlZCgpOiBudW1iZXIge1xuICAgIC8vIFRoaXMgd291bGQgYmUgdHJhY2tlZCBpbiBhY3R1YWwgaW1wbGVtZW50YXRpb25cbiAgICAvLyBGb3Igbm93LCByZXR1cm4gYSBzaW11bGF0ZWQgdmFsdWVcbiAgICByZXR1cm4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogNTApICsgMTA7XG4gIH1cblxuICBwcml2YXRlIGVtaXRBbGVydChhbGVydDogQWxlcnQpOiB2b2lkIHtcbiAgICAvLyBDaGVjayBpZiB0aGlzIGlzIGEgZHVwbGljYXRlIGFsZXJ0IChzYW1lIHR5cGUgd2l0aGluIGxhc3QgaG91cilcbiAgICBjb25zdCBvbmVIb3VyQWdvID0gbmV3IERhdGUoRGF0ZS5ub3coKSAtIDYwICogNjAgKiAxMDAwKTtcbiAgICBjb25zdCByZWNlbnRTaW1pbGFyQWxlcnRzID0gdGhpcy5hbGVydEhpc3RvcnkuZmlsdGVyKFxuICAgICAgYSA9PiBhLnR5cGUgPT09IGFsZXJ0LnR5cGUgJiYgYS50aW1lc3RhbXAgPiBvbmVIb3VyQWdvXG4gICAgKTtcblxuICAgIC8vIE9ubHkgZW1pdCBpZiBubyBzaW1pbGFyIGFsZXJ0IGluIHRoZSBsYXN0IGhvdXJcbiAgICBpZiAocmVjZW50U2ltaWxhckFsZXJ0cy5sZW5ndGggPT09IDApIHtcbiAgICAgIHRoaXMuYWxlcnRIaXN0b3J5LnB1c2goYWxlcnQpO1xuXG4gICAgICAvLyBLZWVwIG9ubHkgbGFzdCAxMDAwIGFsZXJ0c1xuICAgICAgaWYgKHRoaXMuYWxlcnRIaXN0b3J5Lmxlbmd0aCA+IDEwMDApIHtcbiAgICAgICAgdGhpcy5hbGVydEhpc3RvcnkgPSB0aGlzLmFsZXJ0SGlzdG9yeS5zbGljZSgtMTAwMCk7XG4gICAgICB9XG5cbiAgICAgIHRoaXMuc2F2ZUFsZXJ0SGlzdG9yeSgpO1xuICAgICAgdGhpcy5lbWl0KCdhbGVydCcsIGFsZXJ0KTtcblxuICAgICAgY29uc29sZS5sb2coYEFsZXJ0IGVtaXR0ZWQ6ICR7YWxlcnQudHlwZX0gKCR7YWxlcnQuc2V2ZXJpdHl9KSAtICR7YWxlcnQubWVzc2FnZX1gKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGdldExhc3RQcm9ncmVzc1VwZGF0ZSgpOiBEYXRlIHwgbnVsbCB7XG4gICAgLy8gVGhpcyB3b3VsZCB0cmFjayBhY3R1YWwgcHJvZ3Jlc3MgdXBkYXRlcyBpbiByZWFsIGltcGxlbWVudGF0aW9uXG4gICAgLy8gRm9yIG5vdywgcmV0dXJuIGEgc2ltdWxhdGVkIHJlY2VudCB1cGRhdGVcbiAgICByZXR1cm4gbmV3IERhdGUoRGF0ZS5ub3coKSAtIE1hdGgucmFuZG9tKCkgKiAyICogNjAgKiA2MCAqIDEwMDApOyAvLyBSYW5kb20gdGltZSB3aXRoaW4gbGFzdCAyIGhvdXJzXG4gIH1cblxuICBwcml2YXRlIGdldFJlY2VudFNhZmV0eUV2ZW50cygpOiBTYWZldHlFdmVudFtdIHtcbiAgICAvLyBUaGlzIHdvdWxkIHRyYWNrIGFjdHVhbCBzYWZldHkgZXZlbnRzIGluIHJlYWwgaW1wbGVtZW50YXRpb25cbiAgICAvLyBGb3Igbm93LCByZXR1cm4gZW1wdHkgYXJyYXlcbiAgICByZXR1cm4gW107XG4gIH1cblxuICBwcml2YXRlIGdldFJlY2VudEFsZXJ0cyhob3VyczogbnVtYmVyKTogQWxlcnRbXSB7XG4gICAgY29uc3QgY3V0b2ZmVGltZSA9IG5ldyBEYXRlKERhdGUubm93KCkgLSBob3VycyAqIDYwICogNjAgKiAxMDAwKTtcbiAgICByZXR1cm4gdGhpcy5hbGVydEhpc3RvcnkuZmlsdGVyKGFsZXJ0ID0+IGFsZXJ0LnRpbWVzdGFtcCA+IGN1dG9mZlRpbWUpO1xuICB9XG5cbiAgcHJpdmF0ZSBjYWxjdWxhdGVUcmVuZGluZ0RhdGEoKTogVHJlbmRpbmdEYXRhW10ge1xuICAgIC8vIFRoaXMgd291bGQgY2FsY3VsYXRlIGFjdHVhbCB0cmVuZGluZyBkYXRhIGZyb20gaGlzdG9yaWNhbCByZXBvcnRzXG4gICAgLy8gRm9yIG5vdywgcmV0dXJuIHNpbXVsYXRlZCB0cmVuZGluZyBkYXRhXG4gICAgY29uc3QgdHJlbmRzOiBUcmVuZGluZ0RhdGFbXSA9IFtdO1xuICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG5cbiAgICBmb3IgKGxldCBpID0gNzsgaSA+PSAwOyBpLS0pIHtcbiAgICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZShub3cuZ2V0VGltZSgpIC0gaSAqIDI0ICogNjAgKiA2MCAqIDEwMDApO1xuICAgICAgdHJlbmRzLnB1c2goe1xuICAgICAgICBkYXRlLFxuICAgICAgICBzdWNjZXNzUmF0ZTogNzUgKyBNYXRoLnJhbmRvbSgpICogMTUsIC8vIDc1LTkwJVxuICAgICAgICB0b3RhbEFueVR5cGVzOiAxODAwIC0gaSAqIDIwICsgTWF0aC5yYW5kb20oKSAqIDEwLFxuICAgICAgICB1bmludGVudGlvbmFsQ291bnQ6IDEyMDAgLSBpICogMTUgKyBNYXRoLnJhbmRvbSgpICogOCxcbiAgICAgICAgY2xhc3NpZmljYXRpb25BY2N1cmFjeTogODAgKyBNYXRoLnJhbmRvbSgpICogMTUgLy8gODAtOTUlXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4gdHJlbmRzO1xuICB9XG5cbiAgcHJpdmF0ZSBjYWxjdWxhdGVTeXN0ZW1IZWFsdGgoKTogU3lzdGVtSGVhbHRoIHtcbiAgICBjb25zdCByZWNlbnRBbGVydHMgPSB0aGlzLmdldFJlY2VudEFsZXJ0cygyNCk7XG4gICAgY29uc3QgY3JpdGljYWxBbGVydHMgPSByZWNlbnRBbGVydHMuZmlsdGVyKGEgPT4gYS5zZXZlcml0eSA9PT0gJ2NyaXRpY2FsJykubGVuZ3RoO1xuICAgIGNvbnN0IGhpZ2hBbGVydHMgPSByZWNlbnRBbGVydHMuZmlsdGVyKGEgPT4gYS5zZXZlcml0eSA9PT0gJ2hpZ2gnKS5sZW5ndGg7XG5cbiAgICBsZXQgaGVhbHRoU2NvcmUgPSAxMDA7XG4gICAgaGVhbHRoU2NvcmUgLT0gY3JpdGljYWxBbGVydHMgKiAyMDtcbiAgICBoZWFsdGhTY29yZSAtPSBoaWdoQWxlcnRzICogMTA7XG4gICAgaGVhbHRoU2NvcmUgLT0gcmVjZW50QWxlcnRzLmxlbmd0aCAqIDI7XG5cbiAgICBoZWFsdGhTY29yZSA9IE1hdGgubWF4KDAsIE1hdGgubWluKDEwMCwgaGVhbHRoU2NvcmUpKTtcblxuICAgIGxldCBzdGF0dXM6ICdoZWFsdGh5JyB8ICd3YXJuaW5nJyB8ICdjcml0aWNhbCc7XG4gICAgaWYgKGhlYWx0aFNjb3JlID49IDgwKSBzdGF0dXMgPSAnaGVhbHRoeSc7XG4gICAgZWxzZSBpZiAoaGVhbHRoU2NvcmUgPj0gNjApIHN0YXR1cyA9ICd3YXJuaW5nJztcbiAgICBlbHNlIHN0YXR1cyA9ICdjcml0aWNhbCc7XG5cbiAgICByZXR1cm4ge1xuICAgICAgc2NvcmU6IGhlYWx0aFNjb3JlLFxuICAgICAgc3RhdHVzLFxuICAgICAgbGFzdENoZWNrOiBuZXcgRGF0ZSgpLFxuICAgICAgaXNzdWVzOiByZWNlbnRBbGVydHMuZmlsdGVyKGEgPT4gYS5zZXZlcml0eSA9PT0gJ2NyaXRpY2FsJyB8fCBhLnNldmVyaXR5ID09PSAnaGlnaCcpLm1hcChhID0+IGEubWVzc2FnZSlcbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBsb2FkQWxlcnRIaXN0b3J5KCk6IHZvaWQge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBoaXN0b3J5UGF0aCA9IHBhdGguam9pbihwcm9jZXNzLmN3ZCgpLCAnLmtpcm8nLCAnY2FtcGFpZ24tcmVwb3J0cycsICdhbGVydC1oaXN0b3J5Lmpzb24nKTtcbiAgICAgIGlmIChmcy5leGlzdHNTeW5jKGhpc3RvcnlQYXRoKSkge1xuICAgICAgICBjb25zdCBoaXN0b3J5RGF0YSA9IGZzLnJlYWRGaWxlU3luYyhoaXN0b3J5UGF0aCwgJ3V0ZjgnKTtcbiAgICAgICAgdGhpcy5hbGVydEhpc3RvcnkgPSBKU09OLnBhcnNlKGhpc3RvcnlEYXRhKS5tYXAoKGFsZXJ0OiBhbnkpID0+ICh7XG4gICAgICAgICAgLi4uYWxlcnQsXG4gICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZShhbGVydC50aW1lc3RhbXApXG4gICAgICAgIH0pKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS53YXJuKCdDb3VsZCBub3QgbG9hZCBhbGVydCBoaXN0b3J5OicsIGVycm9yKTtcbiAgICAgIHRoaXMuYWxlcnRIaXN0b3J5ID0gW107XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzYXZlQWxlcnRIaXN0b3J5KCk6IHZvaWQge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBoaXN0b3J5RGlyID0gcGF0aC5qb2luKHByb2Nlc3MuY3dkKCksICcua2lybycsICdjYW1wYWlnbi1yZXBvcnRzJyk7XG4gICAgICBpZiAoIWZzLmV4aXN0c1N5bmMoaGlzdG9yeURpcikpIHtcbiAgICAgICAgZnMubWtkaXJTeW5jKGhpc3RvcnlEaXIsIHsgcmVjdXJzaXZlOiB0cnVlIH0pO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBoaXN0b3J5UGF0aCA9IHBhdGguam9pbihoaXN0b3J5RGlyLCAnYWxlcnQtaGlzdG9yeS5qc29uJyk7XG4gICAgICBmcy53cml0ZUZpbGVTeW5jKGhpc3RvcnlQYXRoLCBKU09OLnN0cmluZ2lmeSh0aGlzLmFsZXJ0SGlzdG9yeSwgbnVsbCwgMikpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLndhcm4oJ0NvdWxkIG5vdCBzYXZlIGFsZXJ0IGhpc3Rvcnk6JywgZXJyb3IpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgbG9hZEJ1aWxkU3RhYmlsaXR5SGlzdG9yeSgpOiB2b2lkIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgaGlzdG9yeVBhdGggPSBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgJy5raXJvJywgJ2NhbXBhaWduLXJlcG9ydHMnLCAnYnVpbGQtc3RhYmlsaXR5LWhpc3RvcnkuanNvbicpO1xuICAgICAgaWYgKGZzLmV4aXN0c1N5bmMoaGlzdG9yeVBhdGgpKSB7XG4gICAgICAgIGNvbnN0IGhpc3RvcnlEYXRhID0gZnMucmVhZEZpbGVTeW5jKGhpc3RvcnlQYXRoLCAndXRmOCcpO1xuICAgICAgICB0aGlzLmJ1aWxkU3RhYmlsaXR5SGlzdG9yeSA9IEpTT04ucGFyc2UoaGlzdG9yeURhdGEpLm1hcCgocmVjb3JkOiBhbnkpID0+ICh7XG4gICAgICAgICAgLi4ucmVjb3JkLFxuICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUocmVjb3JkLnRpbWVzdGFtcClcbiAgICAgICAgfSkpO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLndhcm4oJ0NvdWxkIG5vdCBsb2FkIGJ1aWxkIHN0YWJpbGl0eSBoaXN0b3J5OicsIGVycm9yKTtcbiAgICAgIHRoaXMuYnVpbGRTdGFiaWxpdHlIaXN0b3J5ID0gW107XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBzYXZlQnVpbGRTdGFiaWxpdHlIaXN0b3J5KCk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBoaXN0b3J5RGlyID0gcGF0aC5qb2luKHByb2Nlc3MuY3dkKCksICcua2lybycsICdjYW1wYWlnbi1yZXBvcnRzJyk7XG4gICAgICBpZiAoIWZzLmV4aXN0c1N5bmMoaGlzdG9yeURpcikpIHtcbiAgICAgICAgZnMubWtkaXJTeW5jKGhpc3RvcnlEaXIsIHsgcmVjdXJzaXZlOiB0cnVlIH0pO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBoaXN0b3J5UGF0aCA9IHBhdGguam9pbihoaXN0b3J5RGlyLCAnYnVpbGQtc3RhYmlsaXR5LWhpc3RvcnkuanNvbicpO1xuICAgICAgZnMud3JpdGVGaWxlU3luYyhoaXN0b3J5UGF0aCwgSlNPTi5zdHJpbmdpZnkodGhpcy5idWlsZFN0YWJpbGl0eUhpc3RvcnksIG51bGwsIDIpKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS53YXJuKCdDb3VsZCBub3Qgc2F2ZSBidWlsZCBzdGFiaWxpdHkgaGlzdG9yeTonLCBlcnJvcik7XG4gICAgfVxuICB9XG59XG5cbi8vIFN1cHBvcnRpbmcgaW50ZXJmYWNlc1xuXG5leHBvcnQgaW50ZXJmYWNlIERhc2hib2FyZERhdGEge1xuICBsYXN0VXBkYXRlOiBEYXRlO1xuICBhbmFseXNpc1JlcG9ydDogQW5hbHlzaXNSZXBvcnQ7XG4gIHByb2dyZXNzTWV0cmljczogVW5pbnRlbnRpb25hbEFueVByb2dyZXNzO1xuICBidWlsZFN0YWJpbGl0eTogQnVpbGRTdGFiaWxpdHlSZWNvcmQ7XG4gIGFsZXJ0U3VtbWFyeTogQWxlcnRTdW1tYXJ5O1xuICB0cmVuZGluZ0RhdGE6IFRyZW5kaW5nRGF0YVtdO1xuICBzeXN0ZW1IZWFsdGg6IFN5c3RlbUhlYWx0aDtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBBbGVydFRocmVzaG9sZHMge1xuICBzdWNjZXNzUmF0ZVRocmVzaG9sZDogbnVtYmVyO1xuICBidWlsZEZhaWx1cmVUaHJlc2hvbGQ6IG51bWJlcjtcbiAgY2xhc3NpZmljYXRpb25BY2N1cmFjeVRocmVzaG9sZDogbnVtYmVyO1xuICBzYWZldHlFdmVudFRocmVzaG9sZDogbnVtYmVyO1xuICBwcm9ncmVzc1N0YWxsVGhyZXNob2xkOiBudW1iZXI7IC8vIGhvdXJzXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQWxlcnQge1xuICB0eXBlOiBBbGVydFR5cGU7XG4gIHNldmVyaXR5OiAnbG93JyB8ICdtZWRpdW0nIHwgJ2hpZ2gnIHwgJ2NyaXRpY2FsJztcbiAgbWVzc2FnZTogc3RyaW5nO1xuICB0aW1lc3RhbXA6IERhdGU7XG4gIGRhdGE/OiBhbnk7XG59XG5cbmV4cG9ydCB0eXBlIEFsZXJ0VHlwZSA9XG4gIHwgJ2xvd19zdWNjZXNzX3JhdGUnXG4gIHwgJ2J1aWxkX2ZhaWx1cmUnXG4gIHwgJ2NvbnNlY3V0aXZlX2J1aWxkX2ZhaWx1cmVzJ1xuICB8ICdsb3dfY2xhc3NpZmljYXRpb25fYWNjdXJhY3knXG4gIHwgJ3Byb2dyZXNzX3N0YWxsJ1xuICB8ICdmcmVxdWVudF9zYWZldHlfZXZlbnRzJ1xuICB8ICdzYWZldHlfcHJvdG9jb2xfYWN0aXZhdGlvbidcbiAgfCAnc3lzdGVtX2Vycm9yJztcblxuZXhwb3J0IGludGVyZmFjZSBTYWZldHlFdmVudCB7XG4gIHR5cGU6IHN0cmluZztcbiAgc2V2ZXJpdHk6ICdsb3cnIHwgJ21lZGl1bScgfCAnaGlnaCcgfCAnY3JpdGljYWwnO1xuICBkZXNjcmlwdGlvbjogc3RyaW5nO1xuICBhY3Rpb246IHN0cmluZztcbiAgdGltZXN0YW1wOiBEYXRlO1xuICBhZmZlY3RlZEZpbGVzPzogc3RyaW5nW107XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQnVpbGRTdGFiaWxpdHlSZWNvcmQge1xuICB0aW1lc3RhbXA6IERhdGU7XG4gIGlzU3RhYmxlOiBib29sZWFuO1xuICBidWlsZFRpbWU6IG51bWJlcjtcbiAgZXJyb3JDb3VudDogbnVtYmVyO1xuICBlcnJvck1lc3NhZ2U6IHN0cmluZyB8IG51bGw7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQWxlcnRTdW1tYXJ5IHtcbiAgdG90YWxBbGVydHM6IG51bWJlcjtcbiAgY3JpdGljYWxBbGVydHM6IG51bWJlcjtcbiAgaGlnaEFsZXJ0czogbnVtYmVyO1xuICBtZWRpdW1BbGVydHM6IG51bWJlcjtcbiAgbG93QWxlcnRzOiBudW1iZXI7XG4gIHJlY2VudEFsZXJ0czogQWxlcnRbXTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBTeXN0ZW1IZWFsdGgge1xuICBzY29yZTogbnVtYmVyOyAvLyAwLTEwMFxuICBzdGF0dXM6ICdoZWFsdGh5JyB8ICd3YXJuaW5nJyB8ICdjcml0aWNhbCc7XG4gIGxhc3RDaGVjazogRGF0ZTtcbiAgaXNzdWVzOiBzdHJpbmdbXTtcbn1cbiJdLCJ2ZXJzaW9uIjozfQ==