cd137329973b38b7ae5fd260380800d7
"use strict";
/**
 * Enhanced Metrics Collection System
 * Perfect Codebase Campaign - Real-time Comprehensive Metrics
 * Requirements: 6.1, 6.2, 6.3
 */
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.MetricsCollectionSystem = void 0;
const child_process_1 = require("child_process");
const fs = __importStar(require("fs"));
class MetricsCollectionSystem {
    snapshots = [];
    collectionInterval = null;
    isCollecting = false;
    /**
     * Start real-time metrics collection
     */
    startRealTimeCollection(intervalMs = 30000) {
        if (this.isCollecting) {
            console.log('ðŸ“Š Metrics collection already running');
            return;
        }
        this.isCollecting = true;
        console.log(`ðŸ“Š Starting real-time metrics collection (interval: ${intervalMs}ms)`);
        this.collectionInterval = setInterval(async () => {
            try {
                await this.collectSnapshot();
            }
            catch (error) {
                console.error('âŒ Error during metrics collection:', error.message || 'Unknown error');
            }
        }, intervalMs);
        // Collect initial snapshot
        this.collectSnapshot();
    }
    /**
     * Stop real-time metrics collection
     */
    stopRealTimeCollection() {
        if (this.collectionInterval) {
            clearInterval(this.collectionInterval);
            this.collectionInterval = null;
        }
        this.isCollecting = false;
        console.log('ðŸ“Š Stopped real-time metrics collection');
    }
    /**
     * Collect comprehensive metrics snapshot
     */
    async collectSnapshot(phase, milestone, notes) {
        const timestamp = new Date();
        const id = `snapshot_${timestamp.getTime()}`;
        console.log('ðŸ“Š Collecting metrics snapshot...');
        const metrics = await this.collectDetailedMetrics();
        const snapshot = {
            id,
            timestamp,
            metrics,
            phase: phase || 'unknown',
            milestone,
            notes
        };
        this.snapshots.push(snapshot);
        // Keep only recent snapshots to prevent memory issues
        if (this.snapshots.length > 1000) {
            this.snapshots = this.snapshots.slice(-500);
        }
        console.log(`ðŸ“Š Snapshot collected: ${id}`);
        return snapshot;
    }
    /**
     * Collect detailed metrics with comprehensive analysis
     */
    async collectDetailedMetrics() {
        const [typeScriptMetrics, lintingMetrics, buildMetrics, resourceMetrics, enterpriseSystemCount] = await Promise.all([
            this.collectTypeScriptMetrics(),
            this.collectLintingMetrics(),
            this.collectBuildMetrics(),
            this.collectResourceMetrics(),
            this.getEnterpriseSystemCount()
        ]);
        const trendData = this.calculateTrendData();
        const detailedMetrics = {
            timestamp: new Date(),
            typeScriptErrors: {
                current: typeScriptMetrics.count,
                target: 0,
                reduction: Math.max(0, 86 - typeScriptMetrics.count),
                percentage: typeScriptMetrics.count >= 0 ? Math.round(((86 - typeScriptMetrics.count) / 86) * 100) : 0
            },
            lintingWarnings: {
                current: lintingMetrics.count,
                target: 0,
                reduction: Math.max(0, 4506 - lintingMetrics.count),
                percentage: lintingMetrics.count >= 0 ? Math.round(((4506 - lintingMetrics.count) / 4506) * 100) : 0
            },
            buildPerformance: {
                currentTime: buildMetrics.buildTime,
                targetTime: 10,
                cacheHitRate: buildMetrics.cacheHitRate,
                memoryUsage: buildMetrics.memoryUsage
            },
            enterpriseSystems: {
                current: enterpriseSystemCount,
                target: 200,
                transformedExports: Math.max(0, enterpriseSystemCount - 0)
            },
            errorBreakdown: typeScriptMetrics.breakdown,
            warningBreakdown: lintingMetrics.breakdown,
            buildMetrics,
            resourceMetrics,
            trendData
        };
        return detailedMetrics;
    }
    /**
     * Collect TypeScript error metrics with detailed breakdown
     */
    async collectTypeScriptMetrics() {
        try {
            // Get total error count
            const countOutput = (0, child_process_1.execSync)('yarn tsc --noEmit --skipLibCheck 2>&1 | grep -c "error TS" || echo "0"', {
                encoding: 'utf8',
                stdio: 'pipe'
            });
            const count = parseInt(countOutput.trim()) || 0;
            // Get detailed breakdown by error type
            const breakdown = {};
            if (count > 0) {
                try {
                    const breakdownOutput = (0, child_process_1.execSync)('yarn tsc --noEmit --skipLibCheck 2>&1 | grep -E "error TS" | sed \'s/.*error //\' | cut -d\':\' -f1 | sort | uniq -c | sort -nr', {
                        encoding: 'utf8',
                        stdio: 'pipe'
                    });
                    const lines = breakdownOutput.trim().split('\n').filter(line => line.trim());
                    for (const line of lines) {
                        const match = line.trim().match(/^\s*(\d+)\s+(.+)$/);
                        if (match) {
                            const errorCount = parseInt(match[1]);
                            const errorType = match[2].trim();
                            breakdown[errorType] = errorCount;
                        }
                    }
                }
                catch (error) {
                    console.warn('Could not get TypeScript error breakdown:', error.message || 'Unknown error');
                }
            }
            return { count, breakdown };
        }
        catch (error) {
            console.warn('Could not collect TypeScript metrics:', error.message || 'Unknown error');
            return { count: -1, breakdown: {} };
        }
    }
    /**
     * Collect linting warning metrics with categorized breakdown
     */
    async collectLintingMetrics() {
        try {
            // Get total warning count
            const countOutput = (0, child_process_1.execSync)('yarn lint 2>&1 | grep -c "warning" || echo "0"', {
                encoding: 'utf8',
                stdio: 'pipe'
            });
            const count = parseInt(countOutput.trim()) || 0;
            // Get detailed breakdown by warning type
            const breakdown = {};
            if (count > 0) {
                try {
                    const lintOutput = (0, child_process_1.execSync)('yarn lint 2>&1', {
                        encoding: 'utf8',
                        stdio: 'pipe'
                    });
                    const lines = lintOutput.split('\n');
                    for (const line of lines) {
                        // Look for ESLint warning patterns
                        const warningMatch = line.match(/warning\s+(.+?)\s+(@typescript-eslint\/[\w-]+|[\w-]+)/);
                        if (warningMatch) {
                            const ruleType = warningMatch[2];
                            breakdown[ruleType] = (breakdown[ruleType] || 0) + 1;
                        }
                    }
                }
                catch (error) {
                    console.warn('Could not get linting warning breakdown:', error.message || 'Unknown error');
                }
            }
            return { count, breakdown };
        }
        catch (error) {
            console.warn('Could not collect linting metrics:', error.message || 'Unknown error');
            return { count: -1, breakdown: {} };
        }
    }
    /**
     * Collect comprehensive build performance metrics
     */
    async collectBuildMetrics() {
        const startTime = Date.now();
        let buildTime = -1;
        let bundleSize = 0;
        let compilationSpeed = 0;
        try {
            // Measure build time
            const buildStart = Date.now();
            (0, child_process_1.execSync)('yarn build', {
                encoding: 'utf8',
                stdio: 'pipe'
            });
            buildTime = (Date.now() - buildStart) / 1000;
            // Calculate compilation speed (rough estimate)
            const sourceFiles = this.countSourceFiles();
            compilationSpeed = sourceFiles / buildTime;
        }
        catch (error) {
            console.warn('Build failed during metrics collection:', error.message || 'Unknown error');
        }
        try {
            // Get bundle size
            bundleSize = await this.getBundleSize();
        }
        catch (error) {
            console.warn('Could not measure bundle size:', error.message || 'Unknown error');
        }
        return {
            buildTime,
            bundleSize,
            cacheHitRate: await this.estimateCacheHitRate(),
            memoryUsage: this.getMemoryUsage(),
            cpuUsage: await this.getCpuUsage(),
            diskUsage: await this.getDiskUsage(),
            compilationSpeed
        };
    }
    /**
     * Collect system resource metrics
     */
    async collectResourceMetrics() {
        const nodeMemoryUsage = process.memoryUsage();
        return {
            nodeMemoryUsage,
            systemMemory: await this.getSystemMemory(),
            diskSpace: await this.getDiskSpace()
        };
    }
    /**
     * Calculate trend data based on historical snapshots
     */
    calculateTrendData() {
        if (this.snapshots.length < 2) {
            return {
                errorReductionRate: 0,
                warningReductionRate: 0,
                buildTimeImprovement: 0,
                systemGrowthRate: 0
            };
        }
        const recent = this.snapshots.slice(-10); // Last 10 snapshots
        const timeSpanHours = (recent[recent.length - 1].timestamp.getTime() - recent[0].timestamp.getTime()) / (1000 * 60 * 60);
        if (timeSpanHours === 0) {
            return {
                errorReductionRate: 0,
                warningReductionRate: 0,
                buildTimeImprovement: 0,
                systemGrowthRate: 0
            };
        }
        const errorReduction = recent[0].metrics.typeScriptErrors.current - recent[recent.length - 1].metrics.typeScriptErrors.current;
        const warningReduction = recent[0].metrics.lintingWarnings.current - recent[recent.length - 1].metrics.lintingWarnings.current;
        const buildTimeImprovement = recent[0].metrics.buildPerformance.currentTime - recent[recent.length - 1].metrics.buildPerformance.currentTime;
        const systemGrowth = recent[recent.length - 1].metrics.enterpriseSystems.current - recent[0].metrics.enterpriseSystems.current;
        return {
            errorReductionRate: errorReduction / timeSpanHours,
            warningReductionRate: warningReduction / timeSpanHours,
            buildTimeImprovement: buildTimeImprovement / timeSpanHours,
            systemGrowthRate: systemGrowth / timeSpanHours
        };
    }
    /**
     * Helper methods for metrics collection
     */
    async getEnterpriseSystemCount() {
        try {
            const output = (0, child_process_1.execSync)('grep -r "INTELLIGENCE_SYSTEM" src/ | wc -l', {
                encoding: 'utf8',
                stdio: 'pipe'
            });
            return parseInt(output.trim()) || 0;
        }
        catch (error) {
            return 0;
        }
    }
    async getBundleSize() {
        try {
            const buildDirs = ['.next', 'dist', 'build'];
            let totalSize = 0;
            for (const dir of buildDirs) {
                if (fs.existsSync(dir)) {
                    const output = (0, child_process_1.execSync)(`du -sk ${dir} | cut -f1`, {
                        encoding: 'utf8',
                        stdio: 'pipe'
                    });
                    totalSize += parseInt(output.trim()) || 0;
                }
            }
            return totalSize;
        }
        catch (error) {
            return 0;
        }
    }
    async estimateCacheHitRate() {
        // This is a simplified estimation - in a real implementation,
        // you'd integrate with the actual build system's cache metrics
        return 0.8; // 80% default estimate
    }
    getMemoryUsage() {
        const memUsage = process.memoryUsage();
        return Math.round(memUsage.heapUsed / 1024 / 1024);
    }
    async getCpuUsage() {
        try {
            const output = (0, child_process_1.execSync)('ps -o %cpu -p $$ | tail -1', {
                encoding: 'utf8',
                stdio: 'pipe'
            });
            return parseFloat(output.trim()) || 0;
        }
        catch (error) {
            return 0;
        }
    }
    async getDiskUsage() {
        try {
            const output = (0, child_process_1.execSync)('du -sh . | cut -f1', {
                encoding: 'utf8',
                stdio: 'pipe'
            });
            // Convert to MB (rough estimation)
            const sizeStr = output.trim();
            if (sizeStr.includes('G')) {
                return parseFloat(sizeStr) * 1024;
            }
            else if (sizeStr.includes('M')) {
                return parseFloat(sizeStr);
            }
            return 0;
        }
        catch (error) {
            return 0;
        }
    }
    countSourceFiles() {
        try {
            const output = (0, child_process_1.execSync)('find src -name "*.ts" -o -name "*.tsx" | wc -l', {
                encoding: 'utf8',
                stdio: 'pipe'
            });
            return parseInt(output.trim()) || 0;
        }
        catch (error) {
            return 0;
        }
    }
    async getSystemMemory() {
        try {
            const output = (0, child_process_1.execSync)('free -m | grep Mem', {
                encoding: 'utf8',
                stdio: 'pipe'
            });
            const match = output.match(/Mem:\s+(\d+)\s+(\d+)\s+(\d+)/);
            if (match) {
                const total = parseInt(match[1]);
                const used = parseInt(match[2]);
                const free = parseInt(match[3]);
                return {
                    total,
                    used,
                    free,
                    percentage: Math.round((used / total) * 100)
                };
            }
        }
        catch (error) {
            // Fallback for non-Linux systems
        }
        return {
            total: 0,
            used: 0,
            free: 0,
            percentage: 0
        };
    }
    async getDiskSpace() {
        try {
            const output = (0, child_process_1.execSync)('df -h . | tail -1', {
                encoding: 'utf8',
                stdio: 'pipe'
            });
            const parts = output.trim().split(/\s+/);
            if (parts.length >= 4) {
                const total = this.parseSize(parts[1]);
                const used = this.parseSize(parts[2]);
                const free = this.parseSize(parts[3]);
                return {
                    total,
                    used,
                    free,
                    percentage: Math.round((used / total) * 100)
                };
            }
        }
        catch (error) {
            // Handle error
        }
        return {
            total: 0,
            used: 0,
            free: 0,
            percentage: 0
        };
    }
    parseSize(sizeStr) {
        const num = parseFloat(sizeStr);
        if (sizeStr.includes('G'))
            return num * 1024;
        if (sizeStr.includes('M'))
            return num;
        if (sizeStr.includes('K'))
            return num / 1024;
        return num;
    }
    /**
     * Export methods for external access
     */
    getSnapshots() {
        return [...this.snapshots];
    }
    getLatestSnapshot() {
        return this.snapshots.length > 0 ? this.snapshots[this.snapshots.length - 1] : null;
    }
    async exportSnapshots(filePath) {
        const exportData = {
            timestamp: new Date().toISOString(),
            totalSnapshots: this.snapshots.length,
            snapshots: this.snapshots,
            summary: {
                collectionPeriod: this.snapshots.length > 0 ? {
                    start: this.snapshots[0].timestamp,
                    end: this.snapshots[this.snapshots.length - 1].timestamp
                } : null,
                trends: this.calculateTrendData()
            }
        };
        fs.writeFileSync(filePath, JSON.stringify(exportData, null, 2));
        console.log(`ðŸ“Š Metrics snapshots exported to: ${filePath}`);
    }
    clearSnapshots() {
        this.snapshots = [];
        console.log('ðŸ“Š Metrics snapshots cleared');
    }
}
exports.MetricsCollectionSystem = MetricsCollectionSystem;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9zZXJ2aWNlcy9jYW1wYWlnbi9NZXRyaWNzQ29sbGVjdGlvblN5c3RlbS50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7R0FJRzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFSCxpREFBeUM7QUFDekMsdUNBQXlCO0FBNER6QixNQUFhLHVCQUF1QjtJQUMxQixTQUFTLEdBQXNCLEVBQUUsQ0FBQztJQUNsQyxrQkFBa0IsR0FBMEIsSUFBSSxDQUFDO0lBQ2pELFlBQVksR0FBRyxLQUFLLENBQUM7SUFFN0I7O09BRUc7SUFDSCx1QkFBdUIsQ0FBQyxhQUFxQixLQUFLO1FBQ2hELElBQUksSUFBSSxDQUFDLFlBQVksRUFBRTtZQUNyQixPQUFPLENBQUMsR0FBRyxDQUFDLHVDQUF1QyxDQUFDLENBQUM7WUFDckQsT0FBTztTQUNSO1FBRUQsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUM7UUFDekIsT0FBTyxDQUFDLEdBQUcsQ0FBQyx1REFBdUQsVUFBVSxLQUFLLENBQUMsQ0FBQztRQUVwRixJQUFJLENBQUMsa0JBQWtCLEdBQUcsV0FBVyxDQUFDLEtBQUssSUFBSSxFQUFFO1lBQy9DLElBQUk7Z0JBQ0YsTUFBTSxJQUFJLENBQUMsZUFBZSxFQUFFLENBQUM7YUFDOUI7WUFBQyxPQUFPLEtBQUssRUFBRTtnQkFDZCxPQUFPLENBQUMsS0FBSyxDQUFDLG9DQUFvQyxFQUFHLEtBQWtDLENBQUMsT0FBTyxJQUFJLGVBQWUsQ0FBQyxDQUFDO2FBQ3JIO1FBQ0gsQ0FBQyxFQUFFLFVBQVUsQ0FBQyxDQUFDO1FBRWYsMkJBQTJCO1FBQzNCLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQztJQUN6QixDQUFDO0lBRUQ7O09BRUc7SUFDSCxzQkFBc0I7UUFDcEIsSUFBSSxJQUFJLENBQUMsa0JBQWtCLEVBQUU7WUFDM0IsYUFBYSxDQUFDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO1lBQ3ZDLElBQUksQ0FBQyxr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QXFDLFFBQVEsRUFBRSxDQUFDLENBQUM7SUFDL0QsQ0FBQztJQUVELGNBQWM7UUFDWixJQUFJLENBQUMsU0FBUyxHQUFHLEVBQUUsQ0FBQztRQUNwQixPQUFPLENBQUMsR0FBRyxDQUFDLDhCQUE4QixDQUFDLENBQUM7SUFDOUMsQ0FBQztDQUNGO0FBMWZELDBEQTBmQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvR3JlZ0Nhc3Ryby9EZXNrdG9wL1doYXRUb0VhdE5leHQvc3JjL3NlcnZpY2VzL2NhbXBhaWduL01ldHJpY3NDb2xsZWN0aW9uU3lzdGVtLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogRW5oYW5jZWQgTWV0cmljcyBDb2xsZWN0aW9uIFN5c3RlbVxuICogUGVyZmVjdCBDb2RlYmFzZSBDYW1wYWlnbiAtIFJlYWwtdGltZSBDb21wcmVoZW5zaXZlIE1ldHJpY3NcbiAqIFJlcXVpcmVtZW50czogNi4xLCA2LjIsIDYuM1xuICovXG5cbmltcG9ydCB7IGV4ZWNTeW5jIH0gZnJvbSAnY2hpbGRfcHJvY2Vzcyc7XG5pbXBvcnQgKiBhcyBmcyBmcm9tICdmcyc7XG5pbXBvcnQgKiBhcyBwYXRoIGZyb20gJ3BhdGgnO1xuXG5pbXBvcnQge1xuICBQcm9ncmVzc01ldHJpY3MsXG4gIEVycm9yQ2F0ZWdvcnksXG4gIFZhbGlkYXRpb25SZXN1bHRcbn0gZnJvbSAnLi4vLi4vdHlwZXMvY2FtcGFpZ24nO1xuXG5leHBvcnQgaW50ZXJmYWNlIERldGFpbGVkTWV0cmljcyBleHRlbmRzIFByb2dyZXNzTWV0cmljcyB7XG4gIHRpbWVzdGFtcDogRGF0ZTtcbiAgZXJyb3JCcmVha2Rvd246IFJlY29yZDxzdHJpbmcsIG51bWJlcj47XG4gIHdhcm5pbmdCcmVha2Rvd246IFJlY29yZDxzdHJpbmcsIG51bWJlcj47XG4gIGJ1aWxkTWV0cmljczogQnVpbGRNZXRyaWNzO1xuICByZXNvdXJjZU1ldHJpY3M6IFJlc291cmNlTWV0cmljcztcbiAgdHJlbmREYXRhOiBUcmVuZERhdGE7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQnVpbGRNZXRyaWNzIHtcbiAgYnVpbGRUaW1lOiBudW1iZXI7XG4gIGJ1bmRsZVNpemU6IG51bWJlcjtcbiAgY2FjaGVIaXRSYXRlOiBudW1iZXI7XG4gIG1lbW9yeVVzYWdlOiBudW1iZXI7XG4gIGNwdVVzYWdlOiBudW1iZXI7XG4gIGRpc2tVc2FnZTogbnVtYmVyO1xuICBjb21waWxhdGlvblNwZWVkOiBudW1iZXI7IC8vIGZpbGVzIHBlciBzZWNvbmRcbn1cblxuZXhwb3J0IGludGVyZmFjZSBSZXNvdXJjZU1ldHJpY3Mge1xuICBub2RlTWVtb3J5VXNhZ2U6IE5vZGVKUy5NZW1vcnlVc2FnZTtcbiAgc3lzdGVtTWVtb3J5OiB7XG4gICAgdG90YWw6IG51bWJlcjtcbiAgICBmcmVlOiBudW1iZXI7XG4gICAgdXNlZDogbnVtYmVyO1xuICAgIHBlcmNlbnRhZ2U6IG51bWJlcjtcbiAgfTtcbiAgZGlza1NwYWNlOiB7XG4gICAgdG90YWw6IG51bWJlcjtcbiAgICBmcmVlOiBudW1iZXI7XG4gICAgdXNlZDogbnVtYmVyO1xuICAgIHBlcmNlbnRhZ2U6IG51bWJlcjtcbiAgfTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBUcmVuZERhdGEge1xuICBlcnJvclJlZHVjdGlvblJhdGU6IG51bWJlcjsgLy8gZXJyb3JzIHJlZHVjZWQgcGVyIGhvdXJcbiAgd2FybmluZ1JlZHVjdGlvblJhdGU6IG51bWJlcjsgLy8gd2FybmluZ3MgcmVkdWNlZCBwZXIgaG91clxuICBidWlsZFRpbWVJbXByb3ZlbWVudDogbnVtYmVyOyAvLyBzZWNvbmRzIGltcHJvdmVkIHBlciBob3VyXG4gIHN5c3RlbUdyb3d0aFJhdGU6IG51bWJlcjsgLy8gZW50ZXJwcmlzZSBzeXN0ZW1zIGFkZGVkIHBlciBob3VyXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgTWV0cmljc1NuYXBzaG90IHtcbiAgaWQ6IHN0cmluZztcbiAgdGltZXN0YW1wOiBEYXRlO1xuICBtZXRyaWNzOiBEZXRhaWxlZE1ldHJpY3M7XG4gIHBoYXNlOiBzdHJpbmc7XG4gIG1pbGVzdG9uZT86IHN0cmluZztcbiAgbm90ZXM/OiBzdHJpbmc7XG59XG5cbmV4cG9ydCBjbGFzcyBNZXRyaWNzQ29sbGVjdGlvblN5c3RlbSB7XG4gIHByaXZhdGUgc25hcHNob3RzOiBNZXRyaWNzU25hcHNob3RbXSA9IFtdO1xuICBwcml2YXRlIGNvbGxlY3Rpb25JbnRlcnZhbDogTm9kZUpTLlRpbWVvdXQgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSBpc0NvbGxlY3RpbmcgPSBmYWxzZTtcblxuICAvKipcbiAgICogU3RhcnQgcmVhbC10aW1lIG1ldHJpY3MgY29sbGVjdGlvblxuICAgKi9cbiAgc3RhcnRSZWFsVGltZUNvbGxlY3Rpb24oaW50ZXJ2YWxNczogbnVtYmVyID0gMzAwMDApOiB2b2lkIHtcbiAgICBpZiAodGhpcy5pc0NvbGxlY3RpbmcpIHtcbiAgICAgIGNvbnNvbGUubG9nKCfwn5OKIE1ldHJpY3MgY29sbGVjdGlvbiBhbHJlYWR5IHJ1bm5pbmcnKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLmlzQ29sbGVjdGluZyA9IHRydWU7XG4gICAgY29uc29sZS5sb2coYPCfk4ogU3RhcnRpbmcgcmVhbC10aW1lIG1ldHJpY3MgY29sbGVjdGlvbiAoaW50ZXJ2YWw6ICR7aW50ZXJ2YWxNc31tcylgKTtcblxuICAgIHRoaXMuY29sbGVjdGlvbkludGVydmFsID0gc2V0SW50ZXJ2YWwoYXN5bmMgKCkgPT4ge1xuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgdGhpcy5jb2xsZWN0U25hcHNob3QoKTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBkdXJpbmcgbWV0cmljcyBjb2xsZWN0aW9uOicsIChlcnJvciAgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pLm1lc3NhZ2UgfHwgJ1Vua25vd24gZXJyb3InKTtcbiAgICAgIH1cbiAgICB9LCBpbnRlcnZhbE1zKTtcblxuICAgIC8vIENvbGxlY3QgaW5pdGlhbCBzbmFwc2hvdFxuICAgIHRoaXMuY29sbGVjdFNuYXBzaG90KCk7XG4gIH1cblxuICAvKipcbiAgICogU3RvcCByZWFsLXRpbWUgbWV0cmljcyBjb2xsZWN0aW9uXG4gICAqL1xuICBzdG9wUmVhbFRpbWVDb2xsZWN0aW9uKCk6IHZvaWQge1xuICAgIGlmICh0aGlzLmNvbGxlY3Rpb25JbnRlcnZhbCkge1xuICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLmNvbGxlY3Rpb25JbnRlcnZhbCk7XG4gICAgICB0aGlzLmNvbGxlY3Rpb25JbnRlcnZhbCA9IG51bGw7XG4gICAgfVxuICAgIHRoaXMuaXNDb2xsZWN0aW5nID0gZmFsc2U7XG4gICAgY29uc29sZS5sb2coJ/Cfk4ogU3RvcHBlZCByZWFsLXRpbWUgbWV0cmljcyBjb2xsZWN0aW9uJyk7XG4gIH1cblxuICAvKipcbiAgICogQ29sbGVjdCBjb21wcmVoZW5zaXZlIG1ldHJpY3Mgc25hcHNob3RcbiAgICovXG4gIGFzeW5jIGNvbGxlY3RTbmFwc2hvdChwaGFzZT86IHN0cmluZywgbWlsZXN0b25lPzogc3RyaW5nLCBub3Rlcz86IHN0cmluZyk6IFByb21pc2U8TWV0cmljc1NuYXBzaG90PiB7XG4gICAgY29uc3QgdGltZXN0YW1wID0gbmV3IERhdGUoKTtcbiAgICBjb25zdCBpZCA9IGBzbmFwc2hvdF8ke3RpbWVzdGFtcC5nZXRUaW1lKCl9YDtcblxuICAgIGNvbnNvbGUubG9nKCfwn5OKIENvbGxlY3RpbmcgbWV0cmljcyBzbmFwc2hvdC4uLicpO1xuXG4gICAgY29uc3QgbWV0cmljcyA9IGF3YWl0IHRoaXMuY29sbGVjdERldGFpbGVkTWV0cmljcygpO1xuICAgIFxuICAgIGNvbnN0IHNuYXBzaG90OiBNZXRyaWNzU25hcHNob3QgPSB7XG4gICAgICBpZCxcbiAgICAgIHRpbWVzdGFtcCxcbiAgICAgIG1ldHJpY3MsXG4gICAgICBwaGFzZTogcGhhc2UgfHwgJ3Vua25vd24nLFxuICAgICAgbWlsZXN0b25lLFxuICAgICAgbm90ZXNcbiAgICB9O1xuXG4gICAgdGhpcy5zbmFwc2hvdHMucHVzaChzbmFwc2hvdCk7XG5cbiAgICAvLyBLZWVwIG9ubHkgcmVjZW50IHNuYXBzaG90cyB0byBwcmV2ZW50IG1lbW9yeSBpc3N1ZXNcbiAgICBpZiAodGhpcy5zbmFwc2hvdHMubGVuZ3RoID4gMTAwMCkge1xuICAgICAgdGhpcy5zbmFwc2hvdHMgPSB0aGlzLnNuYXBzaG90cy5zbGljZSgtNTAwKTtcbiAgICB9XG5cbiAgICBjb25zb2xlLmxvZyhg8J+TiiBTbmFwc2hvdCBjb2xsZWN0ZWQ6ICR7aWR9YCk7XG4gICAgcmV0dXJuIHNuYXBzaG90O1xuICB9XG5cbiAgLyoqXG4gICAqIENvbGxlY3QgZGV0YWlsZWQgbWV0cmljcyB3aXRoIGNvbXByZWhlbnNpdmUgYW5hbHlzaXNcbiAgICovXG4gIGFzeW5jIGNvbGxlY3REZXRhaWxlZE1ldHJpY3MoKTogUHJvbWlzZTxEZXRhaWxlZE1ldHJpY3M+IHtcbiAgICBjb25zdCBbXG4gICAgICB0eXBlU2NyaXB0TWV0cmljcyxcbiAgICAgIGxpbnRpbmdNZXRyaWNzLFxuICAgICAgYnVpbGRNZXRyaWNzLFxuICAgICAgcmVzb3VyY2VNZXRyaWNzLFxuICAgICAgZW50ZXJwcmlzZVN5c3RlbUNvdW50XG4gICAgXSA9IGF3YWl0IFByb21pc2UuYWxsKFtcbiAgICAgIHRoaXMuY29sbGVjdFR5cGVTY3JpcHRNZXRyaWNzKCksXG4gICAgICB0aGlzLmNvbGxlY3RMaW50aW5nTWV0cmljcygpLFxuICAgICAgdGhpcy5jb2xsZWN0QnVpbGRNZXRyaWNzKCksXG4gICAgICB0aGlzLmNvbGxlY3RSZXNvdXJjZU1ldHJpY3MoKSxcbiAgICAgIHRoaXMuZ2V0RW50ZXJwcmlzZVN5c3RlbUNvdW50KClcbiAgICBdKTtcblxuICAgIGNvbnN0IHRyZW5kRGF0YSA9IHRoaXMuY2FsY3VsYXRlVHJlbmREYXRhKCk7XG5cbiAgICBjb25zdCBkZXRhaWxlZE1ldHJpY3M6IERldGFpbGVkTWV0cmljcyA9IHtcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgIHR5cGVTY3JpcHRFcnJvcnM6IHtcbiAgICAgICAgY3VycmVudDogdHlwZVNjcmlwdE1ldHJpY3MuY291bnQsXG4gICAgICAgIHRhcmdldDogMCxcbiAgICAgICAgcmVkdWN0aW9uOiBNYXRoLm1heCgwLCA4NiAtIHR5cGVTY3JpcHRNZXRyaWNzLmNvdW50KSxcbiAgICAgICAgcGVyY2VudGFnZTogdHlwZVNjcmlwdE1ldHJpY3MuY291bnQgPj0gMCA/IE1hdGgucm91bmQoKCg4NiAtIHR5cGVTY3JpcHRNZXRyaWNzLmNvdW50KSAvIDg2KSAqIDEwMCkgOiAwXG4gICAgICB9LFxuICAgICAgbGludGluZ1dhcm5pbmdzOiB7XG4gICAgICAgIGN1cnJlbnQ6IGxpbnRpbmdNZXRyaWNzLmNvdW50LFxuICAgICAgICB0YXJnZXQ6IDAsXG4gICAgICAgIHJlZHVjdGlvbjogTWF0aC5tYXgoMCwgNDUwNiAtIGxpbnRpbmdNZXRyaWNzLmNvdW50KSxcbiAgICAgICAgcGVyY2VudGFnZTogbGludGluZ01ldHJpY3MuY291bnQgPj0gMCA/IE1hdGgucm91bmQoKCg0NTA2IC0gbGludGluZ01ldHJpY3MuY291bnQpIC8gNDUwNikgKiAxMDApIDogMFxuICAgICAgfSxcbiAgICAgIGJ1aWxkUGVyZm9ybWFuY2U6IHtcbiAgICAgICAgY3VycmVudFRpbWU6IGJ1aWxkTWV0cmljcy5idWlsZFRpbWUsXG4gICAgICAgIHRhcmdldFRpbWU6IDEwLFxuICAgICAgICBjYWNoZUhpdFJhdGU6IGJ1aWxkTWV0cmljcy5jYWNoZUhpdFJhdGUsXG4gICAgICAgIG1lbW9yeVVzYWdlOiBidWlsZE1ldHJpY3MubWVtb3J5VXNhZ2VcbiAgICAgIH0sXG4gICAgICBlbnRlcnByaXNlU3lzdGVtczoge1xuICAgICAgICBjdXJyZW50OiBlbnRlcnByaXNlU3lzdGVtQ291bnQsXG4gICAgICAgIHRhcmdldDogMjAwLFxuICAgICAgICB0cmFuc2Zvcm1lZEV4cG9ydHM6IE1hdGgubWF4KDAsIGVudGVycHJpc2VTeXN0ZW1Db3VudCAtIDApXG4gICAgICB9LFxuICAgICAgZXJyb3JCcmVha2Rvd246IHR5cGVTY3JpcHRNZXRyaWNzLmJyZWFrZG93bixcbiAgICAgIHdhcm5pbmdCcmVha2Rvd246IGxpbnRpbmdNZXRyaWNzLmJyZWFrZG93bixcbiAgICAgIGJ1aWxkTWV0cmljcyxcbiAgICAgIHJlc291cmNlTWV0cmljcyxcbiAgICAgIHRyZW5kRGF0YVxuICAgIH07XG5cbiAgICByZXR1cm4gZGV0YWlsZWRNZXRyaWNzO1xuICB9XG5cbiAgLyoqXG4gICAqIENvbGxlY3QgVHlwZVNjcmlwdCBlcnJvciBtZXRyaWNzIHdpdGggZGV0YWlsZWQgYnJlYWtkb3duXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGNvbGxlY3RUeXBlU2NyaXB0TWV0cmljcygpOiBQcm9taXNlPHtjb3VudDogbnVtYmVyLCBicmVha2Rvd246IFJlY29yZDxzdHJpbmcsIG51bWJlcj59PiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIEdldCB0b3RhbCBlcnJvciBjb3VudFxuICAgICAgY29uc3QgY291bnRPdXRwdXQgPSBleGVjU3luYygneWFybiB0c2MgLS1ub0VtaXQgLS1za2lwTGliQ2hlY2sgMj4mMSB8IGdyZXAgLWMgXCJlcnJvciBUU1wiIHx8IGVjaG8gXCIwXCInLCB7XG4gICAgICAgIGVuY29kaW5nOiAndXRmOCcsXG4gICAgICAgIHN0ZGlvOiAncGlwZSdcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBjb25zdCBjb3VudCA9IHBhcnNlSW50KGNvdW50T3V0cHV0LnRyaW0oKSkgfHwgMDtcblxuICAgICAgLy8gR2V0IGRldGFpbGVkIGJyZWFrZG93biBieSBlcnJvciB0eXBlXG4gICAgICBjb25zdCBicmVha2Rvd246IFJlY29yZDxzdHJpbmcsIG51bWJlcj4gPSB7fTtcbiAgICAgIFxuICAgICAgaWYgKGNvdW50ID4gMCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IGJyZWFrZG93bk91dHB1dCA9IGV4ZWNTeW5jKCd5YXJuIHRzYyAtLW5vRW1pdCAtLXNraXBMaWJDaGVjayAyPiYxIHwgZ3JlcCAtRSBcImVycm9yIFRTXCIgfCBzZWQgXFwncy8uKmVycm9yIC8vXFwnIHwgY3V0IC1kXFwnOlxcJyAtZjEgfCBzb3J0IHwgdW5pcSAtYyB8IHNvcnQgLW5yJywge1xuICAgICAgICAgICAgZW5jb2Rpbmc6ICd1dGY4JyxcbiAgICAgICAgICAgIHN0ZGlvOiAncGlwZSdcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIGNvbnN0IGxpbmVzID0gYnJlYWtkb3duT3V0cHV0LnRyaW0oKS5zcGxpdCgnXFxuJykuZmlsdGVyKGxpbmUgPT4gbGluZS50cmltKCkpO1xuICAgICAgICAgIGZvciAoY29uc3QgbGluZSBvZiBsaW5lcykge1xuICAgICAgICAgICAgY29uc3QgbWF0Y2ggPSBsaW5lLnRyaW0oKS5tYXRjaCgvXlxccyooXFxkKylcXHMrKC4rKSQvKTtcbiAgICAgICAgICAgIGlmIChtYXRjaCkge1xuICAgICAgICAgICAgICBjb25zdCBlcnJvckNvdW50ID0gcGFyc2VJbnQobWF0Y2hbMV0pO1xuICAgICAgICAgICAgICBjb25zdCBlcnJvclR5cGUgPSBtYXRjaFsyXS50cmltKCk7XG4gICAgICAgICAgICAgIGJyZWFrZG93bltlcnJvclR5cGVdID0gZXJyb3JDb3VudDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS53YXJuKCdDb3VsZCBub3QgZ2V0IFR5cGVTY3JpcHQgZXJyb3IgYnJlYWtkb3duOicsIChlcnJvciAgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pLm1lc3NhZ2UgfHwgJ1Vua25vd24gZXJyb3InKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4geyBjb3VudCwgYnJlYWtkb3duIH07XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS53YXJuKCdDb3VsZCBub3QgY29sbGVjdCBUeXBlU2NyaXB0IG1ldHJpY3M6JywgKGVycm9yICBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPikubWVzc2FnZSB8fCAnVW5rbm93biBlcnJvcicpO1xuICAgICAgcmV0dXJuIHsgY291bnQ6IC0xLCBicmVha2Rvd246IHt9IH07XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENvbGxlY3QgbGludGluZyB3YXJuaW5nIG1ldHJpY3Mgd2l0aCBjYXRlZ29yaXplZCBicmVha2Rvd25cbiAgICovXG4gIHByaXZhdGUgYXN5bmMgY29sbGVjdExpbnRpbmdNZXRyaWNzKCk6IFByb21pc2U8e2NvdW50OiBudW1iZXIsIGJyZWFrZG93bjogUmVjb3JkPHN0cmluZywgbnVtYmVyPn0+IHtcbiAgICB0cnkge1xuICAgICAgLy8gR2V0IHRvdGFsIHdhcm5pbmcgY291bnRcbiAgICAgIGNvbnN0IGNvdW50T3V0cHV0ID0gZXhlY1N5bmMoJ3lhcm4gbGludCAyPiYxIHwgZ3JlcCAtYyBcIndhcm5pbmdcIiB8fCBlY2hvIFwiMFwiJywge1xuICAgICAgICBlbmNvZGluZzogJ3V0ZjgnLFxuICAgICAgICBzdGRpbzogJ3BpcGUnXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgY29uc3QgY291bnQgPSBwYXJzZUludChjb3VudE91dHB1dC50cmltKCkpIHx8IDA7XG5cbiAgICAgIC8vIEdldCBkZXRhaWxlZCBicmVha2Rvd24gYnkgd2FybmluZyB0eXBlXG4gICAgICBjb25zdCBicmVha2Rvd246IFJlY29yZDxzdHJpbmcsIG51bWJlcj4gPSB7fTtcbiAgICAgIFxuICAgICAgaWYgKGNvdW50ID4gMCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IGxpbnRPdXRwdXQgPSBleGVjU3luYygneWFybiBsaW50IDI+JjEnLCB7XG4gICAgICAgICAgICBlbmNvZGluZzogJ3V0ZjgnLFxuICAgICAgICAgICAgc3RkaW86ICdwaXBlJ1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgY29uc3QgbGluZXMgPSBsaW50T3V0cHV0LnNwbGl0KCdcXG4nKTtcbiAgICAgICAgICBmb3IgKGNvbnN0IGxpbmUgb2YgbGluZXMpIHtcbiAgICAgICAgICAgIC8vIExvb2sgZm9yIEVTTGludCB3YXJuaW5nIHBhdHRlcm5zXG4gICAgICAgICAgICBjb25zdCB3YXJuaW5nTWF0Y2ggPSBsaW5lLm1hdGNoKC93YXJuaW5nXFxzKyguKz8pXFxzKyhAdHlwZXNjcmlwdC1lc2xpbnRcXC9bXFx3LV0rfFtcXHctXSspLyk7XG4gICAgICAgICAgICBpZiAod2FybmluZ01hdGNoKSB7XG4gICAgICAgICAgICAgIGNvbnN0IHJ1bGVUeXBlID0gd2FybmluZ01hdGNoWzJdO1xuICAgICAgICAgICAgICBicmVha2Rvd25bcnVsZVR5cGVdID0gKGJyZWFrZG93bltydWxlVHlwZV0gfHwgMCkgKyAxO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLndhcm4oJ0NvdWxkIG5vdCBnZXQgbGludGluZyB3YXJuaW5nIGJyZWFrZG93bjonLCAoZXJyb3IgIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KS5tZXNzYWdlIHx8ICdVbmtub3duIGVycm9yJyk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHsgY291bnQsIGJyZWFrZG93biB9O1xuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUud2FybignQ291bGQgbm90IGNvbGxlY3QgbGludGluZyBtZXRyaWNzOicsIChlcnJvciAgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pLm1lc3NhZ2UgfHwgJ1Vua25vd24gZXJyb3InKTtcbiAgICAgIHJldHVybiB7IGNvdW50OiAtMSwgYnJlYWtkb3duOiB7fSB9O1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDb2xsZWN0IGNvbXByZWhlbnNpdmUgYnVpbGQgcGVyZm9ybWFuY2UgbWV0cmljc1xuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBjb2xsZWN0QnVpbGRNZXRyaWNzKCk6IFByb21pc2U8QnVpbGRNZXRyaWNzPiB7XG4gICAgY29uc3Qgc3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICBsZXQgYnVpbGRUaW1lID0gLTE7XG4gICAgbGV0IGJ1bmRsZVNpemUgPSAwO1xuICAgIGxldCBjb21waWxhdGlvblNwZWVkID0gMDtcblxuICAgIHRyeSB7XG4gICAgICAvLyBNZWFzdXJlIGJ1aWxkIHRpbWVcbiAgICAgIGNvbnN0IGJ1aWxkU3RhcnQgPSBEYXRlLm5vdygpO1xuICAgICAgZXhlY1N5bmMoJ3lhcm4gYnVpbGQnLCB7XG4gICAgICAgIGVuY29kaW5nOiAndXRmOCcsXG4gICAgICAgIHN0ZGlvOiAncGlwZSdcbiAgICAgIH0pO1xuICAgICAgYnVpbGRUaW1lID0gKERhdGUubm93KCkgLSBidWlsZFN0YXJ0KSAvIDEwMDA7XG5cbiAgICAgIC8vIENhbGN1bGF0ZSBjb21waWxhdGlvbiBzcGVlZCAocm91Z2ggZXN0aW1hdGUpXG4gICAgICBjb25zdCBzb3VyY2VGaWxlcyA9IHRoaXMuY291bnRTb3VyY2VGaWxlcygpO1xuICAgICAgY29tcGlsYXRpb25TcGVlZCA9IHNvdXJjZUZpbGVzIC8gYnVpbGRUaW1lO1xuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUud2FybignQnVpbGQgZmFpbGVkIGR1cmluZyBtZXRyaWNzIGNvbGxlY3Rpb246JywgKGVycm9yICBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPikubWVzc2FnZSB8fCAnVW5rbm93biBlcnJvcicpO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICAvLyBHZXQgYnVuZGxlIHNpemVcbiAgICAgIGJ1bmRsZVNpemUgPSBhd2FpdCB0aGlzLmdldEJ1bmRsZVNpemUoKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS53YXJuKCdDb3VsZCBub3QgbWVhc3VyZSBidW5kbGUgc2l6ZTonLCAoZXJyb3IgIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KS5tZXNzYWdlIHx8ICdVbmtub3duIGVycm9yJyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIGJ1aWxkVGltZSxcbiAgICAgIGJ1bmRsZVNpemUsXG4gICAgICBjYWNoZUhpdFJhdGU6IGF3YWl0IHRoaXMuZXN0aW1hdGVDYWNoZUhpdFJhdGUoKSxcbiAgICAgIG1lbW9yeVVzYWdlOiB0aGlzLmdldE1lbW9yeVVzYWdlKCksXG4gICAgICBjcHVVc2FnZTogYXdhaXQgdGhpcy5nZXRDcHVVc2FnZSgpLFxuICAgICAgZGlza1VzYWdlOiBhd2FpdCB0aGlzLmdldERpc2tVc2FnZSgpLFxuICAgICAgY29tcGlsYXRpb25TcGVlZFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogQ29sbGVjdCBzeXN0ZW0gcmVzb3VyY2UgbWV0cmljc1xuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBjb2xsZWN0UmVzb3VyY2VNZXRyaWNzKCk6IFByb21pc2U8UmVzb3VyY2VNZXRyaWNzPiB7XG4gICAgY29uc3Qgbm9kZU1lbW9yeVVzYWdlID0gcHJvY2Vzcy5tZW1vcnlVc2FnZSgpO1xuICAgIFxuICAgIHJldHVybiB7XG4gICAgICBub2RlTWVtb3J5VXNhZ2UsXG4gICAgICBzeXN0ZW1NZW1vcnk6IGF3YWl0IHRoaXMuZ2V0U3lzdGVtTWVtb3J5KCksXG4gICAgICBkaXNrU3BhY2U6IGF3YWl0IHRoaXMuZ2V0RGlza1NwYWNlKClcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIENhbGN1bGF0ZSB0cmVuZCBkYXRhIGJhc2VkIG9uIGhpc3RvcmljYWwgc25hcHNob3RzXG4gICAqL1xuICBwcml2YXRlIGNhbGN1bGF0ZVRyZW5kRGF0YSgpOiBUcmVuZERhdGEge1xuICAgIGlmICh0aGlzLnNuYXBzaG90cy5sZW5ndGggPCAyKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBlcnJvclJlZHVjdGlvblJhdGU6IDAsXG4gICAgICAgIHdhcm5pbmdSZWR1Y3Rpb25SYXRlOiAwLFxuICAgICAgICBidWlsZFRpbWVJbXByb3ZlbWVudDogMCxcbiAgICAgICAgc3lzdGVtR3Jvd3RoUmF0ZTogMFxuICAgICAgfTtcbiAgICB9XG5cbiAgICBjb25zdCByZWNlbnQgPSB0aGlzLnNuYXBzaG90cy5zbGljZSgtMTApOyAvLyBMYXN0IDEwIHNuYXBzaG90c1xuICAgIGNvbnN0IHRpbWVTcGFuSG91cnMgPSAocmVjZW50W3JlY2VudC5sZW5ndGggLSAxXS50aW1lc3RhbXAuZ2V0VGltZSgpIC0gcmVjZW50WzBdLnRpbWVzdGFtcC5nZXRUaW1lKCkpIC8gKDEwMDAgKiA2MCAqIDYwKTtcblxuICAgIGlmICh0aW1lU3BhbkhvdXJzID09PSAwKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBlcnJvclJlZHVjdGlvblJhdGU6IDAsXG4gICAgICAgIHdhcm5pbmdSZWR1Y3Rpb25SYXRlOiAwLFxuICAgICAgICBidWlsZFRpbWVJbXByb3ZlbWVudDogMCxcbiAgICAgICAgc3lzdGVtR3Jvd3RoUmF0ZTogMFxuICAgICAgfTtcbiAgICB9XG5cbiAgICBjb25zdCBlcnJvclJlZHVjdGlvbiA9IHJlY2VudFswXS5tZXRyaWNzLnR5cGVTY3JpcHRFcnJvcnMuY3VycmVudCAtIHJlY2VudFtyZWNlbnQubGVuZ3RoIC0gMV0ubWV0cmljcy50eXBlU2NyaXB0RXJyb3JzLmN1cnJlbnQ7XG4gICAgY29uc3Qgd2FybmluZ1JlZHVjdGlvbiA9IHJlY2VudFswXS5tZXRyaWNzLmxpbnRpbmdXYXJuaW5ncy5jdXJyZW50IC0gcmVjZW50W3JlY2VudC5sZW5ndGggLSAxXS5tZXRyaWNzLmxpbnRpbmdXYXJuaW5ncy5jdXJyZW50O1xuICAgIGNvbnN0IGJ1aWxkVGltZUltcHJvdmVtZW50ID0gcmVjZW50WzBdLm1ldHJpY3MuYnVpbGRQZXJmb3JtYW5jZS5jdXJyZW50VGltZSAtIHJlY2VudFtyZWNlbnQubGVuZ3RoIC0gMV0ubWV0cmljcy5idWlsZFBlcmZvcm1hbmNlLmN1cnJlbnRUaW1lO1xuICAgIGNvbnN0IHN5c3RlbUdyb3d0aCA9IHJlY2VudFtyZWNlbnQubGVuZ3RoIC0gMV0ubWV0cmljcy5lbnRlcnByaXNlU3lzdGVtcy5jdXJyZW50IC0gcmVjZW50WzBdLm1ldHJpY3MuZW50ZXJwcmlzZVN5c3RlbXMuY3VycmVudDtcblxuICAgIHJldHVybiB7XG4gICAgICBlcnJvclJlZHVjdGlvblJhdGU6IGVycm9yUmVkdWN0aW9uIC8gdGltZVNwYW5Ib3VycyxcbiAgICAgIHdhcm5pbmdSZWR1Y3Rpb25SYXRlOiB3YXJuaW5nUmVkdWN0aW9uIC8gdGltZVNwYW5Ib3VycyxcbiAgICAgIGJ1aWxkVGltZUltcHJvdmVtZW50OiBidWlsZFRpbWVJbXByb3ZlbWVudCAvIHRpbWVTcGFuSG91cnMsXG4gICAgICBzeXN0ZW1Hcm93dGhSYXRlOiBzeXN0ZW1Hcm93dGggLyB0aW1lU3BhbkhvdXJzXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBIZWxwZXIgbWV0aG9kcyBmb3IgbWV0cmljcyBjb2xsZWN0aW9uXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGdldEVudGVycHJpc2VTeXN0ZW1Db3VudCgpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBvdXRwdXQgPSBleGVjU3luYygnZ3JlcCAtciBcIklOVEVMTElHRU5DRV9TWVNURU1cIiBzcmMvIHwgd2MgLWwnLCB7XG4gICAgICAgIGVuY29kaW5nOiAndXRmOCcsXG4gICAgICAgIHN0ZGlvOiAncGlwZSdcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHBhcnNlSW50KG91dHB1dC50cmltKCkpIHx8IDA7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZ2V0QnVuZGxlU2l6ZSgpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBidWlsZERpcnMgPSBbJy5uZXh0JywgJ2Rpc3QnLCAnYnVpbGQnXTtcbiAgICAgIGxldCB0b3RhbFNpemUgPSAwO1xuXG4gICAgICBmb3IgKGNvbnN0IGRpciBvZiBidWlsZERpcnMpIHtcbiAgICAgICAgaWYgKGZzLmV4aXN0c1N5bmMoZGlyKSkge1xuICAgICAgICAgIGNvbnN0IG91dHB1dCA9IGV4ZWNTeW5jKGBkdSAtc2sgJHtkaXJ9IHwgY3V0IC1mMWAsIHtcbiAgICAgICAgICAgIGVuY29kaW5nOiAndXRmOCcsXG4gICAgICAgICAgICBzdGRpbzogJ3BpcGUnXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgdG90YWxTaXplICs9IHBhcnNlSW50KG91dHB1dC50cmltKCkpIHx8IDA7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRvdGFsU2l6ZTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgcmV0dXJuIDA7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBlc3RpbWF0ZUNhY2hlSGl0UmF0ZSgpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgIC8vIFRoaXMgaXMgYSBzaW1wbGlmaWVkIGVzdGltYXRpb24gLSBpbiBhIHJlYWwgaW1wbGVtZW50YXRpb24sXG4gICAgLy8geW91J2QgaW50ZWdyYXRlIHdpdGggdGhlIGFjdHVhbCBidWlsZCBzeXN0ZW0ncyBjYWNoZSBtZXRyaWNzXG4gICAgcmV0dXJuIDAuODsgLy8gODAlIGRlZmF1bHQgZXN0aW1hdGVcbiAgfVxuXG4gIHByaXZhdGUgZ2V0TWVtb3J5VXNhZ2UoKTogbnVtYmVyIHtcbiAgICBjb25zdCBtZW1Vc2FnZSA9IHByb2Nlc3MubWVtb3J5VXNhZ2UoKTtcbiAgICByZXR1cm4gTWF0aC5yb3VuZChtZW1Vc2FnZS5oZWFwVXNlZCAvIDEwMjQgLyAxMDI0KTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZ2V0Q3B1VXNhZ2UoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3Qgb3V0cHV0ID0gZXhlY1N5bmMoJ3BzIC1vICVjcHUgLXAgJCQgfCB0YWlsIC0xJywge1xuICAgICAgICBlbmNvZGluZzogJ3V0ZjgnLFxuICAgICAgICBzdGRpbzogJ3BpcGUnXG4gICAgICB9KTtcbiAgICAgIHJldHVybiBwYXJzZUZsb2F0KG91dHB1dC50cmltKCkpIHx8IDA7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZ2V0RGlza1VzYWdlKCk6IFByb21pc2U8bnVtYmVyPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IG91dHB1dCA9IGV4ZWNTeW5jKCdkdSAtc2ggLiB8IGN1dCAtZjEnLCB7XG4gICAgICAgIGVuY29kaW5nOiAndXRmOCcsXG4gICAgICAgIHN0ZGlvOiAncGlwZSdcbiAgICAgIH0pO1xuICAgICAgLy8gQ29udmVydCB0byBNQiAocm91Z2ggZXN0aW1hdGlvbilcbiAgICAgIGNvbnN0IHNpemVTdHIgPSBvdXRwdXQudHJpbSgpO1xuICAgICAgaWYgKHNpemVTdHIuaW5jbHVkZXMoJ0cnKSkge1xuICAgICAgICByZXR1cm4gcGFyc2VGbG9hdChzaXplU3RyKSAqIDEwMjQ7XG4gICAgICB9IGVsc2UgaWYgKHNpemVTdHIuaW5jbHVkZXMoJ00nKSkge1xuICAgICAgICByZXR1cm4gcGFyc2VGbG9hdChzaXplU3RyKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiAwO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICByZXR1cm4gMDtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNvdW50U291cmNlRmlsZXMoKTogbnVtYmVyIHtcbiAgICB0cnkge1xuICAgICAgY29uc3Qgb3V0cHV0ID0gZXhlY1N5bmMoJ2ZpbmQgc3JjIC1uYW1lIFwiKi50c1wiIC1vIC1uYW1lIFwiKi50c3hcIiB8IHdjIC1sJywge1xuICAgICAgICBlbmNvZGluZzogJ3V0ZjgnLFxuICAgICAgICBzdGRpbzogJ3BpcGUnXG4gICAgICB9KTtcbiAgICAgIHJldHVybiBwYXJzZUludChvdXRwdXQudHJpbSgpKSB8fCAwO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICByZXR1cm4gMDtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGdldFN5c3RlbU1lbW9yeSgpOiBQcm9taXNlPFJlc291cmNlTWV0cmljc1snc3lzdGVtTWVtb3J5J10+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3Qgb3V0cHV0ID0gZXhlY1N5bmMoJ2ZyZWUgLW0gfCBncmVwIE1lbScsIHtcbiAgICAgICAgZW5jb2Rpbmc6ICd1dGY4JyxcbiAgICAgICAgc3RkaW86ICdwaXBlJ1xuICAgICAgfSk7XG4gICAgICBcbiAgICAgIGNvbnN0IG1hdGNoID0gb3V0cHV0Lm1hdGNoKC9NZW06XFxzKyhcXGQrKVxccysoXFxkKylcXHMrKFxcZCspLyk7XG4gICAgICBpZiAobWF0Y2gpIHtcbiAgICAgICAgY29uc3QgdG90YWwgPSBwYXJzZUludChtYXRjaFsxXSk7XG4gICAgICAgIGNvbnN0IHVzZWQgPSBwYXJzZUludChtYXRjaFsyXSk7XG4gICAgICAgIGNvbnN0IGZyZWUgPSBwYXJzZUludChtYXRjaFszXSk7XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgdG90YWwsXG4gICAgICAgICAgdXNlZCxcbiAgICAgICAgICBmcmVlLFxuICAgICAgICAgIHBlcmNlbnRhZ2U6IE1hdGgucm91bmQoKHVzZWQgLyB0b3RhbCkgKiAxMDApXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIC8vIEZhbGxiYWNrIGZvciBub24tTGludXggc3lzdGVtc1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICB0b3RhbDogMCxcbiAgICAgIHVzZWQ6IDAsXG4gICAgICBmcmVlOiAwLFxuICAgICAgcGVyY2VudGFnZTogMFxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGdldERpc2tTcGFjZSgpOiBQcm9taXNlPFJlc291cmNlTWV0cmljc1snZGlza1NwYWNlJ10+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3Qgb3V0cHV0ID0gZXhlY1N5bmMoJ2RmIC1oIC4gfCB0YWlsIC0xJywge1xuICAgICAgICBlbmNvZGluZzogJ3V0ZjgnLFxuICAgICAgICBzdGRpbzogJ3BpcGUnXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgY29uc3QgcGFydHMgPSBvdXRwdXQudHJpbSgpLnNwbGl0KC9cXHMrLyk7XG4gICAgICBpZiAocGFydHMubGVuZ3RoID49IDQpIHtcbiAgICAgICAgY29uc3QgdG90YWwgPSB0aGlzLnBhcnNlU2l6ZShwYXJ0c1sxXSk7XG4gICAgICAgIGNvbnN0IHVzZWQgPSB0aGlzLnBhcnNlU2l6ZShwYXJ0c1syXSk7XG4gICAgICAgIGNvbnN0IGZyZWUgPSB0aGlzLnBhcnNlU2l6ZShwYXJ0c1szXSk7XG4gICAgICAgIFxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHRvdGFsLFxuICAgICAgICAgIHVzZWQsXG4gICAgICAgICAgZnJlZSxcbiAgICAgICAgICBwZXJjZW50YWdlOiBNYXRoLnJvdW5kKCh1c2VkIC8gdG90YWwpICogMTAwKVxuICAgICAgICB9O1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAvLyBIYW5kbGUgZXJyb3JcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgdG90YWw6IDAsXG4gICAgICB1c2VkOiAwLFxuICAgICAgZnJlZTogMCxcbiAgICAgIHBlcmNlbnRhZ2U6IDBcbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBwYXJzZVNpemUoc2l6ZVN0cjogc3RyaW5nKTogbnVtYmVyIHtcbiAgICBjb25zdCBudW0gPSBwYXJzZUZsb2F0KHNpemVTdHIpO1xuICAgIGlmIChzaXplU3RyLmluY2x1ZGVzKCdHJykpIHJldHVybiBudW0gKiAxMDI0O1xuICAgIGlmIChzaXplU3RyLmluY2x1ZGVzKCdNJykpIHJldHVybiBudW07XG4gICAgaWYgKHNpemVTdHIuaW5jbHVkZXMoJ0snKSkgcmV0dXJuIG51bSAvIDEwMjQ7XG4gICAgcmV0dXJuIG51bTtcbiAgfVxuXG4gIC8qKlxuICAgKiBFeHBvcnQgbWV0aG9kcyBmb3IgZXh0ZXJuYWwgYWNjZXNzXG4gICAqL1xuICBnZXRTbmFwc2hvdHMoKTogTWV0cmljc1NuYXBzaG90W10ge1xuICAgIHJldHVybiBbLi4udGhpcy5zbmFwc2hvdHNdO1xuICB9XG5cbiAgZ2V0TGF0ZXN0U25hcHNob3QoKTogTWV0cmljc1NuYXBzaG90IHwgbnVsbCB7XG4gICAgcmV0dXJuIHRoaXMuc25hcHNob3RzLmxlbmd0aCA+IDAgPyB0aGlzLnNuYXBzaG90c1t0aGlzLnNuYXBzaG90cy5sZW5ndGggLSAxXSA6IG51bGw7XG4gIH1cblxuICBhc3luYyBleHBvcnRTbmFwc2hvdHMoZmlsZVBhdGg6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IGV4cG9ydERhdGEgPSB7XG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgIHRvdGFsU25hcHNob3RzOiB0aGlzLnNuYXBzaG90cy5sZW5ndGgsXG4gICAgICBzbmFwc2hvdHM6IHRoaXMuc25hcHNob3RzLFxuICAgICAgc3VtbWFyeToge1xuICAgICAgICBjb2xsZWN0aW9uUGVyaW9kOiB0aGlzLnNuYXBzaG90cy5sZW5ndGggPiAwID8ge1xuICAgICAgICAgIHN0YXJ0OiB0aGlzLnNuYXBzaG90c1swXS50aW1lc3RhbXAsXG4gICAgICAgICAgZW5kOiB0aGlzLnNuYXBzaG90c1t0aGlzLnNuYXBzaG90cy5sZW5ndGggLSAxXS50aW1lc3RhbXBcbiAgICAgICAgfSA6IG51bGwsXG4gICAgICAgIHRyZW5kczogdGhpcy5jYWxjdWxhdGVUcmVuZERhdGEoKVxuICAgICAgfVxuICAgIH07XG5cbiAgICBmcy53cml0ZUZpbGVTeW5jKGZpbGVQYXRoLCBKU09OLnN0cmluZ2lmeShleHBvcnREYXRhLCBudWxsLCAyKSk7XG4gICAgY29uc29sZS5sb2coYPCfk4ogTWV0cmljcyBzbmFwc2hvdHMgZXhwb3J0ZWQgdG86ICR7ZmlsZVBhdGh9YCk7XG4gIH1cblxuICBjbGVhclNuYXBzaG90cygpOiB2b2lkIHtcbiAgICB0aGlzLnNuYXBzaG90cyA9IFtdO1xuICAgIGNvbnNvbGUubG9nKCfwn5OKIE1ldHJpY3Mgc25hcHNob3RzIGNsZWFyZWQnKTtcbiAgfVxufSJdLCJ2ZXJzaW9uIjozfQ==