eab5d549bfddc1b7434eaf609fcb81a4
"use strict";
/**
 * Tests for LintingAnalysisService
 */
Object.defineProperty(exports, "__esModule", { value: true });
// Mock all external dependencies first
jest.mock('child_process');
jest.mock('fs');
jest.mock('path');
// Mock child_process to prevent actual ESLint execution during tests
jest.mock('child_process', () => ({
    execSync: jest.fn().mockReturnValue(JSON.stringify([
        {
            filePath: '/test/src/App.tsx',
            messages: [
                {
                    ruleId: 'import/order',
                    severity: 2,
                    message: 'Import order is incorrect',
                    line: 1,
                    column: 1,
                    fix: { range: [0, 10], text: 'fixed import' }
                },
                {
                    ruleId: '@typescript-eslint/no-explicit-any',
                    severity: 1,
                    message: 'Unexpected any type',
                    line: 5,
                    column: 10
                }
            ]
        }
    ]))
}));
// Mock fs to prevent actual file system access during tests
jest.mock('fs', () => ({
    existsSync: jest.fn().mockReturnValue(true),
    readFileSync: jest.fn().mockReturnValue(`
    import React from 'react';
    import { useState } from 'react';
    
    const component: any = {};
    
    function TestComponent() {
      const [state, setState] = useState(0);
      return <div>Test</div>;
    }
  `),
    statSync: jest.fn().mockReturnValue({ mtime: new Date() })
}));
const LintingAnalysisService_1 = require("../LintingAnalysisService");
describe('LintingAnalysisService', () => {
    let service;
    beforeEach(() => {
        service = new LintingAnalysisService_1.LintingAnalysisService('/test');
        // Clear mocks
        jest.clearAllMocks();
    });
    describe('Quick Analysis', () => {
        it('should perform quick analysis without errors', async () => {
            const result = await service.performQuickAnalysis();
            expect(result).toBeDefined();
            expect(result.summary).toBeDefined();
            expect(result.summary.totalIssues).toBeGreaterThan(0);
            expect(result.topIssues).toBeDefined();
            expect(result.quickWins).toBeDefined();
            expect(result.criticalIssues).toBeDefined();
        });
        it('should identify auto-fixable issues as quick wins', async () => {
            const result = await service.performQuickAnalysis();
            // Should have at least one quick win (import/order is auto-fixable)
            expect(result.quickWins.length).toBeGreaterThan(0);
            expect(result.quickWins[0].autoFixable).toBe(true);
        });
        it('should categorize issues by severity', async () => {
            const result = await service.performQuickAnalysis();
            expect(result.summary.errorCount).toBeGreaterThanOrEqual(0);
            expect(result.summary.warningCount).toBeGreaterThanOrEqual(0);
            expect(result.summary.totalIssues).toBe(result.summary.errorCount + result.summary.warningCount);
        });
    });
    describe('Comprehensive Analysis', () => {
        it('should perform comprehensive analysis with default options', async () => {
            const result = await service.performComprehensiveAnalysis();
            expect(result).toBeDefined();
            expect(result.summary).toBeDefined();
            expect(result.categorizedErrors).toBeDefined();
            expect(result.fileAnalyses).toBeDefined();
            expect(result.resolutionStrategies).toBeDefined();
            expect(result.optimizedPlan).toBeDefined();
            expect(result.recommendations).toBeDefined();
            expect(result.metrics).toBeDefined();
        });
        it('should generate resolution strategies when requested', async () => {
            const result = await service.performComprehensiveAnalysis({
                generateStrategies: true
            });
            expect(result.resolutionStrategies.length).toBeGreaterThan(0);
            expect(result.optimizedPlan.totalStrategies).toBeGreaterThan(0);
        });
        it('should skip file analysis when disabled', async () => {
            const result = await service.performComprehensiveAnalysis({
                includeFileAnalysis: false
            });
            expect(result.fileAnalyses).toHaveLength(0);
        });
        it('should focus on specific areas when requested', async () => {
            const result = await service.performComprehensiveAnalysis({
                focusAreas: ['import', 'typescript']
            });
            expect(result).toBeDefined();
            // Should still work with focus areas
            expect(result.summary.totalIssues).toBeGreaterThanOrEqual(0);
        });
        it('should generate appropriate recommendations', async () => {
            const result = await service.performComprehensiveAnalysis();
            expect(result.recommendations).toBeDefined();
            expect(result.recommendations.length).toBeGreaterThan(0);
            // Should have at least one recommendation
            const firstRec = result.recommendations[0];
            expect(firstRec.title).toBeDefined();
            expect(firstRec.description).toBeDefined();
            expect(firstRec.actionItems).toBeDefined();
            expect(firstRec.actionItems.length).toBeGreaterThan(0);
        });
        it('should calculate comprehensive metrics', async () => {
            const result = await service.performComprehensiveAnalysis();
            expect(result.metrics).toBeDefined();
            expect(result.metrics.analysisTime).toBeGreaterThan(0);
            expect(result.metrics.filesAnalyzed).toBeGreaterThanOrEqual(0);
            expect(result.metrics.rulesTriggered).toBeDefined();
            expect(result.metrics.domainDistribution).toBeDefined();
            expect(result.metrics.severityDistribution).toBeDefined();
            expect(result.metrics.confidenceScores).toBeDefined();
        });
    });
    describe('Error Handling', () => {
        it('should handle ESLint execution errors gracefully', async () => {
            // Mock execSync to throw an error
            const mockExecSync = require('child_process').execSync;
            mockExecSync.mockImplementationOnce(() => {
                const error = new Error('ESLint failed');
                error.stdout = '[]'; // Empty results
                throw error;
            });
            // Should not throw, but handle gracefully
            const result = await service.performQuickAnalysis();
            expect(result).toBeDefined();
        });
        it('should handle file system errors gracefully', async () => {
            // Mock fs.readFileSync to throw an error
            const mockReadFileSync = require('fs').readFileSync;
            mockReadFileSync.mockImplementationOnce(() => {
                throw new Error('File not found');
            });
            // Should still work with file system errors
            const result = await service.performQuickAnalysis();
            expect(result).toBeDefined();
        });
    });
    describe('Integration', () => {
        it('should integrate all analysis components', async () => {
            const result = await service.performComprehensiveAnalysis({
                includeFileAnalysis: true,
                generateStrategies: true,
                projectContext: {
                    hasTests: true,
                    teamSize: 'small',
                    riskTolerance: 'moderate'
                }
            });
            // Verify all components worked together
            expect(result.categorizedErrors.total).toBeGreaterThan(0);
            expect(result.fileAnalyses.length).toBeGreaterThan(0);
            expect(result.resolutionStrategies.length).toBeGreaterThan(0);
            expect(result.recommendations.length).toBeGreaterThan(0);
            // Verify data consistency
            expect(result.summary.totalIssues).toBe(result.categorizedErrors.total);
            expect(result.optimizedPlan.totalStrategies).toBe(result.resolutionStrategies.length);
        });
        it('should provide consistent analysis results', async () => {
            // Run analysis twice and compare results
            const result1 = await service.performQuickAnalysis();
            const result2 = await service.performQuickAnalysis();
            expect(result1.summary.totalIssues).toBe(result2.summary.totalIssues);
            expect(result1.summary.errorCount).toBe(result2.summary.errorCount);
            expect(result1.summary.warningCount).toBe(result2.summary.warningCount);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9zZXJ2aWNlcy9saW50aW5nL19fdGVzdHNfXy9MaW50aW5nQW5hbHlzaXNTZXJ2aWNlLnRlc3QudHMiLCJtYXBwaW5ncyI6IjtBQUFBOztHQUVHOztBQUVILHVDQUF1QztBQUN2QyxJQUFJLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFDO0FBQzNCLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7QUFDaEIsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztBQUlsQixxRUFBcUU7QUFDckUsSUFBSSxDQUFDLElBQUksQ0FBQyxlQUFlLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUNoQyxRQUFRLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDO1FBQ2pEO1lBQ0UsUUFBUSxFQUFFLG1CQUFtQjtZQUM3QixRQUFRLEVBQUU7Z0JBQ1I7b0JBQ0UsTUFBTSxFQUFFLGNBQWM7b0JBQ3RCLFFBQVEsRUFBRSxDQUFDO29CQUNYLE9BQU8sRUFBRSwyQkFBMkI7b0JBQ3BDLElBQUksRUFBRSxDQUFDO29CQUNQLE1BQU0sRUFBRSxDQUFDO29CQUNULEdBQUcsRUFBRSxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsRUFBRSxJQUFJLEVBQUUsY0FBYyxFQUFFO2lCQUM5QztnQkFDRDtvQkFDRSxNQUFNLEVBQUUsb0NBQW9DO29CQUM1QyxRQUFRLEVBQUUsQ0FBQztvQkFDWCxPQUFPLEVBQUUscUJBQXFCO29CQUM5QixJQUFJLEVBQUUsQ0FBQztvQkFDUCxNQUFNLEVBQUUsRUFBRTtpQkFDWDthQUNGO1NBQ0Y7S0FDRixDQUFDLENBQUM7Q0FDSixDQUFDLENBQUMsQ0FBQztBQUVKLDREQUE0RDtBQUM1RCxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQ3JC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TyxDQUFDLFlBQVksQ0FBQyxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQzFFLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvR3JlZ0Nhc3Ryby9EZXNrdG9wL1doYXRUb0VhdE5leHQvc3JjL3NlcnZpY2VzL2xpbnRpbmcvX190ZXN0c19fL0xpbnRpbmdBbmFseXNpc1NlcnZpY2UudGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFRlc3RzIGZvciBMaW50aW5nQW5hbHlzaXNTZXJ2aWNlXG4gKi9cblxuLy8gTW9jayBhbGwgZXh0ZXJuYWwgZGVwZW5kZW5jaWVzIGZpcnN0XG5qZXN0Lm1vY2soJ2NoaWxkX3Byb2Nlc3MnKTtcbmplc3QubW9jaygnZnMnKTtcbmplc3QubW9jaygncGF0aCcpO1xuXG5pbXBvcnQgeyBMaW50aW5nQW5hbHlzaXNTZXJ2aWNlIH0gZnJvbSAnLi4vTGludGluZ0FuYWx5c2lzU2VydmljZSc7XG5cbi8vIE1vY2sgY2hpbGRfcHJvY2VzcyB0byBwcmV2ZW50IGFjdHVhbCBFU0xpbnQgZXhlY3V0aW9uIGR1cmluZyB0ZXN0c1xuamVzdC5tb2NrKCdjaGlsZF9wcm9jZXNzJywgKCkgPT4gKHtcbiAgZXhlY1N5bmM6IGplc3QuZm4oKS5tb2NrUmV0dXJuVmFsdWUoSlNPTi5zdHJpbmdpZnkoW1xuICAgIHtcbiAgICAgIGZpbGVQYXRoOiAnL3Rlc3Qvc3JjL0FwcC50c3gnLFxuICAgICAgbWVzc2FnZXM6IFtcbiAgICAgICAge1xuICAgICAgICAgIHJ1bGVJZDogJ2ltcG9ydC9vcmRlcicsXG4gICAgICAgICAgc2V2ZXJpdHk6IDIsXG4gICAgICAgICAgbWVzc2FnZTogJ0ltcG9ydCBvcmRlciBpcyBpbmNvcnJlY3QnLFxuICAgICAgICAgIGxpbmU6IDEsXG4gICAgICAgICAgY29sdW1uOiAxLFxuICAgICAgICAgIGZpeDogeyByYW5nZTogWzAsIDEwXSwgdGV4dDogJ2ZpeGVkIGltcG9ydCcgfVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgcnVsZUlkOiAnQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueScsXG4gICAgICAgICAgc2V2ZXJpdHk6IDEsXG4gICAgICAgICAgbWVzc2FnZTogJ1VuZXhwZWN0ZWQgYW55IHR5cGUnLFxuICAgICAgICAgIGxpbmU6IDUsXG4gICAgICAgICAgY29sdW1uOiAxMFxuICAgICAgICB9XG4gICAgICBdXG4gICAgfVxuICBdKSlcbn0pKTtcblxuLy8gTW9jayBmcyB0byBwcmV2ZW50IGFjdHVhbCBmaWxlIHN5c3RlbSBhY2Nlc3MgZHVyaW5nIHRlc3RzXG5qZXN0Lm1vY2soJ2ZzJywgKCkgPT4gKHtcbiAgZXhpc3RzU3luYzogamVzdC5mbigpLm1vY2tSZXR1cm5WYWx1ZSh0cnVlKSxcbiAgcmVhZEZpbGVTeW5jOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKGBcbiAgICBpbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuICAgIGltcG9ydCB7IHVzZVN0YXRlIH0gZnJvbSAncmVhY3QnO1xuICAgIFxuICAgIGNvbnN0IGNvbXBvbmVudDogYW55ID0ge307XG4gICAgXG4gICAgZnVuY3Rpb24gVGVzdENvbXBvbmVudCgpIHtcbiAgICAgIGNvbnN0IFtzdGF0ZSwgc2V0U3RhdGVdID0gdXNlU3RhdGUoMCk7XG4gICAgICByZXR1cm4gPGRpdj5UZXN0PC9kaXY+O1xuICAgIH1cbiAgYCksXG4gIHN0YXRTeW5jOiBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHsgbXRpbWU6IG5ldyBEYXRlKCkgfSlcbn0pKTtcblxuZGVzY3JpYmUoJ0xpbnRpbmdBbmFseXNpc1NlcnZpY2UnLCAoKSA9PiB7XG4gIGxldCBzZXJ2aWNlOiBMaW50aW5nQW5hbHlzaXNTZXJ2aWNlO1xuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIHNlcnZpY2UgPSBuZXcgTGludGluZ0FuYWx5c2lzU2VydmljZSgnL3Rlc3QnKTtcbiAgICAvLyBDbGVhciBtb2Nrc1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICB9KTtcblxuICBkZXNjcmliZSgnUXVpY2sgQW5hbHlzaXMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBwZXJmb3JtIHF1aWNrIGFuYWx5c2lzIHdpdGhvdXQgZXJyb3JzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5wZXJmb3JtUXVpY2tBbmFseXNpcygpO1xuICAgICAgXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5zdW1tYXJ5KS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5zdW1tYXJ5LnRvdGFsSXNzdWVzKS50b0JlR3JlYXRlclRoYW4oMCk7XG4gICAgICBleHBlY3QocmVzdWx0LnRvcElzc3VlcykudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQucXVpY2tXaW5zKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5jcml0aWNhbElzc3VlcykudG9CZURlZmluZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaWRlbnRpZnkgYXV0by1maXhhYmxlIGlzc3VlcyBhcyBxdWljayB3aW5zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5wZXJmb3JtUXVpY2tBbmFseXNpcygpO1xuICAgICAgXG4gICAgICAvLyBTaG91bGQgaGF2ZSBhdCBsZWFzdCBvbmUgcXVpY2sgd2luIChpbXBvcnQvb3JkZXIgaXMgYXV0by1maXhhYmxlKVxuICAgICAgZXhwZWN0KHJlc3VsdC5xdWlja1dpbnMubGVuZ3RoKS50b0JlR3JlYXRlclRoYW4oMCk7XG4gICAgICBleHBlY3QocmVzdWx0LnF1aWNrV2luc1swXS5hdXRvRml4YWJsZSkudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgY2F0ZWdvcml6ZSBpc3N1ZXMgYnkgc2V2ZXJpdHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLnBlcmZvcm1RdWlja0FuYWx5c2lzKCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHQuc3VtbWFyeS5lcnJvckNvdW50KS50b0JlR3JlYXRlclRoYW5PckVxdWFsKDApO1xuICAgICAgZXhwZWN0KHJlc3VsdC5zdW1tYXJ5Lndhcm5pbmdDb3VudCkudG9CZUdyZWF0ZXJUaGFuT3JFcXVhbCgwKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuc3VtbWFyeS50b3RhbElzc3VlcykudG9CZShyZXN1bHQuc3VtbWFyeS5lcnJvckNvdW50ICsgcmVzdWx0LnN1bW1hcnkud2FybmluZ0NvdW50KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0NvbXByZWhlbnNpdmUgQW5hbHlzaXMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBwZXJmb3JtIGNvbXByZWhlbnNpdmUgYW5hbHlzaXMgd2l0aCBkZWZhdWx0IG9wdGlvbnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLnBlcmZvcm1Db21wcmVoZW5zaXZlQW5hbHlzaXMoKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuc3VtbWFyeSkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuY2F0ZWdvcml6ZWRFcnJvcnMpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QocmVzdWx0LmZpbGVBbmFseXNlcykudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQucmVzb2x1dGlvblN0cmF0ZWdpZXMpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QocmVzdWx0Lm9wdGltaXplZFBsYW4pLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QocmVzdWx0LnJlY29tbWVuZGF0aW9ucykudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQubWV0cmljcykudG9CZURlZmluZWQoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZ2VuZXJhdGUgcmVzb2x1dGlvbiBzdHJhdGVnaWVzIHdoZW4gcmVxdWVzdGVkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5wZXJmb3JtQ29tcHJlaGVuc2l2ZUFuYWx5c2lzKHtcbiAgICAgICAgZ2VuZXJhdGVTdHJhdGVnaWVzOiB0cnVlXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHJlc3VsdC5yZXNvbHV0aW9uU3RyYXRlZ2llcy5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICAgIGV4cGVjdChyZXN1bHQub3B0aW1pemVkUGxhbi50b3RhbFN0cmF0ZWdpZXMpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgc2tpcCBmaWxlIGFuYWx5c2lzIHdoZW4gZGlzYWJsZWQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzZXJ2aWNlLnBlcmZvcm1Db21wcmVoZW5zaXZlQW5hbHlzaXMoe1xuICAgICAgICBpbmNsdWRlRmlsZUFuYWx5c2lzOiBmYWxzZVxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHQuZmlsZUFuYWx5c2VzKS50b0hhdmVMZW5ndGgoMCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGZvY3VzIG9uIHNwZWNpZmljIGFyZWFzIHdoZW4gcmVxdWVzdGVkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5wZXJmb3JtQ29tcHJlaGVuc2l2ZUFuYWx5c2lzKHtcbiAgICAgICAgZm9jdXNBcmVhczogWydpbXBvcnQnLCAndHlwZXNjcmlwdCddXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHJlc3VsdCkudG9CZURlZmluZWQoKTtcbiAgICAgIC8vIFNob3VsZCBzdGlsbCB3b3JrIHdpdGggZm9jdXMgYXJlYXNcbiAgICAgIGV4cGVjdChyZXN1bHQuc3VtbWFyeS50b3RhbElzc3VlcykudG9CZUdyZWF0ZXJUaGFuT3JFcXVhbCgwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZ2VuZXJhdGUgYXBwcm9wcmlhdGUgcmVjb21tZW5kYXRpb25zJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5wZXJmb3JtQ29tcHJlaGVuc2l2ZUFuYWx5c2lzKCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHQucmVjb21tZW5kYXRpb25zKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5yZWNvbW1lbmRhdGlvbnMubGVuZ3RoKS50b0JlR3JlYXRlclRoYW4oMCk7XG4gICAgICBcbiAgICAgIC8vIFNob3VsZCBoYXZlIGF0IGxlYXN0IG9uZSByZWNvbW1lbmRhdGlvblxuICAgICAgY29uc3QgZmlyc3RSZWMgPSByZXN1bHQucmVjb21tZW5kYXRpb25zWzBdO1xuICAgICAgZXhwZWN0KGZpcnN0UmVjLnRpdGxlKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KGZpcnN0UmVjLmRlc2NyaXB0aW9uKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KGZpcnN0UmVjLmFjdGlvbkl0ZW1zKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KGZpcnN0UmVjLmFjdGlvbkl0ZW1zLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBjYWxjdWxhdGUgY29tcHJlaGVuc2l2ZSBtZXRyaWNzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc2VydmljZS5wZXJmb3JtQ29tcHJlaGVuc2l2ZUFuYWx5c2lzKCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHQubWV0cmljcykudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQubWV0cmljcy5hbmFseXNpc1RpbWUpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICAgIGV4cGVjdChyZXN1bHQubWV0cmljcy5maWxlc0FuYWx5emVkKS50b0JlR3JlYXRlclRoYW5PckVxdWFsKDApO1xuICAgICAgZXhwZWN0KHJlc3VsdC5tZXRyaWNzLnJ1bGVzVHJpZ2dlcmVkKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5tZXRyaWNzLmRvbWFpbkRpc3RyaWJ1dGlvbikudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQubWV0cmljcy5zZXZlcml0eURpc3RyaWJ1dGlvbikudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQubWV0cmljcy5jb25maWRlbmNlU2NvcmVzKS50b0JlRGVmaW5lZCgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnRXJyb3IgSGFuZGxpbmcnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgRVNMaW50IGV4ZWN1dGlvbiBlcnJvcnMgZ3JhY2VmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIE1vY2sgZXhlY1N5bmMgdG8gdGhyb3cgYW4gZXJyb3JcbiAgICAgIGNvbnN0IG1vY2tFeGVjU3luYyA9IHJlcXVpcmUoJ2NoaWxkX3Byb2Nlc3MnKS5leGVjU3luYztcbiAgICAgIG1vY2tFeGVjU3luYy5tb2NrSW1wbGVtZW50YXRpb25PbmNlKCgpID0+IHtcbiAgICAgICAgY29uc3QgZXJyb3IgPSBuZXcgRXJyb3IoJ0VTTGludCBmYWlsZWQnKTtcbiAgICAgICAgKGVycm9yIGFzIGFueSkuc3Rkb3V0ID0gJ1tdJzsgLy8gRW1wdHkgcmVzdWx0c1xuICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgIH0pO1xuXG4gICAgICAvLyBTaG91bGQgbm90IHRocm93LCBidXQgaGFuZGxlIGdyYWNlZnVsbHlcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UucGVyZm9ybVF1aWNrQW5hbHlzaXMoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBmaWxlIHN5c3RlbSBlcnJvcnMgZ3JhY2VmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIE1vY2sgZnMucmVhZEZpbGVTeW5jIHRvIHRocm93IGFuIGVycm9yXG4gICAgICBjb25zdCBtb2NrUmVhZEZpbGVTeW5jID0gcmVxdWlyZSgnZnMnKS5yZWFkRmlsZVN5bmM7XG4gICAgICBtb2NrUmVhZEZpbGVTeW5jLm1vY2tJbXBsZW1lbnRhdGlvbk9uY2UoKCkgPT4ge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZpbGUgbm90IGZvdW5kJyk7XG4gICAgICB9KTtcblxuICAgICAgLy8gU2hvdWxkIHN0aWxsIHdvcmsgd2l0aCBmaWxlIHN5c3RlbSBlcnJvcnNcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UucGVyZm9ybVF1aWNrQW5hbHlzaXMoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdJbnRlZ3JhdGlvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGludGVncmF0ZSBhbGwgYW5hbHlzaXMgY29tcG9uZW50cycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNlcnZpY2UucGVyZm9ybUNvbXByZWhlbnNpdmVBbmFseXNpcyh7XG4gICAgICAgIGluY2x1ZGVGaWxlQW5hbHlzaXM6IHRydWUsXG4gICAgICAgIGdlbmVyYXRlU3RyYXRlZ2llczogdHJ1ZSxcbiAgICAgICAgcHJvamVjdENvbnRleHQ6IHtcbiAgICAgICAgICBoYXNUZXN0czogdHJ1ZSxcbiAgICAgICAgICB0ZWFtU2l6ZTogJ3NtYWxsJyxcbiAgICAgICAgICByaXNrVG9sZXJhbmNlOiAnbW9kZXJhdGUnXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgXG4gICAgICAvLyBWZXJpZnkgYWxsIGNvbXBvbmVudHMgd29ya2VkIHRvZ2V0aGVyXG4gICAgICBleHBlY3QocmVzdWx0LmNhdGVnb3JpemVkRXJyb3JzLnRvdGFsKS50b0JlR3JlYXRlclRoYW4oMCk7XG4gICAgICBleHBlY3QocmVzdWx0LmZpbGVBbmFseXNlcy5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICAgIGV4cGVjdChyZXN1bHQucmVzb2x1dGlvblN0cmF0ZWdpZXMubGVuZ3RoKS50b0JlR3JlYXRlclRoYW4oMCk7XG4gICAgICBleHBlY3QocmVzdWx0LnJlY29tbWVuZGF0aW9ucy5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICAgIFxuICAgICAgLy8gVmVyaWZ5IGRhdGEgY29uc2lzdGVuY3lcbiAgICAgIGV4cGVjdChyZXN1bHQuc3VtbWFyeS50b3RhbElzc3VlcykudG9CZShyZXN1bHQuY2F0ZWdvcml6ZWRFcnJvcnMudG90YWwpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5vcHRpbWl6ZWRQbGFuLnRvdGFsU3RyYXRlZ2llcykudG9CZShyZXN1bHQucmVzb2x1dGlvblN0cmF0ZWdpZXMubGVuZ3RoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcHJvdmlkZSBjb25zaXN0ZW50IGFuYWx5c2lzIHJlc3VsdHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBSdW4gYW5hbHlzaXMgdHdpY2UgYW5kIGNvbXBhcmUgcmVzdWx0c1xuICAgICAgY29uc3QgcmVzdWx0MSA9IGF3YWl0IHNlcnZpY2UucGVyZm9ybVF1aWNrQW5hbHlzaXMoKTtcbiAgICAgIGNvbnN0IHJlc3VsdDIgPSBhd2FpdCBzZXJ2aWNlLnBlcmZvcm1RdWlja0FuYWx5c2lzKCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHQxLnN1bW1hcnkudG90YWxJc3N1ZXMpLnRvQmUocmVzdWx0Mi5zdW1tYXJ5LnRvdGFsSXNzdWVzKTtcbiAgICAgIGV4cGVjdChyZXN1bHQxLnN1bW1hcnkuZXJyb3JDb3VudCkudG9CZShyZXN1bHQyLnN1bW1hcnkuZXJyb3JDb3VudCk7XG4gICAgICBleHBlY3QocmVzdWx0MS5zdW1tYXJ5Lndhcm5pbmdDb3VudCkudG9CZShyZXN1bHQyLnN1bW1hcnkud2FybmluZ0NvdW50KTtcbiAgICB9KTtcbiAgfSk7XG59KTsiXSwidmVyc2lvbiI6M30=