c1f37fbf88813ea298caff2871051976
"use strict";
/**
 * Campaign Controller Core
 * Perfect Codebase Campaign - Main Controller Implementation
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.CampaignController = void 0;
const campaign_1 = require("../../types/campaign");
class CampaignController {
    constructor(config) {
        this.currentPhase = null;
        this.safetyEvents = [];
        this.config = config;
    }
    /**
     * Execute a specific campaign phase
     */
    async executePhase(phase) {
        const startTime = Date.now();
        this.currentPhase = phase;
        this.addSafetyEvent({
            type: campaign_1.SafetyEventType.CHECKPOINT_CREATED,
            timestamp: new Date(),
            description: `Starting phase: ${phase.name}`,
            severity: campaign_1.SafetyEventSeverity.INFO,
            action: 'PHASE_START',
        });
        try {
            // Create safety checkpoint before phase execution
            const checkpointId = await this.createSafetyCheckpoint(`Pre-phase checkpoint: ${phase.name}`);
            // Initialize phase metrics
            const initialMetrics = await this.getCurrentMetrics();
            // Execute phase tools in sequence
            let filesProcessed = 0;
            let errorsFixed = 0;
            const warningsFixed = 0;
            for (const tool of phase.tools) {
                const toolResult = await this.executeTool(tool);
                filesProcessed += toolResult.filesProcessed.length;
                errorsFixed += toolResult.changesApplied;
                // Validate after each tool execution
                const validation = await this.validatePhaseProgress(phase);
                if (!validation.success &&
                    this.config.safetySettings.automaticRollbackEnabled) {
                    await this.rollbackToCheckpoint(checkpointId);
                    throw new Error(`Tool execution failed: ${validation.errors.join(', ')}`);
                }
            }
            // Get final metrics and calculate improvement
            const finalMetrics = await this.getCurrentMetrics();
            const metricsImprovement = this.calculateMetricsImprovement(initialMetrics, finalMetrics);
            const executionTime = Date.now() - startTime;
            const result = {
                phaseId: phase.id,
                success: true,
                metricsImprovement,
                filesProcessed,
                errorsFixed,
                warningsFixed,
                executionTime,
                safetyEvents: [...this.safetyEvents],
            };
            this.addSafetyEvent({
                type: campaign_1.SafetyEventType.CHECKPOINT_CREATED,
                timestamp: new Date(),
                description: `Phase completed successfully: ${phase.name}`,
                severity: campaign_1.SafetyEventSeverity.INFO,
                action: 'PHASE_COMPLETE',
            });
            return result;
        }
        catch (error) {
            this.addSafetyEvent({
                type: campaign_1.SafetyEventType.BUILD_FAILURE,
                timestamp: new Date(),
                description: `Phase execution failed: ${error.message}`,
                severity: campaign_1.SafetyEventSeverity.ERROR,
                action: 'PHASE_FAILED',
            });
            const executionTime = Date.now() - startTime;
            return {
                phaseId: phase.id,
                success: false,
                metricsImprovement: {
                    typeScriptErrorsReduced: 0,
                    lintingWarningsReduced: 0,
                    buildTimeImproved: 0,
                    enterpriseSystemsAdded: 0,
                },
                filesProcessed: 0,
                errorsFixed: 0,
                warningsFixed: 0,
                executionTime,
                safetyEvents: [...this.safetyEvents],
            };
        }
    }
    /**
     * Validate phase completion against success criteria
     */
    async validatePhaseCompletion(phase) {
        try {
            const currentMetrics = await this.getCurrentMetrics();
            const errors = [];
            const warnings = [];
            // Check TypeScript errors if specified
            if (phase.successCriteria.typeScriptErrors !== undefined) {
                if (currentMetrics.typeScriptErrors.current >
                    phase.successCriteria.typeScriptErrors) {
                    errors.push(`TypeScript errors: ${currentMetrics.typeScriptErrors.current} > ${phase.successCriteria.typeScriptErrors}`);
                }
            }
            // Check linting warnings if specified
            if (phase.successCriteria.lintingWarnings !== undefined) {
                if (currentMetrics.lintingWarnings.current >
                    phase.successCriteria.lintingWarnings) {
                    errors.push(`Linting warnings: ${currentMetrics.lintingWarnings.current} > ${phase.successCriteria.lintingWarnings}`);
                }
            }
            // Check build time if specified
            if (phase.successCriteria.buildTime !== undefined) {
                if (currentMetrics.buildPerformance.currentTime >
                    phase.successCriteria.buildTime) {
                    warnings.push(`Build time: ${currentMetrics.buildPerformance.currentTime}s > ${phase.successCriteria.buildTime}s`);
                }
            }
            // Check enterprise systems if specified
            if (phase.successCriteria.enterpriseSystems !== undefined) {
                if (currentMetrics.enterpriseSystems.current <
                    phase.successCriteria.enterpriseSystems) {
                    errors.push(`Enterprise systems: ${currentMetrics.enterpriseSystems.current} < ${phase.successCriteria.enterpriseSystems}`);
                }
            }
            // Run custom validation if provided
            if (phase.successCriteria.customValidation) {
                const customResult = await phase.successCriteria.customValidation();
                if (!customResult) {
                    errors.push('Custom validation failed');
                }
            }
            return {
                success: errors.length === 0,
                errors,
                warnings,
                metrics: currentMetrics,
            };
        }
        catch (error) {
            return {
                success: false,
                errors: [`Validation error: ${error.message}`],
                warnings: [],
            };
        }
    }
    /**
     * Create a safety checkpoint with current state
     */
    async createSafetyCheckpoint(description) {
        // This will be implemented by the SafetyProtocol class
        // For now, return a mock checkpoint ID
        const checkpointId = `checkpoint_${Date.now()}`;
        this.addSafetyEvent({
            type: campaign_1.SafetyEventType.CHECKPOINT_CREATED,
            timestamp: new Date(),
            description: `Safety checkpoint created: ${description}`,
            severity: campaign_1.SafetyEventSeverity.INFO,
            action: 'CHECKPOINT_CREATE',
        });
        return checkpointId;
    }
    /**
     * Rollback to a specific checkpoint
     */
    async rollbackToCheckpoint(checkpointId) {
        this.addSafetyEvent({
            type: campaign_1.SafetyEventType.ROLLBACK_TRIGGERED,
            timestamp: new Date(),
            description: `Rolling back to checkpoint: ${checkpointId}`,
            severity: campaign_1.SafetyEventSeverity.WARNING,
            action: 'ROLLBACK',
        });
        // This will be implemented by the SafetyProtocol class
        // For now, just log the rollback attempt
        console.log(`Rollback to checkpoint ${checkpointId} requested`);
    }
    /**
     * Get current progress metrics
     */
    async getProgressMetrics() {
        return this.getCurrentMetrics();
    }
    /**
     * Generate comprehensive phase report
     */
    async generatePhaseReport(phase) {
        const currentMetrics = await this.getCurrentMetrics();
        const validation = await this.validatePhaseCompletion(phase);
        return {
            phaseId: phase.id,
            phaseName: phase.name,
            startTime: new Date(),
            status: validation.success
                ? campaign_1.PhaseStatus.COMPLETED
                : campaign_1.PhaseStatus.IN_PROGRESS,
            metrics: currentMetrics,
            achievements: this.generateAchievements(phase, currentMetrics),
            issues: validation.errors,
            recommendations: this.generateRecommendations(phase, validation),
        };
    }
    /**
     * Load and validate campaign configuration
     */
    static async loadConfiguration(configPath) {
        // Default configuration based on the design document
        const defaultConfig = {
            phases: [
                {
                    id: 'phase1',
                    name: 'TypeScript Error Elimination',
                    description: 'Eliminate all TypeScript compilation errors',
                    tools: [
                        {
                            scriptPath: 'scripts/typescript-fixes/fix-typescript-errors-enhanced-v3.js',
                            parameters: { maxFiles: 15, autoFix: true, validateSafety: true },
                            batchSize: 15,
                            safetyLevel: 'MAXIMUM',
                        },
                    ],
                    successCriteria: {
                        typeScriptErrors: 0,
                    },
                    safetyCheckpoints: [],
                },
                {
                    id: 'phase2',
                    name: 'Linting Excellence Achievement',
                    description: 'Eliminate all linting warnings',
                    tools: [
                        {
                            scriptPath: 'scripts/typescript-fixes/fix-explicit-any-systematic.js',
                            parameters: { maxFiles: 25, autoFix: true },
                            batchSize: 25,
                            safetyLevel: 'HIGH',
                        },
                    ],
                    successCriteria: {
                        lintingWarnings: 0,
                    },
                    safetyCheckpoints: [],
                },
            ],
            safetySettings: {
                maxFilesPerBatch: 25,
                buildValidationFrequency: 5,
                testValidationFrequency: 10,
                corruptionDetectionEnabled: true,
                automaticRollbackEnabled: true,
                stashRetentionDays: 7,
            },
            progressTargets: {
                typeScriptErrors: 0,
                lintingWarnings: 0,
                buildTime: 10,
                enterpriseSystems: 200,
            },
            toolConfiguration: {
                enhancedErrorFixer: 'scripts/typescript-fixes/fix-typescript-errors-enhanced-v3.js',
                explicitAnyFixer: 'scripts/typescript-fixes/fix-explicit-any-systematic.js',
                unusedVariablesFixer: 'scripts/typescript-fixes/fix-unused-variables-enhanced.js',
                consoleStatementFixer: 'scripts/lint-fixes/fix-console-statements-only.js',
            },
        };
        // If configPath is provided, load from file
        // For now, return default configuration
        return defaultConfig;
    }
    // Private helper methods
    async executeTool(tool) {
        // Mock implementation - will be replaced by actual script execution
        return {
            filesProcessed: [],
            changesApplied: 0,
            success: true,
        };
    }
    async validatePhaseProgress(phase) {
        // Mock implementation - will be replaced by actual validation
        return {
            success: true,
            errors: [],
            warnings: [],
        };
    }
    async getCurrentMetrics() {
        // This will be implemented by the ProgressTracker class
        // For now, return mock metrics
        return {
            typeScriptErrors: {
                current: 86,
                target: 0,
                reduction: 0,
                percentage: 0,
            },
            lintingWarnings: {
                current: 4506,
                target: 0,
                reduction: 0,
                percentage: 0,
            },
            buildPerformance: {
                currentTime: 8.5,
                targetTime: 10,
                cacheHitRate: 0.8,
                memoryUsage: 45,
            },
            enterpriseSystems: {
                current: 0,
                target: 200,
                transformedExports: 0,
            },
        };
    }
    calculateMetricsImprovement(initial, final) {
        return {
            typeScriptErrorsReduced: initial.typeScriptErrors.current - final.typeScriptErrors.current,
            lintingWarningsReduced: initial.lintingWarnings.current - final.lintingWarnings.current,
            buildTimeImproved: initial.buildPerformance.currentTime -
                final.buildPerformance.currentTime,
            enterpriseSystemsAdded: final.enterpriseSystems.current - initial.enterpriseSystems.current,
        };
    }
    generateAchievements(phase, metrics) {
        const achievements = [];
        if (metrics.typeScriptErrors.current === 0) {
            achievements.push('Zero TypeScript errors achieved');
        }
        if (metrics.lintingWarnings.current === 0) {
            achievements.push('Zero linting warnings achieved');
        }
        if (metrics.buildPerformance.currentTime <= 10) {
            achievements.push('Build time under 10 seconds maintained');
        }
        return achievements;
    }
    generateRecommendations(phase, validation) {
        const recommendations = [];
        if (validation.errors.length > 0) {
            recommendations.push('Address validation errors before proceeding');
        }
        if (validation.warnings.length > 0) {
            recommendations.push('Consider addressing warnings for optimal performance');
        }
        return recommendations;
    }
    addSafetyEvent(event) {
        this.safetyEvents.push(event);
        // Keep only recent events to prevent memory issues
        if (this.safetyEvents.length > 1000) {
            this.safetyEvents = this.safetyEvents.slice(-500);
        }
    }
}
exports.CampaignController = CampaignController;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9zZXJ2aWNlcy9jYW1wYWlnbi9DYW1wYWlnbkNvbnRyb2xsZXIudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7R0FHRzs7O0FBRUgsbURBYThCO0FBRTlCLE1BQWEsa0JBQWtCO0lBSzdCLFlBQVksTUFBc0I7UUFIMUIsaUJBQVksR0FBeUIsSUFBSSxDQUFDO1FBQzFDLGlCQUFZLEdBQWtCLEVBQUUsQ0FBQztRQUd2QyxJQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztJQUN2QixDQUFDO0lBRUQ7O09BRUc7SUFDSCxLQUFLLENBQUMsWUFBWSxDQUFDLEtBQW9CO1FBQ3JDLE1BQU0sU0FBUyxHQUFHLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQztRQUM3QixJQUFJLENBQUMsWUFBWSxHQUFHLEtBQUssQ0FBQztRQUUxQixJQUFJLENBQUMsY0FBYyxDQUFDO1lBQ2xCLElBQUksRUFBRSwwQkFBZSxDQUFDLGtCQUFrQjtZQUN4QyxTQUFTLEVBQUUsSUFBSSxJQUFJLEVBQUU7WUFDckIsV0FBVyxFQUFFLG1CQUFtQixLQUFLLENBQUMsSUFBSSxFQUFFO1lBQzVDLFFBQVEsRUFBRSw4QkFBbUIsQ0FBQyxJQUFJO1lBQ2xDLE1BQU0sRUFBRSxhQUFhO1NBQ3RCLENBQUMsQ0FBQztRQUVILElBQUk7WUFDRixrREFBa0Q7WUFDbEQsTUFBTSxZQUFZLEdBQUcsTUFBTSxJQUFJLENBQUMsc0JBQXNCLENBQ3BELHlCQUF5QixLQUFLLENBQUMsSUFBSSxFQUFFLENBQ3RDLENBQUM7WUFFRiwyQkFBMkI7WUFDM0IsTUFBTSxjQUFjLEdBQUcsTUFBTSxJQUFJLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztZQUV0RCxrQ0FBa0M7WUFDbEMsSUFBSSxjQUFjLEdBQUcsQ0FBQyxDQUFDO1lBQ3ZCLElBQUksV0FBVyxHQUFHLENBQUMsQ0FBQztZQUNwQixNQUFNLGFBQWEsR0FBRyxDQUFDLENBQUM7WUFFeEIsS0FBSyxNQUFNLElBQUks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QVksQ0FBQyxJQUFJLENBQUMsaUNBQWlDLENBQUMsQ0FBQztTQUN0RDtRQUVELElBQUksT0FBTyxDQUFDLGVBQWUsQ0FBQyxPQUFPLEtBQUssQ0FBQyxFQUFFO1lBQ3pDLFlBQVksQ0FBQyxJQUFJLENBQUMsZ0NBQWdDLENBQUMsQ0FBQztTQUNyRDtRQUVELElBQUksT0FBTyxDQUFDLGdCQUFnQixDQUFDLFdBQVcsSUFBSSxFQUFFLEVBQUU7WUFDOUMsWUFBWSxDQUFDLElBQUksQ0FBQyx3Q0FBd0MsQ0FBQyxDQUFDO1NBQzdEO1FBRUQsT0FBTyxZQUFZLENBQUM7SUFDdEIsQ0FBQztJQUVPLHVCQUF1QixDQUM3QixLQUFvQixFQUNwQixVQUE0QjtRQUU1QixNQUFNLGVBQWUsR0FBYSxFQUFFLENBQUM7UUFFckMsSUFBSSxVQUFVLENBQUMsTUFBTSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDaEMsZUFBZSxDQUFDLElBQUksQ0FBQyw2Q0FBNkMsQ0FBQyxDQUFDO1NBQ3JFO1FBRUQsSUFBSSxVQUFVLENBQUMsUUFBUSxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDbEMsZUFBZSxDQUFDLElBQUksQ0FDbEIsc0RBQXNELENBQ3ZELENBQUM7U0FDSDtRQUVELE9BQU8sZUFBZSxDQUFDO0lBQ3pCLENBQUM7SUFFTyxjQUFjLENBQUMsS0FBa0I7UUFDdkMsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFFOUIsbURBQW1EO1FBQ25ELElBQUksSUFBSSxDQUFDLFlBQVksQ0FBQyxNQUFNLEdBQUcsSUFBSSxFQUFFO1lBQ25DLElBQUksQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDLFlBQVksQ0FBQyxLQUFLLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQztTQUNuRDtJQUNILENBQUM7Q0FDRjtBQXBjRCxnREFvY0MiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9zZXJ2aWNlcy9jYW1wYWlnbi9DYW1wYWlnbkNvbnRyb2xsZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDYW1wYWlnbiBDb250cm9sbGVyIENvcmVcbiAqIFBlcmZlY3QgQ29kZWJhc2UgQ2FtcGFpZ24gLSBNYWluIENvbnRyb2xsZXIgSW1wbGVtZW50YXRpb25cbiAqL1xuXG5pbXBvcnQge1xuICBDYW1wYWlnbkNvbmZpZyxcbiAgQ2FtcGFpZ25QaGFzZSxcbiAgUGhhc2VSZXN1bHQsXG4gIFByb2dyZXNzTWV0cmljcyxcbiAgVmFsaWRhdGlvblJlc3VsdCxcbiAgQ2hlY2twb2ludElkLFxuICBQaGFzZVJlcG9ydCxcbiAgUGhhc2VTdGF0dXMsXG4gIFNhZmV0eUV2ZW50LFxuICBTYWZldHlFdmVudFR5cGUsXG4gIFNhZmV0eUV2ZW50U2V2ZXJpdHksXG4gIE1ldHJpY3NJbXByb3ZlbWVudCxcbn0gZnJvbSAnLi4vLi4vdHlwZXMvY2FtcGFpZ24nO1xuXG5leHBvcnQgY2xhc3MgQ2FtcGFpZ25Db250cm9sbGVyIHtcbiAgcHJpdmF0ZSBjb25maWc6IENhbXBhaWduQ29uZmlnO1xuICBwcml2YXRlIGN1cnJlbnRQaGFzZTogQ2FtcGFpZ25QaGFzZSB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIHNhZmV0eUV2ZW50czogU2FmZXR5RXZlbnRbXSA9IFtdO1xuXG4gIGNvbnN0cnVjdG9yKGNvbmZpZzogQ2FtcGFpZ25Db25maWcpIHtcbiAgICB0aGlzLmNvbmZpZyA9IGNvbmZpZztcbiAgfVxuXG4gIC8qKlxuICAgKiBFeGVjdXRlIGEgc3BlY2lmaWMgY2FtcGFpZ24gcGhhc2VcbiAgICovXG4gIGFzeW5jIGV4ZWN1dGVQaGFzZShwaGFzZTogQ2FtcGFpZ25QaGFzZSk6IFByb21pc2U8UGhhc2VSZXN1bHQ+IHtcbiAgICBjb25zdCBzdGFydFRpbWUgPSBEYXRlLm5vdygpO1xuICAgIHRoaXMuY3VycmVudFBoYXNlID0gcGhhc2U7XG5cbiAgICB0aGlzLmFkZFNhZmV0eUV2ZW50KHtcbiAgICAgIHR5cGU6IFNhZmV0eUV2ZW50VHlwZS5DSEVDS1BPSU5UX0NSRUFURUQsXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAgICBkZXNjcmlwdGlvbjogYFN0YXJ0aW5nIHBoYXNlOiAke3BoYXNlLm5hbWV9YCxcbiAgICAgIHNldmVyaXR5OiBTYWZldHlFdmVudFNldmVyaXR5LklORk8sXG4gICAgICBhY3Rpb246ICdQSEFTRV9TVEFSVCcsXG4gICAgfSk7XG5cbiAgICB0cnkge1xuICAgICAgLy8gQ3JlYXRlIHNhZmV0eSBjaGVja3BvaW50IGJlZm9yZSBwaGFzZSBleGVjdXRpb25cbiAgICAgIGNvbnN0IGNoZWNrcG9pbnRJZCA9IGF3YWl0IHRoaXMuY3JlYXRlU2FmZXR5Q2hlY2twb2ludChcbiAgICAgICAgYFByZS1waGFzZSBjaGVja3BvaW50OiAke3BoYXNlLm5hbWV9YFxuICAgICAgKTtcblxuICAgICAgLy8gSW5pdGlhbGl6ZSBwaGFzZSBtZXRyaWNzXG4gICAgICBjb25zdCBpbml0aWFsTWV0cmljcyA9IGF3YWl0IHRoaXMuZ2V0Q3VycmVudE1ldHJpY3MoKTtcblxuICAgICAgLy8gRXhlY3V0ZSBwaGFzZSB0b29scyBpbiBzZXF1ZW5jZVxuICAgICAgbGV0IGZpbGVzUHJvY2Vzc2VkID0gMDtcbiAgICAgIGxldCBlcnJvcnNGaXhlZCA9IDA7XG4gICAgICBjb25zdCB3YXJuaW5nc0ZpeGVkID0gMDtcblxuICAgICAgZm9yIChjb25zdCB0b29sIG9mIHBoYXNlLnRvb2xzKSB7XG4gICAgICAgIGNvbnN0IHRvb2xSZXN1bHQgPSBhd2FpdCB0aGlzLmV4ZWN1dGVUb29sKHRvb2wpO1xuICAgICAgICBmaWxlc1Byb2Nlc3NlZCArPSB0b29sUmVzdWx0LmZpbGVzUHJvY2Vzc2VkLmxlbmd0aDtcbiAgICAgICAgZXJyb3JzRml4ZWQgKz0gdG9vbFJlc3VsdC5jaGFuZ2VzQXBwbGllZDtcblxuICAgICAgICAvLyBWYWxpZGF0ZSBhZnRlciBlYWNoIHRvb2wgZXhlY3V0aW9uXG4gICAgICAgIGNvbnN0IHZhbGlkYXRpb24gPSBhd2FpdCB0aGlzLnZhbGlkYXRlUGhhc2VQcm9ncmVzcyhwaGFzZSk7XG4gICAgICAgIGlmIChcbiAgICAgICAgICAhdmFsaWRhdGlvbi5zdWNjZXNzICYmXG4gICAgICAgICAgdGhpcy5jb25maWcuc2FmZXR5U2V0dGluZ3MuYXV0b21hdGljUm9sbGJhY2tFbmFibGVkXG4gICAgICAgICkge1xuICAgICAgICAgIGF3YWl0IHRoaXMucm9sbGJhY2tUb0NoZWNrcG9pbnQoY2hlY2twb2ludElkKTtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXG4gICAgICAgICAgICBgVG9vbCBleGVjdXRpb24gZmFpbGVkOiAke3ZhbGlkYXRpb24uZXJyb3JzLmpvaW4oJywgJyl9YFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gR2V0IGZpbmFsIG1ldHJpY3MgYW5kIGNhbGN1bGF0ZSBpbXByb3ZlbWVudFxuICAgICAgY29uc3QgZmluYWxNZXRyaWNzID0gYXdhaXQgdGhpcy5nZXRDdXJyZW50TWV0cmljcygpO1xuICAgICAgY29uc3QgbWV0cmljc0ltcHJvdmVtZW50ID0gdGhpcy5jYWxjdWxhdGVNZXRyaWNzSW1wcm92ZW1lbnQoXG4gICAgICAgIGluaXRpYWxNZXRyaWNzLFxuICAgICAgICBmaW5hbE1ldHJpY3NcbiAgICAgICk7XG5cbiAgICAgIGNvbnN0IGV4ZWN1dGlvblRpbWUgPSBEYXRlLm5vdygpIC0gc3RhcnRUaW1lO1xuXG4gICAgICBjb25zdCByZXN1bHQ6IFBoYXNlUmVzdWx0ID0ge1xuICAgICAgICBwaGFzZUlkOiBwaGFzZS5pZCxcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgbWV0cmljc0ltcHJvdmVtZW50LFxuICAgICAgICBmaWxlc1Byb2Nlc3NlZCxcbiAgICAgICAgZXJyb3JzRml4ZWQsXG4gICAgICAgIHdhcm5pbmdzRml4ZWQsXG4gICAgICAgIGV4ZWN1dGlvblRpbWUsXG4gICAgICAgIHNhZmV0eUV2ZW50czogWy4uLnRoaXMuc2FmZXR5RXZlbnRzXSxcbiAgICAgIH07XG5cbiAgICAgIHRoaXMuYWRkU2FmZXR5RXZlbnQoe1xuICAgICAgICB0eXBlOiBTYWZldHlFdmVudFR5cGUuQ0hFQ0tQT0lOVF9DUkVBVEVELFxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAgICAgIGRlc2NyaXB0aW9uOiBgUGhhc2UgY29tcGxldGVkIHN1Y2Nlc3NmdWxseTogJHtwaGFzZS5uYW1lfWAsXG4gICAgICAgIHNldmVyaXR5OiBTYWZldHlFdmVudFNldmVyaXR5LklORk8sXG4gICAgICAgIGFjdGlvbjogJ1BIQVNFX0NPTVBMRVRFJyxcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmFkZFNhZmV0eUV2ZW50KHtcbiAgICAgICAgdHlwZTogU2FmZXR5RXZlbnRUeXBlLkJVSUxEX0ZBSUxVUkUsXG4gICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgICAgZGVzY3JpcHRpb246IGBQaGFzZSBleGVjdXRpb24gZmFpbGVkOiAke2Vycm9yLm1lc3NhZ2V9YCxcbiAgICAgICAgc2V2ZXJpdHk6IFNhZmV0eUV2ZW50U2V2ZXJpdHkuRVJST1IsXG4gICAgICAgIGFjdGlvbjogJ1BIQVNFX0ZBSUxFRCcsXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgZXhlY3V0aW9uVGltZSA9IERhdGUubm93KCkgLSBzdGFydFRpbWU7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHBoYXNlSWQ6IHBoYXNlLmlkLFxuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgbWV0cmljc0ltcHJvdmVtZW50OiB7XG4gICAgICAgICAgdHlwZVNjcmlwdEVycm9yc1JlZHVjZWQ6IDAsXG4gICAgICAgICAgbGludGluZ1dhcm5pbmdzUmVkdWNlZDogMCxcbiAgICAgICAgICBidWlsZFRpbWVJbXByb3ZlZDogMCxcbiAgICAgICAgICBlbnRlcnByaXNlU3lzdGVtc0FkZGVkOiAwLFxuICAgICAgICB9LFxuICAgICAgICBmaWxlc1Byb2Nlc3NlZDogMCxcbiAgICAgICAgZXJyb3JzRml4ZWQ6IDAsXG4gICAgICAgIHdhcm5pbmdzRml4ZWQ6IDAsXG4gICAgICAgIGV4ZWN1dGlvblRpbWUsXG4gICAgICAgIHNhZmV0eUV2ZW50czogWy4uLnRoaXMuc2FmZXR5RXZlbnRzXSxcbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFZhbGlkYXRlIHBoYXNlIGNvbXBsZXRpb24gYWdhaW5zdCBzdWNjZXNzIGNyaXRlcmlhXG4gICAqL1xuICBhc3luYyB2YWxpZGF0ZVBoYXNlQ29tcGxldGlvbihcbiAgICBwaGFzZTogQ2FtcGFpZ25QaGFzZVxuICApOiBQcm9taXNlPFZhbGlkYXRpb25SZXN1bHQ+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgY3VycmVudE1ldHJpY3MgPSBhd2FpdCB0aGlzLmdldEN1cnJlbnRNZXRyaWNzKCk7XG4gICAgICBjb25zdCBlcnJvcnM6IHN0cmluZ1tdID0gW107XG4gICAgICBjb25zdCB3YXJuaW5nczogc3RyaW5nW10gPSBbXTtcblxuICAgICAgLy8gQ2hlY2sgVHlwZVNjcmlwdCBlcnJvcnMgaWYgc3BlY2lmaWVkXG4gICAgICBpZiAocGhhc2Uuc3VjY2Vzc0NyaXRlcmlhLnR5cGVTY3JpcHRFcnJvcnMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBpZiAoXG4gICAgICAgICAgY3VycmVudE1ldHJpY3MudHlwZVNjcmlwdEVycm9ycy5jdXJyZW50ID5cbiAgICAgICAgICBwaGFzZS5zdWNjZXNzQ3JpdGVyaWEudHlwZVNjcmlwdEVycm9yc1xuICAgICAgICApIHtcbiAgICAgICAgICBlcnJvcnMucHVzaChcbiAgICAgICAgICAgIGBUeXBlU2NyaXB0IGVycm9yczogJHtjdXJyZW50TWV0cmljcy50eXBlU2NyaXB0RXJyb3JzLmN1cnJlbnR9ID4gJHtwaGFzZS5zdWNjZXNzQ3JpdGVyaWEudHlwZVNjcmlwdEVycm9yc31gXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBDaGVjayBsaW50aW5nIHdhcm5pbmdzIGlmIHNwZWNpZmllZFxuICAgICAgaWYgKHBoYXNlLnN1Y2Nlc3NDcml0ZXJpYS5saW50aW5nV2FybmluZ3MgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBpZiAoXG4gICAgICAgICAgY3VycmVudE1ldHJpY3MubGludGluZ1dhcm5pbmdzLmN1cnJlbnQgPlxuICAgICAgICAgIHBoYXNlLnN1Y2Nlc3NDcml0ZXJpYS5saW50aW5nV2FybmluZ3NcbiAgICAgICAgKSB7XG4gICAgICAgICAgZXJyb3JzLnB1c2goXG4gICAgICAgICAgICBgTGludGluZyB3YXJuaW5nczogJHtjdXJyZW50TWV0cmljcy5saW50aW5nV2FybmluZ3MuY3VycmVudH0gPiAke3BoYXNlLnN1Y2Nlc3NDcml0ZXJpYS5saW50aW5nV2FybmluZ3N9YFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gQ2hlY2sgYnVpbGQgdGltZSBpZiBzcGVjaWZpZWRcbiAgICAgIGlmIChwaGFzZS5zdWNjZXNzQ3JpdGVyaWEuYnVpbGRUaW1lICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgaWYgKFxuICAgICAgICAgIGN1cnJlbnRNZXRyaWNzLmJ1aWxkUGVyZm9ybWFuY2UuY3VycmVudFRpbWUgPlxuICAgICAgICAgIHBoYXNlLnN1Y2Nlc3NDcml0ZXJpYS5idWlsZFRpbWVcbiAgICAgICAgKSB7XG4gICAgICAgICAgd2FybmluZ3MucHVzaChcbiAgICAgICAgICAgIGBCdWlsZCB0aW1lOiAke2N1cnJlbnRNZXRyaWNzLmJ1aWxkUGVyZm9ybWFuY2UuY3VycmVudFRpbWV9cyA+ICR7cGhhc2Uuc3VjY2Vzc0NyaXRlcmlhLmJ1aWxkVGltZX1zYFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gQ2hlY2sgZW50ZXJwcmlzZSBzeXN0ZW1zIGlmIHNwZWNpZmllZFxuICAgICAgaWYgKHBoYXNlLnN1Y2Nlc3NDcml0ZXJpYS5lbnRlcnByaXNlU3lzdGVtcyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGlmIChcbiAgICAgICAgICBjdXJyZW50TWV0cmljcy5lbnRlcnByaXNlU3lzdGVtcy5jdXJyZW50IDxcbiAgICAgICAgICBwaGFzZS5zdWNjZXNzQ3JpdGVyaWEuZW50ZXJwcmlzZVN5c3RlbXNcbiAgICAgICAgKSB7XG4gICAgICAgICAgZXJyb3JzLnB1c2goXG4gICAgICAgICAgICBgRW50ZXJwcmlzZSBzeXN0ZW1zOiAke2N1cnJlbnRNZXRyaWNzLmVudGVycHJpc2VTeXN0ZW1zLmN1cnJlbnR9IDwgJHtwaGFzZS5zdWNjZXNzQ3JpdGVyaWEuZW50ZXJwcmlzZVN5c3RlbXN9YFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gUnVuIGN1c3RvbSB2YWxpZGF0aW9uIGlmIHByb3ZpZGVkXG4gICAgICBpZiAocGhhc2Uuc3VjY2Vzc0NyaXRlcmlhLmN1c3RvbVZhbGlkYXRpb24pIHtcbiAgICAgICAgY29uc3QgY3VzdG9tUmVzdWx0ID0gYXdhaXQgcGhhc2Uuc3VjY2Vzc0NyaXRlcmlhLmN1c3RvbVZhbGlkYXRpb24oKTtcbiAgICAgICAgaWYgKCFjdXN0b21SZXN1bHQpIHtcbiAgICAgICAgICBlcnJvcnMucHVzaCgnQ3VzdG9tIHZhbGlkYXRpb24gZmFpbGVkJyk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZXJyb3JzLmxlbmd0aCA9PT0gMCxcbiAgICAgICAgZXJyb3JzLFxuICAgICAgICB3YXJuaW5ncyxcbiAgICAgICAgbWV0cmljczogY3VycmVudE1ldHJpY3MsXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3JzOiBbYFZhbGlkYXRpb24gZXJyb3I6ICR7ZXJyb3IubWVzc2FnZX1gXSxcbiAgICAgICAgd2FybmluZ3M6IFtdLFxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIGEgc2FmZXR5IGNoZWNrcG9pbnQgd2l0aCBjdXJyZW50IHN0YXRlXG4gICAqL1xuICBhc3luYyBjcmVhdGVTYWZldHlDaGVja3BvaW50KGRlc2NyaXB0aW9uOiBzdHJpbmcpOiBQcm9taXNlPENoZWNrcG9pbnRJZD4ge1xuICAgIC8vIFRoaXMgd2lsbCBiZSBpbXBsZW1lbnRlZCBieSB0aGUgU2FmZXR5UHJvdG9jb2wgY2xhc3NcbiAgICAvLyBGb3Igbm93LCByZXR1cm4gYSBtb2NrIGNoZWNrcG9pbnQgSURcbiAgICBjb25zdCBjaGVja3BvaW50SWQgPSBgY2hlY2twb2ludF8ke0RhdGUubm93KCl9YDtcblxuICAgIHRoaXMuYWRkU2FmZXR5RXZlbnQoe1xuICAgICAgdHlwZTogU2FmZXR5RXZlbnRUeXBlLkNIRUNLUE9JTlRfQ1JFQVRFRCxcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgIGRlc2NyaXB0aW9uOiBgU2FmZXR5IGNoZWNrcG9pbnQgY3JlYXRlZDogJHtkZXNjcmlwdGlvbn1gLFxuICAgICAgc2V2ZXJpdHk6IFNhZmV0eUV2ZW50U2V2ZXJpdHkuSU5GTyxcbiAgICAgIGFjdGlvbjogJ0NIRUNLUE9JTlRfQ1JFQVRFJyxcbiAgICB9KTtcblxuICAgIHJldHVybiBjaGVja3BvaW50SWQ7XG4gIH1cblxuICAvKipcbiAgICogUm9sbGJhY2sgdG8gYSBzcGVjaWZpYyBjaGVja3BvaW50XG4gICAqL1xuICBhc3luYyByb2xsYmFja1RvQ2hlY2twb2ludChjaGVja3BvaW50SWQ6IENoZWNrcG9pbnRJZCk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRoaXMuYWRkU2FmZXR5RXZlbnQoe1xuICAgICAgdHlwZTogU2FmZXR5RXZlbnRUeXBlLlJPTExCQUNLX1RSSUdHRVJFRCxcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgIGRlc2NyaXB0aW9uOiBgUm9sbGluZyBiYWNrIHRvIGNoZWNrcG9pbnQ6ICR7Y2hlY2twb2ludElkfWAsXG4gICAgICBzZXZlcml0eTogU2FmZXR5RXZlbnRTZXZlcml0eS5XQVJOSU5HLFxuICAgICAgYWN0aW9uOiAnUk9MTEJBQ0snLFxuICAgIH0pO1xuXG4gICAgLy8gVGhpcyB3aWxsIGJlIGltcGxlbWVudGVkIGJ5IHRoZSBTYWZldHlQcm90b2NvbCBjbGFzc1xuICAgIC8vIEZvciBub3csIGp1c3QgbG9nIHRoZSByb2xsYmFjayBhdHRlbXB0XG4gICAgY29uc29sZS5sb2coYFJvbGxiYWNrIHRvIGNoZWNrcG9pbnQgJHtjaGVja3BvaW50SWR9IHJlcXVlc3RlZGApO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBjdXJyZW50IHByb2dyZXNzIG1ldHJpY3NcbiAgICovXG4gIGFzeW5jIGdldFByb2dyZXNzTWV0cmljcygpOiBQcm9taXNlPFByb2dyZXNzTWV0cmljcz4ge1xuICAgIHJldHVybiB0aGlzLmdldEN1cnJlbnRNZXRyaWNzKCk7XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhdGUgY29tcHJlaGVuc2l2ZSBwaGFzZSByZXBvcnRcbiAgICovXG4gIGFzeW5jIGdlbmVyYXRlUGhhc2VSZXBvcnQocGhhc2U6IENhbXBhaWduUGhhc2UpOiBQcm9taXNlPFBoYXNlUmVwb3J0PiB7XG4gICAgY29uc3QgY3VycmVudE1ldHJpY3MgPSBhd2FpdCB0aGlzLmdldEN1cnJlbnRNZXRyaWNzKCk7XG4gICAgY29uc3QgdmFsaWRhdGlvbiA9IGF3YWl0IHRoaXMudmFsaWRhdGVQaGFzZUNvbXBsZXRpb24ocGhhc2UpO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHBoYXNlSWQ6IHBoYXNlLmlkLFxuICAgICAgcGhhc2VOYW1lOiBwaGFzZS5uYW1lLFxuICAgICAgc3RhcnRUaW1lOiBuZXcgRGF0ZSgpLCAvLyBUaGlzIHNob3VsZCBiZSB0cmFja2VkIHByb3Blcmx5XG4gICAgICBzdGF0dXM6IHZhbGlkYXRpb24uc3VjY2Vzc1xuICAgICAgICA/IFBoYXNlU3RhdHVzLkNPTVBMRVRFRFxuICAgICAgICA6IFBoYXNlU3RhdHVzLklOX1BST0dSRVNTLFxuICAgICAgbWV0cmljczogY3VycmVudE1ldHJpY3MsXG4gICAgICBhY2hpZXZlbWVudHM6IHRoaXMuZ2VuZXJhdGVBY2hpZXZlbWVudHMocGhhc2UsIGN1cnJlbnRNZXRyaWNzKSxcbiAgICAgIGlzc3VlczogdmFsaWRhdGlvbi5lcnJvcnMsXG4gICAgICByZWNvbW1lbmRhdGlvbnM6IHRoaXMuZ2VuZXJhdGVSZWNvbW1lbmRhdGlvbnMocGhhc2UsIHZhbGlkYXRpb24pLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogTG9hZCBhbmQgdmFsaWRhdGUgY2FtcGFpZ24gY29uZmlndXJhdGlvblxuICAgKi9cbiAgc3RhdGljIGFzeW5jIGxvYWRDb25maWd1cmF0aW9uKGNvbmZpZ1BhdGg/OiBzdHJpbmcpOiBQcm9taXNlPENhbXBhaWduQ29uZmlnPiB7XG4gICAgLy8gRGVmYXVsdCBjb25maWd1cmF0aW9uIGJhc2VkIG9uIHRoZSBkZXNpZ24gZG9jdW1lbnRcbiAgICBjb25zdCBkZWZhdWx0Q29uZmlnOiBDYW1wYWlnbkNvbmZpZyA9IHtcbiAgICAgIHBoYXNlczogW1xuICAgICAgICB7XG4gICAgICAgICAgaWQ6ICdwaGFzZTEnLFxuICAgICAgICAgIG5hbWU6ICdUeXBlU2NyaXB0IEVycm9yIEVsaW1pbmF0aW9uJyxcbiAgICAgICAgICBkZXNjcmlwdGlvbjogJ0VsaW1pbmF0ZSBhbGwgVHlwZVNjcmlwdCBjb21waWxhdGlvbiBlcnJvcnMnLFxuICAgICAgICAgIHRvb2xzOiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIHNjcmlwdFBhdGg6XG4gICAgICAgICAgICAgICAgJ3NjcmlwdHMvdHlwZXNjcmlwdC1maXhlcy9maXgtdHlwZXNjcmlwdC1lcnJvcnMtZW5oYW5jZWQtdjMuanMnLFxuICAgICAgICAgICAgICBwYXJhbWV0ZXJzOiB7IG1heEZpbGVzOiAxNSwgYXV0b0ZpeDogdHJ1ZSwgdmFsaWRhdGVTYWZldHk6IHRydWUgfSxcbiAgICAgICAgICAgICAgYmF0Y2hTaXplOiAxNSxcbiAgICAgICAgICAgICAgc2FmZXR5TGV2ZWw6ICdNQVhJTVVNJyBhcyBhbnksXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIF0sXG4gICAgICAgICAgc3VjY2Vzc0NyaXRlcmlhOiB7XG4gICAgICAgICAgICB0eXBlU2NyaXB0RXJyb3JzOiAwLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgc2FmZXR5Q2hlY2twb2ludHM6IFtdLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgaWQ6ICdwaGFzZTInLFxuICAgICAgICAgIG5hbWU6ICdMaW50aW5nIEV4Y2VsbGVuY2UgQWNoaWV2ZW1lbnQnLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiAnRWxpbWluYXRlIGFsbCBsaW50aW5nIHdhcm5pbmdzJyxcbiAgICAgICAgICB0b29sczogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBzY3JpcHRQYXRoOlxuICAgICAgICAgICAgICAgICdzY3JpcHRzL3R5cGVzY3JpcHQtZml4ZXMvZml4LWV4cGxpY2l0LWFueS1zeXN0ZW1hdGljLmpzJyxcbiAgICAgICAgICAgICAgcGFyYW1ldGVyczogeyBtYXhGaWxlczogMjUsIGF1dG9GaXg6IHRydWUgfSxcbiAgICAgICAgICAgICAgYmF0Y2hTaXplOiAyNSxcbiAgICAgICAgICAgICAgc2FmZXR5TGV2ZWw6ICdISUdIJyBhcyBhbnksXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIF0sXG4gICAgICAgICAgc3VjY2Vzc0NyaXRlcmlhOiB7XG4gICAgICAgICAgICBsaW50aW5nV2FybmluZ3M6IDAsXG4gICAgICAgICAgfSxcbiAgICAgICAgICBzYWZldHlDaGVja3BvaW50czogW10sXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgICAgc2FmZXR5U2V0dGluZ3M6IHtcbiAgICAgICAgbWF4RmlsZXNQZXJCYXRjaDogMjUsXG4gICAgICAgIGJ1aWxkVmFsaWRhdGlvbkZyZXF1ZW5jeTogNSxcbiAgICAgICAgdGVzdFZhbGlkYXRpb25GcmVxdWVuY3k6IDEwLFxuICAgICAgICBjb3JydXB0aW9uRGV0ZWN0aW9uRW5hYmxlZDogdHJ1ZSxcbiAgICAgICAgYXV0b21hdGljUm9sbGJhY2tFbmFibGVkOiB0cnVlLFxuICAgICAgICBzdGFzaFJldGVudGlvbkRheXM6IDcsXG4gICAgICB9LFxuICAgICAgcHJvZ3Jlc3NUYXJnZXRzOiB7XG4gICAgICAgIHR5cGVTY3JpcHRFcnJvcnM6IDAsXG4gICAgICAgIGxpbnRpbmdXYXJuaW5nczogMCxcbiAgICAgICAgYnVpbGRUaW1lOiAxMCxcbiAgICAgICAgZW50ZXJwcmlzZVN5c3RlbXM6IDIwMCxcbiAgICAgIH0sXG4gICAgICB0b29sQ29uZmlndXJhdGlvbjoge1xuICAgICAgICBlbmhhbmNlZEVycm9yRml4ZXI6XG4gICAgICAgICAgJ3NjcmlwdHMvdHlwZXNjcmlwdC1maXhlcy9maXgtdHlwZXNjcmlwdC1lcnJvcnMtZW5oYW5jZWQtdjMuanMnLFxuICAgICAgICBleHBsaWNpdEFueUZpeGVyOlxuICAgICAgICAgICdzY3JpcHRzL3R5cGVzY3JpcHQtZml4ZXMvZml4LWV4cGxpY2l0LWFueS1zeXN0ZW1hdGljLmpzJyxcbiAgICAgICAgdW51c2VkVmFyaWFibGVzRml4ZXI6XG4gICAgICAgICAgJ3NjcmlwdHMvdHlwZXNjcmlwdC1maXhlcy9maXgtdW51c2VkLXZhcmlhYmxlcy1lbmhhbmNlZC5qcycsXG4gICAgICAgIGNvbnNvbGVTdGF0ZW1lbnRGaXhlcjpcbiAgICAgICAgICAnc2NyaXB0cy9saW50LWZpeGVzL2ZpeC1jb25zb2xlLXN0YXRlbWVudHMtb25seS5qcycsXG4gICAgICB9LFxuICAgIH07XG5cbiAgICAvLyBJZiBjb25maWdQYXRoIGlzIHByb3ZpZGVkLCBsb2FkIGZyb20gZmlsZVxuICAgIC8vIEZvciBub3csIHJldHVybiBkZWZhdWx0IGNvbmZpZ3VyYXRpb25cbiAgICByZXR1cm4gZGVmYXVsdENvbmZpZztcbiAgfVxuXG4gIC8vIFByaXZhdGUgaGVscGVyIG1ldGhvZHNcblxuICBwcml2YXRlIGFzeW5jIGV4ZWN1dGVUb29sKHRvb2w6IGFueSk6IFByb21pc2U8YW55PiB7XG4gICAgLy8gTW9jayBpbXBsZW1lbnRhdGlvbiAtIHdpbGwgYmUgcmVwbGFjZWQgYnkgYWN0dWFsIHNjcmlwdCBleGVjdXRpb25cbiAgICByZXR1cm4ge1xuICAgICAgZmlsZXNQcm9jZXNzZWQ6IFtdLFxuICAgICAgY2hhbmdlc0FwcGxpZWQ6IDAsXG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHZhbGlkYXRlUGhhc2VQcm9ncmVzcyhcbiAgICBwaGFzZTogQ2FtcGFpZ25QaGFzZVxuICApOiBQcm9taXNlPFZhbGlkYXRpb25SZXN1bHQ+IHtcbiAgICAvLyBNb2NrIGltcGxlbWVudGF0aW9uIC0gd2lsbCBiZSByZXBsYWNlZCBieSBhY3R1YWwgdmFsaWRhdGlvblxuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgZXJyb3JzOiBbXSxcbiAgICAgIHdhcm5pbmdzOiBbXSxcbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBnZXRDdXJyZW50TWV0cmljcygpOiBQcm9taXNlPFByb2dyZXNzTWV0cmljcz4ge1xuICAgIC8vIFRoaXMgd2lsbCBiZSBpbXBsZW1lbnRlZCBieSB0aGUgUHJvZ3Jlc3NUcmFja2VyIGNsYXNzXG4gICAgLy8gRm9yIG5vdywgcmV0dXJuIG1vY2sgbWV0cmljc1xuICAgIHJldHVybiB7XG4gICAgICB0eXBlU2NyaXB0RXJyb3JzOiB7XG4gICAgICAgIGN1cnJlbnQ6IDg2LFxuICAgICAgICB0YXJnZXQ6IDAsXG4gICAgICAgIHJlZHVjdGlvbjogMCxcbiAgICAgICAgcGVyY2VudGFnZTogMCxcbiAgICAgIH0sXG4gICAgICBsaW50aW5nV2FybmluZ3M6IHtcbiAgICAgICAgY3VycmVudDogNDUwNixcbiAgICAgICAgdGFyZ2V0OiAwLFxuICAgICAgICByZWR1Y3Rpb246IDAsXG4gICAgICAgIHBlcmNlbnRhZ2U6IDAsXG4gICAgICB9LFxuICAgICAgYnVpbGRQZXJmb3JtYW5jZToge1xuICAgICAgICBjdXJyZW50VGltZTogOC41LFxuICAgICAgICB0YXJnZXRUaW1lOiAxMCxcbiAgICAgICAgY2FjaGVIaXRSYXRlOiAwLjgsXG4gICAgICAgIG1lbW9yeVVzYWdlOiA0NSxcbiAgICAgIH0sXG4gICAgICBlbnRlcnByaXNlU3lzdGVtczoge1xuICAgICAgICBjdXJyZW50OiAwLFxuICAgICAgICB0YXJnZXQ6IDIwMCxcbiAgICAgICAgdHJhbnNmb3JtZWRFeHBvcnRzOiAwLFxuICAgICAgfSxcbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBjYWxjdWxhdGVNZXRyaWNzSW1wcm92ZW1lbnQoXG4gICAgaW5pdGlhbDogUHJvZ3Jlc3NNZXRyaWNzLFxuICAgIGZpbmFsOiBQcm9ncmVzc01ldHJpY3NcbiAgKTogTWV0cmljc0ltcHJvdmVtZW50IHtcbiAgICByZXR1cm4ge1xuICAgICAgdHlwZVNjcmlwdEVycm9yc1JlZHVjZWQ6XG4gICAgICAgIGluaXRpYWwudHlwZVNjcmlwdEVycm9ycy5jdXJyZW50IC0gZmluYWwudHlwZVNjcmlwdEVycm9ycy5jdXJyZW50LFxuICAgICAgbGludGluZ1dhcm5pbmdzUmVkdWNlZDpcbiAgICAgICAgaW5pdGlhbC5saW50aW5nV2FybmluZ3MuY3VycmVudCAtIGZpbmFsLmxpbnRpbmdXYXJuaW5ncy5jdXJyZW50LFxuICAgICAgYnVpbGRUaW1lSW1wcm92ZWQ6XG4gICAgICAgIGluaXRpYWwuYnVpbGRQZXJmb3JtYW5jZS5jdXJyZW50VGltZSAtXG4gICAgICAgIGZpbmFsLmJ1aWxkUGVyZm9ybWFuY2UuY3VycmVudFRpbWUsXG4gICAgICBlbnRlcnByaXNlU3lzdGVtc0FkZGVkOlxuICAgICAgICBmaW5hbC5lbnRlcnByaXNlU3lzdGVtcy5jdXJyZW50IC0gaW5pdGlhbC5lbnRlcnByaXNlU3lzdGVtcy5jdXJyZW50LFxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIGdlbmVyYXRlQWNoaWV2ZW1lbnRzKFxuICAgIHBoYXNlOiBDYW1wYWlnblBoYXNlLFxuICAgIG1ldHJpY3M6IFByb2dyZXNzTWV0cmljc1xuICApOiBzdHJpbmdbXSB7XG4gICAgY29uc3QgYWNoaWV2ZW1lbnRzOiBzdHJpbmdbXSA9IFtdO1xuXG4gICAgaWYgKG1ldHJpY3MudHlwZVNjcmlwdEVycm9ycy5jdXJyZW50ID09PSAwKSB7XG4gICAgICBhY2hpZXZlbWVudHMucHVzaCgnWmVybyBUeXBlU2NyaXB0IGVycm9ycyBhY2hpZXZlZCcpO1xuICAgIH1cblxuICAgIGlmIChtZXRyaWNzLmxpbnRpbmdXYXJuaW5ncy5jdXJyZW50ID09PSAwKSB7XG4gICAgICBhY2hpZXZlbWVudHMucHVzaCgnWmVybyBsaW50aW5nIHdhcm5pbmdzIGFjaGlldmVkJyk7XG4gICAgfVxuXG4gICAgaWYgKG1ldHJpY3MuYnVpbGRQZXJmb3JtYW5jZS5jdXJyZW50VGltZSA8PSAxMCkge1xuICAgICAgYWNoaWV2ZW1lbnRzLnB1c2goJ0J1aWxkIHRpbWUgdW5kZXIgMTAgc2Vjb25kcyBtYWludGFpbmVkJyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGFjaGlldmVtZW50cztcbiAgfVxuXG4gIHByaXZhdGUgZ2VuZXJhdGVSZWNvbW1lbmRhdGlvbnMoXG4gICAgcGhhc2U6IENhbXBhaWduUGhhc2UsXG4gICAgdmFsaWRhdGlvbjogVmFsaWRhdGlvblJlc3VsdFxuICApOiBzdHJpbmdbXSB7XG4gICAgY29uc3QgcmVjb21tZW5kYXRpb25zOiBzdHJpbmdbXSA9IFtdO1xuXG4gICAgaWYgKHZhbGlkYXRpb24uZXJyb3JzLmxlbmd0aCA+IDApIHtcbiAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKCdBZGRyZXNzIHZhbGlkYXRpb24gZXJyb3JzIGJlZm9yZSBwcm9jZWVkaW5nJyk7XG4gICAgfVxuXG4gICAgaWYgKHZhbGlkYXRpb24ud2FybmluZ3MubGVuZ3RoID4gMCkge1xuICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goXG4gICAgICAgICdDb25zaWRlciBhZGRyZXNzaW5nIHdhcm5pbmdzIGZvciBvcHRpbWFsIHBlcmZvcm1hbmNlJ1xuICAgICAgKTtcbiAgICB9XG5cbiAgICByZXR1cm4gcmVjb21tZW5kYXRpb25zO1xuICB9XG5cbiAgcHJpdmF0ZSBhZGRTYWZldHlFdmVudChldmVudDogU2FmZXR5RXZlbnQpOiB2b2lkIHtcbiAgICB0aGlzLnNhZmV0eUV2ZW50cy5wdXNoKGV2ZW50KTtcblxuICAgIC8vIEtlZXAgb25seSByZWNlbnQgZXZlbnRzIHRvIHByZXZlbnQgbWVtb3J5IGlzc3Vlc1xuICAgIGlmICh0aGlzLnNhZmV0eUV2ZW50cy5sZW5ndGggPiAxMDAwKSB7XG4gICAgICB0aGlzLnNhZmV0eUV2ZW50cyA9IHRoaXMuc2FmZXR5RXZlbnRzLnNsaWNlKC01MDApO1xuICAgIH1cbiAgfVxufVxuIl0sInZlcnNpb24iOjN9