365e3ef060f329a87950bd332b7d3703
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.calculateSeasonalScores = exports.calculateSeasonalElements = exports.calculateSeasonalEffectiveness = void 0;
const seasonalModifiers_1 = require("@/constants/seasonalModifiers");
const zodiacSeasons_1 = require("@/data/zodiacSeasons");
/**
 * Calculates how effective a recipe is for a given season or zodiac sign
 */
function calculateSeasonalEffectiveness(recipe, season) {
    var _a;
    let totalScore = 0;
    const breakdown = {
        elementalAlignment: 0,
        ingredientSuitability: 0,
        seasonalBonus: 0
    };
    // Normalize season to lowercase for consistent lookup
    const seasonLower = season.toLowerCase();
    // 1. Calculate Elemental Alignment (50% of total)
    const elementalScore = Object.entries(recipe.elementalProperties || {}).reduce((score, [element, value]) => {
        // Get modifier from SEASONAL_MODIFIERS using lowercase season
        // Using proper type access with fallback
        const seasonModifiers = seasonalModifiers_1.SEASONAL_MODIFIERS[seasonLower] || {};
        const seasonalModifier = seasonModifiers[element] || 0.25;
        return score + (value * seasonalModifier);
    }, 0);
    breakdown.elementalAlignment = elementalScore * 50;
    totalScore += breakdown.elementalAlignment;
    // 2. Calculate Ingredient Seasonality (30% of total)
    if ((_a = recipe.ingredients) === null || _a === void 0 ? void 0 : _a.length) {
        // Count ingredients that have this season in their seasonality array
        let seasonalCount = 0;
        for (const ingredient of recipe.ingredients) {
            if (Array.isArray(ingredient.seasonality)) {
                const lowerSeasons = ingredient.seasonality.map((s) => s.toLowerCase());
                if (lowerSeasons.includes(seasonLower) || lowerSeasons.includes('all')) {
                    seasonalCount++;
                }
            }
        }
        const ingredientScore = (seasonalCount / recipe.ingredients.length) * 30;
        breakdown.ingredientSuitability = ingredientScore;
        totalScore += ingredientScore;
    }
    // 3. Calculate Direct Season Match (20% of total)
    if (recipe.season) {
        const recipeSeasons = Array.isArray(recipe.season) ? recipe.season : [recipe.season];
        const recipeSeasonLower = recipeSeasons.map((s) => s.toLowerCase());
        if (recipeSeasonLower.includes(seasonLower)) {
            breakdown.seasonalBonus = 20;
            totalScore += 20;
        }
    }
    // Normalize score to 0-100 range
    const normalizedScore = Math.round(Math.max(0, Math.min(100, totalScore)));
    // Determine rating based on score
    let rating = 'Poor';
    if (normalizedScore >= 80)
        rating = 'Excellent';
    else if (normalizedScore >= 60)
        rating = 'Good';
    else if (normalizedScore >= 40)
        rating = 'Average';
    else if (normalizedScore >= 20)
        rating = 'Below Average';
    return {
        score: normalizedScore,
        rating,
        breakdown
    };
}
exports.calculateSeasonalEffectiveness = calculateSeasonalEffectiveness;
function calculateSeasonalElements(baseElements, season) {
    const normalizedSeason = season.toLowerCase();
    const modifier = seasonalModifiers_1.SEASONAL_MODIFIERS[normalizedSeason] || {};
    return Object.fromEntries(Object.entries(baseElements).map(([element, value]) => {
        const adjusted = value + (modifier[element] || 0);
        return [element, Math.max(0, Math.min(1, adjusted))];
    }));
}
exports.calculateSeasonalElements = calculateSeasonalElements;
function calculateSeasonalScores(recipeElements, zodiacSign) {
    // Get current zodiac sign if none provided
    const currentZodiac = (zodiacSign === null || zodiacSign === void 0 ? void 0 : zodiacSign.toLowerCase()) || getCurrentZodiacSeason().toLowerCase();
    // Use the zodiac sign directly with our new SEASONAL_MODIFIERS
    const seasonMultiplier = 1.2; // Fixed multiplier
    // Calculate seasonal alignment - direct check with current zodiac
    const isAlignedWithSeason = currentZodiac === (zodiacSign === null || zodiacSign === void 0 ? void 0 : zodiacSign.toLowerCase());
    const seasonalScore = isAlignedWithSeason ? 80 : 50;
    const astrologicalInfluence = isAlignedWithSeason ? 1.2 : 1.0;
    return {
        seasonalScore,
        astrologicalInfluence
    };
}
exports.calculateSeasonalScores = calculateSeasonalScores;
// Helper function to get current season as a zodiac sign
function getCurrentZodiacSeason() {
    return (0, zodiacSeasons_1.getZodiacSignForDate)(new Date());
}
// For backward compatibility
function _getCurrentSeason() {
    const zodiacSign = getCurrentZodiacSeason();
    // Map zodiac sign to a season
    if (['aries', 'taurus', 'gemini'].includes(zodiacSign)) {
        return 'spring';
    }
    else if (['cancer', 'leo', 'virgo'].includes(zodiacSign)) {
        return 'summer';
    }
    else if (['libra', 'scorpio', 'sagittarius'].includes(zodiacSign)) {
        return 'autumn';
    }
    else {
        return 'winter';
    }
}
exports.default = {
    calculateSeasonalEffectiveness,
    SEASONAL_MODIFIERS: seasonalModifiers_1.SEASONAL_MODIFIERS
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9jYWxjdWxhdGlvbnMvc2Vhc29uYWxDYWxjdWxhdGlvbnMudHMiLCJtYXBwaW5ncyI6Ijs7O0FBQ0EscUVBQWtFO0FBQ2xFLHdEQUE0RDtBQWE1RDs7R0FFRztBQUNILFNBQWdCLDhCQUE4QixDQUFDLE1BQWMsRUFBRSxNQUFjOztJQUN6RSxJQUFJLFVBQVUsR0FBRyxDQUFDLENBQUM7SUFDbkIsTUFBTSxTQUFTLEdBQUc7UUFDZCxrQkFBa0IsRUFBRSxDQUFDO1FBQ3JCLHFCQUFxQixFQUFFLENBQUM7UUFDeEIsYUFBYSxFQUFFLENBQUM7S0FDbkIsQ0FBQztJQUVGLHNEQUFzRDtJQUN0RCxNQUFNLFdBQVcsR0FBRyxNQUFNLENBQUMsV0FBVyxFQUFFLENBQUM7SUFFekMsa0RBQWtEO0lBQ2xELE1BQU0sY0FBYyxHQUFHLE1BQU0sQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLG1CQUFtQixJQUFJLEVBQUUsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxDQUFDLEtBQUssRUFBRSxDQUFDLE9BQU8sRUFBRSxLQUFLLENBQUMsRUFBRSxFQUFFO1FBQ3ZHLDhEQUE4RDtRQUM5RCx5Q0FBeUM7UUFDekMsTUFBTSxlQUFlLEdBQUcsc0NBQWtCLENBQUMsV0FBVyxDQUFDLElBQUksRUFBRSxDQUFDO1FBQzlELE1BQU0sZ0JBQWdCLEdBQUcsZUFBZSxDQUFDLE9BQW9DLENBQUMsSUFBSSxJQUFJLENBQUM7UUFDdkYsT0FBTyxLQUFLLEdBQUcsQ0FBQyxLQUFLLEdBQUcsZ0JBQWdCLENBQUMsQ0FBQztJQUM5QyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFDTixTQUFTLENBQUMsa0JBQWtCLEdBQUcsY0FBYyxHQUFHLEVBQUUsQ0FBQztJQUNuRCxVQUFVLElBQUksU0FBUyxDQUFDLGtCQUFrQixDQUFDO0lBRTNDLHFEQUFxRDtJQUNyRCxJQUFJLE1BQUEsTUFBTSxDQUFDLFdBQVcsMENBQUUsTUFBTSxFQUFFO1FBQzVCLHFF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QUFJLENBQUMsUUFBUSxFQUFFLEtBQUssRUFBRSxPQUFPLENBQUMsQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLEVBQUU7UUFDMUQsT0FBTyxRQUFRLENBQUM7S0FDakI7U0FBTSxJQUFJLENBQUMsT0FBTyxFQUFFLFNBQVMsRUFBRSxhQUFhLENBQUMsQ0FBQyxRQUFRLENBQUMsVUFBVSxDQUFDLEVBQUU7UUFDbkUsT0FBTyxRQUFRLENBQUM7S0FDakI7U0FBTTtRQUNMLE9BQU8sUUFBUSxDQUFDO0tBQ2pCO0FBQ0gsQ0FBQztBQUVELGtCQUFlO0lBQ1gsOEJBQThCO0lBQzlCLGtCQUFrQixFQUFsQixzQ0FBa0I7Q0FDckIsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvR3JlZ0Nhc3Ryby9EZXNrdG9wL1doYXRUb0VhdE5leHQvc3JjL2NhbGN1bGF0aW9ucy9zZWFzb25hbENhbGN1bGF0aW9ucy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7IEVsZW1lbnRhbFByb3BlcnRpZXMsIFJlY2lwZSwgU2Vhc29uLCBab2RpYWNTaWduIH0gZnJvbSAnQC90eXBlcy9hbGNoZW15JztcbmltcG9ydCB7IFNFQVNPTkFMX01PRElGSUVSU30gZnJvbSAnQC9jb25zdGFudHMvc2Vhc29uYWxNb2RpZmllcnMnO1xuaW1wb3J0IHsgZ2V0Wm9kaWFjU2lnbkZvckRhdGUgfSBmcm9tICdAL2RhdGEvem9kaWFjU2Vhc29ucyc7XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2Vhc29uYWxFZmZlY3RpdmVuZXNzIHtcbiAgICBzY29yZTogbnVtYmVyO1xuICAgIHJhdGluZzogc3RyaW5nO1xuICAgIGJyZWFrZG93bjoge1xuICAgICAgICBlbGVtZW50YWxBbGlnbm1lbnQ6IG51bWJlcjtcbiAgICAgICAgaW5ncmVkaWVudFN1aXRhYmlsaXR5OiBudW1iZXI7XG4gICAgICAgIHNlYXNvbmFsQm9udXM6IG51bWJlcjtcbiAgICB9O1xuICAgIGVsZW1lbnRhbEJyZWFrZG93bj86IFJlY29yZDxzdHJpbmcsIG51bWJlcj47XG59XG5cbi8qKlxuICogQ2FsY3VsYXRlcyBob3cgZWZmZWN0aXZlIGEgcmVjaXBlIGlzIGZvciBhIGdpdmVuIHNlYXNvbiBvciB6b2RpYWMgc2lnblxuICovXG5leHBvcnQgZnVuY3Rpb24gY2FsY3VsYXRlU2Vhc29uYWxFZmZlY3RpdmVuZXNzKHJlY2lwZTogUmVjaXBlLCBzZWFzb246IHN0cmluZyk6IFNlYXNvbmFsRWZmZWN0aXZlbmVzcyB7XG4gICAgbGV0IHRvdGFsU2NvcmUgPSAwO1xuICAgIGNvbnN0IGJyZWFrZG93biA9IHtcbiAgICAgICAgZWxlbWVudGFsQWxpZ25tZW50OiAwLFxuICAgICAgICBpbmdyZWRpZW50U3VpdGFiaWxpdHk6IDAsXG4gICAgICAgIHNlYXNvbmFsQm9udXM6IDBcbiAgICB9O1xuXG4gICAgLy8gTm9ybWFsaXplIHNlYXNvbiB0byBsb3dlcmNhc2UgZm9yIGNvbnNpc3RlbnQgbG9va3VwXG4gICAgY29uc3Qgc2Vhc29uTG93ZXIgPSBzZWFzb24udG9Mb3dlckNhc2UoKTtcblxuICAgIC8vIDEuIENhbGN1bGF0ZSBFbGVtZW50YWwgQWxpZ25tZW50ICg1MCUgb2YgdG90YWwpXG4gICAgY29uc3QgZWxlbWVudGFsU2NvcmUgPSBPYmplY3QuZW50cmllcyhyZWNpcGUuZWxlbWVudGFsUHJvcGVydGllcyB8fCB7fSkucmVkdWNlKChzY29yZSwgW2VsZW1lbnQsIHZhbHVlXSkgPT4ge1xuICAgICAgICAvLyBHZXQgbW9kaWZpZXIgZnJvbSBTRUFTT05BTF9NT0RJRklFUlMgdXNpbmcgbG93ZXJjYXNlIHNlYXNvblxuICAgICAgICAvLyBVc2luZyBwcm9wZXIgdHlwZSBhY2Nlc3Mgd2l0aCBmYWxsYmFja1xuICAgICAgICBjb25zdCBzZWFzb25Nb2RpZmllcnMgPSBTRUFTT05BTF9NT0RJRklFUlNbc2Vhc29uTG93ZXJdIHx8IHt9O1xuICAgICAgICBjb25zdCBzZWFzb25hbE1vZGlmaWVyID0gc2Vhc29uTW9kaWZpZXJzW2VsZW1lbnQgYXMga2V5b2YgRWxlbWVudGFsUHJvcGVydGllc10gfHwgMC4yNTtcbiAgICAgICAgcmV0dXJuIHNjb3JlICsgKHZhbHVlICogc2Vhc29uYWxNb2RpZmllcik7XG4gICAgfSwgMCk7XG4gICAgYnJlYWtkb3duLmVsZW1lbnRhbEFsaWdubWVudCA9IGVsZW1lbnRhbFNjb3JlICogNTA7XG4gICAgdG90YWxTY29yZSArPSBicmVha2Rvd24uZWxlbWVudGFsQWxpZ25tZW50O1xuXG4gICAgLy8gMi4gQ2FsY3VsYXRlIEluZ3JlZGllbnQgU2Vhc29uYWxpdHkgKDMwJSBvZiB0b3RhbClcbiAgICBpZiAocmVjaXBlLmluZ3JlZGllbnRzPy5sZW5ndGgpIHtcbiAgICAgICAgLy8gQ291bnQgaW5ncmVkaWVudHMgdGhhdCBoYXZlIHRoaXMgc2Vhc29uIGluIHRoZWlyIHNlYXNvbmFsaXR5IGFycmF5XG4gICAgICAgIGxldCBzZWFzb25hbENvdW50ID0gMDtcbiAgICAgICAgZm9yIChjb25zdCBpbmdyZWRpZW50IG9mIHJlY2lwZS5pbmdyZWRpZW50cykge1xuICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoaW5ncmVkaWVudC5zZWFzb25hbGl0eSkpIHtcbiAgICAgICAgICAgICAgICBjb25zdCBsb3dlclNlYXNvbnMgPSBpbmdyZWRpZW50LnNlYXNvbmFsaXR5Lm1hcCgoczogc3RyaW5nKSA9PiBcbiAgICAgICAgICAgICAgICAgICAgcy50b0xvd2VyQ2FzZSgpKTtcbiAgICAgICAgICAgICAgICBpZiAobG93ZXJTZWFzb25zLmluY2x1ZGVzKHNlYXNvbkxvd2VyKSB8fCBsb3dlclNlYXNvbnMuaW5jbHVkZXMoJ2FsbCcpKSB7XG4gICAgICAgICAgICAgICAgICAgIHNlYXNvbmFsQ291bnQrKztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIGNvbnN0IGluZ3JlZGllbnRTY29yZSA9IChzZWFzb25hbENvdW50IC8gcmVjaXBlLmluZ3JlZGllbnRzLmxlbmd0aCkgKiAzMDtcbiAgICAgICAgYnJlYWtkb3duLmluZ3JlZGllbnRTdWl0YWJpbGl0eSA9IGluZ3JlZGllbnRTY29yZTtcbiAgICAgICAgdG90YWxTY29yZSArPSBpbmdyZWRpZW50U2NvcmU7XG4gICAgfVxuXG4gICAgLy8gMy4gQ2FsY3VsYXRlIERpcmVjdCBTZWFzb24gTWF0Y2ggKDIwJSBvZiB0b3RhbClcbiAgICBpZiAocmVjaXBlLnNlYXNvbikge1xuICAgICAgICBjb25zdCByZWNpcGVTZWFzb25zID0gQXJyYXkuaXNBcnJheShyZWNpcGUuc2Vhc29uKSA/IHJlY2lwZS5zZWFzb24gOiBbcmVjaXBlLnNlYXNvbl07XG4gICAgICAgIGNvbnN0IHJlY2lwZVNlYXNvbkxvd2VyID0gcmVjaXBlU2Vhc29ucy5tYXAoKHM6IHN0cmluZykgPT4gcy50b0xvd2VyQ2FzZSgpKTtcbiAgICAgICAgICAgIFxuICAgICAgICBpZiAocmVjaXBlU2Vhc29uTG93ZXIuaW5jbHVkZXMoc2Vhc29uTG93ZXIpKSB7XG4gICAgICAgICAgICBicmVha2Rvd24uc2Vhc29uYWxCb251cyA9IDIwO1xuICAgICAgICAgICAgdG90YWxTY29yZSArPSAyMDtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vIE5vcm1hbGl6ZSBzY29yZSB0byAwLTEwMCByYW5nZVxuICAgIGNvbnN0IG5vcm1hbGl6ZWRTY29yZSA9IE1hdGgucm91bmQoTWF0aC5tYXgoMCwgTWF0aC5taW4oMTAwLCB0b3RhbFNjb3JlKSkpO1xuXG4gICAgLy8gRGV0ZXJtaW5lIHJhdGluZyBiYXNlZCBvbiBzY29yZVxuICAgIGxldCByYXRpbmcgPSAnUG9vcic7XG4gICAgaWYgKG5vcm1hbGl6ZWRTY29yZSA+PSA4MCkgcmF0aW5nID0gJ0V4Y2VsbGVudCc7XG4gICAgZWxzZSBpZiAobm9ybWFsaXplZFNjb3JlID49IDYwKSByYXRpbmcgPSAnR29vZCc7XG4gICAgZWxzZSBpZiAobm9ybWFsaXplZFNjb3JlID49IDQwKSByYXRpbmcgPSAnQXZlcmFnZSc7XG4gICAgZWxzZSBpZiAobm9ybWFsaXplZFNjb3JlID49IDIwKSByYXRpbmcgPSAnQmVsb3cgQXZlcmFnZSc7XG4gICAgXG4gICAgcmV0dXJuIHtcbiAgICAgICAgc2NvcmU6IG5vcm1hbGl6ZWRTY29yZSxcbiAgICAgICAgcmF0aW5nLFxuICAgICAgICBicmVha2Rvd25cbiAgICB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY2FsY3VsYXRlU2Vhc29uYWxFbGVtZW50cyhcbiAgICBiYXNlRWxlbWVudHM6IEVsZW1lbnRhbFByb3BlcnRpZXMsXG4gICAgc2Vhc29uOiBzdHJpbmdcbik6IEVsZW1lbnRhbFByb3BlcnRpZXMge1xuICAgIGNvbnN0IG5vcm1hbGl6ZWRTZWFzb24gPSBzZWFzb24udG9Mb3dlckNhc2UoKTtcbiAgICBjb25zdCBtb2RpZmllciA9IFNFQVNPTkFMX01PRElGSUVSU1tub3JtYWxpemVkU2Vhc29uXSB8fCB7fTtcbiAgICBcbiAgICByZXR1cm4gT2JqZWN0LmZyb21FbnRyaWVzKFxuICAgICAgICBPYmplY3QuZW50cmllcyhiYXNlRWxlbWVudHMpLm1hcCgoW2VsZW1lbnQsIHZhbHVlXSkgPT4ge1xuICAgICAgICAgICAgY29uc3QgYWRqdXN0ZWQgPSB2YWx1ZSArIChtb2RpZmllcltlbGVtZW50IGFzIGtleW9mIEVsZW1lbnRhbFByb3BlcnRpZXNdIHx8IDApO1xuICAgICAgICAgICAgcmV0dXJuIFtlbGVtZW50LCBNYXRoLm1heCgwLCBNYXRoLm1pbigxLCBhZGp1c3RlZCkpXTtcbiAgICAgICAgfSlcbiAgICApIGFzIEVsZW1lbnRhbFByb3BlcnRpZXM7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjYWxjdWxhdGVTZWFzb25hbFNjb3JlcyhcbiAgcmVjaXBlRWxlbWVudHM6IEVsZW1lbnRhbFByb3BlcnRpZXMsXG4gIHpvZGlhY1NpZ24/OiBzdHJpbmdcbik6IHtcbiAgc2Vhc29uYWxTY29yZTogbnVtYmVyO1xuICBhc3Ryb2xvZ2ljYWxJbmZsdWVuY2U6IG51bWJlcjtcbn0ge1xuICAvLyBHZXQgY3VycmVudCB6b2RpYWMgc2lnbiBpZiBub25lIHByb3ZpZGVkXG4gIGNvbnN0IGN1cnJlbnRab2RpYWMgPSB6b2RpYWNTaWduPy50b0xvd2VyQ2FzZSgpIHx8IGdldEN1cnJlbnRab2RpYWNTZWFzb24oKS50b0xvd2VyQ2FzZSgpO1xuICBcbiAgLy8gVXNlIHRoZSB6b2RpYWMgc2lnbiBkaXJlY3RseSB3aXRoIG91ciBuZXcgU0VBU09OQUxfTU9ESUZJRVJTXG4gIGNvbnN0IHNlYXNvbk11bHRpcGxpZXIgPSAxLjI7IC8vIEZpeGVkIG11bHRpcGxpZXJcbiAgXG4gIC8vIENhbGN1bGF0ZSBzZWFzb25hbCBhbGlnbm1lbnQgLSBkaXJlY3QgY2hlY2sgd2l0aCBjdXJyZW50IHpvZGlhY1xuICBjb25zdCBpc0FsaWduZWRXaXRoU2Vhc29uID0gY3VycmVudFpvZGlhYyA9PT0gem9kaWFjU2lnbj8udG9Mb3dlckNhc2UoKTtcbiAgXG4gIGNvbnN0IHNlYXNvbmFsU2NvcmUgPSBpc0FsaWduZWRXaXRoU2Vhc29uID8gODAgOiA1MDtcbiAgY29uc3QgYXN0cm9sb2dpY2FsSW5mbHVlbmNlID0gaXNBbGlnbmVkV2l0aFNlYXNvbiA/IDEuMiA6IDEuMDtcbiAgXG4gIHJldHVybiB7XG4gICAgc2Vhc29uYWxTY29yZSxcbiAgICBhc3Ryb2xvZ2ljYWxJbmZsdWVuY2VcbiAgfTtcbn1cblxuLy8gSGVscGVyIGZ1bmN0aW9uIHRvIGdldCBjdXJyZW50IHNlYXNvbiBhcyBhIHpvZGlhYyBzaWduXG5mdW5jdGlvbiBnZXRDdXJyZW50Wm9kaWFjU2Vhc29uKCk6IFpvZGlhY1NpZ24ge1xuICByZXR1cm4gZ2V0Wm9kaWFjU2lnbkZvckRhdGUobmV3IERhdGUoKSk7XG59XG5cbi8vIEZvciBiYWNrd2FyZCBjb21wYXRpYmlsaXR5XG5mdW5jdGlvbiBfZ2V0Q3VycmVudFNlYXNvbigpOiBTZWFzb24ge1xuICBjb25zdCB6b2RpYWNTaWduID0gZ2V0Q3VycmVudFpvZGlhY1NlYXNvbigpO1xuICAvLyBNYXAgem9kaWFjIHNpZ24gdG8gYSBzZWFzb25cbiAgaWYgKFsnYXJpZXMnLCAndGF1cnVzJywgJ2dlbWluaSddLmluY2x1ZGVzKHpvZGlhY1NpZ24pKSB7XG4gICAgcmV0dXJuICdzcHJpbmcnO1xuICB9IGVsc2UgaWYgKFsnY2FuY2VyJywgJ2xlbycsICd2aXJnbyddLmluY2x1ZGVzKHpvZGlhY1NpZ24pKSB7XG4gICAgcmV0dXJuICdzdW1tZXInO1xuICB9IGVsc2UgaWYgKFsnbGlicmEnLCAnc2NvcnBpbycsICdzYWdpdHRhcml1cyddLmluY2x1ZGVzKHpvZGlhY1NpZ24pKSB7XG4gICAgcmV0dXJuICdhdXR1bW4nO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiAnd2ludGVyJztcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCB7XG4gICAgY2FsY3VsYXRlU2Vhc29uYWxFZmZlY3RpdmVuZXNzLFxuICAgIFNFQVNPTkFMX01PRElGSUVSU1xufTsiXSwidmVyc2lvbiI6M30=