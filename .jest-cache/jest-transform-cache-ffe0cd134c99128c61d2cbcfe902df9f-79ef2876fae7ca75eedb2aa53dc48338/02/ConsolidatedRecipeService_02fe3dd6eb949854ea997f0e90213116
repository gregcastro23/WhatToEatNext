048fc15b10056f3eae2ec3230fb4a179
"use strict";
// Removed local type and logger definitions to avoid conflicts with imports
/**
 * ConsolidatedRecipeService.ts
 *
 * A consolidated implementation of the RecipeServiceInterface that combines
 * functionality from LocalRecipeService, UnifiedRecipeService, and RecipeElementalService.
 *
 * This service serves as the primary entry point for all recipe-related operations
 * in the WhatToEatNext application.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.consolidatedRecipeService = exports.ConsolidatedRecipeService = void 0;
const recipes_1 = require("../data/recipes");
const logger_1 = require("../utils/logger");
const LocalRecipeService_1 = require("./LocalRecipeService");
const UnifiedRecipeService_1 = require("./UnifiedRecipeService");
const errorHandler_1 = require("@/utils/errorHandler");
const RecipeElementalService_1 = require("./RecipeElementalService");
// Missing unified system imports
const recipes_2 = require("@/data/recipes");
/**
 * Implementation of the RecipeServiceInterface that delegates to specialized services
 * and consolidates their functionality into a single, consistent API.
 */
class ConsolidatedRecipeService {
    /**
     * Private constructor to enforce singleton pattern
     */
    constructor() {
        this.recipeCache = new Map();
        // Private constructor
    }
    /**
     * Get singleton instance
     */
    static getInstance() {
        if (!ConsolidatedRecipeService.instance) {
            ConsolidatedRecipeService.instance = new ConsolidatedRecipeService();
        }
        return ConsolidatedRecipeService.instance;
    }
    /**
     * Get all available recipes
     */
    async getAllRecipes() {
        try {
            return await LocalRecipeService_1.LocalRecipeService.getAllRecipes();
        }
        catch (error) {
            errorHandler_1.ErrorHandler.log(error, {
                component: 'ConsolidatedRecipeService',
                context: { action: 'getAllRecipes' }
            });
            return [];
        }
    }
    /**
     * Search for recipes based on criteria
     */
    async searchRecipes(criteria, options = {}) {
        try {
            // Convert our criteria to UnifiedRecipeService format
            const unifiedResults = await UnifiedRecipeService_1.unifiedRecipeService.searchRecipes(criteria);
            // Extract just the Recipe objects from the results
            return (unifiedResults || []).map((result) => result.recipe || result);
        }
        catch (error) {
            errorHandler_1.ErrorHandler.log(error, {
                component: 'ConsolidatedRecipeService',
                context: { action: 'searchRecipes', criteria }
            });
            return [];
        }
    }
    /**
     * Get recipes by cuisine
     */
    async getRecipesByCuisine(cuisine) {
        try {
            return await LocalRecipeService_1.LocalRecipeService.getRecipesByCuisine(cuisine);
        }
        catch (error) {
            errorHandler_1.ErrorHandler.log(error, {
                component: 'ConsolidatedRecipeService',
                context: { action: 'getRecipesByCuisine', cuisine }
            });
            return [];
        }
    }
    /**
     * Get recipes by zodiac sign
     */
    async getRecipesByZodiac(currentZodiacSign) {
        try {
            const recipeData = await (0, recipes_2.getRecipesForZodiac)(currentZodiacSign);
            return recipeData;
        }
        catch (error) {
            errorHandler_1.ErrorHandler.log(error, {
                component: 'ConsolidatedRecipeService',
                context: { action: 'getRecipesByZodiac', currentZodiacSign }
            });
            return [];
        }
    }
    /**
     * Get recipes by season
     */
    async getRecipesBySeason(season) {
        try {
            const recipeData = await (0, recipes_2.getRecipesForSeason)(season);
            return recipeData;
        }
        catch (error) {
            errorHandler_1.ErrorHandler.log(error, {
                component: 'ConsolidatedRecipeService',
                context: { action: 'getRecipesBySeason', season }
            });
            return [];
        }
    }
    /**
     * Get recipes by lunar phase
     */
    async getRecipesByLunarPhase(lunarPhase) {
        try {
            const recipeData = await (0, recipes_2.getRecipesForLunarPhase)(lunarPhase);
            return recipeData;
        }
        catch (error) {
            errorHandler_1.ErrorHandler.log(error, {
                component: 'ConsolidatedRecipeService',
                context: { action: 'getRecipesByLunarPhase', lunarPhase }
            });
            return [];
        }
    }
    /**
     * Get recipes by meal type
     */
    async getRecipesByMealType(mealType) {
        try {
            return await LocalRecipeService_1.LocalRecipeService.getRecipesByMealType(mealType);
        }
        catch (error) {
            errorHandler_1.ErrorHandler.log(error, {
                component: 'ConsolidatedRecipeService',
                context: { action: 'getRecipesByMealType', mealType }
            });
            return [];
        }
    }
    /**
     * Get recipes that match current planetary alignments
     */
    async getRecipesForPlanetaryAlignment(planetaryInfluences, minMatchScore = 0.6) {
        try {
            return await (0, recipes_1.getRecipesForPlanetaryAlignment)(planetaryInfluences, minMatchScore);
        }
        catch (error) {
            errorHandler_1.ErrorHandler.log(error, {
                component: 'ConsolidatedRecipeService',
                context: { action: 'getRecipesForPlanetaryAlignment' }
            });
            return [];
        }
    }
    /**
     * Get recipes that match a given flavor profile
     */
    async getRecipesForFlavorProfile(flavorProfile, minMatchScore = 0.7) {
        try {
            return await (0, recipes_1.getRecipesForFlavorProfile)(flavorProfile, minMatchScore);
        }
        catch (error) {
            errorHandler_1.ErrorHandler.log(error, {
                component: 'ConsolidatedRecipeService',
                context: { action: 'getRecipesForFlavorProfile' }
            });
            return [];
        }
    }
    /**
     * Get best recipe matches based on multiple criteria
     */
    async getBestRecipeMatches(criteria, limit = 10) {
        try {
            return await (0, recipes_1.getBestRecipeMatches)(criteria, limit);
        }
        catch (error) {
            errorHandler_1.ErrorHandler.log(error, {
                component: 'ConsolidatedRecipeService',
                context: { action: 'getBestRecipeMatches', criteria }
            });
            return [];
        }
    }
    /**
     * Generate a recipe based on criteria
     */
    async generateRecipe(criteria) {
        try {
            // Apply surgical type casting with variable extraction
            const serviceData = UnifiedRecipeService_1.unifiedRecipeService;
            const generateRecipeMethod = serviceData === null || serviceData === void 0 ? void 0 : serviceData.generateRecipe;
            const unifiedResult = generateRecipeMethod ? await generateRecipeMethod(criteria) : null;
            return (unifiedResult === null || unifiedResult === void 0 ? void 0 : unifiedResult.recipe) || null;
        }
        catch (error) {
            errorHandler_1.ErrorHandler.log(error, {
                component: 'ConsolidatedRecipeService',
                context: { action: 'generateRecipe', criteria }
            });
            throw error;
        }
    }
    /**
     * Generate a fusion recipe combining multiple cuisines
     */
    async generateFusionRecipe(cuisines, criteria) {
        try {
            // Apply surgical type casting with variable extraction
            const serviceData = UnifiedRecipeService_1.unifiedRecipeService;
            const generateFusionRecipeMethod = serviceData === null || serviceData === void 0 ? void 0 : serviceData.generateFusionRecipe;
            const unifiedResult = generateFusionRecipeMethod ? await generateFusionRecipeMethod(cuisines, criteria) : null;
            return (unifiedResult === null || unifiedResult === void 0 ? void 0 : unifiedResult.recipe) || null;
        }
        catch (error) {
            errorHandler_1.ErrorHandler.log(error, {
                component: 'ConsolidatedRecipeService',
                context: { action: 'generateFusionRecipe', cuisines, criteria }
            });
            throw error;
        }
    }
    /**
     * Adapt a recipe for the current season
     */
    async adaptRecipeForSeason(recipe, season) {
        try {
            // Apply surgical type casting with variable extraction
            const serviceData = UnifiedRecipeService_1.unifiedRecipeService;
            const adaptRecipeMethod = serviceData === null || serviceData === void 0 ? void 0 : serviceData.adaptRecipeForCurrentSeason;
            const unifiedResult = adaptRecipeMethod ? await adaptRecipeMethod(recipe) : null;
            return (unifiedResult === null || unifiedResult === void 0 ? void 0 : unifiedResult.recipe) || recipe;
        }
        catch (error) {
            errorHandler_1.ErrorHandler.log(error, {
                component: 'ConsolidatedRecipeService',
                context: { action: 'adaptRecipeForSeason', recipe, season }
            });
            return recipe; // Return original recipe on error
        }
    }
    /**
     * Calculate the elemental properties of a recipe
     */
    calculateElementalProperties(recipe) {
        try {
            return RecipeElementalService_1.recipeElementalService.deriveElementalProperties(recipe);
        }
        catch (error) {
            logger_1.logger.error('Error calculating elemental properties', error);
            // Return balanced properties on error
            return { Fire: 0.25, Water: 0.25, Earth: 0.25, Air: 0.25
            };
        }
    }
    /**
     * Get the dominant element of a recipe
     */
    getDominantElement(recipe) {
        try {
            return RecipeElementalService_1.recipeElementalService.getDominantElement(recipe);
        }
        catch (error) {
            logger_1.logger.error('Error getting dominant element', error);
            // Return Earth as default
            return { element: 'Earth', value: 0.25 };
        }
    }
    /**
     * Calculate the similarity between two recipes based on their elemental properties
     */
    calculateSimilarity(recipe1, recipe2) {
        var _a, _b;
        try {
            const elementalProps1 = (_a = RecipeElementalService_1.recipeElementalService.standardizeRecipe(recipe1)) === null || _a === void 0 ? void 0 : _a.elementalState;
            const elementalProps2 = (_b = RecipeElementalService_1.recipeElementalService.standardizeRecipe(recipe2)) === null || _b === void 0 ? void 0 : _b.elementalState;
            return RecipeElementalService_1.recipeElementalService.calculateSimilarity(elementalProps1, elementalProps2);
        }
        catch (error) {
            logger_1.logger.error('Error calculating recipe similarity', error);
            return 0.5; // Return neutral similarity on error
        }
    }
    /**
     * Clear the recipe cache
     */
    clearCache() {
        this.recipeCache.clear();
        LocalRecipeService_1.LocalRecipeService.clearCache();
    }
}
exports.ConsolidatedRecipeService = ConsolidatedRecipeService;
// Export singleton instance
exports.consolidatedRecipeService = ConsolidatedRecipeService.getInstance();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9zZXJ2aWNlcy9Db25zb2xpZGF0ZWRSZWNpcGVTZXJ2aWNlLnRzIiwibWFwcGluZ3MiOiI7QUFBQSw0RUFBNEU7QUFDNUU7Ozs7Ozs7O0dBUUc7OztBQUdILDZDQUl5QjtBQUN6Qiw0Q0FBeUM7QUFpQnpDLDZEQUEwRDtBQUMxRCxpRUFBcUY7QUFDckYsdURBQW9EO0FBQ3BELHFFQUFrRTtBQUVsRSxpQ0FBaUM7QUFDakMsNENBS3dCO0FBSXhCOzs7R0FHRztBQUNILE1BQWEseUJBQXlCO0lBSXBDOztPQUVHO0lBQ0g7UUFMUSxnQkFBVyxHQUEwQixJQUFJLEdBQUcsRUFBRSxDQUFDO1FBTXJELHNCQUFzQjtJQUN4QixDQUFDO0lBRUQ7O09BRUc7SUFDSSxNQUFNLENBQUMsV0FBVztRQUN2QixJQUFJLENBQUMseUJBQXlCLENBQUMsUUFBUSxFQUFFO1lBQ3ZDLHlCQUF5QixDQUFDLFFBQVEsR0FBRyxJQUFJLHlCQUF5QixFQUFFLENBQUM7U0FDdEU7UUFDRCxPQUFPLHlCQUF5QixDQUFDLFFBQVEsQ0FBQztJQUM1QyxDQUFDO0lBRUQ7O09BRUc7SUFDSCxLQUFLLENBQUMsYUFBYTtRQUNqQixJQUFJO1lBQ0YsT0FBTyxNQUFNLHVDQUFrQixDQUFDLGFBQWEsRUFBRSxDQUFDO1NBQ2pEO1FBQUMsT0FBTyxLQUFLLEVBQUU7WUFDZCwyQkFBWSxDQUFDLEdBQUcsQ0FBRSxLQUEwQixFQUFFO2dCQUM1QyxTQUFTLEVBQUUsMkJBQTJCO2dCQUN0QyxPQUFPLEVBQUUsRUFBRSxNQUFNLEVBQUUsZUFBZSxFQUFFO2FBQ3JDLENBQUMsQ0FBQztZQUNILE9BQU8sRUFBRSxDQUFDO1NBQ1g7SUFDSCxDQUFDO0lBRUQ7O09BRUc7SUFDSCxLQUFLLENBQUMsYUFBYSxDQUNqQixRQUE4QixFQUM5QixVQUF1QyxFQUFFO1FBRXpDLElBQUk7WUFDRixzREFBc0Q7WUFDdEQsTUFBTSxjQUFjLEdBQUcsTUFBTywyQ0FBZ0QsQ0FB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Q0FBQyxDQUFDO1lBQzNELE9BQU8sR0FBRyxDQUFDLENBQUMscUNBQXFDO1NBQ2xEO0lBQ0gsQ0FBQztJQUVEOztPQUVHO0lBQ0gsVUFBVTtRQUNSLElBQUksQ0FBQyxXQUFXLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDekIsdUNBQWtCLENBQUMsVUFBVSxFQUFFLENBQUM7SUFDbEMsQ0FBQztDQUNGO0FBMVRELDhEQTBUQztBQUVELDRCQUE0QjtBQUVmLFFBQUEseUJBQXlCLEdBQUcseUJBQXlCLENBQUMsV0FBVyxFQUFFLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9zZXJ2aWNlcy9Db25zb2xpZGF0ZWRSZWNpcGVTZXJ2aWNlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIFJlbW92ZWQgbG9jYWwgdHlwZSBhbmQgbG9nZ2VyIGRlZmluaXRpb25zIHRvIGF2b2lkIGNvbmZsaWN0cyB3aXRoIGltcG9ydHNcbi8qKlxuICogQ29uc29saWRhdGVkUmVjaXBlU2VydmljZS50c1xuICogXG4gKiBBIGNvbnNvbGlkYXRlZCBpbXBsZW1lbnRhdGlvbiBvZiB0aGUgUmVjaXBlU2VydmljZUludGVyZmFjZSB0aGF0IGNvbWJpbmVzXG4gKiBmdW5jdGlvbmFsaXR5IGZyb20gTG9jYWxSZWNpcGVTZXJ2aWNlLCBVbmlmaWVkUmVjaXBlU2VydmljZSwgYW5kIFJlY2lwZUVsZW1lbnRhbFNlcnZpY2UuXG4gKiBcbiAqIFRoaXMgc2VydmljZSBzZXJ2ZXMgYXMgdGhlIHByaW1hcnkgZW50cnkgcG9pbnQgZm9yIGFsbCByZWNpcGUtcmVsYXRlZCBvcGVyYXRpb25zXG4gKiBpbiB0aGUgV2hhdFRvRWF0TmV4dCBhcHBsaWNhdGlvbi5cbiAqL1xuXG5cbmltcG9ydCB7XG4gICAgICAgICBnZXRSZWNpcGVzRm9yUGxhbmV0YXJ5QWxpZ25tZW50LCBcbiAgICAgICAgIGdldFJlY2lwZXNGb3JGbGF2b3JQcm9maWxlLCBcbiAgICAgICAgIGdldEJlc3RSZWNpcGVNYXRjaGVzIFxufSBmcm9tICcuLi9kYXRhL3JlY2lwZXMnO1xuaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSAnLi4vdXRpbHMvbG9nZ2VyJztcblxuXG5pbXBvcnQgdHlwZSB7IFxuICBFbGVtZW50LCBcbiAgU2Vhc29uLCBcbiAgWm9kaWFjU2lnbiwgXG4gIEx1bmFyUGhhc2UsIFxuICBQbGFuZXROYW1lIFxuLCBFbGVtZW50YWxQcm9wZXJ0aWVzIH0gZnJvbSAnQC90eXBlcy9hbGNoZW15JztcblxuLy8gTWlzc2luZyBzZXJ2aWNlIGFuZCBpbnRlcmZhY2UgaW1wb3J0c1xuaW1wb3J0IHR5cGUgeyBSZWNpcGUgfSBmcm9tICdAL3R5cGVzL3JlY2lwZSc7XG5pbXBvcnQgdHlwZSB7IFJlY2lwZVNlcnZpY2VJbnRlcmZhY2UgLFxuICBSZWNpcGVTZWFyY2hDcml0ZXJpYSwgXG4gIFJlY2lwZVJlY29tbWVuZGF0aW9uT3B0aW9ucyBcbn0gZnJvbSAnLi9pbnRlcmZhY2VzL1JlY2lwZVNlcnZpY2VJbnRlcmZhY2UnO1xuaW1wb3J0IHsgTG9jYWxSZWNpcGVTZXJ2aWNlIH0gZnJvbSAnLi9Mb2NhbFJlY2lwZVNlcnZpY2UnO1xuaW1wb3J0IHsgVW5pZmllZFJlY2lwZVNlcnZpY2UgLCB1bmlmaWVkUmVjaXBlU2VydmljZSB9IGZyb20gJy4vVW5pZmllZFJlY2lwZVNlcnZpY2UnO1xuaW1wb3J0IHsgRXJyb3JIYW5kbGVyIH0gZnJvbSAnQC91dGlscy9lcnJvckhhbmRsZXInO1xuaW1wb3J0IHsgcmVjaXBlRWxlbWVudGFsU2VydmljZSB9IGZyb20gJy4vUmVjaXBlRWxlbWVudGFsU2VydmljZSc7XG5cbi8vIE1pc3NpbmcgdW5pZmllZCBzeXN0ZW0gaW1wb3J0c1xuaW1wb3J0IHsgXG4gIGdldFJlY2lwZXNGb3Jab2RpYWMsXG4gIGdldFJlY2lwZXNGb3JTZWFzb24sIFxuICBnZXRSZWNpcGVzRm9yTHVuYXJQaGFzZSxcbiAgZ2V0QWxsUmVjaXBlc1xufSBmcm9tICdAL2RhdGEvcmVjaXBlcyc7XG5cblxuXG4vKipcbiAqIEltcGxlbWVudGF0aW9uIG9mIHRoZSBSZWNpcGVTZXJ2aWNlSW50ZXJmYWNlIHRoYXQgZGVsZWdhdGVzIHRvIHNwZWNpYWxpemVkIHNlcnZpY2VzXG4gKiBhbmQgY29uc29saWRhdGVzIHRoZWlyIGZ1bmN0aW9uYWxpdHkgaW50byBhIHNpbmdsZSwgY29uc2lzdGVudCBBUEkuXG4gKi9cbmV4cG9ydCBjbGFzcyBDb25zb2xpZGF0ZWRSZWNpcGVTZXJ2aWNlIHtcbiAgcHJpdmF0ZSBzdGF0aWMgaW5zdGFuY2U6IENvbnNvbGlkYXRlZFJlY2lwZVNlcnZpY2U7XG4gIHByaXZhdGUgcmVjaXBlQ2FjaGU6IE1hcDxzdHJpbmcsIFJlY2lwZVtdPiA9IG5ldyBNYXAoKTtcbiAgXG4gIC8qKlxuICAgKiBQcml2YXRlIGNvbnN0cnVjdG9yIHRvIGVuZm9yY2Ugc2luZ2xldG9uIHBhdHRlcm5cbiAgICovXG4gIHByaXZhdGUgY29uc3RydWN0b3IoKSB7XG4gICAgLy8gUHJpdmF0ZSBjb25zdHJ1Y3RvclxuICB9XG4gIFxuICAvKipcbiAgICogR2V0IHNpbmdsZXRvbiBpbnN0YW5jZVxuICAgKi9cbiAgcHVibGljIHN0YXRpYyBnZXRJbnN0YW5jZSgpOiBDb25zb2xpZGF0ZWRSZWNpcGVTZXJ2aWNlIHtcbiAgICBpZiAoIUNvbnNvbGlkYXRlZFJlY2lwZVNlcnZpY2UuaW5zdGFuY2UpIHtcbiAgICAgIENvbnNvbGlkYXRlZFJlY2lwZVNlcnZpY2UuaW5zdGFuY2UgPSBuZXcgQ29uc29saWRhdGVkUmVjaXBlU2VydmljZSgpO1xuICAgIH1cbiAgICByZXR1cm4gQ29uc29saWRhdGVkUmVjaXBlU2VydmljZS5pbnN0YW5jZTtcbiAgfVxuICBcbiAgLyoqXG4gICAqIEdldCBhbGwgYXZhaWxhYmxlIHJlY2lwZXNcbiAgICovXG4gIGFzeW5jIGdldEFsbFJlY2lwZXMoKTogUHJvbWlzZTxSZWNpcGVbXT4ge1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gYXdhaXQgTG9jYWxSZWNpcGVTZXJ2aWNlLmdldEFsbFJlY2lwZXMoKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgRXJyb3JIYW5kbGVyLmxvZygoZXJyb3IgYXMgdW5rbm93biBhcyBFcnJvciksIHtcbiAgICAgICAgY29tcG9uZW50OiAnQ29uc29saWRhdGVkUmVjaXBlU2VydmljZScsXG4gICAgICAgIGNvbnRleHQ6IHsgYWN0aW9uOiAnZ2V0QWxsUmVjaXBlcycgfVxuICAgICAgfSk7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuICB9XG4gIFxuICAvKipcbiAgICogU2VhcmNoIGZvciByZWNpcGVzIGJhc2VkIG9uIGNyaXRlcmlhXG4gICAqL1xuICBhc3luYyBzZWFyY2hSZWNpcGVzKFxuICAgIGNyaXRlcmlhOiBSZWNpcGVTZWFyY2hDcml0ZXJpYSwgXG4gICAgb3B0aW9uczogUmVjaXBlUmVjb21tZW5kYXRpb25PcHRpb25zID0ge31cbiAgKTogUHJvbWlzZTxSZWNpcGVbXT4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBDb252ZXJ0IG91ciBjcml0ZXJpYSB0byBVbmlmaWVkUmVjaXBlU2VydmljZSBmb3JtYXRcbiAgICAgIGNvbnN0IHVuaWZpZWRSZXN1bHRzID0gYXdhaXQgKHVuaWZpZWRSZWNpcGVTZXJ2aWNlIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KS5zZWFyY2hSZWNpcGVzKGNyaXRlcmlhIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KTtcbiAgICAgIFxuICAgICAgLy8gRXh0cmFjdCBqdXN0IHRoZSBSZWNpcGUgb2JqZWN0cyBmcm9tIHRoZSByZXN1bHRzXG4gICAgICByZXR1cm4gKHVuaWZpZWRSZXN1bHRzIHx8IFtdKS5tYXAoKHJlc3VsdDogdW5rbm93bikgPT4gcmVzdWx0LnJlY2lwZSB8fCByZXN1bHQpIGFzIHVua25vd24gYXMgUmVjaXBlW107XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIEVycm9ySGFuZGxlci5sb2coKGVycm9yIGFzIHVua25vd24gYXMgRXJyb3IpLCB7XG4gICAgICAgIGNvbXBvbmVudDogJ0NvbnNvbGlkYXRlZFJlY2lwZVNlcnZpY2UnLFxuICAgICAgICBjb250ZXh0OiB7IGFjdGlvbjogJ3NlYXJjaFJlY2lwZXMnLCBjcml0ZXJpYSB9XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gIH1cbiAgXG4gIC8qKlxuICAgKiBHZXQgcmVjaXBlcyBieSBjdWlzaW5lXG4gICAqL1xuICBhc3luYyBnZXRSZWNpcGVzQnlDdWlzaW5lKGN1aXNpbmU6IHN0cmluZyk6IFByb21pc2U8UmVjaXBlW10+IHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGF3YWl0IExvY2FsUmVjaXBlU2VydmljZS5nZXRSZWNpcGVzQnlDdWlzaW5lKGN1aXNpbmUpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBFcnJvckhhbmRsZXIubG9nKChlcnJvciBhcyB1bmtub3duIGFzIEVycm9yKSwge1xuICAgICAgICBjb21wb25lbnQ6ICdDb25zb2xpZGF0ZWRSZWNpcGVTZXJ2aWNlJyxcbiAgICAgICAgY29udGV4dDogeyBhY3Rpb246ICdnZXRSZWNpcGVzQnlDdWlzaW5lJywgY3Vpc2luZSB9XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gIH1cbiAgXG4gIC8qKlxuICAgKiBHZXQgcmVjaXBlcyBieSB6b2RpYWMgc2lnblxuICAgKi9cbiAgYXN5bmMgZ2V0UmVjaXBlc0J5Wm9kaWFjKGN1cnJlbnRab2RpYWNTaWduOiBab2RpYWNTaWduKTogUHJvbWlzZTxSZWNpcGVbXT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCByZWNpcGVEYXRhID0gYXdhaXQgZ2V0UmVjaXBlc0ZvclpvZGlhYyhjdXJyZW50Wm9kaWFjU2lnbik7XG4gICAgICByZXR1cm4gcmVjaXBlRGF0YSBhcyBSZWNpcGVbXTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgRXJyb3JIYW5kbGVyLmxvZygoZXJyb3IgYXMgdW5rbm93biBhcyBFcnJvciksIHtcbiAgICAgICAgY29tcG9uZW50OiAnQ29uc29saWRhdGVkUmVjaXBlU2VydmljZScsXG4gICAgICAgIGNvbnRleHQ6IHsgYWN0aW9uOiAnZ2V0UmVjaXBlc0J5Wm9kaWFjJywgY3VycmVudFpvZGlhY1NpZ24gfVxuICAgICAgfSk7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuICB9XG4gIFxuICAvKipcbiAgICogR2V0IHJlY2lwZXMgYnkgc2Vhc29uXG4gICAqL1xuICBhc3luYyBnZXRSZWNpcGVzQnlTZWFzb24oc2Vhc29uOiBTZWFzb24pOiBQcm9taXNlPFJlY2lwZVtdPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlY2lwZURhdGEgPSBhd2FpdCBnZXRSZWNpcGVzRm9yU2Vhc29uKHNlYXNvbik7XG4gICAgICByZXR1cm4gcmVjaXBlRGF0YSBhcyBSZWNpcGVbXTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgRXJyb3JIYW5kbGVyLmxvZygoZXJyb3IgYXMgdW5rbm93biBhcyBFcnJvciksIHtcbiAgICAgICAgY29tcG9uZW50OiAnQ29uc29saWRhdGVkUmVjaXBlU2VydmljZScsXG4gICAgICAgIGNvbnRleHQ6IHsgYWN0aW9uOiAnZ2V0UmVjaXBlc0J5U2Vhc29uJywgc2Vhc29uIH1cbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbiAgfVxuICBcbiAgLyoqXG4gICAqIEdldCByZWNpcGVzIGJ5IGx1bmFyIHBoYXNlXG4gICAqL1xuICBhc3luYyBnZXRSZWNpcGVzQnlMdW5hclBoYXNlKGx1bmFyUGhhc2U6IEx1bmFyUGhhc2UpOiBQcm9taXNlPFJlY2lwZVtdPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlY2lwZURhdGEgPSBhd2FpdCBnZXRSZWNpcGVzRm9yTHVuYXJQaGFzZShsdW5hclBoYXNlKTtcbiAgICAgIHJldHVybiByZWNpcGVEYXRhIGFzIFJlY2lwZVtdO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBFcnJvckhhbmRsZXIubG9nKChlcnJvciBhcyB1bmtub3duIGFzIEVycm9yKSwge1xuICAgICAgICBjb21wb25lbnQ6ICdDb25zb2xpZGF0ZWRSZWNpcGVTZXJ2aWNlJyxcbiAgICAgICAgY29udGV4dDogeyBhY3Rpb246ICdnZXRSZWNpcGVzQnlMdW5hclBoYXNlJywgbHVuYXJQaGFzZSB9XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gIH1cbiAgXG4gIC8qKlxuICAgKiBHZXQgcmVjaXBlcyBieSBtZWFsIHR5cGVcbiAgICovXG4gIGFzeW5jIGdldFJlY2lwZXNCeU1lYWxUeXBlKG1lYWxUeXBlOiBzdHJpbmcpOiBQcm9taXNlPFJlY2lwZVtdPiB7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiBhd2FpdCBMb2NhbFJlY2lwZVNlcnZpY2UuZ2V0UmVjaXBlc0J5TWVhbFR5cGUobWVhbFR5cGUpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBFcnJvckhhbmRsZXIubG9nKChlcnJvciBhcyB1bmtub3duIGFzIEVycm9yKSwge1xuICAgICAgICBjb21wb25lbnQ6ICdDb25zb2xpZGF0ZWRSZWNpcGVTZXJ2aWNlJyxcbiAgICAgICAgY29udGV4dDogeyBhY3Rpb246ICdnZXRSZWNpcGVzQnlNZWFsVHlwZScsIG1lYWxUeXBlIH1cbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbiAgfVxuICBcbiAgLyoqXG4gICAqIEdldCByZWNpcGVzIHRoYXQgbWF0Y2ggY3VycmVudCBwbGFuZXRhcnkgYWxpZ25tZW50c1xuICAgKi9cbiAgYXN5bmMgZ2V0UmVjaXBlc0ZvclBsYW5ldGFyeUFsaWdubWVudChcbiAgICBwbGFuZXRhcnlJbmZsdWVuY2VzOiB7IFtrZXk6IHN0cmluZ106IG51bWJlciB9LFxuICAgIG1pbk1hdGNoU2NvcmU6IG51bWJlciA9IDAuNixcbiAgKTogUHJvbWlzZTxSZWNpcGVbXT4ge1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gYXdhaXQgZ2V0UmVjaXBlc0ZvclBsYW5ldGFyeUFsaWdubWVudChwbGFuZXRhcnlJbmZsdWVuY2VzLCBtaW5NYXRjaFNjb3JlKSBhcyB1bmtub3duIGFzIFJlY2lwZVtdO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBFcnJvckhhbmRsZXIubG9nKChlcnJvciBhcyB1bmtub3duIGFzIEVycm9yKSwge1xuICAgICAgICBjb21wb25lbnQ6ICdDb25zb2xpZGF0ZWRSZWNpcGVTZXJ2aWNlJyxcbiAgICAgICAgY29udGV4dDogeyBhY3Rpb246ICdnZXRSZWNpcGVzRm9yUGxhbmV0YXJ5QWxpZ25tZW50JyB9XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gIH1cbiAgXG4gIC8qKlxuICAgKiBHZXQgcmVjaXBlcyB0aGF0IG1hdGNoIGEgZ2l2ZW4gZmxhdm9yIHByb2ZpbGVcbiAgICovXG4gIGFzeW5jIGdldFJlY2lwZXNGb3JGbGF2b3JQcm9maWxlKFxuICAgIGZsYXZvclByb2ZpbGU6IHsgW2tleTogc3RyaW5nXTogbnVtYmVyIH0sXG4gICAgbWluTWF0Y2hTY29yZTogbnVtYmVyID0gMC43LFxuICApOiBQcm9taXNlPFJlY2lwZVtdPiB7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiBhd2FpdCBnZXRSZWNpcGVzRm9yRmxhdm9yUHJvZmlsZShmbGF2b3JQcm9maWxlLCBtaW5NYXRjaFNjb3JlKSBhcyB1bmtub3duIGFzIFJlY2lwZVtdO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBFcnJvckhhbmRsZXIubG9nKChlcnJvciBhcyB1bmtub3duIGFzIEVycm9yKSwge1xuICAgICAgICBjb21wb25lbnQ6ICdDb25zb2xpZGF0ZWRSZWNpcGVTZXJ2aWNlJyxcbiAgICAgICAgY29udGV4dDogeyBhY3Rpb246ICdnZXRSZWNpcGVzRm9yRmxhdm9yUHJvZmlsZScgfVxuICAgICAgfSk7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuICB9XG4gIFxuICAvKipcbiAgICogR2V0IGJlc3QgcmVjaXBlIG1hdGNoZXMgYmFzZWQgb24gbXVsdGlwbGUgY3JpdGVyaWFcbiAgICovXG4gIGFzeW5jIGdldEJlc3RSZWNpcGVNYXRjaGVzKFxuICAgIGNyaXRlcmlhOiB7XG4gICAgICBjdWlzaW5lPzogc3RyaW5nO1xuICAgICAgZmxhdm9yUHJvZmlsZT86IHsgW2tleTogc3RyaW5nXTogbnVtYmVyIH07XG4gICAgICBzZWFzb24/OiBTZWFzb247XG4gICAgICB6b2RpYWNTaWduPzogWm9kaWFjU2lnbjtcbiAgICAgIGx1bmFyUGhhc2U/OiBMdW5hclBoYXNlO1xuICAgICAgcGxhbmV0TmFtZT86IFBsYW5ldE5hbWU7XG4gICAgICBlbGVtZW50YWxGb2N1cz86IEVsZW1lbnQ7XG4gICAgICBtYXhSZXN1bHRzPzogbnVtYmVyO1xuICAgIH0sXG4gICAgbGltaXQ6IG51bWJlciA9IDEwXG4gICk6IFByb21pc2U8UmVjaXBlW10+IHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIGF3YWl0IGdldEJlc3RSZWNpcGVNYXRjaGVzKGNyaXRlcmlhLCBsaW1pdCkgYXMgdW5rbm93biBhcyBSZWNpcGVbXTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgRXJyb3JIYW5kbGVyLmxvZygoZXJyb3IgYXMgdW5rbm93biBhcyBFcnJvciksIHtcbiAgICAgICAgY29tcG9uZW50OiAnQ29uc29saWRhdGVkUmVjaXBlU2VydmljZScsXG4gICAgICAgIGNvbnRleHQ6IHsgYWN0aW9uOiAnZ2V0QmVzdFJlY2lwZU1hdGNoZXMnLCBjcml0ZXJpYSB9XG4gICAgICB9KTtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gIH1cbiAgXG4gIC8qKlxuICAgKiBHZW5lcmF0ZSBhIHJlY2lwZSBiYXNlZCBvbiBjcml0ZXJpYVxuICAgKi9cbiAgYXN5bmMgZ2VuZXJhdGVSZWNpcGUoY3JpdGVyaWE6IFJlY2lwZVNlYXJjaENyaXRlcmlhKTogUHJvbWlzZTxSZWNpcGU+IHtcbiAgICB0cnkge1xuICAgICAgLy8gQXBwbHkgc3VyZ2ljYWwgdHlwZSBjYXN0aW5nIHdpdGggdmFyaWFibGUgZXh0cmFjdGlvblxuICAgICAgY29uc3Qgc2VydmljZURhdGEgPSB1bmlmaWVkUmVjaXBlU2VydmljZSBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPjtcbiAgICAgIGNvbnN0IGdlbmVyYXRlUmVjaXBlTWV0aG9kID0gc2VydmljZURhdGE/LmdlbmVyYXRlUmVjaXBlO1xuICAgICAgY29uc3QgdW5pZmllZFJlc3VsdCA9IGdlbmVyYXRlUmVjaXBlTWV0aG9kID8gYXdhaXQgZ2VuZXJhdGVSZWNpcGVNZXRob2QoY3JpdGVyaWEpIDogbnVsbDtcbiAgICAgIHJldHVybiB1bmlmaWVkUmVzdWx0Py5yZWNpcGUgfHwgbnVsbDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgRXJyb3JIYW5kbGVyLmxvZygoZXJyb3IgYXMgdW5rbm93biBhcyBFcnJvciksIHtcbiAgICAgICAgY29tcG9uZW50OiAnQ29uc29saWRhdGVkUmVjaXBlU2VydmljZScsXG4gICAgICAgIGNvbnRleHQ6IHsgYWN0aW9uOiAnZ2VuZXJhdGVSZWNpcGUnLCBjcml0ZXJpYSB9XG4gICAgICB9KTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuICBcbiAgLyoqXG4gICAqIEdlbmVyYXRlIGEgZnVzaW9uIHJlY2lwZSBjb21iaW5pbmcgbXVsdGlwbGUgY3Vpc2luZXNcbiAgICovXG4gIGFzeW5jIGdlbmVyYXRlRnVzaW9uUmVjaXBlKFxuICAgIGN1aXNpbmVzOiBzdHJpbmdbXSxcbiAgICBjcml0ZXJpYTogUmVjaXBlU2VhcmNoQ3JpdGVyaWEsXG4gICk6IFByb21pc2U8UmVjaXBlPiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIEFwcGx5IHN1cmdpY2FsIHR5cGUgY2FzdGluZyB3aXRoIHZhcmlhYmxlIGV4dHJhY3Rpb25cbiAgICAgIGNvbnN0IHNlcnZpY2VEYXRhID0gdW5pZmllZFJlY2lwZVNlcnZpY2UgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj47XG4gICAgICBjb25zdCBnZW5lcmF0ZUZ1c2lvblJlY2lwZU1ldGhvZCA9IHNlcnZpY2VEYXRhPy5nZW5lcmF0ZUZ1c2lvblJlY2lwZTtcbiAgICAgIGNvbnN0IHVuaWZpZWRSZXN1bHQgPSBnZW5lcmF0ZUZ1c2lvblJlY2lwZU1ldGhvZCA/IGF3YWl0IGdlbmVyYXRlRnVzaW9uUmVjaXBlTWV0aG9kKGN1aXNpbmVzLCBjcml0ZXJpYSkgOiBudWxsO1xuICAgICAgcmV0dXJuIHVuaWZpZWRSZXN1bHQ/LnJlY2lwZSB8fCBudWxsO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBFcnJvckhhbmRsZXIubG9nKChlcnJvciBhcyB1bmtub3duIGFzIEVycm9yKSwge1xuICAgICAgICBjb21wb25lbnQ6ICdDb25zb2xpZGF0ZWRSZWNpcGVTZXJ2aWNlJyxcbiAgICAgICAgY29udGV4dDogeyBhY3Rpb246ICdnZW5lcmF0ZUZ1c2lvblJlY2lwZScsIGN1aXNpbmVzLCBjcml0ZXJpYSB9XG4gICAgICB9KTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuICBcbiAgLyoqXG4gICAqIEFkYXB0IGEgcmVjaXBlIGZvciB0aGUgY3VycmVudCBzZWFzb25cbiAgICovXG4gIGFzeW5jIGFkYXB0UmVjaXBlRm9yU2Vhc29uKFxuICAgIHJlY2lwZTogUmVjaXBlLFxuICAgIHNlYXNvbj86IFNlYXNvblxuICApOiBQcm9taXNlPFJlY2lwZT4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBBcHBseSBzdXJnaWNhbCB0eXBlIGNhc3Rpbmcgd2l0aCB2YXJpYWJsZSBleHRyYWN0aW9uXG4gICAgICBjb25zdCBzZXJ2aWNlRGF0YSA9IHVuaWZpZWRSZWNpcGVTZXJ2aWNlIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+O1xuICAgICAgY29uc3QgYWRhcHRSZWNpcGVNZXRob2QgPSBzZXJ2aWNlRGF0YT8uYWRhcHRSZWNpcGVGb3JDdXJyZW50U2Vhc29uO1xuICAgICAgY29uc3QgdW5pZmllZFJlc3VsdCA9IGFkYXB0UmVjaXBlTWV0aG9kID8gYXdhaXQgYWRhcHRSZWNpcGVNZXRob2QocmVjaXBlKSA6IG51bGw7XG4gICAgICByZXR1cm4gdW5pZmllZFJlc3VsdD8ucmVjaXBlIHx8IHJlY2lwZTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgRXJyb3JIYW5kbGVyLmxvZygoZXJyb3IgYXMgdW5rbm93biBhcyBFcnJvciksIHtcbiAgICAgICAgY29tcG9uZW50OiAnQ29uc29saWRhdGVkUmVjaXBlU2VydmljZScsXG4gICAgICAgIGNvbnRleHQ6IHsgYWN0aW9uOiAnYWRhcHRSZWNpcGVGb3JTZWFzb24nLCByZWNpcGUsIHNlYXNvbiB9XG4gICAgICB9KTtcbiAgICAgIHJldHVybiByZWNpcGU7IC8vIFJldHVybiBvcmlnaW5hbCByZWNpcGUgb24gZXJyb3JcbiAgICB9XG4gIH1cbiAgXG4gIC8qKlxuICAgKiBDYWxjdWxhdGUgdGhlIGVsZW1lbnRhbCBwcm9wZXJ0aWVzIG9mIGEgcmVjaXBlXG4gICAqL1xuICBjYWxjdWxhdGVFbGVtZW50YWxQcm9wZXJ0aWVzKHJlY2lwZTogUGFydGlhbDxSZWNpcGU+KTogRWxlbWVudGFsUHJvcGVydGllcyB7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiByZWNpcGVFbGVtZW50YWxTZXJ2aWNlLmRlcml2ZUVsZW1lbnRhbFByb3BlcnRpZXMocmVjaXBlKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdFcnJvciBjYWxjdWxhdGluZyBlbGVtZW50YWwgcHJvcGVydGllcycsIGVycm9yKTtcbiAgICAgIC8vIFJldHVybiBiYWxhbmNlZCBwcm9wZXJ0aWVzIG9uIGVycm9yXG4gICAgICByZXR1cm4geyBGaXJlOiAwLjI1LCBXYXRlcjogMC4yNSwgRWFydGg6IDAuMjUsIEFpcjogMC4yNVxuICAgICAgfTtcbiAgICB9XG4gIH1cbiAgXG4gIC8qKlxuICAgKiBHZXQgdGhlIGRvbWluYW50IGVsZW1lbnQgb2YgYSByZWNpcGVcbiAgICovXG4gIGdldERvbWluYW50RWxlbWVudChyZWNpcGU6IFJlY2lwZSk6IHsgZWxlbWVudDoga2V5b2YgRWxlbWVudGFsUHJvcGVydGllczsgdmFsdWU6IG51bWJlciB9IHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIHJlY2lwZUVsZW1lbnRhbFNlcnZpY2UuZ2V0RG9taW5hbnRFbGVtZW50KHJlY2lwZSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignRXJyb3IgZ2V0dGluZyBkb21pbmFudCBlbGVtZW50JywgZXJyb3IpO1xuICAgICAgLy8gUmV0dXJuIEVhcnRoIGFzIGRlZmF1bHRcbiAgICAgIHJldHVybiB7IGVsZW1lbnQ6ICdFYXJ0aCcsIHZhbHVlOiAwLjI1IH07XG4gICAgfVxuICB9XG4gIFxuICAvKipcbiAgICogQ2FsY3VsYXRlIHRoZSBzaW1pbGFyaXR5IGJldHdlZW4gdHdvIHJlY2lwZXMgYmFzZWQgb24gdGhlaXIgZWxlbWVudGFsIHByb3BlcnRpZXNcbiAgICovXG4gIGNhbGN1bGF0ZVNpbWlsYXJpdHkocmVjaXBlMTogUmVjaXBlLCByZWNpcGUyOiBSZWNpcGUpOiBudW1iZXIge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBlbGVtZW50YWxQcm9wczEgPSByZWNpcGVFbGVtZW50YWxTZXJ2aWNlLnN0YW5kYXJkaXplUmVjaXBlKHJlY2lwZTEpPy5lbGVtZW50YWxTdGF0ZTtcbiAgICAgIGNvbnN0IGVsZW1lbnRhbFByb3BzMiA9IHJlY2lwZUVsZW1lbnRhbFNlcnZpY2Uuc3RhbmRhcmRpemVSZWNpcGUocmVjaXBlMik/LmVsZW1lbnRhbFN0YXRlO1xuICAgICAgXG4gICAgICByZXR1cm4gcmVjaXBlRWxlbWVudGFsU2VydmljZS5jYWxjdWxhdGVTaW1pbGFyaXR5KFxuICAgICAgICBlbGVtZW50YWxQcm9wczEgYXMgdW5rbm93biBhcyBFbGVtZW50YWxQcm9wZXJ0aWVzLCBcbiAgICAgICAgZWxlbWVudGFsUHJvcHMyIGFzIHVua25vd24gYXMgRWxlbWVudGFsUHJvcGVydGllc1xuICAgICAgKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdFcnJvciBjYWxjdWxhdGluZyByZWNpcGUgc2ltaWxhcml0eScsIGVycm9yKTtcbiAgICAgIHJldHVybiAwLjU7IC8vIFJldHVybiBuZXV0cmFsIHNpbWlsYXJpdHkgb24gZXJyb3JcbiAgICB9XG4gIH1cbiAgXG4gIC8qKlxuICAgKiBDbGVhciB0aGUgcmVjaXBlIGNhY2hlXG4gICAqL1xuICBjbGVhckNhY2hlKCk6IHZvaWQge1xuICAgIHRoaXMucmVjaXBlQ2FjaGUuY2xlYXIoKTtcbiAgICBMb2NhbFJlY2lwZVNlcnZpY2UuY2xlYXJDYWNoZSgpO1xuICB9XG59XG5cbi8vIEV4cG9ydCBzaW5nbGV0b24gaW5zdGFuY2VcblxuZXhwb3J0IGNvbnN0IGNvbnNvbGlkYXRlZFJlY2lwZVNlcnZpY2UgPSBDb25zb2xpZGF0ZWRSZWNpcGVTZXJ2aWNlLmdldEluc3RhbmNlKCk7XG4iXSwidmVyc2lvbiI6M30=