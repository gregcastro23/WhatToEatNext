c1aaf83eccdd0a6ae18d8f0be55f92fc
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.ProgressMonitoringSystem = void 0;
const child_process_1 = require("child_process");
const events_1 = require("events");
const fs = __importStar(require("fs"));
const path = __importStar(require("path"));
const AnalysisTools_1 = require("./AnalysisTools");
/**
 * Real-time progress monitoring and alerting system
 * Provides dashboard functionality, safety protocol monitoring, and threshold-based alerts
 */
class ProgressMonitoringSystem extends events_1.EventEmitter {
    analysisTools;
    monitoringInterval = null;
    isMonitoring = false;
    dashboardData = null;
    alertThresholds;
    alertHistory = [];
    buildStabilityHistory = [];
    constructor(alertThresholds) {
        super();
        this.analysisTools = new AnalysisTools_1.AnalysisTools();
        this.alertThresholds = {
            successRateThreshold: 70,
            buildFailureThreshold: 3,
            classificationAccuracyThreshold: 80,
            safetyEventThreshold: 5,
            progressStallThreshold: 24,
            ...alertThresholds
        };
        this.loadAlertHistory();
        this.loadBuildStabilityHistory();
    }
    /**
     * Start real-time progress monitoring
     */
    startMonitoring(intervalMinutes = 5) {
        if (this.isMonitoring) {
            console.log('Progress monitoring is already running');
            return;
        }
        console.log(`Starting progress monitoring with ${intervalMinutes}-minute intervals`);
        this.isMonitoring = true;
        // Initial update
        this.updateDashboard();
        // Set up periodic updates
        this.monitoringInterval = setInterval(async () => {
            try {
                await this.updateDashboard();
                await this.checkAlertConditions();
                await this.monitorBuildStability();
            }
            catch (error) {
                console.error('Error during monitoring update:', error);
                this.emitAlert({
                    type: 'system_error',
                    severity: 'high',
                    message: `Monitoring system error: ${error.message}`,
                    timestamp: new Date(),
                    data: { error: error.message }
                });
            }
        }, intervalMinutes * 60 * 1000);
        this.emit('monitoring_started', { intervalMinutes });
    }
    /**
     * Stop real-time progress monitoring
     */
    stopMonitoring() {
        if (!this.isMonitoring) {
            console.log('Progress monitoring is not running');
            return;
        }
        console.log('Stopping progress monitoring');
        this.isMonitoring = false;
        if (this.monitoringInterval) {
            clearInterval(this.monitoringInterval);
            this.monitoringInterval = null;
        }
        this.emit('monitoring_stopped');
    }
    /**
     * Get current dashboard data
     */
    getDashboardData() {
        return this.dashboardData;
    }
    /**
     * Get real-time progress metrics
     */
    async getProgressMetrics() {
        console.log('Collecting real-time progress metrics...');
        const currentReport = await this.analysisTools.generateComprehensiveReport();
        const buildStability = await this.getCurrentBuildStability();
        const progress = {
            totalAnyTypes: currentReport.domainDistribution.totalAnyTypes,
            classifiedIntentional: currentReport.domainDistribution.intentionalVsUnintentional.intentional.count,
            classifiedUnintentional: currentReport.domainDistribution.intentionalVsUnintentional.unintentional.count,
            successfulReplacements: Math.floor(currentReport.summary.currentSuccessRate * currentReport.summary.totalAnyTypes / 100),
            documentedIntentional: currentReport.domainDistribution.intentionalVsUnintentional.intentional.count,
            remainingUnintentional: currentReport.domainDistribution.intentionalVsUnintentional.unintentional.count,
            reductionPercentage: this.calculateReductionPercentage(currentReport),
            targetReductionPercentage: 20,
            batchesCompleted: this.getBatchesCompleted(),
            averageSuccessRate: currentReport.summary.currentSuccessRate,
            // Base ProgressMetrics properties
            errorsFixed: 0,
            warningsFixed: 0,
            filesProcessed: 0,
            buildStable: buildStability.isStable,
            lastUpdate: new Date()
        };
        return progress;
    }
    /**
     * Monitor build stability
     */
    async monitorBuildStability() {
        const stability = await this.getCurrentBuildStability();
        // Add to history
        this.buildStabilityHistory.push(stability);
        // Keep only last 100 records
        if (this.buildStabilityHistory.length > 100) {
            this.buildStabilityHistory = this.buildStabilityHistory.slice(-100);
        }
        // Check for build stability issues
        if (!stability.isStable) {
            this.emitAlert({
                type: 'build_failure',
                severity: 'high',
                message: `Build failure detected: ${stability.errorMessage}`,
                timestamp: new Date(),
                data: {
                    buildTime: stability.buildTime,
                    errorCount: stability.errorCount,
                    errorMessage: stability.errorMessage
                }
            });
        }
        // Check for consecutive build failures
        const recentFailures = this.buildStabilityHistory
            .slice(-this.alertThresholds.buildFailureThreshold)
            .filter(record => !record.isStable);
        if (recentFailures.length >= this.alertThresholds.buildFailureThreshold) {
            this.emitAlert({
                type: 'consecutive_build_failures',
                severity: 'critical',
                message: `${recentFailures.length} consecutive build failures detected`,
                timestamp: new Date(),
                data: {
                    failureCount: recentFailures.length,
                    threshold: this.alertThresholds.buildFailureThreshold
                }
            });
        }
        await this.saveBuildStabilityHistory();
    }
    /**
     * Check alert conditions and emit alerts
     */
    async checkAlertConditions() {
        const progress = await this.getProgressMetrics();
        const currentTime = new Date();
        // Check success rate threshold
        if (progress.averageSuccessRate < this.alertThresholds.successRateThreshold) {
            this.emitAlert({
                type: 'low_success_rate',
                severity: 'medium',
                message: `Success rate (${progress.averageSuccessRate.toFixed(1)}%) below threshold (${this.alertThresholds.successRateThreshold}%)`,
                timestamp: currentTime,
                data: {
                    currentRate: progress.averageSuccessRate,
                    threshold: this.alertThresholds.successRateThreshold
                }
            });
        }
        // Check classification accuracy
        if (this.dashboardData?.accuracyReport.overallAccuracy < this.alertThresholds.classificationAccuracyThreshold) {
            this.emitAlert({
                type: 'low_classification_accuracy',
                severity: 'medium',
                message: `Classification accuracy (${this.dashboardData.accuracyReport.overallAccuracy.toFixed(1)}%) below threshold (${this.alertThresholds.classificationAccuracyThreshold}%)`,
                timestamp: currentTime,
                data: {
                    currentAccuracy: this.dashboardData.accuracyReport.overallAccuracy,
                    threshold: this.alertThresholds.classificationAccuracyThreshold
                }
            });
        }
        // Check for progress stall
        const lastProgressUpdate = this.getLastProgressUpdate();
        if (lastProgressUpdate) {
            const hoursSinceUpdate = (currentTime.getTime() - lastProgressUpdate.getTime()) / (1000 * 60 * 60);
            if (hoursSinceUpdate > this.alertThresholds.progressStallThreshold) {
                this.emitAlert({
                    type: 'progress_stall',
                    severity: 'medium',
                    message: `No progress detected for ${hoursSinceUpdate.toFixed(1)} hours`,
                    timestamp: currentTime,
                    data: {
                        hoursSinceUpdate,
                        threshold: this.alertThresholds.progressStallThreshold,
                        lastUpdate: lastProgressUpdate
                    }
                });
            }
        }
        // Check safety event frequency
        const recentSafetyEvents = this.getRecentSafetyEvents();
        if (recentSafetyEvents.length >= this.alertThresholds.safetyEventThreshold) {
            this.emitAlert({
                type: 'frequent_safety_events',
                severity: 'high',
                message: `${recentSafetyEvents.length} safety events in the last hour`,
                timestamp: currentTime,
                data: {
                    eventCount: recentSafetyEvents.length,
                    threshold: this.alertThresholds.safetyEventThreshold,
                    events: recentSafetyEvents
                }
            });
        }
    }
    /**
     * Handle safety protocol activation
     */
    handleSafetyProtocolActivation(event) {
        console.log(`Safety protocol activated: ${event.type}`);
        this.emitAlert({
            type: 'safety_protocol_activation',
            severity: event.severity === 'critical' ? 'critical' : 'high',
            message: `Safety protocol activated: ${event.description}`,
            timestamp: new Date(),
            data: {
                safetyEvent: event,
                action: event.action,
                affectedFiles: event.affectedFiles || []
            }
        });
        // If it's a critical safety event, consider stopping monitoring temporarily
        if (event.severity === 'critical') {
            this.emit('critical_safety_event', event);
        }
    }
    /**
     * Get alert history
     */
    getAlertHistory(limit) {
        const alerts = [...this.alertHistory].reverse(); // Most recent first
        return limit ? alerts.slice(0, limit) : alerts;
    }
    /**
     * Get build stability history
     */
    getBuildStabilityHistory(limit) {
        const history = [...this.buildStabilityHistory].reverse(); // Most recent first
        return limit ? history.slice(0, limit) : history;
    }
    /**
     * Clear alert history
     */
    clearAlertHistory() {
        this.alertHistory = [];
        this.saveAlertHistory();
        this.emit('alert_history_cleared');
    }
    /**
     * Update alert thresholds
     */
    updateAlertThresholds(newThresholds) {
        this.alertThresholds = { ...this.alertThresholds, ...newThresholds };
        this.emit('alert_thresholds_updated', this.alertThresholds);
    }
    /**
     * Get current alert thresholds
     */
    getAlertThresholds() {
        return { ...this.alertThresholds };
    }
    // Private methods
    async updateDashboard() {
        try {
            console.log('Updating dashboard data...');
            const [analysisReport, progressMetrics, buildStability] = await Promise.all([
                this.analysisTools.generateComprehensiveReport(),
                this.getProgressMetrics(),
                this.getCurrentBuildStability()
            ]);
            this.dashboardData = {
                lastUpdate: new Date(),
                analysisReport,
                progressMetrics,
                buildStability,
                alertSummary: {
                    totalAlerts: this.alertHistory.length,
                    criticalAlerts: this.alertHistory.filter(a => a.severity === 'critical').length,
                    highAlerts: this.alertHistory.filter(a => a.severity === 'high').length,
                    mediumAlerts: this.alertHistory.filter(a => a.severity === 'medium').length,
                    lowAlerts: this.alertHistory.filter(a => a.severity === 'low').length,
                    recentAlerts: this.getRecentAlerts(24) // Last 24 hours
                },
                trendingData: this.calculateTrendingData(),
                systemHealth: this.calculateSystemHealth()
            };
            this.emit('dashboard_updated', this.dashboardData);
        }
        catch (error) {
            console.error('Error updating dashboard:', error);
            throw error;
        }
    }
    async getCurrentBuildStability() {
        const startTime = Date.now();
        try {
            // Run TypeScript compilation check
            (0, child_process_1.execSync)('yarn tsc --noEmit --skipLibCheck', {
                stdio: 'pipe',
                timeout: 30000 // 30 second timeout
            });
            const buildTime = Date.now() - startTime;
            return {
                timestamp: new Date(),
                isStable: true,
                buildTime,
                errorCount: 0,
                errorMessage: null
            };
        }
        catch (error) {
            const buildTime = Date.now() - startTime;
            const errorOutput = error.stdout?.toString() || error.stderr?.toString() || error.message;
            const errorCount = this.countTypeScriptErrors(errorOutput);
            return {
                timestamp: new Date(),
                isStable: false,
                buildTime,
                errorCount,
                errorMessage: errorOutput.substring(0, 500) // Limit error message length
            };
        }
    }
    countTypeScriptErrors(output) {
        const errorMatches = output.match(/error TS\d+:/g);
        return errorMatches ? errorMatches.length : 0;
    }
    calculateReductionPercentage(report) {
        // Calculate reduction from baseline (would need historical baseline data)
        // For now, use a simple calculation based on intentional vs unintentional ratio
        const total = report.domainDistribution.totalAnyTypes;
        const unintentional = report.domainDistribution.intentionalVsUnintentional.unintentional.count;
        if (total === 0)
            return 0;
        // Assume baseline was 100% unintentional, calculate current reduction
        const currentUnintentionalPercentage = (unintentional / total) * 100;
        return Math.max(0, 100 - currentUnintentionalPercentage);
    }
    getBatchesCompleted() {
        // This would be tracked in actual implementation
        // For now, return a simulated value
        return Math.floor(Math.random() * 50) + 10;
    }
    emitAlert(alert) {
        // Check if this is a duplicate alert (same type within last hour)
        const oneHourAgo = new Date(Date.now() - 60 * 60 * 1000);
        const recentSimilarAlerts = this.alertHistory.filter(a => a.type === alert.type && a.timestamp > oneHourAgo);
        // Only emit if no similar alert in the last hour
        if (recentSimilarAlerts.length === 0) {
            this.alertHistory.push(alert);
            // Keep only last 1000 alerts
            if (this.alertHistory.length > 1000) {
                this.alertHistory = this.alertHistory.slice(-1000);
            }
            this.saveAlertHistory();
            this.emit('alert', alert);
            console.log(`Alert emitted: ${alert.type} (${alert.severity}) - ${alert.message}`);
        }
    }
    getLastProgressUpdate() {
        // This would track actual progress updates in real implementation
        // For now, return a simulated recent update
        return new Date(Date.now() - Math.random() * 2 * 60 * 60 * 1000); // Random time within last 2 hours
    }
    getRecentSafetyEvents() {
        // This would track actual safety events in real implementation
        // For now, return empty array
        return [];
    }
    getRecentAlerts(hours) {
        const cutoffTime = new Date(Date.now() - hours * 60 * 60 * 1000);
        return this.alertHistory.filter(alert => alert.timestamp > cutoffTime);
    }
    calculateTrendingData() {
        // This would calculate actual trending data from historical reports
        // For now, return simulated trending data
        const trends = [];
        const now = new Date();
        for (let i = 7; i >= 0; i--) {
            const date = new Date(now.getTime() - i * 24 * 60 * 60 * 1000);
            trends.push({
                date,
                successRate: 75 + Math.random() * 15,
                totalAnyTypes: 1800 - i * 20 + Math.random() * 10,
                unintentionalCount: 1200 - i * 15 + Math.random() * 8,
                classificationAccuracy: 80 + Math.random() * 15 // 80-95%
            });
        }
        return trends;
    }
    calculateSystemHealth() {
        const recentAlerts = this.getRecentAlerts(24);
        const criticalAlerts = recentAlerts.filter(a => a.severity === 'critical').length;
        const highAlerts = recentAlerts.filter(a => a.severity === 'high').length;
        let healthScore = 100;
        healthScore -= criticalAlerts * 20;
        healthScore -= highAlerts * 10;
        healthScore -= recentAlerts.length * 2;
        healthScore = Math.max(0, Math.min(100, healthScore));
        let status;
        if (healthScore >= 80)
            status = 'healthy';
        else if (healthScore >= 60)
            status = 'warning';
        else
            status = 'critical';
        return {
            score: healthScore,
            status,
            lastCheck: new Date(),
            issues: recentAlerts.filter(a => a.severity === 'critical' || a.severity === 'high').map(a => a.message)
        };
    }
    loadAlertHistory() {
        try {
            const historyPath = path.join(process.cwd(), '.kiro', 'campaign-reports', 'alert-history.json');
            if (fs.existsSync(historyPath)) {
                const historyData = fs.readFileSync(historyPath, 'utf8');
                this.alertHistory = JSON.parse(historyData).map((alert) => ({
                    ...alert,
                    timestamp: new Date(alert.timestamp)
                }));
            }
        }
        catch (error) {
            console.warn('Could not load alert history:', error);
            this.alertHistory = [];
        }
    }
    saveAlertHistory() {
        try {
            const historyDir = path.join(process.cwd(), '.kiro', 'campaign-reports');
            if (!fs.existsSync(historyDir)) {
                fs.mkdirSync(historyDir, { recursive: true });
            }
            const historyPath = path.join(historyDir, 'alert-history.json');
            fs.writeFileSync(historyPath, JSON.stringify(this.alertHistory, null, 2));
        }
        catch (error) {
            console.warn('Could not save alert history:', error);
        }
    }
    loadBuildStabilityHistory() {
        try {
            const historyPath = path.join(process.cwd(), '.kiro', 'campaign-reports', 'build-stability-history.json');
            if (fs.existsSync(historyPath)) {
                const historyData = fs.readFileSync(historyPath, 'utf8');
                this.buildStabilityHistory = JSON.parse(historyData).map((record) => ({
                    ...record,
                    timestamp: new Date(record.timestamp)
                }));
            }
        }
        catch (error) {
            console.warn('Could not load build stability history:', error);
            this.buildStabilityHistory = [];
        }
    }
    async saveBuildStabilityHistory() {
        try {
            const historyDir = path.join(process.cwd(), '.kiro', 'campaign-reports');
            if (!fs.existsSync(historyDir)) {
                fs.mkdirSync(historyDir, { recursive: true });
            }
            const historyPath = path.join(historyDir, 'build-stability-history.json');
            fs.writeFileSync(historyPath, JSON.stringify(this.buildStabilityHistory, null, 2));
        }
        catch (error) {
            console.warn('Could not save build stability history:', error);
        }
    }
}
exports.ProgressMonitoringSystem = ProgressMonitoringSystem;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9zZXJ2aWNlcy9jYW1wYWlnbi91bmludGVudGlvbmFsLWFueS1lbGltaW5hdGlvbi9Qcm9ncmVzc01vbml0b3JpbmdTeXN0ZW0udHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxpREFBeUM7QUFDekMsbUNBQXNDO0FBQ3RDLHVDQUF5QjtBQUN6QiwyQ0FBNkI7QUFDN0IsbURBQWdEO0FBT2hEOzs7R0FHRztBQUNILE1BQWEsd0JBQXlCLFNBQVEscUJBQVk7SUFDaEQsYUFBYSxDQUFnQjtJQUM3QixrQkFBa0IsR0FBMEIsSUFBSSxDQUFDO0lBQ2pELFlBQVksR0FBRyxLQUFLLENBQUM7SUFDckIsYUFBYSxHQUF5QixJQUFJLENBQUM7SUFDM0MsZUFBZSxDQUFrQjtJQUNqQyxZQUFZLEdBQVksRUFBRSxDQUFDO0lBQzNCLHFCQUFxQixHQUEyQixFQUFFLENBQUM7SUFFM0QsWUFBWSxlQUEwQztRQUNwRCxLQUFLLEVBQUUsQ0FBQztRQUNSLElBQUksQ0FBQyxhQUFhLEdBQUcsSUFBSSw2QkFBYSxFQUFFLENBQUM7UUFDekMsSUFBSSxDQUFDLGVBQWUsR0FBRztZQUNyQixvQkFBb0IsRUFBRSxFQUFFO1lBQ3hCLHFCQUFxQixFQUFFLENBQUM7WUFDeEIsK0JBQStCLEVBQUUsRUFBRTtZQUNuQyxvQkFBb0IsRUFBRSxDQUFDO1lBQ3ZCLHNCQUFzQixFQUFFLEVBQUU7WUFDMUIsR0FBRyxlQUFlO1NBQ25CLENBQUM7UUFFRixJQUFJLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztRQUN4QixJQUFJLENBQUMseUJBQXlCLEVBQUUsQ0FBQztJQUNuQyxDQUFDO0lBRUQ7O09BRUc7SUFDSCxlQUFlLENBQUMsa0JBQTBCLENBQUM7UUFDekMsSUFBSSxJQUFJLENBQUMsWUFBWSxFQUFFO1lBQ3JCLE9BQU8sQ0FBQyxHQUFHLENBQUMsd0NBQXdDLENBQUMsQ0FBQztZQUN0RCxPQUFPO1NBQ1I7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L0Rlc2t0b3AvV2hhdFRvRWF0TmV4dC9zcmMvc2VydmljZXMvY2FtcGFpZ24vdW5pbnRlbnRpb25hbC1hbnktZWxpbWluYXRpb24vUHJvZ3Jlc3NNb25pdG9yaW5nU3lzdGVtLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGV4ZWNTeW5jIH0gZnJvbSAnY2hpbGRfcHJvY2Vzcyc7XG5pbXBvcnQgeyBFdmVudEVtaXR0ZXIgfSBmcm9tICdldmVudHMnO1xuaW1wb3J0ICogYXMgZnMgZnJvbSAnZnMnO1xuaW1wb3J0ICogYXMgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCB7IEFuYWx5c2lzVG9vbHMgfSBmcm9tICcuL0FuYWx5c2lzVG9vbHMnO1xuaW1wb3J0IHtcbiAgICBBbmFseXNpc1JlcG9ydCxcbiAgICBUcmVuZGluZ0RhdGEsXG4gICAgVW5pbnRlbnRpb25hbEFueVByb2dyZXNzXG59IGZyb20gJy4vdHlwZXMnO1xuXG4vKipcbiAqIFJlYWwtdGltZSBwcm9ncmVzcyBtb25pdG9yaW5nIGFuZCBhbGVydGluZyBzeXN0ZW1cbiAqIFByb3ZpZGVzIGRhc2hib2FyZCBmdW5jdGlvbmFsaXR5LCBzYWZldHkgcHJvdG9jb2wgbW9uaXRvcmluZywgYW5kIHRocmVzaG9sZC1iYXNlZCBhbGVydHNcbiAqL1xuZXhwb3J0IGNsYXNzIFByb2dyZXNzTW9uaXRvcmluZ1N5c3RlbSBleHRlbmRzIEV2ZW50RW1pdHRlciB7XG4gIHByaXZhdGUgYW5hbHlzaXNUb29sczogQW5hbHlzaXNUb29scztcbiAgcHJpdmF0ZSBtb25pdG9yaW5nSW50ZXJ2YWw6IE5vZGVKUy5UaW1lb3V0IHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgaXNNb25pdG9yaW5nID0gZmFsc2U7XG4gIHByaXZhdGUgZGFzaGJvYXJkRGF0YTogRGFzaGJvYXJkRGF0YSB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIGFsZXJ0VGhyZXNob2xkczogQWxlcnRUaHJlc2hvbGRzO1xuICBwcml2YXRlIGFsZXJ0SGlzdG9yeTogQWxlcnRbXSA9IFtdO1xuICBwcml2YXRlIGJ1aWxkU3RhYmlsaXR5SGlzdG9yeTogQnVpbGRTdGFiaWxpdHlSZWNvcmRbXSA9IFtdO1xuXG4gIGNvbnN0cnVjdG9yKGFsZXJ0VGhyZXNob2xkcz86IFBhcnRpYWw8QWxlcnRUaHJlc2hvbGRzPikge1xuICAgIHN1cGVyKCk7XG4gICAgdGhpcy5hbmFseXNpc1Rvb2xzID0gbmV3IEFuYWx5c2lzVG9vbHMoKTtcbiAgICB0aGlzLmFsZXJ0VGhyZXNob2xkcyA9IHtcbiAgICAgIHN1Y2Nlc3NSYXRlVGhyZXNob2xkOiA3MCxcbiAgICAgIGJ1aWxkRmFpbHVyZVRocmVzaG9sZDogMyxcbiAgICAgIGNsYXNzaWZpY2F0aW9uQWNjdXJhY3lUaHJlc2hvbGQ6IDgwLFxuICAgICAgc2FmZXR5RXZlbnRUaHJlc2hvbGQ6IDUsXG4gICAgICBwcm9ncmVzc1N0YWxsVGhyZXNob2xkOiAyNCwgLy8gaG91cnNcbiAgICAgIC4uLmFsZXJ0VGhyZXNob2xkc1xuICAgIH07XG5cbiAgICB0aGlzLmxvYWRBbGVydEhpc3RvcnkoKTtcbiAgICB0aGlzLmxvYWRCdWlsZFN0YWJpbGl0eUhpc3RvcnkoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTdGFydCByZWFsLXRpbWUgcHJvZ3Jlc3MgbW9uaXRvcmluZ1xuICAgKi9cbiAgc3RhcnRNb25pdG9yaW5nKGludGVydmFsTWludXRlczogbnVtYmVyID0gNSk6IHZvaWQge1xuICAgIGlmICh0aGlzLmlzTW9uaXRvcmluZykge1xuICAgICAgY29uc29sZS5sb2coJ1Byb2dyZXNzIG1vbml0b3JpbmcgaXMgYWxyZWFkeSBydW5uaW5nJyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc29sZS5sb2coYFN0YXJ0aW5nIHByb2dyZXNzIG1vbml0b3Jpbmcgd2l0aCAke2ludGVydmFsTWludXRlc30tbWludXRlIGludGVydmFsc2ApO1xuICAgIHRoaXMuaXNNb25pdG9yaW5nID0gdHJ1ZTtcblxuICAgIC8vIEluaXRpYWwgdXBkYXRlXG4gICAgdGhpcy51cGRhdGVEYXNoYm9hcmQoKTtcblxuICAgIC8vIFNldCB1cCBwZXJpb2RpYyB1cGRhdGVzXG4gICAgdGhpcy5tb25pdG9yaW5nSW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChhc3luYyAoKSA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCB0aGlzLnVwZGF0ZURhc2hib2FyZCgpO1xuICAgICAgICBhd2FpdCB0aGlzLmNoZWNrQWxlcnRDb25kaXRpb25zKCk7XG4gICAgICAgIGF3YWl0IHRoaXMubW9uaXRvckJ1aWxkU3RhYmlsaXR5KCk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBkdXJpbmcgbW9uaXRvcmluZyB1cGRhdGU6JywgZXJyb3IpO1xuICAgICAgICB0aGlzLmVtaXRBbGVydCh7XG4gICAgICAgICAgdHlwZTogJ3N5c3RlbV9lcnJvcicsXG4gICAgICAgICAgc2V2ZXJpdHk6ICdoaWdoJyxcbiAgICAgICAgICBtZXNzYWdlOiBgTW9uaXRvcmluZyBzeXN0ZW0gZXJyb3I6ICR7ZXJyb3IubWVzc2FnZX1gLFxuICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgICAgICBkYXRhOiB7IGVycm9yOiBlcnJvci5tZXNzYWdlIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSwgaW50ZXJ2YWxNaW51dGVzICogNjAgKiAxMDAwKTtcblxuICAgIHRoaXMuZW1pdCgnbW9uaXRvcmluZ19zdGFydGVkJywgeyBpbnRlcnZhbE1pbnV0ZXMgfSk7XG4gIH1cblxuICAvKipcbiAgICogU3RvcCByZWFsLXRpbWUgcHJvZ3Jlc3MgbW9uaXRvcmluZ1xuICAgKi9cbiAgc3RvcE1vbml0b3JpbmcoKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLmlzTW9uaXRvcmluZykge1xuICAgICAgY29uc29sZS5sb2coJ1Byb2dyZXNzIG1vbml0b3JpbmcgaXMgbm90IHJ1bm5pbmcnKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zb2xlLmxvZygnU3RvcHBpbmcgcHJvZ3Jlc3MgbW9uaXRvcmluZycpO1xuICAgIHRoaXMuaXNNb25pdG9yaW5nID0gZmFsc2U7XG5cbiAgICBpZiAodGhpcy5tb25pdG9yaW5nSW50ZXJ2YWwpIHtcbiAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5tb25pdG9yaW5nSW50ZXJ2YWwpO1xuICAgICAgdGhpcy5tb25pdG9yaW5nSW50ZXJ2YWwgPSBudWxsO1xuICAgIH1cblxuICAgIHRoaXMuZW1pdCgnbW9uaXRvcmluZ19zdG9wcGVkJyk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGN1cnJlbnQgZGFzaGJvYXJkIGRhdGFcbiAgICovXG4gIGdldERhc2hib2FyZERhdGEoKTogRGFzaGJvYXJkRGF0YSB8IG51bGwge1xuICAgIHJldHVybiB0aGlzLmRhc2hib2FyZERhdGE7XG4gIH1cblxuICAvKipcbiAgICogR2V0IHJlYWwtdGltZSBwcm9ncmVzcyBtZXRyaWNzXG4gICAqL1xuICBhc3luYyBnZXRQcm9ncmVzc01ldHJpY3MoKTogUHJvbWlzZTxVbmludGVudGlvbmFsQW55UHJvZ3Jlc3M+IHtcbiAgICBjb25zb2xlLmxvZygnQ29sbGVjdGluZyByZWFsLXRpbWUgcHJvZ3Jlc3MgbWV0cmljcy4uLicpO1xuXG4gICAgY29uc3QgY3VycmVudFJlcG9ydCA9IGF3YWl0IHRoaXMuYW5hbHlzaXNUb29scy5nZW5lcmF0ZUNvbXByZWhlbnNpdmVSZXBvcnQoKTtcbiAgICBjb25zdCBidWlsZFN0YWJpbGl0eSA9IGF3YWl0IHRoaXMuZ2V0Q3VycmVudEJ1aWxkU3RhYmlsaXR5KCk7XG5cbiAgICBjb25zdCBwcm9ncmVzczogVW5pbnRlbnRpb25hbEFueVByb2dyZXNzID0ge1xuICAgICAgdG90YWxBbnlUeXBlczogY3VycmVudFJlcG9ydC5kb21haW5EaXN0cmlidXRpb24udG90YWxBbnlUeXBlcyxcbiAgICAgIGNsYXNzaWZpZWRJbnRlbnRpb25hbDogY3VycmVudFJlcG9ydC5kb21haW5EaXN0cmlidXRpb24uaW50ZW50aW9uYWxWc1VuaW50ZW50aW9uYWwuaW50ZW50aW9uYWwuY291bnQsXG4gICAgICBjbGFzc2lmaWVkVW5pbnRlbnRpb25hbDogY3VycmVudFJlcG9ydC5kb21haW5EaXN0cmlidXRpb24uaW50ZW50aW9uYWxWc1VuaW50ZW50aW9uYWwudW5pbnRlbnRpb25hbC5jb3VudCxcbiAgICAgIHN1Y2Nlc3NmdWxSZXBsYWNlbWVudHM6IE1hdGguZmxvb3IoY3VycmVudFJlcG9ydC5zdW1tYXJ5LmN1cnJlbnRTdWNjZXNzUmF0ZSAqIGN1cnJlbnRSZXBvcnQuc3VtbWFyeS50b3RhbEFueVR5cGVzIC8gMTAwKSxcbiAgICAgIGRvY3VtZW50ZWRJbnRlbnRpb25hbDogY3VycmVudFJlcG9ydC5kb21haW5EaXN0cmlidXRpb24uaW50ZW50aW9uYWxWc1VuaW50ZW50aW9uYWwuaW50ZW50aW9uYWwuY291bnQsXG4gICAgICByZW1haW5pbmdVbmludGVudGlvbmFsOiBjdXJyZW50UmVwb3J0LmRvbWFpbkRpc3RyaWJ1dGlvbi5pbnRlbnRpb25hbFZzVW5pbnRlbnRpb25hbC51bmludGVudGlvbmFsLmNvdW50LFxuICAgICAgcmVkdWN0aW9uUGVyY2VudGFnZTogdGhpcy5jYWxjdWxhdGVSZWR1Y3Rpb25QZXJjZW50YWdlKGN1cnJlbnRSZXBvcnQpLFxuICAgICAgdGFyZ2V0UmVkdWN0aW9uUGVyY2VudGFnZTogMjAsIC8vIFRhcmdldCAyMCUgcmVkdWN0aW9uXG4gICAgICBiYXRjaGVzQ29tcGxldGVkOiB0aGlzLmdldEJhdGNoZXNDb21wbGV0ZWQoKSxcbiAgICAgIGF2ZXJhZ2VTdWNjZXNzUmF0ZTogY3VycmVudFJlcG9ydC5zdW1tYXJ5LmN1cnJlbnRTdWNjZXNzUmF0ZSxcblxuICAgICAgLy8gQmFzZSBQcm9ncmVzc01ldHJpY3MgcHJvcGVydGllc1xuICAgICAgZXJyb3JzRml4ZWQ6IDAsXG4gICAgICB3YXJuaW5nc0ZpeGVkOiAwLFxuICAgICAgZmlsZXNQcm9jZXNzZWQ6IDAsXG4gICAgICBidWlsZFN0YWJsZTogYnVpbGRTdGFiaWxpdHkuaXNTdGFibGUsXG4gICAgICBsYXN0VXBkYXRlOiBuZXcgRGF0ZSgpXG4gICAgfTtcblxuICAgIHJldHVybiBwcm9ncmVzcztcbiAgfVxuXG4gIC8qKlxuICAgKiBNb25pdG9yIGJ1aWxkIHN0YWJpbGl0eVxuICAgKi9cbiAgYXN5bmMgbW9uaXRvckJ1aWxkU3RhYmlsaXR5KCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IHN0YWJpbGl0eSA9IGF3YWl0IHRoaXMuZ2V0Q3VycmVudEJ1aWxkU3RhYmlsaXR5KCk7XG5cbiAgICAvLyBBZGQgdG8gaGlzdG9yeVxuICAgIHRoaXMuYnVpbGRTdGFiaWxpdHlIaXN0b3J5LnB1c2goc3RhYmlsaXR5KTtcblxuICAgIC8vIEtlZXAgb25seSBsYXN0IDEwMCByZWNvcmRzXG4gICAgaWYgKHRoaXMuYnVpbGRTdGFiaWxpdHlIaXN0b3J5Lmxlbmd0aCA+IDEwMCkge1xuICAgICAgdGhpcy5idWlsZFN0YWJpbGl0eUhpc3RvcnkgPSB0aGlzLmJ1aWxkU3RhYmlsaXR5SGlzdG9yeS5zbGljZSgtMTAwKTtcbiAgICB9XG5cbiAgICAvLyBDaGVjayBmb3IgYnVpbGQgc3RhYmlsaXR5IGlzc3Vlc1xuICAgIGlmICghc3RhYmlsaXR5LmlzU3RhYmxlKSB7XG4gICAgICB0aGlzLmVtaXRBbGVydCh7XG4gICAgICAgIHR5cGU6ICdidWlsZF9mYWlsdXJlJyxcbiAgICAgICAgc2V2ZXJpdHk6ICdoaWdoJyxcbiAgICAgICAgbWVzc2FnZTogYEJ1aWxkIGZhaWx1cmUgZGV0ZWN0ZWQ6ICR7c3RhYmlsaXR5LmVycm9yTWVzc2FnZX1gLFxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICBidWlsZFRpbWU6IHN0YWJpbGl0eS5idWlsZFRpbWUsXG4gICAgICAgICAgZXJyb3JDb3VudDogc3RhYmlsaXR5LmVycm9yQ291bnQsXG4gICAgICAgICAgZXJyb3JNZXNzYWdlOiBzdGFiaWxpdHkuZXJyb3JNZXNzYWdlXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIENoZWNrIGZvciBjb25zZWN1dGl2ZSBidWlsZCBmYWlsdXJlc1xuICAgIGNvbnN0IHJlY2VudEZhaWx1cmVzID0gdGhpcy5idWlsZFN0YWJpbGl0eUhpc3RvcnlcbiAgICAgIC5zbGljZSgtdGhpcy5hbGVydFRocmVzaG9sZHMuYnVpbGRGYWlsdXJlVGhyZXNob2xkKVxuICAgICAgLmZpbHRlcihyZWNvcmQgPT4gIXJlY29yZC5pc1N0YWJsZSk7XG5cbiAgICBpZiAocmVjZW50RmFpbHVyZXMubGVuZ3RoID49IHRoaXMuYWxlcnRUaHJlc2hvbGRzLmJ1aWxkRmFpbHVyZVRocmVzaG9sZCkge1xuICAgICAgdGhpcy5lbWl0QWxlcnQoe1xuICAgICAgICB0eXBlOiAnY29uc2VjdXRpdmVfYnVpbGRfZmFpbHVyZXMnLFxuICAgICAgICBzZXZlcml0eTogJ2NyaXRpY2FsJyxcbiAgICAgICAgbWVzc2FnZTogYCR7cmVjZW50RmFpbHVyZXMubGVuZ3RofSBjb25zZWN1dGl2ZSBidWlsZCBmYWlsdXJlcyBkZXRlY3RlZGAsXG4gICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGZhaWx1cmVDb3VudDogcmVjZW50RmFpbHVyZXMubGVuZ3RoLFxuICAgICAgICAgIHRocmVzaG9sZDogdGhpcy5hbGVydFRocmVzaG9sZHMuYnVpbGRGYWlsdXJlVGhyZXNob2xkXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIGF3YWl0IHRoaXMuc2F2ZUJ1aWxkU3RhYmlsaXR5SGlzdG9yeSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrIGFsZXJ0IGNvbmRpdGlvbnMgYW5kIGVtaXQgYWxlcnRzXG4gICAqL1xuICBhc3luYyBjaGVja0FsZXJ0Q29uZGl0aW9ucygpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBwcm9ncmVzcyA9IGF3YWl0IHRoaXMuZ2V0UHJvZ3Jlc3NNZXRyaWNzKCk7XG4gICAgY29uc3QgY3VycmVudFRpbWUgPSBuZXcgRGF0ZSgpO1xuXG4gICAgLy8gQ2hlY2sgc3VjY2VzcyByYXRlIHRocmVzaG9sZFxuICAgIGlmIChwcm9ncmVzcy5hdmVyYWdlU3VjY2Vzc1JhdGUgPCB0aGlzLmFsZXJ0VGhyZXNob2xkcy5zdWNjZXNzUmF0ZVRocmVzaG9sZCkge1xuICAgICAgdGhpcy5lbWl0QWxlcnQoe1xuICAgICAgICB0eXBlOiAnbG93X3N1Y2Nlc3NfcmF0ZScsXG4gICAgICAgIHNldmVyaXR5OiAnbWVkaXVtJyxcbiAgICAgICAgbWVzc2FnZTogYFN1Y2Nlc3MgcmF0ZSAoJHtwcm9ncmVzcy5hdmVyYWdlU3VjY2Vzc1JhdGUudG9GaXhlZCgxKX0lKSBiZWxvdyB0aHJlc2hvbGQgKCR7dGhpcy5hbGVydFRocmVzaG9sZHMuc3VjY2Vzc1JhdGVUaHJlc2hvbGR9JSlgLFxuICAgICAgICB0aW1lc3RhbXA6IGN1cnJlbnRUaW1lLFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgY3VycmVudFJhdGU6IHByb2dyZXNzLmF2ZXJhZ2VTdWNjZXNzUmF0ZSxcbiAgICAgICAgICB0aHJlc2hvbGQ6IHRoaXMuYWxlcnRUaHJlc2hvbGRzLnN1Y2Nlc3NSYXRlVGhyZXNob2xkXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIENoZWNrIGNsYXNzaWZpY2F0aW9uIGFjY3VyYWN5XG4gICAgaWYgKHRoaXMuZGFzaGJvYXJkRGF0YT8uYWNjdXJhY3lSZXBvcnQub3ZlcmFsbEFjY3VyYWN5IDwgdGhpcy5hbGVydFRocmVzaG9sZHMuY2xhc3NpZmljYXRpb25BY2N1cmFjeVRocmVzaG9sZCkge1xuICAgICAgdGhpcy5lbWl0QWxlcnQoe1xuICAgICAgICB0eXBlOiAnbG93X2NsYXNzaWZpY2F0aW9uX2FjY3VyYWN5JyxcbiAgICAgICAgc2V2ZXJpdHk6ICdtZWRpdW0nLFxuICAgICAgICBtZXNzYWdlOiBgQ2xhc3NpZmljYXRpb24gYWNjdXJhY3kgKCR7dGhpcy5kYXNoYm9hcmREYXRhLmFjY3VyYWN5UmVwb3J0Lm92ZXJhbGxBY2N1cmFjeS50b0ZpeGVkKDEpfSUpIGJlbG93IHRocmVzaG9sZCAoJHt0aGlzLmFsZXJ0VGhyZXNob2xkcy5jbGFzc2lmaWNhdGlvbkFjY3VyYWN5VGhyZXNob2xkfSUpYCxcbiAgICAgICAgdGltZXN0YW1wOiBjdXJyZW50VGltZSxcbiAgICAgICAgZGF0YToge1xuICAgICAgICAgIGN1cnJlbnRBY2N1cmFjeTogdGhpcy5kYXNoYm9hcmREYXRhLmFjY3VyYWN5UmVwb3J0Lm92ZXJhbGxBY2N1cmFjeSxcbiAgICAgICAgICB0aHJlc2hvbGQ6IHRoaXMuYWxlcnRUaHJlc2hvbGRzLmNsYXNzaWZpY2F0aW9uQWNjdXJhY3lUaHJlc2hvbGRcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgZm9yIHByb2dyZXNzIHN0YWxsXG4gICAgY29uc3QgbGFzdFByb2dyZXNzVXBkYXRlID0gdGhpcy5nZXRMYXN0UHJvZ3Jlc3NVcGRhdGUoKTtcbiAgICBpZiAobGFzdFByb2dyZXNzVXBkYXRlKSB7XG4gICAgICBjb25zdCBob3Vyc1NpbmNlVXBkYXRlID0gKGN1cnJlbnRUaW1lLmdldFRpbWUoKSAtIGxhc3RQcm9ncmVzc1VwZGF0ZS5nZXRUaW1lKCkpIC8gKDEwMDAgKiA2MCAqIDYwKTtcbiAgICAgIGlmIChob3Vyc1NpbmNlVXBkYXRlID4gdGhpcy5hbGVydFRocmVzaG9sZHMucHJvZ3Jlc3NTdGFsbFRocmVzaG9sZCkge1xuICAgICAgICB0aGlzLmVtaXRBbGVydCh7XG4gICAgICAgICAgdHlwZTogJ3Byb2dyZXNzX3N0YWxsJyxcbiAgICAgICAgICBzZXZlcml0eTogJ21lZGl1bScsXG4gICAgICAgICAgbWVzc2FnZTogYE5vIHByb2dyZXNzIGRldGVjdGVkIGZvciAke2hvdXJzU2luY2VVcGRhdGUudG9GaXhlZCgxKX0gaG91cnNgLFxuICAgICAgICAgIHRpbWVzdGFtcDogY3VycmVudFRpbWUsXG4gICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgaG91cnNTaW5jZVVwZGF0ZSxcbiAgICAgICAgICAgIHRocmVzaG9sZDogdGhpcy5hbGVydFRocmVzaG9sZHMucHJvZ3Jlc3NTdGFsbFRocmVzaG9sZCxcbiAgICAgICAgICAgIGxhc3RVcGRhdGU6IGxhc3RQcm9ncmVzc1VwZGF0ZVxuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgc2FmZXR5IGV2ZW50IGZyZXF1ZW5jeVxuICAgIGNvbnN0IHJlY2VudFNhZmV0eUV2ZW50cyA9IHRoaXMuZ2V0UmVjZW50U2FmZXR5RXZlbnRzKCk7XG4gICAgaWYgKHJlY2VudFNhZmV0eUV2ZW50cy5sZW5ndGggPj0gdGhpcy5hbGVydFRocmVzaG9sZHMuc2FmZXR5RXZlbnRUaHJlc2hvbGQpIHtcbiAgICAgIHRoaXMuZW1pdEFsZXJ0KHtcbiAgICAgICAgdHlwZTogJ2ZyZXF1ZW50X3NhZmV0eV9ldmVudHMnLFxuICAgICAgICBzZXZlcml0eTogJ2hpZ2gnLFxuICAgICAgICBtZXNzYWdlOiBgJHtyZWNlbnRTYWZldHlFdmVudHMubGVuZ3RofSBzYWZldHkgZXZlbnRzIGluIHRoZSBsYXN0IGhvdXJgLFxuICAgICAgICB0aW1lc3RhbXA6IGN1cnJlbnRUaW1lLFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgZXZlbnRDb3VudDogcmVjZW50U2FmZXR5RXZlbnRzLmxlbmd0aCxcbiAgICAgICAgICB0aHJlc2hvbGQ6IHRoaXMuYWxlcnRUaHJlc2hvbGRzLnNhZmV0eUV2ZW50VGhyZXNob2xkLFxuICAgICAgICAgIGV2ZW50czogcmVjZW50U2FmZXR5RXZlbnRzXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBIYW5kbGUgc2FmZXR5IHByb3RvY29sIGFjdGl2YXRpb25cbiAgICovXG4gIGhhbmRsZVNhZmV0eVByb3RvY29sQWN0aXZhdGlvbihldmVudDogU2FmZXR5RXZlbnQpOiB2b2lkIHtcbiAgICBjb25zb2xlLmxvZyhgU2FmZXR5IHByb3RvY29sIGFjdGl2YXRlZDogJHtldmVudC50eXBlfWApO1xuXG4gICAgdGhpcy5lbWl0QWxlcnQoe1xuICAgICAgdHlwZTogJ3NhZmV0eV9wcm90b2NvbF9hY3RpdmF0aW9uJyxcbiAgICAgIHNldmVyaXR5OiBldmVudC5zZXZlcml0eSA9PT0gJ2NyaXRpY2FsJyA/ICdjcml0aWNhbCcgOiAnaGlnaCcsXG4gICAgICBtZXNzYWdlOiBgU2FmZXR5IHByb3RvY29sIGFjdGl2YXRlZDogJHtldmVudC5kZXNjcmlwdGlvbn1gLFxuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuICAgICAgZGF0YToge1xuICAgICAgICBzYWZldHlFdmVudDogZXZlbnQsXG4gICAgICAgIGFjdGlvbjogZXZlbnQuYWN0aW9uLFxuICAgICAgICBhZmZlY3RlZEZpbGVzOiBldmVudC5hZmZlY3RlZEZpbGVzIHx8IFtdXG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBJZiBpdCdzIGEgY3JpdGljYWwgc2FmZXR5IGV2ZW50LCBjb25zaWRlciBzdG9wcGluZyBtb25pdG9yaW5nIHRlbXBvcmFyaWx5XG4gICAgaWYgKGV2ZW50LnNldmVyaXR5ID09PSAnY3JpdGljYWwnKSB7XG4gICAgICB0aGlzLmVtaXQoJ2NyaXRpY2FsX3NhZmV0eV9ldmVudCcsIGV2ZW50KTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2V0IGFsZXJ0IGhpc3RvcnlcbiAgICovXG4gIGdldEFsZXJ0SGlzdG9yeShsaW1pdD86IG51bWJlcik6IEFsZXJ0W10ge1xuICAgIGNvbnN0IGFsZXJ0cyA9IFsuLi50aGlzLmFsZXJ0SGlzdG9yeV0ucmV2ZXJzZSgpOyAvLyBNb3N0IHJlY2VudCBmaXJzdFxuICAgIHJldHVybiBsaW1pdCA/IGFsZXJ0cy5zbGljZSgwLCBsaW1pdCkgOiBhbGVydHM7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGJ1aWxkIHN0YWJpbGl0eSBoaXN0b3J5XG4gICAqL1xuICBnZXRCdWlsZFN0YWJpbGl0eUhpc3RvcnkobGltaXQ/OiBudW1iZXIpOiBCdWlsZFN0YWJpbGl0eVJlY29yZFtdIHtcbiAgICBjb25zdCBoaXN0b3J5ID0gWy4uLnRoaXMuYnVpbGRTdGFiaWxpdHlIaXN0b3J5XS5yZXZlcnNlKCk7IC8vIE1vc3QgcmVjZW50IGZpcnN0XG4gICAgcmV0dXJuIGxpbWl0ID8gaGlzdG9yeS5zbGljZSgwLCBsaW1pdCkgOiBoaXN0b3J5O1xuICB9XG5cbiAgLyoqXG4gICAqIENsZWFyIGFsZXJ0IGhpc3RvcnlcbiAgICovXG4gIGNsZWFyQWxlcnRIaXN0b3J5KCk6IHZvaWQge1xuICAgIHRoaXMuYWxlcnRIaXN0b3J5ID0gW107XG4gICAgdGhpcy5zYXZlQWxlcnRIaXN0b3J5KCk7XG4gICAgdGhpcy5lbWl0KCdhbGVydF9oaXN0b3J5X2NsZWFyZWQnKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVcGRhdGUgYWxlcnQgdGhyZXNob2xkc1xuICAgKi9cbiAgdXBkYXRlQWxlcnRUaHJlc2hvbGRzKG5ld1RocmVzaG9sZHM6IFBhcnRpYWw8QWxlcnRUaHJlc2hvbGRzPik6IHZvaWQge1xuICAgIHRoaXMuYWxlcnRUaHJlc2hvbGRzID0geyAuLi50aGlzLmFsZXJ0VGhyZXNob2xkcywgLi4ubmV3VGhyZXNob2xkcyB9O1xuICAgIHRoaXMuZW1pdCgnYWxlcnRfdGhyZXNob2xkc191cGRhdGVkJywgdGhpcy5hbGVydFRocmVzaG9sZHMpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBjdXJyZW50IGFsZXJ0IHRocmVzaG9sZHNcbiAgICovXG4gIGdldEFsZXJ0VGhyZXNob2xkcygpOiBBbGVydFRocmVzaG9sZHMge1xuICAgIHJldHVybiB7IC4uLnRoaXMuYWxlcnRUaHJlc2hvbGRzIH07XG4gIH1cblxuICAvLyBQcml2YXRlIG1ldGhvZHNcblxuICBwcml2YXRlIGFzeW5jIHVwZGF0ZURhc2hib2FyZCgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgY29uc29sZS5sb2coJ1VwZGF0aW5nIGRhc2hib2FyZCBkYXRhLi4uJyk7XG5cbiAgICAgIGNvbnN0IFtcbiAgICAgICAgYW5hbHlzaXNSZXBvcnQsXG4gICAgICAgIHByb2dyZXNzTWV0cmljcyxcbiAgICAgICAgYnVpbGRTdGFiaWxpdHlcbiAgICAgIF0gPSBhd2FpdCBQcm9taXNlLmFsbChbXG4gICAgICAgIHRoaXMuYW5hbHlzaXNUb29scy5nZW5lcmF0ZUNvbXByZWhlbnNpdmVSZXBvcnQoKSxcbiAgICAgICAgdGhpcy5nZXRQcm9ncmVzc01ldHJpY3MoKSxcbiAgICAgICAgdGhpcy5nZXRDdXJyZW50QnVpbGRTdGFiaWxpdHkoKVxuICAgICAgXSk7XG5cbiAgICAgIHRoaXMuZGFzaGJvYXJkRGF0YSA9IHtcbiAgICAgICAgbGFzdFVwZGF0ZTogbmV3IERhdGUoKSxcbiAgICAgICAgYW5hbHlzaXNSZXBvcnQsXG4gICAgICAgIHByb2dyZXNzTWV0cmljcyxcbiAgICAgICAgYnVpbGRTdGFiaWxpdHksXG4gICAgICAgIGFsZXJ0U3VtbWFyeToge1xuICAgICAgICAgIHRvdGFsQWxlcnRzOiB0aGlzLmFsZXJ0SGlzdG9yeS5sZW5ndGgsXG4gICAgICAgICAgY3JpdGljYWxBbGVydHM6IHRoaXMuYWxlcnRIaXN0b3J5LmZpbHRlcihhID0+IGEuc2V2ZXJpdHkgPT09ICdjcml0aWNhbCcpLmxlbmd0aCxcbiAgICAgICAgICBoaWdoQWxlcnRzOiB0aGlzLmFsZXJ0SGlzdG9yeS5maWx0ZXIoYSA9PiBhLnNldmVyaXR5ID09PSAnaGlnaCcpLmxlbmd0aCxcbiAgICAgICAgICBtZWRpdW1BbGVydHM6IHRoaXMuYWxlcnRIaXN0b3J5LmZpbHRlcihhID0+IGEuc2V2ZXJpdHkgPT09ICdtZWRpdW0nKS5sZW5ndGgsXG4gICAgICAgICAgbG93QWxlcnRzOiB0aGlzLmFsZXJ0SGlzdG9yeS5maWx0ZXIoYSA9PiBhLnNldmVyaXR5ID09PSAnbG93JykubGVuZ3RoLFxuICAgICAgICAgIHJlY2VudEFsZXJ0czogdGhpcy5nZXRSZWNlbnRBbGVydHMoMjQpIC8vIExhc3QgMjQgaG91cnNcbiAgICAgICAgfSxcbiAgICAgICAgdHJlbmRpbmdEYXRhOiB0aGlzLmNhbGN1bGF0ZVRyZW5kaW5nRGF0YSgpLFxuICAgICAgICBzeXN0ZW1IZWFsdGg6IHRoaXMuY2FsY3VsYXRlU3lzdGVtSGVhbHRoKClcbiAgICAgIH07XG5cbiAgICAgIHRoaXMuZW1pdCgnZGFzaGJvYXJkX3VwZGF0ZWQnLCB0aGlzLmRhc2hib2FyZERhdGEpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciB1cGRhdGluZyBkYXNoYm9hcmQ6JywgZXJyb3IpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBnZXRDdXJyZW50QnVpbGRTdGFiaWxpdHkoKTogUHJvbWlzZTxCdWlsZFN0YWJpbGl0eVJlY29yZD4ge1xuICAgIGNvbnN0IHN0YXJ0VGltZSA9IERhdGUubm93KCk7XG5cbiAgICB0cnkge1xuICAgICAgLy8gUnVuIFR5cGVTY3JpcHQgY29tcGlsYXRpb24gY2hlY2tcbiAgICAgIGV4ZWNTeW5jKCd5YXJuIHRzYyAtLW5vRW1pdCAtLXNraXBMaWJDaGVjaycsIHtcbiAgICAgICAgc3RkaW86ICdwaXBlJyxcbiAgICAgICAgdGltZW91dDogMzAwMDAgLy8gMzAgc2Vjb25kIHRpbWVvdXRcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBidWlsZFRpbWUgPSBEYXRlLm5vdygpIC0gc3RhcnRUaW1lO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAgICAgIGlzU3RhYmxlOiB0cnVlLFxuICAgICAgICBidWlsZFRpbWUsXG4gICAgICAgIGVycm9yQ291bnQ6IDAsXG4gICAgICAgIGVycm9yTWVzc2FnZTogbnVsbFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc3QgYnVpbGRUaW1lID0gRGF0ZS5ub3coKSAtIHN0YXJ0VGltZTtcbiAgICAgIGNvbnN0IGVycm9yT3V0cHV0ID0gZXJyb3Iuc3Rkb3V0Py50b1N0cmluZygpIHx8IGVycm9yLnN0ZGVycj8udG9TdHJpbmcoKSB8fCBlcnJvci5tZXNzYWdlO1xuICAgICAgY29uc3QgZXJyb3JDb3VudCA9IHRoaXMuY291bnRUeXBlU2NyaXB0RXJyb3JzKGVycm9yT3V0cHV0KTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuICAgICAgICBpc1N0YWJsZTogZmFsc2UsXG4gICAgICAgIGJ1aWxkVGltZSxcbiAgICAgICAgZXJyb3JDb3VudCxcbiAgICAgICAgZXJyb3JNZXNzYWdlOiBlcnJvck91dHB1dC5zdWJzdHJpbmcoMCwgNTAwKSAvLyBMaW1pdCBlcnJvciBtZXNzYWdlIGxlbmd0aFxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNvdW50VHlwZVNjcmlwdEVycm9ycyhvdXRwdXQ6IHN0cmluZyk6IG51bWJlciB7XG4gICAgY29uc3QgZXJyb3JNYXRjaGVzID0gb3V0cHV0Lm1hdGNoKC9lcnJvciBUU1xcZCs6L2cpO1xuICAgIHJldHVybiBlcnJvck1hdGNoZXMgPyBlcnJvck1hdGNoZXMubGVuZ3RoIDogMDtcbiAgfVxuXG4gIHByaXZhdGUgY2FsY3VsYXRlUmVkdWN0aW9uUGVyY2VudGFnZShyZXBvcnQ6IEFuYWx5c2lzUmVwb3J0KTogbnVtYmVyIHtcbiAgICAvLyBDYWxjdWxhdGUgcmVkdWN0aW9uIGZyb20gYmFzZWxpbmUgKHdvdWxkIG5lZWQgaGlzdG9yaWNhbCBiYXNlbGluZSBkYXRhKVxuICAgIC8vIEZvciBub3csIHVzZSBhIHNpbXBsZSBjYWxjdWxhdGlvbiBiYXNlZCBvbiBpbnRlbnRpb25hbCB2cyB1bmludGVudGlvbmFsIHJhdGlvXG4gICAgY29uc3QgdG90YWwgPSByZXBvcnQuZG9tYWluRGlzdHJpYnV0aW9uLnRvdGFsQW55VHlwZXM7XG4gICAgY29uc3QgdW5pbnRlbnRpb25hbCA9IHJlcG9ydC5kb21haW5EaXN0cmlidXRpb24uaW50ZW50aW9uYWxWc1VuaW50ZW50aW9uYWwudW5pbnRlbnRpb25hbC5jb3VudDtcblxuICAgIGlmICh0b3RhbCA9PT0gMCkgcmV0dXJuIDA7XG5cbiAgICAvLyBBc3N1bWUgYmFzZWxpbmUgd2FzIDEwMCUgdW5pbnRlbnRpb25hbCwgY2FsY3VsYXRlIGN1cnJlbnQgcmVkdWN0aW9uXG4gICAgY29uc3QgY3VycmVudFVuaW50ZW50aW9uYWxQZXJjZW50YWdlID0gKHVuaW50ZW50aW9uYWwgLyB0b3RhbCkgKiAxMDA7XG4gICAgcmV0dXJuIE1hdGgubWF4KDAsIDEwMCAtIGN1cnJlbnRVbmludGVudGlvbmFsUGVyY2VudGFnZSk7XG4gIH1cblxuICBwcml2YXRlIGdldEJhdGNoZXNDb21wbGV0ZWQoKTogbnVtYmVyIHtcbiAgICAvLyBUaGlzIHdvdWxkIGJlIHRyYWNrZWQgaW4gYWN0dWFsIGltcGxlbWVudGF0aW9uXG4gICAgLy8gRm9yIG5vdywgcmV0dXJuIGEgc2ltdWxhdGVkIHZhbHVlXG4gICAgcmV0dXJuIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDUwKSArIDEwO1xuICB9XG5cbiAgcHJpdmF0ZSBlbWl0QWxlcnQoYWxlcnQ6IEFsZXJ0KTogdm9pZCB7XG4gICAgLy8gQ2hlY2sgaWYgdGhpcyBpcyBhIGR1cGxpY2F0ZSBhbGVydCAoc2FtZSB0eXBlIHdpdGhpbiBsYXN0IGhvdXIpXG4gICAgY29uc3Qgb25lSG91ckFnbyA9IG5ldyBEYXRlKERhdGUubm93KCkgLSA2MCAqIDYwICogMTAwMCk7XG4gICAgY29uc3QgcmVjZW50U2ltaWxhckFsZXJ0cyA9IHRoaXMuYWxlcnRIaXN0b3J5LmZpbHRlcihcbiAgICAgIGEgPT4gYS50eXBlID09PSBhbGVydC50eXBlICYmIGEudGltZXN0YW1wID4gb25lSG91ckFnb1xuICAgICk7XG5cbiAgICAvLyBPbmx5IGVtaXQgaWYgbm8gc2ltaWxhciBhbGVydCBpbiB0aGUgbGFzdCBob3VyXG4gICAgaWYgKHJlY2VudFNpbWlsYXJBbGVydHMubGVuZ3RoID09PSAwKSB7XG4gICAgICB0aGlzLmFsZXJ0SGlzdG9yeS5wdXNoKGFsZXJ0KTtcblxuICAgICAgLy8gS2VlcCBvbmx5IGxhc3QgMTAwMCBhbGVydHNcbiAgICAgIGlmICh0aGlzLmFsZXJ0SGlzdG9yeS5sZW5ndGggPiAxMDAwKSB7XG4gICAgICAgIHRoaXMuYWxlcnRIaXN0b3J5ID0gdGhpcy5hbGVydEhpc3Rvcnkuc2xpY2UoLTEwMDApO1xuICAgICAgfVxuXG4gICAgICB0aGlzLnNhdmVBbGVydEhpc3RvcnkoKTtcbiAgICAgIHRoaXMuZW1pdCgnYWxlcnQnLCBhbGVydCk7XG5cbiAgICAgIGNvbnNvbGUubG9nKGBBbGVydCBlbWl0dGVkOiAke2FsZXJ0LnR5cGV9ICgke2FsZXJ0LnNldmVyaXR5fSkgLSAke2FsZXJ0Lm1lc3NhZ2V9YCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBnZXRMYXN0UHJvZ3Jlc3NVcGRhdGUoKTogRGF0ZSB8IG51bGwge1xuICAgIC8vIFRoaXMgd291bGQgdHJhY2sgYWN0dWFsIHByb2dyZXNzIHVwZGF0ZXMgaW4gcmVhbCBpbXBsZW1lbnRhdGlvblxuICAgIC8vIEZvciBub3csIHJldHVybiBhIHNpbXVsYXRlZCByZWNlbnQgdXBkYXRlXG4gICAgcmV0dXJuIG5ldyBEYXRlKERhdGUubm93KCkgLSBNYXRoLnJhbmRvbSgpICogMiAqIDYwICogNjAgKiAxMDAwKTsgLy8gUmFuZG9tIHRpbWUgd2l0aGluIGxhc3QgMiBob3Vyc1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRSZWNlbnRTYWZldHlFdmVudHMoKTogU2FmZXR5RXZlbnRbXSB7XG4gICAgLy8gVGhpcyB3b3VsZCB0cmFjayBhY3R1YWwgc2FmZXR5IGV2ZW50cyBpbiByZWFsIGltcGxlbWVudGF0aW9uXG4gICAgLy8gRm9yIG5vdywgcmV0dXJuIGVtcHR5IGFycmF5XG4gICAgcmV0dXJuIFtdO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRSZWNlbnRBbGVydHMoaG91cnM6IG51bWJlcik6IEFsZXJ0W10ge1xuICAgIGNvbnN0IGN1dG9mZlRpbWUgPSBuZXcgRGF0ZShEYXRlLm5vdygpIC0gaG91cnMgKiA2MCAqIDYwICogMTAwMCk7XG4gICAgcmV0dXJuIHRoaXMuYWxlcnRIaXN0b3J5LmZpbHRlcihhbGVydCA9PiBhbGVydC50aW1lc3RhbXAgPiBjdXRvZmZUaW1lKTtcbiAgfVxuXG4gIHByaXZhdGUgY2FsY3VsYXRlVHJlbmRpbmdEYXRhKCk6IFRyZW5kaW5nRGF0YVtdIHtcbiAgICAvLyBUaGlzIHdvdWxkIGNhbGN1bGF0ZSBhY3R1YWwgdHJlbmRpbmcgZGF0YSBmcm9tIGhpc3RvcmljYWwgcmVwb3J0c1xuICAgIC8vIEZvciBub3csIHJldHVybiBzaW11bGF0ZWQgdHJlbmRpbmcgZGF0YVxuICAgIGNvbnN0IHRyZW5kczogVHJlbmRpbmdEYXRhW10gPSBbXTtcbiAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpO1xuXG4gICAgZm9yIChsZXQgaSA9IDc7IGkgPj0gMDsgaS0tKSB7XG4gICAgICBjb25zdCBkYXRlID0gbmV3IERhdGUobm93LmdldFRpbWUoKSAtIGkgKiAyNCAqIDYwICogNjAgKiAxMDAwKTtcbiAgICAgIHRyZW5kcy5wdXNoKHtcbiAgICAgICAgZGF0ZSxcbiAgICAgICAgc3VjY2Vzc1JhdGU6IDc1ICsgTWF0aC5yYW5kb20oKSAqIDE1LCAvLyA3NS05MCVcbiAgICAgICAgdG90YWxBbnlUeXBlczogMTgwMCAtIGkgKiAyMCArIE1hdGgucmFuZG9tKCkgKiAxMCxcbiAgICAgICAgdW5pbnRlbnRpb25hbENvdW50OiAxMjAwIC0gaSAqIDE1ICsgTWF0aC5yYW5kb20oKSAqIDgsXG4gICAgICAgIGNsYXNzaWZpY2F0aW9uQWNjdXJhY3k6IDgwICsgTWF0aC5yYW5kb20oKSAqIDE1IC8vIDgwLTk1JVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRyZW5kcztcbiAgfVxuXG4gIHByaXZhdGUgY2FsY3VsYXRlU3lzdGVtSGVhbHRoKCk6IFN5c3RlbUhlYWx0aCB7XG4gICAgY29uc3QgcmVjZW50QWxlcnRzID0gdGhpcy5nZXRSZWNlbnRBbGVydHMoMjQpO1xuICAgIGNvbnN0IGNyaXRpY2FsQWxlcnRzID0gcmVjZW50QWxlcnRzLmZpbHRlcihhID0+IGEuc2V2ZXJpdHkgPT09ICdjcml0aWNhbCcpLmxlbmd0aDtcbiAgICBjb25zdCBoaWdoQWxlcnRzID0gcmVjZW50QWxlcnRzLmZpbHRlcihhID0+IGEuc2V2ZXJpdHkgPT09ICdoaWdoJykubGVuZ3RoO1xuXG4gICAgbGV0IGhlYWx0aFNjb3JlID0gMTAwO1xuICAgIGhlYWx0aFNjb3JlIC09IGNyaXRpY2FsQWxlcnRzICogMjA7XG4gICAgaGVhbHRoU2NvcmUgLT0gaGlnaEFsZXJ0cyAqIDEwO1xuICAgIGhlYWx0aFNjb3JlIC09IHJlY2VudEFsZXJ0cy5sZW5ndGggKiAyO1xuXG4gICAgaGVhbHRoU2NvcmUgPSBNYXRoLm1heCgwLCBNYXRoLm1pbigxMDAsIGhlYWx0aFNjb3JlKSk7XG5cbiAgICBsZXQgc3RhdHVzOiAnaGVhbHRoeScgfCAnd2FybmluZycgfCAnY3JpdGljYWwnO1xuICAgIGlmIChoZWFsdGhTY29yZSA+PSA4MCkgc3RhdHVzID0gJ2hlYWx0aHknO1xuICAgIGVsc2UgaWYgKGhlYWx0aFNjb3JlID49IDYwKSBzdGF0dXMgPSAnd2FybmluZyc7XG4gICAgZWxzZSBzdGF0dXMgPSAnY3JpdGljYWwnO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHNjb3JlOiBoZWFsdGhTY29yZSxcbiAgICAgIHN0YXR1cyxcbiAgICAgIGxhc3RDaGVjazogbmV3IERhdGUoKSxcbiAgICAgIGlzc3VlczogcmVjZW50QWxlcnRzLmZpbHRlcihhID0+IGEuc2V2ZXJpdHkgPT09ICdjcml0aWNhbCcgfHwgYS5zZXZlcml0eSA9PT0gJ2hpZ2gnKS5tYXAoYSA9PiBhLm1lc3NhZ2UpXG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgbG9hZEFsZXJ0SGlzdG9yeSgpOiB2b2lkIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgaGlzdG9yeVBhdGggPSBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgJy5raXJvJywgJ2NhbXBhaWduLXJlcG9ydHMnLCAnYWxlcnQtaGlzdG9yeS5qc29uJyk7XG4gICAgICBpZiAoZnMuZXhpc3RzU3luYyhoaXN0b3J5UGF0aCkpIHtcbiAgICAgICAgY29uc3QgaGlzdG9yeURhdGEgPSBmcy5yZWFkRmlsZVN5bmMoaGlzdG9yeVBhdGgsICd1dGY4Jyk7XG4gICAgICAgIHRoaXMuYWxlcnRIaXN0b3J5ID0gSlNPTi5wYXJzZShoaXN0b3J5RGF0YSkubWFwKChhbGVydDogYW55KSA9PiAoe1xuICAgICAgICAgIC4uLmFsZXJ0LFxuICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoYWxlcnQudGltZXN0YW1wKVxuICAgICAgICB9KSk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUud2FybignQ291bGQgbm90IGxvYWQgYWxlcnQgaGlzdG9yeTonLCBlcnJvcik7XG4gICAgICB0aGlzLmFsZXJ0SGlzdG9yeSA9IFtdO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgc2F2ZUFsZXJ0SGlzdG9yeSgpOiB2b2lkIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgaGlzdG9yeURpciA9IHBhdGguam9pbihwcm9jZXNzLmN3ZCgpLCAnLmtpcm8nLCAnY2FtcGFpZ24tcmVwb3J0cycpO1xuICAgICAgaWYgKCFmcy5leGlzdHNTeW5jKGhpc3RvcnlEaXIpKSB7XG4gICAgICAgIGZzLm1rZGlyU3luYyhoaXN0b3J5RGlyLCB7IHJlY3Vyc2l2ZTogdHJ1ZSB9KTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgaGlzdG9yeVBhdGggPSBwYXRoLmpvaW4oaGlzdG9yeURpciwgJ2FsZXJ0LWhpc3RvcnkuanNvbicpO1xuICAgICAgZnMud3JpdGVGaWxlU3luYyhoaXN0b3J5UGF0aCwgSlNPTi5zdHJpbmdpZnkodGhpcy5hbGVydEhpc3RvcnksIG51bGwsIDIpKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS53YXJuKCdDb3VsZCBub3Qgc2F2ZSBhbGVydCBoaXN0b3J5OicsIGVycm9yKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGxvYWRCdWlsZFN0YWJpbGl0eUhpc3RvcnkoKTogdm9pZCB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGhpc3RvcnlQYXRoID0gcGF0aC5qb2luKHByb2Nlc3MuY3dkKCksICcua2lybycsICdjYW1wYWlnbi1yZXBvcnRzJywgJ2J1aWxkLXN0YWJpbGl0eS1oaXN0b3J5Lmpzb24nKTtcbiAgICAgIGlmIChmcy5leGlzdHNTeW5jKGhpc3RvcnlQYXRoKSkge1xuICAgICAgICBjb25zdCBoaXN0b3J5RGF0YSA9IGZzLnJlYWRGaWxlU3luYyhoaXN0b3J5UGF0aCwgJ3V0ZjgnKTtcbiAgICAgICAgdGhpcy5idWlsZFN0YWJpbGl0eUhpc3RvcnkgPSBKU09OLnBhcnNlKGhpc3RvcnlEYXRhKS5tYXAoKHJlY29yZDogYW55KSA9PiAoe1xuICAgICAgICAgIC4uLnJlY29yZCxcbiAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKHJlY29yZC50aW1lc3RhbXApXG4gICAgICAgIH0pKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS53YXJuKCdDb3VsZCBub3QgbG9hZCBidWlsZCBzdGFiaWxpdHkgaGlzdG9yeTonLCBlcnJvcik7XG4gICAgICB0aGlzLmJ1aWxkU3RhYmlsaXR5SGlzdG9yeSA9IFtdO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgc2F2ZUJ1aWxkU3RhYmlsaXR5SGlzdG9yeSgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgaGlzdG9yeURpciA9IHBhdGguam9pbihwcm9jZXNzLmN3ZCgpLCAnLmtpcm8nLCAnY2FtcGFpZ24tcmVwb3J0cycpO1xuICAgICAgaWYgKCFmcy5leGlzdHNTeW5jKGhpc3RvcnlEaXIpKSB7XG4gICAgICAgIGZzLm1rZGlyU3luYyhoaXN0b3J5RGlyLCB7IHJlY3Vyc2l2ZTogdHJ1ZSB9KTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgaGlzdG9yeVBhdGggPSBwYXRoLmpvaW4oaGlzdG9yeURpciwgJ2J1aWxkLXN0YWJpbGl0eS1oaXN0b3J5Lmpzb24nKTtcbiAgICAgIGZzLndyaXRlRmlsZVN5bmMoaGlzdG9yeVBhdGgsIEpTT04uc3RyaW5naWZ5KHRoaXMuYnVpbGRTdGFiaWxpdHlIaXN0b3J5LCBudWxsLCAyKSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUud2FybignQ291bGQgbm90IHNhdmUgYnVpbGQgc3RhYmlsaXR5IGhpc3Rvcnk6JywgZXJyb3IpO1xuICAgIH1cbiAgfVxufVxuXG4vLyBTdXBwb3J0aW5nIGludGVyZmFjZXNcblxuZXhwb3J0IGludGVyZmFjZSBEYXNoYm9hcmREYXRhIHtcbiAgbGFzdFVwZGF0ZTogRGF0ZTtcbiAgYW5hbHlzaXNSZXBvcnQ6IEFuYWx5c2lzUmVwb3J0O1xuICBwcm9ncmVzc01ldHJpY3M6IFVuaW50ZW50aW9uYWxBbnlQcm9ncmVzcztcbiAgYnVpbGRTdGFiaWxpdHk6IEJ1aWxkU3RhYmlsaXR5UmVjb3JkO1xuICBhbGVydFN1bW1hcnk6IEFsZXJ0U3VtbWFyeTtcbiAgdHJlbmRpbmdEYXRhOiBUcmVuZGluZ0RhdGFbXTtcbiAgc3lzdGVtSGVhbHRoOiBTeXN0ZW1IZWFsdGg7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQWxlcnRUaHJlc2hvbGRzIHtcbiAgc3VjY2Vzc1JhdGVUaHJlc2hvbGQ6IG51bWJlcjtcbiAgYnVpbGRGYWlsdXJlVGhyZXNob2xkOiBudW1iZXI7XG4gIGNsYXNzaWZpY2F0aW9uQWNjdXJhY3lUaHJlc2hvbGQ6IG51bWJlcjtcbiAgc2FmZXR5RXZlbnRUaHJlc2hvbGQ6IG51bWJlcjtcbiAgcHJvZ3Jlc3NTdGFsbFRocmVzaG9sZDogbnVtYmVyOyAvLyBob3Vyc1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEFsZXJ0IHtcbiAgdHlwZTogQWxlcnRUeXBlO1xuICBzZXZlcml0eTogJ2xvdycgfCAnbWVkaXVtJyB8ICdoaWdoJyB8ICdjcml0aWNhbCc7XG4gIG1lc3NhZ2U6IHN0cmluZztcbiAgdGltZXN0YW1wOiBEYXRlO1xuICBkYXRhPzogYW55O1xufVxuXG5leHBvcnQgdHlwZSBBbGVydFR5cGUgPVxuICB8ICdsb3dfc3VjY2Vzc19yYXRlJ1xuICB8ICdidWlsZF9mYWlsdXJlJ1xuICB8ICdjb25zZWN1dGl2ZV9idWlsZF9mYWlsdXJlcydcbiAgfCAnbG93X2NsYXNzaWZpY2F0aW9uX2FjY3VyYWN5J1xuICB8ICdwcm9ncmVzc19zdGFsbCdcbiAgfCAnZnJlcXVlbnRfc2FmZXR5X2V2ZW50cydcbiAgfCAnc2FmZXR5X3Byb3RvY29sX2FjdGl2YXRpb24nXG4gIHwgJ3N5c3RlbV9lcnJvcic7XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2FmZXR5RXZlbnQge1xuICB0eXBlOiBzdHJpbmc7XG4gIHNldmVyaXR5OiAnbG93JyB8ICdtZWRpdW0nIHwgJ2hpZ2gnIHwgJ2NyaXRpY2FsJztcbiAgZGVzY3JpcHRpb246IHN0cmluZztcbiAgYWN0aW9uOiBzdHJpbmc7XG4gIHRpbWVzdGFtcDogRGF0ZTtcbiAgYWZmZWN0ZWRGaWxlcz86IHN0cmluZ1tdO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEJ1aWxkU3RhYmlsaXR5UmVjb3JkIHtcbiAgdGltZXN0YW1wOiBEYXRlO1xuICBpc1N0YWJsZTogYm9vbGVhbjtcbiAgYnVpbGRUaW1lOiBudW1iZXI7XG4gIGVycm9yQ291bnQ6IG51bWJlcjtcbiAgZXJyb3JNZXNzYWdlOiBzdHJpbmcgfCBudWxsO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEFsZXJ0U3VtbWFyeSB7XG4gIHRvdGFsQWxlcnRzOiBudW1iZXI7XG4gIGNyaXRpY2FsQWxlcnRzOiBudW1iZXI7XG4gIGhpZ2hBbGVydHM6IG51bWJlcjtcbiAgbWVkaXVtQWxlcnRzOiBudW1iZXI7XG4gIGxvd0FsZXJ0czogbnVtYmVyO1xuICByZWNlbnRBbGVydHM6IEFsZXJ0W107XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU3lzdGVtSGVhbHRoIHtcbiAgc2NvcmU6IG51bWJlcjsgLy8gMC0xMDBcbiAgc3RhdHVzOiAnaGVhbHRoeScgfCAnd2FybmluZycgfCAnY3JpdGljYWwnO1xuICBsYXN0Q2hlY2s6IERhdGU7XG4gIGlzc3Vlczogc3RyaW5nW107XG59XG4iXSwidmVyc2lvbiI6M30=