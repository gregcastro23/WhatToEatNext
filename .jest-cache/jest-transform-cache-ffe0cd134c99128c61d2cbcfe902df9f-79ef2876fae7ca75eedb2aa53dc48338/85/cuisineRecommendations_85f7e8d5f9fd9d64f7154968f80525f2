3e9a0484ecc9061b7cdc8bb219baa69c
"use strict";
/**
 * Cuisine Recommendations Module
 *
 * Generates cuisine recommendations based on alchemical and planetary influences
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.generateCuisineRecommendations = void 0;
/**
 * Planetary cuisine associations
 */
const PLANETARY_CUISINES = {
    Sun: ['Mediterranean', 'Italian', 'Spanish', 'Greek'],
    moon: ['Japanese', 'Korean', 'Scandinavian', 'British'],
    Mercury: ['Thai', 'Vietnamese', 'Lebanese', 'Moroccan'],
    Venus: ['French', 'Indian', 'Persian', 'Turkish'],
    Mars: ['Mexican', 'Cajun', 'Ethiopian', 'Szechuan'],
    Jupiter: ['German', 'Russian', 'Hungarian', 'Brazilian'],
    Saturn: ['Chinese', 'Tibetan', 'Mongolian', 'Nordic'],
    Uranus: ['Fusion', 'Molecular', 'Experimental', 'Modern'],
    Neptune: ['Seafood', 'Coastal', 'Island', 'Aquatic'],
    Pluto: ['Underground', 'Fermented', 'Aged', 'Transformed']
};
/**
 * Elemental cuisine characteristics
 */
const ELEMENTAL_CUISINES = { Fire: {
        cuisines: ['Mexican', 'Indian', 'Thai', 'Cajun', 'Ethiopian'],
        characteristics: ['Spicy', 'Grilled', 'Roasted', 'High heat cooking'],
        ingredients: ['Chili peppers', 'Ginger', 'Garlic', 'Spices']
    },
    Water: {
        cuisines: ['Japanese', 'Scandinavian', 'Coastal', 'Seafood'],
        characteristics: ['Steamed', 'Boiled', 'Raw', 'Liquid-based'],
        ingredients: ['Fish', 'Seaweed', 'Rice', 'Broths']
    },
    Air: {
        cuisines: ['Mediterranean', 'Lebanese', 'Greek', 'Light'],
        characteristics: ['Light', 'Airy', 'Whipped', 'Fermented'],
        ingredients: ['Herbs', 'Citrus', 'Olive oil', 'Fresh vegetables']
    },
    Earth: {
        cuisines: ['German', 'Russian', 'British', 'Comfort food'],
        characteristics: ['Hearty', 'Roasted', 'Baked', 'Grounding'],
        ingredients: ['Root vegetables', 'Grains', 'Meat', 'Dairy']
    }
};
/**
 * Generate cuisine recommendations based on dominant planets
 */
function generateCuisineRecommendations(dominantPlanets, elementalProperties) {
    const recommendations = [];
    const processedCuisines = new Set();
    // Get recommendations from dominant planets
    dominantPlanets === null || dominantPlanets === void 0 ? void 0 : dominantPlanets.slice(0, 3).forEach(({ planet, strength, element }) => {
        const planetaryCuisines = PLANETARY_CUISINES[planet] || [];
        (planetaryCuisines || []).forEach(cuisine => {
            if (!processedCuisines.has(cuisine)) {
                processedCuisines.add(cuisine);
                const compatibility = calculateCuisineCompatibility(cuisine, elementalProperties, strength);
                const reasons = generateCuisineReasons(cuisine, planet, element, strength);
                const suggestedDishes = getSuggestedDishes(cuisine, elementalProperties);
                recommendations === null || recommendations === void 0 ? void 0 : recommendations.push({
                    cuisine,
                    compatibility,
                    reasons,
                    elementalAlignment: calculateCuisineElementalAlignment(cuisine),
                    suggestedDishes
                });
            }
        });
    });
    // Add elemental cuisine recommendations
    Object.entries(elementalProperties || {}).forEach(([element, value]) => {
        if (value > 0.3) { // Only recommend if element is prominent
            const elementalCuisines = ELEMENTAL_CUISINES[element];
            (elementalCuisines.cuisines || []).forEach(cuisine => {
                if (!processedCuisines.has(cuisine)) {
                    processedCuisines.add(cuisine);
                    const compatibility = value * 0.8; // Base on elemental strength
                    const reasons = [`Strong ${element} element aligns with ${cuisine} cuisine characteristics`];
                    const suggestedDishes = getSuggestedDishes(cuisine, elementalProperties);
                    recommendations === null || recommendations === void 0 ? void 0 : recommendations.push({
                        cuisine,
                        compatibility,
                        reasons,
                        elementalAlignment: calculateCuisineElementalAlignment(cuisine),
                        suggestedDishes
                    });
                }
            });
        }
    });
    // Sort by compatibility and return top recommendations
    return recommendations
        .sort((a, b) => b.compatibility - a.compatibility)
        .slice(0, 8);
}
exports.generateCuisineRecommendations = generateCuisineRecommendations;
/**
 * Calculate cuisine compatibility with user's elemental properties
 */
function calculateCuisineCompatibility(cuisine, userElementals, planetaryStrength = 1.0) {
    const cuisineElementals = calculateCuisineElementalAlignment(cuisine);
    // Calculate elemental similarity
    const similarity = (Math.abs(cuisineElementals.Fire - userElementals.Fire) +
        Math.abs(cuisineElementals.Water - userElementals.Water) +
        Math.abs(cuisineElementals.Air - userElementals.Air) +
        Math.abs(cuisineElementals.Earth - userElementals.Earth)) / 4;
    const elementalCompatibility = 1 - similarity;
    // Combine with planetary strength
    return (elementalCompatibility * 0.7) + (planetaryStrength * 0.3);
}
/**
 * Calculate elemental alignment for a cuisine
 */
function calculateCuisineElementalAlignment(cuisine) {
    // Default balanced alignment
    let alignment = { Fire: 0.25, Water: 0.25, Air: 0.25, Earth: 0.25 };
    // Adjust based on cuisine characteristics
    const lowerCuisine = cuisine === null || cuisine === void 0 ? void 0 : cuisine.toLowerCase();
    if (['mexican', 'indian', 'thai', 'cajun', 'ethiopian', 'szechuan'].includes(lowerCuisine)) {
        alignment = { Fire: 0.4, Water: 0.2, Air: 0.2, Earth: 0.2 };
    }
    else if (['japanese', 'scandinavian', 'seafood', 'coastal'].includes(lowerCuisine)) {
        alignment = { Fire: 0.15, Water: 0.45, Air: 0.2, Earth: 0.2 };
    }
    else if (['mediterranean', 'lebanese', 'greek', 'moroccan'].includes(lowerCuisine)) {
        alignment = { Fire: 0.2, Water: 0.2, Air: 0.4, Earth: 0.2 };
    }
    else if (['german', 'russian', 'british', 'hungarian'].includes(lowerCuisine)) {
        alignment = { Fire: 0.2, Water: 0.2, Air: 0.15, Earth: 0.45 };
    }
    else if (['french', 'italian', 'spanish'].includes(lowerCuisine)) {
        alignment = { Fire: 0.3, Water: 0.2, Air: 0.3, Earth: 0.2 };
    }
    return alignment;
}
/**
 * Generate reasons for cuisine recommendation
 */
function generateCuisineReasons(cuisine, planet, element, strength) {
    var _a;
    const reasons = [];
    reasons === null || reasons === void 0 ? void 0 : reasons.push(`${planet} influence (${(_a = (strength * 100)) === null || _a === void 0 ? void 0 : _a.toFixed(0)}%) aligns with ${cuisine} cuisine`);
    reasons === null || reasons === void 0 ? void 0 : reasons.push(`${element} elemental energy complements ${cuisine} cooking methods`);
    if (strength > 0.7) {
        reasons === null || reasons === void 0 ? void 0 : reasons.push(`Strong planetary influence makes this an excellent match`);
    }
    else if (strength > 0.5) {
        reasons === null || reasons === void 0 ? void 0 : reasons.push(`Good planetary alignment for this cuisine style`);
    }
    return reasons;
}
/**
 * Get suggested dishes for a cuisine based on elemental properties
 */
function getSuggestedDishes(cuisine, elementals) {
    const dishes = {
        'Mexican': ['Tacos al pastor', 'Mole poblano', 'Ceviche', 'Pozole'],
        'Indian': ['Curry', 'Biryani', 'Tandoori', 'Dal'],
        'Thai': ['Pad thai', 'Tom yum', 'Green curry', 'Som tam'],
        'Japanese': ['Sushi', 'Ramen', 'Tempura', 'Miso soup'],
        'Italian': ['Pasta', 'Risotto', 'Pizza', 'Osso buco'],
        'French': ['Coq au vin', 'Bouillabaisse', 'Ratatouille', 'Soufflé'],
        'Mediterranean': ['Paella', 'Moussaka', 'Hummus', 'Grilled fish'],
        'Chinese': ['Stir-fry', 'Dim sum', 'Hot pot', 'Peking duck'],
        'German': ['Sauerbraten', 'Schnitzel', 'Sauerkraut', 'Bratwurst'],
        'Cajun': ['Gumbo', 'Jambalaya', 'Crawfish étouffee', 'Beignets']
    };
    const cuisineDishes = dishes[cuisine] || ['Traditional dishes', 'Regional specialties'];
    // Filter based on dominant element
    const dominantElement = Object.entries(elementals)
        .reduce((a, b) => elementals[a[0]] > elementals[b[0]] ? a : b)[0];
    // Return dishes that align with dominant element
    return cuisineDishes === null || cuisineDishes === void 0 ? void 0 : cuisineDishes.slice(0, 3);
}
exports.default = {
    generateCuisineRecommendations,
    calculateCuisineCompatibility,
    calculateCuisineElementalAlignment
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9jYWxjdWxhdGlvbnMvY3VsaW5hcnkvY3Vpc2luZVJlY29tbWVuZGF0aW9ucy50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7R0FJRzs7O0FBa0JIOztHQUVHO0FBQ0gsTUFBTSxrQkFBa0IsR0FBRztJQUN6QixHQUFHLEVBQUUsQ0FBQyxlQUFlLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxPQUFPLENBQUM7SUFDckQsSUFBSSxFQUFFLENBQUMsVUFBVSxFQUFFLFFBQVEsRUFBRSxjQUFjLEVBQUUsU0FBUyxDQUFDO0lBQ3ZELE9BQU8sRUFBRSxDQUFDLE1BQU0sRUFBRSxZQUFZLEVBQUUsVUFBVSxFQUFFLFVBQVUsQ0FBQztJQUN2RCxLQUFLLEVBQUUsQ0FBQyxRQUFRLEVBQUUsUUFBUSxFQUFFLFNBQVMsRUFBRSxTQUFTLENBQUM7SUFDakQsSUFBSSxFQUFFLENBQUMsU0FBUyxFQUFFLE9BQU8sRUFBRSxXQUFXLEVBQUUsVUFBVSxDQUFDO0lBQ25ELE9BQU8sRUFBRSxDQUFDLFFBQVEsRUFBRSxTQUFTLEVBQUUsV0FBVyxFQUFFLFdBQVcsQ0FBQztJQUN4RCxNQUFNLEVBQUUsQ0FBQyxTQUFTLEVBQUUsU0FBUyxFQUFFLFdBQVcsRUFBRSxRQUFRLENBQUM7SUFDckQsTUFBTSxFQUFFLENBQUMsUUFBUSxFQUFFLFdBQVcsRUFBRSxjQUFjLEVBQUUsUUFBUSxDQUFDO0lBQ3pELE9BQU8sRUFBRSxDQUFDLFNBQVMsRUFBRSxTQUFTLEVBQUUsUUFBUSxFQUFFLFNBQVMsQ0FBQztJQUNwRCxLQUFLLEVBQUUsQ0FBQyxhQUFhLEVBQUUsV0FBVyxFQUFFLE1BQU0sRUFBRSxhQUFhLENBQUM7Q0FDM0QsQ0FBQztBQUVGOztHQUVHO0FBQ0gsTUFBTSxrQkFBa0IsR0FBRyxFQUFFLElBQUksRUFBRTtRQUMvQixRQUFRLEVBQUUsQ0FBQyxTQUFTLEVBQUUsUUFBUSxFQUFFLE1BQU0sRUFBRSxPQUFPLEVBQUUsV0FBVyxD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QztRQUNyRCxRQUFRLEVBQUUsQ0FBQyxZQUFZLEVBQUUsZUFBZSxFQUFFLGFBQWEsRUFBRSxTQUFTLENBQUM7UUFDbkUsZUFBZSxFQUFFLENBQUMsUUFBUSxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUUsY0FBYyxDQUFDO1FBQ2pFLFNBQVMsRUFBRSxDQUFDLFVBQVUsRUFBRSxTQUFTLEVBQUUsU0FBUyxFQUFFLGFBQWEsQ0FBQztRQUM1RCxRQUFRLEVBQUUsQ0FBQyxhQUFhLEVBQUUsV0FBVyxFQUFFLFlBQVksRUFBRSxXQUFXLENBQUM7UUFDakUsT0FBTyxFQUFFLENBQUMsT0FBTyxFQUFFLFdBQVcsRUFBRSxtQkFBbUIsRUFBRSxVQUFVLENBQUM7S0FDakUsQ0FBQztJQUVGLE1BQU0sYUFBYSxHQUFHLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLG9CQUFvQixFQUFFLHNCQUFzQixDQUFDLENBQUM7SUFFeEYsbUNBQW1DO0lBQ25DLE1BQU0sZUFBZSxHQUFHLE1BQU0sQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDO1NBQy9DLE1BQU0sQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUE4QixDQUFDLEdBQUcsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQThCLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUU5SCxpREFBaUQ7SUFDakQsT0FBTyxhQUFhLGFBQWIsYUFBYSx1QkFBYixhQUFhLENBQUUsS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztBQUNwQyxDQUFDO0FBRUQsa0JBQWU7SUFDYiw4QkFBOEI7SUFDOUIsNkJBQTZCO0lBQzdCLGtDQUFrQztDQUNuQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9HcmVnQ2FzdHJvL0Rlc2t0b3AvV2hhdFRvRWF0TmV4dC9zcmMvY2FsY3VsYXRpb25zL2N1bGluYXJ5L2N1aXNpbmVSZWNvbW1lbmRhdGlvbnMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDdWlzaW5lIFJlY29tbWVuZGF0aW9ucyBNb2R1bGVcbiAqIFxuICogR2VuZXJhdGVzIGN1aXNpbmUgcmVjb21tZW5kYXRpb25zIGJhc2VkIG9uIGFsY2hlbWljYWwgYW5kIHBsYW5ldGFyeSBpbmZsdWVuY2VzXG4gKi9cblxuXG5cbmltcG9ydCB0eXBlIHsgRWxlbWVudGFsUHJvcGVydGllcyB9IGZyb20gXCJAL3R5cGVzL2FsY2hlbXlcIjtcbmltcG9ydCB7IEVsZW1lbnQgfSBmcm9tIFwiQC90eXBlcy9hbGNoZW15XCI7XG5cbi8qKlxuICogQ3Vpc2luZSByZWNvbW1lbmRhdGlvbiByZXN1bHRcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBDdWlzaW5lUmVjb21tZW5kYXRpb24ge1xuICBjdWlzaW5lOiBzdHJpbmc7XG4gIGNvbXBhdGliaWxpdHk6IG51bWJlcjtcbiAgcmVhc29uczogc3RyaW5nW107XG4gIGVsZW1lbnRhbEFsaWdubWVudDogRWxlbWVudGFsUHJvcGVydGllcztcbiAgc3VnZ2VzdGVkRGlzaGVzOiBzdHJpbmdbXTtcbn1cblxuLyoqXG4gKiBQbGFuZXRhcnkgY3Vpc2luZSBhc3NvY2lhdGlvbnNcbiAqL1xuY29uc3QgUExBTkVUQVJZX0NVSVNJTkVTID0ge1xuICBTdW46IFsnTWVkaXRlcnJhbmVhbicsICdJdGFsaWFuJywgJ1NwYW5pc2gnLCAnR3JlZWsnXSxcbiAgbW9vbjogWydKYXBhbmVzZScsICdLb3JlYW4nLCAnU2NhbmRpbmF2aWFuJywgJ0JyaXRpc2gnXSxcbiAgTWVyY3VyeTogWydUaGFpJywgJ1ZpZXRuYW1lc2UnLCAnTGViYW5lc2UnLCAnTW9yb2NjYW4nXSxcbiAgVmVudXM6IFsnRnJlbmNoJywgJ0luZGlhbicsICdQZXJzaWFuJywgJ1R1cmtpc2gnXSxcbiAgTWFyczogWydNZXhpY2FuJywgJ0NhanVuJywgJ0V0aGlvcGlhbicsICdTemVjaHVhbiddLFxuICBKdXBpdGVyOiBbJ0dlcm1hbicsICdSdXNzaWFuJywgJ0h1bmdhcmlhbicsICdCcmF6aWxpYW4nXSxcbiAgU2F0dXJuOiBbJ0NoaW5lc2UnLCAnVGliZXRhbicsICdNb25nb2xpYW4nLCAnTm9yZGljJ10sXG4gIFVyYW51czogWydGdXNpb24nLCAnTW9sZWN1bGFyJywgJ0V4cGVyaW1lbnRhbCcsICdNb2Rlcm4nXSxcbiAgTmVwdHVuZTogWydTZWFmb29kJywgJ0NvYXN0YWwnLCAnSXNsYW5kJywgJ0FxdWF0aWMnXSxcbiAgUGx1dG86IFsnVW5kZXJncm91bmQnLCAnRmVybWVudGVkJywgJ0FnZWQnLCAnVHJhbnNmb3JtZWQnXVxufTtcblxuLyoqXG4gKiBFbGVtZW50YWwgY3Vpc2luZSBjaGFyYWN0ZXJpc3RpY3NcbiAqL1xuY29uc3QgRUxFTUVOVEFMX0NVSVNJTkVTID0geyBGaXJlOiB7XG4gICAgY3Vpc2luZXM6IFsnTWV4aWNhbicsICdJbmRpYW4nLCAnVGhhaScsICdDYWp1bicsICdFdGhpb3BpYW4nXSxcbiAgICBjaGFyYWN0ZXJpc3RpY3M6IFsnU3BpY3knLCAnR3JpbGxlZCcsICdSb2FzdGVkJywgJ0hpZ2ggaGVhdCBjb29raW5nJ10sXG4gICAgaW5ncmVkaWVudHM6IFsnQ2hpbGkgcGVwcGVycycsICdHaW5nZXInLCAnR2FybGljJywgJ1NwaWNlcyddXG4gIH0sXG4gIFdhdGVyOiB7XG4gICAgY3Vpc2luZXM6IFsnSmFwYW5lc2UnLCAnU2NhbmRpbmF2aWFuJywgJ0NvYXN0YWwnLCAnU2VhZm9vZCddLFxuICAgIGNoYXJhY3RlcmlzdGljczogWydTdGVhbWVkJywgJ0JvaWxlZCcsICdSYXcnLCAnTGlxdWlkLWJhc2VkJ10sXG4gICAgaW5ncmVkaWVudHM6IFsnRmlzaCcsICdTZWF3ZWVkJywgJ1JpY2UnLCAnQnJvdGhzJ11cbiAgfSxcbiAgQWlyOiB7XG4gICAgY3Vpc2luZXM6IFsnTWVkaXRlcnJhbmVhbicsICdMZWJhbmVzZScsICdHcmVlaycsICdMaWdodCddLFxuICAgIGNoYXJhY3RlcmlzdGljczogWydMaWdodCcsICdBaXJ5JywgJ1doaXBwZWQnLCAnRmVybWVudGVkJ10sXG4gICAgaW5ncmVkaWVudHM6IFsnSGVyYnMnLCAnQ2l0cnVzJywgJ09saXZlIG9pbCcsICdGcmVzaCB2ZWdldGFibGVzJ11cbiAgfSxcbiAgRWFydGg6IHtcbiAgICBjdWlzaW5lczogWydHZXJtYW4nLCAnUnVzc2lhbicsICdCcml0aXNoJywgJ0NvbWZvcnQgZm9vZCddLFxuICAgIGNoYXJhY3RlcmlzdGljczogWydIZWFydHknLCAnUm9hc3RlZCcsICdCYWtlZCcsICdHcm91bmRpbmcnXSxcbiAgICBpbmdyZWRpZW50czogWydSb290IHZlZ2V0YWJsZXMnLCAnR3JhaW5zJywgJ01lYXQnLCAnRGFpcnknXVxuICB9XG59O1xuXG4vKipcbiAqIEdlbmVyYXRlIGN1aXNpbmUgcmVjb21tZW5kYXRpb25zIGJhc2VkIG9uIGRvbWluYW50IHBsYW5ldHNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdlbmVyYXRlQ3Vpc2luZVJlY29tbWVuZGF0aW9ucyhcbiAgZG9taW5hbnRQbGFuZXRzOiBBcnJheTx7IHBsYW5ldDogc3RyaW5nOyBzdHJlbmd0aDogbnVtYmVyOyBlbGVtZW50OiBFbGVtZW50IH0+LFxuICBlbGVtZW50YWxQcm9wZXJ0aWVzOiBFbGVtZW50YWxQcm9wZXJ0aWVzXG4pOiBDdWlzaW5lUmVjb21tZW5kYXRpb25bXSB7XG4gIGNvbnN0IHJlY29tbWVuZGF0aW9uczogQ3Vpc2luZVJlY29tbWVuZGF0aW9uW10gPSBbXTtcbiAgY29uc3QgcHJvY2Vzc2VkQ3Vpc2luZXMgPSBuZXcgU2V0PHN0cmluZz4oKTtcblxuICAvLyBHZXQgcmVjb21tZW5kYXRpb25zIGZyb20gZG9taW5hbnQgcGxhbmV0c1xuICBkb21pbmFudFBsYW5ldHM/LnNsaWNlKDAsIDMpLmZvckVhY2goKHsgcGxhbmV0LCBzdHJlbmd0aCwgZWxlbWVudCB9KSA9PiB7XG4gICAgY29uc3QgcGxhbmV0YXJ5Q3Vpc2luZXMgPSBQTEFORVRBUllfQ1VJU0lORVNbcGxhbmV0IGFzIGtleW9mIHR5cGVvZiBQTEFORVRBUllfQ1VJU0lORVNdIHx8IFtdO1xuICAgIFxuICAgIChwbGFuZXRhcnlDdWlzaW5lcyB8fCBbXSkuZm9yRWFjaChjdWlzaW5lID0+IHtcbiAgICAgIGlmICghcHJvY2Vzc2VkQ3Vpc2luZXMuaGFzKGN1aXNpbmUpKSB7XG4gICAgICAgIHByb2Nlc3NlZEN1aXNpbmVzLmFkZChjdWlzaW5lKTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IGNvbXBhdGliaWxpdHkgPSBjYWxjdWxhdGVDdWlzaW5lQ29tcGF0aWJpbGl0eShjdWlzaW5lLCBlbGVtZW50YWxQcm9wZXJ0aWVzLCBzdHJlbmd0aCk7XG4gICAgICAgIGNvbnN0IHJlYXNvbnMgPSBnZW5lcmF0ZUN1aXNpbmVSZWFzb25zKGN1aXNpbmUsIHBsYW5ldCwgZWxlbWVudCwgc3RyZW5ndGgpO1xuICAgICAgICBjb25zdCBzdWdnZXN0ZWREaXNoZXMgPSBnZXRTdWdnZXN0ZWREaXNoZXMoY3Vpc2luZSwgZWxlbWVudGFsUHJvcGVydGllcyk7XG4gICAgICAgIFxuICAgICAgICByZWNvbW1lbmRhdGlvbnM/LnB1c2goe1xuICAgICAgICAgIGN1aXNpbmUsXG4gICAgICAgICAgY29tcGF0aWJpbGl0eSxcbiAgICAgICAgICByZWFzb25zLFxuICAgICAgICAgIGVsZW1lbnRhbEFsaWdubWVudDogY2FsY3VsYXRlQ3Vpc2luZUVsZW1lbnRhbEFsaWdubWVudChjdWlzaW5lKSxcbiAgICAgICAgICBzdWdnZXN0ZWREaXNoZXNcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xuXG4gIC8vIEFkZCBlbGVtZW50YWwgY3Vpc2luZSByZWNvbW1lbmRhdGlvbnNcbiAgT2JqZWN0LmVudHJpZXMoZWxlbWVudGFsUHJvcGVydGllcyB8fCB7fSkuZm9yRWFjaCgoW2VsZW1lbnQsIHZhbHVlXSkgPT4ge1xuICAgIGlmICh2YWx1ZSA+IDAuMykgeyAvLyBPbmx5IHJlY29tbWVuZCBpZiBlbGVtZW50IGlzIHByb21pbmVudFxuICAgICAgY29uc3QgZWxlbWVudGFsQ3Vpc2luZXMgPSBFTEVNRU5UQUxfQ1VJU0lORVNbZWxlbWVudCBhcyBrZXlvZiB0eXBlb2YgRUxFTUVOVEFMX0NVSVNJTkVTXTtcbiAgICAgIFxuICAgICAgKGVsZW1lbnRhbEN1aXNpbmVzLmN1aXNpbmVzIHx8IFtdKS5mb3JFYWNoKGN1aXNpbmUgPT4ge1xuICAgICAgICBpZiAoIXByb2Nlc3NlZEN1aXNpbmVzLmhhcyhjdWlzaW5lKSkge1xuICAgICAgICAgIHByb2Nlc3NlZEN1aXNpbmVzLmFkZChjdWlzaW5lKTtcbiAgICAgICAgICBcbiAgICAgICAgICBjb25zdCBjb21wYXRpYmlsaXR5ID0gdmFsdWUgKiAwLjg7IC8vIEJhc2Ugb24gZWxlbWVudGFsIHN0cmVuZ3RoXG4gICAgICAgICAgY29uc3QgcmVhc29ucyA9IFtgU3Ryb25nICR7ZWxlbWVudH0gZWxlbWVudCBhbGlnbnMgd2l0aCAke2N1aXNpbmV9IGN1aXNpbmUgY2hhcmFjdGVyaXN0aWNzYF07XG4gICAgICAgICAgY29uc3Qgc3VnZ2VzdGVkRGlzaGVzID0gZ2V0U3VnZ2VzdGVkRGlzaGVzKGN1aXNpbmUsIGVsZW1lbnRhbFByb3BlcnRpZXMpO1xuICAgICAgICAgIFxuICAgICAgICAgIHJlY29tbWVuZGF0aW9ucz8ucHVzaCh7XG4gICAgICAgICAgICBjdWlzaW5lLFxuICAgICAgICAgICAgY29tcGF0aWJpbGl0eSxcbiAgICAgICAgICAgIHJlYXNvbnMsXG4gICAgICAgICAgICBlbGVtZW50YWxBbGlnbm1lbnQ6IGNhbGN1bGF0ZUN1aXNpbmVFbGVtZW50YWxBbGlnbm1lbnQoY3Vpc2luZSksXG4gICAgICAgICAgICBzdWdnZXN0ZWREaXNoZXNcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9KTtcblxuICAvLyBTb3J0IGJ5IGNvbXBhdGliaWxpdHkgYW5kIHJldHVybiB0b3AgcmVjb21tZW5kYXRpb25zXG4gIHJldHVybiByZWNvbW1lbmRhdGlvbnNcbiAgICAuc29ydCgoYSwgYikgPT4gYi5jb21wYXRpYmlsaXR5IC0gYS5jb21wYXRpYmlsaXR5KVxuICAgIC5zbGljZSgwLCA4KTtcbn1cblxuLyoqXG4gKiBDYWxjdWxhdGUgY3Vpc2luZSBjb21wYXRpYmlsaXR5IHdpdGggdXNlcidzIGVsZW1lbnRhbCBwcm9wZXJ0aWVzXG4gKi9cbmZ1bmN0aW9uIGNhbGN1bGF0ZUN1aXNpbmVDb21wYXRpYmlsaXR5KFxuICBjdWlzaW5lOiBzdHJpbmcsXG4gIHVzZXJFbGVtZW50YWxzOiBFbGVtZW50YWxQcm9wZXJ0aWVzLFxuICBwbGFuZXRhcnlTdHJlbmd0aDogbnVtYmVyID0gMS4wXG4pOiBudW1iZXIge1xuICBjb25zdCBjdWlzaW5lRWxlbWVudGFscyA9IGNhbGN1bGF0ZUN1aXNpbmVFbGVtZW50YWxBbGlnbm1lbnQoY3Vpc2luZSk7XG4gIFxuICAvLyBDYWxjdWxhdGUgZWxlbWVudGFsIHNpbWlsYXJpdHlcbiAgY29uc3Qgc2ltaWxhcml0eSA9IChcbiAgICBNYXRoLmFicyhjdWlzaW5lRWxlbWVudGFscy5GaXJlIC0gdXNlckVsZW1lbnRhbHMuRmlyZSkgK1xuICAgIE1hdGguYWJzKGN1aXNpbmVFbGVtZW50YWxzLldhdGVyIC0gdXNlckVsZW1lbnRhbHMuV2F0ZXIpICtcbiAgICBNYXRoLmFicyhjdWlzaW5lRWxlbWVudGFscy5BaXIgLSB1c2VyRWxlbWVudGFscy5BaXIpICtcbiAgICBNYXRoLmFicyhjdWlzaW5lRWxlbWVudGFscy5FYXJ0aCAtIHVzZXJFbGVtZW50YWxzLkVhcnRoKVxuICApIC8gNDtcbiAgXG4gIGNvbnN0IGVsZW1lbnRhbENvbXBhdGliaWxpdHkgPSAxIC0gc2ltaWxhcml0eTtcbiAgXG4gIC8vIENvbWJpbmUgd2l0aCBwbGFuZXRhcnkgc3RyZW5ndGhcbiAgcmV0dXJuIChlbGVtZW50YWxDb21wYXRpYmlsaXR5ICogMC43KSArIChwbGFuZXRhcnlTdHJlbmd0aCAqIDAuMyk7XG59XG5cbi8qKlxuICogQ2FsY3VsYXRlIGVsZW1lbnRhbCBhbGlnbm1lbnQgZm9yIGEgY3Vpc2luZVxuICovXG5mdW5jdGlvbiBjYWxjdWxhdGVDdWlzaW5lRWxlbWVudGFsQWxpZ25tZW50KGN1aXNpbmU6IHN0cmluZyk6IEVsZW1lbnRhbFByb3BlcnRpZXMge1xuICAvLyBEZWZhdWx0IGJhbGFuY2VkIGFsaWdubWVudFxuICBsZXQgYWxpZ25tZW50OiBFbGVtZW50YWxQcm9wZXJ0aWVzID0geyBGaXJlOiAwLjI1LCBXYXRlcjogMC4yNSwgQWlyOiAwLjI1LCBFYXJ0aDogMC4yNSB9O1xuXG4gIC8vIEFkanVzdCBiYXNlZCBvbiBjdWlzaW5lIGNoYXJhY3RlcmlzdGljc1xuICBjb25zdCBsb3dlckN1aXNpbmUgPSBjdWlzaW5lPy50b0xvd2VyQ2FzZSgpO1xuXG4gIGlmIChbJ21leGljYW4nLCAnaW5kaWFuJywgJ3RoYWknLCAnY2FqdW4nLCAnZXRoaW9waWFuJywgJ3N6ZWNodWFuJ10uaW5jbHVkZXMobG93ZXJDdWlzaW5lKSkge1xuICAgIGFsaWdubWVudCA9IHsgRmlyZTogMC40LCBXYXRlcjogMC4yLCBBaXI6IDAuMiwgRWFydGg6IDAuMiB9O1xuICB9IGVsc2UgaWYgKFsnamFwYW5lc2UnLCAnc2NhbmRpbmF2aWFuJywgJ3NlYWZvb2QnLCAnY29hc3RhbCddLmluY2x1ZGVzKGxvd2VyQ3Vpc2luZSkpIHtcbiAgICBhbGlnbm1lbnQgPSB7IEZpcmU6IDAuMTUsIFdhdGVyOiAwLjQ1LCBBaXI6IDAuMiwgRWFydGg6IDAuMiB9O1xuICB9IGVsc2UgaWYgKFsnbWVkaXRlcnJhbmVhbicsICdsZWJhbmVzZScsICdncmVlaycsICdtb3JvY2NhbiddLmluY2x1ZGVzKGxvd2VyQ3Vpc2luZSkpIHtcbiAgICBhbGlnbm1lbnQgPSB7IEZpcmU6IDAuMiwgV2F0ZXI6IDAuMiwgQWlyOiAwLjQsIEVhcnRoOiAwLjIgfTtcbiAgfSBlbHNlIGlmIChbJ2dlcm1hbicsICdydXNzaWFuJywgJ2JyaXRpc2gnLCAnaHVuZ2FyaWFuJ10uaW5jbHVkZXMobG93ZXJDdWlzaW5lKSkge1xuICAgIGFsaWdubWVudCA9IHsgRmlyZTogMC4yLCBXYXRlcjogMC4yLCBBaXI6IDAuMTUsIEVhcnRoOiAwLjQ1IH07XG4gIH0gZWxzZSBpZiAoWydmcmVuY2gnLCAnaXRhbGlhbicsICdzcGFuaXNoJ10uaW5jbHVkZXMobG93ZXJDdWlzaW5lKSkge1xuICAgIGFsaWdubWVudCA9IHsgRmlyZTogMC4zLCBXYXRlcjogMC4yLCBBaXI6IDAuMywgRWFydGg6IDAuMiB9O1xuICB9XG5cbiAgcmV0dXJuIGFsaWdubWVudDtcbn1cblxuLyoqXG4gKiBHZW5lcmF0ZSByZWFzb25zIGZvciBjdWlzaW5lIHJlY29tbWVuZGF0aW9uXG4gKi9cbmZ1bmN0aW9uIGdlbmVyYXRlQ3Vpc2luZVJlYXNvbnMoXG4gIGN1aXNpbmU6IHN0cmluZyxcbiAgcGxhbmV0OiBzdHJpbmcsXG4gIGVsZW1lbnQ6IEVsZW1lbnQsXG4gIHN0cmVuZ3RoOiBudW1iZXJcbik6IHN0cmluZ1tdIHtcbiAgY29uc3QgcmVhc29uczogc3RyaW5nW10gPSBbXTtcblxuICByZWFzb25zPy5wdXNoKGAke3BsYW5ldH0gaW5mbHVlbmNlICgkeyhzdHJlbmd0aCAqIDEwMCk/LnRvRml4ZWQoMCl9JSkgYWxpZ25zIHdpdGggJHtjdWlzaW5lfSBjdWlzaW5lYCk7XG4gIHJlYXNvbnM/LnB1c2goYCR7ZWxlbWVudH0gZWxlbWVudGFsIGVuZXJneSBjb21wbGVtZW50cyAke2N1aXNpbmV9IGNvb2tpbmcgbWV0aG9kc2ApO1xuXG4gIGlmIChzdHJlbmd0aCA+IDAuNykge1xuICAgIHJlYXNvbnM/LnB1c2goYFN0cm9uZyBwbGFuZXRhcnkgaW5mbHVlbmNlIG1ha2VzIHRoaXMgYW4gZXhjZWxsZW50IG1hdGNoYCk7XG4gIH0gZWxzZSBpZiAoc3RyZW5ndGggPiAwLjUpIHtcbiAgICByZWFzb25zPy5wdXNoKGBHb29kIHBsYW5ldGFyeSBhbGlnbm1lbnQgZm9yIHRoaXMgY3Vpc2luZSBzdHlsZWApO1xuICB9XG5cbiAgcmV0dXJuIHJlYXNvbnM7XG59XG5cbi8qKlxuICogR2V0IHN1Z2dlc3RlZCBkaXNoZXMgZm9yIGEgY3Vpc2luZSBiYXNlZCBvbiBlbGVtZW50YWwgcHJvcGVydGllc1xuICovXG5mdW5jdGlvbiBnZXRTdWdnZXN0ZWREaXNoZXMoY3Vpc2luZTogc3RyaW5nLCBlbGVtZW50YWxzOiBFbGVtZW50YWxQcm9wZXJ0aWVzKTogc3RyaW5nW10ge1xuICBjb25zdCBkaXNoZXM6IFJlY29yZDxzdHJpbmcsIHN0cmluZ1tdPiA9IHtcbiAgICAnTWV4aWNhbic6IFsnVGFjb3MgYWwgcGFzdG9yJywgJ01vbGUgcG9ibGFubycsICdDZXZpY2hlJywgJ1Bvem9sZSddLFxuICAgICdJbmRpYW4nOiBbJ0N1cnJ5JywgJ0JpcnlhbmknLCAnVGFuZG9vcmknLCAnRGFsJ10sXG4gICAgJ1RoYWknOiBbJ1BhZCB0aGFpJywgJ1RvbSB5dW0nLCAnR3JlZW4gY3VycnknLCAnU29tIHRhbSddLFxuICAgICdKYXBhbmVzZSc6IFsnU3VzaGknLCAnUmFtZW4nLCAnVGVtcHVyYScsICdNaXNvIHNvdXAnXSxcbiAgICAnSXRhbGlhbic6IFsnUGFzdGEnLCAnUmlzb3R0bycsICdQaXp6YScsICdPc3NvIGJ1Y28nXSxcbiAgICAnRnJlbmNoJzogWydDb3EgYXUgdmluJywgJ0JvdWlsbGFiYWlzc2UnLCAnUmF0YXRvdWlsbGUnLCAnU291ZmZsw6knXSxcbiAgICAnTWVkaXRlcnJhbmVhbic6IFsnUGFlbGxhJywgJ01vdXNzYWthJywgJ0h1bW11cycsICdHcmlsbGVkIGZpc2gnXSxcbiAgICAnQ2hpbmVzZSc6IFsnU3Rpci1mcnknLCAnRGltIHN1bScsICdIb3QgcG90JywgJ1Bla2luZyBkdWNrJ10sXG4gICAgJ0dlcm1hbic6IFsnU2F1ZXJicmF0ZW4nLCAnU2Nobml0emVsJywgJ1NhdWVya3JhdXQnLCAnQnJhdHd1cnN0J10sXG4gICAgJ0NhanVuJzogWydHdW1ibycsICdKYW1iYWxheWEnLCAnQ3Jhd2Zpc2ggw6l0b3VmZmVlJywgJ0JlaWduZXRzJ11cbiAgfTtcblxuICBjb25zdCBjdWlzaW5lRGlzaGVzID0gZGlzaGVzW2N1aXNpbmVdIHx8IFsnVHJhZGl0aW9uYWwgZGlzaGVzJywgJ1JlZ2lvbmFsIHNwZWNpYWx0aWVzJ107XG4gIFxuICAvLyBGaWx0ZXIgYmFzZWQgb24gZG9taW5hbnQgZWxlbWVudFxuICBjb25zdCBkb21pbmFudEVsZW1lbnQgPSBPYmplY3QuZW50cmllcyhlbGVtZW50YWxzKVxuICAgIC5yZWR1Y2UoKGEsIGIpID0+IGVsZW1lbnRhbHNbYVswXSBhcyBrZXlvZiBFbGVtZW50YWxQcm9wZXJ0aWVzXSA+IGVsZW1lbnRhbHNbYlswXSBhcyBrZXlvZiBFbGVtZW50YWxQcm9wZXJ0aWVzXSA/IGEgOiBiKVswXTtcblxuICAvLyBSZXR1cm4gZGlzaGVzIHRoYXQgYWxpZ24gd2l0aCBkb21pbmFudCBlbGVtZW50XG4gIHJldHVybiBjdWlzaW5lRGlzaGVzPy5zbGljZSgwLCAzKTtcbn1cblxuZXhwb3J0IGRlZmF1bHQge1xuICBnZW5lcmF0ZUN1aXNpbmVSZWNvbW1lbmRhdGlvbnMsXG4gIGNhbGN1bGF0ZUN1aXNpbmVDb21wYXRpYmlsaXR5LFxuICBjYWxjdWxhdGVDdWlzaW5lRWxlbWVudGFsQWxpZ25tZW50XG59OyAiXSwidmVyc2lvbiI6M30=