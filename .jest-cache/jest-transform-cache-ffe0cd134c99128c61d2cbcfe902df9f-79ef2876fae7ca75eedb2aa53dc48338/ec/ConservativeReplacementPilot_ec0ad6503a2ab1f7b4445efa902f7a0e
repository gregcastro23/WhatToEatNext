74dd596beba621e28cbadff0884baa83
"use strict";
/**
 * Conservative Replacement Pilot
 * Executes limited batch processing on high-confidence cases with real-time validation
 *
 * Task 12.2 Implementation:
 * - Run limited batch processing on high-confidence cases (10-15 files per batch)
 * - Focus on array types (any[] ‚Üí unknown[]) and simple Record types
 * - Monitor build stability and rollback frequency with real-time validation
 * - Collect success rate metrics and safety protocol effectiveness
 * - Validate integration with existing campaign infrastructure
 * - Target >80% successful replacements with zero build failures
 */
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.ConservativeReplacementPilot = void 0;
const child_process_1 = require("child_process");
const fs = __importStar(require("fs"));
const path = __importStar(require("path"));
const AnyTypeClassifier_1 = require("./AnyTypeClassifier");
const CampaignIntegration_1 = require("./CampaignIntegration");
const MetricsIntegration_1 = require("./MetricsIntegration");
const ProgressiveImprovementEngine_1 = require("./ProgressiveImprovementEngine");
const SafeTypeReplacer_1 = require("./SafeTypeReplacer");
const types_1 = require("./types");
class ConservativeReplacementPilot {
    classifier;
    replacer;
    progressiveEngine;
    campaignIntegration;
    metricsIntegration;
    config;
    pilotStartTime;
    batchResults = [];
    safetyMetrics;
    constructor(config = {}) {
        this.config = {
            maxFilesPerBatch: 15,
            minFilesPerBatch: 10,
            targetSuccessRate: 0.8,
            maxBatches: 10,
            realTimeValidation: true,
            rollbackOnFailure: true,
            safetyThreshold: 0.7,
            focusCategories: [types_1.AnyTypeCategory.ARRAY_TYPE, types_1.AnyTypeCategory.RECORD_TYPE],
            buildValidationFrequency: 1,
            ...config
        };
        this.classifier = new AnyTypeClassifier_1.AnyTypeClassifier();
        this.replacer = new SafeTypeReplacer_1.SafeTypeReplacer('./.conservative-pilot-backups', this.config.safetyThreshold);
        this.progressiveEngine = new ProgressiveImprovementEngine_1.ProgressiveImprovementEngine();
        this.campaignIntegration = new CampaignIntegration_1.CampaignIntegration();
        this.metricsIntegration = new MetricsIntegration_1.MetricsIntegration();
        this.pilotStartTime = new Date();
        this.safetyMetrics = this.initializeSafetyMetrics();
    }
    /**
     * Execute the conservative replacement pilot
     * Main entry point for Task 12.2
     */
    async executePilot() {
        console.log('üöÄ Starting Conservative Replacement Pilot...');
        console.log(`Configuration: ${this.config.maxFilesPerBatch} files per batch, ${this.config.maxBatches} max batches`);
        try {
            // Phase 1: Identify high-confidence cases
            const highConfidenceCases = await this.identifyHighConfidenceCases();
            console.log(`üìä Found ${highConfidenceCases.length} high-confidence cases`);
            if (highConfidenceCases.length === 0) {
                return this.createPilotResult(false, 'No high-confidence cases found for replacement');
            }
            // Phase 2: Execute batch processing
            const batchProcessingResult = await this.executeBatchProcessing(highConfidenceCases);
            // Phase 3: Validate integration with campaign infrastructure
            const integrationValidation = await this.validateCampaignIntegration();
            // Phase 4: Generate comprehensive results
            const pilotResult = this.createPilotResult(batchProcessingResult.success && integrationValidation.success, batchProcessingResult.success ? 'Pilot completed successfully' : batchProcessingResult.error);
            // Phase 5: Report results
            await this.generatePilotReport(pilotResult);
            return pilotResult;
        }
        catch (error) {
            const errorMessage = error instanceof Error ? error.message : String(error);
            console.error('‚ùå Conservative Replacement Pilot failed:', errorMessage);
            return this.createPilotResult(false, `Pilot execution failed: ${errorMessage}`);
        }
    }
    /**
     * Identify high-confidence cases for replacement
     * Focus on array types and simple Record types
     */
    async identifyHighConfidenceCases() {
        console.log('üîç Identifying high-confidence replacement cases...');
        const highConfidenceCases = [];
        try {
            // Get TypeScript files from the codebase
            const tsFiles = await this.getTypeScriptFiles();
            console.log(`üìÅ Analyzing ${tsFiles.length} TypeScript files`);
            let filesAnalyzed = 0;
            const maxFilesToAnalyze = 100; // Limit for pilot
            for (const filePath of tsFiles.slice(0, maxFilesToAnalyze)) {
                try {
                    const fileContent = fs.readFileSync(filePath, 'utf8');
                    const anyTypeOccurrences = this.findAnyTypeOccurrences(fileContent, filePath);
                    for (const occurrence of anyTypeOccurrences) {
                        const classification = await this.classifier.classify(occurrence.context);
                        // Focus on high-confidence, low-risk categories
                        if (this.isHighConfidenceCase(classification)) {
                            const replacement = this.createTypeReplacement(occurrence, classification);
                            if (replacement) {
                                highConfidenceCases.push(replacement);
                            }
                        }
                    }
                    filesAnalyzed++;
                    if (filesAnalyzed % 10 === 0) {
                        console.log(`üìä Analyzed ${filesAnalyzed} files, found ${highConfidenceCases.length} high-confidence cases`);
                    }
                }
                catch (error) {
                    console.warn(`‚ö†Ô∏è Failed to analyze file ${filePath}:`, error);
                    continue;
                }
            }
            // Sort by confidence score (highest first)
            highConfidenceCases.sort((a, b) => b.confidence - a.confidence);
            console.log(`‚úÖ Identified ${highConfidenceCases.length} high-confidence cases from ${filesAnalyzed} files`);
            return highConfidenceCases;
        }
        catch (error) {
            console.error('‚ùå Failed to identify high-confidence cases:', error);
            return [];
        }
    }
    /**
     * Execute batch processing with real-time validation
     */
    async executeBatchProcessing(cases) {
        console.log(`üîÑ Starting batch processing of ${cases.length} cases...`);
        let totalProcessed = 0;
        let totalSuccessful = 0;
        let totalFailed = 0;
        let batchNumber = 0;
        try {
            // Group cases by file to optimize processing
            const casesByFile = this.groupCasesByFile(cases);
            const fileGroups = Array.from(casesByFile.entries());
            while (totalProcessed < cases.length && batchNumber < this.config.maxBatches) {
                batchNumber++;
                console.log(`\nüì¶ Processing Batch ${batchNumber}...`);
                // Select files for this batch
                const batchFiles = this.selectBatchFiles(fileGroups, totalProcessed);
                const batchCases = batchFiles.flatMap(([_, fileCases]) => fileCases);
                if (batchCases.length === 0) {
                    console.log('‚ÑπÔ∏è No more cases to process');
                    break;
                }
                console.log(`üìä Batch ${batchNumber}: Processing ${batchCases.length} cases across ${batchFiles.length} files`);
                // Execute batch with real-time validation
                const batchResult = await this.executeBatch(batchCases, batchNumber);
                this.batchResults.push(batchResult);
                // Update totals
                totalProcessed += batchCases.length;
                totalSuccessful += batchResult.successfulReplacements;
                totalFailed += batchResult.failedReplacements;
                // Real-time validation and safety checks
                const validationResult = await this.performRealTimeValidation(batchResult);
                if (!validationResult.buildStable) {
                    console.error('‚ùå Build stability compromised, stopping pilot');
                    return {
                        success: false,
                        error: 'Build stability compromised during batch processing',
                        totalProcessed,
                        totalSuccessful,
                        totalFailed,
                        batchResults: this.batchResults
                    };
                }
                // Check success rate
                const currentSuccessRate = totalSuccessful / totalProcessed;
                console.log(`üìà Current success rate: ${(currentSuccessRate * 100).toFixed(1)}%`);
                if (currentSuccessRate < this.config.targetSuccessRate && batchNumber > 2) {
                    console.warn(`‚ö†Ô∏è Success rate ${(currentSuccessRate * 100).toFixed(1)}% below target ${(this.config.targetSuccessRate * 100).toFixed(1)}%`);
                    // Continue but with increased caution
                }
                // Brief pause between batches for system stability
                await new Promise(resolve => setTimeout(resolve, 1000));
            }
            const finalSuccessRate = totalSuccessful / totalProcessed;
            const success = finalSuccessRate >= this.config.targetSuccessRate && this.safetyMetrics.buildFailures === 0;
            console.log(`\n‚úÖ Batch processing completed:`);
            console.log(`   Total processed: ${totalProcessed}`);
            console.log(`   Successful: ${totalSuccessful}`);
            console.log(`   Failed: ${totalFailed}`);
            console.log(`   Success rate: ${(finalSuccessRate * 100).toFixed(1)}%`);
            console.log(`   Build failures: ${this.safetyMetrics.buildFailures}`);
            return {
                success,
                totalProcessed,
                totalSuccessful,
                totalFailed,
                batchResults: this.batchResults,
                finalSuccessRate
            };
        }
        catch (error) {
            console.error('‚ùå Batch processing failed:', error);
            return {
                success: false,
                error: error instanceof Error ? error.message : String(error),
                totalProcessed,
                totalSuccessful,
                totalFailed,
                batchResults: this.batchResults
            };
        }
    }
    /**
     * Execute a single batch with comprehensive safety monitoring
     */
    async executeBatch(cases, batchNumber) {
        const batchStartTime = new Date();
        console.log(`‚ö° Executing batch ${batchNumber} with ${cases.length} cases...`);
        try {
            // Pre-batch validation
            const preBatchValidation = await this.validateBuildStability();
            if (!preBatchValidation.buildSuccessful) {
                console.error('‚ùå Pre-batch build validation failed');
                this.safetyMetrics.buildFailures++;
                return {
                    batchNumber,
                    startTime: batchStartTime,
                    endTime: new Date(),
                    casesProcessed: 0,
                    successfulReplacements: 0,
                    failedReplacements: cases.length,
                    buildStable: false,
                    rollbackPerformed: false,
                    error: 'Pre-batch build validation failed'
                };
            }
            // Execute replacements
            const replacementResult = await this.replacer.processBatch(cases);
            // Post-batch validation
            const postBatchValidation = await this.validateBuildStability();
            const buildStable = postBatchValidation.buildSuccessful;
            if (!buildStable && this.config.rollbackOnFailure) {
                console.warn('‚ö†Ô∏è Post-batch build validation failed, performing rollback...');
                // The SafeTypeReplacer should have already performed rollback
                this.safetyMetrics.rollbacksPerformed++;
                this.safetyMetrics.buildFailures++;
            }
            // Update safety metrics
            this.updateSafetyMetrics(replacementResult, buildStable);
            const batchResult = {
                batchNumber,
                startTime: batchStartTime,
                endTime: new Date(),
                casesProcessed: cases.length,
                successfulReplacements: replacementResult.appliedReplacements.length,
                failedReplacements: replacementResult.failedReplacements.length,
                buildStable,
                rollbackPerformed: replacementResult.rollbackPerformed,
                compilationErrors: replacementResult.compilationErrors
            };
            console.log(`‚úÖ Batch ${batchNumber} completed: ${batchResult.successfulReplacements}/${batchResult.casesProcessed} successful`);
            return batchResult;
        }
        catch (error) {
            console.error(`‚ùå Batch ${batchNumber} execution failed:`, error);
            this.safetyMetrics.batchFailures++;
            return {
                batchNumber,
                startTime: batchStartTime,
                endTime: new Date(),
                casesProcessed: cases.length,
                successfulReplacements: 0,
                failedReplacements: cases.length,
                buildStable: false,
                rollbackPerformed: false,
                error: error instanceof Error ? error.message : String(error)
            };
        }
    }
    /**
     * Perform real-time validation after each batch
     */
    async performRealTimeValidation(batchResult) {
        console.log('üîç Performing real-time validation...');
        try {
            // Build stability check
            const buildValidation = await this.validateBuildStability();
            // TypeScript error count check
            const currentErrorCount = await this.getCurrentTypeScriptErrorCount();
            // Safety metrics check
            const safetyScore = this.calculateSafetyScore();
            const validationResult = {
                buildStable: buildValidation.buildSuccessful,
                typeScriptErrorCount: currentErrorCount,
                safetyScore,
                validationTime: new Date(),
                batchNumber: batchResult.batchNumber,
                warnings: []
            };
            // Add warnings based on validation results
            if (!buildValidation.buildSuccessful) {
                validationResult.warnings.push('Build compilation failed');
            }
            if (safetyScore < this.config.safetyThreshold) {
                validationResult.warnings.push(`Safety score ${safetyScore.toFixed(2)} below threshold ${this.config.safetyThreshold}`);
            }
            if (this.safetyMetrics.rollbacksPerformed > 0) {
                validationResult.warnings.push(`${this.safetyMetrics.rollbacksPerformed} rollbacks performed`);
            }
            console.log(`üìä Validation result: Build stable: ${validationResult.buildStable}, Safety score: ${safetyScore.toFixed(2)}`);
            return validationResult;
        }
        catch (error) {
            console.error('‚ùå Real-time validation failed:', error);
            return {
                buildStable: false,
                typeScriptErrorCount: -1,
                safetyScore: 0,
                validationTime: new Date(),
                batchNumber: batchResult.batchNumber,
                warnings: ['Validation process failed'],
                error: error instanceof Error ? error.message : String(error)
            };
        }
    }
    /**
     * Validate integration with existing campaign infrastructure
     */
    async validateCampaignIntegration() {
        console.log('üîó Validating campaign infrastructure integration...');
        try {
            // Test campaign integration
            const campaignValidation = await this.campaignIntegration.validateIntegration();
            if (!campaignValidation.success) {
                return { success: false, error: 'Campaign integration validation failed' };
            }
            // Test metrics integration
            const metricsValidation = await this.metricsIntegration.validateIntegration();
            if (!metricsValidation.success) {
                return { success: false, error: 'Metrics integration validation failed' };
            }
            // Test progressive engine integration
            const engineValidation = await this.progressiveEngine.validateConfiguration();
            if (!engineValidation.isValid) {
                return { success: false, error: 'Progressive engine validation failed' };
            }
            console.log('‚úÖ Campaign infrastructure integration validated successfully');
            return { success: true };
        }
        catch (error) {
            console.error('‚ùå Campaign integration validation failed:', error);
            return {
                success: false,
                error: error instanceof Error ? error.message : String(error)
            };
        }
    }
    /**
     * Generate comprehensive pilot report
     */
    async generatePilotReport(result) {
        console.log('üìÑ Generating pilot report...');
        const reportPath = '.kiro/campaign-reports/conservative-pilot';
        if (!fs.existsSync(reportPath)) {
            fs.mkdirSync(reportPath, { recursive: true });
        }
        // Generate detailed report
        const report = {
            pilotId: `conservative-pilot-${Date.now()}`,
            timestamp: new Date().toISOString(),
            configuration: this.config,
            results: result,
            batchResults: this.batchResults,
            safetyMetrics: this.safetyMetrics,
            executionTime: new Date().getTime() - this.pilotStartTime.getTime(),
            recommendations: this.generateRecommendations(result)
        };
        // Save JSON report
        const jsonReportPath = path.join(reportPath, 'pilot-report.json');
        fs.writeFileSync(jsonReportPath, JSON.stringify(report, null, 2));
        // Save markdown summary
        const markdownReportPath = path.join(reportPath, 'pilot-summary.md');
        const markdownContent = this.generateMarkdownReport(report);
        fs.writeFileSync(markdownReportPath, markdownContent);
        console.log(`üìä Pilot report saved to ${reportPath}`);
    }
    // Helper Methods
    async getTypeScriptFiles() {
        try {
            const output = (0, child_process_1.execSync)('find src -name "*.ts" -o -name "*.tsx" | grep -v __tests__ | grep -v .test. | head -200', {
                encoding: 'utf8',
                stdio: 'pipe'
            });
            return output.trim().split('\n').filter(file => file.trim());
        }
        catch (error) {
            console.warn('Failed to get TypeScript files, using fallback method');
            return this.getFallbackTypeScriptFiles();
        }
    }
    getFallbackTypeScriptFiles() {
        // Fallback method to get TypeScript files
        const files = [];
        const srcDir = 'src';
        if (fs.existsSync(srcDir)) {
            const walkDir = (dir) => {
                const items = fs.readdirSync(dir);
                for (const item of items) {
                    const fullPath = path.join(dir, item);
                    const stat = fs.statSync(fullPath);
                    if (stat.isDirectory() && !item.includes('__tests__') && !item.includes('node_modules')) {
                        walkDir(fullPath);
                    }
                    else if (stat.isFile() && (item.endsWith('.ts') || item.endsWith('.tsx')) && !item.includes('.test.')) {
                        files.push(fullPath);
                    }
                }
            };
            walkDir(srcDir);
        }
        return files.slice(0, 100); // Limit for pilot
    }
    findAnyTypeOccurrences(content, filePath) {
        const lines = content.split('\n');
        const occurrences = [];
        for (let i = 0; i < lines.length; i++) {
            const line = lines[i];
            // Look for any[] patterns
            if (line.includes('any[]')) {
                occurrences.push({
                    context: {
                        filePath,
                        lineNumber: i + 1,
                        codeSnippet: line.trim(),
                        surroundingLines: this.getSurroundingLines(lines, i),
                        hasExistingComment: this.hasCommentAbove(lines, i),
                        isInTestFile: filePath.includes('.test.') || filePath.includes('__tests__'),
                        domainContext: { domain: this.inferDomain(filePath) }
                    },
                    lineNumber: i + 1
                });
            }
            // Look for Record<string, any> patterns
            if (line.includes('Record<string, any>')) {
                occurrences.push({
                    context: {
                        filePath,
                        lineNumber: i + 1,
                        codeSnippet: line.trim(),
                        surroundingLines: this.getSurroundingLines(lines, i),
                        hasExistingComment: this.hasCommentAbove(lines, i),
                        isInTestFile: filePath.includes('.test.') || filePath.includes('__tests__'),
                        domainContext: { domain: this.inferDomain(filePath) }
                    },
                    lineNumber: i + 1
                });
            }
        }
        return occurrences;
    }
    getSurroundingLines(lines, index, context = 2) {
        const start = Math.max(0, index - context);
        const end = Math.min(lines.length, index + context + 1);
        return lines.slice(start, end);
    }
    hasCommentAbove(lines, index) {
        if (index > 0) {
            const previousLine = lines[index - 1].trim();
            return previousLine.startsWith('//') || previousLine.startsWith('/*');
        }
        return false;
    }
    inferDomain(filePath) {
        if (filePath.includes('astro') || filePath.includes('planet') || filePath.includes('calculation')) {
            return 'astrological';
        }
        if (filePath.includes('recipe') || filePath.includes('ingredient') || filePath.includes('food')) {
            return 'recipe';
        }
        if (filePath.includes('campaign') || filePath.includes('intelligence')) {
            return 'campaign';
        }
        if (filePath.includes('service') || filePath.includes('api')) {
            return 'service';
        }
        return 'utility';
    }
    isHighConfidenceCase(classification) {
        // Focus on specific categories for conservative pilot
        if (!this.config.focusCategories.includes(classification.category)) {
            return false;
        }
        // High confidence threshold
        if (classification.confidence < 0.8) {
            return false;
        }
        // Must be classified as unintentional
        if (classification.isIntentional) {
            return false;
        }
        // Additional safety checks
        if (classification.category === types_1.AnyTypeCategory.ARRAY_TYPE) {
            return true; // Array types are very safe
        }
        if (classification.category === types_1.AnyTypeCategory.RECORD_TYPE) {
            // Only simple Record types
            return classification.suggestedReplacement?.includes('unknown') || false;
        }
        return false;
    }
    createTypeReplacement(occurrence, classification) {
        if (!classification.suggestedReplacement) {
            return null;
        }
        let original;
        let replacement;
        if (classification.category === types_1.AnyTypeCategory.ARRAY_TYPE) {
            original = 'any[]';
            replacement = 'unknown[]';
        }
        else if (classification.category === types_1.AnyTypeCategory.RECORD_TYPE) {
            original = 'Record<string, any>';
            replacement = 'Record<string, unknown>';
        }
        else {
            return null;
        }
        return {
            original,
            replacement,
            filePath: occurrence.context.filePath,
            lineNumber: occurrence.lineNumber,
            confidence: classification.confidence,
            validationRequired: true
        };
    }
    groupCasesByFile(cases) {
        const grouped = new Map();
        for (const case_ of cases) {
            if (!grouped.has(case_.filePath)) {
                grouped.set(case_.filePath, []);
            }
            grouped.get(case_.filePath).push(case_);
        }
        return grouped;
    }
    selectBatchFiles(fileGroups, processedCount) {
        const remainingFiles = fileGroups.filter(([_, cases]) => cases.some(c => !this.isProcessed(c, processedCount)));
        // Select files to fit within batch size limits
        const selectedFiles = [];
        let totalCases = 0;
        for (const [filePath, cases] of remainingFiles) {
            const unprocessedCases = cases.filter(c => !this.isProcessed(c, processedCount));
            if (totalCases + unprocessedCases.length <= this.config.maxFilesPerBatch) {
                selectedFiles.push([filePath, unprocessedCases]);
                totalCases += unprocessedCases.length;
            }
            if (selectedFiles.length >= this.config.maxFilesPerBatch || totalCases >= this.config.maxFilesPerBatch) {
                break;
            }
        }
        return selectedFiles;
    }
    isProcessed(case_, processedCount) {
        // Simple tracking - in a real implementation, this would be more sophisticated
        return false; // For now, assume no cases are pre-processed
    }
    async validateBuildStability() {
        try {
            (0, child_process_1.execSync)('yarn tsc --noEmit --skipLibCheck', {
                stdio: 'pipe',
                timeout: 30000
            });
            return { buildSuccessful: true };
        }
        catch (error) {
            return {
                buildSuccessful: false,
                errors: [error instanceof Error ? error.message : String(error)]
            };
        }
    }
    async getCurrentTypeScriptErrorCount() {
        try {
            const output = (0, child_process_1.execSync)('yarn tsc --noEmit --skipLibCheck 2>&1 | grep -c "error TS" || echo "0"', {
                encoding: 'utf8',
                stdio: 'pipe'
            });
            return parseInt(output.trim()) || 0;
        }
        catch (error) {
            return -1; // Error in getting count
        }
    }
    initializeSafetyMetrics() {
        return {
            buildFailures: 0,
            rollbacksPerformed: 0,
            batchFailures: 0,
            compilationErrors: 0,
            safetyProtocolActivations: 0
        };
    }
    updateSafetyMetrics(result, buildStable) {
        if (!buildStable) {
            this.safetyMetrics.buildFailures++;
        }
        if (result.rollbackPerformed) {
            this.safetyMetrics.rollbacksPerformed++;
        }
        if (result.compilationErrors.length > 0) {
            this.safetyMetrics.compilationErrors += result.compilationErrors.length;
        }
    }
    calculateSafetyScore() {
        const totalBatches = this.batchResults.length;
        if (totalBatches === 0)
            return 1.0;
        const successfulBatches = this.batchResults.filter(b => b.buildStable && !b.rollbackPerformed).length;
        const baseScore = successfulBatches / totalBatches;
        // Penalize for safety issues
        const penalties = (this.safetyMetrics.buildFailures * 0.2 +
            this.safetyMetrics.rollbacksPerformed * 0.1 +
            this.safetyMetrics.batchFailures * 0.15);
        return Math.max(0, baseScore - penalties);
    }
    createPilotResult(success, message) {
        const totalProcessed = this.batchResults.reduce((sum, batch) => sum + batch.casesProcessed, 0);
        const totalSuccessful = this.batchResults.reduce((sum, batch) => sum + batch.successfulReplacements, 0);
        const successRate = totalProcessed > 0 ? totalSuccessful / totalProcessed : 0;
        return {
            success,
            message,
            pilotStartTime: this.pilotStartTime,
            pilotEndTime: new Date(),
            totalCasesProcessed: totalProcessed,
            totalSuccessfulReplacements: totalSuccessful,
            successRate,
            batchesExecuted: this.batchResults.length,
            buildFailures: this.safetyMetrics.buildFailures,
            rollbacksPerformed: this.safetyMetrics.rollbacksPerformed,
            safetyScore: this.calculateSafetyScore(),
            targetAchieved: successRate >= this.config.targetSuccessRate && this.safetyMetrics.buildFailures === 0,
            batchResults: this.batchResults,
            safetyMetrics: this.safetyMetrics
        };
    }
    generateRecommendations(result) {
        const recommendations = [];
        if (result.successRate < this.config.targetSuccessRate) {
            recommendations.push(`Success rate ${(result.successRate * 100).toFixed(1)}% below target ${(this.config.targetSuccessRate * 100).toFixed(1)}%. Consider more conservative classification thresholds.`);
        }
        if (result.buildFailures > 0) {
            recommendations.push(`${result.buildFailures} build failures occurred. Review failed cases and improve safety validation.`);
        }
        if (result.rollbacksPerformed > 0) {
            recommendations.push(`${result.rollbacksPerformed} rollbacks performed. Analyze rollback causes to improve replacement strategies.`);
        }
        if (result.safetyScore < this.config.safetyThreshold) {
            recommendations.push(`Safety score ${result.safetyScore.toFixed(2)} below threshold. Implement additional safety measures before full campaign.`);
        }
        if (result.targetAchieved) {
            recommendations.push('Pilot successful! Ready to proceed to full campaign execution (Task 12.3).');
        }
        else {
            recommendations.push('Pilot did not meet all targets. Review results and adjust strategy before full campaign.');
        }
        return recommendations;
    }
    generateMarkdownReport(report) {
        return `# Conservative Replacement Pilot Report

## Executive Summary

**Pilot Status**: ${report.results.success ? '‚úÖ SUCCESS' : '‚ùå FAILED'}
**Execution Time**: ${Math.round(report.executionTime / 1000)}s
**Target Achievement**: ${report.results.targetAchieved ? '‚úÖ YES' : '‚ùå NO'}

## Key Metrics

- **Cases Processed**: ${report.results.totalCasesProcessed}
- **Successful Replacements**: ${report.results.totalSuccessfulReplacements}
- **Success Rate**: ${(report.results.successRate * 100).toFixed(1)}% (Target: ${(report.configuration.targetSuccessRate * 100).toFixed(1)}%)
- **Batches Executed**: ${report.results.batchesExecuted}
- **Build Failures**: ${report.results.buildFailures} (Target: 0)
- **Rollbacks Performed**: ${report.results.rollbacksPerformed}
- **Safety Score**: ${report.results.safetyScore.toFixed(2)} (Threshold: ${report.configuration.safetyThreshold})

## Batch Results

${report.batchResults.map((batch, index) => `
### Batch ${batch.batchNumber}
- **Cases**: ${batch.casesProcessed}
- **Successful**: ${batch.successfulReplacements}
- **Failed**: ${batch.failedReplacements}
- **Build Stable**: ${batch.buildStable ? '‚úÖ' : '‚ùå'}
- **Rollback**: ${batch.rollbackPerformed ? '‚ö†Ô∏è YES' : '‚úÖ NO'}
`).join('')}

## Safety Metrics

- **Build Failures**: ${report.safetyMetrics.buildFailures}
- **Rollbacks Performed**: ${report.safetyMetrics.rollbacksPerformed}
- **Batch Failures**: ${report.safetyMetrics.batchFailures}
- **Compilation Errors**: ${report.safetyMetrics.compilationErrors}

## Recommendations

${report.recommendations.map((rec) => `- ${rec}`).join('\n')}

## Configuration

\`\`\`json
${JSON.stringify(report.configuration, null, 2)}
\`\`\`

---
*Report generated on ${new Date().toISOString()}*
`;
    }
}
exports.ConservativeReplacementPilot = ConservativeReplacementPilot;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9zZXJ2aWNlcy9jYW1wYWlnbi91bmludGVudGlvbmFsLWFueS1lbGltaW5hdGlvbi9Db25zZXJ2YXRpdmVSZXBsYWNlbWVudFBpbG90LnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7Ozs7Ozs7R0FXRzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFSCxpREFBeUM7QUFDekMsdUNBQXlCO0FBQ3pCLDJDQUE2QjtBQUU3QiwyREFBd0Q7QUFDeEQsK0RBQTREO0FBQzVELDZEQUEwRDtBQUMxRCxpRkFBOEU7QUFDOUUseURBQXNEO0FBQ3RELG1DQVVpQjtBQUVqQixNQUFhLDRCQUE0QjtJQUMvQixVQUFVLENBQW9CO0lBQzlCLFFBQVEsQ0FBbUI7SUFDM0IsaUJBQWlCLENBQStCO0lBQ2hELG1CQUFtQixDQUFzQjtJQUN6QyxrQkFBa0IsQ0FBcUI7SUFDdkMsTUFBTSxDQUEwQjtJQUNoQyxjQUFjLENBQU87SUFDckIsWUFBWSxHQUE0QixFQUFFLENBQUM7SUFDM0MsYUFBYSxDQUFnQjtJQUVyQyxZQUFZLFNBQTJDLEVBQUU7UUFDdkQsSUFBSSxDQUFDLE1BQU0sR0FBRztZQUNaLGdCQUFnQixFQUFFLEVBQUU7WUFDcEIsZ0JBQWdCLEVBQUUsRUFBRTtZQUNwQixpQkFBaUIsRUFBRSxHQUFHO1lBQ3RCLFVBQVUsRUFBRSxFQUFFO1lBQ2Qsa0JBQWtCLEVBQUUsSUFBSTtZQUN4QixpQkFBaUIsRUFBRSxJQUFJO1lBQ3ZCLGVBQWUsRUFBRSxHQUFHO1lBQ3BCLGVBQWUsRUFBRSxDQUFDLHVCQUFlLENBQUMsVUFBVSxFQUFFLHVCQUFlLENBQUMsV0FBVyxDQUFDO1lBQzFFLHdCQUF3QixFQUFFLENBQUM7WUFDM0IsR0FBRyxNQUFNO1NBQ1YsQ0FBQztRQUVGLElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxxQ0FBaUIsRUFBRSxDQUFDO1FBQzFDLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxtQ0FBZ0IsQ0FDbEMs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QUMsaUJBQWlCLENBQUMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsTUFBTTtDQUM1RCxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQzs7Ozt3QkFJYSxNQUFNLENBQUMsYUFBYSxDQUFDLGFBQWE7NkJBQzdCLE1BQU0sQ0FBQyxhQUFhLENBQUMsa0JBQWtCO3dCQUM1QyxNQUFNLENBQUMsYUFBYSxDQUFDLGFBQWE7NEJBQzlCLE1BQU0sQ0FBQyxhQUFhLENBQUMsaUJBQWlCOzs7O0VBSWhFLE1BQU0sQ0FBQyxlQUFlLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBVyxFQUFFLEVBQUUsQ0FBQyxLQUFLLEdBQUcsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQzs7Ozs7RUFLbEUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsYUFBYSxFQUFFLElBQUksRUFBRSxDQUFDLENBQUM7Ozs7dUJBSXhCLElBQUksSUFBSSxFQUFFLENBQUMsV0FBVyxFQUFFO0NBQzlDLENBQUM7SUFDQSxDQUFDO0NBQ0Y7QUEzekJELG9FQTJ6QkMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9zZXJ2aWNlcy9jYW1wYWlnbi91bmludGVudGlvbmFsLWFueS1lbGltaW5hdGlvbi9Db25zZXJ2YXRpdmVSZXBsYWNlbWVudFBpbG90LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29uc2VydmF0aXZlIFJlcGxhY2VtZW50IFBpbG90XG4gKiBFeGVjdXRlcyBsaW1pdGVkIGJhdGNoIHByb2Nlc3Npbmcgb24gaGlnaC1jb25maWRlbmNlIGNhc2VzIHdpdGggcmVhbC10aW1lIHZhbGlkYXRpb25cbiAqXG4gKiBUYXNrIDEyLjIgSW1wbGVtZW50YXRpb246XG4gKiAtIFJ1biBsaW1pdGVkIGJhdGNoIHByb2Nlc3Npbmcgb24gaGlnaC1jb25maWRlbmNlIGNhc2VzICgxMC0xNSBmaWxlcyBwZXIgYmF0Y2gpXG4gKiAtIEZvY3VzIG9uIGFycmF5IHR5cGVzIChhbnlbXSDihpIgdW5rbm93bltdKSBhbmQgc2ltcGxlIFJlY29yZCB0eXBlc1xuICogLSBNb25pdG9yIGJ1aWxkIHN0YWJpbGl0eSBhbmQgcm9sbGJhY2sgZnJlcXVlbmN5IHdpdGggcmVhbC10aW1lIHZhbGlkYXRpb25cbiAqIC0gQ29sbGVjdCBzdWNjZXNzIHJhdGUgbWV0cmljcyBhbmQgc2FmZXR5IHByb3RvY29sIGVmZmVjdGl2ZW5lc3NcbiAqIC0gVmFsaWRhdGUgaW50ZWdyYXRpb24gd2l0aCBleGlzdGluZyBjYW1wYWlnbiBpbmZyYXN0cnVjdHVyZVxuICogLSBUYXJnZXQgPjgwJSBzdWNjZXNzZnVsIHJlcGxhY2VtZW50cyB3aXRoIHplcm8gYnVpbGQgZmFpbHVyZXNcbiAqL1xuXG5pbXBvcnQgeyBleGVjU3luYyB9IGZyb20gJ2NoaWxkX3Byb2Nlc3MnO1xuaW1wb3J0ICogYXMgZnMgZnJvbSAnZnMnO1xuaW1wb3J0ICogYXMgcGF0aCBmcm9tICdwYXRoJztcblxuaW1wb3J0IHsgQW55VHlwZUNsYXNzaWZpZXIgfSBmcm9tICcuL0FueVR5cGVDbGFzc2lmaWVyJztcbmltcG9ydCB7IENhbXBhaWduSW50ZWdyYXRpb24gfSBmcm9tICcuL0NhbXBhaWduSW50ZWdyYXRpb24nO1xuaW1wb3J0IHsgTWV0cmljc0ludGVncmF0aW9uIH0gZnJvbSAnLi9NZXRyaWNzSW50ZWdyYXRpb24nO1xuaW1wb3J0IHsgUHJvZ3Jlc3NpdmVJbXByb3ZlbWVudEVuZ2luZSB9IGZyb20gJy4vUHJvZ3Jlc3NpdmVJbXByb3ZlbWVudEVuZ2luZSc7XG5pbXBvcnQgeyBTYWZlVHlwZVJlcGxhY2VyIH0gZnJvbSAnLi9TYWZlVHlwZVJlcGxhY2VyJztcbmltcG9ydCB7XG4gICAgQW55VHlwZUNhdGVnb3J5LFxuICAgIEFueVR5cGVDbGFzc2lmaWNhdGlvbixcbiAgICBCYXRjaFByb2Nlc3NpbmdSZXN1bHQsXG4gICAgQ29uc2VydmF0aXZlUGlsb3RDb25maWcsXG4gICAgQ29uc2VydmF0aXZlUGlsb3RSZXN1bHQsXG4gICAgUmVhbFRpbWVWYWxpZGF0aW9uUmVzdWx0LFxuICAgIFJlcGxhY2VtZW50UmVzdWx0LFxuICAgIFNhZmV0eU1ldHJpY3MsXG4gICAgVHlwZVJlcGxhY2VtZW50XG59IGZyb20gJy4vdHlwZXMnO1xuXG5leHBvcnQgY2xhc3MgQ29uc2VydmF0aXZlUmVwbGFjZW1lbnRQaWxvdCB7XG4gIHByaXZhdGUgY2xhc3NpZmllcjogQW55VHlwZUNsYXNzaWZpZXI7XG4gIHByaXZhdGUgcmVwbGFjZXI6IFNhZmVUeXBlUmVwbGFjZXI7XG4gIHByaXZhdGUgcHJvZ3Jlc3NpdmVFbmdpbmU6IFByb2dyZXNzaXZlSW1wcm92ZW1lbnRFbmdpbmU7XG4gIHByaXZhdGUgY2FtcGFpZ25JbnRlZ3JhdGlvbjogQ2FtcGFpZ25JbnRlZ3JhdGlvbjtcbiAgcHJpdmF0ZSBtZXRyaWNzSW50ZWdyYXRpb246IE1ldHJpY3NJbnRlZ3JhdGlvbjtcbiAgcHJpdmF0ZSBjb25maWc6IENvbnNlcnZhdGl2ZVBpbG90Q29uZmlnO1xuICBwcml2YXRlIHBpbG90U3RhcnRUaW1lOiBEYXRlO1xuICBwcml2YXRlIGJhdGNoUmVzdWx0czogQmF0Y2hQcm9jZXNzaW5nUmVzdWx0W10gPSBbXTtcbiAgcHJpdmF0ZSBzYWZldHlNZXRyaWNzOiBTYWZldHlNZXRyaWNzO1xuXG4gIGNvbnN0cnVjdG9yKGNvbmZpZzogUGFydGlhbDxDb25zZXJ2YXRpdmVQaWxvdENvbmZpZz4gPSB7fSkge1xuICAgIHRoaXMuY29uZmlnID0ge1xuICAgICAgbWF4RmlsZXNQZXJCYXRjaDogMTUsXG4gICAgICBtaW5GaWxlc1BlckJhdGNoOiAxMCxcbiAgICAgIHRhcmdldFN1Y2Nlc3NSYXRlOiAwLjgsXG4gICAgICBtYXhCYXRjaGVzOiAxMCxcbiAgICAgIHJlYWxUaW1lVmFsaWRhdGlvbjogdHJ1ZSxcbiAgICAgIHJvbGxiYWNrT25GYWlsdXJlOiB0cnVlLFxuICAgICAgc2FmZXR5VGhyZXNob2xkOiAwLjcsXG4gICAgICBmb2N1c0NhdGVnb3JpZXM6IFtBbnlUeXBlQ2F0ZWdvcnkuQVJSQVlfVFlQRSwgQW55VHlwZUNhdGVnb3J5LlJFQ09SRF9UWVBFXSxcbiAgICAgIGJ1aWxkVmFsaWRhdGlvbkZyZXF1ZW5jeTogMSwgLy8gVmFsaWRhdGUgYWZ0ZXIgZXZlcnkgYmF0Y2hcbiAgICAgIC4uLmNvbmZpZ1xuICAgIH07XG5cbiAgICB0aGlzLmNsYXNzaWZpZXIgPSBuZXcgQW55VHlwZUNsYXNzaWZpZXIoKTtcbiAgICB0aGlzLnJlcGxhY2VyID0gbmV3IFNhZmVUeXBlUmVwbGFjZXIoXG4gICAgICAnLi8uY29uc2VydmF0aXZlLXBpbG90LWJhY2t1cHMnLFxuICAgICAgdGhpcy5jb25maWcuc2FmZXR5VGhyZXNob2xkXG4gICAgKTtcbiAgICB0aGlzLnByb2dyZXNzaXZlRW5naW5lID0gbmV3IFByb2dyZXNzaXZlSW1wcm92ZW1lbnRFbmdpbmUoKTtcbiAgICB0aGlzLmNhbXBhaWduSW50ZWdyYXRpb24gPSBuZXcgQ2FtcGFpZ25JbnRlZ3JhdGlvbigpO1xuICAgIHRoaXMubWV0cmljc0ludGVncmF0aW9uID0gbmV3IE1ldHJpY3NJbnRlZ3JhdGlvbigpO1xuICAgIHRoaXMucGlsb3RTdGFydFRpbWUgPSBuZXcgRGF0ZSgpO1xuICAgIHRoaXMuc2FmZXR5TWV0cmljcyA9IHRoaXMuaW5pdGlhbGl6ZVNhZmV0eU1ldHJpY3MoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBFeGVjdXRlIHRoZSBjb25zZXJ2YXRpdmUgcmVwbGFjZW1lbnQgcGlsb3RcbiAgICogTWFpbiBlbnRyeSBwb2ludCBmb3IgVGFzayAxMi4yXG4gICAqL1xuICBhc3luYyBleGVjdXRlUGlsb3QoKTogUHJvbWlzZTxDb25zZXJ2YXRpdmVQaWxvdFJlc3VsdD4ge1xuICAgIGNvbnNvbGUubG9nKCfwn5qAIFN0YXJ0aW5nIENvbnNlcnZhdGl2ZSBSZXBsYWNlbWVudCBQaWxvdC4uLicpO1xuICAgIGNvbnNvbGUubG9nKGBDb25maWd1cmF0aW9uOiAke3RoaXMuY29uZmlnLm1heEZpbGVzUGVyQmF0Y2h9IGZpbGVzIHBlciBiYXRjaCwgJHt0aGlzLmNvbmZpZy5tYXhCYXRjaGVzfSBtYXggYmF0Y2hlc2ApO1xuXG4gICAgdHJ5IHtcbiAgICAgIC8vIFBoYXNlIDE6IElkZW50aWZ5IGhpZ2gtY29uZmlkZW5jZSBjYXNlc1xuICAgICAgY29uc3QgaGlnaENvbmZpZGVuY2VDYXNlcyA9IGF3YWl0IHRoaXMuaWRlbnRpZnlIaWdoQ29uZmlkZW5jZUNhc2VzKCk7XG4gICAgICBjb25zb2xlLmxvZyhg8J+TiiBGb3VuZCAke2hpZ2hDb25maWRlbmNlQ2FzZXMubGVuZ3RofSBoaWdoLWNvbmZpZGVuY2UgY2FzZXNgKTtcblxuICAgICAgaWYgKGhpZ2hDb25maWRlbmNlQ2FzZXMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmNyZWF0ZVBpbG90UmVzdWx0KGZhbHNlLCAnTm8gaGlnaC1jb25maWRlbmNlIGNhc2VzIGZvdW5kIGZvciByZXBsYWNlbWVudCcpO1xuICAgICAgfVxuXG4gICAgICAvLyBQaGFzZSAyOiBFeGVjdXRlIGJhdGNoIHByb2Nlc3NpbmdcbiAgICAgIGNvbnN0IGJhdGNoUHJvY2Vzc2luZ1Jlc3VsdCA9IGF3YWl0IHRoaXMuZXhlY3V0ZUJhdGNoUHJvY2Vzc2luZyhoaWdoQ29uZmlkZW5jZUNhc2VzKTtcblxuICAgICAgLy8gUGhhc2UgMzogVmFsaWRhdGUgaW50ZWdyYXRpb24gd2l0aCBjYW1wYWlnbiBpbmZyYXN0cnVjdHVyZVxuICAgICAgY29uc3QgaW50ZWdyYXRpb25WYWxpZGF0aW9uID0gYXdhaXQgdGhpcy52YWxpZGF0ZUNhbXBhaWduSW50ZWdyYXRpb24oKTtcblxuICAgICAgLy8gUGhhc2UgNDogR2VuZXJhdGUgY29tcHJlaGVuc2l2ZSByZXN1bHRzXG4gICAgICBjb25zdCBwaWxvdFJlc3VsdCA9IHRoaXMuY3JlYXRlUGlsb3RSZXN1bHQoXG4gICAgICAgIGJhdGNoUHJvY2Vzc2luZ1Jlc3VsdC5zdWNjZXNzICYmIGludGVncmF0aW9uVmFsaWRhdGlvbi5zdWNjZXNzLFxuICAgICAgICBiYXRjaFByb2Nlc3NpbmdSZXN1bHQuc3VjY2VzcyA/ICdQaWxvdCBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5JyA6IGJhdGNoUHJvY2Vzc2luZ1Jlc3VsdC5lcnJvclxuICAgICAgKTtcblxuICAgICAgLy8gUGhhc2UgNTogUmVwb3J0IHJlc3VsdHNcbiAgICAgIGF3YWl0IHRoaXMuZ2VuZXJhdGVQaWxvdFJlcG9ydChwaWxvdFJlc3VsdCk7XG5cbiAgICAgIHJldHVybiBwaWxvdFJlc3VsdDtcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zdCBlcnJvck1lc3NhZ2UgPSBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IFN0cmluZyhlcnJvcik7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgQ29uc2VydmF0aXZlIFJlcGxhY2VtZW50IFBpbG90IGZhaWxlZDonLCBlcnJvck1lc3NhZ2UpO1xuXG4gICAgICByZXR1cm4gdGhpcy5jcmVhdGVQaWxvdFJlc3VsdChmYWxzZSwgYFBpbG90IGV4ZWN1dGlvbiBmYWlsZWQ6ICR7ZXJyb3JNZXNzYWdlfWApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBJZGVudGlmeSBoaWdoLWNvbmZpZGVuY2UgY2FzZXMgZm9yIHJlcGxhY2VtZW50XG4gICAqIEZvY3VzIG9uIGFycmF5IHR5cGVzIGFuZCBzaW1wbGUgUmVjb3JkIHR5cGVzXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGlkZW50aWZ5SGlnaENvbmZpZGVuY2VDYXNlcygpOiBQcm9taXNlPFR5cGVSZXBsYWNlbWVudFtdPiB7XG4gICAgY29uc29sZS5sb2coJ/CflI0gSWRlbnRpZnlpbmcgaGlnaC1jb25maWRlbmNlIHJlcGxhY2VtZW50IGNhc2VzLi4uJyk7XG5cbiAgICBjb25zdCBoaWdoQ29uZmlkZW5jZUNhc2VzOiBUeXBlUmVwbGFjZW1lbnRbXSA9IFtdO1xuXG4gICAgdHJ5IHtcbiAgICAgIC8vIEdldCBUeXBlU2NyaXB0IGZpbGVzIGZyb20gdGhlIGNvZGViYXNlXG4gICAgICBjb25zdCB0c0ZpbGVzID0gYXdhaXQgdGhpcy5nZXRUeXBlU2NyaXB0RmlsZXMoKTtcbiAgICAgIGNvbnNvbGUubG9nKGDwn5OBIEFuYWx5emluZyAke3RzRmlsZXMubGVuZ3RofSBUeXBlU2NyaXB0IGZpbGVzYCk7XG5cbiAgICAgIGxldCBmaWxlc0FuYWx5emVkID0gMDtcbiAgICAgIGNvbnN0IG1heEZpbGVzVG9BbmFseXplID0gMTAwOyAvLyBMaW1pdCBmb3IgcGlsb3RcblxuICAgICAgZm9yIChjb25zdCBmaWxlUGF0aCBvZiB0c0ZpbGVzLnNsaWNlKDAsIG1heEZpbGVzVG9BbmFseXplKSkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IGZpbGVDb250ZW50ID0gZnMucmVhZEZpbGVTeW5jKGZpbGVQYXRoLCAndXRmOCcpO1xuICAgICAgICAgIGNvbnN0IGFueVR5cGVPY2N1cnJlbmNlcyA9IHRoaXMuZmluZEFueVR5cGVPY2N1cnJlbmNlcyhmaWxlQ29udGVudCwgZmlsZVBhdGgpO1xuXG4gICAgICAgICAgZm9yIChjb25zdCBvY2N1cnJlbmNlIG9mIGFueVR5cGVPY2N1cnJlbmNlcykge1xuICAgICAgICAgICAgY29uc3QgY2xhc3NpZmljYXRpb24gPSBhd2FpdCB0aGlzLmNsYXNzaWZpZXIuY2xhc3NpZnkob2NjdXJyZW5jZS5jb250ZXh0KTtcblxuICAgICAgICAgICAgLy8gRm9jdXMgb24gaGlnaC1jb25maWRlbmNlLCBsb3ctcmlzayBjYXRlZ29yaWVzXG4gICAgICAgICAgICBpZiAodGhpcy5pc0hpZ2hDb25maWRlbmNlQ2FzZShjbGFzc2lmaWNhdGlvbikpIHtcbiAgICAgICAgICAgICAgY29uc3QgcmVwbGFjZW1lbnQgPSB0aGlzLmNyZWF0ZVR5cGVSZXBsYWNlbWVudChvY2N1cnJlbmNlLCBjbGFzc2lmaWNhdGlvbik7XG4gICAgICAgICAgICAgIGlmIChyZXBsYWNlbWVudCkge1xuICAgICAgICAgICAgICAgIGhpZ2hDb25maWRlbmNlQ2FzZXMucHVzaChyZXBsYWNlbWVudCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG5cbiAgICAgICAgICBmaWxlc0FuYWx5emVkKys7XG4gICAgICAgICAgaWYgKGZpbGVzQW5hbHl6ZWQgJSAxMCA9PT0gMCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coYPCfk4ogQW5hbHl6ZWQgJHtmaWxlc0FuYWx5emVkfSBmaWxlcywgZm91bmQgJHtoaWdoQ29uZmlkZW5jZUNhc2VzLmxlbmd0aH0gaGlnaC1jb25maWRlbmNlIGNhc2VzYCk7XG4gICAgICAgICAgfVxuXG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS53YXJuKGDimqDvuI8gRmFpbGVkIHRvIGFuYWx5emUgZmlsZSAke2ZpbGVQYXRofTpgLCBlcnJvcik7XG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gU29ydCBieSBjb25maWRlbmNlIHNjb3JlIChoaWdoZXN0IGZpcnN0KVxuICAgICAgaGlnaENvbmZpZGVuY2VDYXNlcy5zb3J0KChhLCBiKSA9PiBiLmNvbmZpZGVuY2UgLSBhLmNvbmZpZGVuY2UpO1xuXG4gICAgICBjb25zb2xlLmxvZyhg4pyFIElkZW50aWZpZWQgJHtoaWdoQ29uZmlkZW5jZUNhc2VzLmxlbmd0aH0gaGlnaC1jb25maWRlbmNlIGNhc2VzIGZyb20gJHtmaWxlc0FuYWx5emVkfSBmaWxlc2ApO1xuICAgICAgcmV0dXJuIGhpZ2hDb25maWRlbmNlQ2FzZXM7XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIEZhaWxlZCB0byBpZGVudGlmeSBoaWdoLWNvbmZpZGVuY2UgY2FzZXM6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBFeGVjdXRlIGJhdGNoIHByb2Nlc3Npbmcgd2l0aCByZWFsLXRpbWUgdmFsaWRhdGlvblxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBleGVjdXRlQmF0Y2hQcm9jZXNzaW5nKGNhc2VzOiBUeXBlUmVwbGFjZW1lbnRbXSk6IFByb21pc2U8QmF0Y2hQcm9jZXNzaW5nUmVzdWx0PiB7XG4gICAgY29uc29sZS5sb2coYPCflIQgU3RhcnRpbmcgYmF0Y2ggcHJvY2Vzc2luZyBvZiAke2Nhc2VzLmxlbmd0aH0gY2FzZXMuLi5gKTtcblxuICAgIGxldCB0b3RhbFByb2Nlc3NlZCA9IDA7XG4gICAgbGV0IHRvdGFsU3VjY2Vzc2Z1bCA9IDA7XG4gICAgbGV0IHRvdGFsRmFpbGVkID0gMDtcbiAgICBsZXQgYmF0Y2hOdW1iZXIgPSAwO1xuXG4gICAgdHJ5IHtcbiAgICAgIC8vIEdyb3VwIGNhc2VzIGJ5IGZpbGUgdG8gb3B0aW1pemUgcHJvY2Vzc2luZ1xuICAgICAgY29uc3QgY2FzZXNCeUZpbGUgPSB0aGlzLmdyb3VwQ2FzZXNCeUZpbGUoY2FzZXMpO1xuICAgICAgY29uc3QgZmlsZUdyb3VwcyA9IEFycmF5LmZyb20oY2FzZXNCeUZpbGUuZW50cmllcygpKTtcblxuICAgICAgd2hpbGUgKHRvdGFsUHJvY2Vzc2VkIDwgY2FzZXMubGVuZ3RoICYmIGJhdGNoTnVtYmVyIDwgdGhpcy5jb25maWcubWF4QmF0Y2hlcykge1xuICAgICAgICBiYXRjaE51bWJlcisrO1xuICAgICAgICBjb25zb2xlLmxvZyhgXFxu8J+TpiBQcm9jZXNzaW5nIEJhdGNoICR7YmF0Y2hOdW1iZXJ9Li4uYCk7XG5cbiAgICAgICAgLy8gU2VsZWN0IGZpbGVzIGZvciB0aGlzIGJhdGNoXG4gICAgICAgIGNvbnN0IGJhdGNoRmlsZXMgPSB0aGlzLnNlbGVjdEJhdGNoRmlsZXMoZmlsZUdyb3VwcywgdG90YWxQcm9jZXNzZWQpO1xuICAgICAgICBjb25zdCBiYXRjaENhc2VzID0gYmF0Y2hGaWxlcy5mbGF0TWFwKChbXywgZmlsZUNhc2VzXSkgPT4gZmlsZUNhc2VzKTtcblxuICAgICAgICBpZiAoYmF0Y2hDYXNlcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICBjb25zb2xlLmxvZygn4oS577iPIE5vIG1vcmUgY2FzZXMgdG8gcHJvY2VzcycpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc29sZS5sb2coYPCfk4ogQmF0Y2ggJHtiYXRjaE51bWJlcn06IFByb2Nlc3NpbmcgJHtiYXRjaENhc2VzLmxlbmd0aH0gY2FzZXMgYWNyb3NzICR7YmF0Y2hGaWxlcy5sZW5ndGh9IGZpbGVzYCk7XG5cbiAgICAgICAgLy8gRXhlY3V0ZSBiYXRjaCB3aXRoIHJlYWwtdGltZSB2YWxpZGF0aW9uXG4gICAgICAgIGNvbnN0IGJhdGNoUmVzdWx0ID0gYXdhaXQgdGhpcy5leGVjdXRlQmF0Y2goYmF0Y2hDYXNlcywgYmF0Y2hOdW1iZXIpO1xuICAgICAgICB0aGlzLmJhdGNoUmVzdWx0cy5wdXNoKGJhdGNoUmVzdWx0KTtcblxuICAgICAgICAvLyBVcGRhdGUgdG90YWxzXG4gICAgICAgIHRvdGFsUHJvY2Vzc2VkICs9IGJhdGNoQ2FzZXMubGVuZ3RoO1xuICAgICAgICB0b3RhbFN1Y2Nlc3NmdWwgKz0gYmF0Y2hSZXN1bHQuc3VjY2Vzc2Z1bFJlcGxhY2VtZW50cztcbiAgICAgICAgdG90YWxGYWlsZWQgKz0gYmF0Y2hSZXN1bHQuZmFpbGVkUmVwbGFjZW1lbnRzO1xuXG4gICAgICAgIC8vIFJlYWwtdGltZSB2YWxpZGF0aW9uIGFuZCBzYWZldHkgY2hlY2tzXG4gICAgICAgIGNvbnN0IHZhbGlkYXRpb25SZXN1bHQgPSBhd2FpdCB0aGlzLnBlcmZvcm1SZWFsVGltZVZhbGlkYXRpb24oYmF0Y2hSZXN1bHQpO1xuICAgICAgICBpZiAoIXZhbGlkYXRpb25SZXN1bHQuYnVpbGRTdGFibGUpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCfinYwgQnVpbGQgc3RhYmlsaXR5IGNvbXByb21pc2VkLCBzdG9wcGluZyBwaWxvdCcpO1xuICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICAgIGVycm9yOiAnQnVpbGQgc3RhYmlsaXR5IGNvbXByb21pc2VkIGR1cmluZyBiYXRjaCBwcm9jZXNzaW5nJyxcbiAgICAgICAgICAgIHRvdGFsUHJvY2Vzc2VkLFxuICAgICAgICAgICAgdG90YWxTdWNjZXNzZnVsLFxuICAgICAgICAgICAgdG90YWxGYWlsZWQsXG4gICAgICAgICAgICBiYXRjaFJlc3VsdHM6IHRoaXMuYmF0Y2hSZXN1bHRzXG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIENoZWNrIHN1Y2Nlc3MgcmF0ZVxuICAgICAgICBjb25zdCBjdXJyZW50U3VjY2Vzc1JhdGUgPSB0b3RhbFN1Y2Nlc3NmdWwgLyB0b3RhbFByb2Nlc3NlZDtcbiAgICAgICAgY29uc29sZS5sb2coYPCfk4ggQ3VycmVudCBzdWNjZXNzIHJhdGU6ICR7KGN1cnJlbnRTdWNjZXNzUmF0ZSAqIDEwMCkudG9GaXhlZCgxKX0lYCk7XG5cbiAgICAgICAgaWYgKGN1cnJlbnRTdWNjZXNzUmF0ZSA8IHRoaXMuY29uZmlnLnRhcmdldFN1Y2Nlc3NSYXRlICYmIGJhdGNoTnVtYmVyID4gMikge1xuICAgICAgICAgIGNvbnNvbGUud2Fybihg4pqg77iPIFN1Y2Nlc3MgcmF0ZSAkeyhjdXJyZW50U3VjY2Vzc1JhdGUgKiAxMDApLnRvRml4ZWQoMSl9JSBiZWxvdyB0YXJnZXQgJHsodGhpcy5jb25maWcudGFyZ2V0U3VjY2Vzc1JhdGUgKiAxMDApLnRvRml4ZWQoMSl9JWApO1xuICAgICAgICAgIC8vIENvbnRpbnVlIGJ1dCB3aXRoIGluY3JlYXNlZCBjYXV0aW9uXG4gICAgICAgIH1cblxuICAgICAgICAvLyBCcmllZiBwYXVzZSBiZXR3ZWVuIGJhdGNoZXMgZm9yIHN5c3RlbSBzdGFiaWxpdHlcbiAgICAgICAgYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDEwMDApKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgZmluYWxTdWNjZXNzUmF0ZSA9IHRvdGFsU3VjY2Vzc2Z1bCAvIHRvdGFsUHJvY2Vzc2VkO1xuICAgICAgY29uc3Qgc3VjY2VzcyA9IGZpbmFsU3VjY2Vzc1JhdGUgPj0gdGhpcy5jb25maWcudGFyZ2V0U3VjY2Vzc1JhdGUgJiYgdGhpcy5zYWZldHlNZXRyaWNzLmJ1aWxkRmFpbHVyZXMgPT09IDA7XG5cbiAgICAgIGNvbnNvbGUubG9nKGBcXG7inIUgQmF0Y2ggcHJvY2Vzc2luZyBjb21wbGV0ZWQ6YCk7XG4gICAgICBjb25zb2xlLmxvZyhgICAgVG90YWwgcHJvY2Vzc2VkOiAke3RvdGFsUHJvY2Vzc2VkfWApO1xuICAgICAgY29uc29sZS5sb2coYCAgIFN1Y2Nlc3NmdWw6ICR7dG90YWxTdWNjZXNzZnVsfWApO1xuICAgICAgY29uc29sZS5sb2coYCAgIEZhaWxlZDogJHt0b3RhbEZhaWxlZH1gKTtcbiAgICAgIGNvbnNvbGUubG9nKGAgICBTdWNjZXNzIHJhdGU6ICR7KGZpbmFsU3VjY2Vzc1JhdGUgKiAxMDApLnRvRml4ZWQoMSl9JWApO1xuICAgICAgY29uc29sZS5sb2coYCAgIEJ1aWxkIGZhaWx1cmVzOiAke3RoaXMuc2FmZXR5TWV0cmljcy5idWlsZEZhaWx1cmVzfWApO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzLFxuICAgICAgICB0b3RhbFByb2Nlc3NlZCxcbiAgICAgICAgdG90YWxTdWNjZXNzZnVsLFxuICAgICAgICB0b3RhbEZhaWxlZCxcbiAgICAgICAgYmF0Y2hSZXN1bHRzOiB0aGlzLmJhdGNoUmVzdWx0cyxcbiAgICAgICAgZmluYWxTdWNjZXNzUmF0ZVxuICAgICAgfTtcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgQmF0Y2ggcHJvY2Vzc2luZyBmYWlsZWQ6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IFN0cmluZyhlcnJvciksXG4gICAgICAgIHRvdGFsUHJvY2Vzc2VkLFxuICAgICAgICB0b3RhbFN1Y2Nlc3NmdWwsXG4gICAgICAgIHRvdGFsRmFpbGVkLFxuICAgICAgICBiYXRjaFJlc3VsdHM6IHRoaXMuYmF0Y2hSZXN1bHRzXG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBFeGVjdXRlIGEgc2luZ2xlIGJhdGNoIHdpdGggY29tcHJlaGVuc2l2ZSBzYWZldHkgbW9uaXRvcmluZ1xuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBleGVjdXRlQmF0Y2goY2FzZXM6IFR5cGVSZXBsYWNlbWVudFtdLCBiYXRjaE51bWJlcjogbnVtYmVyKTogUHJvbWlzZTxCYXRjaFByb2Nlc3NpbmdSZXN1bHQ+IHtcbiAgICBjb25zdCBiYXRjaFN0YXJ0VGltZSA9IG5ldyBEYXRlKCk7XG4gICAgY29uc29sZS5sb2coYOKaoSBFeGVjdXRpbmcgYmF0Y2ggJHtiYXRjaE51bWJlcn0gd2l0aCAke2Nhc2VzLmxlbmd0aH0gY2FzZXMuLi5gKTtcblxuICAgIHRyeSB7XG4gICAgICAvLyBQcmUtYmF0Y2ggdmFsaWRhdGlvblxuICAgICAgY29uc3QgcHJlQmF0Y2hWYWxpZGF0aW9uID0gYXdhaXQgdGhpcy52YWxpZGF0ZUJ1aWxkU3RhYmlsaXR5KCk7XG4gICAgICBpZiAoIXByZUJhdGNoVmFsaWRhdGlvbi5idWlsZFN1Y2Nlc3NmdWwpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcign4p2MIFByZS1iYXRjaCBidWlsZCB2YWxpZGF0aW9uIGZhaWxlZCcpO1xuICAgICAgICB0aGlzLnNhZmV0eU1ldHJpY3MuYnVpbGRGYWlsdXJlcysrO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGJhdGNoTnVtYmVyLFxuICAgICAgICAgIHN0YXJ0VGltZTogYmF0Y2hTdGFydFRpbWUsXG4gICAgICAgICAgZW5kVGltZTogbmV3IERhdGUoKSxcbiAgICAgICAgICBjYXNlc1Byb2Nlc3NlZDogMCxcbiAgICAgICAgICBzdWNjZXNzZnVsUmVwbGFjZW1lbnRzOiAwLFxuICAgICAgICAgIGZhaWxlZFJlcGxhY2VtZW50czogY2FzZXMubGVuZ3RoLFxuICAgICAgICAgIGJ1aWxkU3RhYmxlOiBmYWxzZSxcbiAgICAgICAgICByb2xsYmFja1BlcmZvcm1lZDogZmFsc2UsXG4gICAgICAgICAgZXJyb3I6ICdQcmUtYmF0Y2ggYnVpbGQgdmFsaWRhdGlvbiBmYWlsZWQnXG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIC8vIEV4ZWN1dGUgcmVwbGFjZW1lbnRzXG4gICAgICBjb25zdCByZXBsYWNlbWVudFJlc3VsdCA9IGF3YWl0IHRoaXMucmVwbGFjZXIucHJvY2Vzc0JhdGNoKGNhc2VzKTtcblxuICAgICAgLy8gUG9zdC1iYXRjaCB2YWxpZGF0aW9uXG4gICAgICBjb25zdCBwb3N0QmF0Y2hWYWxpZGF0aW9uID0gYXdhaXQgdGhpcy52YWxpZGF0ZUJ1aWxkU3RhYmlsaXR5KCk7XG4gICAgICBjb25zdCBidWlsZFN0YWJsZSA9IHBvc3RCYXRjaFZhbGlkYXRpb24uYnVpbGRTdWNjZXNzZnVsO1xuXG4gICAgICBpZiAoIWJ1aWxkU3RhYmxlICYmIHRoaXMuY29uZmlnLnJvbGxiYWNrT25GYWlsdXJlKSB7XG4gICAgICAgIGNvbnNvbGUud2Fybign4pqg77iPIFBvc3QtYmF0Y2ggYnVpbGQgdmFsaWRhdGlvbiBmYWlsZWQsIHBlcmZvcm1pbmcgcm9sbGJhY2suLi4nKTtcbiAgICAgICAgLy8gVGhlIFNhZmVUeXBlUmVwbGFjZXIgc2hvdWxkIGhhdmUgYWxyZWFkeSBwZXJmb3JtZWQgcm9sbGJhY2tcbiAgICAgICAgdGhpcy5zYWZldHlNZXRyaWNzLnJvbGxiYWNrc1BlcmZvcm1lZCsrO1xuICAgICAgICB0aGlzLnNhZmV0eU1ldHJpY3MuYnVpbGRGYWlsdXJlcysrO1xuICAgICAgfVxuXG4gICAgICAvLyBVcGRhdGUgc2FmZXR5IG1ldHJpY3NcbiAgICAgIHRoaXMudXBkYXRlU2FmZXR5TWV0cmljcyhyZXBsYWNlbWVudFJlc3VsdCwgYnVpbGRTdGFibGUpO1xuXG4gICAgICBjb25zdCBiYXRjaFJlc3VsdDogQmF0Y2hQcm9jZXNzaW5nUmVzdWx0ID0ge1xuICAgICAgICBiYXRjaE51bWJlcixcbiAgICAgICAgc3RhcnRUaW1lOiBiYXRjaFN0YXJ0VGltZSxcbiAgICAgICAgZW5kVGltZTogbmV3IERhdGUoKSxcbiAgICAgICAgY2FzZXNQcm9jZXNzZWQ6IGNhc2VzLmxlbmd0aCxcbiAgICAgICAgc3VjY2Vzc2Z1bFJlcGxhY2VtZW50czogcmVwbGFjZW1lbnRSZXN1bHQuYXBwbGllZFJlcGxhY2VtZW50cy5sZW5ndGgsXG4gICAgICAgIGZhaWxlZFJlcGxhY2VtZW50czogcmVwbGFjZW1lbnRSZXN1bHQuZmFpbGVkUmVwbGFjZW1lbnRzLmxlbmd0aCxcbiAgICAgICAgYnVpbGRTdGFibGUsXG4gICAgICAgIHJvbGxiYWNrUGVyZm9ybWVkOiByZXBsYWNlbWVudFJlc3VsdC5yb2xsYmFja1BlcmZvcm1lZCxcbiAgICAgICAgY29tcGlsYXRpb25FcnJvcnM6IHJlcGxhY2VtZW50UmVzdWx0LmNvbXBpbGF0aW9uRXJyb3JzXG4gICAgICB9O1xuXG4gICAgICBjb25zb2xlLmxvZyhg4pyFIEJhdGNoICR7YmF0Y2hOdW1iZXJ9IGNvbXBsZXRlZDogJHtiYXRjaFJlc3VsdC5zdWNjZXNzZnVsUmVwbGFjZW1lbnRzfS8ke2JhdGNoUmVzdWx0LmNhc2VzUHJvY2Vzc2VkfSBzdWNjZXNzZnVsYCk7XG5cbiAgICAgIHJldHVybiBiYXRjaFJlc3VsdDtcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKGDinYwgQmF0Y2ggJHtiYXRjaE51bWJlcn0gZXhlY3V0aW9uIGZhaWxlZDpgLCBlcnJvcik7XG4gICAgICB0aGlzLnNhZmV0eU1ldHJpY3MuYmF0Y2hGYWlsdXJlcysrO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBiYXRjaE51bWJlcixcbiAgICAgICAgc3RhcnRUaW1lOiBiYXRjaFN0YXJ0VGltZSxcbiAgICAgICAgZW5kVGltZTogbmV3IERhdGUoKSxcbiAgICAgICAgY2FzZXNQcm9jZXNzZWQ6IGNhc2VzLmxlbmd0aCxcbiAgICAgICAgc3VjY2Vzc2Z1bFJlcGxhY2VtZW50czogMCxcbiAgICAgICAgZmFpbGVkUmVwbGFjZW1lbnRzOiBjYXNlcy5sZW5ndGgsXG4gICAgICAgIGJ1aWxkU3RhYmxlOiBmYWxzZSxcbiAgICAgICAgcm9sbGJhY2tQZXJmb3JtZWQ6IGZhbHNlLFxuICAgICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBTdHJpbmcoZXJyb3IpXG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBQZXJmb3JtIHJlYWwtdGltZSB2YWxpZGF0aW9uIGFmdGVyIGVhY2ggYmF0Y2hcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgcGVyZm9ybVJlYWxUaW1lVmFsaWRhdGlvbihiYXRjaFJlc3VsdDogQmF0Y2hQcm9jZXNzaW5nUmVzdWx0KTogUHJvbWlzZTxSZWFsVGltZVZhbGlkYXRpb25SZXN1bHQ+IHtcbiAgICBjb25zb2xlLmxvZygn8J+UjSBQZXJmb3JtaW5nIHJlYWwtdGltZSB2YWxpZGF0aW9uLi4uJyk7XG5cbiAgICB0cnkge1xuICAgICAgLy8gQnVpbGQgc3RhYmlsaXR5IGNoZWNrXG4gICAgICBjb25zdCBidWlsZFZhbGlkYXRpb24gPSBhd2FpdCB0aGlzLnZhbGlkYXRlQnVpbGRTdGFiaWxpdHkoKTtcblxuICAgICAgLy8gVHlwZVNjcmlwdCBlcnJvciBjb3VudCBjaGVja1xuICAgICAgY29uc3QgY3VycmVudEVycm9yQ291bnQgPSBhd2FpdCB0aGlzLmdldEN1cnJlbnRUeXBlU2NyaXB0RXJyb3JDb3VudCgpO1xuXG4gICAgICAvLyBTYWZldHkgbWV0cmljcyBjaGVja1xuICAgICAgY29uc3Qgc2FmZXR5U2NvcmUgPSB0aGlzLmNhbGN1bGF0ZVNhZmV0eVNjb3JlKCk7XG5cbiAgICAgIGNvbnN0IHZhbGlkYXRpb25SZXN1bHQ6IFJlYWxUaW1lVmFsaWRhdGlvblJlc3VsdCA9IHtcbiAgICAgICAgYnVpbGRTdGFibGU6IGJ1aWxkVmFsaWRhdGlvbi5idWlsZFN1Y2Nlc3NmdWwsXG4gICAgICAgIHR5cGVTY3JpcHRFcnJvckNvdW50OiBjdXJyZW50RXJyb3JDb3VudCxcbiAgICAgICAgc2FmZXR5U2NvcmUsXG4gICAgICAgIHZhbGlkYXRpb25UaW1lOiBuZXcgRGF0ZSgpLFxuICAgICAgICBiYXRjaE51bWJlcjogYmF0Y2hSZXN1bHQuYmF0Y2hOdW1iZXIsXG4gICAgICAgIHdhcm5pbmdzOiBbXVxuICAgICAgfTtcblxuICAgICAgLy8gQWRkIHdhcm5pbmdzIGJhc2VkIG9uIHZhbGlkYXRpb24gcmVzdWx0c1xuICAgICAgaWYgKCFidWlsZFZhbGlkYXRpb24uYnVpbGRTdWNjZXNzZnVsKSB7XG4gICAgICAgIHZhbGlkYXRpb25SZXN1bHQud2FybmluZ3MucHVzaCgnQnVpbGQgY29tcGlsYXRpb24gZmFpbGVkJyk7XG4gICAgICB9XG5cbiAgICAgIGlmIChzYWZldHlTY29yZSA8IHRoaXMuY29uZmlnLnNhZmV0eVRocmVzaG9sZCkge1xuICAgICAgICB2YWxpZGF0aW9uUmVzdWx0Lndhcm5pbmdzLnB1c2goYFNhZmV0eSBzY29yZSAke3NhZmV0eVNjb3JlLnRvRml4ZWQoMil9IGJlbG93IHRocmVzaG9sZCAke3RoaXMuY29uZmlnLnNhZmV0eVRocmVzaG9sZH1gKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHRoaXMuc2FmZXR5TWV0cmljcy5yb2xsYmFja3NQZXJmb3JtZWQgPiAwKSB7XG4gICAgICAgIHZhbGlkYXRpb25SZXN1bHQud2FybmluZ3MucHVzaChgJHt0aGlzLnNhZmV0eU1ldHJpY3Mucm9sbGJhY2tzUGVyZm9ybWVkfSByb2xsYmFja3MgcGVyZm9ybWVkYCk7XG4gICAgICB9XG5cbiAgICAgIGNvbnNvbGUubG9nKGDwn5OKIFZhbGlkYXRpb24gcmVzdWx0OiBCdWlsZCBzdGFibGU6ICR7dmFsaWRhdGlvblJlc3VsdC5idWlsZFN0YWJsZX0sIFNhZmV0eSBzY29yZTogJHtzYWZldHlTY29yZS50b0ZpeGVkKDIpfWApO1xuXG4gICAgICByZXR1cm4gdmFsaWRhdGlvblJlc3VsdDtcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgUmVhbC10aW1lIHZhbGlkYXRpb24gZmFpbGVkOicsIGVycm9yKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGJ1aWxkU3RhYmxlOiBmYWxzZSxcbiAgICAgICAgdHlwZVNjcmlwdEVycm9yQ291bnQ6IC0xLFxuICAgICAgICBzYWZldHlTY29yZTogMCxcbiAgICAgICAgdmFsaWRhdGlvblRpbWU6IG5ldyBEYXRlKCksXG4gICAgICAgIGJhdGNoTnVtYmVyOiBiYXRjaFJlc3VsdC5iYXRjaE51bWJlcixcbiAgICAgICAgd2FybmluZ3M6IFsnVmFsaWRhdGlvbiBwcm9jZXNzIGZhaWxlZCddLFxuICAgICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBTdHJpbmcoZXJyb3IpXG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBWYWxpZGF0ZSBpbnRlZ3JhdGlvbiB3aXRoIGV4aXN0aW5nIGNhbXBhaWduIGluZnJhc3RydWN0dXJlXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIHZhbGlkYXRlQ2FtcGFpZ25JbnRlZ3JhdGlvbigpOiBQcm9taXNlPHsgc3VjY2VzczogYm9vbGVhbjsgZXJyb3I/OiBzdHJpbmcgfT4ge1xuICAgIGNvbnNvbGUubG9nKCfwn5SXIFZhbGlkYXRpbmcgY2FtcGFpZ24gaW5mcmFzdHJ1Y3R1cmUgaW50ZWdyYXRpb24uLi4nKTtcblxuICAgIHRyeSB7XG4gICAgICAvLyBUZXN0IGNhbXBhaWduIGludGVncmF0aW9uXG4gICAgICBjb25zdCBjYW1wYWlnblZhbGlkYXRpb24gPSBhd2FpdCB0aGlzLmNhbXBhaWduSW50ZWdyYXRpb24udmFsaWRhdGVJbnRlZ3JhdGlvbigpO1xuICAgICAgaWYgKCFjYW1wYWlnblZhbGlkYXRpb24uc3VjY2Vzcykge1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdDYW1wYWlnbiBpbnRlZ3JhdGlvbiB2YWxpZGF0aW9uIGZhaWxlZCcgfTtcbiAgICAgIH1cblxuICAgICAgLy8gVGVzdCBtZXRyaWNzIGludGVncmF0aW9uXG4gICAgICBjb25zdCBtZXRyaWNzVmFsaWRhdGlvbiA9IGF3YWl0IHRoaXMubWV0cmljc0ludGVncmF0aW9uLnZhbGlkYXRlSW50ZWdyYXRpb24oKTtcbiAgICAgIGlmICghbWV0cmljc1ZhbGlkYXRpb24uc3VjY2Vzcykge1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdNZXRyaWNzIGludGVncmF0aW9uIHZhbGlkYXRpb24gZmFpbGVkJyB9O1xuICAgICAgfVxuXG4gICAgICAvLyBUZXN0IHByb2dyZXNzaXZlIGVuZ2luZSBpbnRlZ3JhdGlvblxuICAgICAgY29uc3QgZW5naW5lVmFsaWRhdGlvbiA9IGF3YWl0IHRoaXMucHJvZ3Jlc3NpdmVFbmdpbmUudmFsaWRhdGVDb25maWd1cmF0aW9uKCk7XG4gICAgICBpZiAoIWVuZ2luZVZhbGlkYXRpb24uaXNWYWxpZCkge1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdQcm9ncmVzc2l2ZSBlbmdpbmUgdmFsaWRhdGlvbiBmYWlsZWQnIH07XG4gICAgICB9XG5cbiAgICAgIGNvbnNvbGUubG9nKCfinIUgQ2FtcGFpZ24gaW5mcmFzdHJ1Y3R1cmUgaW50ZWdyYXRpb24gdmFsaWRhdGVkIHN1Y2Nlc3NmdWxseScpO1xuICAgICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSB9O1xuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBDYW1wYWlnbiBpbnRlZ3JhdGlvbiB2YWxpZGF0aW9uIGZhaWxlZDonLCBlcnJvcik7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKVxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhdGUgY29tcHJlaGVuc2l2ZSBwaWxvdCByZXBvcnRcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgZ2VuZXJhdGVQaWxvdFJlcG9ydChyZXN1bHQ6IENvbnNlcnZhdGl2ZVBpbG90UmVzdWx0KTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc29sZS5sb2coJ/Cfk4QgR2VuZXJhdGluZyBwaWxvdCByZXBvcnQuLi4nKTtcblxuICAgIGNvbnN0IHJlcG9ydFBhdGggPSAnLmtpcm8vY2FtcGFpZ24tcmVwb3J0cy9jb25zZXJ2YXRpdmUtcGlsb3QnO1xuICAgIGlmICghZnMuZXhpc3RzU3luYyhyZXBvcnRQYXRoKSkge1xuICAgICAgZnMubWtkaXJTeW5jKHJlcG9ydFBhdGgsIHsgcmVjdXJzaXZlOiB0cnVlIH0pO1xuICAgIH1cblxuICAgIC8vIEdlbmVyYXRlIGRldGFpbGVkIHJlcG9ydFxuICAgIGNvbnN0IHJlcG9ydCA9IHtcbiAgICAgIHBpbG90SWQ6IGBjb25zZXJ2YXRpdmUtcGlsb3QtJHtEYXRlLm5vdygpfWAsXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgIGNvbmZpZ3VyYXRpb246IHRoaXMuY29uZmlnLFxuICAgICAgcmVzdWx0czogcmVzdWx0LFxuICAgICAgYmF0Y2hSZXN1bHRzOiB0aGlzLmJhdGNoUmVzdWx0cyxcbiAgICAgIHNhZmV0eU1ldHJpY3M6IHRoaXMuc2FmZXR5TWV0cmljcyxcbiAgICAgIGV4ZWN1dGlvblRpbWU6IG5ldyBEYXRlKCkuZ2V0VGltZSgpIC0gdGhpcy5waWxvdFN0YXJ0VGltZS5nZXRUaW1lKCksXG4gICAgICByZWNvbW1lbmRhdGlvbnM6IHRoaXMuZ2VuZXJhdGVSZWNvbW1lbmRhdGlvbnMocmVzdWx0KVxuICAgIH07XG5cbiAgICAvLyBTYXZlIEpTT04gcmVwb3J0XG4gICAgY29uc3QganNvblJlcG9ydFBhdGggPSBwYXRoLmpvaW4ocmVwb3J0UGF0aCwgJ3BpbG90LXJlcG9ydC5qc29uJyk7XG4gICAgZnMud3JpdGVGaWxlU3luYyhqc29uUmVwb3J0UGF0aCwgSlNPTi5zdHJpbmdpZnkocmVwb3J0LCBudWxsLCAyKSk7XG5cbiAgICAvLyBTYXZlIG1hcmtkb3duIHN1bW1hcnlcbiAgICBjb25zdCBtYXJrZG93blJlcG9ydFBhdGggPSBwYXRoLmpvaW4ocmVwb3J0UGF0aCwgJ3BpbG90LXN1bW1hcnkubWQnKTtcbiAgICBjb25zdCBtYXJrZG93bkNvbnRlbnQgPSB0aGlzLmdlbmVyYXRlTWFya2Rvd25SZXBvcnQocmVwb3J0KTtcbiAgICBmcy53cml0ZUZpbGVTeW5jKG1hcmtkb3duUmVwb3J0UGF0aCwgbWFya2Rvd25Db250ZW50KTtcblxuICAgIGNvbnNvbGUubG9nKGDwn5OKIFBpbG90IHJlcG9ydCBzYXZlZCB0byAke3JlcG9ydFBhdGh9YCk7XG4gIH1cblxuICAvLyBIZWxwZXIgTWV0aG9kc1xuXG4gIHByaXZhdGUgYXN5bmMgZ2V0VHlwZVNjcmlwdEZpbGVzKCk6IFByb21pc2U8c3RyaW5nW10+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3Qgb3V0cHV0ID0gZXhlY1N5bmMoJ2ZpbmQgc3JjIC1uYW1lIFwiKi50c1wiIC1vIC1uYW1lIFwiKi50c3hcIiB8IGdyZXAgLXYgX190ZXN0c19fIHwgZ3JlcCAtdiAudGVzdC4gfCBoZWFkIC0yMDAnLCB7XG4gICAgICAgIGVuY29kaW5nOiAndXRmOCcsXG4gICAgICAgIHN0ZGlvOiAncGlwZSdcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIG91dHB1dC50cmltKCkuc3BsaXQoJ1xcbicpLmZpbHRlcihmaWxlID0+IGZpbGUudHJpbSgpKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS53YXJuKCdGYWlsZWQgdG8gZ2V0IFR5cGVTY3JpcHQgZmlsZXMsIHVzaW5nIGZhbGxiYWNrIG1ldGhvZCcpO1xuICAgICAgcmV0dXJuIHRoaXMuZ2V0RmFsbGJhY2tUeXBlU2NyaXB0RmlsZXMoKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGdldEZhbGxiYWNrVHlwZVNjcmlwdEZpbGVzKCk6IHN0cmluZ1tdIHtcbiAgICAvLyBGYWxsYmFjayBtZXRob2QgdG8gZ2V0IFR5cGVTY3JpcHQgZmlsZXNcbiAgICBjb25zdCBmaWxlczogc3RyaW5nW10gPSBbXTtcbiAgICBjb25zdCBzcmNEaXIgPSAnc3JjJztcblxuICAgIGlmIChmcy5leGlzdHNTeW5jKHNyY0RpcikpIHtcbiAgICAgIGNvbnN0IHdhbGtEaXIgPSAoZGlyOiBzdHJpbmcpID0+IHtcbiAgICAgICAgY29uc3QgaXRlbXMgPSBmcy5yZWFkZGlyU3luYyhkaXIpO1xuICAgICAgICBmb3IgKGNvbnN0IGl0ZW0gb2YgaXRlbXMpIHtcbiAgICAgICAgICBjb25zdCBmdWxsUGF0aCA9IHBhdGguam9pbihkaXIsIGl0ZW0pO1xuICAgICAgICAgIGNvbnN0IHN0YXQgPSBmcy5zdGF0U3luYyhmdWxsUGF0aCk7XG5cbiAgICAgICAgICBpZiAoc3RhdC5pc0RpcmVjdG9yeSgpICYmICFpdGVtLmluY2x1ZGVzKCdfX3Rlc3RzX18nKSAmJiAhaXRlbS5pbmNsdWRlcygnbm9kZV9tb2R1bGVzJykpIHtcbiAgICAgICAgICAgIHdhbGtEaXIoZnVsbFBhdGgpO1xuICAgICAgICAgIH0gZWxzZSBpZiAoc3RhdC5pc0ZpbGUoKSAmJiAoaXRlbS5lbmRzV2l0aCgnLnRzJykgfHwgaXRlbS5lbmRzV2l0aCgnLnRzeCcpKSAmJiAhaXRlbS5pbmNsdWRlcygnLnRlc3QuJykpIHtcbiAgICAgICAgICAgIGZpbGVzLnB1c2goZnVsbFBhdGgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgd2Fsa0RpcihzcmNEaXIpO1xuICAgIH1cblxuICAgIHJldHVybiBmaWxlcy5zbGljZSgwLCAxMDApOyAvLyBMaW1pdCBmb3IgcGlsb3RcbiAgfVxuXG4gIHByaXZhdGUgZmluZEFueVR5cGVPY2N1cnJlbmNlcyhjb250ZW50OiBzdHJpbmcsIGZpbGVQYXRoOiBzdHJpbmcpOiBBcnJheTx7IGNvbnRleHQ6IGFueTsgbGluZU51bWJlcjogbnVtYmVyIH0+IHtcbiAgICBjb25zdCBsaW5lcyA9IGNvbnRlbnQuc3BsaXQoJ1xcbicpO1xuICAgIGNvbnN0IG9jY3VycmVuY2VzOiBBcnJheTx7IGNvbnRleHQ6IGFueTsgbGluZU51bWJlcjogbnVtYmVyIH0+ID0gW107XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxpbmVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCBsaW5lID0gbGluZXNbaV07XG5cbiAgICAgIC8vIExvb2sgZm9yIGFueVtdIHBhdHRlcm5zXG4gICAgICBpZiAobGluZS5pbmNsdWRlcygnYW55W10nKSkge1xuICAgICAgICBvY2N1cnJlbmNlcy5wdXNoKHtcbiAgICAgICAgICBjb250ZXh0OiB7XG4gICAgICAgICAgICBmaWxlUGF0aCxcbiAgICAgICAgICAgIGxpbmVOdW1iZXI6IGkgKyAxLFxuICAgICAgICAgICAgY29kZVNuaXBwZXQ6IGxpbmUudHJpbSgpLFxuICAgICAgICAgICAgc3Vycm91bmRpbmdMaW5lczogdGhpcy5nZXRTdXJyb3VuZGluZ0xpbmVzKGxpbmVzLCBpKSxcbiAgICAgICAgICAgIGhhc0V4aXN0aW5nQ29tbWVudDogdGhpcy5oYXNDb21tZW50QWJvdmUobGluZXMsIGkpLFxuICAgICAgICAgICAgaXNJblRlc3RGaWxlOiBmaWxlUGF0aC5pbmNsdWRlcygnLnRlc3QuJykgfHwgZmlsZVBhdGguaW5jbHVkZXMoJ19fdGVzdHNfXycpLFxuICAgICAgICAgICAgZG9tYWluQ29udGV4dDogeyBkb21haW46IHRoaXMuaW5mZXJEb21haW4oZmlsZVBhdGgpIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIGxpbmVOdW1iZXI6IGkgKyAxXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBMb29rIGZvciBSZWNvcmQ8c3RyaW5nLCBhbnk+IHBhdHRlcm5zXG4gICAgICBpZiAobGluZS5pbmNsdWRlcygnUmVjb3JkPHN0cmluZywgYW55PicpKSB7XG4gICAgICAgIG9jY3VycmVuY2VzLnB1c2goe1xuICAgICAgICAgIGNvbnRleHQ6IHtcbiAgICAgICAgICAgIGZpbGVQYXRoLFxuICAgICAgICAgICAgbGluZU51bWJlcjogaSArIDEsXG4gICAgICAgICAgICBjb2RlU25pcHBldDogbGluZS50cmltKCksXG4gICAgICAgICAgICBzdXJyb3VuZGluZ0xpbmVzOiB0aGlzLmdldFN1cnJvdW5kaW5nTGluZXMobGluZXMsIGkpLFxuICAgICAgICAgICAgaGFzRXhpc3RpbmdDb21tZW50OiB0aGlzLmhhc0NvbW1lbnRBYm92ZShsaW5lcywgaSksXG4gICAgICAgICAgICBpc0luVGVzdEZpbGU6IGZpbGVQYXRoLmluY2x1ZGVzKCcudGVzdC4nKSB8fCBmaWxlUGF0aC5pbmNsdWRlcygnX190ZXN0c19fJyksXG4gICAgICAgICAgICBkb21haW5Db250ZXh0OiB7IGRvbWFpbjogdGhpcy5pbmZlckRvbWFpbihmaWxlUGF0aCkgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgbGluZU51bWJlcjogaSArIDFcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIG9jY3VycmVuY2VzO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRTdXJyb3VuZGluZ0xpbmVzKGxpbmVzOiBzdHJpbmdbXSwgaW5kZXg6IG51bWJlciwgY29udGV4dCA9IDIpOiBzdHJpbmdbXSB7XG4gICAgY29uc3Qgc3RhcnQgPSBNYXRoLm1heCgwLCBpbmRleCAtIGNvbnRleHQpO1xuICAgIGNvbnN0IGVuZCA9IE1hdGgubWluKGxpbmVzLmxlbmd0aCwgaW5kZXggKyBjb250ZXh0ICsgMSk7XG4gICAgcmV0dXJuIGxpbmVzLnNsaWNlKHN0YXJ0LCBlbmQpO1xuICB9XG5cbiAgcHJpdmF0ZSBoYXNDb21tZW50QWJvdmUobGluZXM6IHN0cmluZ1tdLCBpbmRleDogbnVtYmVyKTogYm9vbGVhbiB7XG4gICAgaWYgKGluZGV4ID4gMCkge1xuICAgICAgY29uc3QgcHJldmlvdXNMaW5lID0gbGluZXNbaW5kZXggLSAxXS50cmltKCk7XG4gICAgICByZXR1cm4gcHJldmlvdXNMaW5lLnN0YXJ0c1dpdGgoJy8vJykgfHwgcHJldmlvdXNMaW5lLnN0YXJ0c1dpdGgoJy8qJyk7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHByaXZhdGUgaW5mZXJEb21haW4oZmlsZVBhdGg6IHN0cmluZyk6IHN0cmluZyB7XG4gICAgaWYgKGZpbGVQYXRoLmluY2x1ZGVzKCdhc3RybycpIHx8IGZpbGVQYXRoLmluY2x1ZGVzKCdwbGFuZXQnKSB8fCBmaWxlUGF0aC5pbmNsdWRlcygnY2FsY3VsYXRpb24nKSkge1xuICAgICAgcmV0dXJuICdhc3Ryb2xvZ2ljYWwnO1xuICAgIH1cbiAgICBpZiAoZmlsZVBhdGguaW5jbHVkZXMoJ3JlY2lwZScpIHx8IGZpbGVQYXRoLmluY2x1ZGVzKCdpbmdyZWRpZW50JykgfHwgZmlsZVBhdGguaW5jbHVkZXMoJ2Zvb2QnKSkge1xuICAgICAgcmV0dXJuICdyZWNpcGUnO1xuICAgIH1cbiAgICBpZiAoZmlsZVBhdGguaW5jbHVkZXMoJ2NhbXBhaWduJykgfHwgZmlsZVBhdGguaW5jbHVkZXMoJ2ludGVsbGlnZW5jZScpKSB7XG4gICAgICByZXR1cm4gJ2NhbXBhaWduJztcbiAgICB9XG4gICAgaWYgKGZpbGVQYXRoLmluY2x1ZGVzKCdzZXJ2aWNlJykgfHwgZmlsZVBhdGguaW5jbHVkZXMoJ2FwaScpKSB7XG4gICAgICByZXR1cm4gJ3NlcnZpY2UnO1xuICAgIH1cbiAgICByZXR1cm4gJ3V0aWxpdHknO1xuICB9XG5cbiAgcHJpdmF0ZSBpc0hpZ2hDb25maWRlbmNlQ2FzZShjbGFzc2lmaWNhdGlvbjogQW55VHlwZUNsYXNzaWZpY2F0aW9uKTogYm9vbGVhbiB7XG4gICAgLy8gRm9jdXMgb24gc3BlY2lmaWMgY2F0ZWdvcmllcyBmb3IgY29uc2VydmF0aXZlIHBpbG90XG4gICAgaWYgKCF0aGlzLmNvbmZpZy5mb2N1c0NhdGVnb3JpZXMuaW5jbHVkZXMoY2xhc3NpZmljYXRpb24uY2F0ZWdvcnkpKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgLy8gSGlnaCBjb25maWRlbmNlIHRocmVzaG9sZFxuICAgIGlmIChjbGFzc2lmaWNhdGlvbi5jb25maWRlbmNlIDwgMC44KSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgLy8gTXVzdCBiZSBjbGFzc2lmaWVkIGFzIHVuaW50ZW50aW9uYWxcbiAgICBpZiAoY2xhc3NpZmljYXRpb24uaXNJbnRlbnRpb25hbCkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIC8vIEFkZGl0aW9uYWwgc2FmZXR5IGNoZWNrc1xuICAgIGlmIChjbGFzc2lmaWNhdGlvbi5jYXRlZ29yeSA9PT0gQW55VHlwZUNhdGVnb3J5LkFSUkFZX1RZUEUpIHtcbiAgICAgIHJldHVybiB0cnVlOyAvLyBBcnJheSB0eXBlcyBhcmUgdmVyeSBzYWZlXG4gICAgfVxuXG4gICAgaWYgKGNsYXNzaWZpY2F0aW9uLmNhdGVnb3J5ID09PSBBbnlUeXBlQ2F0ZWdvcnkuUkVDT1JEX1RZUEUpIHtcbiAgICAgIC8vIE9ubHkgc2ltcGxlIFJlY29yZCB0eXBlc1xuICAgICAgcmV0dXJuIGNsYXNzaWZpY2F0aW9uLnN1Z2dlc3RlZFJlcGxhY2VtZW50Py5pbmNsdWRlcygndW5rbm93bicpIHx8IGZhbHNlO1xuICAgIH1cblxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlVHlwZVJlcGxhY2VtZW50KG9jY3VycmVuY2U6IGFueSwgY2xhc3NpZmljYXRpb246IEFueVR5cGVDbGFzc2lmaWNhdGlvbik6IFR5cGVSZXBsYWNlbWVudCB8IG51bGwge1xuICAgIGlmICghY2xhc3NpZmljYXRpb24uc3VnZ2VzdGVkUmVwbGFjZW1lbnQpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIGxldCBvcmlnaW5hbDogc3RyaW5nO1xuICAgIGxldCByZXBsYWNlbWVudDogc3RyaW5nO1xuXG4gICAgaWYgKGNsYXNzaWZpY2F0aW9uLmNhdGVnb3J5ID09PSBBbnlUeXBlQ2F0ZWdvcnkuQVJSQVlfVFlQRSkge1xuICAgICAgb3JpZ2luYWwgPSAnYW55W10nO1xuICAgICAgcmVwbGFjZW1lbnQgPSAndW5rbm93bltdJztcbiAgICB9IGVsc2UgaWYgKGNsYXNzaWZpY2F0aW9uLmNhdGVnb3J5ID09PSBBbnlUeXBlQ2F0ZWdvcnkuUkVDT1JEX1RZUEUpIHtcbiAgICAgIG9yaWdpbmFsID0gJ1JlY29yZDxzdHJpbmcsIGFueT4nO1xuICAgICAgcmVwbGFjZW1lbnQgPSAnUmVjb3JkPHN0cmluZywgdW5rbm93bj4nO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgb3JpZ2luYWwsXG4gICAgICByZXBsYWNlbWVudCxcbiAgICAgIGZpbGVQYXRoOiBvY2N1cnJlbmNlLmNvbnRleHQuZmlsZVBhdGgsXG4gICAgICBsaW5lTnVtYmVyOiBvY2N1cnJlbmNlLmxpbmVOdW1iZXIsXG4gICAgICBjb25maWRlbmNlOiBjbGFzc2lmaWNhdGlvbi5jb25maWRlbmNlLFxuICAgICAgdmFsaWRhdGlvblJlcXVpcmVkOiB0cnVlXG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgZ3JvdXBDYXNlc0J5RmlsZShjYXNlczogVHlwZVJlcGxhY2VtZW50W10pOiBNYXA8c3RyaW5nLCBUeXBlUmVwbGFjZW1lbnRbXT4ge1xuICAgIGNvbnN0IGdyb3VwZWQgPSBuZXcgTWFwPHN0cmluZywgVHlwZVJlcGxhY2VtZW50W10+KCk7XG5cbiAgICBmb3IgKGNvbnN0IGNhc2VfIG9mIGNhc2VzKSB7XG4gICAgICBpZiAoIWdyb3VwZWQuaGFzKGNhc2VfLmZpbGVQYXRoKSkge1xuICAgICAgICBncm91cGVkLnNldChjYXNlXy5maWxlUGF0aCwgW10pO1xuICAgICAgfVxuICAgICAgZ3JvdXBlZC5nZXQoY2FzZV8uZmlsZVBhdGgpIS5wdXNoKGNhc2VfKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZ3JvdXBlZDtcbiAgfVxuXG4gIHByaXZhdGUgc2VsZWN0QmF0Y2hGaWxlcyhcbiAgICBmaWxlR3JvdXBzOiBBcnJheTxbc3RyaW5nLCBUeXBlUmVwbGFjZW1lbnRbXV0+LFxuICAgIHByb2Nlc3NlZENvdW50OiBudW1iZXJcbiAgKTogQXJyYXk8W3N0cmluZywgVHlwZVJlcGxhY2VtZW50W11dPiB7XG4gICAgY29uc3QgcmVtYWluaW5nRmlsZXMgPSBmaWxlR3JvdXBzLmZpbHRlcigoW18sIGNhc2VzXSkgPT5cbiAgICAgIGNhc2VzLnNvbWUoYyA9PiAhdGhpcy5pc1Byb2Nlc3NlZChjLCBwcm9jZXNzZWRDb3VudCkpXG4gICAgKTtcblxuICAgIC8vIFNlbGVjdCBmaWxlcyB0byBmaXQgd2l0aGluIGJhdGNoIHNpemUgbGltaXRzXG4gICAgY29uc3Qgc2VsZWN0ZWRGaWxlczogQXJyYXk8W3N0cmluZywgVHlwZVJlcGxhY2VtZW50W11dPiA9IFtdO1xuICAgIGxldCB0b3RhbENhc2VzID0gMDtcblxuICAgIGZvciAoY29uc3QgW2ZpbGVQYXRoLCBjYXNlc10gb2YgcmVtYWluaW5nRmlsZXMpIHtcbiAgICAgIGNvbnN0IHVucHJvY2Vzc2VkQ2FzZXMgPSBjYXNlcy5maWx0ZXIoYyA9PiAhdGhpcy5pc1Byb2Nlc3NlZChjLCBwcm9jZXNzZWRDb3VudCkpO1xuXG4gICAgICBpZiAodG90YWxDYXNlcyArIHVucHJvY2Vzc2VkQ2FzZXMubGVuZ3RoIDw9IHRoaXMuY29uZmlnLm1heEZpbGVzUGVyQmF0Y2gpIHtcbiAgICAgICAgc2VsZWN0ZWRGaWxlcy5wdXNoKFtmaWxlUGF0aCwgdW5wcm9jZXNzZWRDYXNlc10pO1xuICAgICAgICB0b3RhbENhc2VzICs9IHVucHJvY2Vzc2VkQ2FzZXMubGVuZ3RoO1xuICAgICAgfVxuXG4gICAgICBpZiAoc2VsZWN0ZWRGaWxlcy5sZW5ndGggPj0gdGhpcy5jb25maWcubWF4RmlsZXNQZXJCYXRjaCB8fCB0b3RhbENhc2VzID49IHRoaXMuY29uZmlnLm1heEZpbGVzUGVyQmF0Y2gpIHtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHNlbGVjdGVkRmlsZXM7XG4gIH1cblxuICBwcml2YXRlIGlzUHJvY2Vzc2VkKGNhc2VfOiBUeXBlUmVwbGFjZW1lbnQsIHByb2Nlc3NlZENvdW50OiBudW1iZXIpOiBib29sZWFuIHtcbiAgICAvLyBTaW1wbGUgdHJhY2tpbmcgLSBpbiBhIHJlYWwgaW1wbGVtZW50YXRpb24sIHRoaXMgd291bGQgYmUgbW9yZSBzb3BoaXN0aWNhdGVkXG4gICAgcmV0dXJuIGZhbHNlOyAvLyBGb3Igbm93LCBhc3N1bWUgbm8gY2FzZXMgYXJlIHByZS1wcm9jZXNzZWRcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgdmFsaWRhdGVCdWlsZFN0YWJpbGl0eSgpOiBQcm9taXNlPHsgYnVpbGRTdWNjZXNzZnVsOiBib29sZWFuOyBlcnJvcnM/OiBzdHJpbmdbXSB9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGV4ZWNTeW5jKCd5YXJuIHRzYyAtLW5vRW1pdCAtLXNraXBMaWJDaGVjaycsIHtcbiAgICAgICAgc3RkaW86ICdwaXBlJyxcbiAgICAgICAgdGltZW91dDogMzAwMDBcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHsgYnVpbGRTdWNjZXNzZnVsOiB0cnVlIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGJ1aWxkU3VjY2Vzc2Z1bDogZmFsc2UsXG4gICAgICAgIGVycm9yczogW2Vycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKV1cbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBnZXRDdXJyZW50VHlwZVNjcmlwdEVycm9yQ291bnQoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3Qgb3V0cHV0ID0gZXhlY1N5bmMoJ3lhcm4gdHNjIC0tbm9FbWl0IC0tc2tpcExpYkNoZWNrIDI+JjEgfCBncmVwIC1jIFwiZXJyb3IgVFNcIiB8fCBlY2hvIFwiMFwiJywge1xuICAgICAgICBlbmNvZGluZzogJ3V0ZjgnLFxuICAgICAgICBzdGRpbzogJ3BpcGUnXG4gICAgICB9KTtcbiAgICAgIHJldHVybiBwYXJzZUludChvdXRwdXQudHJpbSgpKSB8fCAwO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICByZXR1cm4gLTE7IC8vIEVycm9yIGluIGdldHRpbmcgY291bnRcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGluaXRpYWxpemVTYWZldHlNZXRyaWNzKCk6IFNhZmV0eU1ldHJpY3Mge1xuICAgIHJldHVybiB7XG4gICAgICBidWlsZEZhaWx1cmVzOiAwLFxuICAgICAgcm9sbGJhY2tzUGVyZm9ybWVkOiAwLFxuICAgICAgYmF0Y2hGYWlsdXJlczogMCxcbiAgICAgIGNvbXBpbGF0aW9uRXJyb3JzOiAwLFxuICAgICAgc2FmZXR5UHJvdG9jb2xBY3RpdmF0aW9uczogMFxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIHVwZGF0ZVNhZmV0eU1ldHJpY3MocmVzdWx0OiBSZXBsYWNlbWVudFJlc3VsdCwgYnVpbGRTdGFibGU6IGJvb2xlYW4pOiB2b2lkIHtcbiAgICBpZiAoIWJ1aWxkU3RhYmxlKSB7XG4gICAgICB0aGlzLnNhZmV0eU1ldHJpY3MuYnVpbGRGYWlsdXJlcysrO1xuICAgIH1cblxuICAgIGlmIChyZXN1bHQucm9sbGJhY2tQZXJmb3JtZWQpIHtcbiAgICAgIHRoaXMuc2FmZXR5TWV0cmljcy5yb2xsYmFja3NQZXJmb3JtZWQrKztcbiAgICB9XG5cbiAgICBpZiAocmVzdWx0LmNvbXBpbGF0aW9uRXJyb3JzLmxlbmd0aCA+IDApIHtcbiAgICAgIHRoaXMuc2FmZXR5TWV0cmljcy5jb21waWxhdGlvbkVycm9ycyArPSByZXN1bHQuY29tcGlsYXRpb25FcnJvcnMubGVuZ3RoO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgY2FsY3VsYXRlU2FmZXR5U2NvcmUoKTogbnVtYmVyIHtcbiAgICBjb25zdCB0b3RhbEJhdGNoZXMgPSB0aGlzLmJhdGNoUmVzdWx0cy5sZW5ndGg7XG4gICAgaWYgKHRvdGFsQmF0Y2hlcyA9PT0gMCkgcmV0dXJuIDEuMDtcblxuICAgIGNvbnN0IHN1Y2Nlc3NmdWxCYXRjaGVzID0gdGhpcy5iYXRjaFJlc3VsdHMuZmlsdGVyKGIgPT4gYi5idWlsZFN0YWJsZSAmJiAhYi5yb2xsYmFja1BlcmZvcm1lZCkubGVuZ3RoO1xuICAgIGNvbnN0IGJhc2VTY29yZSA9IHN1Y2Nlc3NmdWxCYXRjaGVzIC8gdG90YWxCYXRjaGVzO1xuXG4gICAgLy8gUGVuYWxpemUgZm9yIHNhZmV0eSBpc3N1ZXNcbiAgICBjb25zdCBwZW5hbHRpZXMgPSAoXG4gICAgICB0aGlzLnNhZmV0eU1ldHJpY3MuYnVpbGRGYWlsdXJlcyAqIDAuMiArXG4gICAgICB0aGlzLnNhZmV0eU1ldHJpY3Mucm9sbGJhY2tzUGVyZm9ybWVkICogMC4xICtcbiAgICAgIHRoaXMuc2FmZXR5TWV0cmljcy5iYXRjaEZhaWx1cmVzICogMC4xNVxuICAgICk7XG5cbiAgICByZXR1cm4gTWF0aC5tYXgoMCwgYmFzZVNjb3JlIC0gcGVuYWx0aWVzKTtcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlUGlsb3RSZXN1bHQoc3VjY2VzczogYm9vbGVhbiwgbWVzc2FnZT86IHN0cmluZyk6IENvbnNlcnZhdGl2ZVBpbG90UmVzdWx0IHtcbiAgICBjb25zdCB0b3RhbFByb2Nlc3NlZCA9IHRoaXMuYmF0Y2hSZXN1bHRzLnJlZHVjZSgoc3VtLCBiYXRjaCkgPT4gc3VtICsgYmF0Y2guY2FzZXNQcm9jZXNzZWQsIDApO1xuICAgIGNvbnN0IHRvdGFsU3VjY2Vzc2Z1bCA9IHRoaXMuYmF0Y2hSZXN1bHRzLnJlZHVjZSgoc3VtLCBiYXRjaCkgPT4gc3VtICsgYmF0Y2guc3VjY2Vzc2Z1bFJlcGxhY2VtZW50cywgMCk7XG4gICAgY29uc3Qgc3VjY2Vzc1JhdGUgPSB0b3RhbFByb2Nlc3NlZCA+IDAgPyB0b3RhbFN1Y2Nlc3NmdWwgLyB0b3RhbFByb2Nlc3NlZCA6IDA7XG5cbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzcyxcbiAgICAgIG1lc3NhZ2UsXG4gICAgICBwaWxvdFN0YXJ0VGltZTogdGhpcy5waWxvdFN0YXJ0VGltZSxcbiAgICAgIHBpbG90RW5kVGltZTogbmV3IERhdGUoKSxcbiAgICAgIHRvdGFsQ2FzZXNQcm9jZXNzZWQ6IHRvdGFsUHJvY2Vzc2VkLFxuICAgICAgdG90YWxTdWNjZXNzZnVsUmVwbGFjZW1lbnRzOiB0b3RhbFN1Y2Nlc3NmdWwsXG4gICAgICBzdWNjZXNzUmF0ZSxcbiAgICAgIGJhdGNoZXNFeGVjdXRlZDogdGhpcy5iYXRjaFJlc3VsdHMubGVuZ3RoLFxuICAgICAgYnVpbGRGYWlsdXJlczogdGhpcy5zYWZldHlNZXRyaWNzLmJ1aWxkRmFpbHVyZXMsXG4gICAgICByb2xsYmFja3NQZXJmb3JtZWQ6IHRoaXMuc2FmZXR5TWV0cmljcy5yb2xsYmFja3NQZXJmb3JtZWQsXG4gICAgICBzYWZldHlTY29yZTogdGhpcy5jYWxjdWxhdGVTYWZldHlTY29yZSgpLFxuICAgICAgdGFyZ2V0QWNoaWV2ZWQ6IHN1Y2Nlc3NSYXRlID49IHRoaXMuY29uZmlnLnRhcmdldFN1Y2Nlc3NSYXRlICYmIHRoaXMuc2FmZXR5TWV0cmljcy5idWlsZEZhaWx1cmVzID09PSAwLFxuICAgICAgYmF0Y2hSZXN1bHRzOiB0aGlzLmJhdGNoUmVzdWx0cyxcbiAgICAgIHNhZmV0eU1ldHJpY3M6IHRoaXMuc2FmZXR5TWV0cmljc1xuICAgIH07XG4gIH1cblxuICBwcml2YXRlIGdlbmVyYXRlUmVjb21tZW5kYXRpb25zKHJlc3VsdDogQ29uc2VydmF0aXZlUGlsb3RSZXN1bHQpOiBzdHJpbmdbXSB7XG4gICAgY29uc3QgcmVjb21tZW5kYXRpb25zOiBzdHJpbmdbXSA9IFtdO1xuXG4gICAgaWYgKHJlc3VsdC5zdWNjZXNzUmF0ZSA8IHRoaXMuY29uZmlnLnRhcmdldFN1Y2Nlc3NSYXRlKSB7XG4gICAgICByZWNvbW1lbmRhdGlvbnMucHVzaChgU3VjY2VzcyByYXRlICR7KHJlc3VsdC5zdWNjZXNzUmF0ZSAqIDEwMCkudG9GaXhlZCgxKX0lIGJlbG93IHRhcmdldCAkeyh0aGlzLmNvbmZpZy50YXJnZXRTdWNjZXNzUmF0ZSAqIDEwMCkudG9GaXhlZCgxKX0lLiBDb25zaWRlciBtb3JlIGNvbnNlcnZhdGl2ZSBjbGFzc2lmaWNhdGlvbiB0aHJlc2hvbGRzLmApO1xuICAgIH1cblxuICAgIGlmIChyZXN1bHQuYnVpbGRGYWlsdXJlcyA+IDApIHtcbiAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKGAke3Jlc3VsdC5idWlsZEZhaWx1cmVzfSBidWlsZCBmYWlsdXJlcyBvY2N1cnJlZC4gUmV2aWV3IGZhaWxlZCBjYXNlcyBhbmQgaW1wcm92ZSBzYWZldHkgdmFsaWRhdGlvbi5gKTtcbiAgICB9XG5cbiAgICBpZiAocmVzdWx0LnJvbGxiYWNrc1BlcmZvcm1lZCA+IDApIHtcbiAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKGAke3Jlc3VsdC5yb2xsYmFja3NQZXJmb3JtZWR9IHJvbGxiYWNrcyBwZXJmb3JtZWQuIEFuYWx5emUgcm9sbGJhY2sgY2F1c2VzIHRvIGltcHJvdmUgcmVwbGFjZW1lbnQgc3RyYXRlZ2llcy5gKTtcbiAgICB9XG5cbiAgICBpZiAocmVzdWx0LnNhZmV0eVNjb3JlIDwgdGhpcy5jb25maWcuc2FmZXR5VGhyZXNob2xkKSB7XG4gICAgICByZWNvbW1lbmRhdGlvbnMucHVzaChgU2FmZXR5IHNjb3JlICR7cmVzdWx0LnNhZmV0eVNjb3JlLnRvRml4ZWQoMil9IGJlbG93IHRocmVzaG9sZC4gSW1wbGVtZW50IGFkZGl0aW9uYWwgc2FmZXR5IG1lYXN1cmVzIGJlZm9yZSBmdWxsIGNhbXBhaWduLmApO1xuICAgIH1cblxuICAgIGlmIChyZXN1bHQudGFyZ2V0QWNoaWV2ZWQpIHtcbiAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKCdQaWxvdCBzdWNjZXNzZnVsISBSZWFkeSB0byBwcm9jZWVkIHRvIGZ1bGwgY2FtcGFpZ24gZXhlY3V0aW9uIChUYXNrIDEyLjMpLicpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZWNvbW1lbmRhdGlvbnMucHVzaCgnUGlsb3QgZGlkIG5vdCBtZWV0IGFsbCB0YXJnZXRzLiBSZXZpZXcgcmVzdWx0cyBhbmQgYWRqdXN0IHN0cmF0ZWd5IGJlZm9yZSBmdWxsIGNhbXBhaWduLicpO1xuICAgIH1cblxuICAgIHJldHVybiByZWNvbW1lbmRhdGlvbnM7XG4gIH1cblxuICBwcml2YXRlIGdlbmVyYXRlTWFya2Rvd25SZXBvcnQocmVwb3J0OiBhbnkpOiBzdHJpbmcge1xuICAgIHJldHVybiBgIyBDb25zZXJ2YXRpdmUgUmVwbGFjZW1lbnQgUGlsb3QgUmVwb3J0XG5cbiMjIEV4ZWN1dGl2ZSBTdW1tYXJ5XG5cbioqUGlsb3QgU3RhdHVzKio6ICR7cmVwb3J0LnJlc3VsdHMuc3VjY2VzcyA/ICfinIUgU1VDQ0VTUycgOiAn4p2MIEZBSUxFRCd9XG4qKkV4ZWN1dGlvbiBUaW1lKio6ICR7TWF0aC5yb3VuZChyZXBvcnQuZXhlY3V0aW9uVGltZSAvIDEwMDApfXNcbioqVGFyZ2V0IEFjaGlldmVtZW50Kio6ICR7cmVwb3J0LnJlc3VsdHMudGFyZ2V0QWNoaWV2ZWQgPyAn4pyFIFlFUycgOiAn4p2MIE5PJ31cblxuIyMgS2V5IE1ldHJpY3NcblxuLSAqKkNhc2VzIFByb2Nlc3NlZCoqOiAke3JlcG9ydC5yZXN1bHRzLnRvdGFsQ2FzZXNQcm9jZXNzZWR9XG4tICoqU3VjY2Vzc2Z1bCBSZXBsYWNlbWVudHMqKjogJHtyZXBvcnQucmVzdWx0cy50b3RhbFN1Y2Nlc3NmdWxSZXBsYWNlbWVudHN9XG4tICoqU3VjY2VzcyBSYXRlKio6ICR7KHJlcG9ydC5yZXN1bHRzLnN1Y2Nlc3NSYXRlICogMTAwKS50b0ZpeGVkKDEpfSUgKFRhcmdldDogJHsocmVwb3J0LmNvbmZpZ3VyYXRpb24udGFyZ2V0U3VjY2Vzc1JhdGUgKiAxMDApLnRvRml4ZWQoMSl9JSlcbi0gKipCYXRjaGVzIEV4ZWN1dGVkKio6ICR7cmVwb3J0LnJlc3VsdHMuYmF0Y2hlc0V4ZWN1dGVkfVxuLSAqKkJ1aWxkIEZhaWx1cmVzKio6ICR7cmVwb3J0LnJlc3VsdHMuYnVpbGRGYWlsdXJlc30gKFRhcmdldDogMClcbi0gKipSb2xsYmFja3MgUGVyZm9ybWVkKio6ICR7cmVwb3J0LnJlc3VsdHMucm9sbGJhY2tzUGVyZm9ybWVkfVxuLSAqKlNhZmV0eSBTY29yZSoqOiAke3JlcG9ydC5yZXN1bHRzLnNhZmV0eVNjb3JlLnRvRml4ZWQoMil9IChUaHJlc2hvbGQ6ICR7cmVwb3J0LmNvbmZpZ3VyYXRpb24uc2FmZXR5VGhyZXNob2xkfSlcblxuIyMgQmF0Y2ggUmVzdWx0c1xuXG4ke3JlcG9ydC5iYXRjaFJlc3VsdHMubWFwKChiYXRjaDogYW55LCBpbmRleDogbnVtYmVyKSA9PiBgXG4jIyMgQmF0Y2ggJHtiYXRjaC5iYXRjaE51bWJlcn1cbi0gKipDYXNlcyoqOiAke2JhdGNoLmNhc2VzUHJvY2Vzc2VkfVxuLSAqKlN1Y2Nlc3NmdWwqKjogJHtiYXRjaC5zdWNjZXNzZnVsUmVwbGFjZW1lbnRzfVxuLSAqKkZhaWxlZCoqOiAke2JhdGNoLmZhaWxlZFJlcGxhY2VtZW50c31cbi0gKipCdWlsZCBTdGFibGUqKjogJHtiYXRjaC5idWlsZFN0YWJsZSA/ICfinIUnIDogJ+KdjCd9XG4tICoqUm9sbGJhY2sqKjogJHtiYXRjaC5yb2xsYmFja1BlcmZvcm1lZCA/ICfimqDvuI8gWUVTJyA6ICfinIUgTk8nfVxuYCkuam9pbignJyl9XG5cbiMjIFNhZmV0eSBNZXRyaWNzXG5cbi0gKipCdWlsZCBGYWlsdXJlcyoqOiAke3JlcG9ydC5zYWZldHlNZXRyaWNzLmJ1aWxkRmFpbHVyZXN9XG4tICoqUm9sbGJhY2tzIFBlcmZvcm1lZCoqOiAke3JlcG9ydC5zYWZldHlNZXRyaWNzLnJvbGxiYWNrc1BlcmZvcm1lZH1cbi0gKipCYXRjaCBGYWlsdXJlcyoqOiAke3JlcG9ydC5zYWZldHlNZXRyaWNzLmJhdGNoRmFpbHVyZXN9XG4tICoqQ29tcGlsYXRpb24gRXJyb3JzKio6ICR7cmVwb3J0LnNhZmV0eU1ldHJpY3MuY29tcGlsYXRpb25FcnJvcnN9XG5cbiMjIFJlY29tbWVuZGF0aW9uc1xuXG4ke3JlcG9ydC5yZWNvbW1lbmRhdGlvbnMubWFwKChyZWM6IHN0cmluZykgPT4gYC0gJHtyZWN9YCkuam9pbignXFxuJyl9XG5cbiMjIENvbmZpZ3VyYXRpb25cblxuXFxgXFxgXFxganNvblxuJHtKU09OLnN0cmluZ2lmeShyZXBvcnQuY29uZmlndXJhdGlvbiwgbnVsbCwgMil9XG5cXGBcXGBcXGBcblxuLS0tXG4qUmVwb3J0IGdlbmVyYXRlZCBvbiAke25ldyBEYXRlKCkudG9JU09TdHJpbmcoKX0qXG5gO1xuICB9XG59XG4iXSwidmVyc2lvbiI6M30=