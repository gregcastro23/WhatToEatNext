a90992c606acae3d021a1afdc5d2e121
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.calculateElementalCompatibility = void 0;
const RecipeElementalService_1 = require("@/services/RecipeElementalService");
const elementalUtils_1 = require("@/utils/elementalUtils");
/**
 * Calculate the elemental compatibility between a recipe and user's preference
 */
async function calculateElementalCompatibility(recipeElemental, userElemental = (0, elementalUtils_1.getCurrentElementalState)()) {
    // Ensure properties are standardized
    const recipe = RecipeElementalService_1.recipeElementalService.standardizeRecipe({ elementalProperties: recipeElemental });
    const user = RecipeElementalService_1.recipeElementalService.standardizeRecipe({ elementalProperties: userElemental });
    // Calculate simple similarity score
    const similarity = RecipeElementalService_1.recipeElementalService.calculateSimilarity(recipe.elementalProperties, user.elementalProperties);
    // Find dominant elements
    const recipeDominant = getDominantElement(recipe.elementalProperties);
    const userDominant = getDominantElement(user.elementalProperties);
    // Calculate complementary score - check if dominant elements complement each other
    const complementaryScore = calculateComplementaryScore(recipeDominant, userDominant);
    // Calculate balance score - how well the recipe balances user's elemental profile
    const balanceScore = calculateBalanceScore(recipe.elementalProperties, user.elementalProperties);
    // Calculate overall compatibility (weighted average)
    const compatibility = (similarity * 0.4 +
        complementaryScore * 0.3 +
        balanceScore * 0.3);
    return {
        compatibility: Math.min(1, Math.max(0, compatibility)),
        dominantPair: {
            recipe: recipeDominant,
            user: userDominant
        },
        complementaryScore,
        balanceScore,
        recommendation: generateRecommendation(compatibility, recipeDominant, userDominant)
    };
}
exports.calculateElementalCompatibility = calculateElementalCompatibility;
/**
 * Get the dominant element from elemental properties
 */
function getDominantElement(props) {
    return Object.entries(props)
        .sort(([, a], [, b]) => b - a)[0][0];
}
/**
 * Calculate how well two elements complement each other
 * Each element should be treated individually, without opposition
 */
function calculateComplementaryScore(element1, element2) {
    // All elements work together in various ways
    if (element1 === element2) {
        return 0.9; // Same element - highest compatibility (like reinforces like)
    }
    else {
        // All combinations of different elements are complementary
        // Providing different yet harmonious qualities
        return 0.7; // Different elements - good compatibility
    }
}
/**
 * Calculate how well recipe balances user's elemental profile
 */
function calculateBalanceScore(recipeProps, userProps) {
    // Find user's weakest element
    const userWeakest = Object.entries(userProps)
        .sort(([, a], [, b]) => a - b)[0][0];
    // Find user's strongest element
    const userStrongest = Object.entries(userProps)
        .sort(([, a], [, b]) => b - a)[0][0];
    // Check if recipe strengthens user's weakest element
    const weakestScore = recipeProps[userWeakest] * 2; // Higher is better
    // Check if recipe moderates user's strongest element
    const strongestDifference = Math.abs(recipeProps[userStrongest] - userProps[userStrongest]);
    const strongestScore = 1 - strongestDifference; // Lower difference is better
    // Combined balance score
    return (weakestScore * 0.6) + (strongestScore * 0.4);
}
/**
 * Generate a text recommendation based on compatibility
 */
function generateRecommendation(score, recipeDominant, userDominant) {
    if (score <= 0.4) {
        return `This recipe's ${recipeDominant} energy contrasts with your ${userDominant} energy. This contrasts with your natural balance and might feel disharmonious.`;
    }
    else if (score > 0.8) {
        return `Excellent match! This ${recipeDominant}-dominant recipe complements your ${userDominant} energy perfectly.`;
    }
    else if (score > 0.6) {
        return `Good match. This recipe's ${recipeDominant} qualities work well with your ${userDominant} energy.`;
    }
    else {
        return `Moderate match. This recipe will provide a different but balanced energy to your ${userDominant} dominant profile.`;
    }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy91dGlscy9lbGVtZW50YWxDb21wYXRpYmlsaXR5LnRzIiwibWFwcGluZ3MiOiI7OztBQUNBLDhFQUEyRTtBQUczRSwyREFBa0U7QUFnQmxFOztHQUVHO0FBQ0ksS0FBSyxVQUFVLCtCQUErQixDQUNuRCxlQUFvQyxFQUNwQyxnQkFBcUMsSUFBQSx5Q0FBd0IsR0FBRTtJQUUvRCxxQ0FBcUM7SUFDckMsTUFBTSxNQUFNLEdBQUcsK0NBQXNCLENBQUMsaUJBQWlCLENBQUMsRUFBRSxtQkFBbUIsRUFBRSxlQUFlLEVBQUUsQ0FBQyxDQUFDO0lBQ2xHLE1BQU0sSUFBSSxHQUFHLCtDQUFzQixDQUFDLGlCQUFpQixDQUFDLEVBQUUsbUJBQW1CLEVBQUUsYUFBYSxFQUFFLENBQUMsQ0FBQztJQUU5RixvQ0FBb0M7SUFDcEMsTUFBTSxVQUFVLEdBQUcsK0NBQXNCLENBQUMsbUJBQW1CLENBQzNELE1BQU0sQ0FBQyxtQkFBbUIsRUFDMUIsSUFBSSxDQUFDLG1CQUFtQixDQUN6QixDQUFDO0lBRUYseUJBQXlCO0lBQ3pCLE1BQU0sY0FBYyxHQUFHLGtCQUFrQixDQUFDLE1BQU0sQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDO0lBQ3RFLE1BQU0sWUFBWSxHQUFHLGtCQUFrQixDQUFDLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDO0lBRWxFLG1GQUFtRjtJQUNuRixNQUFNLGtCQUFrQixHQUFHLDJCQUEyQixDQUNwRCxjQUFjLEVBQ2QsWUFBWSxDQUNiLENBQUM7SUFFRixrRkFBa0Y7SUFDbEYsTUFBTSxZQUFZLEdBQUcscUJBQXFCLENBQ3hDLE1BQU0sQ0FBQyxtQkFBbUIsRUFDMUIsSUFBSSxDQUFDLG1CQUFtQixDQUN6QixDQUFDO0lBRUYscURBQXFEO0lBQ3JELE1BQU0sYUFBYSxHQUFHLENBQ3BCLFVBQVUsR0FBRyxHQUFHO1FBQ2hCLGtCQUFrQixHQUFHLEdBQUc7UUFDeEIsWUFBWSxHQUFHLEdBQUcsQ0FDbkIsQ0FBQztJQUVGLE9BQU87UUFDTCxhQUFhLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsYUFBYSxDQUFDLENBQUM7UUFDdEQsWUFBWSxFQUFFO1lBQ1osTUFBTSxFQUFFLGNBQWM7WUFDdEIsSUFBSSxFQUFFLFlBQVk7U0FDbkI7UUFDRCxrQkFBa0I7UUFDbEIsWUFBWTtRQUNaLGNBQWMsRUFBRSxzQkFBc0IsQ0FDcEMsYUFBYSxFQUNiLGNBQWMsRUFDZCxZQUFZLENBQ2I7S0FDRixDQUFDO0FBQ0osQ0FBQztBQW5ERCwwRUFtREM7QUFFRDs7R0FFRztBQUNILFNBQVMsa0JBQWtCLENBQUMsS0FBMEI7SUFDcEQsT0FBTyxNQUFNLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQztTQUN6QixJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUE4QixDQUFDO0FBQ3RFLENBQUM7QUFFRDs7O0dBR0c7QUFDSCxTQUFTLDJCQUEyQixDQUNsQyxRQUFtQyxFQUNuQyxRQUFtQztJQUVuQyw2Q0FBNkM7SUFDN0MsSUFBSSxRQUFRLEtBQUssUUFBUSxFQUFFO1FBQ3pCLE9BQU8sR0FBRyxDQUFDLENBQUMsOERBQThEO0tBQzNFO1NBQU07UUFDTCwyREFBMkQ7UUFDM0QsK0NBQStDO1FBQy9DLE9BQU8sR0FBRyxDQUFDLENBQUMsMENBQTBDO0tBQ3ZEO0FBQ0gsQ0FBQztBQUVEOztHQUVHO0FBQ0gsU0FBUyxxQkFBcUIsQ0FDNUIsV0FBZ0MsRUFDaEMsU0FBOEI7SUFFOUIsOEJBQThCO0lBQzlCLE1BQU0sV0FBVyxHQUFHLE1BQU0sQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDO1NBQzFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQThCLENBQUM7SUFFcEUsZ0NBQWdDO0lBQ2hDLE1BQU0sYUFBYSxHQUFHLE1BQU0sQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDO1NBQzVDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQThCLENBQUM7SUFFcEUscURBQXFEO0lBQ3JELE1BQU0sWUFBWSxHQUFHLFdBQVcsQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxtQkFBbUI7SUFFdEUscURBQXFEO0lBQ3JELE1BQU0sbUJBQW1CLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUMsYUFBYSxDQUFDLEdBQUcsU0FBUyxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUM7SUFDNUYsTUFBTSxjQUFjLEdBQUcsQ0FBQyxHQUFHLG1CQUFtQixDQUFDLENBQUMsNkJBQTZCO0lBRTdFLHlCQUF5QjtJQUN6QixPQUFPLENBQUMsWUFBWSxHQUFHLEdBQUcsQ0FBQyxHQUFHLENBQUMsY0FBYyxHQUFHLEdBQUcsQ0FBQyxDQUFDO0FBQ3ZELENBQUM7QUFFRDs7R0FFRztBQUNILFNBQVMsc0JBQXNCLENBQzdCLEtBQWEsRUFDYixjQUF5QyxFQUN6QyxZQUF1QztJQUV2QyxJQUFJLEtBQUssSUFBSSxHQUFHLEVBQUU7UUFDaEIsT0FBTyxpQkFBaUIsY0FBYywrQkFBK0IsWUFBWSxpRkFBaUYsQ0FBQztLQUNwSztTQUFNLElBQUksS0FBSyxHQUFHLEdBQUcsRUFBRTtRQUN0QixPQUFPLHlCQUF5QixjQUFjLHFDQUFxQyxZQUFZLG9CQUFvQixDQUFDO0tBQ3JIO1NBQU0sSUFBSSxLQUFLLEdBQUcsR0FBRyxFQUFFO1FBQ3RCLE9BQU8sNkJBQTZCLGNBQWMsa0NBQWtDLFlBQVksVUFBVSxDQUFDO0tBQzVHO1NBQU07UUFDTCxPQUFPLG9GQUFvRixZQUFZLG9CQUFvQixDQUFDO0tBQzdIO0FBQ0gsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvR3JlZ0Nhc3Ryby9EZXNrdG9wL1doYXRUb0VhdE5leHQvc3JjL3V0aWxzL2VsZW1lbnRhbENvbXBhdGliaWxpdHkudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHR5cGUgeyBFbGVtZW50YWxQcm9wZXJ0aWVzIH0gZnJvbSAnQC90eXBlcy9hbGNoZW15JztcbmltcG9ydCB7IHJlY2lwZUVsZW1lbnRhbFNlcnZpY2UgfSBmcm9tICdAL3NlcnZpY2VzL1JlY2lwZUVsZW1lbnRhbFNlcnZpY2UnO1xuaW1wb3J0IHsgREVGQVVMVF9FTEVNRU5UQUxfUFJPUEVSVElFUywgRUxFTUVOVFMgfSBmcm9tICdAL2NvbnN0YW50cy9lbGVtZW50YWxDb25zdGFudHMnO1xuaW1wb3J0IHsgZ2V0TGF0ZXN0QXN0cm9sb2dpY2FsU3RhdGUgfSBmcm9tICdAL3NlcnZpY2VzL0FzdHJvbG9naWNhbFNlcnZpY2UnO1xuaW1wb3J0IHsgZ2V0Q3VycmVudEVsZW1lbnRhbFN0YXRlIH0gZnJvbSAnQC91dGlscy9lbGVtZW50YWxVdGlscyc7XG5cbi8qKlxuICogSW50ZXJmYWNlIGZvciBlbGVtZW50YWwgY29tcGF0aWJpbGl0eSByZXN1bHRzXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgRWxlbWVudGFsQ29tcGF0aWJpbGl0eSB7XG4gIGNvbXBhdGliaWxpdHk6IG51bWJlcjsgLy8gMC0xIHNjb3JlXG4gIGRvbWluYW50UGFpcjoge1xuICAgIHJlY2lwZToga2V5b2YgRWxlbWVudGFsUHJvcGVydGllcztcbiAgICB1c2VyOiBrZXlvZiBFbGVtZW50YWxQcm9wZXJ0aWVzO1xuICB9O1xuICBjb21wbGVtZW50YXJ5U2NvcmU6IG51bWJlcjsgLy8gMC0xIHNjb3JlIGZvciBob3cgd2VsbCBlbGVtZW50cyBjb21wbGVtZW50IGVhY2ggb3RoZXJcbiAgYmFsYW5jZVNjb3JlOiBudW1iZXI7IC8vIDAtMSBzY29yZSBmb3Igb3ZlcmFsbCBiYWxhbmNlXG4gIHJlY29tbWVuZGF0aW9uOiBzdHJpbmc7IC8vIFRleHQgcmVjb21tZW5kYXRpb25cbn1cblxuLyoqXG4gKiBDYWxjdWxhdGUgdGhlIGVsZW1lbnRhbCBjb21wYXRpYmlsaXR5IGJldHdlZW4gYSByZWNpcGUgYW5kIHVzZXIncyBwcmVmZXJlbmNlXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBjYWxjdWxhdGVFbGVtZW50YWxDb21wYXRpYmlsaXR5KFxuICByZWNpcGVFbGVtZW50YWw6IEVsZW1lbnRhbFByb3BlcnRpZXMsXG4gIHVzZXJFbGVtZW50YWw6IEVsZW1lbnRhbFByb3BlcnRpZXMgPSBnZXRDdXJyZW50RWxlbWVudGFsU3RhdGUoKVxuKTogUHJvbWlzZTxFbGVtZW50YWxDb21wYXRpYmlsaXR5PiB7XG4gIC8vIEVuc3VyZSBwcm9wZXJ0aWVzIGFyZSBzdGFuZGFyZGl6ZWRcbiAgY29uc3QgcmVjaXBlID0gcmVjaXBlRWxlbWVudGFsU2VydmljZS5zdGFuZGFyZGl6ZVJlY2lwZSh7IGVsZW1lbnRhbFByb3BlcnRpZXM6IHJlY2lwZUVsZW1lbnRhbCB9KTtcbiAgY29uc3QgdXNlciA9IHJlY2lwZUVsZW1lbnRhbFNlcnZpY2Uuc3RhbmRhcmRpemVSZWNpcGUoeyBlbGVtZW50YWxQcm9wZXJ0aWVzOiB1c2VyRWxlbWVudGFsIH0pO1xuICBcbiAgLy8gQ2FsY3VsYXRlIHNpbXBsZSBzaW1pbGFyaXR5IHNjb3JlXG4gIGNvbnN0IHNpbWlsYXJpdHkgPSByZWNpcGVFbGVtZW50YWxTZXJ2aWNlLmNhbGN1bGF0ZVNpbWlsYXJpdHkoXG4gICAgcmVjaXBlLmVsZW1lbnRhbFByb3BlcnRpZXMsXG4gICAgdXNlci5lbGVtZW50YWxQcm9wZXJ0aWVzXG4gICk7XG4gIFxuICAvLyBGaW5kIGRvbWluYW50IGVsZW1lbnRzXG4gIGNvbnN0IHJlY2lwZURvbWluYW50ID0gZ2V0RG9taW5hbnRFbGVtZW50KHJlY2lwZS5lbGVtZW50YWxQcm9wZXJ0aWVzKTtcbiAgY29uc3QgdXNlckRvbWluYW50ID0gZ2V0RG9taW5hbnRFbGVtZW50KHVzZXIuZWxlbWVudGFsUHJvcGVydGllcyk7XG4gIFxuICAvLyBDYWxjdWxhdGUgY29tcGxlbWVudGFyeSBzY29yZSAtIGNoZWNrIGlmIGRvbWluYW50IGVsZW1lbnRzIGNvbXBsZW1lbnQgZWFjaCBvdGhlclxuICBjb25zdCBjb21wbGVtZW50YXJ5U2NvcmUgPSBjYWxjdWxhdGVDb21wbGVtZW50YXJ5U2NvcmUoXG4gICAgcmVjaXBlRG9taW5hbnQsXG4gICAgdXNlckRvbWluYW50XG4gICk7XG4gIFxuICAvLyBDYWxjdWxhdGUgYmFsYW5jZSBzY29yZSAtIGhvdyB3ZWxsIHRoZSByZWNpcGUgYmFsYW5jZXMgdXNlcidzIGVsZW1lbnRhbCBwcm9maWxlXG4gIGNvbnN0IGJhbGFuY2VTY29yZSA9IGNhbGN1bGF0ZUJhbGFuY2VTY29yZShcbiAgICByZWNpcGUuZWxlbWVudGFsUHJvcGVydGllcyxcbiAgICB1c2VyLmVsZW1lbnRhbFByb3BlcnRpZXNcbiAgKTtcbiAgXG4gIC8vIENhbGN1bGF0ZSBvdmVyYWxsIGNvbXBhdGliaWxpdHkgKHdlaWdodGVkIGF2ZXJhZ2UpXG4gIGNvbnN0IGNvbXBhdGliaWxpdHkgPSAoXG4gICAgc2ltaWxhcml0eSAqIDAuNCArXG4gICAgY29tcGxlbWVudGFyeVNjb3JlICogMC4zICtcbiAgICBiYWxhbmNlU2NvcmUgKiAwLjNcbiAgKTtcbiAgXG4gIHJldHVybiB7XG4gICAgY29tcGF0aWJpbGl0eTogTWF0aC5taW4oMSwgTWF0aC5tYXgoMCwgY29tcGF0aWJpbGl0eSkpLFxuICAgIGRvbWluYW50UGFpcjoge1xuICAgICAgcmVjaXBlOiByZWNpcGVEb21pbmFudCxcbiAgICAgIHVzZXI6IHVzZXJEb21pbmFudFxuICAgIH0sXG4gICAgY29tcGxlbWVudGFyeVNjb3JlLFxuICAgIGJhbGFuY2VTY29yZSxcbiAgICByZWNvbW1lbmRhdGlvbjogZ2VuZXJhdGVSZWNvbW1lbmRhdGlvbihcbiAgICAgIGNvbXBhdGliaWxpdHksXG4gICAgICByZWNpcGVEb21pbmFudCxcbiAgICAgIHVzZXJEb21pbmFudFxuICAgIClcbiAgfTtcbn1cblxuLyoqXG4gKiBHZXQgdGhlIGRvbWluYW50IGVsZW1lbnQgZnJvbSBlbGVtZW50YWwgcHJvcGVydGllc1xuICovXG5mdW5jdGlvbiBnZXREb21pbmFudEVsZW1lbnQocHJvcHM6IEVsZW1lbnRhbFByb3BlcnRpZXMpOiBrZXlvZiBFbGVtZW50YWxQcm9wZXJ0aWVzIHtcbiAgcmV0dXJuIE9iamVjdC5lbnRyaWVzKHByb3BzKVxuICAgIC5zb3J0KChbLCBhXSwgWywgYl0pID0+IGIgLSBhKVswXVswXSBhcyBrZXlvZiBFbGVtZW50YWxQcm9wZXJ0aWVzO1xufVxuXG4vKipcbiAqIENhbGN1bGF0ZSBob3cgd2VsbCB0d28gZWxlbWVudHMgY29tcGxlbWVudCBlYWNoIG90aGVyXG4gKiBFYWNoIGVsZW1lbnQgc2hvdWxkIGJlIHRyZWF0ZWQgaW5kaXZpZHVhbGx5LCB3aXRob3V0IG9wcG9zaXRpb25cbiAqL1xuZnVuY3Rpb24gY2FsY3VsYXRlQ29tcGxlbWVudGFyeVNjb3JlKFxuICBlbGVtZW50MToga2V5b2YgRWxlbWVudGFsUHJvcGVydGllcyxcbiAgZWxlbWVudDI6IGtleW9mIEVsZW1lbnRhbFByb3BlcnRpZXNcbik6IG51bWJlciB7XG4gIC8vIEFsbCBlbGVtZW50cyB3b3JrIHRvZ2V0aGVyIGluIHZhcmlvdXMgd2F5c1xuICBpZiAoZWxlbWVudDEgPT09IGVsZW1lbnQyKSB7XG4gICAgcmV0dXJuIDAuOTsgLy8gU2FtZSBlbGVtZW50IC0gaGlnaGVzdCBjb21wYXRpYmlsaXR5IChsaWtlIHJlaW5mb3JjZXMgbGlrZSlcbiAgfSBlbHNlIHtcbiAgICAvLyBBbGwgY29tYmluYXRpb25zIG9mIGRpZmZlcmVudCBlbGVtZW50cyBhcmUgY29tcGxlbWVudGFyeVxuICAgIC8vIFByb3ZpZGluZyBkaWZmZXJlbnQgeWV0IGhhcm1vbmlvdXMgcXVhbGl0aWVzXG4gICAgcmV0dXJuIDAuNzsgLy8gRGlmZmVyZW50IGVsZW1lbnRzIC0gZ29vZCBjb21wYXRpYmlsaXR5XG4gIH1cbn1cblxuLyoqXG4gKiBDYWxjdWxhdGUgaG93IHdlbGwgcmVjaXBlIGJhbGFuY2VzIHVzZXIncyBlbGVtZW50YWwgcHJvZmlsZVxuICovXG5mdW5jdGlvbiBjYWxjdWxhdGVCYWxhbmNlU2NvcmUoXG4gIHJlY2lwZVByb3BzOiBFbGVtZW50YWxQcm9wZXJ0aWVzLFxuICB1c2VyUHJvcHM6IEVsZW1lbnRhbFByb3BlcnRpZXNcbik6IG51bWJlciB7XG4gIC8vIEZpbmQgdXNlcidzIHdlYWtlc3QgZWxlbWVudFxuICBjb25zdCB1c2VyV2Vha2VzdCA9IE9iamVjdC5lbnRyaWVzKHVzZXJQcm9wcylcbiAgICAuc29ydCgoWywgYV0sIFssIGJdKSA9PiBhIC0gYilbMF1bMF0gYXMga2V5b2YgRWxlbWVudGFsUHJvcGVydGllcztcbiAgXG4gIC8vIEZpbmQgdXNlcidzIHN0cm9uZ2VzdCBlbGVtZW50XG4gIGNvbnN0IHVzZXJTdHJvbmdlc3QgPSBPYmplY3QuZW50cmllcyh1c2VyUHJvcHMpXG4gICAgLnNvcnQoKFssIGFdLCBbLCBiXSkgPT4gYiAtIGEpWzBdWzBdIGFzIGtleW9mIEVsZW1lbnRhbFByb3BlcnRpZXM7XG4gIFxuICAvLyBDaGVjayBpZiByZWNpcGUgc3RyZW5ndGhlbnMgdXNlcidzIHdlYWtlc3QgZWxlbWVudFxuICBjb25zdCB3ZWFrZXN0U2NvcmUgPSByZWNpcGVQcm9wc1t1c2VyV2Vha2VzdF0gKiAyOyAvLyBIaWdoZXIgaXMgYmV0dGVyXG4gIFxuICAvLyBDaGVjayBpZiByZWNpcGUgbW9kZXJhdGVzIHVzZXIncyBzdHJvbmdlc3QgZWxlbWVudFxuICBjb25zdCBzdHJvbmdlc3REaWZmZXJlbmNlID0gTWF0aC5hYnMocmVjaXBlUHJvcHNbdXNlclN0cm9uZ2VzdF0gLSB1c2VyUHJvcHNbdXNlclN0cm9uZ2VzdF0pO1xuICBjb25zdCBzdHJvbmdlc3RTY29yZSA9IDEgLSBzdHJvbmdlc3REaWZmZXJlbmNlOyAvLyBMb3dlciBkaWZmZXJlbmNlIGlzIGJldHRlclxuICBcbiAgLy8gQ29tYmluZWQgYmFsYW5jZSBzY29yZVxuICByZXR1cm4gKHdlYWtlc3RTY29yZSAqIDAuNikgKyAoc3Ryb25nZXN0U2NvcmUgKiAwLjQpO1xufVxuXG4vKipcbiAqIEdlbmVyYXRlIGEgdGV4dCByZWNvbW1lbmRhdGlvbiBiYXNlZCBvbiBjb21wYXRpYmlsaXR5XG4gKi9cbmZ1bmN0aW9uIGdlbmVyYXRlUmVjb21tZW5kYXRpb24oXG4gIHNjb3JlOiBudW1iZXIsXG4gIHJlY2lwZURvbWluYW50OiBrZXlvZiBFbGVtZW50YWxQcm9wZXJ0aWVzLFxuICB1c2VyRG9taW5hbnQ6IGtleW9mIEVsZW1lbnRhbFByb3BlcnRpZXNcbik6IHN0cmluZyB7XG4gIGlmIChzY29yZSA8PSAwLjQpIHtcbiAgICByZXR1cm4gYFRoaXMgcmVjaXBlJ3MgJHtyZWNpcGVEb21pbmFudH0gZW5lcmd5IGNvbnRyYXN0cyB3aXRoIHlvdXIgJHt1c2VyRG9taW5hbnR9IGVuZXJneS4gVGhpcyBjb250cmFzdHMgd2l0aCB5b3VyIG5hdHVyYWwgYmFsYW5jZSBhbmQgbWlnaHQgZmVlbCBkaXNoYXJtb25pb3VzLmA7XG4gIH0gZWxzZSBpZiAoc2NvcmUgPiAwLjgpIHtcbiAgICByZXR1cm4gYEV4Y2VsbGVudCBtYXRjaCEgVGhpcyAke3JlY2lwZURvbWluYW50fS1kb21pbmFudCByZWNpcGUgY29tcGxlbWVudHMgeW91ciAke3VzZXJEb21pbmFudH0gZW5lcmd5IHBlcmZlY3RseS5gO1xuICB9IGVsc2UgaWYgKHNjb3JlID4gMC42KSB7XG4gICAgcmV0dXJuIGBHb29kIG1hdGNoLiBUaGlzIHJlY2lwZSdzICR7cmVjaXBlRG9taW5hbnR9IHF1YWxpdGllcyB3b3JrIHdlbGwgd2l0aCB5b3VyICR7dXNlckRvbWluYW50fSBlbmVyZ3kuYDtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gYE1vZGVyYXRlIG1hdGNoLiBUaGlzIHJlY2lwZSB3aWxsIHByb3ZpZGUgYSBkaWZmZXJlbnQgYnV0IGJhbGFuY2VkIGVuZXJneSB0byB5b3VyICR7dXNlckRvbWluYW50fSBkb21pbmFudCBwcm9maWxlLmA7XG4gIH1cbn0gIl0sInZlcnNpb24iOjN9