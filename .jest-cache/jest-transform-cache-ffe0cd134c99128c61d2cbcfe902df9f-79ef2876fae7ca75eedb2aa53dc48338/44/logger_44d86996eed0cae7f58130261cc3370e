17404f59b0a7416e424888d8d2ed8834
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.errorLog = exports.warnLog = exports.infoLog = exports.debugLog = exports.createLogger = exports.logger = void 0;
const LoggingService_1 = require("@/services/LoggingService");
// Get environment
const isDev = process.env.NODE_ENV !== 'production';
const _isBrowser = typeof window !== 'undefined';
/**
 * Logger class providing centralized logging capabilities
 */
class Logger {
    logLevel = isDev ? 'debug' : 'info';
    recentErrors = [];
    MAX_ERRORS = 20;
    // Track components that have created loggers
    componentLoggers = new Set();
    /**
     * Set the minimum log level
     */
    setLevel(level) {
        this.logLevel = level;
    }
    /**
     * Create a component-specific logger
     * @param component The name of the component or module
     * @returns An object with logging methods specific to the component
     */
    createLogger(component) {
        this.componentLoggers.add(component);
        return {
            debug: (message, ...args) => {
                try {
                    this.debug(message, { component, args });
                }
                catch (e) {
                    // Silent failure - logging errors should not break application
                    console.warn(`[LOGGER-ERROR] Failed to log debug message for ${component}:`, e);
                }
            },
            log: (message, ...args) => {
                try {
                    this.info(message, { component, args });
                }
                catch (e) {
                    console.warn(`[LOGGER-ERROR] Failed to log message for ${component}:`, e);
                }
            },
            info: (message, ...args) => {
                try {
                    this.info(message, { component, args });
                }
                catch (e) {
                    console.warn(`[LOGGER-ERROR] Failed to log info message for ${component}:`, e);
                }
            },
            warn: (message, ...args) => {
                try {
                    this.warn(message, { component, args });
                }
                catch (e) {
                    console.warn(`[LOGGER-ERROR] Failed to log warning for ${component}:`, e);
                }
            },
            error: (message, ...args) => {
                try {
                    this.error(message, { component, args });
                }
                catch (e) {
                    console.error(`[LOGGER-ERROR] Failed to log error for ${component}:`, e);
                }
            },
        };
    }
    /**
     * Log debug information (only in development)
     */
    debug(message, ...args) {
        if (this.shouldLog('debug')) {
            const options = this.extractOptions(args);
            const component = options.component ? `[${options.component}]` : '';
            LoggingService_1.log.debug(`[DEBUG]${component} ${message}`, ...options.rest);
        }
    }
    /**
     * Log general information
     */
    info(message, ...args) {
        if (this.shouldLog('info')) {
            const options = this.extractOptions(args);
            const component = options.component ? `[${options.component}]` : '';
            LoggingService_1.log.info(`[INFO]${component} ${message}`, ...options.rest);
        }
    }
    /**
     * Log warnings
     */
    warn(message, ...args) {
        if (this.shouldLog('warn')) {
            const options = this.extractOptions(args);
            const component = options.component ? `[${options.component}]` : '';
            console.warn(`[WARN]${component} ${message}`, ...options.rest);
        }
    }
    /**
     * Log errors
     */
    error(message, ...args) {
        if (this.shouldLog('error')) {
            const options = this.extractOptions(args);
            const component = options.component ? `[${options.component}]` : '';
            console.error(`[ERROR]${component} ${message}`, ...options.rest);
            // Store error for summary
            this.storeError(message, options.component);
        }
    }
    /**
     * Extract options from args, if last arg is an object with component property
     */
    extractOptions(args) {
        const last = args[args.length - 1];
        if (last && typeof last === 'object' && !Array.isArray(last) && 'component' in last) {
            return {
                component: last.component,
                rest: args.slice(0, args.length - 1),
            };
        }
        return { rest: args };
    }
    /**
     * Store error in recent errors list
     */
    storeError(message, component) {
        this.recentErrors.unshift({
            message,
            timestamp: Date.now(),
            component,
        });
        // Keep list at max length
        if (this.recentErrors.length > this.MAX_ERRORS) {
            this.recentErrors.pop();
        }
    }
    /**
     * Get a summary of recent errors
     */
    getErrorSummary() {
        if (this.recentErrors.length === 0) {
            return 'No recent errors';
        }
        return this.recentErrors
            .map(err => {
            const date = new Date(err.timestamp).toLocaleTimeString();
            const component = err.component ? `[${err.component}]` : '';
            return `[${date}]${component} ${err.message}`;
        })
            .join('\n');
    }
    /**
     * Get a list of all registered components
     */
    getComponents() {
        return [...this.componentLoggers];
    }
    /**
     * Check if we should log at this level
     */
    shouldLog(level) {
        // Ensure the method exists and is accessible
        if (!this.logLevel) {
            return true; // Default to allowing all logs if level is undefined
        }
        const levels = ['debug', 'info', 'warn', 'error'];
        const currentLevelIndex = levels.indexOf(this.logLevel);
        const targetLevelIndex = levels.indexOf(level);
        return targetLevelIndex >= currentLevelIndex;
    }
}
// Singleton instance of the logger with safe initialization
let loggerInstance;
exports.logger = (() => {
    if (!loggerInstance) {
        loggerInstance = new Logger();
    }
    return loggerInstance;
})();
// Helper functions for creating component-specific loggers
const createLogger = (component) => exports.logger.createLogger(component);
exports.createLogger = createLogger;
// Utility functions for direct use (for backwards compatibility)
const debugLog = (message, ...args) => exports.logger.debug(message, ...args);
exports.debugLog = debugLog;
const infoLog = (message, ...args) => exports.logger.info(message, ...args);
exports.infoLog = infoLog;
const warnLog = (message, ...args) => exports.logger.warn(message, ...args);
exports.warnLog = warnLog;
const errorLog = (message, ...args) => exports.logger.error(message, ...args);
exports.errorLog = errorLog;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L2JhY2t1cHMvZmlyc3Qtd2F2ZS0yMDI1LTA4LTExVDA1LTE5LTI2LTgxM1ovc3JjL3V0aWxzL2xvZ2dlci50cyIsIm1hcHBpbmdzIjoiOzs7QUFBQSw4REFBZ0Q7QUFRaEQsa0JBQWtCO0FBQ2xCLE1BQU0sS0FBSyxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsUUFBUSxLQUFLLFlBQVksQ0FBQztBQUNwRCxNQUFNLFVBQVUsR0FBRyxPQUFPLE1BQU0sS0FBSyxXQUFXLENBQUM7QUFFakQ7O0dBRUc7QUFDSCxNQUFNLE1BQU07SUFDRixRQUFRLEdBQWEsS0FBSyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQztJQUM5QyxZQUFZLEdBQXNFLEVBQUUsQ0FBQztJQUM1RSxVQUFVLEdBQUcsRUFBRSxDQUFDO0lBRWpDLDZDQUE2QztJQUNyQyxnQkFBZ0IsR0FBZ0IsSUFBSSxHQUFHLEVBQUUsQ0FBQztJQUVsRDs7T0FFRztJQUNILFFBQVEsQ0FBQyxLQUFlO1FBQ3RCLElBQUksQ0FBQyxRQUFRLEdBQUcsS0FBSyxDQUFDO0lBQ3hCLENBQUM7SUFFRDs7OztPQUlHO0lBQ0gsWUFBWSxDQUFDLFNBQWlCO1FBQzVCLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDLENBQUM7UUFFckMsT0FBTztZQUNMLEtBQUssRUFBRSxDQUFDLE9BQWUsRUFBRSxHQUFHLElBQWUsRUFBUSxFQUFFO2dCQUNuRCxJQUFJO29CQUNGLElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxFQUFFLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUM7aUJBQzFDO2dCQUFDLE9BQU8sQ0FBQyxFQUFFO29CQUNWLCtEQUErRDtvQkFDL0QsT0FBTyxDQUFDLElBQUksQ0FBQyxrREFBa0QsU0FBUyxHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQUM7aUJBQ2pGO1lBQ0gsQ0FBQztZQUNELEdBQUcs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QUFFLEdBQUcsSUFBZSxFQUFRLEVBQUUsQ0FBQyxjQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxHQUFHLElBQUksQ0FBQyxDQUFDO0FBQXZGLFFBQUEsT0FBTyxXQUFnRjtBQUM3RixNQUFNLE9BQU8sR0FBRyxDQUFDLE9BQWUsRUFBRSxHQUFHLElBQWUsRUFBUSxFQUFFLENBQUMsY0FBTSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsR0FBRyxJQUFJLENBQUMsQ0FBQztBQUF2RixRQUFBLE9BQU8sV0FBZ0Y7QUFDN0YsTUFBTSxRQUFRLEdBQUcsQ0FBQyxPQUFlLEVBQUUsR0FBRyxJQUFlLEVBQVEsRUFBRSxDQUNwRSxjQUFNLENBQUMsS0FBSyxDQUFDLE9BQU8sRUFBRSxHQUFHLElBQUksQ0FBQyxDQUFDO0FBRHBCLFFBQUEsUUFBUSxZQUNZIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9HcmVnQ2FzdHJvL0Rlc2t0b3AvV2hhdFRvRWF0TmV4dC9iYWNrdXBzL2ZpcnN0LXdhdmUtMjAyNS0wOC0xMVQwNS0xOS0yNi04MTNaL3NyYy91dGlscy9sb2dnZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgbG9nIH0gZnJvbSAnQC9zZXJ2aWNlcy9Mb2dnaW5nU2VydmljZSc7XG4vKipcbiAqIEFkdmFuY2VkIGxvZ2dlciB1dGlsaXR5IHRvIHN0YW5kYXJkaXplIGxvZ2dpbmcgYWNyb3NzIHRoZSBhcHBsaWNhdGlvbi5cbiAqIFRoaXMgbW9kdWxlIHByb3ZpZGVzIGNvbXBvbmVudC1zcGVjaWZpYyBsb2dnaW5nIGNhcGFiaWxpdGllcyBhbmQgY29uc2lzdGVudCBmb3JtYXR0aW5nLlxuICovXG5cbnR5cGUgTG9nTGV2ZWwgPSAnZGVidWcnIHwgJ2luZm8nIHwgJ3dhcm4nIHwgJ2Vycm9yJztcblxuLy8gR2V0IGVudmlyb25tZW50XG5jb25zdCBpc0RldiA9IHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbic7XG5jb25zdCBfaXNCcm93c2VyID0gdHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCc7XG5cbi8qKlxuICogTG9nZ2VyIGNsYXNzIHByb3ZpZGluZyBjZW50cmFsaXplZCBsb2dnaW5nIGNhcGFiaWxpdGllc1xuICovXG5jbGFzcyBMb2dnZXIge1xuICBwcml2YXRlIGxvZ0xldmVsOiBMb2dMZXZlbCA9IGlzRGV2ID8gJ2RlYnVnJyA6ICdpbmZvJztcbiAgcHJpdmF0ZSByZWNlbnRFcnJvcnM6IEFycmF5PHsgbWVzc2FnZTogc3RyaW5nOyB0aW1lc3RhbXA6IG51bWJlcjsgY29tcG9uZW50Pzogc3RyaW5nIH0+ID0gW107XG4gIHByaXZhdGUgcmVhZG9ubHkgTUFYX0VSUk9SUyA9IDIwO1xuXG4gIC8vIFRyYWNrIGNvbXBvbmVudHMgdGhhdCBoYXZlIGNyZWF0ZWQgbG9nZ2Vyc1xuICBwcml2YXRlIGNvbXBvbmVudExvZ2dlcnM6IFNldDxzdHJpbmc+ID0gbmV3IFNldCgpO1xuXG4gIC8qKlxuICAgKiBTZXQgdGhlIG1pbmltdW0gbG9nIGxldmVsXG4gICAqL1xuICBzZXRMZXZlbChsZXZlbDogTG9nTGV2ZWwpOiB2b2lkIHtcbiAgICB0aGlzLmxvZ0xldmVsID0gbGV2ZWw7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIGEgY29tcG9uZW50LXNwZWNpZmljIGxvZ2dlclxuICAgKiBAcGFyYW0gY29tcG9uZW50IFRoZSBuYW1lIG9mIHRoZSBjb21wb25lbnQgb3IgbW9kdWxlXG4gICAqIEByZXR1cm5zIEFuIG9iamVjdCB3aXRoIGxvZ2dpbmcgbWV0aG9kcyBzcGVjaWZpYyB0byB0aGUgY29tcG9uZW50XG4gICAqL1xuICBjcmVhdGVMb2dnZXIoY29tcG9uZW50OiBzdHJpbmcpIHtcbiAgICB0aGlzLmNvbXBvbmVudExvZ2dlcnMuYWRkKGNvbXBvbmVudCk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgZGVidWc6IChtZXNzYWdlOiBzdHJpbmcsIC4uLmFyZ3M6IHVua25vd25bXSk6IHZvaWQgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIHRoaXMuZGVidWcobWVzc2FnZSwgeyBjb21wb25lbnQsIGFyZ3MgfSk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAvLyBTaWxlbnQgZmFpbHVyZSAtIGxvZ2dpbmcgZXJyb3JzIHNob3VsZCBub3QgYnJlYWsgYXBwbGljYXRpb25cbiAgICAgICAgICBjb25zb2xlLndhcm4oYFtMT0dHRVItRVJST1JdIEZhaWxlZCB0byBsb2cgZGVidWcgbWVzc2FnZSBmb3IgJHtjb21wb25lbnR9OmAsIGUpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgbG9nOiAobWVzc2FnZTogc3RyaW5nLCAuLi5hcmdzOiB1bmtub3duW10pOiB2b2lkID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICB0aGlzLmluZm8obWVzc2FnZSwgeyBjb21wb25lbnQsIGFyZ3MgfSk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICBjb25zb2xlLndhcm4oYFtMT0dHRVItRVJST1JdIEZhaWxlZCB0byBsb2cgbWVzc2FnZSBmb3IgJHtjb21wb25lbnR9OmAsIGUpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgaW5mbzogKG1lc3NhZ2U6IHN0cmluZywgLi4uYXJnczogdW5rbm93bltdKTogdm9pZCA9PiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgdGhpcy5pbmZvKG1lc3NhZ2UsIHsgY29tcG9uZW50LCBhcmdzIH0pO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgY29uc29sZS53YXJuKGBbTE9HR0VSLUVSUk9SXSBGYWlsZWQgdG8gbG9nIGluZm8gbWVzc2FnZSBmb3IgJHtjb21wb25lbnR9OmAsIGUpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgd2FybjogKG1lc3NhZ2U6IHN0cmluZywgLi4uYXJnczogdW5rbm93bltdKTogdm9pZCA9PiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgdGhpcy53YXJuKG1lc3NhZ2UsIHsgY29tcG9uZW50LCBhcmdzIH0pO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgY29uc29sZS53YXJuKGBbTE9HR0VSLUVSUk9SXSBGYWlsZWQgdG8gbG9nIHdhcm5pbmcgZm9yICR7Y29tcG9uZW50fTpgLCBlKTtcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGVycm9yOiAobWVzc2FnZTogc3RyaW5nLCAuLi5hcmdzOiB1bmtub3duW10pOiB2b2lkID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICB0aGlzLmVycm9yKG1lc3NhZ2UsIHsgY29tcG9uZW50LCBhcmdzIH0pO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihgW0xPR0dFUi1FUlJPUl0gRmFpbGVkIHRvIGxvZyBlcnJvciBmb3IgJHtjb21wb25lbnR9OmAsIGUpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogTG9nIGRlYnVnIGluZm9ybWF0aW9uIChvbmx5IGluIGRldmVsb3BtZW50KVxuICAgKi9cbiAgZGVidWcobWVzc2FnZTogc3RyaW5nLCAuLi5hcmdzOiB1bmtub3duW10pOiB2b2lkIHtcbiAgICBpZiAodGhpcy5zaG91bGRMb2coJ2RlYnVnJykpIHtcbiAgICAgIGNvbnN0IG9wdGlvbnMgPSB0aGlzLmV4dHJhY3RPcHRpb25zKGFyZ3MpO1xuICAgICAgY29uc3QgY29tcG9uZW50ID0gb3B0aW9ucy5jb21wb25lbnQgPyBgWyR7b3B0aW9ucy5jb21wb25lbnR9XWAgOiAnJztcbiAgICAgIGxvZy5kZWJ1ZyhgW0RFQlVHXSR7Y29tcG9uZW50fSAke21lc3NhZ2V9YCwgLi4uKG9wdGlvbnMucmVzdCBhcyBhbnlbXSkpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBMb2cgZ2VuZXJhbCBpbmZvcm1hdGlvblxuICAgKi9cbiAgaW5mbyhtZXNzYWdlOiBzdHJpbmcsIC4uLmFyZ3M6IHVua25vd25bXSk6IHZvaWQge1xuICAgIGlmICh0aGlzLnNob3VsZExvZygnaW5mbycpKSB7XG4gICAgICBjb25zdCBvcHRpb25zID0gdGhpcy5leHRyYWN0T3B0aW9ucyhhcmdzKTtcbiAgICAgIGNvbnN0IGNvbXBvbmVudCA9IG9wdGlvbnMuY29tcG9uZW50ID8gYFske29wdGlvbnMuY29tcG9uZW50fV1gIDogJyc7XG4gICAgICBsb2cuaW5mbyhgW0lORk9dJHtjb21wb25lbnR9ICR7bWVzc2FnZX1gLCAuLi4ob3B0aW9ucy5yZXN0IGFzIGFueVtdKSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIExvZyB3YXJuaW5nc1xuICAgKi9cbiAgd2FybihtZXNzYWdlOiBzdHJpbmcsIC4uLmFyZ3M6IHVua25vd25bXSk6IHZvaWQge1xuICAgIGlmICh0aGlzLnNob3VsZExvZygnd2FybicpKSB7XG4gICAgICBjb25zdCBvcHRpb25zID0gdGhpcy5leHRyYWN0T3B0aW9ucyhhcmdzKTtcbiAgICAgIGNvbnN0IGNvbXBvbmVudCA9IG9wdGlvbnMuY29tcG9uZW50ID8gYFske29wdGlvbnMuY29tcG9uZW50fV1gIDogJyc7XG4gICAgICBjb25zb2xlLndhcm4oYFtXQVJOXSR7Y29tcG9uZW50fSAke21lc3NhZ2V9YCwgLi4ub3B0aW9ucy5yZXN0KTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogTG9nIGVycm9yc1xuICAgKi9cbiAgZXJyb3IobWVzc2FnZTogc3RyaW5nLCAuLi5hcmdzOiB1bmtub3duW10pOiB2b2lkIHtcbiAgICBpZiAodGhpcy5zaG91bGRMb2coJ2Vycm9yJykpIHtcbiAgICAgIGNvbnN0IG9wdGlvbnMgPSB0aGlzLmV4dHJhY3RPcHRpb25zKGFyZ3MpO1xuICAgICAgY29uc3QgY29tcG9uZW50ID0gb3B0aW9ucy5jb21wb25lbnQgPyBgWyR7b3B0aW9ucy5jb21wb25lbnR9XWAgOiAnJztcbiAgICAgIGNvbnNvbGUuZXJyb3IoYFtFUlJPUl0ke2NvbXBvbmVudH0gJHttZXNzYWdlfWAsIC4uLm9wdGlvbnMucmVzdCk7XG5cbiAgICAgIC8vIFN0b3JlIGVycm9yIGZvciBzdW1tYXJ5XG4gICAgICB0aGlzLnN0b3JlRXJyb3IobWVzc2FnZSwgb3B0aW9ucy5jb21wb25lbnQpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBFeHRyYWN0IG9wdGlvbnMgZnJvbSBhcmdzLCBpZiBsYXN0IGFyZyBpcyBhbiBvYmplY3Qgd2l0aCBjb21wb25lbnQgcHJvcGVydHlcbiAgICovXG4gIHByaXZhdGUgZXh0cmFjdE9wdGlvbnMoYXJnczogdW5rbm93bltdKSB7XG4gICAgY29uc3QgbGFzdCA9IGFyZ3NbYXJncy5sZW5ndGggLSAxXTtcbiAgICBpZiAobGFzdCAmJiB0eXBlb2YgbGFzdCA9PT0gJ29iamVjdCcgJiYgIUFycmF5LmlzQXJyYXkobGFzdCkgJiYgJ2NvbXBvbmVudCcgaW4gbGFzdCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgY29tcG9uZW50OiBsYXN0LmNvbXBvbmVudCBhcyBzdHJpbmcsXG4gICAgICAgIHJlc3Q6IGFyZ3Muc2xpY2UoMCwgYXJncy5sZW5ndGggLSAxKSxcbiAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiB7IHJlc3Q6IGFyZ3MgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTdG9yZSBlcnJvciBpbiByZWNlbnQgZXJyb3JzIGxpc3RcbiAgICovXG4gIHByaXZhdGUgc3RvcmVFcnJvcihtZXNzYWdlOiBzdHJpbmcsIGNvbXBvbmVudD86IHN0cmluZyk6IHZvaWQge1xuICAgIHRoaXMucmVjZW50RXJyb3JzLnVuc2hpZnQoe1xuICAgICAgbWVzc2FnZSxcbiAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICAgIGNvbXBvbmVudCxcbiAgICB9KTtcblxuICAgIC8vIEtlZXAgbGlzdCBhdCBtYXggbGVuZ3RoXG4gICAgaWYgKHRoaXMucmVjZW50RXJyb3JzLmxlbmd0aCA+IHRoaXMuTUFYX0VSUk9SUykge1xuICAgICAgdGhpcy5yZWNlbnRFcnJvcnMucG9wKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldCBhIHN1bW1hcnkgb2YgcmVjZW50IGVycm9yc1xuICAgKi9cbiAgZ2V0RXJyb3JTdW1tYXJ5KCk6IHN0cmluZyB7XG4gICAgaWYgKHRoaXMucmVjZW50RXJyb3JzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuICdObyByZWNlbnQgZXJyb3JzJztcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5yZWNlbnRFcnJvcnNcbiAgICAgIC5tYXAoZXJyID0+IHtcbiAgICAgICAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKGVyci50aW1lc3RhbXApLnRvTG9jYWxlVGltZVN0cmluZygpO1xuICAgICAgICBjb25zdCBjb21wb25lbnQgPSBlcnIuY29tcG9uZW50ID8gYFske2Vyci5jb21wb25lbnR9XWAgOiAnJztcbiAgICAgICAgcmV0dXJuIGBbJHtkYXRlfV0ke2NvbXBvbmVudH0gJHtlcnIubWVzc2FnZX1gO1xuICAgICAgfSlcbiAgICAgIC5qb2luKCdcXG4nKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgYSBsaXN0IG9mIGFsbCByZWdpc3RlcmVkIGNvbXBvbmVudHNcbiAgICovXG4gIGdldENvbXBvbmVudHMoKTogc3RyaW5nW10ge1xuICAgIHJldHVybiBbLi4udGhpcy5jb21wb25lbnRMb2dnZXJzXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVjayBpZiB3ZSBzaG91bGQgbG9nIGF0IHRoaXMgbGV2ZWxcbiAgICovXG4gIHByaXZhdGUgc2hvdWxkTG9nKGxldmVsOiBMb2dMZXZlbCk6IGJvb2xlYW4ge1xuICAgIC8vIEVuc3VyZSB0aGUgbWV0aG9kIGV4aXN0cyBhbmQgaXMgYWNjZXNzaWJsZVxuICAgIGlmICghdGhpcy5sb2dMZXZlbCkge1xuICAgICAgcmV0dXJuIHRydWU7IC8vIERlZmF1bHQgdG8gYWxsb3dpbmcgYWxsIGxvZ3MgaWYgbGV2ZWwgaXMgdW5kZWZpbmVkXG4gICAgfVxuXG4gICAgY29uc3QgbGV2ZWxzOiBMb2dMZXZlbFtdID0gWydkZWJ1ZycsICdpbmZvJywgJ3dhcm4nLCAnZXJyb3InXTtcbiAgICBjb25zdCBjdXJyZW50TGV2ZWxJbmRleCA9IGxldmVscy5pbmRleE9mKHRoaXMubG9nTGV2ZWwpO1xuICAgIGNvbnN0IHRhcmdldExldmVsSW5kZXggPSBsZXZlbHMuaW5kZXhPZihsZXZlbCk7XG5cbiAgICByZXR1cm4gdGFyZ2V0TGV2ZWxJbmRleCA+PSBjdXJyZW50TGV2ZWxJbmRleDtcbiAgfVxufVxuXG4vLyBTaW5nbGV0b24gaW5zdGFuY2Ugb2YgdGhlIGxvZ2dlciB3aXRoIHNhZmUgaW5pdGlhbGl6YXRpb25cbmxldCBsb2dnZXJJbnN0YW5jZTogTG9nZ2VyIHwgdW5kZWZpbmVkO1xuXG5leHBvcnQgY29uc3QgbG9nZ2VyID0gKCgpID0+IHtcbiAgaWYgKCFsb2dnZXJJbnN0YW5jZSkge1xuICAgIGxvZ2dlckluc3RhbmNlID0gbmV3IExvZ2dlcigpO1xuICB9XG4gIHJldHVybiBsb2dnZXJJbnN0YW5jZTtcbn0pKCk7XG5cbi8vIEhlbHBlciBmdW5jdGlvbnMgZm9yIGNyZWF0aW5nIGNvbXBvbmVudC1zcGVjaWZpYyBsb2dnZXJzXG5leHBvcnQgY29uc3QgY3JlYXRlTG9nZ2VyID0gKGNvbXBvbmVudDogc3RyaW5nKSA9PiBsb2dnZXIuY3JlYXRlTG9nZ2VyKGNvbXBvbmVudCk7XG5cbi8vIFV0aWxpdHkgZnVuY3Rpb25zIGZvciBkaXJlY3QgdXNlIChmb3IgYmFja3dhcmRzIGNvbXBhdGliaWxpdHkpXG5leHBvcnQgY29uc3QgZGVidWdMb2cgPSAobWVzc2FnZTogc3RyaW5nLCAuLi5hcmdzOiB1bmtub3duW10pOiB2b2lkID0+XG4gIGxvZ2dlci5kZWJ1ZyhtZXNzYWdlLCAuLi5hcmdzKTtcbmV4cG9ydCBjb25zdCBpbmZvTG9nID0gKG1lc3NhZ2U6IHN0cmluZywgLi4uYXJnczogdW5rbm93bltdKTogdm9pZCA9PiBsb2dnZXIuaW5mbyhtZXNzYWdlLCAuLi5hcmdzKTtcbmV4cG9ydCBjb25zdCB3YXJuTG9nID0gKG1lc3NhZ2U6IHN0cmluZywgLi4uYXJnczogdW5rbm93bltdKTogdm9pZCA9PiBsb2dnZXIud2FybihtZXNzYWdlLCAuLi5hcmdzKTtcbmV4cG9ydCBjb25zdCBlcnJvckxvZyA9IChtZXNzYWdlOiBzdHJpbmcsIC4uLmFyZ3M6IHVua25vd25bXSk6IHZvaWQgPT5cbiAgbG9nZ2VyLmVycm9yKG1lc3NhZ2UsIC4uLmFyZ3MpO1xuIl0sInZlcnNpb24iOjN9