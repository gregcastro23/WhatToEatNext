a31b75918d09dca8b62cabd56508df51
"use strict";
/**
 * Dependency and Security Monitoring System
 * Automated dependency update monitoring and security vulnerability scanning
 * Part of the Kiro Optimization Campaign System
 */
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.DEFAULT_DEPENDENCY_SECURITY_CONFIG = exports.DependencySecurityMonitor = void 0;
const child_process_1 = require("child_process");
const fs = __importStar(require("fs"));
const logger_1 = require("../../utils/logger");
class DependencySecurityMonitor {
    config;
    packageJsonPath;
    constructor(config, packageJsonPath = 'package.json') {
        this.config = config;
        this.packageJsonPath = packageJsonPath;
    }
    /**
     * Execute comprehensive dependency and security monitoring
     */
    async executeDependencySecurityMonitoring() {
        const startTime = Date.now();
        logger_1.logger.info('Starting dependency and security monitoring');
        try {
            const result = {
                dependenciesScanned: 0,
                vulnerabilitiesFound: 0,
                updatesAvailable: 0,
                updatesApplied: 0,
                securityPatchesApplied: 0,
                compatibilityTestsPassed: true,
                errors: [],
                warnings: [],
                securityReport: {
                    vulnerabilities: [],
                    summary: { critical: 0, high: 0, moderate: 0, low: 0, total: 0 },
                    recommendations: []
                },
                updateReport: {
                    availableUpdates: [],
                    appliedUpdates: [],
                    failedUpdates: [],
                    summary: { major: 0, minor: 0, patch: 0, security: 0, total: 0 }
                }
            };
            // Step 1: Scan for security vulnerabilities
            if (this.config.securityScanEnabled) {
                try {
                    result.securityReport = await this.scanSecurityVulnerabilities();
                    result.vulnerabilitiesFound = result.securityReport.summary.total;
                }
                catch (error) {
                    result.errors.push(`Security scan failed: ${error.message || 'Unknown error'}`);
                }
            }
            // Step 2: Check for dependency updates
            try {
                result.updateReport = await this.checkDependencyUpdates();
                result.updatesAvailable = result.updateReport.summary.total;
                result.dependenciesScanned = await this.getDependencyCount();
            }
            catch (error) {
                result.errors.push(`Dependency update check failed: ${error.message || 'Unknown error'}`);
            }
            // Step 3: Apply security patches automatically if enabled
            if (this.config.autoUpdateEnabled) {
                try {
                    const securityUpdates = await this.applySecurityPatches(result.securityReport.vulnerabilities);
                    result.securityPatchesApplied = securityUpdates.length;
                    result.updateReport.appliedUpdates.push(...securityUpdates);
                }
                catch (error) {
                    result.errors.push(`Security patch application failed: ${error.message || 'Unknown error'}`);
                }
            }
            // Step 4: Apply safe dependency updates
            if (this.config.autoUpdateEnabled) {
                try {
                    const safeUpdates = await this.applySafeUpdates(result.updateReport.availableUpdates);
                    result.updatesApplied = safeUpdates.length;
                    result.updateReport.appliedUpdates.push(...safeUpdates);
                }
                catch (error) {
                    result.errors.push(`Safe update application failed: ${error.message || 'Unknown error'}`);
                }
            }
            // Step 5: Run compatibility tests if enabled
            if (this.config.compatibilityTestingEnabled && result.updatesApplied > 0) {
                try {
                    result.compatibilityTestsPassed = await this.runCompatibilityTests();
                }
                catch (error) {
                    result.errors.push(`Compatibility testing failed: ${error.message || 'Unknown error'}`);
                    result.compatibilityTestsPassed = false;
                }
            }
            const executionTime = Date.now() - startTime;
            logger_1.logger.info(`Dependency and security monitoring completed in ${executionTime}ms`, {
                dependenciesScanned: result.dependenciesScanned,
                vulnerabilitiesFound: result.vulnerabilitiesFound,
                updatesApplied: result.updatesApplied
            });
            return result;
        }
        catch (error) {
            logger_1.logger.error('Dependency and security monitoring failed', error);
            return {
                dependenciesScanned: 0,
                vulnerabilitiesFound: 0,
                updatesAvailable: 0,
                updatesApplied: 0,
                securityPatchesApplied: 0,
                compatibilityTestsPassed: false,
                errors: [String(error.message || 'Unknown error')],
                warnings: [],
                securityReport: {
                    vulnerabilities: [],
                    summary: { critical: 0, high: 0, moderate: 0, low: 0, total: 0 },
                    recommendations: []
                },
                updateReport: {
                    availableUpdates: [],
                    appliedUpdates: [],
                    failedUpdates: [],
                    summary: { major: 0, minor: 0, patch: 0, security: 0, total: 0 }
                }
            };
        }
    }
    /**
     * Scan for security vulnerabilities using yarn audit
     */
    async scanSecurityVulnerabilities() {
        try {
            const auditOutput = (0, child_process_1.execSync)('yarn audit --json', {
                encoding: 'utf8',
                stdio: 'pipe',
                timeout: 60000
            });
            const auditData = JSON.parse(auditOutput);
            const vulnerabilities = [];
            const summary = { critical: 0, high: 0, moderate: 0, low: 0, total: 0 };
            // Parse npm audit output
            if (auditData.vulnerabilities) {
                for (const [packageName, vulnData] of Object.entries(auditData.vulnerabilities)) {
                    const vuln = vulnData;
                    const vulnerability = {
                        packageName,
                        currentVersion: vuln.via?.[0]?.range || 'unknown',
                        vulnerableVersions: vuln.range || 'unknown',
                        severity: vuln.severity,
                        cve: vuln.via?.[0]?.source || 'N/A',
                        description: vuln.via?.[0]?.title || 'No description available',
                        fixedVersion: vuln.fixAvailable?.version,
                        patchAvailable: !!vuln.fixAvailable
                    };
                    vulnerabilities.push(vulnerability);
                    summary[vuln.severity]++;
                    summary.total++;
                }
            }
            const recommendations = this.generateSecurityRecommendations(vulnerabilities, summary);
            return {
                vulnerabilities,
                summary,
                recommendations
            };
        }
        catch (error) {
            logger_1.logger.error('Security vulnerability scan failed', error);
            return {
                vulnerabilities: [],
                summary: { critical: 0, high: 0, moderate: 0, low: 0, total: 0 },
                recommendations: ['Failed to scan for vulnerabilities. Please run yarn audit manually.']
            };
        }
    }
    /**
     * Check for available dependency updates
     */
    async checkDependencyUpdates() {
        try {
            const outdatedOutput = (0, child_process_1.execSync)('yarn outdated --json', {
                encoding: 'utf8',
                stdio: 'pipe',
                timeout: 60000
            });
            const outdatedData = JSON.parse(outdatedOutput || '{}');
            const availableUpdates = [];
            const summary = { major: 0, minor: 0, patch: 0, security: 0, total: 0 };
            for (const [packageName, updateInfo] of Object.entries(outdatedData)) {
                const info = updateInfo;
                const updateType = this.determineUpdateType(info.current, info.latest);
                const breakingChanges = updateType === 'major';
                const update = {
                    packageName,
                    currentVersion: info.current,
                    latestVersion: info.latest,
                    updateType,
                    changelogUrl: await this.getChangelogUrl(packageName),
                    breakingChanges,
                    securityFix: false,
                    testingRequired: breakingChanges || this.requiresTesting(packageName)
                };
                availableUpdates.push(update);
                summary[updateType]++;
                summary.total++;
            }
            return {
                availableUpdates,
                appliedUpdates: [],
                failedUpdates: [],
                summary
            };
        }
        catch (error) {
            // yarn outdated returns non-zero exit code when updates are available
            if (error.stdout) {
                try {
                    const outdatedData = JSON.parse(error.stdout || '{}');
                    // Process the data as above
                    return this.processOutdatedData(outdatedData);
                }
                catch (parseError) {
                    logger_1.logger.error('Failed to parse yarn outdated output', parseError);
                }
            }
            return {
                availableUpdates: [],
                appliedUpdates: [],
                failedUpdates: [],
                summary: { major: 0, minor: 0, patch: 0, security: 0, total: 0 }
            };
        }
    }
    /**
     * Apply security patches automatically
     */
    async applySecurityPatches(vulnerabilities) {
        const appliedUpdates = [];
        for (const vuln of vulnerabilities) {
            if (!vuln.patchAvailable)
                continue;
            const shouldAutoFix = this.shouldAutoFixVulnerability(vuln.severity);
            if (!shouldAutoFix)
                continue;
            if (this.config.excludedPackages.includes(vuln.packageName)) {
                logger_1.logger.info(`Skipping excluded package: ${vuln.packageName}`);
                continue;
            }
            try {
                // Apply the security fix
                const updateCommand = vuln.fixedVersion
                    ? `yarn add ${vuln.packageName}@${vuln.fixedVersion}`
                    : `yarn audit --fix`;
                (0, child_process_1.execSync)(updateCommand, {
                    encoding: 'utf8',
                    stdio: 'pipe',
                    timeout: 120000
                });
                const update = {
                    packageName: vuln.packageName,
                    currentVersion: vuln.currentVersion,
                    latestVersion: vuln.fixedVersion || 'patched',
                    updateType: 'patch',
                    breakingChanges: false,
                    securityFix: true,
                    testingRequired: false
                };
                appliedUpdates.push(update);
                logger_1.logger.info(`Applied security patch for ${vuln.packageName}`);
            }
            catch (error) {
                logger_1.logger.error(`Failed to apply security patch for ${vuln.packageName}`, error);
            }
        }
        return appliedUpdates;
    }
    /**
     * Apply safe dependency updates
     */
    async applySafeUpdates(availableUpdates) {
        const appliedUpdates = [];
        for (const update of availableUpdates) {
            if (this.config.excludedPackages.includes(update.packageName)) {
                logger_1.logger.info(`Skipping excluded package: ${update.packageName}`);
                continue;
            }
            const strategy = this.getUpdateStrategy(update);
            if (!strategy || strategy.updateType === 'none')
                continue;
            if (strategy.requiresManualApproval && update.updateType === 'major') {
                logger_1.logger.info(`Skipping major update requiring manual approval: ${update.packageName}`);
                continue;
            }
            try {
                // Apply the update
                const updateCommand = `yarn add ${update.packageName}@${update.latestVersion}`;
                (0, child_process_1.execSync)(updateCommand, {
                    encoding: 'utf8',
                    stdio: 'pipe',
                    timeout: 120000
                });
                appliedUpdates.push(update);
                logger_1.logger.info(`Applied update for ${update.packageName}: ${update.currentVersion} → ${update.latestVersion}`);
                // Run tests if required
                if (strategy.testingRequired && this.config.compatibilityTestingEnabled) {
                    const testsPass = await this.runPackageTests(update.packageName);
                    if (!testsPass) {
                        logger_1.logger.warn(`Tests failed after updating ${update.packageName}, consider rollback`);
                    }
                }
            }
            catch (error) {
                logger_1.logger.error(`Failed to apply update for ${update.packageName}`, error);
            }
        }
        return appliedUpdates;
    }
    /**
     * Run compatibility tests
     */
    async runCompatibilityTests() {
        try {
            // Run TypeScript compilation check
            (0, child_process_1.execSync)('yarn build', {
                encoding: 'utf8',
                stdio: 'pipe',
                timeout: 300000
            });
            // Run test suite
            (0, child_process_1.execSync)('yarn test', {
                encoding: 'utf8',
                stdio: 'pipe',
                timeout: 300000
            });
            return true;
        }
        catch (error) {
            logger_1.logger.error('Compatibility tests failed', error);
            return false;
        }
    }
    // Private helper methods
    processOutdatedData(outdatedData) {
        const availableUpdates = [];
        const summary = { major: 0, minor: 0, patch: 0, security: 0, total: 0 };
        for (const [packageName, updateInfo] of Object.entries(outdatedData)) {
            const info = updateInfo;
            const updateType = this.determineUpdateType(info.current, info.latest);
            const update = {
                packageName,
                currentVersion: info.current,
                latestVersion: info.latest,
                updateType,
                breakingChanges: updateType === 'major',
                securityFix: false,
                testingRequired: updateType === 'major' || this.requiresTesting(packageName)
            };
            availableUpdates.push(update);
            summary[updateType]++;
            summary.total++;
        }
        return {
            availableUpdates,
            appliedUpdates: [],
            failedUpdates: [],
            summary
        };
    }
    determineUpdateType(current, latest) {
        const currentParts = current.replace(/[^0-9.]/g, '').split('.').map(Number);
        const latestParts = latest.replace(/[^0-9.]/g, '').split('.').map(Number);
        if (latestParts[0] > currentParts[0])
            return 'major';
        if (latestParts[1] > currentParts[1])
            return 'minor';
        return 'patch';
    }
    shouldAutoFixVulnerability(severity) {
        const { securityThresholds } = this.config;
        switch (severity) {
            case 'critical':
                return securityThresholds.autoFixCritical;
            case 'high':
                return securityThresholds.autoFixHigh;
            default:
                return false;
        }
    }
    getUpdateStrategy(update) {
        for (const strategy of this.config.updateStrategies) {
            if (strategy.pattern.test(update.packageName)) {
                return strategy;
            }
        }
        return null;
    }
    requiresTesting(packageName) {
        // Packages that typically require testing after updates
        const testingRequiredPatterns = [
            /^react/,
            /^next/,
            /^typescript/,
            /^@types\//,
            /^eslint/,
            /^jest/,
            /^babel/
        ];
        return testingRequiredPatterns.some(pattern => pattern.test(packageName));
    }
    async getChangelogUrl(packageName) {
        try {
            const packageInfo = (0, child_process_1.execSync)(`yarn info ${packageName} --json`, {
                encoding: 'utf8',
                stdio: 'pipe',
                timeout: 10000
            });
            const info = JSON.parse(packageInfo);
            return info.repository?.url || info.homepage;
        }
        catch (error) {
            return undefined;
        }
    }
    async runPackageTests(packageName) {
        try {
            // Run a subset of tests related to the updated package
            (0, child_process_1.execSync)('yarn test --testNamePattern=".*" --bail', {
                encoding: 'utf8',
                stdio: 'pipe',
                timeout: 60000
            });
            return true;
        }
        catch (error) {
            return false;
        }
    }
    async getDependencyCount() {
        try {
            const packageJson = JSON.parse(fs.readFileSync(this.packageJsonPath, 'utf8'));
            const deps = Object.keys(packageJson.dependencies || {});
            const devDeps = Object.keys(packageJson.devDependencies || {});
            return deps.length + devDeps.length;
        }
        catch (error) {
            return 0;
        }
    }
    generateSecurityRecommendations(vulnerabilities, summary) {
        const recommendations = [];
        if (summary.critical > 0) {
            recommendations.push(`🚨 ${summary.critical} critical vulnerabilities found - immediate action required`);
        }
        if (summary.high > 0) {
            recommendations.push(`⚠️ ${summary.high} high severity vulnerabilities found - update as soon as possible`);
        }
        if (summary.moderate > 0) {
            recommendations.push(`📋 ${summary.moderate} moderate vulnerabilities found - plan updates`);
        }
        const patchableVulns = vulnerabilities.filter(v => v.patchAvailable);
        if (patchableVulns.length > 0) {
            recommendations.push(`✅ ${patchableVulns.length} vulnerabilities have patches available`);
        }
        if (summary.total === 0) {
            recommendations.push('✅ No security vulnerabilities found');
        }
        return recommendations;
    }
}
exports.DependencySecurityMonitor = DependencySecurityMonitor;
/**
 * Default configuration for dependency and security monitoring
 */
exports.DEFAULT_DEPENDENCY_SECURITY_CONFIG = {
    maxDependenciesPerBatch: 10,
    safetyValidationEnabled: true,
    autoUpdateEnabled: false,
    securityScanEnabled: true,
    compatibilityTestingEnabled: true,
    updateStrategies: [
        {
            name: 'Security patches',
            description: 'Automatically apply security patches',
            pattern: /.*/,
            updateType: 'patch',
            requiresManualApproval: false,
            testingRequired: false
        },
        {
            name: 'TypeScript ecosystem',
            description: 'Careful updates for TypeScript-related packages',
            pattern: /^(@types\/|typescript|ts-)/,
            updateType: 'minor',
            requiresManualApproval: true,
            testingRequired: true
        },
        {
            name: 'React ecosystem',
            description: 'Careful updates for React-related packages',
            pattern: /^(react|@react|next)/,
            updateType: 'minor',
            requiresManualApproval: true,
            testingRequired: true
        },
        {
            name: 'Development tools',
            description: 'Safe updates for development tools',
            pattern: /^(eslint|prettier|jest|babel)/,
            updateType: 'minor',
            requiresManualApproval: false,
            testingRequired: true
        }
    ],
    securityThresholds: {
        critical: 0,
        high: 5,
        moderate: 10,
        low: 20,
        autoFixCritical: true,
        autoFixHigh: false
    },
    excludedPackages: [
        // Packages to never auto-update
        'react',
        'react-dom',
        'next',
        'typescript'
    ]
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9zZXJ2aWNlcy9jYW1wYWlnbi9EZXBlbmRlbmN5U2VjdXJpdHlNb25pdG9yLnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7OztHQUlHOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUVILGlEQUF5QztBQUN6Qyx1Q0FBeUI7QUFHekIsK0NBQTRDO0FBeUc1QyxNQUFhLHlCQUF5QjtJQUM1QixNQUFNLENBQTJCO0lBQ2pDLGVBQWUsQ0FBUztJQUVoQyxZQUFZLE1BQWdDLEVBQUUsa0JBQTBCLGNBQWM7UUFDcEYsSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUM7UUFDckIsSUFBSSxDQUFDLGVBQWUsR0FBRyxlQUFlLENBQUM7SUFDekMsQ0FBQztJQUVEOztPQUVHO0lBQ0gsS0FBSyxDQUFDLG1DQUFtQztRQUN2QyxNQUFNLFNBQVMsR0FBRyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUM7UUFDN0IsZUFBTSxDQUFDLElBQUksQ0FBQyw2Q0FBNkMsQ0FBQyxDQUFDO1FBRTNELElBQUk7WUFDRixNQUFNLE1BQU0sR0FBNkI7Z0JBQ3ZDLG1CQUFtQixFQUFFLENBQUM7Z0JBQ3RCLG9CQUFvQixFQUFFLENBQUM7Z0JBQ3ZCLGdCQUFnQixFQUFFLENBQUM7Z0JBQ25CLGNBQWMsRUFBRSxDQUFDO2dCQUNqQixzQkFBc0IsRUFBRSxDQUFDO2dCQUN6Qix3QkFBd0IsRUFBRSxJQUFJO2dCQUM5QixNQUFNLEVBQUUsRUFBRTtnQkFDVixRQUFRLEVBQUUsRUFBRTtnQkFDWixjQUFjLEVBQUU7b0JBQ2QsZUFBZSxFQUFFLEVBQUU7b0JBQ25CLE9BQU8sRUFBRSxFQUFFLFFBQVEsRUFBRSxDQUFDLEVBQUUsSUFBSSxFQUFFLENBQUMsRUFBRSxRQUFRLEVBQUUsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLEVBQUUsS0FBSyxFQUFFLENBQUMsRUFBRTtvQkFDaEUsZUFBZSxFQUFFLEVBQUU7aUJBQ3BCO2dCQUNELFlBQVksRUFB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QUksRUFBRSxDQUFDO1FBQ1AsUUFBUSxFQUFFLEVBQUU7UUFDWixHQUFHLEVBQUUsRUFBRTtRQUNQLGVBQWUsRUFBRSxJQUFJO1FBQ3JCLFdBQVcsRUFBRSxLQUFLO0tBQ25CO0lBQ0QsZ0JBQWdCLEVBQUU7UUFDaEIsZ0NBQWdDO1FBQ2hDLE9BQU87UUFDUCxXQUFXO1FBQ1gsTUFBTTtRQUNOLFlBQVk7S0FDYjtDQUNGLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9zZXJ2aWNlcy9jYW1wYWlnbi9EZXBlbmRlbmN5U2VjdXJpdHlNb25pdG9yLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogRGVwZW5kZW5jeSBhbmQgU2VjdXJpdHkgTW9uaXRvcmluZyBTeXN0ZW1cbiAqIEF1dG9tYXRlZCBkZXBlbmRlbmN5IHVwZGF0ZSBtb25pdG9yaW5nIGFuZCBzZWN1cml0eSB2dWxuZXJhYmlsaXR5IHNjYW5uaW5nXG4gKiBQYXJ0IG9mIHRoZSBLaXJvIE9wdGltaXphdGlvbiBDYW1wYWlnbiBTeXN0ZW1cbiAqL1xuXG5pbXBvcnQgeyBleGVjU3luYyB9IGZyb20gJ2NoaWxkX3Byb2Nlc3MnO1xuaW1wb3J0ICogYXMgZnMgZnJvbSAnZnMnO1xuaW1wb3J0ICogYXMgcGF0aCBmcm9tICdwYXRoJztcblxuaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSAnLi4vLi4vdXRpbHMvbG9nZ2VyJztcblxuZXhwb3J0IGludGVyZmFjZSBEZXBlbmRlbmN5U2VjdXJpdHlDb25maWcge1xuICBtYXhEZXBlbmRlbmNpZXNQZXJCYXRjaDogbnVtYmVyO1xuICBzYWZldHlWYWxpZGF0aW9uRW5hYmxlZDogYm9vbGVhbjtcbiAgYXV0b1VwZGF0ZUVuYWJsZWQ6IGJvb2xlYW47XG4gIHNlY3VyaXR5U2NhbkVuYWJsZWQ6IGJvb2xlYW47XG4gIGNvbXBhdGliaWxpdHlUZXN0aW5nRW5hYmxlZDogYm9vbGVhbjtcbiAgdXBkYXRlU3RyYXRlZ2llczogVXBkYXRlU3RyYXRlZ3lbXTtcbiAgc2VjdXJpdHlUaHJlc2hvbGRzOiBTZWN1cml0eVRocmVzaG9sZHM7XG4gIGV4Y2x1ZGVkUGFja2FnZXM6IHN0cmluZ1tdO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFVwZGF0ZVN0cmF0ZWd5IHtcbiAgbmFtZTogc3RyaW5nO1xuICBkZXNjcmlwdGlvbjogc3RyaW5nO1xuICBwYXR0ZXJuOiBSZWdFeHA7XG4gIHVwZGF0ZVR5cGU6ICdtYWpvcicgfCAnbWlub3InIHwgJ3BhdGNoJyB8ICdub25lJztcbiAgcmVxdWlyZXNNYW51YWxBcHByb3ZhbDogYm9vbGVhbjtcbiAgdGVzdGluZ1JlcXVpcmVkOiBib29sZWFuO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFNlY3VyaXR5VGhyZXNob2xkcyB7XG4gIGNyaXRpY2FsOiBudW1iZXI7XG4gIGhpZ2g6IG51bWJlcjtcbiAgbW9kZXJhdGU6IG51bWJlcjtcbiAgbG93OiBudW1iZXI7XG4gIGF1dG9GaXhDcml0aWNhbDogYm9vbGVhbjtcbiAgYXV0b0ZpeEhpZ2g6IGJvb2xlYW47XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgRGVwZW5kZW5jeVNlY3VyaXR5UmVzdWx0IHtcbiAgZGVwZW5kZW5jaWVzU2Nhbm5lZDogbnVtYmVyO1xuICB2dWxuZXJhYmlsaXRpZXNGb3VuZDogbnVtYmVyO1xuICB1cGRhdGVzQXZhaWxhYmxlOiBudW1iZXI7XG4gIHVwZGF0ZXNBcHBsaWVkOiBudW1iZXI7XG4gIHNlY3VyaXR5UGF0Y2hlc0FwcGxpZWQ6IG51bWJlcjtcbiAgY29tcGF0aWJpbGl0eVRlc3RzUGFzc2VkOiBib29sZWFuO1xuICBlcnJvcnM6IHN0cmluZ1tdO1xuICB3YXJuaW5nczogc3RyaW5nW107XG4gIHNlY3VyaXR5UmVwb3J0OiBTZWN1cml0eVJlcG9ydDtcbiAgdXBkYXRlUmVwb3J0OiBVcGRhdGVSZXBvcnQ7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2VjdXJpdHlSZXBvcnQge1xuICB2dWxuZXJhYmlsaXRpZXM6IFNlY3VyaXR5VnVsbmVyYWJpbGl0eVtdO1xuICBzdW1tYXJ5OiBTZWN1cml0eVN1bW1hcnk7XG4gIHJlY29tbWVuZGF0aW9uczogc3RyaW5nW107XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2VjdXJpdHlWdWxuZXJhYmlsaXR5IHtcbiAgcGFja2FnZU5hbWU6IHN0cmluZztcbiAgY3VycmVudFZlcnNpb246IHN0cmluZztcbiAgdnVsbmVyYWJsZVZlcnNpb25zOiBzdHJpbmc7XG4gIHNldmVyaXR5OiAnY3JpdGljYWwnIHwgJ2hpZ2gnIHwgJ21vZGVyYXRlJyB8ICdsb3cnO1xuICBjdmU6IHN0cmluZztcbiAgZGVzY3JpcHRpb246IHN0cmluZztcbiAgZml4ZWRWZXJzaW9uPzogc3RyaW5nO1xuICBwYXRjaEF2YWlsYWJsZTogYm9vbGVhbjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBTZWN1cml0eVN1bW1hcnkge1xuICBjcml0aWNhbDogbnVtYmVyO1xuICBoaWdoOiBudW1iZXI7XG4gIG1vZGVyYXRlOiBudW1iZXI7XG4gIGxvdzogbnVtYmVyO1xuICB0b3RhbDogbnVtYmVyO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFVwZGF0ZVJlcG9ydCB7XG4gIGF2YWlsYWJsZVVwZGF0ZXM6IERlcGVuZGVuY3lVcGRhdGVbXTtcbiAgYXBwbGllZFVwZGF0ZXM6IERlcGVuZGVuY3lVcGRhdGVbXTtcbiAgZmFpbGVkVXBkYXRlczogRGVwZW5kZW5jeVVwZGF0ZVtdO1xuICBzdW1tYXJ5OiBVcGRhdGVTdW1tYXJ5O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIERlcGVuZGVuY3lVcGRhdGUge1xuICBwYWNrYWdlTmFtZTogc3RyaW5nO1xuICBjdXJyZW50VmVyc2lvbjogc3RyaW5nO1xuICBsYXRlc3RWZXJzaW9uOiBzdHJpbmc7XG4gIHVwZGF0ZVR5cGU6ICdtYWpvcicgfCAnbWlub3InIHwgJ3BhdGNoJztcbiAgY2hhbmdlbG9nVXJsPzogc3RyaW5nO1xuICBicmVha2luZ0NoYW5nZXM6IGJvb2xlYW47XG4gIHNlY3VyaXR5Rml4OiBib29sZWFuO1xuICB0ZXN0aW5nUmVxdWlyZWQ6IGJvb2xlYW47XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVXBkYXRlU3VtbWFyeSB7XG4gIG1ham9yOiBudW1iZXI7XG4gIG1pbm9yOiBudW1iZXI7XG4gIHBhdGNoOiBudW1iZXI7XG4gIHNlY3VyaXR5OiBudW1iZXI7XG4gIHRvdGFsOiBudW1iZXI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUGFja2FnZUluZm8ge1xuICBuYW1lOiBzdHJpbmc7XG4gIGN1cnJlbnRWZXJzaW9uOiBzdHJpbmc7XG4gIGxhdGVzdFZlcnNpb246IHN0cmluZztcbiAgd2FudGVkVmVyc2lvbjogc3RyaW5nO1xuICB0eXBlOiAnZGVwZW5kZW5jaWVzJyB8ICdkZXZEZXBlbmRlbmNpZXMnO1xuICBob21lcGFnZT86IHN0cmluZztcbiAgcmVwb3NpdG9yeT86IHN0cmluZztcbn1cblxuZXhwb3J0IGNsYXNzIERlcGVuZGVuY3lTZWN1cml0eU1vbml0b3Ige1xuICBwcml2YXRlIGNvbmZpZzogRGVwZW5kZW5jeVNlY3VyaXR5Q29uZmlnO1xuICBwcml2YXRlIHBhY2thZ2VKc29uUGF0aDogc3RyaW5nO1xuXG4gIGNvbnN0cnVjdG9yKGNvbmZpZzogRGVwZW5kZW5jeVNlY3VyaXR5Q29uZmlnLCBwYWNrYWdlSnNvblBhdGg6IHN0cmluZyA9ICdwYWNrYWdlLmpzb24nKSB7XG4gICAgdGhpcy5jb25maWcgPSBjb25maWc7XG4gICAgdGhpcy5wYWNrYWdlSnNvblBhdGggPSBwYWNrYWdlSnNvblBhdGg7XG4gIH1cblxuICAvKipcbiAgICogRXhlY3V0ZSBjb21wcmVoZW5zaXZlIGRlcGVuZGVuY3kgYW5kIHNlY3VyaXR5IG1vbml0b3JpbmdcbiAgICovXG4gIGFzeW5jIGV4ZWN1dGVEZXBlbmRlbmN5U2VjdXJpdHlNb25pdG9yaW5nKCk6IFByb21pc2U8RGVwZW5kZW5jeVNlY3VyaXR5UmVzdWx0PiB7XG4gICAgY29uc3Qgc3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICBsb2dnZXIuaW5mbygnU3RhcnRpbmcgZGVwZW5kZW5jeSBhbmQgc2VjdXJpdHkgbW9uaXRvcmluZycpO1xuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3VsdDogRGVwZW5kZW5jeVNlY3VyaXR5UmVzdWx0ID0ge1xuICAgICAgICBkZXBlbmRlbmNpZXNTY2FubmVkOiAwLFxuICAgICAgICB2dWxuZXJhYmlsaXRpZXNGb3VuZDogMCxcbiAgICAgICAgdXBkYXRlc0F2YWlsYWJsZTogMCxcbiAgICAgICAgdXBkYXRlc0FwcGxpZWQ6IDAsXG4gICAgICAgIHNlY3VyaXR5UGF0Y2hlc0FwcGxpZWQ6IDAsXG4gICAgICAgIGNvbXBhdGliaWxpdHlUZXN0c1Bhc3NlZDogdHJ1ZSxcbiAgICAgICAgZXJyb3JzOiBbXSxcbiAgICAgICAgd2FybmluZ3M6IFtdLFxuICAgICAgICBzZWN1cml0eVJlcG9ydDoge1xuICAgICAgICAgIHZ1bG5lcmFiaWxpdGllczogW10sXG4gICAgICAgICAgc3VtbWFyeTogeyBjcml0aWNhbDogMCwgaGlnaDogMCwgbW9kZXJhdGU6IDAsIGxvdzogMCwgdG90YWw6IDAgfSxcbiAgICAgICAgICByZWNvbW1lbmRhdGlvbnM6IFtdXG4gICAgICAgIH0sXG4gICAgICAgIHVwZGF0ZVJlcG9ydDoge1xuICAgICAgICAgIGF2YWlsYWJsZVVwZGF0ZXM6IFtdLFxuICAgICAgICAgIGFwcGxpZWRVcGRhdGVzOiBbXSxcbiAgICAgICAgICBmYWlsZWRVcGRhdGVzOiBbXSxcbiAgICAgICAgICBzdW1tYXJ5OiB7IG1ham9yOiAwLCBtaW5vcjogMCwgcGF0Y2g6IDAsIHNlY3VyaXR5OiAwLCB0b3RhbDogMCB9XG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIC8vIFN0ZXAgMTogU2NhbiBmb3Igc2VjdXJpdHkgdnVsbmVyYWJpbGl0aWVzXG4gICAgICBpZiAodGhpcy5jb25maWcuc2VjdXJpdHlTY2FuRW5hYmxlZCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIHJlc3VsdC5zZWN1cml0eVJlcG9ydCA9IGF3YWl0IHRoaXMuc2NhblNlY3VyaXR5VnVsbmVyYWJpbGl0aWVzKCk7XG4gICAgICAgICAgcmVzdWx0LnZ1bG5lcmFiaWxpdGllc0ZvdW5kID0gcmVzdWx0LnNlY3VyaXR5UmVwb3J0LnN1bW1hcnkudG90YWw7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgcmVzdWx0LmVycm9ycy5wdXNoKGBTZWN1cml0eSBzY2FuIGZhaWxlZDogJHsoZXJyb3IgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pLm1lc3NhZ2UgfHwgJ1Vua25vd24gZXJyb3InfWApO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIFN0ZXAgMjogQ2hlY2sgZm9yIGRlcGVuZGVuY3kgdXBkYXRlc1xuICAgICAgdHJ5IHtcbiAgICAgICAgcmVzdWx0LnVwZGF0ZVJlcG9ydCA9IGF3YWl0IHRoaXMuY2hlY2tEZXBlbmRlbmN5VXBkYXRlcygpO1xuICAgICAgICByZXN1bHQudXBkYXRlc0F2YWlsYWJsZSA9IHJlc3VsdC51cGRhdGVSZXBvcnQuc3VtbWFyeS50b3RhbDtcbiAgICAgICAgcmVzdWx0LmRlcGVuZGVuY2llc1NjYW5uZWQgPSBhd2FpdCB0aGlzLmdldERlcGVuZGVuY3lDb3VudCgpO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgcmVzdWx0LmVycm9ycy5wdXNoKGBEZXBlbmRlbmN5IHVwZGF0ZSBjaGVjayBmYWlsZWQ6ICR7KGVycm9yIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KS5tZXNzYWdlIHx8ICdVbmtub3duIGVycm9yJ31gKTtcbiAgICAgIH1cblxuICAgICAgLy8gU3RlcCAzOiBBcHBseSBzZWN1cml0eSBwYXRjaGVzIGF1dG9tYXRpY2FsbHkgaWYgZW5hYmxlZFxuICAgICAgaWYgKHRoaXMuY29uZmlnLmF1dG9VcGRhdGVFbmFibGVkKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3Qgc2VjdXJpdHlVcGRhdGVzID0gYXdhaXQgdGhpcy5hcHBseVNlY3VyaXR5UGF0Y2hlcyhyZXN1bHQuc2VjdXJpdHlSZXBvcnQudnVsbmVyYWJpbGl0aWVzKTtcbiAgICAgICAgICByZXN1bHQuc2VjdXJpdHlQYXRjaGVzQXBwbGllZCA9IHNlY3VyaXR5VXBkYXRlcy5sZW5ndGg7XG4gICAgICAgICAgcmVzdWx0LnVwZGF0ZVJlcG9ydC5hcHBsaWVkVXBkYXRlcy5wdXNoKC4uLnNlY3VyaXR5VXBkYXRlcyk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgcmVzdWx0LmVycm9ycy5wdXNoKGBTZWN1cml0eSBwYXRjaCBhcHBsaWNhdGlvbiBmYWlsZWQ6ICR7KGVycm9yIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KS5tZXNzYWdlIHx8ICdVbmtub3duIGVycm9yJ31gKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBTdGVwIDQ6IEFwcGx5IHNhZmUgZGVwZW5kZW5jeSB1cGRhdGVzXG4gICAgICBpZiAodGhpcy5jb25maWcuYXV0b1VwZGF0ZUVuYWJsZWQpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zdCBzYWZlVXBkYXRlcyA9IGF3YWl0IHRoaXMuYXBwbHlTYWZlVXBkYXRlcyhyZXN1bHQudXBkYXRlUmVwb3J0LmF2YWlsYWJsZVVwZGF0ZXMpO1xuICAgICAgICAgIHJlc3VsdC51cGRhdGVzQXBwbGllZCA9IHNhZmVVcGRhdGVzLmxlbmd0aDtcbiAgICAgICAgICByZXN1bHQudXBkYXRlUmVwb3J0LmFwcGxpZWRVcGRhdGVzLnB1c2goLi4uc2FmZVVwZGF0ZXMpO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIHJlc3VsdC5lcnJvcnMucHVzaChgU2FmZSB1cGRhdGUgYXBwbGljYXRpb24gZmFpbGVkOiAkeyhlcnJvciBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPikubWVzc2FnZSB8fCAnVW5rbm93biBlcnJvcid9YCk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gU3RlcCA1OiBSdW4gY29tcGF0aWJpbGl0eSB0ZXN0cyBpZiBlbmFibGVkXG4gICAgICBpZiAodGhpcy5jb25maWcuY29tcGF0aWJpbGl0eVRlc3RpbmdFbmFibGVkICYmIHJlc3VsdC51cGRhdGVzQXBwbGllZCA+IDApIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICByZXN1bHQuY29tcGF0aWJpbGl0eVRlc3RzUGFzc2VkID0gYXdhaXQgdGhpcy5ydW5Db21wYXRpYmlsaXR5VGVzdHMoKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICByZXN1bHQuZXJyb3JzLnB1c2goYENvbXBhdGliaWxpdHkgdGVzdGluZyBmYWlsZWQ6ICR7KGVycm9yIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KS5tZXNzYWdlIHx8ICdVbmtub3duIGVycm9yJ31gKTtcbiAgICAgICAgICByZXN1bHQuY29tcGF0aWJpbGl0eVRlc3RzUGFzc2VkID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgY29uc3QgZXhlY3V0aW9uVGltZSA9IERhdGUubm93KCkgLSBzdGFydFRpbWU7XG4gICAgICBsb2dnZXIuaW5mbyhgRGVwZW5kZW5jeSBhbmQgc2VjdXJpdHkgbW9uaXRvcmluZyBjb21wbGV0ZWQgaW4gJHtleGVjdXRpb25UaW1lfW1zYCwge1xuICAgICAgICBkZXBlbmRlbmNpZXNTY2FubmVkOiByZXN1bHQuZGVwZW5kZW5jaWVzU2Nhbm5lZCxcbiAgICAgICAgdnVsbmVyYWJpbGl0aWVzRm91bmQ6IHJlc3VsdC52dWxuZXJhYmlsaXRpZXNGb3VuZCxcbiAgICAgICAgdXBkYXRlc0FwcGxpZWQ6IHJlc3VsdC51cGRhdGVzQXBwbGllZFxuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiByZXN1bHQ7XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdEZXBlbmRlbmN5IGFuZCBzZWN1cml0eSBtb25pdG9yaW5nIGZhaWxlZCcsIGVycm9yKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGRlcGVuZGVuY2llc1NjYW5uZWQ6IDAsXG4gICAgICAgIHZ1bG5lcmFiaWxpdGllc0ZvdW5kOiAwLFxuICAgICAgICB1cGRhdGVzQXZhaWxhYmxlOiAwLFxuICAgICAgICB1cGRhdGVzQXBwbGllZDogMCxcbiAgICAgICAgc2VjdXJpdHlQYXRjaGVzQXBwbGllZDogMCxcbiAgICAgICAgY29tcGF0aWJpbGl0eVRlc3RzUGFzc2VkOiBmYWxzZSxcbiAgICAgICAgZXJyb3JzOiBbU3RyaW5nKChlcnJvciBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPikubWVzc2FnZSB8fCAnVW5rbm93biBlcnJvcicpXSxcbiAgICAgICAgd2FybmluZ3M6IFtdLFxuICAgICAgICBzZWN1cml0eVJlcG9ydDoge1xuICAgICAgICAgIHZ1bG5lcmFiaWxpdGllczogW10sXG4gICAgICAgICAgc3VtbWFyeTogeyBjcml0aWNhbDogMCwgaGlnaDogMCwgbW9kZXJhdGU6IDAsIGxvdzogMCwgdG90YWw6IDAgfSxcbiAgICAgICAgICByZWNvbW1lbmRhdGlvbnM6IFtdXG4gICAgICAgIH0sXG4gICAgICAgIHVwZGF0ZVJlcG9ydDoge1xuICAgICAgICAgIGF2YWlsYWJsZVVwZGF0ZXM6IFtdLFxuICAgICAgICAgIGFwcGxpZWRVcGRhdGVzOiBbXSxcbiAgICAgICAgICBmYWlsZWRVcGRhdGVzOiBbXSxcbiAgICAgICAgICBzdW1tYXJ5OiB7IG1ham9yOiAwLCBtaW5vcjogMCwgcGF0Y2g6IDAsIHNlY3VyaXR5OiAwLCB0b3RhbDogMCB9XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFNjYW4gZm9yIHNlY3VyaXR5IHZ1bG5lcmFiaWxpdGllcyB1c2luZyB5YXJuIGF1ZGl0XG4gICAqL1xuICBhc3luYyBzY2FuU2VjdXJpdHlWdWxuZXJhYmlsaXRpZXMoKTogUHJvbWlzZTxTZWN1cml0eVJlcG9ydD4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBhdWRpdE91dHB1dCA9IGV4ZWNTeW5jKCd5YXJuIGF1ZGl0IC0tanNvbicsIHtcbiAgICAgICAgZW5jb2Rpbmc6ICd1dGY4JyxcbiAgICAgICAgc3RkaW86ICdwaXBlJyxcbiAgICAgICAgdGltZW91dDogNjAwMDBcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBhdWRpdERhdGEgPSBKU09OLnBhcnNlKGF1ZGl0T3V0cHV0KTtcbiAgICAgIGNvbnN0IHZ1bG5lcmFiaWxpdGllczogU2VjdXJpdHlWdWxuZXJhYmlsaXR5W10gPSBbXTtcbiAgICAgIGNvbnN0IHN1bW1hcnk6IFNlY3VyaXR5U3VtbWFyeSA9IHsgY3JpdGljYWw6IDAsIGhpZ2g6IDAsIG1vZGVyYXRlOiAwLCBsb3c6IDAsIHRvdGFsOiAwIH07XG5cbiAgICAgIC8vIFBhcnNlIG5wbSBhdWRpdCBvdXRwdXRcbiAgICAgIGlmIChhdWRpdERhdGEudnVsbmVyYWJpbGl0aWVzKSB7XG4gICAgICAgIGZvciAoY29uc3QgW3BhY2thZ2VOYW1lLCB2dWxuRGF0YV0gb2YgT2JqZWN0LmVudHJpZXMoYXVkaXREYXRhLnZ1bG5lcmFiaWxpdGllcykpIHtcbiAgICAgICAgICBjb25zdCB2dWxuID0gdnVsbkRhdGEgYXMgdW5rbm93biBhcyB7XG4gICAgICAgICAgICB2aWE/OiBBcnJheTx7IHJhbmdlPzogc3RyaW5nOyBzZXZlcml0eT86IHN0cmluZzsgdGl0bGU/OiBzdHJpbmcgfT47XG4gICAgICAgICAgICByYW5nZT86IHN0cmluZztcbiAgICAgICAgICAgIHNldmVyaXR5Pzogc3RyaW5nO1xuICAgICAgICAgICAgbmFtZT86IHN0cmluZztcbiAgICAgICAgICAgIFtrZXk6IHN0cmluZ106IHVua25vd247XG4gICAgICAgICAgfTtcbiAgICAgICAgICBcbiAgICAgICAgICBjb25zdCB2dWxuZXJhYmlsaXR5OiBTZWN1cml0eVZ1bG5lcmFiaWxpdHkgPSB7XG4gICAgICAgICAgICBwYWNrYWdlTmFtZSxcbiAgICAgICAgICAgIGN1cnJlbnRWZXJzaW9uOiB2dWxuLnZpYT8uWzBdPy5yYW5nZSB8fCAndW5rbm93bicsXG4gICAgICAgICAgICB2dWxuZXJhYmxlVmVyc2lvbnM6IHZ1bG4ucmFuZ2UgfHwgJ3Vua25vd24nLFxuICAgICAgICAgICAgc2V2ZXJpdHk6IHZ1bG4uc2V2ZXJpdHksXG4gICAgICAgICAgICBjdmU6IHZ1bG4udmlhPy5bMF0/LnNvdXJjZSB8fCAnTi9BJyxcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiB2dWxuLnZpYT8uWzBdPy50aXRsZSB8fCAnTm8gZGVzY3JpcHRpb24gYXZhaWxhYmxlJyxcbiAgICAgICAgICAgIGZpeGVkVmVyc2lvbjogdnVsbi5maXhBdmFpbGFibGU/LnZlcnNpb24sXG4gICAgICAgICAgICBwYXRjaEF2YWlsYWJsZTogISF2dWxuLmZpeEF2YWlsYWJsZVxuICAgICAgICAgIH07XG5cbiAgICAgICAgICB2dWxuZXJhYmlsaXRpZXMucHVzaCh2dWxuZXJhYmlsaXR5KTtcbiAgICAgICAgICBzdW1tYXJ5W3Z1bG4uc2V2ZXJpdHldKys7XG4gICAgICAgICAgc3VtbWFyeS50b3RhbCsrO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHJlY29tbWVuZGF0aW9ucyA9IHRoaXMuZ2VuZXJhdGVTZWN1cml0eVJlY29tbWVuZGF0aW9ucyh2dWxuZXJhYmlsaXRpZXMsIHN1bW1hcnkpO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICB2dWxuZXJhYmlsaXRpZXMsXG4gICAgICAgIHN1bW1hcnksXG4gICAgICAgIHJlY29tbWVuZGF0aW9uc1xuICAgICAgfTtcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ1NlY3VyaXR5IHZ1bG5lcmFiaWxpdHkgc2NhbiBmYWlsZWQnLCBlcnJvcik7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB2dWxuZXJhYmlsaXRpZXM6IFtdLFxuICAgICAgICBzdW1tYXJ5OiB7IGNyaXRpY2FsOiAwLCBoaWdoOiAwLCBtb2RlcmF0ZTogMCwgbG93OiAwLCB0b3RhbDogMCB9LFxuICAgICAgICByZWNvbW1lbmRhdGlvbnM6IFsnRmFpbGVkIHRvIHNjYW4gZm9yIHZ1bG5lcmFiaWxpdGllcy4gUGxlYXNlIHJ1biB5YXJuIGF1ZGl0IG1hbnVhbGx5LiddXG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVjayBmb3IgYXZhaWxhYmxlIGRlcGVuZGVuY3kgdXBkYXRlc1xuICAgKi9cbiAgYXN5bmMgY2hlY2tEZXBlbmRlbmN5VXBkYXRlcygpOiBQcm9taXNlPFVwZGF0ZVJlcG9ydD4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBvdXRkYXRlZE91dHB1dCA9IGV4ZWNTeW5jKCd5YXJuIG91dGRhdGVkIC0tanNvbicsIHtcbiAgICAgICAgZW5jb2Rpbmc6ICd1dGY4JyxcbiAgICAgICAgc3RkaW86ICdwaXBlJyxcbiAgICAgICAgdGltZW91dDogNjAwMDBcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBvdXRkYXRlZERhdGEgPSBKU09OLnBhcnNlKG91dGRhdGVkT3V0cHV0IHx8ICd7fScpO1xuICAgICAgY29uc3QgYXZhaWxhYmxlVXBkYXRlczogRGVwZW5kZW5jeVVwZGF0ZVtdID0gW107XG4gICAgICBjb25zdCBzdW1tYXJ5OiBVcGRhdGVTdW1tYXJ5ID0geyBtYWpvcjogMCwgbWlub3I6IDAsIHBhdGNoOiAwLCBzZWN1cml0eTogMCwgdG90YWw6IDAgfTtcblxuICAgICAgZm9yIChjb25zdCBbcGFja2FnZU5hbWUsIHVwZGF0ZUluZm9dIG9mIE9iamVjdC5lbnRyaWVzKG91dGRhdGVkRGF0YSkpIHtcbiAgICAgICAgY29uc3QgaW5mbyA9IHVwZGF0ZUluZm8gYXMgdW5rbm93biBhcyB7XG4gICAgICAgICAgY3VycmVudD86IHN0cmluZztcbiAgICAgICAgICB3YW50ZWQ/OiBzdHJpbmc7XG4gICAgICAgICAgbGF0ZXN0Pzogc3RyaW5nO1xuICAgICAgICAgIGRlcGVuZGVudD86IHN0cmluZztcbiAgICAgICAgICBsb2NhdGlvbj86IHN0cmluZztcbiAgICAgICAgICBba2V5OiBzdHJpbmddOiB1bmtub3duO1xuICAgICAgICB9O1xuICAgICAgICBcbiAgICAgICAgY29uc3QgdXBkYXRlVHlwZSA9IHRoaXMuZGV0ZXJtaW5lVXBkYXRlVHlwZShpbmZvLmN1cnJlbnQsIGluZm8ubGF0ZXN0KTtcbiAgICAgICAgY29uc3QgYnJlYWtpbmdDaGFuZ2VzID0gdXBkYXRlVHlwZSA9PT0gJ21ham9yJztcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IHVwZGF0ZTogRGVwZW5kZW5jeVVwZGF0ZSA9IHtcbiAgICAgICAgICBwYWNrYWdlTmFtZSxcbiAgICAgICAgICBjdXJyZW50VmVyc2lvbjogaW5mby5jdXJyZW50LFxuICAgICAgICAgIGxhdGVzdFZlcnNpb246IGluZm8ubGF0ZXN0LFxuICAgICAgICAgIHVwZGF0ZVR5cGUsXG4gICAgICAgICAgY2hhbmdlbG9nVXJsOiBhd2FpdCB0aGlzLmdldENoYW5nZWxvZ1VybChwYWNrYWdlTmFtZSksXG4gICAgICAgICAgYnJlYWtpbmdDaGFuZ2VzLFxuICAgICAgICAgIHNlY3VyaXR5Rml4OiBmYWxzZSwgLy8gV2lsbCBiZSBkZXRlcm1pbmVkIGJ5IGNyb3NzLXJlZmVyZW5jaW5nIHdpdGggc2VjdXJpdHkgc2NhblxuICAgICAgICAgIHRlc3RpbmdSZXF1aXJlZDogYnJlYWtpbmdDaGFuZ2VzIHx8IHRoaXMucmVxdWlyZXNUZXN0aW5nKHBhY2thZ2VOYW1lKVxuICAgICAgICB9O1xuXG4gICAgICAgIGF2YWlsYWJsZVVwZGF0ZXMucHVzaCh1cGRhdGUpO1xuICAgICAgICBzdW1tYXJ5W3VwZGF0ZVR5cGVdKys7XG4gICAgICAgIHN1bW1hcnkudG90YWwrKztcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgYXZhaWxhYmxlVXBkYXRlcyxcbiAgICAgICAgYXBwbGllZFVwZGF0ZXM6IFtdLFxuICAgICAgICBmYWlsZWRVcGRhdGVzOiBbXSxcbiAgICAgICAgc3VtbWFyeVxuICAgICAgfTtcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAvLyB5YXJuIG91dGRhdGVkIHJldHVybnMgbm9uLXplcm8gZXhpdCBjb2RlIHdoZW4gdXBkYXRlcyBhcmUgYXZhaWxhYmxlXG4gICAgICBpZiAoKGVycm9yIGFzIHVua25vd24gYXMgeyBzdGRvdXQ/OiBzdHJpbmcgfSkuc3Rkb3V0KSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3Qgb3V0ZGF0ZWREYXRhID0gSlNPTi5wYXJzZSgoZXJyb3IgYXMgdW5rbm93biBhcyB7IHN0ZG91dDogc3RyaW5nIH0pLnN0ZG91dCB8fCAne30nKTtcbiAgICAgICAgICAvLyBQcm9jZXNzIHRoZSBkYXRhIGFzIGFib3ZlXG4gICAgICAgICAgcmV0dXJuIHRoaXMucHJvY2Vzc091dGRhdGVkRGF0YShvdXRkYXRlZERhdGEpO1xuICAgICAgICB9IGNhdGNoIChwYXJzZUVycm9yKSB7XG4gICAgICAgICAgbG9nZ2VyLmVycm9yKCdGYWlsZWQgdG8gcGFyc2UgeWFybiBvdXRkYXRlZCBvdXRwdXQnLCBwYXJzZUVycm9yKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgXG4gICAgICByZXR1cm4ge1xuICAgICAgICBhdmFpbGFibGVVcGRhdGVzOiBbXSxcbiAgICAgICAgYXBwbGllZFVwZGF0ZXM6IFtdLFxuICAgICAgICBmYWlsZWRVcGRhdGVzOiBbXSxcbiAgICAgICAgc3VtbWFyeTogeyBtYWpvcjogMCwgbWlub3I6IDAsIHBhdGNoOiAwLCBzZWN1cml0eTogMCwgdG90YWw6IDAgfVxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQXBwbHkgc2VjdXJpdHkgcGF0Y2hlcyBhdXRvbWF0aWNhbGx5XG4gICAqL1xuICBhc3luYyBhcHBseVNlY3VyaXR5UGF0Y2hlcyh2dWxuZXJhYmlsaXRpZXM6IFNlY3VyaXR5VnVsbmVyYWJpbGl0eVtdKTogUHJvbWlzZTxEZXBlbmRlbmN5VXBkYXRlW10+IHtcbiAgICBjb25zdCBhcHBsaWVkVXBkYXRlczogRGVwZW5kZW5jeVVwZGF0ZVtdID0gW107XG5cbiAgICBmb3IgKGNvbnN0IHZ1bG4gb2YgdnVsbmVyYWJpbGl0aWVzKSB7XG4gICAgICBpZiAoIXZ1bG4ucGF0Y2hBdmFpbGFibGUpIGNvbnRpbnVlO1xuXG4gICAgICBjb25zdCBzaG91bGRBdXRvRml4ID0gdGhpcy5zaG91bGRBdXRvRml4VnVsbmVyYWJpbGl0eSh2dWxuLnNldmVyaXR5KTtcbiAgICAgIGlmICghc2hvdWxkQXV0b0ZpeCkgY29udGludWU7XG5cbiAgICAgIGlmICh0aGlzLmNvbmZpZy5leGNsdWRlZFBhY2thZ2VzLmluY2x1ZGVzKHZ1bG4ucGFja2FnZU5hbWUpKSB7XG4gICAgICAgIGxvZ2dlci5pbmZvKGBTa2lwcGluZyBleGNsdWRlZCBwYWNrYWdlOiAke3Z1bG4ucGFja2FnZU5hbWV9YCk7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuXG4gICAgICB0cnkge1xuICAgICAgICAvLyBBcHBseSB0aGUgc2VjdXJpdHkgZml4XG4gICAgICAgIGNvbnN0IHVwZGF0ZUNvbW1hbmQgPSB2dWxuLmZpeGVkVmVyc2lvbiBcbiAgICAgICAgICA/IGB5YXJuIGFkZCAke3Z1bG4ucGFja2FnZU5hbWV9QCR7dnVsbi5maXhlZFZlcnNpb259YFxuICAgICAgICAgIDogYHlhcm4gYXVkaXQgLS1maXhgO1xuXG4gICAgICAgIGV4ZWNTeW5jKHVwZGF0ZUNvbW1hbmQsIHtcbiAgICAgICAgICBlbmNvZGluZzogJ3V0ZjgnLFxuICAgICAgICAgIHN0ZGlvOiAncGlwZScsXG4gICAgICAgICAgdGltZW91dDogMTIwMDAwXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IHVwZGF0ZTogRGVwZW5kZW5jeVVwZGF0ZSA9IHtcbiAgICAgICAgICBwYWNrYWdlTmFtZTogdnVsbi5wYWNrYWdlTmFtZSxcbiAgICAgICAgICBjdXJyZW50VmVyc2lvbjogdnVsbi5jdXJyZW50VmVyc2lvbixcbiAgICAgICAgICBsYXRlc3RWZXJzaW9uOiB2dWxuLmZpeGVkVmVyc2lvbiB8fCAncGF0Y2hlZCcsXG4gICAgICAgICAgdXBkYXRlVHlwZTogJ3BhdGNoJyxcbiAgICAgICAgICBicmVha2luZ0NoYW5nZXM6IGZhbHNlLFxuICAgICAgICAgIHNlY3VyaXR5Rml4OiB0cnVlLFxuICAgICAgICAgIHRlc3RpbmdSZXF1aXJlZDogZmFsc2VcbiAgICAgICAgfTtcblxuICAgICAgICBhcHBsaWVkVXBkYXRlcy5wdXNoKHVwZGF0ZSk7XG4gICAgICAgIGxvZ2dlci5pbmZvKGBBcHBsaWVkIHNlY3VyaXR5IHBhdGNoIGZvciAke3Z1bG4ucGFja2FnZU5hbWV9YCk7XG5cbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGxvZ2dlci5lcnJvcihgRmFpbGVkIHRvIGFwcGx5IHNlY3VyaXR5IHBhdGNoIGZvciAke3Z1bG4ucGFja2FnZU5hbWV9YCwgZXJyb3IpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBhcHBsaWVkVXBkYXRlcztcbiAgfVxuXG4gIC8qKlxuICAgKiBBcHBseSBzYWZlIGRlcGVuZGVuY3kgdXBkYXRlc1xuICAgKi9cbiAgYXN5bmMgYXBwbHlTYWZlVXBkYXRlcyhhdmFpbGFibGVVcGRhdGVzOiBEZXBlbmRlbmN5VXBkYXRlW10pOiBQcm9taXNlPERlcGVuZGVuY3lVcGRhdGVbXT4ge1xuICAgIGNvbnN0IGFwcGxpZWRVcGRhdGVzOiBEZXBlbmRlbmN5VXBkYXRlW10gPSBbXTtcblxuICAgIGZvciAoY29uc3QgdXBkYXRlIG9mIGF2YWlsYWJsZVVwZGF0ZXMpIHtcbiAgICAgIGlmICh0aGlzLmNvbmZpZy5leGNsdWRlZFBhY2thZ2VzLmluY2x1ZGVzKHVwZGF0ZS5wYWNrYWdlTmFtZSkpIHtcbiAgICAgICAgbG9nZ2VyLmluZm8oYFNraXBwaW5nIGV4Y2x1ZGVkIHBhY2thZ2U6ICR7dXBkYXRlLnBhY2thZ2VOYW1lfWApO1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cblxuICAgICAgY29uc3Qgc3RyYXRlZ3kgPSB0aGlzLmdldFVwZGF0ZVN0cmF0ZWd5KHVwZGF0ZSk7XG4gICAgICBpZiAoIXN0cmF0ZWd5IHx8IHN0cmF0ZWd5LnVwZGF0ZVR5cGUgPT09ICdub25lJykgY29udGludWU7XG5cbiAgICAgIGlmIChzdHJhdGVneS5yZXF1aXJlc01hbnVhbEFwcHJvdmFsICYmIHVwZGF0ZS51cGRhdGVUeXBlID09PSAnbWFqb3InKSB7XG4gICAgICAgIGxvZ2dlci5pbmZvKGBTa2lwcGluZyBtYWpvciB1cGRhdGUgcmVxdWlyaW5nIG1hbnVhbCBhcHByb3ZhbDogJHt1cGRhdGUucGFja2FnZU5hbWV9YCk7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuXG4gICAgICB0cnkge1xuICAgICAgICAvLyBBcHBseSB0aGUgdXBkYXRlXG4gICAgICAgIGNvbnN0IHVwZGF0ZUNvbW1hbmQgPSBgeWFybiBhZGQgJHt1cGRhdGUucGFja2FnZU5hbWV9QCR7dXBkYXRlLmxhdGVzdFZlcnNpb259YDtcbiAgICAgICAgXG4gICAgICAgIGV4ZWNTeW5jKHVwZGF0ZUNvbW1hbmQsIHtcbiAgICAgICAgICBlbmNvZGluZzogJ3V0ZjgnLFxuICAgICAgICAgIHN0ZGlvOiAncGlwZScsXG4gICAgICAgICAgdGltZW91dDogMTIwMDAwXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGFwcGxpZWRVcGRhdGVzLnB1c2godXBkYXRlKTtcbiAgICAgICAgbG9nZ2VyLmluZm8oYEFwcGxpZWQgdXBkYXRlIGZvciAke3VwZGF0ZS5wYWNrYWdlTmFtZX06ICR7dXBkYXRlLmN1cnJlbnRWZXJzaW9ufSDihpIgJHt1cGRhdGUubGF0ZXN0VmVyc2lvbn1gKTtcblxuICAgICAgICAvLyBSdW4gdGVzdHMgaWYgcmVxdWlyZWRcbiAgICAgICAgaWYgKHN0cmF0ZWd5LnRlc3RpbmdSZXF1aXJlZCAmJiB0aGlzLmNvbmZpZy5jb21wYXRpYmlsaXR5VGVzdGluZ0VuYWJsZWQpIHtcbiAgICAgICAgICBjb25zdCB0ZXN0c1Bhc3MgPSBhd2FpdCB0aGlzLnJ1blBhY2thZ2VUZXN0cyh1cGRhdGUucGFja2FnZU5hbWUpO1xuICAgICAgICAgIGlmICghdGVzdHNQYXNzKSB7XG4gICAgICAgICAgICBsb2dnZXIud2FybihgVGVzdHMgZmFpbGVkIGFmdGVyIHVwZGF0aW5nICR7dXBkYXRlLnBhY2thZ2VOYW1lfSwgY29uc2lkZXIgcm9sbGJhY2tgKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgbG9nZ2VyLmVycm9yKGBGYWlsZWQgdG8gYXBwbHkgdXBkYXRlIGZvciAke3VwZGF0ZS5wYWNrYWdlTmFtZX1gLCBlcnJvcik7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGFwcGxpZWRVcGRhdGVzO1xuICB9XG5cbiAgLyoqXG4gICAqIFJ1biBjb21wYXRpYmlsaXR5IHRlc3RzXG4gICAqL1xuICBhc3luYyBydW5Db21wYXRpYmlsaXR5VGVzdHMoKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIFJ1biBUeXBlU2NyaXB0IGNvbXBpbGF0aW9uIGNoZWNrXG4gICAgICBleGVjU3luYygneWFybiBidWlsZCcsIHtcbiAgICAgICAgZW5jb2Rpbmc6ICd1dGY4JyxcbiAgICAgICAgc3RkaW86ICdwaXBlJyxcbiAgICAgICAgdGltZW91dDogMzAwMDAwXG4gICAgICB9KTtcblxuICAgICAgLy8gUnVuIHRlc3Qgc3VpdGVcbiAgICAgIGV4ZWNTeW5jKCd5YXJuIHRlc3QnLCB7XG4gICAgICAgIGVuY29kaW5nOiAndXRmOCcsXG4gICAgICAgIHN0ZGlvOiAncGlwZScsXG4gICAgICAgIHRpbWVvdXQ6IDMwMDAwMFxuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ0NvbXBhdGliaWxpdHkgdGVzdHMgZmFpbGVkJywgZXJyb3IpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIC8vIFByaXZhdGUgaGVscGVyIG1ldGhvZHNcblxuICBwcml2YXRlIHByb2Nlc3NPdXRkYXRlZERhdGEob3V0ZGF0ZWREYXRhOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPik6IFVwZGF0ZVJlcG9ydCB7XG4gICAgY29uc3QgYXZhaWxhYmxlVXBkYXRlczogRGVwZW5kZW5jeVVwZGF0ZVtdID0gW107XG4gICAgY29uc3Qgc3VtbWFyeTogVXBkYXRlU3VtbWFyeSA9IHsgbWFqb3I6IDAsIG1pbm9yOiAwLCBwYXRjaDogMCwgc2VjdXJpdHk6IDAsIHRvdGFsOiAwIH07XG5cbiAgICBmb3IgKGNvbnN0IFtwYWNrYWdlTmFtZSwgdXBkYXRlSW5mb10gb2YgT2JqZWN0LmVudHJpZXMob3V0ZGF0ZWREYXRhKSkge1xuICAgICAgY29uc3QgaW5mbyA9IHVwZGF0ZUluZm8gYXMgYW55O1xuICAgICAgXG4gICAgICBjb25zdCB1cGRhdGVUeXBlID0gdGhpcy5kZXRlcm1pbmVVcGRhdGVUeXBlKGluZm8uY3VycmVudCwgaW5mby5sYXRlc3QpO1xuICAgICAgXG4gICAgICBjb25zdCB1cGRhdGU6IERlcGVuZGVuY3lVcGRhdGUgPSB7XG4gICAgICAgIHBhY2thZ2VOYW1lLFxuICAgICAgICBjdXJyZW50VmVyc2lvbjogaW5mby5jdXJyZW50LFxuICAgICAgICBsYXRlc3RWZXJzaW9uOiBpbmZvLmxhdGVzdCxcbiAgICAgICAgdXBkYXRlVHlwZSxcbiAgICAgICAgYnJlYWtpbmdDaGFuZ2VzOiB1cGRhdGVUeXBlID09PSAnbWFqb3InLFxuICAgICAgICBzZWN1cml0eUZpeDogZmFsc2UsXG4gICAgICAgIHRlc3RpbmdSZXF1aXJlZDogdXBkYXRlVHlwZSA9PT0gJ21ham9yJyB8fCB0aGlzLnJlcXVpcmVzVGVzdGluZyhwYWNrYWdlTmFtZSlcbiAgICAgIH07XG5cbiAgICAgIGF2YWlsYWJsZVVwZGF0ZXMucHVzaCh1cGRhdGUpO1xuICAgICAgc3VtbWFyeVt1cGRhdGVUeXBlXSsrO1xuICAgICAgc3VtbWFyeS50b3RhbCsrO1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICBhdmFpbGFibGVVcGRhdGVzLFxuICAgICAgYXBwbGllZFVwZGF0ZXM6IFtdLFxuICAgICAgZmFpbGVkVXBkYXRlczogW10sXG4gICAgICBzdW1tYXJ5XG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgZGV0ZXJtaW5lVXBkYXRlVHlwZShjdXJyZW50OiBzdHJpbmcsIGxhdGVzdDogc3RyaW5nKTogJ21ham9yJyB8ICdtaW5vcicgfCAncGF0Y2gnIHtcbiAgICBjb25zdCBjdXJyZW50UGFydHMgPSBjdXJyZW50LnJlcGxhY2UoL1teMC05Ll0vZywgJycpLnNwbGl0KCcuJykubWFwKE51bWJlcik7XG4gICAgY29uc3QgbGF0ZXN0UGFydHMgPSBsYXRlc3QucmVwbGFjZSgvW14wLTkuXS9nLCAnJykuc3BsaXQoJy4nKS5tYXAoTnVtYmVyKTtcblxuICAgIGlmIChsYXRlc3RQYXJ0c1swXSA+IGN1cnJlbnRQYXJ0c1swXSkgcmV0dXJuICdtYWpvcic7XG4gICAgaWYgKGxhdGVzdFBhcnRzWzFdID4gY3VycmVudFBhcnRzWzFdKSByZXR1cm4gJ21pbm9yJztcbiAgICByZXR1cm4gJ3BhdGNoJztcbiAgfVxuXG4gIHByaXZhdGUgc2hvdWxkQXV0b0ZpeFZ1bG5lcmFiaWxpdHkoc2V2ZXJpdHk6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IHsgc2VjdXJpdHlUaHJlc2hvbGRzIH0gPSB0aGlzLmNvbmZpZztcbiAgICBcbiAgICBzd2l0Y2ggKHNldmVyaXR5KSB7XG4gICAgICBjYXNlICdjcml0aWNhbCc6XG4gICAgICAgIHJldHVybiBzZWN1cml0eVRocmVzaG9sZHMuYXV0b0ZpeENyaXRpY2FsO1xuICAgICAgY2FzZSAnaGlnaCc6XG4gICAgICAgIHJldHVybiBzZWN1cml0eVRocmVzaG9sZHMuYXV0b0ZpeEhpZ2g7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBnZXRVcGRhdGVTdHJhdGVneSh1cGRhdGU6IERlcGVuZGVuY3lVcGRhdGUpOiBVcGRhdGVTdHJhdGVneSB8IG51bGwge1xuICAgIGZvciAoY29uc3Qgc3RyYXRlZ3kgb2YgdGhpcy5jb25maWcudXBkYXRlU3RyYXRlZ2llcykge1xuICAgICAgaWYgKHN0cmF0ZWd5LnBhdHRlcm4udGVzdCh1cGRhdGUucGFja2FnZU5hbWUpKSB7XG4gICAgICAgIHJldHVybiBzdHJhdGVneTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBwcml2YXRlIHJlcXVpcmVzVGVzdGluZyhwYWNrYWdlTmFtZTogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgLy8gUGFja2FnZXMgdGhhdCB0eXBpY2FsbHkgcmVxdWlyZSB0ZXN0aW5nIGFmdGVyIHVwZGF0ZXNcbiAgICBjb25zdCB0ZXN0aW5nUmVxdWlyZWRQYXR0ZXJucyA9IFtcbiAgICAgIC9ecmVhY3QvLFxuICAgICAgL15uZXh0LyxcbiAgICAgIC9edHlwZXNjcmlwdC8sXG4gICAgICAvXkB0eXBlc1xcLy8sXG4gICAgICAvXmVzbGludC8sXG4gICAgICAvXmplc3QvLFxuICAgICAgL15iYWJlbC9cbiAgICBdO1xuXG4gICAgcmV0dXJuIHRlc3RpbmdSZXF1aXJlZFBhdHRlcm5zLnNvbWUocGF0dGVybiA9PiBwYXR0ZXJuLnRlc3QocGFja2FnZU5hbWUpKTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZ2V0Q2hhbmdlbG9nVXJsKHBhY2thZ2VOYW1lOiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZyB8IHVuZGVmaW5lZD4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBwYWNrYWdlSW5mbyA9IGV4ZWNTeW5jKGB5YXJuIGluZm8gJHtwYWNrYWdlTmFtZX0gLS1qc29uYCwge1xuICAgICAgICBlbmNvZGluZzogJ3V0ZjgnLFxuICAgICAgICBzdGRpbzogJ3BpcGUnLFxuICAgICAgICB0aW1lb3V0OiAxMDAwMFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IGluZm8gPSBKU09OLnBhcnNlKHBhY2thZ2VJbmZvKTtcbiAgICAgIHJldHVybiBpbmZvLnJlcG9zaXRvcnk/LnVybCB8fCBpbmZvLmhvbWVwYWdlO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgcnVuUGFja2FnZVRlc3RzKHBhY2thZ2VOYW1lOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICB0cnkge1xuICAgICAgLy8gUnVuIGEgc3Vic2V0IG9mIHRlc3RzIHJlbGF0ZWQgdG8gdGhlIHVwZGF0ZWQgcGFja2FnZVxuICAgICAgZXhlY1N5bmMoJ3lhcm4gdGVzdCAtLXRlc3ROYW1lUGF0dGVybj1cIi4qXCIgLS1iYWlsJywge1xuICAgICAgICBlbmNvZGluZzogJ3V0ZjgnLFxuICAgICAgICBzdGRpbzogJ3BpcGUnLFxuICAgICAgICB0aW1lb3V0OiA2MDAwMFxuICAgICAgfSk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZ2V0RGVwZW5kZW5jeUNvdW50KCk6IFByb21pc2U8bnVtYmVyPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHBhY2thZ2VKc29uID0gSlNPTi5wYXJzZShmcy5yZWFkRmlsZVN5bmModGhpcy5wYWNrYWdlSnNvblBhdGgsICd1dGY4JykpO1xuICAgICAgY29uc3QgZGVwcyA9IE9iamVjdC5rZXlzKHBhY2thZ2VKc29uLmRlcGVuZGVuY2llcyB8fCB7fSk7XG4gICAgICBjb25zdCBkZXZEZXBzID0gT2JqZWN0LmtleXMocGFja2FnZUpzb24uZGV2RGVwZW5kZW5jaWVzIHx8IHt9KTtcbiAgICAgIHJldHVybiBkZXBzLmxlbmd0aCArIGRldkRlcHMubGVuZ3RoO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICByZXR1cm4gMDtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGdlbmVyYXRlU2VjdXJpdHlSZWNvbW1lbmRhdGlvbnModnVsbmVyYWJpbGl0aWVzOiBTZWN1cml0eVZ1bG5lcmFiaWxpdHlbXSwgc3VtbWFyeTogU2VjdXJpdHlTdW1tYXJ5KTogc3RyaW5nW10ge1xuICAgIGNvbnN0IHJlY29tbWVuZGF0aW9uczogc3RyaW5nW10gPSBbXTtcblxuICAgIGlmIChzdW1tYXJ5LmNyaXRpY2FsID4gMCkge1xuICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goYPCfmqggJHtzdW1tYXJ5LmNyaXRpY2FsfSBjcml0aWNhbCB2dWxuZXJhYmlsaXRpZXMgZm91bmQgLSBpbW1lZGlhdGUgYWN0aW9uIHJlcXVpcmVkYCk7XG4gICAgfVxuXG4gICAgaWYgKHN1bW1hcnkuaGlnaCA+IDApIHtcbiAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKGDimqDvuI8gJHtzdW1tYXJ5LmhpZ2h9IGhpZ2ggc2V2ZXJpdHkgdnVsbmVyYWJpbGl0aWVzIGZvdW5kIC0gdXBkYXRlIGFzIHNvb24gYXMgcG9zc2libGVgKTtcbiAgICB9XG5cbiAgICBpZiAoc3VtbWFyeS5tb2RlcmF0ZSA+IDApIHtcbiAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKGDwn5OLICR7c3VtbWFyeS5tb2RlcmF0ZX0gbW9kZXJhdGUgdnVsbmVyYWJpbGl0aWVzIGZvdW5kIC0gcGxhbiB1cGRhdGVzYCk7XG4gICAgfVxuXG4gICAgY29uc3QgcGF0Y2hhYmxlVnVsbnMgPSB2dWxuZXJhYmlsaXRpZXMuZmlsdGVyKHYgPT4gdi5wYXRjaEF2YWlsYWJsZSk7XG4gICAgaWYgKHBhdGNoYWJsZVZ1bG5zLmxlbmd0aCA+IDApIHtcbiAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKGDinIUgJHtwYXRjaGFibGVWdWxucy5sZW5ndGh9IHZ1bG5lcmFiaWxpdGllcyBoYXZlIHBhdGNoZXMgYXZhaWxhYmxlYCk7XG4gICAgfVxuXG4gICAgaWYgKHN1bW1hcnkudG90YWwgPT09IDApIHtcbiAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKCfinIUgTm8gc2VjdXJpdHkgdnVsbmVyYWJpbGl0aWVzIGZvdW5kJyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlY29tbWVuZGF0aW9ucztcbiAgfVxufVxuXG4vKipcbiAqIERlZmF1bHQgY29uZmlndXJhdGlvbiBmb3IgZGVwZW5kZW5jeSBhbmQgc2VjdXJpdHkgbW9uaXRvcmluZ1xuICovXG5leHBvcnQgY29uc3QgREVGQVVMVF9ERVBFTkRFTkNZX1NFQ1VSSVRZX0NPTkZJRzogRGVwZW5kZW5jeVNlY3VyaXR5Q29uZmlnID0ge1xuICBtYXhEZXBlbmRlbmNpZXNQZXJCYXRjaDogMTAsXG4gIHNhZmV0eVZhbGlkYXRpb25FbmFibGVkOiB0cnVlLFxuICBhdXRvVXBkYXRlRW5hYmxlZDogZmFsc2UsIC8vIERpc2FibGVkIGJ5IGRlZmF1bHQgZm9yIHNhZmV0eVxuICBzZWN1cml0eVNjYW5FbmFibGVkOiB0cnVlLFxuICBjb21wYXRpYmlsaXR5VGVzdGluZ0VuYWJsZWQ6IHRydWUsXG4gIHVwZGF0ZVN0cmF0ZWdpZXM6IFtcbiAgICB7XG4gICAgICBuYW1lOiAnU2VjdXJpdHkgcGF0Y2hlcycsXG4gICAgICBkZXNjcmlwdGlvbjogJ0F1dG9tYXRpY2FsbHkgYXBwbHkgc2VjdXJpdHkgcGF0Y2hlcycsXG4gICAgICBwYXR0ZXJuOiAvLiovLFxuICAgICAgdXBkYXRlVHlwZTogJ3BhdGNoJyxcbiAgICAgIHJlcXVpcmVzTWFudWFsQXBwcm92YWw6IGZhbHNlLFxuICAgICAgdGVzdGluZ1JlcXVpcmVkOiBmYWxzZVxuICAgIH0sXG4gICAge1xuICAgICAgbmFtZTogJ1R5cGVTY3JpcHQgZWNvc3lzdGVtJyxcbiAgICAgIGRlc2NyaXB0aW9uOiAnQ2FyZWZ1bCB1cGRhdGVzIGZvciBUeXBlU2NyaXB0LXJlbGF0ZWQgcGFja2FnZXMnLFxuICAgICAgcGF0dGVybjogL14oQHR5cGVzXFwvfHR5cGVzY3JpcHR8dHMtKS8sXG4gICAgICB1cGRhdGVUeXBlOiAnbWlub3InLFxuICAgICAgcmVxdWlyZXNNYW51YWxBcHByb3ZhbDogdHJ1ZSxcbiAgICAgIHRlc3RpbmdSZXF1aXJlZDogdHJ1ZVxuICAgIH0sXG4gICAge1xuICAgICAgbmFtZTogJ1JlYWN0IGVjb3N5c3RlbScsXG4gICAgICBkZXNjcmlwdGlvbjogJ0NhcmVmdWwgdXBkYXRlcyBmb3IgUmVhY3QtcmVsYXRlZCBwYWNrYWdlcycsXG4gICAgICBwYXR0ZXJuOiAvXihyZWFjdHxAcmVhY3R8bmV4dCkvLFxuICAgICAgdXBkYXRlVHlwZTogJ21pbm9yJyxcbiAgICAgIHJlcXVpcmVzTWFudWFsQXBwcm92YWw6IHRydWUsXG4gICAgICB0ZXN0aW5nUmVxdWlyZWQ6IHRydWVcbiAgICB9LFxuICAgIHtcbiAgICAgIG5hbWU6ICdEZXZlbG9wbWVudCB0b29scycsXG4gICAgICBkZXNjcmlwdGlvbjogJ1NhZmUgdXBkYXRlcyBmb3IgZGV2ZWxvcG1lbnQgdG9vbHMnLFxuICAgICAgcGF0dGVybjogL14oZXNsaW50fHByZXR0aWVyfGplc3R8YmFiZWwpLyxcbiAgICAgIHVwZGF0ZVR5cGU6ICdtaW5vcicsXG4gICAgICByZXF1aXJlc01hbnVhbEFwcHJvdmFsOiBmYWxzZSxcbiAgICAgIHRlc3RpbmdSZXF1aXJlZDogdHJ1ZVxuICAgIH1cbiAgXSxcbiAgc2VjdXJpdHlUaHJlc2hvbGRzOiB7XG4gICAgY3JpdGljYWw6IDAsXG4gICAgaGlnaDogNSxcbiAgICBtb2RlcmF0ZTogMTAsXG4gICAgbG93OiAyMCxcbiAgICBhdXRvRml4Q3JpdGljYWw6IHRydWUsXG4gICAgYXV0b0ZpeEhpZ2g6IGZhbHNlXG4gIH0sXG4gIGV4Y2x1ZGVkUGFja2FnZXM6IFtcbiAgICAvLyBQYWNrYWdlcyB0byBuZXZlciBhdXRvLXVwZGF0ZVxuICAgICdyZWFjdCcsXG4gICAgJ3JlYWN0LWRvbScsXG4gICAgJ25leHQnLFxuICAgICd0eXBlc2NyaXB0J1xuICBdXG59OyJdLCJ2ZXJzaW9uIjozfQ==