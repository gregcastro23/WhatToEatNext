3abf0abb19342383f94d7627bdab99c2
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.AnalysisTools = void 0;
const child_process_1 = require("child_process");
const fs = __importStar(require("fs"));
const path = __importStar(require("path"));
const AnyTypeClassifier_1 = require("./AnyTypeClassifier");
const DomainContextAnalyzer_1 = require("./DomainContextAnalyzer");
const types_1 = require("./types");
/**
 * Comprehensive analysis tools for unintentional any type elimination
 * Provides domain distribution analysis, classification accuracy reporting,
 * success rate analysis, and manual review recommendations
 */
class AnalysisTools {
    classifier;
    domainAnalyzer;
    analysisHistory = [];
    constructor() {
        this.classifier = new AnyTypeClassifier_1.AnyTypeClassifier();
        this.domainAnalyzer = new DomainContextAnalyzer_1.DomainContextAnalyzer();
        this.loadAnalysisHistory();
    }
    /**
     * Analyze current any type distribution by domain
     */
    async analyzeDomainDistribution() {
        console.log('Analyzing any type distribution by domain...');
        const anyTypeOccurrences = await this.findAllAnyTypes();
        const domainDistribution = {
            [types_1.CodeDomain.ASTROLOGICAL]: 0,
            [types_1.CodeDomain.RECIPE]: 0,
            [types_1.CodeDomain.CAMPAIGN]: 0,
            [types_1.CodeDomain.INTELLIGENCE]: 0,
            [types_1.CodeDomain.SERVICE]: 0,
            [types_1.CodeDomain.COMPONENT]: 0,
            [types_1.CodeDomain.UTILITY]: 0,
            [types_1.CodeDomain.TEST]: 0
        };
        const categoryDistribution = {
            [types_1.AnyTypeCategory.ERROR_HANDLING]: 0,
            [types_1.AnyTypeCategory.EXTERNAL_API]: 0,
            [types_1.AnyTypeCategory.TEST_MOCK]: 0,
            [types_1.AnyTypeCategory.DYNAMIC_CONFIG]: 0,
            [types_1.AnyTypeCategory.LEGACY_COMPATIBILITY]: 0,
            [types_1.AnyTypeCategory.ARRAY_TYPE]: 0,
            [types_1.AnyTypeCategory.RECORD_TYPE]: 0,
            [types_1.AnyTypeCategory.FUNCTION_PARAM]: 0,
            [types_1.AnyTypeCategory.RETURN_TYPE]: 0,
            [types_1.AnyTypeCategory.TYPE_ASSERTION]: 0
        };
        const intentionalCount = { count: 0 };
        const unintentionalCount = { count: 0 };
        for (const occurrence of anyTypeOccurrences) {
            const context = await this.createClassificationContext(occurrence);
            const domainContext = await this.domainAnalyzer.analyzeDomain(context);
            const classification = await this.classifier.classify(context);
            // Count by domain
            domainDistribution[domainContext.domain]++;
            // Count by category
            categoryDistribution[classification.category]++;
            // Count by intentionality
            if (classification.isIntentional) {
                intentionalCount.count++;
            }
            else {
                unintentionalCount.count++;
            }
        }
        const totalCount = anyTypeOccurrences.length;
        const distribution = {
            totalAnyTypes: totalCount,
            byDomain: Object.entries(domainDistribution).map(([domain, count]) => ({
                domain: domain,
                count,
                percentage: totalCount > 0 ? (count / totalCount) * 100 : 0
            })),
            byCategory: Object.entries(categoryDistribution).map(([category, count]) => ({
                category: category,
                count,
                percentage: totalCount > 0 ? (count / totalCount) * 100 : 0
            })),
            intentionalVsUnintentional: {
                intentional: {
                    count: intentionalCount.count,
                    percentage: totalCount > 0 ? (intentionalCount.count / totalCount) * 100 : 0
                },
                unintentional: {
                    count: unintentionalCount.count,
                    percentage: totalCount > 0 ? (unintentionalCount.count / totalCount) * 100 : 0
                }
            },
            analysisDate: new Date()
        };
        console.log(`Domain distribution analysis complete: ${totalCount} any types found`);
        return distribution;
    }
    /**
     * Implement classification accuracy reporting
     */
    async generateClassificationAccuracyReport() {
        console.log('Generating classification accuracy report...');
        const anyTypeOccurrences = await this.findAllAnyTypes();
        const sampleSize = Math.min(100, anyTypeOccurrences.length); // Sample for accuracy testing
        const sample = anyTypeOccurrences.slice(0, sampleSize);
        let correctClassifications = 0;
        let totalClassifications = 0;
        const confidenceScores = [];
        const categoryAccuracy = {
            [types_1.AnyTypeCategory.ERROR_HANDLING]: { correct: 0, total: 0 },
            [types_1.AnyTypeCategory.EXTERNAL_API]: { correct: 0, total: 0 },
            [types_1.AnyTypeCategory.TEST_MOCK]: { correct: 0, total: 0 },
            [types_1.AnyTypeCategory.DYNAMIC_CONFIG]: { correct: 0, total: 0 },
            [types_1.AnyTypeCategory.LEGACY_COMPATIBILITY]: { correct: 0, total: 0 },
            [types_1.AnyTypeCategory.ARRAY_TYPE]: { correct: 0, total: 0 },
            [types_1.AnyTypeCategory.RECORD_TYPE]: { correct: 0, total: 0 },
            [types_1.AnyTypeCategory.FUNCTION_PARAM]: { correct: 0, total: 0 },
            [types_1.AnyTypeCategory.RETURN_TYPE]: { correct: 0, total: 0 },
            [types_1.AnyTypeCategory.TYPE_ASSERTION]: { correct: 0, total: 0 }
        };
        for (const occurrence of sample) {
            const context = await this.createClassificationContext(occurrence);
            const classification = await this.classifier.classify(context);
            totalClassifications++;
            confidenceScores.push(classification.confidence);
            categoryAccuracy[classification.category].total++;
            // Validate classification accuracy using heuristics
            const isAccurate = await this.validateClassificationAccuracy(context, classification);
            if (isAccurate) {
                correctClassifications++;
                categoryAccuracy[classification.category].correct++;
            }
        }
        const overallAccuracy = totalClassifications > 0 ? (correctClassifications / totalClassifications) * 100 : 0;
        const averageConfidence = confidenceScores.length > 0
            ? confidenceScores.reduce((sum, score) => sum + score, 0) / confidenceScores.length
            : 0;
        const report = {
            overallAccuracy,
            averageConfidence,
            sampleSize,
            categoryAccuracy: Object.entries(categoryAccuracy).map(([category, stats]) => ({
                category: category,
                accuracy: stats.total > 0 ? (stats.correct / stats.total) * 100 : 0,
                sampleCount: stats.total
            })),
            confidenceDistribution: this.calculateConfidenceDistribution(confidenceScores),
            reportDate: new Date()
        };
        console.log(`Classification accuracy report complete: ${overallAccuracy.toFixed(1)}% accuracy`);
        return report;
    }
    /**
     * Add success rate analysis and trending
     */
    async generateSuccessRateAnalysis() {
        console.log('Generating success rate analysis and trending...');
        const currentMetrics = await this.getCurrentMetrics();
        const historicalData = this.getHistoricalTrendingData();
        // Calculate success rates by category
        const categorySuccessRates = await this.calculateCategorySuccessRates();
        // Calculate trending data
        const trendingData = this.calculateTrendingMetrics(historicalData);
        const analysis = {
            currentSuccessRate: currentMetrics.overallSuccessRate,
            targetSuccessRate: 85,
            improvementNeeded: Math.max(0, 85 - currentMetrics.overallSuccessRate),
            categorySuccessRates,
            trendingData,
            projectedCompletion: this.calculateProjectedCompletion(trendingData),
            recommendations: await this.generateSuccessRateRecommendations(categorySuccessRates),
            analysisDate: new Date()
        };
        console.log(`Success rate analysis complete: ${currentMetrics.overallSuccessRate.toFixed(1)}% current success rate`);
        return analysis;
    }
    /**
     * Create recommendations for manual review cases
     */
    async generateManualReviewRecommendations() {
        console.log('Generating manual review recommendations...');
        const anyTypeOccurrences = await this.findAllAnyTypes();
        const recommendations = [];
        for (const occurrence of anyTypeOccurrences) {
            const context = await this.createClassificationContext(occurrence);
            const classification = await this.classifier.classify(context);
            // Identify cases that need manual review
            if (this.requiresManualReview(classification, context)) {
                const recommendation = {
                    filePath: occurrence.filePath,
                    lineNumber: occurrence.lineNumber,
                    codeSnippet: occurrence.codeSnippet,
                    classification,
                    reviewReason: this.getReviewReason(classification, context),
                    priority: this.calculateReviewPriority(classification, context),
                    suggestedActions: await this.generateSuggestedActions(classification, context),
                    estimatedEffort: this.estimateReviewEffort(classification, context),
                    relatedOccurrences: await this.findRelatedOccurrences(occurrence)
                };
                recommendations.push(recommendation);
            }
        }
        // Sort by priority (high to low)
        recommendations.sort((a, b) => {
            const priorityOrder = { high: 3, medium: 2, low: 1 };
            return priorityOrder[b.priority] - priorityOrder[a.priority];
        });
        console.log(`Manual review recommendations complete: ${recommendations.length} cases identified`);
        return recommendations;
    }
    /**
     * Generate comprehensive analysis report
     */
    async generateComprehensiveReport() {
        console.log('Generating comprehensive analysis report...');
        const [domainDistribution, accuracyReport, successRateAnalysis, manualReviewRecommendations] = await Promise.all([
            this.analyzeDomainDistribution(),
            this.generateClassificationAccuracyReport(),
            this.generateSuccessRateAnalysis(),
            this.generateManualReviewRecommendations()
        ]);
        const report = {
            id: `analysis-${Date.now()}`,
            timestamp: new Date(),
            domainDistribution,
            accuracyReport,
            successRateAnalysis,
            manualReviewRecommendations,
            summary: {
                totalAnyTypes: domainDistribution.totalAnyTypes,
                unintentionalCount: domainDistribution.intentionalVsUnintentional.unintentional.count,
                classificationAccuracy: accuracyReport.overallAccuracy,
                currentSuccessRate: successRateAnalysis.currentSuccessRate,
                manualReviewCases: manualReviewRecommendations.length,
                topDomain: this.getTopDomain(domainDistribution),
                topCategory: this.getTopCategory(domainDistribution)
            }
        };
        // Save report to history
        this.analysisHistory.push(report);
        await this.saveAnalysisHistory();
        console.log('Comprehensive analysis report generated successfully');
        return report;
    }
    // Private helper methods
    async findAllAnyTypes() {
        const occurrences = [];
        try {
            // Use grep to find all explicit any types
            const grepCommand = `grep -rn "\\bany\\b" src --include="*.ts" --include="*.tsx" | head -1000`;
            const output = (0, child_process_1.execSync)(grepCommand, { encoding: 'utf8', stdio: 'pipe' });
            const lines = output.trim().split('\n').filter(line => line.trim());
            for (const line of lines) {
                const match = line.match(/^([^:]+):(\d+):(.+)$/);
                if (match) {
                    const [, filePath, lineNumber, codeSnippet] = match;
                    occurrences.push({
                        filePath: filePath.trim(),
                        lineNumber: parseInt(lineNumber),
                        codeSnippet: codeSnippet.trim()
                    });
                }
            }
        }
        catch (error) {
            console.warn('Error finding any types:', error);
        }
        return occurrences;
    }
    async createClassificationContext(occurrence) {
        const surroundingLines = await this.getSurroundingLines(occurrence.filePath, occurrence.lineNumber);
        const hasExistingComment = this.hasExistingComment(surroundingLines);
        const domainContext = await this.domainAnalyzer.analyzeDomain({
            filePath: occurrence.filePath,
            lineNumber: occurrence.lineNumber,
            codeSnippet: occurrence.codeSnippet,
            surroundingLines,
            hasExistingComment,
            isInTestFile: occurrence.filePath.includes('.test.') || occurrence.filePath.includes('__tests__'),
            domainContext: { domain: types_1.CodeDomain.UTILITY, intentionalityHints: [], suggestedTypes: [], preservationReasons: [] }
        });
        return {
            filePath: occurrence.filePath,
            lineNumber: occurrence.lineNumber,
            codeSnippet: occurrence.codeSnippet,
            surroundingLines,
            hasExistingComment,
            existingComment: hasExistingComment ? this.extractComment(surroundingLines) : undefined,
            isInTestFile: occurrence.filePath.includes('.test.') || occurrence.filePath.includes('__tests__'),
            domainContext
        };
    }
    async getSurroundingLines(filePath, lineNumber) {
        try {
            const content = fs.readFileSync(filePath, 'utf8');
            const lines = content.split('\n');
            const start = Math.max(0, lineNumber - 3);
            const end = Math.min(lines.length, lineNumber + 2);
            return lines.slice(start, end);
        }
        catch (error) {
            return [];
        }
    }
    hasExistingComment(surroundingLines) {
        return surroundingLines.some(line => line.trim().startsWith('//') ||
            line.trim().startsWith('/*') ||
            line.trim().startsWith('*'));
    }
    extractComment(surroundingLines) {
        const commentLines = surroundingLines.filter(line => line.trim().startsWith('//') ||
            line.trim().startsWith('/*') ||
            line.trim().startsWith('*'));
        return commentLines.join(' ').trim();
    }
    async validateClassificationAccuracy(context, classification) {
        // Heuristic validation based on context
        // Error handling should be in catch blocks
        if (classification.category === types_1.AnyTypeCategory.ERROR_HANDLING) {
            return context.codeSnippet.includes('catch') || context.codeSnippet.includes('error');
        }
        // Test mocks should be in test files
        if (classification.category === types_1.AnyTypeCategory.TEST_MOCK) {
            return context.isInTestFile;
        }
        // Array types should contain array syntax
        if (classification.category === types_1.AnyTypeCategory.ARRAY_TYPE) {
            return context.codeSnippet.includes('any[]') || context.codeSnippet.includes('Array<unknown>');
        }
        // Record types should contain Record syntax
        if (classification.category === types_1.AnyTypeCategory.RECORD_TYPE) {
            return context.codeSnippet.includes('Record<') && context.codeSnippet.includes('any');
        }
        // Default to accurate for other categories
        return true;
    }
    calculateConfidenceDistribution(scores) {
        const ranges = [
            { min: 0.9, max: 1.0, label: '90-100%' },
            { min: 0.8, max: 0.9, label: '80-90%' },
            { min: 0.7, max: 0.8, label: '70-80%' },
            { min: 0.6, max: 0.7, label: '60-70%' },
            { min: 0.0, max: 0.6, label: '0-60%' }
        ];
        return ranges.map(range => {
            const count = scores.filter(score => score >= range.min && score < range.max).length;
            return {
                range: range.label,
                count,
                percentage: scores.length > 0 ? (count / scores.length) * 100 : 0
            };
        });
    }
    async getCurrentMetrics() {
        // Simulate current metrics - in real implementation, this would fetch from actual data
        return {
            overallSuccessRate: 78.5,
            totalProcessed: 1250,
            successfulReplacements: 982,
            failedReplacements: 268,
            averageConfidence: 0.82
        };
    }
    getHistoricalTrendingData() {
        // Return last 30 days of trending data from history
        const thirtyDaysAgo = new Date();
        thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
        return this.analysisHistory
            .filter(report => report.timestamp >= thirtyDaysAgo)
            .map(report => ({
            date: report.timestamp,
            successRate: report.successRateAnalysis.currentSuccessRate,
            totalAnyTypes: report.domainDistribution.totalAnyTypes,
            unintentionalCount: report.domainDistribution.intentionalVsUnintentional.unintentional.count,
            classificationAccuracy: report.accuracyReport.overallAccuracy
        }));
    }
    async calculateCategorySuccessRates() {
        // Simulate category success rates - in real implementation, this would calculate from actual data
        return [
            { category: types_1.AnyTypeCategory.ARRAY_TYPE, successRate: 95.2, sampleSize: 156 },
            { category: types_1.AnyTypeCategory.RECORD_TYPE, successRate: 87.3, sampleSize: 203 },
            { category: types_1.AnyTypeCategory.FUNCTION_PARAM, successRate: 65.8, sampleSize: 342 },
            { category: types_1.AnyTypeCategory.RETURN_TYPE, successRate: 72.1, sampleSize: 189 },
            { category: types_1.AnyTypeCategory.TYPE_ASSERTION, successRate: 81.4, sampleSize: 127 },
            { category: types_1.AnyTypeCategory.ERROR_HANDLING, successRate: 45.6, sampleSize: 98 },
            { category: types_1.AnyTypeCategory.EXTERNAL_API, successRate: 52.3, sampleSize: 76 },
            { category: types_1.AnyTypeCategory.TEST_MOCK, successRate: 89.7, sampleSize: 134 },
            { category: types_1.AnyTypeCategory.DYNAMIC_CONFIG, successRate: 38.9, sampleSize: 67 },
            { category: types_1.AnyTypeCategory.LEGACY_COMPATIBILITY, successRate: 41.2, sampleSize: 45 }
        ];
    }
    calculateTrendingMetrics(historicalData) {
        if (historicalData.length === 0) {
            return {
                date: new Date(),
                successRate: 0,
                totalAnyTypes: 0,
                unintentionalCount: 0,
                classificationAccuracy: 0
            };
        }
        const latest = historicalData[historicalData.length - 1];
        const previous = historicalData.length > 1 ? historicalData[historicalData.length - 2] : latest;
        return {
            date: latest.date,
            successRate: latest.successRate,
            totalAnyTypes: latest.totalAnyTypes,
            unintentionalCount: latest.unintentionalCount,
            classificationAccuracy: latest.classificationAccuracy,
            trends: {
                successRateChange: latest.successRate - previous.successRate,
                totalAnyTypesChange: latest.totalAnyTypes - previous.totalAnyTypes,
                unintentionalCountChange: latest.unintentionalCount - previous.unintentionalCount,
                classificationAccuracyChange: latest.classificationAccuracy - previous.classificationAccuracy
            }
        };
    }
    calculateProjectedCompletion(trendingData) {
        // Simple linear projection based on current trend
        const currentRate = trendingData.successRate;
        const targetRate = 85;
        const rateChange = trendingData.trends?.successRateChange || 0.5; // Default 0.5% improvement per analysis
        if (rateChange <= 0 || currentRate >= targetRate) {
            const futureDate = new Date();
            futureDate.setDate(futureDate.getDate() + 30); // Default 30 days if no improvement
            return futureDate;
        }
        const daysNeeded = Math.ceil((targetRate - currentRate) / rateChange);
        const projectedDate = new Date();
        projectedDate.setDate(projectedDate.getDate() + daysNeeded);
        return projectedDate;
    }
    async generateSuccessRateRecommendations(categorySuccessRates) {
        const recommendations = [];
        // Find categories with low success rates
        const lowSuccessCategories = categorySuccessRates.filter(cat => cat.successRate < 70);
        for (const category of lowSuccessCategories) {
            switch (category.category) {
                case types_1.AnyTypeCategory.FUNCTION_PARAM:
                    recommendations.push('Focus on improving function parameter type inference algorithms');
                    break;
                case types_1.AnyTypeCategory.RETURN_TYPE:
                    recommendations.push('Enhance return type analysis with better context understanding');
                    break;
                case types_1.AnyTypeCategory.ERROR_HANDLING:
                    recommendations.push('Consider preserving error handling any types as intentional');
                    break;
                case types_1.AnyTypeCategory.EXTERNAL_API:
                    recommendations.push('Improve external API response type detection');
                    break;
                case types_1.AnyTypeCategory.DYNAMIC_CONFIG:
                    recommendations.push('Review dynamic configuration patterns for better type safety');
                    break;
                case types_1.AnyTypeCategory.LEGACY_COMPATIBILITY:
                    recommendations.push('Evaluate legacy compatibility requirements vs type safety benefits');
                    break;
            }
        }
        // Find categories with high success rates to leverage
        const highSuccessCategories = categorySuccessRates.filter(cat => cat.successRate > 85);
        if (highSuccessCategories.length > 0) {
            recommendations.push(`Prioritize ${highSuccessCategories.map(cat => cat.category).join(', ')} categories for quick wins`);
        }
        return recommendations;
    }
    requiresManualReview(classification, context) {
        // Low confidence classifications need manual review
        if (classification.confidence < 0.7) {
            return true;
        }
        // Complex domain contexts need manual review
        if (context.domainContext.intentionalityHints.length > 2) {
            return true;
        }
        // Conflicting signals need manual review
        if (classification.isIntentional && classification.suggestedReplacement) {
            return true;
        }
        // High-risk categories need manual review
        const highRiskCategories = [
            types_1.AnyTypeCategory.EXTERNAL_API,
            types_1.AnyTypeCategory.DYNAMIC_CONFIG,
            types_1.AnyTypeCategory.LEGACY_COMPATIBILITY
        ];
        return highRiskCategories.includes(classification.category);
    }
    getReviewReason(classification, context) {
        if (classification.confidence < 0.7) {
            return `Low classification confidence (${(classification.confidence * 100).toFixed(1)}%)`;
        }
        if (context.domainContext.intentionalityHints.length > 2) {
            return 'Complex domain context with multiple intentionality hints';
        }
        if (classification.isIntentional && classification.suggestedReplacement) {
            return 'Conflicting signals: classified as intentional but has suggested replacement';
        }
        return `High-risk category: ${classification.category}`;
    }
    calculateReviewPriority(classification, context) {
        // High priority: Low confidence or conflicting signals
        if (classification.confidence < 0.6 || (classification.isIntentional && classification.suggestedReplacement)) {
            return 'high';
        }
        // Medium priority: Moderate confidence or complex context
        if (classification.confidence < 0.8 || context.domainContext.intentionalityHints.length > 1) {
            return 'medium';
        }
        // Low priority: High confidence, simple cases
        return 'low';
    }
    async generateSuggestedActions(classification, context) {
        const actions = [];
        if (classification.confidence < 0.7) {
            actions.push('Review classification logic and add more context');
        }
        if (classification.suggestedReplacement) {
            actions.push(`Consider replacing with: ${classification.suggestedReplacement}`);
        }
        if (!classification.isIntentional) {
            actions.push('Attempt automated replacement with safety validation');
        }
        else {
            actions.push('Add documentation explaining why any type is necessary');
        }
        if (context.domainContext.suggestedTypes.length > 0) {
            actions.push(`Consider domain-specific types: ${context.domainContext.suggestedTypes.join(', ')}`);
        }
        return actions;
    }
    estimateReviewEffort(classification, context) {
        // High effort: Complex domain context or low confidence
        if (classification.confidence < 0.6 || context.domainContext.intentionalityHints.length > 2) {
            return 'high';
        }
        // Medium effort: Moderate complexity
        if (classification.confidence < 0.8 || context.domainContext.intentionalityHints.length > 0) {
            return 'medium';
        }
        // Low effort: Simple cases
        return 'low';
    }
    async findRelatedOccurrences(occurrence) {
        // Find other any types in the same file
        const relatedOccurrences = [];
        try {
            const grepCommand = `grep -n "\\bany\\b" "${occurrence.filePath}"`;
            const output = (0, child_process_1.execSync)(grepCommand, { encoding: 'utf8', stdio: 'pipe' });
            const lines = output.trim().split('\n').filter(line => line.trim());
            for (const line of lines) {
                const match = line.match(/^(\d+):(.+)$/);
                if (match) {
                    const lineNumber = parseInt(match[1]);
                    if (lineNumber !== occurrence.lineNumber) {
                        relatedOccurrences.push({
                            filePath: occurrence.filePath,
                            lineNumber
                        });
                    }
                }
            }
        }
        catch (error) {
            // No related occurrences found
        }
        return relatedOccurrences.slice(0, 5); // Limit to 5 related occurrences
    }
    getTopDomain(distribution) {
        const topDomain = distribution.byDomain.reduce((max, current) => current.count > max.count ? current : max);
        return topDomain.domain;
    }
    getTopCategory(distribution) {
        const topCategory = distribution.byCategory.reduce((max, current) => current.count > max.count ? current : max);
        return topCategory.category;
    }
    loadAnalysisHistory() {
        try {
            const historyPath = path.join(process.cwd(), '.kiro', 'campaign-reports', 'unintentional-any-analysis-history.json');
            if (fs.existsSync(historyPath)) {
                const historyData = fs.readFileSync(historyPath, 'utf8');
                this.analysisHistory = JSON.parse(historyData);
            }
        }
        catch (error) {
            console.warn('Could not load analysis history:', error);
            this.analysisHistory = [];
        }
    }
    async saveAnalysisHistory() {
        try {
            const historyDir = path.join(process.cwd(), '.kiro', 'campaign-reports');
            if (!fs.existsSync(historyDir)) {
                fs.mkdirSync(historyDir, { recursive: true });
            }
            const historyPath = path.join(historyDir, 'unintentional-any-analysis-history.json');
            fs.writeFileSync(historyPath, JSON.stringify(this.analysisHistory, null, 2));
        }
        catch (error) {
            console.warn('Could not save analysis history:', error);
        }
    }
}
exports.AnalysisTools = AnalysisTools;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9zZXJ2aWNlcy9jYW1wYWlnbi91bmludGVudGlvbmFsLWFueS1lbGltaW5hdGlvbi9BbmFseXNpc1Rvb2xzLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsaURBQXlDO0FBQ3pDLHVDQUF5QjtBQUN6QiwyQ0FBNkI7QUFDN0IsMkRBQXdEO0FBQ3hELG1FQUFnRTtBQUNoRSxtQ0FZaUI7QUFFakI7Ozs7R0FJRztBQUNILE1BQWEsYUFBYTtJQUNoQixVQUFVLENBQW9CO0lBQzlCLGNBQWMsQ0FBd0I7SUFDdEMsZUFBZSxHQUFxQixFQUFFLENBQUM7SUFFL0M7UUFDRSxJQUFJLENBQUMsVUFBVSxHQUFHLElBQUkscUNBQWlCLEVBQUUsQ0FBQztRQUMxQyxJQUFJLENBQUMsY0FBYyxHQUFHLElBQUksNkNBQXFCLEVBQUUsQ0FBQztRQUNsRCxJQUFJLENBQUMsbUJBQW1CLEVBQUUsQ0FBQztJQUM3QixDQUFDO0lBRUQ7O09BRUc7SUFDSCxLQUFLLENBQUMseUJBQXlCO1FBQzdCLE9BQU8sQ0FBQyxHQUFHLENBQUMsOENBQThDLENBQUMsQ0FBQztRQUU1RCxNQUFNLGtCQUFrQixHQUFHLE1BQU0sSUFBSSxDQUFDLGVBQWUsRUFBRSxDQUFDO1FBQ3hELE1BQU0sa0JBQWtCLEdBQStCO1lBQ3JELENBQUMsa0JBQVUsQ0FBQyxZQUFZLENBQUMsRUFBRSxDQUFDO1lBQzVCLENBQUMsa0JBQVUsQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDO1lBQ3RCLENBQUMsa0JBQVUsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDO1lBQ3hCLENBQUMsa0JBQVUsQ0FBQyxZQUFZLENBQUMsRUFBRSxDQUFDO1lBQzVCLENBQUMsa0JBQVUsQ0FBQyxPQUFPLENBQUMsRUFBRSxDQUFDO1lBQ3ZCLENBQUMsa0JBQVUsQ0FBQyxTQUFTLENBQUMsRUFBRSxDQUFDO1lBQ3pCLENBQUMsa0JBQVUsQ0FBQyxPQUFP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LCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9zZXJ2aWNlcy9jYW1wYWlnbi91bmludGVudGlvbmFsLWFueS1lbGltaW5hdGlvbi9BbmFseXNpc1Rvb2xzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGV4ZWNTeW5jIH0gZnJvbSAnY2hpbGRfcHJvY2Vzcyc7XG5pbXBvcnQgKiBhcyBmcyBmcm9tICdmcyc7XG5pbXBvcnQgKiBhcyBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IHsgQW55VHlwZUNsYXNzaWZpZXIgfSBmcm9tICcuL0FueVR5cGVDbGFzc2lmaWVyJztcbmltcG9ydCB7IERvbWFpbkNvbnRleHRBbmFseXplciB9IGZyb20gJy4vRG9tYWluQ29udGV4dEFuYWx5emVyJztcbmltcG9ydCB7XG4gICAgQW5hbHlzaXNNZXRyaWNzLFxuICAgIEFuYWx5c2lzUmVwb3J0LFxuICAgIEFueVR5cGVDYXRlZ29yeSxcbiAgICBBbnlUeXBlQ2xhc3NpZmljYXRpb24sXG4gICAgQ2xhc3NpZmljYXRpb25BY2N1cmFjeVJlcG9ydCxcbiAgICBDbGFzc2lmaWNhdGlvbkNvbnRleHQsXG4gICAgQ29kZURvbWFpbixcbiAgICBEb21haW5EaXN0cmlidXRpb24sXG4gICAgTWFudWFsUmV2aWV3UmVjb21tZW5kYXRpb24sXG4gICAgU3VjY2Vzc1JhdGVBbmFseXNpcyxcbiAgICBUcmVuZGluZ0RhdGFcbn0gZnJvbSAnLi90eXBlcyc7XG5cbi8qKlxuICogQ29tcHJlaGVuc2l2ZSBhbmFseXNpcyB0b29scyBmb3IgdW5pbnRlbnRpb25hbCBhbnkgdHlwZSBlbGltaW5hdGlvblxuICogUHJvdmlkZXMgZG9tYWluIGRpc3RyaWJ1dGlvbiBhbmFseXNpcywgY2xhc3NpZmljYXRpb24gYWNjdXJhY3kgcmVwb3J0aW5nLFxuICogc3VjY2VzcyByYXRlIGFuYWx5c2lzLCBhbmQgbWFudWFsIHJldmlldyByZWNvbW1lbmRhdGlvbnNcbiAqL1xuZXhwb3J0IGNsYXNzIEFuYWx5c2lzVG9vbHMge1xuICBwcml2YXRlIGNsYXNzaWZpZXI6IEFueVR5cGVDbGFzc2lmaWVyO1xuICBwcml2YXRlIGRvbWFpbkFuYWx5emVyOiBEb21haW5Db250ZXh0QW5hbHl6ZXI7XG4gIHByaXZhdGUgYW5hbHlzaXNIaXN0b3J5OiBBbmFseXNpc1JlcG9ydFtdID0gW107XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5jbGFzc2lmaWVyID0gbmV3IEFueVR5cGVDbGFzc2lmaWVyKCk7XG4gICAgdGhpcy5kb21haW5BbmFseXplciA9IG5ldyBEb21haW5Db250ZXh0QW5hbHl6ZXIoKTtcbiAgICB0aGlzLmxvYWRBbmFseXNpc0hpc3RvcnkoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBbmFseXplIGN1cnJlbnQgYW55IHR5cGUgZGlzdHJpYnV0aW9uIGJ5IGRvbWFpblxuICAgKi9cbiAgYXN5bmMgYW5hbHl6ZURvbWFpbkRpc3RyaWJ1dGlvbigpOiBQcm9taXNlPERvbWFpbkRpc3RyaWJ1dGlvbj4ge1xuICAgIGNvbnNvbGUubG9nKCdBbmFseXppbmcgYW55IHR5cGUgZGlzdHJpYnV0aW9uIGJ5IGRvbWFpbi4uLicpO1xuXG4gICAgY29uc3QgYW55VHlwZU9jY3VycmVuY2VzID0gYXdhaXQgdGhpcy5maW5kQWxsQW55VHlwZXMoKTtcbiAgICBjb25zdCBkb21haW5EaXN0cmlidXRpb246IFJlY29yZDxDb2RlRG9tYWluLCBudW1iZXI+ID0ge1xuICAgICAgW0NvZGVEb21haW4uQVNUUk9MT0dJQ0FMXTogMCxcbiAgICAgIFtDb2RlRG9tYWluLlJFQ0lQRV06IDAsXG4gICAgICBbQ29kZURvbWFpbi5DQU1QQUlHTl06IDAsXG4gICAgICBbQ29kZURvbWFpbi5JTlRFTExJR0VOQ0VdOiAwLFxuICAgICAgW0NvZGVEb21haW4uU0VSVklDRV06IDAsXG4gICAgICBbQ29kZURvbWFpbi5DT01QT05FTlRdOiAwLFxuICAgICAgW0NvZGVEb21haW4uVVRJTElUWV06IDAsXG4gICAgICBbQ29kZURvbWFpbi5URVNUXTogMFxuICAgIH07XG5cbiAgICBjb25zdCBjYXRlZ29yeURpc3RyaWJ1dGlvbjogUmVjb3JkPEFueVR5cGVDYXRlZ29yeSwgbnVtYmVyPiA9IHtcbiAgICAgIFtBbnlUeXBlQ2F0ZWdvcnkuRVJST1JfSEFORExJTkddOiAwLFxuICAgICAgW0FueVR5cGVDYXRlZ29yeS5FWFRFUk5BTF9BUEldOiAwLFxuICAgICAgW0FueVR5cGVDYXRlZ29yeS5URVNUX01PQ0tdOiAwLFxuICAgICAgW0FueVR5cGVDYXRlZ29yeS5EWU5BTUlDX0NPTkZJR106IDAsXG4gICAgICBbQW55VHlwZUNhdGVnb3J5LkxFR0FDWV9DT01QQVRJQklMSVRZXTogMCxcbiAgICAgIFtBbnlUeXBlQ2F0ZWdvcnkuQVJSQVlfVFlQRV06IDAsXG4gICAgICBbQW55VHlwZUNhdGVnb3J5LlJFQ09SRF9UWVBFXTogMCxcbiAgICAgIFtBbnlUeXBlQ2F0ZWdvcnkuRlVOQ1RJT05fUEFSQU1dOiAwLFxuICAgICAgW0FueVR5cGVDYXRlZ29yeS5SRVRVUk5fVFlQRV06IDAsXG4gICAgICBbQW55VHlwZUNhdGVnb3J5LlRZUEVfQVNTRVJUSU9OXTogMFxuICAgIH07XG5cbiAgICBjb25zdCBpbnRlbnRpb25hbENvdW50ID0geyBjb3VudDogMCB9O1xuICAgIGNvbnN0IHVuaW50ZW50aW9uYWxDb3VudCA9IHsgY291bnQ6IDAgfTtcblxuICAgIGZvciAoY29uc3Qgb2NjdXJyZW5jZSBvZiBhbnlUeXBlT2NjdXJyZW5jZXMpIHtcbiAgICAgIGNvbnN0IGNvbnRleHQgPSBhd2FpdCB0aGlzLmNyZWF0ZUNsYXNzaWZpY2F0aW9uQ29udGV4dChvY2N1cnJlbmNlKTtcbiAgICAgIGNvbnN0IGRvbWFpbkNvbnRleHQgPSBhd2FpdCB0aGlzLmRvbWFpbkFuYWx5emVyLmFuYWx5emVEb21haW4oY29udGV4dCk7XG4gICAgICBjb25zdCBjbGFzc2lmaWNhdGlvbiA9IGF3YWl0IHRoaXMuY2xhc3NpZmllci5jbGFzc2lmeShjb250ZXh0KTtcblxuICAgICAgLy8gQ291bnQgYnkgZG9tYWluXG4gICAgICBkb21haW5EaXN0cmlidXRpb25bZG9tYWluQ29udGV4dC5kb21haW5dKys7XG5cbiAgICAgIC8vIENvdW50IGJ5IGNhdGVnb3J5XG4gICAgICBjYXRlZ29yeURpc3RyaWJ1dGlvbltjbGFzc2lmaWNhdGlvbi5jYXRlZ29yeV0rKztcblxuICAgICAgLy8gQ291bnQgYnkgaW50ZW50aW9uYWxpdHlcbiAgICAgIGlmIChjbGFzc2lmaWNhdGlvbi5pc0ludGVudGlvbmFsKSB7XG4gICAgICAgIGludGVudGlvbmFsQ291bnQuY291bnQrKztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHVuaW50ZW50aW9uYWxDb3VudC5jb3VudCsrO1xuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IHRvdGFsQ291bnQgPSBhbnlUeXBlT2NjdXJyZW5jZXMubGVuZ3RoO1xuICAgIGNvbnN0IGRpc3RyaWJ1dGlvbjogRG9tYWluRGlzdHJpYnV0aW9uID0ge1xuICAgICAgdG90YWxBbnlUeXBlczogdG90YWxDb3VudCxcbiAgICAgIGJ5RG9tYWluOiBPYmplY3QuZW50cmllcyhkb21haW5EaXN0cmlidXRpb24pLm1hcCgoW2RvbWFpbiwgY291bnRdKSA9PiAoe1xuICAgICAgICBkb21haW46IGRvbWFpbiBhcyBDb2RlRG9tYWluLFxuICAgICAgICBjb3VudCxcbiAgICAgICAgcGVyY2VudGFnZTogdG90YWxDb3VudCA+IDAgPyAoY291bnQgLyB0b3RhbENvdW50KSAqIDEwMCA6IDBcbiAgICAgIH0pKSxcbiAgICAgIGJ5Q2F0ZWdvcnk6IE9iamVjdC5lbnRyaWVzKGNhdGVnb3J5RGlzdHJpYnV0aW9uKS5tYXAoKFtjYXRlZ29yeSwgY291bnRdKSA9PiAoe1xuICAgICAgICBjYXRlZ29yeTogY2F0ZWdvcnkgYXMgQW55VHlwZUNhdGVnb3J5LFxuICAgICAgICBjb3VudCxcbiAgICAgICAgcGVyY2VudGFnZTogdG90YWxDb3VudCA+IDAgPyAoY291bnQgLyB0b3RhbENvdW50KSAqIDEwMCA6IDBcbiAgICAgIH0pKSxcbiAgICAgIGludGVudGlvbmFsVnNVbmludGVudGlvbmFsOiB7XG4gICAgICAgIGludGVudGlvbmFsOiB7XG4gICAgICAgICAgY291bnQ6IGludGVudGlvbmFsQ291bnQuY291bnQsXG4gICAgICAgICAgcGVyY2VudGFnZTogdG90YWxDb3VudCA+IDAgPyAoaW50ZW50aW9uYWxDb3VudC5jb3VudCAvIHRvdGFsQ291bnQpICogMTAwIDogMFxuICAgICAgICB9LFxuICAgICAgICB1bmludGVudGlvbmFsOiB7XG4gICAgICAgICAgY291bnQ6IHVuaW50ZW50aW9uYWxDb3VudC5jb3VudCxcbiAgICAgICAgICBwZXJjZW50YWdlOiB0b3RhbENvdW50ID4gMCA/ICh1bmludGVudGlvbmFsQ291bnQuY291bnQgLyB0b3RhbENvdW50KSAqIDEwMCA6IDBcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGFuYWx5c2lzRGF0ZTogbmV3IERhdGUoKVxuICAgIH07XG5cbiAgICBjb25zb2xlLmxvZyhgRG9tYWluIGRpc3RyaWJ1dGlvbiBhbmFseXNpcyBjb21wbGV0ZTogJHt0b3RhbENvdW50fSBhbnkgdHlwZXMgZm91bmRgKTtcbiAgICByZXR1cm4gZGlzdHJpYnV0aW9uO1xuICB9XG5cbiAgLyoqXG4gICAqIEltcGxlbWVudCBjbGFzc2lmaWNhdGlvbiBhY2N1cmFjeSByZXBvcnRpbmdcbiAgICovXG4gIGFzeW5jIGdlbmVyYXRlQ2xhc3NpZmljYXRpb25BY2N1cmFjeVJlcG9ydCgpOiBQcm9taXNlPENsYXNzaWZpY2F0aW9uQWNjdXJhY3lSZXBvcnQ+IHtcbiAgICBjb25zb2xlLmxvZygnR2VuZXJhdGluZyBjbGFzc2lmaWNhdGlvbiBhY2N1cmFjeSByZXBvcnQuLi4nKTtcblxuICAgIGNvbnN0IGFueVR5cGVPY2N1cnJlbmNlcyA9IGF3YWl0IHRoaXMuZmluZEFsbEFueVR5cGVzKCk7XG4gICAgY29uc3Qgc2FtcGxlU2l6ZSA9IE1hdGgubWluKDEwMCwgYW55VHlwZU9jY3VycmVuY2VzLmxlbmd0aCk7IC8vIFNhbXBsZSBmb3IgYWNjdXJhY3kgdGVzdGluZ1xuICAgIGNvbnN0IHNhbXBsZSA9IGFueVR5cGVPY2N1cnJlbmNlcy5zbGljZSgwLCBzYW1wbGVTaXplKTtcblxuICAgIGxldCBjb3JyZWN0Q2xhc3NpZmljYXRpb25zID0gMDtcbiAgICBsZXQgdG90YWxDbGFzc2lmaWNhdGlvbnMgPSAwO1xuICAgIGNvbnN0IGNvbmZpZGVuY2VTY29yZXM6IG51bWJlcltdID0gW107XG4gICAgY29uc3QgY2F0ZWdvcnlBY2N1cmFjeTogUmVjb3JkPEFueVR5cGVDYXRlZ29yeSwgeyBjb3JyZWN0OiBudW1iZXI7IHRvdGFsOiBudW1iZXIgfT4gPSB7XG4gICAgICBbQW55VHlwZUNhdGVnb3J5LkVSUk9SX0hBTkRMSU5HXTogeyBjb3JyZWN0OiAwLCB0b3RhbDogMCB9LFxuICAgICAgW0FueVR5cGVDYXRlZ29yeS5FWFRFUk5BTF9BUEldOiB7IGNvcnJlY3Q6IDAsIHRvdGFsOiAwIH0sXG4gICAgICBbQW55VHlwZUNhdGVnb3J5LlRFU1RfTU9DS106IHsgY29ycmVjdDogMCwgdG90YWw6IDAgfSxcbiAgICAgIFtBbnlUeXBlQ2F0ZWdvcnkuRFlOQU1JQ19DT05GSUddOiB7IGNvcnJlY3Q6IDAsIHRvdGFsOiAwIH0sXG4gICAgICBbQW55VHlwZUNhdGVnb3J5LkxFR0FDWV9DT01QQVRJQklMSVRZXTogeyBjb3JyZWN0OiAwLCB0b3RhbDogMCB9LFxuICAgICAgW0FueVR5cGVDYXRlZ29yeS5BUlJBWV9UWVBFXTogeyBjb3JyZWN0OiAwLCB0b3RhbDogMCB9LFxuICAgICAgW0FueVR5cGVDYXRlZ29yeS5SRUNPUkRfVFlQRV06IHsgY29ycmVjdDogMCwgdG90YWw6IDAgfSxcbiAgICAgIFtBbnlUeXBlQ2F0ZWdvcnkuRlVOQ1RJT05fUEFSQU1dOiB7IGNvcnJlY3Q6IDAsIHRvdGFsOiAwIH0sXG4gICAgICBbQW55VHlwZUNhdGVnb3J5LlJFVFVSTl9UWVBFXTogeyBjb3JyZWN0OiAwLCB0b3RhbDogMCB9LFxuICAgICAgW0FueVR5cGVDYXRlZ29yeS5UWVBFX0FTU0VSVElPTl06IHsgY29ycmVjdDogMCwgdG90YWw6IDAgfVxuICAgIH07XG5cbiAgICBmb3IgKGNvbnN0IG9jY3VycmVuY2Ugb2Ygc2FtcGxlKSB7XG4gICAgICBjb25zdCBjb250ZXh0ID0gYXdhaXQgdGhpcy5jcmVhdGVDbGFzc2lmaWNhdGlvbkNvbnRleHQob2NjdXJyZW5jZSk7XG4gICAgICBjb25zdCBjbGFzc2lmaWNhdGlvbiA9IGF3YWl0IHRoaXMuY2xhc3NpZmllci5jbGFzc2lmeShjb250ZXh0KTtcblxuICAgICAgdG90YWxDbGFzc2lmaWNhdGlvbnMrKztcbiAgICAgIGNvbmZpZGVuY2VTY29yZXMucHVzaChjbGFzc2lmaWNhdGlvbi5jb25maWRlbmNlKTtcbiAgICAgIGNhdGVnb3J5QWNjdXJhY3lbY2xhc3NpZmljYXRpb24uY2F0ZWdvcnldLnRvdGFsKys7XG5cbiAgICAgIC8vIFZhbGlkYXRlIGNsYXNzaWZpY2F0aW9uIGFjY3VyYWN5IHVzaW5nIGhldXJpc3RpY3NcbiAgICAgIGNvbnN0IGlzQWNjdXJhdGUgPSBhd2FpdCB0aGlzLnZhbGlkYXRlQ2xhc3NpZmljYXRpb25BY2N1cmFjeShjb250ZXh0LCBjbGFzc2lmaWNhdGlvbik7XG4gICAgICBpZiAoaXNBY2N1cmF0ZSkge1xuICAgICAgICBjb3JyZWN0Q2xhc3NpZmljYXRpb25zKys7XG4gICAgICAgIGNhdGVnb3J5QWNjdXJhY3lbY2xhc3NpZmljYXRpb24uY2F0ZWdvcnldLmNvcnJlY3QrKztcbiAgICAgIH1cbiAgICB9XG5cbiAgICBjb25zdCBvdmVyYWxsQWNjdXJhY3kgPSB0b3RhbENsYXNzaWZpY2F0aW9ucyA+IDAgPyAoY29ycmVjdENsYXNzaWZpY2F0aW9ucyAvIHRvdGFsQ2xhc3NpZmljYXRpb25zKSAqIDEwMCA6IDA7XG4gICAgY29uc3QgYXZlcmFnZUNvbmZpZGVuY2UgPSBjb25maWRlbmNlU2NvcmVzLmxlbmd0aCA+IDBcbiAgICAgID8gY29uZmlkZW5jZVNjb3Jlcy5yZWR1Y2UoKHN1bSwgc2NvcmUpID0+IHN1bSArIHNjb3JlLCAwKSAvIGNvbmZpZGVuY2VTY29yZXMubGVuZ3RoXG4gICAgICA6IDA7XG5cbiAgICBjb25zdCByZXBvcnQ6IENsYXNzaWZpY2F0aW9uQWNjdXJhY3lSZXBvcnQgPSB7XG4gICAgICBvdmVyYWxsQWNjdXJhY3ksXG4gICAgICBhdmVyYWdlQ29uZmlkZW5jZSxcbiAgICAgIHNhbXBsZVNpemUsXG4gICAgICBjYXRlZ29yeUFjY3VyYWN5OiBPYmplY3QuZW50cmllcyhjYXRlZ29yeUFjY3VyYWN5KS5tYXAoKFtjYXRlZ29yeSwgc3RhdHNdKSA9PiAoe1xuICAgICAgICBjYXRlZ29yeTogY2F0ZWdvcnkgYXMgQW55VHlwZUNhdGVnb3J5LFxuICAgICAgICBhY2N1cmFjeTogc3RhdHMudG90YWwgPiAwID8gKHN0YXRzLmNvcnJlY3QgLyBzdGF0cy50b3RhbCkgKiAxMDAgOiAwLFxuICAgICAgICBzYW1wbGVDb3VudDogc3RhdHMudG90YWxcbiAgICAgIH0pKSxcbiAgICAgIGNvbmZpZGVuY2VEaXN0cmlidXRpb246IHRoaXMuY2FsY3VsYXRlQ29uZmlkZW5jZURpc3RyaWJ1dGlvbihjb25maWRlbmNlU2NvcmVzKSxcbiAgICAgIHJlcG9ydERhdGU6IG5ldyBEYXRlKClcbiAgICB9O1xuXG4gICAgY29uc29sZS5sb2coYENsYXNzaWZpY2F0aW9uIGFjY3VyYWN5IHJlcG9ydCBjb21wbGV0ZTogJHtvdmVyYWxsQWNjdXJhY3kudG9GaXhlZCgxKX0lIGFjY3VyYWN5YCk7XG4gICAgcmV0dXJuIHJlcG9ydDtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGQgc3VjY2VzcyByYXRlIGFuYWx5c2lzIGFuZCB0cmVuZGluZ1xuICAgKi9cbiAgYXN5bmMgZ2VuZXJhdGVTdWNjZXNzUmF0ZUFuYWx5c2lzKCk6IFByb21pc2U8U3VjY2Vzc1JhdGVBbmFseXNpcz4ge1xuICAgIGNvbnNvbGUubG9nKCdHZW5lcmF0aW5nIHN1Y2Nlc3MgcmF0ZSBhbmFseXNpcyBhbmQgdHJlbmRpbmcuLi4nKTtcblxuICAgIGNvbnN0IGN1cnJlbnRNZXRyaWNzID0gYXdhaXQgdGhpcy5nZXRDdXJyZW50TWV0cmljcygpO1xuICAgIGNvbnN0IGhpc3RvcmljYWxEYXRhID0gdGhpcy5nZXRIaXN0b3JpY2FsVHJlbmRpbmdEYXRhKCk7XG5cbiAgICAvLyBDYWxjdWxhdGUgc3VjY2VzcyByYXRlcyBieSBjYXRlZ29yeVxuICAgIGNvbnN0IGNhdGVnb3J5U3VjY2Vzc1JhdGVzID0gYXdhaXQgdGhpcy5jYWxjdWxhdGVDYXRlZ29yeVN1Y2Nlc3NSYXRlcygpO1xuXG4gICAgLy8gQ2FsY3VsYXRlIHRyZW5kaW5nIGRhdGFcbiAgICBjb25zdCB0cmVuZGluZ0RhdGEgPSB0aGlzLmNhbGN1bGF0ZVRyZW5kaW5nTWV0cmljcyhoaXN0b3JpY2FsRGF0YSk7XG5cbiAgICBjb25zdCBhbmFseXNpczogU3VjY2Vzc1JhdGVBbmFseXNpcyA9IHtcbiAgICAgIGN1cnJlbnRTdWNjZXNzUmF0ZTogY3VycmVudE1ldHJpY3Mub3ZlcmFsbFN1Y2Nlc3NSYXRlLFxuICAgICAgdGFyZ2V0U3VjY2Vzc1JhdGU6IDg1LCAvLyBUYXJnZXQgODUlIHN1Y2Nlc3MgcmF0ZVxuICAgICAgaW1wcm92ZW1lbnROZWVkZWQ6IE1hdGgubWF4KDAsIDg1IC0gY3VycmVudE1ldHJpY3Mub3ZlcmFsbFN1Y2Nlc3NSYXRlKSxcbiAgICAgIGNhdGVnb3J5U3VjY2Vzc1JhdGVzLFxuICAgICAgdHJlbmRpbmdEYXRhLFxuICAgICAgcHJvamVjdGVkQ29tcGxldGlvbjogdGhpcy5jYWxjdWxhdGVQcm9qZWN0ZWRDb21wbGV0aW9uKHRyZW5kaW5nRGF0YSksXG4gICAgICByZWNvbW1lbmRhdGlvbnM6IGF3YWl0IHRoaXMuZ2VuZXJhdGVTdWNjZXNzUmF0ZVJlY29tbWVuZGF0aW9ucyhjYXRlZ29yeVN1Y2Nlc3NSYXRlcyksXG4gICAgICBhbmFseXNpc0RhdGU6IG5ldyBEYXRlKClcbiAgICB9O1xuXG4gICAgY29uc29sZS5sb2coYFN1Y2Nlc3MgcmF0ZSBhbmFseXNpcyBjb21wbGV0ZTogJHtjdXJyZW50TWV0cmljcy5vdmVyYWxsU3VjY2Vzc1JhdGUudG9GaXhlZCgxKX0lIGN1cnJlbnQgc3VjY2VzcyByYXRlYCk7XG4gICAgcmV0dXJuIGFuYWx5c2lzO1xuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSByZWNvbW1lbmRhdGlvbnMgZm9yIG1hbnVhbCByZXZpZXcgY2FzZXNcbiAgICovXG4gIGFzeW5jIGdlbmVyYXRlTWFudWFsUmV2aWV3UmVjb21tZW5kYXRpb25zKCk6IFByb21pc2U8TWFudWFsUmV2aWV3UmVjb21tZW5kYXRpb25bXT4ge1xuICAgIGNvbnNvbGUubG9nKCdHZW5lcmF0aW5nIG1hbnVhbCByZXZpZXcgcmVjb21tZW5kYXRpb25zLi4uJyk7XG5cbiAgICBjb25zdCBhbnlUeXBlT2NjdXJyZW5jZXMgPSBhd2FpdCB0aGlzLmZpbmRBbGxBbnlUeXBlcygpO1xuICAgIGNvbnN0IHJlY29tbWVuZGF0aW9uczogTWFudWFsUmV2aWV3UmVjb21tZW5kYXRpb25bXSA9IFtdO1xuXG4gICAgZm9yIChjb25zdCBvY2N1cnJlbmNlIG9mIGFueVR5cGVPY2N1cnJlbmNlcykge1xuICAgICAgY29uc3QgY29udGV4dCA9IGF3YWl0IHRoaXMuY3JlYXRlQ2xhc3NpZmljYXRpb25Db250ZXh0KG9jY3VycmVuY2UpO1xuICAgICAgY29uc3QgY2xhc3NpZmljYXRpb24gPSBhd2FpdCB0aGlzLmNsYXNzaWZpZXIuY2xhc3NpZnkoY29udGV4dCk7XG5cbiAgICAgIC8vIElkZW50aWZ5IGNhc2VzIHRoYXQgbmVlZCBtYW51YWwgcmV2aWV3XG4gICAgICBpZiAodGhpcy5yZXF1aXJlc01hbnVhbFJldmlldyhjbGFzc2lmaWNhdGlvbiwgY29udGV4dCkpIHtcbiAgICAgICAgY29uc3QgcmVjb21tZW5kYXRpb246IE1hbnVhbFJldmlld1JlY29tbWVuZGF0aW9uID0ge1xuICAgICAgICAgIGZpbGVQYXRoOiBvY2N1cnJlbmNlLmZpbGVQYXRoLFxuICAgICAgICAgIGxpbmVOdW1iZXI6IG9jY3VycmVuY2UubGluZU51bWJlcixcbiAgICAgICAgICBjb2RlU25pcHBldDogb2NjdXJyZW5jZS5jb2RlU25pcHBldCxcbiAgICAgICAgICBjbGFzc2lmaWNhdGlvbixcbiAgICAgICAgICByZXZpZXdSZWFzb246IHRoaXMuZ2V0UmV2aWV3UmVhc29uKGNsYXNzaWZpY2F0aW9uLCBjb250ZXh0KSxcbiAgICAgICAgICBwcmlvcml0eTogdGhpcy5jYWxjdWxhdGVSZXZpZXdQcmlvcml0eShjbGFzc2lmaWNhdGlvbiwgY29udGV4dCksXG4gICAgICAgICAgc3VnZ2VzdGVkQWN0aW9uczogYXdhaXQgdGhpcy5nZW5lcmF0ZVN1Z2dlc3RlZEFjdGlvbnMoY2xhc3NpZmljYXRpb24sIGNvbnRleHQpLFxuICAgICAgICAgIGVzdGltYXRlZEVmZm9ydDogdGhpcy5lc3RpbWF0ZVJldmlld0VmZm9ydChjbGFzc2lmaWNhdGlvbiwgY29udGV4dCksXG4gICAgICAgICAgcmVsYXRlZE9jY3VycmVuY2VzOiBhd2FpdCB0aGlzLmZpbmRSZWxhdGVkT2NjdXJyZW5jZXMob2NjdXJyZW5jZSlcbiAgICAgICAgfTtcblxuICAgICAgICByZWNvbW1lbmRhdGlvbnMucHVzaChyZWNvbW1lbmRhdGlvbik7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gU29ydCBieSBwcmlvcml0eSAoaGlnaCB0byBsb3cpXG4gICAgcmVjb21tZW5kYXRpb25zLnNvcnQoKGEsIGIpID0+IHtcbiAgICAgIGNvbnN0IHByaW9yaXR5T3JkZXIgPSB7IGhpZ2g6IDMsIG1lZGl1bTogMiwgbG93OiAxIH07XG4gICAgICByZXR1cm4gcHJpb3JpdHlPcmRlcltiLnByaW9yaXR5XSAtIHByaW9yaXR5T3JkZXJbYS5wcmlvcml0eV07XG4gICAgfSk7XG5cbiAgICBjb25zb2xlLmxvZyhgTWFudWFsIHJldmlldyByZWNvbW1lbmRhdGlvbnMgY29tcGxldGU6ICR7cmVjb21tZW5kYXRpb25zLmxlbmd0aH0gY2FzZXMgaWRlbnRpZmllZGApO1xuICAgIHJldHVybiByZWNvbW1lbmRhdGlvbnM7XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhdGUgY29tcHJlaGVuc2l2ZSBhbmFseXNpcyByZXBvcnRcbiAgICovXG4gIGFzeW5jIGdlbmVyYXRlQ29tcHJlaGVuc2l2ZVJlcG9ydCgpOiBQcm9taXNlPEFuYWx5c2lzUmVwb3J0PiB7XG4gICAgY29uc29sZS5sb2coJ0dlbmVyYXRpbmcgY29tcHJlaGVuc2l2ZSBhbmFseXNpcyByZXBvcnQuLi4nKTtcblxuICAgIGNvbnN0IFtcbiAgICAgIGRvbWFpbkRpc3RyaWJ1dGlvbixcbiAgICAgIGFjY3VyYWN5UmVwb3J0LFxuICAgICAgc3VjY2Vzc1JhdGVBbmFseXNpcyxcbiAgICAgIG1hbnVhbFJldmlld1JlY29tbWVuZGF0aW9uc1xuICAgIF0gPSBhd2FpdCBQcm9taXNlLmFsbChbXG4gICAgICB0aGlzLmFuYWx5emVEb21haW5EaXN0cmlidXRpb24oKSxcbiAgICAgIHRoaXMuZ2VuZXJhdGVDbGFzc2lmaWNhdGlvbkFjY3VyYWN5UmVwb3J0KCksXG4gICAgICB0aGlzLmdlbmVyYXRlU3VjY2Vzc1JhdGVBbmFseXNpcygpLFxuICAgICAgdGhpcy5nZW5lcmF0ZU1hbnVhbFJldmlld1JlY29tbWVuZGF0aW9ucygpXG4gICAgXSk7XG5cbiAgICBjb25zdCByZXBvcnQ6IEFuYWx5c2lzUmVwb3J0ID0ge1xuICAgICAgaWQ6IGBhbmFseXNpcy0ke0RhdGUubm93KCl9YCxcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgIGRvbWFpbkRpc3RyaWJ1dGlvbixcbiAgICAgIGFjY3VyYWN5UmVwb3J0LFxuICAgICAgc3VjY2Vzc1JhdGVBbmFseXNpcyxcbiAgICAgIG1hbnVhbFJldmlld1JlY29tbWVuZGF0aW9ucyxcbiAgICAgIHN1bW1hcnk6IHtcbiAgICAgICAgdG90YWxBbnlUeXBlczogZG9tYWluRGlzdHJpYnV0aW9uLnRvdGFsQW55VHlwZXMsXG4gICAgICAgIHVuaW50ZW50aW9uYWxDb3VudDogZG9tYWluRGlzdHJpYnV0aW9uLmludGVudGlvbmFsVnNVbmludGVudGlvbmFsLnVuaW50ZW50aW9uYWwuY291bnQsXG4gICAgICAgIGNsYXNzaWZpY2F0aW9uQWNjdXJhY3k6IGFjY3VyYWN5UmVwb3J0Lm92ZXJhbGxBY2N1cmFjeSxcbiAgICAgICAgY3VycmVudFN1Y2Nlc3NSYXRlOiBzdWNjZXNzUmF0ZUFuYWx5c2lzLmN1cnJlbnRTdWNjZXNzUmF0ZSxcbiAgICAgICAgbWFudWFsUmV2aWV3Q2FzZXM6IG1hbnVhbFJldmlld1JlY29tbWVuZGF0aW9ucy5sZW5ndGgsXG4gICAgICAgIHRvcERvbWFpbjogdGhpcy5nZXRUb3BEb21haW4oZG9tYWluRGlzdHJpYnV0aW9uKSxcbiAgICAgICAgdG9wQ2F0ZWdvcnk6IHRoaXMuZ2V0VG9wQ2F0ZWdvcnkoZG9tYWluRGlzdHJpYnV0aW9uKVxuICAgICAgfVxuICAgIH07XG5cbiAgICAvLyBTYXZlIHJlcG9ydCB0byBoaXN0b3J5XG4gICAgdGhpcy5hbmFseXNpc0hpc3RvcnkucHVzaChyZXBvcnQpO1xuICAgIGF3YWl0IHRoaXMuc2F2ZUFuYWx5c2lzSGlzdG9yeSgpO1xuXG4gICAgY29uc29sZS5sb2coJ0NvbXByZWhlbnNpdmUgYW5hbHlzaXMgcmVwb3J0IGdlbmVyYXRlZCBzdWNjZXNzZnVsbHknKTtcbiAgICByZXR1cm4gcmVwb3J0O1xuICB9XG5cbiAgLy8gUHJpdmF0ZSBoZWxwZXIgbWV0aG9kc1xuXG4gIHByaXZhdGUgYXN5bmMgZmluZEFsbEFueVR5cGVzKCk6IFByb21pc2U8QXJyYXk8eyBmaWxlUGF0aDogc3RyaW5nOyBsaW5lTnVtYmVyOiBudW1iZXI7IGNvZGVTbmlwcGV0OiBzdHJpbmcgfT4+IHtcbiAgICBjb25zdCBvY2N1cnJlbmNlczogQXJyYXk8eyBmaWxlUGF0aDogc3RyaW5nOyBsaW5lTnVtYmVyOiBudW1iZXI7IGNvZGVTbmlwcGV0OiBzdHJpbmcgfT4gPSBbXTtcblxuICAgIHRyeSB7XG4gICAgICAvLyBVc2UgZ3JlcCB0byBmaW5kIGFsbCBleHBsaWNpdCBhbnkgdHlwZXNcbiAgICAgIGNvbnN0IGdyZXBDb21tYW5kID0gYGdyZXAgLXJuIFwiXFxcXGJhbnlcXFxcYlwiIHNyYyAtLWluY2x1ZGU9XCIqLnRzXCIgLS1pbmNsdWRlPVwiKi50c3hcIiB8IGhlYWQgLTEwMDBgO1xuICAgICAgY29uc3Qgb3V0cHV0ID0gZXhlY1N5bmMoZ3JlcENvbW1hbmQsIHsgZW5jb2Rpbmc6ICd1dGY4Jywgc3RkaW86ICdwaXBlJyB9KTtcblxuICAgICAgY29uc3QgbGluZXMgPSBvdXRwdXQudHJpbSgpLnNwbGl0KCdcXG4nKS5maWx0ZXIobGluZSA9PiBsaW5lLnRyaW0oKSk7XG5cbiAgICAgIGZvciAoY29uc3QgbGluZSBvZiBsaW5lcykge1xuICAgICAgICBjb25zdCBtYXRjaCA9IGxpbmUubWF0Y2goL14oW146XSspOihcXGQrKTooLispJC8pO1xuICAgICAgICBpZiAobWF0Y2gpIHtcbiAgICAgICAgICBjb25zdCBbLCBmaWxlUGF0aCwgbGluZU51bWJlciwgY29kZVNuaXBwZXRdID0gbWF0Y2g7XG4gICAgICAgICAgb2NjdXJyZW5jZXMucHVzaCh7XG4gICAgICAgICAgICBmaWxlUGF0aDogZmlsZVBhdGgudHJpbSgpLFxuICAgICAgICAgICAgbGluZU51bWJlcjogcGFyc2VJbnQobGluZU51bWJlciksXG4gICAgICAgICAgICBjb2RlU25pcHBldDogY29kZVNuaXBwZXQudHJpbSgpXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS53YXJuKCdFcnJvciBmaW5kaW5nIGFueSB0eXBlczonLCBlcnJvcik7XG4gICAgfVxuXG4gICAgcmV0dXJuIG9jY3VycmVuY2VzO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBjcmVhdGVDbGFzc2lmaWNhdGlvbkNvbnRleHQob2NjdXJyZW5jZTogeyBmaWxlUGF0aDogc3RyaW5nOyBsaW5lTnVtYmVyOiBudW1iZXI7IGNvZGVTbmlwcGV0OiBzdHJpbmcgfSk6IFByb21pc2U8Q2xhc3NpZmljYXRpb25Db250ZXh0PiB7XG4gICAgY29uc3Qgc3Vycm91bmRpbmdMaW5lcyA9IGF3YWl0IHRoaXMuZ2V0U3Vycm91bmRpbmdMaW5lcyhvY2N1cnJlbmNlLmZpbGVQYXRoLCBvY2N1cnJlbmNlLmxpbmVOdW1iZXIpO1xuICAgIGNvbnN0IGhhc0V4aXN0aW5nQ29tbWVudCA9IHRoaXMuaGFzRXhpc3RpbmdDb21tZW50KHN1cnJvdW5kaW5nTGluZXMpO1xuICAgIGNvbnN0IGRvbWFpbkNvbnRleHQgPSBhd2FpdCB0aGlzLmRvbWFpbkFuYWx5emVyLmFuYWx5emVEb21haW4oe1xuICAgICAgZmlsZVBhdGg6IG9jY3VycmVuY2UuZmlsZVBhdGgsXG4gICAgICBsaW5lTnVtYmVyOiBvY2N1cnJlbmNlLmxpbmVOdW1iZXIsXG4gICAgICBjb2RlU25pcHBldDogb2NjdXJyZW5jZS5jb2RlU25pcHBldCxcbiAgICAgIHN1cnJvdW5kaW5nTGluZXMsXG4gICAgICBoYXNFeGlzdGluZ0NvbW1lbnQsXG4gICAgICBpc0luVGVzdEZpbGU6IG9jY3VycmVuY2UuZmlsZVBhdGguaW5jbHVkZXMoJy50ZXN0LicpIHx8IG9jY3VycmVuY2UuZmlsZVBhdGguaW5jbHVkZXMoJ19fdGVzdHNfXycpLFxuICAgICAgZG9tYWluQ29udGV4dDogeyBkb21haW46IENvZGVEb21haW4uVVRJTElUWSwgaW50ZW50aW9uYWxpdHlIaW50czogW10sIHN1Z2dlc3RlZFR5cGVzOiBbXSwgcHJlc2VydmF0aW9uUmVhc29uczogW10gfVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIGZpbGVQYXRoOiBvY2N1cnJlbmNlLmZpbGVQYXRoLFxuICAgICAgbGluZU51bWJlcjogb2NjdXJyZW5jZS5saW5lTnVtYmVyLFxuICAgICAgY29kZVNuaXBwZXQ6IG9jY3VycmVuY2UuY29kZVNuaXBwZXQsXG4gICAgICBzdXJyb3VuZGluZ0xpbmVzLFxuICAgICAgaGFzRXhpc3RpbmdDb21tZW50LFxuICAgICAgZXhpc3RpbmdDb21tZW50OiBoYXNFeGlzdGluZ0NvbW1lbnQgPyB0aGlzLmV4dHJhY3RDb21tZW50KHN1cnJvdW5kaW5nTGluZXMpIDogdW5kZWZpbmVkLFxuICAgICAgaXNJblRlc3RGaWxlOiBvY2N1cnJlbmNlLmZpbGVQYXRoLmluY2x1ZGVzKCcudGVzdC4nKSB8fCBvY2N1cnJlbmNlLmZpbGVQYXRoLmluY2x1ZGVzKCdfX3Rlc3RzX18nKSxcbiAgICAgIGRvbWFpbkNvbnRleHRcbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBnZXRTdXJyb3VuZGluZ0xpbmVzKGZpbGVQYXRoOiBzdHJpbmcsIGxpbmVOdW1iZXI6IG51bWJlcik6IFByb21pc2U8c3RyaW5nW10+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgY29udGVudCA9IGZzLnJlYWRGaWxlU3luYyhmaWxlUGF0aCwgJ3V0ZjgnKTtcbiAgICAgIGNvbnN0IGxpbmVzID0gY29udGVudC5zcGxpdCgnXFxuJyk7XG4gICAgICBjb25zdCBzdGFydCA9IE1hdGgubWF4KDAsIGxpbmVOdW1iZXIgLSAzKTtcbiAgICAgIGNvbnN0IGVuZCA9IE1hdGgubWluKGxpbmVzLmxlbmd0aCwgbGluZU51bWJlciArIDIpO1xuICAgICAgcmV0dXJuIGxpbmVzLnNsaWNlKHN0YXJ0LCBlbmQpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBoYXNFeGlzdGluZ0NvbW1lbnQoc3Vycm91bmRpbmdMaW5lczogc3RyaW5nW10pOiBib29sZWFuIHtcbiAgICByZXR1cm4gc3Vycm91bmRpbmdMaW5lcy5zb21lKGxpbmUgPT5cbiAgICAgIGxpbmUudHJpbSgpLnN0YXJ0c1dpdGgoJy8vJykgfHxcbiAgICAgIGxpbmUudHJpbSgpLnN0YXJ0c1dpdGgoJy8qJykgfHxcbiAgICAgIGxpbmUudHJpbSgpLnN0YXJ0c1dpdGgoJyonKVxuICAgICk7XG4gIH1cblxuICBwcml2YXRlIGV4dHJhY3RDb21tZW50KHN1cnJvdW5kaW5nTGluZXM6IHN0cmluZ1tdKTogc3RyaW5nIHtcbiAgICBjb25zdCBjb21tZW50TGluZXMgPSBzdXJyb3VuZGluZ0xpbmVzLmZpbHRlcihsaW5lID0+XG4gICAgICBsaW5lLnRyaW0oKS5zdGFydHNXaXRoKCcvLycpIHx8XG4gICAgICBsaW5lLnRyaW0oKS5zdGFydHNXaXRoKCcvKicpIHx8XG4gICAgICBsaW5lLnRyaW0oKS5zdGFydHNXaXRoKCcqJylcbiAgICApO1xuICAgIHJldHVybiBjb21tZW50TGluZXMuam9pbignICcpLnRyaW0oKTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgdmFsaWRhdGVDbGFzc2lmaWNhdGlvbkFjY3VyYWN5KGNvbnRleHQ6IENsYXNzaWZpY2F0aW9uQ29udGV4dCwgY2xhc3NpZmljYXRpb246IEFueVR5cGVDbGFzc2lmaWNhdGlvbik6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIC8vIEhldXJpc3RpYyB2YWxpZGF0aW9uIGJhc2VkIG9uIGNvbnRleHRcblxuICAgIC8vIEVycm9yIGhhbmRsaW5nIHNob3VsZCBiZSBpbiBjYXRjaCBibG9ja3NcbiAgICBpZiAoY2xhc3NpZmljYXRpb24uY2F0ZWdvcnkgPT09IEFueVR5cGVDYXRlZ29yeS5FUlJPUl9IQU5ETElORykge1xuICAgICAgcmV0dXJuIGNvbnRleHQuY29kZVNuaXBwZXQuaW5jbHVkZXMoJ2NhdGNoJykgfHwgY29udGV4dC5jb2RlU25pcHBldC5pbmNsdWRlcygnZXJyb3InKTtcbiAgICB9XG5cbiAgICAvLyBUZXN0IG1vY2tzIHNob3VsZCBiZSBpbiB0ZXN0IGZpbGVzXG4gICAgaWYgKGNsYXNzaWZpY2F0aW9uLmNhdGVnb3J5ID09PSBBbnlUeXBlQ2F0ZWdvcnkuVEVTVF9NT0NLKSB7XG4gICAgICByZXR1cm4gY29udGV4dC5pc0luVGVzdEZpbGU7XG4gICAgfVxuXG4gICAgLy8gQXJyYXkgdHlwZXMgc2hvdWxkIGNvbnRhaW4gYXJyYXkgc3ludGF4XG4gICAgaWYgKGNsYXNzaWZpY2F0aW9uLmNhdGVnb3J5ID09PSBBbnlUeXBlQ2F0ZWdvcnkuQVJSQVlfVFlQRSkge1xuICAgICAgcmV0dXJuIGNvbnRleHQuY29kZVNuaXBwZXQuaW5jbHVkZXMoJ2FueVtdJykgfHwgY29udGV4dC5jb2RlU25pcHBldC5pbmNsdWRlcygnQXJyYXk8dW5rbm93bj4nKTtcbiAgICB9XG5cbiAgICAvLyBSZWNvcmQgdHlwZXMgc2hvdWxkIGNvbnRhaW4gUmVjb3JkIHN5bnRheFxuICAgIGlmIChjbGFzc2lmaWNhdGlvbi5jYXRlZ29yeSA9PT0gQW55VHlwZUNhdGVnb3J5LlJFQ09SRF9UWVBFKSB7XG4gICAgICByZXR1cm4gY29udGV4dC5jb2RlU25pcHBldC5pbmNsdWRlcygnUmVjb3JkPCcpICYmIGNvbnRleHQuY29kZVNuaXBwZXQuaW5jbHVkZXMoJ2FueScpO1xuICAgIH1cblxuICAgIC8vIERlZmF1bHQgdG8gYWNjdXJhdGUgZm9yIG90aGVyIGNhdGVnb3JpZXNcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIHByaXZhdGUgY2FsY3VsYXRlQ29uZmlkZW5jZURpc3RyaWJ1dGlvbihzY29yZXM6IG51bWJlcltdKTogeyByYW5nZTogc3RyaW5nOyBjb3VudDogbnVtYmVyOyBwZXJjZW50YWdlOiBudW1iZXIgfVtdIHtcbiAgICBjb25zdCByYW5nZXMgPSBbXG4gICAgICB7IG1pbjogMC45LCBtYXg6IDEuMCwgbGFiZWw6ICc5MC0xMDAlJyB9LFxuICAgICAgeyBtaW46IDAuOCwgbWF4OiAwLjksIGxhYmVsOiAnODAtOTAlJyB9LFxuICAgICAgeyBtaW46IDAuNywgbWF4OiAwLjgsIGxhYmVsOiAnNzAtODAlJyB9LFxuICAgICAgeyBtaW46IDAuNiwgbWF4OiAwLjcsIGxhYmVsOiAnNjAtNzAlJyB9LFxuICAgICAgeyBtaW46IDAuMCwgbWF4OiAwLjYsIGxhYmVsOiAnMC02MCUnIH1cbiAgICBdO1xuXG4gICAgcmV0dXJuIHJhbmdlcy5tYXAocmFuZ2UgPT4ge1xuICAgICAgY29uc3QgY291bnQgPSBzY29yZXMuZmlsdGVyKHNjb3JlID0+IHNjb3JlID49IHJhbmdlLm1pbiAmJiBzY29yZSA8IHJhbmdlLm1heCkubGVuZ3RoO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcmFuZ2U6IHJhbmdlLmxhYmVsLFxuICAgICAgICBjb3VudCxcbiAgICAgICAgcGVyY2VudGFnZTogc2NvcmVzLmxlbmd0aCA+IDAgPyAoY291bnQgLyBzY29yZXMubGVuZ3RoKSAqIDEwMCA6IDBcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGdldEN1cnJlbnRNZXRyaWNzKCk6IFByb21pc2U8QW5hbHlzaXNNZXRyaWNzPiB7XG4gICAgLy8gU2ltdWxhdGUgY3VycmVudCBtZXRyaWNzIC0gaW4gcmVhbCBpbXBsZW1lbnRhdGlvbiwgdGhpcyB3b3VsZCBmZXRjaCBmcm9tIGFjdHVhbCBkYXRhXG4gICAgcmV0dXJuIHtcbiAgICAgIG92ZXJhbGxTdWNjZXNzUmF0ZTogNzguNSxcbiAgICAgIHRvdGFsUHJvY2Vzc2VkOiAxMjUwLFxuICAgICAgc3VjY2Vzc2Z1bFJlcGxhY2VtZW50czogOTgyLFxuICAgICAgZmFpbGVkUmVwbGFjZW1lbnRzOiAyNjgsXG4gICAgICBhdmVyYWdlQ29uZmlkZW5jZTogMC44MlxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIGdldEhpc3RvcmljYWxUcmVuZGluZ0RhdGEoKTogVHJlbmRpbmdEYXRhW10ge1xuICAgIC8vIFJldHVybiBsYXN0IDMwIGRheXMgb2YgdHJlbmRpbmcgZGF0YSBmcm9tIGhpc3RvcnlcbiAgICBjb25zdCB0aGlydHlEYXlzQWdvID0gbmV3IERhdGUoKTtcbiAgICB0aGlydHlEYXlzQWdvLnNldERhdGUodGhpcnR5RGF5c0Fnby5nZXREYXRlKCkgLSAzMCk7XG5cbiAgICByZXR1cm4gdGhpcy5hbmFseXNpc0hpc3RvcnlcbiAgICAgIC5maWx0ZXIocmVwb3J0ID0+IHJlcG9ydC50aW1lc3RhbXAgPj0gdGhpcnR5RGF5c0FnbylcbiAgICAgIC5tYXAocmVwb3J0ID0+ICh7XG4gICAgICAgIGRhdGU6IHJlcG9ydC50aW1lc3RhbXAsXG4gICAgICAgIHN1Y2Nlc3NSYXRlOiByZXBvcnQuc3VjY2Vzc1JhdGVBbmFseXNpcy5jdXJyZW50U3VjY2Vzc1JhdGUsXG4gICAgICAgIHRvdGFsQW55VHlwZXM6IHJlcG9ydC5kb21haW5EaXN0cmlidXRpb24udG90YWxBbnlUeXBlcyxcbiAgICAgICAgdW5pbnRlbnRpb25hbENvdW50OiByZXBvcnQuZG9tYWluRGlzdHJpYnV0aW9uLmludGVudGlvbmFsVnNVbmludGVudGlvbmFsLnVuaW50ZW50aW9uYWwuY291bnQsXG4gICAgICAgIGNsYXNzaWZpY2F0aW9uQWNjdXJhY3k6IHJlcG9ydC5hY2N1cmFjeVJlcG9ydC5vdmVyYWxsQWNjdXJhY3lcbiAgICAgIH0pKTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgY2FsY3VsYXRlQ2F0ZWdvcnlTdWNjZXNzUmF0ZXMoKTogUHJvbWlzZTxBcnJheTx7IGNhdGVnb3J5OiBBbnlUeXBlQ2F0ZWdvcnk7IHN1Y2Nlc3NSYXRlOiBudW1iZXI7IHNhbXBsZVNpemU6IG51bWJlciB9Pj4ge1xuICAgIC8vIFNpbXVsYXRlIGNhdGVnb3J5IHN1Y2Nlc3MgcmF0ZXMgLSBpbiByZWFsIGltcGxlbWVudGF0aW9uLCB0aGlzIHdvdWxkIGNhbGN1bGF0ZSBmcm9tIGFjdHVhbCBkYXRhXG4gICAgcmV0dXJuIFtcbiAgICAgIHsgY2F0ZWdvcnk6IEFueVR5cGVDYXRlZ29yeS5BUlJBWV9UWVBFLCBzdWNjZXNzUmF0ZTogOTUuMiwgc2FtcGxlU2l6ZTogMTU2IH0sXG4gICAgICB7IGNhdGVnb3J5OiBBbnlUeXBlQ2F0ZWdvcnkuUkVDT1JEX1RZUEUsIHN1Y2Nlc3NSYXRlOiA4Ny4zLCBzYW1wbGVTaXplOiAyMDMgfSxcbiAgICAgIHsgY2F0ZWdvcnk6IEFueVR5cGVDYXRlZ29yeS5GVU5DVElPTl9QQVJBTSwgc3VjY2Vzc1JhdGU6IDY1LjgsIHNhbXBsZVNpemU6IDM0MiB9LFxuICAgICAgeyBjYXRlZ29yeTogQW55VHlwZUNhdGVnb3J5LlJFVFVSTl9UWVBFLCBzdWNjZXNzUmF0ZTogNzIuMSwgc2FtcGxlU2l6ZTogMTg5IH0sXG4gICAgICB7IGNhdGVnb3J5OiBBbnlUeXBlQ2F0ZWdvcnkuVFlQRV9BU1NFUlRJT04sIHN1Y2Nlc3NSYXRlOiA4MS40LCBzYW1wbGVTaXplOiAxMjcgfSxcbiAgICAgIHsgY2F0ZWdvcnk6IEFueVR5cGVDYXRlZ29yeS5FUlJPUl9IQU5ETElORywgc3VjY2Vzc1JhdGU6IDQ1LjYsIHNhbXBsZVNpemU6IDk4IH0sXG4gICAgICB7IGNhdGVnb3J5OiBBbnlUeXBlQ2F0ZWdvcnkuRVhURVJOQUxfQVBJLCBzdWNjZXNzUmF0ZTogNTIuMywgc2FtcGxlU2l6ZTogNzYgfSxcbiAgICAgIHsgY2F0ZWdvcnk6IEFueVR5cGVDYXRlZ29yeS5URVNUX01PQ0ssIHN1Y2Nlc3NSYXRlOiA4OS43LCBzYW1wbGVTaXplOiAxMzQgfSxcbiAgICAgIHsgY2F0ZWdvcnk6IEFueVR5cGVDYXRlZ29yeS5EWU5BTUlDX0NPTkZJRywgc3VjY2Vzc1JhdGU6IDM4LjksIHNhbXBsZVNpemU6IDY3IH0sXG4gICAgICB7IGNhdGVnb3J5OiBBbnlUeXBlQ2F0ZWdvcnkuTEVHQUNZX0NPTVBBVElCSUxJVFksIHN1Y2Nlc3NSYXRlOiA0MS4yLCBzYW1wbGVTaXplOiA0NSB9XG4gICAgXTtcbiAgfVxuXG4gIHByaXZhdGUgY2FsY3VsYXRlVHJlbmRpbmdNZXRyaWNzKGhpc3RvcmljYWxEYXRhOiBUcmVuZGluZ0RhdGFbXSk6IFRyZW5kaW5nRGF0YSB7XG4gICAgaWYgKGhpc3RvcmljYWxEYXRhLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZGF0ZTogbmV3IERhdGUoKSxcbiAgICAgICAgc3VjY2Vzc1JhdGU6IDAsXG4gICAgICAgIHRvdGFsQW55VHlwZXM6IDAsXG4gICAgICAgIHVuaW50ZW50aW9uYWxDb3VudDogMCxcbiAgICAgICAgY2xhc3NpZmljYXRpb25BY2N1cmFjeTogMFxuICAgICAgfTtcbiAgICB9XG5cbiAgICBjb25zdCBsYXRlc3QgPSBoaXN0b3JpY2FsRGF0YVtoaXN0b3JpY2FsRGF0YS5sZW5ndGggLSAxXTtcbiAgICBjb25zdCBwcmV2aW91cyA9IGhpc3RvcmljYWxEYXRhLmxlbmd0aCA+IDEgPyBoaXN0b3JpY2FsRGF0YVtoaXN0b3JpY2FsRGF0YS5sZW5ndGggLSAyXSA6IGxhdGVzdDtcblxuICAgIHJldHVybiB7XG4gICAgICBkYXRlOiBsYXRlc3QuZGF0ZSxcbiAgICAgIHN1Y2Nlc3NSYXRlOiBsYXRlc3Quc3VjY2Vzc1JhdGUsXG4gICAgICB0b3RhbEFueVR5cGVzOiBsYXRlc3QudG90YWxBbnlUeXBlcyxcbiAgICAgIHVuaW50ZW50aW9uYWxDb3VudDogbGF0ZXN0LnVuaW50ZW50aW9uYWxDb3VudCxcbiAgICAgIGNsYXNzaWZpY2F0aW9uQWNjdXJhY3k6IGxhdGVzdC5jbGFzc2lmaWNhdGlvbkFjY3VyYWN5LFxuICAgICAgdHJlbmRzOiB7XG4gICAgICAgIHN1Y2Nlc3NSYXRlQ2hhbmdlOiBsYXRlc3Quc3VjY2Vzc1JhdGUgLSBwcmV2aW91cy5zdWNjZXNzUmF0ZSxcbiAgICAgICAgdG90YWxBbnlUeXBlc0NoYW5nZTogbGF0ZXN0LnRvdGFsQW55VHlwZXMgLSBwcmV2aW91cy50b3RhbEFueVR5cGVzLFxuICAgICAgICB1bmludGVudGlvbmFsQ291bnRDaGFuZ2U6IGxhdGVzdC51bmludGVudGlvbmFsQ291bnQgLSBwcmV2aW91cy51bmludGVudGlvbmFsQ291bnQsXG4gICAgICAgIGNsYXNzaWZpY2F0aW9uQWNjdXJhY3lDaGFuZ2U6IGxhdGVzdC5jbGFzc2lmaWNhdGlvbkFjY3VyYWN5IC0gcHJldmlvdXMuY2xhc3NpZmljYXRpb25BY2N1cmFjeVxuICAgICAgfVxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIGNhbGN1bGF0ZVByb2plY3RlZENvbXBsZXRpb24odHJlbmRpbmdEYXRhOiBUcmVuZGluZ0RhdGEpOiBEYXRlIHtcbiAgICAvLyBTaW1wbGUgbGluZWFyIHByb2plY3Rpb24gYmFzZWQgb24gY3VycmVudCB0cmVuZFxuICAgIGNvbnN0IGN1cnJlbnRSYXRlID0gdHJlbmRpbmdEYXRhLnN1Y2Nlc3NSYXRlO1xuICAgIGNvbnN0IHRhcmdldFJhdGUgPSA4NTtcbiAgICBjb25zdCByYXRlQ2hhbmdlID0gdHJlbmRpbmdEYXRhLnRyZW5kcz8uc3VjY2Vzc1JhdGVDaGFuZ2UgfHwgMC41OyAvLyBEZWZhdWx0IDAuNSUgaW1wcm92ZW1lbnQgcGVyIGFuYWx5c2lzXG5cbiAgICBpZiAocmF0ZUNoYW5nZSA8PSAwIHx8IGN1cnJlbnRSYXRlID49IHRhcmdldFJhdGUpIHtcbiAgICAgIGNvbnN0IGZ1dHVyZURhdGUgPSBuZXcgRGF0ZSgpO1xuICAgICAgZnV0dXJlRGF0ZS5zZXREYXRlKGZ1dHVyZURhdGUuZ2V0RGF0ZSgpICsgMzApOyAvLyBEZWZhdWx0IDMwIGRheXMgaWYgbm8gaW1wcm92ZW1lbnRcbiAgICAgIHJldHVybiBmdXR1cmVEYXRlO1xuICAgIH1cblxuICAgIGNvbnN0IGRheXNOZWVkZWQgPSBNYXRoLmNlaWwoKHRhcmdldFJhdGUgLSBjdXJyZW50UmF0ZSkgLyByYXRlQ2hhbmdlKTtcbiAgICBjb25zdCBwcm9qZWN0ZWREYXRlID0gbmV3IERhdGUoKTtcbiAgICBwcm9qZWN0ZWREYXRlLnNldERhdGUocHJvamVjdGVkRGF0ZS5nZXREYXRlKCkgKyBkYXlzTmVlZGVkKTtcblxuICAgIHJldHVybiBwcm9qZWN0ZWREYXRlO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBnZW5lcmF0ZVN1Y2Nlc3NSYXRlUmVjb21tZW5kYXRpb25zKGNhdGVnb3J5U3VjY2Vzc1JhdGVzOiBBcnJheTx7IGNhdGVnb3J5OiBBbnlUeXBlQ2F0ZWdvcnk7IHN1Y2Nlc3NSYXRlOiBudW1iZXI7IHNhbXBsZVNpemU6IG51bWJlciB9Pik6IFByb21pc2U8c3RyaW5nW10+IHtcbiAgICBjb25zdCByZWNvbW1lbmRhdGlvbnM6IHN0cmluZ1tdID0gW107XG5cbiAgICAvLyBGaW5kIGNhdGVnb3JpZXMgd2l0aCBsb3cgc3VjY2VzcyByYXRlc1xuICAgIGNvbnN0IGxvd1N1Y2Nlc3NDYXRlZ29yaWVzID0gY2F0ZWdvcnlTdWNjZXNzUmF0ZXMuZmlsdGVyKGNhdCA9PiBjYXQuc3VjY2Vzc1JhdGUgPCA3MCk7XG5cbiAgICBmb3IgKGNvbnN0IGNhdGVnb3J5IG9mIGxvd1N1Y2Nlc3NDYXRlZ29yaWVzKSB7XG4gICAgICBzd2l0Y2ggKGNhdGVnb3J5LmNhdGVnb3J5KSB7XG4gICAgICAgIGNhc2UgQW55VHlwZUNhdGVnb3J5LkZVTkNUSU9OX1BBUkFNOlxuICAgICAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKCdGb2N1cyBvbiBpbXByb3ZpbmcgZnVuY3Rpb24gcGFyYW1ldGVyIHR5cGUgaW5mZXJlbmNlIGFsZ29yaXRobXMnKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBBbnlUeXBlQ2F0ZWdvcnkuUkVUVVJOX1RZUEU6XG4gICAgICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goJ0VuaGFuY2UgcmV0dXJuIHR5cGUgYW5hbHlzaXMgd2l0aCBiZXR0ZXIgY29udGV4dCB1bmRlcnN0YW5kaW5nJyk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgQW55VHlwZUNhdGVnb3J5LkVSUk9SX0hBTkRMSU5HOlxuICAgICAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKCdDb25zaWRlciBwcmVzZXJ2aW5nIGVycm9yIGhhbmRsaW5nIGFueSB0eXBlcyBhcyBpbnRlbnRpb25hbCcpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIEFueVR5cGVDYXRlZ29yeS5FWFRFUk5BTF9BUEk6XG4gICAgICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goJ0ltcHJvdmUgZXh0ZXJuYWwgQVBJIHJlc3BvbnNlIHR5cGUgZGV0ZWN0aW9uJyk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgQW55VHlwZUNhdGVnb3J5LkRZTkFNSUNfQ09ORklHOlxuICAgICAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKCdSZXZpZXcgZHluYW1pYyBjb25maWd1cmF0aW9uIHBhdHRlcm5zIGZvciBiZXR0ZXIgdHlwZSBzYWZldHknKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBBbnlUeXBlQ2F0ZWdvcnkuTEVHQUNZX0NPTVBBVElCSUxJVFk6XG4gICAgICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goJ0V2YWx1YXRlIGxlZ2FjeSBjb21wYXRpYmlsaXR5IHJlcXVpcmVtZW50cyB2cyB0eXBlIHNhZmV0eSBiZW5lZml0cycpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIEZpbmQgY2F0ZWdvcmllcyB3aXRoIGhpZ2ggc3VjY2VzcyByYXRlcyB0byBsZXZlcmFnZVxuICAgIGNvbnN0IGhpZ2hTdWNjZXNzQ2F0ZWdvcmllcyA9IGNhdGVnb3J5U3VjY2Vzc1JhdGVzLmZpbHRlcihjYXQgPT4gY2F0LnN1Y2Nlc3NSYXRlID4gODUpO1xuXG4gICAgaWYgKGhpZ2hTdWNjZXNzQ2F0ZWdvcmllcy5sZW5ndGggPiAwKSB7XG4gICAgICByZWNvbW1lbmRhdGlvbnMucHVzaChgUHJpb3JpdGl6ZSAke2hpZ2hTdWNjZXNzQ2F0ZWdvcmllcy5tYXAoY2F0ID0+IGNhdC5jYXRlZ29yeSkuam9pbignLCAnKX0gY2F0ZWdvcmllcyBmb3IgcXVpY2sgd2luc2ApO1xuICAgIH1cblxuICAgIHJldHVybiByZWNvbW1lbmRhdGlvbnM7XG4gIH1cblxuICBwcml2YXRlIHJlcXVpcmVzTWFudWFsUmV2aWV3KGNsYXNzaWZpY2F0aW9uOiBBbnlUeXBlQ2xhc3NpZmljYXRpb24sIGNvbnRleHQ6IENsYXNzaWZpY2F0aW9uQ29udGV4dCk6IGJvb2xlYW4ge1xuICAgIC8vIExvdyBjb25maWRlbmNlIGNsYXNzaWZpY2F0aW9ucyBuZWVkIG1hbnVhbCByZXZpZXdcbiAgICBpZiAoY2xhc3NpZmljYXRpb24uY29uZmlkZW5jZSA8IDAuNykge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgLy8gQ29tcGxleCBkb21haW4gY29udGV4dHMgbmVlZCBtYW51YWwgcmV2aWV3XG4gICAgaWYgKGNvbnRleHQuZG9tYWluQ29udGV4dC5pbnRlbnRpb25hbGl0eUhpbnRzLmxlbmd0aCA+IDIpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIC8vIENvbmZsaWN0aW5nIHNpZ25hbHMgbmVlZCBtYW51YWwgcmV2aWV3XG4gICAgaWYgKGNsYXNzaWZpY2F0aW9uLmlzSW50ZW50aW9uYWwgJiYgY2xhc3NpZmljYXRpb24uc3VnZ2VzdGVkUmVwbGFjZW1lbnQpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIC8vIEhpZ2gtcmlzayBjYXRlZ29yaWVzIG5lZWQgbWFudWFsIHJldmlld1xuICAgIGNvbnN0IGhpZ2hSaXNrQ2F0ZWdvcmllcyA9IFtcbiAgICAgIEFueVR5cGVDYXRlZ29yeS5FWFRFUk5BTF9BUEksXG4gICAgICBBbnlUeXBlQ2F0ZWdvcnkuRFlOQU1JQ19DT05GSUcsXG4gICAgICBBbnlUeXBlQ2F0ZWdvcnkuTEVHQUNZX0NPTVBBVElCSUxJVFlcbiAgICBdO1xuXG4gICAgcmV0dXJuIGhpZ2hSaXNrQ2F0ZWdvcmllcy5pbmNsdWRlcyhjbGFzc2lmaWNhdGlvbi5jYXRlZ29yeSk7XG4gIH1cblxuICBwcml2YXRlIGdldFJldmlld1JlYXNvbihjbGFzc2lmaWNhdGlvbjogQW55VHlwZUNsYXNzaWZpY2F0aW9uLCBjb250ZXh0OiBDbGFzc2lmaWNhdGlvbkNvbnRleHQpOiBzdHJpbmcge1xuICAgIGlmIChjbGFzc2lmaWNhdGlvbi5jb25maWRlbmNlIDwgMC43KSB7XG4gICAgICByZXR1cm4gYExvdyBjbGFzc2lmaWNhdGlvbiBjb25maWRlbmNlICgkeyhjbGFzc2lmaWNhdGlvbi5jb25maWRlbmNlICogMTAwKS50b0ZpeGVkKDEpfSUpYDtcbiAgICB9XG5cbiAgICBpZiAoY29udGV4dC5kb21haW5Db250ZXh0LmludGVudGlvbmFsaXR5SGludHMubGVuZ3RoID4gMikge1xuICAgICAgcmV0dXJuICdDb21wbGV4IGRvbWFpbiBjb250ZXh0IHdpdGggbXVsdGlwbGUgaW50ZW50aW9uYWxpdHkgaGludHMnO1xuICAgIH1cblxuICAgIGlmIChjbGFzc2lmaWNhdGlvbi5pc0ludGVudGlvbmFsICYmIGNsYXNzaWZpY2F0aW9uLnN1Z2dlc3RlZFJlcGxhY2VtZW50KSB7XG4gICAgICByZXR1cm4gJ0NvbmZsaWN0aW5nIHNpZ25hbHM6IGNsYXNzaWZpZWQgYXMgaW50ZW50aW9uYWwgYnV0IGhhcyBzdWdnZXN0ZWQgcmVwbGFjZW1lbnQnO1xuICAgIH1cblxuICAgIHJldHVybiBgSGlnaC1yaXNrIGNhdGVnb3J5OiAke2NsYXNzaWZpY2F0aW9uLmNhdGVnb3J5fWA7XG4gIH1cblxuICBwcml2YXRlIGNhbGN1bGF0ZVJldmlld1ByaW9yaXR5KGNsYXNzaWZpY2F0aW9uOiBBbnlUeXBlQ2xhc3NpZmljYXRpb24sIGNvbnRleHQ6IENsYXNzaWZpY2F0aW9uQ29udGV4dCk6ICdoaWdoJyB8ICdtZWRpdW0nIHwgJ2xvdycge1xuICAgIC8vIEhpZ2ggcHJpb3JpdHk6IExvdyBjb25maWRlbmNlIG9yIGNvbmZsaWN0aW5nIHNpZ25hbHNcbiAgICBpZiAoY2xhc3NpZmljYXRpb24uY29uZmlkZW5jZSA8IDAuNiB8fCAoY2xhc3NpZmljYXRpb24uaXNJbnRlbnRpb25hbCAmJiBjbGFzc2lmaWNhdGlvbi5zdWdnZXN0ZWRSZXBsYWNlbWVudCkpIHtcbiAgICAgIHJldHVybiAnaGlnaCc7XG4gICAgfVxuXG4gICAgLy8gTWVkaXVtIHByaW9yaXR5OiBNb2RlcmF0ZSBjb25maWRlbmNlIG9yIGNvbXBsZXggY29udGV4dFxuICAgIGlmIChjbGFzc2lmaWNhdGlvbi5jb25maWRlbmNlIDwgMC44IHx8IGNvbnRleHQuZG9tYWluQ29udGV4dC5pbnRlbnRpb25hbGl0eUhpbnRzLmxlbmd0aCA+IDEpIHtcbiAgICAgIHJldHVybiAnbWVkaXVtJztcbiAgICB9XG5cbiAgICAvLyBMb3cgcHJpb3JpdHk6IEhpZ2ggY29uZmlkZW5jZSwgc2ltcGxlIGNhc2VzXG4gICAgcmV0dXJuICdsb3cnO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBnZW5lcmF0ZVN1Z2dlc3RlZEFjdGlvbnMoY2xhc3NpZmljYXRpb246IEFueVR5cGVDbGFzc2lmaWNhdGlvbiwgY29udGV4dDogQ2xhc3NpZmljYXRpb25Db250ZXh0KTogUHJvbWlzZTxzdHJpbmdbXT4ge1xuICAgIGNvbnN0IGFjdGlvbnM6IHN0cmluZ1tdID0gW107XG5cbiAgICBpZiAoY2xhc3NpZmljYXRpb24uY29uZmlkZW5jZSA8IDAuNykge1xuICAgICAgYWN0aW9ucy5wdXNoKCdSZXZpZXcgY2xhc3NpZmljYXRpb24gbG9naWMgYW5kIGFkZCBtb3JlIGNvbnRleHQnKTtcbiAgICB9XG5cbiAgICBpZiAoY2xhc3NpZmljYXRpb24uc3VnZ2VzdGVkUmVwbGFjZW1lbnQpIHtcbiAgICAgIGFjdGlvbnMucHVzaChgQ29uc2lkZXIgcmVwbGFjaW5nIHdpdGg6ICR7Y2xhc3NpZmljYXRpb24uc3VnZ2VzdGVkUmVwbGFjZW1lbnR9YCk7XG4gICAgfVxuXG4gICAgaWYgKCFjbGFzc2lmaWNhdGlvbi5pc0ludGVudGlvbmFsKSB7XG4gICAgICBhY3Rpb25zLnB1c2goJ0F0dGVtcHQgYXV0b21hdGVkIHJlcGxhY2VtZW50IHdpdGggc2FmZXR5IHZhbGlkYXRpb24nKTtcbiAgICB9IGVsc2Uge1xuICAgICAgYWN0aW9ucy5wdXNoKCdBZGQgZG9jdW1lbnRhdGlvbiBleHBsYWluaW5nIHdoeSBhbnkgdHlwZSBpcyBuZWNlc3NhcnknKTtcbiAgICB9XG5cbiAgICBpZiAoY29udGV4dC5kb21haW5Db250ZXh0LnN1Z2dlc3RlZFR5cGVzLmxlbmd0aCA+IDApIHtcbiAgICAgIGFjdGlvbnMucHVzaChgQ29uc2lkZXIgZG9tYWluLXNwZWNpZmljIHR5cGVzOiAke2NvbnRleHQuZG9tYWluQ29udGV4dC5zdWdnZXN0ZWRUeXBlcy5qb2luKCcsICcpfWApO1xuICAgIH1cblxuICAgIHJldHVybiBhY3Rpb25zO1xuICB9XG5cbiAgcHJpdmF0ZSBlc3RpbWF0ZVJldmlld0VmZm9ydChjbGFzc2lmaWNhdGlvbjogQW55VHlwZUNsYXNzaWZpY2F0aW9uLCBjb250ZXh0OiBDbGFzc2lmaWNhdGlvbkNvbnRleHQpOiAnbG93JyB8ICdtZWRpdW0nIHwgJ2hpZ2gnIHtcbiAgICAvLyBIaWdoIGVmZm9ydDogQ29tcGxleCBkb21haW4gY29udGV4dCBvciBsb3cgY29uZmlkZW5jZVxuICAgIGlmIChjbGFzc2lmaWNhdGlvbi5jb25maWRlbmNlIDwgMC42IHx8IGNvbnRleHQuZG9tYWluQ29udGV4dC5pbnRlbnRpb25hbGl0eUhpbnRzLmxlbmd0aCA+IDIpIHtcbiAgICAgIHJldHVybiAnaGlnaCc7XG4gICAgfVxuXG4gICAgLy8gTWVkaXVtIGVmZm9ydDogTW9kZXJhdGUgY29tcGxleGl0eVxuICAgIGlmIChjbGFzc2lmaWNhdGlvbi5jb25maWRlbmNlIDwgMC44IHx8IGNvbnRleHQuZG9tYWluQ29udGV4dC5pbnRlbnRpb25hbGl0eUhpbnRzLmxlbmd0aCA+IDApIHtcbiAgICAgIHJldHVybiAnbWVkaXVtJztcbiAgICB9XG5cbiAgICAvLyBMb3cgZWZmb3J0OiBTaW1wbGUgY2FzZXNcbiAgICByZXR1cm4gJ2xvdyc7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGZpbmRSZWxhdGVkT2NjdXJyZW5jZXMob2NjdXJyZW5jZTogeyBmaWxlUGF0aDogc3RyaW5nOyBsaW5lTnVtYmVyOiBudW1iZXI7IGNvZGVTbmlwcGV0OiBzdHJpbmcgfSk6IFByb21pc2U8QXJyYXk8eyBmaWxlUGF0aDogc3RyaW5nOyBsaW5lTnVtYmVyOiBudW1iZXIgfT4+IHtcbiAgICAvLyBGaW5kIG90aGVyIGFueSB0eXBlcyBpbiB0aGUgc2FtZSBmaWxlXG4gICAgY29uc3QgcmVsYXRlZE9jY3VycmVuY2VzOiBBcnJheTx7IGZpbGVQYXRoOiBzdHJpbmc7IGxpbmVOdW1iZXI6IG51bWJlciB9PiA9IFtdO1xuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGdyZXBDb21tYW5kID0gYGdyZXAgLW4gXCJcXFxcYmFueVxcXFxiXCIgXCIke29jY3VycmVuY2UuZmlsZVBhdGh9XCJgO1xuICAgICAgY29uc3Qgb3V0cHV0ID0gZXhlY1N5bmMoZ3JlcENvbW1hbmQsIHsgZW5jb2Rpbmc6ICd1dGY4Jywgc3RkaW86ICdwaXBlJyB9KTtcblxuICAgICAgY29uc3QgbGluZXMgPSBvdXRwdXQudHJpbSgpLnNwbGl0KCdcXG4nKS5maWx0ZXIobGluZSA9PiBsaW5lLnRyaW0oKSk7XG5cbiAgICAgIGZvciAoY29uc3QgbGluZSBvZiBsaW5lcykge1xuICAgICAgICBjb25zdCBtYXRjaCA9IGxpbmUubWF0Y2goL14oXFxkKyk6KC4rKSQvKTtcbiAgICAgICAgaWYgKG1hdGNoKSB7XG4gICAgICAgICAgY29uc3QgbGluZU51bWJlciA9IHBhcnNlSW50KG1hdGNoWzFdKTtcbiAgICAgICAgICBpZiAobGluZU51bWJlciAhPT0gb2NjdXJyZW5jZS5saW5lTnVtYmVyKSB7XG4gICAgICAgICAgICByZWxhdGVkT2NjdXJyZW5jZXMucHVzaCh7XG4gICAgICAgICAgICAgIGZpbGVQYXRoOiBvY2N1cnJlbmNlLmZpbGVQYXRoLFxuICAgICAgICAgICAgICBsaW5lTnVtYmVyXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgLy8gTm8gcmVsYXRlZCBvY2N1cnJlbmNlcyBmb3VuZFxuICAgIH1cblxuICAgIHJldHVybiByZWxhdGVkT2NjdXJyZW5jZXMuc2xpY2UoMCwgNSk7IC8vIExpbWl0IHRvIDUgcmVsYXRlZCBvY2N1cnJlbmNlc1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRUb3BEb21haW4oZGlzdHJpYnV0aW9uOiBEb21haW5EaXN0cmlidXRpb24pOiBDb2RlRG9tYWluIHtcbiAgICBjb25zdCB0b3BEb21haW4gPSBkaXN0cmlidXRpb24uYnlEb21haW4ucmVkdWNlKChtYXgsIGN1cnJlbnQpID0+XG4gICAgICBjdXJyZW50LmNvdW50ID4gbWF4LmNvdW50ID8gY3VycmVudCA6IG1heFxuICAgICk7XG4gICAgcmV0dXJuIHRvcERvbWFpbi5kb21haW47XG4gIH1cblxuICBwcml2YXRlIGdldFRvcENhdGVnb3J5KGRpc3RyaWJ1dGlvbjogRG9tYWluRGlzdHJpYnV0aW9uKTogQW55VHlwZUNhdGVnb3J5IHtcbiAgICBjb25zdCB0b3BDYXRlZ29yeSA9IGRpc3RyaWJ1dGlvbi5ieUNhdGVnb3J5LnJlZHVjZSgobWF4LCBjdXJyZW50KSA9PlxuICAgICAgY3VycmVudC5jb3VudCA+IG1heC5jb3VudCA/IGN1cnJlbnQgOiBtYXhcbiAgICApO1xuICAgIHJldHVybiB0b3BDYXRlZ29yeS5jYXRlZ29yeTtcbiAgfVxuXG4gIHByaXZhdGUgbG9hZEFuYWx5c2lzSGlzdG9yeSgpOiB2b2lkIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgaGlzdG9yeVBhdGggPSBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgJy5raXJvJywgJ2NhbXBhaWduLXJlcG9ydHMnLCAndW5pbnRlbnRpb25hbC1hbnktYW5hbHlzaXMtaGlzdG9yeS5qc29uJyk7XG4gICAgICBpZiAoZnMuZXhpc3RzU3luYyhoaXN0b3J5UGF0aCkpIHtcbiAgICAgICAgY29uc3QgaGlzdG9yeURhdGEgPSBmcy5yZWFkRmlsZVN5bmMoaGlzdG9yeVBhdGgsICd1dGY4Jyk7XG4gICAgICAgIHRoaXMuYW5hbHlzaXNIaXN0b3J5ID0gSlNPTi5wYXJzZShoaXN0b3J5RGF0YSk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUud2FybignQ291bGQgbm90IGxvYWQgYW5hbHlzaXMgaGlzdG9yeTonLCBlcnJvcik7XG4gICAgICB0aGlzLmFuYWx5c2lzSGlzdG9yeSA9IFtdO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgc2F2ZUFuYWx5c2lzSGlzdG9yeSgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgaGlzdG9yeURpciA9IHBhdGguam9pbihwcm9jZXNzLmN3ZCgpLCAnLmtpcm8nLCAnY2FtcGFpZ24tcmVwb3J0cycpO1xuICAgICAgaWYgKCFmcy5leGlzdHNTeW5jKGhpc3RvcnlEaXIpKSB7XG4gICAgICAgIGZzLm1rZGlyU3luYyhoaXN0b3J5RGlyLCB7IHJlY3Vyc2l2ZTogdHJ1ZSB9KTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgaGlzdG9yeVBhdGggPSBwYXRoLmpvaW4oaGlzdG9yeURpciwgJ3VuaW50ZW50aW9uYWwtYW55LWFuYWx5c2lzLWhpc3RvcnkuanNvbicpO1xuICAgICAgZnMud3JpdGVGaWxlU3luYyhoaXN0b3J5UGF0aCwgSlNPTi5zdHJpbmdpZnkodGhpcy5hbmFseXNpc0hpc3RvcnksIG51bGwsIDIpKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS53YXJuKCdDb3VsZCBub3Qgc2F2ZSBhbmFseXNpcyBoaXN0b3J5OicsIGVycm9yKTtcbiAgICB9XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==