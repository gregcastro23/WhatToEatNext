1f34c8a42c14db1da811b9b383a52e55
"use strict";
/**
 * Performance Monitoring System
 * Perfect Codebase Campaign - Phase 4 Implementation
 *
 * Implements comprehensive performance monitoring with:
 * - Build time measurement using `time yarn build` integration
 * - Cache hit rate monitoring and memory usage tracking
 * - Performance regression detection with automatic alerts
 */
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.PerformanceMonitoringSystem = void 0;
const child_process_1 = require("child_process");
const fs = __importStar(require("fs"));
const ProgressTracker_1 = require("./ProgressTracker");
class PerformanceMonitoringSystem extends ProgressTracker_1.ProgressTracker {
    constructor() {
        super();
        this.performanceHistory = [];
        this.alerts = [];
        this.monitoringInterval = null;
        this.PERFORMANCE_TARGETS = {
            buildTime: 10,
            cacheHitRate: 0.8,
            memoryUsage: 50,
            bundleSize: 420, // kB
        };
    }
    /**
     * Measure build time using time command integration
     */
    async measureBuildTime() {
        try {
            console.log('üìä Measuring build time...');
            // Use time command to measure build execution
            const startTime = process.hrtime.bigint();
            // Execute build with time measurement
            const timeOutput = (0, child_process_1.execSync)('time -p yarn build 2>&1', {
                encoding: 'utf8',
                stdio: 'pipe',
            });
            const endTime = process.hrtime.bigint();
            const buildTimeSeconds = Number(endTime - startTime) / 1000000000;
            // Also try to extract time from the time command output
            const timeMatch = timeOutput.match(/real\s+(\d+\.\d+)/);
            const measuredTime = timeMatch
                ? parseFloat(timeMatch[1])
                : buildTimeSeconds;
            console.log(`‚è±Ô∏è  Build completed in ${measuredTime.toFixed(2)}s`);
            return measuredTime;
        }
        catch (error) {
            console.warn(`‚ö†Ô∏è  Build time measurement failed: ${error.message}`);
            // Fallback to simple timing if time command fails
            try {
                const startTime = Date.now();
                (0, child_process_1.execSync)('yarn build', { encoding: 'utf8', stdio: 'pipe' });
                const endTime = Date.now();
                const fallbackTime = (endTime - startTime) / 1000;
                console.log(`‚è±Ô∏è  Build completed in ${fallbackTime.toFixed(2)}s (fallback timing)`);
                return fallbackTime;
            }
            catch (buildError) {
                console.error(`‚ùå Build failed: ${buildError.message}`);
                return -1;
            }
        }
    }
    /**
     * Monitor cache hit rate from build system
     */
    async monitorCacheHitRate() {
        try {
            // Check for Next.js cache information
            if (fs.existsSync('.next')) {
                const cacheDir = '.next/cache';
                if (fs.existsSync(cacheDir)) {
                    // Count cache files and estimate hit rate
                    const cacheFiles = (0, child_process_1.execSync)(`find ${cacheDir} -type f | wc -l`, {
                        encoding: 'utf8',
                        stdio: 'pipe',
                    });
                    const cacheCount = parseInt(cacheFiles.trim()) || 0;
                    // Estimate cache hit rate based on cache file count
                    // This is a simplified estimation - in a real system, you'd track actual cache hits
                    const estimatedHitRate = Math.min(0.95, Math.max(0.5, cacheCount / 1000));
                    console.log(`üìà Cache hit rate estimated: ${(estimatedHitRate * 100).toFixed(1)}%`);
                    return estimatedHitRate;
                }
            }
            // Check for other build system caches
            const cacheDirs = ['.yarn/cache', 'node_modules/.cache', '.cache'];
            let totalCacheSize = 0;
            for (const dir of cacheDirs) {
                if (fs.existsSync(dir)) {
                    try {
                        const sizeOutput = (0, child_process_1.execSync)(`du -sk ${dir} | cut -f1`, {
                            encoding: 'utf8',
                            stdio: 'pipe',
                        });
                        totalCacheSize += parseInt(sizeOutput.trim()) || 0;
                    }
                    catch (error) {
                        // Ignore individual cache directory errors
                    }
                }
            }
            // Estimate hit rate based on cache size (simplified heuristic)
            const estimatedHitRate = totalCacheSize > 10000 ? 0.8 : 0.6;
            console.log(`üìà Cache hit rate estimated: ${(estimatedHitRate * 100).toFixed(1)}% (based on cache size: ${totalCacheSize}kB)`);
            return estimatedHitRate;
        }
        catch (error) {
            console.warn(`‚ö†Ô∏è  Cache hit rate monitoring failed: ${error.message}`);
            return 0.7; // Default reasonable estimate
        }
    }
    /**
     * Track memory usage during build and runtime
     */
    async trackMemoryUsage() {
        try {
            // Get current Node.js process memory usage
            const memUsage = process.memoryUsage();
            const currentMB = Math.round(memUsage.heapUsed / 1024 / 1024);
            const peakMB = Math.round(memUsage.heapTotal / 1024 / 1024);
            // Also check system memory if available
            try {
                const systemMemOutput = (0, child_process_1.execSync)('ps -o pid,vsz,rss,comm -p $$ | tail -1', {
                    encoding: 'utf8',
                    stdio: 'pipe',
                });
                const memMatch = systemMemOutput.match(/\s+(\d+)\s+(\d+)\s+(\d+)/);
                if (memMatch) {
                    const systemCurrentMB = Math.round(parseInt(memMatch[3]) / 1024); // RSS in MB
                    console.log(`üíæ Memory usage: ${currentMB}MB (heap), ${systemCurrentMB}MB (system)`);
                    return {
                        current: Math.max(currentMB, systemCurrentMB),
                        peak: peakMB,
                    };
                }
            }
            catch (systemError) {
                // Fallback to Node.js memory only
            }
            console.log(`üíæ Memory usage: ${currentMB}MB (current), ${peakMB}MB (peak)`);
            return { current: currentMB, peak: peakMB };
        }
        catch (error) {
            console.warn(`‚ö†Ô∏è  Memory usage tracking failed: ${error.message}`);
            return { current: 0, peak: 0 };
        }
    }
    /**
     * Detect performance regressions automatically
     */
    async detectPerformanceRegression() {
        if (this.performanceHistory.length < 3) {
            return false; // Need at least 3 data points for trend analysis
        }
        const recent = this.performanceHistory.slice(-3);
        let regressionDetected = false;
        // Check build time regression (increasing trend)
        const buildTimes = recent.map(m => m.buildTime.current);
        if (buildTimes[2] > buildTimes[1] && buildTimes[1] > buildTimes[0]) {
            const increase = ((buildTimes[2] - buildTimes[0]) / buildTimes[0]) * 100;
            if (increase > 20) {
                // 20% increase threshold
                this.addAlert({
                    type: 'build_time',
                    severity: 'warning',
                    message: `Build time regression detected: ${increase.toFixed(1)}% increase over recent builds`,
                    currentValue: buildTimes[2],
                    targetValue: this.PERFORMANCE_TARGETS.buildTime,
                    timestamp: new Date(),
                    recommendations: [
                        'Check for new dependencies or code changes',
                        'Review build configuration for optimization opportunities',
                        'Consider cache invalidation or cleanup',
                    ],
                });
                regressionDetected = true;
            }
        }
        // Check cache hit rate regression (decreasing trend)
        const cacheRates = recent.map(m => m.cacheHitRate.current);
        if (cacheRates[2] < cacheRates[1] && cacheRates[1] < cacheRates[0]) {
            const decrease = ((cacheRates[0] - cacheRates[2]) / cacheRates[0]) * 100;
            if (decrease > 15) {
                // 15% decrease threshold
                this.addAlert({
                    type: 'cache_hit_rate',
                    severity: 'warning',
                    message: `Cache hit rate regression detected: ${decrease.toFixed(1)}% decrease`,
                    currentValue: cacheRates[2],
                    targetValue: this.PERFORMANCE_TARGETS.cacheHitRate,
                    timestamp: new Date(),
                    recommendations: [
                        'Check cache configuration and invalidation policies',
                        'Review recent changes that might affect caching',
                        'Consider cache warming strategies',
                    ],
                });
                regressionDetected = true;
            }
        }
        // Check memory usage regression (increasing trend)
        const memoryUsages = recent.map(m => m.memoryUsage.current);
        if (memoryUsages[2] > memoryUsages[1] &&
            memoryUsages[1] > memoryUsages[0]) {
            const increase = ((memoryUsages[2] - memoryUsages[0]) / memoryUsages[0]) * 100;
            if (increase > 25) {
                // 25% increase threshold
                this.addAlert({
                    type: 'memory_usage',
                    severity: 'critical',
                    message: `Memory usage regression detected: ${increase.toFixed(1)}% increase`,
                    currentValue: memoryUsages[2],
                    targetValue: this.PERFORMANCE_TARGETS.memoryUsage,
                    timestamp: new Date(),
                    recommendations: [
                        'Check for memory leaks in recent code changes',
                        'Review data structures and caching strategies',
                        'Consider garbage collection optimization',
                    ],
                });
                regressionDetected = true;
            }
        }
        return regressionDetected;
    }
    /**
     * Generate automatic alerts for performance issues
     */
    addAlert(alert) {
        this.alerts.push(alert);
        // Keep only recent alerts to prevent memory issues
        if (this.alerts.length > 100) {
            this.alerts = this.alerts.slice(-50);
        }
        // Log alert immediately
        const severityIcon = alert.severity === 'critical' ? 'üö®' : '‚ö†Ô∏è';
        console.log(`${severityIcon} Performance Alert: ${alert.message}`);
        if (alert.recommendations.length > 0) {
            console.log('üí° Recommendations:');
            alert.recommendations.forEach(rec => console.log(`   ‚Ä¢ ${rec}`));
        }
    }
    /**
     * Get comprehensive performance metrics
     */
    async getPerformanceMetrics() {
        const buildTime = await this.measureBuildTime();
        const cacheHitRate = await this.monitorCacheHitRate();
        const memoryUsage = await this.trackMemoryUsage();
        const bundleSize = await this.getBundleSize();
        // Calculate averages from history
        const buildTimeAvg = this.performanceHistory.length > 0
            ? this.performanceHistory.reduce((sum, m) => sum + m.buildTime.current, 0) / this.performanceHistory.length
            : buildTime;
        const cacheHitRateAvg = this.performanceHistory.length > 0
            ? this.performanceHistory.reduce((sum, m) => sum + m.cacheHitRate.current, 0) / this.performanceHistory.length
            : cacheHitRate;
        const memoryUsageAvg = this.performanceHistory.length > 0
            ? this.performanceHistory.reduce((sum, m) => sum + m.memoryUsage.current, 0) / this.performanceHistory.length
            : memoryUsage.current;
        // Determine trends
        const buildTimeTrend = this.calculateTrend(this.performanceHistory.map(m => m.buildTime.current), buildTime);
        const cacheHitRateTrend = this.calculateTrend(this.performanceHistory.map(m => m.cacheHitRate.current), cacheHitRate);
        const bundleSizeTrend = this.calculateTrend(this.performanceHistory.map(m => m.bundleSize.current), bundleSize);
        const metrics = {
            buildTime: {
                current: buildTime,
                target: this.PERFORMANCE_TARGETS.buildTime,
                average: buildTimeAvg,
                trend: buildTimeTrend,
            },
            cacheHitRate: {
                current: cacheHitRate,
                target: this.PERFORMANCE_TARGETS.cacheHitRate,
                average: cacheHitRateAvg,
                trend: cacheHitRateTrend,
            },
            memoryUsage: {
                current: memoryUsage.current,
                target: this.PERFORMANCE_TARGETS.memoryUsage,
                peak: memoryUsage.peak,
                average: memoryUsageAvg,
            },
            bundleSize: {
                current: bundleSize,
                target: this.PERFORMANCE_TARGETS.bundleSize,
                compressed: Math.round(bundleSize * 0.7),
                trend: bundleSizeTrend,
            },
        };
        // Store in history
        this.performanceHistory.push(metrics);
        // Keep only recent history
        if (this.performanceHistory.length > 50) {
            this.performanceHistory = this.performanceHistory.slice(-25);
        }
        return metrics;
    }
    /**
     * Calculate trend from historical data
     */
    calculateTrend(history, current) {
        if (history.length < 2)
            return 'stable';
        const recent = history.slice(-3);
        const average = recent.reduce((sum, val) => sum + val, 0) / recent.length;
        const changePercent = ((current - average) / average) * 100;
        if (Math.abs(changePercent) < 5)
            return 'stable';
        return changePercent < 0 ? 'improving' : 'degrading';
    }
    /**
     * Generate comprehensive performance report
     */
    async generatePerformanceReport() {
        const metrics = await this.getPerformanceMetrics();
        const regressionDetected = await this.detectPerformanceRegression();
        // Calculate overall performance score (0-100)
        const buildTimeScore = Math.max(0, Math.min(100, (this.PERFORMANCE_TARGETS.buildTime /
            Math.max(metrics.buildTime.current, 0.1)) *
            100));
        const cacheHitRateScore = metrics.cacheHitRate.current * 100;
        const memoryScore = Math.max(0, Math.min(100, (this.PERFORMANCE_TARGETS.memoryUsage /
            Math.max(metrics.memoryUsage.current, 1)) *
            100));
        const bundleSizeScore = Math.max(0, Math.min(100, (this.PERFORMANCE_TARGETS.bundleSize /
            Math.max(metrics.bundleSize.current, 1)) *
            100));
        const overallScore = Math.round((buildTimeScore + cacheHitRateScore + memoryScore + bundleSizeScore) / 4);
        // Generate recommendations
        const recommendations = [];
        if (metrics.buildTime.current > this.PERFORMANCE_TARGETS.buildTime) {
            recommendations.push(`Build time (${metrics.buildTime.current.toFixed(1)}s) exceeds target (${this.PERFORMANCE_TARGETS.buildTime}s)`);
        }
        if (metrics.cacheHitRate.current < this.PERFORMANCE_TARGETS.cacheHitRate) {
            recommendations.push(`Cache hit rate (${(metrics.cacheHitRate.current * 100).toFixed(1)}%) below target (${this.PERFORMANCE_TARGETS.cacheHitRate * 100}%)`);
        }
        if (metrics.memoryUsage.current > this.PERFORMANCE_TARGETS.memoryUsage) {
            recommendations.push(`Memory usage (${metrics.memoryUsage.current}MB) exceeds target (${this.PERFORMANCE_TARGETS.memoryUsage}MB)`);
        }
        if (metrics.bundleSize.current > this.PERFORMANCE_TARGETS.bundleSize) {
            recommendations.push(`Bundle size (${metrics.bundleSize.current}kB) exceeds target (${this.PERFORMANCE_TARGETS.bundleSize}kB)`);
        }
        return {
            timestamp: new Date(),
            metrics,
            alerts: [...this.alerts],
            regressionDetected,
            overallScore,
            recommendations,
        };
    }
    /**
     * Start continuous performance monitoring
     */
    startMonitoring(intervalMinutes = 5) {
        if (this.monitoringInterval) {
            clearInterval(this.monitoringInterval);
        }
        console.log(`üìä Starting performance monitoring (every ${intervalMinutes} minutes)`);
        this.monitoringInterval = setInterval(async () => {
            try {
                await this.getPerformanceMetrics();
                await this.detectPerformanceRegression();
            }
            catch (error) {
                console.warn(`‚ö†Ô∏è  Performance monitoring error: ${error.message}`);
            }
        }, intervalMinutes * 60 * 1000);
    }
    /**
     * Stop continuous performance monitoring
     */
    stopMonitoring() {
        if (this.monitoringInterval) {
            clearInterval(this.monitoringInterval);
            this.monitoringInterval = null;
            console.log('üìä Performance monitoring stopped');
        }
    }
    /**
     * Export performance data for analysis
     */
    async exportPerformanceData(filePath) {
        try {
            const report = await this.generatePerformanceReport();
            const exportData = {
                timestamp: new Date().toISOString(),
                report,
                history: this.performanceHistory,
                alerts: this.alerts,
                targets: this.PERFORMANCE_TARGETS,
            };
            fs.writeFileSync(filePath, JSON.stringify(exportData, null, 2));
            console.log(`üìä Performance data exported to: ${filePath}`);
        }
        catch (error) {
            throw new Error(`Failed to export performance data: ${error.message}`);
        }
    }
    /**
     * Get current alerts
     */
    getCurrentAlerts() {
        return [...this.alerts];
    }
    /**
     * Clear all alerts
     */
    clearAlerts() {
        this.alerts = [];
        console.log('üìä Performance alerts cleared');
    }
    /**
     * Get performance history
     */
    getPerformanceHistory() {
        return [...this.performanceHistory];
    }
}
exports.PerformanceMonitoringSystem = PerformanceMonitoringSystem;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9zZXJ2aWNlcy9jYW1wYWlnbi9QZXJmb3JtYW5jZU1vbml0b3JpbmdTeXN0ZW0udHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7Ozs7OztHQVFHOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUVILGlEQUF5QztBQUN6Qyx1Q0FBeUI7QUFFekIsdURBQW9EO0FBZ0RwRCxNQUFhLDJCQUE0QixTQUFRLGlDQUFlO0lBVzlEO1FBQ0UsS0FBSyxFQUFFLENBQUM7UUFYRix1QkFBa0IsR0FBeUIsRUFBRSxDQUFDO1FBQzlDLFdBQU0sR0FBdUIsRUFBRSxDQUFDO1FBQ2hDLHVCQUFrQixHQUEwQixJQUFJLENBQUM7UUFDeEMsd0JBQW1CLEdBQUc7WUFDckMsU0FBUyxFQUFFLEVBQUU7WUFDYixZQUFZLEVBQUUsR0FBRztZQUNqQixXQUFXLEVBQUUsRUFBRTtZQUNmLFVBQVUsRUFBRSxHQUFHLEVBQUUsS0FBSztTQUN2QixDQUFDO0lBSUYsQ0FBQztJQUVEOztPQUVHO0lBQ0gsS0FBSyxDQUFDLGdCQUFnQjtRQUNwQixJQUFJO1lBQ0YsT0FBTyxDQUFDLEdBQUcsQ0FBQyw0QkFBNEIsQ0FBQyxDQUFDO1lBRTFDLDhDQUE4QztZQUM5QyxNQUFNLFNBQVMsR0FBRyxPQUFPLENBQUMsTUFBTSxDQUFDLE1BQU0sRUFBRSxDQUFDO1lBRTFDLHNDQUFzQztZQUN0QyxNQUFNLFVBQVUsR0FBRyxJQUFBLHdCQUFRLEVBQUMseUJBQXlCLEVBQUU7Z0JBQ3JELFFBQVEsRUFBRSxNQUFNO2dCQUNoQixLQUFLLEVBQUUsTUFBTTthQUNkLENBQUMsQ0FBQztZQUVILE1BQU0sT0FBTyxHQUFHLE9BQU8sQ0FBQyxNQUFNLENBQUMsTUFBTSxFQUFFLENBQUM7WUFDeEMsTUFBTSxnQkFBZ0IsR0FBRyxNQUFNLENBQUMsT0FBTyxHQUFHLFNBQVMsQ0FBQyxHQUFHLFVBQWEsQ0FBQztZQUVyRSx3REFBd0Q7WUFDeEQsTUFBTSxTQUFTLEdBQUcs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RDs7T0FFRztJQUNILGdCQUFnQjtRQUNkLE9BQU8sQ0FBQyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUMxQixDQUFDO0lBRUQ7O09BRUc7SUFDSCxXQUFXO1FBQ1QsSUFBSSxDQUFDLE1BQU0sR0FBRyxFQUFFLENBQUM7UUFDakIsT0FBTyxDQUFDLEdBQUcsQ0FBQywrQkFBK0IsQ0FBQyxDQUFDO0lBQy9DLENBQUM7SUFFRDs7T0FFRztJQUNILHFCQUFxQjtRQUNuQixPQUFPLENBQUMsR0FBRyxJQUFJLENBQUMsa0JBQWtCLENBQUMsQ0FBQztJQUN0QyxDQUFDO0NBQ0Y7QUExaEJELGtFQTBoQkMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9zZXJ2aWNlcy9jYW1wYWlnbi9QZXJmb3JtYW5jZU1vbml0b3JpbmdTeXN0ZW0udHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBQZXJmb3JtYW5jZSBNb25pdG9yaW5nIFN5c3RlbVxuICogUGVyZmVjdCBDb2RlYmFzZSBDYW1wYWlnbiAtIFBoYXNlIDQgSW1wbGVtZW50YXRpb25cbiAqXG4gKiBJbXBsZW1lbnRzIGNvbXByZWhlbnNpdmUgcGVyZm9ybWFuY2UgbW9uaXRvcmluZyB3aXRoOlxuICogLSBCdWlsZCB0aW1lIG1lYXN1cmVtZW50IHVzaW5nIGB0aW1lIHlhcm4gYnVpbGRgIGludGVncmF0aW9uXG4gKiAtIENhY2hlIGhpdCByYXRlIG1vbml0b3JpbmcgYW5kIG1lbW9yeSB1c2FnZSB0cmFja2luZ1xuICogLSBQZXJmb3JtYW5jZSByZWdyZXNzaW9uIGRldGVjdGlvbiB3aXRoIGF1dG9tYXRpYyBhbGVydHNcbiAqL1xuXG5pbXBvcnQgeyBleGVjU3luYyB9IGZyb20gJ2NoaWxkX3Byb2Nlc3MnO1xuaW1wb3J0ICogYXMgZnMgZnJvbSAnZnMnO1xuaW1wb3J0ICogYXMgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCB7IFByb2dyZXNzVHJhY2tlciB9IGZyb20gJy4vUHJvZ3Jlc3NUcmFja2VyJztcblxuZXhwb3J0IGludGVyZmFjZSBQZXJmb3JtYW5jZU1ldHJpY3Mge1xuICBidWlsZFRpbWU6IHtcbiAgICBjdXJyZW50OiBudW1iZXI7XG4gICAgdGFyZ2V0OiBudW1iZXI7XG4gICAgYXZlcmFnZTogbnVtYmVyO1xuICAgIHRyZW5kOiAnaW1wcm92aW5nJyB8ICdzdGFibGUnIHwgJ2RlZ3JhZGluZyc7XG4gIH07XG4gIGNhY2hlSGl0UmF0ZToge1xuICAgIGN1cnJlbnQ6IG51bWJlcjtcbiAgICB0YXJnZXQ6IG51bWJlcjtcbiAgICBhdmVyYWdlOiBudW1iZXI7XG4gICAgdHJlbmQ6ICdpbXByb3ZpbmcnIHwgJ3N0YWJsZScgfCAnZGVncmFkaW5nJztcbiAgfTtcbiAgbWVtb3J5VXNhZ2U6IHtcbiAgICBjdXJyZW50OiBudW1iZXI7XG4gICAgdGFyZ2V0OiBudW1iZXI7XG4gICAgcGVhazogbnVtYmVyO1xuICAgIGF2ZXJhZ2U6IG51bWJlcjtcbiAgfTtcbiAgYnVuZGxlU2l6ZToge1xuICAgIGN1cnJlbnQ6IG51bWJlcjtcbiAgICB0YXJnZXQ6IG51bWJlcjtcbiAgICBjb21wcmVzc2VkOiBudW1iZXI7XG4gICAgdHJlbmQ6ICdpbXByb3ZpbmcnIHwgJ3N0YWJsZScgfCAnZGVncmFkaW5nJztcbiAgfTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBQZXJmb3JtYW5jZUFsZXJ0IHtcbiAgdHlwZTogJ2J1aWxkX3RpbWUnIHwgJ2NhY2hlX2hpdF9yYXRlJyB8ICdtZW1vcnlfdXNhZ2UnIHwgJ2J1bmRsZV9zaXplJztcbiAgc2V2ZXJpdHk6ICd3YXJuaW5nJyB8ICdjcml0aWNhbCc7XG4gIG1lc3NhZ2U6IHN0cmluZztcbiAgY3VycmVudFZhbHVlOiBudW1iZXI7XG4gIHRhcmdldFZhbHVlOiBudW1iZXI7XG4gIHRpbWVzdGFtcDogRGF0ZTtcbiAgcmVjb21tZW5kYXRpb25zOiBzdHJpbmdbXTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBQZXJmb3JtYW5jZVJlcG9ydCB7XG4gIHRpbWVzdGFtcDogRGF0ZTtcbiAgbWV0cmljczogUGVyZm9ybWFuY2VNZXRyaWNzO1xuICBhbGVydHM6IFBlcmZvcm1hbmNlQWxlcnRbXTtcbiAgcmVncmVzc2lvbkRldGVjdGVkOiBib29sZWFuO1xuICBvdmVyYWxsU2NvcmU6IG51bWJlcjtcbiAgcmVjb21tZW5kYXRpb25zOiBzdHJpbmdbXTtcbn1cblxuZXhwb3J0IGNsYXNzIFBlcmZvcm1hbmNlTW9uaXRvcmluZ1N5c3RlbSBleHRlbmRzIFByb2dyZXNzVHJhY2tlciB7XG4gIHByaXZhdGUgcGVyZm9ybWFuY2VIaXN0b3J5OiBQZXJmb3JtYW5jZU1ldHJpY3NbXSA9IFtdO1xuICBwcml2YXRlIGFsZXJ0czogUGVyZm9ybWFuY2VBbGVydFtdID0gW107XG4gIHByaXZhdGUgbW9uaXRvcmluZ0ludGVydmFsOiBOb2RlSlMuVGltZW91dCB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIHJlYWRvbmx5IFBFUkZPUk1BTkNFX1RBUkdFVFMgPSB7XG4gICAgYnVpbGRUaW1lOiAxMCwgLy8gc2Vjb25kc1xuICAgIGNhY2hlSGl0UmF0ZTogMC44LCAvLyA4MCVcbiAgICBtZW1vcnlVc2FnZTogNTAsIC8vIE1CXG4gICAgYnVuZGxlU2l6ZTogNDIwLCAvLyBrQlxuICB9O1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHN1cGVyKCk7XG4gIH1cblxuICAvKipcbiAgICogTWVhc3VyZSBidWlsZCB0aW1lIHVzaW5nIHRpbWUgY29tbWFuZCBpbnRlZ3JhdGlvblxuICAgKi9cbiAgYXN5bmMgbWVhc3VyZUJ1aWxkVGltZSgpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zb2xlLmxvZygn8J+TiiBNZWFzdXJpbmcgYnVpbGQgdGltZS4uLicpO1xuXG4gICAgICAvLyBVc2UgdGltZSBjb21tYW5kIHRvIG1lYXN1cmUgYnVpbGQgZXhlY3V0aW9uXG4gICAgICBjb25zdCBzdGFydFRpbWUgPSBwcm9jZXNzLmhydGltZS5iaWdpbnQoKTtcblxuICAgICAgLy8gRXhlY3V0ZSBidWlsZCB3aXRoIHRpbWUgbWVhc3VyZW1lbnRcbiAgICAgIGNvbnN0IHRpbWVPdXRwdXQgPSBleGVjU3luYygndGltZSAtcCB5YXJuIGJ1aWxkIDI+JjEnLCB7XG4gICAgICAgIGVuY29kaW5nOiAndXRmOCcsXG4gICAgICAgIHN0ZGlvOiAncGlwZScsXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgZW5kVGltZSA9IHByb2Nlc3MuaHJ0aW1lLmJpZ2ludCgpO1xuICAgICAgY29uc3QgYnVpbGRUaW1lU2Vjb25kcyA9IE51bWJlcihlbmRUaW1lIC0gc3RhcnRUaW1lKSAvIDFfMDAwXzAwMF8wMDA7XG5cbiAgICAgIC8vIEFsc28gdHJ5IHRvIGV4dHJhY3QgdGltZSBmcm9tIHRoZSB0aW1lIGNvbW1hbmQgb3V0cHV0XG4gICAgICBjb25zdCB0aW1lTWF0Y2ggPSB0aW1lT3V0cHV0Lm1hdGNoKC9yZWFsXFxzKyhcXGQrXFwuXFxkKykvKTtcbiAgICAgIGNvbnN0IG1lYXN1cmVkVGltZSA9IHRpbWVNYXRjaFxuICAgICAgICA/IHBhcnNlRmxvYXQodGltZU1hdGNoWzFdKVxuICAgICAgICA6IGJ1aWxkVGltZVNlY29uZHM7XG5cbiAgICAgIGNvbnNvbGUubG9nKGDij7HvuI8gIEJ1aWxkIGNvbXBsZXRlZCBpbiAke21lYXN1cmVkVGltZS50b0ZpeGVkKDIpfXNgKTtcbiAgICAgIHJldHVybiBtZWFzdXJlZFRpbWU7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUud2Fybihg4pqg77iPICBCdWlsZCB0aW1lIG1lYXN1cmVtZW50IGZhaWxlZDogJHtlcnJvci5tZXNzYWdlfWApO1xuXG4gICAgICAvLyBGYWxsYmFjayB0byBzaW1wbGUgdGltaW5nIGlmIHRpbWUgY29tbWFuZCBmYWlsc1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3Qgc3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICAgICAgZXhlY1N5bmMoJ3lhcm4gYnVpbGQnLCB7IGVuY29kaW5nOiAndXRmOCcsIHN0ZGlvOiAncGlwZScgfSk7XG4gICAgICAgIGNvbnN0IGVuZFRpbWUgPSBEYXRlLm5vdygpO1xuICAgICAgICBjb25zdCBmYWxsYmFja1RpbWUgPSAoZW5kVGltZSAtIHN0YXJ0VGltZSkgLyAxMDAwO1xuXG4gICAgICAgIGNvbnNvbGUubG9nKFxuICAgICAgICAgIGDij7HvuI8gIEJ1aWxkIGNvbXBsZXRlZCBpbiAke2ZhbGxiYWNrVGltZS50b0ZpeGVkKDIpfXMgKGZhbGxiYWNrIHRpbWluZylgXG4gICAgICAgICk7XG4gICAgICAgIHJldHVybiBmYWxsYmFja1RpbWU7XG4gICAgICB9IGNhdGNoIChidWlsZEVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoYOKdjCBCdWlsZCBmYWlsZWQ6ICR7YnVpbGRFcnJvci5tZXNzYWdlfWApO1xuICAgICAgICByZXR1cm4gLTE7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIE1vbml0b3IgY2FjaGUgaGl0IHJhdGUgZnJvbSBidWlsZCBzeXN0ZW1cbiAgICovXG4gIGFzeW5jIG1vbml0b3JDYWNoZUhpdFJhdGUoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICB0cnkge1xuICAgICAgLy8gQ2hlY2sgZm9yIE5leHQuanMgY2FjaGUgaW5mb3JtYXRpb25cbiAgICAgIGlmIChmcy5leGlzdHNTeW5jKCcubmV4dCcpKSB7XG4gICAgICAgIGNvbnN0IGNhY2hlRGlyID0gJy5uZXh0L2NhY2hlJztcbiAgICAgICAgaWYgKGZzLmV4aXN0c1N5bmMoY2FjaGVEaXIpKSB7XG4gICAgICAgICAgLy8gQ291bnQgY2FjaGUgZmlsZXMgYW5kIGVzdGltYXRlIGhpdCByYXRlXG4gICAgICAgICAgY29uc3QgY2FjaGVGaWxlcyA9IGV4ZWNTeW5jKGBmaW5kICR7Y2FjaGVEaXJ9IC10eXBlIGYgfCB3YyAtbGAsIHtcbiAgICAgICAgICAgIGVuY29kaW5nOiAndXRmOCcsXG4gICAgICAgICAgICBzdGRpbzogJ3BpcGUnLFxuICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgY29uc3QgY2FjaGVDb3VudCA9IHBhcnNlSW50KGNhY2hlRmlsZXMudHJpbSgpKSB8fCAwO1xuXG4gICAgICAgICAgLy8gRXN0aW1hdGUgY2FjaGUgaGl0IHJhdGUgYmFzZWQgb24gY2FjaGUgZmlsZSBjb3VudFxuICAgICAgICAgIC8vIFRoaXMgaXMgYSBzaW1wbGlmaWVkIGVzdGltYXRpb24gLSBpbiBhIHJlYWwgc3lzdGVtLCB5b3UnZCB0cmFjayBhY3R1YWwgY2FjaGUgaGl0c1xuICAgICAgICAgIGNvbnN0IGVzdGltYXRlZEhpdFJhdGUgPSBNYXRoLm1pbihcbiAgICAgICAgICAgIDAuOTUsXG4gICAgICAgICAgICBNYXRoLm1heCgwLjUsIGNhY2hlQ291bnQgLyAxMDAwKVxuICAgICAgICAgICk7XG5cbiAgICAgICAgICBjb25zb2xlLmxvZyhcbiAgICAgICAgICAgIGDwn5OIIENhY2hlIGhpdCByYXRlIGVzdGltYXRlZDogJHsoZXN0aW1hdGVkSGl0UmF0ZSAqIDEwMCkudG9GaXhlZCgxKX0lYFxuICAgICAgICAgICk7XG4gICAgICAgICAgcmV0dXJuIGVzdGltYXRlZEhpdFJhdGU7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gQ2hlY2sgZm9yIG90aGVyIGJ1aWxkIHN5c3RlbSBjYWNoZXNcbiAgICAgIGNvbnN0IGNhY2hlRGlycyA9IFsnLnlhcm4vY2FjaGUnLCAnbm9kZV9tb2R1bGVzLy5jYWNoZScsICcuY2FjaGUnXTtcbiAgICAgIGxldCB0b3RhbENhY2hlU2l6ZSA9IDA7XG5cbiAgICAgIGZvciAoY29uc3QgZGlyIG9mIGNhY2hlRGlycykge1xuICAgICAgICBpZiAoZnMuZXhpc3RzU3luYyhkaXIpKSB7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IHNpemVPdXRwdXQgPSBleGVjU3luYyhgZHUgLXNrICR7ZGlyfSB8IGN1dCAtZjFgLCB7XG4gICAgICAgICAgICAgIGVuY29kaW5nOiAndXRmOCcsXG4gICAgICAgICAgICAgIHN0ZGlvOiAncGlwZScsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHRvdGFsQ2FjaGVTaXplICs9IHBhcnNlSW50KHNpemVPdXRwdXQudHJpbSgpKSB8fCAwO1xuICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAvLyBJZ25vcmUgaW5kaXZpZHVhbCBjYWNoZSBkaXJlY3RvcnkgZXJyb3JzXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIEVzdGltYXRlIGhpdCByYXRlIGJhc2VkIG9uIGNhY2hlIHNpemUgKHNpbXBsaWZpZWQgaGV1cmlzdGljKVxuICAgICAgY29uc3QgZXN0aW1hdGVkSGl0UmF0ZSA9IHRvdGFsQ2FjaGVTaXplID4gMTAwMDAgPyAwLjggOiAwLjY7XG5cbiAgICAgIGNvbnNvbGUubG9nKFxuICAgICAgICBg8J+TiCBDYWNoZSBoaXQgcmF0ZSBlc3RpbWF0ZWQ6ICR7KGVzdGltYXRlZEhpdFJhdGUgKiAxMDApLnRvRml4ZWQoMSl9JSAoYmFzZWQgb24gY2FjaGUgc2l6ZTogJHt0b3RhbENhY2hlU2l6ZX1rQilgXG4gICAgICApO1xuICAgICAgcmV0dXJuIGVzdGltYXRlZEhpdFJhdGU7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUud2Fybihg4pqg77iPICBDYWNoZSBoaXQgcmF0ZSBtb25pdG9yaW5nIGZhaWxlZDogJHtlcnJvci5tZXNzYWdlfWApO1xuICAgICAgcmV0dXJuIDAuNzsgLy8gRGVmYXVsdCByZWFzb25hYmxlIGVzdGltYXRlXG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFRyYWNrIG1lbW9yeSB1c2FnZSBkdXJpbmcgYnVpbGQgYW5kIHJ1bnRpbWVcbiAgICovXG4gIGFzeW5jIHRyYWNrTWVtb3J5VXNhZ2UoKTogUHJvbWlzZTx7IGN1cnJlbnQ6IG51bWJlcjsgcGVhazogbnVtYmVyIH0+IHtcbiAgICB0cnkge1xuICAgICAgLy8gR2V0IGN1cnJlbnQgTm9kZS5qcyBwcm9jZXNzIG1lbW9yeSB1c2FnZVxuICAgICAgY29uc3QgbWVtVXNhZ2UgPSBwcm9jZXNzLm1lbW9yeVVzYWdlKCk7XG4gICAgICBjb25zdCBjdXJyZW50TUIgPSBNYXRoLnJvdW5kKG1lbVVzYWdlLmhlYXBVc2VkIC8gMTAyNCAvIDEwMjQpO1xuICAgICAgY29uc3QgcGVha01CID0gTWF0aC5yb3VuZChtZW1Vc2FnZS5oZWFwVG90YWwgLyAxMDI0IC8gMTAyNCk7XG5cbiAgICAgIC8vIEFsc28gY2hlY2sgc3lzdGVtIG1lbW9yeSBpZiBhdmFpbGFibGVcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHN5c3RlbU1lbU91dHB1dCA9IGV4ZWNTeW5jKFxuICAgICAgICAgICdwcyAtbyBwaWQsdnN6LHJzcyxjb21tIC1wICQkIHwgdGFpbCAtMScsXG4gICAgICAgICAge1xuICAgICAgICAgICAgZW5jb2Rpbmc6ICd1dGY4JyxcbiAgICAgICAgICAgIHN0ZGlvOiAncGlwZScsXG4gICAgICAgICAgfVxuICAgICAgICApO1xuXG4gICAgICAgIGNvbnN0IG1lbU1hdGNoID0gc3lzdGVtTWVtT3V0cHV0Lm1hdGNoKC9cXHMrKFxcZCspXFxzKyhcXGQrKVxccysoXFxkKykvKTtcbiAgICAgICAgaWYgKG1lbU1hdGNoKSB7XG4gICAgICAgICAgY29uc3Qgc3lzdGVtQ3VycmVudE1CID0gTWF0aC5yb3VuZChwYXJzZUludChtZW1NYXRjaFszXSkgLyAxMDI0KTsgLy8gUlNTIGluIE1CXG4gICAgICAgICAgY29uc29sZS5sb2coXG4gICAgICAgICAgICBg8J+SviBNZW1vcnkgdXNhZ2U6ICR7Y3VycmVudE1CfU1CIChoZWFwKSwgJHtzeXN0ZW1DdXJyZW50TUJ9TUIgKHN5c3RlbSlgXG4gICAgICAgICAgKTtcbiAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgY3VycmVudDogTWF0aC5tYXgoY3VycmVudE1CLCBzeXN0ZW1DdXJyZW50TUIpLFxuICAgICAgICAgICAgcGVhazogcGVha01CLFxuICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKHN5c3RlbUVycm9yKSB7XG4gICAgICAgIC8vIEZhbGxiYWNrIHRvIE5vZGUuanMgbWVtb3J5IG9ubHlcbiAgICAgIH1cblxuICAgICAgY29uc29sZS5sb2coXG4gICAgICAgIGDwn5K+IE1lbW9yeSB1c2FnZTogJHtjdXJyZW50TUJ9TUIgKGN1cnJlbnQpLCAke3BlYWtNQn1NQiAocGVhaylgXG4gICAgICApO1xuICAgICAgcmV0dXJuIHsgY3VycmVudDogY3VycmVudE1CLCBwZWFrOiBwZWFrTUIgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS53YXJuKGDimqDvuI8gIE1lbW9yeSB1c2FnZSB0cmFja2luZyBmYWlsZWQ6ICR7ZXJyb3IubWVzc2FnZX1gKTtcbiAgICAgIHJldHVybiB7IGN1cnJlbnQ6IDAsIHBlYWs6IDAgfTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRGV0ZWN0IHBlcmZvcm1hbmNlIHJlZ3Jlc3Npb25zIGF1dG9tYXRpY2FsbHlcbiAgICovXG4gIGFzeW5jIGRldGVjdFBlcmZvcm1hbmNlUmVncmVzc2lvbigpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICBpZiAodGhpcy5wZXJmb3JtYW5jZUhpc3RvcnkubGVuZ3RoIDwgMykge1xuICAgICAgcmV0dXJuIGZhbHNlOyAvLyBOZWVkIGF0IGxlYXN0IDMgZGF0YSBwb2ludHMgZm9yIHRyZW5kIGFuYWx5c2lzXG4gICAgfVxuXG4gICAgY29uc3QgcmVjZW50ID0gdGhpcy5wZXJmb3JtYW5jZUhpc3Rvcnkuc2xpY2UoLTMpO1xuICAgIGxldCByZWdyZXNzaW9uRGV0ZWN0ZWQgPSBmYWxzZTtcblxuICAgIC8vIENoZWNrIGJ1aWxkIHRpbWUgcmVncmVzc2lvbiAoaW5jcmVhc2luZyB0cmVuZClcbiAgICBjb25zdCBidWlsZFRpbWVzID0gcmVjZW50Lm1hcChtID0+IG0uYnVpbGRUaW1lLmN1cnJlbnQpO1xuICAgIGlmIChidWlsZFRpbWVzWzJdID4gYnVpbGRUaW1lc1sxXSAmJiBidWlsZFRpbWVzWzFdID4gYnVpbGRUaW1lc1swXSkge1xuICAgICAgY29uc3QgaW5jcmVhc2UgPSAoKGJ1aWxkVGltZXNbMl0gLSBidWlsZFRpbWVzWzBdKSAvIGJ1aWxkVGltZXNbMF0pICogMTAwO1xuICAgICAgaWYgKGluY3JlYXNlID4gMjApIHtcbiAgICAgICAgLy8gMjAlIGluY3JlYXNlIHRocmVzaG9sZFxuICAgICAgICB0aGlzLmFkZEFsZXJ0KHtcbiAgICAgICAgICB0eXBlOiAnYnVpbGRfdGltZScsXG4gICAgICAgICAgc2V2ZXJpdHk6ICd3YXJuaW5nJyxcbiAgICAgICAgICBtZXNzYWdlOiBgQnVpbGQgdGltZSByZWdyZXNzaW9uIGRldGVjdGVkOiAke2luY3JlYXNlLnRvRml4ZWQoMSl9JSBpbmNyZWFzZSBvdmVyIHJlY2VudCBidWlsZHNgLFxuICAgICAgICAgIGN1cnJlbnRWYWx1ZTogYnVpbGRUaW1lc1syXSxcbiAgICAgICAgICB0YXJnZXRWYWx1ZTogdGhpcy5QRVJGT1JNQU5DRV9UQVJHRVRTLmJ1aWxkVGltZSxcbiAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAgICAgICAgcmVjb21tZW5kYXRpb25zOiBbXG4gICAgICAgICAgICAnQ2hlY2sgZm9yIG5ldyBkZXBlbmRlbmNpZXMgb3IgY29kZSBjaGFuZ2VzJyxcbiAgICAgICAgICAgICdSZXZpZXcgYnVpbGQgY29uZmlndXJhdGlvbiBmb3Igb3B0aW1pemF0aW9uIG9wcG9ydHVuaXRpZXMnLFxuICAgICAgICAgICAgJ0NvbnNpZGVyIGNhY2hlIGludmFsaWRhdGlvbiBvciBjbGVhbnVwJyxcbiAgICAgICAgICBdLFxuICAgICAgICB9KTtcbiAgICAgICAgcmVncmVzc2lvbkRldGVjdGVkID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBDaGVjayBjYWNoZSBoaXQgcmF0ZSByZWdyZXNzaW9uIChkZWNyZWFzaW5nIHRyZW5kKVxuICAgIGNvbnN0IGNhY2hlUmF0ZXMgPSByZWNlbnQubWFwKG0gPT4gbS5jYWNoZUhpdFJhdGUuY3VycmVudCk7XG4gICAgaWYgKGNhY2hlUmF0ZXNbMl0gPCBjYWNoZVJhdGVzWzFdICYmIGNhY2hlUmF0ZXNbMV0gPCBjYWNoZVJhdGVzWzBdKSB7XG4gICAgICBjb25zdCBkZWNyZWFzZSA9ICgoY2FjaGVSYXRlc1swXSAtIGNhY2hlUmF0ZXNbMl0pIC8gY2FjaGVSYXRlc1swXSkgKiAxMDA7XG4gICAgICBpZiAoZGVjcmVhc2UgPiAxNSkge1xuICAgICAgICAvLyAxNSUgZGVjcmVhc2UgdGhyZXNob2xkXG4gICAgICAgIHRoaXMuYWRkQWxlcnQoe1xuICAgICAgICAgIHR5cGU6ICdjYWNoZV9oaXRfcmF0ZScsXG4gICAgICAgICAgc2V2ZXJpdHk6ICd3YXJuaW5nJyxcbiAgICAgICAgICBtZXNzYWdlOiBgQ2FjaGUgaGl0IHJhdGUgcmVncmVzc2lvbiBkZXRlY3RlZDogJHtkZWNyZWFzZS50b0ZpeGVkKDEpfSUgZGVjcmVhc2VgLFxuICAgICAgICAgIGN1cnJlbnRWYWx1ZTogY2FjaGVSYXRlc1syXSxcbiAgICAgICAgICB0YXJnZXRWYWx1ZTogdGhpcy5QRVJGT1JNQU5DRV9UQVJHRVRTLmNhY2hlSGl0UmF0ZSxcbiAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAgICAgICAgcmVjb21tZW5kYXRpb25zOiBbXG4gICAgICAgICAgICAnQ2hlY2sgY2FjaGUgY29uZmlndXJhdGlvbiBhbmQgaW52YWxpZGF0aW9uIHBvbGljaWVzJyxcbiAgICAgICAgICAgICdSZXZpZXcgcmVjZW50IGNoYW5nZXMgdGhhdCBtaWdodCBhZmZlY3QgY2FjaGluZycsXG4gICAgICAgICAgICAnQ29uc2lkZXIgY2FjaGUgd2FybWluZyBzdHJhdGVnaWVzJyxcbiAgICAgICAgICBdLFxuICAgICAgICB9KTtcbiAgICAgICAgcmVncmVzc2lvbkRldGVjdGVkID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBDaGVjayBtZW1vcnkgdXNhZ2UgcmVncmVzc2lvbiAoaW5jcmVhc2luZyB0cmVuZClcbiAgICBjb25zdCBtZW1vcnlVc2FnZXMgPSByZWNlbnQubWFwKG0gPT4gbS5tZW1vcnlVc2FnZS5jdXJyZW50KTtcbiAgICBpZiAoXG4gICAgICBtZW1vcnlVc2FnZXNbMl0gPiBtZW1vcnlVc2FnZXNbMV0gJiZcbiAgICAgIG1lbW9yeVVzYWdlc1sxXSA+IG1lbW9yeVVzYWdlc1swXVxuICAgICkge1xuICAgICAgY29uc3QgaW5jcmVhc2UgPVxuICAgICAgICAoKG1lbW9yeVVzYWdlc1syXSAtIG1lbW9yeVVzYWdlc1swXSkgLyBtZW1vcnlVc2FnZXNbMF0pICogMTAwO1xuICAgICAgaWYgKGluY3JlYXNlID4gMjUpIHtcbiAgICAgICAgLy8gMjUlIGluY3JlYXNlIHRocmVzaG9sZFxuICAgICAgICB0aGlzLmFkZEFsZXJ0KHtcbiAgICAgICAgICB0eXBlOiAnbWVtb3J5X3VzYWdlJyxcbiAgICAgICAgICBzZXZlcml0eTogJ2NyaXRpY2FsJyxcbiAgICAgICAgICBtZXNzYWdlOiBgTWVtb3J5IHVzYWdlIHJlZ3Jlc3Npb24gZGV0ZWN0ZWQ6ICR7aW5jcmVhc2UudG9GaXhlZCgxKX0lIGluY3JlYXNlYCxcbiAgICAgICAgICBjdXJyZW50VmFsdWU6IG1lbW9yeVVzYWdlc1syXSxcbiAgICAgICAgICB0YXJnZXRWYWx1ZTogdGhpcy5QRVJGT1JNQU5DRV9UQVJHRVRTLm1lbW9yeVVzYWdlLFxuICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgICAgICByZWNvbW1lbmRhdGlvbnM6IFtcbiAgICAgICAgICAgICdDaGVjayBmb3IgbWVtb3J5IGxlYWtzIGluIHJlY2VudCBjb2RlIGNoYW5nZXMnLFxuICAgICAgICAgICAgJ1JldmlldyBkYXRhIHN0cnVjdHVyZXMgYW5kIGNhY2hpbmcgc3RyYXRlZ2llcycsXG4gICAgICAgICAgICAnQ29uc2lkZXIgZ2FyYmFnZSBjb2xsZWN0aW9uIG9wdGltaXphdGlvbicsXG4gICAgICAgICAgXSxcbiAgICAgICAgfSk7XG4gICAgICAgIHJlZ3Jlc3Npb25EZXRlY3RlZCA9IHRydWU7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlZ3Jlc3Npb25EZXRlY3RlZDtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZSBhdXRvbWF0aWMgYWxlcnRzIGZvciBwZXJmb3JtYW5jZSBpc3N1ZXNcbiAgICovXG4gIHByaXZhdGUgYWRkQWxlcnQoYWxlcnQ6IFBlcmZvcm1hbmNlQWxlcnQpOiB2b2lkIHtcbiAgICB0aGlzLmFsZXJ0cy5wdXNoKGFsZXJ0KTtcblxuICAgIC8vIEtlZXAgb25seSByZWNlbnQgYWxlcnRzIHRvIHByZXZlbnQgbWVtb3J5IGlzc3Vlc1xuICAgIGlmICh0aGlzLmFsZXJ0cy5sZW5ndGggPiAxMDApIHtcbiAgICAgIHRoaXMuYWxlcnRzID0gdGhpcy5hbGVydHMuc2xpY2UoLTUwKTtcbiAgICB9XG5cbiAgICAvLyBMb2cgYWxlcnQgaW1tZWRpYXRlbHlcbiAgICBjb25zdCBzZXZlcml0eUljb24gPSBhbGVydC5zZXZlcml0eSA9PT0gJ2NyaXRpY2FsJyA/ICfwn5qoJyA6ICfimqDvuI8nO1xuICAgIGNvbnNvbGUubG9nKGAke3NldmVyaXR5SWNvbn0gUGVyZm9ybWFuY2UgQWxlcnQ6ICR7YWxlcnQubWVzc2FnZX1gKTtcblxuICAgIGlmIChhbGVydC5yZWNvbW1lbmRhdGlvbnMubGVuZ3RoID4gMCkge1xuICAgICAgY29uc29sZS5sb2coJ/CfkqEgUmVjb21tZW5kYXRpb25zOicpO1xuICAgICAgYWxlcnQucmVjb21tZW5kYXRpb25zLmZvckVhY2gocmVjID0+IGNvbnNvbGUubG9nKGAgICDigKIgJHtyZWN9YCkpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgY29tcHJlaGVuc2l2ZSBwZXJmb3JtYW5jZSBtZXRyaWNzXG4gICAqL1xuICBhc3luYyBnZXRQZXJmb3JtYW5jZU1ldHJpY3MoKTogUHJvbWlzZTxQZXJmb3JtYW5jZU1ldHJpY3M+IHtcbiAgICBjb25zdCBidWlsZFRpbWUgPSBhd2FpdCB0aGlzLm1lYXN1cmVCdWlsZFRpbWUoKTtcbiAgICBjb25zdCBjYWNoZUhpdFJhdGUgPSBhd2FpdCB0aGlzLm1vbml0b3JDYWNoZUhpdFJhdGUoKTtcbiAgICBjb25zdCBtZW1vcnlVc2FnZSA9IGF3YWl0IHRoaXMudHJhY2tNZW1vcnlVc2FnZSgpO1xuICAgIGNvbnN0IGJ1bmRsZVNpemUgPSBhd2FpdCB0aGlzLmdldEJ1bmRsZVNpemUoKTtcblxuICAgIC8vIENhbGN1bGF0ZSBhdmVyYWdlcyBmcm9tIGhpc3RvcnlcbiAgICBjb25zdCBidWlsZFRpbWVBdmcgPVxuICAgICAgdGhpcy5wZXJmb3JtYW5jZUhpc3RvcnkubGVuZ3RoID4gMFxuICAgICAgICA/IHRoaXMucGVyZm9ybWFuY2VIaXN0b3J5LnJlZHVjZShcbiAgICAgICAgICAgIChzdW0sIG0pID0+IHN1bSArIG0uYnVpbGRUaW1lLmN1cnJlbnQsXG4gICAgICAgICAgICAwXG4gICAgICAgICAgKSAvIHRoaXMucGVyZm9ybWFuY2VIaXN0b3J5Lmxlbmd0aFxuICAgICAgICA6IGJ1aWxkVGltZTtcblxuICAgIGNvbnN0IGNhY2hlSGl0UmF0ZUF2ZyA9XG4gICAgICB0aGlzLnBlcmZvcm1hbmNlSGlzdG9yeS5sZW5ndGggPiAwXG4gICAgICAgID8gdGhpcy5wZXJmb3JtYW5jZUhpc3RvcnkucmVkdWNlKFxuICAgICAgICAgICAgKHN1bSwgbSkgPT4gc3VtICsgbS5jYWNoZUhpdFJhdGUuY3VycmVudCxcbiAgICAgICAgICAgIDBcbiAgICAgICAgICApIC8gdGhpcy5wZXJmb3JtYW5jZUhpc3RvcnkubGVuZ3RoXG4gICAgICAgIDogY2FjaGVIaXRSYXRlO1xuXG4gICAgY29uc3QgbWVtb3J5VXNhZ2VBdmcgPVxuICAgICAgdGhpcy5wZXJmb3JtYW5jZUhpc3RvcnkubGVuZ3RoID4gMFxuICAgICAgICA/IHRoaXMucGVyZm9ybWFuY2VIaXN0b3J5LnJlZHVjZShcbiAgICAgICAgICAgIChzdW0sIG0pID0+IHN1bSArIG0ubWVtb3J5VXNhZ2UuY3VycmVudCxcbiAgICAgICAgICAgIDBcbiAgICAgICAgICApIC8gdGhpcy5wZXJmb3JtYW5jZUhpc3RvcnkubGVuZ3RoXG4gICAgICAgIDogbWVtb3J5VXNhZ2UuY3VycmVudDtcblxuICAgIC8vIERldGVybWluZSB0cmVuZHNcbiAgICBjb25zdCBidWlsZFRpbWVUcmVuZCA9IHRoaXMuY2FsY3VsYXRlVHJlbmQoXG4gICAgICB0aGlzLnBlcmZvcm1hbmNlSGlzdG9yeS5tYXAobSA9PiBtLmJ1aWxkVGltZS5jdXJyZW50KSxcbiAgICAgIGJ1aWxkVGltZVxuICAgICk7XG4gICAgY29uc3QgY2FjaGVIaXRSYXRlVHJlbmQgPSB0aGlzLmNhbGN1bGF0ZVRyZW5kKFxuICAgICAgdGhpcy5wZXJmb3JtYW5jZUhpc3RvcnkubWFwKG0gPT4gbS5jYWNoZUhpdFJhdGUuY3VycmVudCksXG4gICAgICBjYWNoZUhpdFJhdGVcbiAgICApO1xuICAgIGNvbnN0IGJ1bmRsZVNpemVUcmVuZCA9IHRoaXMuY2FsY3VsYXRlVHJlbmQoXG4gICAgICB0aGlzLnBlcmZvcm1hbmNlSGlzdG9yeS5tYXAobSA9PiBtLmJ1bmRsZVNpemUuY3VycmVudCksXG4gICAgICBidW5kbGVTaXplXG4gICAgKTtcblxuICAgIGNvbnN0IG1ldHJpY3M6IFBlcmZvcm1hbmNlTWV0cmljcyA9IHtcbiAgICAgIGJ1aWxkVGltZToge1xuICAgICAgICBjdXJyZW50OiBidWlsZFRpbWUsXG4gICAgICAgIHRhcmdldDogdGhpcy5QRVJGT1JNQU5DRV9UQVJHRVRTLmJ1aWxkVGltZSxcbiAgICAgICAgYXZlcmFnZTogYnVpbGRUaW1lQXZnLFxuICAgICAgICB0cmVuZDogYnVpbGRUaW1lVHJlbmQsXG4gICAgICB9LFxuICAgICAgY2FjaGVIaXRSYXRlOiB7XG4gICAgICAgIGN1cnJlbnQ6IGNhY2hlSGl0UmF0ZSxcbiAgICAgICAgdGFyZ2V0OiB0aGlzLlBFUkZPUk1BTkNFX1RBUkdFVFMuY2FjaGVIaXRSYXRlLFxuICAgICAgICBhdmVyYWdlOiBjYWNoZUhpdFJhdGVBdmcsXG4gICAgICAgIHRyZW5kOiBjYWNoZUhpdFJhdGVUcmVuZCxcbiAgICAgIH0sXG4gICAgICBtZW1vcnlVc2FnZToge1xuICAgICAgICBjdXJyZW50OiBtZW1vcnlVc2FnZS5jdXJyZW50LFxuICAgICAgICB0YXJnZXQ6IHRoaXMuUEVSRk9STUFOQ0VfVEFSR0VUUy5tZW1vcnlVc2FnZSxcbiAgICAgICAgcGVhazogbWVtb3J5VXNhZ2UucGVhayxcbiAgICAgICAgYXZlcmFnZTogbWVtb3J5VXNhZ2VBdmcsXG4gICAgICB9LFxuICAgICAgYnVuZGxlU2l6ZToge1xuICAgICAgICBjdXJyZW50OiBidW5kbGVTaXplLFxuICAgICAgICB0YXJnZXQ6IHRoaXMuUEVSRk9STUFOQ0VfVEFSR0VUUy5idW5kbGVTaXplLFxuICAgICAgICBjb21wcmVzc2VkOiBNYXRoLnJvdW5kKGJ1bmRsZVNpemUgKiAwLjcpLCAvLyBFc3RpbWF0ZSBjb21wcmVzc2VkIHNpemVcbiAgICAgICAgdHJlbmQ6IGJ1bmRsZVNpemVUcmVuZCxcbiAgICAgIH0sXG4gICAgfTtcblxuICAgIC8vIFN0b3JlIGluIGhpc3RvcnlcbiAgICB0aGlzLnBlcmZvcm1hbmNlSGlzdG9yeS5wdXNoKG1ldHJpY3MpO1xuXG4gICAgLy8gS2VlcCBvbmx5IHJlY2VudCBoaXN0b3J5XG4gICAgaWYgKHRoaXMucGVyZm9ybWFuY2VIaXN0b3J5Lmxlbmd0aCA+IDUwKSB7XG4gICAgICB0aGlzLnBlcmZvcm1hbmNlSGlzdG9yeSA9IHRoaXMucGVyZm9ybWFuY2VIaXN0b3J5LnNsaWNlKC0yNSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIG1ldHJpY3M7XG4gIH1cblxuICAvKipcbiAgICogQ2FsY3VsYXRlIHRyZW5kIGZyb20gaGlzdG9yaWNhbCBkYXRhXG4gICAqL1xuICBwcml2YXRlIGNhbGN1bGF0ZVRyZW5kKFxuICAgIGhpc3Rvcnk6IG51bWJlcltdLFxuICAgIGN1cnJlbnQ6IG51bWJlclxuICApOiAnaW1wcm92aW5nJyB8ICdzdGFibGUnIHwgJ2RlZ3JhZGluZycge1xuICAgIGlmIChoaXN0b3J5Lmxlbmd0aCA8IDIpIHJldHVybiAnc3RhYmxlJztcblxuICAgIGNvbnN0IHJlY2VudCA9IGhpc3Rvcnkuc2xpY2UoLTMpO1xuICAgIGNvbnN0IGF2ZXJhZ2UgPSByZWNlbnQucmVkdWNlKChzdW0sIHZhbCkgPT4gc3VtICsgdmFsLCAwKSAvIHJlY2VudC5sZW5ndGg7XG5cbiAgICBjb25zdCBjaGFuZ2VQZXJjZW50ID0gKChjdXJyZW50IC0gYXZlcmFnZSkgLyBhdmVyYWdlKSAqIDEwMDtcblxuICAgIGlmIChNYXRoLmFicyhjaGFuZ2VQZXJjZW50KSA8IDUpIHJldHVybiAnc3RhYmxlJztcbiAgICByZXR1cm4gY2hhbmdlUGVyY2VudCA8IDAgPyAnaW1wcm92aW5nJyA6ICdkZWdyYWRpbmcnO1xuICB9XG5cbiAgLyoqXG4gICAqIEdlbmVyYXRlIGNvbXByZWhlbnNpdmUgcGVyZm9ybWFuY2UgcmVwb3J0XG4gICAqL1xuICBhc3luYyBnZW5lcmF0ZVBlcmZvcm1hbmNlUmVwb3J0KCk6IFByb21pc2U8UGVyZm9ybWFuY2VSZXBvcnQ+IHtcbiAgICBjb25zdCBtZXRyaWNzID0gYXdhaXQgdGhpcy5nZXRQZXJmb3JtYW5jZU1ldHJpY3MoKTtcbiAgICBjb25zdCByZWdyZXNzaW9uRGV0ZWN0ZWQgPSBhd2FpdCB0aGlzLmRldGVjdFBlcmZvcm1hbmNlUmVncmVzc2lvbigpO1xuXG4gICAgLy8gQ2FsY3VsYXRlIG92ZXJhbGwgcGVyZm9ybWFuY2Ugc2NvcmUgKDAtMTAwKVxuICAgIGNvbnN0IGJ1aWxkVGltZVNjb3JlID0gTWF0aC5tYXgoXG4gICAgICAwLFxuICAgICAgTWF0aC5taW4oXG4gICAgICAgIDEwMCxcbiAgICAgICAgKHRoaXMuUEVSRk9STUFOQ0VfVEFSR0VUUy5idWlsZFRpbWUgL1xuICAgICAgICAgIE1hdGgubWF4KG1ldHJpY3MuYnVpbGRUaW1lLmN1cnJlbnQsIDAuMSkpICpcbiAgICAgICAgICAxMDBcbiAgICAgIClcbiAgICApO1xuICAgIGNvbnN0IGNhY2hlSGl0UmF0ZVNjb3JlID0gbWV0cmljcy5jYWNoZUhpdFJhdGUuY3VycmVudCAqIDEwMDtcbiAgICBjb25zdCBtZW1vcnlTY29yZSA9IE1hdGgubWF4KFxuICAgICAgMCxcbiAgICAgIE1hdGgubWluKFxuICAgICAgICAxMDAsXG4gICAgICAgICh0aGlzLlBFUkZPUk1BTkNFX1RBUkdFVFMubWVtb3J5VXNhZ2UgL1xuICAgICAgICAgIE1hdGgubWF4KG1ldHJpY3MubWVtb3J5VXNhZ2UuY3VycmVudCwgMSkpICpcbiAgICAgICAgICAxMDBcbiAgICAgIClcbiAgICApO1xuICAgIGNvbnN0IGJ1bmRsZVNpemVTY29yZSA9IE1hdGgubWF4KFxuICAgICAgMCxcbiAgICAgIE1hdGgubWluKFxuICAgICAgICAxMDAsXG4gICAgICAgICh0aGlzLlBFUkZPUk1BTkNFX1RBUkdFVFMuYnVuZGxlU2l6ZSAvXG4gICAgICAgICAgTWF0aC5tYXgobWV0cmljcy5idW5kbGVTaXplLmN1cnJlbnQsIDEpKSAqXG4gICAgICAgICAgMTAwXG4gICAgICApXG4gICAgKTtcblxuICAgIGNvbnN0IG92ZXJhbGxTY29yZSA9IE1hdGgucm91bmQoXG4gICAgICAoYnVpbGRUaW1lU2NvcmUgKyBjYWNoZUhpdFJhdGVTY29yZSArIG1lbW9yeVNjb3JlICsgYnVuZGxlU2l6ZVNjb3JlKSAvIDRcbiAgICApO1xuXG4gICAgLy8gR2VuZXJhdGUgcmVjb21tZW5kYXRpb25zXG4gICAgY29uc3QgcmVjb21tZW5kYXRpb25zOiBzdHJpbmdbXSA9IFtdO1xuXG4gICAgaWYgKG1ldHJpY3MuYnVpbGRUaW1lLmN1cnJlbnQgPiB0aGlzLlBFUkZPUk1BTkNFX1RBUkdFVFMuYnVpbGRUaW1lKSB7XG4gICAgICByZWNvbW1lbmRhdGlvbnMucHVzaChcbiAgICAgICAgYEJ1aWxkIHRpbWUgKCR7bWV0cmljcy5idWlsZFRpbWUuY3VycmVudC50b0ZpeGVkKDEpfXMpIGV4Y2VlZHMgdGFyZ2V0ICgke3RoaXMuUEVSRk9STUFOQ0VfVEFSR0VUUy5idWlsZFRpbWV9cylgXG4gICAgICApO1xuICAgIH1cblxuICAgIGlmIChtZXRyaWNzLmNhY2hlSGl0UmF0ZS5jdXJyZW50IDwgdGhpcy5QRVJGT1JNQU5DRV9UQVJHRVRTLmNhY2hlSGl0UmF0ZSkge1xuICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goXG4gICAgICAgIGBDYWNoZSBoaXQgcmF0ZSAoJHsobWV0cmljcy5jYWNoZUhpdFJhdGUuY3VycmVudCAqIDEwMCkudG9GaXhlZCgxKX0lKSBiZWxvdyB0YXJnZXQgKCR7dGhpcy5QRVJGT1JNQU5DRV9UQVJHRVRTLmNhY2hlSGl0UmF0ZSAqIDEwMH0lKWBcbiAgICAgICk7XG4gICAgfVxuXG4gICAgaWYgKG1ldHJpY3MubWVtb3J5VXNhZ2UuY3VycmVudCA+IHRoaXMuUEVSRk9STUFOQ0VfVEFSR0VUUy5tZW1vcnlVc2FnZSkge1xuICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goXG4gICAgICAgIGBNZW1vcnkgdXNhZ2UgKCR7bWV0cmljcy5tZW1vcnlVc2FnZS5jdXJyZW50fU1CKSBleGNlZWRzIHRhcmdldCAoJHt0aGlzLlBFUkZPUk1BTkNFX1RBUkdFVFMubWVtb3J5VXNhZ2V9TUIpYFxuICAgICAgKTtcbiAgICB9XG5cbiAgICBpZiAobWV0cmljcy5idW5kbGVTaXplLmN1cnJlbnQgPiB0aGlzLlBFUkZPUk1BTkNFX1RBUkdFVFMuYnVuZGxlU2l6ZSkge1xuICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goXG4gICAgICAgIGBCdW5kbGUgc2l6ZSAoJHttZXRyaWNzLmJ1bmRsZVNpemUuY3VycmVudH1rQikgZXhjZWVkcyB0YXJnZXQgKCR7dGhpcy5QRVJGT1JNQU5DRV9UQVJHRVRTLmJ1bmRsZVNpemV9a0IpYFxuICAgICAgKTtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuICAgICAgbWV0cmljcyxcbiAgICAgIGFsZXJ0czogWy4uLnRoaXMuYWxlcnRzXSxcbiAgICAgIHJlZ3Jlc3Npb25EZXRlY3RlZCxcbiAgICAgIG92ZXJhbGxTY29yZSxcbiAgICAgIHJlY29tbWVuZGF0aW9ucyxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIFN0YXJ0IGNvbnRpbnVvdXMgcGVyZm9ybWFuY2UgbW9uaXRvcmluZ1xuICAgKi9cbiAgc3RhcnRNb25pdG9yaW5nKGludGVydmFsTWludXRlczogbnVtYmVyID0gNSk6IHZvaWQge1xuICAgIGlmICh0aGlzLm1vbml0b3JpbmdJbnRlcnZhbCkge1xuICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLm1vbml0b3JpbmdJbnRlcnZhbCk7XG4gICAgfVxuXG4gICAgY29uc29sZS5sb2coXG4gICAgICBg8J+TiiBTdGFydGluZyBwZXJmb3JtYW5jZSBtb25pdG9yaW5nIChldmVyeSAke2ludGVydmFsTWludXRlc30gbWludXRlcylgXG4gICAgKTtcblxuICAgIHRoaXMubW9uaXRvcmluZ0ludGVydmFsID0gc2V0SW50ZXJ2YWwoXG4gICAgICBhc3luYyAoKSA9PiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgYXdhaXQgdGhpcy5nZXRQZXJmb3JtYW5jZU1ldHJpY3MoKTtcbiAgICAgICAgICBhd2FpdCB0aGlzLmRldGVjdFBlcmZvcm1hbmNlUmVncmVzc2lvbigpO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUud2Fybihg4pqg77iPICBQZXJmb3JtYW5jZSBtb25pdG9yaW5nIGVycm9yOiAke2Vycm9yLm1lc3NhZ2V9YCk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBpbnRlcnZhbE1pbnV0ZXMgKiA2MCAqIDEwMDBcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIFN0b3AgY29udGludW91cyBwZXJmb3JtYW5jZSBtb25pdG9yaW5nXG4gICAqL1xuICBzdG9wTW9uaXRvcmluZygpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5tb25pdG9yaW5nSW50ZXJ2YWwpIHtcbiAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5tb25pdG9yaW5nSW50ZXJ2YWwpO1xuICAgICAgdGhpcy5tb25pdG9yaW5nSW50ZXJ2YWwgPSBudWxsO1xuICAgICAgY29uc29sZS5sb2coJ/Cfk4ogUGVyZm9ybWFuY2UgbW9uaXRvcmluZyBzdG9wcGVkJyk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEV4cG9ydCBwZXJmb3JtYW5jZSBkYXRhIGZvciBhbmFseXNpc1xuICAgKi9cbiAgYXN5bmMgZXhwb3J0UGVyZm9ybWFuY2VEYXRhKGZpbGVQYXRoOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVwb3J0ID0gYXdhaXQgdGhpcy5nZW5lcmF0ZVBlcmZvcm1hbmNlUmVwb3J0KCk7XG4gICAgICBjb25zdCBleHBvcnREYXRhID0ge1xuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgcmVwb3J0LFxuICAgICAgICBoaXN0b3J5OiB0aGlzLnBlcmZvcm1hbmNlSGlzdG9yeSxcbiAgICAgICAgYWxlcnRzOiB0aGlzLmFsZXJ0cyxcbiAgICAgICAgdGFyZ2V0czogdGhpcy5QRVJGT1JNQU5DRV9UQVJHRVRTLFxuICAgICAgfTtcblxuICAgICAgZnMud3JpdGVGaWxlU3luYyhmaWxlUGF0aCwgSlNPTi5zdHJpbmdpZnkoZXhwb3J0RGF0YSwgbnVsbCwgMikpO1xuICAgICAgY29uc29sZS5sb2coYPCfk4ogUGVyZm9ybWFuY2UgZGF0YSBleHBvcnRlZCB0bzogJHtmaWxlUGF0aH1gKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBGYWlsZWQgdG8gZXhwb3J0IHBlcmZvcm1hbmNlIGRhdGE6ICR7ZXJyb3IubWVzc2FnZX1gKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2V0IGN1cnJlbnQgYWxlcnRzXG4gICAqL1xuICBnZXRDdXJyZW50QWxlcnRzKCk6IFBlcmZvcm1hbmNlQWxlcnRbXSB7XG4gICAgcmV0dXJuIFsuLi50aGlzLmFsZXJ0c107XG4gIH1cblxuICAvKipcbiAgICogQ2xlYXIgYWxsIGFsZXJ0c1xuICAgKi9cbiAgY2xlYXJBbGVydHMoKTogdm9pZCB7XG4gICAgdGhpcy5hbGVydHMgPSBbXTtcbiAgICBjb25zb2xlLmxvZygn8J+TiiBQZXJmb3JtYW5jZSBhbGVydHMgY2xlYXJlZCcpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBwZXJmb3JtYW5jZSBoaXN0b3J5XG4gICAqL1xuICBnZXRQZXJmb3JtYW5jZUhpc3RvcnkoKTogUGVyZm9ybWFuY2VNZXRyaWNzW10ge1xuICAgIHJldHVybiBbLi4udGhpcy5wZXJmb3JtYW5jZUhpc3RvcnldO1xuICB9XG59XG4iXSwidmVyc2lvbiI6M30=