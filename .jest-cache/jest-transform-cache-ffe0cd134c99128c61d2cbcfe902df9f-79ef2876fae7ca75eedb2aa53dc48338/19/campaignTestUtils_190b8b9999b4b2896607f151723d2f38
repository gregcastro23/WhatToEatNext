46427d3e9092e38e06c3f06894dbf5f2
"use strict";
/**
 * Campaign Test Utilities
 *
 * Comprehensive utilities for testing campaign system functionality
 * with proper isolation and memory management.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.campaignTestData = exports.campaignTestAssertions = exports.validateCampaignMemoryUsage = exports.withCampaignTestIsolation = exports.executeCampaignTestScenario = exports.validateCampaignTestIsolation = exports.simulateProgressTracking = exports.simulateCampaignPhase = exports.createMockSafetyEvent = exports.createMockProgressMetrics = exports.createMockCampaignConfig = exports.cleanupCampaignTest = exports.setupCampaignTest = void 0;
const CampaignTestController_1 = require("./CampaignTestController");
const campaign_1 = require("../../types/campaign");
/**
 * Setup campaign test environment with proper isolation
 */
async function setupCampaignTest(setup) {
    const { testName, enableMemoryMonitoring = true, preventActualBuilds = true, preventGitOperations = true, mockProgressTracking = true, simulateRealProgress = false, customConfig } = setup;
    // Initialize test controller with configuration
    await CampaignTestController_1.campaignTestController.initializeForTest(testName, {
        pauseProgressTracking: mockProgressTracking,
        preventBuildExecution: preventActualBuilds,
        preventGitOperations,
        enableMemoryMonitoring,
        isolateFileSystem: false,
        mockExternalAPIs: true
    });
    // Pause campaign operations for test isolation
    await CampaignTestController_1.campaignTestController.pauseCampaignForTest(testName);
    // Get mock instances
    const mockInstances = CampaignTestController_1.campaignTestController.getMockInstances();
    const testSafeTracker = CampaignTestController_1.campaignTestController.getTestSafeTracker();
    // Validate that all required instances are available
    if (!mockInstances.controller || !mockInstances.tracker || !mockInstances.safety) {
        throw new Error('Failed to initialize campaign mock instances');
    }
    return {
        controller: mockInstances.controller,
        tracker: mockInstances.tracker,
        safety: mockInstances.safety,
        testSafeTracker,
        testController: CampaignTestController_1.campaignTestController
    };
}
exports.setupCampaignTest = setupCampaignTest;
/**
 * Cleanup campaign test environment
 */
async function cleanupCampaignTest(testName) {
    await CampaignTestController_1.campaignTestController.cleanupAfterTest(testName);
}
exports.cleanupCampaignTest = cleanupCampaignTest;
/**
 * Create mock campaign configuration for testing
 */
function createMockCampaignConfig(overrides) {
    const defaultConfig = {
        phases: [
            {
                id: 'test-phase-1',
                name: 'Test Phase 1',
                description: 'Mock phase for testing',
                tools: [
                    {
                        scriptPath: 'mock-script.js',
                        parameters: { maxFiles: 10, autoFix: true },
                        batchSize: 10,
                        safetyLevel: 'HIGH'
                    }
                ],
                successCriteria: {
                    typeScriptErrors: 0,
                    lintingWarnings: 0
                },
                safetyCheckpoints: []
            }
        ],
        safetySettings: {
            maxFilesPerBatch: 10,
            buildValidationFrequency: 5,
            testValidationFrequency: 10,
            corruptionDetectionEnabled: true,
            automaticRollbackEnabled: true,
            stashRetentionDays: 7
        },
        progressTargets: {
            typeScriptErrors: 0,
            lintingWarnings: 0,
            buildTime: 10,
            enterpriseSystems: 200
        },
        toolConfiguration: {
            enhancedErrorFixer: 'mock-enhanced-fixer.js',
            explicitAnyFixer: 'mock-any-fixer.js',
            unusedVariablesFixer: 'mock-unused-fixer.js',
            consoleStatementFixer: 'mock-console-fixer.js'
        }
    };
    return { ...defaultConfig, ...overrides };
}
exports.createMockCampaignConfig = createMockCampaignConfig;
/**
 * Create mock progress metrics for testing
 */
function createMockProgressMetrics(overrides) {
    const defaultMetrics = {
        typeScriptErrors: {
            current: 50,
            target: 0,
            reduction: 36,
            percentage: 42
        },
        lintingWarnings: {
            current: 2000,
            target: 0,
            reduction: 2506,
            percentage: 56
        },
        buildPerformance: {
            currentTime: 8.5,
            targetTime: 10,
            cacheHitRate: 0.8,
            memoryUsage: 45
        },
        enterpriseSystems: {
            current: 50,
            target: 200,
            transformedExports: 50
        }
    };
    return { ...defaultMetrics, ...overrides };
}
exports.createMockProgressMetrics = createMockProgressMetrics;
/**
 * Create mock safety event for testing
 */
function createMockSafetyEvent(type, description, severity = campaign_1.SafetyEventSeverity.INFO) {
    return {
        type,
        timestamp: new Date(),
        description: `Mock: ${description}`,
        severity,
        action: 'MOCK_TEST_EVENT'
    };
}
exports.createMockSafetyEvent = createMockSafetyEvent;
/**
 * Simulate campaign phase execution for testing
 */
async function simulateCampaignPhase(context, phase, expectedResult) {
    var _a;
    const result = await context.controller.executePhase(phase);
    // Validate result if expected result is provided
    if (expectedResult) {
        expect(result.success).toBe((_a = expectedResult.success) !== null && _a !== void 0 ? _a : true);
        if (expectedResult.filesProcessed !== undefined) {
            expect(result.filesProcessed).toBe(expectedResult.filesProcessed);
        }
        if (expectedResult.errorsFixed !== undefined) {
            expect(result.errorsFixed).toBe(expectedResult.errorsFixed);
        }
    }
    return result;
}
exports.simulateCampaignPhase = simulateCampaignPhase;
/**
 * Simulate progress tracking for testing
 */
async function simulateProgressTracking(context, targetMetrics, durationMs = 1000) {
    if (context.testSafeTracker) {
        await context.testSafeTracker.simulateProgress(targetMetrics, durationMs, 'test-simulation');
        return await context.testSafeTracker.getProgressMetrics();
    }
    else {
        // Fallback to mock tracker
        context.tracker.updateMockMetrics(targetMetrics);
        return await context.tracker.getProgressMetrics();
    }
}
exports.simulateProgressTracking = simulateProgressTracking;
/**
 * Validate campaign test isolation
 */
function validateCampaignTestIsolation(context) {
    return context.testController.validateTestIsolation();
}
exports.validateCampaignTestIsolation = validateCampaignTestIsolation;
/**
 * Execute a complete campaign test scenario
 */
async function executeCampaignTestScenario(scenario, config) {
    // Setup test environment
    const context = await setupCampaignTest({
        testName: scenario.name,
        customConfig: config
    });
    try {
        // Set initial metrics
        context.testController.updateMockMetrics(scenario.initialMetrics, scenario.name);
        // Execute phases
        const campaignConfig = createMockCampaignConfig(config);
        const results = [];
        for (let i = 0; i < campaignConfig.phases.length; i++) {
            const phase = campaignConfig.phases[i];
            const expectedResult = scenario.expectedPhaseResults[i] || {};
            const result = await simulateCampaignPhase(context, phase, expectedResult);
            results.push(result);
        }
        // Simulate progress to target metrics
        const finalMetrics = await simulateProgressTracking(context, scenario.targetMetrics, scenario.simulationDuration);
        // Get safety events
        const safetyEvents = context.controller.getSafetyEvents();
        // Validate expected safety events
        scenario.expectedSafetyEvents.forEach(expectedType => {
            const hasEvent = safetyEvents.some(event => event.type === expectedType);
            expect(hasEvent).toBe(true);
        });
        return {
            context,
            results,
            finalMetrics,
            safetyEvents
        };
    }
    finally {
        // Cleanup is handled by the caller or test framework
    }
}
exports.executeCampaignTestScenario = executeCampaignTestScenario;
/**
 * Memory-safe test wrapper for campaign operations
 */
async function withCampaignTestIsolation(testName, testFn, setup) {
    const context = await setupCampaignTest({
        testName,
        ...setup
    });
    try {
        return await testFn(context);
    }
    finally {
        await cleanupCampaignTest(testName);
    }
}
exports.withCampaignTestIsolation = withCampaignTestIsolation;
/**
 * Validate campaign system memory usage during tests
 */
function validateCampaignMemoryUsage(context) {
    const recommendations = [];
    let isMemoryEfficient = true;
    // Check test-safe tracker memory usage
    if (context.testSafeTracker) {
        const memoryStats = context.testSafeTracker.getMemoryStatistics();
        if (memoryStats && !memoryStats.memoryEfficient) {
            isMemoryEfficient = false;
            recommendations.push('Test-safe tracker memory usage is high');
        }
        return {
            isMemoryEfficient,
            memoryStats,
            recommendations
        };
    }
    return {
        isMemoryEfficient: true,
        memoryStats: null,
        recommendations: []
    };
}
exports.validateCampaignMemoryUsage = validateCampaignMemoryUsage;
/**
 * Create comprehensive test assertions for campaign operations
 */
exports.campaignTestAssertions = {
    /**
     * Assert that campaign phase completed successfully
     */
    phaseCompletedSuccessfully: (result) => {
        expect(result.success).toBe(true);
        expect(result.executionTime).toBeGreaterThan(0);
        expect(result.safetyEvents).toBeDefined();
    },
    /**
     * Assert that progress metrics improved
     */
    progressImproved: (initial, final) => {
        expect(final.typeScriptErrors.current).toBeLessThanOrEqual(initial.typeScriptErrors.current);
        expect(final.lintingWarnings.current).toBeLessThanOrEqual(initial.lintingWarnings.current);
    },
    /**
     * Assert that safety events were recorded
     */
    safetyEventsRecorded: (events, expectedTypes) => {
        expectedTypes.forEach(expectedType => {
            const hasEvent = events.some(event => event.type === expectedType);
            expect(hasEvent).toBe(true);
        });
    },
    /**
     * Assert that test isolation is working
     */
    testIsolationActive: (context) => {
        const validation = validateCampaignTestIsolation(context);
        expect(validation.isValid).toBe(true);
        expect(validation.issues).toHaveLength(0);
    },
    /**
     * Assert that memory usage is within acceptable limits
     */
    memoryUsageAcceptable: (context) => {
        const memoryValidation = validateCampaignMemoryUsage(context);
        expect(memoryValidation.isMemoryEfficient).toBe(true);
    }
};
/**
 * Common test data generators
 */
exports.campaignTestData = {
    /**
     * Generate realistic TypeScript error reduction scenario
     */
    typeScriptErrorReduction: () => ({
        name: 'typescript-error-reduction',
        initialMetrics: createMockProgressMetrics({
            typeScriptErrors: { current: 86, target: 0, reduction: 0, percentage: 0 }
        }),
        targetMetrics: {
            typeScriptErrors: { current: 0, target: 0, reduction: 86, percentage: 100 }
        },
        expectedPhaseResults: [
            { success: true, errorsFixed: 86 }
        ],
        expectedSafetyEvents: [
            campaign_1.SafetyEventType.CHECKPOINT_CREATED,
            campaign_1.SafetyEventType.CHECKPOINT_CREATED // Start and end checkpoints
        ],
        simulationDuration: 2000
    }),
    /**
     * Generate linting warning cleanup scenario
     */
    lintingWarningCleanup: () => ({
        name: 'linting-warning-cleanup',
        initialMetrics: createMockProgressMetrics({
            lintingWarnings: { current: 4506, target: 0, reduction: 0, percentage: 0 }
        }),
        targetMetrics: {
            lintingWarnings: { current: 0, target: 0, reduction: 4506, percentage: 100 }
        },
        expectedPhaseResults: [
            { success: true, warningsFixed: 4506 }
        ],
        expectedSafetyEvents: [
            campaign_1.SafetyEventType.CHECKPOINT_CREATED
        ],
        simulationDuration: 3000
    }),
    /**
     * Generate build performance optimization scenario
     */
    buildPerformanceOptimization: () => ({
        name: 'build-performance-optimization',
        initialMetrics: createMockProgressMetrics({
            buildPerformance: { currentTime: 15, targetTime: 10, cacheHitRate: 0.6, memoryUsage: 80 }
        }),
        targetMetrics: {
            buildPerformance: { currentTime: 8, targetTime: 10, cacheHitRate: 0.8, memoryUsage: 45 }
        },
        expectedPhaseResults: [
            { success: true }
        ],
        expectedSafetyEvents: [
            campaign_1.SafetyEventType.CHECKPOINT_CREATED
        ],
        simulationDuration: 1500
    })
};
// Functions are already exported at their declarations above
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9fX3Rlc3RzX18vdXRpbHMvY2FtcGFpZ25UZXN0VXRpbHMudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7OztHQUtHOzs7QUFFSCxxRUFBMEY7QUFRMUYsbURBUThCO0FBMEI5Qjs7R0FFRztBQUNJLEtBQUssVUFBVSxpQkFBaUIsQ0FBQyxLQUF3QjtJQUM5RCxNQUFNLEVBQ0osUUFBUSxFQUNSLHNCQUFzQixHQUFHLElBQUksRUFDN0IsbUJBQW1CLEdBQUcsSUFBSSxFQUMxQixvQkFBb0IsR0FBRyxJQUFJLEVBQzNCLG9CQUFvQixHQUFHLElBQUksRUFDM0Isb0JBQW9CLEdBQUcsS0FBSyxFQUM1QixZQUFZLEVBQ2IsR0FBRyxLQUFLLENBQUM7SUFFVixnREFBZ0Q7SUFDaEQsTUFBTSwrQ0FBc0IsQ0FBQyxpQkFBaUIsQ0FBQyxRQUFRLEVBQUU7UUFDdkQscUJBQXFCLEVBQUUsb0JBQW9CO1FBQzNDLHFCQUFxQixFQUFFLG1CQUFtQjtRQUMxQyxvQkFBb0I7UUFDcEIsc0JBQXNCO1FBQ3RCLGlCQUFpQixFQUFFLEtBQUs7UUFDeEIsZ0JBQWdCLEVBQUUsSUFBSTtLQUN2QixDQUFDLENBQUM7SUFFSCwrQ0FBK0M7SUFDL0MsTUFBTSwrQ0FBc0IsQ0FBQyxvQkFBb0IsQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUU1RCxxQkFBcUI7SUFDckIsTUFBTSxhQUFhLEdBQUcsK0NBQXNCLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztJQUNoRSxNQUFNLGVBQWUsR0FBRywrQ0FBc0IsQ0FBQyxrQkFBa0IsRUFBRSxDQUFDO0lBRXBFLHFEQUFxRDtJQUNyRCxJQUFJLENBQUMsYUFBYSxDQUFDLFVBQVUsSUFBSSxDQUFDLGFBQWEsQ0FBQyxPQUFPLElBQUksQ0FBQyxhQUFhLENBQUMsTUFBTSxFQUFFO1FBQ2hGLE1BQU0sSUFBSSxLQUFLLENBQUMsOENBQThDLENBQUMsQ0FBQztLQUNqRTtJQUVELE9BQU87UUFDTCxVQUFVLEVBQUUs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QUFhLEVBQUUsSUFBSSxFQUFFO1NBQ3ZDO1FBQ0Qsb0JBQW9CLEVBQUU7WUFDcEIsMEJBQWUsQ0FBQyxrQkFBa0I7U0FDbkM7UUFDRCxrQkFBa0IsRUFBRSxJQUFJO0tBQ3pCLENBQUM7SUFFRjs7T0FFRztJQUNILDRCQUE0QixFQUFFLEdBQXlCLEVBQUUsQ0FBQyxDQUFDO1FBQ3pELElBQUksRUFBRSxnQ0FBZ0M7UUFDdEMsY0FBYyxFQUFFLHlCQUF5QixDQUFDO1lBQ3hDLGdCQUFnQixFQUFFLEVBQUUsV0FBVyxFQUFFLEVBQUUsRUFBRSxVQUFVLEVBQUUsRUFBRSxFQUFFLFlBQVksRUFBRSxHQUFHLEVBQUUsV0FBVyxFQUFFLEVBQUUsRUFBRTtTQUMxRixDQUFDO1FBQ0YsYUFBYSxFQUFFO1lBQ2IsZ0JBQWdCLEVBQUUsRUFBRSxXQUFXLEVBQUUsQ0FBQyxFQUFFLFVBQVUsRUFBRSxFQUFFLEVBQUUsWUFBWSxFQUFFLEdBQUcsRUFBRSxXQUFXLEVBQUUsRUFBRSxFQUFFO1NBQ3pGO1FBQ0Qsb0JBQW9CLEVBQUU7WUFDcEIsRUFBRSxPQUFPLEVBQUUsSUFBSSxFQUFFO1NBQ2xCO1FBQ0Qsb0JBQW9CLEVBQUU7WUFDcEIsMEJBQWUsQ0FBQyxrQkFBa0I7U0FDbkM7UUFDRCxrQkFBa0IsRUFBRSxJQUFJO0tBQ3pCLENBQUM7Q0FDSCxDQUFDO0FBRUYsNkRBQTZEIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9HcmVnQ2FzdHJvL0Rlc2t0b3AvV2hhdFRvRWF0TmV4dC9zcmMvX190ZXN0c19fL3V0aWxzL2NhbXBhaWduVGVzdFV0aWxzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ2FtcGFpZ24gVGVzdCBVdGlsaXRpZXNcbiAqIFxuICogQ29tcHJlaGVuc2l2ZSB1dGlsaXRpZXMgZm9yIHRlc3RpbmcgY2FtcGFpZ24gc3lzdGVtIGZ1bmN0aW9uYWxpdHlcbiAqIHdpdGggcHJvcGVyIGlzb2xhdGlvbiBhbmQgbWVtb3J5IG1hbmFnZW1lbnQuXG4gKi9cblxuaW1wb3J0IHsgY2FtcGFpZ25UZXN0Q29udHJvbGxlciwgQ2FtcGFpZ25UZXN0Q29udHJvbGxlciB9IGZyb20gJy4vQ2FtcGFpZ25UZXN0Q29udHJvbGxlcic7XG5pbXBvcnQgeyBUZXN0U2FmZVByb2dyZXNzVHJhY2tlciB9IGZyb20gJy4vVGVzdFNhZmVQcm9ncmVzc1RyYWNrZXInO1xuaW1wb3J0IHtcbiAgTW9ja0NhbXBhaWduQ29udHJvbGxlcixcbiAgTW9ja1Byb2dyZXNzVHJhY2tlcixcbiAgTW9ja1NhZmV0eVByb3RvY29sLFxuICBjYW1wYWlnblRlc3RJc29sYXRpb25cbn0gZnJvbSAnLi4vbW9ja3MvQ2FtcGFpZ25TeXN0ZW1Nb2Nrcyc7XG5pbXBvcnQge1xuICBDYW1wYWlnbkNvbmZpZyxcbiAgQ2FtcGFpZ25QaGFzZSxcbiAgUHJvZ3Jlc3NNZXRyaWNzLFxuICBTYWZldHlFdmVudCxcbiAgU2FmZXR5RXZlbnRUeXBlLFxuICBTYWZldHlFdmVudFNldmVyaXR5LFxuICBQaGFzZVJlc3VsdFxufSBmcm9tICcuLi8uLi90eXBlcy9jYW1wYWlnbic7XG5cbi8qKlxuICogVGVzdCBzZXR1cCBjb25maWd1cmF0aW9uIGZvciBjYW1wYWlnbiB0ZXN0c1xuICovXG5leHBvcnQgaW50ZXJmYWNlIENhbXBhaWduVGVzdFNldHVwIHtcbiAgdGVzdE5hbWU6IHN0cmluZztcbiAgZW5hYmxlTWVtb3J5TW9uaXRvcmluZz86IGJvb2xlYW47XG4gIHByZXZlbnRBY3R1YWxCdWlsZHM/OiBib29sZWFuO1xuICBwcmV2ZW50R2l0T3BlcmF0aW9ucz86IGJvb2xlYW47XG4gIG1vY2tQcm9ncmVzc1RyYWNraW5nPzogYm9vbGVhbjtcbiAgc2ltdWxhdGVSZWFsUHJvZ3Jlc3M/OiBib29sZWFuO1xuICBjdXN0b21Db25maWc/OiBQYXJ0aWFsPENhbXBhaWduQ29uZmlnPjtcbn1cblxuLyoqXG4gKiBDYW1wYWlnbiB0ZXN0IGNvbnRleHQgdGhhdCBwcm92aWRlcyBhY2Nlc3MgdG8gYWxsIG1vY2sgaW5zdGFuY2VzXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgQ2FtcGFpZ25UZXN0Q29udGV4dCB7XG4gIGNvbnRyb2xsZXI6IE1vY2tDYW1wYWlnbkNvbnRyb2xsZXI7XG4gIHRyYWNrZXI6IE1vY2tQcm9ncmVzc1RyYWNrZXI7XG4gIHNhZmV0eTogTW9ja1NhZmV0eVByb3RvY29sO1xuICB0ZXN0U2FmZVRyYWNrZXI6IFRlc3RTYWZlUHJvZ3Jlc3NUcmFja2VyIHwgbnVsbDtcbiAgdGVzdENvbnRyb2xsZXI6IENhbXBhaWduVGVzdENvbnRyb2xsZXI7XG59XG5cbi8qKlxuICogU2V0dXAgY2FtcGFpZ24gdGVzdCBlbnZpcm9ubWVudCB3aXRoIHByb3BlciBpc29sYXRpb25cbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHNldHVwQ2FtcGFpZ25UZXN0KHNldHVwOiBDYW1wYWlnblRlc3RTZXR1cCk6IFByb21pc2U8Q2FtcGFpZ25UZXN0Q29udGV4dD4ge1xuICBjb25zdCB7XG4gICAgdGVzdE5hbWUsXG4gICAgZW5hYmxlTWVtb3J5TW9uaXRvcmluZyA9IHRydWUsXG4gICAgcHJldmVudEFjdHVhbEJ1aWxkcyA9IHRydWUsXG4gICAgcHJldmVudEdpdE9wZXJhdGlvbnMgPSB0cnVlLFxuICAgIG1vY2tQcm9ncmVzc1RyYWNraW5nID0gdHJ1ZSxcbiAgICBzaW11bGF0ZVJlYWxQcm9ncmVzcyA9IGZhbHNlLFxuICAgIGN1c3RvbUNvbmZpZ1xuICB9ID0gc2V0dXA7XG5cbiAgLy8gSW5pdGlhbGl6ZSB0ZXN0IGNvbnRyb2xsZXIgd2l0aCBjb25maWd1cmF0aW9uXG4gIGF3YWl0IGNhbXBhaWduVGVzdENvbnRyb2xsZXIuaW5pdGlhbGl6ZUZvclRlc3QodGVzdE5hbWUsIHtcbiAgICBwYXVzZVByb2dyZXNzVHJhY2tpbmc6IG1vY2tQcm9ncmVzc1RyYWNraW5nLFxuICAgIHByZXZlbnRCdWlsZEV4ZWN1dGlvbjogcHJldmVudEFjdHVhbEJ1aWxkcyxcbiAgICBwcmV2ZW50R2l0T3BlcmF0aW9ucyxcbiAgICBlbmFibGVNZW1vcnlNb25pdG9yaW5nLFxuICAgIGlzb2xhdGVGaWxlU3lzdGVtOiBmYWxzZSxcbiAgICBtb2NrRXh0ZXJuYWxBUElzOiB0cnVlXG4gIH0pO1xuXG4gIC8vIFBhdXNlIGNhbXBhaWduIG9wZXJhdGlvbnMgZm9yIHRlc3QgaXNvbGF0aW9uXG4gIGF3YWl0IGNhbXBhaWduVGVzdENvbnRyb2xsZXIucGF1c2VDYW1wYWlnbkZvclRlc3QodGVzdE5hbWUpO1xuXG4gIC8vIEdldCBtb2NrIGluc3RhbmNlc1xuICBjb25zdCBtb2NrSW5zdGFuY2VzID0gY2FtcGFpZ25UZXN0Q29udHJvbGxlci5nZXRNb2NrSW5zdGFuY2VzKCk7XG4gIGNvbnN0IHRlc3RTYWZlVHJhY2tlciA9IGNhbXBhaWduVGVzdENvbnRyb2xsZXIuZ2V0VGVzdFNhZmVUcmFja2VyKCk7XG5cbiAgLy8gVmFsaWRhdGUgdGhhdCBhbGwgcmVxdWlyZWQgaW5zdGFuY2VzIGFyZSBhdmFpbGFibGVcbiAgaWYgKCFtb2NrSW5zdGFuY2VzLmNvbnRyb2xsZXIgfHwgIW1vY2tJbnN0YW5jZXMudHJhY2tlciB8fCAhbW9ja0luc3RhbmNlcy5zYWZldHkpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZhaWxlZCB0byBpbml0aWFsaXplIGNhbXBhaWduIG1vY2sgaW5zdGFuY2VzJyk7XG4gIH1cblxuICByZXR1cm4ge1xuICAgIGNvbnRyb2xsZXI6IG1vY2tJbnN0YW5jZXMuY29udHJvbGxlcixcbiAgICB0cmFja2VyOiBtb2NrSW5zdGFuY2VzLnRyYWNrZXIsXG4gICAgc2FmZXR5OiBtb2NrSW5zdGFuY2VzLnNhZmV0eSxcbiAgICB0ZXN0U2FmZVRyYWNrZXIsXG4gICAgdGVzdENvbnRyb2xsZXI6IGNhbXBhaWduVGVzdENvbnRyb2xsZXJcbiAgfTtcbn1cblxuLyoqXG4gKiBDbGVhbnVwIGNhbXBhaWduIHRlc3QgZW52aXJvbm1lbnRcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNsZWFudXBDYW1wYWlnblRlc3QodGVzdE5hbWU6IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICBhd2FpdCBjYW1wYWlnblRlc3RDb250cm9sbGVyLmNsZWFudXBBZnRlclRlc3QodGVzdE5hbWUpO1xufVxuXG4vKipcbiAqIENyZWF0ZSBtb2NrIGNhbXBhaWduIGNvbmZpZ3VyYXRpb24gZm9yIHRlc3RpbmdcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZU1vY2tDYW1wYWlnbkNvbmZpZyhvdmVycmlkZXM/OiBQYXJ0aWFsPENhbXBhaWduQ29uZmlnPik6IENhbXBhaWduQ29uZmlnIHtcbiAgY29uc3QgZGVmYXVsdENvbmZpZzogQ2FtcGFpZ25Db25maWcgPSB7XG4gICAgcGhhc2VzOiBbXG4gICAgICB7XG4gICAgICAgIGlkOiAndGVzdC1waGFzZS0xJyxcbiAgICAgICAgbmFtZTogJ1Rlc3QgUGhhc2UgMScsXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnTW9jayBwaGFzZSBmb3IgdGVzdGluZycsXG4gICAgICAgIHRvb2xzOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgc2NyaXB0UGF0aDogJ21vY2stc2NyaXB0LmpzJyxcbiAgICAgICAgICAgIHBhcmFtZXRlcnM6IHsgbWF4RmlsZXM6IDEwLCBhdXRvRml4OiB0cnVlIH0sXG4gICAgICAgICAgICBiYXRjaFNpemU6IDEwLFxuICAgICAgICAgICAgc2FmZXR5TGV2ZWw6ICdISUdIJyBhcyBhbnlcbiAgICAgICAgICB9XG4gICAgICAgIF0sXG4gICAgICAgIHN1Y2Nlc3NDcml0ZXJpYToge1xuICAgICAgICAgIHR5cGVTY3JpcHRFcnJvcnM6IDAsXG4gICAgICAgICAgbGludGluZ1dhcm5pbmdzOiAwXG4gICAgICAgIH0sXG4gICAgICAgIHNhZmV0eUNoZWNrcG9pbnRzOiBbXVxuICAgICAgfVxuICAgIF0sXG4gICAgc2FmZXR5U2V0dGluZ3M6IHtcbiAgICAgIG1heEZpbGVzUGVyQmF0Y2g6IDEwLFxuICAgICAgYnVpbGRWYWxpZGF0aW9uRnJlcXVlbmN5OiA1LFxuICAgICAgdGVzdFZhbGlkYXRpb25GcmVxdWVuY3k6IDEwLFxuICAgICAgY29ycnVwdGlvbkRldGVjdGlvbkVuYWJsZWQ6IHRydWUsXG4gICAgICBhdXRvbWF0aWNSb2xsYmFja0VuYWJsZWQ6IHRydWUsXG4gICAgICBzdGFzaFJldGVudGlvbkRheXM6IDdcbiAgICB9LFxuICAgIHByb2dyZXNzVGFyZ2V0czoge1xuICAgICAgdHlwZVNjcmlwdEVycm9yczogMCxcbiAgICAgIGxpbnRpbmdXYXJuaW5nczogMCxcbiAgICAgIGJ1aWxkVGltZTogMTAsXG4gICAgICBlbnRlcnByaXNlU3lzdGVtczogMjAwXG4gICAgfSxcbiAgICB0b29sQ29uZmlndXJhdGlvbjoge1xuICAgICAgZW5oYW5jZWRFcnJvckZpeGVyOiAnbW9jay1lbmhhbmNlZC1maXhlci5qcycsXG4gICAgICBleHBsaWNpdEFueUZpeGVyOiAnbW9jay1hbnktZml4ZXIuanMnLFxuICAgICAgdW51c2VkVmFyaWFibGVzRml4ZXI6ICdtb2NrLXVudXNlZC1maXhlci5qcycsXG4gICAgICBjb25zb2xlU3RhdGVtZW50Rml4ZXI6ICdtb2NrLWNvbnNvbGUtZml4ZXIuanMnXG4gICAgfVxuICB9O1xuXG4gIHJldHVybiB7IC4uLmRlZmF1bHRDb25maWcsIC4uLm92ZXJyaWRlcyB9O1xufVxuXG4vKipcbiAqIENyZWF0ZSBtb2NrIHByb2dyZXNzIG1ldHJpY3MgZm9yIHRlc3RpbmdcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZU1vY2tQcm9ncmVzc01ldHJpY3Mob3ZlcnJpZGVzPzogUGFydGlhbDxQcm9ncmVzc01ldHJpY3M+KTogUHJvZ3Jlc3NNZXRyaWNzIHtcbiAgY29uc3QgZGVmYXVsdE1ldHJpY3M6IFByb2dyZXNzTWV0cmljcyA9IHtcbiAgICB0eXBlU2NyaXB0RXJyb3JzOiB7XG4gICAgICBjdXJyZW50OiA1MCxcbiAgICAgIHRhcmdldDogMCxcbiAgICAgIHJlZHVjdGlvbjogMzYsXG4gICAgICBwZXJjZW50YWdlOiA0MlxuICAgIH0sXG4gICAgbGludGluZ1dhcm5pbmdzOiB7XG4gICAgICBjdXJyZW50OiAyMDAwLFxuICAgICAgdGFyZ2V0OiAwLFxuICAgICAgcmVkdWN0aW9uOiAyNTA2LFxuICAgICAgcGVyY2VudGFnZTogNTZcbiAgICB9LFxuICAgIGJ1aWxkUGVyZm9ybWFuY2U6IHtcbiAgICAgIGN1cnJlbnRUaW1lOiA4LjUsXG4gICAgICB0YXJnZXRUaW1lOiAxMCxcbiAgICAgIGNhY2hlSGl0UmF0ZTogMC44LFxuICAgICAgbWVtb3J5VXNhZ2U6IDQ1XG4gICAgfSxcbiAgICBlbnRlcnByaXNlU3lzdGVtczoge1xuICAgICAgY3VycmVudDogNTAsXG4gICAgICB0YXJnZXQ6IDIwMCxcbiAgICAgIHRyYW5zZm9ybWVkRXhwb3J0czogNTBcbiAgICB9XG4gIH07XG5cbiAgcmV0dXJuIHsgLi4uZGVmYXVsdE1ldHJpY3MsIC4uLm92ZXJyaWRlcyB9O1xufVxuXG4vKipcbiAqIENyZWF0ZSBtb2NrIHNhZmV0eSBldmVudCBmb3IgdGVzdGluZ1xuICovXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlTW9ja1NhZmV0eUV2ZW50KFxuICB0eXBlOiBTYWZldHlFdmVudFR5cGUsXG4gIGRlc2NyaXB0aW9uOiBzdHJpbmcsXG4gIHNldmVyaXR5OiBTYWZldHlFdmVudFNldmVyaXR5ID0gU2FmZXR5RXZlbnRTZXZlcml0eS5JTkZPXG4pOiBTYWZldHlFdmVudCB7XG4gIHJldHVybiB7XG4gICAgdHlwZSxcbiAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAgZGVzY3JpcHRpb246IGBNb2NrOiAke2Rlc2NyaXB0aW9ufWAsXG4gICAgc2V2ZXJpdHksXG4gICAgYWN0aW9uOiAnTU9DS19URVNUX0VWRU5UJ1xuICB9O1xufVxuXG4vKipcbiAqIFNpbXVsYXRlIGNhbXBhaWduIHBoYXNlIGV4ZWN1dGlvbiBmb3IgdGVzdGluZ1xuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2ltdWxhdGVDYW1wYWlnblBoYXNlKFxuICBjb250ZXh0OiBDYW1wYWlnblRlc3RDb250ZXh0LFxuICBwaGFzZTogQ2FtcGFpZ25QaGFzZSxcbiAgZXhwZWN0ZWRSZXN1bHQ/OiBQYXJ0aWFsPFBoYXNlUmVzdWx0PlxuKTogUHJvbWlzZTxQaGFzZVJlc3VsdD4ge1xuICBjb25zdCByZXN1bHQgPSBhd2FpdCBjb250ZXh0LmNvbnRyb2xsZXIuZXhlY3V0ZVBoYXNlKHBoYXNlKTtcbiAgXG4gIC8vIFZhbGlkYXRlIHJlc3VsdCBpZiBleHBlY3RlZCByZXN1bHQgaXMgcHJvdmlkZWRcbiAgaWYgKGV4cGVjdGVkUmVzdWx0KSB7XG4gICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKGV4cGVjdGVkUmVzdWx0LnN1Y2Nlc3MgPz8gdHJ1ZSk7XG4gICAgaWYgKGV4cGVjdGVkUmVzdWx0LmZpbGVzUHJvY2Vzc2VkICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGV4cGVjdChyZXN1bHQuZmlsZXNQcm9jZXNzZWQpLnRvQmUoZXhwZWN0ZWRSZXN1bHQuZmlsZXNQcm9jZXNzZWQpO1xuICAgIH1cbiAgICBpZiAoZXhwZWN0ZWRSZXN1bHQuZXJyb3JzRml4ZWQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgZXhwZWN0KHJlc3VsdC5lcnJvcnNGaXhlZCkudG9CZShleHBlY3RlZFJlc3VsdC5lcnJvcnNGaXhlZCk7XG4gICAgfVxuICB9XG4gIFxuICByZXR1cm4gcmVzdWx0O1xufVxuXG4vKipcbiAqIFNpbXVsYXRlIHByb2dyZXNzIHRyYWNraW5nIGZvciB0ZXN0aW5nXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzaW11bGF0ZVByb2dyZXNzVHJhY2tpbmcoXG4gIGNvbnRleHQ6IENhbXBhaWduVGVzdENvbnRleHQsXG4gIHRhcmdldE1ldHJpY3M6IFBhcnRpYWw8UHJvZ3Jlc3NNZXRyaWNzPixcbiAgZHVyYXRpb25NczogbnVtYmVyID0gMTAwMFxuKTogUHJvbWlzZTxQcm9ncmVzc01ldHJpY3M+IHtcbiAgaWYgKGNvbnRleHQudGVzdFNhZmVUcmFja2VyKSB7XG4gICAgYXdhaXQgY29udGV4dC50ZXN0U2FmZVRyYWNrZXIuc2ltdWxhdGVQcm9ncmVzcyh0YXJnZXRNZXRyaWNzLCBkdXJhdGlvbk1zLCAndGVzdC1zaW11bGF0aW9uJyk7XG4gICAgcmV0dXJuIGF3YWl0IGNvbnRleHQudGVzdFNhZmVUcmFja2VyLmdldFByb2dyZXNzTWV0cmljcygpO1xuICB9IGVsc2Uge1xuICAgIC8vIEZhbGxiYWNrIHRvIG1vY2sgdHJhY2tlclxuICAgIGNvbnRleHQudHJhY2tlci51cGRhdGVNb2NrTWV0cmljcyh0YXJnZXRNZXRyaWNzKTtcbiAgICByZXR1cm4gYXdhaXQgY29udGV4dC50cmFja2VyLmdldFByb2dyZXNzTWV0cmljcygpO1xuICB9XG59XG5cbi8qKlxuICogVmFsaWRhdGUgY2FtcGFpZ24gdGVzdCBpc29sYXRpb25cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHZhbGlkYXRlQ2FtcGFpZ25UZXN0SXNvbGF0aW9uKGNvbnRleHQ6IENhbXBhaWduVGVzdENvbnRleHQpOiB7XG4gIGlzVmFsaWQ6IGJvb2xlYW47XG4gIGlzc3Vlczogc3RyaW5nW107XG4gIHdhcm5pbmdzOiBzdHJpbmdbXTtcbn0ge1xuICByZXR1cm4gY29udGV4dC50ZXN0Q29udHJvbGxlci52YWxpZGF0ZVRlc3RJc29sYXRpb24oKTtcbn1cblxuLyoqXG4gKiBDcmVhdGUgdGVzdCBzY2VuYXJpbyBmb3IgY2FtcGFpZ24gb3BlcmF0aW9uc1xuICovXG5leHBvcnQgaW50ZXJmYWNlIENhbXBhaWduVGVzdFNjZW5hcmlvIHtcbiAgbmFtZTogc3RyaW5nO1xuICBpbml0aWFsTWV0cmljczogUHJvZ3Jlc3NNZXRyaWNzO1xuICB0YXJnZXRNZXRyaWNzOiBQYXJ0aWFsPFByb2dyZXNzTWV0cmljcz47XG4gIGV4cGVjdGVkUGhhc2VSZXN1bHRzOiBQYXJ0aWFsPFBoYXNlUmVzdWx0PltdO1xuICBleHBlY3RlZFNhZmV0eUV2ZW50czogU2FmZXR5RXZlbnRUeXBlW107XG4gIHNpbXVsYXRpb25EdXJhdGlvbj86IG51bWJlcjtcbn1cblxuLyoqXG4gKiBFeGVjdXRlIGEgY29tcGxldGUgY2FtcGFpZ24gdGVzdCBzY2VuYXJpb1xuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZXhlY3V0ZUNhbXBhaWduVGVzdFNjZW5hcmlvKFxuICBzY2VuYXJpbzogQ2FtcGFpZ25UZXN0U2NlbmFyaW8sXG4gIGNvbmZpZz86IFBhcnRpYWw8Q2FtcGFpZ25Db25maWc+XG4pOiBQcm9taXNlPHtcbiAgY29udGV4dDogQ2FtcGFpZ25UZXN0Q29udGV4dDtcbiAgcmVzdWx0czogUGhhc2VSZXN1bHRbXTtcbiAgZmluYWxNZXRyaWNzOiBQcm9ncmVzc01ldHJpY3M7XG4gIHNhZmV0eUV2ZW50czogU2FmZXR5RXZlbnRbXTtcbn0+IHtcbiAgLy8gU2V0dXAgdGVzdCBlbnZpcm9ubWVudFxuICBjb25zdCBjb250ZXh0ID0gYXdhaXQgc2V0dXBDYW1wYWlnblRlc3Qoe1xuICAgIHRlc3ROYW1lOiBzY2VuYXJpby5uYW1lLFxuICAgIGN1c3RvbUNvbmZpZzogY29uZmlnXG4gIH0pO1xuXG4gIHRyeSB7XG4gICAgLy8gU2V0IGluaXRpYWwgbWV0cmljc1xuICAgIGNvbnRleHQudGVzdENvbnRyb2xsZXIudXBkYXRlTW9ja01ldHJpY3Moc2NlbmFyaW8uaW5pdGlhbE1ldHJpY3MsIHNjZW5hcmlvLm5hbWUpO1xuXG4gICAgLy8gRXhlY3V0ZSBwaGFzZXNcbiAgICBjb25zdCBjYW1wYWlnbkNvbmZpZyA9IGNyZWF0ZU1vY2tDYW1wYWlnbkNvbmZpZyhjb25maWcpO1xuICAgIGNvbnN0IHJlc3VsdHM6IFBoYXNlUmVzdWx0W10gPSBbXTtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY2FtcGFpZ25Db25maWcucGhhc2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCBwaGFzZSA9IGNhbXBhaWduQ29uZmlnLnBoYXNlc1tpXTtcbiAgICAgIGNvbnN0IGV4cGVjdGVkUmVzdWx0ID0gc2NlbmFyaW8uZXhwZWN0ZWRQaGFzZVJlc3VsdHNbaV0gfHwge307XG4gICAgICBcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNpbXVsYXRlQ2FtcGFpZ25QaGFzZShjb250ZXh0LCBwaGFzZSwgZXhwZWN0ZWRSZXN1bHQpO1xuICAgICAgcmVzdWx0cy5wdXNoKHJlc3VsdCk7XG4gICAgfVxuXG4gICAgLy8gU2ltdWxhdGUgcHJvZ3Jlc3MgdG8gdGFyZ2V0IG1ldHJpY3NcbiAgICBjb25zdCBmaW5hbE1ldHJpY3MgPSBhd2FpdCBzaW11bGF0ZVByb2dyZXNzVHJhY2tpbmcoXG4gICAgICBjb250ZXh0LFxuICAgICAgc2NlbmFyaW8udGFyZ2V0TWV0cmljcyxcbiAgICAgIHNjZW5hcmlvLnNpbXVsYXRpb25EdXJhdGlvblxuICAgICk7XG5cbiAgICAvLyBHZXQgc2FmZXR5IGV2ZW50c1xuICAgIGNvbnN0IHNhZmV0eUV2ZW50cyA9IGNvbnRleHQuY29udHJvbGxlci5nZXRTYWZldHlFdmVudHMoKTtcblxuICAgIC8vIFZhbGlkYXRlIGV4cGVjdGVkIHNhZmV0eSBldmVudHNcbiAgICBzY2VuYXJpby5leHBlY3RlZFNhZmV0eUV2ZW50cy5mb3JFYWNoKGV4cGVjdGVkVHlwZSA9PiB7XG4gICAgICBjb25zdCBoYXNFdmVudCA9IHNhZmV0eUV2ZW50cy5zb21lKGV2ZW50ID0+IGV2ZW50LnR5cGUgPT09IGV4cGVjdGVkVHlwZSk7XG4gICAgICBleHBlY3QoaGFzRXZlbnQpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgY29udGV4dCxcbiAgICAgIHJlc3VsdHMsXG4gICAgICBmaW5hbE1ldHJpY3MsXG4gICAgICBzYWZldHlFdmVudHNcbiAgICB9O1xuXG4gIH0gZmluYWxseSB7XG4gICAgLy8gQ2xlYW51cCBpcyBoYW5kbGVkIGJ5IHRoZSBjYWxsZXIgb3IgdGVzdCBmcmFtZXdvcmtcbiAgfVxufVxuXG4vKipcbiAqIE1lbW9yeS1zYWZlIHRlc3Qgd3JhcHBlciBmb3IgY2FtcGFpZ24gb3BlcmF0aW9uc1xuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gd2l0aENhbXBhaWduVGVzdElzb2xhdGlvbjxUPihcbiAgdGVzdE5hbWU6IHN0cmluZyxcbiAgdGVzdEZuOiAoY29udGV4dDogQ2FtcGFpZ25UZXN0Q29udGV4dCkgPT4gUHJvbWlzZTxUPixcbiAgc2V0dXA/OiBQYXJ0aWFsPENhbXBhaWduVGVzdFNldHVwPlxuKTogUHJvbWlzZTxUPiB7XG4gIGNvbnN0IGNvbnRleHQgPSBhd2FpdCBzZXR1cENhbXBhaWduVGVzdCh7XG4gICAgdGVzdE5hbWUsXG4gICAgLi4uc2V0dXBcbiAgfSk7XG5cbiAgdHJ5IHtcbiAgICByZXR1cm4gYXdhaXQgdGVzdEZuKGNvbnRleHQpO1xuICB9IGZpbmFsbHkge1xuICAgIGF3YWl0IGNsZWFudXBDYW1wYWlnblRlc3QodGVzdE5hbWUpO1xuICB9XG59XG5cbi8qKlxuICogVmFsaWRhdGUgY2FtcGFpZ24gc3lzdGVtIG1lbW9yeSB1c2FnZSBkdXJpbmcgdGVzdHNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHZhbGlkYXRlQ2FtcGFpZ25NZW1vcnlVc2FnZShjb250ZXh0OiBDYW1wYWlnblRlc3RDb250ZXh0KToge1xuICBpc01lbW9yeUVmZmljaWVudDogYm9vbGVhbjtcbiAgbWVtb3J5U3RhdHM6IGFueTtcbiAgcmVjb21tZW5kYXRpb25zOiBzdHJpbmdbXTtcbn0ge1xuICBjb25zdCByZWNvbW1lbmRhdGlvbnM6IHN0cmluZ1tdID0gW107XG4gIGxldCBpc01lbW9yeUVmZmljaWVudCA9IHRydWU7XG5cbiAgLy8gQ2hlY2sgdGVzdC1zYWZlIHRyYWNrZXIgbWVtb3J5IHVzYWdlXG4gIGlmIChjb250ZXh0LnRlc3RTYWZlVHJhY2tlcikge1xuICAgIGNvbnN0IG1lbW9yeVN0YXRzID0gY29udGV4dC50ZXN0U2FmZVRyYWNrZXIuZ2V0TWVtb3J5U3RhdGlzdGljcygpO1xuICAgIFxuICAgIGlmIChtZW1vcnlTdGF0cyAmJiAhbWVtb3J5U3RhdHMubWVtb3J5RWZmaWNpZW50KSB7XG4gICAgICBpc01lbW9yeUVmZmljaWVudCA9IGZhbHNlO1xuICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goJ1Rlc3Qtc2FmZSB0cmFja2VyIG1lbW9yeSB1c2FnZSBpcyBoaWdoJyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIGlzTWVtb3J5RWZmaWNpZW50LFxuICAgICAgbWVtb3J5U3RhdHMsXG4gICAgICByZWNvbW1lbmRhdGlvbnNcbiAgICB9O1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBpc01lbW9yeUVmZmljaWVudDogdHJ1ZSxcbiAgICBtZW1vcnlTdGF0czogbnVsbCxcbiAgICByZWNvbW1lbmRhdGlvbnM6IFtdXG4gIH07XG59XG5cbi8qKlxuICogQ3JlYXRlIGNvbXByZWhlbnNpdmUgdGVzdCBhc3NlcnRpb25zIGZvciBjYW1wYWlnbiBvcGVyYXRpb25zXG4gKi9cbmV4cG9ydCBjb25zdCBjYW1wYWlnblRlc3RBc3NlcnRpb25zID0ge1xuICAvKipcbiAgICogQXNzZXJ0IHRoYXQgY2FtcGFpZ24gcGhhc2UgY29tcGxldGVkIHN1Y2Nlc3NmdWxseVxuICAgKi9cbiAgcGhhc2VDb21wbGV0ZWRTdWNjZXNzZnVsbHk6IChyZXN1bHQ6IFBoYXNlUmVzdWx0KSA9PiB7XG4gICAgZXhwZWN0KHJlc3VsdC5zdWNjZXNzKS50b0JlKHRydWUpO1xuICAgIGV4cGVjdChyZXN1bHQuZXhlY3V0aW9uVGltZSkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgIGV4cGVjdChyZXN1bHQuc2FmZXR5RXZlbnRzKS50b0JlRGVmaW5lZCgpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBBc3NlcnQgdGhhdCBwcm9ncmVzcyBtZXRyaWNzIGltcHJvdmVkXG4gICAqL1xuICBwcm9ncmVzc0ltcHJvdmVkOiAoaW5pdGlhbDogUHJvZ3Jlc3NNZXRyaWNzLCBmaW5hbDogUHJvZ3Jlc3NNZXRyaWNzKSA9PiB7XG4gICAgZXhwZWN0KGZpbmFsLnR5cGVTY3JpcHRFcnJvcnMuY3VycmVudCkudG9CZUxlc3NUaGFuT3JFcXVhbChpbml0aWFsLnR5cGVTY3JpcHRFcnJvcnMuY3VycmVudCk7XG4gICAgZXhwZWN0KGZpbmFsLmxpbnRpbmdXYXJuaW5ncy5jdXJyZW50KS50b0JlTGVzc1RoYW5PckVxdWFsKGluaXRpYWwubGludGluZ1dhcm5pbmdzLmN1cnJlbnQpO1xuICB9LFxuXG4gIC8qKlxuICAgKiBBc3NlcnQgdGhhdCBzYWZldHkgZXZlbnRzIHdlcmUgcmVjb3JkZWRcbiAgICovXG4gIHNhZmV0eUV2ZW50c1JlY29yZGVkOiAoZXZlbnRzOiBTYWZldHlFdmVudFtdLCBleHBlY3RlZFR5cGVzOiBTYWZldHlFdmVudFR5cGVbXSkgPT4ge1xuICAgIGV4cGVjdGVkVHlwZXMuZm9yRWFjaChleHBlY3RlZFR5cGUgPT4ge1xuICAgICAgY29uc3QgaGFzRXZlbnQgPSBldmVudHMuc29tZShldmVudCA9PiBldmVudC50eXBlID09PSBleHBlY3RlZFR5cGUpO1xuICAgICAgZXhwZWN0KGhhc0V2ZW50KS50b0JlKHRydWUpO1xuICAgIH0pO1xuICB9LFxuXG4gIC8qKlxuICAgKiBBc3NlcnQgdGhhdCB0ZXN0IGlzb2xhdGlvbiBpcyB3b3JraW5nXG4gICAqL1xuICB0ZXN0SXNvbGF0aW9uQWN0aXZlOiAoY29udGV4dDogQ2FtcGFpZ25UZXN0Q29udGV4dCkgPT4ge1xuICAgIGNvbnN0IHZhbGlkYXRpb24gPSB2YWxpZGF0ZUNhbXBhaWduVGVzdElzb2xhdGlvbihjb250ZXh0KTtcbiAgICBleHBlY3QodmFsaWRhdGlvbi5pc1ZhbGlkKS50b0JlKHRydWUpO1xuICAgIGV4cGVjdCh2YWxpZGF0aW9uLmlzc3VlcykudG9IYXZlTGVuZ3RoKDApO1xuICB9LFxuXG4gIC8qKlxuICAgKiBBc3NlcnQgdGhhdCBtZW1vcnkgdXNhZ2UgaXMgd2l0aGluIGFjY2VwdGFibGUgbGltaXRzXG4gICAqL1xuICBtZW1vcnlVc2FnZUFjY2VwdGFibGU6IChjb250ZXh0OiBDYW1wYWlnblRlc3RDb250ZXh0KSA9PiB7XG4gICAgY29uc3QgbWVtb3J5VmFsaWRhdGlvbiA9IHZhbGlkYXRlQ2FtcGFpZ25NZW1vcnlVc2FnZShjb250ZXh0KTtcbiAgICBleHBlY3QobWVtb3J5VmFsaWRhdGlvbi5pc01lbW9yeUVmZmljaWVudCkudG9CZSh0cnVlKTtcbiAgfVxufTtcblxuLyoqXG4gKiBDb21tb24gdGVzdCBkYXRhIGdlbmVyYXRvcnNcbiAqL1xuZXhwb3J0IGNvbnN0IGNhbXBhaWduVGVzdERhdGEgPSB7XG4gIC8qKlxuICAgKiBHZW5lcmF0ZSByZWFsaXN0aWMgVHlwZVNjcmlwdCBlcnJvciByZWR1Y3Rpb24gc2NlbmFyaW9cbiAgICovXG4gIHR5cGVTY3JpcHRFcnJvclJlZHVjdGlvbjogKCk6IENhbXBhaWduVGVzdFNjZW5hcmlvID0+ICh7XG4gICAgbmFtZTogJ3R5cGVzY3JpcHQtZXJyb3ItcmVkdWN0aW9uJyxcbiAgICBpbml0aWFsTWV0cmljczogY3JlYXRlTW9ja1Byb2dyZXNzTWV0cmljcyh7XG4gICAgICB0eXBlU2NyaXB0RXJyb3JzOiB7IGN1cnJlbnQ6IDg2LCB0YXJnZXQ6IDAsIHJlZHVjdGlvbjogMCwgcGVyY2VudGFnZTogMCB9XG4gICAgfSksXG4gICAgdGFyZ2V0TWV0cmljczoge1xuICAgICAgdHlwZVNjcmlwdEVycm9yczogeyBjdXJyZW50OiAwLCB0YXJnZXQ6IDAsIHJlZHVjdGlvbjogODYsIHBlcmNlbnRhZ2U6IDEwMCB9XG4gICAgfSxcbiAgICBleHBlY3RlZFBoYXNlUmVzdWx0czogW1xuICAgICAgeyBzdWNjZXNzOiB0cnVlLCBlcnJvcnNGaXhlZDogODYgfVxuICAgIF0sXG4gICAgZXhwZWN0ZWRTYWZldHlFdmVudHM6IFtcbiAgICAgIFNhZmV0eUV2ZW50VHlwZS5DSEVDS1BPSU5UX0NSRUFURUQsXG4gICAgICBTYWZldHlFdmVudFR5cGUuQ0hFQ0tQT0lOVF9DUkVBVEVEIC8vIFN0YXJ0IGFuZCBlbmQgY2hlY2twb2ludHNcbiAgICBdLFxuICAgIHNpbXVsYXRpb25EdXJhdGlvbjogMjAwMFxuICB9KSxcblxuICAvKipcbiAgICogR2VuZXJhdGUgbGludGluZyB3YXJuaW5nIGNsZWFudXAgc2NlbmFyaW9cbiAgICovXG4gIGxpbnRpbmdXYXJuaW5nQ2xlYW51cDogKCk6IENhbXBhaWduVGVzdFNjZW5hcmlvID0+ICh7XG4gICAgbmFtZTogJ2xpbnRpbmctd2FybmluZy1jbGVhbnVwJyxcbiAgICBpbml0aWFsTWV0cmljczogY3JlYXRlTW9ja1Byb2dyZXNzTWV0cmljcyh7XG4gICAgICBsaW50aW5nV2FybmluZ3M6IHsgY3VycmVudDogNDUwNiwgdGFyZ2V0OiAwLCByZWR1Y3Rpb246IDAsIHBlcmNlbnRhZ2U6IDAgfVxuICAgIH0pLFxuICAgIHRhcmdldE1ldHJpY3M6IHtcbiAgICAgIGxpbnRpbmdXYXJuaW5nczogeyBjdXJyZW50OiAwLCB0YXJnZXQ6IDAsIHJlZHVjdGlvbjogNDUwNiwgcGVyY2VudGFnZTogMTAwIH1cbiAgICB9LFxuICAgIGV4cGVjdGVkUGhhc2VSZXN1bHRzOiBbXG4gICAgICB7IHN1Y2Nlc3M6IHRydWUsIHdhcm5pbmdzRml4ZWQ6IDQ1MDYgfVxuICAgIF0sXG4gICAgZXhwZWN0ZWRTYWZldHlFdmVudHM6IFtcbiAgICAgIFNhZmV0eUV2ZW50VHlwZS5DSEVDS1BPSU5UX0NSRUFURURcbiAgICBdLFxuICAgIHNpbXVsYXRpb25EdXJhdGlvbjogMzAwMFxuICB9KSxcblxuICAvKipcbiAgICogR2VuZXJhdGUgYnVpbGQgcGVyZm9ybWFuY2Ugb3B0aW1pemF0aW9uIHNjZW5hcmlvXG4gICAqL1xuICBidWlsZFBlcmZvcm1hbmNlT3B0aW1pemF0aW9uOiAoKTogQ2FtcGFpZ25UZXN0U2NlbmFyaW8gPT4gKHtcbiAgICBuYW1lOiAnYnVpbGQtcGVyZm9ybWFuY2Utb3B0aW1pemF0aW9uJyxcbiAgICBpbml0aWFsTWV0cmljczogY3JlYXRlTW9ja1Byb2dyZXNzTWV0cmljcyh7XG4gICAgICBidWlsZFBlcmZvcm1hbmNlOiB7IGN1cnJlbnRUaW1lOiAxNSwgdGFyZ2V0VGltZTogMTAsIGNhY2hlSGl0UmF0ZTogMC42LCBtZW1vcnlVc2FnZTogODAgfVxuICAgIH0pLFxuICAgIHRhcmdldE1ldHJpY3M6IHtcbiAgICAgIGJ1aWxkUGVyZm9ybWFuY2U6IHsgY3VycmVudFRpbWU6IDgsIHRhcmdldFRpbWU6IDEwLCBjYWNoZUhpdFJhdGU6IDAuOCwgbWVtb3J5VXNhZ2U6IDQ1IH1cbiAgICB9LFxuICAgIGV4cGVjdGVkUGhhc2VSZXN1bHRzOiBbXG4gICAgICB7IHN1Y2Nlc3M6IHRydWUgfVxuICAgIF0sXG4gICAgZXhwZWN0ZWRTYWZldHlFdmVudHM6IFtcbiAgICAgIFNhZmV0eUV2ZW50VHlwZS5DSEVDS1BPSU5UX0NSRUFURURcbiAgICBdLFxuICAgIHNpbXVsYXRpb25EdXJhdGlvbjogMTUwMFxuICB9KVxufTtcblxuLy8gRnVuY3Rpb25zIGFyZSBhbHJlYWR5IGV4cG9ydGVkIGF0IHRoZWlyIGRlY2xhcmF0aW9ucyBhYm92ZSJdLCJ2ZXJzaW9uIjozfQ==