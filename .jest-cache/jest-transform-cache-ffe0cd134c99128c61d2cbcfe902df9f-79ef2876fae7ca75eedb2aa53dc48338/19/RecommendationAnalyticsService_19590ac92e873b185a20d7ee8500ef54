be6d198304b186fe531a4bcbb7272f12
"use strict";
/**
 * Recommendation Analytics Service
 *
 * Provides comprehensive analytics for recommendation systems including:
 * - Performance metrics tracking (load time, API response time)
 * - Recommendation confidence scoring
 * - User interaction analytics
 * - Intelligent caching for recommendations
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.recommendationAnalytics = void 0;
const PerformanceCache_1 = require("./PerformanceCache");
const logger_1 = require("@/utils/logger");
// ========== RECOMMENDATION ANALYTICS SERVICE ==========
class RecommendationAnalyticsService {
    constructor() {
        this.metricsHistory = [];
        this.userInteractions = [];
        this.maxHistorySize = 100;
        this.maxInteractionHistory = 500;
        this.performanceMonitor = new PerformanceCache_1.PerformanceMonitor();
        this.recommendationCache = new PerformanceCache_1.PerformanceCache(1000, 600000); // 10 minutes TTL
        this.confidenceCache = new PerformanceCache_1.PerformanceCache(500, 300000); // 5 minutes TTL
        this.sessionId = this.generateSessionId();
    }
    // ========== PERFORMANCE TRACKING ==========
    /**
     * Start timing a recommendation operation
     */
    startTiming(operation) {
        const startTime = performance.now();
        return () => {
            const endTime = performance.now();
            const duration = endTime - startTime;
            this.performanceMonitor.recordMetric('calculationTime', duration);
            return duration;
        };
    }
    /**
     * Record API response time
     */
    recordApiResponseTime(duration) {
        this.performanceMonitor.recordMetric('averageResponseTime', duration);
    }
    /**
     * Record recommendation load time
     */
    recordLoadTime(duration) {
        this.performanceMonitor.recordMetric('calculationTime', duration);
    }
    // ========== INTELLIGENT CACHING ==========
    /**
     * Get cached recommendation with performance tracking
     */
    getCachedRecommendation(key) {
        const startTime = performance.now();
        const result = this.recommendationCache.get(key);
        const duration = performance.now() - startTime;
        // Update cache hit rate
        const stats = this.recommendationCache.getStats();
        this.performanceMonitor.recordMetric('cacheHitRate', stats.hitRate);
        logger_1.logger.debug(`Cache ${result ? 'hit' : 'miss'} for key: ${key} (${duration.toFixed(2)}ms)`);
        return result;
    }
    /**
     * Cache recommendation with intelligent TTL
     */
    cacheRecommendation(key, data, confidenceScore) {
        // Adjust TTL based on confidence score
        let ttl = 600000; // Default 10 minutes
        if (confidenceScore) {
            if (confidenceScore >= 0.9) {
                ttl = 1800000; // 30 minutes for high confidence
            }
            else if (confidenceScore >= 0.7) {
                ttl = 900000; // 15 minutes for medium confidence
            }
            else {
                ttl = 300000; // 5 minutes for low confidence
            }
        }
        this.recommendationCache.set(key, data, ttl);
        logger_1.logger.debug(`Cached recommendation with key: ${key} (TTL: ${ttl}ms, confidence: ${confidenceScore})`);
    }
    // ========== CONFIDENCE SCORING ==========
    /**
     * Calculate recommendation confidence score
     */
    calculateConfidenceScore(factors) {
        var _a, _b, _c, _d, _e, _f;
        const cacheKey = `confidence_${JSON.stringify(factors)}`;
        const cached = this.confidenceCache.get(cacheKey);
        if (cached) {
            return cached;
        }
        // Default factor values
        const completedFactors = {
            astrologicalAlignment: (_a = factors.astrologicalAlignment) !== null && _a !== void 0 ? _a : 0.8,
            elementalHarmony: (_b = factors.elementalHarmony) !== null && _b !== void 0 ? _b : 0.8,
            culturalRelevance: (_c = factors.culturalRelevance) !== null && _c !== void 0 ? _c : 0.7,
            seasonalOptimization: (_d = factors.seasonalOptimization) !== null && _d !== void 0 ? _d : 0.8,
            userPreferenceMatch: (_e = factors.userPreferenceMatch) !== null && _e !== void 0 ? _e : 0.7,
            dataQuality: (_f = factors.dataQuality) !== null && _f !== void 0 ? _f : 0.9
        };
        // Weighted confidence calculation
        const weights = {
            astrologicalAlignment: 0.25,
            elementalHarmony: 0.20,
            culturalRelevance: 0.15,
            seasonalOptimization: 0.15,
            userPreferenceMatch: 0.15,
            dataQuality: 0.10
        };
        const overallScore = Object.entries(completedFactors).reduce((sum, [key, value]) => {
            const weight = weights[key];
            return sum + (value * weight);
        }, 0);
        // Generate reasoning based on factors
        const reasoning = [];
        if (completedFactors.astrologicalAlignment >= 0.9) {
            reasoning.push('Strong astrological alignment with current planetary positions');
        }
        else if (completedFactors.astrologicalAlignment < 0.6) {
            reasoning.push('Limited astrological alignment - consider alternative timing');
        }
        if (completedFactors.elementalHarmony >= 0.9) {
            reasoning.push('Excellent elemental harmony with user profile');
        }
        else if (completedFactors.elementalHarmony < 0.6) {
            reasoning.push('Moderate elemental compatibility');
        }
        if (completedFactors.culturalRelevance >= 0.8) {
            reasoning.push('High cultural relevance and authenticity');
        }
        if (completedFactors.seasonalOptimization >= 0.8) {
            reasoning.push('Well-optimized for current season');
        }
        // Determine reliability level
        let reliability;
        if (overallScore >= 0.85) {
            reliability = 'high';
        }
        else if (overallScore >= 0.65) {
            reliability = 'medium';
        }
        else {
            reliability = 'low';
        }
        const confidence = {
            overallScore,
            factors: completedFactors,
            reasoning,
            reliability
        };
        // Cache the confidence calculation
        this.confidenceCache.set(cacheKey, confidence);
        return confidence;
    }
    // ========== USER INTERACTION ANALYTICS ==========
    /**
     * Track user interaction
     */
    trackInteraction(interaction) {
        const fullInteraction = {
            ...interaction,
            timestamp: Date.now()
        };
        this.userInteractions.push(fullInteraction);
        // Keep only recent interactions
        if (this.userInteractions.length > this.maxInteractionHistory) {
            this.userInteractions = this.userInteractions.slice(-this.maxInteractionHistory);
        }
        logger_1.logger.debug(`Tracked interaction: ${interaction.type} on ${interaction.target}`);
    }
    /**
     * Get user interaction analytics
     */
    getInteractionAnalytics(timeWindow) {
        var _a, _b;
        const now = Date.now();
        const windowStart = timeWindow ? now - timeWindow : 0;
        const relevantInteractions = this.userInteractions.filter(interaction => interaction.timestamp >= windowStart);
        // Count interactions by type
        const interactionsByType = {};
        const targetCounts = {};
        relevantInteractions.forEach(interaction => {
            interactionsByType[interaction.type] = (interactionsByType[interaction.type] || 0) + 1;
            targetCounts[interaction.target] = (targetCounts[interaction.target] || 0) + 1;
        });
        // Get most interacted targets
        const mostInteractedTargets = Object.entries(targetCounts)
            .map(([target, count]) => ({ target, count }))
            .sort((a, b) => b.count - a.count)
            .slice(0, 5);
        // Calculate interaction rate (interactions per minute)
        const timeSpan = timeWindow || (now - (((_a = this.userInteractions[0]) === null || _a === void 0 ? void 0 : _a.timestamp) || now));
        const interactionRate = relevantInteractions.length / (timeSpan / 60000);
        // Calculate average session duration
        const sessionStart = ((_b = this.userInteractions[0]) === null || _b === void 0 ? void 0 : _b.timestamp) || now;
        const averageSessionDuration = (now - sessionStart) / 60000; // in minutes
        return {
            totalInteractions: relevantInteractions.length,
            interactionsByType,
            interactionRate,
            mostInteractedTargets,
            averageSessionDuration
        };
    }
    // ========== METRICS AND REPORTING ==========
    /**
     * Record comprehensive metrics snapshot
     */
    recordMetricsSnapshot() {
        const performanceStats = this.performanceMonitor.getStats();
        const cacheStats = this.recommendationCache.getStats();
        const interactionAnalytics = this.getInteractionAnalytics(300000); // Last 5 minutes
        const metrics = {
            loadTime: performanceStats.current.calculationTime,
            apiResponseTime: performanceStats.current.averageResponseTime,
            cacheHitRate: cacheStats.hitRate,
            recommendationCount: performanceStats.current.recommendationCount,
            averageConfidenceScore: 0.8,
            userInteractionRate: interactionAnalytics.interactionRate,
            timestamp: Date.now()
        };
        this.metricsHistory.push(metrics);
        // Keep only recent metrics
        if (this.metricsHistory.length > this.maxHistorySize) {
            this.metricsHistory = this.metricsHistory.slice(-this.maxHistorySize);
        }
        return metrics;
    }
    /**
     * Get analytics snapshot
     */
    getAnalyticsSnapshot() {
        const metrics = this.recordMetricsSnapshot();
        const cacheStats = this.recommendationCache.getStats();
        const recentInteractions = this.userInteractions.slice(-20); // Last 20 interactions
        return {
            sessionId: this.sessionId,
            timestamp: Date.now(),
            metrics,
            interactions: recentInteractions,
            cacheStats: {
                hitRate: cacheStats.hitRate,
                totalEntries: cacheStats.totalEntries,
                memoryUsage: cacheStats.memoryUsage
            }
        };
    }
    /**
     * Get performance trends
     */
    getPerformanceTrends(timeWindow) {
        const now = Date.now();
        const windowStart = timeWindow ? now - timeWindow : 0;
        const relevantMetrics = this.metricsHistory.filter(metric => metric.timestamp >= windowStart);
        if (relevantMetrics.length === 0) {
            return {
                loadTimeTrend: [],
                cacheHitRateTrend: [],
                interactionRateTrend: [],
                averageLoadTime: 0,
                averageCacheHitRate: 0,
                performanceScore: 0
            };
        }
        const loadTimeTrend = relevantMetrics.map(m => m.loadTime);
        const cacheHitRateTrend = relevantMetrics.map(m => m.cacheHitRate);
        const interactionRateTrend = relevantMetrics.map(m => m.userInteractionRate);
        const averageLoadTime = loadTimeTrend.reduce((sum, val) => sum + val, 0) / loadTimeTrend.length;
        const averageCacheHitRate = cacheHitRateTrend.reduce((sum, val) => sum + val, 0) / cacheHitRateTrend.length;
        // Calculate performance score (0-100)
        const loadTimeScore = Math.max(0, 100 - (averageLoadTime / 10)); // Penalize load times > 1000ms
        const cacheScore = averageCacheHitRate * 100;
        const performanceScore = (loadTimeScore * 0.6) + (cacheScore * 0.4);
        return {
            loadTimeTrend,
            cacheHitRateTrend,
            interactionRateTrend,
            averageLoadTime,
            averageCacheHitRate,
            performanceScore
        };
    }
    // ========== UTILITY METHODS ==========
    /**
     * Generate unique session ID
     */
    generateSessionId() {
        return `session_${Date.now()}_${Math.random().toString(36).substring(2, 9)}`;
    }
    /**
     * Clear all analytics data
     */
    clearAnalytics() {
        this.metricsHistory = [];
        this.userInteractions = [];
        this.recommendationCache.clear();
        this.confidenceCache.clear();
        this.performanceMonitor.clear();
        this.sessionId = this.generateSessionId();
        logger_1.logger.info('Analytics data cleared');
    }
    /**
     * Get cache statistics
     */
    getCacheStats() {
        return {
            recommendation: this.recommendationCache.getStats(),
            confidence: this.confidenceCache.getStats()
        };
    }
    /**
     * Destroy service and cleanup
     */
    destroy() {
        this.recommendationCache.destroy();
        this.confidenceCache.destroy();
        this.clearAnalytics();
    }
}
// ========== SINGLETON EXPORT ==========
exports.recommendationAnalytics = new RecommendationAnalyticsService();
exports.default = RecommendationAnalyticsService;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9zZXJ2aWNlcy9SZWNvbW1lbmRhdGlvbkFuYWx5dGljc1NlcnZpY2UudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7Ozs7OztHQVFHOzs7QUFFSCx5REFBMEU7QUFDMUUsMkNBQXdDO0FBaUR4Qyx5REFBeUQ7QUFFekQsTUFBTSw4QkFBOEI7SUFVbEM7UUFOUSxtQkFBYyxHQUE0QixFQUFFLENBQUM7UUFDN0MscUJBQWdCLEdBQXNCLEVBQUUsQ0FBQztRQUV6QyxtQkFBYyxHQUFXLEdBQUcsQ0FBQztRQUM3QiwwQkFBcUIsR0FBVyxHQUFHLENBQUM7UUFHMUMsSUFBSSxDQUFDLGtCQUFrQixHQUFHLElBQUkscUNBQWtCLEVBQUUsQ0FBQztRQUNuRCxJQUFJLENBQUMsbUJBQW1CLEdBQUcsSUFBSSxtQ0FBZ0IsQ0FBVSxJQUFJLEVBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQyxpQkFBaUI7UUFDekYsSUFBSSxDQUFDLGVBQWUsR0FBRyxJQUFJLG1DQUFnQixDQUEyQixHQUFHLEVBQUUsTUFBTSxDQUFDLENBQUMsQ0FBQyxnQkFBZ0I7UUFDcEcsSUFBSSxDQUFDLFNBQVMsR0FBRyxJQUFJLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztJQUM1QyxDQUFDO0lBRUQsNkNBQTZDO0lBRTdDOztPQUVHO0lBQ0gsV0FBVyxDQUFDLFNBQWlCO1FBQzNCLE1BQU0sU0FBUyxHQUFHLFdBQVcsQ0FBQyxHQUFHLEVBQUUsQ0FBQztRQUVwQyxPQUFPLEdBQUcsRUFBRTtZQUNWLE1BQU0sT0FBTyxHQUFHLFdBQVcsQ0FBQyxHQUFHLEVBQUUsQ0FBQztZQUNsQyxNQUFNLFFBQVEsR0FBRyxPQUFPLEdBQUcsU0FBUyxDQUFDO1lBRXJDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxZQUFZLENBQUMsaUJBQWlCLEVBQUUsUUFBUSxDQUFDLENBQUM7WUFFbEUsT0FBTyxRQUFRLENBQUM7UUFDbEIsQ0FBQyxDQUFDO0lBQ0osQ0FBQztJQUVEOztPQUVH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Q0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLGlCQUFpQixFQUFFLENBQUM7UUFFMUMsZUFBTSxDQUFDLElBQUksQ0FBQyx3QkFBd0IsQ0FBQyxDQUFDO0lBQ3hDLENBQUM7SUFFRDs7T0FFRztJQUNILGFBQWE7UUFDWCxPQUFPO1lBQ0wsY0FBYyxFQUFFLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxRQUFRLEVBQUU7WUFDbkQsVUFBVSxFQUFFLElBQUksQ0FBQyxlQUFlLENBQUMsUUFBUSxFQUFFO1NBQzVDLENBQUM7SUFDSixDQUFDO0lBRUQ7O09BRUc7SUFDSCxPQUFPO1FBQ0wsSUFBSSxDQUFDLG1CQUFtQixDQUFDLE9BQU8sRUFBRSxDQUFDO1FBQ25DLElBQUksQ0FBQyxlQUFlLENBQUMsT0FBTyxFQUFFLENBQUM7UUFDL0IsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO0lBQ3hCLENBQUM7Q0FDRjtBQUVELHlDQUF5QztBQUU1QixRQUFBLHVCQUF1QixHQUFHLElBQUksOEJBQThCLEVBQUUsQ0FBQztBQUM1RSxrQkFBZSw4QkFBOEIsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvR3JlZ0Nhc3Ryby9EZXNrdG9wL1doYXRUb0VhdE5leHQvc3JjL3NlcnZpY2VzL1JlY29tbWVuZGF0aW9uQW5hbHl0aWNzU2VydmljZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFJlY29tbWVuZGF0aW9uIEFuYWx5dGljcyBTZXJ2aWNlXG4gKiBcbiAqIFByb3ZpZGVzIGNvbXByZWhlbnNpdmUgYW5hbHl0aWNzIGZvciByZWNvbW1lbmRhdGlvbiBzeXN0ZW1zIGluY2x1ZGluZzpcbiAqIC0gUGVyZm9ybWFuY2UgbWV0cmljcyB0cmFja2luZyAobG9hZCB0aW1lLCBBUEkgcmVzcG9uc2UgdGltZSlcbiAqIC0gUmVjb21tZW5kYXRpb24gY29uZmlkZW5jZSBzY29yaW5nXG4gKiAtIFVzZXIgaW50ZXJhY3Rpb24gYW5hbHl0aWNzXG4gKiAtIEludGVsbGlnZW50IGNhY2hpbmcgZm9yIHJlY29tbWVuZGF0aW9uc1xuICovXG5cbmltcG9ydCB7IFBlcmZvcm1hbmNlQ2FjaGUsIFBlcmZvcm1hbmNlTW9uaXRvciB9IGZyb20gJy4vUGVyZm9ybWFuY2VDYWNoZSc7XG5pbXBvcnQgeyBsb2dnZXIgfSBmcm9tICdAL3V0aWxzL2xvZ2dlcic7XG5cbi8vID09PT09PT09PT0gSU5URVJGQUNFUyA9PT09PT09PT09XG5cbmV4cG9ydCBpbnRlcmZhY2UgUmVjb21tZW5kYXRpb25NZXRyaWNzIHtcbiAgbG9hZFRpbWU6IG51bWJlcjtcbiAgYXBpUmVzcG9uc2VUaW1lOiBudW1iZXI7XG4gIGNhY2hlSGl0UmF0ZTogbnVtYmVyO1xuICByZWNvbW1lbmRhdGlvbkNvdW50OiBudW1iZXI7XG4gIGF2ZXJhZ2VDb25maWRlbmNlU2NvcmU6IG51bWJlcjtcbiAgdXNlckludGVyYWN0aW9uUmF0ZTogbnVtYmVyO1xuICB0aW1lc3RhbXA6IG51bWJlcjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBDb25maWRlbmNlRmFjdG9ycyB7XG4gIGFzdHJvbG9naWNhbEFsaWdubWVudDogbnVtYmVyO1xuICBlbGVtZW50YWxIYXJtb255OiBudW1iZXI7XG4gIGN1bHR1cmFsUmVsZXZhbmNlOiBudW1iZXI7XG4gIHNlYXNvbmFsT3B0aW1pemF0aW9uOiBudW1iZXI7XG4gIHVzZXJQcmVmZXJlbmNlTWF0Y2g6IG51bWJlcjtcbiAgZGF0YVF1YWxpdHk6IG51bWJlcjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBSZWNvbW1lbmRhdGlvbkNvbmZpZGVuY2Uge1xuICBvdmVyYWxsU2NvcmU6IG51bWJlcjtcbiAgZmFjdG9yczogQ29uZmlkZW5jZUZhY3RvcnM7XG4gIHJlYXNvbmluZzogc3RyaW5nW107XG4gIHJlbGlhYmlsaXR5OiAnaGlnaCcgfCAnbWVkaXVtJyB8ICdsb3cnO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFVzZXJJbnRlcmFjdGlvbiB7XG4gIHR5cGU6ICd2aWV3JyB8ICdzZWxlY3QnIHwgJ2V4cGFuZCcgfCAnZmlsdGVyJyB8ICdzZWFyY2gnIHwgJ3JldHJ5JztcbiAgdGFyZ2V0OiBzdHJpbmc7XG4gIHRpbWVzdGFtcDogbnVtYmVyO1xuICBtZXRhZGF0YT86IFJlY29yZDxzdHJpbmcsIHVua25vd24+O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEFuYWx5dGljc1NuYXBzaG90IHtcbiAgc2Vzc2lvbklkOiBzdHJpbmc7XG4gIHRpbWVzdGFtcDogbnVtYmVyO1xuICBtZXRyaWNzOiBSZWNvbW1lbmRhdGlvbk1ldHJpY3M7XG4gIGludGVyYWN0aW9uczogVXNlckludGVyYWN0aW9uW107XG4gIGNhY2hlU3RhdHM6IHtcbiAgICBoaXRSYXRlOiBudW1iZXI7XG4gICAgdG90YWxFbnRyaWVzOiBudW1iZXI7XG4gICAgbWVtb3J5VXNhZ2U6IG51bWJlcjtcbiAgfTtcbn1cblxuLy8gPT09PT09PT09PSBSRUNPTU1FTkRBVElPTiBBTkFMWVRJQ1MgU0VSVklDRSA9PT09PT09PT09XG5cbmNsYXNzIFJlY29tbWVuZGF0aW9uQW5hbHl0aWNzU2VydmljZSB7XG4gIHByaXZhdGUgcGVyZm9ybWFuY2VNb25pdG9yOiBQZXJmb3JtYW5jZU1vbml0b3I7XG4gIHByaXZhdGUgcmVjb21tZW5kYXRpb25DYWNoZTogUGVyZm9ybWFuY2VDYWNoZTx1bmtub3duPjtcbiAgcHJpdmF0ZSBjb25maWRlbmNlQ2FjaGU6IFBlcmZvcm1hbmNlQ2FjaGU8UmVjb21tZW5kYXRpb25Db25maWRlbmNlPjtcbiAgcHJpdmF0ZSBtZXRyaWNzSGlzdG9yeTogUmVjb21tZW5kYXRpb25NZXRyaWNzW10gPSBbXTtcbiAgcHJpdmF0ZSB1c2VySW50ZXJhY3Rpb25zOiBVc2VySW50ZXJhY3Rpb25bXSA9IFtdO1xuICBwcml2YXRlIHNlc3Npb25JZDogc3RyaW5nO1xuICBwcml2YXRlIG1heEhpc3RvcnlTaXplOiBudW1iZXIgPSAxMDA7XG4gIHByaXZhdGUgbWF4SW50ZXJhY3Rpb25IaXN0b3J5OiBudW1iZXIgPSA1MDA7XG5cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5wZXJmb3JtYW5jZU1vbml0b3IgPSBuZXcgUGVyZm9ybWFuY2VNb25pdG9yKCk7XG4gICAgdGhpcy5yZWNvbW1lbmRhdGlvbkNhY2hlID0gbmV3IFBlcmZvcm1hbmNlQ2FjaGU8dW5rbm93bj4oMTAwMCwgNjAwMDAwKTsgLy8gMTAgbWludXRlcyBUVExcbiAgICB0aGlzLmNvbmZpZGVuY2VDYWNoZSA9IG5ldyBQZXJmb3JtYW5jZUNhY2hlPFJlY29tbWVuZGF0aW9uQ29uZmlkZW5jZT4oNTAwLCAzMDAwMDApOyAvLyA1IG1pbnV0ZXMgVFRMXG4gICAgdGhpcy5zZXNzaW9uSWQgPSB0aGlzLmdlbmVyYXRlU2Vzc2lvbklkKCk7XG4gIH1cblxuICAvLyA9PT09PT09PT09IFBFUkZPUk1BTkNFIFRSQUNLSU5HID09PT09PT09PT1cblxuICAvKipcbiAgICogU3RhcnQgdGltaW5nIGEgcmVjb21tZW5kYXRpb24gb3BlcmF0aW9uXG4gICAqL1xuICBzdGFydFRpbWluZyhvcGVyYXRpb246IHN0cmluZyk6ICgpID0+IG51bWJlciB7XG4gICAgY29uc3Qgc3RhcnRUaW1lID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgXG4gICAgcmV0dXJuICgpID0+IHtcbiAgICAgIGNvbnN0IGVuZFRpbWUgPSBwZXJmb3JtYW5jZS5ub3coKTtcbiAgICAgIGNvbnN0IGR1cmF0aW9uID0gZW5kVGltZSAtIHN0YXJ0VGltZTtcbiAgICAgIFxuICAgICAgdGhpcy5wZXJmb3JtYW5jZU1vbml0b3IucmVjb3JkTWV0cmljKCdjYWxjdWxhdGlvblRpbWUnLCBkdXJhdGlvbik7XG4gICAgICBcbiAgICAgIHJldHVybiBkdXJhdGlvbjtcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIFJlY29yZCBBUEkgcmVzcG9uc2UgdGltZVxuICAgKi9cbiAgcmVjb3JkQXBpUmVzcG9uc2VUaW1lKGR1cmF0aW9uOiBudW1iZXIpOiB2b2lkIHtcbiAgICB0aGlzLnBlcmZvcm1hbmNlTW9uaXRvci5yZWNvcmRNZXRyaWMoJ2F2ZXJhZ2VSZXNwb25zZVRpbWUnLCBkdXJhdGlvbik7XG4gIH1cblxuICAvKipcbiAgICogUmVjb3JkIHJlY29tbWVuZGF0aW9uIGxvYWQgdGltZVxuICAgKi9cbiAgcmVjb3JkTG9hZFRpbWUoZHVyYXRpb246IG51bWJlcik6IHZvaWQge1xuICAgIHRoaXMucGVyZm9ybWFuY2VNb25pdG9yLnJlY29yZE1ldHJpYygnY2FsY3VsYXRpb25UaW1lJywgZHVyYXRpb24pO1xuICB9XG5cbiAgLy8gPT09PT09PT09PSBJTlRFTExJR0VOVCBDQUNISU5HID09PT09PT09PT1cblxuICAvKipcbiAgICogR2V0IGNhY2hlZCByZWNvbW1lbmRhdGlvbiB3aXRoIHBlcmZvcm1hbmNlIHRyYWNraW5nXG4gICAqL1xuICBnZXRDYWNoZWRSZWNvbW1lbmRhdGlvbjxUPihrZXk6IHN0cmluZyk6IFQgfCBudWxsIHtcbiAgICBjb25zdCBzdGFydFRpbWUgPSBwZXJmb3JtYW5jZS5ub3coKTtcbiAgICBjb25zdCByZXN1bHQgPSB0aGlzLnJlY29tbWVuZGF0aW9uQ2FjaGUuZ2V0KGtleSkgYXMgVCB8IG51bGw7XG4gICAgY29uc3QgZHVyYXRpb24gPSBwZXJmb3JtYW5jZS5ub3coKSAtIHN0YXJ0VGltZTtcbiAgICBcbiAgICAvLyBVcGRhdGUgY2FjaGUgaGl0IHJhdGVcbiAgICBjb25zdCBzdGF0cyA9IHRoaXMucmVjb21tZW5kYXRpb25DYWNoZS5nZXRTdGF0cygpO1xuICAgIHRoaXMucGVyZm9ybWFuY2VNb25pdG9yLnJlY29yZE1ldHJpYygnY2FjaGVIaXRSYXRlJywgc3RhdHMuaGl0UmF0ZSk7XG4gICAgXG4gICAgbG9nZ2VyLmRlYnVnKGBDYWNoZSAke3Jlc3VsdCA/ICdoaXQnIDogJ21pc3MnfSBmb3Iga2V5OiAke2tleX0gKCR7ZHVyYXRpb24udG9GaXhlZCgyKX1tcylgKTtcbiAgICBcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgLyoqXG4gICAqIENhY2hlIHJlY29tbWVuZGF0aW9uIHdpdGggaW50ZWxsaWdlbnQgVFRMXG4gICAqL1xuICBjYWNoZVJlY29tbWVuZGF0aW9uPFQ+KGtleTogc3RyaW5nLCBkYXRhOiBULCBjb25maWRlbmNlU2NvcmU/OiBudW1iZXIpOiB2b2lkIHtcbiAgICAvLyBBZGp1c3QgVFRMIGJhc2VkIG9uIGNvbmZpZGVuY2Ugc2NvcmVcbiAgICBsZXQgdHRsID0gNjAwMDAwOyAvLyBEZWZhdWx0IDEwIG1pbnV0ZXNcbiAgICBcbiAgICBpZiAoY29uZmlkZW5jZVNjb3JlKSB7XG4gICAgICBpZiAoY29uZmlkZW5jZVNjb3JlID49IDAuOSkge1xuICAgICAgICB0dGwgPSAxODAwMDAwOyAvLyAzMCBtaW51dGVzIGZvciBoaWdoIGNvbmZpZGVuY2VcbiAgICAgIH0gZWxzZSBpZiAoY29uZmlkZW5jZVNjb3JlID49IDAuNykge1xuICAgICAgICB0dGwgPSA5MDAwMDA7IC8vIDE1IG1pbnV0ZXMgZm9yIG1lZGl1bSBjb25maWRlbmNlXG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0dGwgPSAzMDAwMDA7IC8vIDUgbWludXRlcyBmb3IgbG93IGNvbmZpZGVuY2VcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgdGhpcy5yZWNvbW1lbmRhdGlvbkNhY2hlLnNldChrZXksIGRhdGEsIHR0bCk7XG4gICAgXG4gICAgbG9nZ2VyLmRlYnVnKGBDYWNoZWQgcmVjb21tZW5kYXRpb24gd2l0aCBrZXk6ICR7a2V5fSAoVFRMOiAke3R0bH1tcywgY29uZmlkZW5jZTogJHtjb25maWRlbmNlU2NvcmV9KWApO1xuICB9XG5cbiAgLy8gPT09PT09PT09PSBDT05GSURFTkNFIFNDT1JJTkcgPT09PT09PT09PVxuXG4gIC8qKlxuICAgKiBDYWxjdWxhdGUgcmVjb21tZW5kYXRpb24gY29uZmlkZW5jZSBzY29yZVxuICAgKi9cbiAgY2FsY3VsYXRlQ29uZmlkZW5jZVNjb3JlKGZhY3RvcnM6IFBhcnRpYWw8Q29uZmlkZW5jZUZhY3RvcnM+KTogUmVjb21tZW5kYXRpb25Db25maWRlbmNlIHtcbiAgICBjb25zdCBjYWNoZUtleSA9IGBjb25maWRlbmNlXyR7SlNPTi5zdHJpbmdpZnkoZmFjdG9ycyl9YDtcbiAgICBjb25zdCBjYWNoZWQgPSB0aGlzLmNvbmZpZGVuY2VDYWNoZS5nZXQoY2FjaGVLZXkpO1xuICAgIFxuICAgIGlmIChjYWNoZWQpIHtcbiAgICAgIHJldHVybiBjYWNoZWQ7XG4gICAgfVxuXG4gICAgLy8gRGVmYXVsdCBmYWN0b3IgdmFsdWVzXG4gICAgY29uc3QgY29tcGxldGVkRmFjdG9yczogQ29uZmlkZW5jZUZhY3RvcnMgPSB7XG4gICAgICBhc3Ryb2xvZ2ljYWxBbGlnbm1lbnQ6IGZhY3RvcnMuYXN0cm9sb2dpY2FsQWxpZ25tZW50ID8/IDAuOCxcbiAgICAgIGVsZW1lbnRhbEhhcm1vbnk6IGZhY3RvcnMuZWxlbWVudGFsSGFybW9ueSA/PyAwLjgsXG4gICAgICBjdWx0dXJhbFJlbGV2YW5jZTogZmFjdG9ycy5jdWx0dXJhbFJlbGV2YW5jZSA/PyAwLjcsXG4gICAgICBzZWFzb25hbE9wdGltaXphdGlvbjogZmFjdG9ycy5zZWFzb25hbE9wdGltaXphdGlvbiA/PyAwLjgsXG4gICAgICB1c2VyUHJlZmVyZW5jZU1hdGNoOiBmYWN0b3JzLnVzZXJQcmVmZXJlbmNlTWF0Y2ggPz8gMC43LFxuICAgICAgZGF0YVF1YWxpdHk6IGZhY3RvcnMuZGF0YVF1YWxpdHkgPz8gMC45XG4gICAgfTtcblxuICAgIC8vIFdlaWdodGVkIGNvbmZpZGVuY2UgY2FsY3VsYXRpb25cbiAgICBjb25zdCB3ZWlnaHRzID0ge1xuICAgICAgYXN0cm9sb2dpY2FsQWxpZ25tZW50OiAwLjI1LFxuICAgICAgZWxlbWVudGFsSGFybW9ueTogMC4yMCxcbiAgICAgIGN1bHR1cmFsUmVsZXZhbmNlOiAwLjE1LFxuICAgICAgc2Vhc29uYWxPcHRpbWl6YXRpb246IDAuMTUsXG4gICAgICB1c2VyUHJlZmVyZW5jZU1hdGNoOiAwLjE1LFxuICAgICAgZGF0YVF1YWxpdHk6IDAuMTBcbiAgICB9O1xuXG4gICAgY29uc3Qgb3ZlcmFsbFNjb3JlID0gT2JqZWN0LmVudHJpZXMoY29tcGxldGVkRmFjdG9ycykucmVkdWNlKChzdW0sIFtrZXksIHZhbHVlXSkgPT4ge1xuICAgICAgY29uc3Qgd2VpZ2h0ID0gd2VpZ2h0c1trZXkgYXMga2V5b2YgQ29uZmlkZW5jZUZhY3RvcnNdO1xuICAgICAgcmV0dXJuIHN1bSArICh2YWx1ZSAqIHdlaWdodCk7XG4gICAgfSwgMCk7XG5cbiAgICAvLyBHZW5lcmF0ZSByZWFzb25pbmcgYmFzZWQgb24gZmFjdG9yc1xuICAgIGNvbnN0IHJlYXNvbmluZzogc3RyaW5nW10gPSBbXTtcbiAgICBcbiAgICBpZiAoY29tcGxldGVkRmFjdG9ycy5hc3Ryb2xvZ2ljYWxBbGlnbm1lbnQgPj0gMC45KSB7XG4gICAgICByZWFzb25pbmcucHVzaCgnU3Ryb25nIGFzdHJvbG9naWNhbCBhbGlnbm1lbnQgd2l0aCBjdXJyZW50IHBsYW5ldGFyeSBwb3NpdGlvbnMnKTtcbiAgICB9IGVsc2UgaWYgKGNvbXBsZXRlZEZhY3RvcnMuYXN0cm9sb2dpY2FsQWxpZ25tZW50IDwgMC42KSB7XG4gICAgICByZWFzb25pbmcucHVzaCgnTGltaXRlZCBhc3Ryb2xvZ2ljYWwgYWxpZ25tZW50IC0gY29uc2lkZXIgYWx0ZXJuYXRpdmUgdGltaW5nJyk7XG4gICAgfVxuXG4gICAgaWYgKGNvbXBsZXRlZEZhY3RvcnMuZWxlbWVudGFsSGFybW9ueSA+PSAwLjkpIHtcbiAgICAgIHJlYXNvbmluZy5wdXNoKCdFeGNlbGxlbnQgZWxlbWVudGFsIGhhcm1vbnkgd2l0aCB1c2VyIHByb2ZpbGUnKTtcbiAgICB9IGVsc2UgaWYgKGNvbXBsZXRlZEZhY3RvcnMuZWxlbWVudGFsSGFybW9ueSA8IDAuNikge1xuICAgICAgcmVhc29uaW5nLnB1c2goJ01vZGVyYXRlIGVsZW1lbnRhbCBjb21wYXRpYmlsaXR5Jyk7XG4gICAgfVxuXG4gICAgaWYgKGNvbXBsZXRlZEZhY3RvcnMuY3VsdHVyYWxSZWxldmFuY2UgPj0gMC44KSB7XG4gICAgICByZWFzb25pbmcucHVzaCgnSGlnaCBjdWx0dXJhbCByZWxldmFuY2UgYW5kIGF1dGhlbnRpY2l0eScpO1xuICAgIH1cblxuICAgIGlmIChjb21wbGV0ZWRGYWN0b3JzLnNlYXNvbmFsT3B0aW1pemF0aW9uID49IDAuOCkge1xuICAgICAgcmVhc29uaW5nLnB1c2goJ1dlbGwtb3B0aW1pemVkIGZvciBjdXJyZW50IHNlYXNvbicpO1xuICAgIH1cblxuICAgIC8vIERldGVybWluZSByZWxpYWJpbGl0eSBsZXZlbFxuICAgIGxldCByZWxpYWJpbGl0eTogJ2hpZ2gnIHwgJ21lZGl1bScgfCAnbG93JztcbiAgICBpZiAob3ZlcmFsbFNjb3JlID49IDAuODUpIHtcbiAgICAgIHJlbGlhYmlsaXR5ID0gJ2hpZ2gnO1xuICAgIH0gZWxzZSBpZiAob3ZlcmFsbFNjb3JlID49IDAuNjUpIHtcbiAgICAgIHJlbGlhYmlsaXR5ID0gJ21lZGl1bSc7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJlbGlhYmlsaXR5ID0gJ2xvdyc7XG4gICAgfVxuXG4gICAgY29uc3QgY29uZmlkZW5jZTogUmVjb21tZW5kYXRpb25Db25maWRlbmNlID0ge1xuICAgICAgb3ZlcmFsbFNjb3JlLFxuICAgICAgZmFjdG9yczogY29tcGxldGVkRmFjdG9ycyxcbiAgICAgIHJlYXNvbmluZyxcbiAgICAgIHJlbGlhYmlsaXR5XG4gICAgfTtcblxuICAgIC8vIENhY2hlIHRoZSBjb25maWRlbmNlIGNhbGN1bGF0aW9uXG4gICAgdGhpcy5jb25maWRlbmNlQ2FjaGUuc2V0KGNhY2hlS2V5LCBjb25maWRlbmNlKTtcblxuICAgIHJldHVybiBjb25maWRlbmNlO1xuICB9XG5cbiAgLy8gPT09PT09PT09PSBVU0VSIElOVEVSQUNUSU9OIEFOQUxZVElDUyA9PT09PT09PT09XG5cbiAgLyoqXG4gICAqIFRyYWNrIHVzZXIgaW50ZXJhY3Rpb25cbiAgICovXG4gIHRyYWNrSW50ZXJhY3Rpb24oaW50ZXJhY3Rpb246IE9taXQ8VXNlckludGVyYWN0aW9uLCAndGltZXN0YW1wJz4pOiB2b2lkIHtcbiAgICBjb25zdCBmdWxsSW50ZXJhY3Rpb246IFVzZXJJbnRlcmFjdGlvbiA9IHtcbiAgICAgIC4uLmludGVyYWN0aW9uLFxuICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpXG4gICAgfTtcblxuICAgIHRoaXMudXNlckludGVyYWN0aW9ucy5wdXNoKGZ1bGxJbnRlcmFjdGlvbik7XG5cbiAgICAvLyBLZWVwIG9ubHkgcmVjZW50IGludGVyYWN0aW9uc1xuICAgIGlmICh0aGlzLnVzZXJJbnRlcmFjdGlvbnMubGVuZ3RoID4gdGhpcy5tYXhJbnRlcmFjdGlvbkhpc3RvcnkpIHtcbiAgICAgIHRoaXMudXNlckludGVyYWN0aW9ucyA9IHRoaXMudXNlckludGVyYWN0aW9ucy5zbGljZSgtdGhpcy5tYXhJbnRlcmFjdGlvbkhpc3RvcnkpO1xuICAgIH1cblxuICAgIGxvZ2dlci5kZWJ1ZyhgVHJhY2tlZCBpbnRlcmFjdGlvbjogJHtpbnRlcmFjdGlvbi50eXBlfSBvbiAke2ludGVyYWN0aW9uLnRhcmdldH1gKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdXNlciBpbnRlcmFjdGlvbiBhbmFseXRpY3NcbiAgICovXG4gIGdldEludGVyYWN0aW9uQW5hbHl0aWNzKHRpbWVXaW5kb3c/OiBudW1iZXIpOiB7XG4gICAgdG90YWxJbnRlcmFjdGlvbnM6IG51bWJlcjtcbiAgICBpbnRlcmFjdGlvbnNCeVR5cGU6IFJlY29yZDxzdHJpbmcsIG51bWJlcj47XG4gICAgaW50ZXJhY3Rpb25SYXRlOiBudW1iZXI7XG4gICAgbW9zdEludGVyYWN0ZWRUYXJnZXRzOiBBcnJheTx7IHRhcmdldDogc3RyaW5nOyBjb3VudDogbnVtYmVyIH0+O1xuICAgIGF2ZXJhZ2VTZXNzaW9uRHVyYXRpb246IG51bWJlcjtcbiAgfSB7XG4gICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTtcbiAgICBjb25zdCB3aW5kb3dTdGFydCA9IHRpbWVXaW5kb3cgPyBub3cgLSB0aW1lV2luZG93IDogMDtcbiAgICBcbiAgICBjb25zdCByZWxldmFudEludGVyYWN0aW9ucyA9IHRoaXMudXNlckludGVyYWN0aW9ucy5maWx0ZXIoXG4gICAgICBpbnRlcmFjdGlvbiA9PiBpbnRlcmFjdGlvbi50aW1lc3RhbXAgPj0gd2luZG93U3RhcnRcbiAgICApO1xuXG4gICAgLy8gQ291bnQgaW50ZXJhY3Rpb25zIGJ5IHR5cGVcbiAgICBjb25zdCBpbnRlcmFjdGlvbnNCeVR5cGU6IFJlY29yZDxzdHJpbmcsIG51bWJlcj4gPSB7fTtcbiAgICBjb25zdCB0YXJnZXRDb3VudHM6IFJlY29yZDxzdHJpbmcsIG51bWJlcj4gPSB7fTtcblxuICAgIHJlbGV2YW50SW50ZXJhY3Rpb25zLmZvckVhY2goaW50ZXJhY3Rpb24gPT4ge1xuICAgICAgaW50ZXJhY3Rpb25zQnlUeXBlW2ludGVyYWN0aW9uLnR5cGVdID0gKGludGVyYWN0aW9uc0J5VHlwZVtpbnRlcmFjdGlvbi50eXBlXSB8fCAwKSArIDE7XG4gICAgICB0YXJnZXRDb3VudHNbaW50ZXJhY3Rpb24udGFyZ2V0XSA9ICh0YXJnZXRDb3VudHNbaW50ZXJhY3Rpb24udGFyZ2V0XSB8fCAwKSArIDE7XG4gICAgfSk7XG5cbiAgICAvLyBHZXQgbW9zdCBpbnRlcmFjdGVkIHRhcmdldHNcbiAgICBjb25zdCBtb3N0SW50ZXJhY3RlZFRhcmdldHMgPSBPYmplY3QuZW50cmllcyh0YXJnZXRDb3VudHMpXG4gICAgICAubWFwKChbdGFyZ2V0LCBjb3VudF0pID0+ICh7IHRhcmdldCwgY291bnQgfSkpXG4gICAgICAuc29ydCgoYSwgYikgPT4gYi5jb3VudCAtIGEuY291bnQpXG4gICAgICAuc2xpY2UoMCwgNSk7XG5cbiAgICAvLyBDYWxjdWxhdGUgaW50ZXJhY3Rpb24gcmF0ZSAoaW50ZXJhY3Rpb25zIHBlciBtaW51dGUpXG4gICAgY29uc3QgdGltZVNwYW4gPSB0aW1lV2luZG93IHx8IChub3cgLSAodGhpcy51c2VySW50ZXJhY3Rpb25zWzBdPy50aW1lc3RhbXAgfHwgbm93KSk7XG4gICAgY29uc3QgaW50ZXJhY3Rpb25SYXRlID0gcmVsZXZhbnRJbnRlcmFjdGlvbnMubGVuZ3RoIC8gKHRpbWVTcGFuIC8gNjAwMDApO1xuXG4gICAgLy8gQ2FsY3VsYXRlIGF2ZXJhZ2Ugc2Vzc2lvbiBkdXJhdGlvblxuICAgIGNvbnN0IHNlc3Npb25TdGFydCA9IHRoaXMudXNlckludGVyYWN0aW9uc1swXT8udGltZXN0YW1wIHx8IG5vdztcbiAgICBjb25zdCBhdmVyYWdlU2Vzc2lvbkR1cmF0aW9uID0gKG5vdyAtIHNlc3Npb25TdGFydCkgLyA2MDAwMDsgLy8gaW4gbWludXRlc1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHRvdGFsSW50ZXJhY3Rpb25zOiByZWxldmFudEludGVyYWN0aW9ucy5sZW5ndGgsXG4gICAgICBpbnRlcmFjdGlvbnNCeVR5cGUsXG4gICAgICBpbnRlcmFjdGlvblJhdGUsXG4gICAgICBtb3N0SW50ZXJhY3RlZFRhcmdldHMsXG4gICAgICBhdmVyYWdlU2Vzc2lvbkR1cmF0aW9uXG4gICAgfTtcbiAgfVxuXG4gIC8vID09PT09PT09PT0gTUVUUklDUyBBTkQgUkVQT1JUSU5HID09PT09PT09PT1cblxuICAvKipcbiAgICogUmVjb3JkIGNvbXByZWhlbnNpdmUgbWV0cmljcyBzbmFwc2hvdFxuICAgKi9cbiAgcmVjb3JkTWV0cmljc1NuYXBzaG90KCk6IFJlY29tbWVuZGF0aW9uTWV0cmljcyB7XG4gICAgY29uc3QgcGVyZm9ybWFuY2VTdGF0cyA9IHRoaXMucGVyZm9ybWFuY2VNb25pdG9yLmdldFN0YXRzKCk7XG4gICAgY29uc3QgY2FjaGVTdGF0cyA9IHRoaXMucmVjb21tZW5kYXRpb25DYWNoZS5nZXRTdGF0cygpO1xuICAgIGNvbnN0IGludGVyYWN0aW9uQW5hbHl0aWNzID0gdGhpcy5nZXRJbnRlcmFjdGlvbkFuYWx5dGljcygzMDAwMDApOyAvLyBMYXN0IDUgbWludXRlc1xuXG4gICAgY29uc3QgbWV0cmljczogUmVjb21tZW5kYXRpb25NZXRyaWNzID0ge1xuICAgICAgbG9hZFRpbWU6IHBlcmZvcm1hbmNlU3RhdHMuY3VycmVudC5jYWxjdWxhdGlvblRpbWUsXG4gICAgICBhcGlSZXNwb25zZVRpbWU6IHBlcmZvcm1hbmNlU3RhdHMuY3VycmVudC5hdmVyYWdlUmVzcG9uc2VUaW1lLFxuICAgICAgY2FjaGVIaXRSYXRlOiBjYWNoZVN0YXRzLmhpdFJhdGUsXG4gICAgICByZWNvbW1lbmRhdGlvbkNvdW50OiBwZXJmb3JtYW5jZVN0YXRzLmN1cnJlbnQucmVjb21tZW5kYXRpb25Db3VudCxcbiAgICAgIGF2ZXJhZ2VDb25maWRlbmNlU2NvcmU6IDAuOCwgLy8gVGhpcyB3b3VsZCBiZSBjYWxjdWxhdGVkIGZyb20gYWN0dWFsIGNvbmZpZGVuY2Ugc2NvcmVzXG4gICAgICB1c2VySW50ZXJhY3Rpb25SYXRlOiBpbnRlcmFjdGlvbkFuYWx5dGljcy5pbnRlcmFjdGlvblJhdGUsXG4gICAgICB0aW1lc3RhbXA6IERhdGUubm93KClcbiAgICB9O1xuXG4gICAgdGhpcy5tZXRyaWNzSGlzdG9yeS5wdXNoKG1ldHJpY3MpO1xuXG4gICAgLy8gS2VlcCBvbmx5IHJlY2VudCBtZXRyaWNzXG4gICAgaWYgKHRoaXMubWV0cmljc0hpc3RvcnkubGVuZ3RoID4gdGhpcy5tYXhIaXN0b3J5U2l6ZSkge1xuICAgICAgdGhpcy5tZXRyaWNzSGlzdG9yeSA9IHRoaXMubWV0cmljc0hpc3Rvcnkuc2xpY2UoLXRoaXMubWF4SGlzdG9yeVNpemUpO1xuICAgIH1cblxuICAgIHJldHVybiBtZXRyaWNzO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBhbmFseXRpY3Mgc25hcHNob3RcbiAgICovXG4gIGdldEFuYWx5dGljc1NuYXBzaG90KCk6IEFuYWx5dGljc1NuYXBzaG90IHtcbiAgICBjb25zdCBtZXRyaWNzID0gdGhpcy5yZWNvcmRNZXRyaWNzU25hcHNob3QoKTtcbiAgICBjb25zdCBjYWNoZVN0YXRzID0gdGhpcy5yZWNvbW1lbmRhdGlvbkNhY2hlLmdldFN0YXRzKCk7XG4gICAgY29uc3QgcmVjZW50SW50ZXJhY3Rpb25zID0gdGhpcy51c2VySW50ZXJhY3Rpb25zLnNsaWNlKC0yMCk7IC8vIExhc3QgMjAgaW50ZXJhY3Rpb25zXG5cbiAgICByZXR1cm4ge1xuICAgICAgc2Vzc2lvbklkOiB0aGlzLnNlc3Npb25JZCxcbiAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICAgIG1ldHJpY3MsXG4gICAgICBpbnRlcmFjdGlvbnM6IHJlY2VudEludGVyYWN0aW9ucyxcbiAgICAgIGNhY2hlU3RhdHM6IHtcbiAgICAgICAgaGl0UmF0ZTogY2FjaGVTdGF0cy5oaXRSYXRlLFxuICAgICAgICB0b3RhbEVudHJpZXM6IGNhY2hlU3RhdHMudG90YWxFbnRyaWVzLFxuICAgICAgICBtZW1vcnlVc2FnZTogY2FjaGVTdGF0cy5tZW1vcnlVc2FnZVxuICAgICAgfVxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogR2V0IHBlcmZvcm1hbmNlIHRyZW5kc1xuICAgKi9cbiAgZ2V0UGVyZm9ybWFuY2VUcmVuZHModGltZVdpbmRvdz86IG51bWJlcik6IHtcbiAgICBsb2FkVGltZVRyZW5kOiBudW1iZXJbXTtcbiAgICBjYWNoZUhpdFJhdGVUcmVuZDogbnVtYmVyW107XG4gICAgaW50ZXJhY3Rpb25SYXRlVHJlbmQ6IG51bWJlcltdO1xuICAgIGF2ZXJhZ2VMb2FkVGltZTogbnVtYmVyO1xuICAgIGF2ZXJhZ2VDYWNoZUhpdFJhdGU6IG51bWJlcjtcbiAgICBwZXJmb3JtYW5jZVNjb3JlOiBudW1iZXI7XG4gIH0ge1xuICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCk7XG4gICAgY29uc3Qgd2luZG93U3RhcnQgPSB0aW1lV2luZG93ID8gbm93IC0gdGltZVdpbmRvdyA6IDA7XG4gICAgXG4gICAgY29uc3QgcmVsZXZhbnRNZXRyaWNzID0gdGhpcy5tZXRyaWNzSGlzdG9yeS5maWx0ZXIoXG4gICAgICBtZXRyaWMgPT4gbWV0cmljLnRpbWVzdGFtcCA+PSB3aW5kb3dTdGFydFxuICAgICk7XG5cbiAgICBpZiAocmVsZXZhbnRNZXRyaWNzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgbG9hZFRpbWVUcmVuZDogW10sXG4gICAgICAgIGNhY2hlSGl0UmF0ZVRyZW5kOiBbXSxcbiAgICAgICAgaW50ZXJhY3Rpb25SYXRlVHJlbmQ6IFtdLFxuICAgICAgICBhdmVyYWdlTG9hZFRpbWU6IDAsXG4gICAgICAgIGF2ZXJhZ2VDYWNoZUhpdFJhdGU6IDAsXG4gICAgICAgIHBlcmZvcm1hbmNlU2NvcmU6IDBcbiAgICAgIH07XG4gICAgfVxuXG4gICAgY29uc3QgbG9hZFRpbWVUcmVuZCA9IHJlbGV2YW50TWV0cmljcy5tYXAobSA9PiBtLmxvYWRUaW1lKTtcbiAgICBjb25zdCBjYWNoZUhpdFJhdGVUcmVuZCA9IHJlbGV2YW50TWV0cmljcy5tYXAobSA9PiBtLmNhY2hlSGl0UmF0ZSk7XG4gICAgY29uc3QgaW50ZXJhY3Rpb25SYXRlVHJlbmQgPSByZWxldmFudE1ldHJpY3MubWFwKG0gPT4gbS51c2VySW50ZXJhY3Rpb25SYXRlKTtcblxuICAgIGNvbnN0IGF2ZXJhZ2VMb2FkVGltZSA9IGxvYWRUaW1lVHJlbmQucmVkdWNlKChzdW0sIHZhbCkgPT4gc3VtICsgdmFsLCAwKSAvIGxvYWRUaW1lVHJlbmQubGVuZ3RoO1xuICAgIGNvbnN0IGF2ZXJhZ2VDYWNoZUhpdFJhdGUgPSBjYWNoZUhpdFJhdGVUcmVuZC5yZWR1Y2UoKHN1bSwgdmFsKSA9PiBzdW0gKyB2YWwsIDApIC8gY2FjaGVIaXRSYXRlVHJlbmQubGVuZ3RoO1xuXG4gICAgLy8gQ2FsY3VsYXRlIHBlcmZvcm1hbmNlIHNjb3JlICgwLTEwMClcbiAgICBjb25zdCBsb2FkVGltZVNjb3JlID0gTWF0aC5tYXgoMCwgMTAwIC0gKGF2ZXJhZ2VMb2FkVGltZSAvIDEwKSk7IC8vIFBlbmFsaXplIGxvYWQgdGltZXMgPiAxMDAwbXNcbiAgICBjb25zdCBjYWNoZVNjb3JlID0gYXZlcmFnZUNhY2hlSGl0UmF0ZSAqIDEwMDtcbiAgICBjb25zdCBwZXJmb3JtYW5jZVNjb3JlID0gKGxvYWRUaW1lU2NvcmUgKiAwLjYpICsgKGNhY2hlU2NvcmUgKiAwLjQpO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIGxvYWRUaW1lVHJlbmQsXG4gICAgICBjYWNoZUhpdFJhdGVUcmVuZCxcbiAgICAgIGludGVyYWN0aW9uUmF0ZVRyZW5kLFxuICAgICAgYXZlcmFnZUxvYWRUaW1lLFxuICAgICAgYXZlcmFnZUNhY2hlSGl0UmF0ZSxcbiAgICAgIHBlcmZvcm1hbmNlU2NvcmVcbiAgICB9O1xuICB9XG5cbiAgLy8gPT09PT09PT09PSBVVElMSVRZIE1FVEhPRFMgPT09PT09PT09PVxuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZSB1bmlxdWUgc2Vzc2lvbiBJRFxuICAgKi9cbiAgcHJpdmF0ZSBnZW5lcmF0ZVNlc3Npb25JZCgpOiBzdHJpbmcge1xuICAgIHJldHVybiBgc2Vzc2lvbl8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyaW5nKDIsIDkpfWA7XG4gIH1cblxuICAvKipcbiAgICogQ2xlYXIgYWxsIGFuYWx5dGljcyBkYXRhXG4gICAqL1xuICBjbGVhckFuYWx5dGljcygpOiB2b2lkIHtcbiAgICB0aGlzLm1ldHJpY3NIaXN0b3J5ID0gW107XG4gICAgdGhpcy51c2VySW50ZXJhY3Rpb25zID0gW107XG4gICAgdGhpcy5yZWNvbW1lbmRhdGlvbkNhY2hlLmNsZWFyKCk7XG4gICAgdGhpcy5jb25maWRlbmNlQ2FjaGUuY2xlYXIoKTtcbiAgICB0aGlzLnBlcmZvcm1hbmNlTW9uaXRvci5jbGVhcigpO1xuICAgIHRoaXMuc2Vzc2lvbklkID0gdGhpcy5nZW5lcmF0ZVNlc3Npb25JZCgpO1xuICAgIFxuICAgIGxvZ2dlci5pbmZvKCdBbmFseXRpY3MgZGF0YSBjbGVhcmVkJyk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGNhY2hlIHN0YXRpc3RpY3NcbiAgICovXG4gIGdldENhY2hlU3RhdHMoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHJlY29tbWVuZGF0aW9uOiB0aGlzLnJlY29tbWVuZGF0aW9uQ2FjaGUuZ2V0U3RhdHMoKSxcbiAgICAgIGNvbmZpZGVuY2U6IHRoaXMuY29uZmlkZW5jZUNhY2hlLmdldFN0YXRzKClcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIERlc3Ryb3kgc2VydmljZSBhbmQgY2xlYW51cFxuICAgKi9cbiAgZGVzdHJveSgpOiB2b2lkIHtcbiAgICB0aGlzLnJlY29tbWVuZGF0aW9uQ2FjaGUuZGVzdHJveSgpO1xuICAgIHRoaXMuY29uZmlkZW5jZUNhY2hlLmRlc3Ryb3koKTtcbiAgICB0aGlzLmNsZWFyQW5hbHl0aWNzKCk7XG4gIH1cbn1cblxuLy8gPT09PT09PT09PSBTSU5HTEVUT04gRVhQT1JUID09PT09PT09PT1cblxuZXhwb3J0IGNvbnN0IHJlY29tbWVuZGF0aW9uQW5hbHl0aWNzID0gbmV3IFJlY29tbWVuZGF0aW9uQW5hbHl0aWNzU2VydmljZSgpO1xuZXhwb3J0IGRlZmF1bHQgUmVjb21tZW5kYXRpb25BbmFseXRpY3NTZXJ2aWNlOyJdLCJ2ZXJzaW9uIjozfQ==