49f2632f5fe6c6ff885ad3bd0952654c
"use strict";
/**
 * Automated Quality Assurance Integration
 *
 * This module implements automated quality assurance with agent hooks for:
 * - Automatic planetary data validation
 * - Ingredient consistency checking for elemental properties
 * - TypeScript campaign triggers for error threshold management
 * - Build quality monitoring for performance tracking
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.useAutomatedQualityAssurance = exports.getAutomatedQualityAssurance = exports.AutomatedQualityAssurance = exports.QA_THRESHOLDS = void 0;
const logger_1 = require("@/utils/logger");
const reliableAstronomy_1 = require("@/utils/reliableAstronomy");
const steeringFileIntelligence_1 = require("@/utils/steeringFileIntelligence");
// Quality assurance thresholds from campaign-integration.md
exports.QA_THRESHOLDS = {
    typescript: {
        criticalThreshold: 100,
        warningThreshold: 500,
        target: 0,
    },
    linting: {
        criticalThreshold: 1000,
        warningThreshold: 2000,
        target: 0,
    },
    performance: {
        renderTime: 16,
        memoryUsage: 50,
        bundleSize: 250,
        apiResponseTime: 2000, // 2 seconds
    },
    planetaryData: {
        positionAccuracy: 0.1,
        cacheValidityHours: 6,
        fallbackThresholdMs: 5000,
    },
};
/**
 * Automated Quality Assurance System
 */
class AutomatedQualityAssurance {
    constructor(config) {
        this.lastValidation = 0;
        this.validationInterval = null;
        this.campaignTriggers = [];
        this.config = {
            enableAutomaticValidation: true,
            enableCampaignTriggers: true,
            enablePerformanceMonitoring: true,
            enablePlanetaryDataValidation: true,
            enableIngredientConsistencyChecking: true,
            thresholds: exports.QA_THRESHOLDS,
            ...config,
        };
        this.metrics = this.initializeMetrics();
        this.startAutomaticValidation();
    }
    static getInstance(config) {
        if (!AutomatedQualityAssurance.instance) {
            AutomatedQualityAssurance.instance = new AutomatedQualityAssurance(config);
        }
        return AutomatedQualityAssurance.instance;
    }
    /**
     * Agent hook for automatic planetary data validation
     */
    async validatePlanetaryData(date = new Date()) {
        if (!this.config.enablePlanetaryDataValidation) {
            return this.createValidationResult(true, 1.0, [], []);
        }
        try {
            const startTime = performance.now();
            const positions = await (0, reliableAstronomy_1.getReliablePlanetaryPositions)(date);
            const responseTime = performance.now() - startTime;
            const issues = [];
            const recommendations = [];
            let score = 1.0;
            // Validate response time
            if (responseTime > this.config.thresholds.planetaryData.fallbackThresholdMs) {
                issues.push(`Planetary data fetch time (${responseTime.toFixed(0)}ms) exceeds threshold`);
                recommendations.push('Consider implementing more aggressive caching');
                score -= 0.2;
            }
            // Validate data completeness
            const requiredPlanets = [
                'sun',
                'moon',
                'mercury',
                'venus',
                'mars',
                'jupiter',
                'saturn',
            ];
            const missingPlanets = requiredPlanets.filter(planet => !positions[planet]);
            if (missingPlanets.length > 0) {
                issues.push(`Missing planetary data for: ${missingPlanets.join(', ')}`);
                recommendations.push('Verify API connectivity and fallback mechanisms');
                score -= 0.1 * missingPlanets.length;
            }
            // Validate position accuracy (check for reasonable longitude values)
            Object.entries(positions).forEach(([planet, data]) => {
                if ((data === null || data === void 0 ? void 0 : data.exactLongitude) !== undefined) {
                    if (data.exactLongitude < 0 || data.exactLongitude >= 360) {
                        issues.push(`Invalid longitude for ${planet}: ${data.exactLongitude}`);
                        score -= 0.1;
                    }
                }
            });
            // Update metrics
            this.metrics.planetaryDataQuality = {
                accuracy: Math.max(0, score),
                freshness: this.calculateDataFreshness(positions),
                reliability: issues.length === 0 ? 1.0 : Math.max(0, 1.0 - issues.length * 0.1),
            };
            // Check for campaign triggers
            this.checkCampaignTriggers('planetary', score);
            logger_1.logger.debug('Planetary data validation completed', {
                score,
                issues: issues.length,
            });
            return this.createValidationResult(score >= 0.8, score, issues, recommendations);
        }
        catch (error) {
            logger_1.logger.error('Error validating planetary data:', error);
            return this.createValidationResult(false, 0, ['Planetary data validation failed'], ['Check API connectivity and error handling']);
        }
    }
    /**
     * Agent hook for ingredient consistency checking
     */
    validateIngredientConsistency(ingredients) {
        if (!this.config.enableIngredientConsistencyChecking) {
            return this.createValidationResult(true, 1.0, [], []);
        }
        const intelligence = (0, steeringFileIntelligence_1.getSteeringFileIntelligence)();
        const issues = [];
        const recommendations = [];
        let totalScore = 0;
        let validatedCount = 0;
        ingredients.forEach((ingredient, index) => {
            // Validate elemental properties structure
            const isValidStructure = intelligence.validateElementalProperties(ingredient.elementalProperties);
            if (!isValidStructure) {
                issues.push(`Invalid elemental properties for ingredient: ${ingredient.name}`);
                recommendations.push(`Fix elemental properties for ${ingredient.name} to meet minimum standards`);
            }
            else {
                validatedCount++;
                // Calculate elemental consistency score
                const elementalSum = Object.values(ingredient.elementalProperties).reduce((sum, val) => sum + val, 0);
                const consistencyScore = elementalSum > 0 ? Math.min(1.0, elementalSum / 1.0) : 0;
                totalScore += consistencyScore;
                // Check for elemental balance (no single element should dominate too much)
                const maxElement = Math.max(...Object.values(ingredient.elementalProperties));
                if (maxElement > 0.8) {
                    recommendations.push(`Consider balancing elemental properties for ${ingredient.name} (max: ${maxElement.toFixed(2)})`);
                }
            }
            // Validate compatibility with other ingredients
            if (index > 0) {
                const prevIngredient = ingredients[index - 1];
                const compatibility = intelligence.calculateCompatibility(ingredient.elementalProperties, prevIngredient.elementalProperties);
                if (compatibility < 0.7) {
                    issues.push(`Low compatibility between ${ingredient.name} and ${prevIngredient.name}: ${compatibility.toFixed(2)}`);
                    recommendations.push('Consider adjusting elemental properties to improve compatibility');
                }
            }
        });
        const averageScore = validatedCount > 0 ? totalScore / validatedCount : 0;
        // Update metrics
        this.metrics.ingredientConsistency = {
            elementalValidation: averageScore,
            compatibilityScores: issues.filter(issue => issue.includes('compatibility')).length === 0
                ? 1.0
                : 0.7,
            culturalSensitivity: this.validateCulturalSensitivity(ingredients.map(i => i.name)),
        };
        // Check for campaign triggers
        this.checkCampaignTriggers('ingredient', averageScore);
        logger_1.logger.debug('Ingredient consistency validation completed', {
            score: averageScore,
            issues: issues.length,
            validatedCount,
        });
        return this.createValidationResult(averageScore >= 0.8, averageScore, issues, recommendations);
    }
    /**
     * TypeScript campaign trigger for error threshold management
     */
    async checkTypeScriptErrorThreshold() {
        if (!this.config.enableCampaignTriggers) {
            return null;
        }
        try {
            // Simulate TypeScript error count check (in real implementation, this would run tsc)
            const errorCount = await this.getTypeScriptErrorCount();
            this.metrics.typeScriptErrors = errorCount;
            const trigger = {
                type: 'typescript',
                threshold: this.config.thresholds.typescript.criticalThreshold,
                currentValue: errorCount,
                action: this.determineAction('typescript', errorCount),
                triggered: errorCount > this.config.thresholds.typescript.criticalThreshold,
                timestamp: Date.now(),
            };
            if (trigger.triggered) {
                logger_1.logger.warn(`TypeScript error threshold exceeded: ${errorCount} > ${trigger.threshold}`);
                this.campaignTriggers.push(trigger);
                // In a real implementation, this would trigger the campaign system
                this.triggerCampaign('typescript-error-elimination', {
                    errorCount,
                    threshold: trigger.threshold,
                    action: trigger.action,
                });
            }
            return trigger;
        }
        catch (error) {
            logger_1.logger.error('Error checking TypeScript error threshold:', error);
            return null;
        }
    }
    /**
     * Build quality monitoring for performance tracking
     */
    monitorBuildQuality(buildMetrics) {
        if (!this.config.enablePerformanceMonitoring) {
            return this.createValidationResult(true, 1.0, [], []);
        }
        const issues = [];
        const recommendations = [];
        let score = 1.0;
        // Check build time
        if (buildMetrics.buildTime && buildMetrics.buildTime > 30000) {
            // 30 seconds
            issues.push(`Build time (${buildMetrics.buildTime}ms) exceeds recommended threshold`);
            recommendations.push('Consider optimizing build configuration and dependencies');
            score -= 0.2;
        }
        // Check bundle size
        if (buildMetrics.bundleSize &&
            buildMetrics.bundleSize >
                this.config.thresholds.performance.bundleSize * 1024) {
            issues.push(`Bundle size (${Math.round(buildMetrics.bundleSize / 1024)}KB) exceeds threshold`);
            recommendations.push('Implement code splitting and tree shaking optimizations');
            score -= 0.2;
        }
        // Check memory usage
        if (buildMetrics.memoryUsage &&
            buildMetrics.memoryUsage > this.config.thresholds.performance.memoryUsage) {
            issues.push(`Memory usage (${buildMetrics.memoryUsage}MB) exceeds threshold`);
            recommendations.push('Optimize memory usage and check for memory leaks');
            score -= 0.2;
        }
        // Check error count
        if (buildMetrics.errorCount && buildMetrics.errorCount > 0) {
            issues.push(`Build contains ${buildMetrics.errorCount} errors`);
            recommendations.push('Fix all build errors before deployment');
            score -= 0.3;
        }
        // Update performance metrics
        this.metrics.performanceMetrics = {
            renderTime: 0,
            memoryUsage: buildMetrics.memoryUsage || 0,
            bundleSize: buildMetrics.bundleSize || 0,
            apiResponseTime: 0, // Will be updated by API monitoring
        };
        // Check for campaign triggers
        this.checkCampaignTriggers('performance', score);
        logger_1.logger.debug('Build quality monitoring completed', {
            score,
            issues: issues.length,
        });
        return this.createValidationResult(score >= 0.8, score, issues, recommendations);
    }
    /**
     * Get current quality metrics
     */
    getQualityMetrics() {
        return { ...this.metrics };
    }
    /**
     * Get active campaign triggers
     */
    getActiveCampaignTriggers() {
        return this.campaignTriggers.filter(trigger => Date.now() - trigger.timestamp < 24 * 60 * 60 * 1000 // Last 24 hours
        );
    }
    /**
     * Update configuration
     */
    updateConfig(newConfig) {
        this.config = { ...this.config, ...newConfig };
        logger_1.logger.debug('Quality assurance configuration updated', newConfig);
    }
    /**
     * Stop automatic validation
     */
    stop() {
        if (this.validationInterval) {
            clearInterval(this.validationInterval);
            this.validationInterval = null;
        }
    }
    // Private helper methods
    initializeMetrics() {
        return {
            typeScriptErrors: 0,
            lintingWarnings: 0,
            performanceMetrics: {
                renderTime: 0,
                memoryUsage: 0,
                bundleSize: 0,
                apiResponseTime: 0,
            },
            planetaryDataQuality: {
                accuracy: 1.0,
                freshness: 1.0,
                reliability: 1.0,
            },
            ingredientConsistency: {
                elementalValidation: 1.0,
                compatibilityScores: 1.0,
                culturalSensitivity: 1.0,
            },
        };
    }
    startAutomaticValidation() {
        if (!this.config.enableAutomaticValidation) {
            return;
        }
        // Run validation every 5 minutes
        this.validationInterval = setInterval(async () => {
            try {
                await this.validatePlanetaryData();
                await this.checkTypeScriptErrorThreshold();
                logger_1.logger.debug('Automatic quality validation completed');
            }
            catch (error) {
                logger_1.logger.error('Error in automatic validation:', error);
            }
        }, 5 * 60 * 1000);
        logger_1.logger.debug('Automatic quality validation started');
    }
    createValidationResult(isValid, score, issues, recommendations) {
        return {
            isValid,
            score: Math.max(0, Math.min(1, score)),
            issues,
            recommendations,
            timestamp: Date.now(),
        };
    }
    calculateDataFreshness(positions) {
        // In a real implementation, this would check the timestamp of the data
        // For now, return 1.0 (fresh) as a placeholder
        return 1.0;
    }
    validateCulturalSensitivity(ingredientNames) {
        // Check for potentially insensitive terms
        const sensitiveTerms = ['exotic', 'ethnic', 'primitive', 'weird'];
        const issues = ingredientNames.filter(name => sensitiveTerms.some(term => name.toLowerCase().includes(term)));
        return issues.length === 0 ? 1.0 : Math.max(0, 1.0 - issues.length * 0.2);
    }
    checkCampaignTriggers(type, value) {
        if (!this.config.enableCampaignTriggers) {
            return;
        }
        const thresholds = this.getThresholdsForType(type);
        if (!thresholds)
            return;
        const trigger = {
            type,
            threshold: thresholds.critical,
            currentValue: value,
            action: this.determineAction(type, value),
            triggered: value < thresholds.critical,
            timestamp: Date.now(),
        };
        if (trigger.triggered) {
            this.campaignTriggers.push(trigger);
            logger_1.logger.warn(`Campaign trigger activated for ${type}:`, trigger);
        }
    }
    getThresholdsForType(type) {
        switch (type) {
            case 'typescript':
                return {
                    critical: this.config.thresholds.typescript.criticalThreshold,
                    warning: this.config.thresholds.typescript.warningThreshold,
                };
            case 'linting':
                return {
                    critical: this.config.thresholds.linting.criticalThreshold,
                    warning: this.config.thresholds.linting.warningThreshold,
                };
            case 'performance':
            case 'planetary':
            case 'ingredient':
                return { critical: 0.8, warning: 0.9 }; // Score-based thresholds
            default:
                return null;
        }
    }
    determineAction(type, value) {
        const thresholds = this.getThresholdsForType(type);
        if (!thresholds)
            return 'monitor';
        if (type === 'typescript' || type === 'linting') {
            // For error counts, higher values are worse
            if (value > thresholds.critical)
                return 'emergency';
            if (value > thresholds.warning)
                return 'campaign';
            return 'monitor';
        }
        else {
            // For scores, lower values are worse
            if (value < 0.7)
                return 'emergency';
            if (value < thresholds.critical)
                return 'campaign';
            if (value < thresholds.warning)
                return 'warn';
            return 'monitor';
        }
    }
    async getTypeScriptErrorCount() {
        // In a real implementation, this would run: yarn tsc --noEmit --skipLibCheck 2>&1 | grep -c "error TS"
        // For now, return a simulated count
        return Math.floor(Math.random() * 50); // Simulate 0-50 errors
    }
    triggerCampaign(campaignType, context) {
        // In a real implementation, this would integrate with the campaign system
        logger_1.logger.info(`Campaign triggered: ${campaignType}`, context);
        // Simulate campaign system integration
        if (typeof window !== 'undefined') {
            // Dispatch custom event for campaign system integration
            window.dispatchEvent(new CustomEvent('kiro-campaign-trigger', {
                detail: { campaignType, context },
            }));
        }
    }
}
exports.AutomatedQualityAssurance = AutomatedQualityAssurance;
/**
 * Convenience function to get quality assurance instance
 */
function getAutomatedQualityAssurance(config) {
    return AutomatedQualityAssurance.getInstance(config);
}
exports.getAutomatedQualityAssurance = getAutomatedQualityAssurance;
/**
 * Hook for components to use automated quality assurance
 */
function useAutomatedQualityAssurance() {
    const qa = getAutomatedQualityAssurance();
    return {
        validatePlanetaryData: (date) => qa.validatePlanetaryData(date),
        validateIngredientConsistency: (ingredients) => qa.validateIngredientConsistency(ingredients),
        checkTypeScriptErrorThreshold: () => qa.checkTypeScriptErrorThreshold(),
        monitorBuildQuality: (metrics) => qa.monitorBuildQuality(metrics),
        getQualityMetrics: () => qa.getQualityMetrics(),
        getActiveCampaignTriggers: () => qa.getActiveCampaignTriggers(),
        updateConfig: (config) => qa.updateConfig(config),
    };
}
exports.useAutomatedQualityAssurance = useAutomatedQualityAssurance;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy91dGlscy9hdXRvbWF0ZWRRdWFsaXR5QXNzdXJhbmNlLnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7Ozs7R0FRRzs7O0FBRUgsMkNBQXdDO0FBQ3hDLGlFQUEwRTtBQUMxRSwrRUFHMEM7QUFFMUMsNERBQTREO0FBQy9DLFFBQUEsYUFBYSxHQUFHO0lBQzNCLFVBQVUsRUFBRTtRQUNWLGlCQUFpQixFQUFFLEdBQUc7UUFDdEIsZ0JBQWdCLEVBQUUsR0FBRztRQUNyQixNQUFNLEVBQUUsQ0FBQztLQUNWO0lBQ0QsT0FBTyxFQUFFO1FBQ1AsaUJBQWlCLEVBQUUsSUFBSTtRQUN2QixnQkFBZ0IsRUFBRSxJQUFJO1FBQ3RCLE1BQU0sRUFBRSxDQUFDO0tBQ1Y7SUFDRCxXQUFXLEVBQUU7UUFDWCxVQUFVLEVBQUUsRUFBRTtRQUNkLFdBQVcsRUFBRSxFQUFFO1FBQ2YsVUFBVSxFQUFFLEdBQUc7UUFDZixlQUFlLEVBQUUsSUFBSSxFQUFFLFlBQVk7S0FDcEM7SUFDRCxhQUFhLEVBQUU7UUFDYixnQkFBZ0IsRUFBRSxHQUFHO1FBQ3JCLGtCQUFrQixFQUFFLENBQUM7UUFDckIsbUJBQW1CLEVBQUUsSUFBSTtLQUMxQjtDQUNPLENBQUM7QUFpRFg7O0dBRUc7QUFDSCxNQUFhLHlCQUF5QjtJQVFwQyxZQUFvQixNQUF3QztRQUpwRCxtQkFBYyxHQUFXLENBQUMsQ0FBQztRQUMzQix1QkFBa0IsR0FBMEIsSUFBSSxDQUFDO1FBQ2pELHFCQUFnQixHQUFzQixFQUFFLENBQUM7UUFHL0MsSUFBSSxDQUFDLE1BQU0sR0FBRztZQUNaLHlCQUF5QixFQUFFLElBQUk7WUFDL0Isc0JBQXNCLEVBQUUsSUFBSTtZQUM1QiwyQkFBMkIsRUFBRSxJQUFJO1lBQ2pDLDZCQUE2QixFQUFFLElBQUk7WUFDbkMsbUNBQW1DLEVBQUUsSUFBSTtZQUN6QyxVQUFVLEVBQUUscUJBQWE7WUFDekIsR0FBRyxNQUFNO1NBQ1YsQ0FBQztRQUVG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S0FDMUIsQ0FBQztBQUNKLENBQUM7QUFuQkQsb0VBbUJDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9HcmVnQ2FzdHJvL0Rlc2t0b3AvV2hhdFRvRWF0TmV4dC9zcmMvdXRpbHMvYXV0b21hdGVkUXVhbGl0eUFzc3VyYW5jZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEF1dG9tYXRlZCBRdWFsaXR5IEFzc3VyYW5jZSBJbnRlZ3JhdGlvblxuICpcbiAqIFRoaXMgbW9kdWxlIGltcGxlbWVudHMgYXV0b21hdGVkIHF1YWxpdHkgYXNzdXJhbmNlIHdpdGggYWdlbnQgaG9va3MgZm9yOlxuICogLSBBdXRvbWF0aWMgcGxhbmV0YXJ5IGRhdGEgdmFsaWRhdGlvblxuICogLSBJbmdyZWRpZW50IGNvbnNpc3RlbmN5IGNoZWNraW5nIGZvciBlbGVtZW50YWwgcHJvcGVydGllc1xuICogLSBUeXBlU2NyaXB0IGNhbXBhaWduIHRyaWdnZXJzIGZvciBlcnJvciB0aHJlc2hvbGQgbWFuYWdlbWVudFxuICogLSBCdWlsZCBxdWFsaXR5IG1vbml0b3JpbmcgZm9yIHBlcmZvcm1hbmNlIHRyYWNraW5nXG4gKi9cblxuaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSAnQC91dGlscy9sb2dnZXInO1xuaW1wb3J0IHsgZ2V0UmVsaWFibGVQbGFuZXRhcnlQb3NpdGlvbnMgfSBmcm9tICdAL3V0aWxzL3JlbGlhYmxlQXN0cm9ub215JztcbmltcG9ydCB7XG4gIEVsZW1lbnRhbFByb3BlcnRpZXMsXG4gIGdldFN0ZWVyaW5nRmlsZUludGVsbGlnZW5jZSxcbn0gZnJvbSAnQC91dGlscy9zdGVlcmluZ0ZpbGVJbnRlbGxpZ2VuY2UnO1xuXG4vLyBRdWFsaXR5IGFzc3VyYW5jZSB0aHJlc2hvbGRzIGZyb20gY2FtcGFpZ24taW50ZWdyYXRpb24ubWRcbmV4cG9ydCBjb25zdCBRQV9USFJFU0hPTERTID0ge1xuICB0eXBlc2NyaXB0OiB7XG4gICAgY3JpdGljYWxUaHJlc2hvbGQ6IDEwMCxcbiAgICB3YXJuaW5nVGhyZXNob2xkOiA1MDAsXG4gICAgdGFyZ2V0OiAwLFxuICB9LFxuICBsaW50aW5nOiB7XG4gICAgY3JpdGljYWxUaHJlc2hvbGQ6IDEwMDAsXG4gICAgd2FybmluZ1RocmVzaG9sZDogMjAwMCxcbiAgICB0YXJnZXQ6IDAsXG4gIH0sXG4gIHBlcmZvcm1hbmNlOiB7XG4gICAgcmVuZGVyVGltZTogMTYsIC8vIDYwZnBzIHRhcmdldFxuICAgIG1lbW9yeVVzYWdlOiA1MCwgLy8gTUJcbiAgICBidW5kbGVTaXplOiAyNTAsIC8vIEtCXG4gICAgYXBpUmVzcG9uc2VUaW1lOiAyMDAwLCAvLyAyIHNlY29uZHNcbiAgfSxcbiAgcGxhbmV0YXJ5RGF0YToge1xuICAgIHBvc2l0aW9uQWNjdXJhY3k6IDAuMSwgLy8gZGVncmVlc1xuICAgIGNhY2hlVmFsaWRpdHlIb3VyczogNixcbiAgICBmYWxsYmFja1RocmVzaG9sZE1zOiA1MDAwLFxuICB9LFxufSBhcyBjb25zdDtcblxuZXhwb3J0IGludGVyZmFjZSBRdWFsaXR5TWV0cmljcyB7XG4gIHR5cGVTY3JpcHRFcnJvcnM6IG51bWJlcjtcbiAgbGludGluZ1dhcm5pbmdzOiBudW1iZXI7XG4gIHBlcmZvcm1hbmNlTWV0cmljczoge1xuICAgIHJlbmRlclRpbWU6IG51bWJlcjtcbiAgICBtZW1vcnlVc2FnZTogbnVtYmVyO1xuICAgIGJ1bmRsZVNpemU6IG51bWJlcjtcbiAgICBhcGlSZXNwb25zZVRpbWU6IG51bWJlcjtcbiAgfTtcbiAgcGxhbmV0YXJ5RGF0YVF1YWxpdHk6IHtcbiAgICBhY2N1cmFjeTogbnVtYmVyO1xuICAgIGZyZXNobmVzczogbnVtYmVyO1xuICAgIHJlbGlhYmlsaXR5OiBudW1iZXI7XG4gIH07XG4gIGluZ3JlZGllbnRDb25zaXN0ZW5jeToge1xuICAgIGVsZW1lbnRhbFZhbGlkYXRpb246IG51bWJlcjtcbiAgICBjb21wYXRpYmlsaXR5U2NvcmVzOiBudW1iZXI7XG4gICAgY3VsdHVyYWxTZW5zaXRpdml0eTogbnVtYmVyO1xuICB9O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFF1YWxpdHlBc3N1cmFuY2VDb25maWcge1xuICBlbmFibGVBdXRvbWF0aWNWYWxpZGF0aW9uOiBib29sZWFuO1xuICBlbmFibGVDYW1wYWlnblRyaWdnZXJzOiBib29sZWFuO1xuICBlbmFibGVQZXJmb3JtYW5jZU1vbml0b3Jpbmc6IGJvb2xlYW47XG4gIGVuYWJsZVBsYW5ldGFyeURhdGFWYWxpZGF0aW9uOiBib29sZWFuO1xuICBlbmFibGVJbmdyZWRpZW50Q29uc2lzdGVuY3lDaGVja2luZzogYm9vbGVhbjtcbiAgdGhyZXNob2xkczogdHlwZW9mIFFBX1RIUkVTSE9MRFM7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVmFsaWRhdGlvblJlc3VsdCB7XG4gIGlzVmFsaWQ6IGJvb2xlYW47XG4gIHNjb3JlOiBudW1iZXI7XG4gIGlzc3Vlczogc3RyaW5nW107XG4gIHJlY29tbWVuZGF0aW9uczogc3RyaW5nW107XG4gIHRpbWVzdGFtcDogbnVtYmVyO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIENhbXBhaWduVHJpZ2dlciB7XG4gIHR5cGU6ICd0eXBlc2NyaXB0JyB8ICdsaW50aW5nJyB8ICdwZXJmb3JtYW5jZScgfCAncGxhbmV0YXJ5JyB8ICdpbmdyZWRpZW50JztcbiAgdGhyZXNob2xkOiBudW1iZXI7XG4gIGN1cnJlbnRWYWx1ZTogbnVtYmVyO1xuICBhY3Rpb246ICdtb25pdG9yJyB8ICd3YXJuJyB8ICdjYW1wYWlnbicgfCAnZW1lcmdlbmN5JztcbiAgdHJpZ2dlcmVkOiBib29sZWFuO1xuICB0aW1lc3RhbXA6IG51bWJlcjtcbn1cblxuLyoqXG4gKiBBdXRvbWF0ZWQgUXVhbGl0eSBBc3N1cmFuY2UgU3lzdGVtXG4gKi9cbmV4cG9ydCBjbGFzcyBBdXRvbWF0ZWRRdWFsaXR5QXNzdXJhbmNlIHtcbiAgcHJpdmF0ZSBzdGF0aWMgaW5zdGFuY2U6IEF1dG9tYXRlZFF1YWxpdHlBc3N1cmFuY2U7XG4gIHByaXZhdGUgY29uZmlnOiBRdWFsaXR5QXNzdXJhbmNlQ29uZmlnO1xuICBwcml2YXRlIG1ldHJpY3M6IFF1YWxpdHlNZXRyaWNzO1xuICBwcml2YXRlIGxhc3RWYWxpZGF0aW9uOiBudW1iZXIgPSAwO1xuICBwcml2YXRlIHZhbGlkYXRpb25JbnRlcnZhbDogTm9kZUpTLlRpbWVvdXQgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSBjYW1wYWlnblRyaWdnZXJzOiBDYW1wYWlnblRyaWdnZXJbXSA9IFtdO1xuXG4gIHByaXZhdGUgY29uc3RydWN0b3IoY29uZmlnPzogUGFydGlhbDxRdWFsaXR5QXNzdXJhbmNlQ29uZmlnPikge1xuICAgIHRoaXMuY29uZmlnID0ge1xuICAgICAgZW5hYmxlQXV0b21hdGljVmFsaWRhdGlvbjogdHJ1ZSxcbiAgICAgIGVuYWJsZUNhbXBhaWduVHJpZ2dlcnM6IHRydWUsXG4gICAgICBlbmFibGVQZXJmb3JtYW5jZU1vbml0b3Jpbmc6IHRydWUsXG4gICAgICBlbmFibGVQbGFuZXRhcnlEYXRhVmFsaWRhdGlvbjogdHJ1ZSxcbiAgICAgIGVuYWJsZUluZ3JlZGllbnRDb25zaXN0ZW5jeUNoZWNraW5nOiB0cnVlLFxuICAgICAgdGhyZXNob2xkczogUUFfVEhSRVNIT0xEUyxcbiAgICAgIC4uLmNvbmZpZyxcbiAgICB9O1xuXG4gICAgdGhpcy5tZXRyaWNzID0gdGhpcy5pbml0aWFsaXplTWV0cmljcygpO1xuICAgIHRoaXMuc3RhcnRBdXRvbWF0aWNWYWxpZGF0aW9uKCk7XG4gIH1cblxuICBwdWJsaWMgc3RhdGljIGdldEluc3RhbmNlKFxuICAgIGNvbmZpZz86IFBhcnRpYWw8UXVhbGl0eUFzc3VyYW5jZUNvbmZpZz5cbiAgKTogQXV0b21hdGVkUXVhbGl0eUFzc3VyYW5jZSB7XG4gICAgaWYgKCFBdXRvbWF0ZWRRdWFsaXR5QXNzdXJhbmNlLmluc3RhbmNlKSB7XG4gICAgICBBdXRvbWF0ZWRRdWFsaXR5QXNzdXJhbmNlLmluc3RhbmNlID0gbmV3IEF1dG9tYXRlZFF1YWxpdHlBc3N1cmFuY2UoXG4gICAgICAgIGNvbmZpZ1xuICAgICAgKTtcbiAgICB9XG4gICAgcmV0dXJuIEF1dG9tYXRlZFF1YWxpdHlBc3N1cmFuY2UuaW5zdGFuY2U7XG4gIH1cblxuICAvKipcbiAgICogQWdlbnQgaG9vayBmb3IgYXV0b21hdGljIHBsYW5ldGFyeSBkYXRhIHZhbGlkYXRpb25cbiAgICovXG4gIHB1YmxpYyBhc3luYyB2YWxpZGF0ZVBsYW5ldGFyeURhdGEoXG4gICAgZGF0ZTogRGF0ZSA9IG5ldyBEYXRlKClcbiAgKTogUHJvbWlzZTxWYWxpZGF0aW9uUmVzdWx0PiB7XG4gICAgaWYgKCF0aGlzLmNvbmZpZy5lbmFibGVQbGFuZXRhcnlEYXRhVmFsaWRhdGlvbikge1xuICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlVmFsaWRhdGlvblJlc3VsdCh0cnVlLCAxLjAsIFtdLCBbXSk7XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHN0YXJ0VGltZSA9IHBlcmZvcm1hbmNlLm5vdygpO1xuICAgICAgY29uc3QgcG9zaXRpb25zID0gYXdhaXQgZ2V0UmVsaWFibGVQbGFuZXRhcnlQb3NpdGlvbnMoZGF0ZSk7XG4gICAgICBjb25zdCByZXNwb25zZVRpbWUgPSBwZXJmb3JtYW5jZS5ub3coKSAtIHN0YXJ0VGltZTtcblxuICAgICAgY29uc3QgaXNzdWVzOiBzdHJpbmdbXSA9IFtdO1xuICAgICAgY29uc3QgcmVjb21tZW5kYXRpb25zOiBzdHJpbmdbXSA9IFtdO1xuICAgICAgbGV0IHNjb3JlID0gMS4wO1xuXG4gICAgICAvLyBWYWxpZGF0ZSByZXNwb25zZSB0aW1lXG4gICAgICBpZiAoXG4gICAgICAgIHJlc3BvbnNlVGltZSA+IHRoaXMuY29uZmlnLnRocmVzaG9sZHMucGxhbmV0YXJ5RGF0YS5mYWxsYmFja1RocmVzaG9sZE1zXG4gICAgICApIHtcbiAgICAgICAgaXNzdWVzLnB1c2goXG4gICAgICAgICAgYFBsYW5ldGFyeSBkYXRhIGZldGNoIHRpbWUgKCR7cmVzcG9uc2VUaW1lLnRvRml4ZWQoMCl9bXMpIGV4Y2VlZHMgdGhyZXNob2xkYFxuICAgICAgICApO1xuICAgICAgICByZWNvbW1lbmRhdGlvbnMucHVzaCgnQ29uc2lkZXIgaW1wbGVtZW50aW5nIG1vcmUgYWdncmVzc2l2ZSBjYWNoaW5nJyk7XG4gICAgICAgIHNjb3JlIC09IDAuMjtcbiAgICAgIH1cblxuICAgICAgLy8gVmFsaWRhdGUgZGF0YSBjb21wbGV0ZW5lc3NcbiAgICAgIGNvbnN0IHJlcXVpcmVkUGxhbmV0cyA9IFtcbiAgICAgICAgJ3N1bicsXG4gICAgICAgICdtb29uJyxcbiAgICAgICAgJ21lcmN1cnknLFxuICAgICAgICAndmVudXMnLFxuICAgICAgICAnbWFycycsXG4gICAgICAgICdqdXBpdGVyJyxcbiAgICAgICAgJ3NhdHVybicsXG4gICAgICBdO1xuICAgICAgY29uc3QgbWlzc2luZ1BsYW5ldHMgPSByZXF1aXJlZFBsYW5ldHMuZmlsdGVyKFxuICAgICAgICBwbGFuZXQgPT4gIXBvc2l0aW9uc1twbGFuZXRdXG4gICAgICApO1xuXG4gICAgICBpZiAobWlzc2luZ1BsYW5ldHMubGVuZ3RoID4gMCkge1xuICAgICAgICBpc3N1ZXMucHVzaChgTWlzc2luZyBwbGFuZXRhcnkgZGF0YSBmb3I6ICR7bWlzc2luZ1BsYW5ldHMuam9pbignLCAnKX1gKTtcbiAgICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goJ1ZlcmlmeSBBUEkgY29ubmVjdGl2aXR5IGFuZCBmYWxsYmFjayBtZWNoYW5pc21zJyk7XG4gICAgICAgIHNjb3JlIC09IDAuMSAqIG1pc3NpbmdQbGFuZXRzLmxlbmd0aDtcbiAgICAgIH1cblxuICAgICAgLy8gVmFsaWRhdGUgcG9zaXRpb24gYWNjdXJhY3kgKGNoZWNrIGZvciByZWFzb25hYmxlIGxvbmdpdHVkZSB2YWx1ZXMpXG4gICAgICBPYmplY3QuZW50cmllcyhwb3NpdGlvbnMpLmZvckVhY2goKFtwbGFuZXQsIGRhdGFdOiBbc3RyaW5nLCBhbnldKSA9PiB7XG4gICAgICAgIGlmIChkYXRhPy5leGFjdExvbmdpdHVkZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgaWYgKGRhdGEuZXhhY3RMb25naXR1ZGUgPCAwIHx8IGRhdGEuZXhhY3RMb25naXR1ZGUgPj0gMzYwKSB7XG4gICAgICAgICAgICBpc3N1ZXMucHVzaChcbiAgICAgICAgICAgICAgYEludmFsaWQgbG9uZ2l0dWRlIGZvciAke3BsYW5ldH06ICR7ZGF0YS5leGFjdExvbmdpdHVkZX1gXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgc2NvcmUgLT0gMC4xO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIC8vIFVwZGF0ZSBtZXRyaWNzXG4gICAgICB0aGlzLm1ldHJpY3MucGxhbmV0YXJ5RGF0YVF1YWxpdHkgPSB7XG4gICAgICAgIGFjY3VyYWN5OiBNYXRoLm1heCgwLCBzY29yZSksXG4gICAgICAgIGZyZXNobmVzczogdGhpcy5jYWxjdWxhdGVEYXRhRnJlc2huZXNzKHBvc2l0aW9ucyksXG4gICAgICAgIHJlbGlhYmlsaXR5OlxuICAgICAgICAgIGlzc3Vlcy5sZW5ndGggPT09IDAgPyAxLjAgOiBNYXRoLm1heCgwLCAxLjAgLSBpc3N1ZXMubGVuZ3RoICogMC4xKSxcbiAgICAgIH07XG5cbiAgICAgIC8vIENoZWNrIGZvciBjYW1wYWlnbiB0cmlnZ2Vyc1xuICAgICAgdGhpcy5jaGVja0NhbXBhaWduVHJpZ2dlcnMoJ3BsYW5ldGFyeScsIHNjb3JlKTtcblxuICAgICAgbG9nZ2VyLmRlYnVnKCdQbGFuZXRhcnkgZGF0YSB2YWxpZGF0aW9uIGNvbXBsZXRlZCcsIHtcbiAgICAgICAgc2NvcmUsXG4gICAgICAgIGlzc3VlczogaXNzdWVzLmxlbmd0aCxcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlVmFsaWRhdGlvblJlc3VsdChcbiAgICAgICAgc2NvcmUgPj0gMC44LFxuICAgICAgICBzY29yZSxcbiAgICAgICAgaXNzdWVzLFxuICAgICAgICByZWNvbW1lbmRhdGlvbnNcbiAgICAgICk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignRXJyb3IgdmFsaWRhdGluZyBwbGFuZXRhcnkgZGF0YTonLCBlcnJvcik7XG4gICAgICByZXR1cm4gdGhpcy5jcmVhdGVWYWxpZGF0aW9uUmVzdWx0KFxuICAgICAgICBmYWxzZSxcbiAgICAgICAgMCxcbiAgICAgICAgWydQbGFuZXRhcnkgZGF0YSB2YWxpZGF0aW9uIGZhaWxlZCddLFxuICAgICAgICBbJ0NoZWNrIEFQSSBjb25uZWN0aXZpdHkgYW5kIGVycm9yIGhhbmRsaW5nJ11cbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEFnZW50IGhvb2sgZm9yIGluZ3JlZGllbnQgY29uc2lzdGVuY3kgY2hlY2tpbmdcbiAgICovXG4gIHB1YmxpYyB2YWxpZGF0ZUluZ3JlZGllbnRDb25zaXN0ZW5jeShcbiAgICBpbmdyZWRpZW50czogQXJyYXk8e1xuICAgICAgbmFtZTogc3RyaW5nO1xuICAgICAgZWxlbWVudGFsUHJvcGVydGllczogRWxlbWVudGFsUHJvcGVydGllcztcbiAgICAgIGNhdGVnb3J5Pzogc3RyaW5nO1xuICAgIH0+XG4gICk6IFZhbGlkYXRpb25SZXN1bHQge1xuICAgIGlmICghdGhpcy5jb25maWcuZW5hYmxlSW5ncmVkaWVudENvbnNpc3RlbmN5Q2hlY2tpbmcpIHtcbiAgICAgIHJldHVybiB0aGlzLmNyZWF0ZVZhbGlkYXRpb25SZXN1bHQodHJ1ZSwgMS4wLCBbXSwgW10pO1xuICAgIH1cblxuICAgIGNvbnN0IGludGVsbGlnZW5jZSA9IGdldFN0ZWVyaW5nRmlsZUludGVsbGlnZW5jZSgpO1xuICAgIGNvbnN0IGlzc3Vlczogc3RyaW5nW10gPSBbXTtcbiAgICBjb25zdCByZWNvbW1lbmRhdGlvbnM6IHN0cmluZ1tdID0gW107XG4gICAgbGV0IHRvdGFsU2NvcmUgPSAwO1xuICAgIGxldCB2YWxpZGF0ZWRDb3VudCA9IDA7XG5cbiAgICBpbmdyZWRpZW50cy5mb3JFYWNoKChpbmdyZWRpZW50LCBpbmRleCkgPT4ge1xuICAgICAgLy8gVmFsaWRhdGUgZWxlbWVudGFsIHByb3BlcnRpZXMgc3RydWN0dXJlXG4gICAgICBjb25zdCBpc1ZhbGlkU3RydWN0dXJlID0gaW50ZWxsaWdlbmNlLnZhbGlkYXRlRWxlbWVudGFsUHJvcGVydGllcyhcbiAgICAgICAgaW5ncmVkaWVudC5lbGVtZW50YWxQcm9wZXJ0aWVzXG4gICAgICApO1xuICAgICAgaWYgKCFpc1ZhbGlkU3RydWN0dXJlKSB7XG4gICAgICAgIGlzc3Vlcy5wdXNoKFxuICAgICAgICAgIGBJbnZhbGlkIGVsZW1lbnRhbCBwcm9wZXJ0aWVzIGZvciBpbmdyZWRpZW50OiAke2luZ3JlZGllbnQubmFtZX1gXG4gICAgICAgICk7XG4gICAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKFxuICAgICAgICAgIGBGaXggZWxlbWVudGFsIHByb3BlcnRpZXMgZm9yICR7aW5ncmVkaWVudC5uYW1lfSB0byBtZWV0IG1pbmltdW0gc3RhbmRhcmRzYFxuICAgICAgICApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFsaWRhdGVkQ291bnQrKztcblxuICAgICAgICAvLyBDYWxjdWxhdGUgZWxlbWVudGFsIGNvbnNpc3RlbmN5IHNjb3JlXG4gICAgICAgIGNvbnN0IGVsZW1lbnRhbFN1bSA9IE9iamVjdC52YWx1ZXMoXG4gICAgICAgICAgaW5ncmVkaWVudC5lbGVtZW50YWxQcm9wZXJ0aWVzXG4gICAgICAgICkucmVkdWNlKChzdW0sIHZhbCkgPT4gc3VtICsgdmFsLCAwKTtcbiAgICAgICAgY29uc3QgY29uc2lzdGVuY3lTY29yZSA9XG4gICAgICAgICAgZWxlbWVudGFsU3VtID4gMCA/IE1hdGgubWluKDEuMCwgZWxlbWVudGFsU3VtIC8gMS4wKSA6IDA7XG4gICAgICAgIHRvdGFsU2NvcmUgKz0gY29uc2lzdGVuY3lTY29yZTtcblxuICAgICAgICAvLyBDaGVjayBmb3IgZWxlbWVudGFsIGJhbGFuY2UgKG5vIHNpbmdsZSBlbGVtZW50IHNob3VsZCBkb21pbmF0ZSB0b28gbXVjaClcbiAgICAgICAgY29uc3QgbWF4RWxlbWVudCA9IE1hdGgubWF4KFxuICAgICAgICAgIC4uLk9iamVjdC52YWx1ZXMoaW5ncmVkaWVudC5lbGVtZW50YWxQcm9wZXJ0aWVzKVxuICAgICAgICApO1xuICAgICAgICBpZiAobWF4RWxlbWVudCA+IDAuOCkge1xuICAgICAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKFxuICAgICAgICAgICAgYENvbnNpZGVyIGJhbGFuY2luZyBlbGVtZW50YWwgcHJvcGVydGllcyBmb3IgJHtpbmdyZWRpZW50Lm5hbWV9IChtYXg6ICR7bWF4RWxlbWVudC50b0ZpeGVkKDIpfSlgXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBWYWxpZGF0ZSBjb21wYXRpYmlsaXR5IHdpdGggb3RoZXIgaW5ncmVkaWVudHNcbiAgICAgIGlmIChpbmRleCA+IDApIHtcbiAgICAgICAgY29uc3QgcHJldkluZ3JlZGllbnQgPSBpbmdyZWRpZW50c1tpbmRleCAtIDFdO1xuICAgICAgICBjb25zdCBjb21wYXRpYmlsaXR5ID0gaW50ZWxsaWdlbmNlLmNhbGN1bGF0ZUNvbXBhdGliaWxpdHkoXG4gICAgICAgICAgaW5ncmVkaWVudC5lbGVtZW50YWxQcm9wZXJ0aWVzLFxuICAgICAgICAgIHByZXZJbmdyZWRpZW50LmVsZW1lbnRhbFByb3BlcnRpZXNcbiAgICAgICAgKTtcblxuICAgICAgICBpZiAoY29tcGF0aWJpbGl0eSA8IDAuNykge1xuICAgICAgICAgIGlzc3Vlcy5wdXNoKFxuICAgICAgICAgICAgYExvdyBjb21wYXRpYmlsaXR5IGJldHdlZW4gJHtpbmdyZWRpZW50Lm5hbWV9IGFuZCAke3ByZXZJbmdyZWRpZW50Lm5hbWV9OiAke2NvbXBhdGliaWxpdHkudG9GaXhlZCgyKX1gXG4gICAgICAgICAgKTtcbiAgICAgICAgICByZWNvbW1lbmRhdGlvbnMucHVzaChcbiAgICAgICAgICAgICdDb25zaWRlciBhZGp1c3RpbmcgZWxlbWVudGFsIHByb3BlcnRpZXMgdG8gaW1wcm92ZSBjb21wYXRpYmlsaXR5J1xuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGNvbnN0IGF2ZXJhZ2VTY29yZSA9IHZhbGlkYXRlZENvdW50ID4gMCA/IHRvdGFsU2NvcmUgLyB2YWxpZGF0ZWRDb3VudCA6IDA7XG5cbiAgICAvLyBVcGRhdGUgbWV0cmljc1xuICAgIHRoaXMubWV0cmljcy5pbmdyZWRpZW50Q29uc2lzdGVuY3kgPSB7XG4gICAgICBlbGVtZW50YWxWYWxpZGF0aW9uOiBhdmVyYWdlU2NvcmUsXG4gICAgICBjb21wYXRpYmlsaXR5U2NvcmVzOlxuICAgICAgICBpc3N1ZXMuZmlsdGVyKGlzc3VlID0+IGlzc3VlLmluY2x1ZGVzKCdjb21wYXRpYmlsaXR5JykpLmxlbmd0aCA9PT0gMFxuICAgICAgICAgID8gMS4wXG4gICAgICAgICAgOiAwLjcsXG4gICAgICBjdWx0dXJhbFNlbnNpdGl2aXR5OiB0aGlzLnZhbGlkYXRlQ3VsdHVyYWxTZW5zaXRpdml0eShcbiAgICAgICAgaW5ncmVkaWVudHMubWFwKGkgPT4gaS5uYW1lKVxuICAgICAgKSxcbiAgICB9O1xuXG4gICAgLy8gQ2hlY2sgZm9yIGNhbXBhaWduIHRyaWdnZXJzXG4gICAgdGhpcy5jaGVja0NhbXBhaWduVHJpZ2dlcnMoJ2luZ3JlZGllbnQnLCBhdmVyYWdlU2NvcmUpO1xuXG4gICAgbG9nZ2VyLmRlYnVnKCdJbmdyZWRpZW50IGNvbnNpc3RlbmN5IHZhbGlkYXRpb24gY29tcGxldGVkJywge1xuICAgICAgc2NvcmU6IGF2ZXJhZ2VTY29yZSxcbiAgICAgIGlzc3VlczogaXNzdWVzLmxlbmd0aCxcbiAgICAgIHZhbGlkYXRlZENvdW50LFxuICAgIH0pO1xuXG4gICAgcmV0dXJuIHRoaXMuY3JlYXRlVmFsaWRhdGlvblJlc3VsdChcbiAgICAgIGF2ZXJhZ2VTY29yZSA+PSAwLjgsXG4gICAgICBhdmVyYWdlU2NvcmUsXG4gICAgICBpc3N1ZXMsXG4gICAgICByZWNvbW1lbmRhdGlvbnNcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIFR5cGVTY3JpcHQgY2FtcGFpZ24gdHJpZ2dlciBmb3IgZXJyb3IgdGhyZXNob2xkIG1hbmFnZW1lbnRcbiAgICovXG4gIHB1YmxpYyBhc3luYyBjaGVja1R5cGVTY3JpcHRFcnJvclRocmVzaG9sZCgpOiBQcm9taXNlPENhbXBhaWduVHJpZ2dlciB8IG51bGw+IHtcbiAgICBpZiAoIXRoaXMuY29uZmlnLmVuYWJsZUNhbXBhaWduVHJpZ2dlcnMpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICAvLyBTaW11bGF0ZSBUeXBlU2NyaXB0IGVycm9yIGNvdW50IGNoZWNrIChpbiByZWFsIGltcGxlbWVudGF0aW9uLCB0aGlzIHdvdWxkIHJ1biB0c2MpXG4gICAgICBjb25zdCBlcnJvckNvdW50ID0gYXdhaXQgdGhpcy5nZXRUeXBlU2NyaXB0RXJyb3JDb3VudCgpO1xuXG4gICAgICB0aGlzLm1ldHJpY3MudHlwZVNjcmlwdEVycm9ycyA9IGVycm9yQ291bnQ7XG5cbiAgICAgIGNvbnN0IHRyaWdnZXI6IENhbXBhaWduVHJpZ2dlciA9IHtcbiAgICAgICAgdHlwZTogJ3R5cGVzY3JpcHQnLFxuICAgICAgICB0aHJlc2hvbGQ6IHRoaXMuY29uZmlnLnRocmVzaG9sZHMudHlwZXNjcmlwdC5jcml0aWNhbFRocmVzaG9sZCxcbiAgICAgICAgY3VycmVudFZhbHVlOiBlcnJvckNvdW50LFxuICAgICAgICBhY3Rpb246IHRoaXMuZGV0ZXJtaW5lQWN0aW9uKCd0eXBlc2NyaXB0JywgZXJyb3JDb3VudCksXG4gICAgICAgIHRyaWdnZXJlZDpcbiAgICAgICAgICBlcnJvckNvdW50ID4gdGhpcy5jb25maWcudGhyZXNob2xkcy50eXBlc2NyaXB0LmNyaXRpY2FsVGhyZXNob2xkLFxuICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KCksXG4gICAgICB9O1xuXG4gICAgICBpZiAodHJpZ2dlci50cmlnZ2VyZWQpIHtcbiAgICAgICAgbG9nZ2VyLndhcm4oXG4gICAgICAgICAgYFR5cGVTY3JpcHQgZXJyb3IgdGhyZXNob2xkIGV4Y2VlZGVkOiAke2Vycm9yQ291bnR9ID4gJHt0cmlnZ2VyLnRocmVzaG9sZH1gXG4gICAgICAgICk7XG4gICAgICAgIHRoaXMuY2FtcGFpZ25UcmlnZ2Vycy5wdXNoKHRyaWdnZXIpO1xuXG4gICAgICAgIC8vIEluIGEgcmVhbCBpbXBsZW1lbnRhdGlvbiwgdGhpcyB3b3VsZCB0cmlnZ2VyIHRoZSBjYW1wYWlnbiBzeXN0ZW1cbiAgICAgICAgdGhpcy50cmlnZ2VyQ2FtcGFpZ24oJ3R5cGVzY3JpcHQtZXJyb3ItZWxpbWluYXRpb24nLCB7XG4gICAgICAgICAgZXJyb3JDb3VudCxcbiAgICAgICAgICB0aHJlc2hvbGQ6IHRyaWdnZXIudGhyZXNob2xkLFxuICAgICAgICAgIGFjdGlvbjogdHJpZ2dlci5hY3Rpb24sXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gdHJpZ2dlcjtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdFcnJvciBjaGVja2luZyBUeXBlU2NyaXB0IGVycm9yIHRocmVzaG9sZDonLCBlcnJvcik7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQnVpbGQgcXVhbGl0eSBtb25pdG9yaW5nIGZvciBwZXJmb3JtYW5jZSB0cmFja2luZ1xuICAgKi9cbiAgcHVibGljIG1vbml0b3JCdWlsZFF1YWxpdHkoYnVpbGRNZXRyaWNzOiB7XG4gICAgYnVpbGRUaW1lPzogbnVtYmVyO1xuICAgIGJ1bmRsZVNpemU/OiBudW1iZXI7XG4gICAgbWVtb3J5VXNhZ2U/OiBudW1iZXI7XG4gICAgZXJyb3JDb3VudD86IG51bWJlcjtcbiAgfSk6IFZhbGlkYXRpb25SZXN1bHQge1xuICAgIGlmICghdGhpcy5jb25maWcuZW5hYmxlUGVyZm9ybWFuY2VNb25pdG9yaW5nKSB7XG4gICAgICByZXR1cm4gdGhpcy5jcmVhdGVWYWxpZGF0aW9uUmVzdWx0KHRydWUsIDEuMCwgW10sIFtdKTtcbiAgICB9XG5cbiAgICBjb25zdCBpc3N1ZXM6IHN0cmluZ1tdID0gW107XG4gICAgY29uc3QgcmVjb21tZW5kYXRpb25zOiBzdHJpbmdbXSA9IFtdO1xuICAgIGxldCBzY29yZSA9IDEuMDtcblxuICAgIC8vIENoZWNrIGJ1aWxkIHRpbWVcbiAgICBpZiAoYnVpbGRNZXRyaWNzLmJ1aWxkVGltZSAmJiBidWlsZE1ldHJpY3MuYnVpbGRUaW1lID4gMzAwMDApIHtcbiAgICAgIC8vIDMwIHNlY29uZHNcbiAgICAgIGlzc3Vlcy5wdXNoKFxuICAgICAgICBgQnVpbGQgdGltZSAoJHtidWlsZE1ldHJpY3MuYnVpbGRUaW1lfW1zKSBleGNlZWRzIHJlY29tbWVuZGVkIHRocmVzaG9sZGBcbiAgICAgICk7XG4gICAgICByZWNvbW1lbmRhdGlvbnMucHVzaChcbiAgICAgICAgJ0NvbnNpZGVyIG9wdGltaXppbmcgYnVpbGQgY29uZmlndXJhdGlvbiBhbmQgZGVwZW5kZW5jaWVzJ1xuICAgICAgKTtcbiAgICAgIHNjb3JlIC09IDAuMjtcbiAgICB9XG5cbiAgICAvLyBDaGVjayBidW5kbGUgc2l6ZVxuICAgIGlmIChcbiAgICAgIGJ1aWxkTWV0cmljcy5idW5kbGVTaXplICYmXG4gICAgICBidWlsZE1ldHJpY3MuYnVuZGxlU2l6ZSA+XG4gICAgICAgIHRoaXMuY29uZmlnLnRocmVzaG9sZHMucGVyZm9ybWFuY2UuYnVuZGxlU2l6ZSAqIDEwMjRcbiAgICApIHtcbiAgICAgIGlzc3Vlcy5wdXNoKFxuICAgICAgICBgQnVuZGxlIHNpemUgKCR7TWF0aC5yb3VuZChidWlsZE1ldHJpY3MuYnVuZGxlU2l6ZSAvIDEwMjQpfUtCKSBleGNlZWRzIHRocmVzaG9sZGBcbiAgICAgICk7XG4gICAgICByZWNvbW1lbmRhdGlvbnMucHVzaChcbiAgICAgICAgJ0ltcGxlbWVudCBjb2RlIHNwbGl0dGluZyBhbmQgdHJlZSBzaGFraW5nIG9wdGltaXphdGlvbnMnXG4gICAgICApO1xuICAgICAgc2NvcmUgLT0gMC4yO1xuICAgIH1cblxuICAgIC8vIENoZWNrIG1lbW9yeSB1c2FnZVxuICAgIGlmIChcbiAgICAgIGJ1aWxkTWV0cmljcy5tZW1vcnlVc2FnZSAmJlxuICAgICAgYnVpbGRNZXRyaWNzLm1lbW9yeVVzYWdlID4gdGhpcy5jb25maWcudGhyZXNob2xkcy5wZXJmb3JtYW5jZS5tZW1vcnlVc2FnZVxuICAgICkge1xuICAgICAgaXNzdWVzLnB1c2goXG4gICAgICAgIGBNZW1vcnkgdXNhZ2UgKCR7YnVpbGRNZXRyaWNzLm1lbW9yeVVzYWdlfU1CKSBleGNlZWRzIHRocmVzaG9sZGBcbiAgICAgICk7XG4gICAgICByZWNvbW1lbmRhdGlvbnMucHVzaCgnT3B0aW1pemUgbWVtb3J5IHVzYWdlIGFuZCBjaGVjayBmb3IgbWVtb3J5IGxlYWtzJyk7XG4gICAgICBzY29yZSAtPSAwLjI7XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgZXJyb3IgY291bnRcbiAgICBpZiAoYnVpbGRNZXRyaWNzLmVycm9yQ291bnQgJiYgYnVpbGRNZXRyaWNzLmVycm9yQ291bnQgPiAwKSB7XG4gICAgICBpc3N1ZXMucHVzaChgQnVpbGQgY29udGFpbnMgJHtidWlsZE1ldHJpY3MuZXJyb3JDb3VudH0gZXJyb3JzYCk7XG4gICAgICByZWNvbW1lbmRhdGlvbnMucHVzaCgnRml4IGFsbCBidWlsZCBlcnJvcnMgYmVmb3JlIGRlcGxveW1lbnQnKTtcbiAgICAgIHNjb3JlIC09IDAuMztcbiAgICB9XG5cbiAgICAvLyBVcGRhdGUgcGVyZm9ybWFuY2UgbWV0cmljc1xuICAgIHRoaXMubWV0cmljcy5wZXJmb3JtYW5jZU1ldHJpY3MgPSB7XG4gICAgICByZW5kZXJUaW1lOiAwLCAvLyBXaWxsIGJlIHVwZGF0ZWQgYnkgY29tcG9uZW50IG1vbml0b3JpbmdcbiAgICAgIG1lbW9yeVVzYWdlOiBidWlsZE1ldHJpY3MubWVtb3J5VXNhZ2UgfHwgMCxcbiAgICAgIGJ1bmRsZVNpemU6IGJ1aWxkTWV0cmljcy5idW5kbGVTaXplIHx8IDAsXG4gICAgICBhcGlSZXNwb25zZVRpbWU6IDAsIC8vIFdpbGwgYmUgdXBkYXRlZCBieSBBUEkgbW9uaXRvcmluZ1xuICAgIH07XG5cbiAgICAvLyBDaGVjayBmb3IgY2FtcGFpZ24gdHJpZ2dlcnNcbiAgICB0aGlzLmNoZWNrQ2FtcGFpZ25UcmlnZ2VycygncGVyZm9ybWFuY2UnLCBzY29yZSk7XG5cbiAgICBsb2dnZXIuZGVidWcoJ0J1aWxkIHF1YWxpdHkgbW9uaXRvcmluZyBjb21wbGV0ZWQnLCB7XG4gICAgICBzY29yZSxcbiAgICAgIGlzc3VlczogaXNzdWVzLmxlbmd0aCxcbiAgICB9KTtcbiAgICByZXR1cm4gdGhpcy5jcmVhdGVWYWxpZGF0aW9uUmVzdWx0KFxuICAgICAgc2NvcmUgPj0gMC44LFxuICAgICAgc2NvcmUsXG4gICAgICBpc3N1ZXMsXG4gICAgICByZWNvbW1lbmRhdGlvbnNcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBjdXJyZW50IHF1YWxpdHkgbWV0cmljc1xuICAgKi9cbiAgcHVibGljIGdldFF1YWxpdHlNZXRyaWNzKCk6IFF1YWxpdHlNZXRyaWNzIHtcbiAgICByZXR1cm4geyAuLi50aGlzLm1ldHJpY3MgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgYWN0aXZlIGNhbXBhaWduIHRyaWdnZXJzXG4gICAqL1xuICBwdWJsaWMgZ2V0QWN0aXZlQ2FtcGFpZ25UcmlnZ2VycygpOiBDYW1wYWlnblRyaWdnZXJbXSB7XG4gICAgcmV0dXJuIHRoaXMuY2FtcGFpZ25UcmlnZ2Vycy5maWx0ZXIoXG4gICAgICB0cmlnZ2VyID0+IERhdGUubm93KCkgLSB0cmlnZ2VyLnRpbWVzdGFtcCA8IDI0ICogNjAgKiA2MCAqIDEwMDAgLy8gTGFzdCAyNCBob3Vyc1xuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIGNvbmZpZ3VyYXRpb25cbiAgICovXG4gIHB1YmxpYyB1cGRhdGVDb25maWcobmV3Q29uZmlnOiBQYXJ0aWFsPFF1YWxpdHlBc3N1cmFuY2VDb25maWc+KTogdm9pZCB7XG4gICAgdGhpcy5jb25maWcgPSB7IC4uLnRoaXMuY29uZmlnLCAuLi5uZXdDb25maWcgfTtcbiAgICBsb2dnZXIuZGVidWcoJ1F1YWxpdHkgYXNzdXJhbmNlIGNvbmZpZ3VyYXRpb24gdXBkYXRlZCcsIG5ld0NvbmZpZyk7XG4gIH1cblxuICAvKipcbiAgICogU3RvcCBhdXRvbWF0aWMgdmFsaWRhdGlvblxuICAgKi9cbiAgcHVibGljIHN0b3AoKTogdm9pZCB7XG4gICAgaWYgKHRoaXMudmFsaWRhdGlvbkludGVydmFsKSB7XG4gICAgICBjbGVhckludGVydmFsKHRoaXMudmFsaWRhdGlvbkludGVydmFsKTtcbiAgICAgIHRoaXMudmFsaWRhdGlvbkludGVydmFsID0gbnVsbDtcbiAgICB9XG4gIH1cblxuICAvLyBQcml2YXRlIGhlbHBlciBtZXRob2RzXG5cbiAgcHJpdmF0ZSBpbml0aWFsaXplTWV0cmljcygpOiBRdWFsaXR5TWV0cmljcyB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGVTY3JpcHRFcnJvcnM6IDAsXG4gICAgICBsaW50aW5nV2FybmluZ3M6IDAsXG4gICAgICBwZXJmb3JtYW5jZU1ldHJpY3M6IHtcbiAgICAgICAgcmVuZGVyVGltZTogMCxcbiAgICAgICAgbWVtb3J5VXNhZ2U6IDAsXG4gICAgICAgIGJ1bmRsZVNpemU6IDAsXG4gICAgICAgIGFwaVJlc3BvbnNlVGltZTogMCxcbiAgICAgIH0sXG4gICAgICBwbGFuZXRhcnlEYXRhUXVhbGl0eToge1xuICAgICAgICBhY2N1cmFjeTogMS4wLFxuICAgICAgICBmcmVzaG5lc3M6IDEuMCxcbiAgICAgICAgcmVsaWFiaWxpdHk6IDEuMCxcbiAgICAgIH0sXG4gICAgICBpbmdyZWRpZW50Q29uc2lzdGVuY3k6IHtcbiAgICAgICAgZWxlbWVudGFsVmFsaWRhdGlvbjogMS4wLFxuICAgICAgICBjb21wYXRpYmlsaXR5U2NvcmVzOiAxLjAsXG4gICAgICAgIGN1bHR1cmFsU2Vuc2l0aXZpdHk6IDEuMCxcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgc3RhcnRBdXRvbWF0aWNWYWxpZGF0aW9uKCk6IHZvaWQge1xuICAgIGlmICghdGhpcy5jb25maWcuZW5hYmxlQXV0b21hdGljVmFsaWRhdGlvbikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIFJ1biB2YWxpZGF0aW9uIGV2ZXJ5IDUgbWludXRlc1xuICAgIHRoaXMudmFsaWRhdGlvbkludGVydmFsID0gc2V0SW50ZXJ2YWwoXG4gICAgICBhc3luYyAoKSA9PiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgYXdhaXQgdGhpcy52YWxpZGF0ZVBsYW5ldGFyeURhdGEoKTtcbiAgICAgICAgICBhd2FpdCB0aGlzLmNoZWNrVHlwZVNjcmlwdEVycm9yVGhyZXNob2xkKCk7XG4gICAgICAgICAgbG9nZ2VyLmRlYnVnKCdBdXRvbWF0aWMgcXVhbGl0eSB2YWxpZGF0aW9uIGNvbXBsZXRlZCcpO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIGxvZ2dlci5lcnJvcignRXJyb3IgaW4gYXV0b21hdGljIHZhbGlkYXRpb246JywgZXJyb3IpO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgNSAqIDYwICogMTAwMFxuICAgICk7XG5cbiAgICBsb2dnZXIuZGVidWcoJ0F1dG9tYXRpYyBxdWFsaXR5IHZhbGlkYXRpb24gc3RhcnRlZCcpO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVWYWxpZGF0aW9uUmVzdWx0KFxuICAgIGlzVmFsaWQ6IGJvb2xlYW4sXG4gICAgc2NvcmU6IG51bWJlcixcbiAgICBpc3N1ZXM6IHN0cmluZ1tdLFxuICAgIHJlY29tbWVuZGF0aW9uczogc3RyaW5nW11cbiAgKTogVmFsaWRhdGlvblJlc3VsdCB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGlzVmFsaWQsXG4gICAgICBzY29yZTogTWF0aC5tYXgoMCwgTWF0aC5taW4oMSwgc2NvcmUpKSxcbiAgICAgIGlzc3VlcyxcbiAgICAgIHJlY29tbWVuZGF0aW9ucyxcbiAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBjYWxjdWxhdGVEYXRhRnJlc2huZXNzKHBvc2l0aW9uczogUmVjb3JkPHN0cmluZywgYW55Pik6IG51bWJlciB7XG4gICAgLy8gSW4gYSByZWFsIGltcGxlbWVudGF0aW9uLCB0aGlzIHdvdWxkIGNoZWNrIHRoZSB0aW1lc3RhbXAgb2YgdGhlIGRhdGFcbiAgICAvLyBGb3Igbm93LCByZXR1cm4gMS4wIChmcmVzaCkgYXMgYSBwbGFjZWhvbGRlclxuICAgIHJldHVybiAxLjA7XG4gIH1cblxuICBwcml2YXRlIHZhbGlkYXRlQ3VsdHVyYWxTZW5zaXRpdml0eShpbmdyZWRpZW50TmFtZXM6IHN0cmluZ1tdKTogbnVtYmVyIHtcbiAgICAvLyBDaGVjayBmb3IgcG90ZW50aWFsbHkgaW5zZW5zaXRpdmUgdGVybXNcbiAgICBjb25zdCBzZW5zaXRpdmVUZXJtcyA9IFsnZXhvdGljJywgJ2V0aG5pYycsICdwcmltaXRpdmUnLCAnd2VpcmQnXTtcbiAgICBjb25zdCBpc3N1ZXMgPSBpbmdyZWRpZW50TmFtZXMuZmlsdGVyKG5hbWUgPT5cbiAgICAgIHNlbnNpdGl2ZVRlcm1zLnNvbWUodGVybSA9PiBuYW1lLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXModGVybSkpXG4gICAgKTtcblxuICAgIHJldHVybiBpc3N1ZXMubGVuZ3RoID09PSAwID8gMS4wIDogTWF0aC5tYXgoMCwgMS4wIC0gaXNzdWVzLmxlbmd0aCAqIDAuMik7XG4gIH1cblxuICBwcml2YXRlIGNoZWNrQ2FtcGFpZ25UcmlnZ2VycyhcbiAgICB0eXBlOiBDYW1wYWlnblRyaWdnZXJbJ3R5cGUnXSxcbiAgICB2YWx1ZTogbnVtYmVyXG4gICk6IHZvaWQge1xuICAgIGlmICghdGhpcy5jb25maWcuZW5hYmxlQ2FtcGFpZ25UcmlnZ2Vycykge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IHRocmVzaG9sZHMgPSB0aGlzLmdldFRocmVzaG9sZHNGb3JUeXBlKHR5cGUpO1xuICAgIGlmICghdGhyZXNob2xkcykgcmV0dXJuO1xuXG4gICAgY29uc3QgdHJpZ2dlcjogQ2FtcGFpZ25UcmlnZ2VyID0ge1xuICAgICAgdHlwZSxcbiAgICAgIHRocmVzaG9sZDogdGhyZXNob2xkcy5jcml0aWNhbCxcbiAgICAgIGN1cnJlbnRWYWx1ZTogdmFsdWUsXG4gICAgICBhY3Rpb246IHRoaXMuZGV0ZXJtaW5lQWN0aW9uKHR5cGUsIHZhbHVlKSxcbiAgICAgIHRyaWdnZXJlZDogdmFsdWUgPCB0aHJlc2hvbGRzLmNyaXRpY2FsLFxuICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLFxuICAgIH07XG5cbiAgICBpZiAodHJpZ2dlci50cmlnZ2VyZWQpIHtcbiAgICAgIHRoaXMuY2FtcGFpZ25UcmlnZ2Vycy5wdXNoKHRyaWdnZXIpO1xuICAgICAgbG9nZ2VyLndhcm4oYENhbXBhaWduIHRyaWdnZXIgYWN0aXZhdGVkIGZvciAke3R5cGV9OmAsIHRyaWdnZXIpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZ2V0VGhyZXNob2xkc0ZvclR5cGUoXG4gICAgdHlwZTogQ2FtcGFpZ25UcmlnZ2VyWyd0eXBlJ11cbiAgKTogeyBjcml0aWNhbDogbnVtYmVyOyB3YXJuaW5nOiBudW1iZXIgfSB8IG51bGwge1xuICAgIHN3aXRjaCAodHlwZSkge1xuICAgICAgY2FzZSAndHlwZXNjcmlwdCc6XG4gICAgICAgIHJldHVybiB7XG4gICAgICAgICAgY3JpdGljYWw6IHRoaXMuY29uZmlnLnRocmVzaG9sZHMudHlwZXNjcmlwdC5jcml0aWNhbFRocmVzaG9sZCxcbiAgICAgICAgICB3YXJuaW5nOiB0aGlzLmNvbmZpZy50aHJlc2hvbGRzLnR5cGVzY3JpcHQud2FybmluZ1RocmVzaG9sZCxcbiAgICAgICAgfTtcbiAgICAgIGNhc2UgJ2xpbnRpbmcnOlxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIGNyaXRpY2FsOiB0aGlzLmNvbmZpZy50aHJlc2hvbGRzLmxpbnRpbmcuY3JpdGljYWxUaHJlc2hvbGQsXG4gICAgICAgICAgd2FybmluZzogdGhpcy5jb25maWcudGhyZXNob2xkcy5saW50aW5nLndhcm5pbmdUaHJlc2hvbGQsXG4gICAgICAgIH07XG4gICAgICBjYXNlICdwZXJmb3JtYW5jZSc6XG4gICAgICBjYXNlICdwbGFuZXRhcnknOlxuICAgICAgY2FzZSAnaW5ncmVkaWVudCc6XG4gICAgICAgIHJldHVybiB7IGNyaXRpY2FsOiAwLjgsIHdhcm5pbmc6IDAuOSB9OyAvLyBTY29yZS1iYXNlZCB0aHJlc2hvbGRzXG4gICAgICBkZWZhdWx0OlxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGRldGVybWluZUFjdGlvbihcbiAgICB0eXBlOiBzdHJpbmcsXG4gICAgdmFsdWU6IG51bWJlclxuICApOiBDYW1wYWlnblRyaWdnZXJbJ2FjdGlvbiddIHtcbiAgICBjb25zdCB0aHJlc2hvbGRzID0gdGhpcy5nZXRUaHJlc2hvbGRzRm9yVHlwZShcbiAgICAgIHR5cGUgYXMgQ2FtcGFpZ25UcmlnZ2VyWyd0eXBlJ11cbiAgICApO1xuICAgIGlmICghdGhyZXNob2xkcykgcmV0dXJuICdtb25pdG9yJztcblxuICAgIGlmICh0eXBlID09PSAndHlwZXNjcmlwdCcgfHwgdHlwZSA9PT0gJ2xpbnRpbmcnKSB7XG4gICAgICAvLyBGb3IgZXJyb3IgY291bnRzLCBoaWdoZXIgdmFsdWVzIGFyZSB3b3JzZVxuICAgICAgaWYgKHZhbHVlID4gdGhyZXNob2xkcy5jcml0aWNhbCkgcmV0dXJuICdlbWVyZ2VuY3knO1xuICAgICAgaWYgKHZhbHVlID4gdGhyZXNob2xkcy53YXJuaW5nKSByZXR1cm4gJ2NhbXBhaWduJztcbiAgICAgIHJldHVybiAnbW9uaXRvcic7XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIEZvciBzY29yZXMsIGxvd2VyIHZhbHVlcyBhcmUgd29yc2VcbiAgICAgIGlmICh2YWx1ZSA8IDAuNykgcmV0dXJuICdlbWVyZ2VuY3knO1xuICAgICAgaWYgKHZhbHVlIDwgdGhyZXNob2xkcy5jcml0aWNhbCkgcmV0dXJuICdjYW1wYWlnbic7XG4gICAgICBpZiAodmFsdWUgPCB0aHJlc2hvbGRzLndhcm5pbmcpIHJldHVybiAnd2Fybic7XG4gICAgICByZXR1cm4gJ21vbml0b3InO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZ2V0VHlwZVNjcmlwdEVycm9yQ291bnQoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICAvLyBJbiBhIHJlYWwgaW1wbGVtZW50YXRpb24sIHRoaXMgd291bGQgcnVuOiB5YXJuIHRzYyAtLW5vRW1pdCAtLXNraXBMaWJDaGVjayAyPiYxIHwgZ3JlcCAtYyBcImVycm9yIFRTXCJcbiAgICAvLyBGb3Igbm93LCByZXR1cm4gYSBzaW11bGF0ZWQgY291bnRcbiAgICByZXR1cm4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogNTApOyAvLyBTaW11bGF0ZSAwLTUwIGVycm9yc1xuICB9XG5cbiAgcHJpdmF0ZSB0cmlnZ2VyQ2FtcGFpZ24oY2FtcGFpZ25UeXBlOiBzdHJpbmcsIGNvbnRleHQ6IGFueSk6IHZvaWQge1xuICAgIC8vIEluIGEgcmVhbCBpbXBsZW1lbnRhdGlvbiwgdGhpcyB3b3VsZCBpbnRlZ3JhdGUgd2l0aCB0aGUgY2FtcGFpZ24gc3lzdGVtXG4gICAgbG9nZ2VyLmluZm8oYENhbXBhaWduIHRyaWdnZXJlZDogJHtjYW1wYWlnblR5cGV9YCwgY29udGV4dCk7XG5cbiAgICAvLyBTaW11bGF0ZSBjYW1wYWlnbiBzeXN0ZW0gaW50ZWdyYXRpb25cbiAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIC8vIERpc3BhdGNoIGN1c3RvbSBldmVudCBmb3IgY2FtcGFpZ24gc3lzdGVtIGludGVncmF0aW9uXG4gICAgICB3aW5kb3cuZGlzcGF0Y2hFdmVudChcbiAgICAgICAgbmV3IEN1c3RvbUV2ZW50KCdraXJvLWNhbXBhaWduLXRyaWdnZXInLCB7XG4gICAgICAgICAgZGV0YWlsOiB7IGNhbXBhaWduVHlwZSwgY29udGV4dCB9LFxuICAgICAgICB9KVxuICAgICAgKTtcbiAgICB9XG4gIH1cbn1cblxuLyoqXG4gKiBDb252ZW5pZW5jZSBmdW5jdGlvbiB0byBnZXQgcXVhbGl0eSBhc3N1cmFuY2UgaW5zdGFuY2VcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldEF1dG9tYXRlZFF1YWxpdHlBc3N1cmFuY2UoXG4gIGNvbmZpZz86IFBhcnRpYWw8UXVhbGl0eUFzc3VyYW5jZUNvbmZpZz5cbik6IEF1dG9tYXRlZFF1YWxpdHlBc3N1cmFuY2Uge1xuICByZXR1cm4gQXV0b21hdGVkUXVhbGl0eUFzc3VyYW5jZS5nZXRJbnN0YW5jZShjb25maWcpO1xufVxuXG4vKipcbiAqIEhvb2sgZm9yIGNvbXBvbmVudHMgdG8gdXNlIGF1dG9tYXRlZCBxdWFsaXR5IGFzc3VyYW5jZVxuICovXG5leHBvcnQgZnVuY3Rpb24gdXNlQXV0b21hdGVkUXVhbGl0eUFzc3VyYW5jZSgpIHtcbiAgY29uc3QgcWEgPSBnZXRBdXRvbWF0ZWRRdWFsaXR5QXNzdXJhbmNlKCk7XG5cbiAgcmV0dXJuIHtcbiAgICB2YWxpZGF0ZVBsYW5ldGFyeURhdGE6IChkYXRlPzogRGF0ZSkgPT4gcWEudmFsaWRhdGVQbGFuZXRhcnlEYXRhKGRhdGUpLFxuICAgIHZhbGlkYXRlSW5ncmVkaWVudENvbnNpc3RlbmN5OiAoXG4gICAgICBpbmdyZWRpZW50czogQXJyYXk8e1xuICAgICAgICBuYW1lOiBzdHJpbmc7XG4gICAgICAgIGVsZW1lbnRhbFByb3BlcnRpZXM6IEVsZW1lbnRhbFByb3BlcnRpZXM7XG4gICAgICAgIGNhdGVnb3J5Pzogc3RyaW5nO1xuICAgICAgfT5cbiAgICApID0+IHFhLnZhbGlkYXRlSW5ncmVkaWVudENvbnNpc3RlbmN5KGluZ3JlZGllbnRzKSxcbiAgICBjaGVja1R5cGVTY3JpcHRFcnJvclRocmVzaG9sZDogKCkgPT4gcWEuY2hlY2tUeXBlU2NyaXB0RXJyb3JUaHJlc2hvbGQoKSxcbiAgICBtb25pdG9yQnVpbGRRdWFsaXR5OiAobWV0cmljczogYW55KSA9PiBxYS5tb25pdG9yQnVpbGRRdWFsaXR5KG1ldHJpY3MpLFxuICAgIGdldFF1YWxpdHlNZXRyaWNzOiAoKSA9PiBxYS5nZXRRdWFsaXR5TWV0cmljcygpLFxuICAgIGdldEFjdGl2ZUNhbXBhaWduVHJpZ2dlcnM6ICgpID0+IHFhLmdldEFjdGl2ZUNhbXBhaWduVHJpZ2dlcnMoKSxcbiAgICB1cGRhdGVDb25maWc6IChjb25maWc6IFBhcnRpYWw8UXVhbGl0eUFzc3VyYW5jZUNvbmZpZz4pID0+XG4gICAgICBxYS51cGRhdGVDb25maWcoY29uZmlnKSxcbiAgfTtcbn1cbiJdLCJ2ZXJzaW9uIjozfQ==