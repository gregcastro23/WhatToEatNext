b977af81edd27da486ceb4606e54629a
"use strict";
/**
 * Enterprise Intelligence Integration Hook
 * Main Page Restoration - Task 3.8 Implementation
 *
 * React hook for integrating enterprise intelligence systems
 * with cuisine recommendation components.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.useEnterpriseIntelligencePerformance = exports.useEnterpriseIntelligenceRecommendations = exports.useEnterpriseIntelligenceHealth = exports.useEnterpriseIntelligence = void 0;
const react_1 = require("react");
const logger_1 = require("@/utils/logger");
const EnterpriseIntelligenceIntegration_1 = require("@/services/EnterpriseIntelligenceIntegration");
// ========== HOOK IMPLEMENTATION ==========
function useEnterpriseIntelligence(config = {}) {
    // ========== STATE ==========
    var _a;
    const [state, setState] = (0, react_1.useState)({
        analysis: null,
        isAnalyzing: false,
        error: null,
        lastAnalyzed: null,
        performanceMetrics: {
            analysisCount: 0,
            averageExecutionTime: 0,
            cacheHitRate: 0,
            errorRate: 0
        }
    });
    const [lastAnalysisParams, setLastAnalysisParams] = (0, react_1.useState)(null);
    // ========== MEMOIZED VALUES ==========
    const intelligenceService = (0, react_1.useMemo)(() => {
        if (Object.keys(config).length > 0) {
            return new EnterpriseIntelligenceIntegration_1.EnterpriseIntelligenceIntegration(config);
        }
        return EnterpriseIntelligenceIntegration_1.enterpriseIntelligenceIntegration;
    }, [config]);
    const recommendations = (0, react_1.useMemo)(() => {
        if (!state.analysis) {
            return {
                recipe: [],
                ingredient: [],
                validation: [],
                safety: [],
                optimization: []
            };
        }
        return {
            recipe: state.analysis.recipeIntelligence.recommendations || [],
            ingredient: state.analysis.ingredientIntelligence.recommendations || [],
            validation: [
                ...state.analysis.validationIntelligence.dataIntegrity.issues,
                ...state.analysis.validationIntelligence.astrologicalConsistency.issues,
                ...state.analysis.validationIntelligence.elementalHarmony.issues
            ],
            safety: state.analysis.safetyIntelligence.fallbackStrategies || [],
            optimization: [
                ...state.analysis.optimizationRecommendations.performance.recommendations,
                ...state.analysis.optimizationRecommendations.accuracy.recommendations,
                ...state.analysis.optimizationRecommendations.userExperience.recommendations,
                ...state.analysis.optimizationRecommendations.systemIntegration.recommendations
            ]
        };
    }, [state.analysis]);
    const systemHealth = (0, react_1.useMemo)(() => {
        if (!state.analysis) {
            return {
                overall: 'fair',
                score: 0.7,
                issues: ['No analysis available'],
                warnings: []
            };
        }
        const analysis = state.analysis;
        const issues = [
            ...analysis.validationIntelligence.overallValidation.criticalIssues,
            ...(analysis.safetyIntelligence.riskAssessment.level === 'high' ||
                analysis.safetyIntelligence.riskAssessment.level === 'critical'
                ? ['High risk level detected'] : [])
        ];
        const warnings = [
            ...analysis.validationIntelligence.dataIntegrity.warnings,
            ...analysis.validationIntelligence.astrologicalConsistency.warnings,
            ...analysis.validationIntelligence.elementalHarmony.warnings,
            ...analysis.safetyIntelligence.monitoringAlerts
        ];
        return {
            overall: analysis.systemHealth,
            score: analysis.overallScore,
            issues,
            warnings
        };
    }, [state.analysis]);
    const isHealthy = (0, react_1.useMemo)(() => {
        return systemHealth.overall === 'excellent' || systemHealth.overall === 'good';
    }, [systemHealth.overall]);
    const needsAttention = (0, react_1.useMemo)(() => {
        var _a, _b;
        return systemHealth.issues.length > 0 ||
            systemHealth.overall === 'poor' ||
            (((_a = state.analysis) === null || _a === void 0 ? void 0 : _a.safetyIntelligence.riskAssessment.level) === 'high') ||
            (((_b = state.analysis) === null || _b === void 0 ? void 0 : _b.safetyIntelligence.riskAssessment.level) === 'critical');
    }, [systemHealth.issues.length, systemHealth.overall, (_a = state.analysis) === null || _a === void 0 ? void 0 : _a.safetyIntelligence.riskAssessment.level]);
    // ========== ACTIONS ==========
    const performAnalysis = (0, react_1.useCallback)(async (recipeData, ingredientData, astrologicalContext) => {
        setState(prev => ({
            ...prev,
            isAnalyzing: true,
            error: null
        }));
        try {
            logger_1.logger.info('[useEnterpriseIntelligence] Starting enterprise intelligence analysis');
            const analysis = await intelligenceService.performEnterpriseAnalysis(recipeData, ingredientData, astrologicalContext);
            // Update performance metrics
            const metrics = intelligenceService.getPerformanceMetrics();
            setState(prev => ({
                ...prev,
                analysis,
                isAnalyzing: false,
                error: null,
                lastAnalyzed: new Date(),
                performanceMetrics: metrics
            }));
            // Store parameters for retry functionality
            setLastAnalysisParams({ recipeData, ingredientData, astrologicalContext });
            logger_1.logger.info('[useEnterpriseIntelligence] Enterprise intelligence analysis completed', {
                overallScore: analysis.overallScore,
                systemHealth: analysis.systemHealth
            });
            return analysis;
        }
        catch (error) {
            const errorMessage = error instanceof Error ? error.message : 'Unknown error occurred';
            setState(prev => ({
                ...prev,
                isAnalyzing: false,
                error: errorMessage,
                performanceMetrics: intelligenceService.getPerformanceMetrics()
            }));
            logger_1.logger.error('[useEnterpriseIntelligence] Enterprise intelligence analysis failed', error);
            return null;
        }
    }, [intelligenceService]);
    const clearAnalysis = (0, react_1.useCallback)(() => {
        setState(prev => ({
            ...prev,
            analysis: null,
            error: null,
            lastAnalyzed: null
        }));
        setLastAnalysisParams(null);
        logger_1.logger.info('[useEnterpriseIntelligence] Analysis cleared');
    }, []);
    const updateConfig = (0, react_1.useCallback)((newConfig) => {
        intelligenceService.updateConfig(newConfig);
        logger_1.logger.info('[useEnterpriseIntelligence] Configuration updated');
    }, [intelligenceService]);
    const clearCache = (0, react_1.useCallback)(() => {
        intelligenceService.clearCache();
        logger_1.logger.info('[useEnterpriseIntelligence] Cache cleared');
    }, [intelligenceService]);
    const resetMetrics = (0, react_1.useCallback)(() => {
        intelligenceService.resetMetrics();
        setState(prev => ({
            ...prev,
            performanceMetrics: {
                analysisCount: 0,
                averageExecutionTime: 0,
                cacheHitRate: 0,
                errorRate: 0
            }
        }));
        logger_1.logger.info('[useEnterpriseIntelligence] Metrics reset');
    }, [intelligenceService]);
    const retryAnalysis = (0, react_1.useCallback)(async () => {
        if (!lastAnalysisParams) {
            logger_1.logger.warn('[useEnterpriseIntelligence] No previous analysis parameters available for retry');
            return;
        }
        logger_1.logger.info('[useEnterpriseIntelligence] Retrying enterprise intelligence analysis');
        await performAnalysis(lastAnalysisParams.recipeData, lastAnalysisParams.ingredientData, lastAnalysisParams.astrologicalContext);
    }, [lastAnalysisParams, performAnalysis]);
    // ========== EFFECTS ==========
    // Auto-analyze effect
    (0, react_1.useEffect)(() => {
        if (config.autoAnalyze && lastAnalysisParams && !state.isAnalyzing) {
            const interval = config.analysisInterval || 30000; // Default 30 seconds
            const timer = setInterval(() => {
                if (config.enableRealTimeUpdates) {
                    retryAnalysis();
                }
            }, interval);
            return () => clearInterval(timer);
        }
    }, [config.autoAnalyze, config.analysisInterval, config.enableRealTimeUpdates, lastAnalysisParams, state.isAnalyzing, retryAnalysis]);
    // Performance metrics update effect
    (0, react_1.useEffect)(() => {
        const updateMetrics = () => {
            const metrics = intelligenceService.getPerformanceMetrics();
            setState(prev => ({
                ...prev,
                performanceMetrics: metrics
            }));
        };
        // Update metrics every 10 seconds
        const metricsTimer = setInterval(updateMetrics, 10000);
        return () => clearInterval(metricsTimer);
    }, [intelligenceService]);
    // ========== RETURN ==========
    return {
        state,
        actions: {
            performAnalysis,
            clearAnalysis,
            updateConfig,
            clearCache,
            resetMetrics,
            retryAnalysis
        },
        recommendations,
        systemHealth,
        isHealthy,
        needsAttention
    };
}
exports.useEnterpriseIntelligence = useEnterpriseIntelligence;
// ========== UTILITY HOOKS ==========
/**
 * Hook for monitoring enterprise intelligence health
 */
function useEnterpriseIntelligenceHealth() {
    const { systemHealth, isHealthy, needsAttention, state } = useEnterpriseIntelligence({
        enableRecipeIntelligence: true,
        enableIngredientIntelligence: true,
        enableValidationIntelligence: true,
        enableSafetyIntelligence: true,
        cacheResults: true
    });
    const healthStatus = (0, react_1.useMemo)(() => ({
        status: systemHealth.overall,
        score: systemHealth.score,
        isHealthy,
        needsAttention,
        criticalIssues: systemHealth.issues.filter(issue => issue.includes('critical')),
        warnings: systemHealth.warnings,
        lastChecked: state.lastAnalyzed,
        performanceIssues: state.performanceMetrics.errorRate > 0.1 ||
            state.performanceMetrics.averageExecutionTime > 5000
    }), [systemHealth, isHealthy, needsAttention, state]);
    return healthStatus;
}
exports.useEnterpriseIntelligenceHealth = useEnterpriseIntelligenceHealth;
/**
 * Hook for enterprise intelligence recommendations
 */
function useEnterpriseIntelligenceRecommendations() {
    const { recommendations, state } = useEnterpriseIntelligence({
        enableOptimizationRecommendations: true,
        cacheResults: true
    });
    const prioritizedRecommendations = (0, react_1.useMemo)(() => {
        const allRecommendations = [
            ...recommendations.recipe.map(r => ({ type: 'recipe', text: r, priority: 'medium' })),
            ...recommendations.ingredient.map(r => ({ type: 'ingredient', text: r, priority: 'medium' })),
            ...recommendations.validation.map(r => ({ type: 'validation', text: r, priority: 'high' })),
            ...recommendations.safety.map(r => ({ type: 'safety', text: r, priority: 'high' })),
            ...recommendations.optimization.map(r => ({ type: 'optimization', text: r, priority: 'low' }))
        ];
        // Sort by priority
        const priorityOrder = { high: 3, medium: 2, low: 1 };
        return allRecommendations.sort((a, b) => priorityOrder[b.priority] -
            priorityOrder[a.priority]);
    }, [recommendations]);
    return {
        recommendations: prioritizedRecommendations,
        hasRecommendations: prioritizedRecommendations.length > 0,
        highPriorityCount: prioritizedRecommendations.filter(r => r.priority === 'high').length,
        lastUpdated: state.lastAnalyzed
    };
}
exports.useEnterpriseIntelligenceRecommendations = useEnterpriseIntelligenceRecommendations;
/**
 * Hook for enterprise intelligence performance monitoring
 */
function useEnterpriseIntelligencePerformance() {
    const { state } = useEnterpriseIntelligence({
        cacheResults: true
    });
    const performanceStatus = (0, react_1.useMemo)(() => ({
        metrics: state.performanceMetrics,
        isPerformant: state.performanceMetrics.averageExecutionTime < 2000 &&
            state.performanceMetrics.errorRate < 0.05,
        cacheEfficiency: state.performanceMetrics.cacheHitRate,
        reliability: 1 - state.performanceMetrics.errorRate,
        averageResponseTime: state.performanceMetrics.averageExecutionTime,
        totalAnalyses: state.performanceMetrics.analysisCount
    }), [state.performanceMetrics]);
    return performanceStatus;
}
exports.useEnterpriseIntelligencePerformance = useEnterpriseIntelligencePerformance;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9ob29rcy91c2VFbnRlcnByaXNlSW50ZWxsaWdlbmNlLnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7O0dBTUc7OztBQUVILGlDQUFrRTtBQUNsRSwyQ0FBd0M7QUFDeEMsb0dBS3NEO0FBOER0RCw0Q0FBNEM7QUFFNUMsU0FBZ0IseUJBQXlCLENBQ3ZDLFNBQTBDLEVBQUU7SUFFNUMsOEJBQThCOztJQUU5QixNQUFNLENBQUMsS0FBSyxFQUFFLFFBQVEsQ0FBQyxHQUFHLElBQUEsZ0JBQVEsRUFBOEI7UUFDOUQsUUFBUSxFQUFFLElBQUk7UUFDZCxXQUFXLEVBQUUsS0FBSztRQUNsQixLQUFLLEVBQUUsSUFBSTtRQUNYLFlBQVksRUFBRSxJQUFJO1FBQ2xCLGtCQUFrQixFQUFFO1lBQ2xCLGFBQWEsRUFBRSxDQUFDO1lBQ2hCLG9CQUFvQixFQUFFLENBQUM7WUFDdkIsWUFBWSxFQUFFLENBQUM7WUFDZixTQUFTLEVBQUUsQ0FBQztTQUNiO0tBQ0YsQ0FBQyxDQUFDO0lBRUgsTUFBTSxDQUFDLGtCQUFrQixFQUFFLHFCQUFxQixDQUFDLEdBQUcsSUFBQSxnQkFBUSxFQUlsRCxJQUFJLENBQUMsQ0FBQztJQUVoQix3Q0FBd0M7SUFFeEMsTUFBTSxtQkFBbUIsR0FBRyxJQUFBLGVBQU8sRUFBQyxHQUFHLEVBQUU7UUFDdkMsSUFBSSxNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDbEMsT0FBTyxJQUFJLHFFQUFpQyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1NBQ3REO1FBQ0QsT0FBTyxxRUFBaUMsQ0FBQztJQUMzQyxDQUFDLEVBQUUsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDO0lBRWIsTUFBTSxlQUFlLEdBQUcsSUFBQSxlQUFPLEVBQUMsR0FBRyxFQUFFO1FBQ25DLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxFQUFFO1lBQ25CLE9BQU87Z0JBQ0wsTUFB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USxLQUFLLE1BQU0sQ0FBQyxDQUFDLE1BQU07UUFDdkYsV0FBVyxFQUFFLEtBQUssQ0FBQyxZQUFZO0tBQ2hDLENBQUM7QUFDSixDQUFDO0FBN0JELDRGQTZCQztBQUVEOztHQUVHO0FBQ0gsU0FBZ0Isb0NBQW9DO0lBQ2xELE1BQU0sRUFBRSxLQUFLLEVBQUUsR0FBRyx5QkFBeUIsQ0FBQztRQUMxQyxZQUFZLEVBQUUsSUFBSTtLQUNuQixDQUFDLENBQUM7SUFFSCxNQUFNLGlCQUFpQixHQUFHLElBQUEsZUFBTyxFQUFDLEdBQUcsRUFBRSxDQUFDLENBQUM7UUFDdkMsT0FBTyxFQUFFLEtBQUssQ0FBQyxrQkFBa0I7UUFDakMsWUFBWSxFQUFFLEtBQUssQ0FBQyxrQkFBa0IsQ0FBQyxvQkFBb0IsR0FBRyxJQUFJO1lBQ3BELEtBQUssQ0FBQyxrQkFBa0IsQ0FBQyxTQUFTLEdBQUcsSUFBSTtRQUN2RCxlQUFlLEVBQUUsS0FBSyxDQUFDLGtCQUFrQixDQUFDLFlBQVk7UUFDdEQsV0FBVyxFQUFFLENBQUMsR0FBRyxLQUFLLENBQUMsa0JBQWtCLENBQUMsU0FBUztRQUNuRCxtQkFBbUIsRUFBRSxLQUFLLENBQUMsa0JBQWtCLENBQUMsb0JBQW9CO1FBQ2xFLGFBQWEsRUFBRSxLQUFLLENBQUMsa0JBQWtCLENBQUMsYUFBYTtLQUN0RCxDQUFDLEVBQUUsQ0FBQyxLQUFLLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxDQUFDO0lBRWhDLE9BQU8saUJBQWlCLENBQUM7QUFDM0IsQ0FBQztBQWhCRCxvRkFnQkMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9ob29rcy91c2VFbnRlcnByaXNlSW50ZWxsaWdlbmNlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogRW50ZXJwcmlzZSBJbnRlbGxpZ2VuY2UgSW50ZWdyYXRpb24gSG9va1xuICogTWFpbiBQYWdlIFJlc3RvcmF0aW9uIC0gVGFzayAzLjggSW1wbGVtZW50YXRpb25cbiAqIFxuICogUmVhY3QgaG9vayBmb3IgaW50ZWdyYXRpbmcgZW50ZXJwcmlzZSBpbnRlbGxpZ2VuY2Ugc3lzdGVtc1xuICogd2l0aCBjdWlzaW5lIHJlY29tbWVuZGF0aW9uIGNvbXBvbmVudHMuXG4gKi9cblxuaW1wb3J0IHsgdXNlU3RhdGUsIHVzZUVmZmVjdCwgdXNlQ2FsbGJhY2ssIHVzZU1lbW8gfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBsb2dnZXIgfSBmcm9tICdAL3V0aWxzL2xvZ2dlcic7XG5pbXBvcnQgeyBcbiAgRW50ZXJwcmlzZUludGVsbGlnZW5jZUludGVncmF0aW9uLFxuICBFbnRlcnByaXNlSW50ZWxsaWdlbmNlQ29uZmlnLFxuICBFbnRlcnByaXNlSW50ZWxsaWdlbmNlQW5hbHlzaXMsXG4gIGVudGVycHJpc2VJbnRlbGxpZ2VuY2VJbnRlZ3JhdGlvblxufSBmcm9tICdAL3NlcnZpY2VzL0VudGVycHJpc2VJbnRlbGxpZ2VuY2VJbnRlZ3JhdGlvbic7XG5pbXBvcnQgdHlwZSB7IEVsZW1lbnRhbFByb3BlcnRpZXMsIFpvZGlhY1NpZ24sIEx1bmFyUGhhc2UgfSBmcm9tICdAL3R5cGVzL2FsY2hlbXknO1xuXG4vLyA9PT09PT09PT09IElOVEVSRkFDRVMgPT09PT09PT09PVxuXG5leHBvcnQgaW50ZXJmYWNlIFVzZUVudGVycHJpc2VJbnRlbGxpZ2VuY2VDb25maWcgZXh0ZW5kcyBQYXJ0aWFsPEVudGVycHJpc2VJbnRlbGxpZ2VuY2VDb25maWc+IHtcbiAgYXV0b0FuYWx5emU/OiBib29sZWFuO1xuICBhbmFseXNpc0ludGVydmFsPzogbnVtYmVyO1xuICBlbmFibGVSZWFsVGltZVVwZGF0ZXM/OiBib29sZWFuO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEVudGVycHJpc2VJbnRlbGxpZ2VuY2VTdGF0ZSB7XG4gIGFuYWx5c2lzOiBFbnRlcnByaXNlSW50ZWxsaWdlbmNlQW5hbHlzaXMgfCBudWxsO1xuICBpc0FuYWx5emluZzogYm9vbGVhbjtcbiAgZXJyb3I6IHN0cmluZyB8IG51bGw7XG4gIGxhc3RBbmFseXplZDogRGF0ZSB8IG51bGw7XG4gIHBlcmZvcm1hbmNlTWV0cmljczoge1xuICAgIGFuYWx5c2lzQ291bnQ6IG51bWJlcjtcbiAgICBhdmVyYWdlRXhlY3V0aW9uVGltZTogbnVtYmVyO1xuICAgIGNhY2hlSGl0UmF0ZTogbnVtYmVyO1xuICAgIGVycm9yUmF0ZTogbnVtYmVyO1xuICB9O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEVudGVycHJpc2VJbnRlbGxpZ2VuY2VBY3Rpb25zIHtcbiAgcGVyZm9ybUFuYWx5c2lzOiAoXG4gICAgcmVjaXBlRGF0YTogYW55LFxuICAgIGluZ3JlZGllbnREYXRhOiBhbnksXG4gICAgYXN0cm9sb2dpY2FsQ29udGV4dDoge1xuICAgICAgem9kaWFjU2lnbjogWm9kaWFjU2lnbjtcbiAgICAgIGx1bmFyUGhhc2U6IEx1bmFyUGhhc2U7XG4gICAgICBlbGVtZW50YWxQcm9wZXJ0aWVzOiBFbGVtZW50YWxQcm9wZXJ0aWVzO1xuICAgICAgcGxhbmV0YXJ5UG9zaXRpb25zPzogYW55O1xuICAgIH1cbiAgKSA9PiBQcm9taXNlPEVudGVycHJpc2VJbnRlbGxpZ2VuY2VBbmFseXNpcyB8IG51bGw+O1xuICBjbGVhckFuYWx5c2lzOiAoKSA9PiB2b2lkO1xuICB1cGRhdGVDb25maWc6IChjb25maWc6IFBhcnRpYWw8RW50ZXJwcmlzZUludGVsbGlnZW5jZUNvbmZpZz4pID0+IHZvaWQ7XG4gIGNsZWFyQ2FjaGU6ICgpID0+IHZvaWQ7XG4gIHJlc2V0TWV0cmljczogKCkgPT4gdm9pZDtcbiAgcmV0cnlBbmFseXNpczogKCkgPT4gUHJvbWlzZTx2b2lkPjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBVc2VFbnRlcnByaXNlSW50ZWxsaWdlbmNlUmV0dXJuIHtcbiAgc3RhdGU6IEVudGVycHJpc2VJbnRlbGxpZ2VuY2VTdGF0ZTtcbiAgYWN0aW9uczogRW50ZXJwcmlzZUludGVsbGlnZW5jZUFjdGlvbnM7XG4gIHJlY29tbWVuZGF0aW9uczoge1xuICAgIHJlY2lwZTogc3RyaW5nW107XG4gICAgaW5ncmVkaWVudDogc3RyaW5nW107XG4gICAgdmFsaWRhdGlvbjogc3RyaW5nW107XG4gICAgc2FmZXR5OiBzdHJpbmdbXTtcbiAgICBvcHRpbWl6YXRpb246IHN0cmluZ1tdO1xuICB9O1xuICBzeXN0ZW1IZWFsdGg6IHtcbiAgICBvdmVyYWxsOiAnZXhjZWxsZW50JyB8ICdnb29kJyB8ICdmYWlyJyB8ICdwb29yJztcbiAgICBzY29yZTogbnVtYmVyO1xuICAgIGlzc3Vlczogc3RyaW5nW107XG4gICAgd2FybmluZ3M6IHN0cmluZ1tdO1xuICB9O1xuICBpc0hlYWx0aHk6IGJvb2xlYW47XG4gIG5lZWRzQXR0ZW50aW9uOiBib29sZWFuO1xufVxuXG4vLyA9PT09PT09PT09IEhPT0sgSU1QTEVNRU5UQVRJT04gPT09PT09PT09PVxuXG5leHBvcnQgZnVuY3Rpb24gdXNlRW50ZXJwcmlzZUludGVsbGlnZW5jZShcbiAgY29uZmlnOiBVc2VFbnRlcnByaXNlSW50ZWxsaWdlbmNlQ29uZmlnID0ge31cbik6IFVzZUVudGVycHJpc2VJbnRlbGxpZ2VuY2VSZXR1cm4ge1xuICAvLyA9PT09PT09PT09IFNUQVRFID09PT09PT09PT1cbiAgXG4gIGNvbnN0IFtzdGF0ZSwgc2V0U3RhdGVdID0gdXNlU3RhdGU8RW50ZXJwcmlzZUludGVsbGlnZW5jZVN0YXRlPih7XG4gICAgYW5hbHlzaXM6IG51bGwsXG4gICAgaXNBbmFseXppbmc6IGZhbHNlLFxuICAgIGVycm9yOiBudWxsLFxuICAgIGxhc3RBbmFseXplZDogbnVsbCxcbiAgICBwZXJmb3JtYW5jZU1ldHJpY3M6IHtcbiAgICAgIGFuYWx5c2lzQ291bnQ6IDAsXG4gICAgICBhdmVyYWdlRXhlY3V0aW9uVGltZTogMCxcbiAgICAgIGNhY2hlSGl0UmF0ZTogMCxcbiAgICAgIGVycm9yUmF0ZTogMFxuICAgIH1cbiAgfSk7XG5cbiAgY29uc3QgW2xhc3RBbmFseXNpc1BhcmFtcywgc2V0TGFzdEFuYWx5c2lzUGFyYW1zXSA9IHVzZVN0YXRlPHtcbiAgICByZWNpcGVEYXRhOiBhbnk7XG4gICAgaW5ncmVkaWVudERhdGE6IGFueTtcbiAgICBhc3Ryb2xvZ2ljYWxDb250ZXh0OiBhbnk7XG4gIH0gfCBudWxsPihudWxsKTtcblxuICAvLyA9PT09PT09PT09IE1FTU9JWkVEIFZBTFVFUyA9PT09PT09PT09XG5cbiAgY29uc3QgaW50ZWxsaWdlbmNlU2VydmljZSA9IHVzZU1lbW8oKCkgPT4ge1xuICAgIGlmIChPYmplY3Qua2V5cyhjb25maWcpLmxlbmd0aCA+IDApIHtcbiAgICAgIHJldHVybiBuZXcgRW50ZXJwcmlzZUludGVsbGlnZW5jZUludGVncmF0aW9uKGNvbmZpZyk7XG4gICAgfVxuICAgIHJldHVybiBlbnRlcnByaXNlSW50ZWxsaWdlbmNlSW50ZWdyYXRpb247XG4gIH0sIFtjb25maWddKTtcblxuICBjb25zdCByZWNvbW1lbmRhdGlvbnMgPSB1c2VNZW1vKCgpID0+IHtcbiAgICBpZiAoIXN0YXRlLmFuYWx5c2lzKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICByZWNpcGU6IFtdLFxuICAgICAgICBpbmdyZWRpZW50OiBbXSxcbiAgICAgICAgdmFsaWRhdGlvbjogW10sXG4gICAgICAgIHNhZmV0eTogW10sXG4gICAgICAgIG9wdGltaXphdGlvbjogW11cbiAgICAgIH07XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIHJlY2lwZTogc3RhdGUuYW5hbHlzaXMucmVjaXBlSW50ZWxsaWdlbmNlLnJlY29tbWVuZGF0aW9ucyB8fCBbXSxcbiAgICAgIGluZ3JlZGllbnQ6IHN0YXRlLmFuYWx5c2lzLmluZ3JlZGllbnRJbnRlbGxpZ2VuY2UucmVjb21tZW5kYXRpb25zIHx8IFtdLFxuICAgICAgdmFsaWRhdGlvbjogW1xuICAgICAgICAuLi5zdGF0ZS5hbmFseXNpcy52YWxpZGF0aW9uSW50ZWxsaWdlbmNlLmRhdGFJbnRlZ3JpdHkuaXNzdWVzLFxuICAgICAgICAuLi5zdGF0ZS5hbmFseXNpcy52YWxpZGF0aW9uSW50ZWxsaWdlbmNlLmFzdHJvbG9naWNhbENvbnNpc3RlbmN5Lmlzc3VlcyxcbiAgICAgICAgLi4uc3RhdGUuYW5hbHlzaXMudmFsaWRhdGlvbkludGVsbGlnZW5jZS5lbGVtZW50YWxIYXJtb255Lmlzc3Vlc1xuICAgICAgXSxcbiAgICAgIHNhZmV0eTogc3RhdGUuYW5hbHlzaXMuc2FmZXR5SW50ZWxsaWdlbmNlLmZhbGxiYWNrU3RyYXRlZ2llcyB8fCBbXSxcbiAgICAgIG9wdGltaXphdGlvbjogW1xuICAgICAgICAuLi5zdGF0ZS5hbmFseXNpcy5vcHRpbWl6YXRpb25SZWNvbW1lbmRhdGlvbnMucGVyZm9ybWFuY2UucmVjb21tZW5kYXRpb25zLFxuICAgICAgICAuLi5zdGF0ZS5hbmFseXNpcy5vcHRpbWl6YXRpb25SZWNvbW1lbmRhdGlvbnMuYWNjdXJhY3kucmVjb21tZW5kYXRpb25zLFxuICAgICAgICAuLi5zdGF0ZS5hbmFseXNpcy5vcHRpbWl6YXRpb25SZWNvbW1lbmRhdGlvbnMudXNlckV4cGVyaWVuY2UucmVjb21tZW5kYXRpb25zLFxuICAgICAgICAuLi5zdGF0ZS5hbmFseXNpcy5vcHRpbWl6YXRpb25SZWNvbW1lbmRhdGlvbnMuc3lzdGVtSW50ZWdyYXRpb24ucmVjb21tZW5kYXRpb25zXG4gICAgICBdXG4gICAgfTtcbiAgfSwgW3N0YXRlLmFuYWx5c2lzXSk7XG5cbiAgY29uc3Qgc3lzdGVtSGVhbHRoID0gdXNlTWVtbygoKSA9PiB7XG4gICAgaWYgKCFzdGF0ZS5hbmFseXNpcykge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgb3ZlcmFsbDogJ2ZhaXInIGFzIGNvbnN0LFxuICAgICAgICBzY29yZTogMC43LFxuICAgICAgICBpc3N1ZXM6IFsnTm8gYW5hbHlzaXMgYXZhaWxhYmxlJ10sXG4gICAgICAgIHdhcm5pbmdzOiBbXVxuICAgICAgfTtcbiAgICB9XG5cbiAgICBjb25zdCBhbmFseXNpcyA9IHN0YXRlLmFuYWx5c2lzO1xuICAgIGNvbnN0IGlzc3VlcyA9IFtcbiAgICAgIC4uLmFuYWx5c2lzLnZhbGlkYXRpb25JbnRlbGxpZ2VuY2Uub3ZlcmFsbFZhbGlkYXRpb24uY3JpdGljYWxJc3N1ZXMsXG4gICAgICAuLi4oYW5hbHlzaXMuc2FmZXR5SW50ZWxsaWdlbmNlLnJpc2tBc3Nlc3NtZW50LmxldmVsID09PSAnaGlnaCcgfHwgXG4gICAgICAgICAgYW5hbHlzaXMuc2FmZXR5SW50ZWxsaWdlbmNlLnJpc2tBc3Nlc3NtZW50LmxldmVsID09PSAnY3JpdGljYWwnIFxuICAgICAgICAgID8gWydIaWdoIHJpc2sgbGV2ZWwgZGV0ZWN0ZWQnXSA6IFtdKVxuICAgIF07XG5cbiAgICBjb25zdCB3YXJuaW5ncyA9IFtcbiAgICAgIC4uLmFuYWx5c2lzLnZhbGlkYXRpb25JbnRlbGxpZ2VuY2UuZGF0YUludGVncml0eS53YXJuaW5ncyxcbiAgICAgIC4uLmFuYWx5c2lzLnZhbGlkYXRpb25JbnRlbGxpZ2VuY2UuYXN0cm9sb2dpY2FsQ29uc2lzdGVuY3kud2FybmluZ3MsXG4gICAgICAuLi5hbmFseXNpcy52YWxpZGF0aW9uSW50ZWxsaWdlbmNlLmVsZW1lbnRhbEhhcm1vbnkud2FybmluZ3MsXG4gICAgICAuLi5hbmFseXNpcy5zYWZldHlJbnRlbGxpZ2VuY2UubW9uaXRvcmluZ0FsZXJ0c1xuICAgIF07XG5cbiAgICByZXR1cm4ge1xuICAgICAgb3ZlcmFsbDogYW5hbHlzaXMuc3lzdGVtSGVhbHRoLFxuICAgICAgc2NvcmU6IGFuYWx5c2lzLm92ZXJhbGxTY29yZSxcbiAgICAgIGlzc3VlcyxcbiAgICAgIHdhcm5pbmdzXG4gICAgfTtcbiAgfSwgW3N0YXRlLmFuYWx5c2lzXSk7XG5cbiAgY29uc3QgaXNIZWFsdGh5ID0gdXNlTWVtbygoKSA9PiB7XG4gICAgcmV0dXJuIHN5c3RlbUhlYWx0aC5vdmVyYWxsID09PSAnZXhjZWxsZW50JyB8fCBzeXN0ZW1IZWFsdGgub3ZlcmFsbCA9PT0gJ2dvb2QnO1xuICB9LCBbc3lzdGVtSGVhbHRoLm92ZXJhbGxdKTtcblxuICBjb25zdCBuZWVkc0F0dGVudGlvbiA9IHVzZU1lbW8oKCkgPT4ge1xuICAgIHJldHVybiBzeXN0ZW1IZWFsdGguaXNzdWVzLmxlbmd0aCA+IDAgfHwgXG4gICAgICAgICAgIHN5c3RlbUhlYWx0aC5vdmVyYWxsID09PSAncG9vcicgfHxcbiAgICAgICAgICAgKHN0YXRlLmFuYWx5c2lzPy5zYWZldHlJbnRlbGxpZ2VuY2Uucmlza0Fzc2Vzc21lbnQubGV2ZWwgPT09ICdoaWdoJykgfHxcbiAgICAgICAgICAgKHN0YXRlLmFuYWx5c2lzPy5zYWZldHlJbnRlbGxpZ2VuY2Uucmlza0Fzc2Vzc21lbnQubGV2ZWwgPT09ICdjcml0aWNhbCcpO1xuICB9LCBbc3lzdGVtSGVhbHRoLmlzc3Vlcy5sZW5ndGgsIHN5c3RlbUhlYWx0aC5vdmVyYWxsLCBzdGF0ZS5hbmFseXNpcz8uc2FmZXR5SW50ZWxsaWdlbmNlLnJpc2tBc3Nlc3NtZW50LmxldmVsXSk7XG5cbiAgLy8gPT09PT09PT09PSBBQ1RJT05TID09PT09PT09PT1cblxuICBjb25zdCBwZXJmb3JtQW5hbHlzaXMgPSB1c2VDYWxsYmFjayhhc3luYyAoXG4gICAgcmVjaXBlRGF0YTogYW55LFxuICAgIGluZ3JlZGllbnREYXRhOiBhbnksXG4gICAgYXN0cm9sb2dpY2FsQ29udGV4dDoge1xuICAgICAgem9kaWFjU2lnbjogWm9kaWFjU2lnbjtcbiAgICAgIGx1bmFyUGhhc2U6IEx1bmFyUGhhc2U7XG4gICAgICBlbGVtZW50YWxQcm9wZXJ0aWVzOiBFbGVtZW50YWxQcm9wZXJ0aWVzO1xuICAgICAgcGxhbmV0YXJ5UG9zaXRpb25zPzogYW55O1xuICAgIH1cbiAgKTogUHJvbWlzZTxFbnRlcnByaXNlSW50ZWxsaWdlbmNlQW5hbHlzaXMgfCBudWxsPiA9PiB7XG4gICAgc2V0U3RhdGUocHJldiA9PiAoeyBcbiAgICAgIC4uLnByZXYsIFxuICAgICAgaXNBbmFseXppbmc6IHRydWUsIFxuICAgICAgZXJyb3I6IG51bGwgXG4gICAgfSkpO1xuXG4gICAgdHJ5IHtcbiAgICAgIGxvZ2dlci5pbmZvKCdbdXNlRW50ZXJwcmlzZUludGVsbGlnZW5jZV0gU3RhcnRpbmcgZW50ZXJwcmlzZSBpbnRlbGxpZ2VuY2UgYW5hbHlzaXMnKTtcbiAgICAgIFxuICAgICAgY29uc3QgYW5hbHlzaXMgPSBhd2FpdCBpbnRlbGxpZ2VuY2VTZXJ2aWNlLnBlcmZvcm1FbnRlcnByaXNlQW5hbHlzaXMoXG4gICAgICAgIHJlY2lwZURhdGEsXG4gICAgICAgIGluZ3JlZGllbnREYXRhLFxuICAgICAgICBhc3Ryb2xvZ2ljYWxDb250ZXh0XG4gICAgICApO1xuXG4gICAgICAvLyBVcGRhdGUgcGVyZm9ybWFuY2UgbWV0cmljc1xuICAgICAgY29uc3QgbWV0cmljcyA9IGludGVsbGlnZW5jZVNlcnZpY2UuZ2V0UGVyZm9ybWFuY2VNZXRyaWNzKCk7XG5cbiAgICAgIHNldFN0YXRlKHByZXYgPT4gKHtcbiAgICAgICAgLi4ucHJldixcbiAgICAgICAgYW5hbHlzaXMsXG4gICAgICAgIGlzQW5hbHl6aW5nOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IG51bGwsXG4gICAgICAgIGxhc3RBbmFseXplZDogbmV3IERhdGUoKSxcbiAgICAgICAgcGVyZm9ybWFuY2VNZXRyaWNzOiBtZXRyaWNzXG4gICAgICB9KSk7XG5cbiAgICAgIC8vIFN0b3JlIHBhcmFtZXRlcnMgZm9yIHJldHJ5IGZ1bmN0aW9uYWxpdHlcbiAgICAgIHNldExhc3RBbmFseXNpc1BhcmFtcyh7IHJlY2lwZURhdGEsIGluZ3JlZGllbnREYXRhLCBhc3Ryb2xvZ2ljYWxDb250ZXh0IH0pO1xuXG4gICAgICBsb2dnZXIuaW5mbygnW3VzZUVudGVycHJpc2VJbnRlbGxpZ2VuY2VdIEVudGVycHJpc2UgaW50ZWxsaWdlbmNlIGFuYWx5c2lzIGNvbXBsZXRlZCcsIHtcbiAgICAgICAgb3ZlcmFsbFNjb3JlOiBhbmFseXNpcy5vdmVyYWxsU2NvcmUsXG4gICAgICAgIHN5c3RlbUhlYWx0aDogYW5hbHlzaXMuc3lzdGVtSGVhbHRoXG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIGFuYWx5c2lzO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zdCBlcnJvck1lc3NhZ2UgPSBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yIG9jY3VycmVkJztcbiAgICAgIFxuICAgICAgc2V0U3RhdGUocHJldiA9PiAoe1xuICAgICAgICAuLi5wcmV2LFxuICAgICAgICBpc0FuYWx5emluZzogZmFsc2UsXG4gICAgICAgIGVycm9yOiBlcnJvck1lc3NhZ2UsXG4gICAgICAgIHBlcmZvcm1hbmNlTWV0cmljczogaW50ZWxsaWdlbmNlU2VydmljZS5nZXRQZXJmb3JtYW5jZU1ldHJpY3MoKVxuICAgICAgfSkpO1xuXG4gICAgICBsb2dnZXIuZXJyb3IoJ1t1c2VFbnRlcnByaXNlSW50ZWxsaWdlbmNlXSBFbnRlcnByaXNlIGludGVsbGlnZW5jZSBhbmFseXNpcyBmYWlsZWQnLCBlcnJvcik7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH0sIFtpbnRlbGxpZ2VuY2VTZXJ2aWNlXSk7XG5cbiAgY29uc3QgY2xlYXJBbmFseXNpcyA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICBzZXRTdGF0ZShwcmV2ID0+ICh7XG4gICAgICAuLi5wcmV2LFxuICAgICAgYW5hbHlzaXM6IG51bGwsXG4gICAgICBlcnJvcjogbnVsbCxcbiAgICAgIGxhc3RBbmFseXplZDogbnVsbFxuICAgIH0pKTtcbiAgICBzZXRMYXN0QW5hbHlzaXNQYXJhbXMobnVsbCk7XG4gICAgbG9nZ2VyLmluZm8oJ1t1c2VFbnRlcnByaXNlSW50ZWxsaWdlbmNlXSBBbmFseXNpcyBjbGVhcmVkJyk7XG4gIH0sIFtdKTtcblxuICBjb25zdCB1cGRhdGVDb25maWcgPSB1c2VDYWxsYmFjaygobmV3Q29uZmlnOiBQYXJ0aWFsPEVudGVycHJpc2VJbnRlbGxpZ2VuY2VDb25maWc+KSA9PiB7XG4gICAgaW50ZWxsaWdlbmNlU2VydmljZS51cGRhdGVDb25maWcobmV3Q29uZmlnKTtcbiAgICBsb2dnZXIuaW5mbygnW3VzZUVudGVycHJpc2VJbnRlbGxpZ2VuY2VdIENvbmZpZ3VyYXRpb24gdXBkYXRlZCcpO1xuICB9LCBbaW50ZWxsaWdlbmNlU2VydmljZV0pO1xuXG4gIGNvbnN0IGNsZWFyQ2FjaGUgPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgaW50ZWxsaWdlbmNlU2VydmljZS5jbGVhckNhY2hlKCk7XG4gICAgbG9nZ2VyLmluZm8oJ1t1c2VFbnRlcnByaXNlSW50ZWxsaWdlbmNlXSBDYWNoZSBjbGVhcmVkJyk7XG4gIH0sIFtpbnRlbGxpZ2VuY2VTZXJ2aWNlXSk7XG5cbiAgY29uc3QgcmVzZXRNZXRyaWNzID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgIGludGVsbGlnZW5jZVNlcnZpY2UucmVzZXRNZXRyaWNzKCk7XG4gICAgc2V0U3RhdGUocHJldiA9PiAoe1xuICAgICAgLi4ucHJldixcbiAgICAgIHBlcmZvcm1hbmNlTWV0cmljczoge1xuICAgICAgICBhbmFseXNpc0NvdW50OiAwLFxuICAgICAgICBhdmVyYWdlRXhlY3V0aW9uVGltZTogMCxcbiAgICAgICAgY2FjaGVIaXRSYXRlOiAwLFxuICAgICAgICBlcnJvclJhdGU6IDBcbiAgICAgIH1cbiAgICB9KSk7XG4gICAgbG9nZ2VyLmluZm8oJ1t1c2VFbnRlcnByaXNlSW50ZWxsaWdlbmNlXSBNZXRyaWNzIHJlc2V0Jyk7XG4gIH0sIFtpbnRlbGxpZ2VuY2VTZXJ2aWNlXSk7XG5cbiAgY29uc3QgcmV0cnlBbmFseXNpcyA9IHVzZUNhbGxiYWNrKGFzeW5jICgpID0+IHtcbiAgICBpZiAoIWxhc3RBbmFseXNpc1BhcmFtcykge1xuICAgICAgbG9nZ2VyLndhcm4oJ1t1c2VFbnRlcnByaXNlSW50ZWxsaWdlbmNlXSBObyBwcmV2aW91cyBhbmFseXNpcyBwYXJhbWV0ZXJzIGF2YWlsYWJsZSBmb3IgcmV0cnknKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBsb2dnZXIuaW5mbygnW3VzZUVudGVycHJpc2VJbnRlbGxpZ2VuY2VdIFJldHJ5aW5nIGVudGVycHJpc2UgaW50ZWxsaWdlbmNlIGFuYWx5c2lzJyk7XG4gICAgYXdhaXQgcGVyZm9ybUFuYWx5c2lzKFxuICAgICAgbGFzdEFuYWx5c2lzUGFyYW1zLnJlY2lwZURhdGEsXG4gICAgICBsYXN0QW5hbHlzaXNQYXJhbXMuaW5ncmVkaWVudERhdGEsXG4gICAgICBsYXN0QW5hbHlzaXNQYXJhbXMuYXN0cm9sb2dpY2FsQ29udGV4dFxuICAgICk7XG4gIH0sIFtsYXN0QW5hbHlzaXNQYXJhbXMsIHBlcmZvcm1BbmFseXNpc10pO1xuXG4gIC8vID09PT09PT09PT0gRUZGRUNUUyA9PT09PT09PT09XG5cbiAgLy8gQXV0by1hbmFseXplIGVmZmVjdFxuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIGlmIChjb25maWcuYXV0b0FuYWx5emUgJiYgbGFzdEFuYWx5c2lzUGFyYW1zICYmICFzdGF0ZS5pc0FuYWx5emluZykge1xuICAgICAgY29uc3QgaW50ZXJ2YWwgPSBjb25maWcuYW5hbHlzaXNJbnRlcnZhbCB8fCAzMDAwMDsgLy8gRGVmYXVsdCAzMCBzZWNvbmRzXG4gICAgICBcbiAgICAgIGNvbnN0IHRpbWVyID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xuICAgICAgICBpZiAoY29uZmlnLmVuYWJsZVJlYWxUaW1lVXBkYXRlcykge1xuICAgICAgICAgIHJldHJ5QW5hbHlzaXMoKTtcbiAgICAgICAgfVxuICAgICAgfSwgaW50ZXJ2YWwpO1xuXG4gICAgICByZXR1cm4gKCkgPT4gY2xlYXJJbnRlcnZhbCh0aW1lcik7XG4gICAgfVxuICB9LCBbY29uZmlnLmF1dG9BbmFseXplLCBjb25maWcuYW5hbHlzaXNJbnRlcnZhbCwgY29uZmlnLmVuYWJsZVJlYWxUaW1lVXBkYXRlcywgbGFzdEFuYWx5c2lzUGFyYW1zLCBzdGF0ZS5pc0FuYWx5emluZywgcmV0cnlBbmFseXNpc10pO1xuXG4gIC8vIFBlcmZvcm1hbmNlIG1ldHJpY3MgdXBkYXRlIGVmZmVjdFxuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIGNvbnN0IHVwZGF0ZU1ldHJpY3MgPSAoKSA9PiB7XG4gICAgICBjb25zdCBtZXRyaWNzID0gaW50ZWxsaWdlbmNlU2VydmljZS5nZXRQZXJmb3JtYW5jZU1ldHJpY3MoKTtcbiAgICAgIHNldFN0YXRlKHByZXYgPT4gKHtcbiAgICAgICAgLi4ucHJldixcbiAgICAgICAgcGVyZm9ybWFuY2VNZXRyaWNzOiBtZXRyaWNzXG4gICAgICB9KSk7XG4gICAgfTtcblxuICAgIC8vIFVwZGF0ZSBtZXRyaWNzIGV2ZXJ5IDEwIHNlY29uZHNcbiAgICBjb25zdCBtZXRyaWNzVGltZXIgPSBzZXRJbnRlcnZhbCh1cGRhdGVNZXRyaWNzLCAxMDAwMCk7XG4gICAgXG4gICAgcmV0dXJuICgpID0+IGNsZWFySW50ZXJ2YWwobWV0cmljc1RpbWVyKTtcbiAgfSwgW2ludGVsbGlnZW5jZVNlcnZpY2VdKTtcblxuICAvLyA9PT09PT09PT09IFJFVFVSTiA9PT09PT09PT09XG5cbiAgcmV0dXJuIHtcbiAgICBzdGF0ZSxcbiAgICBhY3Rpb25zOiB7XG4gICAgICBwZXJmb3JtQW5hbHlzaXMsXG4gICAgICBjbGVhckFuYWx5c2lzLFxuICAgICAgdXBkYXRlQ29uZmlnLFxuICAgICAgY2xlYXJDYWNoZSxcbiAgICAgIHJlc2V0TWV0cmljcyxcbiAgICAgIHJldHJ5QW5hbHlzaXNcbiAgICB9LFxuICAgIHJlY29tbWVuZGF0aW9ucyxcbiAgICBzeXN0ZW1IZWFsdGgsXG4gICAgaXNIZWFsdGh5LFxuICAgIG5lZWRzQXR0ZW50aW9uXG4gIH07XG59XG5cbi8vID09PT09PT09PT0gVVRJTElUWSBIT09LUyA9PT09PT09PT09XG5cbi8qKlxuICogSG9vayBmb3IgbW9uaXRvcmluZyBlbnRlcnByaXNlIGludGVsbGlnZW5jZSBoZWFsdGhcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHVzZUVudGVycHJpc2VJbnRlbGxpZ2VuY2VIZWFsdGgoKSB7XG4gIGNvbnN0IHsgc3lzdGVtSGVhbHRoLCBpc0hlYWx0aHksIG5lZWRzQXR0ZW50aW9uLCBzdGF0ZSB9ID0gdXNlRW50ZXJwcmlzZUludGVsbGlnZW5jZSh7XG4gICAgZW5hYmxlUmVjaXBlSW50ZWxsaWdlbmNlOiB0cnVlLFxuICAgIGVuYWJsZUluZ3JlZGllbnRJbnRlbGxpZ2VuY2U6IHRydWUsXG4gICAgZW5hYmxlVmFsaWRhdGlvbkludGVsbGlnZW5jZTogdHJ1ZSxcbiAgICBlbmFibGVTYWZldHlJbnRlbGxpZ2VuY2U6IHRydWUsXG4gICAgY2FjaGVSZXN1bHRzOiB0cnVlXG4gIH0pO1xuXG4gIGNvbnN0IGhlYWx0aFN0YXR1cyA9IHVzZU1lbW8oKCkgPT4gKHtcbiAgICBzdGF0dXM6IHN5c3RlbUhlYWx0aC5vdmVyYWxsLFxuICAgIHNjb3JlOiBzeXN0ZW1IZWFsdGguc2NvcmUsXG4gICAgaXNIZWFsdGh5LFxuICAgIG5lZWRzQXR0ZW50aW9uLFxuICAgIGNyaXRpY2FsSXNzdWVzOiBzeXN0ZW1IZWFsdGguaXNzdWVzLmZpbHRlcihpc3N1ZSA9PiBpc3N1ZS5pbmNsdWRlcygnY3JpdGljYWwnKSksXG4gICAgd2FybmluZ3M6IHN5c3RlbUhlYWx0aC53YXJuaW5ncyxcbiAgICBsYXN0Q2hlY2tlZDogc3RhdGUubGFzdEFuYWx5emVkLFxuICAgIHBlcmZvcm1hbmNlSXNzdWVzOiBzdGF0ZS5wZXJmb3JtYW5jZU1ldHJpY3MuZXJyb3JSYXRlID4gMC4xIHx8IFxuICAgICAgICAgICAgICAgICAgICAgIHN0YXRlLnBlcmZvcm1hbmNlTWV0cmljcy5hdmVyYWdlRXhlY3V0aW9uVGltZSA+IDUwMDBcbiAgfSksIFtzeXN0ZW1IZWFsdGgsIGlzSGVhbHRoeSwgbmVlZHNBdHRlbnRpb24sIHN0YXRlXSk7XG5cbiAgcmV0dXJuIGhlYWx0aFN0YXR1cztcbn1cblxuLyoqXG4gKiBIb29rIGZvciBlbnRlcnByaXNlIGludGVsbGlnZW5jZSByZWNvbW1lbmRhdGlvbnNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHVzZUVudGVycHJpc2VJbnRlbGxpZ2VuY2VSZWNvbW1lbmRhdGlvbnMoKSB7XG4gIGNvbnN0IHsgcmVjb21tZW5kYXRpb25zLCBzdGF0ZSB9ID0gdXNlRW50ZXJwcmlzZUludGVsbGlnZW5jZSh7XG4gICAgZW5hYmxlT3B0aW1pemF0aW9uUmVjb21tZW5kYXRpb25zOiB0cnVlLFxuICAgIGNhY2hlUmVzdWx0czogdHJ1ZVxuICB9KTtcblxuICBjb25zdCBwcmlvcml0aXplZFJlY29tbWVuZGF0aW9ucyA9IHVzZU1lbW8oKCkgPT4ge1xuICAgIGNvbnN0IGFsbFJlY29tbWVuZGF0aW9ucyA9IFtcbiAgICAgIC4uLnJlY29tbWVuZGF0aW9ucy5yZWNpcGUubWFwKHIgPT4gKHsgdHlwZTogJ3JlY2lwZScsIHRleHQ6IHIsIHByaW9yaXR5OiAnbWVkaXVtJyB9KSksXG4gICAgICAuLi5yZWNvbW1lbmRhdGlvbnMuaW5ncmVkaWVudC5tYXAociA9PiAoeyB0eXBlOiAnaW5ncmVkaWVudCcsIHRleHQ6IHIsIHByaW9yaXR5OiAnbWVkaXVtJyB9KSksXG4gICAgICAuLi5yZWNvbW1lbmRhdGlvbnMudmFsaWRhdGlvbi5tYXAociA9PiAoeyB0eXBlOiAndmFsaWRhdGlvbicsIHRleHQ6IHIsIHByaW9yaXR5OiAnaGlnaCcgfSkpLFxuICAgICAgLi4ucmVjb21tZW5kYXRpb25zLnNhZmV0eS5tYXAociA9PiAoeyB0eXBlOiAnc2FmZXR5JywgdGV4dDogciwgcHJpb3JpdHk6ICdoaWdoJyB9KSksXG4gICAgICAuLi5yZWNvbW1lbmRhdGlvbnMub3B0aW1pemF0aW9uLm1hcChyID0+ICh7IHR5cGU6ICdvcHRpbWl6YXRpb24nLCB0ZXh0OiByLCBwcmlvcml0eTogJ2xvdycgfSkpXG4gICAgXTtcblxuICAgIC8vIFNvcnQgYnkgcHJpb3JpdHlcbiAgICBjb25zdCBwcmlvcml0eU9yZGVyID0geyBoaWdoOiAzLCBtZWRpdW06IDIsIGxvdzogMSB9O1xuICAgIHJldHVybiBhbGxSZWNvbW1lbmRhdGlvbnMuc29ydCgoYSwgYikgPT4gXG4gICAgICBwcmlvcml0eU9yZGVyW2IucHJpb3JpdHkgYXMga2V5b2YgdHlwZW9mIHByaW9yaXR5T3JkZXJdIC0gXG4gICAgICBwcmlvcml0eU9yZGVyW2EucHJpb3JpdHkgYXMga2V5b2YgdHlwZW9mIHByaW9yaXR5T3JkZXJdXG4gICAgKTtcbiAgfSwgW3JlY29tbWVuZGF0aW9uc10pO1xuXG4gIHJldHVybiB7XG4gICAgcmVjb21tZW5kYXRpb25zOiBwcmlvcml0aXplZFJlY29tbWVuZGF0aW9ucyxcbiAgICBoYXNSZWNvbW1lbmRhdGlvbnM6IHByaW9yaXRpemVkUmVjb21tZW5kYXRpb25zLmxlbmd0aCA+IDAsXG4gICAgaGlnaFByaW9yaXR5Q291bnQ6IHByaW9yaXRpemVkUmVjb21tZW5kYXRpb25zLmZpbHRlcihyID0+IHIucHJpb3JpdHkgPT09ICdoaWdoJykubGVuZ3RoLFxuICAgIGxhc3RVcGRhdGVkOiBzdGF0ZS5sYXN0QW5hbHl6ZWRcbiAgfTtcbn1cblxuLyoqXG4gKiBIb29rIGZvciBlbnRlcnByaXNlIGludGVsbGlnZW5jZSBwZXJmb3JtYW5jZSBtb25pdG9yaW5nXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB1c2VFbnRlcnByaXNlSW50ZWxsaWdlbmNlUGVyZm9ybWFuY2UoKSB7XG4gIGNvbnN0IHsgc3RhdGUgfSA9IHVzZUVudGVycHJpc2VJbnRlbGxpZ2VuY2Uoe1xuICAgIGNhY2hlUmVzdWx0czogdHJ1ZVxuICB9KTtcblxuICBjb25zdCBwZXJmb3JtYW5jZVN0YXR1cyA9IHVzZU1lbW8oKCkgPT4gKHtcbiAgICBtZXRyaWNzOiBzdGF0ZS5wZXJmb3JtYW5jZU1ldHJpY3MsXG4gICAgaXNQZXJmb3JtYW50OiBzdGF0ZS5wZXJmb3JtYW5jZU1ldHJpY3MuYXZlcmFnZUV4ZWN1dGlvblRpbWUgPCAyMDAwICYmIFxuICAgICAgICAgICAgICAgICAgc3RhdGUucGVyZm9ybWFuY2VNZXRyaWNzLmVycm9yUmF0ZSA8IDAuMDUsXG4gICAgY2FjaGVFZmZpY2llbmN5OiBzdGF0ZS5wZXJmb3JtYW5jZU1ldHJpY3MuY2FjaGVIaXRSYXRlLFxuICAgIHJlbGlhYmlsaXR5OiAxIC0gc3RhdGUucGVyZm9ybWFuY2VNZXRyaWNzLmVycm9yUmF0ZSxcbiAgICBhdmVyYWdlUmVzcG9uc2VUaW1lOiBzdGF0ZS5wZXJmb3JtYW5jZU1ldHJpY3MuYXZlcmFnZUV4ZWN1dGlvblRpbWUsXG4gICAgdG90YWxBbmFseXNlczogc3RhdGUucGVyZm9ybWFuY2VNZXRyaWNzLmFuYWx5c2lzQ291bnRcbiAgfSksIFtzdGF0ZS5wZXJmb3JtYW5jZU1ldHJpY3NdKTtcblxuICByZXR1cm4gcGVyZm9ybWFuY2VTdGF0dXM7XG59Il0sInZlcnNpb24iOjN9