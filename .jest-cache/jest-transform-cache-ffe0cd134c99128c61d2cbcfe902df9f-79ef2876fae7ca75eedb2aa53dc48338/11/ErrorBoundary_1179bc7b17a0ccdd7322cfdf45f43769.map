{"file":"/Users/GregCastro/Desktop/WhatToEatNext/src/components/error-boundaries/ErrorBoundary.tsx","mappings":"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","names":[],"sources":["/Users/GregCastro/Desktop/WhatToEatNext/src/components/error-boundaries/ErrorBoundary.tsx"],"sourcesContent":["'use client';\n\nimport React, { Component, ErrorInfo, ReactNode, memo } from 'react';\n\nimport { logger } from '@/utils/logger';\n\ninterface ErrorBoundaryProps {\n  children: ReactNode;\n  fallback?: (error: Error, errorInfo: ErrorInfo) => ReactNode;\n  onError?: (error: Error, errorInfo: ErrorInfo) => void;\n  resetOnPropsChange?: boolean;\n  resetKeys?: Array<string | number>;\n  isolate?: boolean;\n}\n\ninterface ErrorBoundaryState {\n  hasError: boolean;\n  error: Error | null;\n  errorInfo: ErrorInfo | null;\n  errorId: string;\n  retryCount: number;\n  lastResetKeys?: Array<string | number>;\n}\n\n// Default fallback component with user-friendly error messages\nconst DefaultErrorFallback = memo(function DefaultErrorFallback({ \n  error, \n  errorInfo, \n  onRetry, \n  retryCount,\n  maxRetries = 3 \n}: {\n  error: Error;\n  errorInfo: ErrorInfo;\n  onRetry: () => void;\n  retryCount: number;\n  maxRetries?: number;\n}) {\n  const isDevelopment = process.env.NODE_ENV === 'development';\n  \n  return (\n    <div className=\"bg-red-50 border border-red-200 rounded-lg p-6 m-4\">\n      <div className=\"flex items-center space-x-2 mb-4\">\n        <div className=\"flex-shrink-0\">\n          <svg className=\"h-5 w-5 text-red-400\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n            <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z\" clipRule=\"evenodd\" />\n          </svg>\n        </div>\n        <h3 className=\"text-lg font-medium text-red-800\">\n          Something went wrong\n        </h3>\n      </div>\n      \n      <div className=\"mb-4\">\n        <p className=\"text-red-700 mb-2\">\n          We encountered an unexpected error. This has been logged and we're working to fix it.\n        </p>\n        \n        {isDevelopment && (\n          <details className=\"mt-4\">\n            <summary className=\"cursor-pointer text-red-600 font-medium mb-2\">\n              Technical Details (Development Mode)\n            </summary>\n            <div className=\"bg-red-100 p-3 rounded border text-sm font-mono\">\n              <div className=\"mb-2\">\n                <strong>Error:</strong> {error.message}\n              </div>\n              <div className=\"mb-2\">\n                <strong>Stack:</strong>\n                <pre className=\"whitespace-pre-wrap text-xs mt-1\">\n                  {error.stack}\n                </pre>\n              </div>\n              {errorInfo.componentStack && (\n                <div>\n                  <strong>Component Stack:</strong>\n                  <pre className=\"whitespace-pre-wrap text-xs mt-1\">\n                    {errorInfo.componentStack}\n                  </pre>\n                </div>\n              )}\n            </div>\n          </details>\n        )}\n      </div>\n      \n      <div className=\"flex items-center space-x-3\">\n        {retryCount < maxRetries && (\n          <button\n            onClick={onRetry}\n            className=\"bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700 transition-colors focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2\"\n          >\n            Try Again ({maxRetries - retryCount} attempts left)\n          </button>\n        )}\n        \n        <button\n          onClick={() => window.location.reload()}\n          className=\"bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700 transition-colors focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2\"\n        >\n          Reload Page\n        </button>\n        \n        {retryCount >= maxRetries && (\n          <p className=\"text-red-600 text-sm\">\n            Maximum retry attempts reached. Please reload the page or contact support.\n          </p>\n        )}\n      </div>\n    </div>\n  );\n});\n\nclass ErrorBoundary extends Component<ErrorBoundaryProps, ErrorBoundaryState> {\n  private resetTimeoutId: number | null = null;\n\n  constructor(props: ErrorBoundaryProps) {\n    super(props);\n    \n    this.state = {\n      hasError: false,\n      error: null,\n      errorInfo: null,\n      errorId: '',\n      retryCount: 0,\n      lastResetKeys: props.resetKeys\n    };\n  }\n\n  static getDerivedStateFromError(error: Error): Partial<ErrorBoundaryState> {\n    // Generate unique error ID for tracking\n    const errorId = `error_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n    \n    return {\n      hasError: true,\n      error,\n      errorId\n    };\n  }\n\n  componentDidCatch(error: Error, errorInfo: ErrorInfo) {\n    // Log error details\n    logger.error('ErrorBoundary caught an error:', {\n      error: error.message,\n      stack: error.stack,\n      componentStack: errorInfo.componentStack,\n      errorId: this.state.errorId,\n      retryCount: this.state.retryCount\n    });\n\n    // Update state with error info\n    this.setState({\n      errorInfo\n    });\n\n    // Call custom error handler if provided\n    if (this.props.onError) {\n      this.props.onError(error, errorInfo);\n    }\n\n    // Report to external error tracking service if available\n    if (typeof window !== 'undefined' && (window as any).reportError) {\n      (window as any).reportError(error, {\n        componentStack: errorInfo.componentStack,\n        errorId: this.state.errorId\n      });\n    }\n  }\n\n  componentDidUpdate(prevProps: ErrorBoundaryProps) {\n    const { resetKeys, resetOnPropsChange } = this.props;\n    const { hasError, lastResetKeys } = this.state;\n\n    // Reset error state if resetKeys have changed\n    if (hasError && resetKeys && lastResetKeys) {\n      const hasResetKeyChanged = resetKeys.some((key, index) => \n        key !== lastResetKeys[index]\n      );\n\n      if (hasResetKeyChanged) {\n        this.resetErrorBoundary();\n      }\n    }\n\n    // Reset error state if resetOnPropsChange is true and props have changed\n    if (hasError && resetOnPropsChange && prevProps !== this.props) {\n      this.resetErrorBoundary();\n    }\n  }\n\n  componentWillUnmount() {\n    if (this.resetTimeoutId) {\n      clearTimeout(this.resetTimeoutId);\n    }\n  }\n\n  resetErrorBoundary = () => {\n    if (this.resetTimeoutId) {\n      clearTimeout(this.resetTimeoutId);\n    }\n\n    this.setState(prevState => ({\n      hasError: false,\n      error: null,\n      errorInfo: null,\n      errorId: '',\n      retryCount: prevState.retryCount + 1,\n      lastResetKeys: this.props.resetKeys\n    }));\n  };\n\n  handleRetry = () => {\n    // Add a small delay before retrying to prevent rapid retry loops\n    this.resetTimeoutId = window.setTimeout(() => {\n      this.resetErrorBoundary();\n    }, 100);\n  };\n\n  render() {\n    const { hasError, error, errorInfo, retryCount } = this.state;\n    const { children, fallback, isolate } = this.props;\n\n    if (hasError && error && errorInfo) {\n      // Use custom fallback if provided\n      if (fallback) {\n        return fallback(error, errorInfo);\n      }\n\n      // Use default fallback\n      return (\n        <DefaultErrorFallback\n          error={error}\n          errorInfo={errorInfo}\n          onRetry={this.handleRetry}\n          retryCount={retryCount}\n        />\n      );\n    }\n\n    // If isolate is true, wrap children in an additional error boundary\n    if (isolate) {\n      return (\n        <div className=\"error-boundary-isolation\">\n          {children}\n        </div>\n      );\n    }\n\n    return children;\n  }\n}\n\nexport default ErrorBoundary;\n\n// Higher-order component for easy error boundary wrapping\nexport function withErrorBoundary<P extends object>(\n  Component: React.ComponentType<P>,\n  errorBoundaryProps?: Omit<ErrorBoundaryProps, 'children'>\n) {\n  const WrappedComponent = (props: P) => (\n    <ErrorBoundary {...errorBoundaryProps}>\n      <Component {...props} />\n    </ErrorBoundary>\n  );\n\n  WrappedComponent.displayName = `withErrorBoundary(${Component.displayName || Component.name})`;\n  \n  return WrappedComponent;\n}\n\n// Hook for programmatic error reporting\nexport function useErrorHandler() {\n  const reportError = React.useCallback((error: Error, context?: Record<string, any>) => {\n    logger.error('Manual error report:', {\n      error: error.message,\n      stack: error.stack,\n      context,\n      timestamp: new Date().toISOString()\n    });\n\n    // Report to external service if available\n    if (typeof window !== 'undefined' && (window as any).reportError) {\n      (window as any).reportError(error, context);\n    }\n  }, []);\n\n  return { reportError };\n}\n\n// Async error boundary for handling promise rejections\nexport class AsyncErrorBoundary extends Component<\n  ErrorBoundaryProps,\n  ErrorBoundaryState\n> {\n  constructor(props: ErrorBoundaryProps) {\n    super(props);\n    this.state = {\n      hasError: false,\n      error: null,\n      errorInfo: null,\n      errorId: '',\n      retryCount: 0\n    };\n  }\n\n  componentDidMount() {\n    // Handle unhandled promise rejections\n    window.addEventListener('unhandledrejection', this.handleUnhandledRejection);\n  }\n\n  componentWillUnmount() {\n    window.removeEventListener('unhandledrejection', this.handleUnhandledRejection);\n  }\n\n  handleUnhandledRejection = (event: PromiseRejectionEvent) => {\n    const error = event.reason instanceof Error ? event.reason : new Error(String(event.reason));\n    \n    this.setState({\n      hasError: true,\n      error,\n      errorInfo: { componentStack: 'Async Error (Promise Rejection)' } as ErrorInfo,\n      errorId: `async_error_${Date.now()}`\n    });\n\n    logger.error('Unhandled promise rejection:', {\n      error: error.message,\n      stack: error.stack,\n      reason: event.reason\n    });\n\n    // Prevent the default browser behavior\n    event.preventDefault();\n  };\n\n  render() {\n    // Use the same rendering logic as ErrorBoundary\n    const { hasError, error, errorInfo } = this.state;\n    const { children, fallback } = this.props;\n\n    if (hasError && error && errorInfo) {\n      if (fallback) {\n        return fallback(error, errorInfo);\n      }\n\n      return (\n        <DefaultErrorFallback\n          error={error}\n          errorInfo={errorInfo}\n          onRetry={() => this.setState({ hasError: false, error: null, errorInfo: null })}\n          retryCount={this.state.retryCount}\n        />\n      );\n    }\n\n    return children;\n  }\n}"],"version":3}