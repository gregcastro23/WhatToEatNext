fc2453085b28d382a865af532713e3ea
"use strict";
/**
 * Unused Export Analyzer
 * Perfect Codebase Campaign - Phase 3 Implementation
 *
 * Analyzes unused exports across the codebase and provides prioritization
 * for transformation into enterprise intelligence systems.
 */
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.UnusedExportAnalyzer = exports.TransformationComplexity = exports.FileCategory = exports.FilePriority = void 0;
const fs = __importStar(require("fs"));
const path = __importStar(require("path"));
const glob_1 = require("glob");
var FilePriority;
(function (FilePriority) {
    FilePriority["HIGH"] = "HIGH";
    FilePriority["MEDIUM"] = "MEDIUM";
    FilePriority["LOW"] = "LOW";
})(FilePriority || (exports.FilePriority = FilePriority = {}));
var FileCategory;
(function (FileCategory) {
    FileCategory["RECIPE"] = "RECIPE";
    FileCategory["CORE"] = "CORE";
    FileCategory["EXTERNAL"] = "EXTERNAL";
    FileCategory["TEST"] = "TEST";
    FileCategory["UTILITY"] = "UTILITY";
})(FileCategory || (exports.FileCategory = FileCategory = {}));
var TransformationComplexity;
(function (TransformationComplexity) {
    TransformationComplexity["SIMPLE"] = "SIMPLE";
    TransformationComplexity["MODERATE"] = "MODERATE";
    TransformationComplexity["COMPLEX"] = "COMPLEX";
    TransformationComplexity["VERY_COMPLEX"] = "VERY_COMPLEX";
})(TransformationComplexity || (exports.TransformationComplexity = TransformationComplexity = {}));
class UnusedExportAnalyzer {
    srcPath;
    excludePatterns;
    priorityPatterns;
    constructor(srcPath = 'src') {
        this.srcPath = srcPath;
        this.excludePatterns = [
            '**/node_modules/**',
            '**/*.test.ts',
            '**/*.test.tsx',
            '**/*.spec.ts',
            '**/*.spec.tsx',
            '**/dist/**',
            '**/build/**',
            '**/*.d.ts',
        ];
        this.priorityPatterns = {
            [FilePriority.HIGH]: [
                '**/data/recipes/**',
                '**/components/recipe/**',
                '**/services/recipe/**',
                '**/utils/recipe/**',
                '**/hooks/recipe/**',
            ],
            [FilePriority.MEDIUM]: [
                '**/components/**',
                '**/services/**',
                '**/utils/**',
                '**/hooks/**',
                '**/contexts/**',
                '**/providers/**',
            ],
            [FilePriority.LOW]: ['**/types/**', '**/constants/**', '**/config/**', '**/lib/**'],
        };
    }
    /**
     * Analyze unused exports across the codebase
     */
    async analyzeUnusedExports() {
        console.log('ðŸ” Starting unused export analysis...');
        const files = await this.getAllSourceFiles();
        const fileAnalyses = [];
        for (const filePath of files) {
            try {
                const analysis = await this.analyzeFile(filePath);
                if (analysis.unusedExports.length > 0) {
                    fileAnalyses.push(analysis);
                }
            }
            catch (error) {
                console.warn(`âš ï¸  Failed to analyze ${filePath}:`, error);
            }
        }
        return this.categorizeAndSummarize(fileAnalyses);
    }
    /**
     * Get all source files for analysis
     */
    async getAllSourceFiles() {
        const patterns = [
            `${this.srcPath}/**/*.ts`,
            `${this.srcPath}/**/*.tsx`,
            `${this.srcPath}/**/*.js`,
            `${this.srcPath}/**/*.jsx`,
        ];
        const files = [];
        for (const pattern of patterns) {
            const matches = await (0, glob_1.glob)(pattern, {
                ignore: this.excludePatterns,
                absolute: true,
            });
            files.push(...matches);
        }
        return [...new Set(files)]; // Remove duplicates
    }
    /**
     * Analyze a single file for unused exports
     */
    async analyzeFile(filePath) {
        const content = await fs.promises.readFile(filePath, 'utf-8');
        const unusedExports = await this.findUnusedExports(filePath, content);
        const priority = this.determinePriority(filePath);
        const category = this.determineCategory(filePath);
        const safetyScore = this.calculateSafetyScore(filePath, content, unusedExports);
        const transformationCandidates = this.identifyTransformationCandidates(unusedExports);
        return {
            filePath,
            priority,
            unusedExports,
            safetyScore,
            transformationCandidates,
            category,
        };
    }
    /**
     * Find unused exports in a file
     */
    async findUnusedExports(filePath, content) {
        const exports = this.extractExports(content);
        const unusedExports = [];
        for (const exportInfo of exports) {
            const usageCount = await this.countUsages(exportInfo.exportName, filePath);
            if (usageCount === 0) {
                unusedExports.push({
                    ...exportInfo,
                    usageCount,
                    complexity: this.calculateComplexity(content, exportInfo),
                });
            }
        }
        return unusedExports;
    }
    /**
     * Extract export information from file content
     */
    extractExports(content) {
        const exports = [];
        const lines = content.split('\n');
        lines.forEach((line, index) => {
            // Named exports
            const namedExportMatch = line.match(/export\s+(?:const|let|var|function|class|interface|type|enum)\s+(\w+)/);
            if (namedExportMatch) {
                exports.push({
                    filePath: '',
                    exportName: namedExportMatch[1],
                    exportType: this.determineExportType(line),
                    lineNumber: index + 1,
                    isDefault: false,
                });
            }
            // Default exports
            const defaultExportMatch = line.match(/export\s+default\s+(?:(?:const|let|var|function|class)\s+)?(\w+)/);
            if (defaultExportMatch) {
                exports.push({
                    filePath: '',
                    exportName: defaultExportMatch[1] || 'default',
                    exportType: this.determineExportType(line),
                    lineNumber: index + 1,
                    isDefault: true,
                });
            }
            // Export destructuring
            const destructuringMatch = line.match(/export\s*\{\s*([^}]+)\s*\}/);
            if (destructuringMatch) {
                const exportNames = destructuringMatch[1].split(',').map(name => name.trim());
                exportNames.forEach(name => {
                    const cleanName = name.split(' as ')[0].trim();
                    exports.push({
                        filePath: '',
                        exportName: cleanName,
                        exportType: 'variable',
                        lineNumber: index + 1,
                        isDefault: false,
                    });
                });
            }
        });
        return exports;
    }
    /**
     * Determine export type from line content
     */
    determineExportType(line) {
        if (line.includes('function'))
            return 'function';
        if (line.includes('class'))
            return 'class';
        if (line.includes('interface'))
            return 'interface';
        if (line.includes('type'))
            return 'type';
        if (line.includes('const'))
            return 'const';
        return 'variable';
    }
    /**
     * Count usages of an export across the codebase
     */
    async countUsages(exportName, excludeFilePath) {
        const files = await this.getAllSourceFiles();
        let usageCount = 0;
        for (const filePath of files) {
            if (filePath === excludeFilePath)
                continue;
            try {
                const content = await fs.promises.readFile(filePath, 'utf-8');
                // Check for import statements
                const importRegex = new RegExp(`import.*\\b${exportName}\\b.*from`, 'g');
                const importMatches = content.match(importRegex) || [];
                usageCount += importMatches.length;
                // Check for direct usage (more complex analysis would be needed for complete accuracy)
                const usageRegex = new RegExp(`\\b${exportName}\\b`, 'g');
                const usageMatches = content.match(usageRegex) || [];
                // Subtract import matches to avoid double counting
                usageCount += Math.max(0, usageMatches.length - importMatches.length);
            }
            catch (error) {
                // Skip files that can't be read
                continue;
            }
        }
        return usageCount;
    }
    /**
     * Calculate complexity score for an export
     */
    calculateComplexity(content, exportInfo) {
        const lines = content.split('\n');
        const startLine = exportInfo.lineNumber - 1;
        // Simple heuristic: count lines of the export definition
        let complexity = 1;
        let braceCount = 0;
        let inExport = false;
        for (let i = startLine; i < lines.length; i++) {
            const line = lines[i];
            if (!inExport && line.includes('export')) {
                inExport = true;
            }
            if (inExport) {
                complexity++;
                braceCount += (line.match(/\{/g) || []).length;
                braceCount -= (line.match(/\}/g) || []).length;
                if (braceCount === 0 && line.includes('}')) {
                    break;
                }
                if (line.includes(';') && braceCount === 0) {
                    break;
                }
            }
        }
        return Math.min(complexity, 100); // Cap at 100
    }
    /**
     * Determine file priority based on path patterns
     */
    determinePriority(filePath) {
        const relativePath = path.relative(process.cwd(), filePath);
        for (const [priority, patterns] of Object.entries(this.priorityPatterns)) {
            for (const pattern of patterns) {
                if (this.matchesPattern(relativePath, pattern)) {
                    return priority;
                }
            }
        }
        return FilePriority.LOW;
    }
    /**
     * Determine file category
     */
    determineCategory(filePath) {
        const relativePath = path.relative(process.cwd(), filePath);
        if (relativePath.includes('/recipe'))
            return FileCategory.RECIPE;
        if (relativePath.includes('/test') ||
            relativePath.includes('.test.') ||
            relativePath.includes('.spec.')) {
            return FileCategory.TEST;
        }
        if (relativePath.includes('/components') ||
            relativePath.includes('/services') ||
            relativePath.includes('/hooks')) {
            return FileCategory.CORE;
        }
        if (relativePath.includes('/types') ||
            relativePath.includes('/constants') ||
            relativePath.includes('/config')) {
            return FileCategory.EXTERNAL;
        }
        return FileCategory.UTILITY;
    }
    /**
     * Calculate safety score for transformation
     */
    calculateSafetyScore(filePath, content, unusedExports) {
        let score = 100; // Start with perfect score
        // Reduce score based on file complexity
        const lines = content.split('\n').length;
        if (lines > 500)
            score -= 20;
        else if (lines > 200)
            score -= 10;
        // Reduce score based on number of unused exports
        if (unusedExports.length > 10)
            score -= 20;
        else if (unusedExports.length > 5)
            score -= 10;
        // Reduce score for critical files
        if (filePath.includes('/core/') || filePath.includes('/critical/')) {
            score -= 15;
        }
        // Increase score for test files (safer to transform)
        if (filePath.includes('/test/') || filePath.includes('.test.')) {
            score += 10;
        }
        return Math.max(0, Math.min(100, score));
    }
    /**
     * Identify transformation candidates
     */
    identifyTransformationCandidates(unusedExports) {
        return unusedExports.map(exportInfo => {
            const intelligenceSystemName = this.generateIntelligenceSystemName(exportInfo);
            const transformationComplexity = this.assessTransformationComplexity(exportInfo);
            const safetyScore = this.calculateTransformationSafetyScore(exportInfo);
            const estimatedBenefit = this.calculateEstimatedBenefit(exportInfo);
            return {
                export: exportInfo,
                intelligenceSystemName,
                transformationComplexity,
                safetyScore,
                estimatedBenefit,
            };
        });
    }
    /**
     * Generate intelligence system name
     */
    generateIntelligenceSystemName(exportInfo) {
        const baseName = exportInfo.exportName.replace(/([A-Z])/g, '_$1').toUpperCase();
        return `${baseName}_INTELLIGENCE_SYSTEM`;
    }
    /**
     * Assess transformation complexity
     */
    assessTransformationComplexity(exportInfo) {
        if (exportInfo.complexity < 5)
            return TransformationComplexity.SIMPLE;
        if (exportInfo.complexity < 15)
            return TransformationComplexity.MODERATE;
        if (exportInfo.complexity < 30)
            return TransformationComplexity.COMPLEX;
        return TransformationComplexity.VERY_COMPLEX;
    }
    /**
     * Calculate transformation safety score
     */
    calculateTransformationSafetyScore(exportInfo) {
        let score = 90; // Start high for unused exports
        // Reduce for complex exports
        if (exportInfo.complexity > 20)
            score -= 20;
        else if (exportInfo.complexity > 10)
            score -= 10;
        // Increase for simple types
        if (exportInfo.exportType === 'interface' || exportInfo.exportType === 'type') {
            score += 10;
        }
        return Math.max(0, Math.min(100, score));
    }
    /**
     * Calculate estimated benefit of transformation
     */
    calculateEstimatedBenefit(exportInfo) {
        let benefit = 50; // Base benefit
        // Higher benefit for functions and classes (more transformable)
        if (exportInfo.exportType === 'function' || exportInfo.exportType === 'class') {
            benefit += 30;
        }
        // Higher benefit for complex exports (more intelligence potential)
        benefit += Math.min(20, exportInfo.complexity);
        return Math.min(100, benefit);
    }
    /**
     * Categorize and summarize analysis results
     */
    categorizeAndSummarize(fileAnalyses) {
        const highPriorityFiles = fileAnalyses.filter(f => f.priority === FilePriority.HIGH);
        const mediumPriorityFiles = fileAnalyses.filter(f => f.priority === FilePriority.MEDIUM);
        const lowPriorityFiles = fileAnalyses.filter(f => f.priority === FilePriority.LOW);
        const totalUnusedExports = fileAnalyses.reduce((sum, f) => sum + f.unusedExports.length, 0);
        const totalTransformationCandidates = fileAnalyses.reduce((sum, f) => sum + f.transformationCandidates.length, 0);
        const recipeFiles = fileAnalyses.filter(f => f.category === FileCategory.RECIPE).length;
        const coreFiles = fileAnalyses.filter(f => f.category === FileCategory.CORE).length;
        const externalFiles = fileAnalyses.filter(f => f.category === FileCategory.EXTERNAL).length;
        const averageSafetyScore = fileAnalyses.reduce((sum, f) => sum + f.safetyScore, 0) / fileAnalyses.length;
        return {
            totalFiles: fileAnalyses.length,
            totalUnusedExports,
            highPriorityFiles,
            mediumPriorityFiles,
            lowPriorityFiles,
            summary: {
                recipeFiles,
                coreFiles,
                externalFiles,
                totalTransformationCandidates,
                averageSafetyScore,
                estimatedIntelligenceSystems: totalTransformationCandidates,
            },
        };
    }
    /**
     * Check if path matches pattern
     */
    matchesPattern(filePath, pattern) {
        const regex = new RegExp(pattern.replace(/\*\*/g, '.*').replace(/\*/g, '[^/]*'));
        return regex.test(filePath);
    }
    /**
     * Generate detailed report
     */
    generateReport(analysis) {
        const report = [
            '# Unused Export Analysis Report',
            '',
            '## Summary',
            `- Total files analyzed: ${analysis.totalFiles}`,
            `- Total unused exports: ${analysis.totalUnusedExports}`,
            `- Recipe files: ${analysis.summary.recipeFiles}`,
            `- Core files: ${analysis.summary.coreFiles}`,
            `- External files: ${analysis.summary.externalFiles}`,
            `- Transformation candidates: ${analysis.summary.totalTransformationCandidates}`,
            `- Average safety score: ${analysis.summary.averageSafetyScore.toFixed(1)}`,
            '',
            '## Priority Breakdown',
            `- High priority files: ${analysis.highPriorityFiles.length}`,
            `- Medium priority files: ${analysis.mediumPriorityFiles.length}`,
            `- Low priority files: ${analysis.lowPriorityFiles.length}`,
            '',
            '## Top Transformation Candidates',
            '',
        ];
        // Add top candidates from each priority level
        const topCandidates = [
            ...analysis.highPriorityFiles.slice(0, 5),
            ...analysis.mediumPriorityFiles.slice(0, 5),
            ...analysis.lowPriorityFiles.slice(0, 5),
        ];
        topCandidates.forEach(file => {
            report.push(`### ${file.filePath}`);
            report.push(`- Priority: ${file.priority}`);
            report.push(`- Safety Score: ${file.safetyScore}`);
            report.push(`- Unused Exports: ${file.unusedExports.length}`);
            report.push(`- Transformation Candidates: ${file.transformationCandidates.length}`);
            report.push('');
        });
        return report.join('\n');
    }
}
exports.UnusedExportAnalyzer = UnusedExportAnalyzer;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9zZXJ2aWNlcy9jYW1wYWlnbi9VbnVzZWRFeHBvcnRBbmFseXplci50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7OztHQU1HOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUVILHVDQUF5QjtBQUN6QiwyQ0FBNkI7QUFFN0IsK0JBQTRCO0FBK0M1QixJQUFZLFlBSVg7QUFKRCxXQUFZLFlBQVk7SUFDdEIsNkJBQWEsQ0FBQTtJQUNiLGlDQUFpQixDQUFBO0lBQ2pCLDJCQUFXLENBQUE7QUFDYixDQUFDLEVBSlcsWUFBWSw0QkFBWixZQUFZLFFBSXZCO0FBRUQsSUFBWSxZQU1YO0FBTkQsV0FBWSxZQUFZO0lBQ3RCLGlDQUFpQixDQUFBO0lBQ2pCLDZCQUFhLENBQUE7SUFDYixxQ0FBcUIsQ0FBQTtJQUNyQiw2QkFBYSxDQUFBO0lBQ2IsbUNBQW1CLENBQUE7QUFDckIsQ0FBQyxFQU5XLFlBQVksNEJBQVosWUFBWSxRQU12QjtBQUVELElBQVksd0JBS1g7QUFMRCxXQUFZLHdCQUF3QjtJQUNsQyw2Q0FBaUIsQ0FBQTtJQUNqQixpREFBcUIsQ0FBQTtJQUNyQiwrQ0FBbUIsQ0FBQTtJQUNuQix5REFBNkIsQ0FBQTtBQUMvQixDQUFDLEVBTFcsd0JBQXdCLHdDQUF4Qix3QkFBd0IsUUFLbkM7QUFFRCxNQUFhLG9CQUFvQjtJQUNkLE9BQU8sQ0FBUztJQUNoQixlQUFlLENBQVc7SUFDMUIsZ0JBQWdCLENBQWlDO0lBRWxFLFlBQVksVUFBa0IsS0FBSztRQUNqQyxJQUFJLENBQUMsT0FBTyxHQUFHLE9BQU8sQ0FBQztRQUN2QixJQUFJLENBQUMsZUFBZSxHQUFHO1lBQ3JCLG9CQUFvQjtZQUNwQixjQUFjO1lBQ2QsZUFBZTtZQUNmLGNBQWM7WUFDZCxlQUFlO1lBQ2YsWUFBWTtZQUNaLGFBQWE7WUFDYixXQUFXO1NBQ1osQ0FBQztRQUVGLElBQUksQ0FBQyxnQkFBZ0IsR0FBRztZQUN0QixDQUFDLFlBQVksQ0FB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QUMsRUFBRSxDQUFDLENBQUM7WUFDM0MsR0FBRyxRQUFRLENBQUMsZ0JBQWdCLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUM7U0FDekMsQ0FBQztRQUVGLGFBQWEsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLEVBQUU7WUFDM0IsTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDO1lBQ3BDLE1BQU0sQ0FBQyxJQUFJLENBQUMsZUFBZSxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQztZQUM1QyxNQUFNLENBQUMsSUFBSSxDQUFDLG1CQUFtQixJQUFJLENBQUMsV0FBVyxFQUFFLENBQUMsQ0FBQztZQUNuRCxNQUFNLENBQUMsSUFBSSxDQUFDLHFCQUFxQixJQUFJLENBQUMsYUFBYSxDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUM7WUFDOUQsTUFBTSxDQUFDLElBQUksQ0FBQyxnQ0FBZ0MsSUFBSSxDQUFDLHdCQUF3QixDQUFDLE1BQU0sRUFBRSxDQUFDLENBQUM7WUFDcEYsTUFBTSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUNsQixDQUFDLENBQUMsQ0FBQztRQUVILE9BQU8sTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUMzQixDQUFDO0NBQ0Y7QUEvZkQsb0RBK2ZDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9HcmVnQ2FzdHJvL0Rlc2t0b3AvV2hhdFRvRWF0TmV4dC9zcmMvc2VydmljZXMvY2FtcGFpZ24vVW51c2VkRXhwb3J0QW5hbHl6ZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBVbnVzZWQgRXhwb3J0IEFuYWx5emVyXG4gKiBQZXJmZWN0IENvZGViYXNlIENhbXBhaWduIC0gUGhhc2UgMyBJbXBsZW1lbnRhdGlvblxuICpcbiAqIEFuYWx5emVzIHVudXNlZCBleHBvcnRzIGFjcm9zcyB0aGUgY29kZWJhc2UgYW5kIHByb3ZpZGVzIHByaW9yaXRpemF0aW9uXG4gKiBmb3IgdHJhbnNmb3JtYXRpb24gaW50byBlbnRlcnByaXNlIGludGVsbGlnZW5jZSBzeXN0ZW1zLlxuICovXG5cbmltcG9ydCAqIGFzIGZzIGZyb20gJ2ZzJztcbmltcG9ydCAqIGFzIHBhdGggZnJvbSAncGF0aCc7XG5cbmltcG9ydCB7IGdsb2IgfSBmcm9tICdnbG9iJztcblxuZXhwb3J0IGludGVyZmFjZSBVbnVzZWRFeHBvcnQge1xuICBmaWxlUGF0aDogc3RyaW5nO1xuICBleHBvcnROYW1lOiBzdHJpbmc7XG4gIGV4cG9ydFR5cGU6ICdmdW5jdGlvbicgfCAnY2xhc3MnIHwgJ2ludGVyZmFjZScgfCAndHlwZScgfCAnY29uc3QnIHwgJ3ZhcmlhYmxlJztcbiAgbGluZU51bWJlcjogbnVtYmVyO1xuICBpc0RlZmF1bHQ6IGJvb2xlYW47XG4gIGNvbXBsZXhpdHk6IG51bWJlcjtcbiAgdXNhZ2VDb3VudDogbnVtYmVyO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEZpbGVBbmFseXNpcyB7XG4gIGZpbGVQYXRoOiBzdHJpbmc7XG4gIHByaW9yaXR5OiBGaWxlUHJpb3JpdHk7XG4gIHVudXNlZEV4cG9ydHM6IFVudXNlZEV4cG9ydFtdO1xuICBzYWZldHlTY29yZTogbnVtYmVyO1xuICB0cmFuc2Zvcm1hdGlvbkNhbmRpZGF0ZXM6IFRyYW5zZm9ybWF0aW9uQ2FuZGlkYXRlW107XG4gIGNhdGVnb3J5OiBGaWxlQ2F0ZWdvcnk7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVHJhbnNmb3JtYXRpb25DYW5kaWRhdGUge1xuICBleHBvcnQ6IFVudXNlZEV4cG9ydDtcbiAgaW50ZWxsaWdlbmNlU3lzdGVtTmFtZTogc3RyaW5nO1xuICB0cmFuc2Zvcm1hdGlvbkNvbXBsZXhpdHk6IFRyYW5zZm9ybWF0aW9uQ29tcGxleGl0eTtcbiAgc2FmZXR5U2NvcmU6IG51bWJlcjtcbiAgZXN0aW1hdGVkQmVuZWZpdDogbnVtYmVyO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEFuYWx5c2lzUmVzdWx0IHtcbiAgdG90YWxGaWxlczogbnVtYmVyO1xuICB0b3RhbFVudXNlZEV4cG9ydHM6IG51bWJlcjtcbiAgaGlnaFByaW9yaXR5RmlsZXM6IEZpbGVBbmFseXNpc1tdO1xuICBtZWRpdW1Qcmlvcml0eUZpbGVzOiBGaWxlQW5hbHlzaXNbXTtcbiAgbG93UHJpb3JpdHlGaWxlczogRmlsZUFuYWx5c2lzW107XG4gIHN1bW1hcnk6IEFuYWx5c2lzU3VtbWFyeTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBBbmFseXNpc1N1bW1hcnkge1xuICByZWNpcGVGaWxlczogbnVtYmVyO1xuICBjb3JlRmlsZXM6IG51bWJlcjtcbiAgZXh0ZXJuYWxGaWxlczogbnVtYmVyO1xuICB0b3RhbFRyYW5zZm9ybWF0aW9uQ2FuZGlkYXRlczogbnVtYmVyO1xuICBhdmVyYWdlU2FmZXR5U2NvcmU6IG51bWJlcjtcbiAgZXN0aW1hdGVkSW50ZWxsaWdlbmNlU3lzdGVtczogbnVtYmVyO1xufVxuXG5leHBvcnQgZW51bSBGaWxlUHJpb3JpdHkge1xuICBISUdIID0gJ0hJR0gnLCAvLyBSZWNpcGUgYnVpbGRpbmcgZmlsZXNcbiAgTUVESVVNID0gJ01FRElVTScsIC8vIENvcmUgc3lzdGVtIGZpbGVzXG4gIExPVyA9ICdMT1cnLCAvLyBFeHRlcm5hbC90ZXN0IGZpbGVzXG59XG5cbmV4cG9ydCBlbnVtIEZpbGVDYXRlZ29yeSB7XG4gIFJFQ0lQRSA9ICdSRUNJUEUnLFxuICBDT1JFID0gJ0NPUkUnLFxuICBFWFRFUk5BTCA9ICdFWFRFUk5BTCcsXG4gIFRFU1QgPSAnVEVTVCcsXG4gIFVUSUxJVFkgPSAnVVRJTElUWScsXG59XG5cbmV4cG9ydCBlbnVtIFRyYW5zZm9ybWF0aW9uQ29tcGxleGl0eSB7XG4gIFNJTVBMRSA9ICdTSU1QTEUnLFxuICBNT0RFUkFURSA9ICdNT0RFUkFURScsXG4gIENPTVBMRVggPSAnQ09NUExFWCcsXG4gIFZFUllfQ09NUExFWCA9ICdWRVJZX0NPTVBMRVgnLFxufVxuXG5leHBvcnQgY2xhc3MgVW51c2VkRXhwb3J0QW5hbHl6ZXIge1xuICBwcml2YXRlIHJlYWRvbmx5IHNyY1BhdGg6IHN0cmluZztcbiAgcHJpdmF0ZSByZWFkb25seSBleGNsdWRlUGF0dGVybnM6IHN0cmluZ1tdO1xuICBwcml2YXRlIHJlYWRvbmx5IHByaW9yaXR5UGF0dGVybnM6IFJlY29yZDxGaWxlUHJpb3JpdHksIHN0cmluZ1tdPjtcblxuICBjb25zdHJ1Y3RvcihzcmNQYXRoOiBzdHJpbmcgPSAnc3JjJykge1xuICAgIHRoaXMuc3JjUGF0aCA9IHNyY1BhdGg7XG4gICAgdGhpcy5leGNsdWRlUGF0dGVybnMgPSBbXG4gICAgICAnKiovbm9kZV9tb2R1bGVzLyoqJyxcbiAgICAgICcqKi8qLnRlc3QudHMnLFxuICAgICAgJyoqLyoudGVzdC50c3gnLFxuICAgICAgJyoqLyouc3BlYy50cycsXG4gICAgICAnKiovKi5zcGVjLnRzeCcsXG4gICAgICAnKiovZGlzdC8qKicsXG4gICAgICAnKiovYnVpbGQvKionLFxuICAgICAgJyoqLyouZC50cycsXG4gICAgXTtcblxuICAgIHRoaXMucHJpb3JpdHlQYXR0ZXJucyA9IHtcbiAgICAgIFtGaWxlUHJpb3JpdHkuSElHSF06IFtcbiAgICAgICAgJyoqL2RhdGEvcmVjaXBlcy8qKicsXG4gICAgICAgICcqKi9jb21wb25lbnRzL3JlY2lwZS8qKicsXG4gICAgICAgICcqKi9zZXJ2aWNlcy9yZWNpcGUvKionLFxuICAgICAgICAnKiovdXRpbHMvcmVjaXBlLyoqJyxcbiAgICAgICAgJyoqL2hvb2tzL3JlY2lwZS8qKicsXG4gICAgICBdLFxuICAgICAgW0ZpbGVQcmlvcml0eS5NRURJVU1dOiBbXG4gICAgICAgICcqKi9jb21wb25lbnRzLyoqJyxcbiAgICAgICAgJyoqL3NlcnZpY2VzLyoqJyxcbiAgICAgICAgJyoqL3V0aWxzLyoqJyxcbiAgICAgICAgJyoqL2hvb2tzLyoqJyxcbiAgICAgICAgJyoqL2NvbnRleHRzLyoqJyxcbiAgICAgICAgJyoqL3Byb3ZpZGVycy8qKicsXG4gICAgICBdLFxuICAgICAgW0ZpbGVQcmlvcml0eS5MT1ddOiBbJyoqL3R5cGVzLyoqJywgJyoqL2NvbnN0YW50cy8qKicsICcqKi9jb25maWcvKionLCAnKiovbGliLyoqJ10sXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBbmFseXplIHVudXNlZCBleHBvcnRzIGFjcm9zcyB0aGUgY29kZWJhc2VcbiAgICovXG4gIGFzeW5jIGFuYWx5emVVbnVzZWRFeHBvcnRzKCk6IFByb21pc2U8QW5hbHlzaXNSZXN1bHQ+IHtcbiAgICBjb25zb2xlLmxvZygn8J+UjSBTdGFydGluZyB1bnVzZWQgZXhwb3J0IGFuYWx5c2lzLi4uJyk7XG5cbiAgICBjb25zdCBmaWxlcyA9IGF3YWl0IHRoaXMuZ2V0QWxsU291cmNlRmlsZXMoKTtcbiAgICBjb25zdCBmaWxlQW5hbHlzZXM6IEZpbGVBbmFseXNpc1tdID0gW107XG5cbiAgICBmb3IgKGNvbnN0IGZpbGVQYXRoIG9mIGZpbGVzKSB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBhbmFseXNpcyA9IGF3YWl0IHRoaXMuYW5hbHl6ZUZpbGUoZmlsZVBhdGgpO1xuICAgICAgICBpZiAoYW5hbHlzaXMudW51c2VkRXhwb3J0cy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgZmlsZUFuYWx5c2VzLnB1c2goYW5hbHlzaXMpO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLndhcm4oYOKaoO+4jyAgRmFpbGVkIHRvIGFuYWx5emUgJHtmaWxlUGF0aH06YCwgZXJyb3IpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB0aGlzLmNhdGVnb3JpemVBbmRTdW1tYXJpemUoZmlsZUFuYWx5c2VzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgYWxsIHNvdXJjZSBmaWxlcyBmb3IgYW5hbHlzaXNcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgZ2V0QWxsU291cmNlRmlsZXMoKTogUHJvbWlzZTxzdHJpbmdbXT4ge1xuICAgIGNvbnN0IHBhdHRlcm5zID0gW1xuICAgICAgYCR7dGhpcy5zcmNQYXRofS8qKi8qLnRzYCxcbiAgICAgIGAke3RoaXMuc3JjUGF0aH0vKiovKi50c3hgLFxuICAgICAgYCR7dGhpcy5zcmNQYXRofS8qKi8qLmpzYCxcbiAgICAgIGAke3RoaXMuc3JjUGF0aH0vKiovKi5qc3hgLFxuICAgIF07XG5cbiAgICBjb25zdCBmaWxlczogc3RyaW5nW10gPSBbXTtcbiAgICBmb3IgKGNvbnN0IHBhdHRlcm4gb2YgcGF0dGVybnMpIHtcbiAgICAgIGNvbnN0IG1hdGNoZXMgPSBhd2FpdCBnbG9iKHBhdHRlcm4sIHtcbiAgICAgICAgaWdub3JlOiB0aGlzLmV4Y2x1ZGVQYXR0ZXJucyxcbiAgICAgICAgYWJzb2x1dGU6IHRydWUsXG4gICAgICB9KTtcbiAgICAgIGZpbGVzLnB1c2goLi4ubWF0Y2hlcyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIFsuLi5uZXcgU2V0KGZpbGVzKV07IC8vIFJlbW92ZSBkdXBsaWNhdGVzXG4gIH1cblxuICAvKipcbiAgICogQW5hbHl6ZSBhIHNpbmdsZSBmaWxlIGZvciB1bnVzZWQgZXhwb3J0c1xuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBhbmFseXplRmlsZShmaWxlUGF0aDogc3RyaW5nKTogUHJvbWlzZTxGaWxlQW5hbHlzaXM+IHtcbiAgICBjb25zdCBjb250ZW50ID0gYXdhaXQgZnMucHJvbWlzZXMucmVhZEZpbGUoZmlsZVBhdGgsICd1dGYtOCcpO1xuICAgIGNvbnN0IHVudXNlZEV4cG9ydHMgPSBhd2FpdCB0aGlzLmZpbmRVbnVzZWRFeHBvcnRzKGZpbGVQYXRoLCBjb250ZW50KTtcbiAgICBjb25zdCBwcmlvcml0eSA9IHRoaXMuZGV0ZXJtaW5lUHJpb3JpdHkoZmlsZVBhdGgpO1xuICAgIGNvbnN0IGNhdGVnb3J5ID0gdGhpcy5kZXRlcm1pbmVDYXRlZ29yeShmaWxlUGF0aCk7XG4gICAgY29uc3Qgc2FmZXR5U2NvcmUgPSB0aGlzLmNhbGN1bGF0ZVNhZmV0eVNjb3JlKGZpbGVQYXRoLCBjb250ZW50LCB1bnVzZWRFeHBvcnRzKTtcbiAgICBjb25zdCB0cmFuc2Zvcm1hdGlvbkNhbmRpZGF0ZXMgPSB0aGlzLmlkZW50aWZ5VHJhbnNmb3JtYXRpb25DYW5kaWRhdGVzKHVudXNlZEV4cG9ydHMpO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIGZpbGVQYXRoLFxuICAgICAgcHJpb3JpdHksXG4gICAgICB1bnVzZWRFeHBvcnRzLFxuICAgICAgc2FmZXR5U2NvcmUsXG4gICAgICB0cmFuc2Zvcm1hdGlvbkNhbmRpZGF0ZXMsXG4gICAgICBjYXRlZ29yeSxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEZpbmQgdW51c2VkIGV4cG9ydHMgaW4gYSBmaWxlXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGZpbmRVbnVzZWRFeHBvcnRzKGZpbGVQYXRoOiBzdHJpbmcsIGNvbnRlbnQ6IHN0cmluZyk6IFByb21pc2U8VW51c2VkRXhwb3J0W10+IHtcbiAgICBjb25zdCBleHBvcnRzID0gdGhpcy5leHRyYWN0RXhwb3J0cyhjb250ZW50KTtcbiAgICBjb25zdCB1bnVzZWRFeHBvcnRzOiBVbnVzZWRFeHBvcnRbXSA9IFtdO1xuXG4gICAgZm9yIChjb25zdCBleHBvcnRJbmZvIG9mIGV4cG9ydHMpIHtcbiAgICAgIGNvbnN0IHVzYWdlQ291bnQgPSBhd2FpdCB0aGlzLmNvdW50VXNhZ2VzKGV4cG9ydEluZm8uZXhwb3J0TmFtZSwgZmlsZVBhdGgpO1xuICAgICAgaWYgKHVzYWdlQ291bnQgPT09IDApIHtcbiAgICAgICAgdW51c2VkRXhwb3J0cy5wdXNoKHtcbiAgICAgICAgICAuLi5leHBvcnRJbmZvLFxuICAgICAgICAgIHVzYWdlQ291bnQsXG4gICAgICAgICAgY29tcGxleGl0eTogdGhpcy5jYWxjdWxhdGVDb21wbGV4aXR5KGNvbnRlbnQsIGV4cG9ydEluZm8pLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gdW51c2VkRXhwb3J0cztcbiAgfVxuXG4gIC8qKlxuICAgKiBFeHRyYWN0IGV4cG9ydCBpbmZvcm1hdGlvbiBmcm9tIGZpbGUgY29udGVudFxuICAgKi9cbiAgcHJpdmF0ZSBleHRyYWN0RXhwb3J0cyhjb250ZW50OiBzdHJpbmcpOiBPbWl0PFVudXNlZEV4cG9ydCwgJ3VzYWdlQ291bnQnIHwgJ2NvbXBsZXhpdHknPltdIHtcbiAgICBjb25zdCBleHBvcnRzOiBPbWl0PFVudXNlZEV4cG9ydCwgJ3VzYWdlQ291bnQnIHwgJ2NvbXBsZXhpdHknPltdID0gW107XG4gICAgY29uc3QgbGluZXMgPSBjb250ZW50LnNwbGl0KCdcXG4nKTtcblxuICAgIGxpbmVzLmZvckVhY2goKGxpbmUsIGluZGV4KSA9PiB7XG4gICAgICAvLyBOYW1lZCBleHBvcnRzXG4gICAgICBjb25zdCBuYW1lZEV4cG9ydE1hdGNoID0gbGluZS5tYXRjaChcbiAgICAgICAgL2V4cG9ydFxccysoPzpjb25zdHxsZXR8dmFyfGZ1bmN0aW9ufGNsYXNzfGludGVyZmFjZXx0eXBlfGVudW0pXFxzKyhcXHcrKS8sXG4gICAgICApO1xuICAgICAgaWYgKG5hbWVkRXhwb3J0TWF0Y2gpIHtcbiAgICAgICAgZXhwb3J0cy5wdXNoKHtcbiAgICAgICAgICBmaWxlUGF0aDogJycsXG4gICAgICAgICAgZXhwb3J0TmFtZTogbmFtZWRFeHBvcnRNYXRjaFsxXSxcbiAgICAgICAgICBleHBvcnRUeXBlOiB0aGlzLmRldGVybWluZUV4cG9ydFR5cGUobGluZSksXG4gICAgICAgICAgbGluZU51bWJlcjogaW5kZXggKyAxLFxuICAgICAgICAgIGlzRGVmYXVsdDogZmFsc2UsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBEZWZhdWx0IGV4cG9ydHNcbiAgICAgIGNvbnN0IGRlZmF1bHRFeHBvcnRNYXRjaCA9IGxpbmUubWF0Y2goXG4gICAgICAgIC9leHBvcnRcXHMrZGVmYXVsdFxccysoPzooPzpjb25zdHxsZXR8dmFyfGZ1bmN0aW9ufGNsYXNzKVxccyspPyhcXHcrKS8sXG4gICAgICApO1xuICAgICAgaWYgKGRlZmF1bHRFeHBvcnRNYXRjaCkge1xuICAgICAgICBleHBvcnRzLnB1c2goe1xuICAgICAgICAgIGZpbGVQYXRoOiAnJyxcbiAgICAgICAgICBleHBvcnROYW1lOiBkZWZhdWx0RXhwb3J0TWF0Y2hbMV0gfHwgJ2RlZmF1bHQnLFxuICAgICAgICAgIGV4cG9ydFR5cGU6IHRoaXMuZGV0ZXJtaW5lRXhwb3J0VHlwZShsaW5lKSxcbiAgICAgICAgICBsaW5lTnVtYmVyOiBpbmRleCArIDEsXG4gICAgICAgICAgaXNEZWZhdWx0OiB0cnVlLFxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLy8gRXhwb3J0IGRlc3RydWN0dXJpbmdcbiAgICAgIGNvbnN0IGRlc3RydWN0dXJpbmdNYXRjaCA9IGxpbmUubWF0Y2goL2V4cG9ydFxccypcXHtcXHMqKFtefV0rKVxccypcXH0vKTtcbiAgICAgIGlmIChkZXN0cnVjdHVyaW5nTWF0Y2gpIHtcbiAgICAgICAgY29uc3QgZXhwb3J0TmFtZXMgPSBkZXN0cnVjdHVyaW5nTWF0Y2hbMV0uc3BsaXQoJywnKS5tYXAobmFtZSA9PiBuYW1lLnRyaW0oKSk7XG4gICAgICAgIGV4cG9ydE5hbWVzLmZvckVhY2gobmFtZSA9PiB7XG4gICAgICAgICAgY29uc3QgY2xlYW5OYW1lID0gbmFtZS5zcGxpdCgnIGFzICcpWzBdLnRyaW0oKTtcbiAgICAgICAgICBleHBvcnRzLnB1c2goe1xuICAgICAgICAgICAgZmlsZVBhdGg6ICcnLFxuICAgICAgICAgICAgZXhwb3J0TmFtZTogY2xlYW5OYW1lLFxuICAgICAgICAgICAgZXhwb3J0VHlwZTogJ3ZhcmlhYmxlJyxcbiAgICAgICAgICAgIGxpbmVOdW1iZXI6IGluZGV4ICsgMSxcbiAgICAgICAgICAgIGlzRGVmYXVsdDogZmFsc2UsXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIGV4cG9ydHM7XG4gIH1cblxuICAvKipcbiAgICogRGV0ZXJtaW5lIGV4cG9ydCB0eXBlIGZyb20gbGluZSBjb250ZW50XG4gICAqL1xuICBwcml2YXRlIGRldGVybWluZUV4cG9ydFR5cGUobGluZTogc3RyaW5nKTogVW51c2VkRXhwb3J0WydleHBvcnRUeXBlJ10ge1xuICAgIGlmIChsaW5lLmluY2x1ZGVzKCdmdW5jdGlvbicpKSByZXR1cm4gJ2Z1bmN0aW9uJztcbiAgICBpZiAobGluZS5pbmNsdWRlcygnY2xhc3MnKSkgcmV0dXJuICdjbGFzcyc7XG4gICAgaWYgKGxpbmUuaW5jbHVkZXMoJ2ludGVyZmFjZScpKSByZXR1cm4gJ2ludGVyZmFjZSc7XG4gICAgaWYgKGxpbmUuaW5jbHVkZXMoJ3R5cGUnKSkgcmV0dXJuICd0eXBlJztcbiAgICBpZiAobGluZS5pbmNsdWRlcygnY29uc3QnKSkgcmV0dXJuICdjb25zdCc7XG4gICAgcmV0dXJuICd2YXJpYWJsZSc7XG4gIH1cblxuICAvKipcbiAgICogQ291bnQgdXNhZ2VzIG9mIGFuIGV4cG9ydCBhY3Jvc3MgdGhlIGNvZGViYXNlXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGNvdW50VXNhZ2VzKGV4cG9ydE5hbWU6IHN0cmluZywgZXhjbHVkZUZpbGVQYXRoOiBzdHJpbmcpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgIGNvbnN0IGZpbGVzID0gYXdhaXQgdGhpcy5nZXRBbGxTb3VyY2VGaWxlcygpO1xuICAgIGxldCB1c2FnZUNvdW50ID0gMDtcblxuICAgIGZvciAoY29uc3QgZmlsZVBhdGggb2YgZmlsZXMpIHtcbiAgICAgIGlmIChmaWxlUGF0aCA9PT0gZXhjbHVkZUZpbGVQYXRoKSBjb250aW51ZTtcblxuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgY29udGVudCA9IGF3YWl0IGZzLnByb21pc2VzLnJlYWRGaWxlKGZpbGVQYXRoLCAndXRmLTgnKTtcblxuICAgICAgICAvLyBDaGVjayBmb3IgaW1wb3J0IHN0YXRlbWVudHNcbiAgICAgICAgY29uc3QgaW1wb3J0UmVnZXggPSBuZXcgUmVnRXhwKGBpbXBvcnQuKlxcXFxiJHtleHBvcnROYW1lfVxcXFxiLipmcm9tYCwgJ2cnKTtcbiAgICAgICAgY29uc3QgaW1wb3J0TWF0Y2hlcyA9IGNvbnRlbnQubWF0Y2goaW1wb3J0UmVnZXgpIHx8IFtdO1xuICAgICAgICB1c2FnZUNvdW50ICs9IGltcG9ydE1hdGNoZXMubGVuZ3RoO1xuXG4gICAgICAgIC8vIENoZWNrIGZvciBkaXJlY3QgdXNhZ2UgKG1vcmUgY29tcGxleCBhbmFseXNpcyB3b3VsZCBiZSBuZWVkZWQgZm9yIGNvbXBsZXRlIGFjY3VyYWN5KVxuICAgICAgICBjb25zdCB1c2FnZVJlZ2V4ID0gbmV3IFJlZ0V4cChgXFxcXGIke2V4cG9ydE5hbWV9XFxcXGJgLCAnZycpO1xuICAgICAgICBjb25zdCB1c2FnZU1hdGNoZXMgPSBjb250ZW50Lm1hdGNoKHVzYWdlUmVnZXgpIHx8IFtdO1xuICAgICAgICAvLyBTdWJ0cmFjdCBpbXBvcnQgbWF0Y2hlcyB0byBhdm9pZCBkb3VibGUgY291bnRpbmdcbiAgICAgICAgdXNhZ2VDb3VudCArPSBNYXRoLm1heCgwLCB1c2FnZU1hdGNoZXMubGVuZ3RoIC0gaW1wb3J0TWF0Y2hlcy5sZW5ndGgpO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgLy8gU2tpcCBmaWxlcyB0aGF0IGNhbid0IGJlIHJlYWRcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHVzYWdlQ291bnQ7XG4gIH1cblxuICAvKipcbiAgICogQ2FsY3VsYXRlIGNvbXBsZXhpdHkgc2NvcmUgZm9yIGFuIGV4cG9ydFxuICAgKi9cbiAgcHJpdmF0ZSBjYWxjdWxhdGVDb21wbGV4aXR5KFxuICAgIGNvbnRlbnQ6IHN0cmluZyxcbiAgICBleHBvcnRJbmZvOiBPbWl0PFVudXNlZEV4cG9ydCwgJ3VzYWdlQ291bnQnIHwgJ2NvbXBsZXhpdHknPixcbiAgKTogbnVtYmVyIHtcbiAgICBjb25zdCBsaW5lcyA9IGNvbnRlbnQuc3BsaXQoJ1xcbicpO1xuICAgIGNvbnN0IHN0YXJ0TGluZSA9IGV4cG9ydEluZm8ubGluZU51bWJlciAtIDE7XG5cbiAgICAvLyBTaW1wbGUgaGV1cmlzdGljOiBjb3VudCBsaW5lcyBvZiB0aGUgZXhwb3J0IGRlZmluaXRpb25cbiAgICBsZXQgY29tcGxleGl0eSA9IDE7XG4gICAgbGV0IGJyYWNlQ291bnQgPSAwO1xuICAgIGxldCBpbkV4cG9ydCA9IGZhbHNlO1xuXG4gICAgZm9yIChsZXQgaSA9IHN0YXJ0TGluZTsgaSA8IGxpbmVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCBsaW5lID0gbGluZXNbaV07XG5cbiAgICAgIGlmICghaW5FeHBvcnQgJiYgbGluZS5pbmNsdWRlcygnZXhwb3J0JykpIHtcbiAgICAgICAgaW5FeHBvcnQgPSB0cnVlO1xuICAgICAgfVxuXG4gICAgICBpZiAoaW5FeHBvcnQpIHtcbiAgICAgICAgY29tcGxleGl0eSsrO1xuICAgICAgICBicmFjZUNvdW50ICs9IChsaW5lLm1hdGNoKC9cXHsvZykgfHwgW10pLmxlbmd0aDtcbiAgICAgICAgYnJhY2VDb3VudCAtPSAobGluZS5tYXRjaCgvXFx9L2cpIHx8IFtdKS5sZW5ndGg7XG5cbiAgICAgICAgaWYgKGJyYWNlQ291bnQgPT09IDAgJiYgbGluZS5pbmNsdWRlcygnfScpKSB7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAobGluZS5pbmNsdWRlcygnOycpICYmIGJyYWNlQ291bnQgPT09IDApIHtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBNYXRoLm1pbihjb21wbGV4aXR5LCAxMDApOyAvLyBDYXAgYXQgMTAwXG4gIH1cblxuICAvKipcbiAgICogRGV0ZXJtaW5lIGZpbGUgcHJpb3JpdHkgYmFzZWQgb24gcGF0aCBwYXR0ZXJuc1xuICAgKi9cbiAgcHJpdmF0ZSBkZXRlcm1pbmVQcmlvcml0eShmaWxlUGF0aDogc3RyaW5nKTogRmlsZVByaW9yaXR5IHtcbiAgICBjb25zdCByZWxhdGl2ZVBhdGggPSBwYXRoLnJlbGF0aXZlKHByb2Nlc3MuY3dkKCksIGZpbGVQYXRoKTtcblxuICAgIGZvciAoY29uc3QgW3ByaW9yaXR5LCBwYXR0ZXJuc10gb2YgT2JqZWN0LmVudHJpZXModGhpcy5wcmlvcml0eVBhdHRlcm5zKSkge1xuICAgICAgZm9yIChjb25zdCBwYXR0ZXJuIG9mIHBhdHRlcm5zKSB7XG4gICAgICAgIGlmICh0aGlzLm1hdGNoZXNQYXR0ZXJuKHJlbGF0aXZlUGF0aCwgcGF0dGVybikpIHtcbiAgICAgICAgICByZXR1cm4gcHJpb3JpdHkgYXMgRmlsZVByaW9yaXR5O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIEZpbGVQcmlvcml0eS5MT1c7XG4gIH1cblxuICAvKipcbiAgICogRGV0ZXJtaW5lIGZpbGUgY2F0ZWdvcnlcbiAgICovXG4gIHByaXZhdGUgZGV0ZXJtaW5lQ2F0ZWdvcnkoZmlsZVBhdGg6IHN0cmluZyk6IEZpbGVDYXRlZ29yeSB7XG4gICAgY29uc3QgcmVsYXRpdmVQYXRoID0gcGF0aC5yZWxhdGl2ZShwcm9jZXNzLmN3ZCgpLCBmaWxlUGF0aCk7XG5cbiAgICBpZiAocmVsYXRpdmVQYXRoLmluY2x1ZGVzKCcvcmVjaXBlJykpIHJldHVybiBGaWxlQ2F0ZWdvcnkuUkVDSVBFO1xuICAgIGlmIChcbiAgICAgIHJlbGF0aXZlUGF0aC5pbmNsdWRlcygnL3Rlc3QnKSB8fFxuICAgICAgcmVsYXRpdmVQYXRoLmluY2x1ZGVzKCcudGVzdC4nKSB8fFxuICAgICAgcmVsYXRpdmVQYXRoLmluY2x1ZGVzKCcuc3BlYy4nKVxuICAgICkge1xuICAgICAgcmV0dXJuIEZpbGVDYXRlZ29yeS5URVNUO1xuICAgIH1cbiAgICBpZiAoXG4gICAgICByZWxhdGl2ZVBhdGguaW5jbHVkZXMoJy9jb21wb25lbnRzJykgfHxcbiAgICAgIHJlbGF0aXZlUGF0aC5pbmNsdWRlcygnL3NlcnZpY2VzJykgfHxcbiAgICAgIHJlbGF0aXZlUGF0aC5pbmNsdWRlcygnL2hvb2tzJylcbiAgICApIHtcbiAgICAgIHJldHVybiBGaWxlQ2F0ZWdvcnkuQ09SRTtcbiAgICB9XG4gICAgaWYgKFxuICAgICAgcmVsYXRpdmVQYXRoLmluY2x1ZGVzKCcvdHlwZXMnKSB8fFxuICAgICAgcmVsYXRpdmVQYXRoLmluY2x1ZGVzKCcvY29uc3RhbnRzJykgfHxcbiAgICAgIHJlbGF0aXZlUGF0aC5pbmNsdWRlcygnL2NvbmZpZycpXG4gICAgKSB7XG4gICAgICByZXR1cm4gRmlsZUNhdGVnb3J5LkVYVEVSTkFMO1xuICAgIH1cblxuICAgIHJldHVybiBGaWxlQ2F0ZWdvcnkuVVRJTElUWTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDYWxjdWxhdGUgc2FmZXR5IHNjb3JlIGZvciB0cmFuc2Zvcm1hdGlvblxuICAgKi9cbiAgcHJpdmF0ZSBjYWxjdWxhdGVTYWZldHlTY29yZShcbiAgICBmaWxlUGF0aDogc3RyaW5nLFxuICAgIGNvbnRlbnQ6IHN0cmluZyxcbiAgICB1bnVzZWRFeHBvcnRzOiBVbnVzZWRFeHBvcnRbXSxcbiAgKTogbnVtYmVyIHtcbiAgICBsZXQgc2NvcmUgPSAxMDA7IC8vIFN0YXJ0IHdpdGggcGVyZmVjdCBzY29yZVxuXG4gICAgLy8gUmVkdWNlIHNjb3JlIGJhc2VkIG9uIGZpbGUgY29tcGxleGl0eVxuICAgIGNvbnN0IGxpbmVzID0gY29udGVudC5zcGxpdCgnXFxuJykubGVuZ3RoO1xuICAgIGlmIChsaW5lcyA+IDUwMCkgc2NvcmUgLT0gMjA7XG4gICAgZWxzZSBpZiAobGluZXMgPiAyMDApIHNjb3JlIC09IDEwO1xuXG4gICAgLy8gUmVkdWNlIHNjb3JlIGJhc2VkIG9uIG51bWJlciBvZiB1bnVzZWQgZXhwb3J0c1xuICAgIGlmICh1bnVzZWRFeHBvcnRzLmxlbmd0aCA+IDEwKSBzY29yZSAtPSAyMDtcbiAgICBlbHNlIGlmICh1bnVzZWRFeHBvcnRzLmxlbmd0aCA+IDUpIHNjb3JlIC09IDEwO1xuXG4gICAgLy8gUmVkdWNlIHNjb3JlIGZvciBjcml0aWNhbCBmaWxlc1xuICAgIGlmIChmaWxlUGF0aC5pbmNsdWRlcygnL2NvcmUvJykgfHwgZmlsZVBhdGguaW5jbHVkZXMoJy9jcml0aWNhbC8nKSkge1xuICAgICAgc2NvcmUgLT0gMTU7XG4gICAgfVxuXG4gICAgLy8gSW5jcmVhc2Ugc2NvcmUgZm9yIHRlc3QgZmlsZXMgKHNhZmVyIHRvIHRyYW5zZm9ybSlcbiAgICBpZiAoZmlsZVBhdGguaW5jbHVkZXMoJy90ZXN0LycpIHx8IGZpbGVQYXRoLmluY2x1ZGVzKCcudGVzdC4nKSkge1xuICAgICAgc2NvcmUgKz0gMTA7XG4gICAgfVxuXG4gICAgcmV0dXJuIE1hdGgubWF4KDAsIE1hdGgubWluKDEwMCwgc2NvcmUpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBJZGVudGlmeSB0cmFuc2Zvcm1hdGlvbiBjYW5kaWRhdGVzXG4gICAqL1xuICBwcml2YXRlIGlkZW50aWZ5VHJhbnNmb3JtYXRpb25DYW5kaWRhdGVzKFxuICAgIHVudXNlZEV4cG9ydHM6IFVudXNlZEV4cG9ydFtdLFxuICApOiBUcmFuc2Zvcm1hdGlvbkNhbmRpZGF0ZVtdIHtcbiAgICByZXR1cm4gdW51c2VkRXhwb3J0cy5tYXAoZXhwb3J0SW5mbyA9PiB7XG4gICAgICBjb25zdCBpbnRlbGxpZ2VuY2VTeXN0ZW1OYW1lID0gdGhpcy5nZW5lcmF0ZUludGVsbGlnZW5jZVN5c3RlbU5hbWUoZXhwb3J0SW5mbyk7XG4gICAgICBjb25zdCB0cmFuc2Zvcm1hdGlvbkNvbXBsZXhpdHkgPSB0aGlzLmFzc2Vzc1RyYW5zZm9ybWF0aW9uQ29tcGxleGl0eShleHBvcnRJbmZvKTtcbiAgICAgIGNvbnN0IHNhZmV0eVNjb3JlID0gdGhpcy5jYWxjdWxhdGVUcmFuc2Zvcm1hdGlvblNhZmV0eVNjb3JlKGV4cG9ydEluZm8pO1xuICAgICAgY29uc3QgZXN0aW1hdGVkQmVuZWZpdCA9IHRoaXMuY2FsY3VsYXRlRXN0aW1hdGVkQmVuZWZpdChleHBvcnRJbmZvKTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZXhwb3J0OiBleHBvcnRJbmZvLFxuICAgICAgICBpbnRlbGxpZ2VuY2VTeXN0ZW1OYW1lLFxuICAgICAgICB0cmFuc2Zvcm1hdGlvbkNvbXBsZXhpdHksXG4gICAgICAgIHNhZmV0eVNjb3JlLFxuICAgICAgICBlc3RpbWF0ZWRCZW5lZml0LFxuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZSBpbnRlbGxpZ2VuY2Ugc3lzdGVtIG5hbWVcbiAgICovXG4gIHByaXZhdGUgZ2VuZXJhdGVJbnRlbGxpZ2VuY2VTeXN0ZW1OYW1lKGV4cG9ydEluZm86IFVudXNlZEV4cG9ydCk6IHN0cmluZyB7XG4gICAgY29uc3QgYmFzZU5hbWUgPSBleHBvcnRJbmZvLmV4cG9ydE5hbWUucmVwbGFjZSgvKFtBLVpdKS9nLCAnXyQxJykudG9VcHBlckNhc2UoKTtcbiAgICByZXR1cm4gYCR7YmFzZU5hbWV9X0lOVEVMTElHRU5DRV9TWVNURU1gO1xuICB9XG5cbiAgLyoqXG4gICAqIEFzc2VzcyB0cmFuc2Zvcm1hdGlvbiBjb21wbGV4aXR5XG4gICAqL1xuICBwcml2YXRlIGFzc2Vzc1RyYW5zZm9ybWF0aW9uQ29tcGxleGl0eShleHBvcnRJbmZvOiBVbnVzZWRFeHBvcnQpOiBUcmFuc2Zvcm1hdGlvbkNvbXBsZXhpdHkge1xuICAgIGlmIChleHBvcnRJbmZvLmNvbXBsZXhpdHkgPCA1KSByZXR1cm4gVHJhbnNmb3JtYXRpb25Db21wbGV4aXR5LlNJTVBMRTtcbiAgICBpZiAoZXhwb3J0SW5mby5jb21wbGV4aXR5IDwgMTUpIHJldHVybiBUcmFuc2Zvcm1hdGlvbkNvbXBsZXhpdHkuTU9ERVJBVEU7XG4gICAgaWYgKGV4cG9ydEluZm8uY29tcGxleGl0eSA8IDMwKSByZXR1cm4gVHJhbnNmb3JtYXRpb25Db21wbGV4aXR5LkNPTVBMRVg7XG4gICAgcmV0dXJuIFRyYW5zZm9ybWF0aW9uQ29tcGxleGl0eS5WRVJZX0NPTVBMRVg7XG4gIH1cblxuICAvKipcbiAgICogQ2FsY3VsYXRlIHRyYW5zZm9ybWF0aW9uIHNhZmV0eSBzY29yZVxuICAgKi9cbiAgcHJpdmF0ZSBjYWxjdWxhdGVUcmFuc2Zvcm1hdGlvblNhZmV0eVNjb3JlKGV4cG9ydEluZm86IFVudXNlZEV4cG9ydCk6IG51bWJlciB7XG4gICAgbGV0IHNjb3JlID0gOTA7IC8vIFN0YXJ0IGhpZ2ggZm9yIHVudXNlZCBleHBvcnRzXG5cbiAgICAvLyBSZWR1Y2UgZm9yIGNvbXBsZXggZXhwb3J0c1xuICAgIGlmIChleHBvcnRJbmZvLmNvbXBsZXhpdHkgPiAyMCkgc2NvcmUgLT0gMjA7XG4gICAgZWxzZSBpZiAoZXhwb3J0SW5mby5jb21wbGV4aXR5ID4gMTApIHNjb3JlIC09IDEwO1xuXG4gICAgLy8gSW5jcmVhc2UgZm9yIHNpbXBsZSB0eXBlc1xuICAgIGlmIChleHBvcnRJbmZvLmV4cG9ydFR5cGUgPT09ICdpbnRlcmZhY2UnIHx8IGV4cG9ydEluZm8uZXhwb3J0VHlwZSA9PT0gJ3R5cGUnKSB7XG4gICAgICBzY29yZSArPSAxMDtcbiAgICB9XG5cbiAgICByZXR1cm4gTWF0aC5tYXgoMCwgTWF0aC5taW4oMTAwLCBzY29yZSkpO1xuICB9XG5cbiAgLyoqXG4gICAqIENhbGN1bGF0ZSBlc3RpbWF0ZWQgYmVuZWZpdCBvZiB0cmFuc2Zvcm1hdGlvblxuICAgKi9cbiAgcHJpdmF0ZSBjYWxjdWxhdGVFc3RpbWF0ZWRCZW5lZml0KGV4cG9ydEluZm86IFVudXNlZEV4cG9ydCk6IG51bWJlciB7XG4gICAgbGV0IGJlbmVmaXQgPSA1MDsgLy8gQmFzZSBiZW5lZml0XG5cbiAgICAvLyBIaWdoZXIgYmVuZWZpdCBmb3IgZnVuY3Rpb25zIGFuZCBjbGFzc2VzIChtb3JlIHRyYW5zZm9ybWFibGUpXG4gICAgaWYgKGV4cG9ydEluZm8uZXhwb3J0VHlwZSA9PT0gJ2Z1bmN0aW9uJyB8fCBleHBvcnRJbmZvLmV4cG9ydFR5cGUgPT09ICdjbGFzcycpIHtcbiAgICAgIGJlbmVmaXQgKz0gMzA7XG4gICAgfVxuXG4gICAgLy8gSGlnaGVyIGJlbmVmaXQgZm9yIGNvbXBsZXggZXhwb3J0cyAobW9yZSBpbnRlbGxpZ2VuY2UgcG90ZW50aWFsKVxuICAgIGJlbmVmaXQgKz0gTWF0aC5taW4oMjAsIGV4cG9ydEluZm8uY29tcGxleGl0eSk7XG5cbiAgICByZXR1cm4gTWF0aC5taW4oMTAwLCBiZW5lZml0KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDYXRlZ29yaXplIGFuZCBzdW1tYXJpemUgYW5hbHlzaXMgcmVzdWx0c1xuICAgKi9cbiAgcHJpdmF0ZSBjYXRlZ29yaXplQW5kU3VtbWFyaXplKGZpbGVBbmFseXNlczogRmlsZUFuYWx5c2lzW10pOiBBbmFseXNpc1Jlc3VsdCB7XG4gICAgY29uc3QgaGlnaFByaW9yaXR5RmlsZXMgPSBmaWxlQW5hbHlzZXMuZmlsdGVyKGYgPT4gZi5wcmlvcml0eSA9PT0gRmlsZVByaW9yaXR5LkhJR0gpO1xuICAgIGNvbnN0IG1lZGl1bVByaW9yaXR5RmlsZXMgPSBmaWxlQW5hbHlzZXMuZmlsdGVyKGYgPT4gZi5wcmlvcml0eSA9PT0gRmlsZVByaW9yaXR5Lk1FRElVTSk7XG4gICAgY29uc3QgbG93UHJpb3JpdHlGaWxlcyA9IGZpbGVBbmFseXNlcy5maWx0ZXIoZiA9PiBmLnByaW9yaXR5ID09PSBGaWxlUHJpb3JpdHkuTE9XKTtcblxuICAgIGNvbnN0IHRvdGFsVW51c2VkRXhwb3J0cyA9IGZpbGVBbmFseXNlcy5yZWR1Y2UoKHN1bSwgZikgPT4gc3VtICsgZi51bnVzZWRFeHBvcnRzLmxlbmd0aCwgMCk7XG4gICAgY29uc3QgdG90YWxUcmFuc2Zvcm1hdGlvbkNhbmRpZGF0ZXMgPSBmaWxlQW5hbHlzZXMucmVkdWNlKFxuICAgICAgKHN1bSwgZikgPT4gc3VtICsgZi50cmFuc2Zvcm1hdGlvbkNhbmRpZGF0ZXMubGVuZ3RoLFxuICAgICAgMCxcbiAgICApO1xuXG4gICAgY29uc3QgcmVjaXBlRmlsZXMgPSBmaWxlQW5hbHlzZXMuZmlsdGVyKGYgPT4gZi5jYXRlZ29yeSA9PT0gRmlsZUNhdGVnb3J5LlJFQ0lQRSkubGVuZ3RoO1xuICAgIGNvbnN0IGNvcmVGaWxlcyA9IGZpbGVBbmFseXNlcy5maWx0ZXIoZiA9PiBmLmNhdGVnb3J5ID09PSBGaWxlQ2F0ZWdvcnkuQ09SRSkubGVuZ3RoO1xuICAgIGNvbnN0IGV4dGVybmFsRmlsZXMgPSBmaWxlQW5hbHlzZXMuZmlsdGVyKGYgPT4gZi5jYXRlZ29yeSA9PT0gRmlsZUNhdGVnb3J5LkVYVEVSTkFMKS5sZW5ndGg7XG5cbiAgICBjb25zdCBhdmVyYWdlU2FmZXR5U2NvcmUgPVxuICAgICAgZmlsZUFuYWx5c2VzLnJlZHVjZSgoc3VtLCBmKSA9PiBzdW0gKyBmLnNhZmV0eVNjb3JlLCAwKSAvIGZpbGVBbmFseXNlcy5sZW5ndGg7XG5cbiAgICByZXR1cm4ge1xuICAgICAgdG90YWxGaWxlczogZmlsZUFuYWx5c2VzLmxlbmd0aCxcbiAgICAgIHRvdGFsVW51c2VkRXhwb3J0cyxcbiAgICAgIGhpZ2hQcmlvcml0eUZpbGVzLFxuICAgICAgbWVkaXVtUHJpb3JpdHlGaWxlcyxcbiAgICAgIGxvd1ByaW9yaXR5RmlsZXMsXG4gICAgICBzdW1tYXJ5OiB7XG4gICAgICAgIHJlY2lwZUZpbGVzLFxuICAgICAgICBjb3JlRmlsZXMsXG4gICAgICAgIGV4dGVybmFsRmlsZXMsXG4gICAgICAgIHRvdGFsVHJhbnNmb3JtYXRpb25DYW5kaWRhdGVzLFxuICAgICAgICBhdmVyYWdlU2FmZXR5U2NvcmUsXG4gICAgICAgIGVzdGltYXRlZEludGVsbGlnZW5jZVN5c3RlbXM6IHRvdGFsVHJhbnNmb3JtYXRpb25DYW5kaWRhdGVzLFxuICAgICAgfSxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrIGlmIHBhdGggbWF0Y2hlcyBwYXR0ZXJuXG4gICAqL1xuICBwcml2YXRlIG1hdGNoZXNQYXR0ZXJuKGZpbGVQYXRoOiBzdHJpbmcsIHBhdHRlcm46IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IHJlZ2V4ID0gbmV3IFJlZ0V4cChwYXR0ZXJuLnJlcGxhY2UoL1xcKlxcKi9nLCAnLionKS5yZXBsYWNlKC9cXCovZywgJ1teL10qJykpO1xuICAgIHJldHVybiByZWdleC50ZXN0KGZpbGVQYXRoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZSBkZXRhaWxlZCByZXBvcnRcbiAgICovXG4gIGdlbmVyYXRlUmVwb3J0KGFuYWx5c2lzOiBBbmFseXNpc1Jlc3VsdCk6IHN0cmluZyB7XG4gICAgY29uc3QgcmVwb3J0ID0gW1xuICAgICAgJyMgVW51c2VkIEV4cG9ydCBBbmFseXNpcyBSZXBvcnQnLFxuICAgICAgJycsXG4gICAgICAnIyMgU3VtbWFyeScsXG4gICAgICBgLSBUb3RhbCBmaWxlcyBhbmFseXplZDogJHthbmFseXNpcy50b3RhbEZpbGVzfWAsXG4gICAgICBgLSBUb3RhbCB1bnVzZWQgZXhwb3J0czogJHthbmFseXNpcy50b3RhbFVudXNlZEV4cG9ydHN9YCxcbiAgICAgIGAtIFJlY2lwZSBmaWxlczogJHthbmFseXNpcy5zdW1tYXJ5LnJlY2lwZUZpbGVzfWAsXG4gICAgICBgLSBDb3JlIGZpbGVzOiAke2FuYWx5c2lzLnN1bW1hcnkuY29yZUZpbGVzfWAsXG4gICAgICBgLSBFeHRlcm5hbCBmaWxlczogJHthbmFseXNpcy5zdW1tYXJ5LmV4dGVybmFsRmlsZXN9YCxcbiAgICAgIGAtIFRyYW5zZm9ybWF0aW9uIGNhbmRpZGF0ZXM6ICR7YW5hbHlzaXMuc3VtbWFyeS50b3RhbFRyYW5zZm9ybWF0aW9uQ2FuZGlkYXRlc31gLFxuICAgICAgYC0gQXZlcmFnZSBzYWZldHkgc2NvcmU6ICR7YW5hbHlzaXMuc3VtbWFyeS5hdmVyYWdlU2FmZXR5U2NvcmUudG9GaXhlZCgxKX1gLFxuICAgICAgJycsXG4gICAgICAnIyMgUHJpb3JpdHkgQnJlYWtkb3duJyxcbiAgICAgIGAtIEhpZ2ggcHJpb3JpdHkgZmlsZXM6ICR7YW5hbHlzaXMuaGlnaFByaW9yaXR5RmlsZXMubGVuZ3RofWAsXG4gICAgICBgLSBNZWRpdW0gcHJpb3JpdHkgZmlsZXM6ICR7YW5hbHlzaXMubWVkaXVtUHJpb3JpdHlGaWxlcy5sZW5ndGh9YCxcbiAgICAgIGAtIExvdyBwcmlvcml0eSBmaWxlczogJHthbmFseXNpcy5sb3dQcmlvcml0eUZpbGVzLmxlbmd0aH1gLFxuICAgICAgJycsXG4gICAgICAnIyMgVG9wIFRyYW5zZm9ybWF0aW9uIENhbmRpZGF0ZXMnLFxuICAgICAgJycsXG4gICAgXTtcblxuICAgIC8vIEFkZCB0b3AgY2FuZGlkYXRlcyBmcm9tIGVhY2ggcHJpb3JpdHkgbGV2ZWxcbiAgICBjb25zdCB0b3BDYW5kaWRhdGVzID0gW1xuICAgICAgLi4uYW5hbHlzaXMuaGlnaFByaW9yaXR5RmlsZXMuc2xpY2UoMCwgNSksXG4gICAgICAuLi5hbmFseXNpcy5tZWRpdW1Qcmlvcml0eUZpbGVzLnNsaWNlKDAsIDUpLFxuICAgICAgLi4uYW5hbHlzaXMubG93UHJpb3JpdHlGaWxlcy5zbGljZSgwLCA1KSxcbiAgICBdO1xuXG4gICAgdG9wQ2FuZGlkYXRlcy5mb3JFYWNoKGZpbGUgPT4ge1xuICAgICAgcmVwb3J0LnB1c2goYCMjIyAke2ZpbGUuZmlsZVBhdGh9YCk7XG4gICAgICByZXBvcnQucHVzaChgLSBQcmlvcml0eTogJHtmaWxlLnByaW9yaXR5fWApO1xuICAgICAgcmVwb3J0LnB1c2goYC0gU2FmZXR5IFNjb3JlOiAke2ZpbGUuc2FmZXR5U2NvcmV9YCk7XG4gICAgICByZXBvcnQucHVzaChgLSBVbnVzZWQgRXhwb3J0czogJHtmaWxlLnVudXNlZEV4cG9ydHMubGVuZ3RofWApO1xuICAgICAgcmVwb3J0LnB1c2goYC0gVHJhbnNmb3JtYXRpb24gQ2FuZGlkYXRlczogJHtmaWxlLnRyYW5zZm9ybWF0aW9uQ2FuZGlkYXRlcy5sZW5ndGh9YCk7XG4gICAgICByZXBvcnQucHVzaCgnJyk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gcmVwb3J0LmpvaW4oJ1xcbicpO1xuICB9XG59XG4iXSwidmVyc2lvbiI6M30=