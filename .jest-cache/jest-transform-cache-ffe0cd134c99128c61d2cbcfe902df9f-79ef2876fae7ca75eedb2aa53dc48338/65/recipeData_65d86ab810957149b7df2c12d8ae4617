043e92e94d58f18516d6f379eb8e410a
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.recipeData = exports.recipeDataService = void 0;
const logger_1 = require("../utils/logger");
const errorHandler_1 = require("./errorHandler");
const elementalMappings_1 = require("../data/recipes/elementalMappings");
const cache_1 = require("../utils/cache");
const RecipeElementalService_1 = require("./RecipeElementalService");
// Sample cuisines for initial data
const CUISINES = [
    'Italian',
    'Japanese',
    'Mexican',
    'Indian',
    'Chinese',
    'French',
    'Greek',
    'Thai'
];
// Cache key for recipes
const RECIPE_CACHE_KEY = 'all_recipes';
// Helper function for safe string extraction
function safeGetString(value) {
    if (typeof value === 'string') {
        return value;
    }
    return undefined;
}
/**
 * Ensures a recipe has all required properties with defaults as needed
 * This is the single source of truth for recipe validation and normalization
 */
function ensureRecipeProperties(recipe) {
    var _a, _b, _c, _d;
    if (!recipe) {
        throw new Error('Recipe cannot be null or undefined');
    }
    // Validate name format
    const recipeName = recipe === null || recipe === void 0 ? void 0 : recipe.name;
    if (recipeName && typeof recipeName === 'string') {
        if (recipeName.length < 3 || recipeName.length > 100) {
            throw new Error('Recipe name must be between 3 and 100 characters');
        }
    }
    // Core required properties with enhanced validation
    const safeRecipe = {
        id: safeGetString(recipe === null || recipe === void 0 ? void 0 : recipe.id) || `recipe-${Date.now()}`,
        name: safeGetString(recipe === null || recipe === void 0 ? void 0 : recipe.name) || 'Unnamed Recipe',
        description: safeGetString(recipe === null || recipe === void 0 ? void 0 : recipe.description) || '',
        cuisine: safeGetString(recipe === null || recipe === void 0 ? void 0 : recipe.cuisine) || '',
        ingredients: validateAndNormalizeIngredients(Array.isArray(recipe.ingredients) ? recipe.ingredients : []),
        instructions: validateAndNormalizeInstructions(recipe.instructions || []),
        timeToMake: validateAndNormalizeTime(recipe.timeToMake) || '30 minutes',
        numberOfServings: validateServings(recipe.numberOfServings) || 2,
        // Use the new recipe elemental service to ensure proper elemental properties
        elementalProperties: RecipeElementalService_1.recipeElementalService.standardizeRecipe(recipe).elementalProperties
    };
    // Optional properties with validation
    if (recipe === null || recipe === void 0 ? void 0 : recipe.mealType) {
        safeRecipe.mealType = validateMealType(recipe === null || recipe === void 0 ? void 0 : recipe.mealType);
    }
    if (recipe === null || recipe === void 0 ? void 0 : recipe.season) {
        safeRecipe.season = validateSeason(recipe === null || recipe === void 0 ? void 0 : recipe.season);
    }
    // Boolean properties
    safeRecipe.isVegetarian = (_a = recipe.isVegetarian) !== null && _a !== void 0 ? _a : false;
    safeRecipe.isVegan = (_b = recipe.isVegan) !== null && _b !== void 0 ? _b : false;
    safeRecipe.isGlutenFree = (_c = recipe.isGlutenFree) !== null && _c !== void 0 ? _c : false;
    safeRecipe.isDairyFree = (_d = recipe.isDairyFree) !== null && _d !== void 0 ? _d : false;
    // Optional complex properties
    if (recipe.astrologicalInfluences) {
        safeRecipe.astrologicalInfluences = validateAstrologicalInfluences(recipe.astrologicalInfluences);
    }
    if (recipe === null || recipe === void 0 ? void 0 : recipe.nutrition) {
        safeRecipe.nutrition = validateAndNormalizeNutrition(recipe === null || recipe === void 0 ? void 0 : recipe.nutrition);
    }
    // Timestamp handling
    safeRecipe.createdAt = recipe.createdAt || new Date().toISOString();
    safeRecipe.updatedAt = new Date().toISOString();
    return safeRecipe;
}
// Helper validation functions
function validateAndNormalizeIngredients(ingredients) {
    if (!Array.isArray(ingredients)) {
        throw new Error('Ingredients must be an array');
    }
    if (ingredients.length === 0) {
        throw new Error('Recipe must have at least one ingredient');
    }
    return ingredients.map(ing => ({
        name: safeGetString(ing === null || ing === void 0 ? void 0 : ing.name) || 'Unknown Ingredient',
        amount: typeof ing.amount === 'number' ? ing.amount : 1,
        unit: ing.unit || 'piece',
        category: ing.category || 'other',
        optional: ing.optional || false,
        preparation: ing.preparation || '',
        notes: ing.notes || '',
        // Standardize ingredient elemental properties too
        elementalProperties: (ing === null || ing === void 0 ? void 0 : ing.elementalProperties) ?
            RecipeElementalService_1.recipeElementalService.standardizeRecipe({ elementalProperties: ing === null || ing === void 0 ? void 0 : ing.elementalProperties }).elementalProperties || { Fire: 0.25, Water: 0.25, Earth: 0.25, Air: 0.25 } :
            { Fire: 0.25, Water: 0.25, Earth: 0.25, Air: 0.25 }
    }));
}
function validateAndNormalizeInstructions(instructions) {
    if (!Array.isArray(instructions)) {
        return ['Prepare ingredients', 'Cook until done'];
    }
    if (instructions.length === 0) {
        return ['Prepare ingredients', 'Cook until done'];
    }
    return instructions.map(step => typeof step === 'string' ? step : 'Prepare according to preference');
}
function validateAndNormalizeTime(time) {
    if (!time)
        return '30 minutes';
    if (typeof time === 'number') {
        return `${time} minutes`;
    }
    if (typeof time === 'string') {
        // Check if already has time units
        if (/minutes|mins|hours|hrs/i.test(time)) {
            return time;
        }
        // Try to parse as number
        const timeNum = parseInt(time, 10);
        if (!isNaN(timeNum)) {
            return `${timeNum} minutes`;
        }
    }
    return '30 minutes';
}
function validateServings(servings) {
    if (typeof servings === 'number') {
        return Math.max(1, Math.min(12, Math.round(servings)));
    }
    if (typeof servings === 'string') {
        const num = parseInt(servings, 10);
        if (!isNaN(num)) {
            return Math.max(1, Math.min(12, num));
        }
    }
    return 2;
}
function validateMealType(mealType) {
    const validMealTypes = ['breakfast', 'lunch', 'dinner', 'snack', 'dessert', 'drink', 'appetizer', 'side'];
    if (typeof mealType === 'string') {
        if (validMealTypes.includes(mealType.toLowerCase())) {
            return [mealType.toLowerCase()];
        }
        return ['dinner'];
    }
    if (Array.isArray(mealType)) {
        const validEntries = mealType
            .filter(type => typeof type === 'string')
            .map(type => type.toLowerCase())
            .filter(type => validMealTypes.includes(type));
        return validEntries.length > 0 ? validEntries : ['dinner'];
    }
    return ['dinner'];
}
function validateSeason(season) {
    const validSeasons = ['spring', 'summer', 'fall', 'winter', 'all'];
    if (typeof season === 'string') {
        if (validSeasons.includes(season.toLowerCase())) {
            return [season.toLowerCase()];
        }
        return ['all'];
    }
    if (Array.isArray(season)) {
        const validEntries = season
            .filter(s => typeof s === 'string')
            .map(s => s.toLowerCase())
            .filter(s => validSeasons.includes(s));
        return validEntries.length > 0 ? validEntries : ['all'];
    }
    return ['all'];
}
function validateAstrologicalInfluences(influences) {
    if (typeof influences === 'string') {
        return [influences];
    }
    if (Array.isArray(influences)) {
        const validEntries = influences
            .filter(i => typeof i === 'string')
            .filter(i => i.length > 0);
        return validEntries.length > 0 ? validEntries : ['all'];
    }
    return ['all'];
}
function validateAndNormalizeNutrition(nutrition) {
    if (!nutrition || typeof nutrition !== 'object') {
        return {};
    }
    const safeNutrition = {};
    // Validate numeric fields
    ['calories', 'protein', 'carbs', 'fat'].forEach(field => {
        if (typeof nutrition[field] === 'number') {
            safeNutrition[field] = nutrition[field];
        }
    });
    // Validate array fields (vitamins, minerals)
    if (Array.isArray(nutrition.vitamins)) {
        safeNutrition.vitamins = nutrition.vitamins
            .filter((v) => typeof v === 'string')
            .slice(0, 10); // Limit to 10 items
    }
    if (Array.isArray(nutrition.minerals)) {
        safeNutrition.minerals = nutrition.minerals
            .filter((m) => typeof m === 'string')
            .slice(0, 10); // Limit to 10 items
    }
    return safeNutrition;
}
class RecipeData {
    constructor() {
        this.recipes = [];
        this.initialized = false;
        this.initPromise = null;
        // Start loading data immediately
        this.initPromise = this.loadRecipeData();
    }
    async loadRecipeData() {
        try {
            logger_1.logger.info('Loading recipe data...');
            // Create recipes from mappings safely
            if (!elementalMappings_1.recipeElementalMappings) {
                logger_1.logger.error('recipeElementalMappings not found or invalid');
                this.recipes = [];
                this.initialized = true;
                return;
            }
            // Handle different formats of recipeElementalMappings
            const mappingsEntries = Array.isArray(elementalMappings_1.recipeElementalMappings)
                ? elementalMappings_1.recipeElementalMappings
                : Object.entries(elementalMappings_1.recipeElementalMappings).map(([id, mapping]) => ({
                    id,
                    ...mapping
                }));
            this.recipes = mappingsEntries.map((mapping) => {
                var _a, _b, _c, _d;
                let elementalProps = (mapping === null || mapping === void 0 ? void 0 : mapping.elementalProperties) || (mapping === null || mapping === void 0 ? void 0 : mapping.elementalProfile);
                // If no elemental properties, derive them from cuisine or other attributes
                if (!elementalProps) {
                    const mappingData = mapping;
                    elementalProps = RecipeElementalService_1.recipeElementalService.deriveElementalProperties({
                        cuisine: String(((_a = mappingData === null || mappingData === void 0 ? void 0 : mappingData.cuisine) === null || _a === void 0 ? void 0 : _a.name) || (mappingData === null || mappingData === void 0 ? void 0 : mappingData.cuisine) || ''),
                        cookingMethod: String((mappingData === null || mappingData === void 0 ? void 0 : mappingData.cookingMethod) || '')
                    });
                }
                // Create a partial recipe object with safe defaults
                const mappingData = mapping;
                const partialRecipe = {
                    id: safeGetString(mappingData === null || mappingData === void 0 ? void 0 : mappingData.id) || `recipe-${Date.now()}-${Math.random().toString(36).substring(2, 9)}`,
                    name: safeGetString(mappingData === null || mappingData === void 0 ? void 0 : mappingData.name) || safeGetString(mappingData === null || mappingData === void 0 ? void 0 : mappingData.id) || 'Unknown Recipe',
                    cuisine: safeGetString((_b = mappingData === null || mappingData === void 0 ? void 0 : mappingData.cuisine) === null || _b === void 0 ? void 0 : _b.name) || safeGetString(mappingData === null || mappingData === void 0 ? void 0 : mappingData.cuisine) || 'Unknown',
                    description: safeGetString(mappingData === null || mappingData === void 0 ? void 0 : mappingData.description) || safeGetString((_c = mappingData === null || mappingData === void 0 ? void 0 : mappingData.cuisine) === null || _c === void 0 ? void 0 : _c.description) || '',
                    elementalProperties: elementalProps,
                    ingredients: Array.isArray(mappingData === null || mappingData === void 0 ? void 0 : mappingData.ingredients)
                        ? mappingData.ingredients.map((ing) => {
                            const ingData = ing;
                            return {
                                name: String((ingData === null || ingData === void 0 ? void 0 : ingData.name) || 'Unknown Ingredient'),
                                amount: typeof (ingData === null || ingData === void 0 ? void 0 : ingData.amount) === 'number' ? ingData.amount : 1,
                                unit: String((ingData === null || ingData === void 0 ? void 0 : ingData.unit) || 'piece'),
                                category: String((ingData === null || ingData === void 0 ? void 0 : ingData.category) || 'other')
                            };
                        })
                        : [],
                    instructions: Array.isArray(mappingData === null || mappingData === void 0 ? void 0 : mappingData.instructions) ? mappingData.instructions : [],
                    timeToMake: (mappingData === null || mappingData === void 0 ? void 0 : mappingData.timeToMake) || '30 minutes',
                    energyProfile: (mappingData === null || mappingData === void 0 ? void 0 : mappingData.energyProfile) || {},
                    // Critical field: always ensure astrologicalInfluences is set
                    astrologicalInfluences: ((mappingData === null || mappingData === void 0 ? void 0 : mappingData.astrologicalInfluences) ?
                        (Array.isArray(mappingData.astrologicalInfluences) ?
                            mappingData.astrologicalInfluences :
                            [String(mappingData.astrologicalInfluences)]) :
                        (((_d = mappingData === null || mappingData === void 0 ? void 0 : mappingData.astrologicalProfile) === null || _d === void 0 ? void 0 : _d.rulingPlanets) ?
                            (Array.isArray(mappingData.astrologicalProfile.rulingPlanets) ?
                                mappingData.astrologicalProfile.rulingPlanets :
                                [String(mappingData.astrologicalProfile.rulingPlanets)]) :
                            ["all"])),
                    season: Array.isArray(mappingData === null || mappingData === void 0 ? void 0 : mappingData.seasonalProperties) ? mappingData.seasonalProperties :
                        Array.isArray(mappingData === null || mappingData === void 0 ? void 0 : mappingData.season) ? mappingData.season : ['all'],
                    mealType: Array.isArray(mappingData === null || mappingData === void 0 ? void 0 : mappingData.mealType) ? mappingData.mealType : ['dinner'],
                    numberOfServings: typeof (mappingData === null || mappingData === void 0 ? void 0 : mappingData.servings) === 'number' ? mappingData.servings : 2,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                // Ensure all properties are properly set with defaults as needed
                return ensureRecipeProperties(partialRecipe);
            });
            // Mark as initialized
            this.initialized = true;
            logger_1.logger.info(`Loaded ${this.recipes.length} recipes successfully`);
            // Cache the recipes
            cache_1.cache.set(RECIPE_CACHE_KEY, this.recipes);
        }
        catch (error) {
            logger_1.logger.error('Error loading recipes:', error);
            // Initialize with an empty array to prevent further errors
            this.recipes = [];
            this.initialized = true;
        }
    }
    // Add a method to standardize recipes after they've been loaded from anywhere
    standardizeRecipes(recipes) {
        return recipes.map(recipe => {
            // First ensure elemental properties are properly set
            const withElementalProps = RecipeElementalService_1.recipeElementalService.standardizeRecipe(recipe);
            // Then ensure all other properties are valid
            return ensureRecipeProperties({
                ...recipe,
                elementalProperties: (withElementalProps === null || withElementalProps === void 0 ? void 0 : withElementalProps.elementalProperties) || { Fire: 0.25, Water: 0.25, Earth: 0.25, Air: 0.25 }
            });
        });
    }
    async getAllRecipes() {
        try {
            // Check cache first
            const cachedRecipes = cache_1.cache.get(RECIPE_CACHE_KEY);
            if (cachedRecipes) {
                // Standardize all cached recipes
                return this.standardizeRecipes(cachedRecipes);
            }
            // If not initialized, wait for initialization
            if (!this.initialized) {
                logger_1.logger.info('Waiting for recipe data to initialize...');
                if (this.initPromise) {
                    await this.initPromise;
                }
                else {
                    await this.loadRecipeData();
                }
            }
            // If we still have no recipes, return at least a fallback recipe
            if (!this.recipes.length) {
                const fallbackRecipe = this.getFallbackRecipe();
                return [fallbackRecipe];
            }
            // Standardize all recipes
            const safeRecipes = this.standardizeRecipes(this.recipes);
            // Update cache
            cache_1.cache.set(RECIPE_CACHE_KEY, safeRecipes);
            return safeRecipes;
        }
        catch (error) {
            errorHandler_1.errorHandler.handleError(error, {
                context: 'RecipeData',
                action: 'getAllRecipes'
            });
            // Return at least one fallback recipe to prevent application errors
            return [this.getFallbackRecipe()];
        }
    }
    getFallbackRecipe() {
        return ensureRecipeProperties({
            id: 'universal-balance',
            name: "Universal Balance Bowl",
            description: "A harmonious blend for any occasion",
            ingredients: [
                { name: "Mixed Greens", amount: 2, unit: "cups", category: "vegetables" },
                { name: "Quinoa", amount: 1, unit: "cup", category: "grains" },
                { name: "Mixed Seeds", amount: 0.25, unit: "cup", category: "garnish" }
            ],
            instructions: [
                "Combine all ingredients in a bowl",
                "Season to taste",
                "Enjoy mindfully"
            ],
            timeToMake: "15 minutes",
            numberOfServings: 2,
            elementalProperties: {
                Fire: 0.25, Earth: 0.25, Air: 0.25, Water: 0.25
            },
            season: ["all"],
            mealType: ["lunch", "dinner"],
            cuisine: "international",
            isVegetarian: true,
            isVegan: true,
            isGlutenFree: true,
            isDairyFree: true,
            score: 1,
            astrologicalInfluences: ["all"]
        });
    }
    async getRecipeByCuisine(cuisine) {
        try {
            if (this.initPromise) {
                await this.initPromise;
            }
            const allRecipes = await this.getAllRecipes();
            return allRecipes.filter(recipe => {
                const recipeData = recipe;
                const recipeCuisine = String((recipeData === null || recipeData === void 0 ? void 0 : recipeData.cuisine) || '').toLowerCase();
                const targetCuisine = String(cuisine || '').toLowerCase();
                return recipeCuisine === targetCuisine;
            });
        }
        catch (error) {
            errorHandler_1.errorHandler.handleError(error, {
                context: 'RecipeData',
                action: 'getRecipeByCuisine',
                cuisine
            });
            return [this.getFallbackRecipe()];
        }
    }
    async searchRecipes(query) {
        var _a;
        try {
            if (this.initPromise) {
                await this.initPromise;
            }
            const lowercaseQuery = (_a = query === null || query === void 0 ? void 0 : query.toLowerCase) === null || _a === void 0 ? void 0 : _a.call(query);
            const recipes = await this.getAllRecipes();
            return recipes.filter(recipe => {
                const recipeData = recipe;
                const recipeName = String((recipeData === null || recipeData === void 0 ? void 0 : recipeData.name) || '').toLowerCase();
                const recipeCuisine = String((recipeData === null || recipeData === void 0 ? void 0 : recipeData.cuisine) || '').toLowerCase();
                return recipeName.includes(lowercaseQuery) || recipeCuisine.includes(lowercaseQuery);
            });
        }
        catch (error) {
            errorHandler_1.errorHandler.handleError(error, {
                context: 'RecipeData',
                action: 'searchRecipes',
                query
            });
            return [this.getFallbackRecipe()];
        }
    }
    async getRecommendedRecipes(count = 3) {
        try {
            if (this.initPromise) {
                await this.initPromise;
            }
            const recipes = await this.getAllRecipes();
            // For now, just return random recipes
            return recipes
                .sort(() => Math.random() - 0.5)
                .slice(0, count);
        }
        catch (error) {
            errorHandler_1.errorHandler.handleError(error, {
                context: 'RecipeData',
                action: 'getRecommendedRecipes'
            });
            return [this.getFallbackRecipe()];
        }
    }
    async addRecipe(recipe) {
        // Ensure the recipe has all required properties
        const newRecipe = ensureRecipeProperties(recipe);
        // Add to recipes array
        this.recipes.push(newRecipe);
        // Clear cache
        cache_1.cache.delete(RECIPE_CACHE_KEY);
        return newRecipe;
    }
    async getRecipeById(id) {
        try {
            const recipes = await this.getAllRecipes();
            const recipe = recipes.find(r => r.id === id);
            return recipe || null;
        }
        catch (error) {
            errorHandler_1.errorHandler.handleError(error, {
                context: 'RecipeData',
                action: 'getRecipeById',
                id
            });
            return null;
        }
    }
    async filterRecipes(filters) {
        try {
            if (this.initPromise) {
                await this.initPromise;
            }
            const recipes = await this.getAllRecipes();
            const filteredRecipes = recipes.filter(recipe => {
                // Filter by cuisine
                if (filters.cuisine && recipe.cuisine) {
                    const recipeCuisine = String(recipe.cuisine || '').toLowerCase();
                    const targetCuisine = String(filters.cuisine || '').toLowerCase();
                    if (!recipeCuisine.includes(targetCuisine)) {
                        return false;
                    }
                }
                // Filter by meal type
                if (filters.mealType && filters.mealType.length > 0 && recipe.mealType) {
                    const mealTypes = Array.isArray(recipe.mealType)
                        ? recipe.mealType.map(mt => String(mt || '').toLowerCase())
                        : [String(recipe.mealType || '').toLowerCase()];
                    const targetMealTypes = filters.mealType.map(mt => String(mt || '').toLowerCase());
                    if (!targetMealTypes.some(target => mealTypes.includes(target))) {
                        return false;
                    }
                }
                // Filter by season
                if (filters.season && filters.season.length > 0 && recipe.season) {
                    const seasons = Array.isArray(recipe.season)
                        ? recipe.season.map(s => String(s || '').toLowerCase())
                        : [String(recipe.season || '').toLowerCase()];
                    // Special case: if 'all' is included in recipe seasons, it matches any season
                    if (!seasons.includes('all')) {
                        const targetSeasons = filters.season.map(s => String(s || '').toLowerCase());
                        if (!targetSeasons.some(target => seasons.includes(target))) {
                            return false;
                        }
                    }
                }
                // Filter by astrological influences
                if (filters.astrologicalInfluences && filters.astrologicalInfluences.length > 0) {
                    const influences = recipe.astrologicalInfluences || [];
                    // Special case: if 'all' is included, it matches any influence
                    if (!influences.includes('all')) {
                        const hasMatch = filters.astrologicalInfluences.some(influence => influences.some(recipeInfluence => String(recipeInfluence || '').toLowerCase() === String(influence || '').toLowerCase()));
                        if (!hasMatch) {
                            return false;
                        }
                    }
                }
                // Filter by dietary restrictions
                if (filters.isVegetarian && recipe.isVegetarian === false) {
                    return false;
                }
                if (filters.isVegan && recipe.isVegan === false) {
                    return false;
                }
                if (filters.isGlutenFree && recipe.isGlutenFree === false) {
                    return false;
                }
                if (filters.isDairyFree && recipe.isDairyFree === false) {
                    return false;
                }
                return true;
            });
            return filteredRecipes;
        }
        catch (error) {
            errorHandler_1.errorHandler.handleError(error, {
                context: 'RecipeData',
                action: 'filterRecipes'
            });
            return [this.getFallbackRecipe()];
        }
    }
}
// Export the singleton instance
exports.recipeDataService = new RecipeData();
// Export alias for compatibility
exports.recipeData = exports.recipeDataService;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9zZXJ2aWNlcy9yZWNpcGVEYXRhLnRzIiwibWFwcGluZ3MiOiI7OztBQVlBLDRDQUF3QztBQUN4QyxpREFBNkM7QUFDN0MseUVBQTJFO0FBTTNFLDBDQUFzQztBQUd0QyxxRUFBaUU7QUFhakUsbUNBQW1DO0FBQ25DLE1BQU0sUUFBUSxHQUFHO0lBQ2YsU0FBUztJQUNULFVBQVU7SUFDVixTQUFTO0lBQ1QsUUFBUTtJQUNSLFNBQVM7SUFDVCxRQUFRO0lBQ1IsT0FBTztJQUNQLE1BQU07Q0FDUCxDQUFBO0FBRUQsd0JBQXdCO0FBQ3hCLE1BQU0sZ0JBQWdCLEdBQUcsYUFBYSxDQUFBO0FBRXRDLDZDQUE2QztBQUM3QyxTQUFTLGFBQWEsQ0FBQyxLQUFjO0lBQ25DLElBQUksT0FBTyxLQUFLLEtBQUssUUFBUSxFQUFFO1FBQzdCLE9BQU8sS0FBSyxDQUFDO0tBQ2Q7SUFDRCxPQUFPLFNBQVMsQ0FBQztBQUNuQixDQUFDO0FBRUQ7OztHQUdHO0FBQ0gsU0FBUyxzQkFBc0IsQ0FBQyxNQUF1Qjs7SUFDckQsSUFBSSxDQUFDLE1BQU0sRUFBRTtRQUNYLE1BQU0sSUFBSSxLQUFLLENBQUMsb0NBQW9DLENBQUMsQ0FBQztLQUN2RDtJQUVELHVCQUF1QjtJQUN2QixNQUFNLFVBQVUsR0FBSSxNQUFrQyxhQUFsQyxNQUFNLHVCQUFOLE1BQU0sQ0FBOEIsSUFBSSxDQUFDO0lBQzdELElBQUksVUFBVSxJQUFJLE9BQU8sVUFBVSxLQUFLLFFBQVEsRUFBRTtRQUNoRCxJQUFJLFVBQVUsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxJQUFJLFVBQVUsQ0FBQyxNQUFNLEdBQUcsR0FBRyxFQUFFO1lBQ3BELE1BQU0sSUFBSSxLQUFLLENBQUMsa0RBQWtELENBQUMsQ0FBQztTQUNyRTtLQUNGO0lBRUQsb0RBQW9EO0lBQ3BELE1BQU0sVUFBVSxHQUFXO1FBQ3pCLEVBQUUsRUFBRSxhQUFhLENBQUUsTUFBa0MsYUFBbEMsTUFBTSx1QkFB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SyxFQUFFO2dCQUM5QixPQUFPLEVBQUUsWUFBWTtnQkFDckIsTUFBTSxFQUFFLGVBQWU7YUFDeEIsQ0FBQyxDQUFDO1lBQ0gsT0FBTyxDQUFDLElBQUksQ0FBQyxpQkFBaUIsRUFBRSxDQUFDLENBQUM7U0FDbkM7SUFDSCxDQUFDO0NBQ0Y7QUFFRCxnQ0FBZ0M7QUFDbkIsUUFBQSxpQkFBaUIsR0FBRyxJQUFJLFVBQVUsRUFBRSxDQUFDO0FBRWxELGlDQUFpQztBQUNwQixRQUFBLFVBQVUsR0FBRyx5QkFBaUIsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvR3JlZ0Nhc3Ryby9EZXNrdG9wL1doYXRUb0VhdE5leHQvc3JjL3NlcnZpY2VzL3JlY2lwZURhdGEudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gRW5oYW5jZWQgUmVjaXBlIGludGVyZmFjZXMgZm9yIFBoYXNlIDExXG5leHBvcnQgaW50ZXJmYWNlIFJlY2lwZURhdGFFbmhhbmNlZCB7XG4gIGlkPzogc3RyaW5nO1xuICBuYW1lPzogc3RyaW5nO1xuICBkZXNjcmlwdGlvbj86IHN0cmluZztcbiAgY3Vpc2luZT86IHN0cmluZztcbiAgZmxhdm9yUHJvZmlsZT86IFJlY29yZDxzdHJpbmcsIG51bWJlcj47XG4gIGFzdHJvbG9naWNhbFByb2ZpbGU/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xuICBzZWFzb24/OiBzdHJpbmcgfCBzdHJpbmdbXTtcbiAgbWVhbFR5cGU/OiBzdHJpbmcgfCBzdHJpbmdbXTtcbn1cbmltcG9ydCB0eXBlIHsgUmVjaXBlIH0gZnJvbSAnLi4vdHlwZXMvcmVjaXBlJ1xuaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSAnLi4vdXRpbHMvbG9nZ2VyJ1xuaW1wb3J0IHsgZXJyb3JIYW5kbGVyIH0gZnJvbSAnLi9lcnJvckhhbmRsZXInXG5pbXBvcnQgeyByZWNpcGVFbGVtZW50YWxNYXBwaW5ncyB9IGZyb20gJy4uL2RhdGEvcmVjaXBlcy9lbGVtZW50YWxNYXBwaW5ncydcbmltcG9ydCB7IHNwaWNlcyB9IGZyb20gJy4uL2RhdGEvaW5ncmVkaWVudHMvc3BpY2VzJ1xuaW1wb3J0IHsgaGVyYnMgfSBmcm9tICcuLi9kYXRhL2luZ3JlZGllbnRzL2hlcmJzJ1xuaW1wb3J0IHsgZnJ1aXRzIH0gZnJvbSAnLi4vZGF0YS9pbmdyZWRpZW50cy9mcnVpdHMnXG5pbXBvcnQgeyB2ZWdldGFibGVzIH0gZnJvbSAnLi4vZGF0YS9pbmdyZWRpZW50cy92ZWdldGFibGVzJ1xuaW1wb3J0IHsgc2Vhc29uaW5ncyB9IGZyb20gJy4uL2RhdGEvaW5ncmVkaWVudHMvc2Vhc29uaW5ncydcbmltcG9ydCB7IGNhY2hlIH0gZnJvbSAnLi4vdXRpbHMvY2FjaGUnXG5pbXBvcnQgeyB2YWxpZGF0ZUVsZW1lbnRhbFByb3BlcnRpZXMgfSBmcm9tICcuLi90eXBlcy9yZWNpcGUnXG5pbXBvcnQgeyBSZWNpcGVJbmdyZWRpZW50IH0gZnJvbSAnLi4vdHlwZXMvcmVjaXBlSW5ncmVkaWVudCdcbmltcG9ydCB7IHJlY2lwZUVsZW1lbnRhbFNlcnZpY2UgfSBmcm9tICcuL1JlY2lwZUVsZW1lbnRhbFNlcnZpY2UnXG5cbi8vIERlZmluZSBpbnRlcmZhY2UgZm9yIG51dHJpdGlvbiBkYXRhXG5leHBvcnQgaW50ZXJmYWNlIE51dHJpdGlvbkRhdGEge1xuICBjYWxvcmllcz86IG51bWJlcjtcbiAgcHJvdGVpbj86IG51bWJlcjtcbiAgY2FyYnM/OiBudW1iZXI7XG4gIGZhdD86IG51bWJlcjtcbiAgdml0YW1pbnM/OiBzdHJpbmdbXTtcbiAgbWluZXJhbHM/OiBzdHJpbmdbXTtcbiAgW2tleTogc3RyaW5nXTogdW5rbm93bjsgLy8gQWxsb3cgb3RoZXIgcHJvcGVydGllc1xufVxuXG4vLyBTYW1wbGUgY3Vpc2luZXMgZm9yIGluaXRpYWwgZGF0YVxuY29uc3QgQ1VJU0lORVMgPSBbXG4gICdJdGFsaWFuJyxcbiAgJ0phcGFuZXNlJyxcbiAgJ01leGljYW4nLFxuICAnSW5kaWFuJyxcbiAgJ0NoaW5lc2UnLFxuICAnRnJlbmNoJyxcbiAgJ0dyZWVrJyxcbiAgJ1RoYWknXG5dXG5cbi8vIENhY2hlIGtleSBmb3IgcmVjaXBlc1xuY29uc3QgUkVDSVBFX0NBQ0hFX0tFWSA9ICdhbGxfcmVjaXBlcydcblxuLy8gSGVscGVyIGZ1bmN0aW9uIGZvciBzYWZlIHN0cmluZyBleHRyYWN0aW9uXG5mdW5jdGlvbiBzYWZlR2V0U3RyaW5nKHZhbHVlOiB1bmtub3duKTogc3RyaW5nIHwgdW5kZWZpbmVkIHtcbiAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICByZXR1cm4gdmFsdWU7XG4gIH1cbiAgcmV0dXJuIHVuZGVmaW5lZDtcbn1cblxuLyoqXG4gKiBFbnN1cmVzIGEgcmVjaXBlIGhhcyBhbGwgcmVxdWlyZWQgcHJvcGVydGllcyB3aXRoIGRlZmF1bHRzIGFzIG5lZWRlZFxuICogVGhpcyBpcyB0aGUgc2luZ2xlIHNvdXJjZSBvZiB0cnV0aCBmb3IgcmVjaXBlIHZhbGlkYXRpb24gYW5kIG5vcm1hbGl6YXRpb25cbiAqL1xuZnVuY3Rpb24gZW5zdXJlUmVjaXBlUHJvcGVydGllcyhyZWNpcGU6IFBhcnRpYWw8UmVjaXBlPik6IFJlY2lwZSB7XG4gIGlmICghcmVjaXBlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdSZWNpcGUgY2Fubm90IGJlIG51bGwgb3IgdW5kZWZpbmVkJyk7XG4gIH1cblxuICAvLyBWYWxpZGF0ZSBuYW1lIGZvcm1hdFxuICBjb25zdCByZWNpcGVOYW1lID0gKHJlY2lwZSBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPik/Lm5hbWU7XG4gIGlmIChyZWNpcGVOYW1lICYmIHR5cGVvZiByZWNpcGVOYW1lID09PSAnc3RyaW5nJykge1xuICAgIGlmIChyZWNpcGVOYW1lLmxlbmd0aCA8IDMgfHwgcmVjaXBlTmFtZS5sZW5ndGggPiAxMDApIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignUmVjaXBlIG5hbWUgbXVzdCBiZSBiZXR3ZWVuIDMgYW5kIDEwMCBjaGFyYWN0ZXJzJyk7XG4gICAgfVxuICB9XG5cbiAgLy8gQ29yZSByZXF1aXJlZCBwcm9wZXJ0aWVzIHdpdGggZW5oYW5jZWQgdmFsaWRhdGlvblxuICBjb25zdCBzYWZlUmVjaXBlOiBSZWNpcGUgPSB7XG4gICAgaWQ6IHNhZmVHZXRTdHJpbmcoKHJlY2lwZSBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPik/LmlkKSB8fCBgcmVjaXBlLSR7RGF0ZS5ub3coKX1gLFxuICAgIG5hbWU6IHNhZmVHZXRTdHJpbmcoKHJlY2lwZSBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPik/Lm5hbWUpIHx8ICdVbm5hbWVkIFJlY2lwZScsXG4gICAgZGVzY3JpcHRpb246IHNhZmVHZXRTdHJpbmcoKHJlY2lwZSBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPik/LmRlc2NyaXB0aW9uKSB8fCAnJyxcbiAgICBjdWlzaW5lOiBzYWZlR2V0U3RyaW5nKChyZWNpcGUgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pPy5jdWlzaW5lKSB8fCAnJyxcbiAgICBpbmdyZWRpZW50czogdmFsaWRhdGVBbmROb3JtYWxpemVJbmdyZWRpZW50cyhBcnJheS5pc0FycmF5KHJlY2lwZS5pbmdyZWRpZW50cykgPyByZWNpcGUuaW5ncmVkaWVudHMgYXMgUGFydGlhbDxSZWNpcGVJbmdyZWRpZW50PltdIDogW10pLFxuICAgIGluc3RydWN0aW9uczogdmFsaWRhdGVBbmROb3JtYWxpemVJbnN0cnVjdGlvbnMocmVjaXBlLmluc3RydWN0aW9ucyB8fCBbXSksXG4gICAgdGltZVRvTWFrZTogdmFsaWRhdGVBbmROb3JtYWxpemVUaW1lKHJlY2lwZS50aW1lVG9NYWtlKSB8fCAnMzAgbWludXRlcycsXG4gICAgbnVtYmVyT2ZTZXJ2aW5nczogdmFsaWRhdGVTZXJ2aW5ncyhyZWNpcGUubnVtYmVyT2ZTZXJ2aW5ncykgfHwgMixcbiAgICAvLyBVc2UgdGhlIG5ldyByZWNpcGUgZWxlbWVudGFsIHNlcnZpY2UgdG8gZW5zdXJlIHByb3BlciBlbGVtZW50YWwgcHJvcGVydGllc1xuICAgIGVsZW1lbnRhbFByb3BlcnRpZXM6IHJlY2lwZUVsZW1lbnRhbFNlcnZpY2Uuc3RhbmRhcmRpemVSZWNpcGUocmVjaXBlKS5lbGVtZW50YWxQcm9wZXJ0aWVzXG4gIH07XG5cbiAgLy8gT3B0aW9uYWwgcHJvcGVydGllcyB3aXRoIHZhbGlkYXRpb25cbiAgaWYgKChyZWNpcGUgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pPy5tZWFsVHlwZSkge1xuICAgIHNhZmVSZWNpcGUubWVhbFR5cGUgPSB2YWxpZGF0ZU1lYWxUeXBlKChyZWNpcGUgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pPy5tZWFsVHlwZSk7XG4gIH1cbiAgaWYgKChyZWNpcGUgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pPy5zZWFzb24pIHtcbiAgICBzYWZlUmVjaXBlLnNlYXNvbiA9IHZhbGlkYXRlU2Vhc29uKChyZWNpcGUgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pPy5zZWFzb24pO1xuICB9XG4gIFxuICAvLyBCb29sZWFuIHByb3BlcnRpZXNcbiAgc2FmZVJlY2lwZS5pc1ZlZ2V0YXJpYW4gPSByZWNpcGUuaXNWZWdldGFyaWFuID8/IGZhbHNlO1xuICBzYWZlUmVjaXBlLmlzVmVnYW4gPSByZWNpcGUuaXNWZWdhbiA/PyBmYWxzZTtcbiAgc2FmZVJlY2lwZS5pc0dsdXRlbkZyZWUgPSByZWNpcGUuaXNHbHV0ZW5GcmVlID8/IGZhbHNlO1xuICBzYWZlUmVjaXBlLmlzRGFpcnlGcmVlID0gcmVjaXBlLmlzRGFpcnlGcmVlID8/IGZhbHNlO1xuXG4gIC8vIE9wdGlvbmFsIGNvbXBsZXggcHJvcGVydGllc1xuICBpZiAocmVjaXBlLmFzdHJvbG9naWNhbEluZmx1ZW5jZXMpIHtcbiAgICBzYWZlUmVjaXBlLmFzdHJvbG9naWNhbEluZmx1ZW5jZXMgPSB2YWxpZGF0ZUFzdHJvbG9naWNhbEluZmx1ZW5jZXMocmVjaXBlLmFzdHJvbG9naWNhbEluZmx1ZW5jZXMpO1xuICB9XG4gIGlmICgocmVjaXBlIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KT8ubnV0cml0aW9uKSB7XG4gICAgc2FmZVJlY2lwZS5udXRyaXRpb24gPSB2YWxpZGF0ZUFuZE5vcm1hbGl6ZU51dHJpdGlvbigocmVjaXBlIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KT8ubnV0cml0aW9uIGFzIE51dHJpdGlvbkRhdGEpO1xuICB9XG5cbiAgLy8gVGltZXN0YW1wIGhhbmRsaW5nXG4gIHNhZmVSZWNpcGUuY3JlYXRlZEF0ID0gcmVjaXBlLmNyZWF0ZWRBdCB8fCBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCk7XG4gIHNhZmVSZWNpcGUudXBkYXRlZEF0ID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xuXG4gIHJldHVybiBzYWZlUmVjaXBlO1xufVxuXG4vLyBIZWxwZXIgdmFsaWRhdGlvbiBmdW5jdGlvbnNcbmZ1bmN0aW9uIHZhbGlkYXRlQW5kTm9ybWFsaXplSW5ncmVkaWVudHMoaW5ncmVkaWVudHM6IEFycmF5PFBhcnRpYWw8UmVjaXBlSW5ncmVkaWVudD4+KTogUmVjaXBlSW5ncmVkaWVudFtdIHtcbiAgaWYgKCFBcnJheS5pc0FycmF5KGluZ3JlZGllbnRzKSkge1xuICAgIHRocm93IG5ldyBFcnJvcignSW5ncmVkaWVudHMgbXVzdCBiZSBhbiBhcnJheScpO1xuICB9XG4gIFxuICBpZiAoaW5ncmVkaWVudHMubGVuZ3RoID09PSAwKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdSZWNpcGUgbXVzdCBoYXZlIGF0IGxlYXN0IG9uZSBpbmdyZWRpZW50Jyk7XG4gIH1cblxuICByZXR1cm4gaW5ncmVkaWVudHMubWFwKGluZyA9PiAoe1xuICAgIG5hbWU6IHNhZmVHZXRTdHJpbmcoKGluZyBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPik/Lm5hbWUpIHx8ICdVbmtub3duIEluZ3JlZGllbnQnLFxuICAgIGFtb3VudDogdHlwZW9mIGluZy5hbW91bnQgPT09ICdudW1iZXInID8gaW5nLmFtb3VudCA6IDEsXG4gICAgdW5pdDogaW5nLnVuaXQgfHwgJ3BpZWNlJyxcbiAgICBjYXRlZ29yeTogaW5nLmNhdGVnb3J5IHx8ICdvdGhlcicsXG4gICAgb3B0aW9uYWw6IGluZy5vcHRpb25hbCB8fCBmYWxzZSxcbiAgICBwcmVwYXJhdGlvbjogaW5nLnByZXBhcmF0aW9uIHx8ICcnLFxuICAgIG5vdGVzOiBpbmcubm90ZXMgfHwgJycsXG4gICAgLy8gU3RhbmRhcmRpemUgaW5ncmVkaWVudCBlbGVtZW50YWwgcHJvcGVydGllcyB0b29cbiAgICBlbGVtZW50YWxQcm9wZXJ0aWVzOiAoaW5nIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KT8uZWxlbWVudGFsUHJvcGVydGllcyA/IFxuICAgICAgKHJlY2lwZUVsZW1lbnRhbFNlcnZpY2Uuc3RhbmRhcmRpemVSZWNpcGUoe2VsZW1lbnRhbFByb3BlcnRpZXM6IChpbmcgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pPy5lbGVtZW50YWxQcm9wZXJ0aWVzfSkuZWxlbWVudGFsUHJvcGVydGllcyBhcyBFbGVtZW50YWxQcm9wZXJ0aWVzKSB8fCB7IEZpcmU6IDAuMjUsIFdhdGVyOiAwLjI1LCBFYXJ0aDogMC4yNSwgQWlyOiAwLjI1IH0gOiBcbiAgICAgIHsgRmlyZTogMC4yNSwgV2F0ZXI6IDAuMjUsIEVhcnRoOiAwLjI1LCBBaXI6IDAuMjUgfVxuICB9KSk7XG59XG5cbmZ1bmN0aW9uIHZhbGlkYXRlQW5kTm9ybWFsaXplSW5zdHJ1Y3Rpb25zKGluc3RydWN0aW9uczogc3RyaW5nW10gfCB1bmtub3duW10pOiBzdHJpbmdbXSB7XG4gIGlmICghQXJyYXkuaXNBcnJheShpbnN0cnVjdGlvbnMpKSB7XG4gICAgcmV0dXJuIFsnUHJlcGFyZSBpbmdyZWRpZW50cycsICdDb29rIHVudGlsIGRvbmUnXTtcbiAgfVxuICBcbiAgaWYgKGluc3RydWN0aW9ucy5sZW5ndGggPT09IDApIHtcbiAgICByZXR1cm4gWydQcmVwYXJlIGluZ3JlZGllbnRzJywgJ0Nvb2sgdW50aWwgZG9uZSddO1xuICB9XG4gIFxuICByZXR1cm4gaW5zdHJ1Y3Rpb25zLm1hcChzdGVwID0+IFxuICAgIHR5cGVvZiBzdGVwID09PSAnc3RyaW5nJyA/IHN0ZXAgOiAnUHJlcGFyZSBhY2NvcmRpbmcgdG8gcHJlZmVyZW5jZSdcbiAgKTtcbn1cblxuZnVuY3Rpb24gdmFsaWRhdGVBbmROb3JtYWxpemVUaW1lKHRpbWU6IHN0cmluZyB8IG51bWJlciB8IHVua25vd24pOiBzdHJpbmcge1xuICBpZiAoIXRpbWUpIHJldHVybiAnMzAgbWludXRlcyc7XG4gIFxuICBpZiAodHlwZW9mIHRpbWUgPT09ICdudW1iZXInKSB7XG4gICAgcmV0dXJuIGAke3RpbWV9IG1pbnV0ZXNgO1xuICB9XG4gIFxuICBpZiAodHlwZW9mIHRpbWUgPT09ICdzdHJpbmcnKSB7XG4gICAgLy8gQ2hlY2sgaWYgYWxyZWFkeSBoYXMgdGltZSB1bml0c1xuICAgIGlmICgvbWludXRlc3xtaW5zfGhvdXJzfGhycy9pLnRlc3QodGltZSkpIHtcbiAgICAgIHJldHVybiB0aW1lO1xuICAgIH1cbiAgICBcbiAgICAvLyBUcnkgdG8gcGFyc2UgYXMgbnVtYmVyXG4gICAgY29uc3QgdGltZU51bSA9IHBhcnNlSW50KHRpbWUsIDEwKTtcbiAgICBpZiAoIWlzTmFOKHRpbWVOdW0pKSB7XG4gICAgICByZXR1cm4gYCR7dGltZU51bX0gbWludXRlc2A7XG4gICAgfVxuICB9XG4gIFxuICByZXR1cm4gJzMwIG1pbnV0ZXMnO1xufVxuXG5mdW5jdGlvbiB2YWxpZGF0ZVNlcnZpbmdzKHNlcnZpbmdzOiBudW1iZXIgfCBzdHJpbmcgfCB1bmtub3duKTogbnVtYmVyIHtcbiAgaWYgKHR5cGVvZiBzZXJ2aW5ncyA9PT0gJ251bWJlcicpIHtcbiAgICByZXR1cm4gTWF0aC5tYXgoMSwgTWF0aC5taW4oMTIsIE1hdGgucm91bmQoc2VydmluZ3MpKSk7XG4gIH1cbiAgXG4gIGlmICh0eXBlb2Ygc2VydmluZ3MgPT09ICdzdHJpbmcnKSB7XG4gICAgY29uc3QgbnVtID0gcGFyc2VJbnQoc2VydmluZ3MsIDEwKTtcbiAgICBpZiAoIWlzTmFOKG51bSkpIHtcbiAgICAgIHJldHVybiBNYXRoLm1heCgxLCBNYXRoLm1pbigxMiwgbnVtKSk7XG4gICAgfVxuICB9XG4gIFxuICByZXR1cm4gMjtcbn1cblxuZnVuY3Rpb24gdmFsaWRhdGVNZWFsVHlwZShtZWFsVHlwZTogc3RyaW5nIHwgc3RyaW5nW10gfCB1bmtub3duKTogc3RyaW5nW10ge1xuICBjb25zdCB2YWxpZE1lYWxUeXBlcyA9IFsnYnJlYWtmYXN0JywgJ2x1bmNoJywgJ2Rpbm5lcicsICdzbmFjaycsICdkZXNzZXJ0JywgJ2RyaW5rJywgJ2FwcGV0aXplcicsICdzaWRlJ107XG4gIFxuICBpZiAodHlwZW9mIG1lYWxUeXBlID09PSAnc3RyaW5nJykge1xuICAgIGlmICh2YWxpZE1lYWxUeXBlcy5pbmNsdWRlcyhtZWFsVHlwZS50b0xvd2VyQ2FzZSgpKSkge1xuICAgICAgcmV0dXJuIFttZWFsVHlwZS50b0xvd2VyQ2FzZSgpXTtcbiAgICB9XG4gICAgcmV0dXJuIFsnZGlubmVyJ107XG4gIH1cbiAgXG4gIGlmIChBcnJheS5pc0FycmF5KG1lYWxUeXBlKSkge1xuICAgIGNvbnN0IHZhbGlkRW50cmllcyA9IG1lYWxUeXBlXG4gICAgICAuZmlsdGVyKHR5cGUgPT4gdHlwZW9mIHR5cGUgPT09ICdzdHJpbmcnKVxuICAgICAgLm1hcCh0eXBlID0+ICh0eXBlIGFzIHN0cmluZykudG9Mb3dlckNhc2UoKSlcbiAgICAgIC5maWx0ZXIodHlwZSA9PiB2YWxpZE1lYWxUeXBlcy5pbmNsdWRlcyh0eXBlKSk7XG4gICAgXG4gICAgcmV0dXJuIHZhbGlkRW50cmllcy5sZW5ndGggPiAwID8gdmFsaWRFbnRyaWVzIDogWydkaW5uZXInXTtcbiAgfVxuICBcbiAgcmV0dXJuIFsnZGlubmVyJ107XG59XG5cbmZ1bmN0aW9uIHZhbGlkYXRlU2Vhc29uKHNlYXNvbjogc3RyaW5nIHwgc3RyaW5nW10gfCB1bmtub3duKTogc3RyaW5nW10ge1xuICBjb25zdCB2YWxpZFNlYXNvbnMgPSBbJ3NwcmluZycsICdzdW1tZXInLCAnZmFsbCcsICd3aW50ZXInLCAnYWxsJ107XG4gIFxuICBpZiAodHlwZW9mIHNlYXNvbiA9PT0gJ3N0cmluZycpIHtcbiAgICBpZiAodmFsaWRTZWFzb25zLmluY2x1ZGVzKHNlYXNvbi50b0xvd2VyQ2FzZSgpKSkge1xuICAgICAgcmV0dXJuIFtzZWFzb24udG9Mb3dlckNhc2UoKV07XG4gICAgfVxuICAgIHJldHVybiBbJ2FsbCddO1xuICB9XG4gIFxuICBpZiAoQXJyYXkuaXNBcnJheShzZWFzb24pKSB7XG4gICAgY29uc3QgdmFsaWRFbnRyaWVzID0gc2Vhc29uXG4gICAgICAuZmlsdGVyKHMgPT4gdHlwZW9mIHMgPT09ICdzdHJpbmcnKVxuICAgICAgLm1hcChzID0+IChzIGFzIHN0cmluZykudG9Mb3dlckNhc2UoKSlcbiAgICAgIC5maWx0ZXIocyA9PiB2YWxpZFNlYXNvbnMuaW5jbHVkZXMocykpO1xuICAgIFxuICAgIHJldHVybiB2YWxpZEVudHJpZXMubGVuZ3RoID4gMCA/IHZhbGlkRW50cmllcyA6IFsnYWxsJ107XG4gIH1cbiAgXG4gIHJldHVybiBbJ2FsbCddO1xufVxuXG5mdW5jdGlvbiB2YWxpZGF0ZUFzdHJvbG9naWNhbEluZmx1ZW5jZXMoaW5mbHVlbmNlczogc3RyaW5nIHwgc3RyaW5nW10gfCB1bmtub3duKTogc3RyaW5nW10ge1xuICBpZiAodHlwZW9mIGluZmx1ZW5jZXMgPT09ICdzdHJpbmcnKSB7XG4gICAgcmV0dXJuIFtpbmZsdWVuY2VzXTtcbiAgfVxuICBcbiAgaWYgKEFycmF5LmlzQXJyYXkoaW5mbHVlbmNlcykpIHtcbiAgICBjb25zdCB2YWxpZEVudHJpZXMgPSBpbmZsdWVuY2VzXG4gICAgICAuZmlsdGVyKGkgPT4gdHlwZW9mIGkgPT09ICdzdHJpbmcnKVxuICAgICAgLmZpbHRlcihpID0+IGkubGVuZ3RoID4gMCk7XG4gICAgXG4gICAgcmV0dXJuIHZhbGlkRW50cmllcy5sZW5ndGggPiAwID8gdmFsaWRFbnRyaWVzIDogWydhbGwnXTtcbiAgfVxuICBcbiAgcmV0dXJuIFsnYWxsJ107XG59XG5cbmZ1bmN0aW9uIHZhbGlkYXRlQW5kTm9ybWFsaXplTnV0cml0aW9uKG51dHJpdGlvbjogTnV0cml0aW9uRGF0YSk6IE51dHJpdGlvbkRhdGEge1xuICBpZiAoIW51dHJpdGlvbiB8fCB0eXBlb2YgbnV0cml0aW9uICE9PSAnb2JqZWN0Jykge1xuICAgIHJldHVybiB7fTtcbiAgfVxuXG4gIGNvbnN0IHNhZmVOdXRyaXRpb246IE51dHJpdGlvbkRhdGEgPSB7fTtcblxuICAvLyBWYWxpZGF0ZSBudW1lcmljIGZpZWxkc1xuICBbJ2NhbG9yaWVzJywgJ3Byb3RlaW4nLCAnY2FyYnMnLCAnZmF0J10uZm9yRWFjaChmaWVsZCA9PiB7XG4gICAgaWYgKHR5cGVvZiBudXRyaXRpb25bZmllbGRdID09PSAnbnVtYmVyJykge1xuICAgICAgc2FmZU51dHJpdGlvbltmaWVsZF0gPSBudXRyaXRpb25bZmllbGRdO1xuICAgIH1cbiAgfSk7XG5cbiAgLy8gVmFsaWRhdGUgYXJyYXkgZmllbGRzICh2aXRhbWlucywgbWluZXJhbHMpXG4gIGlmIChBcnJheS5pc0FycmF5KG51dHJpdGlvbi52aXRhbWlucykpIHtcbiAgICBzYWZlTnV0cml0aW9uLnZpdGFtaW5zID0gbnV0cml0aW9uLnZpdGFtaW5zXG4gICAgICAuZmlsdGVyKCh2OiB1bmtub3duKSA9PiB0eXBlb2YgdiA9PT0gJ3N0cmluZycpXG4gICAgICAuc2xpY2UoMCwgMTApOyAgLy8gTGltaXQgdG8gMTAgaXRlbXNcbiAgfVxuICBcbiAgaWYgKEFycmF5LmlzQXJyYXkobnV0cml0aW9uLm1pbmVyYWxzKSkge1xuICAgIHNhZmVOdXRyaXRpb24ubWluZXJhbHMgPSBudXRyaXRpb24ubWluZXJhbHNcbiAgICAgIC5maWx0ZXIoKG06IHVua25vd24pID0+IHR5cGVvZiBtID09PSAnc3RyaW5nJylcbiAgICAgIC5zbGljZSgwLCAxMCk7ICAvLyBMaW1pdCB0byAxMCBpdGVtc1xuICB9XG5cbiAgcmV0dXJuIHNhZmVOdXRyaXRpb247XG59XG5cbmNsYXNzIFJlY2lwZURhdGEge1xuICBwcml2YXRlIHJlY2lwZXM6IFJlY2lwZVtdID0gW11cbiAgcHJpdmF0ZSBpbml0aWFsaXplZCA9IGZhbHNlXG4gIHByaXZhdGUgaW5pdFByb21pc2U6IFByb21pc2U8dm9pZD4gfCBudWxsID0gbnVsbFxuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIC8vIFN0YXJ0IGxvYWRpbmcgZGF0YSBpbW1lZGlhdGVseVxuICAgIHRoaXMuaW5pdFByb21pc2UgPSB0aGlzLmxvYWRSZWNpcGVEYXRhKClcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgbG9hZFJlY2lwZURhdGEoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdHJ5IHtcbiAgICAgIGxvZ2dlci5pbmZvKCdMb2FkaW5nIHJlY2lwZSBkYXRhLi4uJylcbiAgICAgIFxuICAgICAgLy8gQ3JlYXRlIHJlY2lwZXMgZnJvbSBtYXBwaW5ncyBzYWZlbHlcbiAgICAgIGlmICghcmVjaXBlRWxlbWVudGFsTWFwcGluZ3MpIHtcbiAgICAgICAgbG9nZ2VyLmVycm9yKCdyZWNpcGVFbGVtZW50YWxNYXBwaW5ncyBub3QgZm91bmQgb3IgaW52YWxpZCcpO1xuICAgICAgICB0aGlzLnJlY2lwZXMgPSBbXTtcbiAgICAgICAgdGhpcy5pbml0aWFsaXplZCA9IHRydWU7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gSGFuZGxlIGRpZmZlcmVudCBmb3JtYXRzIG9mIHJlY2lwZUVsZW1lbnRhbE1hcHBpbmdzXG4gICAgICBjb25zdCBtYXBwaW5nc0VudHJpZXMgPSBBcnJheS5pc0FycmF5KHJlY2lwZUVsZW1lbnRhbE1hcHBpbmdzKSBcbiAgICAgICAgPyByZWNpcGVFbGVtZW50YWxNYXBwaW5ncyBcbiAgICAgICAgOiBPYmplY3QuZW50cmllcyhyZWNpcGVFbGVtZW50YWxNYXBwaW5ncykubWFwKChbaWQsIG1hcHBpbmddKSA9PiAoe1xuICAgICAgICAgICAgaWQsXG4gICAgICAgICAgICAuLi5tYXBwaW5nXG4gICAgICAgICAgfSkpO1xuICAgICAgXG4gICAgICB0aGlzLnJlY2lwZXMgPSBtYXBwaW5nc0VudHJpZXMubWFwKChtYXBwaW5nOiB1bmtub3duKSA9PiB7XG4gICAgICAgIGxldCBlbGVtZW50YWxQcm9wcyA9IChtYXBwaW5nIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KT8uZWxlbWVudGFsUHJvcGVydGllcyB8fCAobWFwcGluZyBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPik/LmVsZW1lbnRhbFByb2ZpbGU7XG4gICAgICAgIFxuICAgICAgICAvLyBJZiBubyBlbGVtZW50YWwgcHJvcGVydGllcywgZGVyaXZlIHRoZW0gZnJvbSBjdWlzaW5lIG9yIG90aGVyIGF0dHJpYnV0ZXNcbiAgICAgICAgaWYgKCFlbGVtZW50YWxQcm9wcykge1xuICAgICAgICAgIGNvbnN0IG1hcHBpbmdEYXRhID0gbWFwcGluZyBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPjtcbiAgICAgICAgICBlbGVtZW50YWxQcm9wcyA9IHJlY2lwZUVsZW1lbnRhbFNlcnZpY2UuZGVyaXZlRWxlbWVudGFsUHJvcGVydGllcyh7XG4gICAgICAgICAgICBjdWlzaW5lOiBTdHJpbmcoKG1hcHBpbmdEYXRhPy5jdWlzaW5lIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KT8ubmFtZSB8fCBtYXBwaW5nRGF0YT8uY3Vpc2luZSB8fCAnJyksXG4gICAgICAgICAgICBjb29raW5nTWV0aG9kOiBTdHJpbmcobWFwcGluZ0RhdGE/LmNvb2tpbmdNZXRob2QgfHwgJycpXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC8vIENyZWF0ZSBhIHBhcnRpYWwgcmVjaXBlIG9iamVjdCB3aXRoIHNhZmUgZGVmYXVsdHNcbiAgICAgICAgY29uc3QgbWFwcGluZ0RhdGEgPSBtYXBwaW5nIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+O1xuICAgICAgICBjb25zdCBwYXJ0aWFsUmVjaXBlOiBQYXJ0aWFsPFJlY2lwZT4gPSB7XG4gICAgICAgICAgaWQ6IHNhZmVHZXRTdHJpbmcobWFwcGluZ0RhdGE/LmlkKSB8fCBgcmVjaXBlLSR7RGF0ZS5ub3coKX0tJHtNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHJpbmcoMiwgOSl9YCxcbiAgICAgICAgICBuYW1lOiBzYWZlR2V0U3RyaW5nKG1hcHBpbmdEYXRhPy5uYW1lKSB8fCBzYWZlR2V0U3RyaW5nKG1hcHBpbmdEYXRhPy5pZCkgfHwgJ1Vua25vd24gUmVjaXBlJyxcbiAgICAgICAgICBjdWlzaW5lOiBzYWZlR2V0U3RyaW5nKChtYXBwaW5nRGF0YT8uY3Vpc2luZSBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPik/Lm5hbWUpIHx8IHNhZmVHZXRTdHJpbmcobWFwcGluZ0RhdGE/LmN1aXNpbmUpIHx8ICdVbmtub3duJyxcbiAgICAgICAgICBkZXNjcmlwdGlvbjogc2FmZUdldFN0cmluZyhtYXBwaW5nRGF0YT8uZGVzY3JpcHRpb24pIHx8IHNhZmVHZXRTdHJpbmcoKG1hcHBpbmdEYXRhPy5jdWlzaW5lIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KT8uZGVzY3JpcHRpb24pIHx8ICcnLFxuICAgICAgICAgIGVsZW1lbnRhbFByb3BlcnRpZXM6IGVsZW1lbnRhbFByb3BzIGFzIEVsZW1lbnRhbFByb3BlcnRpZXMsXG4gICAgICAgICAgaW5ncmVkaWVudHM6IEFycmF5LmlzQXJyYXkobWFwcGluZ0RhdGE/LmluZ3JlZGllbnRzKSBcbiAgICAgICAgICAgID8gKG1hcHBpbmdEYXRhLmluZ3JlZGllbnRzIGFzIHVua25vd25bXSkubWFwKChpbmc6IHVua25vd24pID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBpbmdEYXRhID0gaW5nIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+O1xuICAgICAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgICBuYW1lOiBTdHJpbmcoaW5nRGF0YT8ubmFtZSB8fCAnVW5rbm93biBJbmdyZWRpZW50JyksXG4gICAgICAgICAgICAgICAgICBhbW91bnQ6IHR5cGVvZiBpbmdEYXRhPy5hbW91bnQgPT09ICdudW1iZXInID8gaW5nRGF0YS5hbW91bnQgOiAxLFxuICAgICAgICAgICAgICAgICAgdW5pdDogU3RyaW5nKGluZ0RhdGE/LnVuaXQgfHwgJ3BpZWNlJyksXG4gICAgICAgICAgICAgICAgICBjYXRlZ29yeTogU3RyaW5nKGluZ0RhdGE/LmNhdGVnb3J5IHx8ICdvdGhlcicpXG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIDogW10sXG4gICAgICAgICAgaW5zdHJ1Y3Rpb25zOiBBcnJheS5pc0FycmF5KG1hcHBpbmdEYXRhPy5pbnN0cnVjdGlvbnMpID8gbWFwcGluZ0RhdGEuaW5zdHJ1Y3Rpb25zIDogW10sXG4gICAgICAgICAgdGltZVRvTWFrZTogbWFwcGluZ0RhdGE/LnRpbWVUb01ha2UgfHwgJzMwIG1pbnV0ZXMnLFxuICAgICAgICAgIGVuZXJneVByb2ZpbGU6IG1hcHBpbmdEYXRhPy5lbmVyZ3lQcm9maWxlIHx8IHt9LFxuICAgICAgICAgIC8vIENyaXRpY2FsIGZpZWxkOiBhbHdheXMgZW5zdXJlIGFzdHJvbG9naWNhbEluZmx1ZW5jZXMgaXMgc2V0XG4gICAgICAgICAgYXN0cm9sb2dpY2FsSW5mbHVlbmNlczogKG1hcHBpbmdEYXRhPy5hc3Ryb2xvZ2ljYWxJbmZsdWVuY2VzID8gXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKEFycmF5LmlzQXJyYXkobWFwcGluZ0RhdGEuYXN0cm9sb2dpY2FsSW5mbHVlbmNlcykgPyBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChtYXBwaW5nRGF0YS5hc3Ryb2xvZ2ljYWxJbmZsdWVuY2VzIGFzIHN0cmluZ1tdKSA6IFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgW1N0cmluZyhtYXBwaW5nRGF0YS5hc3Ryb2xvZ2ljYWxJbmZsdWVuY2VzKV0pIDogXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKChtYXBwaW5nRGF0YT8uYXN0cm9sb2dpY2FsUHJvZmlsZSBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPik/LnJ1bGluZ1BsYW5ldHMgPyBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChBcnJheS5pc0FycmF5KChtYXBwaW5nRGF0YS5hc3Ryb2xvZ2ljYWxQcm9maWxlIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KS5ydWxpbmdQbGFuZXRzKSA/IFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAoKG1hcHBpbmdEYXRhLmFzdHJvbG9naWNhbFByb2ZpbGUgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pLnJ1bGluZ1BsYW5ldHMgYXMgc3RyaW5nW10pIDogXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtTdHJpbmcoKG1hcHBpbmdEYXRhLmFzdHJvbG9naWNhbFByb2ZpbGUgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pLnJ1bGluZ1BsYW5ldHMpXSkgOiBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtcImFsbFwiXSkpLFxuICAgICAgICAgIHNlYXNvbjogQXJyYXkuaXNBcnJheShtYXBwaW5nRGF0YT8uc2Vhc29uYWxQcm9wZXJ0aWVzKSA/IChtYXBwaW5nRGF0YS5zZWFzb25hbFByb3BlcnRpZXMgYXMgc3RyaW5nW10pIDogXG4gICAgICAgICAgICAgICAgICBBcnJheS5pc0FycmF5KG1hcHBpbmdEYXRhPy5zZWFzb24pID8gKG1hcHBpbmdEYXRhLnNlYXNvbiBhcyBzdHJpbmdbXSkgOiBbJ2FsbCddLFxuICAgICAgICAgIG1lYWxUeXBlOiBBcnJheS5pc0FycmF5KG1hcHBpbmdEYXRhPy5tZWFsVHlwZSkgPyAobWFwcGluZ0RhdGEubWVhbFR5cGUgYXMgc3RyaW5nW10pIDogWydkaW5uZXInXSxcbiAgICAgICAgICBudW1iZXJPZlNlcnZpbmdzOiB0eXBlb2YgbWFwcGluZ0RhdGE/LnNlcnZpbmdzID09PSAnbnVtYmVyJyA/IG1hcHBpbmdEYXRhLnNlcnZpbmdzIDogMixcbiAgICAgICAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgICB1cGRhdGVkQXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAvLyBFbnN1cmUgYWxsIHByb3BlcnRpZXMgYXJlIHByb3Blcmx5IHNldCB3aXRoIGRlZmF1bHRzIGFzIG5lZWRlZFxuICAgICAgICByZXR1cm4gZW5zdXJlUmVjaXBlUHJvcGVydGllcyhwYXJ0aWFsUmVjaXBlKVxuICAgICAgfSlcbiAgICAgIFxuICAgICAgLy8gTWFyayBhcyBpbml0aWFsaXplZFxuICAgICAgdGhpcy5pbml0aWFsaXplZCA9IHRydWVcbiAgICAgIGxvZ2dlci5pbmZvKGBMb2FkZWQgJHt0aGlzLnJlY2lwZXMubGVuZ3RofSByZWNpcGVzIHN1Y2Nlc3NmdWxseWApXG4gICAgICBcbiAgICAgIC8vIENhY2hlIHRoZSByZWNpcGVzXG4gICAgICBjYWNoZS5zZXQoUkVDSVBFX0NBQ0hFX0tFWSwgdGhpcy5yZWNpcGVzKVxuICAgICAgXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignRXJyb3IgbG9hZGluZyByZWNpcGVzOicsIGVycm9yKVxuICAgICAgLy8gSW5pdGlhbGl6ZSB3aXRoIGFuIGVtcHR5IGFycmF5IHRvIHByZXZlbnQgZnVydGhlciBlcnJvcnNcbiAgICAgIHRoaXMucmVjaXBlcyA9IFtdXG4gICAgICB0aGlzLmluaXRpYWxpemVkID0gdHJ1ZVxuICAgIH1cbiAgfVxuXG4gIC8vIEFkZCBhIG1ldGhvZCB0byBzdGFuZGFyZGl6ZSByZWNpcGVzIGFmdGVyIHRoZXkndmUgYmVlbiBsb2FkZWQgZnJvbSBhbnl3aGVyZVxuICBwcml2YXRlIHN0YW5kYXJkaXplUmVjaXBlcyhyZWNpcGVzOiBSZWNpcGVbXSk6IFJlY2lwZVtdIHtcbiAgICByZXR1cm4gcmVjaXBlcy5tYXAocmVjaXBlID0+IHtcbiAgICAgIC8vIEZpcnN0IGVuc3VyZSBlbGVtZW50YWwgcHJvcGVydGllcyBhcmUgcHJvcGVybHkgc2V0XG4gICAgICBjb25zdCB3aXRoRWxlbWVudGFsUHJvcHMgPSByZWNpcGVFbGVtZW50YWxTZXJ2aWNlLnN0YW5kYXJkaXplUmVjaXBlKHJlY2lwZSk7XG4gICAgICBcbiAgICAgIC8vIFRoZW4gZW5zdXJlIGFsbCBvdGhlciBwcm9wZXJ0aWVzIGFyZSB2YWxpZFxuICAgICAgcmV0dXJuIGVuc3VyZVJlY2lwZVByb3BlcnRpZXMoe1xuICAgICAgICAuLi5yZWNpcGUsXG4gICAgICAgIGVsZW1lbnRhbFByb3BlcnRpZXM6ICgod2l0aEVsZW1lbnRhbFByb3BzIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KT8uZWxlbWVudGFsUHJvcGVydGllcyBhcyBFbGVtZW50YWxQcm9wZXJ0aWVzKSB8fCB7IEZpcmU6IDAuMjUsIFdhdGVyOiAwLjI1LCBFYXJ0aDogMC4yNSwgQWlyOiAwLjI1IH1cbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgZ2V0QWxsUmVjaXBlcygpOiBQcm9taXNlPFJlY2lwZVtdPiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIENoZWNrIGNhY2hlIGZpcnN0XG4gICAgICBjb25zdCBjYWNoZWRSZWNpcGVzID0gY2FjaGUuZ2V0KFJFQ0lQRV9DQUNIRV9LRVkpIGFzIFJlY2lwZVtdIHwgdW5kZWZpbmVkO1xuICAgICAgaWYgKGNhY2hlZFJlY2lwZXMpIHtcbiAgICAgICAgLy8gU3RhbmRhcmRpemUgYWxsIGNhY2hlZCByZWNpcGVzXG4gICAgICAgIHJldHVybiB0aGlzLnN0YW5kYXJkaXplUmVjaXBlcyhjYWNoZWRSZWNpcGVzKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gSWYgbm90IGluaXRpYWxpemVkLCB3YWl0IGZvciBpbml0aWFsaXphdGlvblxuICAgICAgaWYgKCF0aGlzLmluaXRpYWxpemVkKSB7XG4gICAgICAgIGxvZ2dlci5pbmZvKCdXYWl0aW5nIGZvciByZWNpcGUgZGF0YSB0byBpbml0aWFsaXplLi4uJyk7XG4gICAgICAgIGlmICh0aGlzLmluaXRQcm9taXNlKSB7XG4gICAgICAgICAgYXdhaXQgdGhpcy5pbml0UHJvbWlzZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBhd2FpdCB0aGlzLmxvYWRSZWNpcGVEYXRhKCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gSWYgd2Ugc3RpbGwgaGF2ZSBubyByZWNpcGVzLCByZXR1cm4gYXQgbGVhc3QgYSBmYWxsYmFjayByZWNpcGVcbiAgICAgIGlmICghdGhpcy5yZWNpcGVzLmxlbmd0aCkge1xuICAgICAgICBjb25zdCBmYWxsYmFja1JlY2lwZSA9IHRoaXMuZ2V0RmFsbGJhY2tSZWNpcGUoKTtcbiAgICAgICAgcmV0dXJuIFtmYWxsYmFja1JlY2lwZV07XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIFN0YW5kYXJkaXplIGFsbCByZWNpcGVzXG4gICAgICBjb25zdCBzYWZlUmVjaXBlcyA9IHRoaXMuc3RhbmRhcmRpemVSZWNpcGVzKHRoaXMucmVjaXBlcyk7XG4gICAgICBcbiAgICAgIC8vIFVwZGF0ZSBjYWNoZVxuICAgICAgY2FjaGUuc2V0KFJFQ0lQRV9DQUNIRV9LRVksIHNhZmVSZWNpcGVzKTtcbiAgICAgIFxuICAgICAgcmV0dXJuIHNhZmVSZWNpcGVzO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBlcnJvckhhbmRsZXIuaGFuZGxlRXJyb3IoZXJyb3IsIHtcbiAgICAgICAgY29udGV4dDogJ1JlY2lwZURhdGEnLFxuICAgICAgICBhY3Rpb246ICdnZXRBbGxSZWNpcGVzJ1xuICAgICAgfSk7XG4gICAgICBcbiAgICAgIC8vIFJldHVybiBhdCBsZWFzdCBvbmUgZmFsbGJhY2sgcmVjaXBlIHRvIHByZXZlbnQgYXBwbGljYXRpb24gZXJyb3JzXG4gICAgICByZXR1cm4gW3RoaXMuZ2V0RmFsbGJhY2tSZWNpcGUoKV07XG4gICAgfVxuICB9XG4gIFxuICBwcml2YXRlIGdldEZhbGxiYWNrUmVjaXBlKCk6IFJlY2lwZSB7XG4gICAgcmV0dXJuIGVuc3VyZVJlY2lwZVByb3BlcnRpZXMoe1xuICAgICAgaWQ6ICd1bml2ZXJzYWwtYmFsYW5jZScsXG4gICAgICBuYW1lOiBcIlVuaXZlcnNhbCBCYWxhbmNlIEJvd2xcIixcbiAgICAgIGRlc2NyaXB0aW9uOiBcIkEgaGFybW9uaW91cyBibGVuZCBmb3IgYW55IG9jY2FzaW9uXCIsXG4gICAgICBpbmdyZWRpZW50czogW1xuICAgICAgICB7IG5hbWU6IFwiTWl4ZWQgR3JlZW5zXCIsIGFtb3VudDogMiwgdW5pdDogXCJjdXBzXCIsIGNhdGVnb3J5OiBcInZlZ2V0YWJsZXNcIiB9LFxuICAgICAgICB7IG5hbWU6IFwiUXVpbm9hXCIsIGFtb3VudDogMSwgdW5pdDogXCJjdXBcIiwgY2F0ZWdvcnk6IFwiZ3JhaW5zXCIgfSxcbiAgICAgICAgeyBuYW1lOiBcIk1peGVkIFNlZWRzXCIsIGFtb3VudDogMC4yNSwgdW5pdDogXCJjdXBcIiwgY2F0ZWdvcnk6IFwiZ2FybmlzaFwiIH1cbiAgICAgIF0sXG4gICAgICBpbnN0cnVjdGlvbnM6IFtcbiAgICAgICAgXCJDb21iaW5lIGFsbCBpbmdyZWRpZW50cyBpbiBhIGJvd2xcIixcbiAgICAgICAgXCJTZWFzb24gdG8gdGFzdGVcIixcbiAgICAgICAgXCJFbmpveSBtaW5kZnVsbHlcIlxuICAgICAgXSxcbiAgICAgIHRpbWVUb01ha2U6IFwiMTUgbWludXRlc1wiLFxuICAgICAgbnVtYmVyT2ZTZXJ2aW5nczogMixcbiAgICAgIGVsZW1lbnRhbFByb3BlcnRpZXM6IHtcbiAgICAgICAgRmlyZTogMC4yNSwgRWFydGg6IDAuMjUsIEFpcjogMC4yNSwgV2F0ZXI6IDAuMjVcbiAgICAgIH0sXG4gICAgICBzZWFzb246IFtcImFsbFwiXSxcbiAgICAgIG1lYWxUeXBlOiBbXCJsdW5jaFwiLCBcImRpbm5lclwiXSxcbiAgICAgIGN1aXNpbmU6IFwiaW50ZXJuYXRpb25hbFwiLFxuICAgICAgaXNWZWdldGFyaWFuOiB0cnVlLFxuICAgICAgaXNWZWdhbjogdHJ1ZSxcbiAgICAgIGlzR2x1dGVuRnJlZTogdHJ1ZSxcbiAgICAgIGlzRGFpcnlGcmVlOiB0cnVlLFxuICAgICAgc2NvcmU6IDEsXG4gICAgICBhc3Ryb2xvZ2ljYWxJbmZsdWVuY2VzOiBbXCJhbGxcIl1cbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIGdldFJlY2lwZUJ5Q3Vpc2luZShjdWlzaW5lOiBzdHJpbmcpOiBQcm9taXNlPFJlY2lwZVtdPiB7XG4gICAgdHJ5IHtcbiAgICAgIGlmICh0aGlzLmluaXRQcm9taXNlKSB7XG4gICAgICAgIGF3YWl0IHRoaXMuaW5pdFByb21pc2U7XG4gICAgICB9XG4gICAgICBcbiAgICAgIGNvbnN0IGFsbFJlY2lwZXMgPSBhd2FpdCB0aGlzLmdldEFsbFJlY2lwZXMoKTtcbiAgICAgIHJldHVybiBhbGxSZWNpcGVzLmZpbHRlcihyZWNpcGUgPT4ge1xuICAgICAgICBjb25zdCByZWNpcGVEYXRhID0gcmVjaXBlIGFzIHVua25vd24gYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj47XG4gICAgICAgIGNvbnN0IHJlY2lwZUN1aXNpbmUgPSBTdHJpbmcocmVjaXBlRGF0YT8uY3Vpc2luZSB8fCAnJykudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgY29uc3QgdGFyZ2V0Q3Vpc2luZSA9IFN0cmluZyhjdWlzaW5lIHx8ICcnKS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICByZXR1cm4gcmVjaXBlQ3Vpc2luZSA9PT0gdGFyZ2V0Q3Vpc2luZTtcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBlcnJvckhhbmRsZXIuaGFuZGxlRXJyb3IoZXJyb3IsIHtcbiAgICAgICAgY29udGV4dDogJ1JlY2lwZURhdGEnLFxuICAgICAgICBhY3Rpb246ICdnZXRSZWNpcGVCeUN1aXNpbmUnLFxuICAgICAgICBjdWlzaW5lXG4gICAgICB9KTtcbiAgICAgIHJldHVybiBbdGhpcy5nZXRGYWxsYmFja1JlY2lwZSgpXTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBzZWFyY2hSZWNpcGVzKHF1ZXJ5OiBzdHJpbmcpOiBQcm9taXNlPFJlY2lwZVtdPiB7XG4gICAgdHJ5IHtcbiAgICAgIGlmICh0aGlzLmluaXRQcm9taXNlKSB7XG4gICAgICAgIGF3YWl0IHRoaXMuaW5pdFByb21pc2U7XG4gICAgICB9XG4gICAgICBjb25zdCBsb3dlcmNhc2VRdWVyeSA9IChxdWVyeSBhcyBzdHJpbmcpPy50b0xvd2VyQ2FzZT8uKCk7XG4gICAgICBjb25zdCByZWNpcGVzID0gYXdhaXQgdGhpcy5nZXRBbGxSZWNpcGVzKCk7XG4gICAgICByZXR1cm4gcmVjaXBlcy5maWx0ZXIocmVjaXBlID0+IHtcbiAgICAgICAgY29uc3QgcmVjaXBlRGF0YSA9IHJlY2lwZSBhcyB1bmtub3duIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+O1xuICAgICAgICBjb25zdCByZWNpcGVOYW1lID0gU3RyaW5nKHJlY2lwZURhdGE/Lm5hbWUgfHwgJycpLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIGNvbnN0IHJlY2lwZUN1aXNpbmUgPSBTdHJpbmcocmVjaXBlRGF0YT8uY3Vpc2luZSB8fCAnJykudG9Mb3dlckNhc2UoKTtcbiAgICAgICAgcmV0dXJuIHJlY2lwZU5hbWUuaW5jbHVkZXMobG93ZXJjYXNlUXVlcnkpIHx8IHJlY2lwZUN1aXNpbmUuaW5jbHVkZXMobG93ZXJjYXNlUXVlcnkpO1xuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGVycm9ySGFuZGxlci5oYW5kbGVFcnJvcihlcnJvciwge1xuICAgICAgICBjb250ZXh0OiAnUmVjaXBlRGF0YScsXG4gICAgICAgIGFjdGlvbjogJ3NlYXJjaFJlY2lwZXMnLFxuICAgICAgICBxdWVyeVxuICAgICAgfSk7XG4gICAgICByZXR1cm4gW3RoaXMuZ2V0RmFsbGJhY2tSZWNpcGUoKV07XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgZ2V0UmVjb21tZW5kZWRSZWNpcGVzKGNvdW50ID0gMyk6IFByb21pc2U8UmVjaXBlW10+IHtcbiAgICB0cnkge1xuICAgICAgaWYgKHRoaXMuaW5pdFByb21pc2UpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5pbml0UHJvbWlzZTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHJlY2lwZXMgPSBhd2FpdCB0aGlzLmdldEFsbFJlY2lwZXMoKTtcbiAgICAgIFxuICAgICAgLy8gRm9yIG5vdywganVzdCByZXR1cm4gcmFuZG9tIHJlY2lwZXNcbiAgICAgIHJldHVybiByZWNpcGVzXG4gICAgICAgIC5zb3J0KCgpID0+IE1hdGgucmFuZG9tKCkgLSAwLjUpXG4gICAgICAgIC5zbGljZSgwLCBjb3VudCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGVycm9ySGFuZGxlci5oYW5kbGVFcnJvcihlcnJvciwge1xuICAgICAgICBjb250ZXh0OiAnUmVjaXBlRGF0YScsXG4gICAgICAgIGFjdGlvbjogJ2dldFJlY29tbWVuZGVkUmVjaXBlcydcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIFt0aGlzLmdldEZhbGxiYWNrUmVjaXBlKCldO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIGFkZFJlY2lwZShyZWNpcGU6IFBhcnRpYWw8UmVjaXBlPik6IFByb21pc2U8UmVjaXBlPiB7XG4gICAgLy8gRW5zdXJlIHRoZSByZWNpcGUgaGFzIGFsbCByZXF1aXJlZCBwcm9wZXJ0aWVzXG4gICAgY29uc3QgbmV3UmVjaXBlID0gZW5zdXJlUmVjaXBlUHJvcGVydGllcyhyZWNpcGUpO1xuICAgIFxuICAgIC8vIEFkZCB0byByZWNpcGVzIGFycmF5XG4gICAgdGhpcy5yZWNpcGVzLnB1c2gobmV3UmVjaXBlKTtcbiAgICBcbiAgICAvLyBDbGVhciBjYWNoZVxuICAgIGNhY2hlLmRlbGV0ZShSRUNJUEVfQ0FDSEVfS0VZKTtcbiAgICBcbiAgICByZXR1cm4gbmV3UmVjaXBlO1xuICB9XG5cbiAgYXN5bmMgZ2V0UmVjaXBlQnlJZChpZDogc3RyaW5nKTogUHJvbWlzZTxSZWNpcGUgfCBudWxsPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlY2lwZXMgPSBhd2FpdCB0aGlzLmdldEFsbFJlY2lwZXMoKTtcbiAgICAgIGNvbnN0IHJlY2lwZSA9IHJlY2lwZXMuZmluZChyID0+IHIuaWQgPT09IGlkKTtcbiAgICAgIFxuICAgICAgcmV0dXJuIHJlY2lwZSB8fCBudWxsO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBlcnJvckhhbmRsZXIuaGFuZGxlRXJyb3IoZXJyb3IsIHtcbiAgICAgICAgY29udGV4dDogJ1JlY2lwZURhdGEnLFxuICAgICAgICBhY3Rpb246ICdnZXRSZWNpcGVCeUlkJyxcbiAgICAgICAgaWRcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgZmlsdGVyUmVjaXBlcyhmaWx0ZXJzOiB7XG4gICAgY3Vpc2luZT86IHN0cmluZztcbiAgICBtZWFsVHlwZT86IHN0cmluZ1tdO1xuICAgIHNlYXNvbj86IHN0cmluZ1tdO1xuICAgIGFzdHJvbG9naWNhbEluZmx1ZW5jZXM/OiBzdHJpbmdbXTtcbiAgICBpc1ZlZ2V0YXJpYW4/OiBib29sZWFuO1xuICAgIGlzVmVnYW4/OiBib29sZWFuO1xuICAgIGlzR2x1dGVuRnJlZT86IGJvb2xlYW47XG4gICAgaXNEYWlyeUZyZWU/OiBib29sZWFuO1xuICB9KTogUHJvbWlzZTxSZWNpcGVbXT4ge1xuICAgIHRyeSB7XG4gICAgICBpZiAodGhpcy5pbml0UHJvbWlzZSkge1xuICAgICAgICBhd2FpdCB0aGlzLmluaXRQcm9taXNlO1xuICAgICAgfVxuICAgICAgXG4gICAgICBjb25zdCByZWNpcGVzID0gYXdhaXQgdGhpcy5nZXRBbGxSZWNpcGVzKCk7XG4gICAgICBcbiAgICAgIGNvbnN0IGZpbHRlcmVkUmVjaXBlcyA9IHJlY2lwZXMuZmlsdGVyKHJlY2lwZSA9PiB7XG4gICAgICAgIC8vIEZpbHRlciBieSBjdWlzaW5lXG4gICAgICAgIGlmIChmaWx0ZXJzLmN1aXNpbmUgJiYgcmVjaXBlLmN1aXNpbmUpIHtcbiAgICAgICAgICBjb25zdCByZWNpcGVDdWlzaW5lID0gU3RyaW5nKHJlY2lwZS5jdWlzaW5lIHx8ICcnKS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgIGNvbnN0IHRhcmdldEN1aXNpbmUgPSBTdHJpbmcoZmlsdGVycy5jdWlzaW5lIHx8ICcnKS50b0xvd2VyQ2FzZSgpO1xuICAgICAgICAgIFxuICAgICAgICAgIGlmICghcmVjaXBlQ3Vpc2luZS5pbmNsdWRlcyh0YXJnZXRDdWlzaW5lKSkge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLy8gRmlsdGVyIGJ5IG1lYWwgdHlwZVxuICAgICAgICBpZiAoZmlsdGVycy5tZWFsVHlwZSAmJiBmaWx0ZXJzLm1lYWxUeXBlLmxlbmd0aCA+IDAgJiYgcmVjaXBlLm1lYWxUeXBlKSB7XG4gICAgICAgICAgY29uc3QgbWVhbFR5cGVzID0gQXJyYXkuaXNBcnJheShyZWNpcGUubWVhbFR5cGUpIFxuICAgICAgICAgICAgPyByZWNpcGUubWVhbFR5cGUubWFwKG10ID0+IFN0cmluZyhtdCB8fCAnJykudG9Mb3dlckNhc2UoKSlcbiAgICAgICAgICAgIDogW1N0cmluZyhyZWNpcGUubWVhbFR5cGUgfHwgJycpLnRvTG93ZXJDYXNlKCldO1xuICAgICAgICAgIFxuICAgICAgICAgIGNvbnN0IHRhcmdldE1lYWxUeXBlcyA9IGZpbHRlcnMubWVhbFR5cGUubWFwKG10ID0+IFN0cmluZyhtdCB8fCAnJykudG9Mb3dlckNhc2UoKSk7XG4gICAgICAgICAgXG4gICAgICAgICAgaWYgKCF0YXJnZXRNZWFsVHlwZXMuc29tZSh0YXJnZXQgPT4gbWVhbFR5cGVzLmluY2x1ZGVzKHRhcmdldCkpKSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAvLyBGaWx0ZXIgYnkgc2Vhc29uXG4gICAgICAgIGlmIChmaWx0ZXJzLnNlYXNvbiAmJiBmaWx0ZXJzLnNlYXNvbi5sZW5ndGggPiAwICYmIHJlY2lwZS5zZWFzb24pIHtcbiAgICAgICAgICBjb25zdCBzZWFzb25zID0gQXJyYXkuaXNBcnJheShyZWNpcGUuc2Vhc29uKVxuICAgICAgICAgICAgPyByZWNpcGUuc2Vhc29uLm1hcChzID0+IFN0cmluZyhzIHx8ICcnKS50b0xvd2VyQ2FzZSgpKVxuICAgICAgICAgICAgOiBbU3RyaW5nKHJlY2lwZS5zZWFzb24gfHwgJycpLnRvTG93ZXJDYXNlKCldO1xuICAgICAgICAgIFxuICAgICAgICAgIC8vIFNwZWNpYWwgY2FzZTogaWYgJ2FsbCcgaXMgaW5jbHVkZWQgaW4gcmVjaXBlIHNlYXNvbnMsIGl0IG1hdGNoZXMgYW55IHNlYXNvblxuICAgICAgICAgIGlmICghc2Vhc29ucy5pbmNsdWRlcygnYWxsJykpIHtcbiAgICAgICAgICAgIGNvbnN0IHRhcmdldFNlYXNvbnMgPSBmaWx0ZXJzLnNlYXNvbi5tYXAocyA9PiBTdHJpbmcocyB8fCAnJykudG9Mb3dlckNhc2UoKSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmICghdGFyZ2V0U2Vhc29ucy5zb21lKHRhcmdldCA9PiBzZWFzb25zLmluY2x1ZGVzKHRhcmdldCkpKSB7XG4gICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC8vIEZpbHRlciBieSBhc3Ryb2xvZ2ljYWwgaW5mbHVlbmNlc1xuICAgICAgICBpZiAoZmlsdGVycy5hc3Ryb2xvZ2ljYWxJbmZsdWVuY2VzICYmIGZpbHRlcnMuYXN0cm9sb2dpY2FsSW5mbHVlbmNlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgY29uc3QgaW5mbHVlbmNlcyA9IHJlY2lwZS5hc3Ryb2xvZ2ljYWxJbmZsdWVuY2VzIHx8IFtdO1xuICAgICAgICAgIFxuICAgICAgICAgIC8vIFNwZWNpYWwgY2FzZTogaWYgJ2FsbCcgaXMgaW5jbHVkZWQsIGl0IG1hdGNoZXMgYW55IGluZmx1ZW5jZVxuICAgICAgICAgIGlmICghaW5mbHVlbmNlcy5pbmNsdWRlcygnYWxsJykpIHtcbiAgICAgICAgICAgIGNvbnN0IGhhc01hdGNoID0gZmlsdGVycy5hc3Ryb2xvZ2ljYWxJbmZsdWVuY2VzLnNvbWUoaW5mbHVlbmNlID0+IFxuICAgICAgICAgICAgICBpbmZsdWVuY2VzLnNvbWUocmVjaXBlSW5mbHVlbmNlID0+IFxuICAgICAgICAgICAgICAgIFN0cmluZyhyZWNpcGVJbmZsdWVuY2UgfHwgJycpLnRvTG93ZXJDYXNlKCkgPT09IFN0cmluZyhpbmZsdWVuY2UgfHwgJycpLnRvTG93ZXJDYXNlKClcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYgKCFoYXNNYXRjaCkge1xuICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAvLyBGaWx0ZXIgYnkgZGlldGFyeSByZXN0cmljdGlvbnNcbiAgICAgICAgaWYgKGZpbHRlcnMuaXNWZWdldGFyaWFuICYmIHJlY2lwZS5pc1ZlZ2V0YXJpYW4gPT09IGZhbHNlKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBpZiAoZmlsdGVycy5pc1ZlZ2FuICYmIHJlY2lwZS5pc1ZlZ2FuID09PSBmYWxzZSkge1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgaWYgKGZpbHRlcnMuaXNHbHV0ZW5GcmVlICYmIHJlY2lwZS5pc0dsdXRlbkZyZWUgPT09IGZhbHNlKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBpZiAoZmlsdGVycy5pc0RhaXJ5RnJlZSAmJiByZWNpcGUuaXNEYWlyeUZyZWUgPT09IGZhbHNlKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICByZXR1cm4gZmlsdGVyZWRSZWNpcGVzO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBlcnJvckhhbmRsZXIuaGFuZGxlRXJyb3IoZXJyb3IsIHtcbiAgICAgICAgY29udGV4dDogJ1JlY2lwZURhdGEnLFxuICAgICAgICBhY3Rpb246ICdmaWx0ZXJSZWNpcGVzJ1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gW3RoaXMuZ2V0RmFsbGJhY2tSZWNpcGUoKV07XG4gICAgfVxuICB9XG59XG5cbi8vIEV4cG9ydCB0aGUgc2luZ2xldG9uIGluc3RhbmNlXG5leHBvcnQgY29uc3QgcmVjaXBlRGF0YVNlcnZpY2UgPSBuZXcgUmVjaXBlRGF0YSgpOyBcblxuLy8gRXhwb3J0IGFsaWFzIGZvciBjb21wYXRpYmlsaXR5XG5leHBvcnQgY29uc3QgcmVjaXBlRGF0YSA9IHJlY2lwZURhdGFTZXJ2aWNlOyAiXSwidmVyc2lvbiI6M30=