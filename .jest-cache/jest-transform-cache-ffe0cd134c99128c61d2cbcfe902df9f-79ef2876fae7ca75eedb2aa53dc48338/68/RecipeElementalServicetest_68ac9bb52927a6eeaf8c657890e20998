ca4340df054f5fb98e8f8725df210fcf
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const RecipeElementalService_1 = require("../../services/RecipeElementalService");
describe('RecipeElementalService', () => {
    describe('standardizeRecipe', () => {
        it('should add missing elemental properties', () => {
            const recipe = {
                id: 'test-recipe',
                name: 'Test Recipe',
                // No elemental properties provided
            };
            const result = RecipeElementalService_1.recipeElementalService.standardizeRecipe(recipe);
            expect(result.elementalProperties).toBeDefined();
            expect(result.elementalProperties.Fire).toBeDefined();
            expect(result.elementalProperties.Water).toBeDefined();
            expect(result.elementalProperties.Earth).toBeDefined();
            expect(result.elementalProperties.Air).toBeDefined();
            // Values should be normalized to sum to 1
            const sum = Object.values(result.elementalProperties).reduce((a, b) => a + b, 0);
            expect(sum).toBeCloseTo(1, 6);
        });
        it('should standardize partial elemental properties', () => {
            const recipe = {
                id: 'test-recipe',
                name: 'Test Recipe',
                elementalProperties: {
                    Fire: 1,
                    Water: 0,
                    Earth: 0,
                    Air: 0
                }
            };
            const result = RecipeElementalService_1.recipeElementalService.standardizeRecipe(recipe);
            expect(result.elementalProperties.Fire).toBeDefined();
            expect(result.elementalProperties.Water).toBeDefined();
            expect(result.elementalProperties.Earth).toBeDefined();
            expect(result.elementalProperties.Air).toBeDefined();
            // Values should be normalized
            const sum = Object.values(result.elementalProperties).reduce((a, b) => a + b, 0);
            expect(sum).toBeCloseTo(1, 6);
        });
    });
    describe('standardizeRecipes', () => {
        it('should standardize an array of recipes', () => {
            const recipes = [
                { id: 'recipe1', name: 'Recipe 1' },
                {
                    id: 'recipe2',
                    name: 'Recipe 2',
                    elementalProperties: {
                        Fire: 0.8,
                        Water: 0.2,
                        Earth: 0,
                        Air: 0
                    }
                }
            ];
            const results = RecipeElementalService_1.recipeElementalService.standardizeRecipes(recipes);
            expect(results.length).toBe(2);
            expect(results[0].elementalProperties).toBeDefined();
            expect(results[1].elementalProperties).toBeDefined();
            // First recipe should have default properties
            expect(results[0].elementalProperties.Fire).toBeCloseTo(0.25, 2);
            // Second recipe should have normalized properties
            const sum = Object.values(results[1].elementalProperties).reduce((a, b) => a + b, 0);
            expect(sum).toBeCloseTo(1, 6);
        });
    });
    describe('getDominantElement', () => {
        it('should return the dominant element', () => {
            const recipe = {
                id: 'test-recipe',
                name: 'Test Recipe',
                elementalProperties: {
                    Fire: 0.4,
                    Water: 0.3,
                    Earth: 0.2,
                    Air: 0.1
                }
            };
            const result = RecipeElementalService_1.recipeElementalService.getDominantElement(recipe);
            expect(result.element).toBe('Fire');
            expect(result.value).toBeCloseTo(0.4, 2);
        });
    });
    describe('calculateSimilarity', () => {
        it('should calculate similarity between elemental property sets', () => {
            const props1 = {
                Fire: 0.25,
                Water: 0.25,
                Earth: 0.25,
                Air: 0.25
            };
            const props2 = {
                Fire: 0.25,
                Water: 0.25,
                Earth: 0.25,
                Air: 0.25
            };
            // Identical properties should have 100% similarity
            const similarity1 = RecipeElementalService_1.recipeElementalService.calculateSimilarity(props1, props2);
            expect(similarity1).toBeCloseTo(1, 6);
            // Different properties should have lower similarity
            const props3 = {
                Fire: 0.5,
                Water: 0.2,
                Earth: 0.2,
                Air: 0.1
            };
            const similarity2 = RecipeElementalService_1.recipeElementalService.calculateSimilarity(props1, props3);
            expect(similarity2).toBeLessThan(1);
            expect(similarity2).toBeGreaterThan(0);
        });
    });
    describe('deriveElementalProperties', () => {
        it('should derive properties based on recipe attributes', () => {
            const recipe = {
                cuisine: 'Mexican',
                cookingMethod: ['grilling']
            };
            const result = RecipeElementalService_1.recipeElementalService.deriveElementalProperties(recipe);
            // Mexican cuisine and grilling should result in higher Fire
            expect(result.Fire).toBeGreaterThan(0.25);
            const sum = Object.values(result).reduce((a, b) => a + b, 0);
            expect(sum).toBeCloseTo(1, 6);
        });
        it('should derive properties for a recipe with ingredients', () => {
            const recipe = {
                cuisine: 'Japanese',
                cookingMethod: ['steaming'],
                ingredients: [
                    {
                        name: 'Rice',
                        amount: 1,
                        unit: 'cup',
                        elementalProperties: {
                            Earth: 0.6,
                            Water: 0.3,
                            Fire: 0.05,
                            Air: 0.05
                        }
                    }
                ]
            };
            const result = RecipeElementalService_1.recipeElementalService.deriveElementalProperties(recipe);
            // Japanese cuisine, steaming, and rice should result in higher Water and Earth
            expect(result.Water).toBeGreaterThan(0.2);
            const sum = Object.values(result).reduce((a, b) => a + b, 0);
            expect(sum).toBeCloseTo(1, 6);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9fX3Rlc3RzX18vc2VydmljZXMvUmVjaXBlRWxlbWVudGFsU2VydmljZS50ZXN0LnRzIiwibWFwcGluZ3MiOiI7O0FBQUEsa0ZBQStFO0FBSS9FLFFBQVEsQ0FBQyx3QkFBd0IsRUFBRSxHQUFHLEVBQUU7SUFDdEMsUUFBUSxDQUFDLG1CQUFtQixFQUFFLEdBQUcsRUFBRTtRQUNqQyxFQUFFLENBQUMseUNBQXlDLEVBQUUsR0FBRyxFQUFFO1lBQ2pELE1BQU0sTUFBTSxHQUFHO2dCQUNiLEVBQUUsRUFBRSxhQUFhO2dCQUNqQixJQUFJLEVBQUUsYUFBYTtnQkFDbkIsbUNBQW1DO2FBQ3BDLENBQUM7WUFFRixNQUFNLE1BQU0sR0FBRywrQ0FBc0IsQ0FBQyxpQkFBaUIsQ0FBQyxNQUFNLENBQUMsQ0FBQztZQUVoRSxNQUFNLENBQUMsTUFBTSxDQUFDLG1CQUFtQixDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDakQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxtQkFBbUIsQ0FBQyxJQUFJLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUN0RCxNQUFNLENBQUMsTUFBTSxDQUFDLG1CQUFtQixDQUFDLEtBQUssQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQ3ZELE1BQU0sQ0FBQyxNQUFNLENBQUMsbUJBQW1CLENBQUMsS0FBSyxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDdkQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxtQkFBbUIsQ0FBQyxHQUFHLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUVyRCwwQ0FBMEM7WUFDMUMsTUFBTSxHQUFHLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsbUJBQW1CLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1lBQ2pGLE1BQU0sQ0FBQyxH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b0VhdE5leHQvc3JjL19fdGVzdHNfXy9zZXJ2aWNlcy9SZWNpcGVFbGVtZW50YWxTZXJ2aWNlLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgcmVjaXBlRWxlbWVudGFsU2VydmljZSB9IGZyb20gJy4uLy4uL3NlcnZpY2VzL1JlY2lwZUVsZW1lbnRhbFNlcnZpY2UnO1xuaW1wb3J0IHR5cGUgeyBFbGVtZW50YWxQcm9wZXJ0aWVzIH0gZnJvbSAnLi4vLi4vdHlwZXMvYWxjaGVteSc7XG5pbXBvcnQgdHlwZSB7IFJlY2lwZSB9IGZyb20gJy4uLy4uL3R5cGVzL3JlY2lwZSc7XG5cbmRlc2NyaWJlKCdSZWNpcGVFbGVtZW50YWxTZXJ2aWNlJywgKCkgPT4ge1xuICBkZXNjcmliZSgnc3RhbmRhcmRpemVSZWNpcGUnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBhZGQgbWlzc2luZyBlbGVtZW50YWwgcHJvcGVydGllcycsICgpID0+IHtcbiAgICAgIGNvbnN0IHJlY2lwZSA9IHtcbiAgICAgICAgaWQ6ICd0ZXN0LXJlY2lwZScsXG4gICAgICAgIG5hbWU6ICdUZXN0IFJlY2lwZScsXG4gICAgICAgIC8vIE5vIGVsZW1lbnRhbCBwcm9wZXJ0aWVzIHByb3ZpZGVkXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSByZWNpcGVFbGVtZW50YWxTZXJ2aWNlLnN0YW5kYXJkaXplUmVjaXBlKHJlY2lwZSk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHQuZWxlbWVudGFsUHJvcGVydGllcykudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZWxlbWVudGFsUHJvcGVydGllcy5GaXJlKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5lbGVtZW50YWxQcm9wZXJ0aWVzLldhdGVyKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5lbGVtZW50YWxQcm9wZXJ0aWVzLkVhcnRoKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5lbGVtZW50YWxQcm9wZXJ0aWVzLkFpcikudG9CZURlZmluZWQoKTtcbiAgICAgIFxuICAgICAgLy8gVmFsdWVzIHNob3VsZCBiZSBub3JtYWxpemVkIHRvIHN1bSB0byAxXG4gICAgICBjb25zdCBzdW0gPSBPYmplY3QudmFsdWVzKHJlc3VsdC5lbGVtZW50YWxQcm9wZXJ0aWVzKS5yZWR1Y2UoKGEsIGIpID0+IGEgKyBiLCAwKTtcbiAgICAgIGV4cGVjdChzdW0pLnRvQmVDbG9zZVRvKDEsIDYpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBzdGFuZGFyZGl6ZSBwYXJ0aWFsIGVsZW1lbnRhbCBwcm9wZXJ0aWVzJywgKCkgPT4ge1xuICAgICAgY29uc3QgcmVjaXBlOiBQYXJ0aWFsPFJlY2lwZT4gPSB7XG4gICAgICAgIGlkOiAndGVzdC1yZWNpcGUnLFxuICAgICAgICBuYW1lOiAnVGVzdCBSZWNpcGUnLFxuICAgICAgICBlbGVtZW50YWxQcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgRmlyZTogMSxcbiAgICAgICAgICBXYXRlcjogMCxcbiAgICAgICAgICBFYXJ0aDogMCxcbiAgICAgICAgICBBaXI6IDBcbiAgICAgICAgfVxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gcmVjaXBlRWxlbWVudGFsU2VydmljZS5zdGFuZGFyZGl6ZVJlY2lwZShyZWNpcGUpO1xuICAgICAgXG4gICAgICBleHBlY3QocmVzdWx0LmVsZW1lbnRhbFByb3BlcnRpZXMuRmlyZSkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZWxlbWVudGFsUHJvcGVydGllcy5XYXRlcikudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZWxlbWVudGFsUHJvcGVydGllcy5FYXJ0aCkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZWxlbWVudGFsUHJvcGVydGllcy5BaXIpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBcbiAgICAgIC8vIFZhbHVlcyBzaG91bGQgYmUgbm9ybWFsaXplZFxuICAgICAgY29uc3Qgc3VtID0gT2JqZWN0LnZhbHVlcyhyZXN1bHQuZWxlbWVudGFsUHJvcGVydGllcykucmVkdWNlKChhLCBiKSA9PiBhICsgYiwgMCk7XG4gICAgICBleHBlY3Qoc3VtKS50b0JlQ2xvc2VUbygxLCA2KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3N0YW5kYXJkaXplUmVjaXBlcycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHN0YW5kYXJkaXplIGFuIGFycmF5IG9mIHJlY2lwZXMnLCAoKSA9PiB7XG4gICAgICBjb25zdCByZWNpcGVzOiBQYXJ0aWFsPFJlY2lwZT5bXSA9IFtcbiAgICAgICAgeyBpZDogJ3JlY2lwZTEnLCBuYW1lOiAnUmVjaXBlIDEnIH0sXG4gICAgICAgIHsgXG4gICAgICAgICAgaWQ6ICdyZWNpcGUyJywgXG4gICAgICAgICAgbmFtZTogJ1JlY2lwZSAyJyxcbiAgICAgICAgICBlbGVtZW50YWxQcm9wZXJ0aWVzOiB7IFxuICAgICAgICAgICAgRmlyZTogMC44LCBcbiAgICAgICAgICAgIFdhdGVyOiAwLjIsXG4gICAgICAgICAgICBFYXJ0aDogMCxcbiAgICAgICAgICAgIEFpcjogMFxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgXTtcblxuICAgICAgY29uc3QgcmVzdWx0cyA9IHJlY2lwZUVsZW1lbnRhbFNlcnZpY2Uuc3RhbmRhcmRpemVSZWNpcGVzKHJlY2lwZXMpO1xuICAgICAgXG4gICAgICBleHBlY3QocmVzdWx0cy5sZW5ndGgpLnRvQmUoMik7XG4gICAgICBleHBlY3QocmVzdWx0c1swXS5lbGVtZW50YWxQcm9wZXJ0aWVzKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHJlc3VsdHNbMV0uZWxlbWVudGFsUHJvcGVydGllcykudG9CZURlZmluZWQoKTtcbiAgICAgIFxuICAgICAgLy8gRmlyc3QgcmVjaXBlIHNob3VsZCBoYXZlIGRlZmF1bHQgcHJvcGVydGllc1xuICAgICAgZXhwZWN0KHJlc3VsdHNbMF0uZWxlbWVudGFsUHJvcGVydGllcy5GaXJlKS50b0JlQ2xvc2VUbygwLjI1LCAyKTtcbiAgICAgIFxuICAgICAgLy8gU2Vjb25kIHJlY2lwZSBzaG91bGQgaGF2ZSBub3JtYWxpemVkIHByb3BlcnRpZXNcbiAgICAgIGNvbnN0IHN1bSA9IE9iamVjdC52YWx1ZXMocmVzdWx0c1sxXS5lbGVtZW50YWxQcm9wZXJ0aWVzKS5yZWR1Y2UoKGEsIGIpID0+IGEgKyBiLCAwKTtcbiAgICAgIGV4cGVjdChzdW0pLnRvQmVDbG9zZVRvKDEsIDYpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0RG9taW5hbnRFbGVtZW50JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmV0dXJuIHRoZSBkb21pbmFudCBlbGVtZW50JywgKCkgPT4ge1xuICAgICAgY29uc3QgcmVjaXBlID0ge1xuICAgICAgICBpZDogJ3Rlc3QtcmVjaXBlJyxcbiAgICAgICAgbmFtZTogJ1Rlc3QgUmVjaXBlJyxcbiAgICAgICAgZWxlbWVudGFsUHJvcGVydGllczoge1xuICAgICAgICAgIEZpcmU6IDAuNCxcbiAgICAgICAgICBXYXRlcjogMC4zLFxuICAgICAgICAgIEVhcnRoOiAwLjIsXG4gICAgICAgICAgQWlyOiAwLjFcbiAgICAgICAgfVxuICAgICAgfSBhcyBSZWNpcGU7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IHJlY2lwZUVsZW1lbnRhbFNlcnZpY2UuZ2V0RG9taW5hbnRFbGVtZW50KHJlY2lwZSk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHQuZWxlbWVudCkudG9CZSgnRmlyZScpO1xuICAgICAgZXhwZWN0KHJlc3VsdC52YWx1ZSkudG9CZUNsb3NlVG8oMC40LCAyKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2NhbGN1bGF0ZVNpbWlsYXJpdHknLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBjYWxjdWxhdGUgc2ltaWxhcml0eSBiZXR3ZWVuIGVsZW1lbnRhbCBwcm9wZXJ0eSBzZXRzJywgKCkgPT4ge1xuICAgICAgY29uc3QgcHJvcHMxOiBFbGVtZW50YWxQcm9wZXJ0aWVzID0ge1xuICAgICAgICBGaXJlOiAwLjI1LFxuICAgICAgICBXYXRlcjogMC4yNSxcbiAgICAgICAgRWFydGg6IDAuMjUsXG4gICAgICAgIEFpcjogMC4yNVxuICAgICAgfTtcblxuICAgICAgY29uc3QgcHJvcHMyOiBFbGVtZW50YWxQcm9wZXJ0aWVzID0ge1xuICAgICAgICBGaXJlOiAwLjI1LFxuICAgICAgICBXYXRlcjogMC4yNSxcbiAgICAgICAgRWFydGg6IDAuMjUsXG4gICAgICAgIEFpcjogMC4yNVxuICAgICAgfTtcblxuICAgICAgLy8gSWRlbnRpY2FsIHByb3BlcnRpZXMgc2hvdWxkIGhhdmUgMTAwJSBzaW1pbGFyaXR5XG4gICAgICBjb25zdCBzaW1pbGFyaXR5MSA9IHJlY2lwZUVsZW1lbnRhbFNlcnZpY2UuY2FsY3VsYXRlU2ltaWxhcml0eShwcm9wczEsIHByb3BzMik7XG4gICAgICBleHBlY3Qoc2ltaWxhcml0eTEpLnRvQmVDbG9zZVRvKDEsIDYpO1xuXG4gICAgICAvLyBEaWZmZXJlbnQgcHJvcGVydGllcyBzaG91bGQgaGF2ZSBsb3dlciBzaW1pbGFyaXR5XG4gICAgICBjb25zdCBwcm9wczM6IEVsZW1lbnRhbFByb3BlcnRpZXMgPSB7XG4gICAgICAgIEZpcmU6IDAuNSxcbiAgICAgICAgV2F0ZXI6IDAuMixcbiAgICAgICAgRWFydGg6IDAuMixcbiAgICAgICAgQWlyOiAwLjFcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHNpbWlsYXJpdHkyID0gcmVjaXBlRWxlbWVudGFsU2VydmljZS5jYWxjdWxhdGVTaW1pbGFyaXR5KHByb3BzMSwgcHJvcHMzKTtcbiAgICAgIGV4cGVjdChzaW1pbGFyaXR5MikudG9CZUxlc3NUaGFuKDEpO1xuICAgICAgZXhwZWN0KHNpbWlsYXJpdHkyKS50b0JlR3JlYXRlclRoYW4oMCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdkZXJpdmVFbGVtZW50YWxQcm9wZXJ0aWVzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZGVyaXZlIHByb3BlcnRpZXMgYmFzZWQgb24gcmVjaXBlIGF0dHJpYnV0ZXMnLCAoKSA9PiB7XG4gICAgICBjb25zdCByZWNpcGUgPSB7XG4gICAgICAgIGN1aXNpbmU6ICdNZXhpY2FuJyxcbiAgICAgICAgY29va2luZ01ldGhvZDogWydncmlsbGluZyddXG4gICAgICB9O1xuXG4gICAgICBjb25zdCByZXN1bHQgPSByZWNpcGVFbGVtZW50YWxTZXJ2aWNlLmRlcml2ZUVsZW1lbnRhbFByb3BlcnRpZXMocmVjaXBlKTtcbiAgICAgIFxuICAgICAgLy8gTWV4aWNhbiBjdWlzaW5lIGFuZCBncmlsbGluZyBzaG91bGQgcmVzdWx0IGluIGhpZ2hlciBGaXJlXG4gICAgICBleHBlY3QocmVzdWx0LkZpcmUpLnRvQmVHcmVhdGVyVGhhbigwLjI1KTtcbiAgICAgIFxuICAgICAgY29uc3Qgc3VtID0gT2JqZWN0LnZhbHVlcyhyZXN1bHQpLnJlZHVjZSgoYSwgYikgPT4gYSArIGIsIDApO1xuICAgICAgZXhwZWN0KHN1bSkudG9CZUNsb3NlVG8oMSwgNik7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGRlcml2ZSBwcm9wZXJ0aWVzIGZvciBhIHJlY2lwZSB3aXRoIGluZ3JlZGllbnRzJywgKCkgPT4ge1xuICAgICAgY29uc3QgcmVjaXBlID0ge1xuICAgICAgICBjdWlzaW5lOiAnSmFwYW5lc2UnLFxuICAgICAgICBjb29raW5nTWV0aG9kOiBbJ3N0ZWFtaW5nJ10sXG4gICAgICAgIGluZ3JlZGllbnRzOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgbmFtZTogJ1JpY2UnLFxuICAgICAgICAgICAgYW1vdW50OiAxLFxuICAgICAgICAgICAgdW5pdDogJ2N1cCcsXG4gICAgICAgICAgICBlbGVtZW50YWxQcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgICAgIEVhcnRoOiAwLjYsXG4gICAgICAgICAgICAgIFdhdGVyOiAwLjMsXG4gICAgICAgICAgICAgIEZpcmU6IDAuMDUsXG4gICAgICAgICAgICAgIEFpcjogMC4wNVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgXVxuICAgICAgfTtcblxuICAgICAgY29uc3QgcmVzdWx0ID0gcmVjaXBlRWxlbWVudGFsU2VydmljZS5kZXJpdmVFbGVtZW50YWxQcm9wZXJ0aWVzKHJlY2lwZSk7XG4gICAgICBcbiAgICAgIC8vIEphcGFuZXNlIGN1aXNpbmUsIHN0ZWFtaW5nLCBhbmQgcmljZSBzaG91bGQgcmVzdWx0IGluIGhpZ2hlciBXYXRlciBhbmQgRWFydGhcbiAgICAgIGV4cGVjdChyZXN1bHQuV2F0ZXIpLnRvQmVHcmVhdGVyVGhhbigwLjIpO1xuICAgICAgXG4gICAgICBjb25zdCBzdW0gPSBPYmplY3QudmFsdWVzKHJlc3VsdCkucmVkdWNlKChhLCBiKSA9PiBhICsgYiwgMCk7XG4gICAgICBleHBlY3Qoc3VtKS50b0JlQ2xvc2VUbygxLCA2KTtcbiAgICB9KTtcbiAgfSk7XG59KTsgIl0sInZlcnNpb24iOjN9