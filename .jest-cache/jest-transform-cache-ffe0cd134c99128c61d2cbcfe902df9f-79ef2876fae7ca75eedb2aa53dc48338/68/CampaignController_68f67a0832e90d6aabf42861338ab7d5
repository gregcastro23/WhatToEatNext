498ee41775f0c306fcee929097ce5f1f
"use strict";
/**
 * Campaign Controller Core
 * Perfect Codebase Campaign - Main Controller Implementation
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.CampaignController = void 0;
const campaign_1 = require("../../types/campaign");
class CampaignController {
    config;
    currentPhase = null;
    safetyEvents = [];
    constructor(config) {
        this.config = config;
    }
    /**
     * Execute a specific campaign phase
     */
    async executePhase(phase) {
        const startTime = Date.now();
        this.currentPhase = phase;
        this.addSafetyEvent({
            type: campaign_1.SafetyEventType.CHECKPOINT_CREATED,
            timestamp: new Date(),
            description: `Starting phase: ${phase.name}`,
            severity: campaign_1.SafetyEventSeverity.INFO,
            action: 'PHASE_START',
        });
        try {
            // Create safety checkpoint before phase execution
            const checkpointId = await this.createSafetyCheckpoint(`Pre-phase checkpoint: ${phase.name}`);
            // Initialize phase metrics
            const initialMetrics = await this.getCurrentMetrics();
            // Execute phase tools in sequence
            let filesProcessed = 0;
            let errorsFixed = 0;
            const warningsFixed = 0;
            for (const tool of phase.tools) {
                const toolResult = await this.executeTool(tool);
                filesProcessed += toolResult.filesProcessed.length;
                errorsFixed += toolResult.changesApplied;
                // Validate after each tool execution
                const validation = await this.validatePhaseProgress(phase);
                if (!validation.success && this.config.safetySettings.automaticRollbackEnabled) {
                    await this.rollbackToCheckpoint(checkpointId);
                    throw new Error(`Tool execution failed: ${validation.errors.join(', ')}`);
                }
            }
            // Get final metrics and calculate improvement
            const finalMetrics = await this.getCurrentMetrics();
            const metricsImprovement = this.calculateMetricsImprovement(initialMetrics, finalMetrics);
            const executionTime = Date.now() - startTime;
            const result = {
                phaseId: phase.id,
                success: true,
                metricsImprovement,
                filesProcessed,
                errorsFixed,
                warningsFixed,
                executionTime,
                safetyEvents: [...this.safetyEvents],
            };
            this.addSafetyEvent({
                type: campaign_1.SafetyEventType.CHECKPOINT_CREATED,
                timestamp: new Date(),
                description: `Phase completed successfully: ${phase.name}`,
                severity: campaign_1.SafetyEventSeverity.INFO,
                action: 'PHASE_COMPLETE',
            });
            return result;
        }
        catch (error) {
            this.addSafetyEvent({
                type: campaign_1.SafetyEventType.BUILD_FAILURE,
                timestamp: new Date(),
                description: `Phase execution failed: ${error.message}`,
                severity: campaign_1.SafetyEventSeverity.ERROR,
                action: 'PHASE_FAILED',
            });
            const executionTime = Date.now() - startTime;
            return {
                phaseId: phase.id,
                success: false,
                metricsImprovement: {
                    typeScriptErrorsReduced: 0,
                    lintingWarningsReduced: 0,
                    buildTimeImproved: 0,
                    enterpriseSystemsAdded: 0,
                },
                filesProcessed: 0,
                errorsFixed: 0,
                warningsFixed: 0,
                executionTime,
                safetyEvents: [...this.safetyEvents],
            };
        }
    }
    /**
     * Validate phase completion against success criteria
     */
    async validatePhaseCompletion(phase) {
        try {
            const currentMetrics = await this.getCurrentMetrics();
            const errors = [];
            const warnings = [];
            // Check TypeScript errors if specified
            if (phase.successCriteria.typeScriptErrors !== undefined) {
                if (currentMetrics.typeScriptErrors.current > phase.successCriteria.typeScriptErrors) {
                    errors.push(`TypeScript errors: ${currentMetrics.typeScriptErrors.current} > ${phase.successCriteria.typeScriptErrors}`);
                }
            }
            // Check linting warnings if specified
            if (phase.successCriteria.lintingWarnings !== undefined) {
                if (currentMetrics.lintingWarnings.current > phase.successCriteria.lintingWarnings) {
                    errors.push(`Linting warnings: ${currentMetrics.lintingWarnings.current} > ${phase.successCriteria.lintingWarnings}`);
                }
            }
            // Check build time if specified
            if (phase.successCriteria.buildTime !== undefined) {
                if (currentMetrics.buildPerformance.currentTime > phase.successCriteria.buildTime) {
                    warnings.push(`Build time: ${currentMetrics.buildPerformance.currentTime}s > ${phase.successCriteria.buildTime}s`);
                }
            }
            // Check enterprise systems if specified
            if (phase.successCriteria.enterpriseSystems !== undefined) {
                if (currentMetrics.enterpriseSystems.current < phase.successCriteria.enterpriseSystems) {
                    errors.push(`Enterprise systems: ${currentMetrics.enterpriseSystems.current} < ${phase.successCriteria.enterpriseSystems}`);
                }
            }
            // Run custom validation if provided
            if (phase.successCriteria.customValidation) {
                const customResult = await phase.successCriteria.customValidation();
                if (!customResult) {
                    errors.push('Custom validation failed');
                }
            }
            return {
                success: errors.length === 0,
                errors,
                warnings,
                metrics: currentMetrics,
            };
        }
        catch (error) {
            return {
                success: false,
                errors: [`Validation error: ${error.message}`],
                warnings: [],
            };
        }
    }
    /**
     * Create a safety checkpoint with current state
     */
    async createSafetyCheckpoint(description) {
        // This will be implemented by the SafetyProtocol class
        // For now, return a mock checkpoint ID
        const checkpointId = `checkpoint_${Date.now()}`;
        this.addSafetyEvent({
            type: campaign_1.SafetyEventType.CHECKPOINT_CREATED,
            timestamp: new Date(),
            description: `Safety checkpoint created: ${description}`,
            severity: campaign_1.SafetyEventSeverity.INFO,
            action: 'CHECKPOINT_CREATE',
        });
        return checkpointId;
    }
    /**
     * Rollback to a specific checkpoint
     */
    async rollbackToCheckpoint(checkpointId) {
        this.addSafetyEvent({
            type: campaign_1.SafetyEventType.ROLLBACK_TRIGGERED,
            timestamp: new Date(),
            description: `Rolling back to checkpoint: ${checkpointId}`,
            severity: campaign_1.SafetyEventSeverity.WARNING,
            action: 'ROLLBACK',
        });
        // This will be implemented by the SafetyProtocol class
        // For now, just log the rollback attempt
        console.log(`Rollback to checkpoint ${checkpointId} requested`);
    }
    /**
     * Get current progress metrics
     */
    async getProgressMetrics() {
        return this.getCurrentMetrics();
    }
    /**
     * Generate comprehensive phase report
     */
    async generatePhaseReport(phase) {
        const currentMetrics = await this.getCurrentMetrics();
        const validation = await this.validatePhaseCompletion(phase);
        return {
            phaseId: phase.id,
            phaseName: phase.name,
            startTime: new Date(),
            status: validation.success ? campaign_1.PhaseStatus.COMPLETED : campaign_1.PhaseStatus.IN_PROGRESS,
            metrics: currentMetrics,
            achievements: this.generateAchievements(phase, currentMetrics),
            issues: validation.errors,
            recommendations: this.generateRecommendations(phase, validation),
        };
    }
    /**
     * Load and validate campaign configuration
     */
    static async loadConfiguration(configPath) {
        // Default configuration based on the design document
        const defaultConfig = {
            phases: [
                {
                    id: 'phase1',
                    name: 'TypeScript Error Elimination',
                    description: 'Eliminate all TypeScript compilation errors',
                    tools: [
                        {
                            scriptPath: 'scripts/typescript-fixes/fix-typescript-errors-enhanced-v3.js',
                            parameters: { maxFiles: 15, autoFix: true, validateSafety: true },
                            batchSize: 15,
                            safetyLevel: 'MAXIMUM',
                        },
                    ],
                    successCriteria: {
                        typeScriptErrors: 0,
                    },
                    safetyCheckpoints: [],
                },
                {
                    id: 'phase2',
                    name: 'Linting Excellence Achievement',
                    description: 'Eliminate all linting warnings',
                    tools: [
                        {
                            scriptPath: 'scripts/typescript-fixes/fix-explicit-any-systematic.js',
                            parameters: { maxFiles: 25, autoFix: true },
                            batchSize: 25,
                            safetyLevel: 'HIGH',
                        },
                    ],
                    successCriteria: {
                        lintingWarnings: 0,
                    },
                    safetyCheckpoints: [],
                },
            ],
            safetySettings: {
                maxFilesPerBatch: 25,
                buildValidationFrequency: 5,
                testValidationFrequency: 10,
                corruptionDetectionEnabled: true,
                automaticRollbackEnabled: true,
                stashRetentionDays: 7,
            },
            progressTargets: {
                typeScriptErrors: 0,
                lintingWarnings: 0,
                buildTime: 10,
                enterpriseSystems: 200,
            },
            toolConfiguration: {
                enhancedErrorFixer: 'scripts/typescript-fixes/fix-typescript-errors-enhanced-v3.js',
                explicitAnyFixer: 'scripts/typescript-fixes/fix-explicit-any-systematic.js',
                unusedVariablesFixer: 'scripts/typescript-fixes/fix-unused-variables-enhanced.js',
                consoleStatementFixer: 'scripts/lint-fixes/fix-console-statements-only.js',
            },
        };
        // If configPath is provided, load from file
        // For now, return default configuration
        return defaultConfig;
    }
    // Private helper methods
    // eslint-disable-next-line @typescript-eslint/no-explicit-any -- High-risk domain requiring flexibility
    async executeTool(tool) {
        // Mock implementation - will be replaced by actual script execution
        return {
            filesProcessed: [],
            changesApplied: 0,
            success: true,
        };
    }
    async validatePhaseProgress(phase) {
        // Mock implementation - will be replaced by actual validation
        return {
            success: true,
            errors: [],
            warnings: [],
        };
    }
    async getCurrentMetrics() {
        // This will be implemented by the ProgressTracker class
        // For now, return mock metrics
        return {
            typeScriptErrors: {
                current: 86,
                target: 0,
                reduction: 0,
                percentage: 0,
            },
            lintingWarnings: {
                current: 4506,
                target: 0,
                reduction: 0,
                percentage: 0,
            },
            buildPerformance: {
                currentTime: 8.5,
                targetTime: 10,
                cacheHitRate: 0.8,
                memoryUsage: 45,
            },
            enterpriseSystems: {
                current: 0,
                target: 200,
                transformedExports: 0,
            },
        };
    }
    calculateMetricsImprovement(initial, final) {
        return {
            typeScriptErrorsReduced: initial.typeScriptErrors.current - final.typeScriptErrors.current,
            lintingWarningsReduced: initial.lintingWarnings.current - final.lintingWarnings.current,
            buildTimeImproved: initial.buildPerformance.currentTime - final.buildPerformance.currentTime,
            enterpriseSystemsAdded: final.enterpriseSystems.current - initial.enterpriseSystems.current,
        };
    }
    generateAchievements(phase, metrics) {
        const achievements = [];
        if (metrics.typeScriptErrors.current === 0) {
            achievements.push('Zero TypeScript errors achieved');
        }
        if (metrics.lintingWarnings.current === 0) {
            achievements.push('Zero linting warnings achieved');
        }
        if (metrics.buildPerformance.currentTime <= 10) {
            achievements.push('Build time under 10 seconds maintained');
        }
        return achievements;
    }
    generateRecommendations(phase, validation) {
        const recommendations = [];
        if (validation.errors.length > 0) {
            recommendations.push('Address validation errors before proceeding');
        }
        if (validation.warnings.length > 0) {
            recommendations.push('Consider addressing warnings for optimal performance');
        }
        return recommendations;
    }
    addSafetyEvent(event) {
        this.safetyEvents.push(event);
        // Keep only recent events to prevent memory issues
        if (this.safetyEvents.length > 1000) {
            this.safetyEvents = this.safetyEvents.slice(-500);
        }
    }
}
exports.CampaignController = CampaignController;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0Ly5jb25zb2xpZGF0aW9uLWJhY2t1cHMtMjAyNS0wOC0yM1QxNy01NC0xMC0wOTJaL3NyYy9zZXJ2aWNlcy9jYW1wYWlnbi9DYW1wYWlnbkNvbnRyb2xsZXIudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7R0FHRzs7O0FBRUgsbURBYThCO0FBRTlCLE1BQWEsa0JBQWtCO0lBQ3JCLE1BQU0sQ0FBaUI7SUFDdkIsWUFBWSxHQUF5QixJQUFJLENBQUM7SUFDMUMsWUFBWSxHQUFrQixFQUFFLENBQUM7SUFFekMsWUFBWSxNQUFzQjtRQUNoQyxJQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztJQUN2QixDQUFDO0lBRUQ7O09BRUc7SUFDSCxLQUFLLENBQUMsWUFBWSxDQUFDLEtBQW9CO1FBQ3JDLE1BQU0sU0FBUyxHQUFHLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQztRQUM3QixJQUFJLENBQUMsWUFBWSxHQUFHLEtBQUssQ0FBQztRQUUxQixJQUFJLENBQUMsY0FBYyxDQUFDO1lBQ2xCLElBQUksRUFBRSwwQkFBZSxDQUFDLGtCQUFrQjtZQUN4QyxTQUFTLEVBQUUsSUFBSSxJQUFJLEVBQUU7WUFDckIsV0FBVyxFQUFFLG1CQUFtQixLQUFLLENBQUMsSUFBSSxFQUFFO1lBQzVDLFFBQVEsRUFBRSw4QkFBbUIsQ0FBQyxJQUFJO1lBQ2xDLE1BQU0sRUFBRSxhQUFhO1NBQ3RCLENBQUMsQ0FBQztRQUVILElBQUk7WUFDRixrREFBa0Q7WUFDbEQsTUFBTSxZQUFZLEdBQUcsTUFBTSxJQUFJLENBQUMsc0JBQXNCLENBQUMseUJBQXlCLEtBQUssQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDO1lBRTlGLDJCQUEyQjtZQUMzQixNQUFNLGNBQWMsR0FBRyxNQUFNLElBQUksQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1lBRXRELGtDQUFrQztZQUNsQyxJQUFJLGNBQWMsR0FBRyxDQUFDLENBQUM7WUFDdkIsSUFBSSxXQUFXLEdBQUcs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c3Ryby9EZXNrdG9wL1doYXRUb0VhdE5leHQvLmNvbnNvbGlkYXRpb24tYmFja3Vwcy0yMDI1LTA4LTIzVDE3LTU0LTEwLTA5Mlovc3JjL3NlcnZpY2VzL2NhbXBhaWduL0NhbXBhaWduQ29udHJvbGxlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENhbXBhaWduIENvbnRyb2xsZXIgQ29yZVxuICogUGVyZmVjdCBDb2RlYmFzZSBDYW1wYWlnbiAtIE1haW4gQ29udHJvbGxlciBJbXBsZW1lbnRhdGlvblxuICovXG5cbmltcG9ydCB7XG4gIENhbXBhaWduQ29uZmlnLFxuICBDYW1wYWlnblBoYXNlLFxuICBQaGFzZVJlc3VsdCxcbiAgUHJvZ3Jlc3NNZXRyaWNzLFxuICBWYWxpZGF0aW9uUmVzdWx0LFxuICBDaGVja3BvaW50SWQsXG4gIFBoYXNlUmVwb3J0LFxuICBQaGFzZVN0YXR1cyxcbiAgU2FmZXR5RXZlbnQsXG4gIFNhZmV0eUV2ZW50VHlwZSxcbiAgU2FmZXR5RXZlbnRTZXZlcml0eSxcbiAgTWV0cmljc0ltcHJvdmVtZW50LFxufSBmcm9tICcuLi8uLi90eXBlcy9jYW1wYWlnbic7XG5cbmV4cG9ydCBjbGFzcyBDYW1wYWlnbkNvbnRyb2xsZXIge1xuICBwcml2YXRlIGNvbmZpZzogQ2FtcGFpZ25Db25maWc7XG4gIHByaXZhdGUgY3VycmVudFBoYXNlOiBDYW1wYWlnblBoYXNlIHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgc2FmZXR5RXZlbnRzOiBTYWZldHlFdmVudFtdID0gW107XG5cbiAgY29uc3RydWN0b3IoY29uZmlnOiBDYW1wYWlnbkNvbmZpZykge1xuICAgIHRoaXMuY29uZmlnID0gY29uZmlnO1xuICB9XG5cbiAgLyoqXG4gICAqIEV4ZWN1dGUgYSBzcGVjaWZpYyBjYW1wYWlnbiBwaGFzZVxuICAgKi9cbiAgYXN5bmMgZXhlY3V0ZVBoYXNlKHBoYXNlOiBDYW1wYWlnblBoYXNlKTogUHJvbWlzZTxQaGFzZVJlc3VsdD4ge1xuICAgIGNvbnN0IHN0YXJ0VGltZSA9IERhdGUubm93KCk7XG4gICAgdGhpcy5jdXJyZW50UGhhc2UgPSBwaGFzZTtcblxuICAgIHRoaXMuYWRkU2FmZXR5RXZlbnQoe1xuICAgICAgdHlwZTogU2FmZXR5RXZlbnRUeXBlLkNIRUNLUE9JTlRfQ1JFQVRFRCxcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgIGRlc2NyaXB0aW9uOiBgU3RhcnRpbmcgcGhhc2U6ICR7cGhhc2UubmFtZX1gLFxuICAgICAgc2V2ZXJpdHk6IFNhZmV0eUV2ZW50U2V2ZXJpdHkuSU5GTyxcbiAgICAgIGFjdGlvbjogJ1BIQVNFX1NUQVJUJyxcbiAgICB9KTtcblxuICAgIHRyeSB7XG4gICAgICAvLyBDcmVhdGUgc2FmZXR5IGNoZWNrcG9pbnQgYmVmb3JlIHBoYXNlIGV4ZWN1dGlvblxuICAgICAgY29uc3QgY2hlY2twb2ludElkID0gYXdhaXQgdGhpcy5jcmVhdGVTYWZldHlDaGVja3BvaW50KGBQcmUtcGhhc2UgY2hlY2twb2ludDogJHtwaGFzZS5uYW1lfWApO1xuXG4gICAgICAvLyBJbml0aWFsaXplIHBoYXNlIG1ldHJpY3NcbiAgICAgIGNvbnN0IGluaXRpYWxNZXRyaWNzID0gYXdhaXQgdGhpcy5nZXRDdXJyZW50TWV0cmljcygpO1xuXG4gICAgICAvLyBFeGVjdXRlIHBoYXNlIHRvb2xzIGluIHNlcXVlbmNlXG4gICAgICBsZXQgZmlsZXNQcm9jZXNzZWQgPSAwO1xuICAgICAgbGV0IGVycm9yc0ZpeGVkID0gMDtcbiAgICAgIGNvbnN0IHdhcm5pbmdzRml4ZWQgPSAwO1xuXG4gICAgICBmb3IgKGNvbnN0IHRvb2wgb2YgcGhhc2UudG9vbHMpIHtcbiAgICAgICAgY29uc3QgdG9vbFJlc3VsdCA9IGF3YWl0IHRoaXMuZXhlY3V0ZVRvb2wodG9vbCk7XG4gICAgICAgIGZpbGVzUHJvY2Vzc2VkICs9IHRvb2xSZXN1bHQuZmlsZXNQcm9jZXNzZWQubGVuZ3RoO1xuICAgICAgICBlcnJvcnNGaXhlZCArPSB0b29sUmVzdWx0LmNoYW5nZXNBcHBsaWVkO1xuXG4gICAgICAgIC8vIFZhbGlkYXRlIGFmdGVyIGVhY2ggdG9vbCBleGVjdXRpb25cbiAgICAgICAgY29uc3QgdmFsaWRhdGlvbiA9IGF3YWl0IHRoaXMudmFsaWRhdGVQaGFzZVByb2dyZXNzKHBoYXNlKTtcbiAgICAgICAgaWYgKCF2YWxpZGF0aW9uLnN1Y2Nlc3MgJiYgdGhpcy5jb25maWcuc2FmZXR5U2V0dGluZ3MuYXV0b21hdGljUm9sbGJhY2tFbmFibGVkKSB7XG4gICAgICAgICAgYXdhaXQgdGhpcy5yb2xsYmFja1RvQ2hlY2twb2ludChjaGVja3BvaW50SWQpO1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgVG9vbCBleGVjdXRpb24gZmFpbGVkOiAke3ZhbGlkYXRpb24uZXJyb3JzLmpvaW4oJywgJyl9YCk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gR2V0IGZpbmFsIG1ldHJpY3MgYW5kIGNhbGN1bGF0ZSBpbXByb3ZlbWVudFxuICAgICAgY29uc3QgZmluYWxNZXRyaWNzID0gYXdhaXQgdGhpcy5nZXRDdXJyZW50TWV0cmljcygpO1xuICAgICAgY29uc3QgbWV0cmljc0ltcHJvdmVtZW50ID0gdGhpcy5jYWxjdWxhdGVNZXRyaWNzSW1wcm92ZW1lbnQoaW5pdGlhbE1ldHJpY3MsIGZpbmFsTWV0cmljcyk7XG5cbiAgICAgIGNvbnN0IGV4ZWN1dGlvblRpbWUgPSBEYXRlLm5vdygpIC0gc3RhcnRUaW1lO1xuXG4gICAgICBjb25zdCByZXN1bHQ6IFBoYXNlUmVzdWx0ID0ge1xuICAgICAgICBwaGFzZUlkOiBwaGFzZS5pZCxcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgbWV0cmljc0ltcHJvdmVtZW50LFxuICAgICAgICBmaWxlc1Byb2Nlc3NlZCxcbiAgICAgICAgZXJyb3JzRml4ZWQsXG4gICAgICAgIHdhcm5pbmdzRml4ZWQsXG4gICAgICAgIGV4ZWN1dGlvblRpbWUsXG4gICAgICAgIHNhZmV0eUV2ZW50czogWy4uLnRoaXMuc2FmZXR5RXZlbnRzXSxcbiAgICAgIH07XG5cbiAgICAgIHRoaXMuYWRkU2FmZXR5RXZlbnQoe1xuICAgICAgICB0eXBlOiBTYWZldHlFdmVudFR5cGUuQ0hFQ0tQT0lOVF9DUkVBVEVELFxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAgICAgIGRlc2NyaXB0aW9uOiBgUGhhc2UgY29tcGxldGVkIHN1Y2Nlc3NmdWxseTogJHtwaGFzZS5uYW1lfWAsXG4gICAgICAgIHNldmVyaXR5OiBTYWZldHlFdmVudFNldmVyaXR5LklORk8sXG4gICAgICAgIGFjdGlvbjogJ1BIQVNFX0NPTVBMRVRFJyxcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLmFkZFNhZmV0eUV2ZW50KHtcbiAgICAgICAgdHlwZTogU2FmZXR5RXZlbnRUeXBlLkJVSUxEX0ZBSUxVUkUsXG4gICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgICAgZGVzY3JpcHRpb246IGBQaGFzZSBleGVjdXRpb24gZmFpbGVkOiAkeyhlcnJvciBhcyBFcnJvcikubWVzc2FnZX1gLFxuICAgICAgICBzZXZlcml0eTogU2FmZXR5RXZlbnRTZXZlcml0eS5FUlJPUixcbiAgICAgICAgYWN0aW9uOiAnUEhBU0VfRkFJTEVEJyxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBleGVjdXRpb25UaW1lID0gRGF0ZS5ub3coKSAtIHN0YXJ0VGltZTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgcGhhc2VJZDogcGhhc2UuaWQsXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXRyaWNzSW1wcm92ZW1lbnQ6IHtcbiAgICAgICAgICB0eXBlU2NyaXB0RXJyb3JzUmVkdWNlZDogMCxcbiAgICAgICAgICBsaW50aW5nV2FybmluZ3NSZWR1Y2VkOiAwLFxuICAgICAgICAgIGJ1aWxkVGltZUltcHJvdmVkOiAwLFxuICAgICAgICAgIGVudGVycHJpc2VTeXN0ZW1zQWRkZWQ6IDAsXG4gICAgICAgIH0sXG4gICAgICAgIGZpbGVzUHJvY2Vzc2VkOiAwLFxuICAgICAgICBlcnJvcnNGaXhlZDogMCxcbiAgICAgICAgd2FybmluZ3NGaXhlZDogMCxcbiAgICAgICAgZXhlY3V0aW9uVGltZSxcbiAgICAgICAgc2FmZXR5RXZlbnRzOiBbLi4udGhpcy5zYWZldHlFdmVudHNdLFxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVmFsaWRhdGUgcGhhc2UgY29tcGxldGlvbiBhZ2FpbnN0IHN1Y2Nlc3MgY3JpdGVyaWFcbiAgICovXG4gIGFzeW5jIHZhbGlkYXRlUGhhc2VDb21wbGV0aW9uKHBoYXNlOiBDYW1wYWlnblBoYXNlKTogUHJvbWlzZTxWYWxpZGF0aW9uUmVzdWx0PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGN1cnJlbnRNZXRyaWNzID0gYXdhaXQgdGhpcy5nZXRDdXJyZW50TWV0cmljcygpO1xuICAgICAgY29uc3QgZXJyb3JzOiBzdHJpbmdbXSA9IFtdO1xuICAgICAgY29uc3Qgd2FybmluZ3M6IHN0cmluZ1tdID0gW107XG5cbiAgICAgIC8vIENoZWNrIFR5cGVTY3JpcHQgZXJyb3JzIGlmIHNwZWNpZmllZFxuICAgICAgaWYgKHBoYXNlLnN1Y2Nlc3NDcml0ZXJpYS50eXBlU2NyaXB0RXJyb3JzICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgaWYgKGN1cnJlbnRNZXRyaWNzLnR5cGVTY3JpcHRFcnJvcnMuY3VycmVudCA+IHBoYXNlLnN1Y2Nlc3NDcml0ZXJpYS50eXBlU2NyaXB0RXJyb3JzKSB7XG4gICAgICAgICAgZXJyb3JzLnB1c2goXG4gICAgICAgICAgICBgVHlwZVNjcmlwdCBlcnJvcnM6ICR7Y3VycmVudE1ldHJpY3MudHlwZVNjcmlwdEVycm9ycy5jdXJyZW50fSA+ICR7cGhhc2Uuc3VjY2Vzc0NyaXRlcmlhLnR5cGVTY3JpcHRFcnJvcnN9YCxcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIENoZWNrIGxpbnRpbmcgd2FybmluZ3MgaWYgc3BlY2lmaWVkXG4gICAgICBpZiAocGhhc2Uuc3VjY2Vzc0NyaXRlcmlhLmxpbnRpbmdXYXJuaW5ncyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGlmIChjdXJyZW50TWV0cmljcy5saW50aW5nV2FybmluZ3MuY3VycmVudCA+IHBoYXNlLnN1Y2Nlc3NDcml0ZXJpYS5saW50aW5nV2FybmluZ3MpIHtcbiAgICAgICAgICBlcnJvcnMucHVzaChcbiAgICAgICAgICAgIGBMaW50aW5nIHdhcm5pbmdzOiAke2N1cnJlbnRNZXRyaWNzLmxpbnRpbmdXYXJuaW5ncy5jdXJyZW50fSA+ICR7cGhhc2Uuc3VjY2Vzc0NyaXRlcmlhLmxpbnRpbmdXYXJuaW5nc31gLFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gQ2hlY2sgYnVpbGQgdGltZSBpZiBzcGVjaWZpZWRcbiAgICAgIGlmIChwaGFzZS5zdWNjZXNzQ3JpdGVyaWEuYnVpbGRUaW1lICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgaWYgKGN1cnJlbnRNZXRyaWNzLmJ1aWxkUGVyZm9ybWFuY2UuY3VycmVudFRpbWUgPiBwaGFzZS5zdWNjZXNzQ3JpdGVyaWEuYnVpbGRUaW1lKSB7XG4gICAgICAgICAgd2FybmluZ3MucHVzaChcbiAgICAgICAgICAgIGBCdWlsZCB0aW1lOiAke2N1cnJlbnRNZXRyaWNzLmJ1aWxkUGVyZm9ybWFuY2UuY3VycmVudFRpbWV9cyA+ICR7cGhhc2Uuc3VjY2Vzc0NyaXRlcmlhLmJ1aWxkVGltZX1zYCxcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIENoZWNrIGVudGVycHJpc2Ugc3lzdGVtcyBpZiBzcGVjaWZpZWRcbiAgICAgIGlmIChwaGFzZS5zdWNjZXNzQ3JpdGVyaWEuZW50ZXJwcmlzZVN5c3RlbXMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICBpZiAoY3VycmVudE1ldHJpY3MuZW50ZXJwcmlzZVN5c3RlbXMuY3VycmVudCA8IHBoYXNlLnN1Y2Nlc3NDcml0ZXJpYS5lbnRlcnByaXNlU3lzdGVtcykge1xuICAgICAgICAgIGVycm9ycy5wdXNoKFxuICAgICAgICAgICAgYEVudGVycHJpc2Ugc3lzdGVtczogJHtjdXJyZW50TWV0cmljcy5lbnRlcnByaXNlU3lzdGVtcy5jdXJyZW50fSA8ICR7cGhhc2Uuc3VjY2Vzc0NyaXRlcmlhLmVudGVycHJpc2VTeXN0ZW1zfWAsXG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBSdW4gY3VzdG9tIHZhbGlkYXRpb24gaWYgcHJvdmlkZWRcbiAgICAgIGlmIChwaGFzZS5zdWNjZXNzQ3JpdGVyaWEuY3VzdG9tVmFsaWRhdGlvbikge1xuICAgICAgICBjb25zdCBjdXN0b21SZXN1bHQgPSBhd2FpdCBwaGFzZS5zdWNjZXNzQ3JpdGVyaWEuY3VzdG9tVmFsaWRhdGlvbigpO1xuICAgICAgICBpZiAoIWN1c3RvbVJlc3VsdCkge1xuICAgICAgICAgIGVycm9ycy5wdXNoKCdDdXN0b20gdmFsaWRhdGlvbiBmYWlsZWQnKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBlcnJvcnMubGVuZ3RoID09PSAwLFxuICAgICAgICBlcnJvcnMsXG4gICAgICAgIHdhcm5pbmdzLFxuICAgICAgICBtZXRyaWNzOiBjdXJyZW50TWV0cmljcyxcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcnM6IFtgVmFsaWRhdGlvbiBlcnJvcjogJHsoZXJyb3IgYXMgRXJyb3IpLm1lc3NhZ2V9YF0sXG4gICAgICAgIHdhcm5pbmdzOiBbXSxcbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENyZWF0ZSBhIHNhZmV0eSBjaGVja3BvaW50IHdpdGggY3VycmVudCBzdGF0ZVxuICAgKi9cbiAgYXN5bmMgY3JlYXRlU2FmZXR5Q2hlY2twb2ludChkZXNjcmlwdGlvbjogc3RyaW5nKTogUHJvbWlzZTxDaGVja3BvaW50SWQ+IHtcbiAgICAvLyBUaGlzIHdpbGwgYmUgaW1wbGVtZW50ZWQgYnkgdGhlIFNhZmV0eVByb3RvY29sIGNsYXNzXG4gICAgLy8gRm9yIG5vdywgcmV0dXJuIGEgbW9jayBjaGVja3BvaW50IElEXG4gICAgY29uc3QgY2hlY2twb2ludElkID0gYGNoZWNrcG9pbnRfJHtEYXRlLm5vdygpfWA7XG5cbiAgICB0aGlzLmFkZFNhZmV0eUV2ZW50KHtcbiAgICAgIHR5cGU6IFNhZmV0eUV2ZW50VHlwZS5DSEVDS1BPSU5UX0NSRUFURUQsXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAgICBkZXNjcmlwdGlvbjogYFNhZmV0eSBjaGVja3BvaW50IGNyZWF0ZWQ6ICR7ZGVzY3JpcHRpb259YCxcbiAgICAgIHNldmVyaXR5OiBTYWZldHlFdmVudFNldmVyaXR5LklORk8sXG4gICAgICBhY3Rpb246ICdDSEVDS1BPSU5UX0NSRUFURScsXG4gICAgfSk7XG5cbiAgICByZXR1cm4gY2hlY2twb2ludElkO1xuICB9XG5cbiAgLyoqXG4gICAqIFJvbGxiYWNrIHRvIGEgc3BlY2lmaWMgY2hlY2twb2ludFxuICAgKi9cbiAgYXN5bmMgcm9sbGJhY2tUb0NoZWNrcG9pbnQoY2hlY2twb2ludElkOiBDaGVja3BvaW50SWQpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0aGlzLmFkZFNhZmV0eUV2ZW50KHtcbiAgICAgIHR5cGU6IFNhZmV0eUV2ZW50VHlwZS5ST0xMQkFDS19UUklHR0VSRUQsXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAgICBkZXNjcmlwdGlvbjogYFJvbGxpbmcgYmFjayB0byBjaGVja3BvaW50OiAke2NoZWNrcG9pbnRJZH1gLFxuICAgICAgc2V2ZXJpdHk6IFNhZmV0eUV2ZW50U2V2ZXJpdHkuV0FSTklORyxcbiAgICAgIGFjdGlvbjogJ1JPTExCQUNLJyxcbiAgICB9KTtcblxuICAgIC8vIFRoaXMgd2lsbCBiZSBpbXBsZW1lbnRlZCBieSB0aGUgU2FmZXR5UHJvdG9jb2wgY2xhc3NcbiAgICAvLyBGb3Igbm93LCBqdXN0IGxvZyB0aGUgcm9sbGJhY2sgYXR0ZW1wdFxuICAgIGNvbnNvbGUubG9nKGBSb2xsYmFjayB0byBjaGVja3BvaW50ICR7Y2hlY2twb2ludElkfSByZXF1ZXN0ZWRgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgY3VycmVudCBwcm9ncmVzcyBtZXRyaWNzXG4gICAqL1xuICBhc3luYyBnZXRQcm9ncmVzc01ldHJpY3MoKTogUHJvbWlzZTxQcm9ncmVzc01ldHJpY3M+IHtcbiAgICByZXR1cm4gdGhpcy5nZXRDdXJyZW50TWV0cmljcygpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdlbmVyYXRlIGNvbXByZWhlbnNpdmUgcGhhc2UgcmVwb3J0XG4gICAqL1xuICBhc3luYyBnZW5lcmF0ZVBoYXNlUmVwb3J0KHBoYXNlOiBDYW1wYWlnblBoYXNlKTogUHJvbWlzZTxQaGFzZVJlcG9ydD4ge1xuICAgIGNvbnN0IGN1cnJlbnRNZXRyaWNzID0gYXdhaXQgdGhpcy5nZXRDdXJyZW50TWV0cmljcygpO1xuICAgIGNvbnN0IHZhbGlkYXRpb24gPSBhd2FpdCB0aGlzLnZhbGlkYXRlUGhhc2VDb21wbGV0aW9uKHBoYXNlKTtcblxuICAgIHJldHVybiB7XG4gICAgICBwaGFzZUlkOiBwaGFzZS5pZCxcbiAgICAgIHBoYXNlTmFtZTogcGhhc2UubmFtZSxcbiAgICAgIHN0YXJ0VGltZTogbmV3IERhdGUoKSwgLy8gVGhpcyBzaG91bGQgYmUgdHJhY2tlZCBwcm9wZXJseVxuICAgICAgc3RhdHVzOiB2YWxpZGF0aW9uLnN1Y2Nlc3MgPyBQaGFzZVN0YXR1cy5DT01QTEVURUQgOiBQaGFzZVN0YXR1cy5JTl9QUk9HUkVTUyxcbiAgICAgIG1ldHJpY3M6IGN1cnJlbnRNZXRyaWNzLFxuICAgICAgYWNoaWV2ZW1lbnRzOiB0aGlzLmdlbmVyYXRlQWNoaWV2ZW1lbnRzKHBoYXNlLCBjdXJyZW50TWV0cmljcyksXG4gICAgICBpc3N1ZXM6IHZhbGlkYXRpb24uZXJyb3JzLFxuICAgICAgcmVjb21tZW5kYXRpb25zOiB0aGlzLmdlbmVyYXRlUmVjb21tZW5kYXRpb25zKHBoYXNlLCB2YWxpZGF0aW9uKSxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIExvYWQgYW5kIHZhbGlkYXRlIGNhbXBhaWduIGNvbmZpZ3VyYXRpb25cbiAgICovXG4gIHN0YXRpYyBhc3luYyBsb2FkQ29uZmlndXJhdGlvbihjb25maWdQYXRoPzogc3RyaW5nKTogUHJvbWlzZTxDYW1wYWlnbkNvbmZpZz4ge1xuICAgIC8vIERlZmF1bHQgY29uZmlndXJhdGlvbiBiYXNlZCBvbiB0aGUgZGVzaWduIGRvY3VtZW50XG4gICAgY29uc3QgZGVmYXVsdENvbmZpZzogQ2FtcGFpZ25Db25maWcgPSB7XG4gICAgICBwaGFzZXM6IFtcbiAgICAgICAge1xuICAgICAgICAgIGlkOiAncGhhc2UxJyxcbiAgICAgICAgICBuYW1lOiAnVHlwZVNjcmlwdCBFcnJvciBFbGltaW5hdGlvbicsXG4gICAgICAgICAgZGVzY3JpcHRpb246ICdFbGltaW5hdGUgYWxsIFR5cGVTY3JpcHQgY29tcGlsYXRpb24gZXJyb3JzJyxcbiAgICAgICAgICB0b29sczogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBzY3JpcHRQYXRoOiAnc2NyaXB0cy90eXBlc2NyaXB0LWZpeGVzL2ZpeC10eXBlc2NyaXB0LWVycm9ycy1lbmhhbmNlZC12My5qcycsXG4gICAgICAgICAgICAgIHBhcmFtZXRlcnM6IHsgbWF4RmlsZXM6IDE1LCBhdXRvRml4OiB0cnVlLCB2YWxpZGF0ZVNhZmV0eTogdHJ1ZSB9LFxuICAgICAgICAgICAgICBiYXRjaFNpemU6IDE1LFxuICAgICAgICAgICAgICBzYWZldHlMZXZlbDogJ01BWElNVU0nIGFzIHVua25vd24sXG4gICAgICAgICAgICB9LFxuICAgICAgICAgIF0sXG4gICAgICAgICAgc3VjY2Vzc0NyaXRlcmlhOiB7XG4gICAgICAgICAgICB0eXBlU2NyaXB0RXJyb3JzOiAwLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgc2FmZXR5Q2hlY2twb2ludHM6IFtdLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgaWQ6ICdwaGFzZTInLFxuICAgICAgICAgIG5hbWU6ICdMaW50aW5nIEV4Y2VsbGVuY2UgQWNoaWV2ZW1lbnQnLFxuICAgICAgICAgIGRlc2NyaXB0aW9uOiAnRWxpbWluYXRlIGFsbCBsaW50aW5nIHdhcm5pbmdzJyxcbiAgICAgICAgICB0b29sczogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBzY3JpcHRQYXRoOiAnc2NyaXB0cy90eXBlc2NyaXB0LWZpeGVzL2ZpeC1leHBsaWNpdC1hbnktc3lzdGVtYXRpYy5qcycsXG4gICAgICAgICAgICAgIHBhcmFtZXRlcnM6IHsgbWF4RmlsZXM6IDI1LCBhdXRvRml4OiB0cnVlIH0sXG4gICAgICAgICAgICAgIGJhdGNoU2l6ZTogMjUsXG4gICAgICAgICAgICAgIHNhZmV0eUxldmVsOiAnSElHSCcgYXMgdW5rbm93bixcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgXSxcbiAgICAgICAgICBzdWNjZXNzQ3JpdGVyaWE6IHtcbiAgICAgICAgICAgIGxpbnRpbmdXYXJuaW5nczogMCxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHNhZmV0eUNoZWNrcG9pbnRzOiBbXSxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgICBzYWZldHlTZXR0aW5nczoge1xuICAgICAgICBtYXhGaWxlc1BlckJhdGNoOiAyNSxcbiAgICAgICAgYnVpbGRWYWxpZGF0aW9uRnJlcXVlbmN5OiA1LFxuICAgICAgICB0ZXN0VmFsaWRhdGlvbkZyZXF1ZW5jeTogMTAsXG4gICAgICAgIGNvcnJ1cHRpb25EZXRlY3Rpb25FbmFibGVkOiB0cnVlLFxuICAgICAgICBhdXRvbWF0aWNSb2xsYmFja0VuYWJsZWQ6IHRydWUsXG4gICAgICAgIHN0YXNoUmV0ZW50aW9uRGF5czogNyxcbiAgICAgIH0sXG4gICAgICBwcm9ncmVzc1RhcmdldHM6IHtcbiAgICAgICAgdHlwZVNjcmlwdEVycm9yczogMCxcbiAgICAgICAgbGludGluZ1dhcm5pbmdzOiAwLFxuICAgICAgICBidWlsZFRpbWU6IDEwLFxuICAgICAgICBlbnRlcnByaXNlU3lzdGVtczogMjAwLFxuICAgICAgfSxcbiAgICAgIHRvb2xDb25maWd1cmF0aW9uOiB7XG4gICAgICAgIGVuaGFuY2VkRXJyb3JGaXhlcjogJ3NjcmlwdHMvdHlwZXNjcmlwdC1maXhlcy9maXgtdHlwZXNjcmlwdC1lcnJvcnMtZW5oYW5jZWQtdjMuanMnLFxuICAgICAgICBleHBsaWNpdEFueUZpeGVyOiAnc2NyaXB0cy90eXBlc2NyaXB0LWZpeGVzL2ZpeC1leHBsaWNpdC1hbnktc3lzdGVtYXRpYy5qcycsXG4gICAgICAgIHVudXNlZFZhcmlhYmxlc0ZpeGVyOiAnc2NyaXB0cy90eXBlc2NyaXB0LWZpeGVzL2ZpeC11bnVzZWQtdmFyaWFibGVzLWVuaGFuY2VkLmpzJyxcbiAgICAgICAgY29uc29sZVN0YXRlbWVudEZpeGVyOiAnc2NyaXB0cy9saW50LWZpeGVzL2ZpeC1jb25zb2xlLXN0YXRlbWVudHMtb25seS5qcycsXG4gICAgICB9LFxuICAgIH07XG5cbiAgICAvLyBJZiBjb25maWdQYXRoIGlzIHByb3ZpZGVkLCBsb2FkIGZyb20gZmlsZVxuICAgIC8vIEZvciBub3csIHJldHVybiBkZWZhdWx0IGNvbmZpZ3VyYXRpb25cbiAgICByZXR1cm4gZGVmYXVsdENvbmZpZztcbiAgfVxuXG4gIC8vIFByaXZhdGUgaGVscGVyIG1ldGhvZHNcblxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueSAtLSBIaWdoLXJpc2sgZG9tYWluIHJlcXVpcmluZyBmbGV4aWJpbGl0eVxuICBwcml2YXRlIGFzeW5jIGV4ZWN1dGVUb29sKHRvb2w6IHVua25vd24pOiBQcm9taXNlPGFueT4ge1xuICAgIC8vIE1vY2sgaW1wbGVtZW50YXRpb24gLSB3aWxsIGJlIHJlcGxhY2VkIGJ5IGFjdHVhbCBzY3JpcHQgZXhlY3V0aW9uXG4gICAgcmV0dXJuIHtcbiAgICAgIGZpbGVzUHJvY2Vzc2VkOiBbXSxcbiAgICAgIGNoYW5nZXNBcHBsaWVkOiAwLFxuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyB2YWxpZGF0ZVBoYXNlUHJvZ3Jlc3MocGhhc2U6IENhbXBhaWduUGhhc2UpOiBQcm9taXNlPFZhbGlkYXRpb25SZXN1bHQ+IHtcbiAgICAvLyBNb2NrIGltcGxlbWVudGF0aW9uIC0gd2lsbCBiZSByZXBsYWNlZCBieSBhY3R1YWwgdmFsaWRhdGlvblxuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgZXJyb3JzOiBbXSxcbiAgICAgIHdhcm5pbmdzOiBbXSxcbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBnZXRDdXJyZW50TWV0cmljcygpOiBQcm9taXNlPFByb2dyZXNzTWV0cmljcz4ge1xuICAgIC8vIFRoaXMgd2lsbCBiZSBpbXBsZW1lbnRlZCBieSB0aGUgUHJvZ3Jlc3NUcmFja2VyIGNsYXNzXG4gICAgLy8gRm9yIG5vdywgcmV0dXJuIG1vY2sgbWV0cmljc1xuICAgIHJldHVybiB7XG4gICAgICB0eXBlU2NyaXB0RXJyb3JzOiB7XG4gICAgICAgIGN1cnJlbnQ6IDg2LFxuICAgICAgICB0YXJnZXQ6IDAsXG4gICAgICAgIHJlZHVjdGlvbjogMCxcbiAgICAgICAgcGVyY2VudGFnZTogMCxcbiAgICAgIH0sXG4gICAgICBsaW50aW5nV2FybmluZ3M6IHtcbiAgICAgICAgY3VycmVudDogNDUwNixcbiAgICAgICAgdGFyZ2V0OiAwLFxuICAgICAgICByZWR1Y3Rpb246IDAsXG4gICAgICAgIHBlcmNlbnRhZ2U6IDAsXG4gICAgICB9LFxuICAgICAgYnVpbGRQZXJmb3JtYW5jZToge1xuICAgICAgICBjdXJyZW50VGltZTogOC41LFxuICAgICAgICB0YXJnZXRUaW1lOiAxMCxcbiAgICAgICAgY2FjaGVIaXRSYXRlOiAwLjgsXG4gICAgICAgIG1lbW9yeVVzYWdlOiA0NSxcbiAgICAgIH0sXG4gICAgICBlbnRlcnByaXNlU3lzdGVtczoge1xuICAgICAgICBjdXJyZW50OiAwLFxuICAgICAgICB0YXJnZXQ6IDIwMCxcbiAgICAgICAgdHJhbnNmb3JtZWRFeHBvcnRzOiAwLFxuICAgICAgfSxcbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBjYWxjdWxhdGVNZXRyaWNzSW1wcm92ZW1lbnQoXG4gICAgaW5pdGlhbDogUHJvZ3Jlc3NNZXRyaWNzLFxuICAgIGZpbmFsOiBQcm9ncmVzc01ldHJpY3MsXG4gICk6IE1ldHJpY3NJbXByb3ZlbWVudCB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGVTY3JpcHRFcnJvcnNSZWR1Y2VkOiBpbml0aWFsLnR5cGVTY3JpcHRFcnJvcnMuY3VycmVudCAtIGZpbmFsLnR5cGVTY3JpcHRFcnJvcnMuY3VycmVudCxcbiAgICAgIGxpbnRpbmdXYXJuaW5nc1JlZHVjZWQ6IGluaXRpYWwubGludGluZ1dhcm5pbmdzLmN1cnJlbnQgLSBmaW5hbC5saW50aW5nV2FybmluZ3MuY3VycmVudCxcbiAgICAgIGJ1aWxkVGltZUltcHJvdmVkOiBpbml0aWFsLmJ1aWxkUGVyZm9ybWFuY2UuY3VycmVudFRpbWUgLSBmaW5hbC5idWlsZFBlcmZvcm1hbmNlLmN1cnJlbnRUaW1lLFxuICAgICAgZW50ZXJwcmlzZVN5c3RlbXNBZGRlZDogZmluYWwuZW50ZXJwcmlzZVN5c3RlbXMuY3VycmVudCAtIGluaXRpYWwuZW50ZXJwcmlzZVN5c3RlbXMuY3VycmVudCxcbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBnZW5lcmF0ZUFjaGlldmVtZW50cyhwaGFzZTogQ2FtcGFpZ25QaGFzZSwgbWV0cmljczogUHJvZ3Jlc3NNZXRyaWNzKTogc3RyaW5nW10ge1xuICAgIGNvbnN0IGFjaGlldmVtZW50czogc3RyaW5nW10gPSBbXTtcblxuICAgIGlmIChtZXRyaWNzLnR5cGVTY3JpcHRFcnJvcnMuY3VycmVudCA9PT0gMCkge1xuICAgICAgYWNoaWV2ZW1lbnRzLnB1c2goJ1plcm8gVHlwZVNjcmlwdCBlcnJvcnMgYWNoaWV2ZWQnKTtcbiAgICB9XG5cbiAgICBpZiAobWV0cmljcy5saW50aW5nV2FybmluZ3MuY3VycmVudCA9PT0gMCkge1xuICAgICAgYWNoaWV2ZW1lbnRzLnB1c2goJ1plcm8gbGludGluZyB3YXJuaW5ncyBhY2hpZXZlZCcpO1xuICAgIH1cblxuICAgIGlmIChtZXRyaWNzLmJ1aWxkUGVyZm9ybWFuY2UuY3VycmVudFRpbWUgPD0gMTApIHtcbiAgICAgIGFjaGlldmVtZW50cy5wdXNoKCdCdWlsZCB0aW1lIHVuZGVyIDEwIHNlY29uZHMgbWFpbnRhaW5lZCcpO1xuICAgIH1cblxuICAgIHJldHVybiBhY2hpZXZlbWVudHM7XG4gIH1cblxuICBwcml2YXRlIGdlbmVyYXRlUmVjb21tZW5kYXRpb25zKHBoYXNlOiBDYW1wYWlnblBoYXNlLCB2YWxpZGF0aW9uOiBWYWxpZGF0aW9uUmVzdWx0KTogc3RyaW5nW10ge1xuICAgIGNvbnN0IHJlY29tbWVuZGF0aW9uczogc3RyaW5nW10gPSBbXTtcblxuICAgIGlmICh2YWxpZGF0aW9uLmVycm9ycy5sZW5ndGggPiAwKSB7XG4gICAgICByZWNvbW1lbmRhdGlvbnMucHVzaCgnQWRkcmVzcyB2YWxpZGF0aW9uIGVycm9ycyBiZWZvcmUgcHJvY2VlZGluZycpO1xuICAgIH1cblxuICAgIGlmICh2YWxpZGF0aW9uLndhcm5pbmdzLmxlbmd0aCA+IDApIHtcbiAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKCdDb25zaWRlciBhZGRyZXNzaW5nIHdhcm5pbmdzIGZvciBvcHRpbWFsIHBlcmZvcm1hbmNlJyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHJlY29tbWVuZGF0aW9ucztcbiAgfVxuXG4gIHByaXZhdGUgYWRkU2FmZXR5RXZlbnQoZXZlbnQ6IFNhZmV0eUV2ZW50KTogdm9pZCB7XG4gICAgdGhpcy5zYWZldHlFdmVudHMucHVzaChldmVudCk7XG5cbiAgICAvLyBLZWVwIG9ubHkgcmVjZW50IGV2ZW50cyB0byBwcmV2ZW50IG1lbW9yeSBpc3N1ZXNcbiAgICBpZiAodGhpcy5zYWZldHlFdmVudHMubGVuZ3RoID4gMTAwMCkge1xuICAgICAgdGhpcy5zYWZldHlFdmVudHMgPSB0aGlzLnNhZmV0eUV2ZW50cy5zbGljZSgtNTAwKTtcbiAgICB9XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==