4f4e27bc4adf2ba1df3049e660a87866
"use strict";
/**
 * Linting Quality Gates Service
 *
 * Implements quality gates that require zero linting issues for deployment
 * and provides comprehensive quality assessment for CI/CD pipelines.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.LintingQualityGates = void 0;
const child_process_1 = require("child_process");
const fs_1 = require("fs");
const logger_1 = require("@/utils/logger");
const LintingProgressTracker_1 = require("./LintingProgressTracker");
/**
 * Linting Quality Gates Service
 */
class LintingQualityGates {
    progressTracker;
    configFile = '.kiro/quality-gates/config.json';
    resultsFile = '.kiro/quality-gates/results.json';
    historyFile = '.kiro/quality-gates/history.json';
    constructor() {
        this.progressTracker = new LintingProgressTracker_1.LintingProgressTracker();
        this.ensureDirectoryExists();
    }
    /**
     * Evaluate quality gates for deployment
     */
    async evaluateQualityGates(gateConfig) {
        try {
            const config = gateConfig || this.getDefaultQualityGateConfig();
            logger_1.logger.info(`Evaluating quality gates: ${config.name}`);
            // Collect current metrics
            const metrics = await this.progressTracker.collectMetrics();
            // Evaluate violations
            const violations = await this.evaluateViolations(config, metrics);
            // Determine if gates passed
            const passed = this.determineGateStatus(config, violations);
            // Generate recommendations
            const recommendations = this.generateRecommendations(violations, metrics);
            // Assess deployment approval
            const deploymentApproved = this.assessDeploymentApproval(config, violations, metrics);
            // Calculate risk level
            const riskLevel = this.calculateRiskLevel(violations, metrics);
            const result = {
                gateName: config.name,
                passed,
                timestamp: new Date(),
                metrics,
                violations,
                recommendations,
                deploymentApproved,
                riskLevel,
            };
            // Save results
            this.saveQualityGateResult(result);
            logger_1.logger.info(`Quality gates evaluation completed:`, {
                passed,
                deploymentApproved,
                riskLevel,
                violationCount: violations.length,
            });
            return result;
        }
        catch (error) {
            logger_1.logger.error('Error evaluating quality gates:', error);
            throw error;
        }
    }
    /**
     * Assess deployment readiness
     */
    async assessDeploymentReadiness() {
        try {
            const gateResult = await this.evaluateQualityGates();
            const blockers = gateResult.violations
                .filter(v => v.type === 'blocker' || v.severity === 'critical')
                .map(v => v.message);
            const warnings = gateResult.violations
                .filter(v => v.type === 'warning' && v.severity !== 'critical')
                .map(v => v.message);
            const qualityScore = this.calculateQualityScore(gateResult.metrics);
            const confidence = this.calculateConfidence(gateResult);
            const riskAssessment = this.assessRisk(gateResult);
            const readiness = {
                ready: gateResult.deploymentApproved && blockers.length === 0,
                confidence,
                blockers,
                warnings,
                qualityScore,
                riskAssessment,
            };
            logger_1.logger.info('Deployment readiness assessment:', {
                ready: readiness.ready,
                confidence: readiness.confidence,
                qualityScore: readiness.qualityScore,
                riskLevel: readiness.riskAssessment.level,
            });
            return readiness;
        }
        catch (error) {
            logger_1.logger.error('Error assessing deployment readiness:', error);
            throw error;
        }
    }
    /**
     * Create CI/CD integration report
     */
    async createCICDReport() {
        try {
            const readiness = await this.assessDeploymentReadiness();
            const gateResult = await this.evaluateQualityGates();
            const report = {
                timestamp: new Date().toISOString(),
                deployment: {
                    approved: readiness.ready,
                    confidence: readiness.confidence,
                    qualityScore: readiness.qualityScore,
                },
                metrics: {
                    totalIssues: gateResult.metrics.totalIssues,
                    errors: gateResult.metrics.errors,
                    warnings: gateResult.metrics.warnings,
                    fixableIssues: gateResult.metrics.fixableIssues,
                },
                qualityGates: {
                    passed: gateResult.passed,
                    riskLevel: gateResult.riskLevel,
                    violationCount: gateResult.violations.length,
                },
                blockers: readiness.blockers,
                recommendations: gateResult.recommendations,
                performance: {
                    executionTime: gateResult.metrics.performanceMetrics.executionTime,
                    memoryUsage: gateResult.metrics.performanceMetrics.memoryUsage,
                    cacheHitRate: gateResult.metrics.performanceMetrics.cacheHitRate,
                },
            };
            // Save CI/CD report
            this.saveCICDReport(report);
            return report;
        }
        catch (error) {
            logger_1.logger.error('Error creating CI/CD report:', error);
            throw error;
        }
    }
    /**
     * Monitor quality trends
     */
    async monitorQualityTrends() {
        try {
            const history = this.getQualityGateHistory();
            if (history.length < 2) {
                return { trend: 'insufficient-data', message: 'Need more historical data' };
            }
            const recent = history.slice(-10); // Last 10 evaluations
            const trends = {
                errorTrend: this.calculateTrend(recent.map(r => r.metrics.errors)),
                warningTrend: this.calculateTrend(recent.map(r => r.metrics.warnings)),
                performanceTrend: this.calculateTrend(recent.map(r => r.metrics.performanceMetrics.executionTime)),
                qualityTrend: this.calculateTrend(recent.map(r => this.calculateQualityScore(r.metrics))),
            };
            const overallTrend = this.determineOverallTrend(trends);
            return {
                trend: overallTrend,
                trends,
                recommendations: this.generateTrendRecommendations(trends),
                alertLevel: this.calculateAlertLevel(trends),
            };
        }
        catch (error) {
            logger_1.logger.error('Error monitoring quality trends:', error);
            throw error;
        }
    }
    /**
     * Private methods
     */
    async evaluateViolations(config, metrics) {
        const violations = [];
        // Check error thresholds
        if (metrics.errors > config.thresholds.maxErrors) {
            violations.push({
                type: 'error',
                rule: 'max-errors-threshold',
                message: `${metrics.errors} errors exceed threshold of ${config.thresholds.maxErrors}`,
                severity: 'high',
                autoFixable: metrics.fixableIssues > 0,
            });
        }
        // Check warning thresholds
        if (metrics.warnings > config.thresholds.maxWarnings) {
            violations.push({
                type: 'warning',
                rule: 'max-warnings-threshold',
                message: `${metrics.warnings} warnings exceed threshold of ${config.thresholds.maxWarnings}`,
                severity: 'medium',
                autoFixable: metrics.fixableIssues > 0,
            });
        }
        // Check performance thresholds
        if (metrics.performanceMetrics.executionTime > config.thresholds.maxExecutionTime) {
            violations.push({
                type: 'performance',
                rule: 'max-execution-time',
                message: `Execution time ${metrics.performanceMetrics.executionTime}ms exceeds threshold`,
                severity: 'medium',
                autoFixable: false,
            });
        }
        // Check for blockers
        if (config.blockers.parserErrors) {
            const parserErrors = await this.checkForParserErrors();
            if (parserErrors.length > 0) {
                violations.push(...parserErrors.map(error => ({
                    type: 'blocker',
                    rule: 'parser-error',
                    message: error.message,
                    file: error.file,
                    line: error.line,
                    severity: 'critical',
                    autoFixable: false,
                })));
            }
        }
        return violations;
    }
    determineGateStatus(config, violations) {
        // Gates fail if there are any critical violations or blockers
        const criticalViolations = violations.filter(v => v.severity === 'critical' || v.type === 'blocker');
        return criticalViolations.length === 0;
    }
    generateRecommendations(violations, metrics) {
        const recommendations = [];
        if (violations.some(v => v.type === 'error')) {
            recommendations.push('Run automated error fixing tools to reduce error count');
        }
        if (metrics.fixableIssues > 0) {
            recommendations.push(`${metrics.fixableIssues} issues can be auto-fixed with ESLint --fix`);
        }
        if (violations.some(v => v.type === 'performance')) {
            recommendations.push('Consider optimizing linting performance with better caching');
        }
        if (violations.some(v => v.type === 'blocker')) {
            recommendations.push('Address critical blockers before attempting deployment');
        }
        return recommendations;
    }
    assessDeploymentApproval(config, violations, metrics) {
        // Deployment is approved if:
        // 1. No critical violations or blockers
        // 2. Error count is within acceptable limits
        // 3. No parser errors or other critical issues
        const criticalIssues = violations.filter(v => v.severity === 'critical' || v.type === 'blocker');
        const errorCountAcceptable = metrics.errors <= config.thresholds.maxErrors;
        return criticalIssues.length === 0 && errorCountAcceptable;
    }
    calculateRiskLevel(violations, metrics) {
        if (violations.some(v => v.severity === 'critical' || v.type === 'blocker')) {
            return 'critical';
        }
        if (metrics.errors > 50 || violations.filter(v => v.severity === 'high').length > 5) {
            return 'high';
        }
        if (metrics.errors > 10 || violations.filter(v => v.severity === 'medium').length > 10) {
            return 'medium';
        }
        return 'low';
    }
    calculateQualityScore(metrics) {
        // Quality score based on error count, warning count, and performance
        const errorPenalty = Math.min(50, metrics.errors * 2);
        const warningPenalty = Math.min(30, metrics.warnings * 0.1);
        const performancePenalty = Math.min(20, metrics.performanceMetrics.executionTime / 3000);
        return Math.max(0, 100 - errorPenalty - warningPenalty - performancePenalty);
    }
    calculateConfidence(gateResult) {
        let confidence = 100;
        // Reduce confidence based on violations
        confidence -= gateResult.violations.filter(v => v.severity === 'critical').length * 30;
        confidence -= gateResult.violations.filter(v => v.severity === 'high').length * 15;
        confidence -= gateResult.violations.filter(v => v.severity === 'medium').length * 5;
        // Increase confidence if many issues are auto-fixable
        const autoFixableRatio = gateResult.metrics.fixableIssues / Math.max(1, gateResult.metrics.totalIssues);
        confidence += autoFixableRatio * 20;
        return Math.max(0, Math.min(100, confidence));
    }
    assessRisk(gateResult) {
        const factors = [];
        const mitigation = [];
        if (gateResult.metrics.errors > 0) {
            factors.push(`${gateResult.metrics.errors} linting errors present`);
            mitigation.push('Run automated error fixing before deployment');
        }
        if (gateResult.violations.some(v => v.type === 'blocker')) {
            factors.push('Critical blockers detected');
            mitigation.push('Resolve all blocker issues immediately');
        }
        return {
            level: gateResult.riskLevel,
            factors,
            mitigation,
        };
    }
    async checkForParserErrors() {
        try {
            // This would check for TypeScript parser errors
            const result = (0, child_process_1.execSync)('yarn tsc --noEmit --skipLibCheck 2>&1 || true', {
                encoding: 'utf8',
            });
            const errors = [];
            // Parse TypeScript compiler output for parser errors
            const lines = result.split('\n');
            for (const line of lines) {
                if (line.includes('error TS') &&
                    (line.includes('Cannot find') || line.includes('Parse error'))) {
                    const match = line.match(/^(.+?)\((\d+),\d+\): error TS\d+: (.+)$/);
                    if (match) {
                        errors.push({
                            file: match[1],
                            line: parseInt(match[2]),
                            message: match[3],
                        });
                    }
                }
            }
            return errors;
        }
        catch (error) {
            logger_1.logger.warn('Error checking for parser errors:', error);
            return [];
        }
    }
    calculateTrend(values) {
        if (values.length < 2)
            return 'stable';
        const recent = values.slice(-5);
        const older = values.slice(-10, -5);
        if (older.length === 0)
            return 'stable';
        const recentAvg = recent.reduce((sum, val) => sum + val, 0) / recent.length;
        const olderAvg = older.reduce((sum, val) => sum + val, 0) / older.length;
        const change = (recentAvg - olderAvg) / olderAvg;
        if (change < -0.1)
            return 'improving';
        if (change > 0.1)
            return 'degrading';
        return 'stable';
    }
    determineOverallTrend(trends) {
        const trendValues = Object.values(trends);
        const improvingCount = trendValues.filter(t => t === 'improving').length;
        const degradingCount = trendValues.filter(t => t === 'degrading').length;
        if (improvingCount > degradingCount)
            return 'improving';
        if (degradingCount > improvingCount)
            return 'degrading';
        return 'stable';
    }
    generateTrendRecommendations(trends) {
        const recommendations = [];
        if (trends.errorTrend === 'degrading') {
            recommendations.push('Error count is increasing - investigate recent changes');
        }
        if (trends.performanceTrend === 'degrading') {
            recommendations.push('Linting performance is degrading - optimize configuration');
        }
        if (trends.qualityTrend === 'improving') {
            recommendations.push('Quality trend is positive - maintain current practices');
        }
        return recommendations;
    }
    calculateAlertLevel(trends) {
        const degradingCount = Object.values(trends).filter(t => t === 'degrading').length;
        if (degradingCount >= 3)
            return 'high';
        if (degradingCount >= 2)
            return 'medium';
        if (degradingCount >= 1)
            return 'low';
        return 'none';
    }
    getDefaultQualityGateConfig() {
        return {
            name: 'Standard Quality Gate',
            description: 'Standard quality gate for deployment approval',
            thresholds: {
                maxErrors: 0,
                maxWarnings: 100,
                maxExecutionTime: 60000,
                minCacheHitRate: 70,
                maxMemoryUsage: 512,
            },
            blockers: {
                parserErrors: true,
                typeScriptErrors: true,
                importErrors: true,
                securityIssues: true,
            },
            exemptions: {
                files: [],
                rules: [],
            },
        };
    }
    /**
     * Utility methods
     */
    ensureDirectoryExists() {
        try {
            (0, child_process_1.execSync)('mkdir -p .kiro/quality-gates', { stdio: 'pipe' });
        }
        catch (error) {
            // Directory might already exist
        }
    }
    saveQualityGateResult(result) {
        try {
            (0, fs_1.writeFileSync)(this.resultsFile, JSON.stringify(result, null, 2));
            // Also append to history
            const history = this.getQualityGateHistory();
            history.push(result);
            // Keep only last 50 entries
            const trimmedHistory = history.slice(-50);
            (0, fs_1.writeFileSync)(this.historyFile, JSON.stringify(trimmedHistory, null, 2));
        }
        catch (error) {
            logger_1.logger.error('Error saving quality gate result:', error);
        }
    }
    getQualityGateHistory() {
        try {
            if ((0, fs_1.existsSync)(this.historyFile)) {
                const data = (0, fs_1.readFileSync)(this.historyFile, 'utf8');
                return JSON.parse(data);
            }
        }
        catch (error) {
            logger_1.logger.warn('Error reading quality gate history:', error);
        }
        return [];
    }
    saveCICDReport(report) {
        try {
            const reportFile = `.kiro/quality-gates/cicd-report-${Date.now()}.json`;
            (0, fs_1.writeFileSync)(reportFile, JSON.stringify(report, null, 2));
        }
        catch (error) {
            logger_1.logger.error('Error saving CI/CD report:', error);
        }
    }
}
exports.LintingQualityGates = LintingQualityGates;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9zZXJ2aWNlcy9saW50aW5nL0xpbnRpbmdRdWFsaXR5R2F0ZXMudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7OztHQUtHOzs7QUFFSCxpREFBeUM7QUFDekMsMkJBQTZEO0FBRTdELDJDQUF3QztBQUV4QyxxRUFBa0Y7QUF1RWxGOztHQUVHO0FBQ0gsTUFBYSxtQkFBbUI7SUFDdEIsZUFBZSxDQUF5QjtJQUN4QyxVQUFVLEdBQUcsaUNBQWlDLENBQUM7SUFDL0MsV0FBVyxHQUFHLGtDQUFrQyxDQUFDO0lBQ2pELFdBQVcsR0FBRyxrQ0FBa0MsQ0FBQztJQUV6RDtRQUNFLElBQUksQ0FBQyxlQUFlLEdBQUcsSUFBSSwrQ0FBc0IsRUFBRSxDQUFDO1FBQ3BELElBQUksQ0FBQyxxQkFBcUIsRUFBRSxDQUFDO0lBQy9CLENBQUM7SUFFRDs7T0FFRztJQUNILEtBQUssQ0FBQyxvQkFBb0IsQ0FBQyxVQUE4QjtRQUN2RCxJQUFJO1lBQ0YsTUFBTSxNQUFNLEdBQUcsVUFBVSxJQUFJLElBQUksQ0FBQywyQkFBMkIsRUFBRSxDQUFDO1lBQ2hFLGVBQU0sQ0FBQyxJQUFJLENBQUMsNkJBQTZCLE1BQU0sQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDO1lBRXhELDBCQUEwQjtZQUMxQixNQUFNLE9BQU8sR0FBRyxNQUFNLElBQUksQ0FBQyxlQUFlLENBQUMsY0FBYyxFQUFFLENBQUM7WUFFNUQsc0JBQXNCO1lBQ3RCLE1BQU0sVUFBVSxHQUFHLE1BQU0sSUFBSSxDQUFDLGtCQUFrQixDQUFDLE1BQU0sRUFBRSxPQUFPLENBQUMsQ0FBQztZQUVsRSw0QkFBNEI7WUFDNUIsTUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLG1CQUFtQixDQUFDLE1BQU0sRUFBRSxVQUFVLENBQUMsQ0FBQztZQUU1RCwyQkFBMkI7WUFDM0IsTUFBTSxlQUFlLEdBQUcsSUFBSSxDQUFDLHVCQUF1QixDQUFDLFVBQVUsRUFBRSxPQUFPLENBQUMsQ0FBQztZ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Q0FBQztnQkFDcEQsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDO2FBQ3pCO1NBQ0Y7UUFBQyxPQUFPLEtBQUssRUFBRTtZQUNkLGVBQU0sQ0FBQyxJQUFJLENBQUMscUNBQXFDLEVBQUUsS0FBSyxDQUFDLENBQUM7U0FDM0Q7UUFDRCxPQUFPLEVBQUUsQ0FBQztJQUNaLENBQUM7SUFFTyxjQUFjLENBQUMsTUFBK0I7UUFDcEQsSUFBSTtZQUNGLE1BQU0sVUFBVSxHQUFHLG1DQUFtQyxJQUFJLENBQUMsR0FBRyxFQUFFLE9BQU8sQ0FBQztZQUN4RSxJQUFBLGtCQUFhLEVBQUMsVUFBVSxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsTUFBTSxFQUFFLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO1NBQzVEO1FBQUMsT0FBTyxLQUFLLEVBQUU7WUFDZCxlQUFNLENBQUMsS0FBSyxDQUFDLDRCQUE0QixFQUFFLEtBQUssQ0FBQyxDQUFDO1NBQ25EO0lBQ0gsQ0FBQztDQUNGO0FBdGlCRCxrREFzaUJDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9HcmVnQ2FzdHJvL0Rlc2t0b3AvV2hhdFRvRWF0TmV4dC9zcmMvc2VydmljZXMvbGludGluZy9MaW50aW5nUXVhbGl0eUdhdGVzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogTGludGluZyBRdWFsaXR5IEdhdGVzIFNlcnZpY2VcbiAqXG4gKiBJbXBsZW1lbnRzIHF1YWxpdHkgZ2F0ZXMgdGhhdCByZXF1aXJlIHplcm8gbGludGluZyBpc3N1ZXMgZm9yIGRlcGxveW1lbnRcbiAqIGFuZCBwcm92aWRlcyBjb21wcmVoZW5zaXZlIHF1YWxpdHkgYXNzZXNzbWVudCBmb3IgQ0kvQ0QgcGlwZWxpbmVzLlxuICovXG5cbmltcG9ydCB7IGV4ZWNTeW5jIH0gZnJvbSAnY2hpbGRfcHJvY2Vzcyc7XG5pbXBvcnQgeyB3cml0ZUZpbGVTeW5jLCByZWFkRmlsZVN5bmMsIGV4aXN0c1N5bmMgfSBmcm9tICdmcyc7XG5cbmltcG9ydCB7IGxvZ2dlciB9IGZyb20gJ0AvdXRpbHMvbG9nZ2VyJztcblxuaW1wb3J0IHsgTGludGluZ1Byb2dyZXNzVHJhY2tlciwgTGludGluZ01ldHJpY3MgfSBmcm9tICcuL0xpbnRpbmdQcm9ncmVzc1RyYWNrZXInO1xuXG4vKipcbiAqIFF1YWxpdHkgZ2F0ZSBjb25maWd1cmF0aW9uXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgUXVhbGl0eUdhdGVDb25maWcge1xuICBuYW1lOiBzdHJpbmc7XG4gIGRlc2NyaXB0aW9uOiBzdHJpbmc7XG4gIHRocmVzaG9sZHM6IHtcbiAgICBtYXhFcnJvcnM6IG51bWJlcjtcbiAgICBtYXhXYXJuaW5nczogbnVtYmVyO1xuICAgIG1heEV4ZWN1dGlvblRpbWU6IG51bWJlcjsgLy8gbWlsbGlzZWNvbmRzXG4gICAgbWluQ2FjaGVIaXRSYXRlOiBudW1iZXI7IC8vIHBlcmNlbnRhZ2VcbiAgICBtYXhNZW1vcnlVc2FnZTogbnVtYmVyOyAvLyBNQlxuICB9O1xuICBibG9ja2Vyczoge1xuICAgIHBhcnNlckVycm9yczogYm9vbGVhbjtcbiAgICB0eXBlU2NyaXB0RXJyb3JzOiBib29sZWFuO1xuICAgIGltcG9ydEVycm9yczogYm9vbGVhbjtcbiAgICBzZWN1cml0eUlzc3VlczogYm9vbGVhbjtcbiAgfTtcbiAgZXhlbXB0aW9uczoge1xuICAgIGZpbGVzOiBzdHJpbmdbXTtcbiAgICBydWxlczogc3RyaW5nW107XG4gICAgdGVtcG9yYXJ5VW50aWw/OiBEYXRlO1xuICB9O1xufVxuXG4vKipcbiAqIFF1YWxpdHkgZ2F0ZSByZXN1bHRcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBRdWFsaXR5R2F0ZVJlc3VsdCB7XG4gIGdhdGVOYW1lOiBzdHJpbmc7XG4gIHBhc3NlZDogYm9vbGVhbjtcbiAgdGltZXN0YW1wOiBEYXRlO1xuICBtZXRyaWNzOiBMaW50aW5nTWV0cmljcztcbiAgdmlvbGF0aW9uczogUXVhbGl0eVZpb2xhdGlvbltdO1xuICByZWNvbW1lbmRhdGlvbnM6IHN0cmluZ1tdO1xuICBkZXBsb3ltZW50QXBwcm92ZWQ6IGJvb2xlYW47XG4gIHJpc2tMZXZlbDogJ2xvdycgfCAnbWVkaXVtJyB8ICdoaWdoJyB8ICdjcml0aWNhbCc7XG59XG5cbi8qKlxuICogUXVhbGl0eSB2aW9sYXRpb25cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBRdWFsaXR5VmlvbGF0aW9uIHtcbiAgdHlwZTogJ2Vycm9yJyB8ICd3YXJuaW5nJyB8ICdwZXJmb3JtYW5jZScgfCAnYmxvY2tlcic7XG4gIHJ1bGU6IHN0cmluZztcbiAgbWVzc2FnZTogc3RyaW5nO1xuICBmaWxlPzogc3RyaW5nO1xuICBsaW5lPzogbnVtYmVyO1xuICBzZXZlcml0eTogJ2xvdycgfCAnbWVkaXVtJyB8ICdoaWdoJyB8ICdjcml0aWNhbCc7XG4gIGF1dG9GaXhhYmxlOiBib29sZWFuO1xufVxuXG4vKipcbiAqIERlcGxveW1lbnQgcmVhZGluZXNzIGFzc2Vzc21lbnRcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBEZXBsb3ltZW50UmVhZGluZXNzIHtcbiAgcmVhZHk6IGJvb2xlYW47XG4gIGNvbmZpZGVuY2U6IG51bWJlcjsgLy8gMC0xMDBcbiAgYmxvY2tlcnM6IHN0cmluZ1tdO1xuICB3YXJuaW5nczogc3RyaW5nW107XG4gIHF1YWxpdHlTY29yZTogbnVtYmVyOyAvLyAwLTEwMFxuICByaXNrQXNzZXNzbWVudDoge1xuICAgIGxldmVsOiAnbG93JyB8ICdtZWRpdW0nIHwgJ2hpZ2gnIHwgJ2NyaXRpY2FsJztcbiAgICBmYWN0b3JzOiBzdHJpbmdbXTtcbiAgICBtaXRpZ2F0aW9uOiBzdHJpbmdbXTtcbiAgfTtcbn1cblxuLyoqXG4gKiBMaW50aW5nIFF1YWxpdHkgR2F0ZXMgU2VydmljZVxuICovXG5leHBvcnQgY2xhc3MgTGludGluZ1F1YWxpdHlHYXRlcyB7XG4gIHByaXZhdGUgcHJvZ3Jlc3NUcmFja2VyOiBMaW50aW5nUHJvZ3Jlc3NUcmFja2VyO1xuICBwcml2YXRlIGNvbmZpZ0ZpbGUgPSAnLmtpcm8vcXVhbGl0eS1nYXRlcy9jb25maWcuanNvbic7XG4gIHByaXZhdGUgcmVzdWx0c0ZpbGUgPSAnLmtpcm8vcXVhbGl0eS1nYXRlcy9yZXN1bHRzLmpzb24nO1xuICBwcml2YXRlIGhpc3RvcnlGaWxlID0gJy5raXJvL3F1YWxpdHktZ2F0ZXMvaGlzdG9yeS5qc29uJztcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLnByb2dyZXNzVHJhY2tlciA9IG5ldyBMaW50aW5nUHJvZ3Jlc3NUcmFja2VyKCk7XG4gICAgdGhpcy5lbnN1cmVEaXJlY3RvcnlFeGlzdHMoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBFdmFsdWF0ZSBxdWFsaXR5IGdhdGVzIGZvciBkZXBsb3ltZW50XG4gICAqL1xuICBhc3luYyBldmFsdWF0ZVF1YWxpdHlHYXRlcyhnYXRlQ29uZmlnPzogUXVhbGl0eUdhdGVDb25maWcpOiBQcm9taXNlPFF1YWxpdHlHYXRlUmVzdWx0PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGNvbmZpZyA9IGdhdGVDb25maWcgfHwgdGhpcy5nZXREZWZhdWx0UXVhbGl0eUdhdGVDb25maWcoKTtcbiAgICAgIGxvZ2dlci5pbmZvKGBFdmFsdWF0aW5nIHF1YWxpdHkgZ2F0ZXM6ICR7Y29uZmlnLm5hbWV9YCk7XG5cbiAgICAgIC8vIENvbGxlY3QgY3VycmVudCBtZXRyaWNzXG4gICAgICBjb25zdCBtZXRyaWNzID0gYXdhaXQgdGhpcy5wcm9ncmVzc1RyYWNrZXIuY29sbGVjdE1ldHJpY3MoKTtcblxuICAgICAgLy8gRXZhbHVhdGUgdmlvbGF0aW9uc1xuICAgICAgY29uc3QgdmlvbGF0aW9ucyA9IGF3YWl0IHRoaXMuZXZhbHVhdGVWaW9sYXRpb25zKGNvbmZpZywgbWV0cmljcyk7XG5cbiAgICAgIC8vIERldGVybWluZSBpZiBnYXRlcyBwYXNzZWRcbiAgICAgIGNvbnN0IHBhc3NlZCA9IHRoaXMuZGV0ZXJtaW5lR2F0ZVN0YXR1cyhjb25maWcsIHZpb2xhdGlvbnMpO1xuXG4gICAgICAvLyBHZW5lcmF0ZSByZWNvbW1lbmRhdGlvbnNcbiAgICAgIGNvbnN0IHJlY29tbWVuZGF0aW9ucyA9IHRoaXMuZ2VuZXJhdGVSZWNvbW1lbmRhdGlvbnModmlvbGF0aW9ucywgbWV0cmljcyk7XG5cbiAgICAgIC8vIEFzc2VzcyBkZXBsb3ltZW50IGFwcHJvdmFsXG4gICAgICBjb25zdCBkZXBsb3ltZW50QXBwcm92ZWQgPSB0aGlzLmFzc2Vzc0RlcGxveW1lbnRBcHByb3ZhbChjb25maWcsIHZpb2xhdGlvbnMsIG1ldHJpY3MpO1xuXG4gICAgICAvLyBDYWxjdWxhdGUgcmlzayBsZXZlbFxuICAgICAgY29uc3Qgcmlza0xldmVsID0gdGhpcy5jYWxjdWxhdGVSaXNrTGV2ZWwodmlvbGF0aW9ucywgbWV0cmljcyk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdDogUXVhbGl0eUdhdGVSZXN1bHQgPSB7XG4gICAgICAgIGdhdGVOYW1lOiBjb25maWcubmFtZSxcbiAgICAgICAgcGFzc2VkLFxuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAgICAgIG1ldHJpY3MsXG4gICAgICAgIHZpb2xhdGlvbnMsXG4gICAgICAgIHJlY29tbWVuZGF0aW9ucyxcbiAgICAgICAgZGVwbG95bWVudEFwcHJvdmVkLFxuICAgICAgICByaXNrTGV2ZWwsXG4gICAgICB9O1xuXG4gICAgICAvLyBTYXZlIHJlc3VsdHNcbiAgICAgIHRoaXMuc2F2ZVF1YWxpdHlHYXRlUmVzdWx0KHJlc3VsdCk7XG5cbiAgICAgIGxvZ2dlci5pbmZvKGBRdWFsaXR5IGdhdGVzIGV2YWx1YXRpb24gY29tcGxldGVkOmAsIHtcbiAgICAgICAgcGFzc2VkLFxuICAgICAgICBkZXBsb3ltZW50QXBwcm92ZWQsXG4gICAgICAgIHJpc2tMZXZlbCxcbiAgICAgICAgdmlvbGF0aW9uQ291bnQ6IHZpb2xhdGlvbnMubGVuZ3RoLFxuICAgICAgfSk7XG5cbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignRXJyb3IgZXZhbHVhdGluZyBxdWFsaXR5IGdhdGVzOicsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBBc3Nlc3MgZGVwbG95bWVudCByZWFkaW5lc3NcbiAgICovXG4gIGFzeW5jIGFzc2Vzc0RlcGxveW1lbnRSZWFkaW5lc3MoKTogUHJvbWlzZTxEZXBsb3ltZW50UmVhZGluZXNzPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGdhdGVSZXN1bHQgPSBhd2FpdCB0aGlzLmV2YWx1YXRlUXVhbGl0eUdhdGVzKCk7XG5cbiAgICAgIGNvbnN0IGJsb2NrZXJzID0gZ2F0ZVJlc3VsdC52aW9sYXRpb25zXG4gICAgICAgIC5maWx0ZXIodiA9PiB2LnR5cGUgPT09ICdibG9ja2VyJyB8fCB2LnNldmVyaXR5ID09PSAnY3JpdGljYWwnKVxuICAgICAgICAubWFwKHYgPT4gdi5tZXNzYWdlKTtcblxuICAgICAgY29uc3Qgd2FybmluZ3MgPSBnYXRlUmVzdWx0LnZpb2xhdGlvbnNcbiAgICAgICAgLmZpbHRlcih2ID0+IHYudHlwZSA9PT0gJ3dhcm5pbmcnICYmIHYuc2V2ZXJpdHkgIT09ICdjcml0aWNhbCcpXG4gICAgICAgIC5tYXAodiA9PiB2Lm1lc3NhZ2UpO1xuXG4gICAgICBjb25zdCBxdWFsaXR5U2NvcmUgPSB0aGlzLmNhbGN1bGF0ZVF1YWxpdHlTY29yZShnYXRlUmVzdWx0Lm1ldHJpY3MpO1xuICAgICAgY29uc3QgY29uZmlkZW5jZSA9IHRoaXMuY2FsY3VsYXRlQ29uZmlkZW5jZShnYXRlUmVzdWx0KTtcblxuICAgICAgY29uc3Qgcmlza0Fzc2Vzc21lbnQgPSB0aGlzLmFzc2Vzc1Jpc2soZ2F0ZVJlc3VsdCk7XG5cbiAgICAgIGNvbnN0IHJlYWRpbmVzczogRGVwbG95bWVudFJlYWRpbmVzcyA9IHtcbiAgICAgICAgcmVhZHk6IGdhdGVSZXN1bHQuZGVwbG95bWVudEFwcHJvdmVkICYmIGJsb2NrZXJzLmxlbmd0aCA9PT0gMCxcbiAgICAgICAgY29uZmlkZW5jZSxcbiAgICAgICAgYmxvY2tlcnMsXG4gICAgICAgIHdhcm5pbmdzLFxuICAgICAgICBxdWFsaXR5U2NvcmUsXG4gICAgICAgIHJpc2tBc3Nlc3NtZW50LFxuICAgICAgfTtcblxuICAgICAgbG9nZ2VyLmluZm8oJ0RlcGxveW1lbnQgcmVhZGluZXNzIGFzc2Vzc21lbnQ6Jywge1xuICAgICAgICByZWFkeTogcmVhZGluZXNzLnJlYWR5LFxuICAgICAgICBjb25maWRlbmNlOiByZWFkaW5lc3MuY29uZmlkZW5jZSxcbiAgICAgICAgcXVhbGl0eVNjb3JlOiByZWFkaW5lc3MucXVhbGl0eVNjb3JlLFxuICAgICAgICByaXNrTGV2ZWw6IHJlYWRpbmVzcy5yaXNrQXNzZXNzbWVudC5sZXZlbCxcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4gcmVhZGluZXNzO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ0Vycm9yIGFzc2Vzc2luZyBkZXBsb3ltZW50IHJlYWRpbmVzczonLCBlcnJvcik7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIENJL0NEIGludGVncmF0aW9uIHJlcG9ydFxuICAgKi9cbiAgYXN5bmMgY3JlYXRlQ0lDRFJlcG9ydCgpOiBQcm9taXNlPHtcbiAgICB0aW1lc3RhbXA6IHN0cmluZztcbiAgICBkZXBsb3ltZW50OiB7IGFwcHJvdmVkOiBib29sZWFuOyBjb25maWRlbmNlOiBudW1iZXI7IHF1YWxpdHlTY29yZTogbnVtYmVyIH07XG4gICAgZ2F0ZXM6IFF1YWxpdHlHYXRlUmVzdWx0O1xuICAgIGlzc3Vlcz86IHN0cmluZ1tdO1xuICAgIHJpc2tzPzogdW5rbm93bjtcbiAgICB0cmVuZHM/OiB1bmtub3duO1xuICAgIHJlY29tbWVuZGF0aW9ucz86IHN0cmluZ1tdO1xuICB9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlYWRpbmVzcyA9IGF3YWl0IHRoaXMuYXNzZXNzRGVwbG95bWVudFJlYWRpbmVzcygpO1xuICAgICAgY29uc3QgZ2F0ZVJlc3VsdCA9IGF3YWl0IHRoaXMuZXZhbHVhdGVRdWFsaXR5R2F0ZXMoKTtcblxuICAgICAgY29uc3QgcmVwb3J0ID0ge1xuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgZGVwbG95bWVudDoge1xuICAgICAgICAgIGFwcHJvdmVkOiByZWFkaW5lc3MucmVhZHksXG4gICAgICAgICAgY29uZmlkZW5jZTogcmVhZGluZXNzLmNvbmZpZGVuY2UsXG4gICAgICAgICAgcXVhbGl0eVNjb3JlOiByZWFkaW5lc3MucXVhbGl0eVNjb3JlLFxuICAgICAgICB9LFxuICAgICAgICBtZXRyaWNzOiB7XG4gICAgICAgICAgdG90YWxJc3N1ZXM6IGdhdGVSZXN1bHQubWV0cmljcy50b3RhbElzc3VlcyxcbiAgICAgICAgICBlcnJvcnM6IGdhdGVSZXN1bHQubWV0cmljcy5lcnJvcnMsXG4gICAgICAgICAgd2FybmluZ3M6IGdhdGVSZXN1bHQubWV0cmljcy53YXJuaW5ncyxcbiAgICAgICAgICBmaXhhYmxlSXNzdWVzOiBnYXRlUmVzdWx0Lm1ldHJpY3MuZml4YWJsZUlzc3VlcyxcbiAgICAgICAgfSxcbiAgICAgICAgcXVhbGl0eUdhdGVzOiB7XG4gICAgICAgICAgcGFzc2VkOiBnYXRlUmVzdWx0LnBhc3NlZCxcbiAgICAgICAgICByaXNrTGV2ZWw6IGdhdGVSZXN1bHQucmlza0xldmVsLFxuICAgICAgICAgIHZpb2xhdGlvbkNvdW50OiBnYXRlUmVzdWx0LnZpb2xhdGlvbnMubGVuZ3RoLFxuICAgICAgICB9LFxuICAgICAgICBibG9ja2VyczogcmVhZGluZXNzLmJsb2NrZXJzLFxuICAgICAgICByZWNvbW1lbmRhdGlvbnM6IGdhdGVSZXN1bHQucmVjb21tZW5kYXRpb25zLFxuICAgICAgICBwZXJmb3JtYW5jZToge1xuICAgICAgICAgIGV4ZWN1dGlvblRpbWU6IGdhdGVSZXN1bHQubWV0cmljcy5wZXJmb3JtYW5jZU1ldHJpY3MuZXhlY3V0aW9uVGltZSxcbiAgICAgICAgICBtZW1vcnlVc2FnZTogZ2F0ZVJlc3VsdC5tZXRyaWNzLnBlcmZvcm1hbmNlTWV0cmljcy5tZW1vcnlVc2FnZSxcbiAgICAgICAgICBjYWNoZUhpdFJhdGU6IGdhdGVSZXN1bHQubWV0cmljcy5wZXJmb3JtYW5jZU1ldHJpY3MuY2FjaGVIaXRSYXRlLFxuICAgICAgICB9LFxuICAgICAgfTtcblxuICAgICAgLy8gU2F2ZSBDSS9DRCByZXBvcnRcbiAgICAgIHRoaXMuc2F2ZUNJQ0RSZXBvcnQocmVwb3J0KTtcblxuICAgICAgcmV0dXJuIHJlcG9ydDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdFcnJvciBjcmVhdGluZyBDSS9DRCByZXBvcnQ6JywgZXJyb3IpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIE1vbml0b3IgcXVhbGl0eSB0cmVuZHNcbiAgICovXG4gIGFzeW5jIG1vbml0b3JRdWFsaXR5VHJlbmRzKCk6IFByb21pc2U8e1xuICAgIHRyZW5kczogUmVjb3JkPHN0cmluZywgdW5rbm93bj47XG4gICAgb3ZlcmFsbFRyZW5kOiAnaW1wcm92aW5nJyB8ICdzdGFibGUnIHwgJ2RlZ3JhZGluZyc7XG4gICAgcmVjb21tZW5kYXRpb25zOiBzdHJpbmdbXTtcbiAgICBhbGVydExldmVsOiAnbm9uZScgfCAnbG93JyB8ICdtZWRpdW0nIHwgJ2hpZ2gnO1xuICB9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGhpc3RvcnkgPSB0aGlzLmdldFF1YWxpdHlHYXRlSGlzdG9yeSgpO1xuICAgICAgaWYgKGhpc3RvcnkubGVuZ3RoIDwgMikge1xuICAgICAgICByZXR1cm4geyB0cmVuZDogJ2luc3VmZmljaWVudC1kYXRhJywgbWVzc2FnZTogJ05lZWQgbW9yZSBoaXN0b3JpY2FsIGRhdGEnIH07XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHJlY2VudCA9IGhpc3Rvcnkuc2xpY2UoLTEwKTsgLy8gTGFzdCAxMCBldmFsdWF0aW9uc1xuICAgICAgY29uc3QgdHJlbmRzID0ge1xuICAgICAgICBlcnJvclRyZW5kOiB0aGlzLmNhbGN1bGF0ZVRyZW5kKHJlY2VudC5tYXAociA9PiByLm1ldHJpY3MuZXJyb3JzKSksXG4gICAgICAgIHdhcm5pbmdUcmVuZDogdGhpcy5jYWxjdWxhdGVUcmVuZChyZWNlbnQubWFwKHIgPT4gci5tZXRyaWNzLndhcm5pbmdzKSksXG4gICAgICAgIHBlcmZvcm1hbmNlVHJlbmQ6IHRoaXMuY2FsY3VsYXRlVHJlbmQoXG4gICAgICAgICAgcmVjZW50Lm1hcChyID0+IHIubWV0cmljcy5wZXJmb3JtYW5jZU1ldHJpY3MuZXhlY3V0aW9uVGltZSksXG4gICAgICAgICksXG4gICAgICAgIHF1YWxpdHlUcmVuZDogdGhpcy5jYWxjdWxhdGVUcmVuZChyZWNlbnQubWFwKHIgPT4gdGhpcy5jYWxjdWxhdGVRdWFsaXR5U2NvcmUoci5tZXRyaWNzKSkpLFxuICAgICAgfTtcblxuICAgICAgY29uc3Qgb3ZlcmFsbFRyZW5kID0gdGhpcy5kZXRlcm1pbmVPdmVyYWxsVHJlbmQodHJlbmRzKTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdHJlbmQ6IG92ZXJhbGxUcmVuZCxcbiAgICAgICAgdHJlbmRzLFxuICAgICAgICByZWNvbW1lbmRhdGlvbnM6IHRoaXMuZ2VuZXJhdGVUcmVuZFJlY29tbWVuZGF0aW9ucyh0cmVuZHMpLFxuICAgICAgICBhbGVydExldmVsOiB0aGlzLmNhbGN1bGF0ZUFsZXJ0TGV2ZWwodHJlbmRzKSxcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignRXJyb3IgbW9uaXRvcmluZyBxdWFsaXR5IHRyZW5kczonLCBlcnJvcik7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUHJpdmF0ZSBtZXRob2RzXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGV2YWx1YXRlVmlvbGF0aW9ucyhcbiAgICBjb25maWc6IFF1YWxpdHlHYXRlQ29uZmlnLFxuICAgIG1ldHJpY3M6IExpbnRpbmdNZXRyaWNzLFxuICApOiBQcm9taXNlPFF1YWxpdHlWaW9sYXRpb25bXT4ge1xuICAgIGNvbnN0IHZpb2xhdGlvbnM6IFF1YWxpdHlWaW9sYXRpb25bXSA9IFtdO1xuXG4gICAgLy8gQ2hlY2sgZXJyb3IgdGhyZXNob2xkc1xuICAgIGlmIChtZXRyaWNzLmVycm9ycyA+IGNvbmZpZy50aHJlc2hvbGRzLm1heEVycm9ycykge1xuICAgICAgdmlvbGF0aW9ucy5wdXNoKHtcbiAgICAgICAgdHlwZTogJ2Vycm9yJyxcbiAgICAgICAgcnVsZTogJ21heC1lcnJvcnMtdGhyZXNob2xkJyxcbiAgICAgICAgbWVzc2FnZTogYCR7bWV0cmljcy5lcnJvcnN9IGVycm9ycyBleGNlZWQgdGhyZXNob2xkIG9mICR7Y29uZmlnLnRocmVzaG9sZHMubWF4RXJyb3JzfWAsXG4gICAgICAgIHNldmVyaXR5OiAnaGlnaCcsXG4gICAgICAgIGF1dG9GaXhhYmxlOiBtZXRyaWNzLmZpeGFibGVJc3N1ZXMgPiAwLFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgd2FybmluZyB0aHJlc2hvbGRzXG4gICAgaWYgKG1ldHJpY3Mud2FybmluZ3MgPiBjb25maWcudGhyZXNob2xkcy5tYXhXYXJuaW5ncykge1xuICAgICAgdmlvbGF0aW9ucy5wdXNoKHtcbiAgICAgICAgdHlwZTogJ3dhcm5pbmcnLFxuICAgICAgICBydWxlOiAnbWF4LXdhcm5pbmdzLXRocmVzaG9sZCcsXG4gICAgICAgIG1lc3NhZ2U6IGAke21ldHJpY3Mud2FybmluZ3N9IHdhcm5pbmdzIGV4Y2VlZCB0aHJlc2hvbGQgb2YgJHtjb25maWcudGhyZXNob2xkcy5tYXhXYXJuaW5nc31gLFxuICAgICAgICBzZXZlcml0eTogJ21lZGl1bScsXG4gICAgICAgIGF1dG9GaXhhYmxlOiBtZXRyaWNzLmZpeGFibGVJc3N1ZXMgPiAwLFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgcGVyZm9ybWFuY2UgdGhyZXNob2xkc1xuICAgIGlmIChtZXRyaWNzLnBlcmZvcm1hbmNlTWV0cmljcy5leGVjdXRpb25UaW1lID4gY29uZmlnLnRocmVzaG9sZHMubWF4RXhlY3V0aW9uVGltZSkge1xuICAgICAgdmlvbGF0aW9ucy5wdXNoKHtcbiAgICAgICAgdHlwZTogJ3BlcmZvcm1hbmNlJyxcbiAgICAgICAgcnVsZTogJ21heC1leGVjdXRpb24tdGltZScsXG4gICAgICAgIG1lc3NhZ2U6IGBFeGVjdXRpb24gdGltZSAke21ldHJpY3MucGVyZm9ybWFuY2VNZXRyaWNzLmV4ZWN1dGlvblRpbWV9bXMgZXhjZWVkcyB0aHJlc2hvbGRgLFxuICAgICAgICBzZXZlcml0eTogJ21lZGl1bScsXG4gICAgICAgIGF1dG9GaXhhYmxlOiBmYWxzZSxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIENoZWNrIGZvciBibG9ja2Vyc1xuICAgIGlmIChjb25maWcuYmxvY2tlcnMucGFyc2VyRXJyb3JzKSB7XG4gICAgICBjb25zdCBwYXJzZXJFcnJvcnMgPSBhd2FpdCB0aGlzLmNoZWNrRm9yUGFyc2VyRXJyb3JzKCk7XG4gICAgICBpZiAocGFyc2VyRXJyb3JzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgdmlvbGF0aW9ucy5wdXNoKFxuICAgICAgICAgIC4uLnBhcnNlckVycm9ycy5tYXAoZXJyb3IgPT4gKHtcbiAgICAgICAgICAgIHR5cGU6ICdibG9ja2VyJyBhcyBjb25zdCxcbiAgICAgICAgICAgIHJ1bGU6ICdwYXJzZXItZXJyb3InLFxuICAgICAgICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSxcbiAgICAgICAgICAgIGZpbGU6IGVycm9yLmZpbGUsXG4gICAgICAgICAgICBsaW5lOiBlcnJvci5saW5lLFxuICAgICAgICAgICAgc2V2ZXJpdHk6ICdjcml0aWNhbCcgYXMgY29uc3QsXG4gICAgICAgICAgICBhdXRvRml4YWJsZTogZmFsc2UsXG4gICAgICAgICAgfSkpLFxuICAgICAgICApO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB2aW9sYXRpb25zO1xuICB9XG5cbiAgcHJpdmF0ZSBkZXRlcm1pbmVHYXRlU3RhdHVzKGNvbmZpZzogUXVhbGl0eUdhdGVDb25maWcsIHZpb2xhdGlvbnM6IFF1YWxpdHlWaW9sYXRpb25bXSk6IGJvb2xlYW4ge1xuICAgIC8vIEdhdGVzIGZhaWwgaWYgdGhlcmUgYXJlIGFueSBjcml0aWNhbCB2aW9sYXRpb25zIG9yIGJsb2NrZXJzXG4gICAgY29uc3QgY3JpdGljYWxWaW9sYXRpb25zID0gdmlvbGF0aW9ucy5maWx0ZXIoXG4gICAgICB2ID0+IHYuc2V2ZXJpdHkgPT09ICdjcml0aWNhbCcgfHwgdi50eXBlID09PSAnYmxvY2tlcicsXG4gICAgKTtcbiAgICByZXR1cm4gY3JpdGljYWxWaW9sYXRpb25zLmxlbmd0aCA9PT0gMDtcbiAgfVxuXG4gIHByaXZhdGUgZ2VuZXJhdGVSZWNvbW1lbmRhdGlvbnMoXG4gICAgdmlvbGF0aW9uczogUXVhbGl0eVZpb2xhdGlvbltdLFxuICAgIG1ldHJpY3M6IExpbnRpbmdNZXRyaWNzLFxuICApOiBzdHJpbmdbXSB7XG4gICAgY29uc3QgcmVjb21tZW5kYXRpb25zOiBzdHJpbmdbXSA9IFtdO1xuXG4gICAgaWYgKHZpb2xhdGlvbnMuc29tZSh2ID0+IHYudHlwZSA9PT0gJ2Vycm9yJykpIHtcbiAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKCdSdW4gYXV0b21hdGVkIGVycm9yIGZpeGluZyB0b29scyB0byByZWR1Y2UgZXJyb3IgY291bnQnKTtcbiAgICB9XG5cbiAgICBpZiAobWV0cmljcy5maXhhYmxlSXNzdWVzID4gMCkge1xuICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goYCR7bWV0cmljcy5maXhhYmxlSXNzdWVzfSBpc3N1ZXMgY2FuIGJlIGF1dG8tZml4ZWQgd2l0aCBFU0xpbnQgLS1maXhgKTtcbiAgICB9XG5cbiAgICBpZiAodmlvbGF0aW9ucy5zb21lKHYgPT4gdi50eXBlID09PSAncGVyZm9ybWFuY2UnKSkge1xuICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goJ0NvbnNpZGVyIG9wdGltaXppbmcgbGludGluZyBwZXJmb3JtYW5jZSB3aXRoIGJldHRlciBjYWNoaW5nJyk7XG4gICAgfVxuXG4gICAgaWYgKHZpb2xhdGlvbnMuc29tZSh2ID0+IHYudHlwZSA9PT0gJ2Jsb2NrZXInKSkge1xuICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goJ0FkZHJlc3MgY3JpdGljYWwgYmxvY2tlcnMgYmVmb3JlIGF0dGVtcHRpbmcgZGVwbG95bWVudCcpO1xuICAgIH1cblxuICAgIHJldHVybiByZWNvbW1lbmRhdGlvbnM7XG4gIH1cblxuICBwcml2YXRlIGFzc2Vzc0RlcGxveW1lbnRBcHByb3ZhbChcbiAgICBjb25maWc6IFF1YWxpdHlHYXRlQ29uZmlnLFxuICAgIHZpb2xhdGlvbnM6IFF1YWxpdHlWaW9sYXRpb25bXSxcbiAgICBtZXRyaWNzOiBMaW50aW5nTWV0cmljcyxcbiAgKTogYm9vbGVhbiB7XG4gICAgLy8gRGVwbG95bWVudCBpcyBhcHByb3ZlZCBpZjpcbiAgICAvLyAxLiBObyBjcml0aWNhbCB2aW9sYXRpb25zIG9yIGJsb2NrZXJzXG4gICAgLy8gMi4gRXJyb3IgY291bnQgaXMgd2l0aGluIGFjY2VwdGFibGUgbGltaXRzXG4gICAgLy8gMy4gTm8gcGFyc2VyIGVycm9ycyBvciBvdGhlciBjcml0aWNhbCBpc3N1ZXNcblxuICAgIGNvbnN0IGNyaXRpY2FsSXNzdWVzID0gdmlvbGF0aW9ucy5maWx0ZXIoXG4gICAgICB2ID0+IHYuc2V2ZXJpdHkgPT09ICdjcml0aWNhbCcgfHwgdi50eXBlID09PSAnYmxvY2tlcicsXG4gICAgKTtcbiAgICBjb25zdCBlcnJvckNvdW50QWNjZXB0YWJsZSA9IG1ldHJpY3MuZXJyb3JzIDw9IGNvbmZpZy50aHJlc2hvbGRzLm1heEVycm9ycztcblxuICAgIHJldHVybiBjcml0aWNhbElzc3Vlcy5sZW5ndGggPT09IDAgJiYgZXJyb3JDb3VudEFjY2VwdGFibGU7XG4gIH1cblxuICBwcml2YXRlIGNhbGN1bGF0ZVJpc2tMZXZlbChcbiAgICB2aW9sYXRpb25zOiBRdWFsaXR5VmlvbGF0aW9uW10sXG4gICAgbWV0cmljczogTGludGluZ01ldHJpY3MsXG4gICk6ICdsb3cnIHwgJ21lZGl1bScgfCAnaGlnaCcgfCAnY3JpdGljYWwnIHtcbiAgICBpZiAodmlvbGF0aW9ucy5zb21lKHYgPT4gdi5zZXZlcml0eSA9PT0gJ2NyaXRpY2FsJyB8fCB2LnR5cGUgPT09ICdibG9ja2VyJykpIHtcbiAgICAgIHJldHVybiAnY3JpdGljYWwnO1xuICAgIH1cblxuICAgIGlmIChtZXRyaWNzLmVycm9ycyA+IDUwIHx8IHZpb2xhdGlvbnMuZmlsdGVyKHYgPT4gdi5zZXZlcml0eSA9PT0gJ2hpZ2gnKS5sZW5ndGggPiA1KSB7XG4gICAgICByZXR1cm4gJ2hpZ2gnO1xuICAgIH1cblxuICAgIGlmIChtZXRyaWNzLmVycm9ycyA+IDEwIHx8IHZpb2xhdGlvbnMuZmlsdGVyKHYgPT4gdi5zZXZlcml0eSA9PT0gJ21lZGl1bScpLmxlbmd0aCA+IDEwKSB7XG4gICAgICByZXR1cm4gJ21lZGl1bSc7XG4gICAgfVxuXG4gICAgcmV0dXJuICdsb3cnO1xuICB9XG5cbiAgcHJpdmF0ZSBjYWxjdWxhdGVRdWFsaXR5U2NvcmUobWV0cmljczogTGludGluZ01ldHJpY3MpOiBudW1iZXIge1xuICAgIC8vIFF1YWxpdHkgc2NvcmUgYmFzZWQgb24gZXJyb3IgY291bnQsIHdhcm5pbmcgY291bnQsIGFuZCBwZXJmb3JtYW5jZVxuICAgIGNvbnN0IGVycm9yUGVuYWx0eSA9IE1hdGgubWluKDUwLCBtZXRyaWNzLmVycm9ycyAqIDIpO1xuICAgIGNvbnN0IHdhcm5pbmdQZW5hbHR5ID0gTWF0aC5taW4oMzAsIG1ldHJpY3Mud2FybmluZ3MgKiAwLjEpO1xuICAgIGNvbnN0IHBlcmZvcm1hbmNlUGVuYWx0eSA9IE1hdGgubWluKDIwLCBtZXRyaWNzLnBlcmZvcm1hbmNlTWV0cmljcy5leGVjdXRpb25UaW1lIC8gMzAwMCk7XG5cbiAgICByZXR1cm4gTWF0aC5tYXgoMCwgMTAwIC0gZXJyb3JQZW5hbHR5IC0gd2FybmluZ1BlbmFsdHkgLSBwZXJmb3JtYW5jZVBlbmFsdHkpO1xuICB9XG5cbiAgcHJpdmF0ZSBjYWxjdWxhdGVDb25maWRlbmNlKGdhdGVSZXN1bHQ6IFF1YWxpdHlHYXRlUmVzdWx0KTogbnVtYmVyIHtcbiAgICBsZXQgY29uZmlkZW5jZSA9IDEwMDtcblxuICAgIC8vIFJlZHVjZSBjb25maWRlbmNlIGJhc2VkIG9uIHZpb2xhdGlvbnNcbiAgICBjb25maWRlbmNlIC09IGdhdGVSZXN1bHQudmlvbGF0aW9ucy5maWx0ZXIodiA9PiB2LnNldmVyaXR5ID09PSAnY3JpdGljYWwnKS5sZW5ndGggKiAzMDtcbiAgICBjb25maWRlbmNlIC09IGdhdGVSZXN1bHQudmlvbGF0aW9ucy5maWx0ZXIodiA9PiB2LnNldmVyaXR5ID09PSAnaGlnaCcpLmxlbmd0aCAqIDE1O1xuICAgIGNvbmZpZGVuY2UgLT0gZ2F0ZVJlc3VsdC52aW9sYXRpb25zLmZpbHRlcih2ID0+IHYuc2V2ZXJpdHkgPT09ICdtZWRpdW0nKS5sZW5ndGggKiA1O1xuXG4gICAgLy8gSW5jcmVhc2UgY29uZmlkZW5jZSBpZiBtYW55IGlzc3VlcyBhcmUgYXV0by1maXhhYmxlXG4gICAgY29uc3QgYXV0b0ZpeGFibGVSYXRpbyA9XG4gICAgICBnYXRlUmVzdWx0Lm1ldHJpY3MuZml4YWJsZUlzc3VlcyAvIE1hdGgubWF4KDEsIGdhdGVSZXN1bHQubWV0cmljcy50b3RhbElzc3Vlcyk7XG4gICAgY29uZmlkZW5jZSArPSBhdXRvRml4YWJsZVJhdGlvICogMjA7XG5cbiAgICByZXR1cm4gTWF0aC5tYXgoMCwgTWF0aC5taW4oMTAwLCBjb25maWRlbmNlKSk7XG4gIH1cblxuICBwcml2YXRlIGFzc2Vzc1Jpc2soZ2F0ZVJlc3VsdDogUXVhbGl0eUdhdGVSZXN1bHQpOiB7XG4gICAgbGV2ZWw6ICdsb3cnIHwgJ21lZGl1bScgfCAnaGlnaCcgfCAnY3JpdGljYWwnO1xuICAgIGZhY3RvcnM6IHN0cmluZ1tdO1xuICAgIG1pdGlnYXRpb25zOiBzdHJpbmdbXTtcbiAgfSB7XG4gICAgY29uc3QgZmFjdG9yczogc3RyaW5nW10gPSBbXTtcbiAgICBjb25zdCBtaXRpZ2F0aW9uOiBzdHJpbmdbXSA9IFtdO1xuXG4gICAgaWYgKGdhdGVSZXN1bHQubWV0cmljcy5lcnJvcnMgPiAwKSB7XG4gICAgICBmYWN0b3JzLnB1c2goYCR7Z2F0ZVJlc3VsdC5tZXRyaWNzLmVycm9yc30gbGludGluZyBlcnJvcnMgcHJlc2VudGApO1xuICAgICAgbWl0aWdhdGlvbi5wdXNoKCdSdW4gYXV0b21hdGVkIGVycm9yIGZpeGluZyBiZWZvcmUgZGVwbG95bWVudCcpO1xuICAgIH1cblxuICAgIGlmIChnYXRlUmVzdWx0LnZpb2xhdGlvbnMuc29tZSh2ID0+IHYudHlwZSA9PT0gJ2Jsb2NrZXInKSkge1xuICAgICAgZmFjdG9ycy5wdXNoKCdDcml0aWNhbCBibG9ja2VycyBkZXRlY3RlZCcpO1xuICAgICAgbWl0aWdhdGlvbi5wdXNoKCdSZXNvbHZlIGFsbCBibG9ja2VyIGlzc3VlcyBpbW1lZGlhdGVseScpO1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICBsZXZlbDogZ2F0ZVJlc3VsdC5yaXNrTGV2ZWwsXG4gICAgICBmYWN0b3JzLFxuICAgICAgbWl0aWdhdGlvbixcbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBjaGVja0ZvclBhcnNlckVycm9ycygpOiBQcm9taXNlPFxuICAgIEFycmF5PHsgbWVzc2FnZTogc3RyaW5nOyBmaWxlPzogc3RyaW5nOyBsaW5lPzogbnVtYmVyIH0+XG4gID4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBUaGlzIHdvdWxkIGNoZWNrIGZvciBUeXBlU2NyaXB0IHBhcnNlciBlcnJvcnNcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGV4ZWNTeW5jKCd5YXJuIHRzYyAtLW5vRW1pdCAtLXNraXBMaWJDaGVjayAyPiYxIHx8IHRydWUnLCB7XG4gICAgICAgIGVuY29kaW5nOiAndXRmOCcsXG4gICAgICB9KTtcbiAgICAgIGNvbnN0IGVycm9yczogQXJyYXk8eyBtZXNzYWdlOiBzdHJpbmc7IGZpbGU/OiBzdHJpbmc7IGxpbmU/OiBudW1iZXIgfT4gPSBbXTtcblxuICAgICAgLy8gUGFyc2UgVHlwZVNjcmlwdCBjb21waWxlciBvdXRwdXQgZm9yIHBhcnNlciBlcnJvcnNcbiAgICAgIGNvbnN0IGxpbmVzID0gcmVzdWx0LnNwbGl0KCdcXG4nKTtcbiAgICAgIGZvciAoY29uc3QgbGluZSBvZiBsaW5lcykge1xuICAgICAgICBpZiAoXG4gICAgICAgICAgbGluZS5pbmNsdWRlcygnZXJyb3IgVFMnKSAmJlxuICAgICAgICAgIChsaW5lLmluY2x1ZGVzKCdDYW5ub3QgZmluZCcpIHx8IGxpbmUuaW5jbHVkZXMoJ1BhcnNlIGVycm9yJykpXG4gICAgICAgICkge1xuICAgICAgICAgIGNvbnN0IG1hdGNoID0gbGluZS5tYXRjaCgvXiguKz8pXFwoKFxcZCspLFxcZCtcXCk6IGVycm9yIFRTXFxkKzogKC4rKSQvKTtcbiAgICAgICAgICBpZiAobWF0Y2gpIHtcbiAgICAgICAgICAgIGVycm9ycy5wdXNoKHtcbiAgICAgICAgICAgICAgZmlsZTogbWF0Y2hbMV0sXG4gICAgICAgICAgICAgIGxpbmU6IHBhcnNlSW50KG1hdGNoWzJdKSxcbiAgICAgICAgICAgICAgbWVzc2FnZTogbWF0Y2hbM10sXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGVycm9ycztcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLndhcm4oJ0Vycm9yIGNoZWNraW5nIGZvciBwYXJzZXIgZXJyb3JzOicsIGVycm9yKTtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNhbGN1bGF0ZVRyZW5kKHZhbHVlczogbnVtYmVyW10pOiAnaW1wcm92aW5nJyB8ICdzdGFibGUnIHwgJ2RlZ3JhZGluZycge1xuICAgIGlmICh2YWx1ZXMubGVuZ3RoIDwgMikgcmV0dXJuICdzdGFibGUnO1xuXG4gICAgY29uc3QgcmVjZW50ID0gdmFsdWVzLnNsaWNlKC01KTtcbiAgICBjb25zdCBvbGRlciA9IHZhbHVlcy5zbGljZSgtMTAsIC01KTtcblxuICAgIGlmIChvbGRlci5sZW5ndGggPT09IDApIHJldHVybiAnc3RhYmxlJztcblxuICAgIGNvbnN0IHJlY2VudEF2ZyA9IHJlY2VudC5yZWR1Y2UoKHN1bSwgdmFsKSA9PiBzdW0gKyB2YWwsIDApIC8gcmVjZW50Lmxlbmd0aDtcbiAgICBjb25zdCBvbGRlckF2ZyA9IG9sZGVyLnJlZHVjZSgoc3VtLCB2YWwpID0+IHN1bSArIHZhbCwgMCkgLyBvbGRlci5sZW5ndGg7XG5cbiAgICBjb25zdCBjaGFuZ2UgPSAocmVjZW50QXZnIC0gb2xkZXJBdmcpIC8gb2xkZXJBdmc7XG5cbiAgICBpZiAoY2hhbmdlIDwgLTAuMSkgcmV0dXJuICdpbXByb3ZpbmcnO1xuICAgIGlmIChjaGFuZ2UgPiAwLjEpIHJldHVybiAnZGVncmFkaW5nJztcbiAgICByZXR1cm4gJ3N0YWJsZSc7XG4gIH1cblxuICBwcml2YXRlIGRldGVybWluZU92ZXJhbGxUcmVuZChcbiAgICB0cmVuZHM6IFJlY29yZDxzdHJpbmcsIHsgY3VycmVudDogbnVtYmVyOyBwcmV2aW91czogbnVtYmVyIH0+LFxuICApOiAnaW1wcm92aW5nJyB8ICdzdGFibGUnIHwgJ2RlZ3JhZGluZycge1xuICAgIGNvbnN0IHRyZW5kVmFsdWVzID0gT2JqZWN0LnZhbHVlcyh0cmVuZHMpO1xuICAgIGNvbnN0IGltcHJvdmluZ0NvdW50ID0gdHJlbmRWYWx1ZXMuZmlsdGVyKHQgPT4gdCA9PT0gJ2ltcHJvdmluZycpLmxlbmd0aDtcbiAgICBjb25zdCBkZWdyYWRpbmdDb3VudCA9IHRyZW5kVmFsdWVzLmZpbHRlcih0ID0+IHQgPT09ICdkZWdyYWRpbmcnKS5sZW5ndGg7XG5cbiAgICBpZiAoaW1wcm92aW5nQ291bnQgPiBkZWdyYWRpbmdDb3VudCkgcmV0dXJuICdpbXByb3ZpbmcnO1xuICAgIGlmIChkZWdyYWRpbmdDb3VudCA+IGltcHJvdmluZ0NvdW50KSByZXR1cm4gJ2RlZ3JhZGluZyc7XG4gICAgcmV0dXJuICdzdGFibGUnO1xuICB9XG5cbiAgcHJpdmF0ZSBnZW5lcmF0ZVRyZW5kUmVjb21tZW5kYXRpb25zKFxuICAgIHRyZW5kczogUmVjb3JkPHN0cmluZywgeyBjdXJyZW50OiBudW1iZXI7IHByZXZpb3VzOiBudW1iZXIgfT4sXG4gICk6IHN0cmluZ1tdIHtcbiAgICBjb25zdCByZWNvbW1lbmRhdGlvbnM6IHN0cmluZ1tdID0gW107XG5cbiAgICBpZiAodHJlbmRzLmVycm9yVHJlbmQgPT09ICdkZWdyYWRpbmcnKSB7XG4gICAgICByZWNvbW1lbmRhdGlvbnMucHVzaCgnRXJyb3IgY291bnQgaXMgaW5jcmVhc2luZyAtIGludmVzdGlnYXRlIHJlY2VudCBjaGFuZ2VzJyk7XG4gICAgfVxuXG4gICAgaWYgKHRyZW5kcy5wZXJmb3JtYW5jZVRyZW5kID09PSAnZGVncmFkaW5nJykge1xuICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goJ0xpbnRpbmcgcGVyZm9ybWFuY2UgaXMgZGVncmFkaW5nIC0gb3B0aW1pemUgY29uZmlndXJhdGlvbicpO1xuICAgIH1cblxuICAgIGlmICh0cmVuZHMucXVhbGl0eVRyZW5kID09PSAnaW1wcm92aW5nJykge1xuICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goJ1F1YWxpdHkgdHJlbmQgaXMgcG9zaXRpdmUgLSBtYWludGFpbiBjdXJyZW50IHByYWN0aWNlcycpO1xuICAgIH1cblxuICAgIHJldHVybiByZWNvbW1lbmRhdGlvbnM7XG4gIH1cblxuICBwcml2YXRlIGNhbGN1bGF0ZUFsZXJ0TGV2ZWwoXG4gICAgdHJlbmRzOiBSZWNvcmQ8c3RyaW5nLCB7IGN1cnJlbnQ6IG51bWJlcjsgcHJldmlvdXM6IG51bWJlciB9PixcbiAgKTogJ25vbmUnIHwgJ2xvdycgfCAnbWVkaXVtJyB8ICdoaWdoJyB7XG4gICAgY29uc3QgZGVncmFkaW5nQ291bnQgPSBPYmplY3QudmFsdWVzKHRyZW5kcykuZmlsdGVyKHQgPT4gdCA9PT0gJ2RlZ3JhZGluZycpLmxlbmd0aDtcblxuICAgIGlmIChkZWdyYWRpbmdDb3VudCA+PSAzKSByZXR1cm4gJ2hpZ2gnO1xuICAgIGlmIChkZWdyYWRpbmdDb3VudCA+PSAyKSByZXR1cm4gJ21lZGl1bSc7XG4gICAgaWYgKGRlZ3JhZGluZ0NvdW50ID49IDEpIHJldHVybiAnbG93JztcbiAgICByZXR1cm4gJ25vbmUnO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXREZWZhdWx0UXVhbGl0eUdhdGVDb25maWcoKTogUXVhbGl0eUdhdGVDb25maWcge1xuICAgIHJldHVybiB7XG4gICAgICBuYW1lOiAnU3RhbmRhcmQgUXVhbGl0eSBHYXRlJyxcbiAgICAgIGRlc2NyaXB0aW9uOiAnU3RhbmRhcmQgcXVhbGl0eSBnYXRlIGZvciBkZXBsb3ltZW50IGFwcHJvdmFsJyxcbiAgICAgIHRocmVzaG9sZHM6IHtcbiAgICAgICAgbWF4RXJyb3JzOiAwLFxuICAgICAgICBtYXhXYXJuaW5nczogMTAwLFxuICAgICAgICBtYXhFeGVjdXRpb25UaW1lOiA2MDAwMCxcbiAgICAgICAgbWluQ2FjaGVIaXRSYXRlOiA3MCxcbiAgICAgICAgbWF4TWVtb3J5VXNhZ2U6IDUxMixcbiAgICAgIH0sXG4gICAgICBibG9ja2Vyczoge1xuICAgICAgICBwYXJzZXJFcnJvcnM6IHRydWUsXG4gICAgICAgIHR5cGVTY3JpcHRFcnJvcnM6IHRydWUsXG4gICAgICAgIGltcG9ydEVycm9yczogdHJ1ZSxcbiAgICAgICAgc2VjdXJpdHlJc3N1ZXM6IHRydWUsXG4gICAgICB9LFxuICAgICAgZXhlbXB0aW9uczoge1xuICAgICAgICBmaWxlczogW10sXG4gICAgICAgIHJ1bGVzOiBbXSxcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBVdGlsaXR5IG1ldGhvZHNcbiAgICovXG4gIHByaXZhdGUgZW5zdXJlRGlyZWN0b3J5RXhpc3RzKCk6IHZvaWQge1xuICAgIHRyeSB7XG4gICAgICBleGVjU3luYygnbWtkaXIgLXAgLmtpcm8vcXVhbGl0eS1nYXRlcycsIHsgc3RkaW86ICdwaXBlJyB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgLy8gRGlyZWN0b3J5IG1pZ2h0IGFscmVhZHkgZXhpc3RcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHNhdmVRdWFsaXR5R2F0ZVJlc3VsdChyZXN1bHQ6IFF1YWxpdHlHYXRlUmVzdWx0KTogdm9pZCB7XG4gICAgdHJ5IHtcbiAgICAgIHdyaXRlRmlsZVN5bmModGhpcy5yZXN1bHRzRmlsZSwgSlNPTi5zdHJpbmdpZnkocmVzdWx0LCBudWxsLCAyKSk7XG5cbiAgICAgIC8vIEFsc28gYXBwZW5kIHRvIGhpc3RvcnlcbiAgICAgIGNvbnN0IGhpc3RvcnkgPSB0aGlzLmdldFF1YWxpdHlHYXRlSGlzdG9yeSgpO1xuICAgICAgaGlzdG9yeS5wdXNoKHJlc3VsdCk7XG5cbiAgICAgIC8vIEtlZXAgb25seSBsYXN0IDUwIGVudHJpZXNcbiAgICAgIGNvbnN0IHRyaW1tZWRIaXN0b3J5ID0gaGlzdG9yeS5zbGljZSgtNTApO1xuICAgICAgd3JpdGVGaWxlU3luYyh0aGlzLmhpc3RvcnlGaWxlLCBKU09OLnN0cmluZ2lmeSh0cmltbWVkSGlzdG9yeSwgbnVsbCwgMikpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ0Vycm9yIHNhdmluZyBxdWFsaXR5IGdhdGUgcmVzdWx0OicsIGVycm9yKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGdldFF1YWxpdHlHYXRlSGlzdG9yeSgpOiBRdWFsaXR5R2F0ZVJlc3VsdFtdIHtcbiAgICB0cnkge1xuICAgICAgaWYgKGV4aXN0c1N5bmModGhpcy5oaXN0b3J5RmlsZSkpIHtcbiAgICAgICAgY29uc3QgZGF0YSA9IHJlYWRGaWxlU3luYyh0aGlzLmhpc3RvcnlGaWxlLCAndXRmOCcpO1xuICAgICAgICByZXR1cm4gSlNPTi5wYXJzZShkYXRhKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLndhcm4oJ0Vycm9yIHJlYWRpbmcgcXVhbGl0eSBnYXRlIGhpc3Rvcnk6JywgZXJyb3IpO1xuICAgIH1cbiAgICByZXR1cm4gW107XG4gIH1cblxuICBwcml2YXRlIHNhdmVDSUNEUmVwb3J0KHJlcG9ydDogUmVjb3JkPHN0cmluZywgdW5rbm93bj4pOiB2b2lkIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVwb3J0RmlsZSA9IGAua2lyby9xdWFsaXR5LWdhdGVzL2NpY2QtcmVwb3J0LSR7RGF0ZS5ub3coKX0uanNvbmA7XG4gICAgICB3cml0ZUZpbGVTeW5jKHJlcG9ydEZpbGUsIEpTT04uc3RyaW5naWZ5KHJlcG9ydCwgbnVsbCwgMikpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ0Vycm9yIHNhdmluZyBDSS9DRCByZXBvcnQ6JywgZXJyb3IpO1xuICAgIH1cbiAgfVxufVxuIl0sInZlcnNpb24iOjN9