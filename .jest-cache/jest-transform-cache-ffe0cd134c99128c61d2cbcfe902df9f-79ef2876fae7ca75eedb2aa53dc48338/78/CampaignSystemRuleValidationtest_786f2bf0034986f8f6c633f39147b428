ae6a6702b19700d5308358c3a0f62871
"use strict";
/**
 * Campaign System Rule Validation Test Suite
 *
 * Tests the domain-specific ESLint rules for campaign system files
 * to ensure enterprise patterns and extensive logging are allowed.
 *
 * Requirements: 4.3
 */
Object.defineProperty(exports, "__esModule", { value: true });
const child_process_1 = require("child_process");
const fs_1 = require("fs");
const path_1 = require("path");
describe('Campaign System Rule Validation', () => {
    const projectRoot = process.cwd();
    const tempFiles = [];
    afterEach(() => {
        // Clean up temporary test files
        tempFiles.forEach(file => {
            try {
                (0, child_process_1.execSync)(`rm -f "${file}"`);
            }
            catch { }
        });
        tempFiles.length = 0;
    });
    describe('Enterprise Patterns Allowance', () => {
        test('should allow high complexity in campaign files', async () => {
            const testContent = `
        class CampaignController {
          private executeComplexCampaign(config: any) {
            // High complexity enterprise logic
            let result = 0;

            for (let phase = 0; phase < 10; phase++) {
              for (let batch = 0; batch < 20; batch++) {
                for (let file = 0; file < 50; file++) {
                  if (phase < 3) {
                    if (batch % 2 === 0) {
                      if (file < 10) {
                        result += this.processFile(phase, batch, file);
                      } else if (file < 30) {
                        result += this.validateFile(phase, batch, file);
                      } else {
                        result += this.optimizeFile(phase, batch, file);
                      }
                    } else {
                      if (file % 3 === 0) {
                        result += this.analyzeFile(phase, batch, file);
                      } else {
                        result += this.transformFile(phase, batch, file);
                      }
                    }
                  } else if (phase < 7) {
                    result += this.advancedProcessing(phase, batch, file);
                  } else {
                    result += this.finalizeProcessing(phase, batch, file);
                  }
                }
              }
            }

            return result;
          }

          private processFile(phase: number, batch: number, file: number): number {
            return phase + batch + file;
          }

          private validateFile(phase: number, batch: number, file: number): number {
            return phase * batch * file;
          }

          private optimizeFile(phase: number, batch: number, file: number): number {
            return Math.max(phase, batch, file);
          }

          private analyzeFile(phase: number, batch: number, file: number): number {
            return Math.min(phase, batch, file);
          }

          private transformFile(phase: number, batch: number, file: number): number {
            return (phase + batch + file) / 3;
          }

          private advancedProcessing(phase: number, batch: number, file: number): number {
            return phase ** 2 + batch ** 2 + file ** 2;
          }

          private finalizeProcessing(phase: number, batch: number, file: number): number {
            return Math.sqrt(phase * batch * file);
          }
        }
      `;
            const testFile = (0, path_1.join)(projectRoot, 'src/services/campaign/temp-complex-enterprise.ts');
            tempFiles.push(testFile);
            (0, fs_1.writeFileSync)(testFile, testContent);
            try {
                const output = (0, child_process_1.execSync)(`npx eslint "${testFile}" --config eslint.config.cjs --format json`, {
                    encoding: 'utf8',
                    cwd: projectRoot,
                });
                const result = JSON.parse(output);
                if (result.length > 0 && result[0].messages) {
                    const complexityErrors = result[0].messages.filter((msg) => msg.ruleId === 'complexity' && msg.severity === 2);
                    // Campaign files should allow high complexity
                    expect(complexityErrors.length).toBe(0);
                }
            }
            catch (error) {
                const output = error.stdout?.toString() || '';
                if (output) {
                    const result = JSON.parse(output);
                    if (result.length > 0 && result[0].messages) {
                        const complexityErrors = result[0].messages.filter((msg) => msg.ruleId === 'complexity' && msg.severity === 2);
                        expect(complexityErrors.length).toBe(0);
                    }
                }
            }
        });
        test('should allow long functions in campaign files', async () => {
            const testContent = `
        class ProgressTracker {
          public generateComprehensiveReport(): string {
            // Long function with extensive reporting logic
            let report = 'Campaign Progress Report\\n';
            report += '========================\\n\\n';

            // Phase 1 Analysis
            report += 'Phase 1: Initial Analysis\\n';
            report += 'Status: Completed\\n';
            report += 'Duration: 2.5 hours\\n';
            report += 'Files Processed: 1,250\\n';
            report += 'Errors Found: 4,310\\n';
            report += 'Errors Fixed: 3,890\\n';
            report += 'Success Rate: 90.2%\\n\\n';

            // Phase 2 Analysis
            report += 'Phase 2: Error Elimination\\n';
            report += 'Status: In Progress\\n';
            report += 'Duration: 4.1 hours\\n';
            report += 'Files Processed: 2,100\\n';
            report += 'Errors Found: 2,566\\n';
            report += 'Errors Fixed: 2,200\\n';
            report += 'Success Rate: 85.7%\\n\\n';

            // Phase 3 Analysis
            report += 'Phase 3: Optimization\\n';
            report += 'Status: Pending\\n';
            report += 'Estimated Duration: 3.0 hours\\n';
            report += 'Estimated Files: 1,800\\n';
            report += 'Estimated Errors: 1,500\\n';
            report += 'Target Success Rate: 95%\\n\\n';

            // Safety Metrics
            report += 'Safety Metrics:\\n';
            report += 'Build Failures: 0\\n';
            report += 'Rollbacks Triggered: 2\\n';
            report += 'Corruption Events: 0\\n';
            report += 'Safety Score: 98.5%\\n\\n';

            // Performance Metrics
            report += 'Performance Metrics:\\n';
            report += 'Average Processing Speed: 125 files/hour\\n';
            report += 'Memory Usage: 2.1GB peak\\n';
            report += 'CPU Usage: 65% average\\n';
            report += 'Cache Hit Rate: 87%\\n\\n';

            // Quality Metrics
            report += 'Quality Metrics:\\n';
            report += 'Code Quality Score: 92/100\\n';
            report += 'Type Safety Score: 89/100\\n';
            report += 'Linting Score: 94/100\\n';
            report += 'Overall Quality: 91.7/100\\n\\n';

            // Recommendations
            report += 'Recommendations:\\n';
            report += '1. Increase batch size for Phase 3\\n';
            report += '2. Enable parallel processing\\n';
            report += '3. Implement additional safety checks\\n';
            report += '4. Optimize memory usage patterns\\n';
            report += '5. Enhance error categorization\\n\\n';

            // Next Steps
            report += 'Next Steps:\\n';
            report += '1. Complete Phase 2 error elimination\\n';
            report += '2. Begin Phase 3 optimization\\n';
            report += '3. Implement performance improvements\\n';
            report += '4. Conduct comprehensive validation\\n';
            report += '5. Prepare for production deployment\\n\\n';

            report += 'Report Generated: ' + new Date().toISOString() + '\\n';
            report += 'Campaign ID: typescript-elimination-2024\\n';
            report += 'Report Version: 1.2.3\\n';

            return report;
          }
        }
      `;
            const testFile = (0, path_1.join)(projectRoot, 'src/services/campaign/temp-long-function.ts');
            tempFiles.push(testFile);
            (0, fs_1.writeFileSync)(testFile, testContent);
            try {
                const output = (0, child_process_1.execSync)(`npx eslint "${testFile}" --config eslint.config.cjs --format json`, {
                    encoding: 'utf8',
                    cwd: projectRoot,
                });
                const result = JSON.parse(output);
                if (result.length > 0 && result[0].messages) {
                    const functionLengthErrors = result[0].messages.filter((msg) => msg.ruleId === 'max-lines-per-function' && msg.severity === 2);
                    // Campaign files should allow long functions
                    expect(functionLengthErrors.length).toBe(0);
                }
            }
            catch (error) {
                const output = error.stdout?.toString() || '';
                if (output) {
                    const result = JSON.parse(output);
                    if (result.length > 0 && result[0].messages) {
                        const functionLengthErrors = result[0].messages.filter((msg) => msg.ruleId === 'max-lines-per-function' && msg.severity === 2);
                        expect(functionLengthErrors.length).toBe(0);
                    }
                }
            }
        });
        test('should allow explicit any types in campaign files', async () => {
            const testContent = `
        class CampaignIntelligenceSystem {
          private analyzeErrorPatterns(data: any): any {
            // Enterprise intelligence requires flexible typing
            const patterns: any = {};
            const metrics: any = data.metrics || {};
            const config: any = data.config || {};

            // Dynamic analysis based on campaign type
            if (config.type === 'typescript-elimination') {
              patterns.errorTypes = this.analyzeTypeScriptErrors(data);
            } else if (config.type === 'linting-excellence') {
              patterns.lintingIssues = this.analyzeLintingIssues(data);
            }

            // Flexible return structure
            return {
              patterns,
              confidence: this.calculateConfidence(patterns),
              recommendations: this.generateRecommendations(patterns),
              metadata: {
                analysisTime: Date.now(),
                dataSize: JSON.stringify(data).length,
                complexity: this.calculateComplexity(data)
              }
            };
          }

          private analyzeTypeScriptErrors(data: any): any {
            return data.errors || [];
          }

          private analyzeLintingIssues(data: any): any {
            return data.warnings || [];
          }

          private calculateConfidence(patterns: any): number {
            return Math.random() * 100;
          }

          private generateRecommendations(patterns: any): any[] {
            return [];
          }

          private calculateComplexity(data: any): number {
            return Object.keys(data).length;
          }
        }
      `;
            const testFile = (0, path_1.join)(projectRoot, 'src/services/campaign/temp-any-types.ts');
            tempFiles.push(testFile);
            (0, fs_1.writeFileSync)(testFile, testContent);
            try {
                const output = (0, child_process_1.execSync)(`npx eslint "${testFile}" --config eslint.config.cjs --format json`, {
                    encoding: 'utf8',
                    cwd: projectRoot,
                });
                const result = JSON.parse(output);
                if (result.length > 0 && result[0].messages) {
                    const anyTypeErrors = result[0].messages.filter((msg) => msg.ruleId === '@typescript-eslint/no-explicit-any' && msg.severity === 2);
                    // Campaign files should allow explicit any types (warn level is OK);
                    expect(anyTypeErrors.length).toBe(0);
                }
            }
            catch (error) {
                const output = error.stdout?.toString() || '';
                if (output) {
                    const result = JSON.parse(output);
                    if (result.length > 0 && result[0].messages) {
                        const anyTypeErrors = result[0].messages.filter((msg) => msg.ruleId === '@typescript-eslint/no-explicit-any' && msg.severity === 2);
                        expect(anyTypeErrors.length).toBe(0);
                    }
                }
            }
        });
        test('should allow deep nesting in campaign files', async () => {
            const testContent = `
        class SafetyProtocolSystem {
          private executeEmergencyProtocol_(event: any): void {
            // Deep nesting for comprehensive safety checks
            if (event.type === 'corruption') {
              if (event.severity === 'critical') {
                if (event.affectedFiles > 10) {
                  if (event.buildStatus === 'failed') {
                    if (event.rollbackAvailable) {
                      if (event.backupIntegrity === 'verified') {
                        this.executeEmergencyRollback_(event);
                      } else {
                        this.createEmergencyBackup_(event);
                      }
                    } else {
                      this.initiateManualRecovery_(event);
                    }
                  } else {
                    this.monitorBuildStatus_(event);
                  }
                } else {
                  this.isolateAffectedFiles_(event);
                }
              } else {
                this.logSafetyEvent_(event);
              }
            }
          }

          private executeEmergencyRollback_(event: any): void {
            console.log('Executing emergency rollback');
          }

          private createEmergencyBackup_(event: any): void {
            console.log('Creating emergency backup');
          }

          private initiateManualRecovery_(event: any): void {
            console.log('Initiating manual recovery');
          }

          private monitorBuildStatus_(event: any): void {
            console.log('Monitoring build status');
          }

          private isolateAffectedFiles_(event: any): void {
            console.log('Isolating affected files');
          }

          private logSafetyEvent_(event: any): void {
            console.log('Logging safety event');
          }
        }
      `;
            const testFile = (0, path_1.join)(projectRoot, 'src/services/campaign/temp-deep-nesting.ts');
            tempFiles.push(testFile);
            (0, fs_1.writeFileSync)(testFile, testContent);
            try {
                const output = (0, child_process_1.execSync)(`npx eslint "${testFile}" --config eslint.config.cjs --format json`, {
                    encoding: 'utf8',
                    cwd: projectRoot,
                });
                const result = JSON.parse(output);
                if (result.length > 0 && result[0].messages) {
                    const depthErrors = result[0].messages.filter((msg) => msg.ruleId === 'max-depth' && msg.severity === 2);
                    // Campaign files should allow deep nesting
                    expect(depthErrors.length).toBe(0);
                }
            }
            catch (error) {
                const output = error.stdout?.toString() || '';
                if (output) {
                    const result = JSON.parse(output);
                    if (result.length > 0 && result[0].messages) {
                        const depthErrors = result[0].messages.filter((msg) => msg.ruleId === 'max-depth' && msg.severity === 2);
                        expect(depthErrors.length).toBe(0);
                    }
                }
            }
        });
    });
    describe('Extensive Logging Allowance', () => {
        test('should allow all console methods in campaign files', async () => {
            const testContent = `
        class CampaignLogger {
          public logCampaignProgress(): void {
            console.log('Campaign progress update: 75% complete');
            console.info('Processing batch 15 of 20');
            console.warn('Memory usage approaching 80% threshold');
            console.error('Failed to process 3 files in current batch');
            console.debug('Detailed timing: parse=125ms, analyze=89ms, fix=234ms');
            console.trace('Call stack for debugging complex issue');
            console.table([
              { phase: 'Analysis', duration: '2.5h', files: 1250 },
              { phase: 'Fixing', duration: '4.1h', files: 2100 }
            ]);
            console.group('Safety Protocol Status');
            console.log('Build validation: PASSED');
            console.log('Corruption detection: ACTIVE');
            console.log('Rollback readiness: READY');
            console.groupEnd();
            console.time('batch-processing');
            // Simulate batch processing
            console.timeEnd('batch-processing');
            console.count('safety-checks');
            console.assert(true, 'Safety assertion passed');
          }

          public logMetrics(metrics: any): void {
            console.log('=== CAMPAIGN METRICS ===');
            console.log('Total errors found:', metrics.totalErrors);
            console.log('Errors fixed:', metrics.errorsFixed);
            console.log('Success rate:', metrics.successRate + '%');
            console.log('Processing speed:', metrics.speed + ' files/hour');
            console.log('Memory usage:', metrics.memoryUsage + 'MB');
            console.log('CPU usage:', metrics.cpuUsage + '%');
            console.log('Cache hit rate:', metrics.cacheHitRate + '%');
            console.log('========================');
          }

          public logSafetyEvents(events: any[]): void {
            console.warn('=== SAFETY EVENTS ===');
            events.forEach((event, index) => {
              console.warn(\`Event \${index + 1}: \${event.type}\`);
              console.warn(\`Severity: \${event.severity}\`);
              console.warn(\`Timestamp: \${event.timestamp}\`);
              console.warn(\`Action taken: \${event.action}\`);
            });
            console.warn('=====================');
          }
        }
      `;
            const testFile = (0, path_1.join)(projectRoot, 'src/services/campaign/temp-extensive-logging.ts');
            tempFiles.push(testFile);
            (0, fs_1.writeFileSync)(testFile, testContent);
            try {
                const output = (0, child_process_1.execSync)(`npx eslint "${testFile}" --config eslint.config.cjs --format json`, {
                    encoding: 'utf8',
                    cwd: projectRoot,
                });
                const result = JSON.parse(output);
                if (result.length > 0 && result[0].messages) {
                    const consoleErrors = result[0].messages.filter((msg) => msg.ruleId === 'no-console' && msg.severity === 2);
                    // Campaign files should allow all console methods
                    expect(consoleErrors.length).toBe(0);
                }
            }
            catch (error) {
                const output = error.stdout?.toString() || '';
                if (output) {
                    const result = JSON.parse(output);
                    if (result.length > 0 && result[0].messages) {
                        const consoleErrors = result[0].messages.filter((msg) => msg.ruleId === 'no-console' && msg.severity === 2);
                        expect(consoleErrors.length).toBe(0);
                    }
                }
            }
        });
        test('should allow process.exit in emergency protocols', async () => {
            const testContent = `
        class EmergencyProtocol {
          public executeEmergencyShutdown(reason: string): void {
            console.error('EMERGENCY SHUTDOWN INITIATED:', reason);
            console.error('Saving current state...');
            this.saveEmergencyState();
            console.error('Creating emergency backup...');
            this.createEmergencyBackup();
            console.error('Notifying administrators...');
            this.notifyAdministrators(reason);
            console.error('Emergency shutdown complete. Exiting process.');
            process.exit(1); // Should be allowed in campaign emergency protocols
          }

          private saveEmergencyState(): void {
            console.log('Emergency state saved');
          }

          private createEmergencyBackup(): void {
            console.log('Emergency backup created');
          }

          private notifyAdministrators(reason: string): void {
            console.log('Administrators notified:', reason);
          }
        }
      `;
            const testFile = (0, path_1.join)(projectRoot, 'src/services/campaign/temp-process-exit.ts');
            tempFiles.push(testFile);
            (0, fs_1.writeFileSync)(testFile, testContent);
            try {
                const output = (0, child_process_1.execSync)(`npx eslint "${testFile}" --config eslint.config.cjs --format json`, {
                    encoding: 'utf8',
                    cwd: projectRoot,
                });
                const result = JSON.parse(output);
                if (result.length > 0 && result[0].messages) {
                    const processExitErrors = result[0].messages.filter((msg) => msg.ruleId === 'no-process-exit' && msg.severity === 2);
                    // Campaign files should allow process.exit
                    expect(processExitErrors.length).toBe(0);
                }
            }
            catch (error) {
                const output = error.stdout?.toString() || '';
                if (output) {
                    const result = JSON.parse(output);
                    if (result.length > 0 && result[0].messages) {
                        const processExitErrors = result[0].messages.filter((msg) => msg.ruleId === 'no-process-exit' && msg.severity === 2);
                        expect(processExitErrors.length).toBe(0);
                    }
                }
            }
        });
    });
    describe('Campaign Variable Patterns', () => {
        test('should ignore unused campaign variables', async () => {
            const testContent = `
        class CampaignManager {
          private initializeCampaign(): void {
            const campaign = 'typescript-elimination';
            const progress = 0.75;
            const metrics = { errors: 100, fixed: 85 };
            const safety = true;
            const UNUSED_CAMPAIGN_ID = 'ts-elim-2024';
            const UNUSED_PROGRESS_THRESHOLD = 0.8;
            const UNUSED_METRICS_INTERVAL = 5000;
            const UNUSED_SAFETY_ENABLED = true;
            const UNUSED_ERROR_THRESHOLD = 1000;
            const UNUSED_campaign = 'unused-campaign';
            const UNUSED_progress = 0.0;
            const UNUSED_metrics = {};
            const UNUSED_safety = false;
          }
        }
      `;
            const testFile = (0, path_1.join)(projectRoot, 'src/services/campaign/temp-campaign-variables.ts');
            tempFiles.push(testFile);
            (0, fs_1.writeFileSync)(testFile, testContent);
            try {
                const output = (0, child_process_1.execSync)(`npx eslint "${testFile}" --config eslint.config.cjs --format json`, {
                    encoding: 'utf8',
                    cwd: projectRoot,
                });
                const result = JSON.parse(output);
                if (result.length > 0 && result[0].messages) {
                    const unusedVarErrors = result[0].messages.filter((msg) => msg.ruleId === '@typescript-eslint/no-unused-vars' &&
                        (msg.message.includes('campaign') ||
                            msg.message.includes('progress') ||
                            msg.message.includes('metrics') ||
                            msg.message.includes('safety')));
                    // Campaign variable patterns should be ignored
                    expect(unusedVarErrors.length).toBe(0);
                }
            }
            catch (error) {
                const output = error.stdout?.toString() || '';
                if (output) {
                    const result = JSON.parse(output);
                    if (result.length > 0 && result[0].messages) {
                        const unusedVarErrors = result[0].messages.filter((msg) => msg.ruleId === '@typescript-eslint/no-unused-vars' &&
                            (msg.message.includes('campaign') ||
                                msg.message.includes('progress') ||
                                msg.message.includes('metrics') ||
                                msg.message.includes('safety')));
                        expect(unusedVarErrors.length).toBe(0);
                    }
                }
            }
        });
        test('should recognize campaign constant patterns', async () => {
            const testContent = `
        class CampaignConstants {
          private static readonly CAMPAIGN_TYPES = {
            TYPESCRIPT_ELIMINATION: 'typescript-elimination',
            LINTING_EXCELLENCE: 'linting-excellence',
            PERFORMANCE_OPTIMIZATION: 'performance-optimization'
          };

          private static readonly PROGRESS_THRESHOLDS = {
            WARNING: 0.2,
            CRITICAL: 0.5,
            SUCCESS: 0.9
          };

          private static readonly METRICS_CONFIG = {
            COLLECTION_INTERVAL: 5000,
            RETENTION_PERIOD: 86400000,
            MAX_ENTRIES: 10000
          };

          private static readonly SAFETY_LIMITS = {
            MAX_ERRORS: 1000,
            MAX_BATCH_SIZE: 50,
            MAX_MEMORY_USAGE: 4096
          };

          private static readonly ERROR_CATEGORIES = {
            TYPESCRIPT: 'typescript',
            LINTING: 'linting',
            BUILD: 'build',
            RUNTIME: 'runtime'
          };
        }
      `;
            const testFile = (0, path_1.join)(projectRoot, 'src/services/campaign/temp-campaign-constants.ts');
            tempFiles.push(testFile);
            (0, fs_1.writeFileSync)(testFile, testContent);
            try {
                const output = (0, child_process_1.execSync)(`npx eslint "${testFile}" --config eslint.config.cjs --format json`, {
                    encoding: 'utf8',
                    cwd: projectRoot,
                });
                const result = JSON.parse(output);
                if (result.length > 0 && result[0].messages) {
                    const unusedVarErrors = result[0].messages.filter((msg) => msg.ruleId === '@typescript-eslint/no-unused-vars');
                    // Campaign constants should be allowed even if unused
                    expect(unusedVarErrors.length).toBe(0);
                }
            }
            catch (error) {
                const output = error.stdout?.toString() || '';
                if (output) {
                    const result = JSON.parse(output);
                    if (result.length > 0 && result[0].messages) {
                        const unusedVarErrors = result[0].messages.filter((msg) => msg.ruleId === '@typescript-eslint/no-unused-vars');
                        expect(unusedVarErrors.length).toBe(0);
                    }
                }
            }
        });
    });
    describe('Dynamic Import Allowance', () => {
        test('should allow dynamic imports for campaign tools', async () => {
            const testContent = `
        class CampaignToolLoader {
          public async loadCampaignTool(toolName: string): Promise<any> {
            // Dynamic imports for campaign tools should be allowed
            const toolPath = \`./tools/\${toolName}\`;
            const tool = import(toolPath);
            return tool.default || tool;
          }

          public async loadConfigBasedTool(config: any): Promise<any> {
            const toolModule = config.toolModule;
            const dynamicTool = import(toolModule);
            return dynamicTool;
          }

          public loadSynchronousTool(toolName: string): any {
            // Dynamic require should also be allowed
            const toolPath = \`./tools/\${toolName}\`;
            return require(toolPath);
          }

          public loadEnvironmentTool(): any {
            const toolModule = process.env.CAMPAIGN_TOOL_MODULE;
            if (toolModule) {
              return require(toolModule);
            }
            return null;
          }
        }
      `;
            const testFile = (0, path_1.join)(projectRoot, 'src/services/campaign/temp-dynamic-imports.ts');
            tempFiles.push(testFile);
            (0, fs_1.writeFileSync)(testFile, testContent);
            try {
                const output = (0, child_process_1.execSync)(`npx eslint "${testFile}" --config eslint.config.cjs --format json`, {
                    encoding: 'utf8',
                    cwd: projectRoot,
                });
                const result = JSON.parse(output);
                if (result.length > 0 && result[0].messages) {
                    const dynamicImportErrors = result[0].messages.filter((msg) => msg.ruleId === 'import/no-dynamic-require' && msg.severity === 2);
                    // Campaign files should allow dynamic imports
                    expect(dynamicImportErrors.length).toBe(0);
                }
            }
            catch (error) {
                const output = error.stdout?.toString() || '';
                if (output) {
                    const result = JSON.parse(output);
                    if (result.length > 0 && result[0].messages) {
                        const dynamicImportErrors = result[0].messages.filter((msg) => msg.ruleId === 'import/no-dynamic-require' && msg.severity === 2);
                        expect(dynamicImportErrors.length).toBe(0);
                    }
                }
            }
        });
    });
    describe('File Pattern Matching', () => {
        test('should apply campaign rules to correct file patterns', () => {
            // Test that campaign files are properly matched by ESLint config
            const campaignFiles = [
                'src/services/campaign/CampaignController.ts',
                'src/services/campaign/ProgressTracker.ts',
                'src/services/campaign/SafetyProtocol.ts',
                'src/types/campaign.ts',
                'src/utils/CampaignUtils.ts',
                'src/utils/ProgressUtils.ts',
            ];
            campaignFiles.forEach(file => {
                // Check if file would match campaign patterns in ESLint config
                const matchesCampaignPattern = file.includes('/services/campaign/') ||
                    file.includes('/types/campaign.ts') ||
                    file.includes('Campaign') ||
                    file.includes('Progress');
                expect(matchesCampaignPattern).toBe(true);
            });
        });
        test('should not apply campaign rules to non-campaign files', () => {
            const nonCampaignFiles = [
                'src/components/FoodRecommender.tsx',
                'src/calculations/culinaryAstrology.ts',
                'src/utils/reliableAstronomy.ts',
                'src/data/ingredients/vegetables.ts',
            ];
            nonCampaignFiles.forEach(file => {
                // Check that file would NOT match campaign patterns
                const matchesCampaignPattern = file.includes('/services/campaign/') ||
                    file.includes('/types/campaign.ts') ||
                    (file.includes('Campaign') && !file.includes('components')) ||
                    (file.includes('Progress') && !file.includes('components'));
                expect(matchesCampaignPattern).toBe(false);
            });
        });
    });
    describe('Integration with Existing Campaign Files', () => {
        test('should validate existing CampaignController if present', async () => {
            const campaignControllerPath = (0, path_1.join)(projectRoot, 'src/services/campaign/CampaignController.ts');
            if ((0, fs_1.existsSync)(campaignControllerPath)) {
                try {
                    const output = (0, child_process_1.execSync)('yarn eslint --format json --no-eslintrc --config eslint.config.cjs ' + campaignControllerPath, { encoding: 'utf8' });
                    const result = JSON.parse(output);
                    if (result.length > 0 && result[0].messages) {
                        const restrictiveErrors = result[0].messages.filter((msg) => (msg.ruleId === 'complexity' && msg.severity === 2) ||
                            (msg.ruleId === 'max-lines-per-function' && msg.severity === 2) ||
                            (msg.ruleId === 'no-console' && msg.severity === 2));
                        // Existing campaign files should not have restrictive errors
                        expect(restrictiveErrors.length).toBe(0);
                    }
                }
                catch (error) {
                    const output = error.stdout?.toString() || '';
                    if (output) {
                        const result = JSON.parse(output);
                        if (result.length > 0 && result[0].messages) {
                            const restrictiveErrors = result[0].messages.filter((msg) => (msg.ruleId === 'complexity' && msg.severity === 2) ||
                                (msg.ruleId === 'max-lines-per-function' && msg.severity === 2) ||
                                (msg.ruleId === 'no-console' && msg.severity === 2));
                            expect(restrictiveErrors.length).toBe(0);
                        }
                    }
                }
            }
            else {
                // If file doesn't exist, test passes
                expect(true).toBe(true);
            }
        });
        test('should validate existing ProgressTracker if present', async () => {
            const progressTrackerPath = (0, path_1.join)(projectRoot, 'src/services/campaign/ProgressTracker.ts');
            if ((0, fs_1.existsSync)(progressTrackerPath)) {
                try {
                    const output = (0, child_process_1.execSync)('yarn eslint --format json --no-eslintrc --config eslint.config.cjs ' + progressTrackerPath, { encoding: 'utf8' });
                    const result = JSON.parse(output);
                    if (result.length > 0 && result[0].messages) {
                        const restrictiveErrors = result[0].messages.filter((msg) => (msg.ruleId === 'complexity' && msg.severity === 2) ||
                            (msg.ruleId === 'max-lines-per-function' && msg.severity === 2) ||
                            (msg.ruleId === 'no-console' && msg.severity === 2));
                        expect(restrictiveErrors.length).toBe(0);
                    }
                }
                catch (error) {
                    const output = error.stdout?.toString() || '';
                    if (output) {
                        const result = JSON.parse(output);
                        if (result.length > 0 && result[0].messages) {
                            const restrictiveErrors = result[0].messages.filter((msg) => (msg.ruleId === 'complexity' && msg.severity === 2) ||
                                (msg.ruleId === 'max-lines-per-function' && msg.severity === 2) ||
                                (msg.ruleId === 'no-console' && msg.severity === 2));
                            expect(restrictiveErrors.length).toBe(0);
                        }
                    }
                }
            }
            else {
                expect(true).toBe(true);
            }
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L2JhY2t1cHMvZmlyc3Qtd2F2ZS0yMDI1LTA4LTExVDA1LTE5LTI2LTgxM1ovc3JjL19fdGVzdHNfXy9saW50aW5nL0NhbXBhaWduU3lzdGVtUnVsZVZhbGlkYXRpb24udGVzdC50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7Ozs7R0FPRzs7QUFFSCxpREFBeUM7QUFDekMsMkJBQStDO0FBQy9DLCtCQUE0QjtBQUU1QixRQUFRLENBQUMsaUNBQWlDLEVBQUUsR0FBRyxFQUFFO0lBQy9DLE1BQU0sV0FBVyxHQUFHLE9BQU8sQ0FBQyxHQUFHLEVBQUUsQ0FBQztJQUNsQyxNQUFNLFNBQVMsR0FBYSxFQUFFLENBQUM7SUFFL0IsU0FBUyxDQUFDLEdBQUcsRUFBRTtRQUNiLGdDQUFnQztRQUNoQyxTQUFTLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFO1lBQ3ZCLElBQUk7Z0JBQ0YsSUFBQSx3QkFBUSxFQUFDLFVBQVUsSUFBSSxHQUFHLENBQUMsQ0FBQzthQUM3QjtZQUFDLE1BQU0sR0FBRTtRQUNaLENBQUMsQ0FBQyxDQUFDO1FBQ0gsU0FBUyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUM7SUFDdkIsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsK0JBQStCLEVBQUUsR0FBRyxFQUFFO1FBQzdDLElBQUksQ0FBQyxnREFBZ0QsRUFBRSxLQUFLLElBQUksRUFBRTtZQUNoRSxNQUFNLFdBQVcsR0FBRzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7T0FpRW5CLENBQUM7WUFFRixNQUFNLFFBQVEsR0FBRyxJQUFBLFdBQUksRUFBQyxXQUFXLEVBQUUsa0RBQWtELENBQUMsQ0FBQztZQUN2RixTQUFTLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQ3pCLElBQUEsa0JBQWEsRUFBQyxRQUFRLEVBQUUsV0FBVyxDQUFDLENBQUM7WUFF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Q0FBQztxQkFDMUM7aUJBQ0Y7Z0JBQUMsT0FBTyxLQUFLLEVBQUU7b0JBQ2QsTUFBTSxNQUFNLEdBQUksS0FBYSxDQUFDLE1BQU0sRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLENBQUM7b0JBQ3ZELElBQUksTUFBTSxFQUFFO3dCQUNWLE1BQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7d0JBQ2xDLElBQUksTUFBTSxDQUFDLE1BQU0sR0FBRyxDQUFDLElBQUksTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsRUFBRTs0QkFDM0MsTUFBTSxpQkFBaUIsR0FBRyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLE1BQU0sQ0FDakQsQ0FBQyxHQUFRLEVBQUUsRUFBRSxDQUNYLENBQUMsR0FBRyxDQUFDLE1BQU0sS0FBSyxZQUFZLElBQUksR0FBRyxDQUFDLFFBQVEsS0FBSyxDQUFDLENBQUM7Z0NBQ25ELENBQUMsR0FBRyxDQUFDLE1BQU0sS0FBSyx3QkFBd0IsSUFBSSxHQUFHLENBQUMsUUFBUSxLQUFLLENBQUMsQ0FBQztnQ0FDL0QsQ0FBQyxHQUFHLENBQUMsTUFBTSxLQUFLLFlBQVksSUFBSSxHQUFHLENBQUMsUUFBUSxLQUFLLENBQUMsQ0FBQyxDQUN0RCxDQUFDOzRCQUVGLE1BQU0sQ0FBQyxpQkFBaUIsQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7eUJBQzFDO3FCQUNGO2lCQUNGO2FBQ0Y7aUJBQU07Z0JBQ0wsTUFBTSxDQUFDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQzthQUN6QjtRQUNILENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvR3JlZ0Nhc3Ryby9EZXNrdG9wL1doYXRUb0VhdE5leHQvYmFja3Vwcy9maXJzdC13YXZlLTIwMjUtMDgtMTFUMDUtMTktMjYtODEzWi9zcmMvX190ZXN0c19fL2xpbnRpbmcvQ2FtcGFpZ25TeXN0ZW1SdWxlVmFsaWRhdGlvbi50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ2FtcGFpZ24gU3lzdGVtIFJ1bGUgVmFsaWRhdGlvbiBUZXN0IFN1aXRlXG4gKlxuICogVGVzdHMgdGhlIGRvbWFpbi1zcGVjaWZpYyBFU0xpbnQgcnVsZXMgZm9yIGNhbXBhaWduIHN5c3RlbSBmaWxlc1xuICogdG8gZW5zdXJlIGVudGVycHJpc2UgcGF0dGVybnMgYW5kIGV4dGVuc2l2ZSBsb2dnaW5nIGFyZSBhbGxvd2VkLlxuICpcbiAqIFJlcXVpcmVtZW50czogNC4zXG4gKi9cblxuaW1wb3J0IHsgZXhlY1N5bmMgfSBmcm9tICdjaGlsZF9wcm9jZXNzJztcbmltcG9ydCB7IGV4aXN0c1N5bmMsIHdyaXRlRmlsZVN5bmMgfSBmcm9tICdmcyc7XG5pbXBvcnQgeyBqb2luIH0gZnJvbSAncGF0aCc7XG5cbmRlc2NyaWJlKCdDYW1wYWlnbiBTeXN0ZW0gUnVsZSBWYWxpZGF0aW9uJywgKCkgPT4ge1xuICBjb25zdCBwcm9qZWN0Um9vdCA9IHByb2Nlc3MuY3dkKCk7XG4gIGNvbnN0IHRlbXBGaWxlczogc3RyaW5nW10gPSBbXTtcblxuICBhZnRlckVhY2goKCkgPT4ge1xuICAgIC8vIENsZWFuIHVwIHRlbXBvcmFyeSB0ZXN0IGZpbGVzXG4gICAgdGVtcEZpbGVzLmZvckVhY2goZmlsZSA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICBleGVjU3luYyhgcm0gLWYgXCIke2ZpbGV9XCJgKTtcbiAgICAgIH0gY2F0Y2gge31cbiAgICB9KTtcbiAgICB0ZW1wRmlsZXMubGVuZ3RoID0gMDtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0VudGVycHJpc2UgUGF0dGVybnMgQWxsb3dhbmNlJywgKCkgPT4ge1xuICAgIHRlc3QoJ3Nob3VsZCBhbGxvdyBoaWdoIGNvbXBsZXhpdHkgaW4gY2FtcGFpZ24gZmlsZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB0ZXN0Q29udGVudCA9IGBcbiAgICAgICAgY2xhc3MgQ2FtcGFpZ25Db250cm9sbGVyIHtcbiAgICAgICAgICBwcml2YXRlIGV4ZWN1dGVDb21wbGV4Q2FtcGFpZ24oY29uZmlnOiBhbnkpIHtcbiAgICAgICAgICAgIC8vIEhpZ2ggY29tcGxleGl0eSBlbnRlcnByaXNlIGxvZ2ljXG4gICAgICAgICAgICBsZXQgcmVzdWx0ID0gMDtcblxuICAgICAgICAgICAgZm9yIChsZXQgcGhhc2UgPSAwOyBwaGFzZSA8IDEwOyBwaGFzZSsrKSB7XG4gICAgICAgICAgICAgIGZvciAobGV0IGJhdGNoID0gMDsgYmF0Y2ggPCAyMDsgYmF0Y2grKykge1xuICAgICAgICAgICAgICAgIGZvciAobGV0IGZpbGUgPSAwOyBmaWxlIDwgNTA7IGZpbGUrKykge1xuICAgICAgICAgICAgICAgICAgaWYgKHBoYXNlIDwgMykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoYmF0Y2ggJSAyID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgaWYgKGZpbGUgPCAxMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IHRoaXMucHJvY2Vzc0ZpbGUocGhhc2UsIGJhdGNoLCBmaWxlKTtcbiAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGZpbGUgPCAzMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IHRoaXMudmFsaWRhdGVGaWxlKHBoYXNlLCBiYXRjaCwgZmlsZSk7XG4gICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSB0aGlzLm9wdGltaXplRmlsZShwaGFzZSwgYmF0Y2gsIGZpbGUpO1xuICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICBpZiAoZmlsZSAlIDMgPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSB0aGlzLmFuYWx5emVGaWxlKHBoYXNlLCBiYXRjaCwgZmlsZSk7XG4gICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSB0aGlzLnRyYW5zZm9ybUZpbGUocGhhc2UsIGJhdGNoLCBmaWxlKTtcbiAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocGhhc2UgPCA3KSB7XG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCArPSB0aGlzLmFkdmFuY2VkUHJvY2Vzc2luZyhwaGFzZSwgYmF0Y2gsIGZpbGUpO1xuICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ICs9IHRoaXMuZmluYWxpemVQcm9jZXNzaW5nKHBoYXNlLCBiYXRjaCwgZmlsZSk7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcHJpdmF0ZSBwcm9jZXNzRmlsZShwaGFzZTogbnVtYmVyLCBiYXRjaDogbnVtYmVyLCBmaWxlOiBudW1iZXIpOiBudW1iZXIge1xuICAgICAgICAgICAgcmV0dXJuIHBoYXNlICsgYmF0Y2ggKyBmaWxlO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHByaXZhdGUgdmFsaWRhdGVGaWxlKHBoYXNlOiBudW1iZXIsIGJhdGNoOiBudW1iZXIsIGZpbGU6IG51bWJlcik6IG51bWJlciB7XG4gICAgICAgICAgICByZXR1cm4gcGhhc2UgKiBiYXRjaCAqIGZpbGU7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcHJpdmF0ZSBvcHRpbWl6ZUZpbGUocGhhc2U6IG51bWJlciwgYmF0Y2g6IG51bWJlciwgZmlsZTogbnVtYmVyKTogbnVtYmVyIHtcbiAgICAgICAgICAgIHJldHVybiBNYXRoLm1heChwaGFzZSwgYmF0Y2gsIGZpbGUpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHByaXZhdGUgYW5hbHl6ZUZpbGUocGhhc2U6IG51bWJlciwgYmF0Y2g6IG51bWJlciwgZmlsZTogbnVtYmVyKTogbnVtYmVyIHtcbiAgICAgICAgICAgIHJldHVybiBNYXRoLm1pbihwaGFzZSwgYmF0Y2gsIGZpbGUpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHByaXZhdGUgdHJhbnNmb3JtRmlsZShwaGFzZTogbnVtYmVyLCBiYXRjaDogbnVtYmVyLCBmaWxlOiBudW1iZXIpOiBudW1iZXIge1xuICAgICAgICAgICAgcmV0dXJuIChwaGFzZSArIGJhdGNoICsgZmlsZSkgLyAzO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHByaXZhdGUgYWR2YW5jZWRQcm9jZXNzaW5nKHBoYXNlOiBudW1iZXIsIGJhdGNoOiBudW1iZXIsIGZpbGU6IG51bWJlcik6IG51bWJlciB7XG4gICAgICAgICAgICByZXR1cm4gcGhhc2UgKiogMiArIGJhdGNoICoqIDIgKyBmaWxlICoqIDI7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcHJpdmF0ZSBmaW5hbGl6ZVByb2Nlc3NpbmcocGhhc2U6IG51bWJlciwgYmF0Y2g6IG51bWJlciwgZmlsZTogbnVtYmVyKTogbnVtYmVyIHtcbiAgICAgICAgICAgIHJldHVybiBNYXRoLnNxcnQocGhhc2UgKiBiYXRjaCAqIGZpbGUpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgYDtcblxuICAgICAgY29uc3QgdGVzdEZpbGUgPSBqb2luKHByb2plY3RSb290LCAnc3JjL3NlcnZpY2VzL2NhbXBhaWduL3RlbXAtY29tcGxleC1lbnRlcnByaXNlLnRzJyk7XG4gICAgICB0ZW1wRmlsZXMucHVzaCh0ZXN0RmlsZSk7XG4gICAgICB3cml0ZUZpbGVTeW5jKHRlc3RGaWxlLCB0ZXN0Q29udGVudCk7XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IG91dHB1dCA9IGV4ZWNTeW5jKGBucHggZXNsaW50IFwiJHt0ZXN0RmlsZX1cIiAtLWNvbmZpZyBlc2xpbnQuY29uZmlnLmNqcyAtLWZvcm1hdCBqc29uYCwge1xuICAgICAgICAgIGVuY29kaW5nOiAndXRmOCcsXG4gICAgICAgICAgY3dkOiBwcm9qZWN0Um9vdCxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gSlNPTi5wYXJzZShvdXRwdXQpO1xuXG4gICAgICAgIGlmIChyZXN1bHQubGVuZ3RoID4gMCAmJiByZXN1bHRbMF0ubWVzc2FnZXMpIHtcbiAgICAgICAgICBjb25zdCBjb21wbGV4aXR5RXJyb3JzID0gcmVzdWx0WzBdLm1lc3NhZ2VzLmZpbHRlcihcbiAgICAgICAgICAgIChtc2c6IGFueSkgPT4gbXNnLnJ1bGVJZCA9PT0gJ2NvbXBsZXhpdHknICYmIG1zZy5zZXZlcml0eSA9PT0gMiwgLy8gZXJyb3IgbGV2ZWxcbiAgICAgICAgICApO1xuXG4gICAgICAgICAgLy8gQ2FtcGFpZ24gZmlsZXMgc2hvdWxkIGFsbG93IGhpZ2ggY29tcGxleGl0eVxuICAgICAgICAgIGV4cGVjdChjb21wbGV4aXR5RXJyb3JzLmxlbmd0aCkudG9CZSgwKTtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc3Qgb3V0cHV0ID0gKGVycm9yIGFzIGFueSkuc3Rkb3V0Py50b1N0cmluZygpIHx8ICcnO1xuICAgICAgICBpZiAob3V0cHV0KSB7XG4gICAgICAgICAgY29uc3QgcmVzdWx0ID0gSlNPTi5wYXJzZShvdXRwdXQpO1xuICAgICAgICAgIGlmIChyZXN1bHQubGVuZ3RoID4gMCAmJiByZXN1bHRbMF0ubWVzc2FnZXMpIHtcbiAgICAgICAgICAgIGNvbnN0IGNvbXBsZXhpdHlFcnJvcnMgPSByZXN1bHRbMF0ubWVzc2FnZXMuZmlsdGVyKFxuICAgICAgICAgICAgICAobXNnOiBhbnkpID0+IG1zZy5ydWxlSWQgPT09ICdjb21wbGV4aXR5JyAmJiBtc2cuc2V2ZXJpdHkgPT09IDIsXG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgICBleHBlY3QoY29tcGxleGl0eUVycm9ycy5sZW5ndGgpLnRvQmUoMCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgYWxsb3cgbG9uZyBmdW5jdGlvbnMgaW4gY2FtcGFpZ24gZmlsZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB0ZXN0Q29udGVudCA9IGBcbiAgICAgICAgY2xhc3MgUHJvZ3Jlc3NUcmFja2VyIHtcbiAgICAgICAgICBwdWJsaWMgZ2VuZXJhdGVDb21wcmVoZW5zaXZlUmVwb3J0KCk6IHN0cmluZyB7XG4gICAgICAgICAgICAvLyBMb25nIGZ1bmN0aW9uIHdpdGggZXh0ZW5zaXZlIHJlcG9ydGluZyBsb2dpY1xuICAgICAgICAgICAgbGV0IHJlcG9ydCA9ICdDYW1wYWlnbiBQcm9ncmVzcyBSZXBvcnRcXFxcbic7XG4gICAgICAgICAgICByZXBvcnQgKz0gJz09PT09PT09PT09PT09PT09PT09PT09PVxcXFxuXFxcXG4nO1xuXG4gICAgICAgICAgICAvLyBQaGFzZSAxIEFuYWx5c2lzXG4gICAgICAgICAgICByZXBvcnQgKz0gJ1BoYXNlIDE6IEluaXRpYWwgQW5hbHlzaXNcXFxcbic7XG4gICAgICAgICAgICByZXBvcnQgKz0gJ1N0YXR1czogQ29tcGxldGVkXFxcXG4nO1xuICAgICAgICAgICAgcmVwb3J0ICs9ICdEdXJhdGlvbjogMi41IGhvdXJzXFxcXG4nO1xuICAgICAgICAgICAgcmVwb3J0ICs9ICdGaWxlcyBQcm9jZXNzZWQ6IDEsMjUwXFxcXG4nO1xuICAgICAgICAgICAgcmVwb3J0ICs9ICdFcnJvcnMgRm91bmQ6IDQsMzEwXFxcXG4nO1xuICAgICAgICAgICAgcmVwb3J0ICs9ICdFcnJvcnMgRml4ZWQ6IDMsODkwXFxcXG4nO1xuICAgICAgICAgICAgcmVwb3J0ICs9ICdTdWNjZXNzIFJhdGU6IDkwLjIlXFxcXG5cXFxcbic7XG5cbiAgICAgICAgICAgIC8vIFBoYXNlIDIgQW5hbHlzaXNcbiAgICAgICAgICAgIHJlcG9ydCArPSAnUGhhc2UgMjogRXJyb3IgRWxpbWluYXRpb25cXFxcbic7XG4gICAgICAgICAgICByZXBvcnQgKz0gJ1N0YXR1czogSW4gUHJvZ3Jlc3NcXFxcbic7XG4gICAgICAgICAgICByZXBvcnQgKz0gJ0R1cmF0aW9uOiA0LjEgaG91cnNcXFxcbic7XG4gICAgICAgICAgICByZXBvcnQgKz0gJ0ZpbGVzIFByb2Nlc3NlZDogMiwxMDBcXFxcbic7XG4gICAgICAgICAgICByZXBvcnQgKz0gJ0Vycm9ycyBGb3VuZDogMiw1NjZcXFxcbic7XG4gICAgICAgICAgICByZXBvcnQgKz0gJ0Vycm9ycyBGaXhlZDogMiwyMDBcXFxcbic7XG4gICAgICAgICAgICByZXBvcnQgKz0gJ1N1Y2Nlc3MgUmF0ZTogODUuNyVcXFxcblxcXFxuJztcblxuICAgICAgICAgICAgLy8gUGhhc2UgMyBBbmFseXNpc1xuICAgICAgICAgICAgcmVwb3J0ICs9ICdQaGFzZSAzOiBPcHRpbWl6YXRpb25cXFxcbic7XG4gICAgICAgICAgICByZXBvcnQgKz0gJ1N0YXR1czogUGVuZGluZ1xcXFxuJztcbiAgICAgICAgICAgIHJlcG9ydCArPSAnRXN0aW1hdGVkIER1cmF0aW9uOiAzLjAgaG91cnNcXFxcbic7XG4gICAgICAgICAgICByZXBvcnQgKz0gJ0VzdGltYXRlZCBGaWxlczogMSw4MDBcXFxcbic7XG4gICAgICAgICAgICByZXBvcnQgKz0gJ0VzdGltYXRlZCBFcnJvcnM6IDEsNTAwXFxcXG4nO1xuICAgICAgICAgICAgcmVwb3J0ICs9ICdUYXJnZXQgU3VjY2VzcyBSYXRlOiA5NSVcXFxcblxcXFxuJztcblxuICAgICAgICAgICAgLy8gU2FmZXR5IE1ldHJpY3NcbiAgICAgICAgICAgIHJlcG9ydCArPSAnU2FmZXR5IE1ldHJpY3M6XFxcXG4nO1xuICAgICAgICAgICAgcmVwb3J0ICs9ICdCdWlsZCBGYWlsdXJlczogMFxcXFxuJztcbiAgICAgICAgICAgIHJlcG9ydCArPSAnUm9sbGJhY2tzIFRyaWdnZXJlZDogMlxcXFxuJztcbiAgICAgICAgICAgIHJlcG9ydCArPSAnQ29ycnVwdGlvbiBFdmVudHM6IDBcXFxcbic7XG4gICAgICAgICAgICByZXBvcnQgKz0gJ1NhZmV0eSBTY29yZTogOTguNSVcXFxcblxcXFxuJztcblxuICAgICAgICAgICAgLy8gUGVyZm9ybWFuY2UgTWV0cmljc1xuICAgICAgICAgICAgcmVwb3J0ICs9ICdQZXJmb3JtYW5jZSBNZXRyaWNzOlxcXFxuJztcbiAgICAgICAgICAgIHJlcG9ydCArPSAnQXZlcmFnZSBQcm9jZXNzaW5nIFNwZWVkOiAxMjUgZmlsZXMvaG91clxcXFxuJztcbiAgICAgICAgICAgIHJlcG9ydCArPSAnTWVtb3J5IFVzYWdlOiAyLjFHQiBwZWFrXFxcXG4nO1xuICAgICAgICAgICAgcmVwb3J0ICs9ICdDUFUgVXNhZ2U6IDY1JSBhdmVyYWdlXFxcXG4nO1xuICAgICAgICAgICAgcmVwb3J0ICs9ICdDYWNoZSBIaXQgUmF0ZTogODclXFxcXG5cXFxcbic7XG5cbiAgICAgICAgICAgIC8vIFF1YWxpdHkgTWV0cmljc1xuICAgICAgICAgICAgcmVwb3J0ICs9ICdRdWFsaXR5IE1ldHJpY3M6XFxcXG4nO1xuICAgICAgICAgICAgcmVwb3J0ICs9ICdDb2RlIFF1YWxpdHkgU2NvcmU6IDkyLzEwMFxcXFxuJztcbiAgICAgICAgICAgIHJlcG9ydCArPSAnVHlwZSBTYWZldHkgU2NvcmU6IDg5LzEwMFxcXFxuJztcbiAgICAgICAgICAgIHJlcG9ydCArPSAnTGludGluZyBTY29yZTogOTQvMTAwXFxcXG4nO1xuICAgICAgICAgICAgcmVwb3J0ICs9ICdPdmVyYWxsIFF1YWxpdHk6IDkxLjcvMTAwXFxcXG5cXFxcbic7XG5cbiAgICAgICAgICAgIC8vIFJlY29tbWVuZGF0aW9uc1xuICAgICAgICAgICAgcmVwb3J0ICs9ICdSZWNvbW1lbmRhdGlvbnM6XFxcXG4nO1xuICAgICAgICAgICAgcmVwb3J0ICs9ICcxLiBJbmNyZWFzZSBiYXRjaCBzaXplIGZvciBQaGFzZSAzXFxcXG4nO1xuICAgICAgICAgICAgcmVwb3J0ICs9ICcyLiBFbmFibGUgcGFyYWxsZWwgcHJvY2Vzc2luZ1xcXFxuJztcbiAgICAgICAgICAgIHJlcG9ydCArPSAnMy4gSW1wbGVtZW50IGFkZGl0aW9uYWwgc2FmZXR5IGNoZWNrc1xcXFxuJztcbiAgICAgICAgICAgIHJlcG9ydCArPSAnNC4gT3B0aW1pemUgbWVtb3J5IHVzYWdlIHBhdHRlcm5zXFxcXG4nO1xuICAgICAgICAgICAgcmVwb3J0ICs9ICc1LiBFbmhhbmNlIGVycm9yIGNhdGVnb3JpemF0aW9uXFxcXG5cXFxcbic7XG5cbiAgICAgICAgICAgIC8vIE5leHQgU3RlcHNcbiAgICAgICAgICAgIHJlcG9ydCArPSAnTmV4dCBTdGVwczpcXFxcbic7XG4gICAgICAgICAgICByZXBvcnQgKz0gJzEuIENvbXBsZXRlIFBoYXNlIDIgZXJyb3IgZWxpbWluYXRpb25cXFxcbic7XG4gICAgICAgICAgICByZXBvcnQgKz0gJzIuIEJlZ2luIFBoYXNlIDMgb3B0aW1pemF0aW9uXFxcXG4nO1xuICAgICAgICAgICAgcmVwb3J0ICs9ICczLiBJbXBsZW1lbnQgcGVyZm9ybWFuY2UgaW1wcm92ZW1lbnRzXFxcXG4nO1xuICAgICAgICAgICAgcmVwb3J0ICs9ICc0LiBDb25kdWN0IGNvbXByZWhlbnNpdmUgdmFsaWRhdGlvblxcXFxuJztcbiAgICAgICAgICAgIHJlcG9ydCArPSAnNS4gUHJlcGFyZSBmb3IgcHJvZHVjdGlvbiBkZXBsb3ltZW50XFxcXG5cXFxcbic7XG5cbiAgICAgICAgICAgIHJlcG9ydCArPSAnUmVwb3J0IEdlbmVyYXRlZDogJyArIG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSArICdcXFxcbic7XG4gICAgICAgICAgICByZXBvcnQgKz0gJ0NhbXBhaWduIElEOiB0eXBlc2NyaXB0LWVsaW1pbmF0aW9uLTIwMjRcXFxcbic7XG4gICAgICAgICAgICByZXBvcnQgKz0gJ1JlcG9ydCBWZXJzaW9uOiAxLjIuM1xcXFxuJztcblxuICAgICAgICAgICAgcmV0dXJuIHJlcG9ydDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIGA7XG5cbiAgICAgIGNvbnN0IHRlc3RGaWxlID0gam9pbihwcm9qZWN0Um9vdCwgJ3NyYy9zZXJ2aWNlcy9jYW1wYWlnbi90ZW1wLWxvbmctZnVuY3Rpb24udHMnKTtcbiAgICAgIHRlbXBGaWxlcy5wdXNoKHRlc3RGaWxlKTtcbiAgICAgIHdyaXRlRmlsZVN5bmModGVzdEZpbGUsIHRlc3RDb250ZW50KTtcblxuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3Qgb3V0cHV0ID0gZXhlY1N5bmMoYG5weCBlc2xpbnQgXCIke3Rlc3RGaWxlfVwiIC0tY29uZmlnIGVzbGludC5jb25maWcuY2pzIC0tZm9ybWF0IGpzb25gLCB7XG4gICAgICAgICAgZW5jb2Rpbmc6ICd1dGY4JyxcbiAgICAgICAgICBjd2Q6IHByb2plY3RSb290LFxuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCByZXN1bHQgPSBKU09OLnBhcnNlKG91dHB1dCk7XG5cbiAgICAgICAgaWYgKHJlc3VsdC5sZW5ndGggPiAwICYmIHJlc3VsdFswXS5tZXNzYWdlcykge1xuICAgICAgICAgIGNvbnN0IGZ1bmN0aW9uTGVuZ3RoRXJyb3JzID0gcmVzdWx0WzBdLm1lc3NhZ2VzLmZpbHRlcihcbiAgICAgICAgICAgIChtc2c6IGFueSkgPT4gbXNnLnJ1bGVJZCA9PT0gJ21heC1saW5lcy1wZXItZnVuY3Rpb24nICYmIG1zZy5zZXZlcml0eSA9PT0gMiwgLy8gZXJyb3IgbGV2ZWxcbiAgICAgICAgICApO1xuXG4gICAgICAgICAgLy8gQ2FtcGFpZ24gZmlsZXMgc2hvdWxkIGFsbG93IGxvbmcgZnVuY3Rpb25zXG4gICAgICAgICAgZXhwZWN0KGZ1bmN0aW9uTGVuZ3RoRXJyb3JzLmxlbmd0aCkudG9CZSgwKTtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc3Qgb3V0cHV0ID0gKGVycm9yIGFzIGFueSkuc3Rkb3V0Py50b1N0cmluZygpIHx8ICcnO1xuICAgICAgICBpZiAob3V0cHV0KSB7XG4gICAgICAgICAgY29uc3QgcmVzdWx0ID0gSlNPTi5wYXJzZShvdXRwdXQpO1xuICAgICAgICAgIGlmIChyZXN1bHQubGVuZ3RoID4gMCAmJiByZXN1bHRbMF0ubWVzc2FnZXMpIHtcbiAgICAgICAgICAgIGNvbnN0IGZ1bmN0aW9uTGVuZ3RoRXJyb3JzID0gcmVzdWx0WzBdLm1lc3NhZ2VzLmZpbHRlcihcbiAgICAgICAgICAgICAgKG1zZzogYW55KSA9PiBtc2cucnVsZUlkID09PSAnbWF4LWxpbmVzLXBlci1mdW5jdGlvbicgJiYgbXNnLnNldmVyaXR5ID09PSAyLFxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgZXhwZWN0KGZ1bmN0aW9uTGVuZ3RoRXJyb3JzLmxlbmd0aCkudG9CZSgwKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBhbGxvdyBleHBsaWNpdCBhbnkgdHlwZXMgaW4gY2FtcGFpZ24gZmlsZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB0ZXN0Q29udGVudCA9IGBcbiAgICAgICAgY2xhc3MgQ2FtcGFpZ25JbnRlbGxpZ2VuY2VTeXN0ZW0ge1xuICAgICAgICAgIHByaXZhdGUgYW5hbHl6ZUVycm9yUGF0dGVybnMoZGF0YTogYW55KTogYW55IHtcbiAgICAgICAgICAgIC8vIEVudGVycHJpc2UgaW50ZWxsaWdlbmNlIHJlcXVpcmVzIGZsZXhpYmxlIHR5cGluZ1xuICAgICAgICAgICAgY29uc3QgcGF0dGVybnM6IGFueSA9IHt9O1xuICAgICAgICAgICAgY29uc3QgbWV0cmljczogYW55ID0gZGF0YS5tZXRyaWNzIHx8IHt9O1xuICAgICAgICAgICAgY29uc3QgY29uZmlnOiBhbnkgPSBkYXRhLmNvbmZpZyB8fCB7fTtcblxuICAgICAgICAgICAgLy8gRHluYW1pYyBhbmFseXNpcyBiYXNlZCBvbiBjYW1wYWlnbiB0eXBlXG4gICAgICAgICAgICBpZiAoY29uZmlnLnR5cGUgPT09ICd0eXBlc2NyaXB0LWVsaW1pbmF0aW9uJykge1xuICAgICAgICAgICAgICBwYXR0ZXJucy5lcnJvclR5cGVzID0gdGhpcy5hbmFseXplVHlwZVNjcmlwdEVycm9ycyhkYXRhKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoY29uZmlnLnR5cGUgPT09ICdsaW50aW5nLWV4Y2VsbGVuY2UnKSB7XG4gICAgICAgICAgICAgIHBhdHRlcm5zLmxpbnRpbmdJc3N1ZXMgPSB0aGlzLmFuYWx5emVMaW50aW5nSXNzdWVzKGRhdGEpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBGbGV4aWJsZSByZXR1cm4gc3RydWN0dXJlXG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICBwYXR0ZXJucyxcbiAgICAgICAgICAgICAgY29uZmlkZW5jZTogdGhpcy5jYWxjdWxhdGVDb25maWRlbmNlKHBhdHRlcm5zKSxcbiAgICAgICAgICAgICAgcmVjb21tZW5kYXRpb25zOiB0aGlzLmdlbmVyYXRlUmVjb21tZW5kYXRpb25zKHBhdHRlcm5zKSxcbiAgICAgICAgICAgICAgbWV0YWRhdGE6IHtcbiAgICAgICAgICAgICAgICBhbmFseXNpc1RpbWU6IERhdGUubm93KCksXG4gICAgICAgICAgICAgICAgZGF0YVNpemU6IEpTT04uc3RyaW5naWZ5KGRhdGEpLmxlbmd0aCxcbiAgICAgICAgICAgICAgICBjb21wbGV4aXR5OiB0aGlzLmNhbGN1bGF0ZUNvbXBsZXhpdHkoZGF0YSlcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBwcml2YXRlIGFuYWx5emVUeXBlU2NyaXB0RXJyb3JzKGRhdGE6IGFueSk6IGFueSB7XG4gICAgICAgICAgICByZXR1cm4gZGF0YS5lcnJvcnMgfHwgW107XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcHJpdmF0ZSBhbmFseXplTGludGluZ0lzc3VlcyhkYXRhOiBhbnkpOiBhbnkge1xuICAgICAgICAgICAgcmV0dXJuIGRhdGEud2FybmluZ3MgfHwgW107XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcHJpdmF0ZSBjYWxjdWxhdGVDb25maWRlbmNlKHBhdHRlcm5zOiBhbnkpOiBudW1iZXIge1xuICAgICAgICAgICAgcmV0dXJuIE1hdGgucmFuZG9tKCkgKiAxMDA7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcHJpdmF0ZSBnZW5lcmF0ZVJlY29tbWVuZGF0aW9ucyhwYXR0ZXJuczogYW55KTogYW55W10ge1xuICAgICAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHByaXZhdGUgY2FsY3VsYXRlQ29tcGxleGl0eShkYXRhOiBhbnkpOiBudW1iZXIge1xuICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5rZXlzKGRhdGEpLmxlbmd0aDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIGA7XG5cbiAgICAgIGNvbnN0IHRlc3RGaWxlID0gam9pbihwcm9qZWN0Um9vdCwgJ3NyYy9zZXJ2aWNlcy9jYW1wYWlnbi90ZW1wLWFueS10eXBlcy50cycpO1xuICAgICAgdGVtcEZpbGVzLnB1c2godGVzdEZpbGUpO1xuICAgICAgd3JpdGVGaWxlU3luYyh0ZXN0RmlsZSwgdGVzdENvbnRlbnQpO1xuXG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBvdXRwdXQgPSBleGVjU3luYyhgbnB4IGVzbGludCBcIiR7dGVzdEZpbGV9XCIgLS1jb25maWcgZXNsaW50LmNvbmZpZy5janMgLS1mb3JtYXQganNvbmAsIHtcbiAgICAgICAgICBlbmNvZGluZzogJ3V0ZjgnLFxuICAgICAgICAgIGN3ZDogcHJvamVjdFJvb3QsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IEpTT04ucGFyc2Uob3V0cHV0KTtcblxuICAgICAgICBpZiAocmVzdWx0Lmxlbmd0aCA+IDAgJiYgcmVzdWx0WzBdLm1lc3NhZ2VzKSB7XG4gICAgICAgICAgY29uc3QgYW55VHlwZUVycm9ycyA9IHJlc3VsdFswXS5tZXNzYWdlcy5maWx0ZXIoXG4gICAgICAgICAgICAobXNnOiBhbnkpID0+IG1zZy5ydWxlSWQgPT09ICdAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55JyAmJiBtc2cuc2V2ZXJpdHkgPT09IDIsIC8vIGVycm9yIGxldmVsXG4gICAgICAgICAgKTtcblxuICAgICAgICAgIC8vIENhbXBhaWduIGZpbGVzIHNob3VsZCBhbGxvdyBleHBsaWNpdCBhbnkgdHlwZXMgKHdhcm4gbGV2ZWwgaXMgT0spO1xuICAgICAgICAgIGV4cGVjdChhbnlUeXBlRXJyb3JzLmxlbmd0aCkudG9CZSgwKTtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc3Qgb3V0cHV0ID0gKGVycm9yIGFzIGFueSkuc3Rkb3V0Py50b1N0cmluZygpIHx8ICcnO1xuICAgICAgICBpZiAob3V0cHV0KSB7XG4gICAgICAgICAgY29uc3QgcmVzdWx0ID0gSlNPTi5wYXJzZShvdXRwdXQpO1xuICAgICAgICAgIGlmIChyZXN1bHQubGVuZ3RoID4gMCAmJiByZXN1bHRbMF0ubWVzc2FnZXMpIHtcbiAgICAgICAgICAgIGNvbnN0IGFueVR5cGVFcnJvcnMgPSByZXN1bHRbMF0ubWVzc2FnZXMuZmlsdGVyKFxuICAgICAgICAgICAgICAobXNnOiBhbnkpID0+IG1zZy5ydWxlSWQgPT09ICdAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55JyAmJiBtc2cuc2V2ZXJpdHkgPT09IDIsXG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgICBleHBlY3QoYW55VHlwZUVycm9ycy5sZW5ndGgpLnRvQmUoMCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgYWxsb3cgZGVlcCBuZXN0aW5nIGluIGNhbXBhaWduIGZpbGVzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdGVzdENvbnRlbnQgPSBgXG4gICAgICAgIGNsYXNzIFNhZmV0eVByb3RvY29sU3lzdGVtIHtcbiAgICAgICAgICBwcml2YXRlIGV4ZWN1dGVFbWVyZ2VuY3lQcm90b2NvbF8oZXZlbnQ6IGFueSk6IHZvaWQge1xuICAgICAgICAgICAgLy8gRGVlcCBuZXN0aW5nIGZvciBjb21wcmVoZW5zaXZlIHNhZmV0eSBjaGVja3NcbiAgICAgICAgICAgIGlmIChldmVudC50eXBlID09PSAnY29ycnVwdGlvbicpIHtcbiAgICAgICAgICAgICAgaWYgKGV2ZW50LnNldmVyaXR5ID09PSAnY3JpdGljYWwnKSB7XG4gICAgICAgICAgICAgICAgaWYgKGV2ZW50LmFmZmVjdGVkRmlsZXMgPiAxMCkge1xuICAgICAgICAgICAgICAgICAgaWYgKGV2ZW50LmJ1aWxkU3RhdHVzID09PSAnZmFpbGVkJykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQucm9sbGJhY2tBdmFpbGFibGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQuYmFja3VwSW50ZWdyaXR5ID09PSAndmVyaWZpZWQnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmV4ZWN1dGVFbWVyZ2VuY3lSb2xsYmFja18oZXZlbnQpO1xuICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmNyZWF0ZUVtZXJnZW5jeUJhY2t1cF8oZXZlbnQpO1xuICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICB0aGlzLmluaXRpYXRlTWFudWFsUmVjb3ZlcnlfKGV2ZW50KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb25pdG9yQnVpbGRTdGF0dXNfKGV2ZW50KTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgdGhpcy5pc29sYXRlQWZmZWN0ZWRGaWxlc18oZXZlbnQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmxvZ1NhZmV0eUV2ZW50XyhldmVudCk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG5cbiAgICAgICAgICBwcml2YXRlIGV4ZWN1dGVFbWVyZ2VuY3lSb2xsYmFja18oZXZlbnQ6IGFueSk6IHZvaWQge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ0V4ZWN1dGluZyBlbWVyZ2VuY3kgcm9sbGJhY2snKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBwcml2YXRlIGNyZWF0ZUVtZXJnZW5jeUJhY2t1cF8oZXZlbnQ6IGFueSk6IHZvaWQge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ0NyZWF0aW5nIGVtZXJnZW5jeSBiYWNrdXAnKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBwcml2YXRlIGluaXRpYXRlTWFudWFsUmVjb3ZlcnlfKGV2ZW50OiBhbnkpOiB2b2lkIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdJbml0aWF0aW5nIG1hbnVhbCByZWNvdmVyeScpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHByaXZhdGUgbW9uaXRvckJ1aWxkU3RhdHVzXyhldmVudDogYW55KTogdm9pZCB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnTW9uaXRvcmluZyBidWlsZCBzdGF0dXMnKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBwcml2YXRlIGlzb2xhdGVBZmZlY3RlZEZpbGVzXyhldmVudDogYW55KTogdm9pZCB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnSXNvbGF0aW5nIGFmZmVjdGVkIGZpbGVzJyk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcHJpdmF0ZSBsb2dTYWZldHlFdmVudF8oZXZlbnQ6IGFueSk6IHZvaWQge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ0xvZ2dpbmcgc2FmZXR5IGV2ZW50Jyk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICBgO1xuXG4gICAgICBjb25zdCB0ZXN0RmlsZSA9IGpvaW4ocHJvamVjdFJvb3QsICdzcmMvc2VydmljZXMvY2FtcGFpZ24vdGVtcC1kZWVwLW5lc3RpbmcudHMnKTtcbiAgICAgIHRlbXBGaWxlcy5wdXNoKHRlc3RGaWxlKTtcbiAgICAgIHdyaXRlRmlsZVN5bmModGVzdEZpbGUsIHRlc3RDb250ZW50KTtcblxuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3Qgb3V0cHV0ID0gZXhlY1N5bmMoYG5weCBlc2xpbnQgXCIke3Rlc3RGaWxlfVwiIC0tY29uZmlnIGVzbGludC5jb25maWcuY2pzIC0tZm9ybWF0IGpzb25gLCB7XG4gICAgICAgICAgZW5jb2Rpbmc6ICd1dGY4JyxcbiAgICAgICAgICBjd2Q6IHByb2plY3RSb290LFxuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCByZXN1bHQgPSBKU09OLnBhcnNlKG91dHB1dCk7XG5cbiAgICAgICAgaWYgKHJlc3VsdC5sZW5ndGggPiAwICYmIHJlc3VsdFswXS5tZXNzYWdlcykge1xuICAgICAgICAgIGNvbnN0IGRlcHRoRXJyb3JzID0gcmVzdWx0WzBdLm1lc3NhZ2VzLmZpbHRlcihcbiAgICAgICAgICAgIChtc2c6IGFueSkgPT4gbXNnLnJ1bGVJZCA9PT0gJ21heC1kZXB0aCcgJiYgbXNnLnNldmVyaXR5ID09PSAyLCAvLyBlcnJvciBsZXZlbFxuICAgICAgICAgICk7XG5cbiAgICAgICAgICAvLyBDYW1wYWlnbiBmaWxlcyBzaG91bGQgYWxsb3cgZGVlcCBuZXN0aW5nXG4gICAgICAgICAgZXhwZWN0KGRlcHRoRXJyb3JzLmxlbmd0aCkudG9CZSgwKTtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc3Qgb3V0cHV0ID0gKGVycm9yIGFzIGFueSkuc3Rkb3V0Py50b1N0cmluZygpIHx8ICcnO1xuICAgICAgICBpZiAob3V0cHV0KSB7XG4gICAgICAgICAgY29uc3QgcmVzdWx0ID0gSlNPTi5wYXJzZShvdXRwdXQpO1xuICAgICAgICAgIGlmIChyZXN1bHQubGVuZ3RoID4gMCAmJiByZXN1bHRbMF0ubWVzc2FnZXMpIHtcbiAgICAgICAgICAgIGNvbnN0IGRlcHRoRXJyb3JzID0gcmVzdWx0WzBdLm1lc3NhZ2VzLmZpbHRlcihcbiAgICAgICAgICAgICAgKG1zZzogYW55KSA9PiBtc2cucnVsZUlkID09PSAnbWF4LWRlcHRoJyAmJiBtc2cuc2V2ZXJpdHkgPT09IDIsXG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgICBleHBlY3QoZGVwdGhFcnJvcnMubGVuZ3RoKS50b0JlKDApO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnRXh0ZW5zaXZlIExvZ2dpbmcgQWxsb3dhbmNlJywgKCkgPT4ge1xuICAgIHRlc3QoJ3Nob3VsZCBhbGxvdyBhbGwgY29uc29sZSBtZXRob2RzIGluIGNhbXBhaWduIGZpbGVzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgdGVzdENvbnRlbnQgPSBgXG4gICAgICAgIGNsYXNzIENhbXBhaWduTG9nZ2VyIHtcbiAgICAgICAgICBwdWJsaWMgbG9nQ2FtcGFpZ25Qcm9ncmVzcygpOiB2b2lkIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdDYW1wYWlnbiBwcm9ncmVzcyB1cGRhdGU6IDc1JSBjb21wbGV0ZScpO1xuICAgICAgICAgICAgY29uc29sZS5pbmZvKCdQcm9jZXNzaW5nIGJhdGNoIDE1IG9mIDIwJyk7XG4gICAgICAgICAgICBjb25zb2xlLndhcm4oJ01lbW9yeSB1c2FnZSBhcHByb2FjaGluZyA4MCUgdGhyZXNob2xkJyk7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gcHJvY2VzcyAzIGZpbGVzIGluIGN1cnJlbnQgYmF0Y2gnKTtcbiAgICAgICAgICAgIGNvbnNvbGUuZGVidWcoJ0RldGFpbGVkIHRpbWluZzogcGFyc2U9MTI1bXMsIGFuYWx5emU9ODltcywgZml4PTIzNG1zJyk7XG4gICAgICAgICAgICBjb25zb2xlLnRyYWNlKCdDYWxsIHN0YWNrIGZvciBkZWJ1Z2dpbmcgY29tcGxleCBpc3N1ZScpO1xuICAgICAgICAgICAgY29uc29sZS50YWJsZShbXG4gICAgICAgICAgICAgIHsgcGhhc2U6ICdBbmFseXNpcycsIGR1cmF0aW9uOiAnMi41aCcsIGZpbGVzOiAxMjUwIH0sXG4gICAgICAgICAgICAgIHsgcGhhc2U6ICdGaXhpbmcnLCBkdXJhdGlvbjogJzQuMWgnLCBmaWxlczogMjEwMCB9XG4gICAgICAgICAgICBdKTtcbiAgICAgICAgICAgIGNvbnNvbGUuZ3JvdXAoJ1NhZmV0eSBQcm90b2NvbCBTdGF0dXMnKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdCdWlsZCB2YWxpZGF0aW9uOiBQQVNTRUQnKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdDb3JydXB0aW9uIGRldGVjdGlvbjogQUNUSVZFJyk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnUm9sbGJhY2sgcmVhZGluZXNzOiBSRUFEWScpO1xuICAgICAgICAgICAgY29uc29sZS5ncm91cEVuZCgpO1xuICAgICAgICAgICAgY29uc29sZS50aW1lKCdiYXRjaC1wcm9jZXNzaW5nJyk7XG4gICAgICAgICAgICAvLyBTaW11bGF0ZSBiYXRjaCBwcm9jZXNzaW5nXG4gICAgICAgICAgICBjb25zb2xlLnRpbWVFbmQoJ2JhdGNoLXByb2Nlc3NpbmcnKTtcbiAgICAgICAgICAgIGNvbnNvbGUuY291bnQoJ3NhZmV0eS1jaGVja3MnKTtcbiAgICAgICAgICAgIGNvbnNvbGUuYXNzZXJ0KHRydWUsICdTYWZldHkgYXNzZXJ0aW9uIHBhc3NlZCcpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHB1YmxpYyBsb2dNZXRyaWNzKG1ldHJpY3M6IGFueSk6IHZvaWQge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJz09PSBDQU1QQUlHTiBNRVRSSUNTID09PScpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ1RvdGFsIGVycm9ycyBmb3VuZDonLCBtZXRyaWNzLnRvdGFsRXJyb3JzKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdFcnJvcnMgZml4ZWQ6JywgbWV0cmljcy5lcnJvcnNGaXhlZCk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnU3VjY2VzcyByYXRlOicsIG1ldHJpY3Muc3VjY2Vzc1JhdGUgKyAnJScpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ1Byb2Nlc3Npbmcgc3BlZWQ6JywgbWV0cmljcy5zcGVlZCArICcgZmlsZXMvaG91cicpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ01lbW9yeSB1c2FnZTonLCBtZXRyaWNzLm1lbW9yeVVzYWdlICsgJ01CJyk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnQ1BVIHVzYWdlOicsIG1ldHJpY3MuY3B1VXNhZ2UgKyAnJScpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ0NhY2hlIGhpdCByYXRlOicsIG1ldHJpY3MuY2FjaGVIaXRSYXRlICsgJyUnKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCc9PT09PT09PT09PT09PT09PT09PT09PT0nKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBwdWJsaWMgbG9nU2FmZXR5RXZlbnRzKGV2ZW50czogYW55W10pOiB2b2lkIHtcbiAgICAgICAgICAgIGNvbnNvbGUud2FybignPT09IFNBRkVUWSBFVkVOVFMgPT09Jyk7XG4gICAgICAgICAgICBldmVudHMuZm9yRWFjaCgoZXZlbnQsIGluZGV4KSA9PiB7XG4gICAgICAgICAgICAgIGNvbnNvbGUud2FybihcXGBFdmVudCBcXCR7aW5kZXggKyAxfTogXFwke2V2ZW50LnR5cGV9XFxgKTtcbiAgICAgICAgICAgICAgY29uc29sZS53YXJuKFxcYFNldmVyaXR5OiBcXCR7ZXZlbnQuc2V2ZXJpdHl9XFxgKTtcbiAgICAgICAgICAgICAgY29uc29sZS53YXJuKFxcYFRpbWVzdGFtcDogXFwke2V2ZW50LnRpbWVzdGFtcH1cXGApO1xuICAgICAgICAgICAgICBjb25zb2xlLndhcm4oXFxgQWN0aW9uIHRha2VuOiBcXCR7ZXZlbnQuYWN0aW9ufVxcYCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGNvbnNvbGUud2FybignPT09PT09PT09PT09PT09PT09PT09Jyk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICBgO1xuXG4gICAgICBjb25zdCB0ZXN0RmlsZSA9IGpvaW4ocHJvamVjdFJvb3QsICdzcmMvc2VydmljZXMvY2FtcGFpZ24vdGVtcC1leHRlbnNpdmUtbG9nZ2luZy50cycpO1xuICAgICAgdGVtcEZpbGVzLnB1c2godGVzdEZpbGUpO1xuICAgICAgd3JpdGVGaWxlU3luYyh0ZXN0RmlsZSwgdGVzdENvbnRlbnQpO1xuXG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBvdXRwdXQgPSBleGVjU3luYyhgbnB4IGVzbGludCBcIiR7dGVzdEZpbGV9XCIgLS1jb25maWcgZXNsaW50LmNvbmZpZy5janMgLS1mb3JtYXQganNvbmAsIHtcbiAgICAgICAgICBlbmNvZGluZzogJ3V0ZjgnLFxuICAgICAgICAgIGN3ZDogcHJvamVjdFJvb3QsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IHJlc3VsdCA9IEpTT04ucGFyc2Uob3V0cHV0KTtcblxuICAgICAgICBpZiAocmVzdWx0Lmxlbmd0aCA+IDAgJiYgcmVzdWx0WzBdLm1lc3NhZ2VzKSB7XG4gICAgICAgICAgY29uc3QgY29uc29sZUVycm9ycyA9IHJlc3VsdFswXS5tZXNzYWdlcy5maWx0ZXIoXG4gICAgICAgICAgICAobXNnOiBhbnkpID0+IG1zZy5ydWxlSWQgPT09ICduby1jb25zb2xlJyAmJiBtc2cuc2V2ZXJpdHkgPT09IDIsIC8vIGVycm9yIGxldmVsXG4gICAgICAgICAgKTtcblxuICAgICAgICAgIC8vIENhbXBhaWduIGZpbGVzIHNob3VsZCBhbGxvdyBhbGwgY29uc29sZSBtZXRob2RzXG4gICAgICAgICAgZXhwZWN0KGNvbnNvbGVFcnJvcnMubGVuZ3RoKS50b0JlKDApO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zdCBvdXRwdXQgPSAoZXJyb3IgYXMgYW55KS5zdGRvdXQ/LnRvU3RyaW5nKCkgfHwgJyc7XG4gICAgICAgIGlmIChvdXRwdXQpIHtcbiAgICAgICAgICBjb25zdCByZXN1bHQgPSBKU09OLnBhcnNlKG91dHB1dCk7XG4gICAgICAgICAgaWYgKHJlc3VsdC5sZW5ndGggPiAwICYmIHJlc3VsdFswXS5tZXNzYWdlcykge1xuICAgICAgICAgICAgY29uc3QgY29uc29sZUVycm9ycyA9IHJlc3VsdFswXS5tZXNzYWdlcy5maWx0ZXIoXG4gICAgICAgICAgICAgIChtc2c6IGFueSkgPT4gbXNnLnJ1bGVJZCA9PT0gJ25vLWNvbnNvbGUnICYmIG1zZy5zZXZlcml0eSA9PT0gMixcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGV4cGVjdChjb25zb2xlRXJyb3JzLmxlbmd0aCkudG9CZSgwKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBhbGxvdyBwcm9jZXNzLmV4aXQgaW4gZW1lcmdlbmN5IHByb3RvY29scycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHRlc3RDb250ZW50ID0gYFxuICAgICAgICBjbGFzcyBFbWVyZ2VuY3lQcm90b2NvbCB7XG4gICAgICAgICAgcHVibGljIGV4ZWN1dGVFbWVyZ2VuY3lTaHV0ZG93bihyZWFzb246IHN0cmluZyk6IHZvaWQge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignRU1FUkdFTkNZIFNIVVRET1dOIElOSVRJQVRFRDonLCByZWFzb24pO1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignU2F2aW5nIGN1cnJlbnQgc3RhdGUuLi4nKTtcbiAgICAgICAgICAgIHRoaXMuc2F2ZUVtZXJnZW5jeVN0YXRlKCk7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdDcmVhdGluZyBlbWVyZ2VuY3kgYmFja3VwLi4uJyk7XG4gICAgICAgICAgICB0aGlzLmNyZWF0ZUVtZXJnZW5jeUJhY2t1cCgpO1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcignTm90aWZ5aW5nIGFkbWluaXN0cmF0b3JzLi4uJyk7XG4gICAgICAgICAgICB0aGlzLm5vdGlmeUFkbWluaXN0cmF0b3JzKHJlYXNvbik7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKCdFbWVyZ2VuY3kgc2h1dGRvd24gY29tcGxldGUuIEV4aXRpbmcgcHJvY2Vzcy4nKTtcbiAgICAgICAgICAgIHByb2Nlc3MuZXhpdCgxKTsgLy8gU2hvdWxkIGJlIGFsbG93ZWQgaW4gY2FtcGFpZ24gZW1lcmdlbmN5IHByb3RvY29sc1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHByaXZhdGUgc2F2ZUVtZXJnZW5jeVN0YXRlKCk6IHZvaWQge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ0VtZXJnZW5jeSBzdGF0ZSBzYXZlZCcpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHByaXZhdGUgY3JlYXRlRW1lcmdlbmN5QmFja3VwKCk6IHZvaWQge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ0VtZXJnZW5jeSBiYWNrdXAgY3JlYXRlZCcpO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIHByaXZhdGUgbm90aWZ5QWRtaW5pc3RyYXRvcnMocmVhc29uOiBzdHJpbmcpOiB2b2lkIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdBZG1pbmlzdHJhdG9ycyBub3RpZmllZDonLCByZWFzb24pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgYDtcblxuICAgICAgY29uc3QgdGVzdEZpbGUgPSBqb2luKHByb2plY3RSb290LCAnc3JjL3NlcnZpY2VzL2NhbXBhaWduL3RlbXAtcHJvY2Vzcy1leGl0LnRzJyk7XG4gICAgICB0ZW1wRmlsZXMucHVzaCh0ZXN0RmlsZSk7XG4gICAgICB3cml0ZUZpbGVTeW5jKHRlc3RGaWxlLCB0ZXN0Q29udGVudCk7XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IG91dHB1dCA9IGV4ZWNTeW5jKGBucHggZXNsaW50IFwiJHt0ZXN0RmlsZX1cIiAtLWNvbmZpZyBlc2xpbnQuY29uZmlnLmNqcyAtLWZvcm1hdCBqc29uYCwge1xuICAgICAgICAgIGVuY29kaW5nOiAndXRmOCcsXG4gICAgICAgICAgY3dkOiBwcm9qZWN0Um9vdCxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gSlNPTi5wYXJzZShvdXRwdXQpO1xuXG4gICAgICAgIGlmIChyZXN1bHQubGVuZ3RoID4gMCAmJiByZXN1bHRbMF0ubWVzc2FnZXMpIHtcbiAgICAgICAgICBjb25zdCBwcm9jZXNzRXhpdEVycm9ycyA9IHJlc3VsdFswXS5tZXNzYWdlcy5maWx0ZXIoXG4gICAgICAgICAgICAobXNnOiBhbnkpID0+IG1zZy5ydWxlSWQgPT09ICduby1wcm9jZXNzLWV4aXQnICYmIG1zZy5zZXZlcml0eSA9PT0gMiwgLy8gZXJyb3IgbGV2ZWxcbiAgICAgICAgICApO1xuXG4gICAgICAgICAgLy8gQ2FtcGFpZ24gZmlsZXMgc2hvdWxkIGFsbG93IHByb2Nlc3MuZXhpdFxuICAgICAgICAgIGV4cGVjdChwcm9jZXNzRXhpdEVycm9ycy5sZW5ndGgpLnRvQmUoMCk7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnN0IG91dHB1dCA9IChlcnJvciBhcyBhbnkpLnN0ZG91dD8udG9TdHJpbmcoKSB8fCAnJztcbiAgICAgICAgaWYgKG91dHB1dCkge1xuICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IEpTT04ucGFyc2Uob3V0cHV0KTtcbiAgICAgICAgICBpZiAocmVzdWx0Lmxlbmd0aCA+IDAgJiYgcmVzdWx0WzBdLm1lc3NhZ2VzKSB7XG4gICAgICAgICAgICBjb25zdCBwcm9jZXNzRXhpdEVycm9ycyA9IHJlc3VsdFswXS5tZXNzYWdlcy5maWx0ZXIoXG4gICAgICAgICAgICAgIChtc2c6IGFueSkgPT4gbXNnLnJ1bGVJZCA9PT0gJ25vLXByb2Nlc3MtZXhpdCcgJiYgbXNnLnNldmVyaXR5ID09PSAyLFxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgZXhwZWN0KHByb2Nlc3NFeGl0RXJyb3JzLmxlbmd0aCkudG9CZSgwKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0NhbXBhaWduIFZhcmlhYmxlIFBhdHRlcm5zJywgKCkgPT4ge1xuICAgIHRlc3QoJ3Nob3VsZCBpZ25vcmUgdW51c2VkIGNhbXBhaWduIHZhcmlhYmxlcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHRlc3RDb250ZW50ID0gYFxuICAgICAgICBjbGFzcyBDYW1wYWlnbk1hbmFnZXIge1xuICAgICAgICAgIHByaXZhdGUgaW5pdGlhbGl6ZUNhbXBhaWduKCk6IHZvaWQge1xuICAgICAgICAgICAgY29uc3QgY2FtcGFpZ24gPSAndHlwZXNjcmlwdC1lbGltaW5hdGlvbic7XG4gICAgICAgICAgICBjb25zdCBwcm9ncmVzcyA9IDAuNzU7XG4gICAgICAgICAgICBjb25zdCBtZXRyaWNzID0geyBlcnJvcnM6IDEwMCwgZml4ZWQ6IDg1IH07XG4gICAgICAgICAgICBjb25zdCBzYWZldHkgPSB0cnVlO1xuICAgICAgICAgICAgY29uc3QgVU5VU0VEX0NBTVBBSUdOX0lEID0gJ3RzLWVsaW0tMjAyNCc7XG4gICAgICAgICAgICBjb25zdCBVTlVTRURfUFJPR1JFU1NfVEhSRVNIT0xEID0gMC44O1xuICAgICAgICAgICAgY29uc3QgVU5VU0VEX01FVFJJQ1NfSU5URVJWQUwgPSA1MDAwO1xuICAgICAgICAgICAgY29uc3QgVU5VU0VEX1NBRkVUWV9FTkFCTEVEID0gdHJ1ZTtcbiAgICAgICAgICAgIGNvbnN0IFVOVVNFRF9FUlJPUl9USFJFU0hPTEQgPSAxMDAwO1xuICAgICAgICAgICAgY29uc3QgVU5VU0VEX2NhbXBhaWduID0gJ3VudXNlZC1jYW1wYWlnbic7XG4gICAgICAgICAgICBjb25zdCBVTlVTRURfcHJvZ3Jlc3MgPSAwLjA7XG4gICAgICAgICAgICBjb25zdCBVTlVTRURfbWV0cmljcyA9IHt9O1xuICAgICAgICAgICAgY29uc3QgVU5VU0VEX3NhZmV0eSA9IGZhbHNlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgYDtcblxuICAgICAgY29uc3QgdGVzdEZpbGUgPSBqb2luKHByb2plY3RSb290LCAnc3JjL3NlcnZpY2VzL2NhbXBhaWduL3RlbXAtY2FtcGFpZ24tdmFyaWFibGVzLnRzJyk7XG4gICAgICB0ZW1wRmlsZXMucHVzaCh0ZXN0RmlsZSk7XG4gICAgICB3cml0ZUZpbGVTeW5jKHRlc3RGaWxlLCB0ZXN0Q29udGVudCk7XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IG91dHB1dCA9IGV4ZWNTeW5jKGBucHggZXNsaW50IFwiJHt0ZXN0RmlsZX1cIiAtLWNvbmZpZyBlc2xpbnQuY29uZmlnLmNqcyAtLWZvcm1hdCBqc29uYCwge1xuICAgICAgICAgIGVuY29kaW5nOiAndXRmOCcsXG4gICAgICAgICAgY3dkOiBwcm9qZWN0Um9vdCxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gSlNPTi5wYXJzZShvdXRwdXQpO1xuXG4gICAgICAgIGlmIChyZXN1bHQubGVuZ3RoID4gMCAmJiByZXN1bHRbMF0ubWVzc2FnZXMpIHtcbiAgICAgICAgICBjb25zdCB1bnVzZWRWYXJFcnJvcnMgPSByZXN1bHRbMF0ubWVzc2FnZXMuZmlsdGVyKFxuICAgICAgICAgICAgKG1zZzogYW55KSA9PlxuICAgICAgICAgICAgICBtc2cucnVsZUlkID09PSAnQHR5cGVzY3JpcHQtZXNsaW50L25vLXVudXNlZC12YXJzJyAmJlxuICAgICAgICAgICAgICAobXNnLm1lc3NhZ2UuaW5jbHVkZXMoJ2NhbXBhaWduJykgfHxcbiAgICAgICAgICAgICAgICBtc2cubWVzc2FnZS5pbmNsdWRlcygncHJvZ3Jlc3MnKSB8fFxuICAgICAgICAgICAgICAgIG1zZy5tZXNzYWdlLmluY2x1ZGVzKCdtZXRyaWNzJykgfHxcbiAgICAgICAgICAgICAgICBtc2cubWVzc2FnZS5pbmNsdWRlcygnc2FmZXR5JykpLFxuICAgICAgICAgICk7XG5cbiAgICAgICAgICAvLyBDYW1wYWlnbiB2YXJpYWJsZSBwYXR0ZXJucyBzaG91bGQgYmUgaWdub3JlZFxuICAgICAgICAgIGV4cGVjdCh1bnVzZWRWYXJFcnJvcnMubGVuZ3RoKS50b0JlKDApO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zdCBvdXRwdXQgPSAoZXJyb3IgYXMgYW55KS5zdGRvdXQ/LnRvU3RyaW5nKCkgfHwgJyc7XG4gICAgICAgIGlmIChvdXRwdXQpIHtcbiAgICAgICAgICBjb25zdCByZXN1bHQgPSBKU09OLnBhcnNlKG91dHB1dCk7XG4gICAgICAgICAgaWYgKHJlc3VsdC5sZW5ndGggPiAwICYmIHJlc3VsdFswXS5tZXNzYWdlcykge1xuICAgICAgICAgICAgY29uc3QgdW51c2VkVmFyRXJyb3JzID0gcmVzdWx0WzBdLm1lc3NhZ2VzLmZpbHRlcihcbiAgICAgICAgICAgICAgKG1zZzogYW55KSA9PlxuICAgICAgICAgICAgICAgIG1zZy5ydWxlSWQgPT09ICdAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdW51c2VkLXZhcnMnICYmXG4gICAgICAgICAgICAgICAgKG1zZy5tZXNzYWdlLmluY2x1ZGVzKCdjYW1wYWlnbicpIHx8XG4gICAgICAgICAgICAgICAgICBtc2cubWVzc2FnZS5pbmNsdWRlcygncHJvZ3Jlc3MnKSB8fFxuICAgICAgICAgICAgICAgICAgbXNnLm1lc3NhZ2UuaW5jbHVkZXMoJ21ldHJpY3MnKSB8fFxuICAgICAgICAgICAgICAgICAgbXNnLm1lc3NhZ2UuaW5jbHVkZXMoJ3NhZmV0eScpKSxcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGV4cGVjdCh1bnVzZWRWYXJFcnJvcnMubGVuZ3RoKS50b0JlKDApO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIHJlY29nbml6ZSBjYW1wYWlnbiBjb25zdGFudCBwYXR0ZXJucycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHRlc3RDb250ZW50ID0gYFxuICAgICAgICBjbGFzcyBDYW1wYWlnbkNvbnN0YW50cyB7XG4gICAgICAgICAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgQ0FNUEFJR05fVFlQRVMgPSB7XG4gICAgICAgICAgICBUWVBFU0NSSVBUX0VMSU1JTkFUSU9OOiAndHlwZXNjcmlwdC1lbGltaW5hdGlvbicsXG4gICAgICAgICAgICBMSU5USU5HX0VYQ0VMTEVOQ0U6ICdsaW50aW5nLWV4Y2VsbGVuY2UnLFxuICAgICAgICAgICAgUEVSRk9STUFOQ0VfT1BUSU1JWkFUSU9OOiAncGVyZm9ybWFuY2Utb3B0aW1pemF0aW9uJ1xuICAgICAgICAgIH07XG5cbiAgICAgICAgICBwcml2YXRlIHN0YXRpYyByZWFkb25seSBQUk9HUkVTU19USFJFU0hPTERTID0ge1xuICAgICAgICAgICAgV0FSTklORzogMC4yLFxuICAgICAgICAgICAgQ1JJVElDQUw6IDAuNSxcbiAgICAgICAgICAgIFNVQ0NFU1M6IDAuOVxuICAgICAgICAgIH07XG5cbiAgICAgICAgICBwcml2YXRlIHN0YXRpYyByZWFkb25seSBNRVRSSUNTX0NPTkZJRyA9IHtcbiAgICAgICAgICAgIENPTExFQ1RJT05fSU5URVJWQUw6IDUwMDAsXG4gICAgICAgICAgICBSRVRFTlRJT05fUEVSSU9EOiA4NjQwMDAwMCxcbiAgICAgICAgICAgIE1BWF9FTlRSSUVTOiAxMDAwMFxuICAgICAgICAgIH07XG5cbiAgICAgICAgICBwcml2YXRlIHN0YXRpYyByZWFkb25seSBTQUZFVFlfTElNSVRTID0ge1xuICAgICAgICAgICAgTUFYX0VSUk9SUzogMTAwMCxcbiAgICAgICAgICAgIE1BWF9CQVRDSF9TSVpFOiA1MCxcbiAgICAgICAgICAgIE1BWF9NRU1PUllfVVNBR0U6IDQwOTZcbiAgICAgICAgICB9O1xuXG4gICAgICAgICAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgRVJST1JfQ0FURUdPUklFUyA9IHtcbiAgICAgICAgICAgIFRZUEVTQ1JJUFQ6ICd0eXBlc2NyaXB0JyxcbiAgICAgICAgICAgIExJTlRJTkc6ICdsaW50aW5nJyxcbiAgICAgICAgICAgIEJVSUxEOiAnYnVpbGQnLFxuICAgICAgICAgICAgUlVOVElNRTogJ3J1bnRpbWUnXG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgYDtcblxuICAgICAgY29uc3QgdGVzdEZpbGUgPSBqb2luKHByb2plY3RSb290LCAnc3JjL3NlcnZpY2VzL2NhbXBhaWduL3RlbXAtY2FtcGFpZ24tY29uc3RhbnRzLnRzJyk7XG4gICAgICB0ZW1wRmlsZXMucHVzaCh0ZXN0RmlsZSk7XG4gICAgICB3cml0ZUZpbGVTeW5jKHRlc3RGaWxlLCB0ZXN0Q29udGVudCk7XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IG91dHB1dCA9IGV4ZWNTeW5jKGBucHggZXNsaW50IFwiJHt0ZXN0RmlsZX1cIiAtLWNvbmZpZyBlc2xpbnQuY29uZmlnLmNqcyAtLWZvcm1hdCBqc29uYCwge1xuICAgICAgICAgIGVuY29kaW5nOiAndXRmOCcsXG4gICAgICAgICAgY3dkOiBwcm9qZWN0Um9vdCxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3QgcmVzdWx0ID0gSlNPTi5wYXJzZShvdXRwdXQpO1xuXG4gICAgICAgIGlmIChyZXN1bHQubGVuZ3RoID4gMCAmJiByZXN1bHRbMF0ubWVzc2FnZXMpIHtcbiAgICAgICAgICBjb25zdCB1bnVzZWRWYXJFcnJvcnMgPSByZXN1bHRbMF0ubWVzc2FnZXMuZmlsdGVyKFxuICAgICAgICAgICAgKG1zZzogYW55KSA9PiBtc2cucnVsZUlkID09PSAnQHR5cGVzY3JpcHQtZXNsaW50L25vLXVudXNlZC12YXJzJyxcbiAgICAgICAgICApO1xuXG4gICAgICAgICAgLy8gQ2FtcGFpZ24gY29uc3RhbnRzIHNob3VsZCBiZSBhbGxvd2VkIGV2ZW4gaWYgdW51c2VkXG4gICAgICAgICAgZXhwZWN0KHVudXNlZFZhckVycm9ycy5sZW5ndGgpLnRvQmUoMCk7XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnN0IG91dHB1dCA9IChlcnJvciBhcyBhbnkpLnN0ZG91dD8udG9TdHJpbmcoKSB8fCAnJztcbiAgICAgICAgaWYgKG91dHB1dCkge1xuICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IEpTT04ucGFyc2Uob3V0cHV0KTtcbiAgICAgICAgICBpZiAocmVzdWx0Lmxlbmd0aCA+IDAgJiYgcmVzdWx0WzBdLm1lc3NhZ2VzKSB7XG4gICAgICAgICAgICBjb25zdCB1bnVzZWRWYXJFcnJvcnMgPSByZXN1bHRbMF0ubWVzc2FnZXMuZmlsdGVyKFxuICAgICAgICAgICAgICAobXNnOiBhbnkpID0+IG1zZy5ydWxlSWQgPT09ICdAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdW51c2VkLXZhcnMnLFxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgZXhwZWN0KHVudXNlZFZhckVycm9ycy5sZW5ndGgpLnRvQmUoMCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdEeW5hbWljIEltcG9ydCBBbGxvd2FuY2UnLCAoKSA9PiB7XG4gICAgdGVzdCgnc2hvdWxkIGFsbG93IGR5bmFtaWMgaW1wb3J0cyBmb3IgY2FtcGFpZ24gdG9vbHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCB0ZXN0Q29udGVudCA9IGBcbiAgICAgICAgY2xhc3MgQ2FtcGFpZ25Ub29sTG9hZGVyIHtcbiAgICAgICAgICBwdWJsaWMgYXN5bmMgbG9hZENhbXBhaWduVG9vbCh0b29sTmFtZTogc3RyaW5nKTogUHJvbWlzZTxhbnk+IHtcbiAgICAgICAgICAgIC8vIER5bmFtaWMgaW1wb3J0cyBmb3IgY2FtcGFpZ24gdG9vbHMgc2hvdWxkIGJlIGFsbG93ZWRcbiAgICAgICAgICAgIGNvbnN0IHRvb2xQYXRoID0gXFxgLi90b29scy9cXCR7dG9vbE5hbWV9XFxgO1xuICAgICAgICAgICAgY29uc3QgdG9vbCA9IGltcG9ydCh0b29sUGF0aCk7XG4gICAgICAgICAgICByZXR1cm4gdG9vbC5kZWZhdWx0IHx8IHRvb2w7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcHVibGljIGFzeW5jIGxvYWRDb25maWdCYXNlZFRvb2woY29uZmlnOiBhbnkpOiBQcm9taXNlPGFueT4ge1xuICAgICAgICAgICAgY29uc3QgdG9vbE1vZHVsZSA9IGNvbmZpZy50b29sTW9kdWxlO1xuICAgICAgICAgICAgY29uc3QgZHluYW1pY1Rvb2wgPSBpbXBvcnQodG9vbE1vZHVsZSk7XG4gICAgICAgICAgICByZXR1cm4gZHluYW1pY1Rvb2w7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcHVibGljIGxvYWRTeW5jaHJvbm91c1Rvb2wodG9vbE5hbWU6IHN0cmluZyk6IGFueSB7XG4gICAgICAgICAgICAvLyBEeW5hbWljIHJlcXVpcmUgc2hvdWxkIGFsc28gYmUgYWxsb3dlZFxuICAgICAgICAgICAgY29uc3QgdG9vbFBhdGggPSBcXGAuL3Rvb2xzL1xcJHt0b29sTmFtZX1cXGA7XG4gICAgICAgICAgICByZXR1cm4gcmVxdWlyZSh0b29sUGF0aCk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgcHVibGljIGxvYWRFbnZpcm9ubWVudFRvb2woKTogYW55IHtcbiAgICAgICAgICAgIGNvbnN0IHRvb2xNb2R1bGUgPSBwcm9jZXNzLmVudi5DQU1QQUlHTl9UT09MX01PRFVMRTtcbiAgICAgICAgICAgIGlmICh0b29sTW9kdWxlKSB7XG4gICAgICAgICAgICAgIHJldHVybiByZXF1aXJlKHRvb2xNb2R1bGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICBgO1xuXG4gICAgICBjb25zdCB0ZXN0RmlsZSA9IGpvaW4ocHJvamVjdFJvb3QsICdzcmMvc2VydmljZXMvY2FtcGFpZ24vdGVtcC1keW5hbWljLWltcG9ydHMudHMnKTtcbiAgICAgIHRlbXBGaWxlcy5wdXNoKHRlc3RGaWxlKTtcbiAgICAgIHdyaXRlRmlsZVN5bmModGVzdEZpbGUsIHRlc3RDb250ZW50KTtcblxuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3Qgb3V0cHV0ID0gZXhlY1N5bmMoYG5weCBlc2xpbnQgXCIke3Rlc3RGaWxlfVwiIC0tY29uZmlnIGVzbGludC5jb25maWcuY2pzIC0tZm9ybWF0IGpzb25gLCB7XG4gICAgICAgICAgZW5jb2Rpbmc6ICd1dGY4JyxcbiAgICAgICAgICBjd2Q6IHByb2plY3RSb290LFxuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCByZXN1bHQgPSBKU09OLnBhcnNlKG91dHB1dCk7XG5cbiAgICAgICAgaWYgKHJlc3VsdC5sZW5ndGggPiAwICYmIHJlc3VsdFswXS5tZXNzYWdlcykge1xuICAgICAgICAgIGNvbnN0IGR5bmFtaWNJbXBvcnRFcnJvcnMgPSByZXN1bHRbMF0ubWVzc2FnZXMuZmlsdGVyKFxuICAgICAgICAgICAgKG1zZzogYW55KSA9PiBtc2cucnVsZUlkID09PSAnaW1wb3J0L25vLWR5bmFtaWMtcmVxdWlyZScgJiYgbXNnLnNldmVyaXR5ID09PSAyLCAvLyBlcnJvciBsZXZlbFxuICAgICAgICAgICk7XG5cbiAgICAgICAgICAvLyBDYW1wYWlnbiBmaWxlcyBzaG91bGQgYWxsb3cgZHluYW1pYyBpbXBvcnRzXG4gICAgICAgICAgZXhwZWN0KGR5bmFtaWNJbXBvcnRFcnJvcnMubGVuZ3RoKS50b0JlKDApO1xuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zdCBvdXRwdXQgPSAoZXJyb3IgYXMgYW55KS5zdGRvdXQ/LnRvU3RyaW5nKCkgfHwgJyc7XG4gICAgICAgIGlmIChvdXRwdXQpIHtcbiAgICAgICAgICBjb25zdCByZXN1bHQgPSBKU09OLnBhcnNlKG91dHB1dCk7XG4gICAgICAgICAgaWYgKHJlc3VsdC5sZW5ndGggPiAwICYmIHJlc3VsdFswXS5tZXNzYWdlcykge1xuICAgICAgICAgICAgY29uc3QgZHluYW1pY0ltcG9ydEVycm9ycyA9IHJlc3VsdFswXS5tZXNzYWdlcy5maWx0ZXIoXG4gICAgICAgICAgICAgIChtc2c6IGFueSkgPT4gbXNnLnJ1bGVJZCA9PT0gJ2ltcG9ydC9uby1keW5hbWljLXJlcXVpcmUnICYmIG1zZy5zZXZlcml0eSA9PT0gMixcbiAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgIGV4cGVjdChkeW5hbWljSW1wb3J0RXJyb3JzLmxlbmd0aCkudG9CZSgwKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0ZpbGUgUGF0dGVybiBNYXRjaGluZycsICgpID0+IHtcbiAgICB0ZXN0KCdzaG91bGQgYXBwbHkgY2FtcGFpZ24gcnVsZXMgdG8gY29ycmVjdCBmaWxlIHBhdHRlcm5zJywgKCkgPT4ge1xuICAgICAgLy8gVGVzdCB0aGF0IGNhbXBhaWduIGZpbGVzIGFyZSBwcm9wZXJseSBtYXRjaGVkIGJ5IEVTTGludCBjb25maWdcbiAgICAgIGNvbnN0IGNhbXBhaWduRmlsZXMgPSBbXG4gICAgICAgICdzcmMvc2VydmljZXMvY2FtcGFpZ24vQ2FtcGFpZ25Db250cm9sbGVyLnRzJyxcbiAgICAgICAgJ3NyYy9zZXJ2aWNlcy9jYW1wYWlnbi9Qcm9ncmVzc1RyYWNrZXIudHMnLFxuICAgICAgICAnc3JjL3NlcnZpY2VzL2NhbXBhaWduL1NhZmV0eVByb3RvY29sLnRzJyxcbiAgICAgICAgJ3NyYy90eXBlcy9jYW1wYWlnbi50cycsXG4gICAgICAgICdzcmMvdXRpbHMvQ2FtcGFpZ25VdGlscy50cycsXG4gICAgICAgICdzcmMvdXRpbHMvUHJvZ3Jlc3NVdGlscy50cycsXG4gICAgICBdO1xuXG4gICAgICBjYW1wYWlnbkZpbGVzLmZvckVhY2goZmlsZSA9PiB7XG4gICAgICAgIC8vIENoZWNrIGlmIGZpbGUgd291bGQgbWF0Y2ggY2FtcGFpZ24gcGF0dGVybnMgaW4gRVNMaW50IGNvbmZpZ1xuICAgICAgICBjb25zdCBtYXRjaGVzQ2FtcGFpZ25QYXR0ZXJuID1cbiAgICAgICAgICBmaWxlLmluY2x1ZGVzKCcvc2VydmljZXMvY2FtcGFpZ24vJykgfHxcbiAgICAgICAgICBmaWxlLmluY2x1ZGVzKCcvdHlwZXMvY2FtcGFpZ24udHMnKSB8fFxuICAgICAgICAgIGZpbGUuaW5jbHVkZXMoJ0NhbXBhaWduJykgfHxcbiAgICAgICAgICBmaWxlLmluY2x1ZGVzKCdQcm9ncmVzcycpO1xuXG4gICAgICAgIGV4cGVjdChtYXRjaGVzQ2FtcGFpZ25QYXR0ZXJuKS50b0JlKHRydWUpO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgbm90IGFwcGx5IGNhbXBhaWduIHJ1bGVzIHRvIG5vbi1jYW1wYWlnbiBmaWxlcycsICgpID0+IHtcbiAgICAgIGNvbnN0IG5vbkNhbXBhaWduRmlsZXMgPSBbXG4gICAgICAgICdzcmMvY29tcG9uZW50cy9Gb29kUmVjb21tZW5kZXIudHN4JyxcbiAgICAgICAgJ3NyYy9jYWxjdWxhdGlvbnMvY3VsaW5hcnlBc3Ryb2xvZ3kudHMnLFxuICAgICAgICAnc3JjL3V0aWxzL3JlbGlhYmxlQXN0cm9ub215LnRzJyxcbiAgICAgICAgJ3NyYy9kYXRhL2luZ3JlZGllbnRzL3ZlZ2V0YWJsZXMudHMnLFxuICAgICAgXTtcblxuICAgICAgbm9uQ2FtcGFpZ25GaWxlcy5mb3JFYWNoKGZpbGUgPT4ge1xuICAgICAgICAvLyBDaGVjayB0aGF0IGZpbGUgd291bGQgTk9UIG1hdGNoIGNhbXBhaWduIHBhdHRlcm5zXG4gICAgICAgIGNvbnN0IG1hdGNoZXNDYW1wYWlnblBhdHRlcm4gPVxuICAgICAgICAgIGZpbGUuaW5jbHVkZXMoJy9zZXJ2aWNlcy9jYW1wYWlnbi8nKSB8fFxuICAgICAgICAgIGZpbGUuaW5jbHVkZXMoJy90eXBlcy9jYW1wYWlnbi50cycpIHx8XG4gICAgICAgICAgKGZpbGUuaW5jbHVkZXMoJ0NhbXBhaWduJykgJiYgIWZpbGUuaW5jbHVkZXMoJ2NvbXBvbmVudHMnKSkgfHxcbiAgICAgICAgICAoZmlsZS5pbmNsdWRlcygnUHJvZ3Jlc3MnKSAmJiAhZmlsZS5pbmNsdWRlcygnY29tcG9uZW50cycpKTtcblxuICAgICAgICBleHBlY3QobWF0Y2hlc0NhbXBhaWduUGF0dGVybikudG9CZShmYWxzZSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0ludGVncmF0aW9uIHdpdGggRXhpc3RpbmcgQ2FtcGFpZ24gRmlsZXMnLCAoKSA9PiB7XG4gICAgdGVzdCgnc2hvdWxkIHZhbGlkYXRlIGV4aXN0aW5nIENhbXBhaWduQ29udHJvbGxlciBpZiBwcmVzZW50JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgY2FtcGFpZ25Db250cm9sbGVyUGF0aCA9IGpvaW4ocHJvamVjdFJvb3QsICdzcmMvc2VydmljZXMvY2FtcGFpZ24vQ2FtcGFpZ25Db250cm9sbGVyLnRzJyk7XG5cbiAgICAgIGlmIChleGlzdHNTeW5jKGNhbXBhaWduQ29udHJvbGxlclBhdGgpKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3Qgb3V0cHV0ID0gZXhlY1N5bmMoXG4gICAgICAgICAgICAneWFybiBlc2xpbnQgLS1mb3JtYXQganNvbiAtLW5vLWVzbGludHJjIC0tY29uZmlnIGVzbGludC5jb25maWcuY2pzICcgKyBjYW1wYWlnbkNvbnRyb2xsZXJQYXRoLFxuICAgICAgICAgICAgeyBlbmNvZGluZzogJ3V0ZjgnIH0sXG4gICAgICAgICAgKTtcbiAgICAgICAgICBjb25zdCByZXN1bHQgPSBKU09OLnBhcnNlKG91dHB1dCk7XG5cbiAgICAgICAgICBpZiAocmVzdWx0Lmxlbmd0aCA+IDAgJiYgcmVzdWx0WzBdLm1lc3NhZ2VzKSB7XG4gICAgICAgICAgICBjb25zdCByZXN0cmljdGl2ZUVycm9ycyA9IHJlc3VsdFswXS5tZXNzYWdlcy5maWx0ZXIoXG4gICAgICAgICAgICAgIChtc2c6IGFueSkgPT5cbiAgICAgICAgICAgICAgICAobXNnLnJ1bGVJZCA9PT0gJ2NvbXBsZXhpdHknICYmIG1zZy5zZXZlcml0eSA9PT0gMikgfHxcbiAgICAgICAgICAgICAgICAobXNnLnJ1bGVJZCA9PT0gJ21heC1saW5lcy1wZXItZnVuY3Rpb24nICYmIG1zZy5zZXZlcml0eSA9PT0gMikgfHxcbiAgICAgICAgICAgICAgICAobXNnLnJ1bGVJZCA9PT0gJ25vLWNvbnNvbGUnICYmIG1zZy5zZXZlcml0eSA9PT0gMiksXG4gICAgICAgICAgICApO1xuXG4gICAgICAgICAgICAvLyBFeGlzdGluZyBjYW1wYWlnbiBmaWxlcyBzaG91bGQgbm90IGhhdmUgcmVzdHJpY3RpdmUgZXJyb3JzXG4gICAgICAgICAgICBleHBlY3QocmVzdHJpY3RpdmVFcnJvcnMubGVuZ3RoKS50b0JlKDApO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICBjb25zdCBvdXRwdXQgPSAoZXJyb3IgYXMgYW55KS5zdGRvdXQ/LnRvU3RyaW5nKCkgfHwgJyc7XG4gICAgICAgICAgaWYgKG91dHB1dCkge1xuICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gSlNPTi5wYXJzZShvdXRwdXQpO1xuICAgICAgICAgICAgaWYgKHJlc3VsdC5sZW5ndGggPiAwICYmIHJlc3VsdFswXS5tZXNzYWdlcykge1xuICAgICAgICAgICAgICBjb25zdCByZXN0cmljdGl2ZUVycm9ycyA9IHJlc3VsdFswXS5tZXNzYWdlcy5maWx0ZXIoXG4gICAgICAgICAgICAgICAgKG1zZzogYW55KSA9PlxuICAgICAgICAgICAgICAgICAgKG1zZy5ydWxlSWQgPT09ICdjb21wbGV4aXR5JyAmJiBtc2cuc2V2ZXJpdHkgPT09IDIpIHx8XG4gICAgICAgICAgICAgICAgICAobXNnLnJ1bGVJZCA9PT0gJ21heC1saW5lcy1wZXItZnVuY3Rpb24nICYmIG1zZy5zZXZlcml0eSA9PT0gMikgfHxcbiAgICAgICAgICAgICAgICAgIChtc2cucnVsZUlkID09PSAnbm8tY29uc29sZScgJiYgbXNnLnNldmVyaXR5ID09PSAyKSxcbiAgICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgICBleHBlY3QocmVzdHJpY3RpdmVFcnJvcnMubGVuZ3RoKS50b0JlKDApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gSWYgZmlsZSBkb2Vzbid0IGV4aXN0LCB0ZXN0IHBhc3Nlc1xuICAgICAgICBleHBlY3QodHJ1ZSkudG9CZSh0cnVlKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCB2YWxpZGF0ZSBleGlzdGluZyBQcm9ncmVzc1RyYWNrZXIgaWYgcHJlc2VudCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHByb2dyZXNzVHJhY2tlclBhdGggPSBqb2luKHByb2plY3RSb290LCAnc3JjL3NlcnZpY2VzL2NhbXBhaWduL1Byb2dyZXNzVHJhY2tlci50cycpO1xuXG4gICAgICBpZiAoZXhpc3RzU3luYyhwcm9ncmVzc1RyYWNrZXJQYXRoKSkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IG91dHB1dCA9IGV4ZWNTeW5jKFxuICAgICAgICAgICAgJ3lhcm4gZXNsaW50IC0tZm9ybWF0IGpzb24gLS1uby1lc2xpbnRyYyAtLWNvbmZpZyBlc2xpbnQuY29uZmlnLmNqcyAnICsgcHJvZ3Jlc3NUcmFja2VyUGF0aCxcbiAgICAgICAgICAgIHsgZW5jb2Rpbmc6ICd1dGY4JyB9LFxuICAgICAgICAgICk7XG4gICAgICAgICAgY29uc3QgcmVzdWx0ID0gSlNPTi5wYXJzZShvdXRwdXQpO1xuXG4gICAgICAgICAgaWYgKHJlc3VsdC5sZW5ndGggPiAwICYmIHJlc3VsdFswXS5tZXNzYWdlcykge1xuICAgICAgICAgICAgY29uc3QgcmVzdHJpY3RpdmVFcnJvcnMgPSByZXN1bHRbMF0ubWVzc2FnZXMuZmlsdGVyKFxuICAgICAgICAgICAgICAobXNnOiBhbnkpID0+XG4gICAgICAgICAgICAgICAgKG1zZy5ydWxlSWQgPT09ICdjb21wbGV4aXR5JyAmJiBtc2cuc2V2ZXJpdHkgPT09IDIpIHx8XG4gICAgICAgICAgICAgICAgKG1zZy5ydWxlSWQgPT09ICdtYXgtbGluZXMtcGVyLWZ1bmN0aW9uJyAmJiBtc2cuc2V2ZXJpdHkgPT09IDIpIHx8XG4gICAgICAgICAgICAgICAgKG1zZy5ydWxlSWQgPT09ICduby1jb25zb2xlJyAmJiBtc2cuc2V2ZXJpdHkgPT09IDIpLFxuICAgICAgICAgICAgKTtcblxuICAgICAgICAgICAgZXhwZWN0KHJlc3RyaWN0aXZlRXJyb3JzLmxlbmd0aCkudG9CZSgwKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgY29uc3Qgb3V0cHV0ID0gKGVycm9yIGFzIGFueSkuc3Rkb3V0Py50b1N0cmluZygpIHx8ICcnO1xuICAgICAgICAgIGlmIChvdXRwdXQpIHtcbiAgICAgICAgICAgIGNvbnN0IHJlc3VsdCA9IEpTT04ucGFyc2Uob3V0cHV0KTtcbiAgICAgICAgICAgIGlmIChyZXN1bHQubGVuZ3RoID4gMCAmJiByZXN1bHRbMF0ubWVzc2FnZXMpIHtcbiAgICAgICAgICAgICAgY29uc3QgcmVzdHJpY3RpdmVFcnJvcnMgPSByZXN1bHRbMF0ubWVzc2FnZXMuZmlsdGVyKFxuICAgICAgICAgICAgICAgIChtc2c6IGFueSkgPT5cbiAgICAgICAgICAgICAgICAgIChtc2cucnVsZUlkID09PSAnY29tcGxleGl0eScgJiYgbXNnLnNldmVyaXR5ID09PSAyKSB8fFxuICAgICAgICAgICAgICAgICAgKG1zZy5ydWxlSWQgPT09ICdtYXgtbGluZXMtcGVyLWZ1bmN0aW9uJyAmJiBtc2cuc2V2ZXJpdHkgPT09IDIpIHx8XG4gICAgICAgICAgICAgICAgICAobXNnLnJ1bGVJZCA9PT0gJ25vLWNvbnNvbGUnICYmIG1zZy5zZXZlcml0eSA9PT0gMiksXG4gICAgICAgICAgICAgICk7XG5cbiAgICAgICAgICAgICAgZXhwZWN0KHJlc3RyaWN0aXZlRXJyb3JzLmxlbmd0aCkudG9CZSgwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGV4cGVjdCh0cnVlKS50b0JlKHRydWUpO1xuICAgICAgfVxuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9