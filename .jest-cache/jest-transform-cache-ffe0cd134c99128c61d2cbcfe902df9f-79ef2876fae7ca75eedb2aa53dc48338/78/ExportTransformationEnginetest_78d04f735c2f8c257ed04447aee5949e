e3332984cd939b0c918a9926d8017562
"use strict";
/**
 * Export Transformation Engine Tests
 * Perfect Codebase Campaign - Phase 3 Implementation
 */
Object.defineProperty(exports, "__esModule", { value: true });
// Mock dependencies
jest.mock('./UnusedExportAnalyzer');
jest.mock('./EnterpriseIntelligenceGenerator');
jest.mock('./SafetyProtocol');
jest.mock('./ProgressTracker');
jest.mock('child_process');
const ExportTransformationEngine_1 = require("./ExportTransformationEngine");
const UnusedExportAnalyzer_1 = require("./UnusedExportAnalyzer");
const EnterpriseIntelligenceGenerator_1 = require("./EnterpriseIntelligenceGenerator");
const SafetyProtocol_1 = require("./SafetyProtocol");
const ProgressTracker_1 = require("./ProgressTracker");
const mockAnalyzer = UnusedExportAnalyzer_1.UnusedExportAnalyzer;
const mockGenerator = EnterpriseIntelligenceGenerator_1.EnterpriseIntelligenceGenerator;
const mockSafetyProtocol = SafetyProtocol_1.SafetyProtocol;
const mockProgressTracker = ProgressTracker_1.ProgressTracker;
describe('ExportTransformationEngine', () => {
    let engine;
    beforeEach(() => {
        jest.clearAllMocks();
        // Mock analyzer
        mockAnalyzer.prototype.analyzeUnusedExports = jest.fn().mockResolvedValue({
            totalFiles: 10,
            totalUnusedExports: 25,
            highPriorityFiles: [
                {
                    filePath: '/test/high1.ts',
                    priority: 'HIGH',
                    unusedExports: [],
                    safetyScore: 90,
                    transformationCandidates: [
                        {
                            export: { exportName: 'testExport1', exportType: 'function', complexity: 5 },
                            intelligenceSystemName: 'TEST_EXPORT_1_INTELLIGENCE_SYSTEM',
                            transformationComplexity: 'MODERATE',
                            safetyScore: 85,
                            estimatedBenefit: 75
                        }
                    ],
                    category: 'CORE'
                }
            ],
            mediumPriorityFiles: [
                {
                    filePath: '/test/medium1.ts',
                    priority: 'MEDIUM',
                    unusedExports: [],
                    safetyScore: 85,
                    transformationCandidates: [
                        {
                            export: { exportName: 'testExport2', exportType: 'class', complexity: 8 },
                            intelligenceSystemName: 'TEST_EXPORT_2_INTELLIGENCE_SYSTEM',
                            transformationComplexity: 'COMPLEX',
                            safetyScore: 80,
                            estimatedBenefit: 80
                        }
                    ],
                    category: 'CORE'
                }
            ],
            lowPriorityFiles: [],
            summary: {
                recipeFiles: 2,
                coreFiles: 8,
                externalFiles: 0,
                totalTransformationCandidates: 2,
                averageSafetyScore: 87.5,
                estimatedIntelligenceSystems: 2
            }
        });
        // Mock generator
        mockGenerator.prototype.generateIntelligenceSystems = jest.fn().mockResolvedValue([
            {
                systemName: 'TEST_SYSTEM_1',
                filePath: '/output/TEST_SYSTEM_1.ts',
                originalExport: { exportName: 'testExport1', exportType: 'function' },
                generatedCode: 'generated code',
                capabilities: [],
                integrationPoints: [],
                estimatedValue: 75,
                complexity: 'MODERATE'
            }
        ]);
        mockGenerator.prototype.generateSummary = jest.fn().mockReturnValue({
            totalSystemsGenerated: 1,
            totalCapabilitiesAdded: 3,
            totalIntegrationPoints: 2,
            averageComplexity: 2.5,
            estimatedTotalValue: 75,
            generationsByCategory: { function: 1 }
        });
        // Mock safety protocol
        mockSafetyProtocol.prototype.createSafetyCheckpoint = jest.fn().mockResolvedValue('checkpoint-123');
        mockSafetyProtocol.prototype.rollbackToCheckpoint = jest.fn().mockResolvedValue(undefined);
        mockSafetyProtocol.prototype.emergencyRollback = jest.fn().mockResolvedValue(undefined);
        // Mock progress tracker
        mockProgressTracker.prototype.updateProgress = jest.fn().mockResolvedValue(undefined);
        engine = new ExportTransformationEngine_1.ExportTransformationEngine({
            batchSize: 5,
            safetyThreshold: 80,
            dryRun: true // Use dry run for tests
        });
    });
    describe('constructor', () => {
        it('should initialize with default configuration', () => {
            const defaultEngine = new ExportTransformationEngine_1.ExportTransformationEngine();
            const config = defaultEngine.getConfig();
            expect(config.batchSize).toBe(10);
            expect(config.safetyThreshold).toBe(80);
            expect(config.buildValidationEnabled).toBe(true);
            expect(config.testValidationEnabled).toBe(true);
            expect(config.rollbackOnFailure).toBe(true);
        });
        it('should initialize with custom configuration', () => {
            const customEngine = new ExportTransformationEngine_1.ExportTransformationEngine({
                batchSize: 15,
                safetyThreshold: 90,
                dryRun: true
            });
            const config = customEngine.getConfig();
            expect(config.batchSize).toBe(15);
            expect(config.safetyThreshold).toBe(90);
            expect(config.dryRun).toBe(true);
        });
    });
    describe('executeTransformation', () => {
        it('should execute complete transformation campaign', async () => {
            const summary = await engine.executeTransformation();
            expect(summary).toHaveProperty('totalBatches');
            expect(summary).toHaveProperty('successfulBatches');
            expect(summary).toHaveProperty('totalFilesProcessed');
            expect(summary).toHaveProperty('totalSystemsGenerated');
            expect(summary).toHaveProperty('successRate');
            expect(summary).toHaveProperty('generationSummary');
        });
        it('should perform analysis phase', async () => {
            await engine.executeTransformation();
            expect(mockAnalyzer.prototype.analyzeUnusedExports).toHaveBeenCalledTimes(1);
        });
        it('should create safety checkpoints', async () => {
            await engine.executeTransformation();
            expect(mockSafetyProtocol.prototype.createSafetyCheckpoint).toHaveBeenCalledWith('transformation-start');
        });
        it('should handle critical failures', async () => {
            mockAnalyzer.prototype.analyzeUnusedExports.mockRejectedValueOnce(new Error('Analysis failed'));
            await expect(engine.executeTransformation()).rejects.toThrow('Analysis failed');
            expect(mockSafetyProtocol.prototype.emergencyRollback).toHaveBeenCalled();
        });
    });
    describe('batch planning', () => {
        it('should create batches based on priority', async () => {
            const summary = await engine.executeTransformation();
            // Should have created batches for high and medium priority files
            expect(summary.totalBatches).toBeGreaterThan(0);
        });
        it('should respect batch size configuration', async () => {
            const smallBatchEngine = new ExportTransformationEngine_1.ExportTransformationEngine({
                batchSize: 1,
                dryRun: true
            });
            const summary = await smallBatchEngine.executeTransformation();
            // With batch size 1 and 2 files, should create 2 batches
            expect(summary.totalBatches).toBe(2);
        });
    });
    describe('batch execution', () => {
        it('should execute batches in priority order', async () => {
            const summary = await engine.executeTransformation();
            expect(summary.successfulBatches).toBeGreaterThan(0);
            expect(summary.successRate).toBe(100); // Dry run should always succeed
        });
        it('should handle batch failures with rollback', async () => {
            const failingEngine = new ExportTransformationEngine_1.ExportTransformationEngine({
                dryRun: false,
                rollbackOnFailure: true
            });
            mockGenerator.prototype.generateIntelligenceSystems.mockRejectedValueOnce(new Error('Generation failed'));
            const summary = await failingEngine.executeTransformation();
            expect(summary.failedBatches).toBeGreaterThan(0);
            expect(mockSafetyProtocol.prototype.rollbackToCheckpoint).toHaveBeenCalled();
        });
        it('should skip rollback when disabled', async () => {
            const noRollbackEngine = new ExportTransformationEngine_1.ExportTransformationEngine({
                dryRun: false,
                rollbackOnFailure: false
            });
            mockGenerator.prototype.generateIntelligenceSystems.mockRejectedValueOnce(new Error('Generation failed'));
            await noRollbackEngine.executeTransformation();
            expect(mockSafetyProtocol.prototype.rollbackToCheckpoint).not.toHaveBeenCalled();
        });
    });
    describe('safety validation', () => {
        it('should enforce safety threshold', async () => {
            const strictEngine = new ExportTransformationEngine_1.ExportTransformationEngine({
                safetyThreshold: 95,
                dryRun: false
            });
            const summary = await strictEngine.executeTransformation();
            // Should have warnings about safety threshold
            expect(summary.totalWarnings).toBeGreaterThan(0);
        });
        it('should create checkpoints for each batch', async () => {
            await engine.executeTransformation();
            // Should create transformation-start checkpoint plus batch checkpoints
            expect(mockSafetyProtocol.prototype.createSafetyCheckpoint).toHaveBeenCalledTimes(3); // start + 2 batches
        });
    });
    describe('error handling', () => {
        it('should log transformation errors', async () => {
            const errorEngine = new ExportTransformationEngine_1.ExportTransformationEngine({
                dryRun: false
            });
            mockGenerator.prototype.generateIntelligenceSystems.mockRejectedValueOnce(new Error('Test error'));
            await errorEngine.executeTransformation();
            const log = errorEngine.getTransformationLog();
            expect(log.length).toBeGreaterThan(0);
            expect(log[0]).toHaveProperty('type', ExportTransformationEngine_1.TransformationErrorType.GENERATION_FAILED);
            expect(log[0]).toHaveProperty('severity', ExportTransformationEngine_1.ErrorSeverity.HIGH);
        });
        it('should clear transformation log', () => {
            const log = engine.getTransformationLog();
            engine.clearTransformationLog();
            expect(engine.getTransformationLog()).toHaveLength(0);
        });
    });
    describe('batch safety scoring', () => {
        it('should calculate batch safety scores correctly', () => {
            const mockFiles = [
                { safetyScore: 90, transformationCandidates: [{ transformationComplexity: 'SIMPLE' }] },
                { safetyScore: 80, transformationCandidates: [{ transformationComplexity: 'COMPLEX' }] }
            ];
            const score = engine.calculateBatchSafetyScore(mockFiles);
            expect(score).toBeLessThan(85); // Should be penalized for complex candidate
            expect(score).toBeGreaterThan(0);
        });
        it('should return 100 for empty batch', () => {
            const score = engine.calculateBatchSafetyScore([]);
            expect(score).toBe(100);
        });
    });
    describe('duration estimation', () => {
        it('should estimate batch duration based on complexity', () => {
            const mockFiles = [
                {
                    transformationCandidates: [
                        { transformationComplexity: 'SIMPLE' },
                        { transformationComplexity: 'COMPLEX' }
                    ]
                }
            ];
            const duration = engine.estimateBatchDuration(mockFiles);
            expect(duration).toBeGreaterThan(2); // Base time + complexity
            expect(typeof duration).toBe('number');
        });
        it('should handle empty files array', () => {
            const duration = engine.estimateBatchDuration([]);
            expect(duration).toBe(0);
        });
    });
    describe('configuration management', () => {
        it('should return configuration copy', () => {
            const config1 = engine.getConfig();
            const config2 = engine.getConfig();
            expect(config1).toEqual(config2);
            expect(config1).not.toBe(config2); // Should be different objects
        });
        it('should not allow external modification of config', () => {
            const config = engine.getConfig();
            config.batchSize = 999;
            const newConfig = engine.getConfig();
            expect(newConfig.batchSize).not.toBe(999);
        });
    });
    describe('summary generation', () => {
        it('should generate comprehensive summary', async () => {
            const summary = await engine.executeTransformation();
            expect(summary.totalBatches).toBeGreaterThan(0);
            expect(summary.successRate).toBe(100); // Dry run
            expect(summary.totalDuration).toBeGreaterThan(0);
            expect(summary.generationSummary).toHaveProperty('totalSystemsGenerated');
            expect(summary.generationSummary).toHaveProperty('totalCapabilitiesAdded');
            expect(summary.generationSummary).toHaveProperty('estimatedTotalValue');
        });
        it('should handle empty results', () => {
            const summary = engine.generateTransformationSummary([], 10);
            expect(summary.totalBatches).toBe(0);
            expect(summary.successfulBatches).toBe(0);
            expect(summary.successRate).toBe(0);
            expect(summary.totalDuration).toBe(10);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9zZXJ2aWNlcy9jYW1wYWlnbi9FeHBvcnRUcmFuc2Zvcm1hdGlvbkVuZ2luZS50ZXN0LnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7O0dBR0c7O0FBYUgsb0JBQW9CO0FBQ3BCLElBQUksQ0FBQyxJQUFJLENBQUMsd0JBQXdCLENBQUMsQ0FBQztBQUNwQyxJQUFJLENBQUMsSUFBSSxDQUFDLG1DQUFtQyxDQUFDLENBQUM7QUFDL0MsSUFBSSxDQUFDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO0FBQzlCLElBQUksQ0FBQyxJQUFJLENBQUMsbUJBQW1CLENBQUMsQ0FBQztBQUMvQixJQUFJLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFDO0FBaEIzQiw2RUFLc0M7QUFDdEMsaUVBQThEO0FBQzlELHVGQUFvRjtBQUNwRixxREFBa0Q7QUFDbEQsdURBQW9EO0FBU3BELE1BQU0sWUFBWSxHQUFHLDJDQUFxRSxDQUFDO0FBQzNGLE1BQU0sYUFBYSxHQUFHLGlFQUEyRixDQUFDO0FBQ2xILE1BQU0sa0JBQWtCLEdBQUcsK0JBQXlELENBQUM7QUFDckYsTUFBTSxtQkFBbUIsR0FBRyxpQ0FBMkQsQ0FBQztBQUV4RixRQUFRLENBQUMsNEJBQTRCLEVBQUUsR0FBRyxFQUFFO0lBQzFDLElBQUksTUFBa0MsQ0FBQztJQUV2QyxVQUFVLENBQUMsR0FBRyxFQUFFO1FBQ2QsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO1FBRXJCLGdCQUFnQjtRQUNoQixZQUFZLENBQUMsU0FBUyxDQUFDLG9CQUFvQixHQUFHLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQztZQUN4RSxVQUFVLEVBQUUsRUFBRTtZQUNkLGtCQUFrQixFQUFFLEVBQUU7WUFDdEIsaUJBQWlCLEVBQUU7Z0JBQ2pCO29CQUNFLFFBQVEsRUFBRSxnQkFBZ0I7b0JBQzFCLFFBQVEsRUFBRSxNQUFNO29CQUNoQixhQUFhLEVBQUUsRUFBRTtv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SSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3BDLE1BQU0sQ0FBQyxPQUFPLENBQUMsYUFBYSxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ3pDLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvR3JlZ0Nhc3Ryby9EZXNrdG9wL1doYXRUb0VhdE5leHQvc3JjL3NlcnZpY2VzL2NhbXBhaWduL0V4cG9ydFRyYW5zZm9ybWF0aW9uRW5naW5lLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBFeHBvcnQgVHJhbnNmb3JtYXRpb24gRW5naW5lIFRlc3RzXG4gKiBQZXJmZWN0IENvZGViYXNlIENhbXBhaWduIC0gUGhhc2UgMyBJbXBsZW1lbnRhdGlvblxuICovXG5cbmltcG9ydCB7IFxuICBFeHBvcnRUcmFuc2Zvcm1hdGlvbkVuZ2luZSwgXG4gIEJhdGNoUHJpb3JpdHksIFxuICBUcmFuc2Zvcm1hdGlvbkVycm9yVHlwZSwgXG4gIEVycm9yU2V2ZXJpdHkgXG59IGZyb20gJy4vRXhwb3J0VHJhbnNmb3JtYXRpb25FbmdpbmUnO1xuaW1wb3J0IHsgVW51c2VkRXhwb3J0QW5hbHl6ZXIgfSBmcm9tICcuL1VudXNlZEV4cG9ydEFuYWx5emVyJztcbmltcG9ydCB7IEVudGVycHJpc2VJbnRlbGxpZ2VuY2VHZW5lcmF0b3IgfSBmcm9tICcuL0VudGVycHJpc2VJbnRlbGxpZ2VuY2VHZW5lcmF0b3InO1xuaW1wb3J0IHsgU2FmZXR5UHJvdG9jb2wgfSBmcm9tICcuL1NhZmV0eVByb3RvY29sJztcbmltcG9ydCB7IFByb2dyZXNzVHJhY2tlciB9IGZyb20gJy4vUHJvZ3Jlc3NUcmFja2VyJztcblxuLy8gTW9jayBkZXBlbmRlbmNpZXNcbmplc3QubW9jaygnLi9VbnVzZWRFeHBvcnRBbmFseXplcicpO1xuamVzdC5tb2NrKCcuL0VudGVycHJpc2VJbnRlbGxpZ2VuY2VHZW5lcmF0b3InKTtcbmplc3QubW9jaygnLi9TYWZldHlQcm90b2NvbCcpO1xuamVzdC5tb2NrKCcuL1Byb2dyZXNzVHJhY2tlcicpO1xuamVzdC5tb2NrKCdjaGlsZF9wcm9jZXNzJyk7XG5cbmNvbnN0IG1vY2tBbmFseXplciA9IFVudXNlZEV4cG9ydEFuYWx5emVyIGFzIGplc3QuTW9ja2VkQ2xhc3M8dHlwZW9mIFVudXNlZEV4cG9ydEFuYWx5emVyPjtcbmNvbnN0IG1vY2tHZW5lcmF0b3IgPSBFbnRlcnByaXNlSW50ZWxsaWdlbmNlR2VuZXJhdG9yIGFzIGplc3QuTW9ja2VkQ2xhc3M8dHlwZW9mIEVudGVycHJpc2VJbnRlbGxpZ2VuY2VHZW5lcmF0b3I+O1xuY29uc3QgbW9ja1NhZmV0eVByb3RvY29sID0gU2FmZXR5UHJvdG9jb2wgYXMgamVzdC5Nb2NrZWRDbGFzczx0eXBlb2YgU2FmZXR5UHJvdG9jb2w+O1xuY29uc3QgbW9ja1Byb2dyZXNzVHJhY2tlciA9IFByb2dyZXNzVHJhY2tlciBhcyBqZXN0Lk1vY2tlZENsYXNzPHR5cGVvZiBQcm9ncmVzc1RyYWNrZXI+O1xuXG5kZXNjcmliZSgnRXhwb3J0VHJhbnNmb3JtYXRpb25FbmdpbmUnLCAoKSA9PiB7XG4gIGxldCBlbmdpbmU6IEV4cG9ydFRyYW5zZm9ybWF0aW9uRW5naW5lO1xuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICAgIFxuICAgIC8vIE1vY2sgYW5hbHl6ZXJcbiAgICBtb2NrQW5hbHl6ZXIucHJvdG90eXBlLmFuYWx5emVVbnVzZWRFeHBvcnRzID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHtcbiAgICAgIHRvdGFsRmlsZXM6IDEwLFxuICAgICAgdG90YWxVbnVzZWRFeHBvcnRzOiAyNSxcbiAgICAgIGhpZ2hQcmlvcml0eUZpbGVzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBmaWxlUGF0aDogJy90ZXN0L2hpZ2gxLnRzJyxcbiAgICAgICAgICBwcmlvcml0eTogJ0hJR0gnLFxuICAgICAgICAgIHVudXNlZEV4cG9ydHM6IFtdLFxuICAgICAgICAgIHNhZmV0eVNjb3JlOiA5MCxcbiAgICAgICAgICB0cmFuc2Zvcm1hdGlvbkNhbmRpZGF0ZXM6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgZXhwb3J0OiB7IGV4cG9ydE5hbWU6ICd0ZXN0RXhwb3J0MScsIGV4cG9ydFR5cGU6ICdmdW5jdGlvbicsIGNvbXBsZXhpdHk6IDUgfSxcbiAgICAgICAgICAgICAgaW50ZWxsaWdlbmNlU3lzdGVtTmFtZTogJ1RFU1RfRVhQT1JUXzFfSU5URUxMSUdFTkNFX1NZU1RFTScsXG4gICAgICAgICAgICAgIHRyYW5zZm9ybWF0aW9uQ29tcGxleGl0eTogJ01PREVSQVRFJyxcbiAgICAgICAgICAgICAgc2FmZXR5U2NvcmU6IDg1LFxuICAgICAgICAgICAgICBlc3RpbWF0ZWRCZW5lZml0OiA3NVxuICAgICAgICAgICAgfVxuICAgICAgICAgIF0sXG4gICAgICAgICAgY2F0ZWdvcnk6ICdDT1JFJ1xuICAgICAgICB9XG4gICAgICBdLFxuICAgICAgbWVkaXVtUHJpb3JpdHlGaWxlczogW1xuICAgICAgICB7XG4gICAgICAgICAgZmlsZVBhdGg6ICcvdGVzdC9tZWRpdW0xLnRzJyxcbiAgICAgICAgICBwcmlvcml0eTogJ01FRElVTScsXG4gICAgICAgICAgdW51c2VkRXhwb3J0czogW10sXG4gICAgICAgICAgc2FmZXR5U2NvcmU6IDg1LFxuICAgICAgICAgIHRyYW5zZm9ybWF0aW9uQ2FuZGlkYXRlczogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBleHBvcnQ6IHsgZXhwb3J0TmFtZTogJ3Rlc3RFeHBvcnQyJywgZXhwb3J0VHlwZTogJ2NsYXNzJywgY29tcGxleGl0eTogOCB9LFxuICAgICAgICAgICAgICBpbnRlbGxpZ2VuY2VTeXN0ZW1OYW1lOiAnVEVTVF9FWFBPUlRfMl9JTlRFTExJR0VOQ0VfU1lTVEVNJyxcbiAgICAgICAgICAgICAgdHJhbnNmb3JtYXRpb25Db21wbGV4aXR5OiAnQ09NUExFWCcsXG4gICAgICAgICAgICAgIHNhZmV0eVNjb3JlOiA4MCxcbiAgICAgICAgICAgICAgZXN0aW1hdGVkQmVuZWZpdDogODBcbiAgICAgICAgICAgIH1cbiAgICAgICAgICBdLFxuICAgICAgICAgIGNhdGVnb3J5OiAnQ09SRSdcbiAgICAgICAgfVxuICAgICAgXSxcbiAgICAgIGxvd1ByaW9yaXR5RmlsZXM6IFtdLFxuICAgICAgc3VtbWFyeToge1xuICAgICAgICByZWNpcGVGaWxlczogMixcbiAgICAgICAgY29yZUZpbGVzOiA4LFxuICAgICAgICBleHRlcm5hbEZpbGVzOiAwLFxuICAgICAgICB0b3RhbFRyYW5zZm9ybWF0aW9uQ2FuZGlkYXRlczogMixcbiAgICAgICAgYXZlcmFnZVNhZmV0eVNjb3JlOiA4Ny41LFxuICAgICAgICBlc3RpbWF0ZWRJbnRlbGxpZ2VuY2VTeXN0ZW1zOiAyXG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBNb2NrIGdlbmVyYXRvclxuICAgIG1vY2tHZW5lcmF0b3IucHJvdG90eXBlLmdlbmVyYXRlSW50ZWxsaWdlbmNlU3lzdGVtcyA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZShbXG4gICAgICB7XG4gICAgICAgIHN5c3RlbU5hbWU6ICdURVNUX1NZU1RFTV8xJyxcbiAgICAgICAgZmlsZVBhdGg6ICcvb3V0cHV0L1RFU1RfU1lTVEVNXzEudHMnLFxuICAgICAgICBvcmlnaW5hbEV4cG9ydDogeyBleHBvcnROYW1lOiAndGVzdEV4cG9ydDEnLCBleHBvcnRUeXBlOiAnZnVuY3Rpb24nIH0sXG4gICAgICAgIGdlbmVyYXRlZENvZGU6ICdnZW5lcmF0ZWQgY29kZScsXG4gICAgICAgIGNhcGFiaWxpdGllczogW10sXG4gICAgICAgIGludGVncmF0aW9uUG9pbnRzOiBbXSxcbiAgICAgICAgZXN0aW1hdGVkVmFsdWU6IDc1LFxuICAgICAgICBjb21wbGV4aXR5OiAnTU9ERVJBVEUnXG4gICAgICB9XG4gICAgXSk7XG5cbiAgICBtb2NrR2VuZXJhdG9yLnByb3RvdHlwZS5nZW5lcmF0ZVN1bW1hcnkgPSBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHtcbiAgICAgIHRvdGFsU3lzdGVtc0dlbmVyYXRlZDogMSxcbiAgICAgIHRvdGFsQ2FwYWJpbGl0aWVzQWRkZWQ6IDMsXG4gICAgICB0b3RhbEludGVncmF0aW9uUG9pbnRzOiAyLFxuICAgICAgYXZlcmFnZUNvbXBsZXhpdHk6IDIuNSxcbiAgICAgIGVzdGltYXRlZFRvdGFsVmFsdWU6IDc1LFxuICAgICAgZ2VuZXJhdGlvbnNCeUNhdGVnb3J5OiB7IGZ1bmN0aW9uOiAxIH1cbiAgICB9KTtcblxuICAgIC8vIE1vY2sgc2FmZXR5IHByb3RvY29sXG4gICAgbW9ja1NhZmV0eVByb3RvY29sLnByb3RvdHlwZS5jcmVhdGVTYWZldHlDaGVja3BvaW50ID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKCdjaGVja3BvaW50LTEyMycpO1xuICAgIG1vY2tTYWZldHlQcm90b2NvbC5wcm90b3R5cGUucm9sbGJhY2tUb0NoZWNrcG9pbnQgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUodW5kZWZpbmVkKTtcbiAgICBtb2NrU2FmZXR5UHJvdG9jb2wucHJvdG90eXBlLmVtZXJnZW5jeVJvbGxiYWNrID0gamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHVuZGVmaW5lZCk7XG5cbiAgICAvLyBNb2NrIHByb2dyZXNzIHRyYWNrZXJcbiAgICBtb2NrUHJvZ3Jlc3NUcmFja2VyLnByb3RvdHlwZS51cGRhdGVQcm9ncmVzcyA9IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh1bmRlZmluZWQpO1xuXG4gICAgZW5naW5lID0gbmV3IEV4cG9ydFRyYW5zZm9ybWF0aW9uRW5naW5lKHtcbiAgICAgIGJhdGNoU2l6ZTogNSxcbiAgICAgIHNhZmV0eVRocmVzaG9sZDogODAsXG4gICAgICBkcnlSdW46IHRydWUgLy8gVXNlIGRyeSBydW4gZm9yIHRlc3RzXG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdjb25zdHJ1Y3RvcicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGluaXRpYWxpemUgd2l0aCBkZWZhdWx0IGNvbmZpZ3VyYXRpb24nLCAoKSA9PiB7XG4gICAgICBjb25zdCBkZWZhdWx0RW5naW5lID0gbmV3IEV4cG9ydFRyYW5zZm9ybWF0aW9uRW5naW5lKCk7XG4gICAgICBjb25zdCBjb25maWcgPSBkZWZhdWx0RW5naW5lLmdldENvbmZpZygpO1xuICAgICAgXG4gICAgICBleHBlY3QoY29uZmlnLmJhdGNoU2l6ZSkudG9CZSgxMCk7XG4gICAgICBleHBlY3QoY29uZmlnLnNhZmV0eVRocmVzaG9sZCkudG9CZSg4MCk7XG4gICAgICBleHBlY3QoY29uZmlnLmJ1aWxkVmFsaWRhdGlvbkVuYWJsZWQpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QoY29uZmlnLnRlc3RWYWxpZGF0aW9uRW5hYmxlZCkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChjb25maWcucm9sbGJhY2tPbkZhaWx1cmUpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGluaXRpYWxpemUgd2l0aCBjdXN0b20gY29uZmlndXJhdGlvbicsICgpID0+IHtcbiAgICAgIGNvbnN0IGN1c3RvbUVuZ2luZSA9IG5ldyBFeHBvcnRUcmFuc2Zvcm1hdGlvbkVuZ2luZSh7XG4gICAgICAgIGJhdGNoU2l6ZTogMTUsXG4gICAgICAgIHNhZmV0eVRocmVzaG9sZDogOTAsXG4gICAgICAgIGRyeVJ1bjogdHJ1ZVxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIGNvbnN0IGNvbmZpZyA9IGN1c3RvbUVuZ2luZS5nZXRDb25maWcoKTtcbiAgICAgIGV4cGVjdChjb25maWcuYmF0Y2hTaXplKS50b0JlKDE1KTtcbiAgICAgIGV4cGVjdChjb25maWcuc2FmZXR5VGhyZXNob2xkKS50b0JlKDkwKTtcbiAgICAgIGV4cGVjdChjb25maWcuZHJ5UnVuKS50b0JlKHRydWUpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZXhlY3V0ZVRyYW5zZm9ybWF0aW9uJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZXhlY3V0ZSBjb21wbGV0ZSB0cmFuc2Zvcm1hdGlvbiBjYW1wYWlnbicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHN1bW1hcnkgPSBhd2FpdCBlbmdpbmUuZXhlY3V0ZVRyYW5zZm9ybWF0aW9uKCk7XG5cbiAgICAgIGV4cGVjdChzdW1tYXJ5KS50b0hhdmVQcm9wZXJ0eSgndG90YWxCYXRjaGVzJyk7XG4gICAgICBleHBlY3Qoc3VtbWFyeSkudG9IYXZlUHJvcGVydHkoJ3N1Y2Nlc3NmdWxCYXRjaGVzJyk7XG4gICAgICBleHBlY3Qoc3VtbWFyeSkudG9IYXZlUHJvcGVydHkoJ3RvdGFsRmlsZXNQcm9jZXNzZWQnKTtcbiAgICAgIGV4cGVjdChzdW1tYXJ5KS50b0hhdmVQcm9wZXJ0eSgndG90YWxTeXN0ZW1zR2VuZXJhdGVkJyk7XG4gICAgICBleHBlY3Qoc3VtbWFyeSkudG9IYXZlUHJvcGVydHkoJ3N1Y2Nlc3NSYXRlJyk7XG4gICAgICBleHBlY3Qoc3VtbWFyeSkudG9IYXZlUHJvcGVydHkoJ2dlbmVyYXRpb25TdW1tYXJ5Jyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHBlcmZvcm0gYW5hbHlzaXMgcGhhc2UnLCBhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBlbmdpbmUuZXhlY3V0ZVRyYW5zZm9ybWF0aW9uKCk7XG5cbiAgICAgIGV4cGVjdChtb2NrQW5hbHl6ZXIucHJvdG90eXBlLmFuYWx5emVVbnVzZWRFeHBvcnRzKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGNyZWF0ZSBzYWZldHkgY2hlY2twb2ludHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBlbmdpbmUuZXhlY3V0ZVRyYW5zZm9ybWF0aW9uKCk7XG5cbiAgICAgIGV4cGVjdChtb2NrU2FmZXR5UHJvdG9jb2wucHJvdG90eXBlLmNyZWF0ZVNhZmV0eUNoZWNrcG9pbnQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCd0cmFuc2Zvcm1hdGlvbi1zdGFydCcpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgY3JpdGljYWwgZmFpbHVyZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrQW5hbHl6ZXIucHJvdG90eXBlLmFuYWx5emVVbnVzZWRFeHBvcnRzLm1vY2tSZWplY3RlZFZhbHVlT25jZShuZXcgRXJyb3IoJ0FuYWx5c2lzIGZhaWxlZCcpKTtcblxuICAgICAgYXdhaXQgZXhwZWN0KGVuZ2luZS5leGVjdXRlVHJhbnNmb3JtYXRpb24oKSkucmVqZWN0cy50b1Rocm93KCdBbmFseXNpcyBmYWlsZWQnKTtcbiAgICAgIGV4cGVjdChtb2NrU2FmZXR5UHJvdG9jb2wucHJvdG90eXBlLmVtZXJnZW5jeVJvbGxiYWNrKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdiYXRjaCBwbGFubmluZycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGNyZWF0ZSBiYXRjaGVzIGJhc2VkIG9uIHByaW9yaXR5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgc3VtbWFyeSA9IGF3YWl0IGVuZ2luZS5leGVjdXRlVHJhbnNmb3JtYXRpb24oKTtcblxuICAgICAgLy8gU2hvdWxkIGhhdmUgY3JlYXRlZCBiYXRjaGVzIGZvciBoaWdoIGFuZCBtZWRpdW0gcHJpb3JpdHkgZmlsZXNcbiAgICAgIGV4cGVjdChzdW1tYXJ5LnRvdGFsQmF0Y2hlcykudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXNwZWN0IGJhdGNoIHNpemUgY29uZmlndXJhdGlvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHNtYWxsQmF0Y2hFbmdpbmUgPSBuZXcgRXhwb3J0VHJhbnNmb3JtYXRpb25FbmdpbmUoe1xuICAgICAgICBiYXRjaFNpemU6IDEsXG4gICAgICAgIGRyeVJ1bjogdHJ1ZVxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHN1bW1hcnkgPSBhd2FpdCBzbWFsbEJhdGNoRW5naW5lLmV4ZWN1dGVUcmFuc2Zvcm1hdGlvbigpO1xuXG4gICAgICAvLyBXaXRoIGJhdGNoIHNpemUgMSBhbmQgMiBmaWxlcywgc2hvdWxkIGNyZWF0ZSAyIGJhdGNoZXNcbiAgICAgIGV4cGVjdChzdW1tYXJ5LnRvdGFsQmF0Y2hlcykudG9CZSgyKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2JhdGNoIGV4ZWN1dGlvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGV4ZWN1dGUgYmF0Y2hlcyBpbiBwcmlvcml0eSBvcmRlcicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHN1bW1hcnkgPSBhd2FpdCBlbmdpbmUuZXhlY3V0ZVRyYW5zZm9ybWF0aW9uKCk7XG5cbiAgICAgIGV4cGVjdChzdW1tYXJ5LnN1Y2Nlc3NmdWxCYXRjaGVzKS50b0JlR3JlYXRlclRoYW4oMCk7XG4gICAgICBleHBlY3Qoc3VtbWFyeS5zdWNjZXNzUmF0ZSkudG9CZSgxMDApOyAvLyBEcnkgcnVuIHNob3VsZCBhbHdheXMgc3VjY2VlZFxuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgYmF0Y2ggZmFpbHVyZXMgd2l0aCByb2xsYmFjaycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IGZhaWxpbmdFbmdpbmUgPSBuZXcgRXhwb3J0VHJhbnNmb3JtYXRpb25FbmdpbmUoe1xuICAgICAgICBkcnlSdW46IGZhbHNlLFxuICAgICAgICByb2xsYmFja09uRmFpbHVyZTogdHJ1ZVxuICAgICAgfSk7XG5cbiAgICAgIG1vY2tHZW5lcmF0b3IucHJvdG90eXBlLmdlbmVyYXRlSW50ZWxsaWdlbmNlU3lzdGVtcy5tb2NrUmVqZWN0ZWRWYWx1ZU9uY2UobmV3IEVycm9yKCdHZW5lcmF0aW9uIGZhaWxlZCcpKTtcblxuICAgICAgY29uc3Qgc3VtbWFyeSA9IGF3YWl0IGZhaWxpbmdFbmdpbmUuZXhlY3V0ZVRyYW5zZm9ybWF0aW9uKCk7XG5cbiAgICAgIGV4cGVjdChzdW1tYXJ5LmZhaWxlZEJhdGNoZXMpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICAgIGV4cGVjdChtb2NrU2FmZXR5UHJvdG9jb2wucHJvdG90eXBlLnJvbGxiYWNrVG9DaGVja3BvaW50KS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHNraXAgcm9sbGJhY2sgd2hlbiBkaXNhYmxlZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG5vUm9sbGJhY2tFbmdpbmUgPSBuZXcgRXhwb3J0VHJhbnNmb3JtYXRpb25FbmdpbmUoe1xuICAgICAgICBkcnlSdW46IGZhbHNlLFxuICAgICAgICByb2xsYmFja09uRmFpbHVyZTogZmFsc2VcbiAgICAgIH0pO1xuXG4gICAgICBtb2NrR2VuZXJhdG9yLnByb3RvdHlwZS5nZW5lcmF0ZUludGVsbGlnZW5jZVN5c3RlbXMubW9ja1JlamVjdGVkVmFsdWVPbmNlKG5ldyBFcnJvcignR2VuZXJhdGlvbiBmYWlsZWQnKSk7XG5cbiAgICAgIGF3YWl0IG5vUm9sbGJhY2tFbmdpbmUuZXhlY3V0ZVRyYW5zZm9ybWF0aW9uKCk7XG5cbiAgICAgIGV4cGVjdChtb2NrU2FmZXR5UHJvdG9jb2wucHJvdG90eXBlLnJvbGxiYWNrVG9DaGVja3BvaW50KS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnc2FmZXR5IHZhbGlkYXRpb24nLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBlbmZvcmNlIHNhZmV0eSB0aHJlc2hvbGQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBzdHJpY3RFbmdpbmUgPSBuZXcgRXhwb3J0VHJhbnNmb3JtYXRpb25FbmdpbmUoe1xuICAgICAgICBzYWZldHlUaHJlc2hvbGQ6IDk1LCAvLyBIaWdoZXIgdGhhbiBtb2NrIGRhdGFcbiAgICAgICAgZHJ5UnVuOiBmYWxzZVxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHN1bW1hcnkgPSBhd2FpdCBzdHJpY3RFbmdpbmUuZXhlY3V0ZVRyYW5zZm9ybWF0aW9uKCk7XG5cbiAgICAgIC8vIFNob3VsZCBoYXZlIHdhcm5pbmdzIGFib3V0IHNhZmV0eSB0aHJlc2hvbGRcbiAgICAgIGV4cGVjdChzdW1tYXJ5LnRvdGFsV2FybmluZ3MpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgY3JlYXRlIGNoZWNrcG9pbnRzIGZvciBlYWNoIGJhdGNoJywgYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgZW5naW5lLmV4ZWN1dGVUcmFuc2Zvcm1hdGlvbigpO1xuXG4gICAgICAvLyBTaG91bGQgY3JlYXRlIHRyYW5zZm9ybWF0aW9uLXN0YXJ0IGNoZWNrcG9pbnQgcGx1cyBiYXRjaCBjaGVja3BvaW50c1xuICAgICAgZXhwZWN0KG1vY2tTYWZldHlQcm90b2NvbC5wcm90b3R5cGUuY3JlYXRlU2FmZXR5Q2hlY2twb2ludCkudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDMpOyAvLyBzdGFydCArIDIgYmF0Y2hlc1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZXJyb3IgaGFuZGxpbmcnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBsb2cgdHJhbnNmb3JtYXRpb24gZXJyb3JzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZXJyb3JFbmdpbmUgPSBuZXcgRXhwb3J0VHJhbnNmb3JtYXRpb25FbmdpbmUoe1xuICAgICAgICBkcnlSdW46IGZhbHNlXG4gICAgICB9KTtcblxuICAgICAgbW9ja0dlbmVyYXRvci5wcm90b3R5cGUuZ2VuZXJhdGVJbnRlbGxpZ2VuY2VTeXN0ZW1zLm1vY2tSZWplY3RlZFZhbHVlT25jZShuZXcgRXJyb3IoJ1Rlc3QgZXJyb3InKSk7XG5cbiAgICAgIGF3YWl0IGVycm9yRW5naW5lLmV4ZWN1dGVUcmFuc2Zvcm1hdGlvbigpO1xuXG4gICAgICBjb25zdCBsb2cgPSBlcnJvckVuZ2luZS5nZXRUcmFuc2Zvcm1hdGlvbkxvZygpO1xuICAgICAgZXhwZWN0KGxvZy5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICAgIGV4cGVjdChsb2dbMF0pLnRvSGF2ZVByb3BlcnR5KCd0eXBlJywgVHJhbnNmb3JtYXRpb25FcnJvclR5cGUuR0VORVJBVElPTl9GQUlMRUQpO1xuICAgICAgZXhwZWN0KGxvZ1swXSkudG9IYXZlUHJvcGVydHkoJ3NldmVyaXR5JywgRXJyb3JTZXZlcml0eS5ISUdIKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgY2xlYXIgdHJhbnNmb3JtYXRpb24gbG9nJywgKCkgPT4ge1xuICAgICAgY29uc3QgbG9nID0gZW5naW5lLmdldFRyYW5zZm9ybWF0aW9uTG9nKCk7XG4gICAgICBlbmdpbmUuY2xlYXJUcmFuc2Zvcm1hdGlvbkxvZygpO1xuICAgICAgXG4gICAgICBleHBlY3QoZW5naW5lLmdldFRyYW5zZm9ybWF0aW9uTG9nKCkpLnRvSGF2ZUxlbmd0aCgwKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2JhdGNoIHNhZmV0eSBzY29yaW5nJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgY2FsY3VsYXRlIGJhdGNoIHNhZmV0eSBzY29yZXMgY29ycmVjdGx5JywgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja0ZpbGVzID0gW1xuICAgICAgICB7IHNhZmV0eVNjb3JlOiA5MCwgdHJhbnNmb3JtYXRpb25DYW5kaWRhdGVzOiBbeyB0cmFuc2Zvcm1hdGlvbkNvbXBsZXhpdHk6ICdTSU1QTEUnIH1dIH0sXG4gICAgICAgIHsgc2FmZXR5U2NvcmU6IDgwLCB0cmFuc2Zvcm1hdGlvbkNhbmRpZGF0ZXM6IFt7IHRyYW5zZm9ybWF0aW9uQ29tcGxleGl0eTogJ0NPTVBMRVgnIH1dIH1cbiAgICAgIF07XG5cbiAgICAgIGNvbnN0IHNjb3JlID0gKGVuZ2luZSBhcyBhbnkpLmNhbGN1bGF0ZUJhdGNoU2FmZXR5U2NvcmUobW9ja0ZpbGVzKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHNjb3JlKS50b0JlTGVzc1RoYW4oODUpOyAvLyBTaG91bGQgYmUgcGVuYWxpemVkIGZvciBjb21wbGV4IGNhbmRpZGF0ZVxuICAgICAgZXhwZWN0KHNjb3JlKS50b0JlR3JlYXRlclRoYW4oMCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiAxMDAgZm9yIGVtcHR5IGJhdGNoJywgKCkgPT4ge1xuICAgICAgY29uc3Qgc2NvcmUgPSAoZW5naW5lIGFzIGFueSkuY2FsY3VsYXRlQmF0Y2hTYWZldHlTY29yZShbXSk7XG4gICAgICBleHBlY3Qoc2NvcmUpLnRvQmUoMTAwKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2R1cmF0aW9uIGVzdGltYXRpb24nLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBlc3RpbWF0ZSBiYXRjaCBkdXJhdGlvbiBiYXNlZCBvbiBjb21wbGV4aXR5JywgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja0ZpbGVzID0gW1xuICAgICAgICB7IFxuICAgICAgICAgIHRyYW5zZm9ybWF0aW9uQ2FuZGlkYXRlczogW1xuICAgICAgICAgICAgeyB0cmFuc2Zvcm1hdGlvbkNvbXBsZXhpdHk6ICdTSU1QTEUnIH0sXG4gICAgICAgICAgICB7IHRyYW5zZm9ybWF0aW9uQ29tcGxleGl0eTogJ0NPTVBMRVgnIH1cbiAgICAgICAgICBdIFxuICAgICAgICB9XG4gICAgICBdO1xuXG4gICAgICBjb25zdCBkdXJhdGlvbiA9IChlbmdpbmUgYXMgYW55KS5lc3RpbWF0ZUJhdGNoRHVyYXRpb24obW9ja0ZpbGVzKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KGR1cmF0aW9uKS50b0JlR3JlYXRlclRoYW4oMik7IC8vIEJhc2UgdGltZSArIGNvbXBsZXhpdHlcbiAgICAgIGV4cGVjdCh0eXBlb2YgZHVyYXRpb24pLnRvQmUoJ251bWJlcicpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZW1wdHkgZmlsZXMgYXJyYXknLCAoKSA9PiB7XG4gICAgICBjb25zdCBkdXJhdGlvbiA9IChlbmdpbmUgYXMgYW55KS5lc3RpbWF0ZUJhdGNoRHVyYXRpb24oW10pO1xuICAgICAgZXhwZWN0KGR1cmF0aW9uKS50b0JlKDApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnY29uZmlndXJhdGlvbiBtYW5hZ2VtZW50JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmV0dXJuIGNvbmZpZ3VyYXRpb24gY29weScsICgpID0+IHtcbiAgICAgIGNvbnN0IGNvbmZpZzEgPSBlbmdpbmUuZ2V0Q29uZmlnKCk7XG4gICAgICBjb25zdCBjb25maWcyID0gZW5naW5lLmdldENvbmZpZygpO1xuICAgICAgXG4gICAgICBleHBlY3QoY29uZmlnMSkudG9FcXVhbChjb25maWcyKTtcbiAgICAgIGV4cGVjdChjb25maWcxKS5ub3QudG9CZShjb25maWcyKTsgLy8gU2hvdWxkIGJlIGRpZmZlcmVudCBvYmplY3RzXG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIG5vdCBhbGxvdyBleHRlcm5hbCBtb2RpZmljYXRpb24gb2YgY29uZmlnJywgKCkgPT4ge1xuICAgICAgY29uc3QgY29uZmlnID0gZW5naW5lLmdldENvbmZpZygpO1xuICAgICAgY29uZmlnLmJhdGNoU2l6ZSA9IDk5OTtcbiAgICAgIFxuICAgICAgY29uc3QgbmV3Q29uZmlnID0gZW5naW5lLmdldENvbmZpZygpO1xuICAgICAgZXhwZWN0KG5ld0NvbmZpZy5iYXRjaFNpemUpLm5vdC50b0JlKDk5OSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdzdW1tYXJ5IGdlbmVyYXRpb24nLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBnZW5lcmF0ZSBjb21wcmVoZW5zaXZlIHN1bW1hcnknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBzdW1tYXJ5ID0gYXdhaXQgZW5naW5lLmV4ZWN1dGVUcmFuc2Zvcm1hdGlvbigpO1xuXG4gICAgICBleHBlY3Qoc3VtbWFyeS50b3RhbEJhdGNoZXMpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICAgIGV4cGVjdChzdW1tYXJ5LnN1Y2Nlc3NSYXRlKS50b0JlKDEwMCk7IC8vIERyeSBydW5cbiAgICAgIGV4cGVjdChzdW1tYXJ5LnRvdGFsRHVyYXRpb24pLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICAgIGV4cGVjdChzdW1tYXJ5LmdlbmVyYXRpb25TdW1tYXJ5KS50b0hhdmVQcm9wZXJ0eSgndG90YWxTeXN0ZW1zR2VuZXJhdGVkJyk7XG4gICAgICBleHBlY3Qoc3VtbWFyeS5nZW5lcmF0aW9uU3VtbWFyeSkudG9IYXZlUHJvcGVydHkoJ3RvdGFsQ2FwYWJpbGl0aWVzQWRkZWQnKTtcbiAgICAgIGV4cGVjdChzdW1tYXJ5LmdlbmVyYXRpb25TdW1tYXJ5KS50b0hhdmVQcm9wZXJ0eSgnZXN0aW1hdGVkVG90YWxWYWx1ZScpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZW1wdHkgcmVzdWx0cycsICgpID0+IHtcbiAgICAgIGNvbnN0IHN1bW1hcnkgPSAoZW5naW5lIGFzIGFueSkuZ2VuZXJhdGVUcmFuc2Zvcm1hdGlvblN1bW1hcnkoW10sIDEwKTtcblxuICAgICAgZXhwZWN0KHN1bW1hcnkudG90YWxCYXRjaGVzKS50b0JlKDApO1xuICAgICAgZXhwZWN0KHN1bW1hcnkuc3VjY2Vzc2Z1bEJhdGNoZXMpLnRvQmUoMCk7XG4gICAgICBleHBlY3Qoc3VtbWFyeS5zdWNjZXNzUmF0ZSkudG9CZSgwKTtcbiAgICAgIGV4cGVjdChzdW1tYXJ5LnRvdGFsRHVyYXRpb24pLnRvQmUoMTApO1xuICAgIH0pO1xuICB9KTtcbn0pOyJdLCJ2ZXJzaW9uIjozfQ==