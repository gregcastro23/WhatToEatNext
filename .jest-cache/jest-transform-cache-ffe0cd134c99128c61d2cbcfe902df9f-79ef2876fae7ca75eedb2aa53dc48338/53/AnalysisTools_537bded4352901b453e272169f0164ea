d0a8d7602d5162064ab3548d7a72b965
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.AnalysisTools = void 0;
const child_process_1 = require("child_process");
const fs = __importStar(require("fs"));
const path = __importStar(require("path"));
const AnyTypeClassifier_1 = require("./AnyTypeClassifier");
const DomainContextAnalyzer_1 = require("./DomainContextAnalyzer");
const types_1 = require("./types");
/**
 * Comprehensive analysis tools for unintentional any type elimination
 * Provides domain distribution analysis, classification accuracy reporting,
 * success rate analysis, and manual review recommendations
 */
class AnalysisTools {
    classifier;
    domainAnalyzer;
    analysisHistory = [];
    constructor() {
        this.classifier = new AnyTypeClassifier_1.AnyTypeClassifier();
        this.domainAnalyzer = new DomainContextAnalyzer_1.DomainContextAnalyzer();
        this.loadAnalysisHistory();
    }
    /**
     * Analyze current any type distribution by domain
     */
    async analyzeDomainDistribution() {
        console.log('Analyzing any type distribution by domain...');
        const anyTypeOccurrences = await this.findAllAnyTypes();
        const domainDistribution = {
            [types_1.CodeDomain.ASTROLOGICAL]: 0,
            [types_1.CodeDomain.RECIPE]: 0,
            [types_1.CodeDomain.CAMPAIGN]: 0,
            [types_1.CodeDomain.INTELLIGENCE]: 0,
            [types_1.CodeDomain.SERVICE]: 0,
            [types_1.CodeDomain.COMPONENT]: 0,
            [types_1.CodeDomain.UTILITY]: 0,
            [types_1.CodeDomain.TEST]: 0
        };
        const categoryDistribution = {
            [types_1.AnyTypeCategory.ERROR_HANDLING]: 0,
            [types_1.AnyTypeCategory.EXTERNAL_API]: 0,
            [types_1.AnyTypeCategory.TEST_MOCK]: 0,
            [types_1.AnyTypeCategory.DYNAMIC_CONFIG]: 0,
            [types_1.AnyTypeCategory.LEGACY_COMPATIBILITY]: 0,
            [types_1.AnyTypeCategory.ARRAY_TYPE]: 0,
            [types_1.AnyTypeCategory.RECORD_TYPE]: 0,
            [types_1.AnyTypeCategory.FUNCTION_PARAM]: 0,
            [types_1.AnyTypeCategory.RETURN_TYPE]: 0,
            [types_1.AnyTypeCategory.TYPE_ASSERTION]: 0
        };
        const intentionalCount = { count: 0 };
        const unintentionalCount = { count: 0 };
        for (const occurrence of anyTypeOccurrences) {
            const context = await this.createClassificationContext(occurrence);
            const domainContext = await this.domainAnalyzer.analyzeDomain(context);
            const classification = await this.classifier.classify(context);
            // Count by domain
            domainDistribution[domainContext.domain]++;
            // Count by category
            categoryDistribution[classification.category]++;
            // Count by intentionality
            if (classification.isIntentional) {
                intentionalCount.count++;
            }
            else {
                unintentionalCount.count++;
            }
        }
        const totalCount = anyTypeOccurrences.length;
        const distribution = {
            totalAnyTypes: totalCount,
            byDomain: Object.entries(domainDistribution).map(([domain, count]) => ({
                domain: domain,
                count,
                percentage: totalCount > 0 ? (count / totalCount) * 100 : 0
            })),
            byCategory: Object.entries(categoryDistribution).map(([category, count]) => ({
                category: category,
                count,
                percentage: totalCount > 0 ? (count / totalCount) * 100 : 0
            })),
            intentionalVsUnintentional: {
                intentional: {
                    count: intentionalCount.count,
                    percentage: totalCount > 0 ? (intentionalCount.count / totalCount) * 100 : 0
                },
                unintentional: {
                    count: unintentionalCount.count,
                    percentage: totalCount > 0 ? (unintentionalCount.count / totalCount) * 100 : 0
                }
            },
            analysisDate: new Date()
        };
        console.log(`Domain distribution analysis complete: ${totalCount} any types found`);
        return distribution;
    }
    /**
     * Implement classification accuracy reporting
     */
    async generateClassificationAccuracyReport() {
        console.log('Generating classification accuracy report...');
        const anyTypeOccurrences = await this.findAllAnyTypes();
        const sampleSize = Math.min(100, anyTypeOccurrences.length); // Sample for accuracy testing
        const sample = anyTypeOccurrences.slice(0, sampleSize);
        let correctClassifications = 0;
        let totalClassifications = 0;
        const confidenceScores = [];
        const categoryAccuracy = {
            [types_1.AnyTypeCategory.ERROR_HANDLING]: { correct: 0, total: 0 },
            [types_1.AnyTypeCategory.EXTERNAL_API]: { correct: 0, total: 0 },
            [types_1.AnyTypeCategory.TEST_MOCK]: { correct: 0, total: 0 },
            [types_1.AnyTypeCategory.DYNAMIC_CONFIG]: { correct: 0, total: 0 },
            [types_1.AnyTypeCategory.LEGACY_COMPATIBILITY]: { correct: 0, total: 0 },
            [types_1.AnyTypeCategory.ARRAY_TYPE]: { correct: 0, total: 0 },
            [types_1.AnyTypeCategory.RECORD_TYPE]: { correct: 0, total: 0 },
            [types_1.AnyTypeCategory.FUNCTION_PARAM]: { correct: 0, total: 0 },
            [types_1.AnyTypeCategory.RETURN_TYPE]: { correct: 0, total: 0 },
            [types_1.AnyTypeCategory.TYPE_ASSERTION]: { correct: 0, total: 0 }
        };
        for (const occurrence of sample) {
            const context = await this.createClassificationContext(occurrence);
            const classification = await this.classifier.classify(context);
            totalClassifications++;
            confidenceScores.push(classification.confidence);
            categoryAccuracy[classification.category].total++;
            // Validate classification accuracy using heuristics
            const isAccurate = await this.validateClassificationAccuracy(context, classification);
            if (isAccurate) {
                correctClassifications++;
                categoryAccuracy[classification.category].correct++;
            }
        }
        const overallAccuracy = totalClassifications > 0 ? (correctClassifications / totalClassifications) * 100 : 0;
        const averageConfidence = confidenceScores.length > 0
            ? confidenceScores.reduce((sum, score) => sum + score, 0) / confidenceScores.length
            : 0;
        const report = {
            overallAccuracy,
            averageConfidence,
            sampleSize,
            categoryAccuracy: Object.entries(categoryAccuracy).map(([category, stats]) => ({
                category: category,
                accuracy: stats.total > 0 ? (stats.correct / stats.total) * 100 : 0,
                sampleCount: stats.total
            })),
            confidenceDistribution: this.calculateConfidenceDistribution(confidenceScores),
            reportDate: new Date()
        };
        console.log(`Classification accuracy report complete: ${overallAccuracy.toFixed(1)}% accuracy`);
        return report;
    }
    /**
     * Add success rate analysis and trending
     */
    async generateSuccessRateAnalysis() {
        console.log('Generating success rate analysis and trending...');
        const currentMetrics = await this.getCurrentMetrics();
        const historicalData = this.getHistoricalTrendingData();
        // Calculate success rates by category
        const categorySuccessRates = await this.calculateCategorySuccessRates();
        // Calculate trending data
        const trendingData = this.calculateTrendingMetrics(historicalData);
        const analysis = {
            currentSuccessRate: currentMetrics.overallSuccessRate,
            targetSuccessRate: 85,
            improvementNeeded: Math.max(0, 85 - currentMetrics.overallSuccessRate),
            categorySuccessRates,
            trendingData,
            projectedCompletion: this.calculateProjectedCompletion(trendingData),
            recommendations: await this.generateSuccessRateRecommendations(categorySuccessRates),
            analysisDate: new Date()
        };
        console.log(`Success rate analysis complete: ${currentMetrics.overallSuccessRate.toFixed(1)}% current success rate`);
        return analysis;
    }
    /**
     * Create recommendations for manual review cases
     */
    async generateManualReviewRecommendations() {
        console.log('Generating manual review recommendations...');
        const anyTypeOccurrences = await this.findAllAnyTypes();
        const recommendations = [];
        for (const occurrence of anyTypeOccurrences) {
            const context = await this.createClassificationContext(occurrence);
            const classification = await this.classifier.classify(context);
            // Identify cases that need manual review
            if (this.requiresManualReview(classification, context)) {
                const recommendation = {
                    filePath: occurrence.filePath,
                    lineNumber: occurrence.lineNumber,
                    codeSnippet: occurrence.codeSnippet,
                    classification,
                    reviewReason: this.getReviewReason(classification, context),
                    priority: this.calculateReviewPriority(classification, context),
                    suggestedActions: await this.generateSuggestedActions(classification, context),
                    estimatedEffort: this.estimateReviewEffort(classification, context),
                    relatedOccurrences: await this.findRelatedOccurrences(occurrence)
                };
                recommendations.push(recommendation);
            }
        }
        // Sort by priority (high to low)
        recommendations.sort((a, b) => {
            const priorityOrder = { high: 3, medium: 2, low: 1 };
            return priorityOrder[b.priority] - priorityOrder[a.priority];
        });
        console.log(`Manual review recommendations complete: ${recommendations.length} cases identified`);
        return recommendations;
    }
    /**
     * Generate comprehensive analysis report
     */
    async generateComprehensiveReport() {
        console.log('Generating comprehensive analysis report...');
        const [domainDistribution, accuracyReport, successRateAnalysis, manualReviewRecommendations] = await Promise.all([
            this.analyzeDomainDistribution(),
            this.generateClassificationAccuracyReport(),
            this.generateSuccessRateAnalysis(),
            this.generateManualReviewRecommendations()
        ]);
        const report = {
            id: `analysis-${Date.now()}`,
            timestamp: new Date(),
            domainDistribution,
            accuracyReport,
            successRateAnalysis,
            manualReviewRecommendations,
            summary: {
                totalAnyTypes: domainDistribution.totalAnyTypes,
                unintentionalCount: domainDistribution.intentionalVsUnintentional.unintentional.count,
                classificationAccuracy: accuracyReport.overallAccuracy,
                currentSuccessRate: successRateAnalysis.currentSuccessRate,
                manualReviewCases: manualReviewRecommendations.length,
                topDomain: this.getTopDomain(domainDistribution),
                topCategory: this.getTopCategory(domainDistribution)
            }
        };
        // Save report to history
        this.analysisHistory.push(report);
        await this.saveAnalysisHistory();
        console.log('Comprehensive analysis report generated successfully');
        return report;
    }
    // Private helper methods
    async findAllAnyTypes() {
        const occurrences = [];
        try {
            // Use grep to find all explicit any types
            const grepCommand = `grep -rn "\\bany\\b" src --include="*.ts" --include="*.tsx" | head -1000`;
            const output = (0, child_process_1.execSync)(grepCommand, { encoding: 'utf8', stdio: 'pipe' });
            const lines = output.trim().split('\n').filter(line => line.trim());
            for (const line of lines) {
                const match = line.match(/^([^:]+):(\d+):(.+)$/);
                if (match) {
                    const [, filePath, lineNumber, codeSnippet] = match;
                    occurrences.push({
                        filePath: filePath.trim(),
                        lineNumber: parseInt(lineNumber),
                        codeSnippet: codeSnippet.trim()
                    });
                }
            }
        }
        catch (error) {
            console.warn('Error finding any types:', error);
        }
        return occurrences;
    }
    async createClassificationContext(occurrence) {
        const surroundingLines = await this.getSurroundingLines(occurrence.filePath, occurrence.lineNumber);
        const hasExistingComment = this.hasExistingComment(surroundingLines);
        const domainContext = await this.domainAnalyzer.analyzeDomain({
            filePath: occurrence.filePath,
            lineNumber: occurrence.lineNumber,
            codeSnippet: occurrence.codeSnippet,
            surroundingLines,
            hasExistingComment,
            isInTestFile: occurrence.filePath.includes('.test.') || occurrence.filePath.includes('__tests__'),
            domainContext: { domain: types_1.CodeDomain.UTILITY, intentionalityHints: [], suggestedTypes: [], preservationReasons: [] }
        });
        return {
            filePath: occurrence.filePath,
            lineNumber: occurrence.lineNumber,
            codeSnippet: occurrence.codeSnippet,
            surroundingLines,
            hasExistingComment,
            existingComment: hasExistingComment ? this.extractComment(surroundingLines) : undefined,
            isInTestFile: occurrence.filePath.includes('.test.') || occurrence.filePath.includes('__tests__'),
            domainContext
        };
    }
    async getSurroundingLines(filePath, lineNumber) {
        try {
            const content = fs.readFileSync(filePath, 'utf8');
            const lines = content.split('\n');
            const start = Math.max(0, lineNumber - 3);
            const end = Math.min(lines.length, lineNumber + 2);
            return lines.slice(start, end);
        }
        catch (error) {
            return [];
        }
    }
    hasExistingComment(surroundingLines) {
        return surroundingLines.some(line => line.trim().startsWith('//') ||
            line.trim().startsWith('/*') ||
            line.trim().startsWith('*'));
    }
    extractComment(surroundingLines) {
        const commentLines = surroundingLines.filter(line => line.trim().startsWith('//') ||
            line.trim().startsWith('/*') ||
            line.trim().startsWith('*'));
        return commentLines.join(' ').trim();
    }
    async validateClassificationAccuracy(context, classification) {
        // Heuristic validation based on context
        // Error handling should be in catch blocks
        if (classification.category === types_1.AnyTypeCategory.ERROR_HANDLING) {
            return context.codeSnippet.includes('catch') || context.codeSnippet.includes('error');
        }
        // Test mocks should be in test files
        if (classification.category === types_1.AnyTypeCategory.TEST_MOCK) {
            return context.isInTestFile;
        }
        // Array types should contain array syntax
        if (classification.category === types_1.AnyTypeCategory.ARRAY_TYPE) {
            return context.codeSnippet.includes('any[]') || context.codeSnippet.includes('Array<any>');
        }
        // Record types should contain Record syntax
        if (classification.category === types_1.AnyTypeCategory.RECORD_TYPE) {
            return context.codeSnippet.includes('Record<') && context.codeSnippet.includes('any');
        }
        // Default to accurate for other categories
        return true;
    }
    calculateConfidenceDistribution(scores) {
        const ranges = [
            { min: 0.9, max: 1.0, label: '90-100%' },
            { min: 0.8, max: 0.9, label: '80-90%' },
            { min: 0.7, max: 0.8, label: '70-80%' },
            { min: 0.6, max: 0.7, label: '60-70%' },
            { min: 0.0, max: 0.6, label: '0-60%' }
        ];
        return ranges.map(range => {
            const count = scores.filter(score => score >= range.min && score < range.max).length;
            return {
                range: range.label,
                count,
                percentage: scores.length > 0 ? (count / scores.length) * 100 : 0
            };
        });
    }
    async getCurrentMetrics() {
        // Simulate current metrics - in real implementation, this would fetch from actual data
        return {
            overallSuccessRate: 78.5,
            totalProcessed: 1250,
            successfulReplacements: 982,
            failedReplacements: 268,
            averageConfidence: 0.82
        };
    }
    getHistoricalTrendingData() {
        // Return last 30 days of trending data from history
        const thirtyDaysAgo = new Date();
        thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
        return this.analysisHistory
            .filter(report => report.timestamp >= thirtyDaysAgo)
            .map(report => ({
            date: report.timestamp,
            successRate: report.successRateAnalysis.currentSuccessRate,
            totalAnyTypes: report.domainDistribution.totalAnyTypes,
            unintentionalCount: report.domainDistribution.intentionalVsUnintentional.unintentional.count,
            classificationAccuracy: report.accuracyReport.overallAccuracy
        }));
    }
    async calculateCategorySuccessRates() {
        // Simulate category success rates - in real implementation, this would calculate from actual data
        return [
            { category: types_1.AnyTypeCategory.ARRAY_TYPE, successRate: 95.2, sampleSize: 156 },
            { category: types_1.AnyTypeCategory.RECORD_TYPE, successRate: 87.3, sampleSize: 203 },
            { category: types_1.AnyTypeCategory.FUNCTION_PARAM, successRate: 65.8, sampleSize: 342 },
            { category: types_1.AnyTypeCategory.RETURN_TYPE, successRate: 72.1, sampleSize: 189 },
            { category: types_1.AnyTypeCategory.TYPE_ASSERTION, successRate: 81.4, sampleSize: 127 },
            { category: types_1.AnyTypeCategory.ERROR_HANDLING, successRate: 45.6, sampleSize: 98 },
            { category: types_1.AnyTypeCategory.EXTERNAL_API, successRate: 52.3, sampleSize: 76 },
            { category: types_1.AnyTypeCategory.TEST_MOCK, successRate: 89.7, sampleSize: 134 },
            { category: types_1.AnyTypeCategory.DYNAMIC_CONFIG, successRate: 38.9, sampleSize: 67 },
            { category: types_1.AnyTypeCategory.LEGACY_COMPATIBILITY, successRate: 41.2, sampleSize: 45 }
        ];
    }
    calculateTrendingMetrics(historicalData) {
        if (historicalData.length === 0) {
            return {
                date: new Date(),
                successRate: 0,
                totalAnyTypes: 0,
                unintentionalCount: 0,
                classificationAccuracy: 0
            };
        }
        const latest = historicalData[historicalData.length - 1];
        const previous = historicalData.length > 1 ? historicalData[historicalData.length - 2] : latest;
        return {
            date: latest.date,
            successRate: latest.successRate,
            totalAnyTypes: latest.totalAnyTypes,
            unintentionalCount: latest.unintentionalCount,
            classificationAccuracy: latest.classificationAccuracy,
            trends: {
                successRateChange: latest.successRate - previous.successRate,
                totalAnyTypesChange: latest.totalAnyTypes - previous.totalAnyTypes,
                unintentionalCountChange: latest.unintentionalCount - previous.unintentionalCount,
                classificationAccuracyChange: latest.classificationAccuracy - previous.classificationAccuracy
            }
        };
    }
    calculateProjectedCompletion(trendingData) {
        // Simple linear projection based on current trend
        const currentRate = trendingData.successRate;
        const targetRate = 85;
        const rateChange = trendingData.trends?.successRateChange || 0.5; // Default 0.5% improvement per analysis
        if (rateChange <= 0 || currentRate >= targetRate) {
            const futureDate = new Date();
            futureDate.setDate(futureDate.getDate() + 30); // Default 30 days if no improvement
            return futureDate;
        }
        const daysNeeded = Math.ceil((targetRate - currentRate) / rateChange);
        const projectedDate = new Date();
        projectedDate.setDate(projectedDate.getDate() + daysNeeded);
        return projectedDate;
    }
    async generateSuccessRateRecommendations(categorySuccessRates) {
        const recommendations = [];
        // Find categories with low success rates
        const lowSuccessCategories = categorySuccessRates.filter(cat => cat.successRate < 70);
        for (const category of lowSuccessCategories) {
            switch (category.category) {
                case types_1.AnyTypeCategory.FUNCTION_PARAM:
                    recommendations.push('Focus on improving function parameter type inference algorithms');
                    break;
                case types_1.AnyTypeCategory.RETURN_TYPE:
                    recommendations.push('Enhance return type analysis with better context understanding');
                    break;
                case types_1.AnyTypeCategory.ERROR_HANDLING:
                    recommendations.push('Consider preserving error handling any types as intentional');
                    break;
                case types_1.AnyTypeCategory.EXTERNAL_API:
                    recommendations.push('Improve external API response type detection');
                    break;
                case types_1.AnyTypeCategory.DYNAMIC_CONFIG:
                    recommendations.push('Review dynamic configuration patterns for better type safety');
                    break;
                case types_1.AnyTypeCategory.LEGACY_COMPATIBILITY:
                    recommendations.push('Evaluate legacy compatibility requirements vs type safety benefits');
                    break;
            }
        }
        // Find categories with high success rates to leverage
        const highSuccessCategories = categorySuccessRates.filter(cat => cat.successRate > 85);
        if (highSuccessCategories.length > 0) {
            recommendations.push(`Prioritize ${highSuccessCategories.map(cat => cat.category).join(', ')} categories for quick wins`);
        }
        return recommendations;
    }
    requiresManualReview(classification, context) {
        // Low confidence classifications need manual review
        if (classification.confidence < 0.7) {
            return true;
        }
        // Complex domain contexts need manual review
        if (context.domainContext.intentionalityHints.length > 2) {
            return true;
        }
        // Conflicting signals need manual review
        if (classification.isIntentional && classification.suggestedReplacement) {
            return true;
        }
        // High-risk categories need manual review
        const highRiskCategories = [
            types_1.AnyTypeCategory.EXTERNAL_API,
            types_1.AnyTypeCategory.DYNAMIC_CONFIG,
            types_1.AnyTypeCategory.LEGACY_COMPATIBILITY
        ];
        return highRiskCategories.includes(classification.category);
    }
    getReviewReason(classification, context) {
        if (classification.confidence < 0.7) {
            return `Low classification confidence (${(classification.confidence * 100).toFixed(1)}%)`;
        }
        if (context.domainContext.intentionalityHints.length > 2) {
            return 'Complex domain context with multiple intentionality hints';
        }
        if (classification.isIntentional && classification.suggestedReplacement) {
            return 'Conflicting signals: classified as intentional but has suggested replacement';
        }
        return `High-risk category: ${classification.category}`;
    }
    calculateReviewPriority(classification, context) {
        // High priority: Low confidence or conflicting signals
        if (classification.confidence < 0.6 || (classification.isIntentional && classification.suggestedReplacement)) {
            return 'high';
        }
        // Medium priority: Moderate confidence or complex context
        if (classification.confidence < 0.8 || context.domainContext.intentionalityHints.length > 1) {
            return 'medium';
        }
        // Low priority: High confidence, simple cases
        return 'low';
    }
    async generateSuggestedActions(classification, context) {
        const actions = [];
        if (classification.confidence < 0.7) {
            actions.push('Review classification logic and add more context');
        }
        if (classification.suggestedReplacement) {
            actions.push(`Consider replacing with: ${classification.suggestedReplacement}`);
        }
        if (!classification.isIntentional) {
            actions.push('Attempt automated replacement with safety validation');
        }
        else {
            actions.push('Add documentation explaining why any type is necessary');
        }
        if (context.domainContext.suggestedTypes.length > 0) {
            actions.push(`Consider domain-specific types: ${context.domainContext.suggestedTypes.join(', ')}`);
        }
        return actions;
    }
    estimateReviewEffort(classification, context) {
        // High effort: Complex domain context or low confidence
        if (classification.confidence < 0.6 || context.domainContext.intentionalityHints.length > 2) {
            return 'high';
        }
        // Medium effort: Moderate complexity
        if (classification.confidence < 0.8 || context.domainContext.intentionalityHints.length > 0) {
            return 'medium';
        }
        // Low effort: Simple cases
        return 'low';
    }
    async findRelatedOccurrences(occurrence) {
        // Find other any types in the same file
        const relatedOccurrences = [];
        try {
            const grepCommand = `grep -n "\\bany\\b" "${occurrence.filePath}"`;
            const output = (0, child_process_1.execSync)(grepCommand, { encoding: 'utf8', stdio: 'pipe' });
            const lines = output.trim().split('\n').filter(line => line.trim());
            for (const line of lines) {
                const match = line.match(/^(\d+):(.+)$/);
                if (match) {
                    const lineNumber = parseInt(match[1]);
                    if (lineNumber !== occurrence.lineNumber) {
                        relatedOccurrences.push({
                            filePath: occurrence.filePath,
                            lineNumber
                        });
                    }
                }
            }
        }
        catch (error) {
            // No related occurrences found
        }
        return relatedOccurrences.slice(0, 5); // Limit to 5 related occurrences
    }
    getTopDomain(distribution) {
        const topDomain = distribution.byDomain.reduce((max, current) => current.count > max.count ? current : max);
        return topDomain.domain;
    }
    getTopCategory(distribution) {
        const topCategory = distribution.byCategory.reduce((max, current) => current.count > max.count ? current : max);
        return topCategory.category;
    }
    loadAnalysisHistory() {
        try {
            const historyPath = path.join(process.cwd(), '.kiro', 'campaign-reports', 'unintentional-any-analysis-history.json');
            if (fs.existsSync(historyPath)) {
                const historyData = fs.readFileSync(historyPath, 'utf8');
                this.analysisHistory = JSON.parse(historyData);
            }
        }
        catch (error) {
            console.warn('Could not load analysis history:', error);
            this.analysisHistory = [];
        }
    }
    async saveAnalysisHistory() {
        try {
            const historyDir = path.join(process.cwd(), '.kiro', 'campaign-reports');
            if (!fs.existsSync(historyDir)) {
                fs.mkdirSync(historyDir, { recursive: true });
            }
            const historyPath = path.join(historyDir, 'unintentional-any-analysis-history.json');
            fs.writeFileSync(historyPath, JSON.stringify(this.analysisHistory, null, 2));
        }
        catch (error) {
            console.warn('Could not save analysis history:', error);
        }
    }
}
exports.AnalysisTools = AnalysisTools;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L2JhY2t1cHMvZmlyc3Qtd2F2ZS0yMDI1LTA4LTExVDA1LTE5LTI2LTgxM1ovc3JjL3NlcnZpY2VzL2NhbXBhaWduL3VuaW50ZW50aW9uYWwtYW55LWVsaW1pbmF0aW9uL0FuYWx5c2lzVG9vbHMudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxpREFBeUM7QUFDekMsdUNBQXlCO0FBQ3pCLDJDQUE2QjtBQUM3QiwyREFBd0Q7QUFDeEQsbUVBQWdFO0FBQ2hFLG1DQVlpQjtBQUVqQjs7OztHQUlHO0FBQ0gsTUFBYSxhQUFhO0lBQ2hCLFVBQVUsQ0FBb0I7SUFDOUIsY0FBYyxDQUF3QjtJQUN0QyxlQUFlLEdBQXFCLEVBQUUsQ0FBQztJQUUvQztRQUNFLElBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxxQ0FBaUIsRUFBRSxDQUFDO1FBQzFDLElBQUksQ0FBQyxjQUFjLEdBQUcsSUFBSSw2Q0FBcUIsRUFBRSxDQUFDO1FBQ2xELElBQUksQ0FBQyxtQkFBbUIsRUFBRSxDQUFDO0lBQzdCLENBQUM7SUFFRDs7T0FFRztJQUNILEtBQUssQ0FBQyx5QkFBeUI7UUFDN0IsT0FBTyxDQUFDLEdBQUcsQ0FBQyw4Q0FBOEMsQ0FBQyxDQUFDO1FBRTVELE1BQU0sa0JBQWtCLEdBQUcsTUFBTSxJQUFJLENBQUMsZUFBZSxFQUFFLENBQUM7UUFDeEQsTUFBTSxrQkFBa0IsR0FBK0I7WUFDckQsQ0FBQyxrQkFBVSxDQUFDLFlBQVksQ0FBQyxFQUFFLENBQUM7WUFDNUIsQ0FBQyxrQkFBVSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUM7WUFDdEIsQ0FBQyxrQkFBVSxDQUFDLFFBQVEsQ0FBQyxFQUFFLENBQUM7WUFDeEIsQ0FBQyxrQkFBVSxDQUFDLFlBQVksQ0FBQyxFQUFFLENBQUM7WUFDNUIsQ0FBQyxrQkFBVSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUM7WUFDdkIsQ0FBQyxrQkFBVSxDQUFDLFNBQVMsQ0FBQyxFQUFFLENBQUM7WUFDekIsQ0FBQyxrQkFBVSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUM7WUFDdkIsQ0FBQyxrQkFBVSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUM7U0FDckIsQ0FBQztRQUVGLE1BQU0sb0JBQW9CLEdBQW9DO1lBQzVELENBQUMsdUJBQWUsQ0FBQyxjQUFjLENBQUMsRUFBRSxDQUFDO1lBQ25DLENBQUMsdUJBQWUsQ0FBQyxZQUFZLENBQUMsRUFBRSxDQUFDO1lBQ2pDLENBQUMsdUJBQWUsQ0FBQyxTQUFTLENBQUMsRUFBRSxDQUFDO1lBQzlCLENBQUMsdUJBQWUsQ0FBQyxjQUFjLENBQUMsRUFBRSxDQUFDO1lBQ25DLENBQUMsdUJBQWUsQ0FBQyxvQkFBb0IsQ0FBQyxFQUFFLENBQUM7WUFDekMsQ0FBQyx1QkFBZSxDQUFDLFVBQVUsQ0FBQyxFQUFFLENBQUM7WUFDL0IsQ0FBQyx1QkFBZSxDQUFDLFdBQVcsQ0FBQyxFQUFFLENBQUM7WUFDaEMsQ0FBQyx1QkFBZSxDQUFDLGNBQWMsQ0FBQyxFQUFFLENBQUM7WUFDbkMsQ0FBQyx1QkFBZSxDQUFDLFdBQVcsQ0FBQyxFQUFFLENBQUM7WUFDaEMsQ0FBQyx1QkFBZSxDQUFDLGNBQWMsQ0FBQyxFQUFFLENBQUM7U0FDcEMsQ0FBQztRQUVGLE1BQU0sZ0JBQWdCLEdBQUcsRUFBRSxLQUFLLEVBQUUsQ0FBQyxFQUFFLENBQUM7UUFDdEMsTUFBTSxrQkFBa0IsR0FBRyxFQUFFLEtBQUssRUFBRSxDQUFDLEVBQUUsQ0FBQztRQUV4QyxLQUFLLE1BQU0sVUFBVSxJQUFJLGtCQUFrQixFQUFFO1lBQzNDLE1BQU0sT0FBTyxHQUFHLE1BQU0sSUFBSSxDQUFDLDJCQUEyQixDQUFDLFVBQVUsQ0FBQyxDQUFDO1lBQ25FLE1BQU0sYUFBYSxHQUFHLE1BQU0sSUFBSSxDQUFDLGNBQWMsQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDdkUsTUFBTSxjQUFjLEdBQUcsTUFBTSxJQUFJLENBQUMsVUFBVSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUUvRCxrQkFBa0I7WUFDbEIsa0JBQWtCLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUM7WUFFM0Msb0JBQW9CO1lBQ3BCLG9CQUFvQixDQUFDLGNBQWMsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDO1lBRWhELDBCQUEwQjtZQUMxQixJQUFJLGNBQWMsQ0FBQyxhQUFhLEVBQUU7Z0JBQ2hDLGdCQUFnQixDQUFDLEtBQUssRUFBRSxDQUFDO2FBQzFCO2lCQUFNO2dCQUNMLGtCQUFrQixDQUFDLEtBQUssRUFBRSxDQUFDO2FBQzVCO1NBQ0Y7UUFFRCxNQUFNLFVBQVUsR0FBRyxrQkFBa0IsQ0FBQyxNQUFNLENBQUM7UUFDN0MsTUFBTSxZQUFZLEdBQXVCO1lBQ3ZDLGFBQWEsRUFBRSxVQUFVO1lBQ3pCLFFBQVEsRUFBRSxNQUFNLENBQUMsT0FBTyxDQUFDLGtCQUFrQixDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxNQUFNLEVBQUUsS0FBSyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7Z0JBQ3JFLE1BQU0sRUFBRSxNQUFvQjtnQkFDNUIsS0FBSztnQkFDTCxVQUFVLEVBQUUsVUFBVSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLEdBQUcsVUFBVSxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO2FBQzVELENBQUMsQ0FBQztZQUNILFVBQVUsRUFBRSxNQUFNLENBQUMsT0FBTyxDQUFDLG9CQUFvQixDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxRQUFRLEVBQUUsS0FBSyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7Z0JBQzNFLFFBQVEsRUFBRSxRQUEyQjtnQkFDckMsS0FBSztnQkFDTCxVQUFVLEVBQUUsVUFBVSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLEdBQUcsVUFBVSxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO2FBQzVELENBQUMsQ0FBQztZQUNILDBCQUEwQixFQUFFO2dCQUMxQixXQUFXLEVBQUU7b0JBQ1gsS0FBSyxFQUFFLGdCQUFnQixDQUFDLEtBQUs7b0JBQzdCLFVBQVUsRUFBRSxVQUFVLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLGdCQUFnQixDQUFDLEtBQUssR0FBRyxVQUFVLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7aUJBQzdFO2dCQUNELGFBQWEsRUFBRTtvQkFDYixLQUFLLEVBQUUsa0JBQWtCLENBQUMsS0FBSztvQkFDL0IsVUFBVSxFQUFFLFVBQVUsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsa0JBQWtCLENBQUMsS0FBSyxHQUFHLFVBQVUsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztpQkFDL0U7YUFDRjtZQUNELFlBQVksRUFBRSxJQUFJLElBQUksRUFBRTtTQUN6QixDQUFDO1FBRUYsT0FBTyxDQUFDLEdBQUcsQ0FBQywwQ0FBMEMsVUFBVSxrQkFBa0IsQ0FBQyxDQUFDO1FBQ3BGLE9BQU8sWUFBWSxDQUFDO0lBQ3RCLENBQUM7SUFFRDs7T0FFRztJQUNILEtBQUssQ0FBQyxvQ0FBb0M7UUFDeEMsT0FBTyxDQUFDLEdBQUcsQ0FBQyw4Q0FBOEMsQ0FBQyxDQUFDO1FBRTVELE1BQU0sa0JBQWtCLEdBQUcsTUFBTSxJQUFJLENBQUMsZUFBZSxFQUFFLENBQUM7UUFDeEQsTUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsa0JBQWtCLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyw4QkFBOEI7UUFDM0YsTUFBTSxNQUFNLEdBQUcsa0JBQWtCLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxVQUFVLENBQUMsQ0FBQztRQUV2RCxJQUFJLHNCQUFzQixHQUFHLENBQUMsQ0FBQztRQUMvQixJQUFJLG9CQUFvQixHQUFHLENBQUMsQ0FBQztRQUM3QixNQUFNLGdCQUFnQixHQUFhLEVBQUUsQ0FBQztRQUN0QyxNQUFNLGdCQUFnQixHQUFnRTtZQUNwRixDQUFDLHVCQUFlLENBQUMsY0FBYyxDQUFDLEVBQUUsRUFBRSxPQUFPLEVBQUUsQ0FBQyxFQUFFLEtBQUssRUFBRSxDQUFDLEVBQUU7WUFDMUQsQ0FBQyx1QkFBZSxDQUFDLFlBQVksQ0FBQyxFQUFFLEVBQUUsT0FBTyxFQUFFLENBQUMsRUFBRSxLQUFLLEVBQUUsQ0FBQyxFQUFFO1lBQ3hELENBQUMsdUJBQWUsQ0FBQyxTQUFTLENBQUMsRUFBRSxFQUFFLE9BQU8sRUFBRSxDQUFDLEVBQUUsS0FBSyxFQUFFLENBQUMsRUFBRTtZQUNyRCxDQUFDLHVCQUFlLENBQUMsY0FBYyxDQUFDLEVBQUUsRUFBRSxPQUFPLEVBQUUsQ0FBQyxFQUFFLEtBQUssRUFBRSxDQUFDLEVBQUU7WUFDMUQsQ0FBQyx1QkFBZSxDQUFDLG9CQUFvQixDQUFDLEVBQUUsRUFBRSxPQUFPLEVBQUUsQ0FBQyxFQUFFLEtBQUssRUFBRSxDQUFDLEVBQUU7WUFDaEUsQ0FBQyx1QkFBZSxDQUFDLFVBQVUsQ0FBQyxFQUFFLEVBQUUsT0FBTyxFQUFFLENBQUMsRUFBRSxLQUFLLEVBQUUsQ0FBQyxFQUFFO1lBQ3RELENBQUMsdUJBQWUsQ0FBQyxXQUFXLENBQUMsRUFBRSxFQUFFLE9BQU8sRUFBRSxDQUFDLEVBQUUsS0FBSyxFQUFFLENBQUMsRUFBRTtZQUN2RCxDQUFDLHVCQUFlLENBQUMsY0FBYyxDQUFDLEVBQUUsRUFBRSxPQUFPLEVBQUUsQ0FBQyxFQUFFLEtBQUssRUFBRSxDQUFDLEVBQUU7WUFDMUQsQ0FBQyx1QkFBZSxDQUFDLFdBQVcsQ0FBQyxFQUFFLEVBQUUsT0FBTyxFQUFFLENBQUMsRUFBRSxLQUFLLEVBQUUsQ0FBQyxFQUFFO1lBQ3ZELENBQUMsdUJBQWUsQ0FBQyxjQUFjLENBQUMsRUFBRSxFQUFFLE9BQU8sRUFBRSxDQUFDLEVBQUUsS0FBSyxFQUFFLENBQUMsRUFBRTtTQUMzRCxDQUFDO1FBRUYsS0FBSyxNQUFNLFVBQVUsSUFBSSxNQUFNLEVBQUU7WUFDL0IsTUFBTSxPQUFPLEdBQUcsTUFBTSxJQUFJLENBQUMsMkJBQTJCLENBQUMsVUFBVSxDQUFDLENBQUM7WUFDbkUsTUFBTSxjQUFjLEdBQUcsTUFBTSxJQUFJLENBQUMsVUFBVSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUUvRCxvQkFBb0IsRUFBRSxDQUFDO1lBQ3ZCLGdCQUFnQixDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsVUFBVSxDQUFDLENBQUM7WUFDakQsZ0JBQWdCLENBQUMsY0FBYyxDQUFDLFFBQVEsQ0FBQyxDQUFDLEtBQUssRUFBRSxDQUFDO1lBRWxELG9EQUFvRDtZQUNwRCxNQUFNLFVBQVUsR0FBRyxNQUFNLElBQUksQ0FBQyw4QkFBOEIsQ0FBQyxPQUFPLEVBQUUsY0FBYyxDQUFDLENBQUM7WUFDdEYsSUFBSSxVQUFVLEVBQUU7Z0JBQ2Qsc0JBQXNCLEVBQUUsQ0FBQztnQkFDekIsZ0JBQWdCLENBQUMsY0FBYyxDQUFDLFFBQVEsQ0FBQyxDQUFDLE9BQU8sRUFBRSxDQUFDO2FBQ3JEO1NBQ0Y7UUFFRCxNQUFNLGVBQWUsR0FBRyxvQkFBb0IsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsc0JBQXNCLEdBQUcsb0JBQW9CLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUM3RyxNQUFNLGlCQUFpQixHQUFHLGdCQUFnQixDQUFDLE1BQU0sR0FBRyxDQUFDO1lBQ25ELENBQUMsQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLENBQUMsQ0FBQyxHQUFHLEVBQUUsS0FBSyxFQUFFLEVBQUUsQ0FBQyxHQUFHLEdBQUcsS0FBSyxFQUFFLENBQUMsQ0FBQyxHQUFHLGdCQUFnQixDQUFDLE1BQU07WUFDbkYsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUVOLE1BQU0sTUFBTSxHQUFpQztZQUMzQyxlQUFlO1lBQ2YsaUJBQWlCO1lBQ2pCLFVBQVU7WUFDVixnQkFBZ0IsRUFBRSxNQUFNLENBQUMsT0FBTyxDQUFDLGdCQUFnQixDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxRQUFRLEVBQUUsS0FBSyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7Z0JBQzdFLFFBQVEsRUFBRSxRQUEyQjtnQkFDckMsUUFBUSxFQUFFLEtBQUssQ0FBQyxLQUFLLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxPQUFPLEdBQUcsS0FBSyxDQUFDLEtBQUssQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDbkUsV0FBVyxFQUFFLEtBQUssQ0FBQyxLQUFLO2FBQ3pCLENBQUMsQ0FBQztZQUNILHNCQUFzQixFQUFFLElBQUksQ0FBQywrQkFBK0IsQ0FBQyxnQkFBZ0IsQ0FBQztZQUM5RSxVQUFVLEVBQUUsSUFBSSxJQUFJLEVBQUU7U0FDdkIsQ0FBQztRQUVGLE9BQU8sQ0FBQyxHQUFHLENBQUMsNENBQTRDLGVBQWUsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBQ2hHLE9BQU8sTUFBTSxDQUFDO0lBQ2hCLENBQUM7SUFFRDs7T0FFRztJQUNILEtBQUssQ0FBQywyQkFBMkI7UUFDL0IsT0FBTyxDQUFDLEdBQUcsQ0FBQyxrREFBa0QsQ0FBQyxDQUFDO1FBRWhFLE1BQU0sY0FBYyxHQUFHLE1BQU0sSUFBSSxDQUFDLGlCQUFpQixFQUFFLENBQUM7UUFDdEQsTUFBTSxjQUFjLEdBQUcsSUFBSSxDQUFDLHlCQUF5QixFQUFFLENBQUM7UUFFeEQsc0NBQXNDO1FBQ3RDLE1BQU0sb0JBQW9CLEdBQUcsTUFBTSxJQUFJLENBQUMsNkJBQTZCLEVBQUUsQ0FBQztRQUV4RSwwQkFBMEI7UUFDMUIsTUFBTSxZQUFZLEdBQUcsSUFBSSxDQUFDLHdCQUF3QixDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBRW5FLE1BQU0sUUFBUSxHQUF3QjtZQUNwQyxrQkFBa0IsRUFBRSxjQUFjLENBQUMsa0JBQWtCO1lBQ3JELGlCQUFpQixFQUFFLEVBQUU7WUFDckIsaUJBQWlCLEVBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLEVBQUUsRUFBRSxHQUFHLGNBQWMsQ0FBQyxrQkFBa0IsQ0FBQztZQUN0RSxvQkFBb0I7WUFDcEIsWUFBWTtZQUNaLG1CQUFtQixFQUFFLElBQUksQ0FBQyw0QkFBNEIsQ0FBQyxZQUFZLENBQUM7WUFDcEUsZUFBZSxFQUFFLE1BQU0sSUFBSSxDQUFDLGtDQUFrQyxDQUFDLG9CQUFvQixDQUFDO1lBQ3BGLFlBQVksRUFBRSxJQUFJLElBQUksRUFBRTtTQUN6QixDQUFDO1FBRUYsT0FBTyxDQUFDLEdBQUcsQ0FBQyxtQ0FBbUMsY0FBYyxDQUFDLGtCQUFrQixDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsd0JBQXdCLENBQUMsQ0FBQztRQUNySCxPQUFPLFFBQVEsQ0FBQztJQUNsQixDQUFDO0lBRUQ7O09BRUc7SUFDSCxLQUFLLENBQUMsbUNBQW1DO1FBQ3ZDLE9BQU8sQ0FBQyxHQUFHLENBQUMsNkNBQTZDLENBQUMsQ0FBQztRQUUzRCxNQUFNLGtCQUFrQixHQUFHLE1BQU0sSUFBSSxDQUFDLGVBQWUsRUFBRSxDQUFDO1FBQ3hELE1BQU0sZUFBZSxHQUFpQyxFQUFFLENBQUM7UUFFekQsS0FBSyxNQUFNLFVBQVUsSUFBSSxrQkFBa0IsRUFBRTtZQUMzQyxNQUFNLE9BQU8sR0FBRyxNQUFNLElBQUksQ0FBQywyQkFBMkIsQ0FBQyxVQUFVLENBQUMsQ0FBQztZQUNuRSxNQUFNLGNBQWMsR0FBRyxNQUFNLElBQUksQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1lBRS9ELHlDQUF5QztZQUN6QyxJQUFJLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxjQUFjLEVBQUUsT0FBTyxDQUFDLEVBQUU7Z0JBQ3RELE1BQU0sY0FBYyxHQUErQjtvQkFDakQsUUFBUSxFQUFFLFVBQVUsQ0FBQyxRQUFRO29CQUM3QixVQUFVLEVBQUUsVUFBVSxDQUFDLFVBQVU7b0JBQ2pDLFdBQVcsRUFBRSxVQUFVLENBQUMsV0FBVztvQkFDbkMsY0FBYztvQkFDZCxZQUFZLEVBQUUsSUFBSSxDQUFDLGVBQWUsQ0FBQyxjQUFjLEVBQUUsT0FBTyxDQUFDO29CQUMzRCxRQUFRLEVBQUUsSUFBSSxDQUFDLHVCQUF1QixDQUFDLGNBQWMsRUFBRSxPQUFPLENBQUM7b0JBQy9ELGdCQUFnQixFQUFFLE1BQU0sSUFBSSxDQUFDLHdCQUF3QixDQUFDLGNBQWMsRUFBRSxPQUFPLENBQUM7b0JBQzlFLGVBQWUsRUFBRSxJQUFJLENBQUMsb0JBQW9CLENBQUMsY0FBYyxFQUFFLE9BQU8sQ0FBQztvQkFDbkUsa0JBQWtCLEVBQUUsTUFBTSxJQUFJLENBQUMsc0JBQXNCLENBQUMsVUFBVSxDQUFDO2lCQUNsRSxDQUFDO2dCQUVGLGVBQWUsQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUM7YUFDdEM7U0FDRjtRQUVELGlDQUFpQztRQUNqQyxlQUFlLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFO1lBQzVCLE1BQU0sYUFBYSxHQUFHLEVBQUUsSUFBSSxFQUFFLENBQUMsRUFBRSxNQUFNLEVBQUUsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLEVBQUUsQ0FBQztZQUNyRCxPQUFPLGFBQWEsQ0FBQyxDQUFDLENBQUMsUUFBUSxDQUFDLEdBQUcsYUFBYSxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUMvRCxDQUFDLENBQUMsQ0FBQztRQUVILE9BQU8sQ0FBQyxHQUFHLENBQUMsMkNBQTJDLGVBQWUsQ0FBQyxNQUFNLG1CQUFtQixDQUFDLENBQUM7UUFDbEcsT0FBTyxlQUFlLENBQUM7SUFDekIsQ0FBQztJQUVEOztPQUVHO0lBQ0gsS0FBSyxDQUFDLDJCQUEyQjtRQUMvQixPQUFPLENBQUMsR0FBRyxDQUFDLDZDQUE2QyxDQUFDLENBQUM7UUFFM0QsTUFBTSxDQUNKLGtCQUFrQixFQUNsQixjQUFjLEVBQ2QsbUJBQW1CLEVBQ25CLDJCQUEyQixDQUM1QixHQUFHLE1BQU0sT0FBTyxDQUFDLEdBQUcsQ0FBQztZQUNwQixJQUFJLENBQUMseUJBQXlCLEVBQUU7WUFDaEMsSUFBSSxDQUFDLG9DQUFvQyxFQUFFO1lBQzNDLElBQUksQ0FBQywyQkFBMkIsRUFBRTtZQUNsQyxJQUFJLENBQUMsbUNBQW1DLEVBQUU7U0FDM0MsQ0FBQyxDQUFDO1FBRUgsTUFBTSxNQUFNLEdBQW1CO1lBQzdCLEVBQUUsRUFBRSxZQUFZLElBQUksQ0FBQyxHQUFHLEVBQUUsRUFBRTtZQUM1QixTQUFTLEVBQUUsSUFBSSxJQUFJLEVBQUU7WUFDckIsa0JBQWtCO1lBQ2xCLGNBQWM7WUFDZCxtQkFBbUI7WUFDbkIsMkJBQTJCO1lBQzNCLE9BQU8sRUFBRTtnQkFDUCxhQUFhLEVBQUUsa0JBQWtCLENBQUMsYUFBYTtnQkFDL0Msa0JBQWtCLEVBQUUsa0JBQWtCLENBQUMsMEJBQTBCLENBQUMsYUFBYSxDQUFDLEtBQUs7Z0JBQ3JGLHNCQUFzQixFQUFFLGNBQWMsQ0FBQyxlQUFlO2dCQUN0RCxrQkFBa0IsRUFBRSxtQkFBbUIsQ0FBQyxrQkFBa0I7Z0JBQzFELGlCQUFpQixFQUFFLDJCQUEyQixDQUFDLE1BQU07Z0JBQ3JELFNBQVMsRUFBRSxJQUFJLENBQUMsWUFBWSxDQUFDLGtCQUFrQixDQUFDO2dCQUNoRCxXQUFXLEVBQUUsSUFBSSxDQUFDLGNBQWMsQ0FBQyxrQkFBa0IsQ0FBQzthQUNyRDtTQUNGLENBQUM7UUFFRix5QkFBeUI7UUFDekIsSUFBSSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDbEMsTUFBTSxJQUFJLENBQUMsbUJBQW1CLEVBQUUsQ0FBQztRQUVqQyxPQUFPLENBQUMsR0FBRyxDQUFDLHNEQUFzRCxDQUFDLENBQUM7UUFDcEUsT0FBTyxNQUFNLENBQUM7SUFDaEIsQ0FBQztJQUVELHlCQUF5QjtJQUVqQixLQUFLLENBQUMsZUFBZTtRQUMzQixNQUFNLFdBQVcsR0FBeUUsRUFBRSxDQUFDO1FBRTdGLElBQUk7WUFDRiwwQ0FBMEM7WUFDMUMsTUFBTSxXQUFXLEdBQUcsMEVBQTBFLENBQUM7WUFDL0YsTUFBTSxNQUFNLEdBQUcsSUFBQSx3QkFBUSxFQUFDLFdBQVcsRUFBRSxFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxDQUFDLENBQUM7WUFFMUUsTUFBTSxLQUFLLEdBQUcsTUFBTSxDQUFDLElBQUksRUFBRSxDQUFDLEtBQUssQ0FBQyxJQUFJLENBQUMsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQztZQUVwRSxLQUFLLE1BQU0sSUFBSSxJQUFJLEtBQUssRUFBRTtnQkFDeEIsTUFBTSxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO2dCQUNqRCxJQUFJLEtBQUssRUFBRTtvQkFDVCxNQUFNLENBQUMsRUFBRSxRQUFRLEVBQUUsVUFBVSxFQUFFLFdBQVcsQ0FBQyxHQUFHLEtBQUssQ0FBQztvQkFDcEQsV0FBVyxDQUFDLElBQUksQ0FBQzt3QkFDZixRQUFRLEVBQUUsUUFBUSxDQUFDLElBQUksRUFBRTt3QkFDekIsVUFBVSxFQUFFLFFBQVEsQ0FBQyxVQUFVLENBQUM7d0JBQ2hDLFdBQVcsRUFBRSxXQUFXLENBQUMsSUFBSSxFQUFFO3FCQUNoQyxDQUFDLENBQUM7aUJBQ0o7YUFDRjtTQUNGO1FBQUMsT0FBTyxLQUFLLEVBQUU7WUFDZCxPQUFPLENBQUMsSUFBSSxDQUFDLDBCQUEwQixFQUFFLEtBQUssQ0FBQyxDQUFDO1NBQ2pEO1FBRUQsT0FBTyxXQUFXLENBQUM7SUFDckIsQ0FBQztJQUVPLEtBQUssQ0FBQywyQkFBMkIsQ0FBQyxVQUF5RTtRQUNqSCxNQUFNLGdCQUFnQixHQUFHLE1BQU0sSUFBSSxDQUFDLG1CQUFtQixDQUFDLFVBQVUsQ0FBQyxRQUFRLEVBQUUsVUFBVSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQ3BHLE1BQU0sa0JBQWtCLEdBQUcsSUFBSSxDQUFDLGtCQUFrQixDQUFDLGdCQUFnQixDQUFDLENBQUM7UUFDckUsTUFBTSxhQUFhLEdBQUcsTUFBTSxJQUFJLENBQUMsY0FBYyxDQUFDLGFBQWEsQ0FBQztZQUM1RCxRQUFRLEVBQUUsVUFBVSxDQUFDLFFBQVE7WUFDN0IsVUFBVSxFQUFFLFVBQVUsQ0FBQyxVQUFVO1lBQ2pDLFdBQVcsRUFBRSxVQUFVLENBQUMsV0FBVztZQUNuQyxnQkFBZ0I7WUFDaEIsa0JBQWtCO1lBQ2xCLFlBQVksRUFBRSxVQUFVLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsSUFBSSxVQUFVLENBQUMsUUFBUSxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUM7WUFDakcsYUFBYSxFQUFFLEVBQUUsTUFBTSxFQUFFLGtCQUFVLENBQUMsT0FBTyxFQUFFLG1CQUFtQixFQUFFLEVBQUUsRUFBRSxjQUFjLEVBQUUsRUFBRSxFQUFFLG1CQUFtQixFQUFFLEVBQUUsRUFBRTtTQUNwSCxDQUFDLENBQUM7UUFFSCxPQUFPO1lBQ0wsUUFBUSxFQUFFLFVBQVUsQ0FBQyxRQUFRO1lBQzdCLFVBQVUsRUFBRSxVQUFVLENBQUMsVUFBVTtZQUNqQyxXQUFXLEVBQUUsVUFBVSxDQUFDLFdBQVc7WUFDbkMsZ0JBQWdCO1lBQ2hCLGtCQUFrQjtZQUNsQixlQUFlLEVBQUUsa0JBQWtCLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxjQUFjLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUztZQUN2RixZQUFZLEVBQUUsVUFBVSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsUUFBUSxDQUFDLElBQUksVUFBVSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDO1lBQ2pHLGFBQWE7U0FDZCxDQUFDO0lBQ0osQ0FBQztJQUVPLEtBQUssQ0FBQyxtQkFBbUIsQ0FBQyxRQUFnQixFQUFFLFVBQWtCO1FBQ3BFLElBQUk7WUFDRixNQUFNLE9BQU8sR0FBRyxFQUFFLENBQUMsWUFBWSxDQUFDLFFBQVEsRUFBRSxNQUFNLENBQUMsQ0FBQztZQUNsRCxNQUFNLEtBQUssR0FBRyxPQUFPLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ2xDLE1BQU0sS0FBSyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLFVBQVUsR0FBRyxDQUFDLENBQUMsQ0FBQztZQUMxQyxNQUFNLEdBQUcsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLEtBQUssQ0FBQyxNQUFNLEVBQUUsVUFBVSxHQUFHLENBQUMsQ0FBQyxDQUFDO1lBQ25ELE9BQU8sS0FBSyxDQUFDLEtBQUssQ0FBQyxLQUFLLEVBQUUsR0FBRyxDQUFDLENBQUM7U0FDaEM7UUFBQyxPQUFPLEtBQUssRUFBRTtZQUNkLE9BQU8sRUFBRSxDQUFDO1NBQ1g7SUFDSCxDQUFDO0lBRU8sa0JBQWtCLENBQUMsZ0JBQTBCO1FBQ25ELE9BQU8sZ0JBQWdCLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxFQUFFLENBQ2xDLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDO1lBQzVCLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDO1lBQzVCLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLENBQzVCLENBQUM7SUFDSixDQUFDO0lBRU8sY0FBYyxDQUFDLGdCQUEwQjtRQUMvQyxNQUFNLFlBQVksR0FBRyxnQkFBZ0IsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FDbEQsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUM7WUFDNUIsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUM7WUFDNUIsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsQ0FDNUIsQ0FBQztRQUNGLE9BQU8sWUFBWSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztJQUN2QyxDQUFDO0lBRU8sS0FBSyxDQUFDLDhCQUE4QixDQUFDLE9BQThCLEVBQUUsY0FBcUM7UUFDaEgsd0NBQXdDO1FBRXhDLDJDQUEyQztRQUMzQyxJQUFJLGNBQWMsQ0FBQyxRQUFRLEtBQUssdUJBQWUsQ0FBQyxjQUFjLEVBQUU7WUFDOUQsT0FBTyxPQUFPLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsSUFBSSxPQUFPLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsQ0FBQztTQUN2RjtRQUVELHFDQUFxQztRQUNyQyxJQUFJLGNBQWMsQ0FBQyxRQUFRLEtBQUssdUJBQWUsQ0FBQyxTQUFTLEVBQUU7WUFDekQsT0FBTyxPQUFPLENBQUMsWUFBWSxDQUFDO1NBQzdCO1FBRUQsMENBQTBDO1FBQzFDLElBQUksY0FBYyxDQUFDLFFBQVEsS0FBSyx1QkFBZSxDQUFDLFVBQVUsRUFBRTtZQUMxRCxPQUFPLE9BQU8sQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxJQUFJLE9BQU8sQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLFlBQVksQ0FBQyxDQUFDO1NBQzVGO1FBRUQsNENBQTRDO1FBQzVDLElBQUksY0FBYyxDQUFDLFFBQVEsS0FBSyx1QkFBZSxDQUFDLFdBQVcsRUFBRTtZQUMzRCxPQUFPLE9BQU8sQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxJQUFJLE9BQU8sQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxDQUFDO1NBQ3ZGO1FBRUQsMkNBQTJDO1FBQzNDLE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQztJQUVPLCtCQUErQixDQUFDLE1BQWdCO1FBQ3RELE1BQU0sTUFBTSxHQUFHO1lBQ2IsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBRTtZQUN4QyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFO1lBQ3ZDLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUU7WUFDdkMsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFFLFFBQVEsRUFBRTtZQUN2QyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUUsT0FBTyxFQUFFO1NBQ3ZDLENBQUM7UUFFRixPQUFPLE1BQU0sQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLEVBQUU7WUFDeEIsTUFBTSxLQUFLLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLEtBQUssSUFBSSxLQUFLLENBQUMsR0FBRyxJQUFJLEtBQUssR0FBRyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsTUFBTSxDQUFDO1lBQ3JGLE9BQU87Z0JBQ0wsS0FBSyxFQUFFLEtBQUssQ0FBQyxLQUFLO2dCQUNsQixLQUFLO2dCQUNMLFVBQVUsRUFBRSxNQUFNLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxLQUFLLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQzthQUNsRSxDQUFDO1FBQ0osQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBRU8sS0FBSyxDQUFDLGlCQUFpQjtRQUM3Qix1RkFBdUY7UUFDdkYsT0FBTztZQUNMLGtCQUFrQixFQUFFLElBQUk7WUFDeEIsY0FBYyxFQUFFLElBQUk7WUFDcEIsc0JBQXNCLEVBQUUsR0FBRztZQUMzQixrQkFBa0IsRUFBRSxHQUFHO1lBQ3ZCLGlCQUFpQixFQUFFLElBQUk7U0FDeEIsQ0FBQztJQUNKLENBQUM7SUFFTyx5QkFBeUI7UUFDL0Isb0RBQW9EO1FBQ3BELE1BQU0sYUFBYSxHQUFHLElBQUksSUFBSSxFQUFFLENBQUM7UUFDakMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxhQUFhLENBQUMsT0FBTyxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7UUFFcEQsT0FBTyxJQUFJLENBQUMsZUFBZTthQUN4QixNQUFNLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxNQUFNLENBQUMsU0FBUyxJQUFJLGFBQWEsQ0FBQzthQUNuRCxHQUFHLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBQ2QsSUFBSSxFQUFFLE1BQU0sQ0FBQyxTQUFTO1lBQ3RCLFdBQVcsRUFBRSxNQUFNLENBQUMsbUJBQW1CLENBQUMsa0JBQWtCO1lBQzFELGFBQWEsRUFBRSxNQUFNLENBQUMsa0JBQWtCLENBQUMsYUFBYTtZQUN0RCxrQkFBa0IsRUFBRSxNQUFNLENBQUMsa0JBQWtCLENBQUMsMEJBQTBCLENBQUMsYUFBYSxDQUFDLEtBQUs7WUFDNUYsc0JBQXNCLEVBQUUsTUFBTSxDQUFDLGNBQWMsQ0FBQyxlQUFlO1NBQzlELENBQUMsQ0FBQyxDQUFDO0lBQ1IsQ0FBQztJQUVPLEtBQUssQ0FBQyw2QkFBNkI7UUFDekMsa0dBQWtHO1FBQ2xHLE9BQU87WUFDTCxFQUFFLFFBQVEsRUFBRSx1QkFBZSxDQUFDLFVBQVUsRUFBRSxXQUFXLEVBQUUsSUFBSSxFQUFFLFVBQVUsRUFBRSxHQUFHLEVBQUU7WUFDNUUsRUFBRSxRQUFRLEVBQUUsdUJBQWUsQ0FBQyxXQUFXLEVBQUUsV0FBVyxFQUFFLElBQUksRUFBRSxVQUFVLEVBQUUsR0FBRyxFQUFFO1lBQzdFLEVBQUUsUUFBUSxFQUFFLHVCQUFlLENBQUMsY0FBYyxFQUFFLFdBQVcsRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFFLEdBQUcsRUFBRTtZQUNoRixFQUFFLFFBQVEsRUFBRSx1QkFBZSxDQUFDLFdBQVcsRUFBRSxXQUFXLEVBQUUsSUFBSSxFQUFFLFVBQVUsRUFBRSxHQUFHLEVBQUU7WUFDN0UsRUFBRSxRQUFRLEVBQUUsdUJBQWUsQ0FBQyxjQUFjLEVBQUUsV0FBVyxFQUFFLElBQUksRUFBRSxVQUFVLEVBQUUsR0FBRyxFQUFFO1lBQ2hGLEVBQUUsUUFBUSxFQUFFLHVCQUFlLENBQUMsY0FBYyxFQUFFLFdBQVcsRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFFLEVBQUUsRUFBRTtZQUMvRSxFQUFFLFFBQVEsRUFBRSx1QkFBZSxDQUFDLFlBQVksRUFBRSxXQUFXLEVBQUUsSUFBSSxFQUFFLFVBQVUsRUFBRSxFQUFFLEVBQUU7WUFDN0UsRUFBRSxRQUFRLEVBQUUsdUJBQWUsQ0FBQyxTQUFTLEVBQUUsV0FBVyxFQUFFLElBQUksRUFBRSxVQUFVLEVBQUUsR0FBRyxFQUFFO1lBQzNFLEVBQUUsUUFBUSxFQUFFLHVCQUFlLENBQUMsY0FBYyxFQUFFLFdBQVcsRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFFLEVBQUUsRUFBRTtZQUMvRSxFQUFFLFFBQVEsRUFBRSx1QkFBZSxDQUFDLG9CQUFvQixFQUFFLFdBQVcsRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFFLEVBQUUsRUFBRTtTQUN0RixDQUFDO0lBQ0osQ0FBQztJQUVPLHdCQUF3QixDQUFDLGNBQThCO1FBQzdELElBQUksY0FBYyxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUU7WUFDL0IsT0FBTztnQkFDTCxJQUFJLEVBQUUsSUFBSSxJQUFJLEVBQUU7Z0JBQ2hCLFdBQVcsRUFBRSxDQUFDO2dCQUNkLGFBQWEsRUFBRSxDQUFDO2dCQUNoQixrQkFBa0IsRUFBRSxDQUFDO2dCQUNyQixzQkFBc0IsRUFBRSxDQUFDO2FBQzFCLENBQUM7U0FDSDtRQUVELE1BQU0sTUFBTSxHQUFHLGNBQWMsQ0FBQyxjQUFjLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBQ3pELE1BQU0sUUFBUSxHQUFHLGNBQWMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxjQUFjLENBQUMsY0FBYyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDO1FBRWhHLE9BQU87WUFDTCxJQUFJLEVBQUUsTUFBTSxDQUFDLElBQUk7WUFDakIsV0FBVyxFQUFFLE1BQU0sQ0FBQyxXQUFXO1lBQy9CLGFBQWEsRUFBRSxNQUFNLENBQUMsYUFBYTtZQUNuQyxrQkFBa0IsRUFBRSxNQUFNLENBQUMsa0JBQWtCO1lBQzdDLHNCQUFzQixFQUFFLE1BQU0sQ0FBQyxzQkFBc0I7WUFDckQsTUFBTSxFQUFFO2dCQUNOLGlCQUFpQixFQUFFLE1BQU0sQ0FBQyxXQUFXLEdBQUcsUUFBUSxDQUFDLFdBQVc7Z0JBQzVELG1CQUFtQixFQUFFLE1BQU0sQ0FBQyxhQUFhLEdBQUcsUUFBUSxDQUFDLGFBQWE7Z0JBQ2xFLHdCQUF3QixFQUFFLE1BQU0sQ0FBQyxrQkFBa0IsR0FBRyxRQUFRLENBQUMsa0JBQWtCO2dCQUNqRiw0QkFBNEIsRUFBRSxNQUFNLENBQUMsc0JBQXNCLEdBQUcsUUFBUSxDQUFDLHNCQUFzQjthQUM5RjtTQUNGLENBQUM7SUFDSixDQUFDO0lBRU8sNEJBQTRCLENBQUMsWUFBMEI7UUFDN0Qsa0RBQWtEO1FBQ2xELE1BQU0sV0FBVyxHQUFHLFlBQVksQ0FBQyxXQUFXLENBQUM7UUFDN0MsTUFBTSxVQUFVLEdBQUcsRUFBRSxDQUFDO1FBQ3RCLE1BQU0sVUFBVSxHQUFHLFlBQVksQ0FBQyxNQUFNLEVBQUUsaUJBQWlCLElBQUksR0FBRyxDQUFDLENBQUMsd0NBQXdDO1FBRTFHLElBQUksVUFBVSxJQUFJLENBQUMsSUFBSSxXQUFXLElBQUksVUFBVSxFQUFFO1lBQ2hELE1BQU0sVUFBVSxHQUFHLElBQUksSUFBSSxFQUFFLENBQUM7WUFDOUIsVUFBVSxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUMsT0FBTyxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQyxvQ0FBb0M7WUFDbkYsT0FBTyxVQUFVLENBQUM7U0FDbkI7UUFFRCxNQUFNLFVBQVUsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsVUFBVSxHQUFHLFdBQVcsQ0FBQyxHQUFHLFVBQVUsQ0FBQyxDQUFDO1FBQ3RFLE1BQU0sYUFBYSxHQUFHLElBQUksSUFBSSxFQUFFLENBQUM7UUFDakMsYUFBYSxDQUFDLE9BQU8sQ0FBQyxhQUFhLENBQUMsT0FBTyxFQUFFLEdBQUcsVUFBVSxDQUFDLENBQUM7UUFFNUQsT0FBTyxhQUFhLENBQUM7SUFDdkIsQ0FBQztJQUVPLEtBQUssQ0FBQyxrQ0FBa0MsQ0FBQyxvQkFBbUc7UUFDbEosTUFBTSxlQUFlLEdBQWEsRUFBRSxDQUFDO1FBRXJDLHlDQUF5QztRQUN6QyxNQUFNLG9CQUFvQixHQUFHLG9CQUFvQixDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxXQUFXLEdBQUcsRUFBRSxDQUFDLENBQUM7UUFFdEYsS0FBSyxNQUFNLFFBQVEsSUFBSSxvQkFBb0IsRUFBRTtZQUMzQyxRQUFRLFFBQVEsQ0FBQyxRQUFRLEVBQUU7Z0JBQ3pCLEtBQUssdUJBQWUsQ0FBQyxjQUFjO29CQUNqQyxlQUFlLENBQUMsSUFBSSxDQUFDLGlFQUFpRSxDQUFDLENBQUM7b0JBQ3hGLE1BQU07Z0JBQ1IsS0FBSyx1QkFBZSxDQUFDLFdBQVc7b0JBQzlCLGVBQWUsQ0FBQyxJQUFJLENBQUMsZ0VBQWdFLENBQUMsQ0FBQztvQkFDdkYsTUFBTTtnQkFDUixLQUFLLHVCQUFlLENBQUMsY0FBYztvQkFDakMsZUFBZSxDQUFDLElBQUksQ0FBQyw2REFBNkQsQ0FBQyxDQUFDO29CQUNwRixNQUFNO2dCQUNSLEtBQUssdUJBQWUsQ0FBQyxZQUFZO29CQUMvQixlQUFlLENBQUMsSUFBSSxDQUFDLDhDQUE4QyxDQUFDLENBQUM7b0JBQ3JFLE1BQU07Z0JBQ1IsS0FBSyx1QkFBZSxDQUFDLGNBQWM7b0JBQ2pDLGVBQWUsQ0FBQyxJQUFJLENBQUMsOERBQThELENBQUMsQ0FBQztvQkFDckYsTUFBTTtnQkFDUixLQUFLLHVCQUFlLENBQUMsb0JBQW9CO29CQUN2QyxlQUFlLENBQUMsSUFBSSxDQUFDLG9FQUFvRSxDQUFDLENBQUM7b0JBQzNGLE1BQU07YUFDVDtTQUNGO1FBRUQsc0RBQXNEO1FBQ3RELE1BQU0scUJBQXFCLEdBQUcsb0JBQW9CLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLFdBQVcsR0FBRyxFQUFFLENBQUMsQ0FBQztRQUV2RixJQUFJLHFCQUFxQixDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDcEMsZUFBZSxDQUFDLElBQUksQ0FBQyxjQUFjLHFCQUFxQixDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLDRCQUE0QixDQUFDLENBQUM7U0FDM0g7UUFFRCxPQUFPLGVBQWUsQ0FBQztJQUN6QixDQUFDO0lBRU8sb0JBQW9CLENBQUMsY0FBcUMsRUFBRSxPQUE4QjtRQUNoRyxvREFBb0Q7UUFDcEQsSUFBSSxjQUFjLENBQUMsVUFBVSxHQUFHLEdBQUcsRUFBRTtZQUNuQyxPQUFPLElBQUksQ0FBQztTQUNiO1FBRUQsNkNBQTZDO1FBQzdDLElBQUksT0FBTyxDQUFDLGFBQWEsQ0FBQyxtQkFBbUIsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO1lBQ3hELE9BQU8sSUFBSSxDQUFDO1NBQ2I7UUFFRCx5Q0FBeUM7UUFDekMsSUFBSSxjQUFjLENBQUMsYUFBYSxJQUFJLGNBQWMsQ0FBQyxvQkFBb0IsRUFBRTtZQUN2RSxPQUFPLElBQUksQ0FBQztTQUNiO1FBRUQsMENBQTBDO1FBQzFDLE1BQU0sa0JBQWtCLEdBQUc7WUFDekIsdUJBQWUsQ0FBQyxZQUFZO1lBQzVCLHVCQUFlLENBQUMsY0FBYztZQUM5Qix1QkFBZSxDQUFDLG9CQUFvQjtTQUNyQyxDQUFDO1FBRUYsT0FBTyxrQkFBa0IsQ0FBQyxRQUFRLENBQUMsY0FBYyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0lBQzlELENBQUM7SUFFTyxlQUFlLENBQUMsY0FBcUMsRUFBRSxPQUE4QjtRQUMzRixJQUFJLGNBQWMsQ0FBQyxVQUFVLEdBQUcsR0FBRyxFQUFFO1lBQ25DLE9BQU8sa0NBQWtDLENBQUMsY0FBYyxDQUFDLFVBQVUsR0FBRyxHQUFHLENBQUMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQztTQUMzRjtRQUVELElBQUksT0FBTyxDQUFDLGFBQWEsQ0FBQyxtQkFBbUIsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO1lBQ3hELE9BQU8sMkRBQTJELENBQUM7U0FDcEU7UUFFRCxJQUFJLGNBQWMsQ0FBQyxhQUFhLElBQUksY0FBYyxDQUFDLG9CQUFvQixFQUFFO1lBQ3ZFLE9BQU8sOEVBQThFLENBQUM7U0FDdkY7UUFFRCxPQUFPLHVCQUF1QixjQUFjLENBQUMsUUFBUSxFQUFFLENBQUM7SUFDMUQsQ0FBQztJQUVPLHVCQUF1QixDQUFDLGNBQXFDLEVBQUUsT0FBOEI7UUFDbkcsdURBQXVEO1FBQ3ZELElBQUksY0FBYyxDQUFDLFVBQVUsR0FBRyxHQUFHLElBQUksQ0FBQyxjQUFjLENBQUMsYUFBYSxJQUFJLGNBQWMsQ0FBQyxvQkFBb0IsQ0FBQyxFQUFFO1lBQzVHLE9BQU8sTUFBTSxDQUFDO1NBQ2Y7UUFFRCwwREFBMEQ7UUFDMUQsSUFBSSxjQUFjLENBQUMsVUFBVSxHQUFHLEdBQUcsSUFBSSxPQUFPLENBQUMsYUFBYSxDQUFDLG1CQUFtQixDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDM0YsT0FBTyxRQUFRLENBQUM7U0FDakI7UUFFRCw4Q0FBOEM7UUFDOUMsT0FBTyxLQUFLLENBQUM7SUFDZixDQUFDO0lBRU8sS0FBSyxDQUFDLHdCQUF3QixDQUFDLGNBQXFDLEVBQUUsT0FBOEI7UUFDMUcsTUFBTSxPQUFPLEdBQWEsRUFBRSxDQUFDO1FBRTdCLElBQUksY0FBYyxDQUFDLFVBQVUsR0FBRyxHQUFHLEVBQUU7WUFDbkMsT0FBTyxDQUFDLElBQUksQ0FBQyxrREFBa0QsQ0FBQyxDQUFDO1NBQ2xFO1FBRUQsSUFBSSxjQUFjLENBQUMsb0JBQW9CLEVBQUU7WUFDdkMsT0FBTyxDQUFDLElBQUksQ0FBQyw0QkFBNEIsY0FBYyxDQUFDLG9CQUFvQixFQUFFLENBQUMsQ0FBQztTQUNqRjtRQUVELElBQUksQ0FBQyxjQUFjLENBQUMsYUFBYSxFQUFFO1lBQ2pDLE9BQU8sQ0FBQyxJQUFJLENBQUMsc0RBQXNELENBQUMsQ0FBQztTQUN0RTthQUFNO1lBQ0wsT0FBTyxDQUFDLElBQUksQ0FBQyx3REFBd0QsQ0FBQyxDQUFDO1NBQ3hFO1FBRUQsSUFBSSxPQUFPLENBQUMsYUFBYSxDQUFDLGNBQWMsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO1lBQ25ELE9BQU8sQ0FBQyxJQUFJLENBQUMsbUNBQW1DLE9BQU8sQ0FBQyxhQUFhLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7U0FDcEc7UUFFRCxPQUFPLE9BQU8sQ0FBQztJQUNqQixDQUFDO0lBRU8sb0JBQW9CLENBQUMsY0FBcUMsRUFBRSxPQUE4QjtRQUNoRyx3REFBd0Q7UUFDeEQsSUFBSSxjQUFjLENBQUMsVUFBVSxHQUFHLEdBQUcsSUFBSSxPQUFPLENBQUMsYUFBYSxDQUFDLG1CQUFtQixDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7WUFDM0YsT0FBTyxNQUFNLENBQUM7U0FDZjtRQUVELHFDQUFxQztRQUNyQyxJQUFJLGNBQWMsQ0FBQyxVQUFVLEdBQUcsR0FBRyxJQUFJLE9BQU8sQ0FBQyxhQUFhLENBQUMsbUJBQW1CLENBQUMsTUFBTSxHQUFHLENBQUMsRUFBRTtZQUMzRixPQUFPLFFBQVEsQ0FBQztTQUNqQjtRQUVELDJCQUEyQjtRQUMzQixPQUFPLEtBQUssQ0FBQztJQUNmLENBQUM7SUFFTyxLQUFLLENBQUMsc0JBQXNCLENBQUMsVUFBeUU7UUFDNUcsd0NBQXdDO1FBQ3hDLE1BQU0sa0JBQWtCLEdBQW9ELEVBQUUsQ0FBQztRQUUvRSxJQUFJO1lBQ0YsTUFBTSxXQUFXLEdBQUcsd0JBQXdCLFVBQVUsQ0FBQyxRQUFRLEdBQUcsQ0FBQztZQUNuRSxNQUFNLE1BQU0sR0FBRyxJQUFBLHdCQUFRLEVBQUMsV0FBVyxFQUFFLEVBQUUsUUFBUSxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLENBQUMsQ0FBQztZQUUxRSxNQUFNLEtBQUssR0FBRyxNQUFNLENBQUMsSUFBSSxFQUFFLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDO1lBRXBFLEtBQUssTUFBTSxJQUFJLElBQUksS0FBSyxFQUFFO2dCQUN4QixNQUFNLEtBQUssR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLGNBQWMsQ0FBQyxDQUFDO2dCQUN6QyxJQUFJLEtBQUssRUFBRTtvQkFDVCxNQUFNLFVBQVUsR0FBRyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7b0JBQ3RDLElBQUksVUFBVSxLQUFLLFVBQVUsQ0FBQyxVQUFVLEVBQUU7d0JBQ3hDLGtCQUFrQixDQUFDLElBQUksQ0FBQzs0QkFDdEIsUUFBUSxFQUFFLFVBQVUsQ0FBQyxRQUFROzRCQUM3QixVQUFVO3lCQUNYLENBQUMsQ0FBQztxQkFDSjtpQkFDRjthQUNGO1NBQ0Y7UUFBQyxPQUFPLEtBQUssRUFBRTtZQUNkLCtCQUErQjtTQUNoQztRQUVELE9BQU8sa0JBQWtCLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLGlDQUFpQztJQUMxRSxDQUFDO0lBRU8sWUFBWSxDQUFDLFlBQWdDO1FBQ25ELE1BQU0sU0FBUyxHQUFHLFlBQVksQ0FBQyxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUMsR0FBRyxFQUFFLE9BQU8sRUFBRSxFQUFFLENBQzlELE9BQU8sQ0FBQyxLQUFLLEdBQUcsR0FBRyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQzFDLENBQUM7UUFDRixPQUFPLFNBQVMsQ0FBQyxNQUFNLENBQUM7SUFDMUIsQ0FBQztJQUVPLGNBQWMsQ0FBQyxZQUFnQztRQUNyRCxNQUFNLFdBQVcsR0FBRyxZQUFZLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxDQUFDLEdBQUcsRUFBRSxPQUFPLEVBQUUsRUFBRSxDQUNsRSxPQUFPLENBQUMsS0FBSyxHQUFHLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUMxQyxDQUFDO1FBQ0YsT0FBTyxXQUFXLENBQUMsUUFBUSxDQUFDO0lBQzlCLENBQUM7SUFFTyxtQkFBbUI7UUFDekIsSUFBSTtZQUNGLE1BQU0sV0FBVyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxFQUFFLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSx5Q0FBeUMsQ0FBQyxDQUFDO1lBQ3JILElBQUksRUFBRSxDQUFDLFVBQVUsQ0FBQyxXQUFXLENBQUMsRUFBRTtnQkFDOUIsTUFBTSxXQUFXLEdBQUcsRUFBRSxDQUFDLFlBQVksQ0FBQyxXQUFXLEVBQUUsTUFBTSxDQUFDLENBQUM7Z0JBQ3pELElBQUksQ0FBQyxlQUFlLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxXQUFXLENBQUMsQ0FBQzthQUNoRDtTQUNGO1FBQUMsT0FBTyxLQUFLLEVBQUU7WUFDZCxPQUFPLENBQUMsSUFBSSxDQUFDLGtDQUFrQyxFQUFFLEtBQUssQ0FBQyxDQUFDO1lBQ3hELElBQUksQ0FBQyxlQUFlLEdBQUcsRUFBRSxDQUFDO1NBQzNCO0lBQ0gsQ0FBQztJQUVPLEtBQUssQ0FBQyxtQkFBbUI7UUFDL0IsSUFBSTtZQUNGLE1BQU0sVUFBVSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxFQUFFLE9BQU8sRUFBRSxrQkFBa0IsQ0FBQyxDQUFDO1lBQ3pFLElBQUksQ0FBQyxFQUFFLENBQUMsVUFBVSxDQUFDLFVBQVUsQ0FBQyxFQUFFO2dCQUM5QixFQUFFLENBQUMsU0FBUyxDQUFDLFVBQVUsRUFBRSxFQUFFLFNBQVMsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDO2FBQy9DO1lBRUQsTUFBTSxXQUFXLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUUseUNBQXlDLENBQUMsQ0FBQztZQUNyRixFQUFFLENBQUMsYUFBYSxDQUFDLFdBQVcsRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxlQUFlLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7U0FDOUU7UUFBQyxPQUFPLEtBQUssRUFBRTtZQUNkLE9BQU8sQ0FBQyxJQUFJLENBQUMsa0NBQWtDLEVBQUUsS0FBSyxDQUFDLENBQUM7U0FDekQ7SUFDSCxDQUFDO0NBQ0Y7QUExckJELHNDQTByQkMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L2JhY2t1cHMvZmlyc3Qtd2F2ZS0yMDI1LTA4LTExVDA1LTE5LTI2LTgxM1ovc3JjL3NlcnZpY2VzL2NhbXBhaWduL3VuaW50ZW50aW9uYWwtYW55LWVsaW1pbmF0aW9uL0FuYWx5c2lzVG9vbHMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgZXhlY1N5bmMgfSBmcm9tICdjaGlsZF9wcm9jZXNzJztcbmltcG9ydCAqIGFzIGZzIGZyb20gJ2ZzJztcbmltcG9ydCAqIGFzIHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgeyBBbnlUeXBlQ2xhc3NpZmllciB9IGZyb20gJy4vQW55VHlwZUNsYXNzaWZpZXInO1xuaW1wb3J0IHsgRG9tYWluQ29udGV4dEFuYWx5emVyIH0gZnJvbSAnLi9Eb21haW5Db250ZXh0QW5hbHl6ZXInO1xuaW1wb3J0IHtcbiAgICBBbmFseXNpc01ldHJpY3MsXG4gICAgQW5hbHlzaXNSZXBvcnQsXG4gICAgQW55VHlwZUNhdGVnb3J5LFxuICAgIEFueVR5cGVDbGFzc2lmaWNhdGlvbixcbiAgICBDbGFzc2lmaWNhdGlvbkFjY3VyYWN5UmVwb3J0LFxuICAgIENsYXNzaWZpY2F0aW9uQ29udGV4dCxcbiAgICBDb2RlRG9tYWluLFxuICAgIERvbWFpbkRpc3RyaWJ1dGlvbixcbiAgICBNYW51YWxSZXZpZXdSZWNvbW1lbmRhdGlvbixcbiAgICBTdWNjZXNzUmF0ZUFuYWx5c2lzLFxuICAgIFRyZW5kaW5nRGF0YVxufSBmcm9tICcuL3R5cGVzJztcblxuLyoqXG4gKiBDb21wcmVoZW5zaXZlIGFuYWx5c2lzIHRvb2xzIGZvciB1bmludGVudGlvbmFsIGFueSB0eXBlIGVsaW1pbmF0aW9uXG4gKiBQcm92aWRlcyBkb21haW4gZGlzdHJpYnV0aW9uIGFuYWx5c2lzLCBjbGFzc2lmaWNhdGlvbiBhY2N1cmFjeSByZXBvcnRpbmcsXG4gKiBzdWNjZXNzIHJhdGUgYW5hbHlzaXMsIGFuZCBtYW51YWwgcmV2aWV3IHJlY29tbWVuZGF0aW9uc1xuICovXG5leHBvcnQgY2xhc3MgQW5hbHlzaXNUb29scyB7XG4gIHByaXZhdGUgY2xhc3NpZmllcjogQW55VHlwZUNsYXNzaWZpZXI7XG4gIHByaXZhdGUgZG9tYWluQW5hbHl6ZXI6IERvbWFpbkNvbnRleHRBbmFseXplcjtcbiAgcHJpdmF0ZSBhbmFseXNpc0hpc3Rvcnk6IEFuYWx5c2lzUmVwb3J0W10gPSBbXTtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLmNsYXNzaWZpZXIgPSBuZXcgQW55VHlwZUNsYXNzaWZpZXIoKTtcbiAgICB0aGlzLmRvbWFpbkFuYWx5emVyID0gbmV3IERvbWFpbkNvbnRleHRBbmFseXplcigpO1xuICAgIHRoaXMubG9hZEFuYWx5c2lzSGlzdG9yeSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIEFuYWx5emUgY3VycmVudCBhbnkgdHlwZSBkaXN0cmlidXRpb24gYnkgZG9tYWluXG4gICAqL1xuICBhc3luYyBhbmFseXplRG9tYWluRGlzdHJpYnV0aW9uKCk6IFByb21pc2U8RG9tYWluRGlzdHJpYnV0aW9uPiB7XG4gICAgY29uc29sZS5sb2coJ0FuYWx5emluZyBhbnkgdHlwZSBkaXN0cmlidXRpb24gYnkgZG9tYWluLi4uJyk7XG5cbiAgICBjb25zdCBhbnlUeXBlT2NjdXJyZW5jZXMgPSBhd2FpdCB0aGlzLmZpbmRBbGxBbnlUeXBlcygpO1xuICAgIGNvbnN0IGRvbWFpbkRpc3RyaWJ1dGlvbjogUmVjb3JkPENvZGVEb21haW4sIG51bWJlcj4gPSB7XG4gICAgICBbQ29kZURvbWFpbi5BU1RST0xPR0lDQUxdOiAwLFxuICAgICAgW0NvZGVEb21haW4uUkVDSVBFXTogMCxcbiAgICAgIFtDb2RlRG9tYWluLkNBTVBBSUdOXTogMCxcbiAgICAgIFtDb2RlRG9tYWluLklOVEVMTElHRU5DRV06IDAsXG4gICAgICBbQ29kZURvbWFpbi5TRVJWSUNFXTogMCxcbiAgICAgIFtDb2RlRG9tYWluLkNPTVBPTkVOVF06IDAsXG4gICAgICBbQ29kZURvbWFpbi5VVElMSVRZXTogMCxcbiAgICAgIFtDb2RlRG9tYWluLlRFU1RdOiAwXG4gICAgfTtcblxuICAgIGNvbnN0IGNhdGVnb3J5RGlzdHJpYnV0aW9uOiBSZWNvcmQ8QW55VHlwZUNhdGVnb3J5LCBudW1iZXI+ID0ge1xuICAgICAgW0FueVR5cGVDYXRlZ29yeS5FUlJPUl9IQU5ETElOR106IDAsXG4gICAgICBbQW55VHlwZUNhdGVnb3J5LkVYVEVSTkFMX0FQSV06IDAsXG4gICAgICBbQW55VHlwZUNhdGVnb3J5LlRFU1RfTU9DS106IDAsXG4gICAgICBbQW55VHlwZUNhdGVnb3J5LkRZTkFNSUNfQ09ORklHXTogMCxcbiAgICAgIFtBbnlUeXBlQ2F0ZWdvcnkuTEVHQUNZX0NPTVBBVElCSUxJVFldOiAwLFxuICAgICAgW0FueVR5cGVDYXRlZ29yeS5BUlJBWV9UWVBFXTogMCxcbiAgICAgIFtBbnlUeXBlQ2F0ZWdvcnkuUkVDT1JEX1RZUEVdOiAwLFxuICAgICAgW0FueVR5cGVDYXRlZ29yeS5GVU5DVElPTl9QQVJBTV06IDAsXG4gICAgICBbQW55VHlwZUNhdGVnb3J5LlJFVFVSTl9UWVBFXTogMCxcbiAgICAgIFtBbnlUeXBlQ2F0ZWdvcnkuVFlQRV9BU1NFUlRJT05dOiAwXG4gICAgfTtcblxuICAgIGNvbnN0IGludGVudGlvbmFsQ291bnQgPSB7IGNvdW50OiAwIH07XG4gICAgY29uc3QgdW5pbnRlbnRpb25hbENvdW50ID0geyBjb3VudDogMCB9O1xuXG4gICAgZm9yIChjb25zdCBvY2N1cnJlbmNlIG9mIGFueVR5cGVPY2N1cnJlbmNlcykge1xuICAgICAgY29uc3QgY29udGV4dCA9IGF3YWl0IHRoaXMuY3JlYXRlQ2xhc3NpZmljYXRpb25Db250ZXh0KG9jY3VycmVuY2UpO1xuICAgICAgY29uc3QgZG9tYWluQ29udGV4dCA9IGF3YWl0IHRoaXMuZG9tYWluQW5hbHl6ZXIuYW5hbHl6ZURvbWFpbihjb250ZXh0KTtcbiAgICAgIGNvbnN0IGNsYXNzaWZpY2F0aW9uID0gYXdhaXQgdGhpcy5jbGFzc2lmaWVyLmNsYXNzaWZ5KGNvbnRleHQpO1xuXG4gICAgICAvLyBDb3VudCBieSBkb21haW5cbiAgICAgIGRvbWFpbkRpc3RyaWJ1dGlvbltkb21haW5Db250ZXh0LmRvbWFpbl0rKztcblxuICAgICAgLy8gQ291bnQgYnkgY2F0ZWdvcnlcbiAgICAgIGNhdGVnb3J5RGlzdHJpYnV0aW9uW2NsYXNzaWZpY2F0aW9uLmNhdGVnb3J5XSsrO1xuXG4gICAgICAvLyBDb3VudCBieSBpbnRlbnRpb25hbGl0eVxuICAgICAgaWYgKGNsYXNzaWZpY2F0aW9uLmlzSW50ZW50aW9uYWwpIHtcbiAgICAgICAgaW50ZW50aW9uYWxDb3VudC5jb3VudCsrO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdW5pbnRlbnRpb25hbENvdW50LmNvdW50Kys7XG4gICAgICB9XG4gICAgfVxuXG4gICAgY29uc3QgdG90YWxDb3VudCA9IGFueVR5cGVPY2N1cnJlbmNlcy5sZW5ndGg7XG4gICAgY29uc3QgZGlzdHJpYnV0aW9uOiBEb21haW5EaXN0cmlidXRpb24gPSB7XG4gICAgICB0b3RhbEFueVR5cGVzOiB0b3RhbENvdW50LFxuICAgICAgYnlEb21haW46IE9iamVjdC5lbnRyaWVzKGRvbWFpbkRpc3RyaWJ1dGlvbikubWFwKChbZG9tYWluLCBjb3VudF0pID0+ICh7XG4gICAgICAgIGRvbWFpbjogZG9tYWluIGFzIENvZGVEb21haW4sXG4gICAgICAgIGNvdW50LFxuICAgICAgICBwZXJjZW50YWdlOiB0b3RhbENvdW50ID4gMCA/IChjb3VudCAvIHRvdGFsQ291bnQpICogMTAwIDogMFxuICAgICAgfSkpLFxuICAgICAgYnlDYXRlZ29yeTogT2JqZWN0LmVudHJpZXMoY2F0ZWdvcnlEaXN0cmlidXRpb24pLm1hcCgoW2NhdGVnb3J5LCBjb3VudF0pID0+ICh7XG4gICAgICAgIGNhdGVnb3J5OiBjYXRlZ29yeSBhcyBBbnlUeXBlQ2F0ZWdvcnksXG4gICAgICAgIGNvdW50LFxuICAgICAgICBwZXJjZW50YWdlOiB0b3RhbENvdW50ID4gMCA/IChjb3VudCAvIHRvdGFsQ291bnQpICogMTAwIDogMFxuICAgICAgfSkpLFxuICAgICAgaW50ZW50aW9uYWxWc1VuaW50ZW50aW9uYWw6IHtcbiAgICAgICAgaW50ZW50aW9uYWw6IHtcbiAgICAgICAgICBjb3VudDogaW50ZW50aW9uYWxDb3VudC5jb3VudCxcbiAgICAgICAgICBwZXJjZW50YWdlOiB0b3RhbENvdW50ID4gMCA/IChpbnRlbnRpb25hbENvdW50LmNvdW50IC8gdG90YWxDb3VudCkgKiAxMDAgOiAwXG4gICAgICAgIH0sXG4gICAgICAgIHVuaW50ZW50aW9uYWw6IHtcbiAgICAgICAgICBjb3VudDogdW5pbnRlbnRpb25hbENvdW50LmNvdW50LFxuICAgICAgICAgIHBlcmNlbnRhZ2U6IHRvdGFsQ291bnQgPiAwID8gKHVuaW50ZW50aW9uYWxDb3VudC5jb3VudCAvIHRvdGFsQ291bnQpICogMTAwIDogMFxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgYW5hbHlzaXNEYXRlOiBuZXcgRGF0ZSgpXG4gICAgfTtcblxuICAgIGNvbnNvbGUubG9nKGBEb21haW4gZGlzdHJpYnV0aW9uIGFuYWx5c2lzIGNvbXBsZXRlOiAke3RvdGFsQ291bnR9IGFueSB0eXBlcyBmb3VuZGApO1xuICAgIHJldHVybiBkaXN0cmlidXRpb247XG4gIH1cblxuICAvKipcbiAgICogSW1wbGVtZW50IGNsYXNzaWZpY2F0aW9uIGFjY3VyYWN5IHJlcG9ydGluZ1xuICAgKi9cbiAgYXN5bmMgZ2VuZXJhdGVDbGFzc2lmaWNhdGlvbkFjY3VyYWN5UmVwb3J0KCk6IFByb21pc2U8Q2xhc3NpZmljYXRpb25BY2N1cmFjeVJlcG9ydD4ge1xuICAgIGNvbnNvbGUubG9nKCdHZW5lcmF0aW5nIGNsYXNzaWZpY2F0aW9uIGFjY3VyYWN5IHJlcG9ydC4uLicpO1xuXG4gICAgY29uc3QgYW55VHlwZU9jY3VycmVuY2VzID0gYXdhaXQgdGhpcy5maW5kQWxsQW55VHlwZXMoKTtcbiAgICBjb25zdCBzYW1wbGVTaXplID0gTWF0aC5taW4oMTAwLCBhbnlUeXBlT2NjdXJyZW5jZXMubGVuZ3RoKTsgLy8gU2FtcGxlIGZvciBhY2N1cmFjeSB0ZXN0aW5nXG4gICAgY29uc3Qgc2FtcGxlID0gYW55VHlwZU9jY3VycmVuY2VzLnNsaWNlKDAsIHNhbXBsZVNpemUpO1xuXG4gICAgbGV0IGNvcnJlY3RDbGFzc2lmaWNhdGlvbnMgPSAwO1xuICAgIGxldCB0b3RhbENsYXNzaWZpY2F0aW9ucyA9IDA7XG4gICAgY29uc3QgY29uZmlkZW5jZVNjb3JlczogbnVtYmVyW10gPSBbXTtcbiAgICBjb25zdCBjYXRlZ29yeUFjY3VyYWN5OiBSZWNvcmQ8QW55VHlwZUNhdGVnb3J5LCB7IGNvcnJlY3Q6IG51bWJlcjsgdG90YWw6IG51bWJlciB9PiA9IHtcbiAgICAgIFtBbnlUeXBlQ2F0ZWdvcnkuRVJST1JfSEFORExJTkddOiB7IGNvcnJlY3Q6IDAsIHRvdGFsOiAwIH0sXG4gICAgICBbQW55VHlwZUNhdGVnb3J5LkVYVEVSTkFMX0FQSV06IHsgY29ycmVjdDogMCwgdG90YWw6IDAgfSxcbiAgICAgIFtBbnlUeXBlQ2F0ZWdvcnkuVEVTVF9NT0NLXTogeyBjb3JyZWN0OiAwLCB0b3RhbDogMCB9LFxuICAgICAgW0FueVR5cGVDYXRlZ29yeS5EWU5BTUlDX0NPTkZJR106IHsgY29ycmVjdDogMCwgdG90YWw6IDAgfSxcbiAgICAgIFtBbnlUeXBlQ2F0ZWdvcnkuTEVHQUNZX0NPTVBBVElCSUxJVFldOiB7IGNvcnJlY3Q6IDAsIHRvdGFsOiAwIH0sXG4gICAgICBbQW55VHlwZUNhdGVnb3J5LkFSUkFZX1RZUEVdOiB7IGNvcnJlY3Q6IDAsIHRvdGFsOiAwIH0sXG4gICAgICBbQW55VHlwZUNhdGVnb3J5LlJFQ09SRF9UWVBFXTogeyBjb3JyZWN0OiAwLCB0b3RhbDogMCB9LFxuICAgICAgW0FueVR5cGVDYXRlZ29yeS5GVU5DVElPTl9QQVJBTV06IHsgY29ycmVjdDogMCwgdG90YWw6IDAgfSxcbiAgICAgIFtBbnlUeXBlQ2F0ZWdvcnkuUkVUVVJOX1RZUEVdOiB7IGNvcnJlY3Q6IDAsIHRvdGFsOiAwIH0sXG4gICAgICBbQW55VHlwZUNhdGVnb3J5LlRZUEVfQVNTRVJUSU9OXTogeyBjb3JyZWN0OiAwLCB0b3RhbDogMCB9XG4gICAgfTtcblxuICAgIGZvciAoY29uc3Qgb2NjdXJyZW5jZSBvZiBzYW1wbGUpIHtcbiAgICAgIGNvbnN0IGNvbnRleHQgPSBhd2FpdCB0aGlzLmNyZWF0ZUNsYXNzaWZpY2F0aW9uQ29udGV4dChvY2N1cnJlbmNlKTtcbiAgICAgIGNvbnN0IGNsYXNzaWZpY2F0aW9uID0gYXdhaXQgdGhpcy5jbGFzc2lmaWVyLmNsYXNzaWZ5KGNvbnRleHQpO1xuXG4gICAgICB0b3RhbENsYXNzaWZpY2F0aW9ucysrO1xuICAgICAgY29uZmlkZW5jZVNjb3Jlcy5wdXNoKGNsYXNzaWZpY2F0aW9uLmNvbmZpZGVuY2UpO1xuICAgICAgY2F0ZWdvcnlBY2N1cmFjeVtjbGFzc2lmaWNhdGlvbi5jYXRlZ29yeV0udG90YWwrKztcblxuICAgICAgLy8gVmFsaWRhdGUgY2xhc3NpZmljYXRpb24gYWNjdXJhY3kgdXNpbmcgaGV1cmlzdGljc1xuICAgICAgY29uc3QgaXNBY2N1cmF0ZSA9IGF3YWl0IHRoaXMudmFsaWRhdGVDbGFzc2lmaWNhdGlvbkFjY3VyYWN5KGNvbnRleHQsIGNsYXNzaWZpY2F0aW9uKTtcbiAgICAgIGlmIChpc0FjY3VyYXRlKSB7XG4gICAgICAgIGNvcnJlY3RDbGFzc2lmaWNhdGlvbnMrKztcbiAgICAgICAgY2F0ZWdvcnlBY2N1cmFjeVtjbGFzc2lmaWNhdGlvbi5jYXRlZ29yeV0uY29ycmVjdCsrO1xuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IG92ZXJhbGxBY2N1cmFjeSA9IHRvdGFsQ2xhc3NpZmljYXRpb25zID4gMCA/IChjb3JyZWN0Q2xhc3NpZmljYXRpb25zIC8gdG90YWxDbGFzc2lmaWNhdGlvbnMpICogMTAwIDogMDtcbiAgICBjb25zdCBhdmVyYWdlQ29uZmlkZW5jZSA9IGNvbmZpZGVuY2VTY29yZXMubGVuZ3RoID4gMFxuICAgICAgPyBjb25maWRlbmNlU2NvcmVzLnJlZHVjZSgoc3VtLCBzY29yZSkgPT4gc3VtICsgc2NvcmUsIDApIC8gY29uZmlkZW5jZVNjb3Jlcy5sZW5ndGhcbiAgICAgIDogMDtcblxuICAgIGNvbnN0IHJlcG9ydDogQ2xhc3NpZmljYXRpb25BY2N1cmFjeVJlcG9ydCA9IHtcbiAgICAgIG92ZXJhbGxBY2N1cmFjeSxcbiAgICAgIGF2ZXJhZ2VDb25maWRlbmNlLFxuICAgICAgc2FtcGxlU2l6ZSxcbiAgICAgIGNhdGVnb3J5QWNjdXJhY3k6IE9iamVjdC5lbnRyaWVzKGNhdGVnb3J5QWNjdXJhY3kpLm1hcCgoW2NhdGVnb3J5LCBzdGF0c10pID0+ICh7XG4gICAgICAgIGNhdGVnb3J5OiBjYXRlZ29yeSBhcyBBbnlUeXBlQ2F0ZWdvcnksXG4gICAgICAgIGFjY3VyYWN5OiBzdGF0cy50b3RhbCA+IDAgPyAoc3RhdHMuY29ycmVjdCAvIHN0YXRzLnRvdGFsKSAqIDEwMCA6IDAsXG4gICAgICAgIHNhbXBsZUNvdW50OiBzdGF0cy50b3RhbFxuICAgICAgfSkpLFxuICAgICAgY29uZmlkZW5jZURpc3RyaWJ1dGlvbjogdGhpcy5jYWxjdWxhdGVDb25maWRlbmNlRGlzdHJpYnV0aW9uKGNvbmZpZGVuY2VTY29yZXMpLFxuICAgICAgcmVwb3J0RGF0ZTogbmV3IERhdGUoKVxuICAgIH07XG5cbiAgICBjb25zb2xlLmxvZyhgQ2xhc3NpZmljYXRpb24gYWNjdXJhY3kgcmVwb3J0IGNvbXBsZXRlOiAke292ZXJhbGxBY2N1cmFjeS50b0ZpeGVkKDEpfSUgYWNjdXJhY3lgKTtcbiAgICByZXR1cm4gcmVwb3J0O1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZCBzdWNjZXNzIHJhdGUgYW5hbHlzaXMgYW5kIHRyZW5kaW5nXG4gICAqL1xuICBhc3luYyBnZW5lcmF0ZVN1Y2Nlc3NSYXRlQW5hbHlzaXMoKTogUHJvbWlzZTxTdWNjZXNzUmF0ZUFuYWx5c2lzPiB7XG4gICAgY29uc29sZS5sb2coJ0dlbmVyYXRpbmcgc3VjY2VzcyByYXRlIGFuYWx5c2lzIGFuZCB0cmVuZGluZy4uLicpO1xuXG4gICAgY29uc3QgY3VycmVudE1ldHJpY3MgPSBhd2FpdCB0aGlzLmdldEN1cnJlbnRNZXRyaWNzKCk7XG4gICAgY29uc3QgaGlzdG9yaWNhbERhdGEgPSB0aGlzLmdldEhpc3RvcmljYWxUcmVuZGluZ0RhdGEoKTtcblxuICAgIC8vIENhbGN1bGF0ZSBzdWNjZXNzIHJhdGVzIGJ5IGNhdGVnb3J5XG4gICAgY29uc3QgY2F0ZWdvcnlTdWNjZXNzUmF0ZXMgPSBhd2FpdCB0aGlzLmNhbGN1bGF0ZUNhdGVnb3J5U3VjY2Vzc1JhdGVzKCk7XG5cbiAgICAvLyBDYWxjdWxhdGUgdHJlbmRpbmcgZGF0YVxuICAgIGNvbnN0IHRyZW5kaW5nRGF0YSA9IHRoaXMuY2FsY3VsYXRlVHJlbmRpbmdNZXRyaWNzKGhpc3RvcmljYWxEYXRhKTtcblxuICAgIGNvbnN0IGFuYWx5c2lzOiBTdWNjZXNzUmF0ZUFuYWx5c2lzID0ge1xuICAgICAgY3VycmVudFN1Y2Nlc3NSYXRlOiBjdXJyZW50TWV0cmljcy5vdmVyYWxsU3VjY2Vzc1JhdGUsXG4gICAgICB0YXJnZXRTdWNjZXNzUmF0ZTogODUsIC8vIFRhcmdldCA4NSUgc3VjY2VzcyByYXRlXG4gICAgICBpbXByb3ZlbWVudE5lZWRlZDogTWF0aC5tYXgoMCwgODUgLSBjdXJyZW50TWV0cmljcy5vdmVyYWxsU3VjY2Vzc1JhdGUpLFxuICAgICAgY2F0ZWdvcnlTdWNjZXNzUmF0ZXMsXG4gICAgICB0cmVuZGluZ0RhdGEsXG4gICAgICBwcm9qZWN0ZWRDb21wbGV0aW9uOiB0aGlzLmNhbGN1bGF0ZVByb2plY3RlZENvbXBsZXRpb24odHJlbmRpbmdEYXRhKSxcbiAgICAgIHJlY29tbWVuZGF0aW9uczogYXdhaXQgdGhpcy5nZW5lcmF0ZVN1Y2Nlc3NSYXRlUmVjb21tZW5kYXRpb25zKGNhdGVnb3J5U3VjY2Vzc1JhdGVzKSxcbiAgICAgIGFuYWx5c2lzRGF0ZTogbmV3IERhdGUoKVxuICAgIH07XG5cbiAgICBjb25zb2xlLmxvZyhgU3VjY2VzcyByYXRlIGFuYWx5c2lzIGNvbXBsZXRlOiAke2N1cnJlbnRNZXRyaWNzLm92ZXJhbGxTdWNjZXNzUmF0ZS50b0ZpeGVkKDEpfSUgY3VycmVudCBzdWNjZXNzIHJhdGVgKTtcbiAgICByZXR1cm4gYW5hbHlzaXM7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIHJlY29tbWVuZGF0aW9ucyBmb3IgbWFudWFsIHJldmlldyBjYXNlc1xuICAgKi9cbiAgYXN5bmMgZ2VuZXJhdGVNYW51YWxSZXZpZXdSZWNvbW1lbmRhdGlvbnMoKTogUHJvbWlzZTxNYW51YWxSZXZpZXdSZWNvbW1lbmRhdGlvbltdPiB7XG4gICAgY29uc29sZS5sb2coJ0dlbmVyYXRpbmcgbWFudWFsIHJldmlldyByZWNvbW1lbmRhdGlvbnMuLi4nKTtcblxuICAgIGNvbnN0IGFueVR5cGVPY2N1cnJlbmNlcyA9IGF3YWl0IHRoaXMuZmluZEFsbEFueVR5cGVzKCk7XG4gICAgY29uc3QgcmVjb21tZW5kYXRpb25zOiBNYW51YWxSZXZpZXdSZWNvbW1lbmRhdGlvbltdID0gW107XG5cbiAgICBmb3IgKGNvbnN0IG9jY3VycmVuY2Ugb2YgYW55VHlwZU9jY3VycmVuY2VzKSB7XG4gICAgICBjb25zdCBjb250ZXh0ID0gYXdhaXQgdGhpcy5jcmVhdGVDbGFzc2lmaWNhdGlvbkNvbnRleHQob2NjdXJyZW5jZSk7XG4gICAgICBjb25zdCBjbGFzc2lmaWNhdGlvbiA9IGF3YWl0IHRoaXMuY2xhc3NpZmllci5jbGFzc2lmeShjb250ZXh0KTtcblxuICAgICAgLy8gSWRlbnRpZnkgY2FzZXMgdGhhdCBuZWVkIG1hbnVhbCByZXZpZXdcbiAgICAgIGlmICh0aGlzLnJlcXVpcmVzTWFudWFsUmV2aWV3KGNsYXNzaWZpY2F0aW9uLCBjb250ZXh0KSkge1xuICAgICAgICBjb25zdCByZWNvbW1lbmRhdGlvbjogTWFudWFsUmV2aWV3UmVjb21tZW5kYXRpb24gPSB7XG4gICAgICAgICAgZmlsZVBhdGg6IG9jY3VycmVuY2UuZmlsZVBhdGgsXG4gICAgICAgICAgbGluZU51bWJlcjogb2NjdXJyZW5jZS5saW5lTnVtYmVyLFxuICAgICAgICAgIGNvZGVTbmlwcGV0OiBvY2N1cnJlbmNlLmNvZGVTbmlwcGV0LFxuICAgICAgICAgIGNsYXNzaWZpY2F0aW9uLFxuICAgICAgICAgIHJldmlld1JlYXNvbjogdGhpcy5nZXRSZXZpZXdSZWFzb24oY2xhc3NpZmljYXRpb24sIGNvbnRleHQpLFxuICAgICAgICAgIHByaW9yaXR5OiB0aGlzLmNhbGN1bGF0ZVJldmlld1ByaW9yaXR5KGNsYXNzaWZpY2F0aW9uLCBjb250ZXh0KSxcbiAgICAgICAgICBzdWdnZXN0ZWRBY3Rpb25zOiBhd2FpdCB0aGlzLmdlbmVyYXRlU3VnZ2VzdGVkQWN0aW9ucyhjbGFzc2lmaWNhdGlvbiwgY29udGV4dCksXG4gICAgICAgICAgZXN0aW1hdGVkRWZmb3J0OiB0aGlzLmVzdGltYXRlUmV2aWV3RWZmb3J0KGNsYXNzaWZpY2F0aW9uLCBjb250ZXh0KSxcbiAgICAgICAgICByZWxhdGVkT2NjdXJyZW5jZXM6IGF3YWl0IHRoaXMuZmluZFJlbGF0ZWRPY2N1cnJlbmNlcyhvY2N1cnJlbmNlKVxuICAgICAgICB9O1xuXG4gICAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKHJlY29tbWVuZGF0aW9uKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBTb3J0IGJ5IHByaW9yaXR5IChoaWdoIHRvIGxvdylcbiAgICByZWNvbW1lbmRhdGlvbnMuc29ydCgoYSwgYikgPT4ge1xuICAgICAgY29uc3QgcHJpb3JpdHlPcmRlciA9IHsgaGlnaDogMywgbWVkaXVtOiAyLCBsb3c6IDEgfTtcbiAgICAgIHJldHVybiBwcmlvcml0eU9yZGVyW2IucHJpb3JpdHldIC0gcHJpb3JpdHlPcmRlclthLnByaW9yaXR5XTtcbiAgICB9KTtcblxuICAgIGNvbnNvbGUubG9nKGBNYW51YWwgcmV2aWV3IHJlY29tbWVuZGF0aW9ucyBjb21wbGV0ZTogJHtyZWNvbW1lbmRhdGlvbnMubGVuZ3RofSBjYXNlcyBpZGVudGlmaWVkYCk7XG4gICAgcmV0dXJuIHJlY29tbWVuZGF0aW9ucztcbiAgfVxuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZSBjb21wcmVoZW5zaXZlIGFuYWx5c2lzIHJlcG9ydFxuICAgKi9cbiAgYXN5bmMgZ2VuZXJhdGVDb21wcmVoZW5zaXZlUmVwb3J0KCk6IFByb21pc2U8QW5hbHlzaXNSZXBvcnQ+IHtcbiAgICBjb25zb2xlLmxvZygnR2VuZXJhdGluZyBjb21wcmVoZW5zaXZlIGFuYWx5c2lzIHJlcG9ydC4uLicpO1xuXG4gICAgY29uc3QgW1xuICAgICAgZG9tYWluRGlzdHJpYnV0aW9uLFxuICAgICAgYWNjdXJhY3lSZXBvcnQsXG4gICAgICBzdWNjZXNzUmF0ZUFuYWx5c2lzLFxuICAgICAgbWFudWFsUmV2aWV3UmVjb21tZW5kYXRpb25zXG4gICAgXSA9IGF3YWl0IFByb21pc2UuYWxsKFtcbiAgICAgIHRoaXMuYW5hbHl6ZURvbWFpbkRpc3RyaWJ1dGlvbigpLFxuICAgICAgdGhpcy5nZW5lcmF0ZUNsYXNzaWZpY2F0aW9uQWNjdXJhY3lSZXBvcnQoKSxcbiAgICAgIHRoaXMuZ2VuZXJhdGVTdWNjZXNzUmF0ZUFuYWx5c2lzKCksXG4gICAgICB0aGlzLmdlbmVyYXRlTWFudWFsUmV2aWV3UmVjb21tZW5kYXRpb25zKClcbiAgICBdKTtcblxuICAgIGNvbnN0IHJlcG9ydDogQW5hbHlzaXNSZXBvcnQgPSB7XG4gICAgICBpZDogYGFuYWx5c2lzLSR7RGF0ZS5ub3coKX1gLFxuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuICAgICAgZG9tYWluRGlzdHJpYnV0aW9uLFxuICAgICAgYWNjdXJhY3lSZXBvcnQsXG4gICAgICBzdWNjZXNzUmF0ZUFuYWx5c2lzLFxuICAgICAgbWFudWFsUmV2aWV3UmVjb21tZW5kYXRpb25zLFxuICAgICAgc3VtbWFyeToge1xuICAgICAgICB0b3RhbEFueVR5cGVzOiBkb21haW5EaXN0cmlidXRpb24udG90YWxBbnlUeXBlcyxcbiAgICAgICAgdW5pbnRlbnRpb25hbENvdW50OiBkb21haW5EaXN0cmlidXRpb24uaW50ZW50aW9uYWxWc1VuaW50ZW50aW9uYWwudW5pbnRlbnRpb25hbC5jb3VudCxcbiAgICAgICAgY2xhc3NpZmljYXRpb25BY2N1cmFjeTogYWNjdXJhY3lSZXBvcnQub3ZlcmFsbEFjY3VyYWN5LFxuICAgICAgICBjdXJyZW50U3VjY2Vzc1JhdGU6IHN1Y2Nlc3NSYXRlQW5hbHlzaXMuY3VycmVudFN1Y2Nlc3NSYXRlLFxuICAgICAgICBtYW51YWxSZXZpZXdDYXNlczogbWFudWFsUmV2aWV3UmVjb21tZW5kYXRpb25zLmxlbmd0aCxcbiAgICAgICAgdG9wRG9tYWluOiB0aGlzLmdldFRvcERvbWFpbihkb21haW5EaXN0cmlidXRpb24pLFxuICAgICAgICB0b3BDYXRlZ29yeTogdGhpcy5nZXRUb3BDYXRlZ29yeShkb21haW5EaXN0cmlidXRpb24pXG4gICAgICB9XG4gICAgfTtcblxuICAgIC8vIFNhdmUgcmVwb3J0IHRvIGhpc3RvcnlcbiAgICB0aGlzLmFuYWx5c2lzSGlzdG9yeS5wdXNoKHJlcG9ydCk7XG4gICAgYXdhaXQgdGhpcy5zYXZlQW5hbHlzaXNIaXN0b3J5KCk7XG5cbiAgICBjb25zb2xlLmxvZygnQ29tcHJlaGVuc2l2ZSBhbmFseXNpcyByZXBvcnQgZ2VuZXJhdGVkIHN1Y2Nlc3NmdWxseScpO1xuICAgIHJldHVybiByZXBvcnQ7XG4gIH1cblxuICAvLyBQcml2YXRlIGhlbHBlciBtZXRob2RzXG5cbiAgcHJpdmF0ZSBhc3luYyBmaW5kQWxsQW55VHlwZXMoKTogUHJvbWlzZTxBcnJheTx7IGZpbGVQYXRoOiBzdHJpbmc7IGxpbmVOdW1iZXI6IG51bWJlcjsgY29kZVNuaXBwZXQ6IHN0cmluZyB9Pj4ge1xuICAgIGNvbnN0IG9jY3VycmVuY2VzOiBBcnJheTx7IGZpbGVQYXRoOiBzdHJpbmc7IGxpbmVOdW1iZXI6IG51bWJlcjsgY29kZVNuaXBwZXQ6IHN0cmluZyB9PiA9IFtdO1xuXG4gICAgdHJ5IHtcbiAgICAgIC8vIFVzZSBncmVwIHRvIGZpbmQgYWxsIGV4cGxpY2l0IGFueSB0eXBlc1xuICAgICAgY29uc3QgZ3JlcENvbW1hbmQgPSBgZ3JlcCAtcm4gXCJcXFxcYmFueVxcXFxiXCIgc3JjIC0taW5jbHVkZT1cIioudHNcIiAtLWluY2x1ZGU9XCIqLnRzeFwiIHwgaGVhZCAtMTAwMGA7XG4gICAgICBjb25zdCBvdXRwdXQgPSBleGVjU3luYyhncmVwQ29tbWFuZCwgeyBlbmNvZGluZzogJ3V0ZjgnLCBzdGRpbzogJ3BpcGUnIH0pO1xuXG4gICAgICBjb25zdCBsaW5lcyA9IG91dHB1dC50cmltKCkuc3BsaXQoJ1xcbicpLmZpbHRlcihsaW5lID0+IGxpbmUudHJpbSgpKTtcblxuICAgICAgZm9yIChjb25zdCBsaW5lIG9mIGxpbmVzKSB7XG4gICAgICAgIGNvbnN0IG1hdGNoID0gbGluZS5tYXRjaCgvXihbXjpdKyk6KFxcZCspOiguKykkLyk7XG4gICAgICAgIGlmIChtYXRjaCkge1xuICAgICAgICAgIGNvbnN0IFssIGZpbGVQYXRoLCBsaW5lTnVtYmVyLCBjb2RlU25pcHBldF0gPSBtYXRjaDtcbiAgICAgICAgICBvY2N1cnJlbmNlcy5wdXNoKHtcbiAgICAgICAgICAgIGZpbGVQYXRoOiBmaWxlUGF0aC50cmltKCksXG4gICAgICAgICAgICBsaW5lTnVtYmVyOiBwYXJzZUludChsaW5lTnVtYmVyKSxcbiAgICAgICAgICAgIGNvZGVTbmlwcGV0OiBjb2RlU25pcHBldC50cmltKClcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLndhcm4oJ0Vycm9yIGZpbmRpbmcgYW55IHR5cGVzOicsIGVycm9yKTtcbiAgICB9XG5cbiAgICByZXR1cm4gb2NjdXJyZW5jZXM7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGNyZWF0ZUNsYXNzaWZpY2F0aW9uQ29udGV4dChvY2N1cnJlbmNlOiB7IGZpbGVQYXRoOiBzdHJpbmc7IGxpbmVOdW1iZXI6IG51bWJlcjsgY29kZVNuaXBwZXQ6IHN0cmluZyB9KTogUHJvbWlzZTxDbGFzc2lmaWNhdGlvbkNvbnRleHQ+IHtcbiAgICBjb25zdCBzdXJyb3VuZGluZ0xpbmVzID0gYXdhaXQgdGhpcy5nZXRTdXJyb3VuZGluZ0xpbmVzKG9jY3VycmVuY2UuZmlsZVBhdGgsIG9jY3VycmVuY2UubGluZU51bWJlcik7XG4gICAgY29uc3QgaGFzRXhpc3RpbmdDb21tZW50ID0gdGhpcy5oYXNFeGlzdGluZ0NvbW1lbnQoc3Vycm91bmRpbmdMaW5lcyk7XG4gICAgY29uc3QgZG9tYWluQ29udGV4dCA9IGF3YWl0IHRoaXMuZG9tYWluQW5hbHl6ZXIuYW5hbHl6ZURvbWFpbih7XG4gICAgICBmaWxlUGF0aDogb2NjdXJyZW5jZS5maWxlUGF0aCxcbiAgICAgIGxpbmVOdW1iZXI6IG9jY3VycmVuY2UubGluZU51bWJlcixcbiAgICAgIGNvZGVTbmlwcGV0OiBvY2N1cnJlbmNlLmNvZGVTbmlwcGV0LFxuICAgICAgc3Vycm91bmRpbmdMaW5lcyxcbiAgICAgIGhhc0V4aXN0aW5nQ29tbWVudCxcbiAgICAgIGlzSW5UZXN0RmlsZTogb2NjdXJyZW5jZS5maWxlUGF0aC5pbmNsdWRlcygnLnRlc3QuJykgfHwgb2NjdXJyZW5jZS5maWxlUGF0aC5pbmNsdWRlcygnX190ZXN0c19fJyksXG4gICAgICBkb21haW5Db250ZXh0OiB7IGRvbWFpbjogQ29kZURvbWFpbi5VVElMSVRZLCBpbnRlbnRpb25hbGl0eUhpbnRzOiBbXSwgc3VnZ2VzdGVkVHlwZXM6IFtdLCBwcmVzZXJ2YXRpb25SZWFzb25zOiBbXSB9XG4gICAgfSk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgZmlsZVBhdGg6IG9jY3VycmVuY2UuZmlsZVBhdGgsXG4gICAgICBsaW5lTnVtYmVyOiBvY2N1cnJlbmNlLmxpbmVOdW1iZXIsXG4gICAgICBjb2RlU25pcHBldDogb2NjdXJyZW5jZS5jb2RlU25pcHBldCxcbiAgICAgIHN1cnJvdW5kaW5nTGluZXMsXG4gICAgICBoYXNFeGlzdGluZ0NvbW1lbnQsXG4gICAgICBleGlzdGluZ0NvbW1lbnQ6IGhhc0V4aXN0aW5nQ29tbWVudCA/IHRoaXMuZXh0cmFjdENvbW1lbnQoc3Vycm91bmRpbmdMaW5lcykgOiB1bmRlZmluZWQsXG4gICAgICBpc0luVGVzdEZpbGU6IG9jY3VycmVuY2UuZmlsZVBhdGguaW5jbHVkZXMoJy50ZXN0LicpIHx8IG9jY3VycmVuY2UuZmlsZVBhdGguaW5jbHVkZXMoJ19fdGVzdHNfXycpLFxuICAgICAgZG9tYWluQ29udGV4dFxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGdldFN1cnJvdW5kaW5nTGluZXMoZmlsZVBhdGg6IHN0cmluZywgbGluZU51bWJlcjogbnVtYmVyKTogUHJvbWlzZTxzdHJpbmdbXT4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBjb250ZW50ID0gZnMucmVhZEZpbGVTeW5jKGZpbGVQYXRoLCAndXRmOCcpO1xuICAgICAgY29uc3QgbGluZXMgPSBjb250ZW50LnNwbGl0KCdcXG4nKTtcbiAgICAgIGNvbnN0IHN0YXJ0ID0gTWF0aC5tYXgoMCwgbGluZU51bWJlciAtIDMpO1xuICAgICAgY29uc3QgZW5kID0gTWF0aC5taW4obGluZXMubGVuZ3RoLCBsaW5lTnVtYmVyICsgMik7XG4gICAgICByZXR1cm4gbGluZXMuc2xpY2Uoc3RhcnQsIGVuZCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGhhc0V4aXN0aW5nQ29tbWVudChzdXJyb3VuZGluZ0xpbmVzOiBzdHJpbmdbXSk6IGJvb2xlYW4ge1xuICAgIHJldHVybiBzdXJyb3VuZGluZ0xpbmVzLnNvbWUobGluZSA9PlxuICAgICAgbGluZS50cmltKCkuc3RhcnRzV2l0aCgnLy8nKSB8fFxuICAgICAgbGluZS50cmltKCkuc3RhcnRzV2l0aCgnLyonKSB8fFxuICAgICAgbGluZS50cmltKCkuc3RhcnRzV2l0aCgnKicpXG4gICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgZXh0cmFjdENvbW1lbnQoc3Vycm91bmRpbmdMaW5lczogc3RyaW5nW10pOiBzdHJpbmcge1xuICAgIGNvbnN0IGNvbW1lbnRMaW5lcyA9IHN1cnJvdW5kaW5nTGluZXMuZmlsdGVyKGxpbmUgPT5cbiAgICAgIGxpbmUudHJpbSgpLnN0YXJ0c1dpdGgoJy8vJykgfHxcbiAgICAgIGxpbmUudHJpbSgpLnN0YXJ0c1dpdGgoJy8qJykgfHxcbiAgICAgIGxpbmUudHJpbSgpLnN0YXJ0c1dpdGgoJyonKVxuICAgICk7XG4gICAgcmV0dXJuIGNvbW1lbnRMaW5lcy5qb2luKCcgJykudHJpbSgpO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyB2YWxpZGF0ZUNsYXNzaWZpY2F0aW9uQWNjdXJhY3koY29udGV4dDogQ2xhc3NpZmljYXRpb25Db250ZXh0LCBjbGFzc2lmaWNhdGlvbjogQW55VHlwZUNsYXNzaWZpY2F0aW9uKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgLy8gSGV1cmlzdGljIHZhbGlkYXRpb24gYmFzZWQgb24gY29udGV4dFxuXG4gICAgLy8gRXJyb3IgaGFuZGxpbmcgc2hvdWxkIGJlIGluIGNhdGNoIGJsb2Nrc1xuICAgIGlmIChjbGFzc2lmaWNhdGlvbi5jYXRlZ29yeSA9PT0gQW55VHlwZUNhdGVnb3J5LkVSUk9SX0hBTkRMSU5HKSB7XG4gICAgICByZXR1cm4gY29udGV4dC5jb2RlU25pcHBldC5pbmNsdWRlcygnY2F0Y2gnKSB8fCBjb250ZXh0LmNvZGVTbmlwcGV0LmluY2x1ZGVzKCdlcnJvcicpO1xuICAgIH1cblxuICAgIC8vIFRlc3QgbW9ja3Mgc2hvdWxkIGJlIGluIHRlc3QgZmlsZXNcbiAgICBpZiAoY2xhc3NpZmljYXRpb24uY2F0ZWdvcnkgPT09IEFueVR5cGVDYXRlZ29yeS5URVNUX01PQ0spIHtcbiAgICAgIHJldHVybiBjb250ZXh0LmlzSW5UZXN0RmlsZTtcbiAgICB9XG5cbiAgICAvLyBBcnJheSB0eXBlcyBzaG91bGQgY29udGFpbiBhcnJheSBzeW50YXhcbiAgICBpZiAoY2xhc3NpZmljYXRpb24uY2F0ZWdvcnkgPT09IEFueVR5cGVDYXRlZ29yeS5BUlJBWV9UWVBFKSB7XG4gICAgICByZXR1cm4gY29udGV4dC5jb2RlU25pcHBldC5pbmNsdWRlcygnYW55W10nKSB8fCBjb250ZXh0LmNvZGVTbmlwcGV0LmluY2x1ZGVzKCdBcnJheTxhbnk+Jyk7XG4gICAgfVxuXG4gICAgLy8gUmVjb3JkIHR5cGVzIHNob3VsZCBjb250YWluIFJlY29yZCBzeW50YXhcbiAgICBpZiAoY2xhc3NpZmljYXRpb24uY2F0ZWdvcnkgPT09IEFueVR5cGVDYXRlZ29yeS5SRUNPUkRfVFlQRSkge1xuICAgICAgcmV0dXJuIGNvbnRleHQuY29kZVNuaXBwZXQuaW5jbHVkZXMoJ1JlY29yZDwnKSAmJiBjb250ZXh0LmNvZGVTbmlwcGV0LmluY2x1ZGVzKCdhbnknKTtcbiAgICB9XG5cbiAgICAvLyBEZWZhdWx0IHRvIGFjY3VyYXRlIGZvciBvdGhlciBjYXRlZ29yaWVzXG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBwcml2YXRlIGNhbGN1bGF0ZUNvbmZpZGVuY2VEaXN0cmlidXRpb24oc2NvcmVzOiBudW1iZXJbXSk6IHsgcmFuZ2U6IHN0cmluZzsgY291bnQ6IG51bWJlcjsgcGVyY2VudGFnZTogbnVtYmVyIH1bXSB7XG4gICAgY29uc3QgcmFuZ2VzID0gW1xuICAgICAgeyBtaW46IDAuOSwgbWF4OiAxLjAsIGxhYmVsOiAnOTAtMTAwJScgfSxcbiAgICAgIHsgbWluOiAwLjgsIG1heDogMC45LCBsYWJlbDogJzgwLTkwJScgfSxcbiAgICAgIHsgbWluOiAwLjcsIG1heDogMC44LCBsYWJlbDogJzcwLTgwJScgfSxcbiAgICAgIHsgbWluOiAwLjYsIG1heDogMC43LCBsYWJlbDogJzYwLTcwJScgfSxcbiAgICAgIHsgbWluOiAwLjAsIG1heDogMC42LCBsYWJlbDogJzAtNjAlJyB9XG4gICAgXTtcblxuICAgIHJldHVybiByYW5nZXMubWFwKHJhbmdlID0+IHtcbiAgICAgIGNvbnN0IGNvdW50ID0gc2NvcmVzLmZpbHRlcihzY29yZSA9PiBzY29yZSA+PSByYW5nZS5taW4gJiYgc2NvcmUgPCByYW5nZS5tYXgpLmxlbmd0aDtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHJhbmdlOiByYW5nZS5sYWJlbCxcbiAgICAgICAgY291bnQsXG4gICAgICAgIHBlcmNlbnRhZ2U6IHNjb3Jlcy5sZW5ndGggPiAwID8gKGNvdW50IC8gc2NvcmVzLmxlbmd0aCkgKiAxMDAgOiAwXG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBnZXRDdXJyZW50TWV0cmljcygpOiBQcm9taXNlPEFuYWx5c2lzTWV0cmljcz4ge1xuICAgIC8vIFNpbXVsYXRlIGN1cnJlbnQgbWV0cmljcyAtIGluIHJlYWwgaW1wbGVtZW50YXRpb24sIHRoaXMgd291bGQgZmV0Y2ggZnJvbSBhY3R1YWwgZGF0YVxuICAgIHJldHVybiB7XG4gICAgICBvdmVyYWxsU3VjY2Vzc1JhdGU6IDc4LjUsXG4gICAgICB0b3RhbFByb2Nlc3NlZDogMTI1MCxcbiAgICAgIHN1Y2Nlc3NmdWxSZXBsYWNlbWVudHM6IDk4MixcbiAgICAgIGZhaWxlZFJlcGxhY2VtZW50czogMjY4LFxuICAgICAgYXZlcmFnZUNvbmZpZGVuY2U6IDAuODJcbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRIaXN0b3JpY2FsVHJlbmRpbmdEYXRhKCk6IFRyZW5kaW5nRGF0YVtdIHtcbiAgICAvLyBSZXR1cm4gbGFzdCAzMCBkYXlzIG9mIHRyZW5kaW5nIGRhdGEgZnJvbSBoaXN0b3J5XG4gICAgY29uc3QgdGhpcnR5RGF5c0FnbyA9IG5ldyBEYXRlKCk7XG4gICAgdGhpcnR5RGF5c0Fnby5zZXREYXRlKHRoaXJ0eURheXNBZ28uZ2V0RGF0ZSgpIC0gMzApO1xuXG4gICAgcmV0dXJuIHRoaXMuYW5hbHlzaXNIaXN0b3J5XG4gICAgICAuZmlsdGVyKHJlcG9ydCA9PiByZXBvcnQudGltZXN0YW1wID49IHRoaXJ0eURheXNBZ28pXG4gICAgICAubWFwKHJlcG9ydCA9PiAoe1xuICAgICAgICBkYXRlOiByZXBvcnQudGltZXN0YW1wLFxuICAgICAgICBzdWNjZXNzUmF0ZTogcmVwb3J0LnN1Y2Nlc3NSYXRlQW5hbHlzaXMuY3VycmVudFN1Y2Nlc3NSYXRlLFxuICAgICAgICB0b3RhbEFueVR5cGVzOiByZXBvcnQuZG9tYWluRGlzdHJpYnV0aW9uLnRvdGFsQW55VHlwZXMsXG4gICAgICAgIHVuaW50ZW50aW9uYWxDb3VudDogcmVwb3J0LmRvbWFpbkRpc3RyaWJ1dGlvbi5pbnRlbnRpb25hbFZzVW5pbnRlbnRpb25hbC51bmludGVudGlvbmFsLmNvdW50LFxuICAgICAgICBjbGFzc2lmaWNhdGlvbkFjY3VyYWN5OiByZXBvcnQuYWNjdXJhY3lSZXBvcnQub3ZlcmFsbEFjY3VyYWN5XG4gICAgICB9KSk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGNhbGN1bGF0ZUNhdGVnb3J5U3VjY2Vzc1JhdGVzKCk6IFByb21pc2U8QXJyYXk8eyBjYXRlZ29yeTogQW55VHlwZUNhdGVnb3J5OyBzdWNjZXNzUmF0ZTogbnVtYmVyOyBzYW1wbGVTaXplOiBudW1iZXIgfT4+IHtcbiAgICAvLyBTaW11bGF0ZSBjYXRlZ29yeSBzdWNjZXNzIHJhdGVzIC0gaW4gcmVhbCBpbXBsZW1lbnRhdGlvbiwgdGhpcyB3b3VsZCBjYWxjdWxhdGUgZnJvbSBhY3R1YWwgZGF0YVxuICAgIHJldHVybiBbXG4gICAgICB7IGNhdGVnb3J5OiBBbnlUeXBlQ2F0ZWdvcnkuQVJSQVlfVFlQRSwgc3VjY2Vzc1JhdGU6IDk1LjIsIHNhbXBsZVNpemU6IDE1NiB9LFxuICAgICAgeyBjYXRlZ29yeTogQW55VHlwZUNhdGVnb3J5LlJFQ09SRF9UWVBFLCBzdWNjZXNzUmF0ZTogODcuMywgc2FtcGxlU2l6ZTogMjAzIH0sXG4gICAgICB7IGNhdGVnb3J5OiBBbnlUeXBlQ2F0ZWdvcnkuRlVOQ1RJT05fUEFSQU0sIHN1Y2Nlc3NSYXRlOiA2NS44LCBzYW1wbGVTaXplOiAzNDIgfSxcbiAgICAgIHsgY2F0ZWdvcnk6IEFueVR5cGVDYXRlZ29yeS5SRVRVUk5fVFlQRSwgc3VjY2Vzc1JhdGU6IDcyLjEsIHNhbXBsZVNpemU6IDE4OSB9LFxuICAgICAgeyBjYXRlZ29yeTogQW55VHlwZUNhdGVnb3J5LlRZUEVfQVNTRVJUSU9OLCBzdWNjZXNzUmF0ZTogODEuNCwgc2FtcGxlU2l6ZTogMTI3IH0sXG4gICAgICB7IGNhdGVnb3J5OiBBbnlUeXBlQ2F0ZWdvcnkuRVJST1JfSEFORExJTkcsIHN1Y2Nlc3NSYXRlOiA0NS42LCBzYW1wbGVTaXplOiA5OCB9LFxuICAgICAgeyBjYXRlZ29yeTogQW55VHlwZUNhdGVnb3J5LkVYVEVSTkFMX0FQSSwgc3VjY2Vzc1JhdGU6IDUyLjMsIHNhbXBsZVNpemU6IDc2IH0sXG4gICAgICB7IGNhdGVnb3J5OiBBbnlUeXBlQ2F0ZWdvcnkuVEVTVF9NT0NLLCBzdWNjZXNzUmF0ZTogODkuNywgc2FtcGxlU2l6ZTogMTM0IH0sXG4gICAgICB7IGNhdGVnb3J5OiBBbnlUeXBlQ2F0ZWdvcnkuRFlOQU1JQ19DT05GSUcsIHN1Y2Nlc3NSYXRlOiAzOC45LCBzYW1wbGVTaXplOiA2NyB9LFxuICAgICAgeyBjYXRlZ29yeTogQW55VHlwZUNhdGVnb3J5LkxFR0FDWV9DT01QQVRJQklMSVRZLCBzdWNjZXNzUmF0ZTogNDEuMiwgc2FtcGxlU2l6ZTogNDUgfVxuICAgIF07XG4gIH1cblxuICBwcml2YXRlIGNhbGN1bGF0ZVRyZW5kaW5nTWV0cmljcyhoaXN0b3JpY2FsRGF0YTogVHJlbmRpbmdEYXRhW10pOiBUcmVuZGluZ0RhdGEge1xuICAgIGlmIChoaXN0b3JpY2FsRGF0YS5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGRhdGU6IG5ldyBEYXRlKCksXG4gICAgICAgIHN1Y2Nlc3NSYXRlOiAwLFxuICAgICAgICB0b3RhbEFueVR5cGVzOiAwLFxuICAgICAgICB1bmludGVudGlvbmFsQ291bnQ6IDAsXG4gICAgICAgIGNsYXNzaWZpY2F0aW9uQWNjdXJhY3k6IDBcbiAgICAgIH07XG4gICAgfVxuXG4gICAgY29uc3QgbGF0ZXN0ID0gaGlzdG9yaWNhbERhdGFbaGlzdG9yaWNhbERhdGEubGVuZ3RoIC0gMV07XG4gICAgY29uc3QgcHJldmlvdXMgPSBoaXN0b3JpY2FsRGF0YS5sZW5ndGggPiAxID8gaGlzdG9yaWNhbERhdGFbaGlzdG9yaWNhbERhdGEubGVuZ3RoIC0gMl0gOiBsYXRlc3Q7XG5cbiAgICByZXR1cm4ge1xuICAgICAgZGF0ZTogbGF0ZXN0LmRhdGUsXG4gICAgICBzdWNjZXNzUmF0ZTogbGF0ZXN0LnN1Y2Nlc3NSYXRlLFxuICAgICAgdG90YWxBbnlUeXBlczogbGF0ZXN0LnRvdGFsQW55VHlwZXMsXG4gICAgICB1bmludGVudGlvbmFsQ291bnQ6IGxhdGVzdC51bmludGVudGlvbmFsQ291bnQsXG4gICAgICBjbGFzc2lmaWNhdGlvbkFjY3VyYWN5OiBsYXRlc3QuY2xhc3NpZmljYXRpb25BY2N1cmFjeSxcbiAgICAgIHRyZW5kczoge1xuICAgICAgICBzdWNjZXNzUmF0ZUNoYW5nZTogbGF0ZXN0LnN1Y2Nlc3NSYXRlIC0gcHJldmlvdXMuc3VjY2Vzc1JhdGUsXG4gICAgICAgIHRvdGFsQW55VHlwZXNDaGFuZ2U6IGxhdGVzdC50b3RhbEFueVR5cGVzIC0gcHJldmlvdXMudG90YWxBbnlUeXBlcyxcbiAgICAgICAgdW5pbnRlbnRpb25hbENvdW50Q2hhbmdlOiBsYXRlc3QudW5pbnRlbnRpb25hbENvdW50IC0gcHJldmlvdXMudW5pbnRlbnRpb25hbENvdW50LFxuICAgICAgICBjbGFzc2lmaWNhdGlvbkFjY3VyYWN5Q2hhbmdlOiBsYXRlc3QuY2xhc3NpZmljYXRpb25BY2N1cmFjeSAtIHByZXZpb3VzLmNsYXNzaWZpY2F0aW9uQWNjdXJhY3lcbiAgICAgIH1cbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBjYWxjdWxhdGVQcm9qZWN0ZWRDb21wbGV0aW9uKHRyZW5kaW5nRGF0YTogVHJlbmRpbmdEYXRhKTogRGF0ZSB7XG4gICAgLy8gU2ltcGxlIGxpbmVhciBwcm9qZWN0aW9uIGJhc2VkIG9uIGN1cnJlbnQgdHJlbmRcbiAgICBjb25zdCBjdXJyZW50UmF0ZSA9IHRyZW5kaW5nRGF0YS5zdWNjZXNzUmF0ZTtcbiAgICBjb25zdCB0YXJnZXRSYXRlID0gODU7XG4gICAgY29uc3QgcmF0ZUNoYW5nZSA9IHRyZW5kaW5nRGF0YS50cmVuZHM/LnN1Y2Nlc3NSYXRlQ2hhbmdlIHx8IDAuNTsgLy8gRGVmYXVsdCAwLjUlIGltcHJvdmVtZW50IHBlciBhbmFseXNpc1xuXG4gICAgaWYgKHJhdGVDaGFuZ2UgPD0gMCB8fCBjdXJyZW50UmF0ZSA+PSB0YXJnZXRSYXRlKSB7XG4gICAgICBjb25zdCBmdXR1cmVEYXRlID0gbmV3IERhdGUoKTtcbiAgICAgIGZ1dHVyZURhdGUuc2V0RGF0ZShmdXR1cmVEYXRlLmdldERhdGUoKSArIDMwKTsgLy8gRGVmYXVsdCAzMCBkYXlzIGlmIG5vIGltcHJvdmVtZW50XG4gICAgICByZXR1cm4gZnV0dXJlRGF0ZTtcbiAgICB9XG5cbiAgICBjb25zdCBkYXlzTmVlZGVkID0gTWF0aC5jZWlsKCh0YXJnZXRSYXRlIC0gY3VycmVudFJhdGUpIC8gcmF0ZUNoYW5nZSk7XG4gICAgY29uc3QgcHJvamVjdGVkRGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgcHJvamVjdGVkRGF0ZS5zZXREYXRlKHByb2plY3RlZERhdGUuZ2V0RGF0ZSgpICsgZGF5c05lZWRlZCk7XG5cbiAgICByZXR1cm4gcHJvamVjdGVkRGF0ZTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZ2VuZXJhdGVTdWNjZXNzUmF0ZVJlY29tbWVuZGF0aW9ucyhjYXRlZ29yeVN1Y2Nlc3NSYXRlczogQXJyYXk8eyBjYXRlZ29yeTogQW55VHlwZUNhdGVnb3J5OyBzdWNjZXNzUmF0ZTogbnVtYmVyOyBzYW1wbGVTaXplOiBudW1iZXIgfT4pOiBQcm9taXNlPHN0cmluZ1tdPiB7XG4gICAgY29uc3QgcmVjb21tZW5kYXRpb25zOiBzdHJpbmdbXSA9IFtdO1xuXG4gICAgLy8gRmluZCBjYXRlZ29yaWVzIHdpdGggbG93IHN1Y2Nlc3MgcmF0ZXNcbiAgICBjb25zdCBsb3dTdWNjZXNzQ2F0ZWdvcmllcyA9IGNhdGVnb3J5U3VjY2Vzc1JhdGVzLmZpbHRlcihjYXQgPT4gY2F0LnN1Y2Nlc3NSYXRlIDwgNzApO1xuXG4gICAgZm9yIChjb25zdCBjYXRlZ29yeSBvZiBsb3dTdWNjZXNzQ2F0ZWdvcmllcykge1xuICAgICAgc3dpdGNoIChjYXRlZ29yeS5jYXRlZ29yeSkge1xuICAgICAgICBjYXNlIEFueVR5cGVDYXRlZ29yeS5GVU5DVElPTl9QQVJBTTpcbiAgICAgICAgICByZWNvbW1lbmRhdGlvbnMucHVzaCgnRm9jdXMgb24gaW1wcm92aW5nIGZ1bmN0aW9uIHBhcmFtZXRlciB0eXBlIGluZmVyZW5jZSBhbGdvcml0aG1zJyk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgQW55VHlwZUNhdGVnb3J5LlJFVFVSTl9UWVBFOlxuICAgICAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKCdFbmhhbmNlIHJldHVybiB0eXBlIGFuYWx5c2lzIHdpdGggYmV0dGVyIGNvbnRleHQgdW5kZXJzdGFuZGluZycpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIEFueVR5cGVDYXRlZ29yeS5FUlJPUl9IQU5ETElORzpcbiAgICAgICAgICByZWNvbW1lbmRhdGlvbnMucHVzaCgnQ29uc2lkZXIgcHJlc2VydmluZyBlcnJvciBoYW5kbGluZyBhbnkgdHlwZXMgYXMgaW50ZW50aW9uYWwnKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSBBbnlUeXBlQ2F0ZWdvcnkuRVhURVJOQUxfQVBJOlxuICAgICAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKCdJbXByb3ZlIGV4dGVybmFsIEFQSSByZXNwb25zZSB0eXBlIGRldGVjdGlvbicpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIEFueVR5cGVDYXRlZ29yeS5EWU5BTUlDX0NPTkZJRzpcbiAgICAgICAgICByZWNvbW1lbmRhdGlvbnMucHVzaCgnUmV2aWV3IGR5bmFtaWMgY29uZmlndXJhdGlvbiBwYXR0ZXJucyBmb3IgYmV0dGVyIHR5cGUgc2FmZXR5Jyk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgQW55VHlwZUNhdGVnb3J5LkxFR0FDWV9DT01QQVRJQklMSVRZOlxuICAgICAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKCdFdmFsdWF0ZSBsZWdhY3kgY29tcGF0aWJpbGl0eSByZXF1aXJlbWVudHMgdnMgdHlwZSBzYWZldHkgYmVuZWZpdHMnKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBGaW5kIGNhdGVnb3JpZXMgd2l0aCBoaWdoIHN1Y2Nlc3MgcmF0ZXMgdG8gbGV2ZXJhZ2VcbiAgICBjb25zdCBoaWdoU3VjY2Vzc0NhdGVnb3JpZXMgPSBjYXRlZ29yeVN1Y2Nlc3NSYXRlcy5maWx0ZXIoY2F0ID0+IGNhdC5zdWNjZXNzUmF0ZSA+IDg1KTtcblxuICAgIGlmIChoaWdoU3VjY2Vzc0NhdGVnb3JpZXMubGVuZ3RoID4gMCkge1xuICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goYFByaW9yaXRpemUgJHtoaWdoU3VjY2Vzc0NhdGVnb3JpZXMubWFwKGNhdCA9PiBjYXQuY2F0ZWdvcnkpLmpvaW4oJywgJyl9IGNhdGVnb3JpZXMgZm9yIHF1aWNrIHdpbnNgKTtcbiAgICB9XG5cbiAgICByZXR1cm4gcmVjb21tZW5kYXRpb25zO1xuICB9XG5cbiAgcHJpdmF0ZSByZXF1aXJlc01hbnVhbFJldmlldyhjbGFzc2lmaWNhdGlvbjogQW55VHlwZUNsYXNzaWZpY2F0aW9uLCBjb250ZXh0OiBDbGFzc2lmaWNhdGlvbkNvbnRleHQpOiBib29sZWFuIHtcbiAgICAvLyBMb3cgY29uZmlkZW5jZSBjbGFzc2lmaWNhdGlvbnMgbmVlZCBtYW51YWwgcmV2aWV3XG4gICAgaWYgKGNsYXNzaWZpY2F0aW9uLmNvbmZpZGVuY2UgPCAwLjcpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cblxuICAgIC8vIENvbXBsZXggZG9tYWluIGNvbnRleHRzIG5lZWQgbWFudWFsIHJldmlld1xuICAgIGlmIChjb250ZXh0LmRvbWFpbkNvbnRleHQuaW50ZW50aW9uYWxpdHlIaW50cy5sZW5ndGggPiAyKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICAvLyBDb25mbGljdGluZyBzaWduYWxzIG5lZWQgbWFudWFsIHJldmlld1xuICAgIGlmIChjbGFzc2lmaWNhdGlvbi5pc0ludGVudGlvbmFsICYmIGNsYXNzaWZpY2F0aW9uLnN1Z2dlc3RlZFJlcGxhY2VtZW50KSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG5cbiAgICAvLyBIaWdoLXJpc2sgY2F0ZWdvcmllcyBuZWVkIG1hbnVhbCByZXZpZXdcbiAgICBjb25zdCBoaWdoUmlza0NhdGVnb3JpZXMgPSBbXG4gICAgICBBbnlUeXBlQ2F0ZWdvcnkuRVhURVJOQUxfQVBJLFxuICAgICAgQW55VHlwZUNhdGVnb3J5LkRZTkFNSUNfQ09ORklHLFxuICAgICAgQW55VHlwZUNhdGVnb3J5LkxFR0FDWV9DT01QQVRJQklMSVRZXG4gICAgXTtcblxuICAgIHJldHVybiBoaWdoUmlza0NhdGVnb3JpZXMuaW5jbHVkZXMoY2xhc3NpZmljYXRpb24uY2F0ZWdvcnkpO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRSZXZpZXdSZWFzb24oY2xhc3NpZmljYXRpb246IEFueVR5cGVDbGFzc2lmaWNhdGlvbiwgY29udGV4dDogQ2xhc3NpZmljYXRpb25Db250ZXh0KTogc3RyaW5nIHtcbiAgICBpZiAoY2xhc3NpZmljYXRpb24uY29uZmlkZW5jZSA8IDAuNykge1xuICAgICAgcmV0dXJuIGBMb3cgY2xhc3NpZmljYXRpb24gY29uZmlkZW5jZSAoJHsoY2xhc3NpZmljYXRpb24uY29uZmlkZW5jZSAqIDEwMCkudG9GaXhlZCgxKX0lKWA7XG4gICAgfVxuXG4gICAgaWYgKGNvbnRleHQuZG9tYWluQ29udGV4dC5pbnRlbnRpb25hbGl0eUhpbnRzLmxlbmd0aCA+IDIpIHtcbiAgICAgIHJldHVybiAnQ29tcGxleCBkb21haW4gY29udGV4dCB3aXRoIG11bHRpcGxlIGludGVudGlvbmFsaXR5IGhpbnRzJztcbiAgICB9XG5cbiAgICBpZiAoY2xhc3NpZmljYXRpb24uaXNJbnRlbnRpb25hbCAmJiBjbGFzc2lmaWNhdGlvbi5zdWdnZXN0ZWRSZXBsYWNlbWVudCkge1xuICAgICAgcmV0dXJuICdDb25mbGljdGluZyBzaWduYWxzOiBjbGFzc2lmaWVkIGFzIGludGVudGlvbmFsIGJ1dCBoYXMgc3VnZ2VzdGVkIHJlcGxhY2VtZW50JztcbiAgICB9XG5cbiAgICByZXR1cm4gYEhpZ2gtcmlzayBjYXRlZ29yeTogJHtjbGFzc2lmaWNhdGlvbi5jYXRlZ29yeX1gO1xuICB9XG5cbiAgcHJpdmF0ZSBjYWxjdWxhdGVSZXZpZXdQcmlvcml0eShjbGFzc2lmaWNhdGlvbjogQW55VHlwZUNsYXNzaWZpY2F0aW9uLCBjb250ZXh0OiBDbGFzc2lmaWNhdGlvbkNvbnRleHQpOiAnaGlnaCcgfCAnbWVkaXVtJyB8ICdsb3cnIHtcbiAgICAvLyBIaWdoIHByaW9yaXR5OiBMb3cgY29uZmlkZW5jZSBvciBjb25mbGljdGluZyBzaWduYWxzXG4gICAgaWYgKGNsYXNzaWZpY2F0aW9uLmNvbmZpZGVuY2UgPCAwLjYgfHwgKGNsYXNzaWZpY2F0aW9uLmlzSW50ZW50aW9uYWwgJiYgY2xhc3NpZmljYXRpb24uc3VnZ2VzdGVkUmVwbGFjZW1lbnQpKSB7XG4gICAgICByZXR1cm4gJ2hpZ2gnO1xuICAgIH1cblxuICAgIC8vIE1lZGl1bSBwcmlvcml0eTogTW9kZXJhdGUgY29uZmlkZW5jZSBvciBjb21wbGV4IGNvbnRleHRcbiAgICBpZiAoY2xhc3NpZmljYXRpb24uY29uZmlkZW5jZSA8IDAuOCB8fCBjb250ZXh0LmRvbWFpbkNvbnRleHQuaW50ZW50aW9uYWxpdHlIaW50cy5sZW5ndGggPiAxKSB7XG4gICAgICByZXR1cm4gJ21lZGl1bSc7XG4gICAgfVxuXG4gICAgLy8gTG93IHByaW9yaXR5OiBIaWdoIGNvbmZpZGVuY2UsIHNpbXBsZSBjYXNlc1xuICAgIHJldHVybiAnbG93JztcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZ2VuZXJhdGVTdWdnZXN0ZWRBY3Rpb25zKGNsYXNzaWZpY2F0aW9uOiBBbnlUeXBlQ2xhc3NpZmljYXRpb24sIGNvbnRleHQ6IENsYXNzaWZpY2F0aW9uQ29udGV4dCk6IFByb21pc2U8c3RyaW5nW10+IHtcbiAgICBjb25zdCBhY3Rpb25zOiBzdHJpbmdbXSA9IFtdO1xuXG4gICAgaWYgKGNsYXNzaWZpY2F0aW9uLmNvbmZpZGVuY2UgPCAwLjcpIHtcbiAgICAgIGFjdGlvbnMucHVzaCgnUmV2aWV3IGNsYXNzaWZpY2F0aW9uIGxvZ2ljIGFuZCBhZGQgbW9yZSBjb250ZXh0Jyk7XG4gICAgfVxuXG4gICAgaWYgKGNsYXNzaWZpY2F0aW9uLnN1Z2dlc3RlZFJlcGxhY2VtZW50KSB7XG4gICAgICBhY3Rpb25zLnB1c2goYENvbnNpZGVyIHJlcGxhY2luZyB3aXRoOiAke2NsYXNzaWZpY2F0aW9uLnN1Z2dlc3RlZFJlcGxhY2VtZW50fWApO1xuICAgIH1cblxuICAgIGlmICghY2xhc3NpZmljYXRpb24uaXNJbnRlbnRpb25hbCkge1xuICAgICAgYWN0aW9ucy5wdXNoKCdBdHRlbXB0IGF1dG9tYXRlZCByZXBsYWNlbWVudCB3aXRoIHNhZmV0eSB2YWxpZGF0aW9uJyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGFjdGlvbnMucHVzaCgnQWRkIGRvY3VtZW50YXRpb24gZXhwbGFpbmluZyB3aHkgYW55IHR5cGUgaXMgbmVjZXNzYXJ5Jyk7XG4gICAgfVxuXG4gICAgaWYgKGNvbnRleHQuZG9tYWluQ29udGV4dC5zdWdnZXN0ZWRUeXBlcy5sZW5ndGggPiAwKSB7XG4gICAgICBhY3Rpb25zLnB1c2goYENvbnNpZGVyIGRvbWFpbi1zcGVjaWZpYyB0eXBlczogJHtjb250ZXh0LmRvbWFpbkNvbnRleHQuc3VnZ2VzdGVkVHlwZXMuam9pbignLCAnKX1gKTtcbiAgICB9XG5cbiAgICByZXR1cm4gYWN0aW9ucztcbiAgfVxuXG4gIHByaXZhdGUgZXN0aW1hdGVSZXZpZXdFZmZvcnQoY2xhc3NpZmljYXRpb246IEFueVR5cGVDbGFzc2lmaWNhdGlvbiwgY29udGV4dDogQ2xhc3NpZmljYXRpb25Db250ZXh0KTogJ2xvdycgfCAnbWVkaXVtJyB8ICdoaWdoJyB7XG4gICAgLy8gSGlnaCBlZmZvcnQ6IENvbXBsZXggZG9tYWluIGNvbnRleHQgb3IgbG93IGNvbmZpZGVuY2VcbiAgICBpZiAoY2xhc3NpZmljYXRpb24uY29uZmlkZW5jZSA8IDAuNiB8fCBjb250ZXh0LmRvbWFpbkNvbnRleHQuaW50ZW50aW9uYWxpdHlIaW50cy5sZW5ndGggPiAyKSB7XG4gICAgICByZXR1cm4gJ2hpZ2gnO1xuICAgIH1cblxuICAgIC8vIE1lZGl1bSBlZmZvcnQ6IE1vZGVyYXRlIGNvbXBsZXhpdHlcbiAgICBpZiAoY2xhc3NpZmljYXRpb24uY29uZmlkZW5jZSA8IDAuOCB8fCBjb250ZXh0LmRvbWFpbkNvbnRleHQuaW50ZW50aW9uYWxpdHlIaW50cy5sZW5ndGggPiAwKSB7XG4gICAgICByZXR1cm4gJ21lZGl1bSc7XG4gICAgfVxuXG4gICAgLy8gTG93IGVmZm9ydDogU2ltcGxlIGNhc2VzXG4gICAgcmV0dXJuICdsb3cnO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBmaW5kUmVsYXRlZE9jY3VycmVuY2VzKG9jY3VycmVuY2U6IHsgZmlsZVBhdGg6IHN0cmluZzsgbGluZU51bWJlcjogbnVtYmVyOyBjb2RlU25pcHBldDogc3RyaW5nIH0pOiBQcm9taXNlPEFycmF5PHsgZmlsZVBhdGg6IHN0cmluZzsgbGluZU51bWJlcjogbnVtYmVyIH0+PiB7XG4gICAgLy8gRmluZCBvdGhlciBhbnkgdHlwZXMgaW4gdGhlIHNhbWUgZmlsZVxuICAgIGNvbnN0IHJlbGF0ZWRPY2N1cnJlbmNlczogQXJyYXk8eyBmaWxlUGF0aDogc3RyaW5nOyBsaW5lTnVtYmVyOiBudW1iZXIgfT4gPSBbXTtcblxuICAgIHRyeSB7XG4gICAgICBjb25zdCBncmVwQ29tbWFuZCA9IGBncmVwIC1uIFwiXFxcXGJhbnlcXFxcYlwiIFwiJHtvY2N1cnJlbmNlLmZpbGVQYXRofVwiYDtcbiAgICAgIGNvbnN0IG91dHB1dCA9IGV4ZWNTeW5jKGdyZXBDb21tYW5kLCB7IGVuY29kaW5nOiAndXRmOCcsIHN0ZGlvOiAncGlwZScgfSk7XG5cbiAgICAgIGNvbnN0IGxpbmVzID0gb3V0cHV0LnRyaW0oKS5zcGxpdCgnXFxuJykuZmlsdGVyKGxpbmUgPT4gbGluZS50cmltKCkpO1xuXG4gICAgICBmb3IgKGNvbnN0IGxpbmUgb2YgbGluZXMpIHtcbiAgICAgICAgY29uc3QgbWF0Y2ggPSBsaW5lLm1hdGNoKC9eKFxcZCspOiguKykkLyk7XG4gICAgICAgIGlmIChtYXRjaCkge1xuICAgICAgICAgIGNvbnN0IGxpbmVOdW1iZXIgPSBwYXJzZUludChtYXRjaFsxXSk7XG4gICAgICAgICAgaWYgKGxpbmVOdW1iZXIgIT09IG9jY3VycmVuY2UubGluZU51bWJlcikge1xuICAgICAgICAgICAgcmVsYXRlZE9jY3VycmVuY2VzLnB1c2goe1xuICAgICAgICAgICAgICBmaWxlUGF0aDogb2NjdXJyZW5jZS5maWxlUGF0aCxcbiAgICAgICAgICAgICAgbGluZU51bWJlclxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIC8vIE5vIHJlbGF0ZWQgb2NjdXJyZW5jZXMgZm91bmRcbiAgICB9XG5cbiAgICByZXR1cm4gcmVsYXRlZE9jY3VycmVuY2VzLnNsaWNlKDAsIDUpOyAvLyBMaW1pdCB0byA1IHJlbGF0ZWQgb2NjdXJyZW5jZXNcbiAgfVxuXG4gIHByaXZhdGUgZ2V0VG9wRG9tYWluKGRpc3RyaWJ1dGlvbjogRG9tYWluRGlzdHJpYnV0aW9uKTogQ29kZURvbWFpbiB7XG4gICAgY29uc3QgdG9wRG9tYWluID0gZGlzdHJpYnV0aW9uLmJ5RG9tYWluLnJlZHVjZSgobWF4LCBjdXJyZW50KSA9PlxuICAgICAgY3VycmVudC5jb3VudCA+IG1heC5jb3VudCA/IGN1cnJlbnQgOiBtYXhcbiAgICApO1xuICAgIHJldHVybiB0b3BEb21haW4uZG9tYWluO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRUb3BDYXRlZ29yeShkaXN0cmlidXRpb246IERvbWFpbkRpc3RyaWJ1dGlvbik6IEFueVR5cGVDYXRlZ29yeSB7XG4gICAgY29uc3QgdG9wQ2F0ZWdvcnkgPSBkaXN0cmlidXRpb24uYnlDYXRlZ29yeS5yZWR1Y2UoKG1heCwgY3VycmVudCkgPT5cbiAgICAgIGN1cnJlbnQuY291bnQgPiBtYXguY291bnQgPyBjdXJyZW50IDogbWF4XG4gICAgKTtcbiAgICByZXR1cm4gdG9wQ2F0ZWdvcnkuY2F0ZWdvcnk7XG4gIH1cblxuICBwcml2YXRlIGxvYWRBbmFseXNpc0hpc3RvcnkoKTogdm9pZCB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGhpc3RvcnlQYXRoID0gcGF0aC5qb2luKHByb2Nlc3MuY3dkKCksICcua2lybycsICdjYW1wYWlnbi1yZXBvcnRzJywgJ3VuaW50ZW50aW9uYWwtYW55LWFuYWx5c2lzLWhpc3RvcnkuanNvbicpO1xuICAgICAgaWYgKGZzLmV4aXN0c1N5bmMoaGlzdG9yeVBhdGgpKSB7XG4gICAgICAgIGNvbnN0IGhpc3RvcnlEYXRhID0gZnMucmVhZEZpbGVTeW5jKGhpc3RvcnlQYXRoLCAndXRmOCcpO1xuICAgICAgICB0aGlzLmFuYWx5c2lzSGlzdG9yeSA9IEpTT04ucGFyc2UoaGlzdG9yeURhdGEpO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLndhcm4oJ0NvdWxkIG5vdCBsb2FkIGFuYWx5c2lzIGhpc3Rvcnk6JywgZXJyb3IpO1xuICAgICAgdGhpcy5hbmFseXNpc0hpc3RvcnkgPSBbXTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHNhdmVBbmFseXNpc0hpc3RvcnkoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGhpc3RvcnlEaXIgPSBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgJy5raXJvJywgJ2NhbXBhaWduLXJlcG9ydHMnKTtcbiAgICAgIGlmICghZnMuZXhpc3RzU3luYyhoaXN0b3J5RGlyKSkge1xuICAgICAgICBmcy5ta2RpclN5bmMoaGlzdG9yeURpciwgeyByZWN1cnNpdmU6IHRydWUgfSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGhpc3RvcnlQYXRoID0gcGF0aC5qb2luKGhpc3RvcnlEaXIsICd1bmludGVudGlvbmFsLWFueS1hbmFseXNpcy1oaXN0b3J5Lmpzb24nKTtcbiAgICAgIGZzLndyaXRlRmlsZVN5bmMoaGlzdG9yeVBhdGgsIEpTT04uc3RyaW5naWZ5KHRoaXMuYW5hbHlzaXNIaXN0b3J5LCBudWxsLCAyKSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUud2FybignQ291bGQgbm90IHNhdmUgYW5hbHlzaXMgaGlzdG9yeTonLCBlcnJvcik7XG4gICAgfVxuICB9XG59XG4iXSwidmVyc2lvbiI6M30=