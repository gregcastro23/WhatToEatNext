cfa2936852412234967fab7c316e9154
"use strict";
// Create or update a utility function to calculate proper alchemical properties
Object.defineProperty(exports, "__esModule", { value: true });
exports.normalizeElementalProperties = exports.ingredientToRecipeIngredient = exports.mapToIngredient = exports.getDominantElement = exports.mergeElementalProperties = exports.validateRecipeIngredient = exports.validateIngredient = exports.isFullIngredient = exports.isRecipeIngredient = exports.determineIngredientModality = exports.calculateThermodynamicProperties = exports.calculateAlchemicalProperties = void 0;
/**
 * Calculate alchemical properties based on elemental properties
 * Following the core alchemizer engine formula patterns
 */
function calculateAlchemicalProperties(ingredient) {
    // Extract elemental properties
    const elementals = ingredient.elementalProperties || {
        Fire: 0.25,
        Water: 0.25,
        Earth: 0.25,
        Air: 0.25
    };
    // Base values derived from planetary influences in the alchemizer
    // Sun (Spirit), Moon/Venus (Essence), Saturn/Mars (Matter), Mercury/Neptune (Substance)
    // The ratios below approximate the original alchemizer calculations
    const spirit = (elementals.Fire * 0.7) + (elementals.Air * 0.3);
    const essence = (elementals.Water * 0.6) + (elementals.Fire * 0.2) + (elementals.Air * 0.2);
    const matter = (elementals.Earth * 0.7) + (elementals.Water * 0.3);
    const substance = (elementals.Earth * 0.5) + (elementals.Water * 0.3) + (elementals.Air * 0.2);
    return {
        spirit,
        essence,
        matter,
        substance
    };
}
exports.calculateAlchemicalProperties = calculateAlchemicalProperties;
/**
 * Calculate thermodynamic properties based on alchemical and elemental properties
 * Using the exact formulas from the alchemizer engine
 */
function calculateThermodynamicProperties(alchemicalProps, elementalProps) {
    const { spirit, essence, matter, substance } = alchemicalProps;
    // Use provided elemental props or create defaults
    const elements = elementalProps || {
        Fire: 0.25,
        Water: 0.25,
        Earth: 0.25,
        Air: 0.25
    };
    // Extract elemental values
    const fire = elements.Fire;
    const water = elements.Water;
    const air = elements.Air;
    const earth = elements.Earth;
    // Using the exact formulas from the alchemizer engine
    const heat = (spirit ** 2 + fire ** 2) /
        ((substance + essence + matter + water + air + earth) ** 2 || 1);
    const entropy = (spirit ** 2 + substance ** 2 + fire ** 2 + air ** 2) /
        ((essence + matter + earth + water) ** 2 || 1);
    const reactivity = (spirit ** 2 + substance ** 2 + essence ** 2 + fire ** 2 + air ** 2 + water ** 2) /
        ((matter + earth) ** 2 || 1);
    const energy = heat - (reactivity * entropy);
    return {
        heat,
        entropy,
        reactivity,
        energy
    };
}
exports.calculateThermodynamicProperties = calculateThermodynamicProperties;
// Helper functions to calculate individual properties
function _calculateSpiritValue(flavorProfile) {
    // Implement logic based on flavor profile attributes
    // Example: spirit might be higher for aromatic, fragrant ingredients
    return flavorProfile.intensity || 0.5; // Default to 0.5 if intensity not provided
}
// Implement similar helper functions for essence, matter, and substance 
/**
 * Determines the modality of an ingredient based on its qualities and elemental properties
 * Using the hierarchical affinities:
 * - Mutability: Air > Water > Fire > Earth
 * - Fixed: Earth > Water > Fire > Air
 * - Cardinal: Equal for all elements
 *
 * @param qualities Array of quality descriptors
 * @param elementalProperties Optional elemental properties for more accurate determination
 * @returns The modality (Cardinal, Fixed, or Mutable)
 */
function determineIngredientModality(qualities = [], elementalProperties) {
    // Ensure qualities is an array
    const qualitiesArray = Array.isArray(qualities) ? qualities : [];
    // Create normalized arrays of qualities for easier matching
    const normalizedQualities = qualitiesArray.map(q => q.toLowerCase());
    // Look for explicit quality indicators in the ingredients
    const cardinalKeywords = ['initiating', 'spicy', 'pungent', 'stimulating', 'invigorating', 'activating'];
    const fixedKeywords = ['grounding', 'stabilizing', 'nourishing', 'sustaining', 'foundational'];
    const mutableKeywords = ['adaptable', 'flexible', 'versatile', 'balancing', 'harmonizing'];
    const hasCardinalQuality = normalizedQualities.some(q => cardinalKeywords.includes(q));
    const hasFixedQuality = normalizedQualities.some(q => fixedKeywords.includes(q));
    const hasMutableQuality = normalizedQualities.some(q => mutableKeywords.includes(q));
    // If there's a clear quality indicator, use that
    if (hasCardinalQuality && !hasFixedQuality && !hasMutableQuality) {
        return 'Cardinal';
    }
    if (hasFixedQuality && !hasCardinalQuality && !hasMutableQuality) {
        return 'Fixed';
    }
    if (hasMutableQuality && !hasCardinalQuality && !hasFixedQuality) {
        return 'Mutable';
    }
    // If elemental properties are provided, use them to determine modality
    if (elementalProperties) {
        const { Fire, Water, Earth, Air } = elementalProperties;
        // Determine dominant element
        const dominantElement = getDominantElement(elementalProperties);
        // Use hierarchical element-modality affinities
        switch (dominantElement) {
            case 'Air':
                // Air has strongest affinity with Mutable, then Cardinal, then Fixed
                if (Air > 0.4) {
                    return 'Mutable';
                }
                break;
            case 'Earth':
                // Earth has strongest affinity with Fixed, then Cardinal, then Mutable
                if (Earth > 0.4) {
                    return 'Fixed';
                }
                break;
            case 'Fire':
                // Fire has balanced affinities but leans Cardinal
                if (Fire > 0.4) {
                    return 'Cardinal';
                }
                break;
            case 'Water':
                // Water is balanced between Fixed and Mutable
                if (Water > 0.4) {
                    // Slightly favor Mutable for Water, as per our hierarchy
                    return Water > 0.6 ? 'Mutable' : 'Fixed';
                }
                break;
        }
        // Calculate modality scores based on hierarchical affinities
        const mutableScore = (Air * 0.9) + (Water * 0.8) + (Fire * 0.7) + (Earth * 0.5);
        const fixedScore = (Earth * 0.9) + (Water * 0.8) + (Fire * 0.6) + (Air * 0.5);
        const cardinalScore = (Fire * 0.8) + (Earth * 0.8) + (Water * 0.8) + (Air * 0.8);
        // Return the modality with the highest score
        if (mutableScore > fixedScore && mutableScore > cardinalScore) {
            return 'Mutable';
        }
        else if (fixedScore > mutableScore && fixedScore > cardinalScore) {
            return 'Fixed';
        }
        else {
            return 'Cardinal';
        }
    }
    // Default to Mutable if no clear indicators are found
    return 'Mutable';
}
exports.determineIngredientModality = determineIngredientModality;
/**
 * Type guard to check if an object is a RecipeIngredient
 */
function isRecipeIngredient(ingredient) {
    const ingredientData = ingredient;
    return (ingredient &&
        typeof (ingredientData === null || ingredientData === void 0 ? void 0 : ingredientData.name) === 'string' &&
        typeof (ingredientData === null || ingredientData === void 0 ? void 0 : ingredientData.amount) === 'number' &&
        typeof (ingredientData === null || ingredientData === void 0 ? void 0 : ingredientData.unit) === 'string');
}
exports.isRecipeIngredient = isRecipeIngredient;
/**
 * Type guard to check if an object is a full Ingredient
 */
function isFullIngredient(ingredient) {
    const ingredientData = ingredient;
    return (ingredient &&
        typeof (ingredientData === null || ingredientData === void 0 ? void 0 : ingredientData.name) === 'string' &&
        typeof (ingredientData === null || ingredientData === void 0 ? void 0 : ingredientData.category) === 'string' &&
        (ingredientData === null || ingredientData === void 0 ? void 0 : ingredientData.elementalProperties) &&
        Array.isArray(ingredientData === null || ingredientData === void 0 ? void 0 : ingredientData.qualities) &&
        (ingredientData === null || ingredientData === void 0 ? void 0 : ingredientData.storage) &&
        typeof (ingredientData === null || ingredientData === void 0 ? void 0 : ingredientData.storage) === 'object');
}
exports.isFullIngredient = isFullIngredient;
/**
 * Validates that an ingredient object has all required properties
 */
function validateIngredient(ingredient) {
    const errors = [];
    // Required fields
    if (!ingredient.name || typeof ingredient.name !== 'string') {
        errors.push('Name is required and must be a string');
    }
    if (!ingredient.category) {
        errors.push('Category is required');
    }
    if (!ingredient.elementalProperties) {
        errors.push('Elemental properties are required');
    }
    // Optional validations
    if (ingredient.qualities && !Array.isArray(ingredient.qualities)) {
        errors.push('Qualities must be an array');
    }
    // Fix specific property access errors
    if (ingredient.qualities && Array.isArray(ingredient.qualities)) {
        // Check each quality is a string
        const invalidQualities = ingredient.qualities.filter((q) => typeof q !== 'string');
        if (invalidQualities.length > 0) {
            errors.push('All qualities must be strings');
        }
    }
    // Storage validation
    if (ingredient.storage && typeof ingredient.storage !== 'object') {
        errors.push('Storage must be an object');
    }
    if (ingredient.storage && typeof ingredient.storage === 'object') {
        // Additional storage property validations could go here
    }
    // Elemental properties validation
    if (ingredient.elementalProperties) {
        const elements = ['Fire', 'Water', 'Earth', 'Air'];
        const props = ingredient.elementalProperties;
        for (const element of elements) {
            if (typeof props[element] !== 'number') {
                errors.push(`Elemental property ${element} must be a number`);
            }
        }
    }
    return {
        isValid: errors.length === 0,
        errors
    };
}
exports.validateIngredient = validateIngredient;
/**
 * Validates a recipe ingredient
 */
function validateRecipeIngredient(ingredient) {
    const errors = [];
    // Check required fields
    if (!ingredient.name) {
        errors.push('Name is required');
    }
    if (typeof ingredient.amount !== 'number') {
        errors.push('Amount must be a number');
    }
    if (!ingredient.unit) {
        errors.push('Unit is required');
    }
    // If elemental properties are provided, validate them
    if (ingredient.elementalProperties) {
        const { Fire, Water, Earth, Air } = ingredient.elementalProperties;
        if (typeof Fire !== 'number' || Fire < 0 || Fire > 1) {
            errors.push('Fire elemental property must be a number between 0 and 1');
        }
        if (typeof Water !== 'number' || Water < 0 || Water > 1) {
            errors.push('Water elemental property must be a number between 0 and 1');
        }
        if (typeof Earth !== 'number' || Earth < 0 || Earth > 1) {
            errors.push('Earth elemental property must be a number between 0 and 1');
        }
        if (typeof Air !== 'number' || Air < 0 || Air > 1) {
            errors.push('Air elemental property must be a number between 0 and 1');
        }
    }
    return {
        isValid: errors.length === 0,
        errors
    };
}
exports.validateRecipeIngredient = validateRecipeIngredient;
/**
 * Merges two sets of elemental properties with optional weighting
 */
function mergeElementalProperties(base, addition, weight = 0.5) {
    return {
        Fire: base.Fire * (1 - weight) + addition.Fire * weight,
        Water: base.Water * (1 - weight) + addition.Water * weight,
        Earth: base.Earth * (1 - weight) + addition.Earth * weight,
        Air: base.Air * (1 - weight) + addition.Air * weight
    };
}
exports.mergeElementalProperties = mergeElementalProperties;
/**
 * Gets the dominant element from an ElementalProperties object
 */
function getDominantElement(elementalProperties) {
    const { Fire, Water, Earth, Air } = elementalProperties;
    const max = Math.max(Fire, Water, Earth, Air);
    if (max === Fire)
        return 'Fire';
    if (max === Water)
        return 'Water';
    if (max === Earth)
        return 'Earth';
    if (max === Air)
        return 'Air';
    return 'Balanced';
}
exports.getDominantElement = getDominantElement;
/**
 * Converts an ingredient mapping to a full ingredient
 */
function mapToIngredient(mapping) {
    // Set default values for required properties
    const ingredient = {
        name: mapping.name || '',
        category: mapping.category || 'culinary_herb',
        elementalProperties: mapping.elementalProperties || { Fire: 0.25, Water: 0.25, Earth: 0.25, Air: 0.25 },
        qualities: mapping.qualities || [],
        storage: mapping.storage || {
            duration: 'unknown'
        },
        // Add missing required properties for Ingredient interface
        amount: mapping.amount || 1,
        astrologicalProfile: mapping.astrologicalProfile || {
            elementalAffinity: { base: 'Earth' },
            rulingPlanets: [],
            zodiacAffinity: []
        }
    };
    // Add any additional properties from the mapping
    for (const key in mapping) {
        if (key !== 'name' && key !== 'category' && key !== 'elementalProperties' && key !== 'qualities') {
            ingredient[key] = mapping[key];
        }
    }
    return ingredient;
}
exports.mapToIngredient = mapToIngredient;
/**
 * Converts a full ingredient to a recipe ingredient
 */
function ingredientToRecipeIngredient(ingredient, amount = 1, unit = 'item') {
    return {
        name: ingredient.name,
        amount,
        unit,
        category: ingredient.category || 'culinary_herb',
        elementalProperties: ingredient.elementalProperties,
        qualities: (ingredient === null || ingredient === void 0 ? void 0 : ingredient.qualities) || [],
        astrologicalProfile: ingredient.astrologicalProfile,
        // Include other relevant properties that exist in RecipeIngredient - safe property access
        origin: (ingredient === null || ingredient === void 0 ? void 0 : ingredient.origin) || undefined,
        seasonality: (ingredient === null || ingredient === void 0 ? void 0 : ingredient.seasonality) || undefined
    };
}
exports.ingredientToRecipeIngredient = ingredientToRecipeIngredient;
/**
 * Normalizes elemental properties to ensure they sum to 1
 */
function normalizeElementalProperties(properties) {
    const { Fire, Water, Earth, Air } = properties;
    const sum = Fire + Water + Earth + Air;
    if (sum === 0) {
        // If all values are 0, return an evenly balanced set
        return { Fire: 0.25, Water: 0.25, Earth: 0.25, Air: 0.25 };
    }
    return {
        Fire: Fire / sum,
        Water: Water / sum,
        Earth: Earth / sum,
        Air: Air / sum
    };
}
exports.normalizeElementalProperties = normalizeElementalProperties;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy91dGlscy9pbmdyZWRpZW50VXRpbHMudHMiLCJtYXBwaW5ncyI6IjtBQUFBLGdGQUFnRjs7O0FBWWhGOzs7R0FHRztBQUNILFNBQWdCLDZCQUE2QixDQUFDLFVBQXNCO0lBQ2xFLCtCQUErQjtJQUMvQixNQUFNLFVBQVUsR0FBRyxVQUFVLENBQUMsbUJBQW1CLElBQUk7UUFDbkQsSUFBSSxFQUFFLElBQUk7UUFDVixLQUFLLEVBQUUsSUFBSTtRQUNYLEtBQUssRUFBRSxJQUFJO1FBQ1gsR0FBRyxFQUFFLElBQUk7S0FDVixDQUFDO0lBRUYsa0VBQWtFO0lBQ2xFLHdGQUF3RjtJQUN4RixvRUFBb0U7SUFDcEUsTUFBTSxNQUFNLEdBQUcsQ0FBQyxVQUFVLENBQUMsSUFBSSxHQUFHLEdBQUcsQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDLEdBQUcsR0FBRyxHQUFHLENBQUMsQ0FBQztJQUNoRSxNQUFNLE9BQU8sR0FBRyxDQUFDLFVBQVUsQ0FBQyxLQUFLLEdBQUcsR0FBRyxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsSUFBSSxHQUFHLEdBQUcsQ0FBQyxHQUFHLENBQUMsVUFBVSxDQUFDLEdBQUcsR0FBRyxHQUFHLENBQUMsQ0FBQztJQUM1RixNQUFNLE1BQU0sR0FBRyxDQUFDLFVBQVUsQ0FBQyxLQUFLLEdBQUcsR0FBRyxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsS0FBSyxHQUFHLEdBQUcsQ0FBQyxDQUFDO0lBQ25FLE1BQU0sU0FBUyxHQUFHLENBQUMsVUFBVSxDQUFDLEtBQUssR0FBRyxHQUFHLENBQUMsR0FBRyxDQUFDLFVBQVUsQ0FBQyxLQUFLLEdBQUcsR0FBRyxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsR0FBRyxHQUFHLEdBQUcsQ0FBQyxDQUFDO0lBRS9GLE9BQU87UUFDTCxNQUFNO1FBQ04sT0FBTztRQUNQLE1BQU07UUFDTixTQUFTO0tBQ1YsQ0FBQztBQUNKLENBQUM7QUF2QkQsc0VBdUJD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ZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy91dGlscy9pbmdyZWRpZW50VXRpbHMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gQ3JlYXRlIG9yIHVwZGF0ZSBhIHV0aWxpdHkgZnVuY3Rpb24gdG8gY2FsY3VsYXRlIHByb3BlciBhbGNoZW1pY2FsIHByb3BlcnRpZXNcblxuaW1wb3J0IHR5cGUgeyBBbGNoZW1pY2FsUHJvcGVydGllcywgVGhlcm1vZHluYW1pY1Byb3BlcnRpZXMsIE1vZGFsaXR5ICwgSW5ncmVkaWVudENhdGVnb3J5IH0gZnJvbSAnQC9kYXRhL2luZ3JlZGllbnRzL3R5cGVzJztcbmltcG9ydCB0eXBlIHsgRWxlbWVudGFsUHJvcGVydGllcyB9IGZyb20gJ0AvdHlwZXMvYWxjaGVteSc7XG5pbXBvcnQgeyBGbGF2b3JQcm9maWxlIH0gZnJvbSAnQC90eXBlcy9hbGNoZW15JztcbmltcG9ydCB0eXBlIHsgXG4gIEluZ3JlZGllbnQsXG4gIFJlY2lwZUluZ3JlZGllbnQsIFxuICBJbmdyZWRpZW50TWFwcGluZ1xufSBmcm9tICdAL3R5cGVzJztcbmltcG9ydCB0eXBlIHsgU2ltcGxlSW5ncmVkaWVudCB9IGZyb20gJ0AvdHlwZXMvcmVjaXBlSW5ncmVkaWVudCc7XG5cbi8qKlxuICogQ2FsY3VsYXRlIGFsY2hlbWljYWwgcHJvcGVydGllcyBiYXNlZCBvbiBlbGVtZW50YWwgcHJvcGVydGllc1xuICogRm9sbG93aW5nIHRoZSBjb3JlIGFsY2hlbWl6ZXIgZW5naW5lIGZvcm11bGEgcGF0dGVybnNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNhbGN1bGF0ZUFsY2hlbWljYWxQcm9wZXJ0aWVzKGluZ3JlZGllbnQ6IEluZ3JlZGllbnQpOiBBbGNoZW1pY2FsUHJvcGVydGllcyB7XG4gIC8vIEV4dHJhY3QgZWxlbWVudGFsIHByb3BlcnRpZXNcbiAgY29uc3QgZWxlbWVudGFscyA9IGluZ3JlZGllbnQuZWxlbWVudGFsUHJvcGVydGllcyB8fCB7XG4gICAgRmlyZTogMC4yNSxcbiAgICBXYXRlcjogMC4yNSxcbiAgICBFYXJ0aDogMC4yNSxcbiAgICBBaXI6IDAuMjVcbiAgfTtcbiAgXG4gIC8vIEJhc2UgdmFsdWVzIGRlcml2ZWQgZnJvbSBwbGFuZXRhcnkgaW5mbHVlbmNlcyBpbiB0aGUgYWxjaGVtaXplclxuICAvLyBTdW4gKFNwaXJpdCksIE1vb24vVmVudXMgKEVzc2VuY2UpLCBTYXR1cm4vTWFycyAoTWF0dGVyKSwgTWVyY3VyeS9OZXB0dW5lIChTdWJzdGFuY2UpXG4gIC8vIFRoZSByYXRpb3MgYmVsb3cgYXBwcm94aW1hdGUgdGhlIG9yaWdpbmFsIGFsY2hlbWl6ZXIgY2FsY3VsYXRpb25zXG4gIGNvbnN0IHNwaXJpdCA9IChlbGVtZW50YWxzLkZpcmUgKiAwLjcpICsgKGVsZW1lbnRhbHMuQWlyICogMC4zKTtcbiAgY29uc3QgZXNzZW5jZSA9IChlbGVtZW50YWxzLldhdGVyICogMC42KSArIChlbGVtZW50YWxzLkZpcmUgKiAwLjIpICsgKGVsZW1lbnRhbHMuQWlyICogMC4yKTtcbiAgY29uc3QgbWF0dGVyID0gKGVsZW1lbnRhbHMuRWFydGggKiAwLjcpICsgKGVsZW1lbnRhbHMuV2F0ZXIgKiAwLjMpO1xuICBjb25zdCBzdWJzdGFuY2UgPSAoZWxlbWVudGFscy5FYXJ0aCAqIDAuNSkgKyAoZWxlbWVudGFscy5XYXRlciAqIDAuMykgKyAoZWxlbWVudGFscy5BaXIgKiAwLjIpO1xuICBcbiAgcmV0dXJuIHtcbiAgICBzcGlyaXQsXG4gICAgZXNzZW5jZSxcbiAgICBtYXR0ZXIsXG4gICAgc3Vic3RhbmNlXG4gIH07XG59XG5cbi8qKlxuICogQ2FsY3VsYXRlIHRoZXJtb2R5bmFtaWMgcHJvcGVydGllcyBiYXNlZCBvbiBhbGNoZW1pY2FsIGFuZCBlbGVtZW50YWwgcHJvcGVydGllc1xuICogVXNpbmcgdGhlIGV4YWN0IGZvcm11bGFzIGZyb20gdGhlIGFsY2hlbWl6ZXIgZW5naW5lXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjYWxjdWxhdGVUaGVybW9keW5hbWljUHJvcGVydGllcyhcbiAgYWxjaGVtaWNhbFByb3BzOiBBbGNoZW1pY2FsUHJvcGVydGllcyxcbiAgZWxlbWVudGFsUHJvcHM/OiBFbGVtZW50YWxQcm9wZXJ0aWVzXG4pOiBUaGVybW9keW5hbWljUHJvcGVydGllcyB7XG4gIGNvbnN0IHsgc3Bpcml0LCBlc3NlbmNlLCBtYXR0ZXIsIHN1YnN0YW5jZSB9ID0gYWxjaGVtaWNhbFByb3BzO1xuICBcbiAgLy8gVXNlIHByb3ZpZGVkIGVsZW1lbnRhbCBwcm9wcyBvciBjcmVhdGUgZGVmYXVsdHNcbiAgY29uc3QgZWxlbWVudHMgPSBlbGVtZW50YWxQcm9wcyB8fCB7XG4gICAgRmlyZTogMC4yNSxcbiAgICBXYXRlcjogMC4yNSxcbiAgICBFYXJ0aDogMC4yNSxcbiAgICBBaXI6IDAuMjVcbiAgfTtcbiAgXG4gIC8vIEV4dHJhY3QgZWxlbWVudGFsIHZhbHVlc1xuICBjb25zdCBmaXJlID0gZWxlbWVudHMuRmlyZTtcbiAgY29uc3Qgd2F0ZXIgPSBlbGVtZW50cy5XYXRlcjtcbiAgY29uc3QgYWlyID0gZWxlbWVudHMuQWlyO1xuICBjb25zdCBlYXJ0aCA9IGVsZW1lbnRzLkVhcnRoO1xuICBcbiAgLy8gVXNpbmcgdGhlIGV4YWN0IGZvcm11bGFzIGZyb20gdGhlIGFsY2hlbWl6ZXIgZW5naW5lXG4gIGNvbnN0IGhlYXQgPSAoc3Bpcml0KioyICsgZmlyZSoqMikgLyBcbiAgICAoKHN1YnN0YW5jZSArIGVzc2VuY2UgKyBtYXR0ZXIgKyB3YXRlciArIGFpciArIGVhcnRoKSoqMiB8fCAxKTtcbiAgICBcbiAgY29uc3QgZW50cm9weSA9IChzcGlyaXQqKjIgKyBzdWJzdGFuY2UqKjIgKyBmaXJlKioyICsgYWlyKioyKSAvIFxuICAgICgoZXNzZW5jZSArIG1hdHRlciArIGVhcnRoICsgd2F0ZXIpKioyIHx8IDEpO1xuICAgIFxuICBjb25zdCByZWFjdGl2aXR5ID0gKHNwaXJpdCoqMiArIHN1YnN0YW5jZSoqMiArIGVzc2VuY2UqKjIgKyBmaXJlKioyICsgYWlyKioyICsgd2F0ZXIqKjIpIC8gXG4gICAgKChtYXR0ZXIgKyBlYXJ0aCkqKjIgfHwgMSk7XG4gIFxuICBjb25zdCBlbmVyZ3kgPSBoZWF0IC0gKHJlYWN0aXZpdHkgKiBlbnRyb3B5KTtcbiAgXG4gIHJldHVybiB7XG4gICAgaGVhdCxcbiAgICBlbnRyb3B5LFxuICAgIHJlYWN0aXZpdHksXG4gICAgZW5lcmd5XG4gIH07XG59XG5cbi8vIEhlbHBlciBmdW5jdGlvbnMgdG8gY2FsY3VsYXRlIGluZGl2aWR1YWwgcHJvcGVydGllc1xuZnVuY3Rpb24gX2NhbGN1bGF0ZVNwaXJpdFZhbHVlKGZsYXZvclByb2ZpbGU6IEZsYXZvclByb2ZpbGUpOiBudW1iZXIge1xuICAvLyBJbXBsZW1lbnQgbG9naWMgYmFzZWQgb24gZmxhdm9yIHByb2ZpbGUgYXR0cmlidXRlc1xuICAvLyBFeGFtcGxlOiBzcGlyaXQgbWlnaHQgYmUgaGlnaGVyIGZvciBhcm9tYXRpYywgZnJhZ3JhbnQgaW5ncmVkaWVudHNcbiAgcmV0dXJuIGZsYXZvclByb2ZpbGUuaW50ZW5zaXR5IHx8IDAuNTsgLy8gRGVmYXVsdCB0byAwLjUgaWYgaW50ZW5zaXR5IG5vdCBwcm92aWRlZFxufVxuXG4vLyBJbXBsZW1lbnQgc2ltaWxhciBoZWxwZXIgZnVuY3Rpb25zIGZvciBlc3NlbmNlLCBtYXR0ZXIsIGFuZCBzdWJzdGFuY2UgXG5cbi8qKlxuICogRGV0ZXJtaW5lcyB0aGUgbW9kYWxpdHkgb2YgYW4gaW5ncmVkaWVudCBiYXNlZCBvbiBpdHMgcXVhbGl0aWVzIGFuZCBlbGVtZW50YWwgcHJvcGVydGllc1xuICogVXNpbmcgdGhlIGhpZXJhcmNoaWNhbCBhZmZpbml0aWVzOlxuICogLSBNdXRhYmlsaXR5OiBBaXIgPiBXYXRlciA+IEZpcmUgPiBFYXJ0aFxuICogLSBGaXhlZDogRWFydGggPiBXYXRlciA+IEZpcmUgPiBBaXJcbiAqIC0gQ2FyZGluYWw6IEVxdWFsIGZvciBhbGwgZWxlbWVudHNcbiAqIFxuICogQHBhcmFtIHF1YWxpdGllcyBBcnJheSBvZiBxdWFsaXR5IGRlc2NyaXB0b3JzXG4gKiBAcGFyYW0gZWxlbWVudGFsUHJvcGVydGllcyBPcHRpb25hbCBlbGVtZW50YWwgcHJvcGVydGllcyBmb3IgbW9yZSBhY2N1cmF0ZSBkZXRlcm1pbmF0aW9uXG4gKiBAcmV0dXJucyBUaGUgbW9kYWxpdHkgKENhcmRpbmFsLCBGaXhlZCwgb3IgTXV0YWJsZSlcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGRldGVybWluZUluZ3JlZGllbnRNb2RhbGl0eShcbiAgcXVhbGl0aWVzOiBzdHJpbmdbXSA9IFtdLFxuICBlbGVtZW50YWxQcm9wZXJ0aWVzPzogRWxlbWVudGFsUHJvcGVydGllc1xuKTogTW9kYWxpdHkge1xuICAvLyBFbnN1cmUgcXVhbGl0aWVzIGlzIGFuIGFycmF5XG4gIGNvbnN0IHF1YWxpdGllc0FycmF5ID0gQXJyYXkuaXNBcnJheShxdWFsaXRpZXMpID8gcXVhbGl0aWVzIDogW107XG4gIFxuICAvLyBDcmVhdGUgbm9ybWFsaXplZCBhcnJheXMgb2YgcXVhbGl0aWVzIGZvciBlYXNpZXIgbWF0Y2hpbmdcbiAgY29uc3Qgbm9ybWFsaXplZFF1YWxpdGllcyA9IHF1YWxpdGllc0FycmF5Lm1hcChxID0+IHEudG9Mb3dlckNhc2UoKSk7XG4gIFxuICAvLyBMb29rIGZvciBleHBsaWNpdCBxdWFsaXR5IGluZGljYXRvcnMgaW4gdGhlIGluZ3JlZGllbnRzXG4gIGNvbnN0IGNhcmRpbmFsS2V5d29yZHMgPSBbJ2luaXRpYXRpbmcnLCAnc3BpY3knLCAncHVuZ2VudCcsICdzdGltdWxhdGluZycsICdpbnZpZ29yYXRpbmcnLCAnYWN0aXZhdGluZyddO1xuICBjb25zdCBmaXhlZEtleXdvcmRzID0gWydncm91bmRpbmcnLCAnc3RhYmlsaXppbmcnLCAnbm91cmlzaGluZycsICdzdXN0YWluaW5nJywgJ2ZvdW5kYXRpb25hbCddO1xuICBjb25zdCBtdXRhYmxlS2V5d29yZHMgPSBbJ2FkYXB0YWJsZScsICdmbGV4aWJsZScsICd2ZXJzYXRpbGUnLCAnYmFsYW5jaW5nJywgJ2hhcm1vbml6aW5nJ107XG4gIFxuICBjb25zdCBoYXNDYXJkaW5hbFF1YWxpdHkgPSBub3JtYWxpemVkUXVhbGl0aWVzLnNvbWUocSA9PiBjYXJkaW5hbEtleXdvcmRzLmluY2x1ZGVzKHEpKTtcbiAgY29uc3QgaGFzRml4ZWRRdWFsaXR5ID0gbm9ybWFsaXplZFF1YWxpdGllcy5zb21lKHEgPT4gZml4ZWRLZXl3b3Jkcy5pbmNsdWRlcyhxKSk7XG4gIGNvbnN0IGhhc011dGFibGVRdWFsaXR5ID0gbm9ybWFsaXplZFF1YWxpdGllcy5zb21lKHEgPT4gbXV0YWJsZUtleXdvcmRzLmluY2x1ZGVzKHEpKTtcbiAgXG4gIC8vIElmIHRoZXJlJ3MgYSBjbGVhciBxdWFsaXR5IGluZGljYXRvciwgdXNlIHRoYXRcbiAgaWYgKGhhc0NhcmRpbmFsUXVhbGl0eSAmJiAhaGFzRml4ZWRRdWFsaXR5ICYmICFoYXNNdXRhYmxlUXVhbGl0eSkge1xuICAgIHJldHVybiAnQ2FyZGluYWwnO1xuICB9XG4gIGlmIChoYXNGaXhlZFF1YWxpdHkgJiYgIWhhc0NhcmRpbmFsUXVhbGl0eSAmJiAhaGFzTXV0YWJsZVF1YWxpdHkpIHtcbiAgICByZXR1cm4gJ0ZpeGVkJztcbiAgfVxuICBpZiAoaGFzTXV0YWJsZVF1YWxpdHkgJiYgIWhhc0NhcmRpbmFsUXVhbGl0eSAmJiAhaGFzRml4ZWRRdWFsaXR5KSB7XG4gICAgcmV0dXJuICdNdXRhYmxlJztcbiAgfVxuICBcbiAgLy8gSWYgZWxlbWVudGFsIHByb3BlcnRpZXMgYXJlIHByb3ZpZGVkLCB1c2UgdGhlbSB0byBkZXRlcm1pbmUgbW9kYWxpdHlcbiAgaWYgKGVsZW1lbnRhbFByb3BlcnRpZXMpIHtcbiAgICBjb25zdCB7IEZpcmUsIFdhdGVyLCBFYXJ0aCwgQWlyIH0gPSBlbGVtZW50YWxQcm9wZXJ0aWVzO1xuICAgIFxuICAgIC8vIERldGVybWluZSBkb21pbmFudCBlbGVtZW50XG4gICAgY29uc3QgZG9taW5hbnRFbGVtZW50ID0gZ2V0RG9taW5hbnRFbGVtZW50KGVsZW1lbnRhbFByb3BlcnRpZXMpO1xuICAgIFxuICAgIC8vIFVzZSBoaWVyYXJjaGljYWwgZWxlbWVudC1tb2RhbGl0eSBhZmZpbml0aWVzXG4gICAgc3dpdGNoIChkb21pbmFudEVsZW1lbnQpIHtcbiAgICAgIGNhc2UgJ0Fpcic6XG4gICAgICAgIC8vIEFpciBoYXMgc3Ryb25nZXN0IGFmZmluaXR5IHdpdGggTXV0YWJsZSwgdGhlbiBDYXJkaW5hbCwgdGhlbiBGaXhlZFxuICAgICAgICBpZiAoQWlyID4gMC40KSB7XG4gICAgICAgICAgcmV0dXJuICdNdXRhYmxlJztcbiAgICAgICAgfVxuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ0VhcnRoJzpcbiAgICAgICAgLy8gRWFydGggaGFzIHN0cm9uZ2VzdCBhZmZpbml0eSB3aXRoIEZpeGVkLCB0aGVuIENhcmRpbmFsLCB0aGVuIE11dGFibGVcbiAgICAgICAgaWYgKEVhcnRoID4gMC40KSB7XG4gICAgICAgICAgcmV0dXJuICdGaXhlZCc7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdGaXJlJzpcbiAgICAgICAgLy8gRmlyZSBoYXMgYmFsYW5jZWQgYWZmaW5pdGllcyBidXQgbGVhbnMgQ2FyZGluYWxcbiAgICAgICAgaWYgKEZpcmUgPiAwLjQpIHtcbiAgICAgICAgICByZXR1cm4gJ0NhcmRpbmFsJztcbiAgICAgICAgfVxuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ1dhdGVyJzpcbiAgICAgICAgLy8gV2F0ZXIgaXMgYmFsYW5jZWQgYmV0d2VlbiBGaXhlZCBhbmQgTXV0YWJsZVxuICAgICAgICBpZiAoV2F0ZXIgPiAwLjQpIHtcbiAgICAgICAgICAvLyBTbGlnaHRseSBmYXZvciBNdXRhYmxlIGZvciBXYXRlciwgYXMgcGVyIG91ciBoaWVyYXJjaHlcbiAgICAgICAgICByZXR1cm4gV2F0ZXIgPiAwLjYgPyAnTXV0YWJsZScgOiAnRml4ZWQnO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBcbiAgICAvLyBDYWxjdWxhdGUgbW9kYWxpdHkgc2NvcmVzIGJhc2VkIG9uIGhpZXJhcmNoaWNhbCBhZmZpbml0aWVzXG4gICAgY29uc3QgbXV0YWJsZVNjb3JlID0gKEFpciAqIDAuOSkgKyAoV2F0ZXIgKiAwLjgpICsgKEZpcmUgKiAwLjcpICsgKEVhcnRoICogMC41KTtcbiAgICBjb25zdCBmaXhlZFNjb3JlID0gKEVhcnRoICogMC45KSArIChXYXRlciAqIDAuOCkgKyAoRmlyZSAqIDAuNikgKyAoQWlyICogMC41KTtcbiAgICBjb25zdCBjYXJkaW5hbFNjb3JlID0gKEZpcmUgKiAwLjgpICsgKEVhcnRoICogMC44KSArIChXYXRlciAqIDAuOCkgKyAoQWlyICogMC44KTtcbiAgICBcbiAgICAvLyBSZXR1cm4gdGhlIG1vZGFsaXR5IHdpdGggdGhlIGhpZ2hlc3Qgc2NvcmVcbiAgICBpZiAobXV0YWJsZVNjb3JlID4gZml4ZWRTY29yZSAmJiBtdXRhYmxlU2NvcmUgPiBjYXJkaW5hbFNjb3JlKSB7XG4gICAgICByZXR1cm4gJ011dGFibGUnO1xuICAgIH0gZWxzZSBpZiAoZml4ZWRTY29yZSA+IG11dGFibGVTY29yZSAmJiBmaXhlZFNjb3JlID4gY2FyZGluYWxTY29yZSkge1xuICAgICAgcmV0dXJuICdGaXhlZCc7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiAnQ2FyZGluYWwnO1xuICAgIH1cbiAgfVxuICBcbiAgLy8gRGVmYXVsdCB0byBNdXRhYmxlIGlmIG5vIGNsZWFyIGluZGljYXRvcnMgYXJlIGZvdW5kXG4gIHJldHVybiAnTXV0YWJsZSc7XG59XG5cbi8qKlxuICogVHlwZSBndWFyZCB0byBjaGVjayBpZiBhbiBvYmplY3QgaXMgYSBSZWNpcGVJbmdyZWRpZW50XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpc1JlY2lwZUluZ3JlZGllbnQoaW5ncmVkaWVudDogdW5rbm93bik6IGluZ3JlZGllbnQgaXMgUmVjaXBlSW5ncmVkaWVudCB7XG4gIGNvbnN0IGluZ3JlZGllbnREYXRhID0gaW5ncmVkaWVudCBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPjtcbiAgcmV0dXJuIChcbiAgICBpbmdyZWRpZW50ICYmXG4gICAgdHlwZW9mIGluZ3JlZGllbnREYXRhPy5uYW1lID09PSAnc3RyaW5nJyAmJlxuICAgIHR5cGVvZiBpbmdyZWRpZW50RGF0YT8uYW1vdW50ID09PSAnbnVtYmVyJyAmJlxuICAgIHR5cGVvZiBpbmdyZWRpZW50RGF0YT8udW5pdCA9PT0gJ3N0cmluZydcbiAgKTtcbn1cblxuLyoqXG4gKiBUeXBlIGd1YXJkIHRvIGNoZWNrIGlmIGFuIG9iamVjdCBpcyBhIGZ1bGwgSW5ncmVkaWVudFxuICovXG5leHBvcnQgZnVuY3Rpb24gaXNGdWxsSW5ncmVkaWVudChpbmdyZWRpZW50OiB1bmtub3duKTogaW5ncmVkaWVudCBpcyBJbmdyZWRpZW50IHtcbiAgY29uc3QgaW5ncmVkaWVudERhdGEgPSBpbmdyZWRpZW50IGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+O1xuICByZXR1cm4gKFxuICAgIGluZ3JlZGllbnQgJiZcbiAgICB0eXBlb2YgaW5ncmVkaWVudERhdGE/Lm5hbWUgPT09ICdzdHJpbmcnICYmXG4gICAgdHlwZW9mIGluZ3JlZGllbnREYXRhPy5jYXRlZ29yeSA9PT0gJ3N0cmluZycgJiZcbiAgICBpbmdyZWRpZW50RGF0YT8uZWxlbWVudGFsUHJvcGVydGllcyAmJlxuICAgIEFycmF5LmlzQXJyYXkoaW5ncmVkaWVudERhdGE/LnF1YWxpdGllcykgJiZcbiAgICBpbmdyZWRpZW50RGF0YT8uc3RvcmFnZSAmJlxuICAgIHR5cGVvZiBpbmdyZWRpZW50RGF0YT8uc3RvcmFnZSA9PT0gJ29iamVjdCdcbiAgKTtcbn1cblxuLyoqXG4gKiBWYWxpZGF0ZXMgdGhhdCBhbiBpbmdyZWRpZW50IG9iamVjdCBoYXMgYWxsIHJlcXVpcmVkIHByb3BlcnRpZXNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHZhbGlkYXRlSW5ncmVkaWVudChpbmdyZWRpZW50OiBQYXJ0aWFsPEluZ3JlZGllbnQ+ICYgeyBcbiAgcXVhbGl0aWVzPzogc3RyaW5nW107IFxuICBzdG9yYWdlPzogeyB0ZW1wZXJhdHVyZT86IHN0cmluZzsgaHVtaWRpdHk/OiBzdHJpbmcgfSBcbn0pOiB7IFxuICBpc1ZhbGlkOiBib29sZWFuOyBcbiAgZXJyb3JzOiBzdHJpbmdbXSBcbn0ge1xuICBjb25zdCBlcnJvcnM6IHN0cmluZ1tdID0gW107XG4gIFxuICAvLyBSZXF1aXJlZCBmaWVsZHNcbiAgaWYgKCFpbmdyZWRpZW50Lm5hbWUgfHwgdHlwZW9mIGluZ3JlZGllbnQubmFtZSAhPT0gJ3N0cmluZycpIHtcbiAgICBlcnJvcnMucHVzaCgnTmFtZSBpcyByZXF1aXJlZCBhbmQgbXVzdCBiZSBhIHN0cmluZycpO1xuICB9XG4gIFxuICBpZiAoIWluZ3JlZGllbnQuY2F0ZWdvcnkpIHtcbiAgICBlcnJvcnMucHVzaCgnQ2F0ZWdvcnkgaXMgcmVxdWlyZWQnKTtcbiAgfVxuICBcbiAgaWYgKCFpbmdyZWRpZW50LmVsZW1lbnRhbFByb3BlcnRpZXMpIHtcbiAgICBlcnJvcnMucHVzaCgnRWxlbWVudGFsIHByb3BlcnRpZXMgYXJlIHJlcXVpcmVkJyk7XG4gIH1cbiAgXG4gIC8vIE9wdGlvbmFsIHZhbGlkYXRpb25zXG4gIGlmIChpbmdyZWRpZW50LnF1YWxpdGllcyAmJiAhQXJyYXkuaXNBcnJheShpbmdyZWRpZW50LnF1YWxpdGllcykpIHtcbiAgICBlcnJvcnMucHVzaCgnUXVhbGl0aWVzIG11c3QgYmUgYW4gYXJyYXknKTtcbiAgfVxuICBcbiAgLy8gRml4IHNwZWNpZmljIHByb3BlcnR5IGFjY2VzcyBlcnJvcnNcbiAgaWYgKGluZ3JlZGllbnQucXVhbGl0aWVzICYmIEFycmF5LmlzQXJyYXkoaW5ncmVkaWVudC5xdWFsaXRpZXMpKSB7XG4gICAgLy8gQ2hlY2sgZWFjaCBxdWFsaXR5IGlzIGEgc3RyaW5nXG4gICAgY29uc3QgaW52YWxpZFF1YWxpdGllcyA9IGluZ3JlZGllbnQucXVhbGl0aWVzLmZpbHRlcigocTogdW5rbm93bikgPT4gdHlwZW9mIHEgIT09ICdzdHJpbmcnKTtcbiAgICBpZiAoaW52YWxpZFF1YWxpdGllcy5sZW5ndGggPiAwKSB7XG4gICAgICBlcnJvcnMucHVzaCgnQWxsIHF1YWxpdGllcyBtdXN0IGJlIHN0cmluZ3MnKTtcbiAgICB9XG4gIH1cbiAgXG4gIC8vIFN0b3JhZ2UgdmFsaWRhdGlvblxuICBpZiAoaW5ncmVkaWVudC5zdG9yYWdlICYmIHR5cGVvZiBpbmdyZWRpZW50LnN0b3JhZ2UgIT09ICdvYmplY3QnKSB7XG4gICAgZXJyb3JzLnB1c2goJ1N0b3JhZ2UgbXVzdCBiZSBhbiBvYmplY3QnKTtcbiAgfVxuICBcbiAgaWYgKGluZ3JlZGllbnQuc3RvcmFnZSAmJiB0eXBlb2YgaW5ncmVkaWVudC5zdG9yYWdlID09PSAnb2JqZWN0Jykge1xuICAgIC8vIEFkZGl0aW9uYWwgc3RvcmFnZSBwcm9wZXJ0eSB2YWxpZGF0aW9ucyBjb3VsZCBnbyBoZXJlXG4gIH1cbiAgXG4gIC8vIEVsZW1lbnRhbCBwcm9wZXJ0aWVzIHZhbGlkYXRpb25cbiAgaWYgKGluZ3JlZGllbnQuZWxlbWVudGFsUHJvcGVydGllcykge1xuICAgIGNvbnN0IGVsZW1lbnRzID0gWydGaXJlJywgJ1dhdGVyJywgJ0VhcnRoJywgJ0FpciddO1xuICAgIGNvbnN0IHByb3BzID0gaW5ncmVkaWVudC5lbGVtZW50YWxQcm9wZXJ0aWVzO1xuICAgIFxuICAgIGZvciAoY29uc3QgZWxlbWVudCBvZiBlbGVtZW50cykge1xuICAgICAgaWYgKHR5cGVvZiBwcm9wc1tlbGVtZW50XSAhPT0gJ251bWJlcicpIHtcbiAgICAgICAgZXJyb3JzLnB1c2goYEVsZW1lbnRhbCBwcm9wZXJ0eSAke2VsZW1lbnR9IG11c3QgYmUgYSBudW1iZXJgKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgXG4gIHJldHVybiB7XG4gICAgaXNWYWxpZDogZXJyb3JzLmxlbmd0aCA9PT0gMCxcbiAgICBlcnJvcnNcbiAgfTtcbn1cblxuLyoqXG4gKiBWYWxpZGF0ZXMgYSByZWNpcGUgaW5ncmVkaWVudFxuICovXG5leHBvcnQgZnVuY3Rpb24gdmFsaWRhdGVSZWNpcGVJbmdyZWRpZW50KGluZ3JlZGllbnQ6IFBhcnRpYWw8UmVjaXBlSW5ncmVkaWVudD4pOiB7XG4gIGlzVmFsaWQ6IGJvb2xlYW47XG4gIGVycm9yczogc3RyaW5nW107XG59IHtcbiAgY29uc3QgZXJyb3JzOiBzdHJpbmdbXSA9IFtdO1xuXG4gIC8vIENoZWNrIHJlcXVpcmVkIGZpZWxkc1xuICBpZiAoIWluZ3JlZGllbnQubmFtZSkge1xuICAgIGVycm9ycy5wdXNoKCdOYW1lIGlzIHJlcXVpcmVkJyk7XG4gIH1cblxuICBpZiAodHlwZW9mIGluZ3JlZGllbnQuYW1vdW50ICE9PSAnbnVtYmVyJykge1xuICAgIGVycm9ycy5wdXNoKCdBbW91bnQgbXVzdCBiZSBhIG51bWJlcicpO1xuICB9XG5cbiAgaWYgKCFpbmdyZWRpZW50LnVuaXQpIHtcbiAgICBlcnJvcnMucHVzaCgnVW5pdCBpcyByZXF1aXJlZCcpO1xuICB9XG5cbiAgLy8gSWYgZWxlbWVudGFsIHByb3BlcnRpZXMgYXJlIHByb3ZpZGVkLCB2YWxpZGF0ZSB0aGVtXG4gIGlmIChpbmdyZWRpZW50LmVsZW1lbnRhbFByb3BlcnRpZXMpIHtcbiAgICBjb25zdCB7IEZpcmUsIFdhdGVyLCBFYXJ0aCwgQWlyIH0gPSBpbmdyZWRpZW50LmVsZW1lbnRhbFByb3BlcnRpZXM7XG4gICAgXG4gICAgaWYgKHR5cGVvZiBGaXJlICE9PSAnbnVtYmVyJyB8fCBGaXJlIDwgMCB8fCBGaXJlID4gMSkge1xuICAgICAgZXJyb3JzLnB1c2goJ0ZpcmUgZWxlbWVudGFsIHByb3BlcnR5IG11c3QgYmUgYSBudW1iZXIgYmV0d2VlbiAwIGFuZCAxJyk7XG4gICAgfVxuICAgIGlmICh0eXBlb2YgV2F0ZXIgIT09ICdudW1iZXInIHx8IFdhdGVyIDwgMCB8fCBXYXRlciA+IDEpIHtcbiAgICAgIGVycm9ycy5wdXNoKCdXYXRlciBlbGVtZW50YWwgcHJvcGVydHkgbXVzdCBiZSBhIG51bWJlciBiZXR3ZWVuIDAgYW5kIDEnKTtcbiAgICB9XG4gICAgaWYgKHR5cGVvZiBFYXJ0aCAhPT0gJ251bWJlcicgfHwgRWFydGggPCAwIHx8IEVhcnRoID4gMSkge1xuICAgICAgZXJyb3JzLnB1c2goJ0VhcnRoIGVsZW1lbnRhbCBwcm9wZXJ0eSBtdXN0IGJlIGEgbnVtYmVyIGJldHdlZW4gMCBhbmQgMScpO1xuICAgIH1cbiAgICBpZiAodHlwZW9mIEFpciAhPT0gJ251bWJlcicgfHwgQWlyIDwgMCB8fCBBaXIgPiAxKSB7XG4gICAgICBlcnJvcnMucHVzaCgnQWlyIGVsZW1lbnRhbCBwcm9wZXJ0eSBtdXN0IGJlIGEgbnVtYmVyIGJldHdlZW4gMCBhbmQgMScpO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiB7XG4gICAgaXNWYWxpZDogZXJyb3JzLmxlbmd0aCA9PT0gMCxcbiAgICBlcnJvcnNcbiAgfTtcbn1cblxuLyoqXG4gKiBNZXJnZXMgdHdvIHNldHMgb2YgZWxlbWVudGFsIHByb3BlcnRpZXMgd2l0aCBvcHRpb25hbCB3ZWlnaHRpbmdcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIG1lcmdlRWxlbWVudGFsUHJvcGVydGllcyhcbiAgYmFzZTogRWxlbWVudGFsUHJvcGVydGllcyxcbiAgYWRkaXRpb246IEVsZW1lbnRhbFByb3BlcnRpZXMsXG4gIHdlaWdodCA9IDAuNVxuKTogRWxlbWVudGFsUHJvcGVydGllcyB7XG4gIHJldHVybiB7XG4gICAgRmlyZTogYmFzZS5GaXJlICogKDEgLSB3ZWlnaHQpICsgYWRkaXRpb24uRmlyZSAqIHdlaWdodCxcbiAgICBXYXRlcjogYmFzZS5XYXRlciAqICgxIC0gd2VpZ2h0KSArIGFkZGl0aW9uLldhdGVyICogd2VpZ2h0LFxuICAgIEVhcnRoOiBiYXNlLkVhcnRoICogKDEgLSB3ZWlnaHQpICsgYWRkaXRpb24uRWFydGggKiB3ZWlnaHQsXG4gICAgQWlyOiBiYXNlLkFpciAqICgxIC0gd2VpZ2h0KSArIGFkZGl0aW9uLkFpciAqIHdlaWdodFxuICB9O1xufVxuXG4vKipcbiAqIEdldHMgdGhlIGRvbWluYW50IGVsZW1lbnQgZnJvbSBhbiBFbGVtZW50YWxQcm9wZXJ0aWVzIG9iamVjdFxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0RG9taW5hbnRFbGVtZW50KGVsZW1lbnRhbFByb3BlcnRpZXM6IEVsZW1lbnRhbFByb3BlcnRpZXMpOiBzdHJpbmcge1xuICBjb25zdCB7IEZpcmUsIFdhdGVyLCBFYXJ0aCwgQWlyIH0gPSBlbGVtZW50YWxQcm9wZXJ0aWVzO1xuICBjb25zdCBtYXggPSBNYXRoLm1heChGaXJlLCBXYXRlciwgRWFydGgsIEFpcik7XG4gIFxuICBpZiAobWF4ID09PSBGaXJlKSByZXR1cm4gJ0ZpcmUnO1xuICBpZiAobWF4ID09PSBXYXRlcikgcmV0dXJuICdXYXRlcic7XG4gIGlmIChtYXggPT09IEVhcnRoKSByZXR1cm4gJ0VhcnRoJztcbiAgaWYgKG1heCA9PT0gQWlyKSByZXR1cm4gJ0Fpcic7XG4gIFxuICByZXR1cm4gJ0JhbGFuY2VkJztcbn1cblxuLyoqXG4gKiBDb252ZXJ0cyBhbiBpbmdyZWRpZW50IG1hcHBpbmcgdG8gYSBmdWxsIGluZ3JlZGllbnRcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIG1hcFRvSW5ncmVkaWVudChtYXBwaW5nOiBJbmdyZWRpZW50TWFwcGluZyk6IEluZ3JlZGllbnQge1xuICAvLyBTZXQgZGVmYXVsdCB2YWx1ZXMgZm9yIHJlcXVpcmVkIHByb3BlcnRpZXNcbiAgY29uc3QgaW5ncmVkaWVudCA9IHtcbiAgICBuYW1lOiAobWFwcGluZy5uYW1lIGFzIHVua25vd24gYXMgc3RyaW5nKSB8fCAnJyxcbiAgICBjYXRlZ29yeTogKG1hcHBpbmcuY2F0ZWdvcnkgYXMgdW5rbm93biBhcyBJbmdyZWRpZW50Q2F0ZWdvcnkpIHx8ICdjdWxpbmFyeV9oZXJiJyxcbiAgICBlbGVtZW50YWxQcm9wZXJ0aWVzOiAobWFwcGluZy5lbGVtZW50YWxQcm9wZXJ0aWVzIGFzIHVua25vd24gYXMgRWxlbWVudGFsUHJvcGVydGllcykgfHwgeyBGaXJlOiAwLjI1LCBXYXRlcjogMC4yNSwgRWFydGg6IDAuMjUsIEFpcjogMC4yNSB9LFxuICAgIHF1YWxpdGllczogKG1hcHBpbmcucXVhbGl0aWVzIGFzIHVua25vd24gYXMgc3RyaW5nW10pIHx8IFtdLFxuICAgIHN0b3JhZ2U6IChtYXBwaW5nLnN0b3JhZ2UgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pIHx8IHtcbiAgICAgIGR1cmF0aW9uOiAndW5rbm93bidcbiAgICB9LFxuICAgIC8vIEFkZCBtaXNzaW5nIHJlcXVpcmVkIHByb3BlcnRpZXMgZm9yIEluZ3JlZGllbnQgaW50ZXJmYWNlXG4gICAgYW1vdW50OiAobWFwcGluZyBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPikuYW1vdW50IHx8IDEsXG4gICAgYXN0cm9sb2dpY2FsUHJvZmlsZTogKG1hcHBpbmcgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pLmFzdHJvbG9naWNhbFByb2ZpbGUgfHwge1xuICAgICAgZWxlbWVudGFsQWZmaW5pdHk6IHsgYmFzZTogJ0VhcnRoJyB9LFxuICAgICAgcnVsaW5nUGxhbmV0czogW10sXG4gICAgICB6b2RpYWNBZmZpbml0eTogW11cbiAgICB9XG4gIH0gYXMgSW5ncmVkaWVudDtcblxuICAvLyBBZGQgYW55IGFkZGl0aW9uYWwgcHJvcGVydGllcyBmcm9tIHRoZSBtYXBwaW5nXG4gIGZvciAoY29uc3Qga2V5IGluIG1hcHBpbmcpIHtcbiAgICBpZiAoa2V5ICE9PSAnbmFtZScgJiYga2V5ICE9PSAnY2F0ZWdvcnknICYmIGtleSAhPT0gJ2VsZW1lbnRhbFByb3BlcnRpZXMnICYmIGtleSAhPT0gJ3F1YWxpdGllcycpIHtcbiAgICAgIChpbmdyZWRpZW50IGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KVtrZXldID0gbWFwcGluZ1trZXldO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBpbmdyZWRpZW50O1xufVxuXG4vKipcbiAqIENvbnZlcnRzIGEgZnVsbCBpbmdyZWRpZW50IHRvIGEgcmVjaXBlIGluZ3JlZGllbnRcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGluZ3JlZGllbnRUb1JlY2lwZUluZ3JlZGllbnQoXG4gIGluZ3JlZGllbnQ6IEluZ3JlZGllbnQsXG4gIGFtb3VudCA9IDEsXG4gIHVuaXQgPSAnaXRlbSdcbik6IFJlY2lwZUluZ3JlZGllbnQge1xuICByZXR1cm4ge1xuICAgIG5hbWU6IGluZ3JlZGllbnQubmFtZSxcbiAgICBhbW91bnQsXG4gICAgdW5pdCxcbiAgICBjYXRlZ29yeTogKGluZ3JlZGllbnQuY2F0ZWdvcnkgYXMgc3RyaW5nKSB8fCAnY3VsaW5hcnlfaGVyYicsXG4gICAgZWxlbWVudGFsUHJvcGVydGllczogaW5ncmVkaWVudC5lbGVtZW50YWxQcm9wZXJ0aWVzIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+LFxuICAgIHF1YWxpdGllczogKGluZ3JlZGllbnQgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pPy5xdWFsaXRpZXMgfHwgW10sXG4gICAgYXN0cm9sb2dpY2FsUHJvZmlsZTogaW5ncmVkaWVudC5hc3Ryb2xvZ2ljYWxQcm9maWxlLFxuICAgIC8vIEluY2x1ZGUgb3RoZXIgcmVsZXZhbnQgcHJvcGVydGllcyB0aGF0IGV4aXN0IGluIFJlY2lwZUluZ3JlZGllbnQgLSBzYWZlIHByb3BlcnR5IGFjY2Vzc1xuICAgIG9yaWdpbjogKGluZ3JlZGllbnQgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pPy5vcmlnaW4gfHwgdW5kZWZpbmVkLFxuICAgIHNlYXNvbmFsaXR5OiAoaW5ncmVkaWVudCBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPik/LnNlYXNvbmFsaXR5IHx8IHVuZGVmaW5lZFxuICB9IGFzIFJlY2lwZUluZ3JlZGllbnQ7XG59XG5cbi8qKlxuICogTm9ybWFsaXplcyBlbGVtZW50YWwgcHJvcGVydGllcyB0byBlbnN1cmUgdGhleSBzdW0gdG8gMVxuICovXG5leHBvcnQgZnVuY3Rpb24gbm9ybWFsaXplRWxlbWVudGFsUHJvcGVydGllcyhwcm9wZXJ0aWVzOiBFbGVtZW50YWxQcm9wZXJ0aWVzKTogRWxlbWVudGFsUHJvcGVydGllcyB7XG4gIGNvbnN0IHsgRmlyZSwgV2F0ZXIsIEVhcnRoLCBBaXIgfSA9IHByb3BlcnRpZXM7XG4gIGNvbnN0IHN1bSA9IEZpcmUgKyBXYXRlciArIEVhcnRoICsgQWlyO1xuICBcbiAgaWYgKHN1bSA9PT0gMCkge1xuICAgIC8vIElmIGFsbCB2YWx1ZXMgYXJlIDAsIHJldHVybiBhbiBldmVubHkgYmFsYW5jZWQgc2V0XG4gICAgcmV0dXJuIHsgRmlyZTogMC4yNSwgV2F0ZXI6IDAuMjUsIEVhcnRoOiAwLjI1LCBBaXI6IDAuMjUgfTtcbiAgfVxuICBcbiAgcmV0dXJuIHtcbiAgICBGaXJlOiBGaXJlIC8gc3VtLFxuICAgIFdhdGVyOiBXYXRlciAvIHN1bSxcbiAgICBFYXJ0aDogRWFydGggLyBzdW0sXG4gICAgQWlyOiBBaXIgLyBzdW1cbiAgfTtcbn0gIl0sInZlcnNpb24iOjN9