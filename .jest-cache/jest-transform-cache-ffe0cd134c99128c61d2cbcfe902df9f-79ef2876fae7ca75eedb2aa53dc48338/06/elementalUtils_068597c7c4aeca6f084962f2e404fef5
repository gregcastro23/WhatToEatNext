8f81e870b7ba017f9daad1d69921483f
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getDominantElement = exports.calculateElementalCompatibility = exports.scaleElementalProperties = exports.mergeElementalProperties = exports.getElementalProperty = exports.isElementalProperties = exports.createElementalProperties = void 0;
/**
 * Creates a properly initialized ElementalProperties object with default values
 */
function createElementalProperties(props) {
    return { Fire: (props?.Fire ?? 0), Water: (props?.Water ?? 0), Earth: (props?.Earth ?? 0), Air: (props?.Air ?? 0) };
}
exports.createElementalProperties = createElementalProperties;
/**
 * Type guard to check if an object is a valid ElementalProperties object
 */
function isElementalProperties(obj) {
    if (!obj || typeof obj !== 'object')
        return false;
    return (typeof obj.Fire === 'number' &&
        typeof obj.Water === 'number' &&
        typeof obj.Earth === 'number' &&
        typeof obj.Air === 'number');
}
exports.isElementalProperties = isElementalProperties;
/**
 * Safely access elemental properties with fallback to default values
 */
function getElementalProperty(props, element) {
    if (!props)
        return 0;
    return props[element] ?? 0;
}
exports.getElementalProperty = getElementalProperty;
/**
 * Merge two ElementalProperties objects
 */
function mergeElementalProperties(base, override) {
    return createElementalProperties({ Fire: ((base?.Fire ?? 0)) + ((override?.Fire ?? 0)), Water: ((base?.Water ?? 0)) + ((override?.Water ?? 0)), Earth: ((base?.Earth ?? 0)) + ((override?.Earth ?? 0)), Air: ((base?.Air ?? 0)) + ((override?.Air ?? 0)) });
}
exports.mergeElementalProperties = mergeElementalProperties;
/**
 * Scale elemental properties by a factor
 */
function scaleElementalProperties(props, factor) {
    if (!props)
        return createElementalProperties({ Fire: 0, Water: 0, Earth: 0, Air: 0 });
    return createElementalProperties({ Fire: ((props.Fire ?? 0)) * factor, Water: ((props.Water ?? 0)) * factor, Earth: ((props.Earth ?? 0)) * factor, Air: ((props.Air ?? 0)) * factor });
}
exports.scaleElementalProperties = scaleElementalProperties;
/**
 * Calculate compatibility score between two ElementalProperties objects
 * Following our elemental principles:
 * 1. Elements reinforce themselves most strongly
 * 2. All element combinations have good compatibility (0.7+)
 * 3. No opposing elements - all elements work together harmoniously
 *
 * @param source - The source elemental properties
 * @param target - The target elemental properties to compare against
 * @returns A compatibility score between 0 and 1
 */
function calculateElementalCompatibility(source, target) {
    // Return default score if either source or target is missing
    if (!source || !target)
        return 0.5;
    // Ensure we have complete properties objects
    const sourceProps = createElementalProperties(source);
    const targetProps = createElementalProperties(target);
    // Define element compatibility scores (same elements have highest compatibility)
    const compatibilityScores = { Fire: { Fire: 0.9, Water: 0.7, Earth: 0.7, Air: 0.8 },
        Water: { Water: 0.9, Fire: 0.7, Earth: 0.8, Air: 0.7 },
        Earth: { Earth: 0.9, Fire: 0.7, Water: 0.8, Air: 0.7 },
        Air: { Air: 0.9, Fire: 0.8, Water: 0.7, Earth: 0.7 }
    };
    // Get dominant elements for each profile
    const sourceDominant = getDominantElement(sourceProps);
    const targetDominant = getDominantElement(targetProps);
    // Calculate direct compatibility between dominant elements
    const baseCompatibility = compatibilityScores[sourceDominant][targetDominant] || 0.7;
    // Calculate weighted compatibility across all elements
    let weightedSum = 0;
    let totalWeight = 0;
    const elements = ['Fire', 'Water', 'Earth', 'Air'];
    for (const sourceElement of elements) {
        const sourceValue = sourceProps[sourceElement];
        if (sourceValue <= 0)
            continue; // Skip elements with no presence
        // Weight by the element's prominence in the source
        const weight = sourceValue;
        // For each source element, calculate its compatibility with each target element
        let bestCompatibility = 0;
        for (const targetElement of elements) {
            const targetValue = targetProps[targetElement];
            if (targetValue <= 0)
                continue; // Skip elements with no presence
            // Get compatibility between these two elements
            const elementCompatibility = compatibilityScores[sourceElement][targetElement] || 0.7;
            // Scale by the target element's prominence
            const scaledCompatibility = elementCompatibility * targetValue;
            bestCompatibility = Math.max(bestCompatibility, scaledCompatibility);
        }
        weightedSum += bestCompatibility * weight;
        totalWeight += weight;
    }
    // Calculate final score - ensure minimum of 0.7 following our principles
    const finalScore = totalWeight > 0
        ? Math.max(0.7, weightedSum / totalWeight)
        : 0.7;
    return finalScore;
}
exports.calculateElementalCompatibility = calculateElementalCompatibility;
/**
 * Get the dominant element from elemental properties
 */
function getDominantElement(properties) {
    return Object.entries(properties)
        .reduce((max, [element, value]) => value > max.value ? { element: element, value } : max, { element: 'Fire', value: 0 }).element;
}
exports.getDominantElement = getDominantElement;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy91dGlscy9lbGVtZW50YWwvZWxlbWVudGFsVXRpbHMudHMiLCJtYXBwaW5ncyI6Ijs7O0FBRUE7O0dBRUc7QUFDSCxTQUFnQix5QkFBeUIsQ0FDdkMsS0FBb0M7SUFDYixPQUFPLEVBQUUsSUFBSSxFQUFFLENBQUMsS0FBSyxFQUFFLElBQUksSUFBSSxDQUFDLENBQUMsRUFBRSxLQUFLLEVBQUUsQ0FBQyxLQUFLLEVBQUUsS0FBSyxJQUFJLENBQUMsQ0FBQyxFQUFFLEtBQUssRUFBRSxDQUFDLEtBQUssRUFBRSxLQUFLLElBQUksQ0FBQyxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMsS0FBSyxFQUFFLEdBQUcsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDO0FBQzdJLENBQUM7QUFIRCw4REFHQztBQUVEOztHQUVHO0FBQ0gsU0FBZ0IscUJBQXFCLENBQUMsR0FBWTtJQUNoRCxJQUFJLENBQUMsR0FBRyxJQUFJLE9BQU8sR0FBRyxLQUFLLFFBQVE7UUFBRSxPQUFPLEtBQUssQ0FBQztJQUNsRCxPQUFPLENBQ0wsT0FBUSxHQUEyQixDQUFDLElBQUksS0FBSyxRQUFRO1FBQ3JELE9BQVEsR0FBMkIsQ0FBQyxLQUFLLEtBQUssUUFBUTtRQUN0RCxPQUFRLEdBQTJCLENBQUMsS0FBSyxLQUFLLFFBQVE7UUFDdEQsT0FBUSxHQUEyQixDQUFDLEdBQUcsS0FBSyxRQUFRLENBQ3JELENBQUM7QUFDSixDQUFDO0FBUkQsc0RBUUM7QUFFRDs7R0FFRztBQUNILFNBQWdCLG9CQUFvQixDQUNsQyxLQUErQyxFQUMvQyxPQUFrQztJQUVsQyxJQUFJLENBQUMsS0FBSztRQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQ3JCLE9BQU8sS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztBQUM3QixDQUFDO0FBTkQsb0RBTUM7QUFFRDs7R0FFRztBQUNILFNBQWdCLHdCQUF3QixDQUN0QyxJQUE4QyxFQUM5QyxRQUFrRDtJQUMz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LHlFQUF5RTtJQUN6RSxNQUFNLFVBQVUsR0FBRyxXQUFXLEdBQUcsQ0FBQztRQUNoQyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsV0FBVyxHQUFHLFdBQVcsQ0FBQztRQUMxQyxDQUFDLENBQUMsR0FBRyxDQUFDO0lBRVIsT0FBTyxVQUFVLENBQUM7QUFDcEIsQ0FBQztBQTlERCwwRUE4REM7QUFFRDs7R0FFRztBQUNILFNBQWdCLGtCQUFrQixDQUFDLFVBQStCO0lBQ2hFLE9BQU8sTUFBTSxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUM7U0FDOUIsTUFBTSxDQUFDLENBQUMsR0FBRyxFQUFFLENBQUMsT0FBTyxFQUFFLEtBQUssQ0FBQyxFQUFFLEVBQUUsQ0FDaEMsS0FBSyxHQUFHLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEVBQUUsT0FBTyxFQUFFLE9BQTZDLEVBQUUsS0FBSyxFQUFFLENBQUMsQ0FBQyxDQUFDLEdBQUcsRUFDM0YsRUFBRSxPQUFPLEVBQUUsTUFBbUMsRUFBRSxLQUFLLEVBQUUsQ0FBQyxFQUFFLENBQzNELENBQUMsT0FBTyxDQUFDO0FBQ2QsQ0FBQztBQU5ELGdEQU1DIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9HcmVnQ2FzdHJvL0Rlc2t0b3AvV2hhdFRvRWF0TmV4dC9zcmMvdXRpbHMvZWxlbWVudGFsL2VsZW1lbnRhbFV0aWxzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEVsZW1lbnRhbFByb3BlcnRpZXMgfSBmcm9tIFwiQC90eXBlcy9hbGNoZW15XCI7XG5cbi8qKlxuICogQ3JlYXRlcyBhIHByb3Blcmx5IGluaXRpYWxpemVkIEVsZW1lbnRhbFByb3BlcnRpZXMgb2JqZWN0IHdpdGggZGVmYXVsdCB2YWx1ZXNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZUVsZW1lbnRhbFByb3BlcnRpZXMoXG4gIHByb3BzPzogUGFydGlhbDxFbGVtZW50YWxQcm9wZXJ0aWVzPlxuKTogRWxlbWVudGFsUHJvcGVydGllcyB7IHJldHVybiB7IEZpcmU6IChwcm9wcz8uRmlyZSA/PyAwKSwgV2F0ZXI6IChwcm9wcz8uV2F0ZXIgPz8gMCksIEVhcnRoOiAocHJvcHM/LkVhcnRoID8/IDApLCBBaXI6IChwcm9wcz8uQWlyID8/IDApIH07XG59XG5cbi8qKlxuICogVHlwZSBndWFyZCB0byBjaGVjayBpZiBhbiBvYmplY3QgaXMgYSB2YWxpZCBFbGVtZW50YWxQcm9wZXJ0aWVzIG9iamVjdFxuICovXG5leHBvcnQgZnVuY3Rpb24gaXNFbGVtZW50YWxQcm9wZXJ0aWVzKG9iajogdW5rbm93bik6IG9iaiBpcyBFbGVtZW50YWxQcm9wZXJ0aWVzIHtcbiAgaWYgKCFvYmogfHwgdHlwZW9mIG9iaiAhPT0gJ29iamVjdCcpIHJldHVybiBmYWxzZTtcbiAgcmV0dXJuIChcbiAgICB0eXBlb2YgKG9iaiBhcyBFbGVtZW50YWxQcm9wZXJ0aWVzKS5GaXJlID09PSAnbnVtYmVyJyAmJlxuICAgIHR5cGVvZiAob2JqIGFzIEVsZW1lbnRhbFByb3BlcnRpZXMpLldhdGVyID09PSAnbnVtYmVyJyAmJlxuICAgIHR5cGVvZiAob2JqIGFzIEVsZW1lbnRhbFByb3BlcnRpZXMpLkVhcnRoID09PSAnbnVtYmVyJyAmJlxuICAgIHR5cGVvZiAob2JqIGFzIEVsZW1lbnRhbFByb3BlcnRpZXMpLkFpciA9PT0gJ251bWJlcidcbiAgKTtcbn1cblxuLyoqXG4gKiBTYWZlbHkgYWNjZXNzIGVsZW1lbnRhbCBwcm9wZXJ0aWVzIHdpdGggZmFsbGJhY2sgdG8gZGVmYXVsdCB2YWx1ZXNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldEVsZW1lbnRhbFByb3BlcnR5KFxuICBwcm9wczogUGFydGlhbDxFbGVtZW50YWxQcm9wZXJ0aWVzPiB8IHVuZGVmaW5lZCxcbiAgZWxlbWVudDoga2V5b2YgRWxlbWVudGFsUHJvcGVydGllc1xuKTogbnVtYmVyIHtcbiAgaWYgKCFwcm9wcykgcmV0dXJuIDA7XG4gIHJldHVybiBwcm9wc1tlbGVtZW50XSA/PyAwO1xufVxuXG4vKipcbiAqIE1lcmdlIHR3byBFbGVtZW50YWxQcm9wZXJ0aWVzIG9iamVjdHNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIG1lcmdlRWxlbWVudGFsUHJvcGVydGllcyhcbiAgYmFzZTogUGFydGlhbDxFbGVtZW50YWxQcm9wZXJ0aWVzPiB8IHVuZGVmaW5lZCxcbiAgb3ZlcnJpZGU6IFBhcnRpYWw8RWxlbWVudGFsUHJvcGVydGllcz4gfCB1bmRlZmluZWRcbik6IEVsZW1lbnRhbFByb3BlcnRpZXMgeyByZXR1cm4gY3JlYXRlRWxlbWVudGFsUHJvcGVydGllcyh7IEZpcmU6ICgoYmFzZT8uRmlyZSA/PyAwKSkgKyAoKG92ZXJyaWRlPy5GaXJlID8/IDApKSwgV2F0ZXI6ICgoYmFzZT8uV2F0ZXIgPz8gMCkpICsgKChvdmVycmlkZT8uV2F0ZXIgPz8gMCkpLCBFYXJ0aDogKChiYXNlPy5FYXJ0aCA/PyAwKSkgKyAoKG92ZXJyaWRlPy5FYXJ0aCA/PyAwKSksIEFpcjogKChiYXNlPy5BaXIgPz8gMCkpICsgKChvdmVycmlkZT8uQWlyID8/IDApKSB9KTtcbn1cblxuLyoqXG4gKiBTY2FsZSBlbGVtZW50YWwgcHJvcGVydGllcyBieSBhIGZhY3RvclxuICovXG5leHBvcnQgZnVuY3Rpb24gc2NhbGVFbGVtZW50YWxQcm9wZXJ0aWVzKFxuICBwcm9wczogUGFydGlhbDxFbGVtZW50YWxQcm9wZXJ0aWVzPiB8IHVuZGVmaW5lZCxcbiAgZmFjdG9yOiBudW1iZXJcbik6IEVsZW1lbnRhbFByb3BlcnRpZXMgeyBpZiAoIXByb3BzKSByZXR1cm4gY3JlYXRlRWxlbWVudGFsUHJvcGVydGllcyh7IEZpcmU6IDAsIFdhdGVyOiAwLCBFYXJ0aDogMCwgQWlyOiAwIH0pO1xuICBcbiAgcmV0dXJuIGNyZWF0ZUVsZW1lbnRhbFByb3BlcnRpZXMoeyBGaXJlOiAoKHByb3BzLkZpcmUgPz8gMCkpICogZmFjdG9yLCBXYXRlcjogKChwcm9wcy5XYXRlciA/PyAwKSkgKiBmYWN0b3IsIEVhcnRoOiAoKHByb3BzLkVhcnRoID8/IDApKSAqIGZhY3RvciwgQWlyOiAoKHByb3BzLkFpciA/PyAwKSkgKiBmYWN0b3IgfSk7XG59XG5cbi8qKlxuICogQ2FsY3VsYXRlIGNvbXBhdGliaWxpdHkgc2NvcmUgYmV0d2VlbiB0d28gRWxlbWVudGFsUHJvcGVydGllcyBvYmplY3RzXG4gKiBGb2xsb3dpbmcgb3VyIGVsZW1lbnRhbCBwcmluY2lwbGVzOlxuICogMS4gRWxlbWVudHMgcmVpbmZvcmNlIHRoZW1zZWx2ZXMgbW9zdCBzdHJvbmdseVxuICogMi4gQWxsIGVsZW1lbnQgY29tYmluYXRpb25zIGhhdmUgZ29vZCBjb21wYXRpYmlsaXR5ICgwLjcrKVxuICogMy4gTm8gb3Bwb3NpbmcgZWxlbWVudHMgLSBhbGwgZWxlbWVudHMgd29yayB0b2dldGhlciBoYXJtb25pb3VzbHlcbiAqIFxuICogQHBhcmFtIHNvdXJjZSAtIFRoZSBzb3VyY2UgZWxlbWVudGFsIHByb3BlcnRpZXNcbiAqIEBwYXJhbSB0YXJnZXQgLSBUaGUgdGFyZ2V0IGVsZW1lbnRhbCBwcm9wZXJ0aWVzIHRvIGNvbXBhcmUgYWdhaW5zdFxuICogQHJldHVybnMgQSBjb21wYXRpYmlsaXR5IHNjb3JlIGJldHdlZW4gMCBhbmQgMVxuICovXG5leHBvcnQgZnVuY3Rpb24gY2FsY3VsYXRlRWxlbWVudGFsQ29tcGF0aWJpbGl0eShcbiAgc291cmNlOiBQYXJ0aWFsPEVsZW1lbnRhbFByb3BlcnRpZXM+IHwgdW5kZWZpbmVkLFxuICB0YXJnZXQ6IFBhcnRpYWw8RWxlbWVudGFsUHJvcGVydGllcz4gfCB1bmRlZmluZWRcbik6IG51bWJlciB7XG4gIC8vIFJldHVybiBkZWZhdWx0IHNjb3JlIGlmIGVpdGhlciBzb3VyY2Ugb3IgdGFyZ2V0IGlzIG1pc3NpbmdcbiAgaWYgKCFzb3VyY2UgfHwgIXRhcmdldCkgcmV0dXJuIDAuNTtcbiAgXG4gIC8vIEVuc3VyZSB3ZSBoYXZlIGNvbXBsZXRlIHByb3BlcnRpZXMgb2JqZWN0c1xuICBjb25zdCBzb3VyY2VQcm9wcyA9IGNyZWF0ZUVsZW1lbnRhbFByb3BlcnRpZXMoc291cmNlKTtcbiAgY29uc3QgdGFyZ2V0UHJvcHMgPSBjcmVhdGVFbGVtZW50YWxQcm9wZXJ0aWVzKHRhcmdldCk7XG4gIFxuICAvLyBEZWZpbmUgZWxlbWVudCBjb21wYXRpYmlsaXR5IHNjb3JlcyAoc2FtZSBlbGVtZW50cyBoYXZlIGhpZ2hlc3QgY29tcGF0aWJpbGl0eSlcbiAgY29uc3QgY29tcGF0aWJpbGl0eVNjb3JlcyA9IHsgRmlyZTogeyBGaXJlOiAwLjksIFdhdGVyOiAwLjcsIEVhcnRoOiAwLjcsIEFpcjogMC44IH0sXG4gICAgV2F0ZXI6IHsgV2F0ZXI6IDAuOSwgRmlyZTogMC43LCBFYXJ0aDogMC44LCBBaXI6IDAuNyB9LFxuICAgIEVhcnRoOiB7IEVhcnRoOiAwLjksIEZpcmU6IDAuNywgV2F0ZXI6IDAuOCwgQWlyOiAwLjcgfSxcbiAgICBBaXI6IHsgQWlyOiAwLjksIEZpcmU6IDAuOCwgV2F0ZXI6IDAuNywgRWFydGg6IDAuNyB9XG4gIH07XG4gIFxuICAvLyBHZXQgZG9taW5hbnQgZWxlbWVudHMgZm9yIGVhY2ggcHJvZmlsZVxuICBjb25zdCBzb3VyY2VEb21pbmFudCA9IGdldERvbWluYW50RWxlbWVudChzb3VyY2VQcm9wcyk7XG4gIGNvbnN0IHRhcmdldERvbWluYW50ID0gZ2V0RG9taW5hbnRFbGVtZW50KHRhcmdldFByb3BzKTtcbiAgXG4gIC8vIENhbGN1bGF0ZSBkaXJlY3QgY29tcGF0aWJpbGl0eSBiZXR3ZWVuIGRvbWluYW50IGVsZW1lbnRzXG4gIGNvbnN0IGJhc2VDb21wYXRpYmlsaXR5ID0gY29tcGF0aWJpbGl0eVNjb3Jlc1tzb3VyY2VEb21pbmFudF1bdGFyZ2V0RG9taW5hbnRdIHx8IDAuNztcbiAgXG4gIC8vIENhbGN1bGF0ZSB3ZWlnaHRlZCBjb21wYXRpYmlsaXR5IGFjcm9zcyBhbGwgZWxlbWVudHNcbiAgbGV0IHdlaWdodGVkU3VtID0gMDtcbiAgbGV0IHRvdGFsV2VpZ2h0ID0gMDtcbiAgXG4gIGNvbnN0IGVsZW1lbnRzOiBBcnJheTxrZXlvZiBFbGVtZW50YWxQcm9wZXJ0aWVzPiA9IFsnRmlyZScsICdXYXRlcicsICdFYXJ0aCcsICdBaXInXTtcbiAgXG4gIGZvciAoY29uc3Qgc291cmNlRWxlbWVudCBvZiBlbGVtZW50cykge1xuICAgIGNvbnN0IHNvdXJjZVZhbHVlID0gc291cmNlUHJvcHNbc291cmNlRWxlbWVudF07XG4gICAgaWYgKHNvdXJjZVZhbHVlIDw9IDApIGNvbnRpbnVlOyAvLyBTa2lwIGVsZW1lbnRzIHdpdGggbm8gcHJlc2VuY2VcbiAgICBcbiAgICAvLyBXZWlnaHQgYnkgdGhlIGVsZW1lbnQncyBwcm9taW5lbmNlIGluIHRoZSBzb3VyY2VcbiAgICBjb25zdCB3ZWlnaHQgPSBzb3VyY2VWYWx1ZTtcbiAgICBcbiAgICAvLyBGb3IgZWFjaCBzb3VyY2UgZWxlbWVudCwgY2FsY3VsYXRlIGl0cyBjb21wYXRpYmlsaXR5IHdpdGggZWFjaCB0YXJnZXQgZWxlbWVudFxuICAgIGxldCBiZXN0Q29tcGF0aWJpbGl0eSA9IDA7XG4gICAgZm9yIChjb25zdCB0YXJnZXRFbGVtZW50IG9mIGVsZW1lbnRzKSB7XG4gICAgICBjb25zdCB0YXJnZXRWYWx1ZSA9IHRhcmdldFByb3BzW3RhcmdldEVsZW1lbnRdO1xuICAgICAgaWYgKHRhcmdldFZhbHVlIDw9IDApIGNvbnRpbnVlOyAvLyBTa2lwIGVsZW1lbnRzIHdpdGggbm8gcHJlc2VuY2VcbiAgICAgIFxuICAgICAgLy8gR2V0IGNvbXBhdGliaWxpdHkgYmV0d2VlbiB0aGVzZSB0d28gZWxlbWVudHNcbiAgICAgIGNvbnN0IGVsZW1lbnRDb21wYXRpYmlsaXR5ID0gY29tcGF0aWJpbGl0eVNjb3Jlc1tzb3VyY2VFbGVtZW50XVt0YXJnZXRFbGVtZW50XSB8fCAwLjc7XG4gICAgICBcbiAgICAgIC8vIFNjYWxlIGJ5IHRoZSB0YXJnZXQgZWxlbWVudCdzIHByb21pbmVuY2VcbiAgICAgIGNvbnN0IHNjYWxlZENvbXBhdGliaWxpdHkgPSBlbGVtZW50Q29tcGF0aWJpbGl0eSAqIHRhcmdldFZhbHVlO1xuICAgICAgYmVzdENvbXBhdGliaWxpdHkgPSBNYXRoLm1heChiZXN0Q29tcGF0aWJpbGl0eSwgc2NhbGVkQ29tcGF0aWJpbGl0eSk7XG4gICAgfVxuICAgIFxuICAgIHdlaWdodGVkU3VtICs9IGJlc3RDb21wYXRpYmlsaXR5ICogd2VpZ2h0O1xuICAgIHRvdGFsV2VpZ2h0ICs9IHdlaWdodDtcbiAgfVxuICBcbiAgLy8gQ2FsY3VsYXRlIGZpbmFsIHNjb3JlIC0gZW5zdXJlIG1pbmltdW0gb2YgMC43IGZvbGxvd2luZyBvdXIgcHJpbmNpcGxlc1xuICBjb25zdCBmaW5hbFNjb3JlID0gdG90YWxXZWlnaHQgPiAwIFxuICAgID8gTWF0aC5tYXgoMC43LCB3ZWlnaHRlZFN1bSAvIHRvdGFsV2VpZ2h0KSBcbiAgICA6IDAuNztcbiAgXG4gIHJldHVybiBmaW5hbFNjb3JlO1xufVxuXG4vKipcbiAqIEdldCB0aGUgZG9taW5hbnQgZWxlbWVudCBmcm9tIGVsZW1lbnRhbCBwcm9wZXJ0aWVzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXREb21pbmFudEVsZW1lbnQocHJvcGVydGllczogRWxlbWVudGFsUHJvcGVydGllcyk6IGtleW9mIEVsZW1lbnRhbFByb3BlcnRpZXMge1xuICByZXR1cm4gT2JqZWN0LmVudHJpZXMocHJvcGVydGllcylcbiAgICAucmVkdWNlKChtYXgsIFtlbGVtZW50LCB2YWx1ZV0pID0+IFxuICAgICAgdmFsdWUgPiBtYXgudmFsdWUgPyB7IGVsZW1lbnQ6IGVsZW1lbnQgYXMgXCJGaXJlXCIgfCBcIldhdGVyXCIgfCBcIkVhcnRoXCIgfCBcIkFpclwiLCB2YWx1ZSB9IDogbWF4LCBcbiAgICAgIHsgZWxlbWVudDogJ0ZpcmUnIGFzIGtleW9mIEVsZW1lbnRhbFByb3BlcnRpZXMsIHZhbHVlOiAwIH1cbiAgICApLmVsZW1lbnQ7XG59ICJdLCJ2ZXJzaW9uIjozfQ==