75d77bc217ce1d1b5ff4e69a42958040
"use strict";
/**
 * Progressive Improvement Engine
 * Orchestrates batch processing with adaptive strategies and progress tracking
 */
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.ProgressiveImprovementEngine = void 0;
const child_process_1 = require("child_process");
const fs = __importStar(require("fs"));
const path = __importStar(require("path"));
const AnyTypeClassifier_1 = require("./AnyTypeClassifier");
const DomainContextAnalyzer_1 = require("./DomainContextAnalyzer");
const SafeTypeReplacer_1 = require("./SafeTypeReplacer");
class ProgressiveImprovementEngine {
    classifier;
    replacer;
    analyzer;
    processedFiles = new Set();
    batchCounter = 0;
    batchHistory = [];
    adaptiveConfig;
    safetyCheckpoints = new Map();
    constructor(initialConfig) {
        this.classifier = new AnyTypeClassifier_1.AnyTypeClassifier();
        this.replacer = new SafeTypeReplacer_1.SafeTypeReplacer();
        this.analyzer = new DomainContextAnalyzer_1.DomainContextAnalyzer();
        // Initialize adaptive configuration with defaults
        this.adaptiveConfig = {
            maxFilesPerBatch: initialConfig?.maxFilesPerBatch || 15,
            targetReductionPercentage: initialConfig?.targetReductionPercentage || 15,
            confidenceThreshold: initialConfig?.confidenceThreshold || 0.8,
            enableDomainAnalysis: initialConfig?.enableDomainAnalysis ?? true,
            enableDocumentation: initialConfig?.enableDocumentation ?? true,
            safetyLevel: initialConfig?.safetyLevel || 'MODERATE',
            validationFrequency: initialConfig?.validationFrequency || 5
        };
    }
    /**
     * Adapt strategy based on recent batch performance
     */
    adaptStrategy() {
        if (this.batchHistory.length < 2)
            return;
        const recentBatches = this.batchHistory.slice(-3);
        const averageSuccessRate = recentBatches.reduce((sum, batch) => sum + (batch.replacementsSuccessful / Math.max(1, batch.replacementsAttempted)), 0) / recentBatches.length;
        const averageSafetyScore = recentBatches.reduce((sum, batch) => sum + batch.safetyScore, 0) / recentBatches.length;
        console.log(`Adapting strategy - Success rate: ${(averageSuccessRate * 100).toFixed(1)}%, Safety score: ${averageSafetyScore.toFixed(2)}`);
        // Adapt batch size based on safety score
        if (averageSafetyScore < 0.7) {
            // Reduce batch size for safety
            this.adaptiveConfig.maxFilesPerBatch = Math.max(5, Math.floor(this.adaptiveConfig.maxFilesPerBatch * 0.7));
            this.adaptiveConfig.confidenceThreshold = Math.min(0.95, this.adaptiveConfig.confidenceThreshold + 0.1);
            console.log(`Reduced batch size to ${this.adaptiveConfig.maxFilesPerBatch} and increased confidence threshold to ${this.adaptiveConfig.confidenceThreshold}`);
        }
        else if (averageSafetyScore > 0.9 && averageSuccessRate > 0.8) {
            // Increase batch size for efficiency
            this.adaptiveConfig.maxFilesPerBatch = Math.min(25, Math.floor(this.adaptiveConfig.maxFilesPerBatch * 1.2));
            this.adaptiveConfig.confidenceThreshold = Math.max(0.7, this.adaptiveConfig.confidenceThreshold - 0.05);
            console.log(`Increased batch size to ${this.adaptiveConfig.maxFilesPerBatch} and decreased confidence threshold to ${this.adaptiveConfig.confidenceThreshold}`);
        }
        // Adapt confidence threshold based on success rate
        if (averageSuccessRate < 0.5) {
            this.adaptiveConfig.confidenceThreshold = Math.min(0.95, this.adaptiveConfig.confidenceThreshold + 0.1);
            console.log(`Low success rate, increased confidence threshold to ${this.adaptiveConfig.confidenceThreshold}`);
        }
        // Adapt validation frequency based on safety
        if (averageSafetyScore < 0.8) {
            this.adaptiveConfig.validationFrequency = Math.max(3, this.adaptiveConfig.validationFrequency - 1);
            console.log(`Increased validation frequency to every ${this.adaptiveConfig.validationFrequency} files`);
        }
    }
    /**
     * Create a safety checkpoint
     */
    async createSafetyCheckpoint() {
        const progress = await this.getCurrentProgress();
        this.safetyCheckpoints.set(this.batchCounter, progress);
        console.log(`Safety checkpoint created at batch ${this.batchCounter}`);
    }
    /**
     * Get comprehensive progress metrics
     */
    async getProgressMetrics() {
        return await this.getCurrentProgress();
    }
    /**
     * Get batch execution history
     */
    getBatchHistory() {
        return [...this.batchHistory];
    }
    /**
     * Get current adaptive configuration
     */
    getAdaptiveConfig() {
        return { ...this.adaptiveConfig };
    }
    /**
     * Set realistic targets based on historical success rates and codebase analysis
     */
    async setRealisticTargets() {
        const currentProgress = await this.getCurrentProgress();
        const candidateFiles = await this.findFilesWithAnyTypes();
        // Analyze file types and complexity
        const fileAnalysis = await this.analyzeFileComplexity(candidateFiles.slice(0, 20));
        // Calculate base success rate expectations
        const baseSuccessRate = this.calculateExpectedSuccessRate(fileAnalysis);
        // Historical data shows previous attempts achieved 1.7% reduction (30 fixes)
        // Target 10x improvement = 17% reduction (300 fixes)
        // But be realistic based on file analysis
        let recommendedTarget = 15; // Default 15% as per requirements
        const reasoning = [];
        // Adjust based on file complexity
        if (fileAnalysis.testFilePercentage > 30) {
            reasoning.push(`${fileAnalysis.testFilePercentage.toFixed(1)}% of files are test files - focusing on non-test files first`);
            recommendedTarget = Math.max(12, recommendedTarget - 3);
        }
        if (fileAnalysis.arrayTypePercentage > 20) {
            reasoning.push(`${fileAnalysis.arrayTypePercentage.toFixed(1)}% are array types with historically 100% success rate`);
            recommendedTarget = Math.min(20, recommendedTarget + 2);
        }
        if (fileAnalysis.recordTypePercentage > 15) {
            reasoning.push(`${fileAnalysis.recordTypePercentage.toFixed(1)}% are Record types with mixed success - being selective`);
            recommendedTarget = Math.max(10, recommendedTarget - 2);
        }
        if (fileAnalysis.functionParamPercentage > 25) {
            reasoning.push(`${fileAnalysis.functionParamPercentage.toFixed(1)}% are function parameters with high failure rate - being conservative`);
            recommendedTarget = Math.max(8, recommendedTarget - 5);
        }
        // Adjust based on historical batch performance if available
        if (this.batchHistory.length > 0) {
            const avgSuccessRate = this.batchHistory.reduce((sum, batch) => sum + (batch.replacementsSuccessful / Math.max(1, batch.replacementsAttempted)), 0) / this.batchHistory.length;
            if (avgSuccessRate > 0.8) {
                reasoning.push(`High historical success rate (${(avgSuccessRate * 100).toFixed(1)}%) - increasing target`);
                recommendedTarget = Math.min(25, recommendedTarget + 3);
            }
            else if (avgSuccessRate < 0.5) {
                reasoning.push(`Low historical success rate (${(avgSuccessRate * 100).toFixed(1)}%) - reducing target`);
                recommendedTarget = Math.max(5, recommendedTarget - 5);
            }
        }
        // Create realistic milestones
        const milestones = [
            {
                percentage: Math.floor(recommendedTarget * 0.25),
                description: 'Initial progress - focus on high-confidence array types',
                estimatedBatches: Math.ceil(candidateFiles.length * 0.1 / this.adaptiveConfig.maxFilesPerBatch)
            },
            {
                percentage: Math.floor(recommendedTarget * 0.5),
                description: 'Mid-point - expand to Record types and simple patterns',
                estimatedBatches: Math.ceil(candidateFiles.length * 0.3 / this.adaptiveConfig.maxFilesPerBatch)
            },
            {
                percentage: Math.floor(recommendedTarget * 0.75),
                description: 'Advanced progress - tackle more complex patterns',
                estimatedBatches: Math.ceil(candidateFiles.length * 0.6 / this.adaptiveConfig.maxFilesPerBatch)
            },
            {
                percentage: recommendedTarget,
                description: 'Target achievement - complete remaining high-confidence cases',
                estimatedBatches: Math.ceil(candidateFiles.length * 0.8 / this.adaptiveConfig.maxFilesPerBatch)
            }
        ];
        reasoning.push(`Recommended target: ${recommendedTarget}% reduction (${Math.floor(currentProgress.totalAnyTypes * recommendedTarget / 100)} fixes)`);
        reasoning.push(`Based on analysis of ${candidateFiles.length} files with any types`);
        // Update adaptive config with realistic target
        this.adaptiveConfig.targetReductionPercentage = recommendedTarget;
        return {
            recommendedTarget,
            reasoning,
            milestones
        };
    }
    /**
     * Monitor progress with realistic milestone tracking
     */
    async monitorProgress() {
        const currentProgress = await this.getCurrentProgress();
        const targetInfo = await this.setRealisticTargets();
        // Check milestone achievements
        const milestoneStatus = targetInfo.milestones.map(milestone => ({
            milestone: milestone.percentage,
            achieved: currentProgress.reductionPercentage >= milestone.percentage,
            description: milestone.description
        }));
        const recommendations = [];
        let needsManualIntervention = false;
        // Analyze if we need manual intervention
        if (this.batchHistory.length >= 5) {
            const recentBatches = this.batchHistory.slice(-5);
            const avgSuccessRate = recentBatches.reduce((sum, batch) => sum + (batch.replacementsSuccessful / Math.max(1, batch.replacementsAttempted)), 0) / recentBatches.length;
            const avgSafetyScore = recentBatches.reduce((sum, batch) => sum + batch.safetyScore, 0) / recentBatches.length;
            if (avgSuccessRate < 0.3) {
                needsManualIntervention = true;
                recommendations.push('Low success rate detected - consider manual review of remaining any types');
                recommendations.push('Focus on documenting intentional any types instead of replacement');
            }
            if (avgSafetyScore < 0.7) {
                needsManualIntervention = true;
                recommendations.push('Safety concerns detected - pause automated processing');
                recommendations.push('Review recent changes and consider rollback if necessary');
            }
            // Check for stagnation
            const recentProgress = recentBatches.reduce((sum, batch) => sum + batch.replacementsSuccessful, 0);
            if (recentProgress < 5 && recentBatches.length >= 3) {
                needsManualIntervention = true;
                recommendations.push('Progress has stagnated - remaining any types may require manual analysis');
                recommendations.push('Consider switching to documentation mode for remaining types');
            }
        }
        // Provide strategic recommendations based on current state
        if (currentProgress.reductionPercentage < 5) {
            recommendations.push('Early stage - focus on array types (any[]) for quick wins');
            recommendations.push('Increase confidence threshold to 0.9 for maximum safety');
        }
        else if (currentProgress.reductionPercentage < 10) {
            recommendations.push('Good progress - expand to Record<string, any> patterns');
            recommendations.push('Consider enabling domain-specific analysis for better suggestions');
        }
        else if (currentProgress.reductionPercentage >= targetInfo.recommendedTarget * 0.8) {
            recommendations.push('Approaching target - focus on documentation for remaining intentional types');
            recommendations.push('Consider manual review for complex remaining cases');
        }
        return {
            currentProgress,
            milestoneStatus,
            recommendations,
            needsManualIntervention
        };
    }
    /**
     * Analyze success rate and adapt strategy accordingly
     */
    analyzeSuccessRateAndAdapt() {
        if (this.batchHistory.length < 2) {
            return {
                currentSuccessRate: 0,
                trend: 'stable',
                adaptations: ['Insufficient data for trend analysis']
            };
        }
        const recentBatches = this.batchHistory.slice(-5);
        const currentSuccessRate = recentBatches.reduce((sum, batch) => sum + (batch.replacementsSuccessful / Math.max(1, batch.replacementsAttempted)), 0) / recentBatches.length;
        // Determine trend
        let trend = 'stable';
        const adaptations = [];
        if (recentBatches.length >= 3) {
            const firstHalf = recentBatches.slice(0, Math.floor(recentBatches.length / 2));
            const secondHalf = recentBatches.slice(Math.floor(recentBatches.length / 2));
            const firstHalfRate = firstHalf.reduce((sum, batch) => sum + (batch.replacementsSuccessful / Math.max(1, batch.replacementsAttempted)), 0) / firstHalf.length;
            const secondHalfRate = secondHalf.reduce((sum, batch) => sum + (batch.replacementsSuccessful / Math.max(1, batch.replacementsAttempted)), 0) / secondHalf.length;
            if (secondHalfRate > firstHalfRate + 0.1) {
                trend = 'improving';
                adaptations.push('Success rate improving - consider increasing batch size');
            }
            else if (secondHalfRate < firstHalfRate - 0.1) {
                trend = 'declining';
                adaptations.push('Success rate declining - reducing batch size and increasing confidence threshold');
                // Apply adaptations
                this.adaptiveConfig.maxFilesPerBatch = Math.max(5, Math.floor(this.adaptiveConfig.maxFilesPerBatch * 0.8));
                this.adaptiveConfig.confidenceThreshold = Math.min(0.95, this.adaptiveConfig.confidenceThreshold + 0.1);
            }
        }
        // Success rate based adaptations
        if (currentSuccessRate < 0.3) {
            adaptations.push('Very low success rate - switching to documentation mode recommended');
            adaptations.push('Consider manual review of remaining any types');
        }
        else if (currentSuccessRate < 0.5) {
            adaptations.push('Low success rate - increasing confidence threshold to 0.9');
            this.adaptiveConfig.confidenceThreshold = Math.min(0.95, this.adaptiveConfig.confidenceThreshold + 0.1);
        }
        else if (currentSuccessRate > 0.8) {
            adaptations.push('High success rate - can afford to be more aggressive');
            this.adaptiveConfig.confidenceThreshold = Math.max(0.7, this.adaptiveConfig.confidenceThreshold - 0.05);
        }
        return {
            currentSuccessRate,
            trend,
            adaptations
        };
    }
    /**
     * Execute a single batch of improvements with adaptive sizing
     */
    async executeBatch(config) {
        const startTime = Date.now();
        this.batchCounter++;
        // Use adaptive config if no config provided, or merge with provided config
        const effectiveConfig = config ? { ...this.adaptiveConfig, ...config } : this.adaptiveConfig;
        const batchMetrics = {
            batchNumber: this.batchCounter,
            filesProcessed: 0,
            anyTypesAnalyzed: 0,
            replacementsAttempted: 0,
            replacementsSuccessful: 0,
            compilationErrors: 0,
            rollbacksPerformed: 0,
            executionTime: 0,
            safetyScore: 1.0
        };
        try {
            // Create safety checkpoint before starting
            await this.createSafetyCheckpoint();
            // Get initial TypeScript error count for safety monitoring
            const initialErrorCount = await this.getTypeScriptErrorCount();
            // Find files with explicit any types
            const candidateFiles = await this.findFilesWithAnyTypes();
            const filesToProcess = candidateFiles
                .filter(file => !this.processedFiles.has(file))
                .slice(0, effectiveConfig.maxFilesPerBatch);
            if (filesToProcess.length === 0) {
                console.log('No more files to process in this batch');
                batchMetrics.executionTime = Date.now() - startTime;
                this.batchHistory.push(batchMetrics);
                return batchMetrics;
            }
            console.log(`Processing batch ${this.batchCounter}: ${filesToProcess.length} files (adaptive batch size: ${effectiveConfig.maxFilesPerBatch})`);
            // Process each file
            for (const filePath of filesToProcess) {
                try {
                    const fileResult = await this.processFile(filePath, effectiveConfig);
                    batchMetrics.filesProcessed++;
                    batchMetrics.anyTypesAnalyzed += fileResult.anyTypesAnalyzed;
                    batchMetrics.replacementsAttempted += fileResult.replacementsAttempted;
                    batchMetrics.replacementsSuccessful += fileResult.replacementsSuccessful;
                    if (fileResult.rollbackPerformed) {
                        batchMetrics.rollbacksPerformed++;
                    }
                    this.processedFiles.add(filePath);
                    // Validate build every few files based on adaptive config
                    if (batchMetrics.filesProcessed % effectiveConfig.validationFrequency === 0) {
                        console.log(`Safety checkpoint: validating build after ${batchMetrics.filesProcessed} files`);
                        const currentErrorCount = await this.getTypeScriptErrorCount();
                        // Safety check: ensure we're not increasing errors significantly
                        if (currentErrorCount > initialErrorCount + 5) { // Allow small increase for temporary states
                            console.warn(`Error count increased from ${initialErrorCount} to ${currentErrorCount}, pausing batch`);
                            batchMetrics.compilationErrors = currentErrorCount - initialErrorCount;
                            batchMetrics.safetyScore = Math.max(0, 1 - (batchMetrics.compilationErrors / 10));
                            break;
                        }
                    }
                }
                catch (error) {
                    console.error(`Failed to process file ${filePath}:`, error);
                    batchMetrics.rollbacksPerformed++;
                }
            }
            // Final safety validation
            const finalErrorCount = await this.getTypeScriptErrorCount();
            if (finalErrorCount > initialErrorCount) {
                batchMetrics.compilationErrors = finalErrorCount - initialErrorCount;
                batchMetrics.safetyScore = Math.max(0, 1 - (batchMetrics.compilationErrors / 20));
            }
            batchMetrics.executionTime = Date.now() - startTime;
            // Store batch metrics for adaptive strategy
            this.batchHistory.push(batchMetrics);
            // Calculate success rate for this batch
            const successRate = batchMetrics.replacementsAttempted > 0
                ? batchMetrics.replacementsSuccessful / batchMetrics.replacementsAttempted
                : 0;
            console.log(`Batch ${this.batchCounter} completed:`, {
                filesProcessed: batchMetrics.filesProcessed,
                replacementsSuccessful: batchMetrics.replacementsSuccessful,
                successRate: `${(successRate * 100).toFixed(1)}%`,
                safetyScore: batchMetrics.safetyScore.toFixed(2),
                executionTime: `${(batchMetrics.executionTime / 1000).toFixed(1)}s`
            });
            // Adapt strategy based on performance
            this.adaptStrategy();
            return batchMetrics;
        }
        catch (error) {
            console.error(`Batch ${this.batchCounter} failed:`, error);
            batchMetrics.executionTime = Date.now() - startTime;
            batchMetrics.safetyScore = 0;
            this.batchHistory.push(batchMetrics);
            return batchMetrics;
        }
    }
    /**
     * Execute the full campaign with progressive improvement and adaptive strategies
     */
    async executeFullCampaign(config) {
        const campaignStart = Date.now();
        // Use adaptive config if no config provided, or merge with provided config
        const effectiveConfig = config ? { ...this.adaptiveConfig, ...config } : this.adaptiveConfig;
        const initialProgress = await this.getCurrentProgress();
        console.log('Starting Unintentional Any Elimination Campaign');
        console.log(`Initial state: ${initialProgress.totalAnyTypes} any types found`);
        console.log(`Target: ${effectiveConfig.targetReductionPercentage}% reduction`);
        console.log(`Initial batch size: ${effectiveConfig.maxFilesPerBatch}, confidence threshold: ${effectiveConfig.confidenceThreshold}`);
        const result = {
            totalAnyTypesAnalyzed: 0,
            intentionalTypesIdentified: 0,
            unintentionalTypesReplaced: 0,
            documentationAdded: 0,
            reductionAchieved: 0,
            safetyEvents: [],
            validationResults: []
        };
        let batchCount = 0;
        let consecutiveFailures = 0;
        const maxConsecutiveFailures = 3;
        const maxBatches = 50; // Safety limit
        while (batchCount < maxBatches && consecutiveFailures < maxConsecutiveFailures) {
            try {
                console.log(`\n--- Starting batch ${batchCount + 1} ---`);
                const batchMetrics = await this.executeBatch();
                batchCount++;
                result.totalAnyTypesAnalyzed += batchMetrics.anyTypesAnalyzed;
                result.unintentionalTypesReplaced += batchMetrics.replacementsSuccessful;
                // Check if we should continue
                if (batchMetrics.filesProcessed === 0) {
                    console.log('No more files to process, campaign complete');
                    break;
                }
                // Safety check with adaptive response
                if (batchMetrics.safetyScore < 0.7) {
                    console.warn(`Low safety score (${batchMetrics.safetyScore.toFixed(2)}), adapting strategy`);
                    consecutiveFailures++;
                    result.safetyEvents.push({
                        type: 'LOW_SAFETY_SCORE',
                        timestamp: new Date(),
                        description: `Safety score ${batchMetrics.safetyScore.toFixed(2)} below threshold`,
                        severity: 'warning',
                        batchNumber: batchCount
                    });
                }
                else {
                    consecutiveFailures = 0;
                }
                // Check progress towards target with detailed reporting
                const currentProgress = await this.getCurrentProgress();
                const reductionAchieved = initialProgress.totalAnyTypes > 0
                    ? ((initialProgress.totalAnyTypes - currentProgress.totalAnyTypes) / initialProgress.totalAnyTypes) * 100
                    : 0;
                console.log(`\nProgress Report:`);
                console.log(`  Reduction achieved: ${reductionAchieved.toFixed(1)}% (target: ${effectiveConfig.targetReductionPercentage}%)`);
                console.log(`  Types replaced: ${result.unintentionalTypesReplaced}`);
                console.log(`  Batches completed: ${batchCount}`);
                console.log(`  Current batch size: ${this.adaptiveConfig.maxFilesPerBatch}`);
                console.log(`  Current confidence threshold: ${this.adaptiveConfig.confidenceThreshold.toFixed(2)}`);
                if (reductionAchieved >= effectiveConfig.targetReductionPercentage) {
                    console.log('\nðŸŽ‰ Target reduction achieved!');
                    break;
                }
                // Brief pause between batches for system stability
                await new Promise(resolve => setTimeout(resolve, 2000));
            }
            catch (error) {
                console.error(`Campaign batch ${batchCount + 1} failed:`, error);
                consecutiveFailures++;
                result.safetyEvents.push({
                    type: 'BATCH_FAILURE',
                    timestamp: new Date(),
                    description: `Batch ${batchCount + 1} failed: ${error.message}`,
                    severity: 'error',
                    batchNumber: batchCount + 1
                });
            }
        }
        // Calculate final results with comprehensive metrics
        const finalProgress = await this.getCurrentProgress();
        result.reductionAchieved = initialProgress.totalAnyTypes > 0
            ? ((initialProgress.totalAnyTypes - finalProgress.totalAnyTypes) / initialProgress.totalAnyTypes) * 100
            : 0;
        result.intentionalTypesIdentified = finalProgress.classifiedIntentional;
        // Calculate average success rate from batch history
        const totalAttempted = this.batchHistory.reduce((sum, batch) => sum + batch.replacementsAttempted, 0);
        const totalSuccessful = this.batchHistory.reduce((sum, batch) => sum + batch.replacementsSuccessful, 0);
        const overallSuccessRate = totalAttempted > 0 ? (totalSuccessful / totalAttempted) * 100 : 0;
        const campaignTime = Date.now() - campaignStart;
        console.log(`\n=== Campaign Summary ===`);
        console.log(`Duration: ${(campaignTime / 1000).toFixed(1)}s`);
        console.log(`Batches processed: ${batchCount}`);
        console.log(`Files processed: ${this.processedFiles.size}`);
        console.log(`Reduction achieved: ${result.reductionAchieved.toFixed(1)}%`);
        console.log(`Types replaced: ${result.unintentionalTypesReplaced}`);
        console.log(`Overall success rate: ${overallSuccessRate.toFixed(1)}%`);
        console.log(`Safety events: ${result.safetyEvents.length}`);
        console.log(`Final batch size: ${this.adaptiveConfig.maxFilesPerBatch}`);
        console.log(`Final confidence threshold: ${this.adaptiveConfig.confidenceThreshold.toFixed(2)}`);
        return result;
    }
    async processFile(filePath, config) {
        const fileContent = fs.readFileSync(filePath, 'utf8');
        const lines = fileContent.split('\n');
        // Find all any type usages in the file
        const anyTypeContexts = [];
        for (let i = 0; i < lines.length; i++) {
            const line = lines[i];
            if (this.containsAnyType(line)) {
                const context = {
                    filePath,
                    lineNumber: i + 1,
                    codeSnippet: line,
                    surroundingLines: this.getSurroundingLines(lines, i, 2),
                    hasExistingComment: this.hasCommentAbove(lines, i),
                    existingComment: this.getCommentAbove(lines, i),
                    isInTestFile: this.isTestFile(filePath),
                    domainContext: await this.analyzer.analyzeDomain({
                        filePath,
                        lineNumber: i + 1,
                        codeSnippet: line,
                        surroundingLines: this.getSurroundingLines(lines, i, 2),
                        hasExistingComment: false,
                        isInTestFile: this.isTestFile(filePath),
                        domainContext: { domain: 'utility', intentionalityHints: [], suggestedTypes: [], preservationReasons: [] }
                    })
                };
                anyTypeContexts.push(context);
            }
        }
        if (anyTypeContexts.length === 0) {
            return {
                anyTypesAnalyzed: 0,
                replacementsAttempted: 0,
                replacementsSuccessful: 0,
                rollbackPerformed: false
            };
        }
        // Classify all any types in the file
        const classifications = await this.classifier.classifyBatch(anyTypeContexts);
        // Create replacements for unintentional any types
        const replacements = [];
        for (let i = 0; i < classifications.length; i++) {
            const classification = classifications[i];
            const context = anyTypeContexts[i];
            if (!classification.isIntentional &&
                classification.confidence >= config.confidenceThreshold &&
                classification.suggestedReplacement) {
                replacements.push({
                    original: 'any',
                    replacement: classification.suggestedReplacement,
                    filePath: context.filePath,
                    lineNumber: context.lineNumber,
                    confidence: classification.confidence,
                    validationRequired: true
                });
            }
        }
        // Apply replacements
        let replacementsSuccessful = 0;
        let rollbackPerformed = false;
        if (replacements.length > 0) {
            const result = await this.replacer.processBatch(replacements);
            replacementsSuccessful = result.appliedReplacements.length;
            rollbackPerformed = result.rollbackPerformed;
        }
        return {
            anyTypesAnalyzed: anyTypeContexts.length,
            replacementsAttempted: replacements.length,
            replacementsSuccessful,
            rollbackPerformed
        };
    }
    async findFilesWithAnyTypes() {
        try {
            // Use grep to find files with explicit any types, excluding node_modules and test files initially
            const output = (0, child_process_1.execSync)('grep -r -l ":\\s*any" src/ --include="*.ts" --include="*.tsx" --exclude-dir=node_modules | head -100', { encoding: 'utf8', stdio: 'pipe' });
            return output.trim().split('\n').filter(line => line.trim().length > 0);
        }
        catch (error) {
            console.warn('Failed to find files with any types, using fallback method');
            return this.findFilesWithAnyTypesFallback();
        }
    }
    findFilesWithAnyTypesFallback() {
        const files = [];
        const srcDir = path.join(process.cwd(), 'src');
        const walkDir = (dir) => {
            const entries = fs.readdirSync(dir, { withFileTypes: true });
            for (const entry of entries) {
                const fullPath = path.join(dir, entry.name);
                if (entry.isDirectory() && !entry.name.startsWith('.') && entry.name !== 'node_modules') {
                    walkDir(fullPath);
                }
                else if (entry.isFile() && (entry.name.endsWith('.ts') || entry.name.endsWith('.tsx'))) {
                    try {
                        const content = fs.readFileSync(fullPath, 'utf8');
                        if (content.includes(': any') || content.includes('any[]') || content.includes('Record<string, any>')) {
                            files.push(fullPath);
                        }
                    }
                    catch (error) {
                        // Skip files that can't be read
                    }
                }
            }
        };
        if (fs.existsSync(srcDir)) {
            walkDir(srcDir);
        }
        return files.slice(0, 100); // Limit to prevent overwhelming
    }
    containsAnyType(line) {
        // Match various any type patterns
        const anyPatterns = [
            /:\s*any(?=\s*[=;,\)\]\}])/,
            /:\s*any\[\]/,
            /:\s*Array<any>/,
            /:\s*Record<\w+,\s*any>/,
            /\[key:\s*\w+\]:\s*any/ // [key: string]: any
        ];
        return anyPatterns.some(pattern => pattern.test(line));
    }
    getSurroundingLines(lines, index, radius) {
        const start = Math.max(0, index - radius);
        const end = Math.min(lines.length, index + radius + 1);
        return lines.slice(start, end);
    }
    hasCommentAbove(lines, index) {
        if (index === 0)
            return false;
        const prevLine = lines[index - 1].trim();
        return prevLine.startsWith('//') || prevLine.startsWith('/*') || prevLine.includes('*/');
    }
    getCommentAbove(lines, index) {
        if (!this.hasCommentAbove(lines, index))
            return undefined;
        return lines[index - 1].trim();
    }
    isTestFile(filePath) {
        return filePath.includes('test') ||
            filePath.includes('spec') ||
            filePath.includes('__tests__') ||
            filePath.endsWith('.test.ts') ||
            filePath.endsWith('.test.tsx') ||
            filePath.endsWith('.spec.ts') ||
            filePath.endsWith('.spec.tsx');
    }
    async getTypeScriptErrorCount() {
        try {
            const output = (0, child_process_1.execSync)('yarn tsc --noEmit --skipLibCheck 2>&1 | grep -c "error TS"', {
                encoding: 'utf8',
                stdio: 'pipe'
            });
            return parseInt(output.trim()) || 0;
        }
        catch (error) {
            // If grep finds no matches, it returns exit code 1, but that means 0 errors
            const errorData = error;
            if (errorData.status === 1) {
                return 0;
            }
            console.warn('Could not get TypeScript error count:', error);
            return -1; // Indicates measurement failure
        }
    }
    /**
     * Analyze file complexity to set realistic expectations
     */
    async analyzeFileComplexity(files) {
        let testFiles = 0;
        let arrayTypes = 0;
        let recordTypes = 0;
        let functionParams = 0;
        let totalAnyTypes = 0;
        for (const filePath of files) {
            try {
                const content = fs.readFileSync(filePath, 'utf8');
                const lines = content.split('\n');
                if (this.isTestFile(filePath)) {
                    testFiles++;
                }
                for (const line of lines) {
                    if (this.containsAnyType(line)) {
                        totalAnyTypes++;
                        if (line.includes('any[]') || line.includes('Array<any>')) {
                            arrayTypes++;
                        }
                        else if (line.includes('Record<') && line.includes('any>')) {
                            recordTypes++;
                        }
                        else if (line.includes('(') && line.includes(': any') && line.includes(')')) {
                            functionParams++;
                        }
                    }
                }
            }
            catch (error) {
                // Skip files that can't be read
            }
        }
        const testFilePercentage = files.length > 0 ? (testFiles / files.length) * 100 : 0;
        const arrayTypePercentage = totalAnyTypes > 0 ? (arrayTypes / totalAnyTypes) * 100 : 0;
        const recordTypePercentage = totalAnyTypes > 0 ? (recordTypes / totalAnyTypes) * 100 : 0;
        const functionParamPercentage = totalAnyTypes > 0 ? (functionParams / totalAnyTypes) * 100 : 0;
        // Calculate complexity score (0-1, where 1 is most complex)
        const complexityScore = Math.min(1, (testFilePercentage * 0.1 + // Test files are easier
            functionParamPercentage * 0.4 + // Function params are harder
            recordTypePercentage * 0.2) / 100 // Record types are moderate
        );
        return {
            testFilePercentage,
            arrayTypePercentage,
            recordTypePercentage,
            functionParamPercentage,
            complexityScore
        };
    }
    /**
     * Calculate expected success rate based on file analysis
     */
    calculateExpectedSuccessRate(analysis) {
        // Base success rate expectations based on historical data
        let expectedRate = 0.6; // 60% base expectation
        // Array types have historically 100% success rate
        expectedRate += (analysis.arrayTypePercentage / 100) * 0.4;
        // Record types have mixed results - moderate boost
        expectedRate += (analysis.recordTypePercentage / 100) * 0.1;
        // Function parameters have high failure rate - penalty
        expectedRate -= (analysis.functionParamPercentage / 100) * 0.3;
        // Test files are generally easier but less impactful
        expectedRate += (analysis.testFilePercentage / 100) * 0.1;
        return Math.max(0.2, Math.min(0.9, expectedRate));
    }
    async getCurrentProgress() {
        const totalFiles = await this.findFilesWithAnyTypes();
        let totalAnyTypes = 0;
        // Count total any types across all files (sample for performance)
        const sampleSize = Math.min(30, totalFiles.length);
        for (const filePath of totalFiles.slice(0, sampleSize)) {
            try {
                const content = fs.readFileSync(filePath, 'utf8');
                const lines = content.split('\n');
                totalAnyTypes += lines.filter(line => this.containsAnyType(line)).length;
            }
            catch (error) {
                // Skip files that can't be read
            }
        }
        // Estimate total based on sample
        const estimatedTotal = sampleSize > 0
            ? Math.floor((totalAnyTypes / sampleSize) * totalFiles.length)
            : 0;
        // Calculate metrics from batch history
        const totalReplacements = this.batchHistory.reduce((sum, batch) => sum + batch.replacementsSuccessful, 0);
        const totalAttempted = this.batchHistory.reduce((sum, batch) => sum + batch.replacementsAttempted, 0);
        const averageSuccessRate = totalAttempted > 0 ? totalReplacements / totalAttempted : 0;
        // Calculate reduction percentage
        const reductionPercentage = estimatedTotal > 0 ? (totalReplacements / estimatedTotal) * 100 : 0;
        // Get current TypeScript error count for comprehensive metrics
        const currentTSErrors = await this.getTypeScriptErrorCount();
        return {
            totalAnyTypes: estimatedTotal,
            classifiedIntentional: 0,
            classifiedUnintentional: totalAttempted,
            successfulReplacements: totalReplacements,
            documentedIntentional: 0,
            remainingUnintentional: Math.max(0, estimatedTotal - totalReplacements),
            reductionPercentage,
            targetReductionPercentage: this.adaptiveConfig.targetReductionPercentage,
            batchesCompleted: this.batchCounter,
            averageSuccessRate,
            // Base ProgressMetrics properties
            typeScriptErrors: {
                current: currentTSErrors >= 0 ? currentTSErrors : 0,
                target: 0,
                reduction: 0,
                percentage: 0
            },
            lintingWarnings: { current: 0, target: 0, reduction: 0, percentage: 0 },
            buildPerformance: { currentTime: 0, targetTime: 0, cacheHitRate: 0, memoryUsage: 0 },
            enterpriseSystems: { current: 0, target: 0, transformedExports: 0 }
        };
    }
}
exports.ProgressiveImprovementEngine = ProgressiveImprovementEngine;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L2JhY2t1cHMvZmlyc3Qtd2F2ZS0yMDI1LTA4LTExVDA1LTE5LTI2LTgxM1ovc3JjL3NlcnZpY2VzL2NhbXBhaWduL3VuaW50ZW50aW9uYWwtYW55LWVsaW1pbmF0aW9uL1Byb2dyZXNzaXZlSW1wcm92ZW1lbnRFbmdpbmUudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7R0FHRzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFSCxpREFBeUM7QUFDekMsdUNBQXlCO0FBQ3pCLDJDQUE2QjtBQVc3QiwyREFBd0Q7QUFDeEQsbUVBQWdFO0FBQ2hFLHlEQUFzRDtBQUV0RCxNQUFhLDRCQUE0QjtJQUMvQixVQUFVLENBQW9CO0lBQzlCLFFBQVEsQ0FBbUI7SUFDM0IsUUFBUSxDQUF3QjtJQUNoQyxjQUFjLEdBQWdCLElBQUksR0FBRyxFQUFFLENBQUM7SUFDeEMsWUFBWSxHQUFHLENBQUMsQ0FBQztJQUNqQixZQUFZLEdBQW1CLEVBQUUsQ0FBQztJQUNsQyxjQUFjLENBQXlCO0lBQ3ZDLGlCQUFpQixHQUEwQyxJQUFJLEdBQUcsRUFBRSxDQUFDO0lBRTdFLFlBQVksYUFBK0M7UUFDekQsSUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLHFDQUFpQixFQUFFLENBQUM7UUFDMUMsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLG1DQUFnQixFQUFFLENBQUM7UUFDdkMsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLDZDQUFxQixFQUFFLENBQUM7UUFFNUMsa0RBQWtEO1FBQ2xELElBQUksQ0FBQyxjQUFjLEdBQUc7WUFDcEIsZ0JBQWdCLEVBQUUsYUFBYSxFQUFFLGdCQUFnQixJQUFJLEVBQUU7WUFDdkQseUJBQXlCLEVBQUUsYUFBYSxFQUFFLHlCQUF5QixJQUFJLEVBQUU7WUFDekUsbUJBQW1CLEVBQUUsYUFBYSxFQUFFLG1CQUFtQixJQUFJLEdBQUc7WUFDOUQsb0JBQW9CLEVBQUUsYUFBYSxFQUFFLG9CQUFvQixJQUFJLElBQUk7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Z0JBQWdCLEVBQUUsRUFBRSxXQUFXLEVBQUUsQ0FBQyxFQUFFLFVBQVUsRUFBRSxDQUFDLEVBQUUsWUFBWSxFQUFFLENBQUMsRUFBRSxXQUFXLEVBQUUsQ0FBQyxFQUFFO1lBQ3BGLGlCQUFpQixFQUFFLEVBQUUsT0FBTyxFQUFFLENBQUMsRUFBRSxNQUFNLEVBQUUsQ0FBQyxFQUFFLGtCQUFrQixFQUFFLENBQUMsRUFBRTtTQUNwRSxDQUFDO0lBQ0osQ0FBQztDQUNGO0FBNzVCRCxvRUE2NUJDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9HcmVnQ2FzdHJvL0Rlc2t0b3AvV2hhdFRvRWF0TmV4dC9iYWNrdXBzL2ZpcnN0LXdhdmUtMjAyNS0wOC0xMVQwNS0xOS0yNi04MTNaL3NyYy9zZXJ2aWNlcy9jYW1wYWlnbi91bmludGVudGlvbmFsLWFueS1lbGltaW5hdGlvbi9Qcm9ncmVzc2l2ZUltcHJvdmVtZW50RW5naW5lLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogUHJvZ3Jlc3NpdmUgSW1wcm92ZW1lbnQgRW5naW5lXG4gKiBPcmNoZXN0cmF0ZXMgYmF0Y2ggcHJvY2Vzc2luZyB3aXRoIGFkYXB0aXZlIHN0cmF0ZWdpZXMgYW5kIHByb2dyZXNzIHRyYWNraW5nXG4gKi9cblxuaW1wb3J0IHsgZXhlY1N5bmMgfSBmcm9tICdjaGlsZF9wcm9jZXNzJztcbmltcG9ydCAqIGFzIGZzIGZyb20gJ2ZzJztcbmltcG9ydCAqIGFzIHBhdGggZnJvbSAncGF0aCc7XG5cbmltcG9ydCB7XG4gICAgQmF0Y2hNZXRyaWNzLFxuICAgIENsYXNzaWZpY2F0aW9uQ29udGV4dCxcbiAgICBUeXBlUmVwbGFjZW1lbnQsXG4gICAgVW5pbnRlbnRpb25hbEFueUNhbXBhaWduUmVzdWx0LFxuICAgIFVuaW50ZW50aW9uYWxBbnlDb25maWcsXG4gICAgVW5pbnRlbnRpb25hbEFueVByb2dyZXNzXG59IGZyb20gJy4vdHlwZXMnO1xuXG5pbXBvcnQgeyBBbnlUeXBlQ2xhc3NpZmllciB9IGZyb20gJy4vQW55VHlwZUNsYXNzaWZpZXInO1xuaW1wb3J0IHsgRG9tYWluQ29udGV4dEFuYWx5emVyIH0gZnJvbSAnLi9Eb21haW5Db250ZXh0QW5hbHl6ZXInO1xuaW1wb3J0IHsgU2FmZVR5cGVSZXBsYWNlciB9IGZyb20gJy4vU2FmZVR5cGVSZXBsYWNlcic7XG5cbmV4cG9ydCBjbGFzcyBQcm9ncmVzc2l2ZUltcHJvdmVtZW50RW5naW5lIHtcbiAgcHJpdmF0ZSBjbGFzc2lmaWVyOiBBbnlUeXBlQ2xhc3NpZmllcjtcbiAgcHJpdmF0ZSByZXBsYWNlcjogU2FmZVR5cGVSZXBsYWNlcjtcbiAgcHJpdmF0ZSBhbmFseXplcjogRG9tYWluQ29udGV4dEFuYWx5emVyO1xuICBwcml2YXRlIHByb2Nlc3NlZEZpbGVzOiBTZXQ8c3RyaW5nPiA9IG5ldyBTZXQoKTtcbiAgcHJpdmF0ZSBiYXRjaENvdW50ZXIgPSAwO1xuICBwcml2YXRlIGJhdGNoSGlzdG9yeTogQmF0Y2hNZXRyaWNzW10gPSBbXTtcbiAgcHJpdmF0ZSBhZGFwdGl2ZUNvbmZpZzogVW5pbnRlbnRpb25hbEFueUNvbmZpZztcbiAgcHJpdmF0ZSBzYWZldHlDaGVja3BvaW50czogTWFwPG51bWJlciwgVW5pbnRlbnRpb25hbEFueVByb2dyZXNzPiA9IG5ldyBNYXAoKTtcblxuICBjb25zdHJ1Y3Rvcihpbml0aWFsQ29uZmlnPzogUGFydGlhbDxVbmludGVudGlvbmFsQW55Q29uZmlnPikge1xuICAgIHRoaXMuY2xhc3NpZmllciA9IG5ldyBBbnlUeXBlQ2xhc3NpZmllcigpO1xuICAgIHRoaXMucmVwbGFjZXIgPSBuZXcgU2FmZVR5cGVSZXBsYWNlcigpO1xuICAgIHRoaXMuYW5hbHl6ZXIgPSBuZXcgRG9tYWluQ29udGV4dEFuYWx5emVyKCk7XG5cbiAgICAvLyBJbml0aWFsaXplIGFkYXB0aXZlIGNvbmZpZ3VyYXRpb24gd2l0aCBkZWZhdWx0c1xuICAgIHRoaXMuYWRhcHRpdmVDb25maWcgPSB7XG4gICAgICBtYXhGaWxlc1BlckJhdGNoOiBpbml0aWFsQ29uZmlnPy5tYXhGaWxlc1BlckJhdGNoIHx8IDE1LFxuICAgICAgdGFyZ2V0UmVkdWN0aW9uUGVyY2VudGFnZTogaW5pdGlhbENvbmZpZz8udGFyZ2V0UmVkdWN0aW9uUGVyY2VudGFnZSB8fCAxNSxcbiAgICAgIGNvbmZpZGVuY2VUaHJlc2hvbGQ6IGluaXRpYWxDb25maWc/LmNvbmZpZGVuY2VUaHJlc2hvbGQgfHwgMC44LFxuICAgICAgZW5hYmxlRG9tYWluQW5hbHlzaXM6IGluaXRpYWxDb25maWc/LmVuYWJsZURvbWFpbkFuYWx5c2lzID8/IHRydWUsXG4gICAgICBlbmFibGVEb2N1bWVudGF0aW9uOiBpbml0aWFsQ29uZmlnPy5lbmFibGVEb2N1bWVudGF0aW9uID8/IHRydWUsXG4gICAgICBzYWZldHlMZXZlbDogaW5pdGlhbENvbmZpZz8uc2FmZXR5TGV2ZWwgfHwgJ01PREVSQVRFJyxcbiAgICAgIHZhbGlkYXRpb25GcmVxdWVuY3k6IGluaXRpYWxDb25maWc/LnZhbGlkYXRpb25GcmVxdWVuY3kgfHwgNVxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogQWRhcHQgc3RyYXRlZ3kgYmFzZWQgb24gcmVjZW50IGJhdGNoIHBlcmZvcm1hbmNlXG4gICAqL1xuICBwcml2YXRlIGFkYXB0U3RyYXRlZ3koKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuYmF0Y2hIaXN0b3J5Lmxlbmd0aCA8IDIpIHJldHVybjtcblxuICAgIGNvbnN0IHJlY2VudEJhdGNoZXMgPSB0aGlzLmJhdGNoSGlzdG9yeS5zbGljZSgtMyk7XG4gICAgY29uc3QgYXZlcmFnZVN1Y2Nlc3NSYXRlID0gcmVjZW50QmF0Y2hlcy5yZWR1Y2UoKHN1bSwgYmF0Y2gpID0+XG4gICAgICBzdW0gKyAoYmF0Y2gucmVwbGFjZW1lbnRzU3VjY2Vzc2Z1bCAvIE1hdGgubWF4KDEsIGJhdGNoLnJlcGxhY2VtZW50c0F0dGVtcHRlZCkpLCAwXG4gICAgKSAvIHJlY2VudEJhdGNoZXMubGVuZ3RoO1xuXG4gICAgY29uc3QgYXZlcmFnZVNhZmV0eVNjb3JlID0gcmVjZW50QmF0Y2hlcy5yZWR1Y2UoKHN1bSwgYmF0Y2gpID0+XG4gICAgICBzdW0gKyBiYXRjaC5zYWZldHlTY29yZSwgMFxuICAgICkgLyByZWNlbnRCYXRjaGVzLmxlbmd0aDtcblxuICAgIGNvbnNvbGUubG9nKGBBZGFwdGluZyBzdHJhdGVneSAtIFN1Y2Nlc3MgcmF0ZTogJHsoYXZlcmFnZVN1Y2Nlc3NSYXRlICogMTAwKS50b0ZpeGVkKDEpfSUsIFNhZmV0eSBzY29yZTogJHthdmVyYWdlU2FmZXR5U2NvcmUudG9GaXhlZCgyKX1gKTtcblxuICAgIC8vIEFkYXB0IGJhdGNoIHNpemUgYmFzZWQgb24gc2FmZXR5IHNjb3JlXG4gICAgaWYgKGF2ZXJhZ2VTYWZldHlTY29yZSA8IDAuNykge1xuICAgICAgLy8gUmVkdWNlIGJhdGNoIHNpemUgZm9yIHNhZmV0eVxuICAgICAgdGhpcy5hZGFwdGl2ZUNvbmZpZy5tYXhGaWxlc1BlckJhdGNoID0gTWF0aC5tYXgoNSwgTWF0aC5mbG9vcih0aGlzLmFkYXB0aXZlQ29uZmlnLm1heEZpbGVzUGVyQmF0Y2ggKiAwLjcpKTtcbiAgICAgIHRoaXMuYWRhcHRpdmVDb25maWcuY29uZmlkZW5jZVRocmVzaG9sZCA9IE1hdGgubWluKDAuOTUsIHRoaXMuYWRhcHRpdmVDb25maWcuY29uZmlkZW5jZVRocmVzaG9sZCArIDAuMSk7XG4gICAgICBjb25zb2xlLmxvZyhgUmVkdWNlZCBiYXRjaCBzaXplIHRvICR7dGhpcy5hZGFwdGl2ZUNvbmZpZy5tYXhGaWxlc1BlckJhdGNofSBhbmQgaW5jcmVhc2VkIGNvbmZpZGVuY2UgdGhyZXNob2xkIHRvICR7dGhpcy5hZGFwdGl2ZUNvbmZpZy5jb25maWRlbmNlVGhyZXNob2xkfWApO1xuICAgIH0gZWxzZSBpZiAoYXZlcmFnZVNhZmV0eVNjb3JlID4gMC45ICYmIGF2ZXJhZ2VTdWNjZXNzUmF0ZSA+IDAuOCkge1xuICAgICAgLy8gSW5jcmVhc2UgYmF0Y2ggc2l6ZSBmb3IgZWZmaWNpZW5jeVxuICAgICAgdGhpcy5hZGFwdGl2ZUNvbmZpZy5tYXhGaWxlc1BlckJhdGNoID0gTWF0aC5taW4oMjUsIE1hdGguZmxvb3IodGhpcy5hZGFwdGl2ZUNvbmZpZy5tYXhGaWxlc1BlckJhdGNoICogMS4yKSk7XG4gICAgICB0aGlzLmFkYXB0aXZlQ29uZmlnLmNvbmZpZGVuY2VUaHJlc2hvbGQgPSBNYXRoLm1heCgwLjcsIHRoaXMuYWRhcHRpdmVDb25maWcuY29uZmlkZW5jZVRocmVzaG9sZCAtIDAuMDUpO1xuICAgICAgY29uc29sZS5sb2coYEluY3JlYXNlZCBiYXRjaCBzaXplIHRvICR7dGhpcy5hZGFwdGl2ZUNvbmZpZy5tYXhGaWxlc1BlckJhdGNofSBhbmQgZGVjcmVhc2VkIGNvbmZpZGVuY2UgdGhyZXNob2xkIHRvICR7dGhpcy5hZGFwdGl2ZUNvbmZpZy5jb25maWRlbmNlVGhyZXNob2xkfWApO1xuICAgIH1cblxuICAgIC8vIEFkYXB0IGNvbmZpZGVuY2UgdGhyZXNob2xkIGJhc2VkIG9uIHN1Y2Nlc3MgcmF0ZVxuICAgIGlmIChhdmVyYWdlU3VjY2Vzc1JhdGUgPCAwLjUpIHtcbiAgICAgIHRoaXMuYWRhcHRpdmVDb25maWcuY29uZmlkZW5jZVRocmVzaG9sZCA9IE1hdGgubWluKDAuOTUsIHRoaXMuYWRhcHRpdmVDb25maWcuY29uZmlkZW5jZVRocmVzaG9sZCArIDAuMSk7XG4gICAgICBjb25zb2xlLmxvZyhgTG93IHN1Y2Nlc3MgcmF0ZSwgaW5jcmVhc2VkIGNvbmZpZGVuY2UgdGhyZXNob2xkIHRvICR7dGhpcy5hZGFwdGl2ZUNvbmZpZy5jb25maWRlbmNlVGhyZXNob2xkfWApO1xuICAgIH1cblxuICAgIC8vIEFkYXB0IHZhbGlkYXRpb24gZnJlcXVlbmN5IGJhc2VkIG9uIHNhZmV0eVxuICAgIGlmIChhdmVyYWdlU2FmZXR5U2NvcmUgPCAwLjgpIHtcbiAgICAgIHRoaXMuYWRhcHRpdmVDb25maWcudmFsaWRhdGlvbkZyZXF1ZW5jeSA9IE1hdGgubWF4KDMsIHRoaXMuYWRhcHRpdmVDb25maWcudmFsaWRhdGlvbkZyZXF1ZW5jeSAtIDEpO1xuICAgICAgY29uc29sZS5sb2coYEluY3JlYXNlZCB2YWxpZGF0aW9uIGZyZXF1ZW5jeSB0byBldmVyeSAke3RoaXMuYWRhcHRpdmVDb25maWcudmFsaWRhdGlvbkZyZXF1ZW5jeX0gZmlsZXNgKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIGEgc2FmZXR5IGNoZWNrcG9pbnRcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgY3JlYXRlU2FmZXR5Q2hlY2twb2ludCgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBwcm9ncmVzcyA9IGF3YWl0IHRoaXMuZ2V0Q3VycmVudFByb2dyZXNzKCk7XG4gICAgdGhpcy5zYWZldHlDaGVja3BvaW50cy5zZXQodGhpcy5iYXRjaENvdW50ZXIsIHByb2dyZXNzKTtcbiAgICBjb25zb2xlLmxvZyhgU2FmZXR5IGNoZWNrcG9pbnQgY3JlYXRlZCBhdCBiYXRjaCAke3RoaXMuYmF0Y2hDb3VudGVyfWApO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBjb21wcmVoZW5zaXZlIHByb2dyZXNzIG1ldHJpY3NcbiAgICovXG4gIGFzeW5jIGdldFByb2dyZXNzTWV0cmljcygpOiBQcm9taXNlPFVuaW50ZW50aW9uYWxBbnlQcm9ncmVzcz4ge1xuICAgIHJldHVybiBhd2FpdCB0aGlzLmdldEN1cnJlbnRQcm9ncmVzcygpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBiYXRjaCBleGVjdXRpb24gaGlzdG9yeVxuICAgKi9cbiAgZ2V0QmF0Y2hIaXN0b3J5KCk6IEJhdGNoTWV0cmljc1tdIHtcbiAgICByZXR1cm4gWy4uLnRoaXMuYmF0Y2hIaXN0b3J5XTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgY3VycmVudCBhZGFwdGl2ZSBjb25maWd1cmF0aW9uXG4gICAqL1xuICBnZXRBZGFwdGl2ZUNvbmZpZygpOiBVbmludGVudGlvbmFsQW55Q29uZmlnIHtcbiAgICByZXR1cm4geyAuLi50aGlzLmFkYXB0aXZlQ29uZmlnIH07XG4gIH1cblxuICAvKipcbiAgICogU2V0IHJlYWxpc3RpYyB0YXJnZXRzIGJhc2VkIG9uIGhpc3RvcmljYWwgc3VjY2VzcyByYXRlcyBhbmQgY29kZWJhc2UgYW5hbHlzaXNcbiAgICovXG4gIGFzeW5jIHNldFJlYWxpc3RpY1RhcmdldHMoKTogUHJvbWlzZTx7XG4gICAgcmVjb21tZW5kZWRUYXJnZXQ6IG51bWJlcjtcbiAgICByZWFzb25pbmc6IHN0cmluZ1tdO1xuICAgIG1pbGVzdG9uZXM6IEFycmF5PHsgcGVyY2VudGFnZTogbnVtYmVyOyBkZXNjcmlwdGlvbjogc3RyaW5nOyBlc3RpbWF0ZWRCYXRjaGVzOiBudW1iZXIgfT47XG4gIH0+IHtcbiAgICBjb25zdCBjdXJyZW50UHJvZ3Jlc3MgPSBhd2FpdCB0aGlzLmdldEN1cnJlbnRQcm9ncmVzcygpO1xuICAgIGNvbnN0IGNhbmRpZGF0ZUZpbGVzID0gYXdhaXQgdGhpcy5maW5kRmlsZXNXaXRoQW55VHlwZXMoKTtcblxuICAgIC8vIEFuYWx5emUgZmlsZSB0eXBlcyBhbmQgY29tcGxleGl0eVxuICAgIGNvbnN0IGZpbGVBbmFseXNpcyA9IGF3YWl0IHRoaXMuYW5hbHl6ZUZpbGVDb21wbGV4aXR5KGNhbmRpZGF0ZUZpbGVzLnNsaWNlKDAsIDIwKSk7XG5cbiAgICAvLyBDYWxjdWxhdGUgYmFzZSBzdWNjZXNzIHJhdGUgZXhwZWN0YXRpb25zXG4gICAgY29uc3QgYmFzZVN1Y2Nlc3NSYXRlID0gdGhpcy5jYWxjdWxhdGVFeHBlY3RlZFN1Y2Nlc3NSYXRlKGZpbGVBbmFseXNpcyk7XG5cbiAgICAvLyBIaXN0b3JpY2FsIGRhdGEgc2hvd3MgcHJldmlvdXMgYXR0ZW1wdHMgYWNoaWV2ZWQgMS43JSByZWR1Y3Rpb24gKDMwIGZpeGVzKVxuICAgIC8vIFRhcmdldCAxMHggaW1wcm92ZW1lbnQgPSAxNyUgcmVkdWN0aW9uICgzMDAgZml4ZXMpXG4gICAgLy8gQnV0IGJlIHJlYWxpc3RpYyBiYXNlZCBvbiBmaWxlIGFuYWx5c2lzXG5cbiAgICBsZXQgcmVjb21tZW5kZWRUYXJnZXQgPSAxNTsgLy8gRGVmYXVsdCAxNSUgYXMgcGVyIHJlcXVpcmVtZW50c1xuICAgIGNvbnN0IHJlYXNvbmluZzogc3RyaW5nW10gPSBbXTtcblxuICAgIC8vIEFkanVzdCBiYXNlZCBvbiBmaWxlIGNvbXBsZXhpdHlcbiAgICBpZiAoZmlsZUFuYWx5c2lzLnRlc3RGaWxlUGVyY2VudGFnZSA+IDMwKSB7XG4gICAgICByZWFzb25pbmcucHVzaChgJHtmaWxlQW5hbHlzaXMudGVzdEZpbGVQZXJjZW50YWdlLnRvRml4ZWQoMSl9JSBvZiBmaWxlcyBhcmUgdGVzdCBmaWxlcyAtIGZvY3VzaW5nIG9uIG5vbi10ZXN0IGZpbGVzIGZpcnN0YCk7XG4gICAgICByZWNvbW1lbmRlZFRhcmdldCA9IE1hdGgubWF4KDEyLCByZWNvbW1lbmRlZFRhcmdldCAtIDMpO1xuICAgIH1cblxuICAgIGlmIChmaWxlQW5hbHlzaXMuYXJyYXlUeXBlUGVyY2VudGFnZSA+IDIwKSB7XG4gICAgICByZWFzb25pbmcucHVzaChgJHtmaWxlQW5hbHlzaXMuYXJyYXlUeXBlUGVyY2VudGFnZS50b0ZpeGVkKDEpfSUgYXJlIGFycmF5IHR5cGVzIHdpdGggaGlzdG9yaWNhbGx5IDEwMCUgc3VjY2VzcyByYXRlYCk7XG4gICAgICByZWNvbW1lbmRlZFRhcmdldCA9IE1hdGgubWluKDIwLCByZWNvbW1lbmRlZFRhcmdldCArIDIpO1xuICAgIH1cblxuICAgIGlmIChmaWxlQW5hbHlzaXMucmVjb3JkVHlwZVBlcmNlbnRhZ2UgPiAxNSkge1xuICAgICAgcmVhc29uaW5nLnB1c2goYCR7ZmlsZUFuYWx5c2lzLnJlY29yZFR5cGVQZXJjZW50YWdlLnRvRml4ZWQoMSl9JSBhcmUgUmVjb3JkIHR5cGVzIHdpdGggbWl4ZWQgc3VjY2VzcyAtIGJlaW5nIHNlbGVjdGl2ZWApO1xuICAgICAgcmVjb21tZW5kZWRUYXJnZXQgPSBNYXRoLm1heCgxMCwgcmVjb21tZW5kZWRUYXJnZXQgLSAyKTtcbiAgICB9XG5cbiAgICBpZiAoZmlsZUFuYWx5c2lzLmZ1bmN0aW9uUGFyYW1QZXJjZW50YWdlID4gMjUpIHtcbiAgICAgIHJlYXNvbmluZy5wdXNoKGAke2ZpbGVBbmFseXNpcy5mdW5jdGlvblBhcmFtUGVyY2VudGFnZS50b0ZpeGVkKDEpfSUgYXJlIGZ1bmN0aW9uIHBhcmFtZXRlcnMgd2l0aCBoaWdoIGZhaWx1cmUgcmF0ZSAtIGJlaW5nIGNvbnNlcnZhdGl2ZWApO1xuICAgICAgcmVjb21tZW5kZWRUYXJnZXQgPSBNYXRoLm1heCg4LCByZWNvbW1lbmRlZFRhcmdldCAtIDUpO1xuICAgIH1cblxuICAgIC8vIEFkanVzdCBiYXNlZCBvbiBoaXN0b3JpY2FsIGJhdGNoIHBlcmZvcm1hbmNlIGlmIGF2YWlsYWJsZVxuICAgIGlmICh0aGlzLmJhdGNoSGlzdG9yeS5sZW5ndGggPiAwKSB7XG4gICAgICBjb25zdCBhdmdTdWNjZXNzUmF0ZSA9IHRoaXMuYmF0Y2hIaXN0b3J5LnJlZHVjZSgoc3VtLCBiYXRjaCkgPT5cbiAgICAgICAgc3VtICsgKGJhdGNoLnJlcGxhY2VtZW50c1N1Y2Nlc3NmdWwgLyBNYXRoLm1heCgxLCBiYXRjaC5yZXBsYWNlbWVudHNBdHRlbXB0ZWQpKSwgMFxuICAgICAgKSAvIHRoaXMuYmF0Y2hIaXN0b3J5Lmxlbmd0aDtcblxuICAgICAgaWYgKGF2Z1N1Y2Nlc3NSYXRlID4gMC44KSB7XG4gICAgICAgIHJlYXNvbmluZy5wdXNoKGBIaWdoIGhpc3RvcmljYWwgc3VjY2VzcyByYXRlICgkeyhhdmdTdWNjZXNzUmF0ZSAqIDEwMCkudG9GaXhlZCgxKX0lKSAtIGluY3JlYXNpbmcgdGFyZ2V0YCk7XG4gICAgICAgIHJlY29tbWVuZGVkVGFyZ2V0ID0gTWF0aC5taW4oMjUsIHJlY29tbWVuZGVkVGFyZ2V0ICsgMyk7XG4gICAgICB9IGVsc2UgaWYgKGF2Z1N1Y2Nlc3NSYXRlIDwgMC41KSB7XG4gICAgICAgIHJlYXNvbmluZy5wdXNoKGBMb3cgaGlzdG9yaWNhbCBzdWNjZXNzIHJhdGUgKCR7KGF2Z1N1Y2Nlc3NSYXRlICogMTAwKS50b0ZpeGVkKDEpfSUpIC0gcmVkdWNpbmcgdGFyZ2V0YCk7XG4gICAgICAgIHJlY29tbWVuZGVkVGFyZ2V0ID0gTWF0aC5tYXgoNSwgcmVjb21tZW5kZWRUYXJnZXQgLSA1KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBDcmVhdGUgcmVhbGlzdGljIG1pbGVzdG9uZXNcbiAgICBjb25zdCBtaWxlc3RvbmVzID0gW1xuICAgICAge1xuICAgICAgICBwZXJjZW50YWdlOiBNYXRoLmZsb29yKHJlY29tbWVuZGVkVGFyZ2V0ICogMC4yNSksXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnSW5pdGlhbCBwcm9ncmVzcyAtIGZvY3VzIG9uIGhpZ2gtY29uZmlkZW5jZSBhcnJheSB0eXBlcycsXG4gICAgICAgIGVzdGltYXRlZEJhdGNoZXM6IE1hdGguY2VpbChjYW5kaWRhdGVGaWxlcy5sZW5ndGggKiAwLjEgLyB0aGlzLmFkYXB0aXZlQ29uZmlnLm1heEZpbGVzUGVyQmF0Y2gpXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBwZXJjZW50YWdlOiBNYXRoLmZsb29yKHJlY29tbWVuZGVkVGFyZ2V0ICogMC41KSxcbiAgICAgICAgZGVzY3JpcHRpb246ICdNaWQtcG9pbnQgLSBleHBhbmQgdG8gUmVjb3JkIHR5cGVzIGFuZCBzaW1wbGUgcGF0dGVybnMnLFxuICAgICAgICBlc3RpbWF0ZWRCYXRjaGVzOiBNYXRoLmNlaWwoY2FuZGlkYXRlRmlsZXMubGVuZ3RoICogMC4zIC8gdGhpcy5hZGFwdGl2ZUNvbmZpZy5tYXhGaWxlc1BlckJhdGNoKVxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgcGVyY2VudGFnZTogTWF0aC5mbG9vcihyZWNvbW1lbmRlZFRhcmdldCAqIDAuNzUpLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ0FkdmFuY2VkIHByb2dyZXNzIC0gdGFja2xlIG1vcmUgY29tcGxleCBwYXR0ZXJucycsXG4gICAgICAgIGVzdGltYXRlZEJhdGNoZXM6IE1hdGguY2VpbChjYW5kaWRhdGVGaWxlcy5sZW5ndGggKiAwLjYgLyB0aGlzLmFkYXB0aXZlQ29uZmlnLm1heEZpbGVzUGVyQmF0Y2gpXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBwZXJjZW50YWdlOiByZWNvbW1lbmRlZFRhcmdldCxcbiAgICAgICAgZGVzY3JpcHRpb246ICdUYXJnZXQgYWNoaWV2ZW1lbnQgLSBjb21wbGV0ZSByZW1haW5pbmcgaGlnaC1jb25maWRlbmNlIGNhc2VzJyxcbiAgICAgICAgZXN0aW1hdGVkQmF0Y2hlczogTWF0aC5jZWlsKGNhbmRpZGF0ZUZpbGVzLmxlbmd0aCAqIDAuOCAvIHRoaXMuYWRhcHRpdmVDb25maWcubWF4RmlsZXNQZXJCYXRjaClcbiAgICAgIH1cbiAgICBdO1xuXG4gICAgcmVhc29uaW5nLnB1c2goYFJlY29tbWVuZGVkIHRhcmdldDogJHtyZWNvbW1lbmRlZFRhcmdldH0lIHJlZHVjdGlvbiAoJHtNYXRoLmZsb29yKGN1cnJlbnRQcm9ncmVzcy50b3RhbEFueVR5cGVzICogcmVjb21tZW5kZWRUYXJnZXQgLyAxMDApfSBmaXhlcylgKTtcbiAgICByZWFzb25pbmcucHVzaChgQmFzZWQgb24gYW5hbHlzaXMgb2YgJHtjYW5kaWRhdGVGaWxlcy5sZW5ndGh9IGZpbGVzIHdpdGggYW55IHR5cGVzYCk7XG5cbiAgICAvLyBVcGRhdGUgYWRhcHRpdmUgY29uZmlnIHdpdGggcmVhbGlzdGljIHRhcmdldFxuICAgIHRoaXMuYWRhcHRpdmVDb25maWcudGFyZ2V0UmVkdWN0aW9uUGVyY2VudGFnZSA9IHJlY29tbWVuZGVkVGFyZ2V0O1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHJlY29tbWVuZGVkVGFyZ2V0LFxuICAgICAgcmVhc29uaW5nLFxuICAgICAgbWlsZXN0b25lc1xuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogTW9uaXRvciBwcm9ncmVzcyB3aXRoIHJlYWxpc3RpYyBtaWxlc3RvbmUgdHJhY2tpbmdcbiAgICovXG4gIGFzeW5jIG1vbml0b3JQcm9ncmVzcygpOiBQcm9taXNlPHtcbiAgICBjdXJyZW50UHJvZ3Jlc3M6IFVuaW50ZW50aW9uYWxBbnlQcm9ncmVzcztcbiAgICBtaWxlc3RvbmVTdGF0dXM6IEFycmF5PHsgbWlsZXN0b25lOiBudW1iZXI7IGFjaGlldmVkOiBib29sZWFuOyBkZXNjcmlwdGlvbjogc3RyaW5nIH0+O1xuICAgIHJlY29tbWVuZGF0aW9uczogc3RyaW5nW107XG4gICAgbmVlZHNNYW51YWxJbnRlcnZlbnRpb246IGJvb2xlYW47XG4gIH0+IHtcbiAgICBjb25zdCBjdXJyZW50UHJvZ3Jlc3MgPSBhd2FpdCB0aGlzLmdldEN1cnJlbnRQcm9ncmVzcygpO1xuICAgIGNvbnN0IHRhcmdldEluZm8gPSBhd2FpdCB0aGlzLnNldFJlYWxpc3RpY1RhcmdldHMoKTtcblxuICAgIC8vIENoZWNrIG1pbGVzdG9uZSBhY2hpZXZlbWVudHNcbiAgICBjb25zdCBtaWxlc3RvbmVTdGF0dXMgPSB0YXJnZXRJbmZvLm1pbGVzdG9uZXMubWFwKG1pbGVzdG9uZSA9PiAoe1xuICAgICAgbWlsZXN0b25lOiBtaWxlc3RvbmUucGVyY2VudGFnZSxcbiAgICAgIGFjaGlldmVkOiBjdXJyZW50UHJvZ3Jlc3MucmVkdWN0aW9uUGVyY2VudGFnZSA+PSBtaWxlc3RvbmUucGVyY2VudGFnZSxcbiAgICAgIGRlc2NyaXB0aW9uOiBtaWxlc3RvbmUuZGVzY3JpcHRpb25cbiAgICB9KSk7XG5cbiAgICBjb25zdCByZWNvbW1lbmRhdGlvbnM6IHN0cmluZ1tdID0gW107XG4gICAgbGV0IG5lZWRzTWFudWFsSW50ZXJ2ZW50aW9uID0gZmFsc2U7XG5cbiAgICAvLyBBbmFseXplIGlmIHdlIG5lZWQgbWFudWFsIGludGVydmVudGlvblxuICAgIGlmICh0aGlzLmJhdGNoSGlzdG9yeS5sZW5ndGggPj0gNSkge1xuICAgICAgY29uc3QgcmVjZW50QmF0Y2hlcyA9IHRoaXMuYmF0Y2hIaXN0b3J5LnNsaWNlKC01KTtcbiAgICAgIGNvbnN0IGF2Z1N1Y2Nlc3NSYXRlID0gcmVjZW50QmF0Y2hlcy5yZWR1Y2UoKHN1bSwgYmF0Y2gpID0+XG4gICAgICAgIHN1bSArIChiYXRjaC5yZXBsYWNlbWVudHNTdWNjZXNzZnVsIC8gTWF0aC5tYXgoMSwgYmF0Y2gucmVwbGFjZW1lbnRzQXR0ZW1wdGVkKSksIDBcbiAgICAgICkgLyByZWNlbnRCYXRjaGVzLmxlbmd0aDtcblxuICAgICAgY29uc3QgYXZnU2FmZXR5U2NvcmUgPSByZWNlbnRCYXRjaGVzLnJlZHVjZSgoc3VtLCBiYXRjaCkgPT4gc3VtICsgYmF0Y2guc2FmZXR5U2NvcmUsIDApIC8gcmVjZW50QmF0Y2hlcy5sZW5ndGg7XG5cbiAgICAgIGlmIChhdmdTdWNjZXNzUmF0ZSA8IDAuMykge1xuICAgICAgICBuZWVkc01hbnVhbEludGVydmVudGlvbiA9IHRydWU7XG4gICAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKCdMb3cgc3VjY2VzcyByYXRlIGRldGVjdGVkIC0gY29uc2lkZXIgbWFudWFsIHJldmlldyBvZiByZW1haW5pbmcgYW55IHR5cGVzJyk7XG4gICAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKCdGb2N1cyBvbiBkb2N1bWVudGluZyBpbnRlbnRpb25hbCBhbnkgdHlwZXMgaW5zdGVhZCBvZiByZXBsYWNlbWVudCcpO1xuICAgICAgfVxuXG4gICAgICBpZiAoYXZnU2FmZXR5U2NvcmUgPCAwLjcpIHtcbiAgICAgICAgbmVlZHNNYW51YWxJbnRlcnZlbnRpb24gPSB0cnVlO1xuICAgICAgICByZWNvbW1lbmRhdGlvbnMucHVzaCgnU2FmZXR5IGNvbmNlcm5zIGRldGVjdGVkIC0gcGF1c2UgYXV0b21hdGVkIHByb2Nlc3NpbmcnKTtcbiAgICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goJ1JldmlldyByZWNlbnQgY2hhbmdlcyBhbmQgY29uc2lkZXIgcm9sbGJhY2sgaWYgbmVjZXNzYXJ5Jyk7XG4gICAgICB9XG5cbiAgICAgIC8vIENoZWNrIGZvciBzdGFnbmF0aW9uXG4gICAgICBjb25zdCByZWNlbnRQcm9ncmVzcyA9IHJlY2VudEJhdGNoZXMucmVkdWNlKChzdW0sIGJhdGNoKSA9PiBzdW0gKyBiYXRjaC5yZXBsYWNlbWVudHNTdWNjZXNzZnVsLCAwKTtcbiAgICAgIGlmIChyZWNlbnRQcm9ncmVzcyA8IDUgJiYgcmVjZW50QmF0Y2hlcy5sZW5ndGggPj0gMykge1xuICAgICAgICBuZWVkc01hbnVhbEludGVydmVudGlvbiA9IHRydWU7XG4gICAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKCdQcm9ncmVzcyBoYXMgc3RhZ25hdGVkIC0gcmVtYWluaW5nIGFueSB0eXBlcyBtYXkgcmVxdWlyZSBtYW51YWwgYW5hbHlzaXMnKTtcbiAgICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goJ0NvbnNpZGVyIHN3aXRjaGluZyB0byBkb2N1bWVudGF0aW9uIG1vZGUgZm9yIHJlbWFpbmluZyB0eXBlcycpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIFByb3ZpZGUgc3RyYXRlZ2ljIHJlY29tbWVuZGF0aW9ucyBiYXNlZCBvbiBjdXJyZW50IHN0YXRlXG4gICAgaWYgKGN1cnJlbnRQcm9ncmVzcy5yZWR1Y3Rpb25QZXJjZW50YWdlIDwgNSkge1xuICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goJ0Vhcmx5IHN0YWdlIC0gZm9jdXMgb24gYXJyYXkgdHlwZXMgKGFueVtdKSBmb3IgcXVpY2sgd2lucycpO1xuICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goJ0luY3JlYXNlIGNvbmZpZGVuY2UgdGhyZXNob2xkIHRvIDAuOSBmb3IgbWF4aW11bSBzYWZldHknKTtcbiAgICB9IGVsc2UgaWYgKGN1cnJlbnRQcm9ncmVzcy5yZWR1Y3Rpb25QZXJjZW50YWdlIDwgMTApIHtcbiAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKCdHb29kIHByb2dyZXNzIC0gZXhwYW5kIHRvIFJlY29yZDxzdHJpbmcsIGFueT4gcGF0dGVybnMnKTtcbiAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKCdDb25zaWRlciBlbmFibGluZyBkb21haW4tc3BlY2lmaWMgYW5hbHlzaXMgZm9yIGJldHRlciBzdWdnZXN0aW9ucycpO1xuICAgIH0gZWxzZSBpZiAoY3VycmVudFByb2dyZXNzLnJlZHVjdGlvblBlcmNlbnRhZ2UgPj0gdGFyZ2V0SW5mby5yZWNvbW1lbmRlZFRhcmdldCAqIDAuOCkge1xuICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goJ0FwcHJvYWNoaW5nIHRhcmdldCAtIGZvY3VzIG9uIGRvY3VtZW50YXRpb24gZm9yIHJlbWFpbmluZyBpbnRlbnRpb25hbCB0eXBlcycpO1xuICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goJ0NvbnNpZGVyIG1hbnVhbCByZXZpZXcgZm9yIGNvbXBsZXggcmVtYWluaW5nIGNhc2VzJyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIGN1cnJlbnRQcm9ncmVzcyxcbiAgICAgIG1pbGVzdG9uZVN0YXR1cyxcbiAgICAgIHJlY29tbWVuZGF0aW9ucyxcbiAgICAgIG5lZWRzTWFudWFsSW50ZXJ2ZW50aW9uXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBbmFseXplIHN1Y2Nlc3MgcmF0ZSBhbmQgYWRhcHQgc3RyYXRlZ3kgYWNjb3JkaW5nbHlcbiAgICovXG4gIGFuYWx5emVTdWNjZXNzUmF0ZUFuZEFkYXB0KCk6IHtcbiAgICBjdXJyZW50U3VjY2Vzc1JhdGU6IG51bWJlcjtcbiAgICB0cmVuZDogJ2ltcHJvdmluZycgfCAnZGVjbGluaW5nJyB8ICdzdGFibGUnO1xuICAgIGFkYXB0YXRpb25zOiBzdHJpbmdbXTtcbiAgfSB7XG4gICAgaWYgKHRoaXMuYmF0Y2hIaXN0b3J5Lmxlbmd0aCA8IDIpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGN1cnJlbnRTdWNjZXNzUmF0ZTogMCxcbiAgICAgICAgdHJlbmQ6ICdzdGFibGUnLFxuICAgICAgICBhZGFwdGF0aW9uczogWydJbnN1ZmZpY2llbnQgZGF0YSBmb3IgdHJlbmQgYW5hbHlzaXMnXVxuICAgICAgfTtcbiAgICB9XG5cbiAgICBjb25zdCByZWNlbnRCYXRjaGVzID0gdGhpcy5iYXRjaEhpc3Rvcnkuc2xpY2UoLTUpO1xuICAgIGNvbnN0IGN1cnJlbnRTdWNjZXNzUmF0ZSA9IHJlY2VudEJhdGNoZXMucmVkdWNlKChzdW0sIGJhdGNoKSA9PlxuICAgICAgc3VtICsgKGJhdGNoLnJlcGxhY2VtZW50c1N1Y2Nlc3NmdWwgLyBNYXRoLm1heCgxLCBiYXRjaC5yZXBsYWNlbWVudHNBdHRlbXB0ZWQpKSwgMFxuICAgICkgLyByZWNlbnRCYXRjaGVzLmxlbmd0aDtcblxuICAgIC8vIERldGVybWluZSB0cmVuZFxuICAgIGxldCB0cmVuZDogJ2ltcHJvdmluZycgfCAnZGVjbGluaW5nJyB8ICdzdGFibGUnID0gJ3N0YWJsZSc7XG4gICAgY29uc3QgYWRhcHRhdGlvbnM6IHN0cmluZ1tdID0gW107XG5cbiAgICBpZiAocmVjZW50QmF0Y2hlcy5sZW5ndGggPj0gMykge1xuICAgICAgY29uc3QgZmlyc3RIYWxmID0gcmVjZW50QmF0Y2hlcy5zbGljZSgwLCBNYXRoLmZsb29yKHJlY2VudEJhdGNoZXMubGVuZ3RoIC8gMikpO1xuICAgICAgY29uc3Qgc2Vjb25kSGFsZiA9IHJlY2VudEJhdGNoZXMuc2xpY2UoTWF0aC5mbG9vcihyZWNlbnRCYXRjaGVzLmxlbmd0aCAvIDIpKTtcblxuICAgICAgY29uc3QgZmlyc3RIYWxmUmF0ZSA9IGZpcnN0SGFsZi5yZWR1Y2UoKHN1bSwgYmF0Y2gpID0+XG4gICAgICAgIHN1bSArIChiYXRjaC5yZXBsYWNlbWVudHNTdWNjZXNzZnVsIC8gTWF0aC5tYXgoMSwgYmF0Y2gucmVwbGFjZW1lbnRzQXR0ZW1wdGVkKSksIDBcbiAgICAgICkgLyBmaXJzdEhhbGYubGVuZ3RoO1xuXG4gICAgICBjb25zdCBzZWNvbmRIYWxmUmF0ZSA9IHNlY29uZEhhbGYucmVkdWNlKChzdW0sIGJhdGNoKSA9PlxuICAgICAgICBzdW0gKyAoYmF0Y2gucmVwbGFjZW1lbnRzU3VjY2Vzc2Z1bCAvIE1hdGgubWF4KDEsIGJhdGNoLnJlcGxhY2VtZW50c0F0dGVtcHRlZCkpLCAwXG4gICAgICApIC8gc2Vjb25kSGFsZi5sZW5ndGg7XG5cbiAgICAgIGlmIChzZWNvbmRIYWxmUmF0ZSA+IGZpcnN0SGFsZlJhdGUgKyAwLjEpIHtcbiAgICAgICAgdHJlbmQgPSAnaW1wcm92aW5nJztcbiAgICAgICAgYWRhcHRhdGlvbnMucHVzaCgnU3VjY2VzcyByYXRlIGltcHJvdmluZyAtIGNvbnNpZGVyIGluY3JlYXNpbmcgYmF0Y2ggc2l6ZScpO1xuICAgICAgfSBlbHNlIGlmIChzZWNvbmRIYWxmUmF0ZSA8IGZpcnN0SGFsZlJhdGUgLSAwLjEpIHtcbiAgICAgICAgdHJlbmQgPSAnZGVjbGluaW5nJztcbiAgICAgICAgYWRhcHRhdGlvbnMucHVzaCgnU3VjY2VzcyByYXRlIGRlY2xpbmluZyAtIHJlZHVjaW5nIGJhdGNoIHNpemUgYW5kIGluY3JlYXNpbmcgY29uZmlkZW5jZSB0aHJlc2hvbGQnKTtcblxuICAgICAgICAvLyBBcHBseSBhZGFwdGF0aW9uc1xuICAgICAgICB0aGlzLmFkYXB0aXZlQ29uZmlnLm1heEZpbGVzUGVyQmF0Y2ggPSBNYXRoLm1heCg1LCBNYXRoLmZsb29yKHRoaXMuYWRhcHRpdmVDb25maWcubWF4RmlsZXNQZXJCYXRjaCAqIDAuOCkpO1xuICAgICAgICB0aGlzLmFkYXB0aXZlQ29uZmlnLmNvbmZpZGVuY2VUaHJlc2hvbGQgPSBNYXRoLm1pbigwLjk1LCB0aGlzLmFkYXB0aXZlQ29uZmlnLmNvbmZpZGVuY2VUaHJlc2hvbGQgKyAwLjEpO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIFN1Y2Nlc3MgcmF0ZSBiYXNlZCBhZGFwdGF0aW9uc1xuICAgIGlmIChjdXJyZW50U3VjY2Vzc1JhdGUgPCAwLjMpIHtcbiAgICAgIGFkYXB0YXRpb25zLnB1c2goJ1ZlcnkgbG93IHN1Y2Nlc3MgcmF0ZSAtIHN3aXRjaGluZyB0byBkb2N1bWVudGF0aW9uIG1vZGUgcmVjb21tZW5kZWQnKTtcbiAgICAgIGFkYXB0YXRpb25zLnB1c2goJ0NvbnNpZGVyIG1hbnVhbCByZXZpZXcgb2YgcmVtYWluaW5nIGFueSB0eXBlcycpO1xuICAgIH0gZWxzZSBpZiAoY3VycmVudFN1Y2Nlc3NSYXRlIDwgMC41KSB7XG4gICAgICBhZGFwdGF0aW9ucy5wdXNoKCdMb3cgc3VjY2VzcyByYXRlIC0gaW5jcmVhc2luZyBjb25maWRlbmNlIHRocmVzaG9sZCB0byAwLjknKTtcbiAgICAgIHRoaXMuYWRhcHRpdmVDb25maWcuY29uZmlkZW5jZVRocmVzaG9sZCA9IE1hdGgubWluKDAuOTUsIHRoaXMuYWRhcHRpdmVDb25maWcuY29uZmlkZW5jZVRocmVzaG9sZCArIDAuMSk7XG4gICAgfSBlbHNlIGlmIChjdXJyZW50U3VjY2Vzc1JhdGUgPiAwLjgpIHtcbiAgICAgIGFkYXB0YXRpb25zLnB1c2goJ0hpZ2ggc3VjY2VzcyByYXRlIC0gY2FuIGFmZm9yZCB0byBiZSBtb3JlIGFnZ3Jlc3NpdmUnKTtcbiAgICAgIHRoaXMuYWRhcHRpdmVDb25maWcuY29uZmlkZW5jZVRocmVzaG9sZCA9IE1hdGgubWF4KDAuNywgdGhpcy5hZGFwdGl2ZUNvbmZpZy5jb25maWRlbmNlVGhyZXNob2xkIC0gMC4wNSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIGN1cnJlbnRTdWNjZXNzUmF0ZSxcbiAgICAgIHRyZW5kLFxuICAgICAgYWRhcHRhdGlvbnNcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEV4ZWN1dGUgYSBzaW5nbGUgYmF0Y2ggb2YgaW1wcm92ZW1lbnRzIHdpdGggYWRhcHRpdmUgc2l6aW5nXG4gICAqL1xuICBhc3luYyBleGVjdXRlQmF0Y2goY29uZmlnPzogVW5pbnRlbnRpb25hbEFueUNvbmZpZyk6IFByb21pc2U8QmF0Y2hNZXRyaWNzPiB7XG4gICAgY29uc3Qgc3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICB0aGlzLmJhdGNoQ291bnRlcisrO1xuXG4gICAgLy8gVXNlIGFkYXB0aXZlIGNvbmZpZyBpZiBubyBjb25maWcgcHJvdmlkZWQsIG9yIG1lcmdlIHdpdGggcHJvdmlkZWQgY29uZmlnXG4gICAgY29uc3QgZWZmZWN0aXZlQ29uZmlnID0gY29uZmlnID8geyAuLi50aGlzLmFkYXB0aXZlQ29uZmlnLCAuLi5jb25maWcgfSA6IHRoaXMuYWRhcHRpdmVDb25maWc7XG5cbiAgICBjb25zdCBiYXRjaE1ldHJpY3M6IEJhdGNoTWV0cmljcyA9IHtcbiAgICAgIGJhdGNoTnVtYmVyOiB0aGlzLmJhdGNoQ291bnRlcixcbiAgICAgIGZpbGVzUHJvY2Vzc2VkOiAwLFxuICAgICAgYW55VHlwZXNBbmFseXplZDogMCxcbiAgICAgIHJlcGxhY2VtZW50c0F0dGVtcHRlZDogMCxcbiAgICAgIHJlcGxhY2VtZW50c1N1Y2Nlc3NmdWw6IDAsXG4gICAgICBjb21waWxhdGlvbkVycm9yczogMCxcbiAgICAgIHJvbGxiYWNrc1BlcmZvcm1lZDogMCxcbiAgICAgIGV4ZWN1dGlvblRpbWU6IDAsXG4gICAgICBzYWZldHlTY29yZTogMS4wXG4gICAgfTtcblxuICAgIHRyeSB7XG4gICAgICAvLyBDcmVhdGUgc2FmZXR5IGNoZWNrcG9pbnQgYmVmb3JlIHN0YXJ0aW5nXG4gICAgICBhd2FpdCB0aGlzLmNyZWF0ZVNhZmV0eUNoZWNrcG9pbnQoKTtcblxuICAgICAgLy8gR2V0IGluaXRpYWwgVHlwZVNjcmlwdCBlcnJvciBjb3VudCBmb3Igc2FmZXR5IG1vbml0b3JpbmdcbiAgICAgIGNvbnN0IGluaXRpYWxFcnJvckNvdW50ID0gYXdhaXQgdGhpcy5nZXRUeXBlU2NyaXB0RXJyb3JDb3VudCgpO1xuXG4gICAgICAvLyBGaW5kIGZpbGVzIHdpdGggZXhwbGljaXQgYW55IHR5cGVzXG4gICAgICBjb25zdCBjYW5kaWRhdGVGaWxlcyA9IGF3YWl0IHRoaXMuZmluZEZpbGVzV2l0aEFueVR5cGVzKCk7XG4gICAgICBjb25zdCBmaWxlc1RvUHJvY2VzcyA9IGNhbmRpZGF0ZUZpbGVzXG4gICAgICAgIC5maWx0ZXIoZmlsZSA9PiAhdGhpcy5wcm9jZXNzZWRGaWxlcy5oYXMoZmlsZSkpXG4gICAgICAgIC5zbGljZSgwLCBlZmZlY3RpdmVDb25maWcubWF4RmlsZXNQZXJCYXRjaCk7XG5cbiAgICAgIGlmIChmaWxlc1RvUHJvY2Vzcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgY29uc29sZS5sb2coJ05vIG1vcmUgZmlsZXMgdG8gcHJvY2VzcyBpbiB0aGlzIGJhdGNoJyk7XG4gICAgICAgIGJhdGNoTWV0cmljcy5leGVjdXRpb25UaW1lID0gRGF0ZS5ub3coKSAtIHN0YXJ0VGltZTtcbiAgICAgICAgdGhpcy5iYXRjaEhpc3RvcnkucHVzaChiYXRjaE1ldHJpY3MpO1xuICAgICAgICByZXR1cm4gYmF0Y2hNZXRyaWNzO1xuICAgICAgfVxuXG4gICAgICBjb25zb2xlLmxvZyhgUHJvY2Vzc2luZyBiYXRjaCAke3RoaXMuYmF0Y2hDb3VudGVyfTogJHtmaWxlc1RvUHJvY2Vzcy5sZW5ndGh9IGZpbGVzIChhZGFwdGl2ZSBiYXRjaCBzaXplOiAke2VmZmVjdGl2ZUNvbmZpZy5tYXhGaWxlc1BlckJhdGNofSlgKTtcblxuICAgICAgLy8gUHJvY2VzcyBlYWNoIGZpbGVcbiAgICAgIGZvciAoY29uc3QgZmlsZVBhdGggb2YgZmlsZXNUb1Byb2Nlc3MpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zdCBmaWxlUmVzdWx0ID0gYXdhaXQgdGhpcy5wcm9jZXNzRmlsZShmaWxlUGF0aCwgZWZmZWN0aXZlQ29uZmlnKTtcblxuICAgICAgICAgIGJhdGNoTWV0cmljcy5maWxlc1Byb2Nlc3NlZCsrO1xuICAgICAgICAgIGJhdGNoTWV0cmljcy5hbnlUeXBlc0FuYWx5emVkICs9IGZpbGVSZXN1bHQuYW55VHlwZXNBbmFseXplZDtcbiAgICAgICAgICBiYXRjaE1ldHJpY3MucmVwbGFjZW1lbnRzQXR0ZW1wdGVkICs9IGZpbGVSZXN1bHQucmVwbGFjZW1lbnRzQXR0ZW1wdGVkO1xuICAgICAgICAgIGJhdGNoTWV0cmljcy5yZXBsYWNlbWVudHNTdWNjZXNzZnVsICs9IGZpbGVSZXN1bHQucmVwbGFjZW1lbnRzU3VjY2Vzc2Z1bDtcblxuICAgICAgICAgIGlmIChmaWxlUmVzdWx0LnJvbGxiYWNrUGVyZm9ybWVkKSB7XG4gICAgICAgICAgICBiYXRjaE1ldHJpY3Mucm9sbGJhY2tzUGVyZm9ybWVkKys7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgdGhpcy5wcm9jZXNzZWRGaWxlcy5hZGQoZmlsZVBhdGgpO1xuXG4gICAgICAgICAgLy8gVmFsaWRhdGUgYnVpbGQgZXZlcnkgZmV3IGZpbGVzIGJhc2VkIG9uIGFkYXB0aXZlIGNvbmZpZ1xuICAgICAgICAgIGlmIChiYXRjaE1ldHJpY3MuZmlsZXNQcm9jZXNzZWQgJSBlZmZlY3RpdmVDb25maWcudmFsaWRhdGlvbkZyZXF1ZW5jeSA9PT0gMCkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coYFNhZmV0eSBjaGVja3BvaW50OiB2YWxpZGF0aW5nIGJ1aWxkIGFmdGVyICR7YmF0Y2hNZXRyaWNzLmZpbGVzUHJvY2Vzc2VkfSBmaWxlc2ApO1xuICAgICAgICAgICAgY29uc3QgY3VycmVudEVycm9yQ291bnQgPSBhd2FpdCB0aGlzLmdldFR5cGVTY3JpcHRFcnJvckNvdW50KCk7XG5cbiAgICAgICAgICAgIC8vIFNhZmV0eSBjaGVjazogZW5zdXJlIHdlJ3JlIG5vdCBpbmNyZWFzaW5nIGVycm9ycyBzaWduaWZpY2FudGx5XG4gICAgICAgICAgICBpZiAoY3VycmVudEVycm9yQ291bnQgPiBpbml0aWFsRXJyb3JDb3VudCArIDUpIHsgLy8gQWxsb3cgc21hbGwgaW5jcmVhc2UgZm9yIHRlbXBvcmFyeSBzdGF0ZXNcbiAgICAgICAgICAgICAgY29uc29sZS53YXJuKGBFcnJvciBjb3VudCBpbmNyZWFzZWQgZnJvbSAke2luaXRpYWxFcnJvckNvdW50fSB0byAke2N1cnJlbnRFcnJvckNvdW50fSwgcGF1c2luZyBiYXRjaGApO1xuICAgICAgICAgICAgICBiYXRjaE1ldHJpY3MuY29tcGlsYXRpb25FcnJvcnMgPSBjdXJyZW50RXJyb3JDb3VudCAtIGluaXRpYWxFcnJvckNvdW50O1xuICAgICAgICAgICAgICBiYXRjaE1ldHJpY3Muc2FmZXR5U2NvcmUgPSBNYXRoLm1heCgwLCAxIC0gKGJhdGNoTWV0cmljcy5jb21waWxhdGlvbkVycm9ycyAvIDEwKSk7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cblxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEZhaWxlZCB0byBwcm9jZXNzIGZpbGUgJHtmaWxlUGF0aH06YCwgZXJyb3IpO1xuICAgICAgICAgIGJhdGNoTWV0cmljcy5yb2xsYmFja3NQZXJmb3JtZWQrKztcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBGaW5hbCBzYWZldHkgdmFsaWRhdGlvblxuICAgICAgY29uc3QgZmluYWxFcnJvckNvdW50ID0gYXdhaXQgdGhpcy5nZXRUeXBlU2NyaXB0RXJyb3JDb3VudCgpO1xuICAgICAgaWYgKGZpbmFsRXJyb3JDb3VudCA+IGluaXRpYWxFcnJvckNvdW50KSB7XG4gICAgICAgIGJhdGNoTWV0cmljcy5jb21waWxhdGlvbkVycm9ycyA9IGZpbmFsRXJyb3JDb3VudCAtIGluaXRpYWxFcnJvckNvdW50O1xuICAgICAgICBiYXRjaE1ldHJpY3Muc2FmZXR5U2NvcmUgPSBNYXRoLm1heCgwLCAxIC0gKGJhdGNoTWV0cmljcy5jb21waWxhdGlvbkVycm9ycyAvIDIwKSk7XG4gICAgICB9XG5cbiAgICAgIGJhdGNoTWV0cmljcy5leGVjdXRpb25UaW1lID0gRGF0ZS5ub3coKSAtIHN0YXJ0VGltZTtcblxuICAgICAgLy8gU3RvcmUgYmF0Y2ggbWV0cmljcyBmb3IgYWRhcHRpdmUgc3RyYXRlZ3lcbiAgICAgIHRoaXMuYmF0Y2hIaXN0b3J5LnB1c2goYmF0Y2hNZXRyaWNzKTtcblxuICAgICAgLy8gQ2FsY3VsYXRlIHN1Y2Nlc3MgcmF0ZSBmb3IgdGhpcyBiYXRjaFxuICAgICAgY29uc3Qgc3VjY2Vzc1JhdGUgPSBiYXRjaE1ldHJpY3MucmVwbGFjZW1lbnRzQXR0ZW1wdGVkID4gMFxuICAgICAgICA/IGJhdGNoTWV0cmljcy5yZXBsYWNlbWVudHNTdWNjZXNzZnVsIC8gYmF0Y2hNZXRyaWNzLnJlcGxhY2VtZW50c0F0dGVtcHRlZFxuICAgICAgICA6IDA7XG5cbiAgICAgIGNvbnNvbGUubG9nKGBCYXRjaCAke3RoaXMuYmF0Y2hDb3VudGVyfSBjb21wbGV0ZWQ6YCwge1xuICAgICAgICBmaWxlc1Byb2Nlc3NlZDogYmF0Y2hNZXRyaWNzLmZpbGVzUHJvY2Vzc2VkLFxuICAgICAgICByZXBsYWNlbWVudHNTdWNjZXNzZnVsOiBiYXRjaE1ldHJpY3MucmVwbGFjZW1lbnRzU3VjY2Vzc2Z1bCxcbiAgICAgICAgc3VjY2Vzc1JhdGU6IGAkeyhzdWNjZXNzUmF0ZSAqIDEwMCkudG9GaXhlZCgxKX0lYCxcbiAgICAgICAgc2FmZXR5U2NvcmU6IGJhdGNoTWV0cmljcy5zYWZldHlTY29yZS50b0ZpeGVkKDIpLFxuICAgICAgICBleGVjdXRpb25UaW1lOiBgJHsoYmF0Y2hNZXRyaWNzLmV4ZWN1dGlvblRpbWUgLyAxMDAwKS50b0ZpeGVkKDEpfXNgXG4gICAgICB9KTtcblxuICAgICAgLy8gQWRhcHQgc3RyYXRlZ3kgYmFzZWQgb24gcGVyZm9ybWFuY2VcbiAgICAgIHRoaXMuYWRhcHRTdHJhdGVneSgpO1xuXG4gICAgICByZXR1cm4gYmF0Y2hNZXRyaWNzO1xuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoYEJhdGNoICR7dGhpcy5iYXRjaENvdW50ZXJ9IGZhaWxlZDpgLCBlcnJvcik7XG4gICAgICBiYXRjaE1ldHJpY3MuZXhlY3V0aW9uVGltZSA9IERhdGUubm93KCkgLSBzdGFydFRpbWU7XG4gICAgICBiYXRjaE1ldHJpY3Muc2FmZXR5U2NvcmUgPSAwO1xuICAgICAgdGhpcy5iYXRjaEhpc3RvcnkucHVzaChiYXRjaE1ldHJpY3MpO1xuICAgICAgcmV0dXJuIGJhdGNoTWV0cmljcztcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRXhlY3V0ZSB0aGUgZnVsbCBjYW1wYWlnbiB3aXRoIHByb2dyZXNzaXZlIGltcHJvdmVtZW50IGFuZCBhZGFwdGl2ZSBzdHJhdGVnaWVzXG4gICAqL1xuICBhc3luYyBleGVjdXRlRnVsbENhbXBhaWduKGNvbmZpZz86IFVuaW50ZW50aW9uYWxBbnlDb25maWcpOiBQcm9taXNlPFVuaW50ZW50aW9uYWxBbnlDYW1wYWlnblJlc3VsdD4ge1xuICAgIGNvbnN0IGNhbXBhaWduU3RhcnQgPSBEYXRlLm5vdygpO1xuXG4gICAgLy8gVXNlIGFkYXB0aXZlIGNvbmZpZyBpZiBubyBjb25maWcgcHJvdmlkZWQsIG9yIG1lcmdlIHdpdGggcHJvdmlkZWQgY29uZmlnXG4gICAgY29uc3QgZWZmZWN0aXZlQ29uZmlnID0gY29uZmlnID8geyAuLi50aGlzLmFkYXB0aXZlQ29uZmlnLCAuLi5jb25maWcgfSA6IHRoaXMuYWRhcHRpdmVDb25maWc7XG5cbiAgICBjb25zdCBpbml0aWFsUHJvZ3Jlc3MgPSBhd2FpdCB0aGlzLmdldEN1cnJlbnRQcm9ncmVzcygpO1xuXG4gICAgY29uc29sZS5sb2coJ1N0YXJ0aW5nIFVuaW50ZW50aW9uYWwgQW55IEVsaW1pbmF0aW9uIENhbXBhaWduJyk7XG4gICAgY29uc29sZS5sb2coYEluaXRpYWwgc3RhdGU6ICR7aW5pdGlhbFByb2dyZXNzLnRvdGFsQW55VHlwZXN9IGFueSB0eXBlcyBmb3VuZGApO1xuICAgIGNvbnNvbGUubG9nKGBUYXJnZXQ6ICR7ZWZmZWN0aXZlQ29uZmlnLnRhcmdldFJlZHVjdGlvblBlcmNlbnRhZ2V9JSByZWR1Y3Rpb25gKTtcbiAgICBjb25zb2xlLmxvZyhgSW5pdGlhbCBiYXRjaCBzaXplOiAke2VmZmVjdGl2ZUNvbmZpZy5tYXhGaWxlc1BlckJhdGNofSwgY29uZmlkZW5jZSB0aHJlc2hvbGQ6ICR7ZWZmZWN0aXZlQ29uZmlnLmNvbmZpZGVuY2VUaHJlc2hvbGR9YCk7XG5cbiAgICBjb25zdCByZXN1bHQ6IFVuaW50ZW50aW9uYWxBbnlDYW1wYWlnblJlc3VsdCA9IHtcbiAgICAgIHRvdGFsQW55VHlwZXNBbmFseXplZDogMCxcbiAgICAgIGludGVudGlvbmFsVHlwZXNJZGVudGlmaWVkOiAwLFxuICAgICAgdW5pbnRlbnRpb25hbFR5cGVzUmVwbGFjZWQ6IDAsXG4gICAgICBkb2N1bWVudGF0aW9uQWRkZWQ6IDAsXG4gICAgICByZWR1Y3Rpb25BY2hpZXZlZDogMCxcbiAgICAgIHNhZmV0eUV2ZW50czogW10sXG4gICAgICB2YWxpZGF0aW9uUmVzdWx0czogW11cbiAgICB9O1xuXG4gICAgbGV0IGJhdGNoQ291bnQgPSAwO1xuICAgIGxldCBjb25zZWN1dGl2ZUZhaWx1cmVzID0gMDtcbiAgICBjb25zdCBtYXhDb25zZWN1dGl2ZUZhaWx1cmVzID0gMztcbiAgICBjb25zdCBtYXhCYXRjaGVzID0gNTA7IC8vIFNhZmV0eSBsaW1pdFxuXG4gICAgd2hpbGUgKGJhdGNoQ291bnQgPCBtYXhCYXRjaGVzICYmIGNvbnNlY3V0aXZlRmFpbHVyZXMgPCBtYXhDb25zZWN1dGl2ZUZhaWx1cmVzKSB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zb2xlLmxvZyhgXFxuLS0tIFN0YXJ0aW5nIGJhdGNoICR7YmF0Y2hDb3VudCArIDF9IC0tLWApO1xuICAgICAgICBjb25zdCBiYXRjaE1ldHJpY3MgPSBhd2FpdCB0aGlzLmV4ZWN1dGVCYXRjaCgpO1xuICAgICAgICBiYXRjaENvdW50Kys7XG5cbiAgICAgICAgcmVzdWx0LnRvdGFsQW55VHlwZXNBbmFseXplZCArPSBiYXRjaE1ldHJpY3MuYW55VHlwZXNBbmFseXplZDtcbiAgICAgICAgcmVzdWx0LnVuaW50ZW50aW9uYWxUeXBlc1JlcGxhY2VkICs9IGJhdGNoTWV0cmljcy5yZXBsYWNlbWVudHNTdWNjZXNzZnVsO1xuXG4gICAgICAgIC8vIENoZWNrIGlmIHdlIHNob3VsZCBjb250aW51ZVxuICAgICAgICBpZiAoYmF0Y2hNZXRyaWNzLmZpbGVzUHJvY2Vzc2VkID09PSAwKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ05vIG1vcmUgZmlsZXMgdG8gcHJvY2VzcywgY2FtcGFpZ24gY29tcGxldGUnKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFNhZmV0eSBjaGVjayB3aXRoIGFkYXB0aXZlIHJlc3BvbnNlXG4gICAgICAgIGlmIChiYXRjaE1ldHJpY3Muc2FmZXR5U2NvcmUgPCAwLjcpIHtcbiAgICAgICAgICBjb25zb2xlLndhcm4oYExvdyBzYWZldHkgc2NvcmUgKCR7YmF0Y2hNZXRyaWNzLnNhZmV0eVNjb3JlLnRvRml4ZWQoMil9KSwgYWRhcHRpbmcgc3RyYXRlZ3lgKTtcbiAgICAgICAgICBjb25zZWN1dGl2ZUZhaWx1cmVzKys7XG5cbiAgICAgICAgICByZXN1bHQuc2FmZXR5RXZlbnRzLnB1c2goe1xuICAgICAgICAgICAgdHlwZTogJ0xPV19TQUZFVFlfU0NPUkUnLFxuICAgICAgICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLFxuICAgICAgICAgICAgZGVzY3JpcHRpb246IGBTYWZldHkgc2NvcmUgJHtiYXRjaE1ldHJpY3Muc2FmZXR5U2NvcmUudG9GaXhlZCgyKX0gYmVsb3cgdGhyZXNob2xkYCxcbiAgICAgICAgICAgIHNldmVyaXR5OiAnd2FybmluZycsXG4gICAgICAgICAgICBiYXRjaE51bWJlcjogYmF0Y2hDb3VudFxuICAgICAgICAgIH0gYXMgYW55KTtcblxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnNlY3V0aXZlRmFpbHVyZXMgPSAwO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQ2hlY2sgcHJvZ3Jlc3MgdG93YXJkcyB0YXJnZXQgd2l0aCBkZXRhaWxlZCByZXBvcnRpbmdcbiAgICAgICAgY29uc3QgY3VycmVudFByb2dyZXNzID0gYXdhaXQgdGhpcy5nZXRDdXJyZW50UHJvZ3Jlc3MoKTtcbiAgICAgICAgY29uc3QgcmVkdWN0aW9uQWNoaWV2ZWQgPSBpbml0aWFsUHJvZ3Jlc3MudG90YWxBbnlUeXBlcyA+IDBcbiAgICAgICAgICA/ICgoaW5pdGlhbFByb2dyZXNzLnRvdGFsQW55VHlwZXMgLSBjdXJyZW50UHJvZ3Jlc3MudG90YWxBbnlUeXBlcykgLyBpbml0aWFsUHJvZ3Jlc3MudG90YWxBbnlUeXBlcykgKiAxMDBcbiAgICAgICAgICA6IDA7XG5cbiAgICAgICAgY29uc29sZS5sb2coYFxcblByb2dyZXNzIFJlcG9ydDpgKTtcbiAgICAgICAgY29uc29sZS5sb2coYCAgUmVkdWN0aW9uIGFjaGlldmVkOiAke3JlZHVjdGlvbkFjaGlldmVkLnRvRml4ZWQoMSl9JSAodGFyZ2V0OiAke2VmZmVjdGl2ZUNvbmZpZy50YXJnZXRSZWR1Y3Rpb25QZXJjZW50YWdlfSUpYCk7XG4gICAgICAgIGNvbnNvbGUubG9nKGAgIFR5cGVzIHJlcGxhY2VkOiAke3Jlc3VsdC51bmludGVudGlvbmFsVHlwZXNSZXBsYWNlZH1gKTtcbiAgICAgICAgY29uc29sZS5sb2coYCAgQmF0Y2hlcyBjb21wbGV0ZWQ6ICR7YmF0Y2hDb3VudH1gKTtcbiAgICAgICAgY29uc29sZS5sb2coYCAgQ3VycmVudCBiYXRjaCBzaXplOiAke3RoaXMuYWRhcHRpdmVDb25maWcubWF4RmlsZXNQZXJCYXRjaH1gKTtcbiAgICAgICAgY29uc29sZS5sb2coYCAgQ3VycmVudCBjb25maWRlbmNlIHRocmVzaG9sZDogJHt0aGlzLmFkYXB0aXZlQ29uZmlnLmNvbmZpZGVuY2VUaHJlc2hvbGQudG9GaXhlZCgyKX1gKTtcblxuICAgICAgICBpZiAocmVkdWN0aW9uQWNoaWV2ZWQgPj0gZWZmZWN0aXZlQ29uZmlnLnRhcmdldFJlZHVjdGlvblBlcmNlbnRhZ2UpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZygnXFxu8J+OiSBUYXJnZXQgcmVkdWN0aW9uIGFjaGlldmVkIScpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gQnJpZWYgcGF1c2UgYmV0d2VlbiBiYXRjaGVzIGZvciBzeXN0ZW0gc3RhYmlsaXR5XG4gICAgICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCAyMDAwKSk7XG5cbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoYENhbXBhaWduIGJhdGNoICR7YmF0Y2hDb3VudCArIDF9IGZhaWxlZDpgLCBlcnJvcik7XG4gICAgICAgIGNvbnNlY3V0aXZlRmFpbHVyZXMrKztcblxuICAgICAgICByZXN1bHQuc2FmZXR5RXZlbnRzLnB1c2goe1xuICAgICAgICAgIHR5cGU6ICdCQVRDSF9GQUlMVVJFJyxcbiAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAgICAgICAgZGVzY3JpcHRpb246IGBCYXRjaCAke2JhdGNoQ291bnQgKyAxfSBmYWlsZWQ6ICR7ZXJyb3IubWVzc2FnZX1gLFxuICAgICAgICAgIHNldmVyaXR5OiAnZXJyb3InLFxuICAgICAgICAgIGJhdGNoTnVtYmVyOiBiYXRjaENvdW50ICsgMVxuICAgICAgICB9IGFzIGFueSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gQ2FsY3VsYXRlIGZpbmFsIHJlc3VsdHMgd2l0aCBjb21wcmVoZW5zaXZlIG1ldHJpY3NcbiAgICBjb25zdCBmaW5hbFByb2dyZXNzID0gYXdhaXQgdGhpcy5nZXRDdXJyZW50UHJvZ3Jlc3MoKTtcbiAgICByZXN1bHQucmVkdWN0aW9uQWNoaWV2ZWQgPSBpbml0aWFsUHJvZ3Jlc3MudG90YWxBbnlUeXBlcyA+IDBcbiAgICAgID8gKChpbml0aWFsUHJvZ3Jlc3MudG90YWxBbnlUeXBlcyAtIGZpbmFsUHJvZ3Jlc3MudG90YWxBbnlUeXBlcykgLyBpbml0aWFsUHJvZ3Jlc3MudG90YWxBbnlUeXBlcykgKiAxMDBcbiAgICAgIDogMDtcbiAgICByZXN1bHQuaW50ZW50aW9uYWxUeXBlc0lkZW50aWZpZWQgPSBmaW5hbFByb2dyZXNzLmNsYXNzaWZpZWRJbnRlbnRpb25hbDtcblxuICAgIC8vIENhbGN1bGF0ZSBhdmVyYWdlIHN1Y2Nlc3MgcmF0ZSBmcm9tIGJhdGNoIGhpc3RvcnlcbiAgICBjb25zdCB0b3RhbEF0dGVtcHRlZCA9IHRoaXMuYmF0Y2hIaXN0b3J5LnJlZHVjZSgoc3VtLCBiYXRjaCkgPT4gc3VtICsgYmF0Y2gucmVwbGFjZW1lbnRzQXR0ZW1wdGVkLCAwKTtcbiAgICBjb25zdCB0b3RhbFN1Y2Nlc3NmdWwgPSB0aGlzLmJhdGNoSGlzdG9yeS5yZWR1Y2UoKHN1bSwgYmF0Y2gpID0+IHN1bSArIGJhdGNoLnJlcGxhY2VtZW50c1N1Y2Nlc3NmdWwsIDApO1xuICAgIGNvbnN0IG92ZXJhbGxTdWNjZXNzUmF0ZSA9IHRvdGFsQXR0ZW1wdGVkID4gMCA/ICh0b3RhbFN1Y2Nlc3NmdWwgLyB0b3RhbEF0dGVtcHRlZCkgKiAxMDAgOiAwO1xuXG4gICAgY29uc3QgY2FtcGFpZ25UaW1lID0gRGF0ZS5ub3coKSAtIGNhbXBhaWduU3RhcnQ7XG5cbiAgICBjb25zb2xlLmxvZyhgXFxuPT09IENhbXBhaWduIFN1bW1hcnkgPT09YCk7XG4gICAgY29uc29sZS5sb2coYER1cmF0aW9uOiAkeyhjYW1wYWlnblRpbWUgLyAxMDAwKS50b0ZpeGVkKDEpfXNgKTtcbiAgICBjb25zb2xlLmxvZyhgQmF0Y2hlcyBwcm9jZXNzZWQ6ICR7YmF0Y2hDb3VudH1gKTtcbiAgICBjb25zb2xlLmxvZyhgRmlsZXMgcHJvY2Vzc2VkOiAke3RoaXMucHJvY2Vzc2VkRmlsZXMuc2l6ZX1gKTtcbiAgICBjb25zb2xlLmxvZyhgUmVkdWN0aW9uIGFjaGlldmVkOiAke3Jlc3VsdC5yZWR1Y3Rpb25BY2hpZXZlZC50b0ZpeGVkKDEpfSVgKTtcbiAgICBjb25zb2xlLmxvZyhgVHlwZXMgcmVwbGFjZWQ6ICR7cmVzdWx0LnVuaW50ZW50aW9uYWxUeXBlc1JlcGxhY2VkfWApO1xuICAgIGNvbnNvbGUubG9nKGBPdmVyYWxsIHN1Y2Nlc3MgcmF0ZTogJHtvdmVyYWxsU3VjY2Vzc1JhdGUudG9GaXhlZCgxKX0lYCk7XG4gICAgY29uc29sZS5sb2coYFNhZmV0eSBldmVudHM6ICR7cmVzdWx0LnNhZmV0eUV2ZW50cy5sZW5ndGh9YCk7XG4gICAgY29uc29sZS5sb2coYEZpbmFsIGJhdGNoIHNpemU6ICR7dGhpcy5hZGFwdGl2ZUNvbmZpZy5tYXhGaWxlc1BlckJhdGNofWApO1xuICAgIGNvbnNvbGUubG9nKGBGaW5hbCBjb25maWRlbmNlIHRocmVzaG9sZDogJHt0aGlzLmFkYXB0aXZlQ29uZmlnLmNvbmZpZGVuY2VUaHJlc2hvbGQudG9GaXhlZCgyKX1gKTtcblxuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHByb2Nlc3NGaWxlKGZpbGVQYXRoOiBzdHJpbmcsIGNvbmZpZzogVW5pbnRlbnRpb25hbEFueUNvbmZpZyk6IFByb21pc2U8e1xuICAgIGFueVR5cGVzQW5hbHl6ZWQ6IG51bWJlcjtcbiAgICByZXBsYWNlbWVudHNBdHRlbXB0ZWQ6IG51bWJlcjtcbiAgICByZXBsYWNlbWVudHNTdWNjZXNzZnVsOiBudW1iZXI7XG4gICAgcm9sbGJhY2tQZXJmb3JtZWQ6IGJvb2xlYW47XG4gIH0+IHtcbiAgICBjb25zdCBmaWxlQ29udGVudCA9IGZzLnJlYWRGaWxlU3luYyhmaWxlUGF0aCwgJ3V0ZjgnKTtcbiAgICBjb25zdCBsaW5lcyA9IGZpbGVDb250ZW50LnNwbGl0KCdcXG4nKTtcblxuICAgIC8vIEZpbmQgYWxsIGFueSB0eXBlIHVzYWdlcyBpbiB0aGUgZmlsZVxuICAgIGNvbnN0IGFueVR5cGVDb250ZXh0czogQ2xhc3NpZmljYXRpb25Db250ZXh0W10gPSBbXTtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGluZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IGxpbmUgPSBsaW5lc1tpXTtcbiAgICAgIGlmICh0aGlzLmNvbnRhaW5zQW55VHlwZShsaW5lKSkge1xuICAgICAgICBjb25zdCBjb250ZXh0OiBDbGFzc2lmaWNhdGlvbkNvbnRleHQgPSB7XG4gICAgICAgICAgZmlsZVBhdGgsXG4gICAgICAgICAgbGluZU51bWJlcjogaSArIDEsXG4gICAgICAgICAgY29kZVNuaXBwZXQ6IGxpbmUsXG4gICAgICAgICAgc3Vycm91bmRpbmdMaW5lczogdGhpcy5nZXRTdXJyb3VuZGluZ0xpbmVzKGxpbmVzLCBpLCAyKSxcbiAgICAgICAgICBoYXNFeGlzdGluZ0NvbW1lbnQ6IHRoaXMuaGFzQ29tbWVudEFib3ZlKGxpbmVzLCBpKSxcbiAgICAgICAgICBleGlzdGluZ0NvbW1lbnQ6IHRoaXMuZ2V0Q29tbWVudEFib3ZlKGxpbmVzLCBpKSxcbiAgICAgICAgICBpc0luVGVzdEZpbGU6IHRoaXMuaXNUZXN0RmlsZShmaWxlUGF0aCksXG4gICAgICAgICAgZG9tYWluQ29udGV4dDogYXdhaXQgdGhpcy5hbmFseXplci5hbmFseXplRG9tYWluKHtcbiAgICAgICAgICAgIGZpbGVQYXRoLFxuICAgICAgICAgICAgbGluZU51bWJlcjogaSArIDEsXG4gICAgICAgICAgICBjb2RlU25pcHBldDogbGluZSxcbiAgICAgICAgICAgIHN1cnJvdW5kaW5nTGluZXM6IHRoaXMuZ2V0U3Vycm91bmRpbmdMaW5lcyhsaW5lcywgaSwgMiksXG4gICAgICAgICAgICBoYXNFeGlzdGluZ0NvbW1lbnQ6IGZhbHNlLFxuICAgICAgICAgICAgaXNJblRlc3RGaWxlOiB0aGlzLmlzVGVzdEZpbGUoZmlsZVBhdGgpLFxuICAgICAgICAgICAgZG9tYWluQ29udGV4dDogeyBkb21haW46ICd1dGlsaXR5JyBhcyBhbnksIGludGVudGlvbmFsaXR5SGludHM6IFtdLCBzdWdnZXN0ZWRUeXBlczogW10sIHByZXNlcnZhdGlvblJlYXNvbnM6IFtdIH1cbiAgICAgICAgICB9KVxuICAgICAgICB9O1xuXG4gICAgICAgIGFueVR5cGVDb250ZXh0cy5wdXNoKGNvbnRleHQpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChhbnlUeXBlQ29udGV4dHMubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBhbnlUeXBlc0FuYWx5emVkOiAwLFxuICAgICAgICByZXBsYWNlbWVudHNBdHRlbXB0ZWQ6IDAsXG4gICAgICAgIHJlcGxhY2VtZW50c1N1Y2Nlc3NmdWw6IDAsXG4gICAgICAgIHJvbGxiYWNrUGVyZm9ybWVkOiBmYWxzZVxuICAgICAgfTtcbiAgICB9XG5cbiAgICAvLyBDbGFzc2lmeSBhbGwgYW55IHR5cGVzIGluIHRoZSBmaWxlXG4gICAgY29uc3QgY2xhc3NpZmljYXRpb25zID0gYXdhaXQgdGhpcy5jbGFzc2lmaWVyLmNsYXNzaWZ5QmF0Y2goYW55VHlwZUNvbnRleHRzKTtcblxuICAgIC8vIENyZWF0ZSByZXBsYWNlbWVudHMgZm9yIHVuaW50ZW50aW9uYWwgYW55IHR5cGVzXG4gICAgY29uc3QgcmVwbGFjZW1lbnRzOiBUeXBlUmVwbGFjZW1lbnRbXSA9IFtdO1xuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjbGFzc2lmaWNhdGlvbnMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IGNsYXNzaWZpY2F0aW9uID0gY2xhc3NpZmljYXRpb25zW2ldO1xuICAgICAgY29uc3QgY29udGV4dCA9IGFueVR5cGVDb250ZXh0c1tpXTtcblxuICAgICAgaWYgKCFjbGFzc2lmaWNhdGlvbi5pc0ludGVudGlvbmFsICYmXG4gICAgICAgICAgY2xhc3NpZmljYXRpb24uY29uZmlkZW5jZSA+PSBjb25maWcuY29uZmlkZW5jZVRocmVzaG9sZCAmJlxuICAgICAgICAgIGNsYXNzaWZpY2F0aW9uLnN1Z2dlc3RlZFJlcGxhY2VtZW50KSB7XG5cbiAgICAgICAgcmVwbGFjZW1lbnRzLnB1c2goe1xuICAgICAgICAgIG9yaWdpbmFsOiAnYW55JyxcbiAgICAgICAgICByZXBsYWNlbWVudDogY2xhc3NpZmljYXRpb24uc3VnZ2VzdGVkUmVwbGFjZW1lbnQsXG4gICAgICAgICAgZmlsZVBhdGg6IGNvbnRleHQuZmlsZVBhdGgsXG4gICAgICAgICAgbGluZU51bWJlcjogY29udGV4dC5saW5lTnVtYmVyLFxuICAgICAgICAgIGNvbmZpZGVuY2U6IGNsYXNzaWZpY2F0aW9uLmNvbmZpZGVuY2UsXG4gICAgICAgICAgdmFsaWRhdGlvblJlcXVpcmVkOiB0cnVlXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cblxuICAgIC8vIEFwcGx5IHJlcGxhY2VtZW50c1xuICAgIGxldCByZXBsYWNlbWVudHNTdWNjZXNzZnVsID0gMDtcbiAgICBsZXQgcm9sbGJhY2tQZXJmb3JtZWQgPSBmYWxzZTtcblxuICAgIGlmIChyZXBsYWNlbWVudHMubGVuZ3RoID4gMCkge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5yZXBsYWNlci5wcm9jZXNzQmF0Y2gocmVwbGFjZW1lbnRzKTtcbiAgICAgIHJlcGxhY2VtZW50c1N1Y2Nlc3NmdWwgPSByZXN1bHQuYXBwbGllZFJlcGxhY2VtZW50cy5sZW5ndGg7XG4gICAgICByb2xsYmFja1BlcmZvcm1lZCA9IHJlc3VsdC5yb2xsYmFja1BlcmZvcm1lZDtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgYW55VHlwZXNBbmFseXplZDogYW55VHlwZUNvbnRleHRzLmxlbmd0aCxcbiAgICAgIHJlcGxhY2VtZW50c0F0dGVtcHRlZDogcmVwbGFjZW1lbnRzLmxlbmd0aCxcbiAgICAgIHJlcGxhY2VtZW50c1N1Y2Nlc3NmdWwsXG4gICAgICByb2xsYmFja1BlcmZvcm1lZFxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGZpbmRGaWxlc1dpdGhBbnlUeXBlcygpOiBQcm9taXNlPHN0cmluZ1tdPiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIFVzZSBncmVwIHRvIGZpbmQgZmlsZXMgd2l0aCBleHBsaWNpdCBhbnkgdHlwZXMsIGV4Y2x1ZGluZyBub2RlX21vZHVsZXMgYW5kIHRlc3QgZmlsZXMgaW5pdGlhbGx5XG4gICAgICBjb25zdCBvdXRwdXQgPSBleGVjU3luYyhcbiAgICAgICAgJ2dyZXAgLXIgLWwgXCI6XFxcXHMqYW55XCIgc3JjLyAtLWluY2x1ZGU9XCIqLnRzXCIgLS1pbmNsdWRlPVwiKi50c3hcIiAtLWV4Y2x1ZGUtZGlyPW5vZGVfbW9kdWxlcyB8IGhlYWQgLTEwMCcsXG4gICAgICAgIHsgZW5jb2Rpbmc6ICd1dGY4Jywgc3RkaW86ICdwaXBlJyB9XG4gICAgICApO1xuXG4gICAgICByZXR1cm4gb3V0cHV0LnRyaW0oKS5zcGxpdCgnXFxuJykuZmlsdGVyKGxpbmUgPT4gbGluZS50cmltKCkubGVuZ3RoID4gMCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUud2FybignRmFpbGVkIHRvIGZpbmQgZmlsZXMgd2l0aCBhbnkgdHlwZXMsIHVzaW5nIGZhbGxiYWNrIG1ldGhvZCcpO1xuICAgICAgcmV0dXJuIHRoaXMuZmluZEZpbGVzV2l0aEFueVR5cGVzRmFsbGJhY2soKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGZpbmRGaWxlc1dpdGhBbnlUeXBlc0ZhbGxiYWNrKCk6IHN0cmluZ1tdIHtcbiAgICBjb25zdCBmaWxlczogc3RyaW5nW10gPSBbXTtcbiAgICBjb25zdCBzcmNEaXIgPSBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgJ3NyYycpO1xuXG4gICAgY29uc3Qgd2Fsa0RpciA9IChkaXI6IHN0cmluZykgPT4ge1xuICAgICAgY29uc3QgZW50cmllcyA9IGZzLnJlYWRkaXJTeW5jKGRpciwgeyB3aXRoRmlsZVR5cGVzOiB0cnVlIH0pO1xuXG4gICAgICBmb3IgKGNvbnN0IGVudHJ5IG9mIGVudHJpZXMpIHtcbiAgICAgICAgY29uc3QgZnVsbFBhdGggPSBwYXRoLmpvaW4oZGlyLCBlbnRyeS5uYW1lKTtcblxuICAgICAgICBpZiAoZW50cnkuaXNEaXJlY3RvcnkoKSAmJiAhZW50cnkubmFtZS5zdGFydHNXaXRoKCcuJykgJiYgZW50cnkubmFtZSAhPT0gJ25vZGVfbW9kdWxlcycpIHtcbiAgICAgICAgICB3YWxrRGlyKGZ1bGxQYXRoKTtcbiAgICAgICAgfSBlbHNlIGlmIChlbnRyeS5pc0ZpbGUoKSAmJiAoZW50cnkubmFtZS5lbmRzV2l0aCgnLnRzJykgfHwgZW50cnkubmFtZS5lbmRzV2l0aCgnLnRzeCcpKSkge1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCBjb250ZW50ID0gZnMucmVhZEZpbGVTeW5jKGZ1bGxQYXRoLCAndXRmOCcpO1xuICAgICAgICAgICAgaWYgKGNvbnRlbnQuaW5jbHVkZXMoJzogYW55JykgfHwgY29udGVudC5pbmNsdWRlcygnYW55W10nKSB8fCBjb250ZW50LmluY2x1ZGVzKCdSZWNvcmQ8c3RyaW5nLCBhbnk+JykpIHtcbiAgICAgICAgICAgICAgZmlsZXMucHVzaChmdWxsUGF0aCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgIC8vIFNraXAgZmlsZXMgdGhhdCBjYW4ndCBiZSByZWFkXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfTtcblxuICAgIGlmIChmcy5leGlzdHNTeW5jKHNyY0RpcikpIHtcbiAgICAgIHdhbGtEaXIoc3JjRGlyKTtcbiAgICB9XG5cbiAgICByZXR1cm4gZmlsZXMuc2xpY2UoMCwgMTAwKTsgLy8gTGltaXQgdG8gcHJldmVudCBvdmVyd2hlbG1pbmdcbiAgfVxuXG4gIHByaXZhdGUgY29udGFpbnNBbnlUeXBlKGxpbmU6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIC8vIE1hdGNoIHZhcmlvdXMgYW55IHR5cGUgcGF0dGVybnNcbiAgICBjb25zdCBhbnlQYXR0ZXJucyA9IFtcbiAgICAgIC86XFxzKmFueSg/PVxccypbPTssXFwpXFxdXFx9XSkvLCAgLy8gOiBhbnkgZm9sbG93ZWQgYnkgZGVsaW1pdGVyXG4gICAgICAvOlxccyphbnlcXFtcXF0vLCAgICAgICAgICAgICAgICAvLyA6IGFueVtdXG4gICAgICAvOlxccypBcnJheTxhbnk+LywgICAgICAgICAgICAgLy8gOiBBcnJheTxhbnk+XG4gICAgICAvOlxccypSZWNvcmQ8XFx3KyxcXHMqYW55Pi8sICAgICAvLyA6IFJlY29yZDxzdHJpbmcsIGFueT5cbiAgICAgIC9cXFtrZXk6XFxzKlxcdytcXF06XFxzKmFueS8gICAgICAgLy8gW2tleTogc3RyaW5nXTogYW55XG4gICAgXTtcblxuICAgIHJldHVybiBhbnlQYXR0ZXJucy5zb21lKHBhdHRlcm4gPT4gcGF0dGVybi50ZXN0KGxpbmUpKTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0U3Vycm91bmRpbmdMaW5lcyhsaW5lczogc3RyaW5nW10sIGluZGV4OiBudW1iZXIsIHJhZGl1czogbnVtYmVyKTogc3RyaW5nW10ge1xuICAgIGNvbnN0IHN0YXJ0ID0gTWF0aC5tYXgoMCwgaW5kZXggLSByYWRpdXMpO1xuICAgIGNvbnN0IGVuZCA9IE1hdGgubWluKGxpbmVzLmxlbmd0aCwgaW5kZXggKyByYWRpdXMgKyAxKTtcbiAgICByZXR1cm4gbGluZXMuc2xpY2Uoc3RhcnQsIGVuZCk7XG4gIH1cblxuICBwcml2YXRlIGhhc0NvbW1lbnRBYm92ZShsaW5lczogc3RyaW5nW10sIGluZGV4OiBudW1iZXIpOiBib29sZWFuIHtcbiAgICBpZiAoaW5kZXggPT09IDApIHJldHVybiBmYWxzZTtcbiAgICBjb25zdCBwcmV2TGluZSA9IGxpbmVzW2luZGV4IC0gMV0udHJpbSgpO1xuICAgIHJldHVybiBwcmV2TGluZS5zdGFydHNXaXRoKCcvLycpIHx8IHByZXZMaW5lLnN0YXJ0c1dpdGgoJy8qJykgfHwgcHJldkxpbmUuaW5jbHVkZXMoJyovJyk7XG4gIH1cblxuICBwcml2YXRlIGdldENvbW1lbnRBYm92ZShsaW5lczogc3RyaW5nW10sIGluZGV4OiBudW1iZXIpOiBzdHJpbmcgfCB1bmRlZmluZWQge1xuICAgIGlmICghdGhpcy5oYXNDb21tZW50QWJvdmUobGluZXMsIGluZGV4KSkgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICByZXR1cm4gbGluZXNbaW5kZXggLSAxXS50cmltKCk7XG4gIH1cblxuICBwcml2YXRlIGlzVGVzdEZpbGUoZmlsZVBhdGg6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIHJldHVybiBmaWxlUGF0aC5pbmNsdWRlcygndGVzdCcpIHx8XG4gICAgICAgICAgIGZpbGVQYXRoLmluY2x1ZGVzKCdzcGVjJykgfHxcbiAgICAgICAgICAgZmlsZVBhdGguaW5jbHVkZXMoJ19fdGVzdHNfXycpIHx8XG4gICAgICAgICAgIGZpbGVQYXRoLmVuZHNXaXRoKCcudGVzdC50cycpIHx8XG4gICAgICAgICAgIGZpbGVQYXRoLmVuZHNXaXRoKCcudGVzdC50c3gnKSB8fFxuICAgICAgICAgICBmaWxlUGF0aC5lbmRzV2l0aCgnLnNwZWMudHMnKSB8fFxuICAgICAgICAgICBmaWxlUGF0aC5lbmRzV2l0aCgnLnNwZWMudHN4Jyk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGdldFR5cGVTY3JpcHRFcnJvckNvdW50KCk6IFByb21pc2U8bnVtYmVyPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IG91dHB1dCA9IGV4ZWNTeW5jKCd5YXJuIHRzYyAtLW5vRW1pdCAtLXNraXBMaWJDaGVjayAyPiYxIHwgZ3JlcCAtYyBcImVycm9yIFRTXCInLCB7XG4gICAgICAgIGVuY29kaW5nOiAndXRmOCcsXG4gICAgICAgIHN0ZGlvOiAncGlwZSdcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHBhcnNlSW50KG91dHB1dC50cmltKCkpIHx8IDA7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIC8vIElmIGdyZXAgZmluZHMgbm8gbWF0Y2hlcywgaXQgcmV0dXJucyBleGl0IGNvZGUgMSwgYnV0IHRoYXQgbWVhbnMgMCBlcnJvcnNcbiAgICAgIGNvbnN0IGVycm9yRGF0YSA9IGVycm9yIGFzIGFueTtcbiAgICAgIGlmIChlcnJvckRhdGEuc3RhdHVzID09PSAxKSB7XG4gICAgICAgIHJldHVybiAwO1xuICAgICAgfVxuICAgICAgY29uc29sZS53YXJuKCdDb3VsZCBub3QgZ2V0IFR5cGVTY3JpcHQgZXJyb3IgY291bnQ6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIC0xOyAvLyBJbmRpY2F0ZXMgbWVhc3VyZW1lbnQgZmFpbHVyZVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBBbmFseXplIGZpbGUgY29tcGxleGl0eSB0byBzZXQgcmVhbGlzdGljIGV4cGVjdGF0aW9uc1xuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBhbmFseXplRmlsZUNvbXBsZXhpdHkoZmlsZXM6IHN0cmluZ1tdKTogUHJvbWlzZTx7XG4gICAgdGVzdEZpbGVQZXJjZW50YWdlOiBudW1iZXI7XG4gICAgYXJyYXlUeXBlUGVyY2VudGFnZTogbnVtYmVyO1xuICAgIHJlY29yZFR5cGVQZXJjZW50YWdlOiBudW1iZXI7XG4gICAgZnVuY3Rpb25QYXJhbVBlcmNlbnRhZ2U6IG51bWJlcjtcbiAgICBjb21wbGV4aXR5U2NvcmU6IG51bWJlcjtcbiAgfT4ge1xuICAgIGxldCB0ZXN0RmlsZXMgPSAwO1xuICAgIGxldCBhcnJheVR5cGVzID0gMDtcbiAgICBsZXQgcmVjb3JkVHlwZXMgPSAwO1xuICAgIGxldCBmdW5jdGlvblBhcmFtcyA9IDA7XG4gICAgbGV0IHRvdGFsQW55VHlwZXMgPSAwO1xuXG4gICAgZm9yIChjb25zdCBmaWxlUGF0aCBvZiBmaWxlcykge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgY29udGVudCA9IGZzLnJlYWRGaWxlU3luYyhmaWxlUGF0aCwgJ3V0ZjgnKTtcbiAgICAgICAgY29uc3QgbGluZXMgPSBjb250ZW50LnNwbGl0KCdcXG4nKTtcblxuICAgICAgICBpZiAodGhpcy5pc1Rlc3RGaWxlKGZpbGVQYXRoKSkge1xuICAgICAgICAgIHRlc3RGaWxlcysrO1xuICAgICAgICB9XG5cbiAgICAgICAgZm9yIChjb25zdCBsaW5lIG9mIGxpbmVzKSB7XG4gICAgICAgICAgaWYgKHRoaXMuY29udGFpbnNBbnlUeXBlKGxpbmUpKSB7XG4gICAgICAgICAgICB0b3RhbEFueVR5cGVzKys7XG5cbiAgICAgICAgICAgIGlmIChsaW5lLmluY2x1ZGVzKCdhbnlbXScpIHx8IGxpbmUuaW5jbHVkZXMoJ0FycmF5PGFueT4nKSkge1xuICAgICAgICAgICAgICBhcnJheVR5cGVzKys7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGxpbmUuaW5jbHVkZXMoJ1JlY29yZDwnKSAmJiBsaW5lLmluY2x1ZGVzKCdhbnk+JykpIHtcbiAgICAgICAgICAgICAgcmVjb3JkVHlwZXMrKztcbiAgICAgICAgICAgIH0gZWxzZSBpZiAobGluZS5pbmNsdWRlcygnKCcpICYmIGxpbmUuaW5jbHVkZXMoJzogYW55JykgJiYgbGluZS5pbmNsdWRlcygnKScpKSB7XG4gICAgICAgICAgICAgIGZ1bmN0aW9uUGFyYW1zKys7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAvLyBTa2lwIGZpbGVzIHRoYXQgY2FuJ3QgYmUgcmVhZFxuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IHRlc3RGaWxlUGVyY2VudGFnZSA9IGZpbGVzLmxlbmd0aCA+IDAgPyAodGVzdEZpbGVzIC8gZmlsZXMubGVuZ3RoKSAqIDEwMCA6IDA7XG4gICAgY29uc3QgYXJyYXlUeXBlUGVyY2VudGFnZSA9IHRvdGFsQW55VHlwZXMgPiAwID8gKGFycmF5VHlwZXMgLyB0b3RhbEFueVR5cGVzKSAqIDEwMCA6IDA7XG4gICAgY29uc3QgcmVjb3JkVHlwZVBlcmNlbnRhZ2UgPSB0b3RhbEFueVR5cGVzID4gMCA/IChyZWNvcmRUeXBlcyAvIHRvdGFsQW55VHlwZXMpICogMTAwIDogMDtcbiAgICBjb25zdCBmdW5jdGlvblBhcmFtUGVyY2VudGFnZSA9IHRvdGFsQW55VHlwZXMgPiAwID8gKGZ1bmN0aW9uUGFyYW1zIC8gdG90YWxBbnlUeXBlcykgKiAxMDAgOiAwO1xuXG4gICAgLy8gQ2FsY3VsYXRlIGNvbXBsZXhpdHkgc2NvcmUgKDAtMSwgd2hlcmUgMSBpcyBtb3N0IGNvbXBsZXgpXG4gICAgY29uc3QgY29tcGxleGl0eVNjb3JlID0gTWF0aC5taW4oMSxcbiAgICAgICh0ZXN0RmlsZVBlcmNlbnRhZ2UgKiAwLjEgKyAvLyBUZXN0IGZpbGVzIGFyZSBlYXNpZXJcbiAgICAgICBmdW5jdGlvblBhcmFtUGVyY2VudGFnZSAqIDAuNCArIC8vIEZ1bmN0aW9uIHBhcmFtcyBhcmUgaGFyZGVyXG4gICAgICAgcmVjb3JkVHlwZVBlcmNlbnRhZ2UgKiAwLjIpIC8gMTAwIC8vIFJlY29yZCB0eXBlcyBhcmUgbW9kZXJhdGVcbiAgICApO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHRlc3RGaWxlUGVyY2VudGFnZSxcbiAgICAgIGFycmF5VHlwZVBlcmNlbnRhZ2UsXG4gICAgICByZWNvcmRUeXBlUGVyY2VudGFnZSxcbiAgICAgIGZ1bmN0aW9uUGFyYW1QZXJjZW50YWdlLFxuICAgICAgY29tcGxleGl0eVNjb3JlXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDYWxjdWxhdGUgZXhwZWN0ZWQgc3VjY2VzcyByYXRlIGJhc2VkIG9uIGZpbGUgYW5hbHlzaXNcbiAgICovXG4gIHByaXZhdGUgY2FsY3VsYXRlRXhwZWN0ZWRTdWNjZXNzUmF0ZShhbmFseXNpczoge1xuICAgIHRlc3RGaWxlUGVyY2VudGFnZTogbnVtYmVyO1xuICAgIGFycmF5VHlwZVBlcmNlbnRhZ2U6IG51bWJlcjtcbiAgICByZWNvcmRUeXBlUGVyY2VudGFnZTogbnVtYmVyO1xuICAgIGZ1bmN0aW9uUGFyYW1QZXJjZW50YWdlOiBudW1iZXI7XG4gICAgY29tcGxleGl0eVNjb3JlOiBudW1iZXI7XG4gIH0pOiBudW1iZXIge1xuICAgIC8vIEJhc2Ugc3VjY2VzcyByYXRlIGV4cGVjdGF0aW9ucyBiYXNlZCBvbiBoaXN0b3JpY2FsIGRhdGFcbiAgICBsZXQgZXhwZWN0ZWRSYXRlID0gMC42OyAvLyA2MCUgYmFzZSBleHBlY3RhdGlvblxuXG4gICAgLy8gQXJyYXkgdHlwZXMgaGF2ZSBoaXN0b3JpY2FsbHkgMTAwJSBzdWNjZXNzIHJhdGVcbiAgICBleHBlY3RlZFJhdGUgKz0gKGFuYWx5c2lzLmFycmF5VHlwZVBlcmNlbnRhZ2UgLyAxMDApICogMC40O1xuXG4gICAgLy8gUmVjb3JkIHR5cGVzIGhhdmUgbWl4ZWQgcmVzdWx0cyAtIG1vZGVyYXRlIGJvb3N0XG4gICAgZXhwZWN0ZWRSYXRlICs9IChhbmFseXNpcy5yZWNvcmRUeXBlUGVyY2VudGFnZSAvIDEwMCkgKiAwLjE7XG5cbiAgICAvLyBGdW5jdGlvbiBwYXJhbWV0ZXJzIGhhdmUgaGlnaCBmYWlsdXJlIHJhdGUgLSBwZW5hbHR5XG4gICAgZXhwZWN0ZWRSYXRlIC09IChhbmFseXNpcy5mdW5jdGlvblBhcmFtUGVyY2VudGFnZSAvIDEwMCkgKiAwLjM7XG5cbiAgICAvLyBUZXN0IGZpbGVzIGFyZSBnZW5lcmFsbHkgZWFzaWVyIGJ1dCBsZXNzIGltcGFjdGZ1bFxuICAgIGV4cGVjdGVkUmF0ZSArPSAoYW5hbHlzaXMudGVzdEZpbGVQZXJjZW50YWdlIC8gMTAwKSAqIDAuMTtcblxuICAgIHJldHVybiBNYXRoLm1heCgwLjIsIE1hdGgubWluKDAuOSwgZXhwZWN0ZWRSYXRlKSk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGdldEN1cnJlbnRQcm9ncmVzcygpOiBQcm9taXNlPFVuaW50ZW50aW9uYWxBbnlQcm9ncmVzcz4ge1xuICAgIGNvbnN0IHRvdGFsRmlsZXMgPSBhd2FpdCB0aGlzLmZpbmRGaWxlc1dpdGhBbnlUeXBlcygpO1xuICAgIGxldCB0b3RhbEFueVR5cGVzID0gMDtcblxuICAgIC8vIENvdW50IHRvdGFsIGFueSB0eXBlcyBhY3Jvc3MgYWxsIGZpbGVzIChzYW1wbGUgZm9yIHBlcmZvcm1hbmNlKVxuICAgIGNvbnN0IHNhbXBsZVNpemUgPSBNYXRoLm1pbigzMCwgdG90YWxGaWxlcy5sZW5ndGgpO1xuICAgIGZvciAoY29uc3QgZmlsZVBhdGggb2YgdG90YWxGaWxlcy5zbGljZSgwLCBzYW1wbGVTaXplKSkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgY29udGVudCA9IGZzLnJlYWRGaWxlU3luYyhmaWxlUGF0aCwgJ3V0ZjgnKTtcbiAgICAgICAgY29uc3QgbGluZXMgPSBjb250ZW50LnNwbGl0KCdcXG4nKTtcbiAgICAgICAgdG90YWxBbnlUeXBlcyArPSBsaW5lcy5maWx0ZXIobGluZSA9PiB0aGlzLmNvbnRhaW5zQW55VHlwZShsaW5lKSkubGVuZ3RoO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgLy8gU2tpcCBmaWxlcyB0aGF0IGNhbid0IGJlIHJlYWRcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBFc3RpbWF0ZSB0b3RhbCBiYXNlZCBvbiBzYW1wbGVcbiAgICBjb25zdCBlc3RpbWF0ZWRUb3RhbCA9IHNhbXBsZVNpemUgPiAwXG4gICAgICA/IE1hdGguZmxvb3IoKHRvdGFsQW55VHlwZXMgLyBzYW1wbGVTaXplKSAqIHRvdGFsRmlsZXMubGVuZ3RoKVxuICAgICAgOiAwO1xuXG4gICAgLy8gQ2FsY3VsYXRlIG1ldHJpY3MgZnJvbSBiYXRjaCBoaXN0b3J5XG4gICAgY29uc3QgdG90YWxSZXBsYWNlbWVudHMgPSB0aGlzLmJhdGNoSGlzdG9yeS5yZWR1Y2UoKHN1bSwgYmF0Y2gpID0+IHN1bSArIGJhdGNoLnJlcGxhY2VtZW50c1N1Y2Nlc3NmdWwsIDApO1xuICAgIGNvbnN0IHRvdGFsQXR0ZW1wdGVkID0gdGhpcy5iYXRjaEhpc3RvcnkucmVkdWNlKChzdW0sIGJhdGNoKSA9PiBzdW0gKyBiYXRjaC5yZXBsYWNlbWVudHNBdHRlbXB0ZWQsIDApO1xuICAgIGNvbnN0IGF2ZXJhZ2VTdWNjZXNzUmF0ZSA9IHRvdGFsQXR0ZW1wdGVkID4gMCA/IHRvdGFsUmVwbGFjZW1lbnRzIC8gdG90YWxBdHRlbXB0ZWQgOiAwO1xuXG4gICAgLy8gQ2FsY3VsYXRlIHJlZHVjdGlvbiBwZXJjZW50YWdlXG4gICAgY29uc3QgcmVkdWN0aW9uUGVyY2VudGFnZSA9IGVzdGltYXRlZFRvdGFsID4gMCA/ICh0b3RhbFJlcGxhY2VtZW50cyAvIGVzdGltYXRlZFRvdGFsKSAqIDEwMCA6IDA7XG5cbiAgICAvLyBHZXQgY3VycmVudCBUeXBlU2NyaXB0IGVycm9yIGNvdW50IGZvciBjb21wcmVoZW5zaXZlIG1ldHJpY3NcbiAgICBjb25zdCBjdXJyZW50VFNFcnJvcnMgPSBhd2FpdCB0aGlzLmdldFR5cGVTY3JpcHRFcnJvckNvdW50KCk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgdG90YWxBbnlUeXBlczogZXN0aW1hdGVkVG90YWwsXG4gICAgICBjbGFzc2lmaWVkSW50ZW50aW9uYWw6IDAsIC8vIFdvdWxkIGJlIHRyYWNrZWQgd2l0aCBwZXJzaXN0ZW50IHN0b3JhZ2VcbiAgICAgIGNsYXNzaWZpZWRVbmludGVudGlvbmFsOiB0b3RhbEF0dGVtcHRlZCxcbiAgICAgIHN1Y2Nlc3NmdWxSZXBsYWNlbWVudHM6IHRvdGFsUmVwbGFjZW1lbnRzLFxuICAgICAgZG9jdW1lbnRlZEludGVudGlvbmFsOiAwLCAvLyBXb3VsZCBiZSB0cmFja2VkIHdpdGggZG9jdW1lbnRhdGlvbiBzeXN0ZW1cbiAgICAgIHJlbWFpbmluZ1VuaW50ZW50aW9uYWw6IE1hdGgubWF4KDAsIGVzdGltYXRlZFRvdGFsIC0gdG90YWxSZXBsYWNlbWVudHMpLFxuICAgICAgcmVkdWN0aW9uUGVyY2VudGFnZSxcbiAgICAgIHRhcmdldFJlZHVjdGlvblBlcmNlbnRhZ2U6IHRoaXMuYWRhcHRpdmVDb25maWcudGFyZ2V0UmVkdWN0aW9uUGVyY2VudGFnZSxcbiAgICAgIGJhdGNoZXNDb21wbGV0ZWQ6IHRoaXMuYmF0Y2hDb3VudGVyLFxuICAgICAgYXZlcmFnZVN1Y2Nlc3NSYXRlLFxuICAgICAgLy8gQmFzZSBQcm9ncmVzc01ldHJpY3MgcHJvcGVydGllc1xuICAgICAgdHlwZVNjcmlwdEVycm9yczoge1xuICAgICAgICBjdXJyZW50OiBjdXJyZW50VFNFcnJvcnMgPj0gMCA/IGN1cnJlbnRUU0Vycm9ycyA6IDAsXG4gICAgICAgIHRhcmdldDogMCxcbiAgICAgICAgcmVkdWN0aW9uOiAwLFxuICAgICAgICBwZXJjZW50YWdlOiAwXG4gICAgICB9LFxuICAgICAgbGludGluZ1dhcm5pbmdzOiB7IGN1cnJlbnQ6IDAsIHRhcmdldDogMCwgcmVkdWN0aW9uOiAwLCBwZXJjZW50YWdlOiAwIH0sXG4gICAgICBidWlsZFBlcmZvcm1hbmNlOiB7IGN1cnJlbnRUaW1lOiAwLCB0YXJnZXRUaW1lOiAwLCBjYWNoZUhpdFJhdGU6IDAsIG1lbW9yeVVzYWdlOiAwIH0sXG4gICAgICBlbnRlcnByaXNlU3lzdGVtczogeyBjdXJyZW50OiAwLCB0YXJnZXQ6IDAsIHRyYW5zZm9ybWVkRXhwb3J0czogMCB9XG4gICAgfTtcbiAgfVxufVxuIl0sInZlcnNpb24iOjN9