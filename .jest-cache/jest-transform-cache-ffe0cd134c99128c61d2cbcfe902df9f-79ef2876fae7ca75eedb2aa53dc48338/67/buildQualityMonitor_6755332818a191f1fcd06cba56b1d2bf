70ac46dbca5fb5885af7dd3fcff2548d
"use strict";
/**
 * Build Quality Monitoring Utilities
 *
 * This module provides comprehensive build performance monitoring, error tracking,
 * and quality metrics analysis for development workflow optimization.
 */
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.getBuildQualityScore = exports.monitorBuildQuality = exports.AlertSeverity = exports.AlertType = void 0;
const child_process_1 = require("child_process");
const fs_1 = __importDefault(require("fs"));
const path_1 = __importDefault(require("path"));
const logger_1 = require("./logger");
var AlertType;
(function (AlertType) {
    AlertType["BUILD_PERFORMANCE"] = "BUILD_PERFORMANCE";
    AlertType["MEMORY_USAGE"] = "MEMORY_USAGE";
    AlertType["BUNDLE_SIZE"] = "BUNDLE_SIZE";
    AlertType["ERROR_RATE"] = "ERROR_RATE";
    AlertType["QUALITY_GATE"] = "QUALITY_GATE";
})(AlertType || (exports.AlertType = AlertType = {}));
var AlertSeverity;
(function (AlertSeverity) {
    AlertSeverity["LOW"] = "LOW";
    AlertSeverity["MEDIUM"] = "MEDIUM";
    AlertSeverity["HIGH"] = "HIGH";
    AlertSeverity["CRITICAL"] = "CRITICAL";
})(AlertSeverity || (exports.AlertSeverity = AlertSeverity = {}));
// Configuration constants
const PERFORMANCE_THRESHOLDS = {
    BUILD_TIME: {
        DEVELOPMENT: 60000,
        PRODUCTION: 300000,
        CRITICAL: 600000 // 10 minutes
    },
    MEMORY_USAGE: {
        WARNING: 2048,
        CRITICAL: 4096,
        EMERGENCY: 8192 // 8GB
    },
    BUNDLE_SIZE: {
        WARNING_INCREASE: 10,
        CRITICAL_INCREASE: 20,
        MAX_SIZE: 10240 // 10MB
    },
    SUCCESS_RATE: {
        MINIMUM: 90 // 90% minimum success rate
    }
};
/**
 * Main function to monitor build quality and generate comprehensive report
 */
async function monitorBuildQuality() {
    const startTime = Date.now();
    try {
        logger_1.logger.info('Starting comprehensive build quality monitoring');
        // 1. Collect build metrics
        const buildMetrics = await collectBuildMetrics();
        // 2. Analyze build performance
        const performanceAnalysis = await analyzeBuildPerformance(buildMetrics);
        // 3. Analyze memory usage
        const memoryAnalysis = await analyzeMemoryUsage(buildMetrics);
        // 4. Generate quality metrics report
        const qualityMetrics = await generateQualityMetricsReport();
        // 5. Process performance alerts
        const alerts = await processPerformanceAlerts(buildMetrics);
        // 6. Generate optimization recommendations
        const recommendations = generateOptimizationRecommendations(buildMetrics, performanceAnalysis, memoryAnalysis);
        const duration = Date.now() - startTime;
        logger_1.logger.info(`Build quality monitoring completed in ${duration}ms`);
        return {
            buildMetrics,
            performanceAnalysis,
            memoryAnalysis,
            qualityMetrics,
            alerts,
            recommendations,
            timestamp: new Date()
        };
    }
    catch (error) {
        logger_1.logger.error('Build quality monitoring failed:', error);
        throw error;
    }
}
exports.monitorBuildQuality = monitorBuildQuality;
/**
 * Collect comprehensive build metrics
 */
async function collectBuildMetrics() {
    try {
        // Generate unique build ID
        const buildId = `build_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
        // Get build timing information
        const buildTiming = await getBuildTiming();
        // Get error and warning counts
        const errorCounts = await getErrorAndWarningCounts();
        // Get memory usage information
        const memoryUsage = await getMemoryUsage();
        // Get bundle size information
        const bundleSize = await getBundleSize();
        // Get cache performance
        const cacheHitRate = await getCacheHitRate();
        // Get parallelization info
        const parallelization = await getParallelizationInfo();
        return {
            buildId,
            startTime: buildTiming.startTime,
            endTime: buildTiming.endTime,
            duration: buildTiming.duration,
            success: buildTiming.success,
            errorCount: errorCounts.errors,
            warningCount: errorCounts.warnings,
            memoryUsage,
            bundleSize,
            cacheHitRate,
            parallelization
        };
    }
    catch (error) {
        logger_1.logger.error('Error collecting build metrics:', error);
        throw error;
    }
}
/**
 * Get build timing information
 */
async function getBuildTiming() {
    try {
        const startTime = new Date();
        // Run a quick build check to get timing
        const buildStart = Date.now();
        try {
            // Check if build is successful by running type check
            (0, child_process_1.execSync)('yarn tsc --noEmit --skipLibCheck', {
                stdio: 'pipe',
                timeout: 30000 // 30 second timeout
            });
            const buildEnd = Date.now();
            const endTime = new Date();
            return {
                startTime,
                endTime,
                duration: buildEnd - buildStart,
                success: true
            };
        }
        catch (error) {
            const buildEnd = Date.now();
            const endTime = new Date();
            return {
                startTime,
                endTime,
                duration: buildEnd - buildStart,
                success: false
            };
        }
    }
    catch (error) {
        logger_1.logger.error('Error getting build timing:', error);
        // Return default values
        const now = new Date();
        return {
            startTime: now,
            endTime: now,
            duration: 0,
            success: false
        };
    }
}
/**
 * Get error and warning counts
 */
async function getErrorAndWarningCounts() {
    try {
        let errors = 0;
        let warnings = 0;
        // Get TypeScript errors
        try {
            const tscOutput = (0, child_process_1.execSync)('yarn tsc --noEmit --skipLibCheck 2>&1', {
                encoding: 'utf8',
                stdio: 'pipe'
            });
            // Count errors in output
            const errorMatches = tscOutput.match(/error TS\d+:/g);
            errors = errorMatches ? errorMatches.length : 0;
        }
        catch (error) {
            // tsc returns non-zero exit code when there are errors
            if (error.stdout) {
                const errorMatches = error.stdout.match(/error TS\d+:/g);
                errors = errorMatches ? errorMatches.length : 0;
            }
        }
        // Get ESLint warnings
        try {
            const eslintOutput = (0, child_process_1.execSync)('yarn lint --format=json 2>/dev/null', {
                encoding: 'utf8',
                stdio: 'pipe'
            });
            const eslintResults = JSON.parse(eslintOutput);
            warnings = eslintResults.reduce((total, result) => {
                return total + (result.warningCount || 0);
            }, 0);
        }
        catch (error) {
            // ESLint might not be configured or might fail
            warnings = 0;
        }
        return { errors, warnings };
    }
    catch (error) {
        logger_1.logger.error('Error getting error and warning counts:', error);
        return { errors: 0, warnings: 0 };
    }
}
/**
 * Get memory usage information
 */
async function getMemoryUsage() {
    try {
        // Get current memory usage
        const memUsage = process.memoryUsage();
        // Estimate peak and average (simplified for this implementation)
        const peak = Math.round(memUsage.heapUsed / 1024 / 1024); // MB
        const average = Math.round(memUsage.heapTotal / 1024 / 1024); // MB
        // GC stats would require more sophisticated monitoring
        // For now, provide estimated values
        const gcCount = 0;
        const gcTime = 0;
        return {
            peak,
            average,
            gcCount,
            gcTime
        };
    }
    catch (error) {
        logger_1.logger.error('Error getting memory usage:', error);
        return {
            peak: 0,
            average: 0,
            gcCount: 0,
            gcTime: 0
        };
    }
}
/**
 * Get bundle size information
 */
async function getBundleSize() {
    try {
        // Check if .next directory exists (Next.js build output)
        const nextDir = path_1.default.join(process.cwd(), '.next');
        if (fs_1.default.existsSync(nextDir)) {
            // Get bundle sizes from .next directory
            const bundleInfo = await analyzeBundleDirectory(nextDir);
            return bundleInfo;
        }
        // Fallback: estimate based on src directory
        const srcDir = path_1.default.join(process.cwd(), 'src');
        if (fs_1.default.existsSync(srcDir)) {
            const srcSize = await getDirectorySize(srcDir);
            return {
                total: srcSize,
                javascript: Math.round(srcSize * 0.7),
                css: Math.round(srcSize * 0.2),
                assets: Math.round(srcSize * 0.1)
            };
        }
        return {
            total: 0,
            javascript: 0,
            css: 0,
            assets: 0
        };
    }
    catch (error) {
        logger_1.logger.error('Error getting bundle size:', error);
        return {
            total: 0,
            javascript: 0,
            css: 0,
            assets: 0
        };
    }
}
/**
 * Analyze bundle directory for size information
 */
async function analyzeBundleDirectory(bundleDir) {
    try {
        let total = 0;
        let javascript = 0;
        let css = 0;
        let assets = 0;
        const analyzeDirectory = (dir) => {
            const files = fs_1.default.readdirSync(dir);
            for (const file of files) {
                const filePath = path_1.default.join(dir, file);
                const stat = fs_1.default.statSync(filePath);
                if (stat.isDirectory()) {
                    analyzeDirectory(filePath);
                }
                else {
                    const size = stat.size;
                    total += size;
                    const ext = path_1.default.extname(file).toLowerCase();
                    if (ext === '.js' || ext === '.jsx' || ext === '.ts' || ext === '.tsx') {
                        javascript += size;
                    }
                    else if (ext === '.css' || ext === '.scss' || ext === '.sass') {
                        css += size;
                    }
                    else {
                        assets += size;
                    }
                }
            }
        };
        analyzeDirectory(bundleDir);
        // Convert to KB
        return {
            total: Math.round(total / 1024),
            javascript: Math.round(javascript / 1024),
            css: Math.round(css / 1024),
            assets: Math.round(assets / 1024)
        };
    }
    catch (error) {
        logger_1.logger.error('Error analyzing bundle directory:', error);
        return {
            total: 0,
            javascript: 0,
            css: 0,
            assets: 0
        };
    }
}
/**
 * Get directory size in bytes
 */
async function getDirectorySize(dir) {
    try {
        let size = 0;
        const files = fs_1.default.readdirSync(dir);
        for (const file of files) {
            const filePath = path_1.default.join(dir, file);
            const stat = fs_1.default.statSync(filePath);
            if (stat.isDirectory()) {
                size += await getDirectorySize(filePath);
            }
            else {
                size += stat.size;
            }
        }
        return Math.round(size / 1024); // Convert to KB
    }
    catch (error) {
        return 0;
    }
}
/**
 * Get cache hit rate
 */
async function getCacheHitRate() {
    try {
        // This would require integration with build system cache
        // For now, return estimated value based on .next cache
        const nextCacheDir = path_1.default.join(process.cwd(), '.next', 'cache');
        if (fs_1.default.existsSync(nextCacheDir)) {
            // Estimate cache efficiency based on cache directory size
            const cacheSize = await getDirectorySize(nextCacheDir);
            // Simple heuristic: larger cache = better hit rate
            if (cacheSize > 1000) { // > 1MB cache
                return 0.8; // 80% hit rate
            }
            else if (cacheSize > 100) { // > 100KB cache
                return 0.6; // 60% hit rate
            }
            else {
                return 0.3; // 30% hit rate
            }
        }
        return 0.5; // Default 50% hit rate
    }
    catch (error) {
        logger_1.logger.error('Error getting cache hit rate:', error);
        return 0.5;
    }
}
/**
 * Get parallelization information
 */
async function getParallelizationInfo() {
    try {
        // Get CPU count for worker estimation
        const cpuCount = require('os').cpus().length;
        // Estimate workers based on CPU count and build system
        const workers = Math.max(1, Math.floor(cpuCount * 0.75));
        // Estimate efficiency based on workers vs CPU count
        const efficiency = Math.min(1.0, workers / cpuCount);
        return {
            workers,
            efficiency
        };
    }
    catch (error) {
        logger_1.logger.error('Error getting parallelization info:', error);
        return {
            workers: 1,
            efficiency: 0.5
        };
    }
}
/**
 * Analyze build performance
 */
async function analyzeBuildPerformance(metrics) {
    try {
        // Calculate performance metrics
        const currentBuildTime = metrics.duration;
        const averageBuildTime = await getAverageBuildTime();
        const buildTimePercentile = calculateBuildTimePercentile(currentBuildTime);
        const performanceTrend = analyzePerformanceTrend(currentBuildTime, averageBuildTime);
        // Identify bottlenecks
        const bottleneckAnalysis = identifyBuildBottlenecks(metrics);
        // Generate optimization recommendations
        const optimizationRecommendations = generateBuildOptimizationRecommendations(metrics);
        return {
            currentBuildTime,
            averageBuildTime,
            buildTimePercentile,
            performanceTrend,
            bottleneckAnalysis,
            optimizationRecommendations
        };
    }
    catch (error) {
        logger_1.logger.error('Error analyzing build performance:', error);
        throw error;
    }
}
/**
 * Get average build time (simplified implementation)
 */
async function getAverageBuildTime() {
    // In a real implementation, this would query historical build data
    // For now, return a reasonable estimate
    return 45000; // 45 seconds
}
/**
 * Calculate build time percentile
 */
function calculateBuildTimePercentile(buildTime) {
    // Simplified percentile calculation
    // In reality, this would use historical data
    const benchmarkTimes = [30000, 45000, 60000, 90000, 120000]; // 30s, 45s, 1m, 1.5m, 2m
    let percentile = 0;
    for (let i = 0; i < benchmarkTimes.length; i++) {
        if (buildTime <= benchmarkTimes[i]) {
            percentile = ((i + 1) / benchmarkTimes.length) * 100;
            break;
        }
    }
    return percentile || 100; // If slower than all benchmarks
}
/**
 * Analyze performance trend
 */
function analyzePerformanceTrend(currentTime, averageTime) {
    const difference = currentTime - averageTime;
    const percentageDifference = (difference / averageTime) * 100;
    if (percentageDifference < -10) {
        return 'improving';
    }
    else if (percentageDifference > 10) {
        return 'degrading';
    }
    else {
        return 'stable';
    }
}
/**
 * Identify build bottlenecks
 */
function identifyBuildBottlenecks(metrics) {
    const bottlenecks = [];
    // Analyze TypeScript compilation
    if (metrics.errorCount > 0) {
        bottlenecks.push({
            phase: 'TypeScript Compilation',
            duration: Math.round(metrics.duration * 0.4),
            percentage: 40,
            suggestions: [
                'Fix TypeScript errors to improve compilation speed',
                'Enable incremental compilation',
                'Use project references for large codebases'
            ]
        });
    }
    // Analyze bundle size impact
    if (metrics.bundleSize.total > PERFORMANCE_THRESHOLDS.BUNDLE_SIZE.MAX_SIZE) {
        bottlenecks.push({
            phase: 'Bundle Generation',
            duration: Math.round(metrics.duration * 0.3),
            percentage: 30,
            suggestions: [
                'Implement code splitting to reduce bundle size',
                'Enable tree shaking to remove unused code',
                'Optimize asset loading and compression'
            ]
        });
    }
    // Analyze cache efficiency
    if (metrics.cacheHitRate < 0.7) {
        bottlenecks.push({
            phase: 'Cache Management',
            duration: Math.round(metrics.duration * 0.2),
            percentage: 20,
            suggestions: [
                'Optimize cache configuration',
                'Implement better cache invalidation strategy',
                'Use persistent cache for dependencies'
            ]
        });
    }
    return bottlenecks;
}
/**
 * Generate build optimization recommendations
 */
function generateBuildOptimizationRecommendations(metrics) {
    const recommendations = [];
    if (metrics.duration > PERFORMANCE_THRESHOLDS.BUILD_TIME.DEVELOPMENT) {
        recommendations.push('Consider enabling incremental builds to reduce compilation time');
    }
    if (metrics.errorCount > 10) {
        recommendations.push('Reduce TypeScript errors to improve build performance');
    }
    if (metrics.cacheHitRate < 0.6) {
        recommendations.push('Optimize build cache configuration for better performance');
    }
    if (metrics.bundleSize.total > PERFORMANCE_THRESHOLDS.BUNDLE_SIZE.MAX_SIZE) {
        recommendations.push('Implement code splitting and tree shaking to reduce bundle size');
    }
    if (metrics.parallelization.efficiency < 0.7) {
        recommendations.push('Optimize build parallelization to utilize available CPU cores');
    }
    return recommendations;
}
/**
 * Analyze memory usage
 */
async function analyzeMemoryUsage(metrics) {
    try {
        const peakMemoryUsage = metrics.memoryUsage.peak;
        const averageMemoryUsage = metrics.memoryUsage.average;
        // Simplified memory leak detection
        const memoryLeakDetection = detectMemoryLeaks(metrics);
        // Simplified GC stats
        const garbageCollectionStats = analyzeGCStats(metrics);
        // Generate memory optimization suggestions
        const memoryOptimizationSuggestions = generateMemoryOptimizationSuggestions(metrics);
        return {
            peakMemoryUsage,
            averageMemoryUsage,
            memoryLeakDetection,
            garbageCollectionStats,
            memoryOptimizationSuggestions
        };
    }
    catch (error) {
        logger_1.logger.error('Error analyzing memory usage:', error);
        throw error;
    }
}
/**
 * Detect memory leaks (simplified implementation)
 */
function detectMemoryLeaks(metrics) {
    const leaks = [];
    // Simple heuristic: if peak memory is much higher than average
    if (metrics.memoryUsage.peak > metrics.memoryUsage.average * 2) {
        leaks.push({
            component: 'Build Process',
            leakSize: metrics.memoryUsage.peak - metrics.memoryUsage.average,
            growthRate: 0.1,
            suggestions: [
                'Monitor memory usage during build process',
                'Implement memory profiling to identify leaks',
                'Consider reducing batch sizes for large operations'
            ]
        });
    }
    return leaks;
}
/**
 * Analyze garbage collection stats (simplified implementation)
 */
function analyzeGCStats(metrics) {
    return {
        totalCollections: metrics.memoryUsage.gcCount,
        totalTime: metrics.memoryUsage.gcTime,
        averageTime: metrics.memoryUsage.gcCount > 0 ? metrics.memoryUsage.gcTime / metrics.memoryUsage.gcCount : 0,
        efficiency: 0.8 // Estimated efficiency
    };
}
/**
 * Generate memory optimization suggestions
 */
function generateMemoryOptimizationSuggestions(metrics) {
    const suggestions = [];
    if (metrics.memoryUsage.peak > PERFORMANCE_THRESHOLDS.MEMORY_USAGE.WARNING) {
        suggestions.push('Consider increasing Node.js heap size for large builds');
    }
    if (metrics.memoryUsage.peak > metrics.memoryUsage.average * 1.5) {
        suggestions.push('Implement memory profiling to identify memory usage spikes');
    }
    suggestions.push('Use streaming and chunked processing for large file operations');
    suggestions.push('Implement proper cleanup of temporary objects and references');
    return suggestions;
}
/**
 * Generate quality metrics report
 */
async function generateQualityMetricsReport() {
    try {
        // This would integrate with various quality tools
        // For now, provide estimated values
        const codeQuality = {
            typeScriptErrors: await getTypeScriptErrorCount(),
            lintingWarnings: await getLintingWarningCount(),
            testCoverage: 75,
            codeComplexity: 6.5 // Estimated
        };
        const buildQuality = {
            successRate: 92,
            averageBuildTime: 45000,
            failureRate: 8,
            recoveryTime: 120 // 2 minutes
        };
        const performanceQuality = {
            bundleSize: 8500,
            loadTime: 2.5,
            memoryEfficiency: 0.8,
            cacheEfficiency: 0.7
        };
        const technicalDebt = {
            debtRatio: 0.15,
            maintainabilityIndex: 75,
            duplicateCodePercentage: 5,
            outdatedDependencies: 3
        };
        // Calculate overall score
        const overallScore = calculateOverallQualityScore(codeQuality, buildQuality, performanceQuality, technicalDebt);
        return {
            overallScore,
            codeQuality,
            buildQuality,
            performanceQuality,
            technicalDebt
        };
    }
    catch (error) {
        logger_1.logger.error('Error generating quality metrics report:', error);
        throw error;
    }
}
/**
 * Get TypeScript error count
 */
async function getTypeScriptErrorCount() {
    try {
        const output = (0, child_process_1.execSync)('yarn tsc --noEmit --skipLibCheck 2>&1', {
            encoding: 'utf8',
            stdio: 'pipe'
        });
        const errorMatches = output.match(/error TS\d+:/g);
        return errorMatches ? errorMatches.length : 0;
    }
    catch (error) {
        if (error.stdout) {
            const errorMatches = error.stdout.match(/error TS\d+:/g);
            return errorMatches ? errorMatches.length : 0;
        }
        return 0;
    }
}
/**
 * Get linting warning count
 */
async function getLintingWarningCount() {
    try {
        const output = (0, child_process_1.execSync)('yarn lint --format=json 2>/dev/null', {
            encoding: 'utf8',
            stdio: 'pipe'
        });
        const results = JSON.parse(output);
        return results.reduce((total, result) => {
            return total + (result.warningCount || 0);
        }, 0);
    }
    catch (error) {
        return 0;
    }
}
/**
 * Calculate overall quality score
 */
function calculateOverallQualityScore(codeQuality, buildQuality, performanceQuality, technicalDebt) {
    // Weighted scoring system
    const codeScore = Math.max(0, 100 - codeQuality.typeScriptErrors - codeQuality.lintingWarnings * 0.1);
    const buildScore = buildQuality.successRate;
    const performanceScore = Math.min(100, performanceQuality.cacheEfficiency * 100);
    const debtScore = Math.max(0, 100 - technicalDebt.debtRatio * 100);
    // Weighted average
    const overallScore = (codeScore * 0.3 + buildScore * 0.3 + performanceScore * 0.2 + debtScore * 0.2);
    return Math.round(overallScore);
}
/**
 * Process performance alerts
 */
async function processPerformanceAlerts(metrics) {
    const alerts = [];
    // Build time alerts
    if (metrics.duration > PERFORMANCE_THRESHOLDS.BUILD_TIME.CRITICAL) {
        alerts.push({
            type: AlertType.BUILD_PERFORMANCE,
            severity: AlertSeverity.CRITICAL,
            message: `Build time ${Math.round(metrics.duration / 1000)}s exceeds critical threshold ${PERFORMANCE_THRESHOLDS.BUILD_TIME.CRITICAL / 1000}s`,
            recommendations: [
                'Implement incremental builds',
                'Optimize TypeScript configuration',
                'Enable build caching'
            ],
            autoResponse: 'ANALYZE_BUILD_BOTTLENECKS',
            timestamp: new Date()
        });
    }
    else if (metrics.duration > PERFORMANCE_THRESHOLDS.BUILD_TIME.DEVELOPMENT) {
        alerts.push({
            type: AlertType.BUILD_PERFORMANCE,
            severity: AlertSeverity.HIGH,
            message: `Build time ${Math.round(metrics.duration / 1000)}s exceeds development threshold ${PERFORMANCE_THRESHOLDS.BUILD_TIME.DEVELOPMENT / 1000}s`,
            recommendations: [
                'Review build configuration',
                'Consider code splitting',
                'Optimize dependencies'
            ],
            autoResponse: 'MONITOR_BUILD_PERFORMANCE',
            timestamp: new Date()
        });
    }
    // Memory usage alerts
    if (metrics.memoryUsage.peak > PERFORMANCE_THRESHOLDS.MEMORY_USAGE.CRITICAL) {
        alerts.push({
            type: AlertType.MEMORY_USAGE,
            severity: AlertSeverity.CRITICAL,
            message: `Memory usage ${metrics.memoryUsage.peak}MB exceeds critical threshold ${PERFORMANCE_THRESHOLDS.MEMORY_USAGE.CRITICAL}MB`,
            recommendations: [
                'Increase Node.js heap size',
                'Implement memory profiling',
                'Optimize memory-intensive operations'
            ],
            autoResponse: 'ANALYZE_MEMORY_USAGE',
            timestamp: new Date()
        });
    }
    // Bundle size alerts
    if (metrics.bundleSize.total > PERFORMANCE_THRESHOLDS.BUNDLE_SIZE.MAX_SIZE) {
        alerts.push({
            type: AlertType.BUNDLE_SIZE,
            severity: AlertSeverity.HIGH,
            message: `Bundle size ${metrics.bundleSize.total}KB exceeds maximum threshold ${PERFORMANCE_THRESHOLDS.BUNDLE_SIZE.MAX_SIZE}KB`,
            recommendations: [
                'Implement code splitting',
                'Enable tree shaking',
                'Optimize asset loading'
            ],
            autoResponse: 'ANALYZE_BUNDLE_SIZE',
            timestamp: new Date()
        });
    }
    return alerts;
}
/**
 * Generate optimization recommendations
 */
function generateOptimizationRecommendations(buildMetrics, performanceAnalysis, memoryAnalysis) {
    const recommendations = [];
    // Build performance recommendations
    if (buildMetrics.duration > PERFORMANCE_THRESHOLDS.BUILD_TIME.DEVELOPMENT) {
        recommendations.push({
            category: 'build',
            priority: 'high',
            impact: 'high',
            effort: 'medium',
            description: 'Optimize build performance to reduce compilation time',
            implementation: [
                'Enable incremental TypeScript compilation',
                'Implement build caching strategy',
                'Optimize webpack configuration'
            ],
            expectedImprovement: '30-50% reduction in build time'
        });
    }
    // Memory optimization recommendations
    if (buildMetrics.memoryUsage.peak > PERFORMANCE_THRESHOLDS.MEMORY_USAGE.WARNING) {
        recommendations.push({
            category: 'memory',
            priority: 'medium',
            impact: 'medium',
            effort: 'low',
            description: 'Optimize memory usage during build process',
            implementation: [
                'Implement streaming for large file operations',
                'Add memory monitoring and profiling',
                'Optimize garbage collection settings'
            ],
            expectedImprovement: '20-30% reduction in memory usage'
        });
    }
    // Bundle size recommendations
    if (buildMetrics.bundleSize.total > PERFORMANCE_THRESHOLDS.BUNDLE_SIZE.MAX_SIZE * 0.8) {
        recommendations.push({
            category: 'bundle',
            priority: 'medium',
            impact: 'high',
            effort: 'medium',
            description: 'Reduce bundle size to improve load performance',
            implementation: [
                'Implement dynamic imports and code splitting',
                'Enable tree shaking for unused code removal',
                'Optimize asset compression and loading'
            ],
            expectedImprovement: '15-25% reduction in bundle size'
        });
    }
    // Cache optimization recommendations
    if (buildMetrics.cacheHitRate < 0.7) {
        recommendations.push({
            category: 'cache',
            priority: 'low',
            impact: 'medium',
            effort: 'low',
            description: 'Improve build cache efficiency',
            implementation: [
                'Optimize cache configuration',
                'Implement better cache invalidation',
                'Use persistent cache for dependencies'
            ],
            expectedImprovement: '10-20% improvement in cache hit rate'
        });
    }
    return recommendations;
}
/**
 * Get simple build quality score
 */
async function getBuildQualityScore() {
    try {
        const report = await monitorBuildQuality();
        return report.qualityMetrics.overallScore;
    }
    catch (error) {
        logger_1.logger.error('Failed to get build quality score:', error);
        return 0;
    }
}
exports.getBuildQualityScore = getBuildQualityScore;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy91dGlscy9idWlsZFF1YWxpdHlNb25pdG9yLnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7R0FLRzs7Ozs7O0FBRUgsaURBQXlDO0FBQ3pDLDRDQUFvQjtBQUNwQixnREFBd0I7QUFFeEIscUNBQWtDO0FBNkhsQyxJQUFZLFNBTVg7QUFORCxXQUFZLFNBQVM7SUFDbkIsb0RBQXVDLENBQUE7SUFDdkMsMENBQTZCLENBQUE7SUFDN0Isd0NBQTJCLENBQUE7SUFDM0Isc0NBQXlCLENBQUE7SUFDekIsMENBQTZCLENBQUE7QUFDL0IsQ0FBQyxFQU5XLFNBQVMseUJBQVQsU0FBUyxRQU1wQjtBQUVELElBQVksYUFLWDtBQUxELFdBQVksYUFBYTtJQUN2Qiw0QkFBVyxDQUFBO0lBQ1gsa0NBQWlCLENBQUE7SUFDakIsOEJBQWEsQ0FBQTtJQUNiLHNDQUFxQixDQUFBO0FBQ3ZCLENBQUMsRUFMVyxhQUFhLDZCQUFiLGFBQWEsUUFLeEI7QUFFRCwwQkFBMEI7QUFDMUIsTUFBTSxzQkFBc0IsR0FBRztJQUM3QixVQUFVLEVBQUU7UUFDVixXQUFXLEVBQUUsS0FBSztRQUNsQixVQUFVLEVBQUUsTUFBTTtRQUNsQixRQUFRLEVBQUUsTUFBTSxDQUFPLGFBQWE7S0FDckM7SUFDRCxZQUFZLEVBQUU7UUFDWixPQUFPLEVBQUUsSUFBSTtRQUNiLFFBQVEsRUFBRSxJQUFJO1FBQ2QsU0FBUyxFQUFFLElBQUksQ0FBUSxNQUFNO0tBQzlCO0lBQ0QsV0FBVyxFQUFFO1FBQ1gsZ0JBQWdCLEVBQUUsRUFBRTtRQUNwQixpQkFBaUIsRUFBRSxFQUFFO1FBQ3JCLFFBQVEsRUFBRSxLQUFLLENBQU8sT0FBTztLQUM5QjtJQUNELFlBQVksRUFBRTtRQUNaLE9BQU8sRUFBRSxFQUFFLENBQVcsMkJBQTJCO0tBQ2xEO0NBQ0YsQ0FBQztBQUVGOztHQUVHO0FBQ0ksS0FBSyxVQUFVLG1CQUFtQjtJQUN2QyxNQUFNLFNBQVMsR0FBRyxJQUFJ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QUM7S0FDSjtJQUVELE9BQU8sZUFBZSxDQUFDO0FBQ3pCLENBQUM7QUFFRDs7R0FFRztBQUNJLEtBQUssVUFBVSxvQkFBb0I7SUFDeEMsSUFBSTtRQUNGLE1BQU0sTUFBTSxHQUFHLE1BQU0sbUJBQW1CLEVBQUUsQ0FBQztRQUMzQyxPQUFPLE1BQU0sQ0FBQyxjQUFjLENBQUMsWUFBWSxDQUFDO0tBQzNDO0lBQUMsT0FBTyxLQUFLLEVBQUU7UUFDZCxlQUFNLENBQUMsS0FBSyxDQUFDLG9DQUFvQyxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQzFELE9BQU8sQ0FBQyxDQUFDO0tBQ1Y7QUFDSCxDQUFDO0FBUkQsb0RBUUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy91dGlscy9idWlsZFF1YWxpdHlNb25pdG9yLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQnVpbGQgUXVhbGl0eSBNb25pdG9yaW5nIFV0aWxpdGllc1xuICogXG4gKiBUaGlzIG1vZHVsZSBwcm92aWRlcyBjb21wcmVoZW5zaXZlIGJ1aWxkIHBlcmZvcm1hbmNlIG1vbml0b3JpbmcsIGVycm9yIHRyYWNraW5nLFxuICogYW5kIHF1YWxpdHkgbWV0cmljcyBhbmFseXNpcyBmb3IgZGV2ZWxvcG1lbnQgd29ya2Zsb3cgb3B0aW1pemF0aW9uLlxuICovXG5cbmltcG9ydCB7IGV4ZWNTeW5jIH0gZnJvbSAnY2hpbGRfcHJvY2Vzcyc7XG5pbXBvcnQgZnMgZnJvbSAnZnMnO1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5cbmltcG9ydCB7IGxvZ2dlciB9IGZyb20gJy4vbG9nZ2VyJztcblxuLy8gQnVpbGQgbW9uaXRvcmluZyBpbnRlcmZhY2VzXG5leHBvcnQgaW50ZXJmYWNlIEJ1aWxkUXVhbGl0eVJlcG9ydCB7XG4gIGJ1aWxkTWV0cmljczogQnVpbGRNZXRyaWNzO1xuICBwZXJmb3JtYW5jZUFuYWx5c2lzOiBCdWlsZFBlcmZvcm1hbmNlQW5hbHlzaXM7XG4gIG1lbW9yeUFuYWx5c2lzOiBNZW1vcnlVc2FnZUFuYWx5c2lzO1xuICBxdWFsaXR5TWV0cmljczogUXVhbGl0eU1ldHJpY3NSZXBvcnQ7XG4gIGFsZXJ0czogQWxlcnRSZXNwb25zZVtdO1xuICByZWNvbW1lbmRhdGlvbnM6IE9wdGltaXphdGlvblJlY29tbWVuZGF0aW9uW107XG4gIHRpbWVzdGFtcDogRGF0ZTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBCdWlsZE1ldHJpY3Mge1xuICBidWlsZElkOiBzdHJpbmc7XG4gIHN0YXJ0VGltZTogRGF0ZTtcbiAgZW5kVGltZTogRGF0ZTtcbiAgZHVyYXRpb246IG51bWJlcjsgLy8gbWlsbGlzZWNvbmRzXG4gIHN1Y2Nlc3M6IGJvb2xlYW47XG4gIGVycm9yQ291bnQ6IG51bWJlcjtcbiAgd2FybmluZ0NvdW50OiBudW1iZXI7XG4gIG1lbW9yeVVzYWdlOiB7XG4gICAgcGVhazogbnVtYmVyO1xuICAgIGF2ZXJhZ2U6IG51bWJlcjtcbiAgICBnY0NvdW50OiBudW1iZXI7XG4gICAgZ2NUaW1lOiBudW1iZXI7XG4gIH07XG4gIGJ1bmRsZVNpemU6IHtcbiAgICB0b3RhbDogbnVtYmVyO1xuICAgIGphdmFzY3JpcHQ6IG51bWJlcjtcbiAgICBjc3M6IG51bWJlcjtcbiAgICBhc3NldHM6IG51bWJlcjtcbiAgfTtcbiAgY2FjaGVIaXRSYXRlOiBudW1iZXI7XG4gIHBhcmFsbGVsaXphdGlvbjoge1xuICAgIHdvcmtlcnM6IG51bWJlcjtcbiAgICBlZmZpY2llbmN5OiBudW1iZXI7XG4gIH07XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQnVpbGRQZXJmb3JtYW5jZUFuYWx5c2lzIHtcbiAgY3VycmVudEJ1aWxkVGltZTogbnVtYmVyO1xuICBhdmVyYWdlQnVpbGRUaW1lOiBudW1iZXI7XG4gIGJ1aWxkVGltZVBlcmNlbnRpbGU6IG51bWJlcjtcbiAgcGVyZm9ybWFuY2VUcmVuZDogJ2ltcHJvdmluZycgfCAnc3RhYmxlJyB8ICdkZWdyYWRpbmcnO1xuICBib3R0bGVuZWNrQW5hbHlzaXM6IEJvdHRsZW5lY2tBbmFseXNpc1tdO1xuICBvcHRpbWl6YXRpb25SZWNvbW1lbmRhdGlvbnM6IHN0cmluZ1tdO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIE1lbW9yeVVzYWdlQW5hbHlzaXMge1xuICBwZWFrTWVtb3J5VXNhZ2U6IG51bWJlcjtcbiAgYXZlcmFnZU1lbW9yeVVzYWdlOiBudW1iZXI7XG4gIG1lbW9yeUxlYWtEZXRlY3Rpb246IE1lbW9yeUxlYWtJbmZvW107XG4gIGdhcmJhZ2VDb2xsZWN0aW9uU3RhdHM6IEdDU3RhdHM7XG4gIG1lbW9yeU9wdGltaXphdGlvblN1Z2dlc3Rpb25zOiBzdHJpbmdbXTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBRdWFsaXR5TWV0cmljc1JlcG9ydCB7XG4gIG92ZXJhbGxTY29yZTogbnVtYmVyOyAvLyAwLTEwMFxuICBjb2RlUXVhbGl0eToge1xuICAgIHR5cGVTY3JpcHRFcnJvcnM6IG51bWJlcjtcbiAgICBsaW50aW5nV2FybmluZ3M6IG51bWJlcjtcbiAgICB0ZXN0Q292ZXJhZ2U6IG51bWJlcjtcbiAgICBjb2RlQ29tcGxleGl0eTogbnVtYmVyO1xuICB9O1xuICBidWlsZFF1YWxpdHk6IHtcbiAgICBzdWNjZXNzUmF0ZTogbnVtYmVyO1xuICAgIGF2ZXJhZ2VCdWlsZFRpbWU6IG51bWJlcjtcbiAgICBmYWlsdXJlUmF0ZTogbnVtYmVyO1xuICAgIHJlY292ZXJ5VGltZTogbnVtYmVyO1xuICB9O1xuICBwZXJmb3JtYW5jZVF1YWxpdHk6IHtcbiAgICBidW5kbGVTaXplOiBudW1iZXI7XG4gICAgbG9hZFRpbWU6IG51bWJlcjtcbiAgICBtZW1vcnlFZmZpY2llbmN5OiBudW1iZXI7XG4gICAgY2FjaGVFZmZpY2llbmN5OiBudW1iZXI7XG4gIH07XG4gIHRlY2huaWNhbERlYnQ6IHtcbiAgICBkZWJ0UmF0aW86IG51bWJlcjtcbiAgICBtYWludGFpbmFiaWxpdHlJbmRleDogbnVtYmVyO1xuICAgIGR1cGxpY2F0ZUNvZGVQZXJjZW50YWdlOiBudW1iZXI7XG4gICAgb3V0ZGF0ZWREZXBlbmRlbmNpZXM6IG51bWJlcjtcbiAgfTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBBbGVydFJlc3BvbnNlIHtcbiAgdHlwZTogQWxlcnRUeXBlO1xuICBzZXZlcml0eTogQWxlcnRTZXZlcml0eTtcbiAgbWVzc2FnZTogc3RyaW5nO1xuICByZWNvbW1lbmRhdGlvbnM6IHN0cmluZ1tdO1xuICBhdXRvUmVzcG9uc2U6IHN0cmluZztcbiAgdGltZXN0YW1wOiBEYXRlO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIE9wdGltaXphdGlvblJlY29tbWVuZGF0aW9uIHtcbiAgY2F0ZWdvcnk6ICdidWlsZCcgfCAnbWVtb3J5JyB8ICdidW5kbGUnIHwgJ2NhY2hlJztcbiAgcHJpb3JpdHk6ICdoaWdoJyB8ICdtZWRpdW0nIHwgJ2xvdyc7XG4gIGltcGFjdDogJ2hpZ2gnIHwgJ21lZGl1bScgfCAnbG93JztcbiAgZWZmb3J0OiAnaGlnaCcgfCAnbWVkaXVtJyB8ICdsb3cnO1xuICBkZXNjcmlwdGlvbjogc3RyaW5nO1xuICBpbXBsZW1lbnRhdGlvbjogc3RyaW5nW107XG4gIGV4cGVjdGVkSW1wcm92ZW1lbnQ6IHN0cmluZztcbn1cblxuZXhwb3J0IGludGVyZmFjZSBCb3R0bGVuZWNrQW5hbHlzaXMge1xuICBwaGFzZTogc3RyaW5nO1xuICBkdXJhdGlvbjogbnVtYmVyO1xuICBwZXJjZW50YWdlOiBudW1iZXI7XG4gIHN1Z2dlc3Rpb25zOiBzdHJpbmdbXTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBNZW1vcnlMZWFrSW5mbyB7XG4gIGNvbXBvbmVudDogc3RyaW5nO1xuICBsZWFrU2l6ZTogbnVtYmVyO1xuICBncm93dGhSYXRlOiBudW1iZXI7XG4gIHN1Z2dlc3Rpb25zOiBzdHJpbmdbXTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBHQ1N0YXRzIHtcbiAgdG90YWxDb2xsZWN0aW9uczogbnVtYmVyO1xuICB0b3RhbFRpbWU6IG51bWJlcjtcbiAgYXZlcmFnZVRpbWU6IG51bWJlcjtcbiAgZWZmaWNpZW5jeTogbnVtYmVyO1xufVxuXG5leHBvcnQgZW51bSBBbGVydFR5cGUge1xuICBCVUlMRF9QRVJGT1JNQU5DRSA9ICdCVUlMRF9QRVJGT1JNQU5DRScsXG4gIE1FTU9SWV9VU0FHRSA9ICdNRU1PUllfVVNBR0UnLFxuICBCVU5ETEVfU0laRSA9ICdCVU5ETEVfU0laRScsXG4gIEVSUk9SX1JBVEUgPSAnRVJST1JfUkFURScsXG4gIFFVQUxJVFlfR0FURSA9ICdRVUFMSVRZX0dBVEUnXG59XG5cbmV4cG9ydCBlbnVtIEFsZXJ0U2V2ZXJpdHkge1xuICBMT1cgPSAnTE9XJyxcbiAgTUVESVVNID0gJ01FRElVTScsXG4gIEhJR0ggPSAnSElHSCcsXG4gIENSSVRJQ0FMID0gJ0NSSVRJQ0FMJ1xufVxuXG4vLyBDb25maWd1cmF0aW9uIGNvbnN0YW50c1xuY29uc3QgUEVSRk9STUFOQ0VfVEhSRVNIT0xEUyA9IHtcbiAgQlVJTERfVElNRToge1xuICAgIERFVkVMT1BNRU5UOiA2MDAwMCwgICAgLy8gNjAgc2Vjb25kc1xuICAgIFBST0RVQ1RJT046IDMwMDAwMCwgICAgLy8gNSBtaW51dGVzXG4gICAgQ1JJVElDQUw6IDYwMDAwMCAgICAgICAvLyAxMCBtaW51dGVzXG4gIH0sXG4gIE1FTU9SWV9VU0FHRToge1xuICAgIFdBUk5JTkc6IDIwNDgsICAgICAgICAgLy8gMkdCXG4gICAgQ1JJVElDQUw6IDQwOTYsICAgICAgICAvLyA0R0JcbiAgICBFTUVSR0VOQ1k6IDgxOTIgICAgICAgIC8vIDhHQlxuICB9LFxuICBCVU5ETEVfU0laRToge1xuICAgIFdBUk5JTkdfSU5DUkVBU0U6IDEwLCAgLy8gMTAlIGluY3JlYXNlXG4gICAgQ1JJVElDQUxfSU5DUkVBU0U6IDIwLCAvLyAyMCUgaW5jcmVhc2VcbiAgICBNQVhfU0laRTogMTAyNDAgICAgICAgLy8gMTBNQlxuICB9LFxuICBTVUNDRVNTX1JBVEU6IHtcbiAgICBNSU5JTVVNOiA5MCAgICAgICAgICAgLy8gOTAlIG1pbmltdW0gc3VjY2VzcyByYXRlXG4gIH1cbn07XG5cbi8qKlxuICogTWFpbiBmdW5jdGlvbiB0byBtb25pdG9yIGJ1aWxkIHF1YWxpdHkgYW5kIGdlbmVyYXRlIGNvbXByZWhlbnNpdmUgcmVwb3J0XG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBtb25pdG9yQnVpbGRRdWFsaXR5KCk6IFByb21pc2U8QnVpbGRRdWFsaXR5UmVwb3J0PiB7XG4gIGNvbnN0IHN0YXJ0VGltZSA9IERhdGUubm93KCk7XG4gIFxuICB0cnkge1xuICAgIGxvZ2dlci5pbmZvKCdTdGFydGluZyBjb21wcmVoZW5zaXZlIGJ1aWxkIHF1YWxpdHkgbW9uaXRvcmluZycpO1xuICAgIFxuICAgIC8vIDEuIENvbGxlY3QgYnVpbGQgbWV0cmljc1xuICAgIGNvbnN0IGJ1aWxkTWV0cmljcyA9IGF3YWl0IGNvbGxlY3RCdWlsZE1ldHJpY3MoKTtcbiAgICBcbiAgICAvLyAyLiBBbmFseXplIGJ1aWxkIHBlcmZvcm1hbmNlXG4gICAgY29uc3QgcGVyZm9ybWFuY2VBbmFseXNpcyA9IGF3YWl0IGFuYWx5emVCdWlsZFBlcmZvcm1hbmNlKGJ1aWxkTWV0cmljcyk7XG4gICAgXG4gICAgLy8gMy4gQW5hbHl6ZSBtZW1vcnkgdXNhZ2VcbiAgICBjb25zdCBtZW1vcnlBbmFseXNpcyA9IGF3YWl0IGFuYWx5emVNZW1vcnlVc2FnZShidWlsZE1ldHJpY3MpO1xuICAgIFxuICAgIC8vIDQuIEdlbmVyYXRlIHF1YWxpdHkgbWV0cmljcyByZXBvcnRcbiAgICBjb25zdCBxdWFsaXR5TWV0cmljcyA9IGF3YWl0IGdlbmVyYXRlUXVhbGl0eU1ldHJpY3NSZXBvcnQoKTtcbiAgICBcbiAgICAvLyA1LiBQcm9jZXNzIHBlcmZvcm1hbmNlIGFsZXJ0c1xuICAgIGNvbnN0IGFsZXJ0cyA9IGF3YWl0IHByb2Nlc3NQZXJmb3JtYW5jZUFsZXJ0cyhidWlsZE1ldHJpY3MpO1xuICAgIFxuICAgIC8vIDYuIEdlbmVyYXRlIG9wdGltaXphdGlvbiByZWNvbW1lbmRhdGlvbnNcbiAgICBjb25zdCByZWNvbW1lbmRhdGlvbnMgPSBnZW5lcmF0ZU9wdGltaXphdGlvblJlY29tbWVuZGF0aW9ucyhcbiAgICAgIGJ1aWxkTWV0cmljcywgXG4gICAgICBwZXJmb3JtYW5jZUFuYWx5c2lzLCBcbiAgICAgIG1lbW9yeUFuYWx5c2lzXG4gICAgKTtcbiAgICBcbiAgICBjb25zdCBkdXJhdGlvbiA9IERhdGUubm93KCkgLSBzdGFydFRpbWU7XG4gICAgbG9nZ2VyLmluZm8oYEJ1aWxkIHF1YWxpdHkgbW9uaXRvcmluZyBjb21wbGV0ZWQgaW4gJHtkdXJhdGlvbn1tc2ApO1xuICAgIFxuICAgIHJldHVybiB7XG4gICAgICBidWlsZE1ldHJpY3MsXG4gICAgICBwZXJmb3JtYW5jZUFuYWx5c2lzLFxuICAgICAgbWVtb3J5QW5hbHlzaXMsXG4gICAgICBxdWFsaXR5TWV0cmljcyxcbiAgICAgIGFsZXJ0cyxcbiAgICAgIHJlY29tbWVuZGF0aW9ucyxcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKVxuICAgIH07XG4gICAgXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgbG9nZ2VyLmVycm9yKCdCdWlsZCBxdWFsaXR5IG1vbml0b3JpbmcgZmFpbGVkOicsIGVycm9yKTtcbiAgICB0aHJvdyBlcnJvcjtcbiAgfVxufVxuXG4vKipcbiAqIENvbGxlY3QgY29tcHJlaGVuc2l2ZSBidWlsZCBtZXRyaWNzXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGNvbGxlY3RCdWlsZE1ldHJpY3MoKTogUHJvbWlzZTxCdWlsZE1ldHJpY3M+IHtcbiAgdHJ5IHtcbiAgICAvLyBHZW5lcmF0ZSB1bmlxdWUgYnVpbGQgSURcbiAgICBjb25zdCBidWlsZElkID0gYGJ1aWxkXyR7RGF0ZS5ub3coKX1fJHtNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHIoMiwgOSl9YDtcbiAgICBcbiAgICAvLyBHZXQgYnVpbGQgdGltaW5nIGluZm9ybWF0aW9uXG4gICAgY29uc3QgYnVpbGRUaW1pbmcgPSBhd2FpdCBnZXRCdWlsZFRpbWluZygpO1xuICAgIFxuICAgIC8vIEdldCBlcnJvciBhbmQgd2FybmluZyBjb3VudHNcbiAgICBjb25zdCBlcnJvckNvdW50cyA9IGF3YWl0IGdldEVycm9yQW5kV2FybmluZ0NvdW50cygpO1xuICAgIFxuICAgIC8vIEdldCBtZW1vcnkgdXNhZ2UgaW5mb3JtYXRpb25cbiAgICBjb25zdCBtZW1vcnlVc2FnZSA9IGF3YWl0IGdldE1lbW9yeVVzYWdlKCk7XG4gICAgXG4gICAgLy8gR2V0IGJ1bmRsZSBzaXplIGluZm9ybWF0aW9uXG4gICAgY29uc3QgYnVuZGxlU2l6ZSA9IGF3YWl0IGdldEJ1bmRsZVNpemUoKTtcbiAgICBcbiAgICAvLyBHZXQgY2FjaGUgcGVyZm9ybWFuY2VcbiAgICBjb25zdCBjYWNoZUhpdFJhdGUgPSBhd2FpdCBnZXRDYWNoZUhpdFJhdGUoKTtcbiAgICBcbiAgICAvLyBHZXQgcGFyYWxsZWxpemF0aW9uIGluZm9cbiAgICBjb25zdCBwYXJhbGxlbGl6YXRpb24gPSBhd2FpdCBnZXRQYXJhbGxlbGl6YXRpb25JbmZvKCk7XG4gICAgXG4gICAgcmV0dXJuIHtcbiAgICAgIGJ1aWxkSWQsXG4gICAgICBzdGFydFRpbWU6IGJ1aWxkVGltaW5nLnN0YXJ0VGltZSxcbiAgICAgIGVuZFRpbWU6IGJ1aWxkVGltaW5nLmVuZFRpbWUsXG4gICAgICBkdXJhdGlvbjogYnVpbGRUaW1pbmcuZHVyYXRpb24sXG4gICAgICBzdWNjZXNzOiBidWlsZFRpbWluZy5zdWNjZXNzLFxuICAgICAgZXJyb3JDb3VudDogZXJyb3JDb3VudHMuZXJyb3JzLFxuICAgICAgd2FybmluZ0NvdW50OiBlcnJvckNvdW50cy53YXJuaW5ncyxcbiAgICAgIG1lbW9yeVVzYWdlLFxuICAgICAgYnVuZGxlU2l6ZSxcbiAgICAgIGNhY2hlSGl0UmF0ZSxcbiAgICAgIHBhcmFsbGVsaXphdGlvblxuICAgIH07XG4gICAgXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgbG9nZ2VyLmVycm9yKCdFcnJvciBjb2xsZWN0aW5nIGJ1aWxkIG1ldHJpY3M6JywgZXJyb3IpO1xuICAgIHRocm93IGVycm9yO1xuICB9XG59XG5cbi8qKlxuICogR2V0IGJ1aWxkIHRpbWluZyBpbmZvcm1hdGlvblxuICovXG5hc3luYyBmdW5jdGlvbiBnZXRCdWlsZFRpbWluZygpOiBQcm9taXNlPHtcbiAgc3RhcnRUaW1lOiBEYXRlO1xuICBlbmRUaW1lOiBEYXRlO1xuICBkdXJhdGlvbjogbnVtYmVyO1xuICBzdWNjZXNzOiBib29sZWFuO1xufT4ge1xuICB0cnkge1xuICAgIGNvbnN0IHN0YXJ0VGltZSA9IG5ldyBEYXRlKCk7XG4gICAgXG4gICAgLy8gUnVuIGEgcXVpY2sgYnVpbGQgY2hlY2sgdG8gZ2V0IHRpbWluZ1xuICAgIGNvbnN0IGJ1aWxkU3RhcnQgPSBEYXRlLm5vdygpO1xuICAgIFxuICAgIHRyeSB7XG4gICAgICAvLyBDaGVjayBpZiBidWlsZCBpcyBzdWNjZXNzZnVsIGJ5IHJ1bm5pbmcgdHlwZSBjaGVja1xuICAgICAgZXhlY1N5bmMoJ3lhcm4gdHNjIC0tbm9FbWl0IC0tc2tpcExpYkNoZWNrJywge1xuICAgICAgICBzdGRpbzogJ3BpcGUnLFxuICAgICAgICB0aW1lb3V0OiAzMDAwMCAvLyAzMCBzZWNvbmQgdGltZW91dFxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIGNvbnN0IGJ1aWxkRW5kID0gRGF0ZS5ub3coKTtcbiAgICAgIGNvbnN0IGVuZFRpbWUgPSBuZXcgRGF0ZSgpO1xuICAgICAgXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdGFydFRpbWUsXG4gICAgICAgIGVuZFRpbWUsXG4gICAgICAgIGR1cmF0aW9uOiBidWlsZEVuZCAtIGJ1aWxkU3RhcnQsXG4gICAgICAgIHN1Y2Nlc3M6IHRydWVcbiAgICAgIH07XG4gICAgICBcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc3QgYnVpbGRFbmQgPSBEYXRlLm5vdygpO1xuICAgICAgY29uc3QgZW5kVGltZSA9IG5ldyBEYXRlKCk7XG4gICAgICBcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN0YXJ0VGltZSxcbiAgICAgICAgZW5kVGltZSxcbiAgICAgICAgZHVyYXRpb246IGJ1aWxkRW5kIC0gYnVpbGRTdGFydCxcbiAgICAgICAgc3VjY2VzczogZmFsc2VcbiAgICAgIH07XG4gICAgfVxuICAgIFxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGxvZ2dlci5lcnJvcignRXJyb3IgZ2V0dGluZyBidWlsZCB0aW1pbmc6JywgZXJyb3IpO1xuICAgIFxuICAgIC8vIFJldHVybiBkZWZhdWx0IHZhbHVlc1xuICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG4gICAgcmV0dXJuIHtcbiAgICAgIHN0YXJ0VGltZTogbm93LFxuICAgICAgZW5kVGltZTogbm93LFxuICAgICAgZHVyYXRpb246IDAsXG4gICAgICBzdWNjZXNzOiBmYWxzZVxuICAgIH07XG4gIH1cbn1cblxuLyoqXG4gKiBHZXQgZXJyb3IgYW5kIHdhcm5pbmcgY291bnRzXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGdldEVycm9yQW5kV2FybmluZ0NvdW50cygpOiBQcm9taXNlPHsgZXJyb3JzOiBudW1iZXI7IHdhcm5pbmdzOiBudW1iZXIgfT4ge1xuICB0cnkge1xuICAgIGxldCBlcnJvcnMgPSAwO1xuICAgIGxldCB3YXJuaW5ncyA9IDA7XG4gICAgXG4gICAgLy8gR2V0IFR5cGVTY3JpcHQgZXJyb3JzXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHRzY091dHB1dCA9IGV4ZWNTeW5jKCd5YXJuIHRzYyAtLW5vRW1pdCAtLXNraXBMaWJDaGVjayAyPiYxJywge1xuICAgICAgICBlbmNvZGluZzogJ3V0ZjgnLFxuICAgICAgICBzdGRpbzogJ3BpcGUnXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgLy8gQ291bnQgZXJyb3JzIGluIG91dHB1dFxuICAgICAgY29uc3QgZXJyb3JNYXRjaGVzID0gdHNjT3V0cHV0Lm1hdGNoKC9lcnJvciBUU1xcZCs6L2cpO1xuICAgICAgZXJyb3JzID0gZXJyb3JNYXRjaGVzID8gZXJyb3JNYXRjaGVzLmxlbmd0aCA6IDA7XG4gICAgICBcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICAvLyB0c2MgcmV0dXJucyBub24temVybyBleGl0IGNvZGUgd2hlbiB0aGVyZSBhcmUgZXJyb3JzXG4gICAgICBpZiAoZXJyb3Iuc3Rkb3V0KSB7XG4gICAgICAgIGNvbnN0IGVycm9yTWF0Y2hlcyA9IGVycm9yLnN0ZG91dC5tYXRjaCgvZXJyb3IgVFNcXGQrOi9nKTtcbiAgICAgICAgZXJyb3JzID0gZXJyb3JNYXRjaGVzID8gZXJyb3JNYXRjaGVzLmxlbmd0aCA6IDA7XG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIC8vIEdldCBFU0xpbnQgd2FybmluZ3NcbiAgICB0cnkge1xuICAgICAgY29uc3QgZXNsaW50T3V0cHV0ID0gZXhlY1N5bmMoJ3lhcm4gbGludCAtLWZvcm1hdD1qc29uIDI+L2Rldi9udWxsJywge1xuICAgICAgICBlbmNvZGluZzogJ3V0ZjgnLFxuICAgICAgICBzdGRpbzogJ3BpcGUnXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgY29uc3QgZXNsaW50UmVzdWx0cyA9IEpTT04ucGFyc2UoZXNsaW50T3V0cHV0KTtcbiAgICAgIHdhcm5pbmdzID0gZXNsaW50UmVzdWx0cy5yZWR1Y2UoKHRvdGFsOiBudW1iZXIsIHJlc3VsdDogYW55KSA9PiB7XG4gICAgICAgIHJldHVybiB0b3RhbCArIChyZXN1bHQud2FybmluZ0NvdW50IHx8IDApO1xuICAgICAgfSwgMCk7XG4gICAgICBcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgLy8gRVNMaW50IG1pZ2h0IG5vdCBiZSBjb25maWd1cmVkIG9yIG1pZ2h0IGZhaWxcbiAgICAgIHdhcm5pbmdzID0gMDtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHsgZXJyb3JzLCB3YXJuaW5ncyB9O1xuICAgIFxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGxvZ2dlci5lcnJvcignRXJyb3IgZ2V0dGluZyBlcnJvciBhbmQgd2FybmluZyBjb3VudHM6JywgZXJyb3IpO1xuICAgIHJldHVybiB7IGVycm9yczogMCwgd2FybmluZ3M6IDAgfTtcbiAgfVxufVxuXG4vKipcbiAqIEdldCBtZW1vcnkgdXNhZ2UgaW5mb3JtYXRpb25cbiAqL1xuYXN5bmMgZnVuY3Rpb24gZ2V0TWVtb3J5VXNhZ2UoKTogUHJvbWlzZTx7XG4gIHBlYWs6IG51bWJlcjtcbiAgYXZlcmFnZTogbnVtYmVyO1xuICBnY0NvdW50OiBudW1iZXI7XG4gIGdjVGltZTogbnVtYmVyO1xufT4ge1xuICB0cnkge1xuICAgIC8vIEdldCBjdXJyZW50IG1lbW9yeSB1c2FnZVxuICAgIGNvbnN0IG1lbVVzYWdlID0gcHJvY2Vzcy5tZW1vcnlVc2FnZSgpO1xuICAgIFxuICAgIC8vIEVzdGltYXRlIHBlYWsgYW5kIGF2ZXJhZ2UgKHNpbXBsaWZpZWQgZm9yIHRoaXMgaW1wbGVtZW50YXRpb24pXG4gICAgY29uc3QgcGVhayA9IE1hdGgucm91bmQobWVtVXNhZ2UuaGVhcFVzZWQgLyAxMDI0IC8gMTAyNCk7IC8vIE1CXG4gICAgY29uc3QgYXZlcmFnZSA9IE1hdGgucm91bmQobWVtVXNhZ2UuaGVhcFRvdGFsIC8gMTAyNCAvIDEwMjQpOyAvLyBNQlxuICAgIFxuICAgIC8vIEdDIHN0YXRzIHdvdWxkIHJlcXVpcmUgbW9yZSBzb3BoaXN0aWNhdGVkIG1vbml0b3JpbmdcbiAgICAvLyBGb3Igbm93LCBwcm92aWRlIGVzdGltYXRlZCB2YWx1ZXNcbiAgICBjb25zdCBnY0NvdW50ID0gMDtcbiAgICBjb25zdCBnY1RpbWUgPSAwO1xuICAgIFxuICAgIHJldHVybiB7XG4gICAgICBwZWFrLFxuICAgICAgYXZlcmFnZSxcbiAgICAgIGdjQ291bnQsXG4gICAgICBnY1RpbWVcbiAgICB9O1xuICAgIFxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGxvZ2dlci5lcnJvcignRXJyb3IgZ2V0dGluZyBtZW1vcnkgdXNhZ2U6JywgZXJyb3IpO1xuICAgIHJldHVybiB7XG4gICAgICBwZWFrOiAwLFxuICAgICAgYXZlcmFnZTogMCxcbiAgICAgIGdjQ291bnQ6IDAsXG4gICAgICBnY1RpbWU6IDBcbiAgICB9O1xuICB9XG59XG5cbi8qKlxuICogR2V0IGJ1bmRsZSBzaXplIGluZm9ybWF0aW9uXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGdldEJ1bmRsZVNpemUoKTogUHJvbWlzZTx7XG4gIHRvdGFsOiBudW1iZXI7XG4gIGphdmFzY3JpcHQ6IG51bWJlcjtcbiAgY3NzOiBudW1iZXI7XG4gIGFzc2V0czogbnVtYmVyO1xufT4ge1xuICB0cnkge1xuICAgIC8vIENoZWNrIGlmIC5uZXh0IGRpcmVjdG9yeSBleGlzdHMgKE5leHQuanMgYnVpbGQgb3V0cHV0KVxuICAgIGNvbnN0IG5leHREaXIgPSBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgJy5uZXh0Jyk7XG4gICAgXG4gICAgaWYgKGZzLmV4aXN0c1N5bmMobmV4dERpcikpIHtcbiAgICAgIC8vIEdldCBidW5kbGUgc2l6ZXMgZnJvbSAubmV4dCBkaXJlY3RvcnlcbiAgICAgIGNvbnN0IGJ1bmRsZUluZm8gPSBhd2FpdCBhbmFseXplQnVuZGxlRGlyZWN0b3J5KG5leHREaXIpO1xuICAgICAgcmV0dXJuIGJ1bmRsZUluZm87XG4gICAgfVxuICAgIFxuICAgIC8vIEZhbGxiYWNrOiBlc3RpbWF0ZSBiYXNlZCBvbiBzcmMgZGlyZWN0b3J5XG4gICAgY29uc3Qgc3JjRGlyID0gcGF0aC5qb2luKHByb2Nlc3MuY3dkKCksICdzcmMnKTtcbiAgICBpZiAoZnMuZXhpc3RzU3luYyhzcmNEaXIpKSB7XG4gICAgICBjb25zdCBzcmNTaXplID0gYXdhaXQgZ2V0RGlyZWN0b3J5U2l6ZShzcmNEaXIpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdG90YWw6IHNyY1NpemUsXG4gICAgICAgIGphdmFzY3JpcHQ6IE1hdGgucm91bmQoc3JjU2l6ZSAqIDAuNyksXG4gICAgICAgIGNzczogTWF0aC5yb3VuZChzcmNTaXplICogMC4yKSxcbiAgICAgICAgYXNzZXRzOiBNYXRoLnJvdW5kKHNyY1NpemUgKiAwLjEpXG4gICAgICB9O1xuICAgIH1cbiAgICBcbiAgICByZXR1cm4ge1xuICAgICAgdG90YWw6IDAsXG4gICAgICBqYXZhc2NyaXB0OiAwLFxuICAgICAgY3NzOiAwLFxuICAgICAgYXNzZXRzOiAwXG4gICAgfTtcbiAgICBcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBsb2dnZXIuZXJyb3IoJ0Vycm9yIGdldHRpbmcgYnVuZGxlIHNpemU6JywgZXJyb3IpO1xuICAgIHJldHVybiB7XG4gICAgICB0b3RhbDogMCxcbiAgICAgIGphdmFzY3JpcHQ6IDAsXG4gICAgICBjc3M6IDAsXG4gICAgICBhc3NldHM6IDBcbiAgICB9O1xuICB9XG59XG5cbi8qKlxuICogQW5hbHl6ZSBidW5kbGUgZGlyZWN0b3J5IGZvciBzaXplIGluZm9ybWF0aW9uXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGFuYWx5emVCdW5kbGVEaXJlY3RvcnkoYnVuZGxlRGlyOiBzdHJpbmcpOiBQcm9taXNlPHtcbiAgdG90YWw6IG51bWJlcjtcbiAgamF2YXNjcmlwdDogbnVtYmVyO1xuICBjc3M6IG51bWJlcjtcbiAgYXNzZXRzOiBudW1iZXI7XG59PiB7XG4gIHRyeSB7XG4gICAgbGV0IHRvdGFsID0gMDtcbiAgICBsZXQgamF2YXNjcmlwdCA9IDA7XG4gICAgbGV0IGNzcyA9IDA7XG4gICAgbGV0IGFzc2V0cyA9IDA7XG4gICAgXG4gICAgY29uc3QgYW5hbHl6ZURpcmVjdG9yeSA9IChkaXI6IHN0cmluZykgPT4ge1xuICAgICAgY29uc3QgZmlsZXMgPSBmcy5yZWFkZGlyU3luYyhkaXIpO1xuICAgICAgXG4gICAgICBmb3IgKGNvbnN0IGZpbGUgb2YgZmlsZXMpIHtcbiAgICAgICAgY29uc3QgZmlsZVBhdGggPSBwYXRoLmpvaW4oZGlyLCBmaWxlKTtcbiAgICAgICAgY29uc3Qgc3RhdCA9IGZzLnN0YXRTeW5jKGZpbGVQYXRoKTtcbiAgICAgICAgXG4gICAgICAgIGlmIChzdGF0LmlzRGlyZWN0b3J5KCkpIHtcbiAgICAgICAgICBhbmFseXplRGlyZWN0b3J5KGZpbGVQYXRoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb25zdCBzaXplID0gc3RhdC5zaXplO1xuICAgICAgICAgIHRvdGFsICs9IHNpemU7XG4gICAgICAgICAgXG4gICAgICAgICAgY29uc3QgZXh0ID0gcGF0aC5leHRuYW1lKGZpbGUpLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgICAgaWYgKGV4dCA9PT0gJy5qcycgfHwgZXh0ID09PSAnLmpzeCcgfHwgZXh0ID09PSAnLnRzJyB8fCBleHQgPT09ICcudHN4Jykge1xuICAgICAgICAgICAgamF2YXNjcmlwdCArPSBzaXplO1xuICAgICAgICAgIH0gZWxzZSBpZiAoZXh0ID09PSAnLmNzcycgfHwgZXh0ID09PSAnLnNjc3MnIHx8IGV4dCA9PT0gJy5zYXNzJykge1xuICAgICAgICAgICAgY3NzICs9IHNpemU7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGFzc2V0cyArPSBzaXplO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH07XG4gICAgXG4gICAgYW5hbHl6ZURpcmVjdG9yeShidW5kbGVEaXIpO1xuICAgIFxuICAgIC8vIENvbnZlcnQgdG8gS0JcbiAgICByZXR1cm4ge1xuICAgICAgdG90YWw6IE1hdGgucm91bmQodG90YWwgLyAxMDI0KSxcbiAgICAgIGphdmFzY3JpcHQ6IE1hdGgucm91bmQoamF2YXNjcmlwdCAvIDEwMjQpLFxuICAgICAgY3NzOiBNYXRoLnJvdW5kKGNzcyAvIDEwMjQpLFxuICAgICAgYXNzZXRzOiBNYXRoLnJvdW5kKGFzc2V0cyAvIDEwMjQpXG4gICAgfTtcbiAgICBcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBsb2dnZXIuZXJyb3IoJ0Vycm9yIGFuYWx5emluZyBidW5kbGUgZGlyZWN0b3J5OicsIGVycm9yKTtcbiAgICByZXR1cm4ge1xuICAgICAgdG90YWw6IDAsXG4gICAgICBqYXZhc2NyaXB0OiAwLFxuICAgICAgY3NzOiAwLFxuICAgICAgYXNzZXRzOiAwXG4gICAgfTtcbiAgfVxufVxuXG4vKipcbiAqIEdldCBkaXJlY3Rvcnkgc2l6ZSBpbiBieXRlc1xuICovXG5hc3luYyBmdW5jdGlvbiBnZXREaXJlY3RvcnlTaXplKGRpcjogc3RyaW5nKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgdHJ5IHtcbiAgICBsZXQgc2l6ZSA9IDA7XG4gICAgXG4gICAgY29uc3QgZmlsZXMgPSBmcy5yZWFkZGlyU3luYyhkaXIpO1xuICAgIGZvciAoY29uc3QgZmlsZSBvZiBmaWxlcykge1xuICAgICAgY29uc3QgZmlsZVBhdGggPSBwYXRoLmpvaW4oZGlyLCBmaWxlKTtcbiAgICAgIGNvbnN0IHN0YXQgPSBmcy5zdGF0U3luYyhmaWxlUGF0aCk7XG4gICAgICBcbiAgICAgIGlmIChzdGF0LmlzRGlyZWN0b3J5KCkpIHtcbiAgICAgICAgc2l6ZSArPSBhd2FpdCBnZXREaXJlY3RvcnlTaXplKGZpbGVQYXRoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHNpemUgKz0gc3RhdC5zaXplO1xuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICByZXR1cm4gTWF0aC5yb3VuZChzaXplIC8gMTAyNCk7IC8vIENvbnZlcnQgdG8gS0JcbiAgICBcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICByZXR1cm4gMDtcbiAgfVxufVxuXG4vKipcbiAqIEdldCBjYWNoZSBoaXQgcmF0ZVxuICovXG5hc3luYyBmdW5jdGlvbiBnZXRDYWNoZUhpdFJhdGUoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgdHJ5IHtcbiAgICAvLyBUaGlzIHdvdWxkIHJlcXVpcmUgaW50ZWdyYXRpb24gd2l0aCBidWlsZCBzeXN0ZW0gY2FjaGVcbiAgICAvLyBGb3Igbm93LCByZXR1cm4gZXN0aW1hdGVkIHZhbHVlIGJhc2VkIG9uIC5uZXh0IGNhY2hlXG4gICAgY29uc3QgbmV4dENhY2hlRGlyID0gcGF0aC5qb2luKHByb2Nlc3MuY3dkKCksICcubmV4dCcsICdjYWNoZScpO1xuICAgIFxuICAgIGlmIChmcy5leGlzdHNTeW5jKG5leHRDYWNoZURpcikpIHtcbiAgICAgIC8vIEVzdGltYXRlIGNhY2hlIGVmZmljaWVuY3kgYmFzZWQgb24gY2FjaGUgZGlyZWN0b3J5IHNpemVcbiAgICAgIGNvbnN0IGNhY2hlU2l6ZSA9IGF3YWl0IGdldERpcmVjdG9yeVNpemUobmV4dENhY2hlRGlyKTtcbiAgICAgIFxuICAgICAgLy8gU2ltcGxlIGhldXJpc3RpYzogbGFyZ2VyIGNhY2hlID0gYmV0dGVyIGhpdCByYXRlXG4gICAgICBpZiAoY2FjaGVTaXplID4gMTAwMCkgeyAvLyA+IDFNQiBjYWNoZVxuICAgICAgICByZXR1cm4gMC44OyAvLyA4MCUgaGl0IHJhdGVcbiAgICAgIH0gZWxzZSBpZiAoY2FjaGVTaXplID4gMTAwKSB7IC8vID4gMTAwS0IgY2FjaGVcbiAgICAgICAgcmV0dXJuIDAuNjsgLy8gNjAlIGhpdCByYXRlXG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gMC4zOyAvLyAzMCUgaGl0IHJhdGVcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIDAuNTsgLy8gRGVmYXVsdCA1MCUgaGl0IHJhdGVcbiAgICBcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBsb2dnZXIuZXJyb3IoJ0Vycm9yIGdldHRpbmcgY2FjaGUgaGl0IHJhdGU6JywgZXJyb3IpO1xuICAgIHJldHVybiAwLjU7XG4gIH1cbn1cblxuLyoqXG4gKiBHZXQgcGFyYWxsZWxpemF0aW9uIGluZm9ybWF0aW9uXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGdldFBhcmFsbGVsaXphdGlvbkluZm8oKTogUHJvbWlzZTx7XG4gIHdvcmtlcnM6IG51bWJlcjtcbiAgZWZmaWNpZW5jeTogbnVtYmVyO1xufT4ge1xuICB0cnkge1xuICAgIC8vIEdldCBDUFUgY291bnQgZm9yIHdvcmtlciBlc3RpbWF0aW9uXG4gICAgY29uc3QgY3B1Q291bnQgPSByZXF1aXJlKCdvcycpLmNwdXMoKS5sZW5ndGg7XG4gICAgXG4gICAgLy8gRXN0aW1hdGUgd29ya2VycyBiYXNlZCBvbiBDUFUgY291bnQgYW5kIGJ1aWxkIHN5c3RlbVxuICAgIGNvbnN0IHdvcmtlcnMgPSBNYXRoLm1heCgxLCBNYXRoLmZsb29yKGNwdUNvdW50ICogMC43NSkpO1xuICAgIFxuICAgIC8vIEVzdGltYXRlIGVmZmljaWVuY3kgYmFzZWQgb24gd29ya2VycyB2cyBDUFUgY291bnRcbiAgICBjb25zdCBlZmZpY2llbmN5ID0gTWF0aC5taW4oMS4wLCB3b3JrZXJzIC8gY3B1Q291bnQpO1xuICAgIFxuICAgIHJldHVybiB7XG4gICAgICB3b3JrZXJzLFxuICAgICAgZWZmaWNpZW5jeVxuICAgIH07XG4gICAgXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgbG9nZ2VyLmVycm9yKCdFcnJvciBnZXR0aW5nIHBhcmFsbGVsaXphdGlvbiBpbmZvOicsIGVycm9yKTtcbiAgICByZXR1cm4ge1xuICAgICAgd29ya2VyczogMSxcbiAgICAgIGVmZmljaWVuY3k6IDAuNVxuICAgIH07XG4gIH1cbn1cblxuLyoqXG4gKiBBbmFseXplIGJ1aWxkIHBlcmZvcm1hbmNlXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGFuYWx5emVCdWlsZFBlcmZvcm1hbmNlKG1ldHJpY3M6IEJ1aWxkTWV0cmljcyk6IFByb21pc2U8QnVpbGRQZXJmb3JtYW5jZUFuYWx5c2lzPiB7XG4gIHRyeSB7XG4gICAgLy8gQ2FsY3VsYXRlIHBlcmZvcm1hbmNlIG1ldHJpY3NcbiAgICBjb25zdCBjdXJyZW50QnVpbGRUaW1lID0gbWV0cmljcy5kdXJhdGlvbjtcbiAgICBjb25zdCBhdmVyYWdlQnVpbGRUaW1lID0gYXdhaXQgZ2V0QXZlcmFnZUJ1aWxkVGltZSgpO1xuICAgIGNvbnN0IGJ1aWxkVGltZVBlcmNlbnRpbGUgPSBjYWxjdWxhdGVCdWlsZFRpbWVQZXJjZW50aWxlKGN1cnJlbnRCdWlsZFRpbWUpO1xuICAgIGNvbnN0IHBlcmZvcm1hbmNlVHJlbmQgPSBhbmFseXplUGVyZm9ybWFuY2VUcmVuZChjdXJyZW50QnVpbGRUaW1lLCBhdmVyYWdlQnVpbGRUaW1lKTtcbiAgICBcbiAgICAvLyBJZGVudGlmeSBib3R0bGVuZWNrc1xuICAgIGNvbnN0IGJvdHRsZW5lY2tBbmFseXNpcyA9IGlkZW50aWZ5QnVpbGRCb3R0bGVuZWNrcyhtZXRyaWNzKTtcbiAgICBcbiAgICAvLyBHZW5lcmF0ZSBvcHRpbWl6YXRpb24gcmVjb21tZW5kYXRpb25zXG4gICAgY29uc3Qgb3B0aW1pemF0aW9uUmVjb21tZW5kYXRpb25zID0gZ2VuZXJhdGVCdWlsZE9wdGltaXphdGlvblJlY29tbWVuZGF0aW9ucyhtZXRyaWNzKTtcbiAgICBcbiAgICByZXR1cm4ge1xuICAgICAgY3VycmVudEJ1aWxkVGltZSxcbiAgICAgIGF2ZXJhZ2VCdWlsZFRpbWUsXG4gICAgICBidWlsZFRpbWVQZXJjZW50aWxlLFxuICAgICAgcGVyZm9ybWFuY2VUcmVuZCxcbiAgICAgIGJvdHRsZW5lY2tBbmFseXNpcyxcbiAgICAgIG9wdGltaXphdGlvblJlY29tbWVuZGF0aW9uc1xuICAgIH07XG4gICAgXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgbG9nZ2VyLmVycm9yKCdFcnJvciBhbmFseXppbmcgYnVpbGQgcGVyZm9ybWFuY2U6JywgZXJyb3IpO1xuICAgIHRocm93IGVycm9yO1xuICB9XG59XG5cbi8qKlxuICogR2V0IGF2ZXJhZ2UgYnVpbGQgdGltZSAoc2ltcGxpZmllZCBpbXBsZW1lbnRhdGlvbilcbiAqL1xuYXN5bmMgZnVuY3Rpb24gZ2V0QXZlcmFnZUJ1aWxkVGltZSgpOiBQcm9taXNlPG51bWJlcj4ge1xuICAvLyBJbiBhIHJlYWwgaW1wbGVtZW50YXRpb24sIHRoaXMgd291bGQgcXVlcnkgaGlzdG9yaWNhbCBidWlsZCBkYXRhXG4gIC8vIEZvciBub3csIHJldHVybiBhIHJlYXNvbmFibGUgZXN0aW1hdGVcbiAgcmV0dXJuIDQ1MDAwOyAvLyA0NSBzZWNvbmRzXG59XG5cbi8qKlxuICogQ2FsY3VsYXRlIGJ1aWxkIHRpbWUgcGVyY2VudGlsZVxuICovXG5mdW5jdGlvbiBjYWxjdWxhdGVCdWlsZFRpbWVQZXJjZW50aWxlKGJ1aWxkVGltZTogbnVtYmVyKTogbnVtYmVyIHtcbiAgLy8gU2ltcGxpZmllZCBwZXJjZW50aWxlIGNhbGN1bGF0aW9uXG4gIC8vIEluIHJlYWxpdHksIHRoaXMgd291bGQgdXNlIGhpc3RvcmljYWwgZGF0YVxuICBjb25zdCBiZW5jaG1hcmtUaW1lcyA9IFszMDAwMCwgNDUwMDAsIDYwMDAwLCA5MDAwMCwgMTIwMDAwXTsgLy8gMzBzLCA0NXMsIDFtLCAxLjVtLCAybVxuICBcbiAgbGV0IHBlcmNlbnRpbGUgPSAwO1xuICBmb3IgKGxldCBpID0gMDsgaSA8IGJlbmNobWFya1RpbWVzLmxlbmd0aDsgaSsrKSB7XG4gICAgaWYgKGJ1aWxkVGltZSA8PSBiZW5jaG1hcmtUaW1lc1tpXSkge1xuICAgICAgcGVyY2VudGlsZSA9ICgoaSArIDEpIC8gYmVuY2htYXJrVGltZXMubGVuZ3RoKSAqIDEwMDtcbiAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuICBcbiAgcmV0dXJuIHBlcmNlbnRpbGUgfHwgMTAwOyAvLyBJZiBzbG93ZXIgdGhhbiBhbGwgYmVuY2htYXJrc1xufVxuXG4vKipcbiAqIEFuYWx5emUgcGVyZm9ybWFuY2UgdHJlbmRcbiAqL1xuZnVuY3Rpb24gYW5hbHl6ZVBlcmZvcm1hbmNlVHJlbmQoY3VycmVudFRpbWU6IG51bWJlciwgYXZlcmFnZVRpbWU6IG51bWJlcik6ICdpbXByb3ZpbmcnIHwgJ3N0YWJsZScgfCAnZGVncmFkaW5nJyB7XG4gIGNvbnN0IGRpZmZlcmVuY2UgPSBjdXJyZW50VGltZSAtIGF2ZXJhZ2VUaW1lO1xuICBjb25zdCBwZXJjZW50YWdlRGlmZmVyZW5jZSA9IChkaWZmZXJlbmNlIC8gYXZlcmFnZVRpbWUpICogMTAwO1xuICBcbiAgaWYgKHBlcmNlbnRhZ2VEaWZmZXJlbmNlIDwgLTEwKSB7XG4gICAgcmV0dXJuICdpbXByb3ZpbmcnO1xuICB9IGVsc2UgaWYgKHBlcmNlbnRhZ2VEaWZmZXJlbmNlID4gMTApIHtcbiAgICByZXR1cm4gJ2RlZ3JhZGluZyc7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuICdzdGFibGUnO1xuICB9XG59XG5cbi8qKlxuICogSWRlbnRpZnkgYnVpbGQgYm90dGxlbmVja3NcbiAqL1xuZnVuY3Rpb24gaWRlbnRpZnlCdWlsZEJvdHRsZW5lY2tzKG1ldHJpY3M6IEJ1aWxkTWV0cmljcyk6IEJvdHRsZW5lY2tBbmFseXNpc1tdIHtcbiAgY29uc3QgYm90dGxlbmVja3M6IEJvdHRsZW5lY2tBbmFseXNpc1tdID0gW107XG4gIFxuICAvLyBBbmFseXplIFR5cGVTY3JpcHQgY29tcGlsYXRpb25cbiAgaWYgKG1ldHJpY3MuZXJyb3JDb3VudCA+IDApIHtcbiAgICBib3R0bGVuZWNrcy5wdXNoKHtcbiAgICAgIHBoYXNlOiAnVHlwZVNjcmlwdCBDb21waWxhdGlvbicsXG4gICAgICBkdXJhdGlvbjogTWF0aC5yb3VuZChtZXRyaWNzLmR1cmF0aW9uICogMC40KSwgLy8gRXN0aW1hdGUgNDAlIG9mIGJ1aWxkIHRpbWVcbiAgICAgIHBlcmNlbnRhZ2U6IDQwLFxuICAgICAgc3VnZ2VzdGlvbnM6IFtcbiAgICAgICAgJ0ZpeCBUeXBlU2NyaXB0IGVycm9ycyB0byBpbXByb3ZlIGNvbXBpbGF0aW9uIHNwZWVkJyxcbiAgICAgICAgJ0VuYWJsZSBpbmNyZW1lbnRhbCBjb21waWxhdGlvbicsXG4gICAgICAgICdVc2UgcHJvamVjdCByZWZlcmVuY2VzIGZvciBsYXJnZSBjb2RlYmFzZXMnXG4gICAgICBdXG4gICAgfSk7XG4gIH1cbiAgXG4gIC8vIEFuYWx5emUgYnVuZGxlIHNpemUgaW1wYWN0XG4gIGlmIChtZXRyaWNzLmJ1bmRsZVNpemUudG90YWwgPiBQRVJGT1JNQU5DRV9USFJFU0hPTERTLkJVTkRMRV9TSVpFLk1BWF9TSVpFKSB7XG4gICAgYm90dGxlbmVja3MucHVzaCh7XG4gICAgICBwaGFzZTogJ0J1bmRsZSBHZW5lcmF0aW9uJyxcbiAgICAgIGR1cmF0aW9uOiBNYXRoLnJvdW5kKG1ldHJpY3MuZHVyYXRpb24gKiAwLjMpLCAvLyBFc3RpbWF0ZSAzMCUgb2YgYnVpbGQgdGltZVxuICAgICAgcGVyY2VudGFnZTogMzAsXG4gICAgICBzdWdnZXN0aW9uczogW1xuICAgICAgICAnSW1wbGVtZW50IGNvZGUgc3BsaXR0aW5nIHRvIHJlZHVjZSBidW5kbGUgc2l6ZScsXG4gICAgICAgICdFbmFibGUgdHJlZSBzaGFraW5nIHRvIHJlbW92ZSB1bnVzZWQgY29kZScsXG4gICAgICAgICdPcHRpbWl6ZSBhc3NldCBsb2FkaW5nIGFuZCBjb21wcmVzc2lvbidcbiAgICAgIF1cbiAgICB9KTtcbiAgfVxuICBcbiAgLy8gQW5hbHl6ZSBjYWNoZSBlZmZpY2llbmN5XG4gIGlmIChtZXRyaWNzLmNhY2hlSGl0UmF0ZSA8IDAuNykge1xuICAgIGJvdHRsZW5lY2tzLnB1c2goe1xuICAgICAgcGhhc2U6ICdDYWNoZSBNYW5hZ2VtZW50JyxcbiAgICAgIGR1cmF0aW9uOiBNYXRoLnJvdW5kKG1ldHJpY3MuZHVyYXRpb24gKiAwLjIpLCAvLyBFc3RpbWF0ZSAyMCUgb2YgYnVpbGQgdGltZVxuICAgICAgcGVyY2VudGFnZTogMjAsXG4gICAgICBzdWdnZXN0aW9uczogW1xuICAgICAgICAnT3B0aW1pemUgY2FjaGUgY29uZmlndXJhdGlvbicsXG4gICAgICAgICdJbXBsZW1lbnQgYmV0dGVyIGNhY2hlIGludmFsaWRhdGlvbiBzdHJhdGVneScsXG4gICAgICAgICdVc2UgcGVyc2lzdGVudCBjYWNoZSBmb3IgZGVwZW5kZW5jaWVzJ1xuICAgICAgXVxuICAgIH0pO1xuICB9XG4gIFxuICByZXR1cm4gYm90dGxlbmVja3M7XG59XG5cbi8qKlxuICogR2VuZXJhdGUgYnVpbGQgb3B0aW1pemF0aW9uIHJlY29tbWVuZGF0aW9uc1xuICovXG5mdW5jdGlvbiBnZW5lcmF0ZUJ1aWxkT3B0aW1pemF0aW9uUmVjb21tZW5kYXRpb25zKG1ldHJpY3M6IEJ1aWxkTWV0cmljcyk6IHN0cmluZ1tdIHtcbiAgY29uc3QgcmVjb21tZW5kYXRpb25zOiBzdHJpbmdbXSA9IFtdO1xuICBcbiAgaWYgKG1ldHJpY3MuZHVyYXRpb24gPiBQRVJGT1JNQU5DRV9USFJFU0hPTERTLkJVSUxEX1RJTUUuREVWRUxPUE1FTlQpIHtcbiAgICByZWNvbW1lbmRhdGlvbnMucHVzaCgnQ29uc2lkZXIgZW5hYmxpbmcgaW5jcmVtZW50YWwgYnVpbGRzIHRvIHJlZHVjZSBjb21waWxhdGlvbiB0aW1lJyk7XG4gIH1cbiAgXG4gIGlmIChtZXRyaWNzLmVycm9yQ291bnQgPiAxMCkge1xuICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKCdSZWR1Y2UgVHlwZVNjcmlwdCBlcnJvcnMgdG8gaW1wcm92ZSBidWlsZCBwZXJmb3JtYW5jZScpO1xuICB9XG4gIFxuICBpZiAobWV0cmljcy5jYWNoZUhpdFJhdGUgPCAwLjYpIHtcbiAgICByZWNvbW1lbmRhdGlvbnMucHVzaCgnT3B0aW1pemUgYnVpbGQgY2FjaGUgY29uZmlndXJhdGlvbiBmb3IgYmV0dGVyIHBlcmZvcm1hbmNlJyk7XG4gIH1cbiAgXG4gIGlmIChtZXRyaWNzLmJ1bmRsZVNpemUudG90YWwgPiBQRVJGT1JNQU5DRV9USFJFU0hPTERTLkJVTkRMRV9TSVpFLk1BWF9TSVpFKSB7XG4gICAgcmVjb21tZW5kYXRpb25zLnB1c2goJ0ltcGxlbWVudCBjb2RlIHNwbGl0dGluZyBhbmQgdHJlZSBzaGFraW5nIHRvIHJlZHVjZSBidW5kbGUgc2l6ZScpO1xuICB9XG4gIFxuICBpZiAobWV0cmljcy5wYXJhbGxlbGl6YXRpb24uZWZmaWNpZW5jeSA8IDAuNykge1xuICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKCdPcHRpbWl6ZSBidWlsZCBwYXJhbGxlbGl6YXRpb24gdG8gdXRpbGl6ZSBhdmFpbGFibGUgQ1BVIGNvcmVzJyk7XG4gIH1cbiAgXG4gIHJldHVybiByZWNvbW1lbmRhdGlvbnM7XG59XG5cbi8qKlxuICogQW5hbHl6ZSBtZW1vcnkgdXNhZ2VcbiAqL1xuYXN5bmMgZnVuY3Rpb24gYW5hbHl6ZU1lbW9yeVVzYWdlKG1ldHJpY3M6IEJ1aWxkTWV0cmljcyk6IFByb21pc2U8TWVtb3J5VXNhZ2VBbmFseXNpcz4ge1xuICB0cnkge1xuICAgIGNvbnN0IHBlYWtNZW1vcnlVc2FnZSA9IG1ldHJpY3MubWVtb3J5VXNhZ2UucGVhaztcbiAgICBjb25zdCBhdmVyYWdlTWVtb3J5VXNhZ2UgPSBtZXRyaWNzLm1lbW9yeVVzYWdlLmF2ZXJhZ2U7XG4gICAgXG4gICAgLy8gU2ltcGxpZmllZCBtZW1vcnkgbGVhayBkZXRlY3Rpb25cbiAgICBjb25zdCBtZW1vcnlMZWFrRGV0ZWN0aW9uID0gZGV0ZWN0TWVtb3J5TGVha3MobWV0cmljcyk7XG4gICAgXG4gICAgLy8gU2ltcGxpZmllZCBHQyBzdGF0c1xuICAgIGNvbnN0IGdhcmJhZ2VDb2xsZWN0aW9uU3RhdHMgPSBhbmFseXplR0NTdGF0cyhtZXRyaWNzKTtcbiAgICBcbiAgICAvLyBHZW5lcmF0ZSBtZW1vcnkgb3B0aW1pemF0aW9uIHN1Z2dlc3Rpb25zXG4gICAgY29uc3QgbWVtb3J5T3B0aW1pemF0aW9uU3VnZ2VzdGlvbnMgPSBnZW5lcmF0ZU1lbW9yeU9wdGltaXphdGlvblN1Z2dlc3Rpb25zKG1ldHJpY3MpO1xuICAgIFxuICAgIHJldHVybiB7XG4gICAgICBwZWFrTWVtb3J5VXNhZ2UsXG4gICAgICBhdmVyYWdlTWVtb3J5VXNhZ2UsXG4gICAgICBtZW1vcnlMZWFrRGV0ZWN0aW9uLFxuICAgICAgZ2FyYmFnZUNvbGxlY3Rpb25TdGF0cyxcbiAgICAgIG1lbW9yeU9wdGltaXphdGlvblN1Z2dlc3Rpb25zXG4gICAgfTtcbiAgICBcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBsb2dnZXIuZXJyb3IoJ0Vycm9yIGFuYWx5emluZyBtZW1vcnkgdXNhZ2U6JywgZXJyb3IpO1xuICAgIHRocm93IGVycm9yO1xuICB9XG59XG5cbi8qKlxuICogRGV0ZWN0IG1lbW9yeSBsZWFrcyAoc2ltcGxpZmllZCBpbXBsZW1lbnRhdGlvbilcbiAqL1xuZnVuY3Rpb24gZGV0ZWN0TWVtb3J5TGVha3MobWV0cmljczogQnVpbGRNZXRyaWNzKTogTWVtb3J5TGVha0luZm9bXSB7XG4gIGNvbnN0IGxlYWtzOiBNZW1vcnlMZWFrSW5mb1tdID0gW107XG4gIFxuICAvLyBTaW1wbGUgaGV1cmlzdGljOiBpZiBwZWFrIG1lbW9yeSBpcyBtdWNoIGhpZ2hlciB0aGFuIGF2ZXJhZ2VcbiAgaWYgKG1ldHJpY3MubWVtb3J5VXNhZ2UucGVhayA+IG1ldHJpY3MubWVtb3J5VXNhZ2UuYXZlcmFnZSAqIDIpIHtcbiAgICBsZWFrcy5wdXNoKHtcbiAgICAgIGNvbXBvbmVudDogJ0J1aWxkIFByb2Nlc3MnLFxuICAgICAgbGVha1NpemU6IG1ldHJpY3MubWVtb3J5VXNhZ2UucGVhayAtIG1ldHJpY3MubWVtb3J5VXNhZ2UuYXZlcmFnZSxcbiAgICAgIGdyb3d0aFJhdGU6IDAuMSwgLy8gRXN0aW1hdGVkXG4gICAgICBzdWdnZXN0aW9uczogW1xuICAgICAgICAnTW9uaXRvciBtZW1vcnkgdXNhZ2UgZHVyaW5nIGJ1aWxkIHByb2Nlc3MnLFxuICAgICAgICAnSW1wbGVtZW50IG1lbW9yeSBwcm9maWxpbmcgdG8gaWRlbnRpZnkgbGVha3MnLFxuICAgICAgICAnQ29uc2lkZXIgcmVkdWNpbmcgYmF0Y2ggc2l6ZXMgZm9yIGxhcmdlIG9wZXJhdGlvbnMnXG4gICAgICBdXG4gICAgfSk7XG4gIH1cbiAgXG4gIHJldHVybiBsZWFrcztcbn1cblxuLyoqXG4gKiBBbmFseXplIGdhcmJhZ2UgY29sbGVjdGlvbiBzdGF0cyAoc2ltcGxpZmllZCBpbXBsZW1lbnRhdGlvbilcbiAqL1xuZnVuY3Rpb24gYW5hbHl6ZUdDU3RhdHMobWV0cmljczogQnVpbGRNZXRyaWNzKTogR0NTdGF0cyB7XG4gIHJldHVybiB7XG4gICAgdG90YWxDb2xsZWN0aW9uczogbWV0cmljcy5tZW1vcnlVc2FnZS5nY0NvdW50LFxuICAgIHRvdGFsVGltZTogbWV0cmljcy5tZW1vcnlVc2FnZS5nY1RpbWUsXG4gICAgYXZlcmFnZVRpbWU6IG1ldHJpY3MubWVtb3J5VXNhZ2UuZ2NDb3VudCA+IDAgPyBtZXRyaWNzLm1lbW9yeVVzYWdlLmdjVGltZSAvIG1ldHJpY3MubWVtb3J5VXNhZ2UuZ2NDb3VudCA6IDAsXG4gICAgZWZmaWNpZW5jeTogMC44IC8vIEVzdGltYXRlZCBlZmZpY2llbmN5XG4gIH07XG59XG5cbi8qKlxuICogR2VuZXJhdGUgbWVtb3J5IG9wdGltaXphdGlvbiBzdWdnZXN0aW9uc1xuICovXG5mdW5jdGlvbiBnZW5lcmF0ZU1lbW9yeU9wdGltaXphdGlvblN1Z2dlc3Rpb25zKG1ldHJpY3M6IEJ1aWxkTWV0cmljcyk6IHN0cmluZ1tdIHtcbiAgY29uc3Qgc3VnZ2VzdGlvbnM6IHN0cmluZ1tdID0gW107XG4gIFxuICBpZiAobWV0cmljcy5tZW1vcnlVc2FnZS5wZWFrID4gUEVSRk9STUFOQ0VfVEhSRVNIT0xEUy5NRU1PUllfVVNBR0UuV0FSTklORykge1xuICAgIHN1Z2dlc3Rpb25zLnB1c2goJ0NvbnNpZGVyIGluY3JlYXNpbmcgTm9kZS5qcyBoZWFwIHNpemUgZm9yIGxhcmdlIGJ1aWxkcycpO1xuICB9XG4gIFxuICBpZiAobWV0cmljcy5tZW1vcnlVc2FnZS5wZWFrID4gbWV0cmljcy5tZW1vcnlVc2FnZS5hdmVyYWdlICogMS41KSB7XG4gICAgc3VnZ2VzdGlvbnMucHVzaCgnSW1wbGVtZW50IG1lbW9yeSBwcm9maWxpbmcgdG8gaWRlbnRpZnkgbWVtb3J5IHVzYWdlIHNwaWtlcycpO1xuICB9XG4gIFxuICBzdWdnZXN0aW9ucy5wdXNoKCdVc2Ugc3RyZWFtaW5nIGFuZCBjaHVua2VkIHByb2Nlc3NpbmcgZm9yIGxhcmdlIGZpbGUgb3BlcmF0aW9ucycpO1xuICBzdWdnZXN0aW9ucy5wdXNoKCdJbXBsZW1lbnQgcHJvcGVyIGNsZWFudXAgb2YgdGVtcG9yYXJ5IG9iamVjdHMgYW5kIHJlZmVyZW5jZXMnKTtcbiAgXG4gIHJldHVybiBzdWdnZXN0aW9ucztcbn1cblxuLyoqXG4gKiBHZW5lcmF0ZSBxdWFsaXR5IG1ldHJpY3MgcmVwb3J0XG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGdlbmVyYXRlUXVhbGl0eU1ldHJpY3NSZXBvcnQoKTogUHJvbWlzZTxRdWFsaXR5TWV0cmljc1JlcG9ydD4ge1xuICB0cnkge1xuICAgIC8vIFRoaXMgd291bGQgaW50ZWdyYXRlIHdpdGggdmFyaW91cyBxdWFsaXR5IHRvb2xzXG4gICAgLy8gRm9yIG5vdywgcHJvdmlkZSBlc3RpbWF0ZWQgdmFsdWVzXG4gICAgXG4gICAgY29uc3QgY29kZVF1YWxpdHkgPSB7XG4gICAgICB0eXBlU2NyaXB0RXJyb3JzOiBhd2FpdCBnZXRUeXBlU2NyaXB0RXJyb3JDb3VudCgpLFxuICAgICAgbGludGluZ1dhcm5pbmdzOiBhd2FpdCBnZXRMaW50aW5nV2FybmluZ0NvdW50KCksXG4gICAgICB0ZXN0Q292ZXJhZ2U6IDc1LCAvLyBFc3RpbWF0ZWRcbiAgICAgIGNvZGVDb21wbGV4aXR5OiA2LjUgLy8gRXN0aW1hdGVkXG4gICAgfTtcbiAgICBcbiAgICBjb25zdCBidWlsZFF1YWxpdHkgPSB7XG4gICAgICBzdWNjZXNzUmF0ZTogOTIsIC8vIEVzdGltYXRlZFxuICAgICAgYXZlcmFnZUJ1aWxkVGltZTogNDUwMDAsIC8vIDQ1IHNlY29uZHNcbiAgICAgIGZhaWx1cmVSYXRlOiA4LCAvLyBFc3RpbWF0ZWRcbiAgICAgIHJlY292ZXJ5VGltZTogMTIwIC8vIDIgbWludXRlc1xuICAgIH07XG4gICAgXG4gICAgY29uc3QgcGVyZm9ybWFuY2VRdWFsaXR5ID0ge1xuICAgICAgYnVuZGxlU2l6ZTogODUwMCwgLy8gS0JcbiAgICAgIGxvYWRUaW1lOiAyLjUsIC8vIHNlY29uZHNcbiAgICAgIG1lbW9yeUVmZmljaWVuY3k6IDAuOCxcbiAgICAgIGNhY2hlRWZmaWNpZW5jeTogMC43XG4gICAgfTtcbiAgICBcbiAgICBjb25zdCB0ZWNobmljYWxEZWJ0ID0ge1xuICAgICAgZGVidFJhdGlvOiAwLjE1LCAvLyAxNSVcbiAgICAgIG1haW50YWluYWJpbGl0eUluZGV4OiA3NSxcbiAgICAgIGR1cGxpY2F0ZUNvZGVQZXJjZW50YWdlOiA1LFxuICAgICAgb3V0ZGF0ZWREZXBlbmRlbmNpZXM6IDNcbiAgICB9O1xuICAgIFxuICAgIC8vIENhbGN1bGF0ZSBvdmVyYWxsIHNjb3JlXG4gICAgY29uc3Qgb3ZlcmFsbFNjb3JlID0gY2FsY3VsYXRlT3ZlcmFsbFF1YWxpdHlTY29yZShjb2RlUXVhbGl0eSwgYnVpbGRRdWFsaXR5LCBwZXJmb3JtYW5jZVF1YWxpdHksIHRlY2huaWNhbERlYnQpO1xuICAgIFxuICAgIHJldHVybiB7XG4gICAgICBvdmVyYWxsU2NvcmUsXG4gICAgICBjb2RlUXVhbGl0eSxcbiAgICAgIGJ1aWxkUXVhbGl0eSxcbiAgICAgIHBlcmZvcm1hbmNlUXVhbGl0eSxcbiAgICAgIHRlY2huaWNhbERlYnRcbiAgICB9O1xuICAgIFxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGxvZ2dlci5lcnJvcignRXJyb3IgZ2VuZXJhdGluZyBxdWFsaXR5IG1ldHJpY3MgcmVwb3J0OicsIGVycm9yKTtcbiAgICB0aHJvdyBlcnJvcjtcbiAgfVxufVxuXG4vKipcbiAqIEdldCBUeXBlU2NyaXB0IGVycm9yIGNvdW50XG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGdldFR5cGVTY3JpcHRFcnJvckNvdW50KCk6IFByb21pc2U8bnVtYmVyPiB7XG4gIHRyeSB7XG4gICAgY29uc3Qgb3V0cHV0ID0gZXhlY1N5bmMoJ3lhcm4gdHNjIC0tbm9FbWl0IC0tc2tpcExpYkNoZWNrIDI+JjEnLCB7XG4gICAgICBlbmNvZGluZzogJ3V0ZjgnLFxuICAgICAgc3RkaW86ICdwaXBlJ1xuICAgIH0pO1xuICAgIFxuICAgIGNvbnN0IGVycm9yTWF0Y2hlcyA9IG91dHB1dC5tYXRjaCgvZXJyb3IgVFNcXGQrOi9nKTtcbiAgICByZXR1cm4gZXJyb3JNYXRjaGVzID8gZXJyb3JNYXRjaGVzLmxlbmd0aCA6IDA7XG4gICAgXG4gIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICBpZiAoZXJyb3Iuc3Rkb3V0KSB7XG4gICAgICBjb25zdCBlcnJvck1hdGNoZXMgPSBlcnJvci5zdGRvdXQubWF0Y2goL2Vycm9yIFRTXFxkKzovZyk7XG4gICAgICByZXR1cm4gZXJyb3JNYXRjaGVzID8gZXJyb3JNYXRjaGVzLmxlbmd0aCA6IDA7XG4gICAgfVxuICAgIHJldHVybiAwO1xuICB9XG59XG5cbi8qKlxuICogR2V0IGxpbnRpbmcgd2FybmluZyBjb3VudFxuICovXG5hc3luYyBmdW5jdGlvbiBnZXRMaW50aW5nV2FybmluZ0NvdW50KCk6IFByb21pc2U8bnVtYmVyPiB7XG4gIHRyeSB7XG4gICAgY29uc3Qgb3V0cHV0ID0gZXhlY1N5bmMoJ3lhcm4gbGludCAtLWZvcm1hdD1qc29uIDI+L2Rldi9udWxsJywge1xuICAgICAgZW5jb2Rpbmc6ICd1dGY4JyxcbiAgICAgIHN0ZGlvOiAncGlwZSdcbiAgICB9KTtcbiAgICBcbiAgICBjb25zdCByZXN1bHRzID0gSlNPTi5wYXJzZShvdXRwdXQpO1xuICAgIHJldHVybiByZXN1bHRzLnJlZHVjZSgodG90YWw6IG51bWJlciwgcmVzdWx0OiBhbnkpID0+IHtcbiAgICAgIHJldHVybiB0b3RhbCArIChyZXN1bHQud2FybmluZ0NvdW50IHx8IDApO1xuICAgIH0sIDApO1xuICAgIFxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIHJldHVybiAwO1xuICB9XG59XG5cbi8qKlxuICogQ2FsY3VsYXRlIG92ZXJhbGwgcXVhbGl0eSBzY29yZVxuICovXG5mdW5jdGlvbiBjYWxjdWxhdGVPdmVyYWxsUXVhbGl0eVNjb3JlKFxuICBjb2RlUXVhbGl0eTogYW55LFxuICBidWlsZFF1YWxpdHk6IGFueSxcbiAgcGVyZm9ybWFuY2VRdWFsaXR5OiBhbnksXG4gIHRlY2huaWNhbERlYnQ6IGFueVxuKTogbnVtYmVyIHtcbiAgLy8gV2VpZ2h0ZWQgc2NvcmluZyBzeXN0ZW1cbiAgY29uc3QgY29kZVNjb3JlID0gTWF0aC5tYXgoMCwgMTAwIC0gY29kZVF1YWxpdHkudHlwZVNjcmlwdEVycm9ycyAtIGNvZGVRdWFsaXR5LmxpbnRpbmdXYXJuaW5ncyAqIDAuMSk7XG4gIGNvbnN0IGJ1aWxkU2NvcmUgPSBidWlsZFF1YWxpdHkuc3VjY2Vzc1JhdGU7XG4gIGNvbnN0IHBlcmZvcm1hbmNlU2NvcmUgPSBNYXRoLm1pbigxMDAsIHBlcmZvcm1hbmNlUXVhbGl0eS5jYWNoZUVmZmljaWVuY3kgKiAxMDApO1xuICBjb25zdCBkZWJ0U2NvcmUgPSBNYXRoLm1heCgwLCAxMDAgLSB0ZWNobmljYWxEZWJ0LmRlYnRSYXRpbyAqIDEwMCk7XG4gIFxuICAvLyBXZWlnaHRlZCBhdmVyYWdlXG4gIGNvbnN0IG92ZXJhbGxTY29yZSA9IChjb2RlU2NvcmUgKiAwLjMgKyBidWlsZFNjb3JlICogMC4zICsgcGVyZm9ybWFuY2VTY29yZSAqIDAuMiArIGRlYnRTY29yZSAqIDAuMik7XG4gIFxuICByZXR1cm4gTWF0aC5yb3VuZChvdmVyYWxsU2NvcmUpO1xufVxuXG4vKipcbiAqIFByb2Nlc3MgcGVyZm9ybWFuY2UgYWxlcnRzXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIHByb2Nlc3NQZXJmb3JtYW5jZUFsZXJ0cyhtZXRyaWNzOiBCdWlsZE1ldHJpY3MpOiBQcm9taXNlPEFsZXJ0UmVzcG9uc2VbXT4ge1xuICBjb25zdCBhbGVydHM6IEFsZXJ0UmVzcG9uc2VbXSA9IFtdO1xuICBcbiAgLy8gQnVpbGQgdGltZSBhbGVydHNcbiAgaWYgKG1ldHJpY3MuZHVyYXRpb24gPiBQRVJGT1JNQU5DRV9USFJFU0hPTERTLkJVSUxEX1RJTUUuQ1JJVElDQUwpIHtcbiAgICBhbGVydHMucHVzaCh7XG4gICAgICB0eXBlOiBBbGVydFR5cGUuQlVJTERfUEVSRk9STUFOQ0UsXG4gICAgICBzZXZlcml0eTogQWxlcnRTZXZlcml0eS5DUklUSUNBTCxcbiAgICAgIG1lc3NhZ2U6IGBCdWlsZCB0aW1lICR7TWF0aC5yb3VuZChtZXRyaWNzLmR1cmF0aW9uIC8gMTAwMCl9cyBleGNlZWRzIGNyaXRpY2FsIHRocmVzaG9sZCAke1BFUkZPUk1BTkNFX1RIUkVTSE9MRFMuQlVJTERfVElNRS5DUklUSUNBTCAvIDEwMDB9c2AsXG4gICAgICByZWNvbW1lbmRhdGlvbnM6IFtcbiAgICAgICAgJ0ltcGxlbWVudCBpbmNyZW1lbnRhbCBidWlsZHMnLFxuICAgICAgICAnT3B0aW1pemUgVHlwZVNjcmlwdCBjb25maWd1cmF0aW9uJyxcbiAgICAgICAgJ0VuYWJsZSBidWlsZCBjYWNoaW5nJ1xuICAgICAgXSxcbiAgICAgIGF1dG9SZXNwb25zZTogJ0FOQUxZWkVfQlVJTERfQk9UVExFTkVDS1MnLFxuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpXG4gICAgfSk7XG4gIH0gZWxzZSBpZiAobWV0cmljcy5kdXJhdGlvbiA+IFBFUkZPUk1BTkNFX1RIUkVTSE9MRFMuQlVJTERfVElNRS5ERVZFTE9QTUVOVCkge1xuICAgIGFsZXJ0cy5wdXNoKHtcbiAgICAgIHR5cGU6IEFsZXJ0VHlwZS5CVUlMRF9QRVJGT1JNQU5DRSxcbiAgICAgIHNldmVyaXR5OiBBbGVydFNldmVyaXR5LkhJR0gsXG4gICAgICBtZXNzYWdlOiBgQnVpbGQgdGltZSAke01hdGgucm91bmQobWV0cmljcy5kdXJhdGlvbiAvIDEwMDApfXMgZXhjZWVkcyBkZXZlbG9wbWVudCB0aHJlc2hvbGQgJHtQRVJGT1JNQU5DRV9USFJFU0hPTERTLkJVSUxEX1RJTUUuREVWRUxPUE1FTlQgLyAxMDAwfXNgLFxuICAgICAgcmVjb21tZW5kYXRpb25zOiBbXG4gICAgICAgICdSZXZpZXcgYnVpbGQgY29uZmlndXJhdGlvbicsXG4gICAgICAgICdDb25zaWRlciBjb2RlIHNwbGl0dGluZycsXG4gICAgICAgICdPcHRpbWl6ZSBkZXBlbmRlbmNpZXMnXG4gICAgICBdLFxuICAgICAgYXV0b1Jlc3BvbnNlOiAnTU9OSVRPUl9CVUlMRF9QRVJGT1JNQU5DRScsXG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKClcbiAgICB9KTtcbiAgfVxuICBcbiAgLy8gTWVtb3J5IHVzYWdlIGFsZXJ0c1xuICBpZiAobWV0cmljcy5tZW1vcnlVc2FnZS5wZWFrID4gUEVSRk9STUFOQ0VfVEhSRVNIT0xEUy5NRU1PUllfVVNBR0UuQ1JJVElDQUwpIHtcbiAgICBhbGVydHMucHVzaCh7XG4gICAgICB0eXBlOiBBbGVydFR5cGUuTUVNT1JZX1VTQUdFLFxuICAgICAgc2V2ZXJpdHk6IEFsZXJ0U2V2ZXJpdHkuQ1JJVElDQUwsXG4gICAgICBtZXNzYWdlOiBgTWVtb3J5IHVzYWdlICR7bWV0cmljcy5tZW1vcnlVc2FnZS5wZWFrfU1CIGV4Y2VlZHMgY3JpdGljYWwgdGhyZXNob2xkICR7UEVSRk9STUFOQ0VfVEhSRVNIT0xEUy5NRU1PUllfVVNBR0UuQ1JJVElDQUx9TUJgLFxuICAgICAgcmVjb21tZW5kYXRpb25zOiBbXG4gICAgICAgICdJbmNyZWFzZSBOb2RlLmpzIGhlYXAgc2l6ZScsXG4gICAgICAgICdJbXBsZW1lbnQgbWVtb3J5IHByb2ZpbGluZycsXG4gICAgICAgICdPcHRpbWl6ZSBtZW1vcnktaW50ZW5zaXZlIG9wZXJhdGlvbnMnXG4gICAgICBdLFxuICAgICAgYXV0b1Jlc3BvbnNlOiAnQU5BTFlaRV9NRU1PUllfVVNBR0UnLFxuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpXG4gICAgfSk7XG4gIH1cbiAgXG4gIC8vIEJ1bmRsZSBzaXplIGFsZXJ0c1xuICBpZiAobWV0cmljcy5idW5kbGVTaXplLnRvdGFsID4gUEVSRk9STUFOQ0VfVEhSRVNIT0xEUy5CVU5ETEVfU0laRS5NQVhfU0laRSkge1xuICAgIGFsZXJ0cy5wdXNoKHtcbiAgICAgIHR5cGU6IEFsZXJ0VHlwZS5CVU5ETEVfU0laRSxcbiAgICAgIHNldmVyaXR5OiBBbGVydFNldmVyaXR5LkhJR0gsXG4gICAgICBtZXNzYWdlOiBgQnVuZGxlIHNpemUgJHttZXRyaWNzLmJ1bmRsZVNpemUudG90YWx9S0IgZXhjZWVkcyBtYXhpbXVtIHRocmVzaG9sZCAke1BFUkZPUk1BTkNFX1RIUkVTSE9MRFMuQlVORExFX1NJWkUuTUFYX1NJWkV9S0JgLFxuICAgICAgcmVjb21tZW5kYXRpb25zOiBbXG4gICAgICAgICdJbXBsZW1lbnQgY29kZSBzcGxpdHRpbmcnLFxuICAgICAgICAnRW5hYmxlIHRyZWUgc2hha2luZycsXG4gICAgICAgICdPcHRpbWl6ZSBhc3NldCBsb2FkaW5nJ1xuICAgICAgXSxcbiAgICAgIGF1dG9SZXNwb25zZTogJ0FOQUxZWkVfQlVORExFX1NJWkUnLFxuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpXG4gICAgfSk7XG4gIH1cbiAgXG4gIHJldHVybiBhbGVydHM7XG59XG5cbi8qKlxuICogR2VuZXJhdGUgb3B0aW1pemF0aW9uIHJlY29tbWVuZGF0aW9uc1xuICovXG5mdW5jdGlvbiBnZW5lcmF0ZU9wdGltaXphdGlvblJlY29tbWVuZGF0aW9ucyhcbiAgYnVpbGRNZXRyaWNzOiBCdWlsZE1ldHJpY3MsXG4gIHBlcmZvcm1hbmNlQW5hbHlzaXM6IEJ1aWxkUGVyZm9ybWFuY2VBbmFseXNpcyxcbiAgbWVtb3J5QW5hbHlzaXM6IE1lbW9yeVVzYWdlQW5hbHlzaXNcbik6IE9wdGltaXphdGlvblJlY29tbWVuZGF0aW9uW10ge1xuICBjb25zdCByZWNvbW1lbmRhdGlvbnM6IE9wdGltaXphdGlvblJlY29tbWVuZGF0aW9uW10gPSBbXTtcbiAgXG4gIC8vIEJ1aWxkIHBlcmZvcm1hbmNlIHJlY29tbWVuZGF0aW9uc1xuICBpZiAoYnVpbGRNZXRyaWNzLmR1cmF0aW9uID4gUEVSRk9STUFOQ0VfVEhSRVNIT0xEUy5CVUlMRF9USU1FLkRFVkVMT1BNRU5UKSB7XG4gICAgcmVjb21tZW5kYXRpb25zLnB1c2goe1xuICAgICAgY2F0ZWdvcnk6ICdidWlsZCcsXG4gICAgICBwcmlvcml0eTogJ2hpZ2gnLFxuICAgICAgaW1wYWN0OiAnaGlnaCcsXG4gICAgICBlZmZvcnQ6ICdtZWRpdW0nLFxuICAgICAgZGVzY3JpcHRpb246ICdPcHRpbWl6ZSBidWlsZCBwZXJmb3JtYW5jZSB0byByZWR1Y2UgY29tcGlsYXRpb24gdGltZScsXG4gICAgICBpbXBsZW1lbnRhdGlvbjogW1xuICAgICAgICAnRW5hYmxlIGluY3JlbWVudGFsIFR5cGVTY3JpcHQgY29tcGlsYXRpb24nLFxuICAgICAgICAnSW1wbGVtZW50IGJ1aWxkIGNhY2hpbmcgc3RyYXRlZ3knLFxuICAgICAgICAnT3B0aW1pemUgd2VicGFjayBjb25maWd1cmF0aW9uJ1xuICAgICAgXSxcbiAgICAgIGV4cGVjdGVkSW1wcm92ZW1lbnQ6ICczMC01MCUgcmVkdWN0aW9uIGluIGJ1aWxkIHRpbWUnXG4gICAgfSk7XG4gIH1cbiAgXG4gIC8vIE1lbW9yeSBvcHRpbWl6YXRpb24gcmVjb21tZW5kYXRpb25zXG4gIGlmIChidWlsZE1ldHJpY3MubWVtb3J5VXNhZ2UucGVhayA+IFBFUkZPUk1BTkNFX1RIUkVTSE9MRFMuTUVNT1JZX1VTQUdFLldBUk5JTkcpIHtcbiAgICByZWNvbW1lbmRhdGlvbnMucHVzaCh7XG4gICAgICBjYXRlZ29yeTogJ21lbW9yeScsXG4gICAgICBwcmlvcml0eTogJ21lZGl1bScsXG4gICAgICBpbXBhY3Q6ICdtZWRpdW0nLFxuICAgICAgZWZmb3J0OiAnbG93JyxcbiAgICAgIGRlc2NyaXB0aW9uOiAnT3B0aW1pemUgbWVtb3J5IHVzYWdlIGR1cmluZyBidWlsZCBwcm9jZXNzJyxcbiAgICAgIGltcGxlbWVudGF0aW9uOiBbXG4gICAgICAgICdJbXBsZW1lbnQgc3RyZWFtaW5nIGZvciBsYXJnZSBmaWxlIG9wZXJhdGlvbnMnLFxuICAgICAgICAnQWRkIG1lbW9yeSBtb25pdG9yaW5nIGFuZCBwcm9maWxpbmcnLFxuICAgICAgICAnT3B0aW1pemUgZ2FyYmFnZSBjb2xsZWN0aW9uIHNldHRpbmdzJ1xuICAgICAgXSxcbiAgICAgIGV4cGVjdGVkSW1wcm92ZW1lbnQ6ICcyMC0zMCUgcmVkdWN0aW9uIGluIG1lbW9yeSB1c2FnZSdcbiAgICB9KTtcbiAgfVxuICBcbiAgLy8gQnVuZGxlIHNpemUgcmVjb21tZW5kYXRpb25zXG4gIGlmIChidWlsZE1ldHJpY3MuYnVuZGxlU2l6ZS50b3RhbCA+IFBFUkZPUk1BTkNFX1RIUkVTSE9MRFMuQlVORExFX1NJWkUuTUFYX1NJWkUgKiAwLjgpIHtcbiAgICByZWNvbW1lbmRhdGlvbnMucHVzaCh7XG4gICAgICBjYXRlZ29yeTogJ2J1bmRsZScsXG4gICAgICBwcmlvcml0eTogJ21lZGl1bScsXG4gICAgICBpbXBhY3Q6ICdoaWdoJyxcbiAgICAgIGVmZm9ydDogJ21lZGl1bScsXG4gICAgICBkZXNjcmlwdGlvbjogJ1JlZHVjZSBidW5kbGUgc2l6ZSB0byBpbXByb3ZlIGxvYWQgcGVyZm9ybWFuY2UnLFxuICAgICAgaW1wbGVtZW50YXRpb246IFtcbiAgICAgICAgJ0ltcGxlbWVudCBkeW5hbWljIGltcG9ydHMgYW5kIGNvZGUgc3BsaXR0aW5nJyxcbiAgICAgICAgJ0VuYWJsZSB0cmVlIHNoYWtpbmcgZm9yIHVudXNlZCBjb2RlIHJlbW92YWwnLFxuICAgICAgICAnT3B0aW1pemUgYXNzZXQgY29tcHJlc3Npb24gYW5kIGxvYWRpbmcnXG4gICAgICBdLFxuICAgICAgZXhwZWN0ZWRJbXByb3ZlbWVudDogJzE1LTI1JSByZWR1Y3Rpb24gaW4gYnVuZGxlIHNpemUnXG4gICAgfSk7XG4gIH1cbiAgXG4gIC8vIENhY2hlIG9wdGltaXphdGlvbiByZWNvbW1lbmRhdGlvbnNcbiAgaWYgKGJ1aWxkTWV0cmljcy5jYWNoZUhpdFJhdGUgPCAwLjcpIHtcbiAgICByZWNvbW1lbmRhdGlvbnMucHVzaCh7XG4gICAgICBjYXRlZ29yeTogJ2NhY2hlJyxcbiAgICAgIHByaW9yaXR5OiAnbG93JyxcbiAgICAgIGltcGFjdDogJ21lZGl1bScsXG4gICAgICBlZmZvcnQ6ICdsb3cnLFxuICAgICAgZGVzY3JpcHRpb246ICdJbXByb3ZlIGJ1aWxkIGNhY2hlIGVmZmljaWVuY3knLFxuICAgICAgaW1wbGVtZW50YXRpb246IFtcbiAgICAgICAgJ09wdGltaXplIGNhY2hlIGNvbmZpZ3VyYXRpb24nLFxuICAgICAgICAnSW1wbGVtZW50IGJldHRlciBjYWNoZSBpbnZhbGlkYXRpb24nLFxuICAgICAgICAnVXNlIHBlcnNpc3RlbnQgY2FjaGUgZm9yIGRlcGVuZGVuY2llcydcbiAgICAgIF0sXG4gICAgICBleHBlY3RlZEltcHJvdmVtZW50OiAnMTAtMjAlIGltcHJvdmVtZW50IGluIGNhY2hlIGhpdCByYXRlJ1xuICAgIH0pO1xuICB9XG4gIFxuICByZXR1cm4gcmVjb21tZW5kYXRpb25zO1xufVxuXG4vKipcbiAqIEdldCBzaW1wbGUgYnVpbGQgcXVhbGl0eSBzY29yZVxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0QnVpbGRRdWFsaXR5U2NvcmUoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCByZXBvcnQgPSBhd2FpdCBtb25pdG9yQnVpbGRRdWFsaXR5KCk7XG4gICAgcmV0dXJuIHJlcG9ydC5xdWFsaXR5TWV0cmljcy5vdmVyYWxsU2NvcmU7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgbG9nZ2VyLmVycm9yKCdGYWlsZWQgdG8gZ2V0IGJ1aWxkIHF1YWxpdHkgc2NvcmU6JywgZXJyb3IpO1xuICAgIHJldHVybiAwO1xuICB9XG59Il0sInZlcnNpb24iOjN9