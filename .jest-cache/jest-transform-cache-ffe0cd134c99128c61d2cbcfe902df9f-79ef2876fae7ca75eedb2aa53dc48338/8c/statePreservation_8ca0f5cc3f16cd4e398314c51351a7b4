c15bf41011f47eba66a735a7f31b6cc7
"use strict";
/**
 * State Preservation Utility
 * Handles saving and restoring component state across navigation
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.createStatePreservationHook = exports.useStateCleanup = exports.clearExpiredState = exports.clearAllState = exports.getScrollPosition = exports.saveScrollPosition = exports.getComponentState = exports.saveComponentState = exports.getNavigationState = exports.saveNavigationState = void 0;
const STATE_KEYS = {
    MAIN_PAGE_STATE: 'mainPageState',
    NAVIGATION_STATE: 'navigationState',
    COMPONENT_STATES: 'componentStates',
    SCROLL_POSITIONS: 'scrollPositions',
};
// State expiration time (1 hour)
const STATE_EXPIRATION_TIME = 60 * 60 * 1000;
/**
 * Check if stored state is still valid (not expired)
 */
function isStateValid(timestamp) {
    return Date.now() - timestamp < STATE_EXPIRATION_TIME;
}
/**
 * Safely get item from storage with error handling
 */
function safeGetItem(key) {
    try {
        return sessionStorage.getItem(key);
    }
    catch (error) {
        console.warn(`Failed to get item from sessionStorage: ${key}`, error);
        return null;
    }
}
/**
 * Safely set item in storage with error handling
 */
function safeSetItem(key, value) {
    try {
        sessionStorage.setItem(key, value);
        return true;
    }
    catch (error) {
        console.warn(`Failed to set item in sessionStorage: ${key}`, error);
        return false;
    }
}
/**
 * Save navigation state
 */
function saveNavigationState(state) {
    const currentState = getNavigationState();
    const updatedState = {
        ...currentState,
        ...state,
    };
    const stateWithTimestamp = {
        timestamp: Date.now(),
        data: updatedState,
    };
    safeSetItem(STATE_KEYS.NAVIGATION_STATE, JSON.stringify(stateWithTimestamp));
}
exports.saveNavigationState = saveNavigationState;
/**
 * Get navigation state
 */
function getNavigationState() {
    const defaultState = {
        activeSection: null,
        navigationHistory: [],
        selectedIngredients: [],
        selectedCuisine: null,
        selectedCookingMethods: [],
        currentRecipe: null,
        selectedIngredientCategory: null,
        selectedIngredient: null,
        selectedCookingMethod: null,
        scrollPosition: 0,
    };
    const stored = safeGetItem(STATE_KEYS.NAVIGATION_STATE);
    if (!stored)
        return defaultState;
    try {
        const parsed = JSON.parse(stored);
        if (!isStateValid(parsed.timestamp)) {
            return defaultState;
        }
        return { ...defaultState, ...parsed.data };
    }
    catch (error) {
        console.warn('Failed to parse navigation state:', error);
        return defaultState;
    }
}
exports.getNavigationState = getNavigationState;
/**
 * Save component-specific state
 */
function saveComponentState(componentId, state) {
    const allStates = getComponentStates();
    allStates[componentId] = {
        timestamp: Date.now(),
        data: state,
    };
    safeSetItem(STATE_KEYS.COMPONENT_STATES, JSON.stringify(allStates));
}
exports.saveComponentState = saveComponentState;
/**
 * Get component-specific state
 */
function getComponentState(componentId) {
    const allStates = getComponentStates();
    const componentState = allStates[componentId];
    if (!componentState || !isStateValid(componentState.timestamp)) {
        return null;
    }
    return componentState.data;
}
exports.getComponentState = getComponentState;
/**
 * Get all component states
 */
function getComponentStates() {
    const stored = safeGetItem(STATE_KEYS.COMPONENT_STATES);
    if (!stored)
        return {};
    try {
        return JSON.parse(stored);
    }
    catch (error) {
        console.warn('Failed to parse component states:', error);
        return {};
    }
}
/**
 * Save scroll position for a specific section
 */
function saveScrollPosition(sectionId, position) {
    const positions = getScrollPositions();
    positions[sectionId] = {
        timestamp: Date.now(),
        data: position,
    };
    safeSetItem(STATE_KEYS.SCROLL_POSITIONS, JSON.stringify(positions));
}
exports.saveScrollPosition = saveScrollPosition;
/**
 * Get scroll position for a specific section
 */
function getScrollPosition(sectionId) {
    const positions = getScrollPositions();
    const position = positions[sectionId];
    if (!position || !isStateValid(position.timestamp)) {
        return 0;
    }
    return position.data;
}
exports.getScrollPosition = getScrollPosition;
/**
 * Get all scroll positions
 */
function getScrollPositions() {
    const stored = safeGetItem(STATE_KEYS.SCROLL_POSITIONS);
    if (!stored)
        return {};
    try {
        return JSON.parse(stored);
    }
    catch (error) {
        console.warn('Failed to parse scroll positions:', error);
        return {};
    }
}
/**
 * Clear all stored state (useful for cleanup)
 */
function clearAllState() {
    Object.values(STATE_KEYS).forEach(key => {
        try {
            sessionStorage.removeItem(key);
        }
        catch (error) {
            console.warn(`Failed to remove item from sessionStorage: ${key}`, error);
        }
    });
}
exports.clearAllState = clearAllState;
/**
 * Clear expired state entries
 */
function clearExpiredState() {
    // Clear expired navigation state
    const navState = safeGetItem(STATE_KEYS.NAVIGATION_STATE);
    if (navState) {
        try {
            const parsed = JSON.parse(navState);
            if (!isStateValid(parsed.timestamp)) {
                sessionStorage.removeItem(STATE_KEYS.NAVIGATION_STATE);
            }
        }
        catch (error) {
            sessionStorage.removeItem(STATE_KEYS.NAVIGATION_STATE);
        }
    }
    // Clear expired component states
    const componentStates = getComponentStates();
    const validStates = {};
    let hasChanges = false;
    Object.entries(componentStates).forEach(([key, state]) => {
        if (isStateValid(state.timestamp)) {
            validStates[key] = state;
        }
        else {
            hasChanges = true;
        }
    });
    if (hasChanges) {
        safeSetItem(STATE_KEYS.COMPONENT_STATES, JSON.stringify(validStates));
    }
    // Clear expired scroll positions
    const scrollPositions = getScrollPositions();
    const validPositions = {};
    hasChanges = false;
    Object.entries(scrollPositions).forEach(([key, position]) => {
        if (isStateValid(position.timestamp)) {
            validPositions[key] = position;
        }
        else {
            hasChanges = true;
        }
    });
    if (hasChanges) {
        safeSetItem(STATE_KEYS.SCROLL_POSITIONS, JSON.stringify(validPositions));
    }
}
exports.clearExpiredState = clearExpiredState;
/**
 * Hook for automatic state cleanup on page load
 */
function useStateCleanup() {
    if (typeof window !== 'undefined') {
        // Clear expired state on page load
        clearExpiredState();
        // Set up periodic cleanup (every 10 minutes)
        const interval = setInterval(clearExpiredState, 10 * 60 * 1000);
        // Cleanup on page unload
        const cleanup = () => {
            clearInterval(interval);
            clearExpiredState();
        };
        window.addEventListener('beforeunload', cleanup);
        // Return cleanup function
        return cleanup;
    }
}
exports.useStateCleanup = useStateCleanup;
/**
 * Create a state preservation hook for components
 */
function createStatePreservationHook(componentId) {
    return {
        saveState: (state) => saveComponentState(componentId, state),
        getState: () => getComponentState(componentId),
        clearState: () => {
            const allStates = getComponentStates();
            delete allStates[componentId];
            safeSetItem(STATE_KEYS.COMPONENT_STATES, JSON.stringify(allStates));
        },
    };
}
exports.createStatePreservationHook = createStatePreservationHook;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy91dGlscy9zdGF0ZVByZXNlcnZhdGlvbi50cyIsIm1hcHBpbmdzIjoiO0FBQUE7OztHQUdHOzs7QUFvQkgsTUFBTSxVQUFVLEdBQUc7SUFDakIsZUFBZSxFQUFFLGVBQWU7SUFDaEMsZ0JBQWdCLEVBQUUsaUJBQWlCO0lBQ25DLGdCQUFnQixFQUFFLGlCQUFpQjtJQUNuQyxnQkFBZ0IsRUFBRSxpQkFBaUI7Q0FDM0IsQ0FBQztBQUVYLGlDQUFpQztBQUNqQyxNQUFNLHFCQUFxQixHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsSUFBSSxDQUFDO0FBRTdDOztHQUVHO0FBQ0gsU0FBUyxZQUFZLENBQUMsU0FBaUI7SUFDckMsT0FBTyxJQUFJLENBQUMsR0FBRyxFQUFFLEdBQUcsU0FBUyxHQUFHLHFCQUFxQixDQUFDO0FBQ3hELENBQUM7QUFFRDs7R0FFRztBQUNILFNBQVMsV0FBVyxDQUFDLEdBQVc7SUFDOUIsSUFBSTtRQUNGLE9BQU8sY0FBYyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQztLQUNwQztJQUFDLE9BQU8sS0FBSyxFQUFFO1FBQ2QsT0FBTyxDQUFDLElBQUksQ0FBQywyQ0FBMkMsR0FBRyxFQUFFLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDdEUsT0FBTyxJQUFJLENBQUM7S0FDYjtBQUNILENBQUM7QUFFRDs7R0FFRztBQUNILFNBQVMsV0FBVyxDQUFDLEdBQVcsRUFBRSxLQUFhO0lBQzdDLElBQUk7UUFDRixjQUFjLENBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUNuQyxPQUFPLElBQUksQ0FBQztLQUNiO0lBQUMsT0FBTyxLQUFLLEVBQUU7UUFDZCxPQUFPLENBQUMsSUFBSSxDQUFDLHlDQUF5QyxHQUFHLEVBQUUsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUNwRSxPQUFPLEtBQUssQ0FBQztLQUNkO0FBQ0gsQ0FBQztBQUVEOztHQUVHO0FBQ0gsU0FBZ0IsbUJB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QUFDLENBQUM7UUFFaEUseUJBQXlCO1FBQ3pCLE1BQU0sT0FBTyxHQUFHLEdBQUcsRUFBRTtZQUNuQixhQUFhLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDeEIsaUJBQWlCLEVBQUUsQ0FBQztRQUN0QixDQUFDLENBQUM7UUFFRixNQUFNLENBQUMsZ0JBQWdCLENBQUMsY0FBYyxFQUFFLE9BQU8sQ0FBQyxDQUFDO1FBRWpELDBCQUEwQjtRQUMxQixPQUFPLE9BQU8sQ0FBQztLQUNoQjtBQUNILENBQUM7QUFuQkQsMENBbUJDO0FBRUQ7O0dBRUc7QUFDSCxTQUFnQiwyQkFBMkIsQ0FBQyxXQUFtQjtJQUM3RCxPQUFPO1FBQ0wsU0FBUyxFQUFFLENBQUMsS0FBVSxFQUFFLEVBQUUsQ0FBQyxrQkFBa0IsQ0FBQyxXQUFXLEVBQUUsS0FBSyxDQUFDO1FBQ2pFLFFBQVEsRUFBRSxHQUFHLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxXQUFXLENBQUM7UUFDOUMsVUFBVSxFQUFFLEdBQUcsRUFBRTtZQUNmLE1BQU0sU0FBUyxHQUFHLGtCQUFrQixFQUFFLENBQUM7WUFDdkMsT0FBTyxTQUFTLENBQUMsV0FBVyxDQUFDLENBQUM7WUFDOUIsV0FBVyxDQUFDLFVBQVUsQ0FBQyxnQkFBZ0IsRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUM7UUFDdEUsQ0FBQztLQUNGLENBQUM7QUFDSixDQUFDO0FBVkQsa0VBVUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy91dGlscy9zdGF0ZVByZXNlcnZhdGlvbi50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFN0YXRlIFByZXNlcnZhdGlvbiBVdGlsaXR5XG4gKiBIYW5kbGVzIHNhdmluZyBhbmQgcmVzdG9yaW5nIGNvbXBvbmVudCBzdGF0ZSBhY3Jvc3MgbmF2aWdhdGlvblxuICovXG5cbmV4cG9ydCBpbnRlcmZhY2UgQ29tcG9uZW50U3RhdGUge1xuICB0aW1lc3RhbXA6IG51bWJlcjtcbiAgZGF0YTogYW55O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIE5hdmlnYXRpb25TdGF0ZSB7XG4gIGFjdGl2ZVNlY3Rpb246IHN0cmluZyB8IG51bGw7XG4gIG5hdmlnYXRpb25IaXN0b3J5OiBzdHJpbmdbXTtcbiAgc2VsZWN0ZWRJbmdyZWRpZW50czogc3RyaW5nW107XG4gIHNlbGVjdGVkQ3Vpc2luZTogc3RyaW5nIHwgbnVsbDtcbiAgc2VsZWN0ZWRDb29raW5nTWV0aG9kczogc3RyaW5nW107XG4gIGN1cnJlbnRSZWNpcGU6IGFueSB8IG51bGw7XG4gIHNlbGVjdGVkSW5ncmVkaWVudENhdGVnb3J5OiBzdHJpbmcgfCBudWxsO1xuICBzZWxlY3RlZEluZ3JlZGllbnQ6IHN0cmluZyB8IG51bGw7XG4gIHNlbGVjdGVkQ29va2luZ01ldGhvZDogYW55IHwgbnVsbDtcbiAgc2Nyb2xsUG9zaXRpb246IG51bWJlcjtcbn1cblxuY29uc3QgU1RBVEVfS0VZUyA9IHtcbiAgTUFJTl9QQUdFX1NUQVRFOiAnbWFpblBhZ2VTdGF0ZScsXG4gIE5BVklHQVRJT05fU1RBVEU6ICduYXZpZ2F0aW9uU3RhdGUnLFxuICBDT01QT05FTlRfU1RBVEVTOiAnY29tcG9uZW50U3RhdGVzJyxcbiAgU0NST0xMX1BPU0lUSU9OUzogJ3Njcm9sbFBvc2l0aW9ucycsXG59IGFzIGNvbnN0O1xuXG4vLyBTdGF0ZSBleHBpcmF0aW9uIHRpbWUgKDEgaG91cilcbmNvbnN0IFNUQVRFX0VYUElSQVRJT05fVElNRSA9IDYwICogNjAgKiAxMDAwO1xuXG4vKipcbiAqIENoZWNrIGlmIHN0b3JlZCBzdGF0ZSBpcyBzdGlsbCB2YWxpZCAobm90IGV4cGlyZWQpXG4gKi9cbmZ1bmN0aW9uIGlzU3RhdGVWYWxpZCh0aW1lc3RhbXA6IG51bWJlcik6IGJvb2xlYW4ge1xuICByZXR1cm4gRGF0ZS5ub3coKSAtIHRpbWVzdGFtcCA8IFNUQVRFX0VYUElSQVRJT05fVElNRTtcbn1cblxuLyoqXG4gKiBTYWZlbHkgZ2V0IGl0ZW0gZnJvbSBzdG9yYWdlIHdpdGggZXJyb3IgaGFuZGxpbmdcbiAqL1xuZnVuY3Rpb24gc2FmZUdldEl0ZW0oa2V5OiBzdHJpbmcpOiBzdHJpbmcgfCBudWxsIHtcbiAgdHJ5IHtcbiAgICByZXR1cm4gc2Vzc2lvblN0b3JhZ2UuZ2V0SXRlbShrZXkpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUud2FybihgRmFpbGVkIHRvIGdldCBpdGVtIGZyb20gc2Vzc2lvblN0b3JhZ2U6ICR7a2V5fWAsIGVycm9yKTtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxufVxuXG4vKipcbiAqIFNhZmVseSBzZXQgaXRlbSBpbiBzdG9yYWdlIHdpdGggZXJyb3IgaGFuZGxpbmdcbiAqL1xuZnVuY3Rpb24gc2FmZVNldEl0ZW0oa2V5OiBzdHJpbmcsIHZhbHVlOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgdHJ5IHtcbiAgICBzZXNzaW9uU3RvcmFnZS5zZXRJdGVtKGtleSwgdmFsdWUpO1xuICAgIHJldHVybiB0cnVlO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUud2FybihgRmFpbGVkIHRvIHNldCBpdGVtIGluIHNlc3Npb25TdG9yYWdlOiAke2tleX1gLCBlcnJvcik7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG59XG5cbi8qKlxuICogU2F2ZSBuYXZpZ2F0aW9uIHN0YXRlXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzYXZlTmF2aWdhdGlvblN0YXRlKHN0YXRlOiBQYXJ0aWFsPE5hdmlnYXRpb25TdGF0ZT4pOiB2b2lkIHtcbiAgY29uc3QgY3VycmVudFN0YXRlID0gZ2V0TmF2aWdhdGlvblN0YXRlKCk7XG4gIGNvbnN0IHVwZGF0ZWRTdGF0ZTogTmF2aWdhdGlvblN0YXRlID0ge1xuICAgIC4uLmN1cnJlbnRTdGF0ZSxcbiAgICAuLi5zdGF0ZSxcbiAgfTtcblxuICBjb25zdCBzdGF0ZVdpdGhUaW1lc3RhbXA6IENvbXBvbmVudFN0YXRlID0ge1xuICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICBkYXRhOiB1cGRhdGVkU3RhdGUsXG4gIH07XG5cbiAgc2FmZVNldEl0ZW0oU1RBVEVfS0VZUy5OQVZJR0FUSU9OX1NUQVRFLCBKU09OLnN0cmluZ2lmeShzdGF0ZVdpdGhUaW1lc3RhbXApKTtcbn1cblxuLyoqXG4gKiBHZXQgbmF2aWdhdGlvbiBzdGF0ZVxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0TmF2aWdhdGlvblN0YXRlKCk6IE5hdmlnYXRpb25TdGF0ZSB7XG4gIGNvbnN0IGRlZmF1bHRTdGF0ZTogTmF2aWdhdGlvblN0YXRlID0ge1xuICAgIGFjdGl2ZVNlY3Rpb246IG51bGwsXG4gICAgbmF2aWdhdGlvbkhpc3Rvcnk6IFtdLFxuICAgIHNlbGVjdGVkSW5ncmVkaWVudHM6IFtdLFxuICAgIHNlbGVjdGVkQ3Vpc2luZTogbnVsbCxcbiAgICBzZWxlY3RlZENvb2tpbmdNZXRob2RzOiBbXSxcbiAgICBjdXJyZW50UmVjaXBlOiBudWxsLFxuICAgIHNlbGVjdGVkSW5ncmVkaWVudENhdGVnb3J5OiBudWxsLFxuICAgIHNlbGVjdGVkSW5ncmVkaWVudDogbnVsbCxcbiAgICBzZWxlY3RlZENvb2tpbmdNZXRob2Q6IG51bGwsXG4gICAgc2Nyb2xsUG9zaXRpb246IDAsXG4gIH07XG5cbiAgY29uc3Qgc3RvcmVkID0gc2FmZUdldEl0ZW0oU1RBVEVfS0VZUy5OQVZJR0FUSU9OX1NUQVRFKTtcbiAgaWYgKCFzdG9yZWQpIHJldHVybiBkZWZhdWx0U3RhdGU7XG5cbiAgdHJ5IHtcbiAgICBjb25zdCBwYXJzZWQ6IENvbXBvbmVudFN0YXRlID0gSlNPTi5wYXJzZShzdG9yZWQpO1xuICAgIGlmICghaXNTdGF0ZVZhbGlkKHBhcnNlZC50aW1lc3RhbXApKSB7XG4gICAgICByZXR1cm4gZGVmYXVsdFN0YXRlO1xuICAgIH1cbiAgICByZXR1cm4geyAuLi5kZWZhdWx0U3RhdGUsIC4uLnBhcnNlZC5kYXRhIH07XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS53YXJuKCdGYWlsZWQgdG8gcGFyc2UgbmF2aWdhdGlvbiBzdGF0ZTonLCBlcnJvcik7XG4gICAgcmV0dXJuIGRlZmF1bHRTdGF0ZTtcbiAgfVxufVxuXG4vKipcbiAqIFNhdmUgY29tcG9uZW50LXNwZWNpZmljIHN0YXRlXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzYXZlQ29tcG9uZW50U3RhdGUoY29tcG9uZW50SWQ6IHN0cmluZywgc3RhdGU6IGFueSk6IHZvaWQge1xuICBjb25zdCBhbGxTdGF0ZXMgPSBnZXRDb21wb25lbnRTdGF0ZXMoKTtcbiAgYWxsU3RhdGVzW2NvbXBvbmVudElkXSA9IHtcbiAgICB0aW1lc3RhbXA6IERhdGUubm93KCksXG4gICAgZGF0YTogc3RhdGUsXG4gIH07XG5cbiAgc2FmZVNldEl0ZW0oU1RBVEVfS0VZUy5DT01QT05FTlRfU1RBVEVTLCBKU09OLnN0cmluZ2lmeShhbGxTdGF0ZXMpKTtcbn1cblxuLyoqXG4gKiBHZXQgY29tcG9uZW50LXNwZWNpZmljIHN0YXRlXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRDb21wb25lbnRTdGF0ZShjb21wb25lbnRJZDogc3RyaW5nKTogYW55IHtcbiAgY29uc3QgYWxsU3RhdGVzID0gZ2V0Q29tcG9uZW50U3RhdGVzKCk7XG4gIGNvbnN0IGNvbXBvbmVudFN0YXRlID0gYWxsU3RhdGVzW2NvbXBvbmVudElkXTtcblxuICBpZiAoIWNvbXBvbmVudFN0YXRlIHx8ICFpc1N0YXRlVmFsaWQoY29tcG9uZW50U3RhdGUudGltZXN0YW1wKSkge1xuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgcmV0dXJuIGNvbXBvbmVudFN0YXRlLmRhdGE7XG59XG5cbi8qKlxuICogR2V0IGFsbCBjb21wb25lbnQgc3RhdGVzXG4gKi9cbmZ1bmN0aW9uIGdldENvbXBvbmVudFN0YXRlcygpOiBSZWNvcmQ8c3RyaW5nLCBDb21wb25lbnRTdGF0ZT4ge1xuICBjb25zdCBzdG9yZWQgPSBzYWZlR2V0SXRlbShTVEFURV9LRVlTLkNPTVBPTkVOVF9TVEFURVMpO1xuICBpZiAoIXN0b3JlZCkgcmV0dXJuIHt9O1xuXG4gIHRyeSB7XG4gICAgcmV0dXJuIEpTT04ucGFyc2Uoc3RvcmVkKTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLndhcm4oJ0ZhaWxlZCB0byBwYXJzZSBjb21wb25lbnQgc3RhdGVzOicsIGVycm9yKTtcbiAgICByZXR1cm4ge307XG4gIH1cbn1cblxuLyoqXG4gKiBTYXZlIHNjcm9sbCBwb3NpdGlvbiBmb3IgYSBzcGVjaWZpYyBzZWN0aW9uXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzYXZlU2Nyb2xsUG9zaXRpb24oc2VjdGlvbklkOiBzdHJpbmcsIHBvc2l0aW9uOiBudW1iZXIpOiB2b2lkIHtcbiAgY29uc3QgcG9zaXRpb25zID0gZ2V0U2Nyb2xsUG9zaXRpb25zKCk7XG4gIHBvc2l0aW9uc1tzZWN0aW9uSWRdID0ge1xuICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICBkYXRhOiBwb3NpdGlvbixcbiAgfTtcblxuICBzYWZlU2V0SXRlbShTVEFURV9LRVlTLlNDUk9MTF9QT1NJVElPTlMsIEpTT04uc3RyaW5naWZ5KHBvc2l0aW9ucykpO1xufVxuXG4vKipcbiAqIEdldCBzY3JvbGwgcG9zaXRpb24gZm9yIGEgc3BlY2lmaWMgc2VjdGlvblxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0U2Nyb2xsUG9zaXRpb24oc2VjdGlvbklkOiBzdHJpbmcpOiBudW1iZXIge1xuICBjb25zdCBwb3NpdGlvbnMgPSBnZXRTY3JvbGxQb3NpdGlvbnMoKTtcbiAgY29uc3QgcG9zaXRpb24gPSBwb3NpdGlvbnNbc2VjdGlvbklkXTtcblxuICBpZiAoIXBvc2l0aW9uIHx8ICFpc1N0YXRlVmFsaWQocG9zaXRpb24udGltZXN0YW1wKSkge1xuICAgIHJldHVybiAwO1xuICB9XG5cbiAgcmV0dXJuIHBvc2l0aW9uLmRhdGE7XG59XG5cbi8qKlxuICogR2V0IGFsbCBzY3JvbGwgcG9zaXRpb25zXG4gKi9cbmZ1bmN0aW9uIGdldFNjcm9sbFBvc2l0aW9ucygpOiBSZWNvcmQ8c3RyaW5nLCBDb21wb25lbnRTdGF0ZT4ge1xuICBjb25zdCBzdG9yZWQgPSBzYWZlR2V0SXRlbShTVEFURV9LRVlTLlNDUk9MTF9QT1NJVElPTlMpO1xuICBpZiAoIXN0b3JlZCkgcmV0dXJuIHt9O1xuXG4gIHRyeSB7XG4gICAgcmV0dXJuIEpTT04ucGFyc2Uoc3RvcmVkKTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLndhcm4oJ0ZhaWxlZCB0byBwYXJzZSBzY3JvbGwgcG9zaXRpb25zOicsIGVycm9yKTtcbiAgICByZXR1cm4ge307XG4gIH1cbn1cblxuLyoqXG4gKiBDbGVhciBhbGwgc3RvcmVkIHN0YXRlICh1c2VmdWwgZm9yIGNsZWFudXApXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjbGVhckFsbFN0YXRlKCk6IHZvaWQge1xuICBPYmplY3QudmFsdWVzKFNUQVRFX0tFWVMpLmZvckVhY2goa2V5ID0+IHtcbiAgICB0cnkge1xuICAgICAgc2Vzc2lvblN0b3JhZ2UucmVtb3ZlSXRlbShrZXkpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLndhcm4oYEZhaWxlZCB0byByZW1vdmUgaXRlbSBmcm9tIHNlc3Npb25TdG9yYWdlOiAke2tleX1gLCBlcnJvcik7XG4gICAgfVxuICB9KTtcbn1cblxuLyoqXG4gKiBDbGVhciBleHBpcmVkIHN0YXRlIGVudHJpZXNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNsZWFyRXhwaXJlZFN0YXRlKCk6IHZvaWQge1xuICAvLyBDbGVhciBleHBpcmVkIG5hdmlnYXRpb24gc3RhdGVcbiAgY29uc3QgbmF2U3RhdGUgPSBzYWZlR2V0SXRlbShTVEFURV9LRVlTLk5BVklHQVRJT05fU1RBVEUpO1xuICBpZiAobmF2U3RhdGUpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcGFyc2VkOiBDb21wb25lbnRTdGF0ZSA9IEpTT04ucGFyc2UobmF2U3RhdGUpO1xuICAgICAgaWYgKCFpc1N0YXRlVmFsaWQocGFyc2VkLnRpbWVzdGFtcCkpIHtcbiAgICAgICAgc2Vzc2lvblN0b3JhZ2UucmVtb3ZlSXRlbShTVEFURV9LRVlTLk5BVklHQVRJT05fU1RBVEUpO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBzZXNzaW9uU3RvcmFnZS5yZW1vdmVJdGVtKFNUQVRFX0tFWVMuTkFWSUdBVElPTl9TVEFURSk7XG4gICAgfVxuICB9XG5cbiAgLy8gQ2xlYXIgZXhwaXJlZCBjb21wb25lbnQgc3RhdGVzXG4gIGNvbnN0IGNvbXBvbmVudFN0YXRlcyA9IGdldENvbXBvbmVudFN0YXRlcygpO1xuICBjb25zdCB2YWxpZFN0YXRlczogUmVjb3JkPHN0cmluZywgQ29tcG9uZW50U3RhdGU+ID0ge307XG4gIGxldCBoYXNDaGFuZ2VzID0gZmFsc2U7XG5cbiAgT2JqZWN0LmVudHJpZXMoY29tcG9uZW50U3RhdGVzKS5mb3JFYWNoKChba2V5LCBzdGF0ZV0pID0+IHtcbiAgICBpZiAoaXNTdGF0ZVZhbGlkKHN0YXRlLnRpbWVzdGFtcCkpIHtcbiAgICAgIHZhbGlkU3RhdGVzW2tleV0gPSBzdGF0ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgaGFzQ2hhbmdlcyA9IHRydWU7XG4gICAgfVxuICB9KTtcblxuICBpZiAoaGFzQ2hhbmdlcykge1xuICAgIHNhZmVTZXRJdGVtKFNUQVRFX0tFWVMuQ09NUE9ORU5UX1NUQVRFUywgSlNPTi5zdHJpbmdpZnkodmFsaWRTdGF0ZXMpKTtcbiAgfVxuXG4gIC8vIENsZWFyIGV4cGlyZWQgc2Nyb2xsIHBvc2l0aW9uc1xuICBjb25zdCBzY3JvbGxQb3NpdGlvbnMgPSBnZXRTY3JvbGxQb3NpdGlvbnMoKTtcbiAgY29uc3QgdmFsaWRQb3NpdGlvbnM6IFJlY29yZDxzdHJpbmcsIENvbXBvbmVudFN0YXRlPiA9IHt9O1xuICBoYXNDaGFuZ2VzID0gZmFsc2U7XG5cbiAgT2JqZWN0LmVudHJpZXMoc2Nyb2xsUG9zaXRpb25zKS5mb3JFYWNoKChba2V5LCBwb3NpdGlvbl0pID0+IHtcbiAgICBpZiAoaXNTdGF0ZVZhbGlkKHBvc2l0aW9uLnRpbWVzdGFtcCkpIHtcbiAgICAgIHZhbGlkUG9zaXRpb25zW2tleV0gPSBwb3NpdGlvbjtcbiAgICB9IGVsc2Uge1xuICAgICAgaGFzQ2hhbmdlcyA9IHRydWU7XG4gICAgfVxuICB9KTtcblxuICBpZiAoaGFzQ2hhbmdlcykge1xuICAgIHNhZmVTZXRJdGVtKFNUQVRFX0tFWVMuU0NST0xMX1BPU0lUSU9OUywgSlNPTi5zdHJpbmdpZnkodmFsaWRQb3NpdGlvbnMpKTtcbiAgfVxufVxuXG4vKipcbiAqIEhvb2sgZm9yIGF1dG9tYXRpYyBzdGF0ZSBjbGVhbnVwIG9uIHBhZ2UgbG9hZFxuICovXG5leHBvcnQgZnVuY3Rpb24gdXNlU3RhdGVDbGVhbnVwKCk6IHZvaWQge1xuICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAvLyBDbGVhciBleHBpcmVkIHN0YXRlIG9uIHBhZ2UgbG9hZFxuICAgIGNsZWFyRXhwaXJlZFN0YXRlKCk7XG5cbiAgICAvLyBTZXQgdXAgcGVyaW9kaWMgY2xlYW51cCAoZXZlcnkgMTAgbWludXRlcylcbiAgICBjb25zdCBpbnRlcnZhbCA9IHNldEludGVydmFsKGNsZWFyRXhwaXJlZFN0YXRlLCAxMCAqIDYwICogMTAwMCk7XG5cbiAgICAvLyBDbGVhbnVwIG9uIHBhZ2UgdW5sb2FkXG4gICAgY29uc3QgY2xlYW51cCA9ICgpID0+IHtcbiAgICAgIGNsZWFySW50ZXJ2YWwoaW50ZXJ2YWwpO1xuICAgICAgY2xlYXJFeHBpcmVkU3RhdGUoKTtcbiAgICB9O1xuXG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2JlZm9yZXVubG9hZCcsIGNsZWFudXApO1xuXG4gICAgLy8gUmV0dXJuIGNsZWFudXAgZnVuY3Rpb25cbiAgICByZXR1cm4gY2xlYW51cDtcbiAgfVxufVxuXG4vKipcbiAqIENyZWF0ZSBhIHN0YXRlIHByZXNlcnZhdGlvbiBob29rIGZvciBjb21wb25lbnRzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVTdGF0ZVByZXNlcnZhdGlvbkhvb2soY29tcG9uZW50SWQ6IHN0cmluZykge1xuICByZXR1cm4ge1xuICAgIHNhdmVTdGF0ZTogKHN0YXRlOiBhbnkpID0+IHNhdmVDb21wb25lbnRTdGF0ZShjb21wb25lbnRJZCwgc3RhdGUpLFxuICAgIGdldFN0YXRlOiAoKSA9PiBnZXRDb21wb25lbnRTdGF0ZShjb21wb25lbnRJZCksXG4gICAgY2xlYXJTdGF0ZTogKCkgPT4ge1xuICAgICAgY29uc3QgYWxsU3RhdGVzID0gZ2V0Q29tcG9uZW50U3RhdGVzKCk7XG4gICAgICBkZWxldGUgYWxsU3RhdGVzW2NvbXBvbmVudElkXTtcbiAgICAgIHNhZmVTZXRJdGVtKFNUQVRFX0tFWVMuQ09NUE9ORU5UX1NUQVRFUywgSlNPTi5zdHJpbmdpZnkoYWxsU3RhdGVzKSk7XG4gICAgfSxcbiAgfTtcbn1cbiJdLCJ2ZXJzaW9uIjozfQ==