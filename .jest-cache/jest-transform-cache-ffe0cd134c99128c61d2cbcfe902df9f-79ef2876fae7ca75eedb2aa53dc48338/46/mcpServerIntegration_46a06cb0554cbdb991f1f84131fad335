c6552ee4b0113e6bd4bb3aad72a30d94
"use strict";
/**
 * MCP Server Integration for Reliable External APIs
 *
 * This module implements Model Context Protocol (MCP) server integration for:
 * - Astrological API connections with NASA JPL Horizons fallback
 * - Nutritional database access with USDA API integration
 * - Recipe API connections with rate limiting and caching
 * - Multi-tier fallback strategy for API reliability
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.useMCPServerIntegration = exports.getMCPServerIntegration = exports.MCPServerIntegration = void 0;
const logger_1 = require("@/utils/logger");
// Default MCP server configurations based on steering file examples
const DEFAULT_MCP_SERVERS = {
    'nasa-horizons': {
        name: 'nasa-horizons',
        command: 'uvx',
        args: ['nasa-horizons-mcp-server@latest'],
        env: {
            FASTMCP_LOG_LEVEL: 'ERROR',
            NASA_API_KEY: process.env.NASA_API_KEY || ''
        },
        disabled: false,
        autoApprove: ['get_planetary_positions', 'get_ephemeris_data'],
        timeout: 10000,
        retryAttempts: 3,
        fallbackEnabled: true
    },
    'usda-nutrition': {
        name: 'usda-nutrition',
        command: 'uvx',
        args: ['usda-nutrition-mcp-server@latest'],
        env: {
            FASTMCP_LOG_LEVEL: 'ERROR',
            USDA_API_KEY: process.env.USDA_API_KEY || ''
        },
        disabled: false,
        autoApprove: ['get_nutrition_data', 'search_ingredients'],
        timeout: 8000,
        retryAttempts: 2,
        fallbackEnabled: true
    },
    'spoonacular-recipes': {
        name: 'spoonacular-recipes',
        command: 'uvx',
        args: ['spoonacular-mcp-server@latest'],
        env: {
            FASTMCP_LOG_LEVEL: 'ERROR',
            SPOONACULAR_API_KEY: process.env.SPOONACULAR_API_KEY || ''
        },
        disabled: false,
        autoApprove: ['search_recipes', 'get_recipe_details'],
        timeout: 6000,
        retryAttempts: 2,
        fallbackEnabled: true
    }
};
// Rate limiting configurations
const RATE_LIMITS = {
    'nasa-horizons': {
        requestsPerMinute: 60,
        requestsPerHour: 1000,
        requestsPerDay: 10000,
        burstLimit: 10
    },
    'usda-nutrition': {
        requestsPerMinute: 30,
        requestsPerHour: 500,
        requestsPerDay: 5000,
        burstLimit: 5
    },
    'spoonacular-recipes': {
        requestsPerMinute: 10,
        requestsPerHour: 150,
        requestsPerDay: 150,
        burstLimit: 3
    }
};
/**
 * MCP Server Integration Manager
 */
class MCPServerIntegration {
    static instance;
    servers = new Map();
    cache = new Map();
    rateLimiters = new Map();
    connectionStatus = new Map();
    constructor() {
        this.initializeServers();
        this.initializeRateLimiters();
        this.startHealthChecks();
    }
    static getInstance() {
        if (!MCPServerIntegration.instance) {
            MCPServerIntegration.instance = new MCPServerIntegration();
        }
        return MCPServerIntegration.instance;
    }
    /**
     * Astrological API connections with NASA JPL Horizons fallback
     */
    async getAstrologicalData(date = new Date()) {
        const cacheKey = `astrological_${date.toISOString().split('T')[0]}`;
        // Check cache first
        const cached = this.getFromCache(cacheKey);
        if (cached) {
            return {
                success: true,
                data: cached.data,
                source: 'cache',
                responseTime: 0,
                timestamp: Date.now()
            };
        }
        // Primary: NASA Horizons MCP server
        try {
            const result = await this.callMCPServer('nasa-horizons', 'get_planetary_positions', { date });
            if (result.success) {
                this.setCache(cacheKey, result.data, 6 * 60 * 60 * 1000); // 6 hours TTL
                return { ...result, source: 'primary' };
            }
        }
        catch (error) {
            logger_1.logger.warn('NASA Horizons MCP server failed:', error);
        }
        // Secondary: Direct NASA API call
        try {
            const result = await this.callDirectNASAAPI(date);
            if (result.success) {
                this.setCache(cacheKey, result.data, 6 * 60 * 60 * 1000);
                return { ...result, source: 'secondary' };
            }
        }
        catch (error) {
            logger_1.logger.warn('Direct NASA API failed:', error);
        }
        // Fallback: Local ephemeris data
        try {
            const fallbackData = await this.getFallbackAstrologicalData(date);
            return {
                success: true,
                data: fallbackData,
                source: 'fallback',
                responseTime: 0,
                timestamp: Date.now()
            };
        }
        catch (error) {
            logger_1.logger.error('All astrological data sources failed:', error);
            return {
                success: false,
                error: 'All astrological data sources unavailable',
                source: 'fallback',
                responseTime: 0,
                timestamp: Date.now()
            };
        }
    }
    /**
     * Nutritional database access with USDA API integration
     */
    async getNutritionalData(ingredient) {
        const cacheKey = `nutrition_${ingredient.toLowerCase().replace(/\s+/g, '_')}`;
        // Check cache first
        const cached = this.getFromCache(cacheKey);
        if (cached) {
            return {
                success: true,
                data: cached.data,
                source: 'cache',
                responseTime: 0,
                timestamp: Date.now()
            };
        }
        // Check rate limits
        if (!this.checkRateLimit('usda-nutrition')) {
            logger_1.logger.warn('USDA nutrition API rate limit exceeded');
            return this.getRateLimitedResponse();
        }
        // Primary: USDA Nutrition MCP server
        try {
            const result = await this.callMCPServer('usda-nutrition', 'get_nutrition_data', { ingredient });
            if (result.success) {
                this.setCache(cacheKey, result.data, 24 * 60 * 60 * 1000); // 24 hours TTL
                return { ...result, source: 'primary' };
            }
        }
        catch (error) {
            logger_1.logger.warn('USDA Nutrition MCP server failed:', error);
        }
        // Secondary: Direct USDA API call
        try {
            const result = await this.callDirectUSDAAPI(ingredient);
            if (result.success) {
                this.setCache(cacheKey, result.data, 24 * 60 * 60 * 1000);
                return { ...result, source: 'secondary' };
            }
        }
        catch (error) {
            logger_1.logger.warn('Direct USDA API failed:', error);
        }
        // Fallback: Local nutrition database
        try {
            const fallbackData = await this.getFallbackNutritionalData(ingredient);
            return {
                success: true,
                data: fallbackData,
                source: 'fallback',
                responseTime: 0,
                timestamp: Date.now()
            };
        }
        catch (error) {
            logger_1.logger.error('All nutritional data sources failed:', error);
            return {
                success: false,
                error: 'Nutritional data unavailable',
                source: 'fallback',
                responseTime: 0,
                timestamp: Date.now()
            };
        }
    }
    /**
     * Recipe API connections with rate limiting and caching
     */
    async getRecipeData(query, options = {}) {
        const cacheKey = `recipes_${query.toLowerCase().replace(/\s+/g, '_')}_${JSON.stringify(options)}`;
        // Check cache first
        const cached = this.getFromCache(cacheKey);
        if (cached) {
            return {
                success: true,
                data: cached.data,
                source: 'cache',
                responseTime: 0,
                timestamp: Date.now()
            };
        }
        // Check rate limits (Spoonacular has strict daily limits)
        if (!this.checkRateLimit('spoonacular-recipes')) {
            logger_1.logger.warn('Spoonacular recipe API rate limit exceeded');
            return this.getRateLimitedResponse();
        }
        // Primary: Spoonacular MCP server
        try {
            const result = await this.callMCPServer('spoonacular-recipes', 'search_recipes', { query, ...options });
            if (result.success) {
                this.setCache(cacheKey, result.data, 12 * 60 * 60 * 1000); // 12 hours TTL
                return { ...result, source: 'primary' };
            }
        }
        catch (error) {
            logger_1.logger.warn('Spoonacular MCP server failed:', error);
        }
        // Secondary: Direct Spoonacular API call
        try {
            const result = await this.callDirectSpoonacularAPI(query, options);
            if (result.success) {
                this.setCache(cacheKey, result.data, 12 * 60 * 60 * 1000);
                return { ...result, source: 'secondary' };
            }
        }
        catch (error) {
            logger_1.logger.warn('Direct Spoonacular API failed:', error);
        }
        // Fallback: Local recipe database
        try {
            const fallbackData = await this.getFallbackRecipeData(query, options);
            return {
                success: true,
                data: fallbackData,
                source: 'fallback',
                responseTime: 0,
                timestamp: Date.now()
            };
        }
        catch (error) {
            logger_1.logger.error('All recipe data sources failed:', error);
            return {
                success: false,
                error: 'Recipe data unavailable',
                source: 'fallback',
                responseTime: 0,
                timestamp: Date.now()
            };
        }
    }
    /**
     * Test multi-tier fallback strategy
     */
    async testFallbackStrategy() {
        logger_1.logger.info('Testing MCP server fallback strategy...');
        const results = await Promise.allSettled([
            this.getAstrologicalData(),
            this.getNutritionalData('apple'),
            this.getRecipeData('pasta')
        ]);
        const astrological = results[0].status === 'fulfilled' ? results[0].value : this.createErrorResponse('Astrological test failed');
        const nutritional = results[1].status === 'fulfilled' ? results[1].value : this.createErrorResponse('Nutritional test failed');
        const recipes = results[2].status === 'fulfilled' ? results[2].value : this.createErrorResponse('Recipe test failed');
        const successCount = [astrological, nutritional, recipes].filter(r => r.success).length;
        const overallReliability = successCount / 3;
        logger_1.logger.info('Fallback strategy test completed', {
            astrological: astrological.success ? astrological.source : 'failed',
            nutritional: nutritional.success ? nutritional.source : 'failed',
            recipes: recipes.success ? recipes.source : 'failed',
            overallReliability
        });
        return { astrological, nutritional, recipes, overallReliability };
    }
    /**
     * Get server connection status
     */
    getServerStatus() {
        const status = {};
        for (const [name, config] of this.servers) {
            status[name] = {
                connected: this.connectionStatus.get(name) || false,
                lastCheck: Date.now(),
                responseTime: 0,
                errorCount: 0 // Would be tracked in real implementation
            };
        }
        return status;
    }
    // Private helper methods
    initializeServers() {
        Object.values(DEFAULT_MCP_SERVERS).forEach(config => {
            if (!config.disabled) {
                this.servers.set(config.name, config);
                this.connectionStatus.set(config.name, false);
            }
        });
        logger_1.logger.info('MCP servers initialized:', Array.from(this.servers.keys()));
    }
    initializeRateLimiters() {
        Object.entries(RATE_LIMITS).forEach(([serverName, config]) => {
            this.rateLimiters.set(serverName, new RateLimiter(config));
        });
        logger_1.logger.info('Rate limiters initialized for MCP servers');
    }
    startHealthChecks() {
        // Check server health every 5 minutes
        setInterval(async () => {
            for (const [name, config] of this.servers) {
                try {
                    const isHealthy = await this.checkServerHealth(name);
                    this.connectionStatus.set(name, isHealthy);
                }
                catch (error) {
                    logger_1.logger.warn(`Health check failed for MCP server ${name}:`, error);
                    this.connectionStatus.set(name, false);
                }
            }
        }, 5 * 60 * 1000);
    }
    async callMCPServer(serverName, method, params) {
        const config = this.servers.get(serverName);
        if (!config) {
            throw new Error(`MCP server ${serverName} not configured`);
        }
        const startTime = performance.now();
        try {
            // In a real implementation, this would use the actual MCP protocol
            // For now, we simulate the MCP server call
            const result = await this.simulateMCPCall(serverName, method, params);
            const responseTime = performance.now() - startTime;
            return {
                success: true,
                data: result,
                source: 'primary',
                responseTime,
                timestamp: Date.now()
            };
        }
        catch (error) {
            const responseTime = performance.now() - startTime;
            logger_1.logger.error(`MCP server ${serverName} call failed:`, error);
            return {
                success: false,
                error: error instanceof Error ? error.message : 'Unknown error',
                source: 'primary',
                responseTime,
                timestamp: Date.now()
            };
        }
    }
    async simulateMCPCall(serverName, method, params) {
        // Simulate MCP server calls for demonstration
        await new Promise(resolve => setTimeout(resolve, Math.random() * 1000 + 500)); // 500-1500ms delay
        switch (serverName) {
            case 'nasa-horizons':
                if (method === 'get_planetary_positions') {
                    return this.generateMockPlanetaryData(params.date);
                }
                break;
            case 'usda-nutrition':
                if (method === 'get_nutrition_data') {
                    return this.generateMockNutritionalData(params.ingredient);
                }
                break;
            case 'spoonacular-recipes':
                if (method === 'search_recipes') {
                    return this.generateMockRecipeData(params.query, params);
                }
                break;
        }
        throw new Error(`Unknown method ${method} for server ${serverName}`);
    }
    async checkServerHealth(serverName) {
        try {
            // In a real implementation, this would ping the MCP server
            // For now, simulate health check
            await new Promise(resolve => setTimeout(resolve, 100));
            return Math.random() > 0.1; // 90% uptime simulation
        }
        catch (error) {
            return false;
        }
    }
    checkRateLimit(serverName) {
        const rateLimiter = this.rateLimiters.get(serverName);
        return rateLimiter ? rateLimiter.checkLimit() : true;
    }
    getFromCache(key) {
        const entry = this.cache.get(key);
        if (!entry)
            return null;
        if (Date.now() - entry.timestamp > entry.ttl) {
            this.cache.delete(key);
            return null;
        }
        return entry;
    }
    setCache(key, data, ttl) {
        this.cache.set(key, {
            data,
            timestamp: Date.now(),
            ttl,
            source: 'cache'
        });
    }
    getRateLimitedResponse() {
        return {
            success: false,
            error: 'Rate limit exceeded',
            source: 'primary',
            responseTime: 0,
            timestamp: Date.now()
        };
    }
    createErrorResponse(error) {
        return {
            success: false,
            error,
            source: 'fallback',
            responseTime: 0,
            timestamp: Date.now()
        };
    }
    // Direct API call methods (fallback implementations)
    async callDirectNASAAPI(date) {
        // Simulate direct NASA API call
        await new Promise(resolve => setTimeout(resolve, 2000));
        return {
            success: true,
            data: this.generateMockPlanetaryData(date),
            source: 'secondary',
            responseTime: 2000,
            timestamp: Date.now()
        };
    }
    async callDirectUSDAAPI(ingredient) {
        // Simulate direct USDA API call
        await new Promise(resolve => setTimeout(resolve, 1500));
        return {
            success: true,
            data: this.generateMockNutritionalData(ingredient),
            source: 'secondary',
            responseTime: 1500,
            timestamp: Date.now()
        };
    }
    async callDirectSpoonacularAPI(query, options) {
        // Simulate direct Spoonacular API call
        await new Promise(resolve => setTimeout(resolve, 1000));
        return {
            success: true,
            data: this.generateMockRecipeData(query, options),
            source: 'secondary',
            responseTime: 1000,
            timestamp: Date.now()
        };
    }
    // Fallback data methods
    async getFallbackAstrologicalData(date) {
        // Return hardcoded reliable positions from March 2025
        return {
            sun: { sign: 'aries', degree: 8.5, exactLongitude: 8.5, isRetrograde: false },
            moon: { sign: 'aries', degree: 1.57, exactLongitude: 1.57, isRetrograde: false },
            mercury: { sign: 'aries', degree: 0.85, exactLongitude: 0.85, isRetrograde: true },
            venus: { sign: 'pisces', degree: 29.08, exactLongitude: 359.08, isRetrograde: true },
            mars: { sign: 'cancer', degree: 22.63, exactLongitude: 112.63, isRetrograde: false },
            jupiter: { sign: 'gemini', degree: 15.52, exactLongitude: 75.52, isRetrograde: false },
            saturn: { sign: 'pisces', degree: 24.12, exactLongitude: 354.12, isRetrograde: false }
        };
    }
    async getFallbackNutritionalData(ingredient) {
        // Return basic nutritional data from local database
        return {
            name: ingredient,
            calories: 50,
            protein: 1,
            carbs: 12,
            fat: 0.2,
            fiber: 2,
            vitamins: ['C', 'K'],
            minerals: ['potassium', 'folate']
        };
    }
    async getFallbackRecipeData(query, options) {
        // Return basic recipe suggestions from local database
        return {
            recipes: [
                {
                    id: 1,
                    title: `Simple ${query}`,
                    readyInMinutes: 30,
                    servings: 4,
                    image: 'placeholder.jpg',
                    summary: `A simple and delicious ${query} recipe.`
                }
            ],
            totalResults: 1
        };
    }
    // Mock data generators for simulation
    generateMockPlanetaryData(date) {
        return {
            date: date.toISOString(),
            planets: {
                sun: { sign: 'aries', degree: 8.5 + Math.random() * 2 },
                moon: { sign: 'aries', degree: 1.57 + Math.random() * 5 },
                mercury: { sign: 'aries', degree: 0.85 + Math.random() * 3 }
            }
        };
    }
    generateMockNutritionalData(ingredient) {
        return {
            name: ingredient,
            fdcId: Math.floor(Math.random() * 100000),
            calories: Math.floor(Math.random() * 200) + 20,
            nutrients: {
                protein: Math.floor(Math.random() * 20) + 1,
                carbs: Math.floor(Math.random() * 50) + 5,
                fat: Math.floor(Math.random() * 15) + 0.1
            }
        };
    }
    generateMockRecipeData(query, options) {
        return {
            results: Array.from({ length: options.maxResults || 5 }, (_, i) => ({
                id: i + 1,
                title: `${query} Recipe ${i + 1}`,
                readyInMinutes: Math.floor(Math.random() * 60) + 15,
                servings: Math.floor(Math.random() * 6) + 2,
                cuisine: options.cuisine || 'international'
            })),
            totalResults: options.maxResults || 5
        };
    }
}
exports.MCPServerIntegration = MCPServerIntegration;
/**
 * Simple rate limiter implementation
 */
class RateLimiter {
    requests = [];
    config;
    constructor(config) {
        this.config = config;
    }
    checkLimit() {
        const now = Date.now();
        // Clean old requests
        this.requests = this.requests.filter(time => now - time < 60000); // Keep last minute
        // Check minute limit
        if (this.requests.length >= this.config.requestsPerMinute) {
            return false;
        }
        // Add current request
        this.requests.push(now);
        return true;
    }
}
/**
 * Convenience function to get MCP server integration instance
 */
function getMCPServerIntegration() {
    return MCPServerIntegration.getInstance();
}
exports.getMCPServerIntegration = getMCPServerIntegration;
/**
 * Hook for components to use MCP server integration
 */
function useMCPServerIntegration() {
    const mcp = getMCPServerIntegration();
    return {
        getAstrologicalData: (date) => mcp.getAstrologicalData(date),
        getNutritionalData: (ingredient) => mcp.getNutritionalData(ingredient),
        getRecipeData: (query, options) => mcp.getRecipeData(query, options),
        testFallbackStrategy: () => mcp.testFallbackStrategy(),
        getServerStatus: () => mcp.getServerStatus()
    };
}
exports.useMCPServerIntegration = useMCPServerIntegration;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy91dGlscy9tY3BTZXJ2ZXJJbnRlZ3JhdGlvbi50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7Ozs7O0dBUUc7OztBQUVILDJDQUF3QztBQXNDeEMsb0VBQW9FO0FBQ3BFLE1BQU0sbUJBQW1CLEdBQW9DO0lBQzNELGVBQWUsRUFBRTtRQUNmLElBQUksRUFBRSxlQUFlO1FBQ3JCLE9BQU8sRUFBRSxLQUFLO1FBQ2QsSUFBSSxFQUFFLENBQUMsaUNBQWlDLENBQUM7UUFDekMsR0FBRyxFQUFFO1lBQ0gsaUJBQWlCLEVBQUUsT0FBTztZQUMxQixZQUFZLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxZQUFZLElBQUksRUFBRTtTQUM3QztRQUNELFFBQVEsRUFBRSxLQUFLO1FBQ2YsV0FBVyxFQUFFLENBQUMseUJBQXlCLEVBQUUsb0JBQW9CLENBQUM7UUFDOUQsT0FBTyxFQUFFLEtBQUs7UUFDZCxhQUFhLEVBQUUsQ0FBQztRQUNoQixlQUFlLEVBQUUsSUFBSTtLQUN0QjtJQUNELGdCQUFnQixFQUFFO1FBQ2hCLElBQUksRUFBRSxnQkFBZ0I7UUFDdEIsT0FBTyxFQUFFLEtBQUs7UUFDZCxJQUFJLEVBQUUsQ0FBQyxrQ0FBa0MsQ0FBQztRQUMxQyxHQUFHLEVBQUU7WUFDSCxpQkFBaUIsRUFBRSxPQUFPO1lBQzFCLFlBQVksRUFBRSxPQUFPLENBQUMsR0FBRyxDQUFDLFlBQVksSUFBSSxFQUFFO1NBQzdDO1FBQ0QsUUFBUSxFQUFFLEtBQUs7UUFDZixXQUFXLEVBQUUsQ0FBQyxvQkFBb0IsRUFBRSxvQkFBb0IsQ0FBQztRQUN6RCxPQUFPLEVBQUUsSUFBSTtRQUNiLGFBQWEsRUFBRSxDQUFDO1FBQ2hCLGVBQWUsRUFBRSxJQUFJO0tBQ3RCO0lBQ0QscUJBQXFCLEVBQUU7UUFDckIsSUFBSSxFQUFFLHFCQUFxQjtRQUMzQixPQUFPLEVBQUUsS0FBSztRQUNkLElBQUksRUFBRSxDQUFDLCtCQUErQixDQUFDO1FBQ3ZD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S0FBSyxDQUFDO1NBQ2Q7UUFFRCxzQkFBc0I7UUFDdEIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDeEIsT0FBTyxJQUFJLENBQUM7SUFDZCxDQUFDO0NBQ0Y7QUFFRDs7R0FFRztBQUNILFNBQWdCLHVCQUF1QjtJQUNyQyxPQUFPLG9CQUFvQixDQUFDLFdBQVcsRUFBRSxDQUFDO0FBQzVDLENBQUM7QUFGRCwwREFFQztBQUVEOztHQUVHO0FBQ0gsU0FBZ0IsdUJBQXVCO0lBQ3JDLE1BQU0sR0FBRyxHQUFHLHVCQUF1QixFQUFFLENBQUM7SUFFdEMsT0FBTztRQUNMLG1CQUFtQixFQUFFLENBQUMsSUFBVyxFQUFFLEVBQUUsQ0FBQyxHQUFHLENBQUMsbUJBQW1CLENBQUMsSUFBSSxDQUFDO1FBQ25FLGtCQUFrQixFQUFFLENBQUMsVUFBa0IsRUFBRSxFQUFFLENBQUMsR0FBRyxDQUFDLGtCQUFrQixDQUFDLFVBQVUsQ0FBQztRQUM5RSxhQUFhLEVBQUUsQ0FBQyxLQUFhLEVBQUUsT0FBYSxFQUFFLEVBQUUsQ0FBQyxHQUFHLENBQUMsYUFBYSxDQUFDLEtBQUssRUFBRSxPQUFPLENBQUM7UUFDbEYsb0JBQW9CLEVBQUUsR0FBRyxFQUFFLENBQUMsR0FBRyxDQUFDLG9CQUFvQixFQUFFO1FBQ3RELGVBQWUsRUFBRSxHQUFHLEVBQUUsQ0FBQyxHQUFHLENBQUMsZUFBZSxFQUFFO0tBQzdDLENBQUM7QUFDSixDQUFDO0FBVkQsMERBVUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy91dGlscy9tY3BTZXJ2ZXJJbnRlZ3JhdGlvbi50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIE1DUCBTZXJ2ZXIgSW50ZWdyYXRpb24gZm9yIFJlbGlhYmxlIEV4dGVybmFsIEFQSXNcbiAqIFxuICogVGhpcyBtb2R1bGUgaW1wbGVtZW50cyBNb2RlbCBDb250ZXh0IFByb3RvY29sIChNQ1ApIHNlcnZlciBpbnRlZ3JhdGlvbiBmb3I6XG4gKiAtIEFzdHJvbG9naWNhbCBBUEkgY29ubmVjdGlvbnMgd2l0aCBOQVNBIEpQTCBIb3Jpem9ucyBmYWxsYmFja1xuICogLSBOdXRyaXRpb25hbCBkYXRhYmFzZSBhY2Nlc3Mgd2l0aCBVU0RBIEFQSSBpbnRlZ3JhdGlvblxuICogLSBSZWNpcGUgQVBJIGNvbm5lY3Rpb25zIHdpdGggcmF0ZSBsaW1pdGluZyBhbmQgY2FjaGluZ1xuICogLSBNdWx0aS10aWVyIGZhbGxiYWNrIHN0cmF0ZWd5IGZvciBBUEkgcmVsaWFiaWxpdHlcbiAqL1xuXG5pbXBvcnQgeyBsb2dnZXIgfSBmcm9tICdAL3V0aWxzL2xvZ2dlcic7XG5cbi8vIE1DUCBTZXJ2ZXIgQ29uZmlndXJhdGlvbiBmcm9tIHN0ZWVyaW5nIGZpbGVzXG5leHBvcnQgaW50ZXJmYWNlIE1DUFNlcnZlckNvbmZpZyB7XG4gIG5hbWU6IHN0cmluZztcbiAgY29tbWFuZDogc3RyaW5nO1xuICBhcmdzOiBzdHJpbmdbXTtcbiAgZW52PzogUmVjb3JkPHN0cmluZywgc3RyaW5nPjtcbiAgZGlzYWJsZWQ6IGJvb2xlYW47XG4gIGF1dG9BcHByb3ZlOiBzdHJpbmdbXTtcbiAgdGltZW91dDogbnVtYmVyO1xuICByZXRyeUF0dGVtcHRzOiBudW1iZXI7XG4gIGZhbGxiYWNrRW5hYmxlZDogYm9vbGVhbjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBNQ1BBcGlSZXNwb25zZTxUID0gYW55PiB7XG4gIHN1Y2Nlc3M6IGJvb2xlYW47XG4gIGRhdGE/OiBUO1xuICBlcnJvcj86IHN0cmluZztcbiAgc291cmNlOiAncHJpbWFyeScgfCAnc2Vjb25kYXJ5JyB8ICdmYWxsYmFjaycgfCAnY2FjaGUnO1xuICByZXNwb25zZVRpbWU6IG51bWJlcjtcbiAgdGltZXN0YW1wOiBudW1iZXI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgTUNQQ2FjaGVFbnRyeTxUID0gYW55PiB7XG4gIGRhdGE6IFQ7XG4gIHRpbWVzdGFtcDogbnVtYmVyO1xuICB0dGw6IG51bWJlcjtcbiAgc291cmNlOiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgTUNQUmF0ZUxpbWl0Q29uZmlnIHtcbiAgcmVxdWVzdHNQZXJNaW51dGU6IG51bWJlcjtcbiAgcmVxdWVzdHNQZXJIb3VyOiBudW1iZXI7XG4gIHJlcXVlc3RzUGVyRGF5OiBudW1iZXI7XG4gIGJ1cnN0TGltaXQ6IG51bWJlcjtcbn1cblxuLy8gRGVmYXVsdCBNQ1Agc2VydmVyIGNvbmZpZ3VyYXRpb25zIGJhc2VkIG9uIHN0ZWVyaW5nIGZpbGUgZXhhbXBsZXNcbmNvbnN0IERFRkFVTFRfTUNQX1NFUlZFUlM6IFJlY29yZDxzdHJpbmcsIE1DUFNlcnZlckNvbmZpZz4gPSB7XG4gICduYXNhLWhvcml6b25zJzoge1xuICAgIG5hbWU6ICduYXNhLWhvcml6b25zJyxcbiAgICBjb21tYW5kOiAndXZ4JyxcbiAgICBhcmdzOiBbJ25hc2EtaG9yaXpvbnMtbWNwLXNlcnZlckBsYXRlc3QnXSxcbiAgICBlbnY6IHtcbiAgICAgIEZBU1RNQ1BfTE9HX0xFVkVMOiAnRVJST1InLFxuICAgICAgTkFTQV9BUElfS0VZOiBwcm9jZXNzLmVudi5OQVNBX0FQSV9LRVkgfHwgJydcbiAgICB9LFxuICAgIGRpc2FibGVkOiBmYWxzZSxcbiAgICBhdXRvQXBwcm92ZTogWydnZXRfcGxhbmV0YXJ5X3Bvc2l0aW9ucycsICdnZXRfZXBoZW1lcmlzX2RhdGEnXSxcbiAgICB0aW1lb3V0OiAxMDAwMCxcbiAgICByZXRyeUF0dGVtcHRzOiAzLFxuICAgIGZhbGxiYWNrRW5hYmxlZDogdHJ1ZVxuICB9LFxuICAndXNkYS1udXRyaXRpb24nOiB7XG4gICAgbmFtZTogJ3VzZGEtbnV0cml0aW9uJyxcbiAgICBjb21tYW5kOiAndXZ4JyxcbiAgICBhcmdzOiBbJ3VzZGEtbnV0cml0aW9uLW1jcC1zZXJ2ZXJAbGF0ZXN0J10sXG4gICAgZW52OiB7XG4gICAgICBGQVNUTUNQX0xPR19MRVZFTDogJ0VSUk9SJyxcbiAgICAgIFVTREFfQVBJX0tFWTogcHJvY2Vzcy5lbnYuVVNEQV9BUElfS0VZIHx8ICcnXG4gICAgfSxcbiAgICBkaXNhYmxlZDogZmFsc2UsXG4gICAgYXV0b0FwcHJvdmU6IFsnZ2V0X251dHJpdGlvbl9kYXRhJywgJ3NlYXJjaF9pbmdyZWRpZW50cyddLFxuICAgIHRpbWVvdXQ6IDgwMDAsXG4gICAgcmV0cnlBdHRlbXB0czogMixcbiAgICBmYWxsYmFja0VuYWJsZWQ6IHRydWVcbiAgfSxcbiAgJ3Nwb29uYWN1bGFyLXJlY2lwZXMnOiB7XG4gICAgbmFtZTogJ3Nwb29uYWN1bGFyLXJlY2lwZXMnLFxuICAgIGNvbW1hbmQ6ICd1dngnLFxuICAgIGFyZ3M6IFsnc3Bvb25hY3VsYXItbWNwLXNlcnZlckBsYXRlc3QnXSxcbiAgICBlbnY6IHtcbiAgICAgIEZBU1RNQ1BfTE9HX0xFVkVMOiAnRVJST1InLFxuICAgICAgU1BPT05BQ1VMQVJfQVBJX0tFWTogcHJvY2Vzcy5lbnYuU1BPT05BQ1VMQVJfQVBJX0tFWSB8fCAnJ1xuICAgIH0sXG4gICAgZGlzYWJsZWQ6IGZhbHNlLFxuICAgIGF1dG9BcHByb3ZlOiBbJ3NlYXJjaF9yZWNpcGVzJywgJ2dldF9yZWNpcGVfZGV0YWlscyddLFxuICAgIHRpbWVvdXQ6IDYwMDAsXG4gICAgcmV0cnlBdHRlbXB0czogMixcbiAgICBmYWxsYmFja0VuYWJsZWQ6IHRydWVcbiAgfVxufTtcblxuLy8gUmF0ZSBsaW1pdGluZyBjb25maWd1cmF0aW9uc1xuY29uc3QgUkFURV9MSU1JVFM6IFJlY29yZDxzdHJpbmcsIE1DUFJhdGVMaW1pdENvbmZpZz4gPSB7XG4gICduYXNhLWhvcml6b25zJzoge1xuICAgIHJlcXVlc3RzUGVyTWludXRlOiA2MCxcbiAgICByZXF1ZXN0c1BlckhvdXI6IDEwMDAsXG4gICAgcmVxdWVzdHNQZXJEYXk6IDEwMDAwLFxuICAgIGJ1cnN0TGltaXQ6IDEwXG4gIH0sXG4gICd1c2RhLW51dHJpdGlvbic6IHtcbiAgICByZXF1ZXN0c1Blck1pbnV0ZTogMzAsXG4gICAgcmVxdWVzdHNQZXJIb3VyOiA1MDAsXG4gICAgcmVxdWVzdHNQZXJEYXk6IDUwMDAsXG4gICAgYnVyc3RMaW1pdDogNVxuICB9LFxuICAnc3Bvb25hY3VsYXItcmVjaXBlcyc6IHtcbiAgICByZXF1ZXN0c1Blck1pbnV0ZTogMTAsXG4gICAgcmVxdWVzdHNQZXJIb3VyOiAxNTAsXG4gICAgcmVxdWVzdHNQZXJEYXk6IDE1MCwgLy8gRGFpbHkgcXVvdGEgbGltaXRcbiAgICBidXJzdExpbWl0OiAzXG4gIH1cbn07XG5cbi8qKlxuICogTUNQIFNlcnZlciBJbnRlZ3JhdGlvbiBNYW5hZ2VyXG4gKi9cbmV4cG9ydCBjbGFzcyBNQ1BTZXJ2ZXJJbnRlZ3JhdGlvbiB7XG4gIHByaXZhdGUgc3RhdGljIGluc3RhbmNlOiBNQ1BTZXJ2ZXJJbnRlZ3JhdGlvbjtcbiAgcHJpdmF0ZSBzZXJ2ZXJzOiBNYXA8c3RyaW5nLCBNQ1BTZXJ2ZXJDb25maWc+ID0gbmV3IE1hcCgpO1xuICBwcml2YXRlIGNhY2hlOiBNYXA8c3RyaW5nLCBNQ1BDYWNoZUVudHJ5PiA9IG5ldyBNYXAoKTtcbiAgcHJpdmF0ZSByYXRlTGltaXRlcnM6IE1hcDxzdHJpbmcsIFJhdGVMaW1pdGVyPiA9IG5ldyBNYXAoKTtcbiAgcHJpdmF0ZSBjb25uZWN0aW9uU3RhdHVzOiBNYXA8c3RyaW5nLCBib29sZWFuPiA9IG5ldyBNYXAoKTtcblxuICBwcml2YXRlIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuaW5pdGlhbGl6ZVNlcnZlcnMoKTtcbiAgICB0aGlzLmluaXRpYWxpemVSYXRlTGltaXRlcnMoKTtcbiAgICB0aGlzLnN0YXJ0SGVhbHRoQ2hlY2tzKCk7XG4gIH1cblxuICBwdWJsaWMgc3RhdGljIGdldEluc3RhbmNlKCk6IE1DUFNlcnZlckludGVncmF0aW9uIHtcbiAgICBpZiAoIU1DUFNlcnZlckludGVncmF0aW9uLmluc3RhbmNlKSB7XG4gICAgICBNQ1BTZXJ2ZXJJbnRlZ3JhdGlvbi5pbnN0YW5jZSA9IG5ldyBNQ1BTZXJ2ZXJJbnRlZ3JhdGlvbigpO1xuICAgIH1cbiAgICByZXR1cm4gTUNQU2VydmVySW50ZWdyYXRpb24uaW5zdGFuY2U7XG4gIH1cblxuICAvKipcbiAgICogQXN0cm9sb2dpY2FsIEFQSSBjb25uZWN0aW9ucyB3aXRoIE5BU0EgSlBMIEhvcml6b25zIGZhbGxiYWNrXG4gICAqL1xuICBwdWJsaWMgYXN5bmMgZ2V0QXN0cm9sb2dpY2FsRGF0YShkYXRlOiBEYXRlID0gbmV3IERhdGUoKSk6IFByb21pc2U8TUNQQXBpUmVzcG9uc2U+IHtcbiAgICBjb25zdCBjYWNoZUtleSA9IGBhc3Ryb2xvZ2ljYWxfJHtkYXRlLnRvSVNPU3RyaW5nKCkuc3BsaXQoJ1QnKVswXX1gO1xuICAgIFxuICAgIC8vIENoZWNrIGNhY2hlIGZpcnN0XG4gICAgY29uc3QgY2FjaGVkID0gdGhpcy5nZXRGcm9tQ2FjaGUoY2FjaGVLZXkpO1xuICAgIGlmIChjYWNoZWQpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGRhdGE6IGNhY2hlZC5kYXRhLFxuICAgICAgICBzb3VyY2U6ICdjYWNoZScsXG4gICAgICAgIHJlc3BvbnNlVGltZTogMCxcbiAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpXG4gICAgICB9O1xuICAgIH1cblxuICAgIC8vIFByaW1hcnk6IE5BU0EgSG9yaXpvbnMgTUNQIHNlcnZlclxuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmNhbGxNQ1BTZXJ2ZXIoJ25hc2EtaG9yaXpvbnMnLCAnZ2V0X3BsYW5ldGFyeV9wb3NpdGlvbnMnLCB7IGRhdGUgfSk7XG4gICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgICAgdGhpcy5zZXRDYWNoZShjYWNoZUtleSwgcmVzdWx0LmRhdGEsIDYgKiA2MCAqIDYwICogMTAwMCk7IC8vIDYgaG91cnMgVFRMXG4gICAgICAgIHJldHVybiB7IC4uLnJlc3VsdCwgc291cmNlOiAncHJpbWFyeScgfTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLndhcm4oJ05BU0EgSG9yaXpvbnMgTUNQIHNlcnZlciBmYWlsZWQ6JywgZXJyb3IpO1xuICAgIH1cblxuICAgIC8vIFNlY29uZGFyeTogRGlyZWN0IE5BU0EgQVBJIGNhbGxcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5jYWxsRGlyZWN0TkFTQUFQSShkYXRlKTtcbiAgICAgIGlmIChyZXN1bHQuc3VjY2Vzcykge1xuICAgICAgICB0aGlzLnNldENhY2hlKGNhY2hlS2V5LCByZXN1bHQuZGF0YSwgNiAqIDYwICogNjAgKiAxMDAwKTtcbiAgICAgICAgcmV0dXJuIHsgLi4ucmVzdWx0LCBzb3VyY2U6ICdzZWNvbmRhcnknIH07XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci53YXJuKCdEaXJlY3QgTkFTQSBBUEkgZmFpbGVkOicsIGVycm9yKTtcbiAgICB9XG5cbiAgICAvLyBGYWxsYmFjazogTG9jYWwgZXBoZW1lcmlzIGRhdGFcbiAgICB0cnkge1xuICAgICAgY29uc3QgZmFsbGJhY2tEYXRhID0gYXdhaXQgdGhpcy5nZXRGYWxsYmFja0FzdHJvbG9naWNhbERhdGEoZGF0ZSk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkYXRhOiBmYWxsYmFja0RhdGEsXG4gICAgICAgIHNvdXJjZTogJ2ZhbGxiYWNrJyxcbiAgICAgICAgcmVzcG9uc2VUaW1lOiAwLFxuICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KClcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignQWxsIGFzdHJvbG9naWNhbCBkYXRhIHNvdXJjZXMgZmFpbGVkOicsIGVycm9yKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcjogJ0FsbCBhc3Ryb2xvZ2ljYWwgZGF0YSBzb3VyY2VzIHVuYXZhaWxhYmxlJyxcbiAgICAgICAgc291cmNlOiAnZmFsbGJhY2snLFxuICAgICAgICByZXNwb25zZVRpbWU6IDAsXG4gICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKVxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogTnV0cml0aW9uYWwgZGF0YWJhc2UgYWNjZXNzIHdpdGggVVNEQSBBUEkgaW50ZWdyYXRpb25cbiAgICovXG4gIHB1YmxpYyBhc3luYyBnZXROdXRyaXRpb25hbERhdGEoaW5ncmVkaWVudDogc3RyaW5nKTogUHJvbWlzZTxNQ1BBcGlSZXNwb25zZT4ge1xuICAgIGNvbnN0IGNhY2hlS2V5ID0gYG51dHJpdGlvbl8ke2luZ3JlZGllbnQudG9Mb3dlckNhc2UoKS5yZXBsYWNlKC9cXHMrL2csICdfJyl9YDtcbiAgICBcbiAgICAvLyBDaGVjayBjYWNoZSBmaXJzdFxuICAgIGNvbnN0IGNhY2hlZCA9IHRoaXMuZ2V0RnJvbUNhY2hlKGNhY2hlS2V5KTtcbiAgICBpZiAoY2FjaGVkKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkYXRhOiBjYWNoZWQuZGF0YSxcbiAgICAgICAgc291cmNlOiAnY2FjaGUnLFxuICAgICAgICByZXNwb25zZVRpbWU6IDAsXG4gICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKVxuICAgICAgfTtcbiAgICB9XG5cbiAgICAvLyBDaGVjayByYXRlIGxpbWl0c1xuICAgIGlmICghdGhpcy5jaGVja1JhdGVMaW1pdCgndXNkYS1udXRyaXRpb24nKSkge1xuICAgICAgbG9nZ2VyLndhcm4oJ1VTREEgbnV0cml0aW9uIEFQSSByYXRlIGxpbWl0IGV4Y2VlZGVkJyk7XG4gICAgICByZXR1cm4gdGhpcy5nZXRSYXRlTGltaXRlZFJlc3BvbnNlKCk7XG4gICAgfVxuXG4gICAgLy8gUHJpbWFyeTogVVNEQSBOdXRyaXRpb24gTUNQIHNlcnZlclxuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmNhbGxNQ1BTZXJ2ZXIoJ3VzZGEtbnV0cml0aW9uJywgJ2dldF9udXRyaXRpb25fZGF0YScsIHsgaW5ncmVkaWVudCB9KTtcbiAgICAgIGlmIChyZXN1bHQuc3VjY2Vzcykge1xuICAgICAgICB0aGlzLnNldENhY2hlKGNhY2hlS2V5LCByZXN1bHQuZGF0YSwgMjQgKiA2MCAqIDYwICogMTAwMCk7IC8vIDI0IGhvdXJzIFRUTFxuICAgICAgICByZXR1cm4geyAuLi5yZXN1bHQsIHNvdXJjZTogJ3ByaW1hcnknIH07XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci53YXJuKCdVU0RBIE51dHJpdGlvbiBNQ1Agc2VydmVyIGZhaWxlZDonLCBlcnJvcik7XG4gICAgfVxuXG4gICAgLy8gU2Vjb25kYXJ5OiBEaXJlY3QgVVNEQSBBUEkgY2FsbFxuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmNhbGxEaXJlY3RVU0RBQVBJKGluZ3JlZGllbnQpO1xuICAgICAgaWYgKHJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICAgIHRoaXMuc2V0Q2FjaGUoY2FjaGVLZXksIHJlc3VsdC5kYXRhLCAyNCAqIDYwICogNjAgKiAxMDAwKTtcbiAgICAgICAgcmV0dXJuIHsgLi4ucmVzdWx0LCBzb3VyY2U6ICdzZWNvbmRhcnknIH07XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci53YXJuKCdEaXJlY3QgVVNEQSBBUEkgZmFpbGVkOicsIGVycm9yKTtcbiAgICB9XG5cbiAgICAvLyBGYWxsYmFjazogTG9jYWwgbnV0cml0aW9uIGRhdGFiYXNlXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGZhbGxiYWNrRGF0YSA9IGF3YWl0IHRoaXMuZ2V0RmFsbGJhY2tOdXRyaXRpb25hbERhdGEoaW5ncmVkaWVudCk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkYXRhOiBmYWxsYmFja0RhdGEsXG4gICAgICAgIHNvdXJjZTogJ2ZhbGxiYWNrJyxcbiAgICAgICAgcmVzcG9uc2VUaW1lOiAwLFxuICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KClcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignQWxsIG51dHJpdGlvbmFsIGRhdGEgc291cmNlcyBmYWlsZWQ6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiAnTnV0cml0aW9uYWwgZGF0YSB1bmF2YWlsYWJsZScsXG4gICAgICAgIHNvdXJjZTogJ2ZhbGxiYWNrJyxcbiAgICAgICAgcmVzcG9uc2VUaW1lOiAwLFxuICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KClcbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFJlY2lwZSBBUEkgY29ubmVjdGlvbnMgd2l0aCByYXRlIGxpbWl0aW5nIGFuZCBjYWNoaW5nXG4gICAqL1xuICBwdWJsaWMgYXN5bmMgZ2V0UmVjaXBlRGF0YShxdWVyeTogc3RyaW5nLCBvcHRpb25zOiB7XG4gICAgY3Vpc2luZT86IHN0cmluZztcbiAgICBkaWV0Pzogc3RyaW5nO1xuICAgIG1heFJlc3VsdHM/OiBudW1iZXI7XG4gIH0gPSB7fSk6IFByb21pc2U8TUNQQXBpUmVzcG9uc2U+IHtcbiAgICBjb25zdCBjYWNoZUtleSA9IGByZWNpcGVzXyR7cXVlcnkudG9Mb3dlckNhc2UoKS5yZXBsYWNlKC9cXHMrL2csICdfJyl9XyR7SlNPTi5zdHJpbmdpZnkob3B0aW9ucyl9YDtcbiAgICBcbiAgICAvLyBDaGVjayBjYWNoZSBmaXJzdFxuICAgIGNvbnN0IGNhY2hlZCA9IHRoaXMuZ2V0RnJvbUNhY2hlKGNhY2hlS2V5KTtcbiAgICBpZiAoY2FjaGVkKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkYXRhOiBjYWNoZWQuZGF0YSxcbiAgICAgICAgc291cmNlOiAnY2FjaGUnLFxuICAgICAgICByZXNwb25zZVRpbWU6IDAsXG4gICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKVxuICAgICAgfTtcbiAgICB9XG5cbiAgICAvLyBDaGVjayByYXRlIGxpbWl0cyAoU3Bvb25hY3VsYXIgaGFzIHN0cmljdCBkYWlseSBsaW1pdHMpXG4gICAgaWYgKCF0aGlzLmNoZWNrUmF0ZUxpbWl0KCdzcG9vbmFjdWxhci1yZWNpcGVzJykpIHtcbiAgICAgIGxvZ2dlci53YXJuKCdTcG9vbmFjdWxhciByZWNpcGUgQVBJIHJhdGUgbGltaXQgZXhjZWVkZWQnKTtcbiAgICAgIHJldHVybiB0aGlzLmdldFJhdGVMaW1pdGVkUmVzcG9uc2UoKTtcbiAgICB9XG5cbiAgICAvLyBQcmltYXJ5OiBTcG9vbmFjdWxhciBNQ1Agc2VydmVyXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuY2FsbE1DUFNlcnZlcignc3Bvb25hY3VsYXItcmVjaXBlcycsICdzZWFyY2hfcmVjaXBlcycsIHsgcXVlcnksIC4uLm9wdGlvbnMgfSk7XG4gICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgICAgdGhpcy5zZXRDYWNoZShjYWNoZUtleSwgcmVzdWx0LmRhdGEsIDEyICogNjAgKiA2MCAqIDEwMDApOyAvLyAxMiBob3VycyBUVExcbiAgICAgICAgcmV0dXJuIHsgLi4ucmVzdWx0LCBzb3VyY2U6ICdwcmltYXJ5JyB9O1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIud2FybignU3Bvb25hY3VsYXIgTUNQIHNlcnZlciBmYWlsZWQ6JywgZXJyb3IpO1xuICAgIH1cblxuICAgIC8vIFNlY29uZGFyeTogRGlyZWN0IFNwb29uYWN1bGFyIEFQSSBjYWxsXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuY2FsbERpcmVjdFNwb29uYWN1bGFyQVBJKHF1ZXJ5LCBvcHRpb25zKTtcbiAgICAgIGlmIChyZXN1bHQuc3VjY2Vzcykge1xuICAgICAgICB0aGlzLnNldENhY2hlKGNhY2hlS2V5LCByZXN1bHQuZGF0YSwgMTIgKiA2MCAqIDYwICogMTAwMCk7XG4gICAgICAgIHJldHVybiB7IC4uLnJlc3VsdCwgc291cmNlOiAnc2Vjb25kYXJ5JyB9O1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIud2FybignRGlyZWN0IFNwb29uYWN1bGFyIEFQSSBmYWlsZWQ6JywgZXJyb3IpO1xuICAgIH1cblxuICAgIC8vIEZhbGxiYWNrOiBMb2NhbCByZWNpcGUgZGF0YWJhc2VcbiAgICB0cnkge1xuICAgICAgY29uc3QgZmFsbGJhY2tEYXRhID0gYXdhaXQgdGhpcy5nZXRGYWxsYmFja1JlY2lwZURhdGEocXVlcnksIG9wdGlvbnMpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgZGF0YTogZmFsbGJhY2tEYXRhLFxuICAgICAgICBzb3VyY2U6ICdmYWxsYmFjaycsXG4gICAgICAgIHJlc3BvbnNlVGltZTogMCxcbiAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ0FsbCByZWNpcGUgZGF0YSBzb3VyY2VzIGZhaWxlZDonLCBlcnJvcik7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6ICdSZWNpcGUgZGF0YSB1bmF2YWlsYWJsZScsXG4gICAgICAgIHNvdXJjZTogJ2ZhbGxiYWNrJyxcbiAgICAgICAgcmVzcG9uc2VUaW1lOiAwLFxuICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KClcbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFRlc3QgbXVsdGktdGllciBmYWxsYmFjayBzdHJhdGVneVxuICAgKi9cbiAgcHVibGljIGFzeW5jIHRlc3RGYWxsYmFja1N0cmF0ZWd5KCk6IFByb21pc2U8e1xuICAgIGFzdHJvbG9naWNhbDogTUNQQXBpUmVzcG9uc2U7XG4gICAgbnV0cml0aW9uYWw6IE1DUEFwaVJlc3BvbnNlO1xuICAgIHJlY2lwZXM6IE1DUEFwaVJlc3BvbnNlO1xuICAgIG92ZXJhbGxSZWxpYWJpbGl0eTogbnVtYmVyO1xuICB9PiB7XG4gICAgbG9nZ2VyLmluZm8oJ1Rlc3RpbmcgTUNQIHNlcnZlciBmYWxsYmFjayBzdHJhdGVneS4uLicpO1xuXG4gICAgY29uc3QgcmVzdWx0cyA9IGF3YWl0IFByb21pc2UuYWxsU2V0dGxlZChbXG4gICAgICB0aGlzLmdldEFzdHJvbG9naWNhbERhdGEoKSxcbiAgICAgIHRoaXMuZ2V0TnV0cml0aW9uYWxEYXRhKCdhcHBsZScpLFxuICAgICAgdGhpcy5nZXRSZWNpcGVEYXRhKCdwYXN0YScpXG4gICAgXSk7XG5cbiAgICBjb25zdCBhc3Ryb2xvZ2ljYWwgPSByZXN1bHRzWzBdLnN0YXR1cyA9PT0gJ2Z1bGZpbGxlZCcgPyByZXN1bHRzWzBdLnZhbHVlIDogdGhpcy5jcmVhdGVFcnJvclJlc3BvbnNlKCdBc3Ryb2xvZ2ljYWwgdGVzdCBmYWlsZWQnKTtcbiAgICBjb25zdCBudXRyaXRpb25hbCA9IHJlc3VsdHNbMV0uc3RhdHVzID09PSAnZnVsZmlsbGVkJyA/IHJlc3VsdHNbMV0udmFsdWUgOiB0aGlzLmNyZWF0ZUVycm9yUmVzcG9uc2UoJ051dHJpdGlvbmFsIHRlc3QgZmFpbGVkJyk7XG4gICAgY29uc3QgcmVjaXBlcyA9IHJlc3VsdHNbMl0uc3RhdHVzID09PSAnZnVsZmlsbGVkJyA/IHJlc3VsdHNbMl0udmFsdWUgOiB0aGlzLmNyZWF0ZUVycm9yUmVzcG9uc2UoJ1JlY2lwZSB0ZXN0IGZhaWxlZCcpO1xuXG4gICAgY29uc3Qgc3VjY2Vzc0NvdW50ID0gW2FzdHJvbG9naWNhbCwgbnV0cml0aW9uYWwsIHJlY2lwZXNdLmZpbHRlcihyID0+IHIuc3VjY2VzcykubGVuZ3RoO1xuICAgIGNvbnN0IG92ZXJhbGxSZWxpYWJpbGl0eSA9IHN1Y2Nlc3NDb3VudCAvIDM7XG5cbiAgICBsb2dnZXIuaW5mbygnRmFsbGJhY2sgc3RyYXRlZ3kgdGVzdCBjb21wbGV0ZWQnLCB7XG4gICAgICBhc3Ryb2xvZ2ljYWw6IGFzdHJvbG9naWNhbC5zdWNjZXNzID8gYXN0cm9sb2dpY2FsLnNvdXJjZSA6ICdmYWlsZWQnLFxuICAgICAgbnV0cml0aW9uYWw6IG51dHJpdGlvbmFsLnN1Y2Nlc3MgPyBudXRyaXRpb25hbC5zb3VyY2UgOiAnZmFpbGVkJyxcbiAgICAgIHJlY2lwZXM6IHJlY2lwZXMuc3VjY2VzcyA/IHJlY2lwZXMuc291cmNlIDogJ2ZhaWxlZCcsXG4gICAgICBvdmVyYWxsUmVsaWFiaWxpdHlcbiAgICB9KTtcblxuICAgIHJldHVybiB7IGFzdHJvbG9naWNhbCwgbnV0cml0aW9uYWwsIHJlY2lwZXMsIG92ZXJhbGxSZWxpYWJpbGl0eSB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBzZXJ2ZXIgY29ubmVjdGlvbiBzdGF0dXNcbiAgICovXG4gIHB1YmxpYyBnZXRTZXJ2ZXJTdGF0dXMoKTogUmVjb3JkPHN0cmluZywge1xuICAgIGNvbm5lY3RlZDogYm9vbGVhbjtcbiAgICBsYXN0Q2hlY2s6IG51bWJlcjtcbiAgICByZXNwb25zZVRpbWU6IG51bWJlcjtcbiAgICBlcnJvckNvdW50OiBudW1iZXI7XG4gIH0+IHtcbiAgICBjb25zdCBzdGF0dXM6IFJlY29yZDxzdHJpbmcsIGFueT4gPSB7fTtcbiAgICBcbiAgICBmb3IgKGNvbnN0IFtuYW1lLCBjb25maWddIG9mIHRoaXMuc2VydmVycykge1xuICAgICAgc3RhdHVzW25hbWVdID0ge1xuICAgICAgICBjb25uZWN0ZWQ6IHRoaXMuY29ubmVjdGlvblN0YXR1cy5nZXQobmFtZSkgfHwgZmFsc2UsXG4gICAgICAgIGxhc3RDaGVjazogRGF0ZS5ub3coKSxcbiAgICAgICAgcmVzcG9uc2VUaW1lOiAwLCAvLyBXb3VsZCBiZSB0cmFja2VkIGluIHJlYWwgaW1wbGVtZW50YXRpb25cbiAgICAgICAgZXJyb3JDb3VudDogMCAvLyBXb3VsZCBiZSB0cmFja2VkIGluIHJlYWwgaW1wbGVtZW50YXRpb25cbiAgICAgIH07XG4gICAgfVxuICAgIFxuICAgIHJldHVybiBzdGF0dXM7XG4gIH1cblxuICAvLyBQcml2YXRlIGhlbHBlciBtZXRob2RzXG5cbiAgcHJpdmF0ZSBpbml0aWFsaXplU2VydmVycygpOiB2b2lkIHtcbiAgICBPYmplY3QudmFsdWVzKERFRkFVTFRfTUNQX1NFUlZFUlMpLmZvckVhY2goY29uZmlnID0+IHtcbiAgICAgIGlmICghY29uZmlnLmRpc2FibGVkKSB7XG4gICAgICAgIHRoaXMuc2VydmVycy5zZXQoY29uZmlnLm5hbWUsIGNvbmZpZyk7XG4gICAgICAgIHRoaXMuY29ubmVjdGlvblN0YXR1cy5zZXQoY29uZmlnLm5hbWUsIGZhbHNlKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBcbiAgICBsb2dnZXIuaW5mbygnTUNQIHNlcnZlcnMgaW5pdGlhbGl6ZWQ6JywgQXJyYXkuZnJvbSh0aGlzLnNlcnZlcnMua2V5cygpKSk7XG4gIH1cblxuICBwcml2YXRlIGluaXRpYWxpemVSYXRlTGltaXRlcnMoKTogdm9pZCB7XG4gICAgT2JqZWN0LmVudHJpZXMoUkFURV9MSU1JVFMpLmZvckVhY2goKFtzZXJ2ZXJOYW1lLCBjb25maWddKSA9PiB7XG4gICAgICB0aGlzLnJhdGVMaW1pdGVycy5zZXQoc2VydmVyTmFtZSwgbmV3IFJhdGVMaW1pdGVyKGNvbmZpZykpO1xuICAgIH0pO1xuICAgIFxuICAgIGxvZ2dlci5pbmZvKCdSYXRlIGxpbWl0ZXJzIGluaXRpYWxpemVkIGZvciBNQ1Agc2VydmVycycpO1xuICB9XG5cbiAgcHJpdmF0ZSBzdGFydEhlYWx0aENoZWNrcygpOiB2b2lkIHtcbiAgICAvLyBDaGVjayBzZXJ2ZXIgaGVhbHRoIGV2ZXJ5IDUgbWludXRlc1xuICAgIHNldEludGVydmFsKGFzeW5jICgpID0+IHtcbiAgICAgIGZvciAoY29uc3QgW25hbWUsIGNvbmZpZ10gb2YgdGhpcy5zZXJ2ZXJzKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3QgaXNIZWFsdGh5ID0gYXdhaXQgdGhpcy5jaGVja1NlcnZlckhlYWx0aChuYW1lKTtcbiAgICAgICAgICB0aGlzLmNvbm5lY3Rpb25TdGF0dXMuc2V0KG5hbWUsIGlzSGVhbHRoeSk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgbG9nZ2VyLndhcm4oYEhlYWx0aCBjaGVjayBmYWlsZWQgZm9yIE1DUCBzZXJ2ZXIgJHtuYW1lfTpgLCBlcnJvcik7XG4gICAgICAgICAgdGhpcy5jb25uZWN0aW9uU3RhdHVzLnNldChuYW1lLCBmYWxzZSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LCA1ICogNjAgKiAxMDAwKTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgY2FsbE1DUFNlcnZlcihzZXJ2ZXJOYW1lOiBzdHJpbmcsIG1ldGhvZDogc3RyaW5nLCBwYXJhbXM6IGFueSk6IFByb21pc2U8TUNQQXBpUmVzcG9uc2U+IHtcbiAgICBjb25zdCBjb25maWcgPSB0aGlzLnNlcnZlcnMuZ2V0KHNlcnZlck5hbWUpO1xuICAgIGlmICghY29uZmlnKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYE1DUCBzZXJ2ZXIgJHtzZXJ2ZXJOYW1lfSBub3QgY29uZmlndXJlZGApO1xuICAgIH1cblxuICAgIGNvbnN0IHN0YXJ0VGltZSA9IHBlcmZvcm1hbmNlLm5vdygpO1xuICAgIFxuICAgIHRyeSB7XG4gICAgICAvLyBJbiBhIHJlYWwgaW1wbGVtZW50YXRpb24sIHRoaXMgd291bGQgdXNlIHRoZSBhY3R1YWwgTUNQIHByb3RvY29sXG4gICAgICAvLyBGb3Igbm93LCB3ZSBzaW11bGF0ZSB0aGUgTUNQIHNlcnZlciBjYWxsXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLnNpbXVsYXRlTUNQQ2FsbChzZXJ2ZXJOYW1lLCBtZXRob2QsIHBhcmFtcyk7XG4gICAgICBjb25zdCByZXNwb25zZVRpbWUgPSBwZXJmb3JtYW5jZS5ub3coKSAtIHN0YXJ0VGltZTtcbiAgICAgIFxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgZGF0YTogcmVzdWx0LFxuICAgICAgICBzb3VyY2U6ICdwcmltYXJ5JyxcbiAgICAgICAgcmVzcG9uc2VUaW1lLFxuICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KClcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnN0IHJlc3BvbnNlVGltZSA9IHBlcmZvcm1hbmNlLm5vdygpIC0gc3RhcnRUaW1lO1xuICAgICAgbG9nZ2VyLmVycm9yKGBNQ1Agc2VydmVyICR7c2VydmVyTmFtZX0gY2FsbCBmYWlsZWQ6YCwgZXJyb3IpO1xuICAgICAgXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InLFxuICAgICAgICBzb3VyY2U6ICdwcmltYXJ5JyxcbiAgICAgICAgcmVzcG9uc2VUaW1lLFxuICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KClcbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBzaW11bGF0ZU1DUENhbGwoc2VydmVyTmFtZTogc3RyaW5nLCBtZXRob2Q6IHN0cmluZywgcGFyYW1zOiBhbnkpOiBQcm9taXNlPGFueT4ge1xuICAgIC8vIFNpbXVsYXRlIE1DUCBzZXJ2ZXIgY2FsbHMgZm9yIGRlbW9uc3RyYXRpb25cbiAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgTWF0aC5yYW5kb20oKSAqIDEwMDAgKyA1MDApKTsgLy8gNTAwLTE1MDBtcyBkZWxheVxuICAgIFxuICAgIHN3aXRjaCAoc2VydmVyTmFtZSkge1xuICAgICAgY2FzZSAnbmFzYS1ob3Jpem9ucyc6XG4gICAgICAgIGlmIChtZXRob2QgPT09ICdnZXRfcGxhbmV0YXJ5X3Bvc2l0aW9ucycpIHtcbiAgICAgICAgICByZXR1cm4gdGhpcy5nZW5lcmF0ZU1vY2tQbGFuZXRhcnlEYXRhKHBhcmFtcy5kYXRlKTtcbiAgICAgICAgfVxuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ3VzZGEtbnV0cml0aW9uJzpcbiAgICAgICAgaWYgKG1ldGhvZCA9PT0gJ2dldF9udXRyaXRpb25fZGF0YScpIHtcbiAgICAgICAgICByZXR1cm4gdGhpcy5nZW5lcmF0ZU1vY2tOdXRyaXRpb25hbERhdGEocGFyYW1zLmluZ3JlZGllbnQpO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnc3Bvb25hY3VsYXItcmVjaXBlcyc6XG4gICAgICAgIGlmIChtZXRob2QgPT09ICdzZWFyY2hfcmVjaXBlcycpIHtcbiAgICAgICAgICByZXR1cm4gdGhpcy5nZW5lcmF0ZU1vY2tSZWNpcGVEYXRhKHBhcmFtcy5xdWVyeSwgcGFyYW1zKTtcbiAgICAgICAgfVxuICAgICAgICBicmVhaztcbiAgICB9XG4gICAgXG4gICAgdGhyb3cgbmV3IEVycm9yKGBVbmtub3duIG1ldGhvZCAke21ldGhvZH0gZm9yIHNlcnZlciAke3NlcnZlck5hbWV9YCk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGNoZWNrU2VydmVySGVhbHRoKHNlcnZlck5hbWU6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBJbiBhIHJlYWwgaW1wbGVtZW50YXRpb24sIHRoaXMgd291bGQgcGluZyB0aGUgTUNQIHNlcnZlclxuICAgICAgLy8gRm9yIG5vdywgc2ltdWxhdGUgaGVhbHRoIGNoZWNrXG4gICAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgMTAwKSk7XG4gICAgICByZXR1cm4gTWF0aC5yYW5kb20oKSA+IDAuMTsgLy8gOTAlIHVwdGltZSBzaW11bGF0aW9uXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNoZWNrUmF0ZUxpbWl0KHNlcnZlck5hbWU6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IHJhdGVMaW1pdGVyID0gdGhpcy5yYXRlTGltaXRlcnMuZ2V0KHNlcnZlck5hbWUpO1xuICAgIHJldHVybiByYXRlTGltaXRlciA/IHJhdGVMaW1pdGVyLmNoZWNrTGltaXQoKSA6IHRydWU7XG4gIH1cblxuICBwcml2YXRlIGdldEZyb21DYWNoZTxUPihrZXk6IHN0cmluZyk6IE1DUENhY2hlRW50cnk8VD4gfCBudWxsIHtcbiAgICBjb25zdCBlbnRyeSA9IHRoaXMuY2FjaGUuZ2V0KGtleSk7XG4gICAgaWYgKCFlbnRyeSkgcmV0dXJuIG51bGw7XG4gICAgXG4gICAgaWYgKERhdGUubm93KCkgLSBlbnRyeS50aW1lc3RhbXAgPiBlbnRyeS50dGwpIHtcbiAgICAgIHRoaXMuY2FjaGUuZGVsZXRlKGtleSk7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIGVudHJ5IGFzIE1DUENhY2hlRW50cnk8VD47XG4gIH1cblxuICBwcml2YXRlIHNldENhY2hlPFQ+KGtleTogc3RyaW5nLCBkYXRhOiBULCB0dGw6IG51bWJlcik6IHZvaWQge1xuICAgIHRoaXMuY2FjaGUuc2V0KGtleSwge1xuICAgICAgZGF0YSxcbiAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICAgIHR0bCxcbiAgICAgIHNvdXJjZTogJ2NhY2hlJ1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRSYXRlTGltaXRlZFJlc3BvbnNlKCk6IE1DUEFwaVJlc3BvbnNlIHtcbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBlcnJvcjogJ1JhdGUgbGltaXQgZXhjZWVkZWQnLFxuICAgICAgc291cmNlOiAncHJpbWFyeScsXG4gICAgICByZXNwb25zZVRpbWU6IDAsXG4gICAgICB0aW1lc3RhbXA6IERhdGUubm93KClcbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVFcnJvclJlc3BvbnNlKGVycm9yOiBzdHJpbmcpOiBNQ1BBcGlSZXNwb25zZSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgZXJyb3IsXG4gICAgICBzb3VyY2U6ICdmYWxsYmFjaycsXG4gICAgICByZXNwb25zZVRpbWU6IDAsXG4gICAgICB0aW1lc3RhbXA6IERhdGUubm93KClcbiAgICB9O1xuICB9XG5cbiAgLy8gRGlyZWN0IEFQSSBjYWxsIG1ldGhvZHMgKGZhbGxiYWNrIGltcGxlbWVudGF0aW9ucylcbiAgcHJpdmF0ZSBhc3luYyBjYWxsRGlyZWN0TkFTQUFQSShkYXRlOiBEYXRlKTogUHJvbWlzZTxNQ1BBcGlSZXNwb25zZT4ge1xuICAgIC8vIFNpbXVsYXRlIGRpcmVjdCBOQVNBIEFQSSBjYWxsXG4gICAgYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDIwMDApKTtcbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIGRhdGE6IHRoaXMuZ2VuZXJhdGVNb2NrUGxhbmV0YXJ5RGF0YShkYXRlKSxcbiAgICAgIHNvdXJjZTogJ3NlY29uZGFyeScsXG4gICAgICByZXNwb25zZVRpbWU6IDIwMDAsXG4gICAgICB0aW1lc3RhbXA6IERhdGUubm93KClcbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBjYWxsRGlyZWN0VVNEQUFQSShpbmdyZWRpZW50OiBzdHJpbmcpOiBQcm9taXNlPE1DUEFwaVJlc3BvbnNlPiB7XG4gICAgLy8gU2ltdWxhdGUgZGlyZWN0IFVTREEgQVBJIGNhbGxcbiAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgMTUwMCkpO1xuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgZGF0YTogdGhpcy5nZW5lcmF0ZU1vY2tOdXRyaXRpb25hbERhdGEoaW5ncmVkaWVudCksXG4gICAgICBzb3VyY2U6ICdzZWNvbmRhcnknLFxuICAgICAgcmVzcG9uc2VUaW1lOiAxNTAwLFxuICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpXG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgY2FsbERpcmVjdFNwb29uYWN1bGFyQVBJKHF1ZXJ5OiBzdHJpbmcsIG9wdGlvbnM6IGFueSk6IFByb21pc2U8TUNQQXBpUmVzcG9uc2U+IHtcbiAgICAvLyBTaW11bGF0ZSBkaXJlY3QgU3Bvb25hY3VsYXIgQVBJIGNhbGxcbiAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgMTAwMCkpO1xuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgZGF0YTogdGhpcy5nZW5lcmF0ZU1vY2tSZWNpcGVEYXRhKHF1ZXJ5LCBvcHRpb25zKSxcbiAgICAgIHNvdXJjZTogJ3NlY29uZGFyeScsXG4gICAgICByZXNwb25zZVRpbWU6IDEwMDAsXG4gICAgICB0aW1lc3RhbXA6IERhdGUubm93KClcbiAgICB9O1xuICB9XG5cbiAgLy8gRmFsbGJhY2sgZGF0YSBtZXRob2RzXG4gIHByaXZhdGUgYXN5bmMgZ2V0RmFsbGJhY2tBc3Ryb2xvZ2ljYWxEYXRhKGRhdGU6IERhdGUpOiBQcm9taXNlPGFueT4ge1xuICAgIC8vIFJldHVybiBoYXJkY29kZWQgcmVsaWFibGUgcG9zaXRpb25zIGZyb20gTWFyY2ggMjAyNVxuICAgIHJldHVybiB7XG4gICAgICBzdW46IHsgc2lnbjogJ2FyaWVzJywgZGVncmVlOiA4LjUsIGV4YWN0TG9uZ2l0dWRlOiA4LjUsIGlzUmV0cm9ncmFkZTogZmFsc2UgfSxcbiAgICAgIG1vb246IHsgc2lnbjogJ2FyaWVzJywgZGVncmVlOiAxLjU3LCBleGFjdExvbmdpdHVkZTogMS41NywgaXNSZXRyb2dyYWRlOiBmYWxzZSB9LFxuICAgICAgbWVyY3VyeTogeyBzaWduOiAnYXJpZXMnLCBkZWdyZWU6IDAuODUsIGV4YWN0TG9uZ2l0dWRlOiAwLjg1LCBpc1JldHJvZ3JhZGU6IHRydWUgfSxcbiAgICAgIHZlbnVzOiB7IHNpZ246ICdwaXNjZXMnLCBkZWdyZWU6IDI5LjA4LCBleGFjdExvbmdpdHVkZTogMzU5LjA4LCBpc1JldHJvZ3JhZGU6IHRydWUgfSxcbiAgICAgIG1hcnM6IHsgc2lnbjogJ2NhbmNlcicsIGRlZ3JlZTogMjIuNjMsIGV4YWN0TG9uZ2l0dWRlOiAxMTIuNjMsIGlzUmV0cm9ncmFkZTogZmFsc2UgfSxcbiAgICAgIGp1cGl0ZXI6IHsgc2lnbjogJ2dlbWluaScsIGRlZ3JlZTogMTUuNTIsIGV4YWN0TG9uZ2l0dWRlOiA3NS41MiwgaXNSZXRyb2dyYWRlOiBmYWxzZSB9LFxuICAgICAgc2F0dXJuOiB7IHNpZ246ICdwaXNjZXMnLCBkZWdyZWU6IDI0LjEyLCBleGFjdExvbmdpdHVkZTogMzU0LjEyLCBpc1JldHJvZ3JhZGU6IGZhbHNlIH1cbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBnZXRGYWxsYmFja051dHJpdGlvbmFsRGF0YShpbmdyZWRpZW50OiBzdHJpbmcpOiBQcm9taXNlPGFueT4ge1xuICAgIC8vIFJldHVybiBiYXNpYyBudXRyaXRpb25hbCBkYXRhIGZyb20gbG9jYWwgZGF0YWJhc2VcbiAgICByZXR1cm4ge1xuICAgICAgbmFtZTogaW5ncmVkaWVudCxcbiAgICAgIGNhbG9yaWVzOiA1MCxcbiAgICAgIHByb3RlaW46IDEsXG4gICAgICBjYXJiczogMTIsXG4gICAgICBmYXQ6IDAuMixcbiAgICAgIGZpYmVyOiAyLFxuICAgICAgdml0YW1pbnM6IFsnQycsICdLJ10sXG4gICAgICBtaW5lcmFsczogWydwb3Rhc3NpdW0nLCAnZm9sYXRlJ11cbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBnZXRGYWxsYmFja1JlY2lwZURhdGEocXVlcnk6IHN0cmluZywgb3B0aW9uczogYW55KTogUHJvbWlzZTxhbnk+IHtcbiAgICAvLyBSZXR1cm4gYmFzaWMgcmVjaXBlIHN1Z2dlc3Rpb25zIGZyb20gbG9jYWwgZGF0YWJhc2VcbiAgICByZXR1cm4ge1xuICAgICAgcmVjaXBlczogW1xuICAgICAgICB7XG4gICAgICAgICAgaWQ6IDEsXG4gICAgICAgICAgdGl0bGU6IGBTaW1wbGUgJHtxdWVyeX1gLFxuICAgICAgICAgIHJlYWR5SW5NaW51dGVzOiAzMCxcbiAgICAgICAgICBzZXJ2aW5nczogNCxcbiAgICAgICAgICBpbWFnZTogJ3BsYWNlaG9sZGVyLmpwZycsXG4gICAgICAgICAgc3VtbWFyeTogYEEgc2ltcGxlIGFuZCBkZWxpY2lvdXMgJHtxdWVyeX0gcmVjaXBlLmBcbiAgICAgICAgfVxuICAgICAgXSxcbiAgICAgIHRvdGFsUmVzdWx0czogMVxuICAgIH07XG4gIH1cblxuICAvLyBNb2NrIGRhdGEgZ2VuZXJhdG9ycyBmb3Igc2ltdWxhdGlvblxuICBwcml2YXRlIGdlbmVyYXRlTW9ja1BsYW5ldGFyeURhdGEoZGF0ZTogRGF0ZSk6IGFueSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGRhdGU6IGRhdGUudG9JU09TdHJpbmcoKSxcbiAgICAgIHBsYW5ldHM6IHtcbiAgICAgICAgc3VuOiB7IHNpZ246ICdhcmllcycsIGRlZ3JlZTogOC41ICsgTWF0aC5yYW5kb20oKSAqIDIgfSxcbiAgICAgICAgbW9vbjogeyBzaWduOiAnYXJpZXMnLCBkZWdyZWU6IDEuNTcgKyBNYXRoLnJhbmRvbSgpICogNSB9LFxuICAgICAgICBtZXJjdXJ5OiB7IHNpZ246ICdhcmllcycsIGRlZ3JlZTogMC44NSArIE1hdGgucmFuZG9tKCkgKiAzIH1cbiAgICAgIH1cbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBnZW5lcmF0ZU1vY2tOdXRyaXRpb25hbERhdGEoaW5ncmVkaWVudDogc3RyaW5nKTogYW55IHtcbiAgICByZXR1cm4ge1xuICAgICAgbmFtZTogaW5ncmVkaWVudCxcbiAgICAgIGZkY0lkOiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMDAwMDApLFxuICAgICAgY2Fsb3JpZXM6IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDIwMCkgKyAyMCxcbiAgICAgIG51dHJpZW50czoge1xuICAgICAgICBwcm90ZWluOiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAyMCkgKyAxLFxuICAgICAgICBjYXJiczogTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogNTApICsgNSxcbiAgICAgICAgZmF0OiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxNSkgKyAwLjFcbiAgICAgIH1cbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBnZW5lcmF0ZU1vY2tSZWNpcGVEYXRhKHF1ZXJ5OiBzdHJpbmcsIG9wdGlvbnM6IGFueSk6IGFueSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHJlc3VsdHM6IEFycmF5LmZyb20oeyBsZW5ndGg6IG9wdGlvbnMubWF4UmVzdWx0cyB8fCA1IH0sIChfLCBpKSA9PiAoe1xuICAgICAgICBpZDogaSArIDEsXG4gICAgICAgIHRpdGxlOiBgJHtxdWVyeX0gUmVjaXBlICR7aSArIDF9YCxcbiAgICAgICAgcmVhZHlJbk1pbnV0ZXM6IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDYwKSArIDE1LFxuICAgICAgICBzZXJ2aW5nczogTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogNikgKyAyLFxuICAgICAgICBjdWlzaW5lOiBvcHRpb25zLmN1aXNpbmUgfHwgJ2ludGVybmF0aW9uYWwnXG4gICAgICB9KSksXG4gICAgICB0b3RhbFJlc3VsdHM6IG9wdGlvbnMubWF4UmVzdWx0cyB8fCA1XG4gICAgfTtcbiAgfVxufVxuXG4vKipcbiAqIFNpbXBsZSByYXRlIGxpbWl0ZXIgaW1wbGVtZW50YXRpb25cbiAqL1xuY2xhc3MgUmF0ZUxpbWl0ZXIge1xuICBwcml2YXRlIHJlcXVlc3RzOiBudW1iZXJbXSA9IFtdO1xuICBwcml2YXRlIGNvbmZpZzogTUNQUmF0ZUxpbWl0Q29uZmlnO1xuXG4gIGNvbnN0cnVjdG9yKGNvbmZpZzogTUNQUmF0ZUxpbWl0Q29uZmlnKSB7XG4gICAgdGhpcy5jb25maWcgPSBjb25maWc7XG4gIH1cblxuICBjaGVja0xpbWl0KCk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCk7XG4gICAgXG4gICAgLy8gQ2xlYW4gb2xkIHJlcXVlc3RzXG4gICAgdGhpcy5yZXF1ZXN0cyA9IHRoaXMucmVxdWVzdHMuZmlsdGVyKHRpbWUgPT4gbm93IC0gdGltZSA8IDYwMDAwKTsgLy8gS2VlcCBsYXN0IG1pbnV0ZVxuICAgIFxuICAgIC8vIENoZWNrIG1pbnV0ZSBsaW1pdFxuICAgIGlmICh0aGlzLnJlcXVlc3RzLmxlbmd0aCA+PSB0aGlzLmNvbmZpZy5yZXF1ZXN0c1Blck1pbnV0ZSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBcbiAgICAvLyBBZGQgY3VycmVudCByZXF1ZXN0XG4gICAgdGhpcy5yZXF1ZXN0cy5wdXNoKG5vdyk7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbn1cblxuLyoqXG4gKiBDb252ZW5pZW5jZSBmdW5jdGlvbiB0byBnZXQgTUNQIHNlcnZlciBpbnRlZ3JhdGlvbiBpbnN0YW5jZVxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0TUNQU2VydmVySW50ZWdyYXRpb24oKTogTUNQU2VydmVySW50ZWdyYXRpb24ge1xuICByZXR1cm4gTUNQU2VydmVySW50ZWdyYXRpb24uZ2V0SW5zdGFuY2UoKTtcbn1cblxuLyoqXG4gKiBIb29rIGZvciBjb21wb25lbnRzIHRvIHVzZSBNQ1Agc2VydmVyIGludGVncmF0aW9uXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB1c2VNQ1BTZXJ2ZXJJbnRlZ3JhdGlvbigpIHtcbiAgY29uc3QgbWNwID0gZ2V0TUNQU2VydmVySW50ZWdyYXRpb24oKTtcbiAgXG4gIHJldHVybiB7XG4gICAgZ2V0QXN0cm9sb2dpY2FsRGF0YTogKGRhdGU/OiBEYXRlKSA9PiBtY3AuZ2V0QXN0cm9sb2dpY2FsRGF0YShkYXRlKSxcbiAgICBnZXROdXRyaXRpb25hbERhdGE6IChpbmdyZWRpZW50OiBzdHJpbmcpID0+IG1jcC5nZXROdXRyaXRpb25hbERhdGEoaW5ncmVkaWVudCksXG4gICAgZ2V0UmVjaXBlRGF0YTogKHF1ZXJ5OiBzdHJpbmcsIG9wdGlvbnM/OiBhbnkpID0+IG1jcC5nZXRSZWNpcGVEYXRhKHF1ZXJ5LCBvcHRpb25zKSxcbiAgICB0ZXN0RmFsbGJhY2tTdHJhdGVneTogKCkgPT4gbWNwLnRlc3RGYWxsYmFja1N0cmF0ZWd5KCksXG4gICAgZ2V0U2VydmVyU3RhdHVzOiAoKSA9PiBtY3AuZ2V0U2VydmVyU3RhdHVzKClcbiAgfTtcbn0iXSwidmVyc2lvbiI6M30=