c89b1957548d33d48afd6ce2a93b601d
"use strict";
/**
 * Planetary Influences Module
 *
 * Handles the mapping of planetary positions to alchemical properties
 * and calculates planetary influences on culinary recommendations.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.getPlanetaryCulinaryRecommendations = exports.calculatePlanetaryInfluences = exports.calculatePlanetaryHoursInfluence = exports.getPlanetaryElementalInfluence = exports.calculatePlanetaryStrength = exports.calculatePlanetaryDignity = exports.PLANETARY_DIGNITIES = exports.PLANETARY_ELEMENTAL_MAPPINGS = exports.PLANETARY_ALCHEMICAL_MAPPINGS = void 0;
const calculationCache_1 = require("../../utils/calculationCache");
/**
 * Planetary alchemical property mappings
 * Based on traditional alchemical correspondences
 */
exports.PLANETARY_ALCHEMICAL_MAPPINGS = {
    Sun: { Spirit: 1, Essence: 0, Matter: 0, Substance: 0 },
    moon: { Spirit: 0, Essence: 1, Matter: 1, Substance: 0 },
    Mercury: { Spirit: 1, Essence: 0, Matter: 0, Substance: 1 },
    Venus: { Spirit: 0, Essence: 1, Matter: 1, Substance: 0 },
    Mars: { Spirit: 0, Essence: 1, Matter: 1, Substance: 0 },
    Jupiter: { Spirit: 1, Essence: 1, Matter: 0, Substance: 0 },
    Saturn: { Spirit: 1, Essence: 0, Matter: 1, Substance: 0 },
    Uranus: { Spirit: 0, Essence: 1, Matter: 1, Substance: 0 },
    Neptune: { Spirit: 0, Essence: 1, Matter: 0, Substance: 1 },
    Pluto: { Spirit: 0, Essence: 1, Matter: 1, Substance: 0 }
};
/**
 * Planetary elemental correspondences (day/night variations)
 */
exports.PLANETARY_ELEMENTAL_MAPPINGS = {
    diurnal: {
        Sun: 'Fire',
        moon: 'Water',
        Mercury: 'Air',
        Venus: 'Water',
        Mars: 'Fire',
        Jupiter: 'Air',
        Saturn: 'Air',
        Uranus: 'Water',
        Neptune: 'Water',
        Pluto: 'Earth'
    },
    nocturnal: {
        Sun: 'Fire',
        moon: 'Water',
        Mercury: 'Earth',
        Venus: 'Earth',
        Mars: 'Water',
        Jupiter: 'Fire',
        Saturn: 'Earth',
        Uranus: 'Air',
        Neptune: 'Water',
        Pluto: 'Water'
    }
};
/**
 * Planetary dignity effects
 */
exports.PLANETARY_DIGNITIES = {
    Sun: {
        rulership: ['leo'],
        exaltation: ['aries'],
        detriment: ['aquarius'],
        fall: ['libra']
    },
    moon: {
        rulership: ['cancer'],
        exaltation: ['taurus'],
        detriment: ['capricorn'],
        fall: ['scorpio']
    },
    Mercury: {
        rulership: ['gemini', 'virgo'],
        exaltation: ['virgo'],
        detriment: ['sagittarius', 'pisces'],
        fall: ['pisces']
    },
    Venus: {
        rulership: ['taurus', 'libra'],
        exaltation: ['pisces'],
        detriment: ['aries', 'scorpio'],
        fall: ['virgo']
    },
    Mars: {
        rulership: ['aries', 'scorpio'],
        exaltation: ['capricorn'],
        detriment: ['taurus', 'libra'],
        fall: ['cancer']
    },
    Jupiter: {
        rulership: ['sagittarius', 'pisces'],
        exaltation: ['cancer'],
        detriment: ['gemini', 'virgo'],
        fall: ['capricorn']
    },
    Saturn: {
        rulership: ['capricorn', 'aquarius'],
        exaltation: ['libra'],
        detriment: ['cancer', 'leo'],
        fall: ['aries']
    },
    Uranus: {
        rulership: ['aquarius'],
        exaltation: ['scorpio'],
        detriment: ['leo'],
        fall: ['taurus']
    },
    Neptune: {
        rulership: ['pisces'],
        exaltation: ['cancer'],
        detriment: ['virgo'],
        fall: ['capricorn']
    },
    Pluto: {
        rulership: ['scorpio'],
        exaltation: ['leo'],
        detriment: ['taurus'],
        fall: ['aquarius']
    }
};
/**
 * Calculate planetary dignity modifier
 */
function calculatePlanetaryDignity(planet, sign) {
    const planetKey = planet === null || planet === void 0 ? void 0 : planet.toLowerCase();
    const signKey = sign === null || sign === void 0 ? void 0 : sign.toLowerCase();
    const dignities = exports.PLANETARY_DIGNITIES[planetKey];
    if (!dignities) {
        return { type: 'neutral', modifier: 1.0 };
    }
    if ((Array.isArray(dignities.rulership) ? dignities.rulership.includes(signKey) : dignities.rulership === signKey)) {
        return { type: 'rulership', modifier: 1.5 };
    }
    if ((Array.isArray(dignities.exaltation) ? dignities.exaltation.includes(signKey) : dignities.exaltation === signKey)) {
        return { type: 'exaltation', modifier: 1.3 };
    }
    if ((Array.isArray(dignities.detriment) ? dignities.detriment.includes(signKey) : dignities.detriment === signKey)) {
        return { type: 'detriment', modifier: 0.7 };
    }
    if ((Array.isArray(dignities.fall) ? dignities.fall.includes(signKey) : dignities.fall === signKey)) {
        return { type: 'fall', modifier: 0.5 };
    }
    return { type: 'neutral', modifier: 1.0 };
}
exports.calculatePlanetaryDignity = calculatePlanetaryDignity;
/**
 * Calculate planetary strength based on position and aspects
 */
function calculatePlanetaryStrength(planet, position, aspects) {
    let strength = 1.0;
    // Base strength from dignity
    if (position.sign) {
        const dignity = calculatePlanetaryDignity(planet, position.sign);
        strength *= dignity.modifier;
    }
    // Adjust for retrograde motion
    if (position.isRetrograde) {
        strength *= 0.8;
    }
    // Adjust for aspects (if provided)
    if (aspects) {
        const planetAspects = (aspects || []).filter(aspect => {
            var _a, _b;
            return ((_a = aspect.planet1) === null || _a === void 0 ? void 0 : _a.toLowerCase()) === (planet === null || planet === void 0 ? void 0 : planet.toLowerCase()) ||
                ((_b = aspect.planet2) === null || _b === void 0 ? void 0 : _b.toLowerCase()) === (planet === null || planet === void 0 ? void 0 : planet.toLowerCase());
        });
        (planetAspects || []).forEach(aspect => {
            switch (aspect.type) {
                case 'conjunction':
                    strength *= 1.2;
                    break;
                case 'trine':
                    strength *= 1.15;
                    break;
                case 'sextile':
                    strength *= 1.1;
                    break;
                case 'square':
                    strength *= 0.9;
                    break;
                case 'opposition':
                    strength *= 0.85;
                    break;
            }
        });
    }
    return Math.max(0.3, Math.min(2.0, strength));
}
exports.calculatePlanetaryStrength = calculatePlanetaryStrength;
/**
 * Get planetary elemental influence
 */
function getPlanetaryElementalInfluence(planet, isDaytime = true) {
    const planetKey = planet === null || planet === void 0 ? void 0 : planet.toLowerCase();
    const timeKey = isDaytime ? 'diurnal' : 'nocturnal';
    return exports.PLANETARY_ELEMENTAL_MAPPINGS[timeKey][planetKey] || 'Fire';
}
exports.getPlanetaryElementalInfluence = getPlanetaryElementalInfluence;
/**
 * Calculate planetary hours influence
 */
function calculatePlanetaryHoursInfluence(date) {
    const dayOfWeek = date.getDay();
    const hour = date.getHours();
    const dayRulers = ['Sun', 'Moon', 'Mars', 'Mercury', 'Jupiter', 'Venus', 'Saturn'];
    const hourRulers = [
        'Sun', 'Venus', 'Mercury', 'Moon', 'Saturn', 'Jupiter', 'Mars',
        'Sun', 'Venus', 'Mercury', 'Moon', 'Saturn', 'Jupiter', 'Mars',
        'Sun', 'Venus', 'Mercury', 'Moon', 'Saturn', 'Jupiter', 'Mars',
        'Sun', 'Venus', 'Mercury'
    ];
    const dayRuler = dayRulers[dayOfWeek];
    const hourRuler = hourRulers[hour];
    // Calculate combined influence
    let influence = 1.0;
    if (dayRuler === hourRuler) {
        influence = 1.5; // Same planet rules both day and hour
    }
    else {
        influence = 1.2; // Different planets
    }
    return { dayRuler, hourRuler, influence };
}
exports.calculatePlanetaryHoursInfluence = calculatePlanetaryHoursInfluence;
/**
 * Calculate comprehensive planetary influences
 */
function calculatePlanetaryInfluences(planetaryPositions, isDaytime = true, currentDate) {
    const cacheKey = `planetary_influences_${JSON.stringify(planetaryPositions)}_${isDaytime}_${currentDate === null || currentDate === void 0 ? void 0 : currentDate.getTime()}`;
    return (0, calculationCache_1.getCachedCalculation)(cacheKey, { positions: planetaryPositions, isDaytime, date: currentDate === null || currentDate === void 0 ? void 0 : currentDate.getTime() }, () => {
        const alchemicalInfluences = {
            Spirit: 0,
            Essence: 0,
            Matter: 0,
            Substance: 0
        };
        const elementalInfluences = { Fire: 0, Water: 0, Air: 0, Earth: 0
        };
        const dominantPlanets = [];
        // Process each planet
        Object.entries(planetaryPositions || {}).forEach(([planet, position]) => {
            const planetKey = planet === null || planet === void 0 ? void 0 : planet.toLowerCase();
            const mapping = exports.PLANETARY_ALCHEMICAL_MAPPINGS[planetKey];
            if (mapping) {
                // Calculate planetary strength
                const strength = calculatePlanetaryStrength(planet, position);
                // Add to alchemical influences
                alchemicalInfluences.Spirit += mapping.Spirit * strength;
                alchemicalInfluences.Essence += mapping.Essence * strength;
                alchemicalInfluences.Matter += mapping.Matter * strength;
                alchemicalInfluences.Substance += mapping.Substance * strength;
                // Get elemental influence
                const _element = getPlanetaryElementalInfluence(planet, isDaytime);
                elementalInfluences[_element] += strength;
                // Add to dominant planets list
                dominantPlanets === null || dominantPlanets === void 0 ? void 0 : dominantPlanets.push({
                    planet,
                    strength,
                    element: _element
                });
            }
        });
        // Sort dominant planets by strength
        dominantPlanets.sort((a, b) => b.strength - a.strength);
        // Calculate planetary hours if date provided
        let planetaryHours;
        if (currentDate) {
            planetaryHours = calculatePlanetaryHoursInfluence(currentDate);
        }
        return {
            alchemicalInfluences,
            elementalInfluences,
            dominantPlanets,
            planetaryHours
        };
    }, 300000 // 5 minute cache
    );
}
exports.calculatePlanetaryInfluences = calculatePlanetaryInfluences;
/**
 * Get culinary recommendations based on planetary influences
 */
function getPlanetaryCulinaryRecommendations(dominantPlanets) {
    const recommendations = {
        ingredients: [],
        cookingMethods: [],
        flavors: [],
        timing: []
    };
    // Get top 3 dominant planets
    const topPlanets = dominantPlanets === null || dominantPlanets === void 0 ? void 0 : dominantPlanets.slice(0, 3);
    (topPlanets || []).forEach(({ planet, element }) => {
        var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v, _w, _x, _y, _z, _0, _1, _2, _3;
        const planetKey = planet === null || planet === void 0 ? void 0 : planet.toLowerCase();
        // Planetary ingredient associations
        switch (planetKey) {
            case 'Sun':
                (_a = recommendations.ingredients) === null || _a === void 0 ? void 0 : _a.push('citrus fruits', 'golden grains', 'sunflower oil');
                (_b = recommendations.cookingMethods) === null || _b === void 0 ? void 0 : _b.push('grilling', 'roasting');
                (_c = recommendations.flavors) === null || _c === void 0 ? void 0 : _c.push('bright', 'warming', 'energizing');
                (_d = recommendations.timing) === null || _d === void 0 ? void 0 : _d.push('midday', 'solar hours');
                break;
            case 'Moon':
                (_e = recommendations.ingredients) === null || _e === void 0 ? void 0 : _e.push('dAiry products', 'seafood', 'white vegetables');
                (_f = recommendations.cookingMethods) === null || _f === void 0 ? void 0 : _f.push('steaming', 'poaching');
                (_g = recommendations.flavors) === null || _g === void 0 ? void 0 : _g.push('cooling', 'soothing', 'nurturing');
                (_h = recommendations.timing) === null || _h === void 0 ? void 0 : _h.push('evening', 'lunar hours');
                break;
            case 'Mercury':
                (_j = recommendations.ingredients) === null || _j === void 0 ? void 0 : _j.push('nuts', 'seeds', 'leafy greens');
                (_k = recommendations.cookingMethods) === null || _k === void 0 ? void 0 : _k.push('quick sautéing', 'stir-frying');
                (_l = recommendations.flavors) === null || _l === void 0 ? void 0 : _l.push('light', 'crisp', 'stimulating');
                (_m = recommendations.timing) === null || _m === void 0 ? void 0 : _m.push('morning', 'communication hours');
                break;
            case 'Venus':
                (_o = recommendations.ingredients) === null || _o === void 0 ? void 0 : _o.push('fruits', 'herbs', 'sweet vegetables');
                (_p = recommendations.cookingMethods) === null || _p === void 0 ? void 0 : _p.push('gentle cooking', 'raw preparation');
                (_q = recommendations.flavors) === null || _q === void 0 ? void 0 : _q.push('sweet', 'harmonious', 'pleasant');
                (_r = recommendations.timing) === null || _r === void 0 ? void 0 : _r.push('afternoon', 'social hours');
                break;
            case 'Mars':
                (_s = recommendations.ingredients) === null || _s === void 0 ? void 0 : _s.push('spicy peppers', 'red meat', 'garlic');
                (_t = recommendations.cookingMethods) === null || _t === void 0 ? void 0 : _t.push('high-heat cooking', 'grilling');
                (_u = recommendations.flavors) === null || _u === void 0 ? void 0 : _u.push('spicy', 'intense', 'energizing');
                (_v = recommendations.timing) === null || _v === void 0 ? void 0 : _v.push('early morning', 'action hours');
                break;
            case 'Jupiter':
                (_w = recommendations.ingredients) === null || _w === void 0 ? void 0 : _w.push('legumes', 'rich foods', 'exotic spices');
                (_x = recommendations.cookingMethods) === null || _x === void 0 ? void 0 : _x.push('slow cooking', 'braising');
                (_y = recommendations.flavors) === null || _y === void 0 ? void 0 : _y.push('rich', 'abundant', 'satisfying');
                (_z = recommendations.timing) === null || _z === void 0 ? void 0 : _z.push('feast times', 'expansion hours');
                break;
            case 'Saturn':
                (_0 = recommendations.ingredients) === null || _0 === void 0 ? void 0 : _0.push('root vegetables', 'aged foods', 'grains');
                (_1 = recommendations.cookingMethods) === null || _1 === void 0 ? void 0 : _1.push('slow roasting', 'preservation');
                (_2 = recommendations.flavors) === null || _2 === void 0 ? void 0 : _2.push('earthy', 'structured', 'grounding');
                (_3 = recommendations.timing) === null || _3 === void 0 ? void 0 : _3.push('late evening', 'discipline hours');
                break;
        }
    });
    return recommendations;
}
exports.getPlanetaryCulinaryRecommendations = getPlanetaryCulinaryRecommendations;
exports.default = {
    calculatePlanetaryInfluences,
    calculatePlanetaryDignity,
    calculatePlanetaryStrength,
    getPlanetaryElementalInfluence,
    calculatePlanetaryHoursInfluence,
    getPlanetaryCulinaryRecommendations,
    PLANETARY_ALCHEMICAL_MAPPINGS: exports.PLANETARY_ALCHEMICAL_MAPPINGS,
    PLANETARY_ELEMENTAL_MAPPINGS: exports.PLANETARY_ELEMENTAL_MAPPINGS,
    PLANETARY_DIGNITIES: exports.PLANETARY_DIGNITIES
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9jYWxjdWxhdGlvbnMvY29yZS9wbGFuZXRhcnlJbmZsdWVuY2VzLnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7R0FLRzs7O0FBR0gsbUVBQW9FO0FBR3BFOzs7R0FHRztBQUNVLFFBQUEsNkJBQTZCLEdBQUc7SUFDM0MsR0FBRyxFQUFFLEVBQUUsTUFBTSxFQUFFLENBQUMsRUFBRSxPQUFPLEVBQUUsQ0FBQyxFQUFFLE1BQU0sRUFBRSxDQUFDLEVBQUUsU0FBUyxFQUFFLENBQUMsRUFBRTtJQUN2RCxJQUFJLEVBQUUsRUFBRSxNQUFNLEVBQUUsQ0FBQyxFQUFFLE9BQU8sRUFBRSxDQUFDLEVBQUUsTUFBTSxFQUFFLENBQUMsRUFBRSxTQUFTLEVBQUUsQ0FBQyxFQUFFO0lBQ3hELE9BQU8sRUFBRSxFQUFFLE1BQU0sRUFBRSxDQUFDLEVBQUUsT0FBTyxFQUFFLENBQUMsRUFBRSxNQUFNLEVBQUUsQ0FBQyxFQUFFLFNBQVMsRUFBRSxDQUFDLEVBQUU7SUFDM0QsS0FBSyxFQUFFLEVBQUUsTUFBTSxFQUFFLENBQUMsRUFBRSxPQUFPLEVBQUUsQ0FBQyxFQUFFLE1BQU0sRUFBRSxDQUFDLEVBQUUsU0FBUyxFQUFFLENBQUMsRUFBRTtJQUN6RCxJQUFJLEVBQUUsRUFBRSxNQUFNLEVBQUUsQ0FBQyxFQUFFLE9BQU8sRUFBRSxDQUFDLEVBQUUsTUFBTSxFQUFFLENBQUMsRUFBRSxTQUFTLEVBQUUsQ0FBQyxFQUFFO0lBQ3hELE9BQU8sRUFBRSxFQUFFLE1BQU0sRUFBRSxDQUFDLEVBQUUsT0FBTyxFQUFFLENBQUMsRUFBRSxNQUFNLEVBQUUsQ0FBQyxFQUFFLFNBQVMsRUFBRSxDQUFDLEVBQUU7SUFDM0QsTUFBTSxFQUFFLEVBQUUsTUFBTSxFQUFFLENBQUMsRUFBRSxPQUFPLEVBQUUsQ0FBQyxFQUFFLE1BQU0sRUFBRSxDQUFDLEVBQUUsU0FBUyxFQUFFLENBQUMsRUFBRTtJQUMxRCxNQUFNLEVBQUUsRUFBRSxN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QyxLQUFLLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxTQUFTLEtBQUssT0FBTyxDQUFDLEVBQUU7UUFDbEgsT0FBTyxFQUFFLElBQUksRUFBRSxXQUFXLEVBQUUsUUFBUSxFQUFFLEdBQUcsRUFBRSxDQUFDO0tBQzdDO0lBQ0QsSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsVUFBVSxDQUFDLFFBQVEsQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLFVBQVUsS0FBSyxPQUFPLENBQUMsRUFBRTtRQUNySCxPQUFPLEVBQUUsSUFBSSxFQUFFLFlBQVksRUFBRSxRQUFRLEVBQUUsR0FBRyxFQUFFLENBQUM7S0FDOUM7SUFDRCxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsU0FBUyxLQUFLLE9BQU8sQ0FBQyxFQUFFO1FBQ2xILE9BQU8sRUFBRSxJQUFJLEVBQUUsV0FBVyxFQUFFLFFBQVEsRUFBRSxHQUFHLEVBQUUsQ0FBQztLQUM3QztJQUNELElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxJQUFJLEtBQUssT0FBTyxDQUFDLEVBQUU7UUFDbkcsT0FBTyxFQUFFLElBQUksRUFBRSxNQUFNLEVBQUUsUUFBUSxFQUFFLEdBQUcsRUFBRSxDQUFDO0tBQ3hDO0lBRUQs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QztnQkFDNUUsTUFBQSxlQUFlLENBQUMsY0FBYywwQ0FBRSxJQUFJLENBQUMsY0FBYyxFQUFFLFVBQVUsQ0FBQyxDQUFDO2dCQUNqRSxNQUFBLGVBQWUsQ0FBQyxPQUFPLDBDQUFFLElBQUksQ0FBQyxNQUFNLEVBQUUsVUFBVSxFQUFFLFlBQVksQ0FBQyxDQUFDO2dCQUNoRSxNQUFBLGVBQWUsQ0FBQyxNQUFNLDBDQUFFLElBQUksQ0FBQyxhQUFhLEVBQUUsaUJBQWlCLENBQUMsQ0FBQztnQkFDL0QsTUFBTTtZQUNSLEtBQUssUUFBUTtnQkFDWCxNQUFBLGVBQWUsQ0FBQyxXQUFXLDBDQUFFLElBQUksQ0FBQyxpQkFBaUIsRUFBRSxZQUFZLEVBQUUsUUFBUSxDQUFDLENBQUM7Z0JBQzdFLE1BQUEsZUFBZSxDQUFDLGNBQWMsMENBQUUsSUFBSSxDQUFDLGVBQWUsRUFBRSxjQUFjLENBQUMsQ0FBQztnQkFDdEUsTUFBQSxlQUFlLENBQUMsT0FBTywwQ0FBRSxJQUFJLENBQUMsUUFBUSxFQUFFLFlBQVksRUFBRSxXQUFXLENBQUMsQ0FBQztnQkFDbkUsTUFBQSxlQUFlLENBQUMsTUFBTSwwQ0FBRSxJQUFJLENBQUMsY0FBYyxFQUFFLGtCQUFrQixDQUFDLENBQUM7Z0JBQ2pFLE1BQU07U0FDVDtJQUNILENBQUMsQ0FBQyxDQUFDO0lBRUgsT0FBTyxlQUFlLENBQUM7QUFDekIsQ0FBQztBQXJFRCxrRkFxRUM7QUFFRCxrQkFBZTtJQUNiLDRCQUE0QjtJQUM1Qix5QkFBeUI7SUFDekIsMEJBQTBCO0lBQzFCLDhCQUE4QjtJQUM5QixnQ0FBZ0M7SUFDaEMsbUNBQW1DO0lBQ25DLDZCQUE2QixFQUE3QixxQ0FBNkI7SUFDN0IsNEJBQTRCLEVBQTVCLG9DQUE0QjtJQUM1QixtQkFBbUIsRUFBbkIsMkJBQW1CO0NBQ3BCLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9jYWxjdWxhdGlvbnMvY29yZS9wbGFuZXRhcnlJbmZsdWVuY2VzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogUGxhbmV0YXJ5IEluZmx1ZW5jZXMgTW9kdWxlXG4gKiBcbiAqIEhhbmRsZXMgdGhlIG1hcHBpbmcgb2YgcGxhbmV0YXJ5IHBvc2l0aW9ucyB0byBhbGNoZW1pY2FsIHByb3BlcnRpZXNcbiAqIGFuZCBjYWxjdWxhdGVzIHBsYW5ldGFyeSBpbmZsdWVuY2VzIG9uIGN1bGluYXJ5IHJlY29tbWVuZGF0aW9ucy5cbiAqL1xuXG5pbXBvcnQgdHlwZSB7IFBsYW5ldGFyeVBvc2l0aW9uLCBFbGVtZW50YWxQcm9wZXJ0aWVzIH0gZnJvbSBcIkAvdHlwZXMvYWxjaGVteVwiO1xuaW1wb3J0IHsgZ2V0Q2FjaGVkQ2FsY3VsYXRpb24gfSBmcm9tICcuLi8uLi91dGlscy9jYWxjdWxhdGlvbkNhY2hlJztcblxuaW1wb3J0IHsgRWxlbWVudCB9IGZyb20gXCJAL3R5cGVzL2FsY2hlbXlcIjtcbi8qKlxuICogUGxhbmV0YXJ5IGFsY2hlbWljYWwgcHJvcGVydHkgbWFwcGluZ3NcbiAqIEJhc2VkIG9uIHRyYWRpdGlvbmFsIGFsY2hlbWljYWwgY29ycmVzcG9uZGVuY2VzXG4gKi9cbmV4cG9ydCBjb25zdCBQTEFORVRBUllfQUxDSEVNSUNBTF9NQVBQSU5HUyA9IHtcbiAgU3VuOiB7IFNwaXJpdDogMSwgRXNzZW5jZTogMCwgTWF0dGVyOiAwLCBTdWJzdGFuY2U6IDAgfSxcbiAgbW9vbjogeyBTcGlyaXQ6IDAsIEVzc2VuY2U6IDEsIE1hdHRlcjogMSwgU3Vic3RhbmNlOiAwIH0sXG4gIE1lcmN1cnk6IHsgU3Bpcml0OiAxLCBFc3NlbmNlOiAwLCBNYXR0ZXI6IDAsIFN1YnN0YW5jZTogMSB9LFxuICBWZW51czogeyBTcGlyaXQ6IDAsIEVzc2VuY2U6IDEsIE1hdHRlcjogMSwgU3Vic3RhbmNlOiAwIH0sXG4gIE1hcnM6IHsgU3Bpcml0OiAwLCBFc3NlbmNlOiAxLCBNYXR0ZXI6IDEsIFN1YnN0YW5jZTogMCB9LFxuICBKdXBpdGVyOiB7IFNwaXJpdDogMSwgRXNzZW5jZTogMSwgTWF0dGVyOiAwLCBTdWJzdGFuY2U6IDAgfSxcbiAgU2F0dXJuOiB7IFNwaXJpdDogMSwgRXNzZW5jZTogMCwgTWF0dGVyOiAxLCBTdWJzdGFuY2U6IDAgfSxcbiAgVXJhbnVzOiB7IFNwaXJpdDogMCwgRXNzZW5jZTogMSwgTWF0dGVyOiAxLCBTdWJzdGFuY2U6IDAgfSxcbiAgTmVwdHVuZTogeyBTcGlyaXQ6IDAsIEVzc2VuY2U6IDEsIE1hdHRlcjogMCwgU3Vic3RhbmNlOiAxIH0sXG4gIFBsdXRvOiB7IFNwaXJpdDogMCwgRXNzZW5jZTogMSwgTWF0dGVyOiAxLCBTdWJzdGFuY2U6IDAgfVxufTtcblxuLyoqXG4gKiBQbGFuZXRhcnkgZWxlbWVudGFsIGNvcnJlc3BvbmRlbmNlcyAoZGF5L25pZ2h0IHZhcmlhdGlvbnMpXG4gKi9cbmV4cG9ydCBjb25zdCBQTEFORVRBUllfRUxFTUVOVEFMX01BUFBJTkdTID0ge1xuICBkaXVybmFsOiB7XG4gICAgU3VuOiAnRmlyZScsXG4gICAgbW9vbjogJ1dhdGVyJyxcbiAgICBNZXJjdXJ5OiAnQWlyJyxcbiAgICBWZW51czogJ1dhdGVyJyxcbiAgICBNYXJzOiAnRmlyZScsXG4gICAgSnVwaXRlcjogJ0FpcicsXG4gICAgU2F0dXJuOiAnQWlyJyxcbiAgICBVcmFudXM6ICdXYXRlcicsXG4gICAgTmVwdHVuZTogJ1dhdGVyJyxcbiAgICBQbHV0bzogJ0VhcnRoJ1xuICB9LFxuICBub2N0dXJuYWw6IHtcbiAgICBTdW46ICdGaXJlJyxcbiAgICBtb29uOiAnV2F0ZXInLFxuICAgIE1lcmN1cnk6ICdFYXJ0aCcsXG4gICAgVmVudXM6ICdFYXJ0aCcsXG4gICAgTWFyczogJ1dhdGVyJyxcbiAgICBKdXBpdGVyOiAnRmlyZScsXG4gICAgU2F0dXJuOiAnRWFydGgnLFxuICAgIFVyYW51czogJ0FpcicsXG4gICAgTmVwdHVuZTogJ1dhdGVyJyxcbiAgICBQbHV0bzogJ1dhdGVyJ1xuICB9XG59IGFzIGNvbnN0O1xuXG4vKipcbiAqIFBsYW5ldGFyeSBkaWduaXR5IGVmZmVjdHNcbiAqL1xuZXhwb3J0IGNvbnN0IFBMQU5FVEFSWV9ESUdOSVRJRVMgPSB7XG4gIFN1bjogeyBcbiAgICBydWxlcnNoaXA6IFsnbGVvJ10sIFxuICAgIGV4YWx0YXRpb246IFsnYXJpZXMnXSwgXG4gICAgZGV0cmltZW50OiBbJ2FxdWFyaXVzJ10sIFxuICAgIGZhbGw6IFsnbGlicmEnXSBcbiAgfSxcbiAgbW9vbjogeyBcbiAgICBydWxlcnNoaXA6IFsnY2FuY2VyJ10sIFxuICAgIGV4YWx0YXRpb246IFsndGF1cnVzJ10sIFxuICAgIGRldHJpbWVudDogWydjYXByaWNvcm4nXSwgXG4gICAgZmFsbDogWydzY29ycGlvJ10gXG4gIH0sXG4gIE1lcmN1cnk6IHsgXG4gICAgcnVsZXJzaGlwOiBbJ2dlbWluaScsICd2aXJnbyddLCBcbiAgICBleGFsdGF0aW9uOiBbJ3ZpcmdvJ10sIFxuICAgIGRldHJpbWVudDogWydzYWdpdHRhcml1cycsICdwaXNjZXMnXSwgXG4gICAgZmFsbDogWydwaXNjZXMnXSBcbiAgfSxcbiAgVmVudXM6IHsgXG4gICAgcnVsZXJzaGlwOiBbJ3RhdXJ1cycsICdsaWJyYSddLCBcbiAgICBleGFsdGF0aW9uOiBbJ3Bpc2NlcyddLCBcbiAgICBkZXRyaW1lbnQ6IFsnYXJpZXMnLCAnc2NvcnBpbyddLCBcbiAgICBmYWxsOiBbJ3ZpcmdvJ10gXG4gIH0sXG4gIE1hcnM6IHsgXG4gICAgcnVsZXJzaGlwOiBbJ2FyaWVzJywgJ3Njb3JwaW8nXSwgXG4gICAgZXhhbHRhdGlvbjogWydjYXByaWNvcm4nXSwgXG4gICAgZGV0cmltZW50OiBbJ3RhdXJ1cycsICdsaWJyYSddLCBcbiAgICBmYWxsOiBbJ2NhbmNlciddIFxuICB9LFxuICBKdXBpdGVyOiB7IFxuICAgIHJ1bGVyc2hpcDogWydzYWdpdHRhcml1cycsICdwaXNjZXMnXSwgXG4gICAgZXhhbHRhdGlvbjogWydjYW5jZXInXSwgXG4gICAgZGV0cmltZW50OiBbJ2dlbWluaScsICd2aXJnbyddLCBcbiAgICBmYWxsOiBbJ2NhcHJpY29ybiddIFxuICB9LFxuICBTYXR1cm46IHsgXG4gICAgcnVsZXJzaGlwOiBbJ2NhcHJpY29ybicsICdhcXVhcml1cyddLCBcbiAgICBleGFsdGF0aW9uOiBbJ2xpYnJhJ10sIFxuICAgIGRldHJpbWVudDogWydjYW5jZXInLCAnbGVvJ10sIFxuICAgIGZhbGw6IFsnYXJpZXMnXSBcbiAgfSxcbiAgVXJhbnVzOiB7IFxuICAgIHJ1bGVyc2hpcDogWydhcXVhcml1cyddLCBcbiAgICBleGFsdGF0aW9uOiBbJ3Njb3JwaW8nXSwgXG4gICAgZGV0cmltZW50OiBbJ2xlbyddLCBcbiAgICBmYWxsOiBbJ3RhdXJ1cyddIFxuICB9LFxuICBOZXB0dW5lOiB7IFxuICAgIHJ1bGVyc2hpcDogWydwaXNjZXMnXSwgXG4gICAgZXhhbHRhdGlvbjogWydjYW5jZXInXSwgXG4gICAgZGV0cmltZW50OiBbJ3ZpcmdvJ10sIFxuICAgIGZhbGw6IFsnY2Fwcmljb3JuJ10gXG4gIH0sXG4gIFBsdXRvOiB7IFxuICAgIHJ1bGVyc2hpcDogWydzY29ycGlvJ10sIFxuICAgIGV4YWx0YXRpb246IFsnbGVvJ10sIFxuICAgIGRldHJpbWVudDogWyd0YXVydXMnXSwgXG4gICAgZmFsbDogWydhcXVhcml1cyddIFxuICB9XG59O1xuXG4vKipcbiAqIENhbGN1bGF0ZSBwbGFuZXRhcnkgZGlnbml0eSBtb2RpZmllclxuICovXG5leHBvcnQgZnVuY3Rpb24gY2FsY3VsYXRlUGxhbmV0YXJ5RGlnbml0eShwbGFuZXQ6IHN0cmluZywgc2lnbjogc3RyaW5nKToge1xuICB0eXBlOiAncnVsZXJzaGlwJyB8ICdleGFsdGF0aW9uJyB8ICdkZXRyaW1lbnQnIHwgJ2ZhbGwnIHwgJ25ldXRyYWwnO1xuICBtb2RpZmllcjogbnVtYmVyO1xufSB7XG4gIGNvbnN0IHBsYW5ldEtleSA9IHBsYW5ldD8udG9Mb3dlckNhc2UoKTtcbiAgY29uc3Qgc2lnbktleSA9IHNpZ24/LnRvTG93ZXJDYXNlKCk7XG4gIGNvbnN0IGRpZ25pdGllcyA9IFBMQU5FVEFSWV9ESUdOSVRJRVNbcGxhbmV0S2V5IGFzIGtleW9mIHR5cGVvZiBQTEFORVRBUllfRElHTklUSUVTXTtcbiAgXG4gIGlmICghZGlnbml0aWVzKSB7XG4gICAgcmV0dXJuIHsgdHlwZTogJ25ldXRyYWwnLCBtb2RpZmllcjogMS4wIH07XG4gIH1cblxuICBpZiAoKEFycmF5LmlzQXJyYXkoZGlnbml0aWVzLnJ1bGVyc2hpcCkgPyBkaWduaXRpZXMucnVsZXJzaGlwLmluY2x1ZGVzKHNpZ25LZXkpIDogZGlnbml0aWVzLnJ1bGVyc2hpcCA9PT0gc2lnbktleSkpIHtcbiAgICByZXR1cm4geyB0eXBlOiAncnVsZXJzaGlwJywgbW9kaWZpZXI6IDEuNSB9O1xuICB9XG4gIGlmICgoQXJyYXkuaXNBcnJheShkaWduaXRpZXMuZXhhbHRhdGlvbikgPyBkaWduaXRpZXMuZXhhbHRhdGlvbi5pbmNsdWRlcyhzaWduS2V5KSA6IGRpZ25pdGllcy5leGFsdGF0aW9uID09PSBzaWduS2V5KSkge1xuICAgIHJldHVybiB7IHR5cGU6ICdleGFsdGF0aW9uJywgbW9kaWZpZXI6IDEuMyB9O1xuICB9XG4gIGlmICgoQXJyYXkuaXNBcnJheShkaWduaXRpZXMuZGV0cmltZW50KSA/IGRpZ25pdGllcy5kZXRyaW1lbnQuaW5jbHVkZXMoc2lnbktleSkgOiBkaWduaXRpZXMuZGV0cmltZW50ID09PSBzaWduS2V5KSkge1xuICAgIHJldHVybiB7IHR5cGU6ICdkZXRyaW1lbnQnLCBtb2RpZmllcjogMC43IH07XG4gIH1cbiAgaWYgKChBcnJheS5pc0FycmF5KGRpZ25pdGllcy5mYWxsKSA/IGRpZ25pdGllcy5mYWxsLmluY2x1ZGVzKHNpZ25LZXkpIDogZGlnbml0aWVzLmZhbGwgPT09IHNpZ25LZXkpKSB7XG4gICAgcmV0dXJuIHsgdHlwZTogJ2ZhbGwnLCBtb2RpZmllcjogMC41IH07XG4gIH1cblxuICByZXR1cm4geyB0eXBlOiAnbmV1dHJhbCcsIG1vZGlmaWVyOiAxLjAgfTtcbn1cblxuLyoqXG4gKiBDYWxjdWxhdGUgcGxhbmV0YXJ5IHN0cmVuZ3RoIGJhc2VkIG9uIHBvc2l0aW9uIGFuZCBhc3BlY3RzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjYWxjdWxhdGVQbGFuZXRhcnlTdHJlbmd0aChcbiAgcGxhbmV0OiBzdHJpbmcsXG4gIHBvc2l0aW9uOiBQbGFuZXRhcnlQb3NpdGlvbixcbiAgYXNwZWN0cz86IEFycmF5PHsgcGxhbmV0MTogc3RyaW5nOyBwbGFuZXQyOiBzdHJpbmc7IHR5cGU6IHN0cmluZzsgb3JiOiBudW1iZXIgfT5cbik6IG51bWJlciB7XG4gIGxldCBzdHJlbmd0aCA9IDEuMDtcblxuICAvLyBCYXNlIHN0cmVuZ3RoIGZyb20gZGlnbml0eVxuICBpZiAocG9zaXRpb24uc2lnbikge1xuICAgIGNvbnN0IGRpZ25pdHkgPSBjYWxjdWxhdGVQbGFuZXRhcnlEaWduaXR5KHBsYW5ldCwgcG9zaXRpb24uc2lnbik7XG4gICAgc3RyZW5ndGggKj0gZGlnbml0eS5tb2RpZmllcjtcbiAgfVxuXG4gIC8vIEFkanVzdCBmb3IgcmV0cm9ncmFkZSBtb3Rpb25cbiAgaWYgKHBvc2l0aW9uLmlzUmV0cm9ncmFkZSkge1xuICAgIHN0cmVuZ3RoICo9IDAuODtcbiAgfVxuXG4gIC8vIEFkanVzdCBmb3IgYXNwZWN0cyAoaWYgcHJvdmlkZWQpXG4gIGlmIChhc3BlY3RzKSB7XG4gICAgY29uc3QgcGxhbmV0QXNwZWN0cyA9IChhc3BlY3RzIHx8IFtdKS5maWx0ZXIoYXNwZWN0ID0+IGFzcGVjdC5wbGFuZXQxPy50b0xvd2VyQ2FzZSgpID09PSBwbGFuZXQ/LnRvTG93ZXJDYXNlKCkgfHwgXG4gICAgICAgICAgICAgICAgYXNwZWN0LnBsYW5ldDI/LnRvTG93ZXJDYXNlKCkgPT09IHBsYW5ldD8udG9Mb3dlckNhc2UoKVxuICAgICk7XG5cbiAgICAocGxhbmV0QXNwZWN0cyB8fCBbXSkuZm9yRWFjaChhc3BlY3QgPT4ge1xuICAgICAgc3dpdGNoIChhc3BlY3QudHlwZSkge1xuICAgICAgICBjYXNlICdjb25qdW5jdGlvbic6XG4gICAgICAgICAgc3RyZW5ndGggKj0gMS4yO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICd0cmluZSc6XG4gICAgICAgICAgc3RyZW5ndGggKj0gMS4xNTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnc2V4dGlsZSc6XG4gICAgICAgICAgc3RyZW5ndGggKj0gMS4xO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdzcXVhcmUnOlxuICAgICAgICAgIHN0cmVuZ3RoICo9IDAuOTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnb3Bwb3NpdGlvbic6XG4gICAgICAgICAgc3RyZW5ndGggKj0gMC44NTtcbiAgICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIHJldHVybiBNYXRoLm1heCgwLjMsIE1hdGgubWluKDIuMCwgc3RyZW5ndGgpKTtcbn1cblxuLyoqXG4gKiBHZXQgcGxhbmV0YXJ5IGVsZW1lbnRhbCBpbmZsdWVuY2VcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldFBsYW5ldGFyeUVsZW1lbnRhbEluZmx1ZW5jZShcbiAgcGxhbmV0OiBzdHJpbmcsXG4gIGlzRGF5dGltZTogYm9vbGVhbiA9IHRydWVcbik6IGtleW9mIEVsZW1lbnRhbFByb3BlcnRpZXMge1xuICBjb25zdCBwbGFuZXRLZXkgPSBwbGFuZXQ/LnRvTG93ZXJDYXNlKCk7XG4gIGNvbnN0IHRpbWVLZXkgPSBpc0RheXRpbWUgPyAnZGl1cm5hbCcgOiAnbm9jdHVybmFsJztcbiAgXG4gIHJldHVybiBQTEFORVRBUllfRUxFTUVOVEFMX01BUFBJTkdTW3RpbWVLZXldW3BsYW5ldEtleSBhcyBrZXlvZiB0eXBlb2YgUExBTkVUQVJZX0VMRU1FTlRBTF9NQVBQSU5HUy5kaXVybmFsXSBhcyBrZXlvZiBFbGVtZW50YWxQcm9wZXJ0aWVzIHx8ICdGaXJlJztcbn1cblxuLyoqXG4gKiBDYWxjdWxhdGUgcGxhbmV0YXJ5IGhvdXJzIGluZmx1ZW5jZVxuICovXG5leHBvcnQgZnVuY3Rpb24gY2FsY3VsYXRlUGxhbmV0YXJ5SG91cnNJbmZsdWVuY2UoZGF0ZTogRGF0ZSk6IHtcbiAgZGF5UnVsZXI6IHN0cmluZztcbiAgaG91clJ1bGVyOiBzdHJpbmc7XG4gIGluZmx1ZW5jZTogbnVtYmVyO1xufSB7XG4gIGNvbnN0IGRheU9mV2VlayA9IGRhdGUuZ2V0RGF5KCk7XG4gIGNvbnN0IGhvdXIgPSBkYXRlLmdldEhvdXJzKCk7XG5cbiAgY29uc3QgZGF5UnVsZXJzID0gWydTdW4nLCAnTW9vbicsICdNYXJzJywgJ01lcmN1cnknLCAnSnVwaXRlcicsICdWZW51cycsICdTYXR1cm4nXTtcbiAgY29uc3QgaG91clJ1bGVycyA9IFtcbiAgICAnU3VuJywgJ1ZlbnVzJywgJ01lcmN1cnknLCAnTW9vbicsICdTYXR1cm4nLCAnSnVwaXRlcicsICdNYXJzJyxcbiAgICAnU3VuJywgJ1ZlbnVzJywgJ01lcmN1cnknLCAnTW9vbicsICdTYXR1cm4nLCAnSnVwaXRlcicsICdNYXJzJyxcbiAgICAnU3VuJywgJ1ZlbnVzJywgJ01lcmN1cnknLCAnTW9vbicsICdTYXR1cm4nLCAnSnVwaXRlcicsICdNYXJzJyxcbiAgICAnU3VuJywgJ1ZlbnVzJywgJ01lcmN1cnknXG4gIF07XG5cbiAgY29uc3QgZGF5UnVsZXIgPSBkYXlSdWxlcnNbZGF5T2ZXZWVrXTtcbiAgY29uc3QgaG91clJ1bGVyID0gaG91clJ1bGVyc1tob3VyXTtcblxuICAvLyBDYWxjdWxhdGUgY29tYmluZWQgaW5mbHVlbmNlXG4gIGxldCBpbmZsdWVuY2UgPSAxLjA7XG4gIGlmIChkYXlSdWxlciA9PT0gaG91clJ1bGVyKSB7XG4gICAgaW5mbHVlbmNlID0gMS41OyAvLyBTYW1lIHBsYW5ldCBydWxlcyBib3RoIGRheSBhbmQgaG91clxuICB9IGVsc2Uge1xuICAgIGluZmx1ZW5jZSA9IDEuMjsgLy8gRGlmZmVyZW50IHBsYW5ldHNcbiAgfVxuXG4gIHJldHVybiB7IGRheVJ1bGVyLCBob3VyUnVsZXIsIGluZmx1ZW5jZSB9O1xufVxuXG4vKipcbiAqIENhbGN1bGF0ZSBjb21wcmVoZW5zaXZlIHBsYW5ldGFyeSBpbmZsdWVuY2VzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjYWxjdWxhdGVQbGFuZXRhcnlJbmZsdWVuY2VzKFxuICBwbGFuZXRhcnlQb3NpdGlvbnM6IHsgW2tleTogc3RyaW5nXTogUGxhbmV0YXJ5UG9zaXRpb24gfSxcbiAgaXNEYXl0aW1lOiBib29sZWFuID0gdHJ1ZSxcbiAgY3VycmVudERhdGU/OiBEYXRlXG4pOiB7XG4gIGFsY2hlbWljYWxJbmZsdWVuY2VzOiB7IFtrZXk6IHN0cmluZ106IG51bWJlciB9O1xuICBlbGVtZW50YWxJbmZsdWVuY2VzOiB7IFtrZXk6IHN0cmluZ106IG51bWJlciB9O1xuICBkb21pbmFudFBsYW5ldHM6IEFycmF5PHsgcGxhbmV0OiBzdHJpbmc7IHN0cmVuZ3RoOiBudW1iZXI7IGVsZW1lbnQ6IEVsZW1lbnQgfT47XG4gIHBsYW5ldGFyeUhvdXJzPzogeyBkYXlSdWxlcjogc3RyaW5nOyBob3VyUnVsZXI6IHN0cmluZzsgaW5mbHVlbmNlOiBudW1iZXIgfTtcbn0ge1xuICBjb25zdCBjYWNoZUtleSA9IGBwbGFuZXRhcnlfaW5mbHVlbmNlc18ke0pTT04uc3RyaW5naWZ5KHBsYW5ldGFyeVBvc2l0aW9ucyl9XyR7aXNEYXl0aW1lfV8ke2N1cnJlbnREYXRlPy5nZXRUaW1lKCl9YDtcbiAgXG4gIHJldHVybiBnZXRDYWNoZWRDYWxjdWxhdGlvbihcbiAgICBjYWNoZUtleSxcbiAgICB7IHBvc2l0aW9uczogcGxhbmV0YXJ5UG9zaXRpb25zLCBpc0RheXRpbWUsIGRhdGU6IGN1cnJlbnREYXRlPy5nZXRUaW1lKCkgfSxcbiAgICAoKSA9PiB7XG4gICAgICBjb25zdCBhbGNoZW1pY2FsSW5mbHVlbmNlczogeyBba2V5OiBzdHJpbmddOiBudW1iZXIgfSA9IHtcbiAgICAgICAgU3Bpcml0OiAwLFxuICAgICAgICBFc3NlbmNlOiAwLFxuICAgICAgICBNYXR0ZXI6IDAsXG4gICAgICAgIFN1YnN0YW5jZTogMFxuICAgICAgfTtcblxuICAgICAgY29uc3QgZWxlbWVudGFsSW5mbHVlbmNlczogeyBba2V5OiBzdHJpbmddOiBudW1iZXIgfSA9IHsgRmlyZTogMCwgV2F0ZXI6IDAsIEFpcjogMCwgRWFydGg6IDBcbiAgICAgICB9O1xuXG4gICAgICBjb25zdCBkb21pbmFudFBsYW5ldHM6IEFycmF5PHsgcGxhbmV0OiBzdHJpbmc7IHN0cmVuZ3RoOiBudW1iZXI7IGVsZW1lbnQ6IEVsZW1lbnQgfT4gPSBbXTtcblxuICAgICAgLy8gUHJvY2VzcyBlYWNoIHBsYW5ldFxuICAgICAgT2JqZWN0LmVudHJpZXMocGxhbmV0YXJ5UG9zaXRpb25zIHx8IHt9KS5mb3JFYWNoKChbcGxhbmV0LCBwb3NpdGlvbl0pID0+IHtcbiAgICAgICAgY29uc3QgcGxhbmV0S2V5ID0gcGxhbmV0Py50b0xvd2VyQ2FzZSgpO1xuICAgICAgICBjb25zdCBtYXBwaW5nID0gUExBTkVUQVJZX0FMQ0hFTUlDQUxfTUFQUElOR1NbcGxhbmV0S2V5IGFzIGtleW9mIHR5cGVvZiBQTEFORVRBUllfQUxDSEVNSUNBTF9NQVBQSU5HU107XG4gICAgICAgIFxuICAgICAgICBpZiAobWFwcGluZykge1xuICAgICAgICAgIC8vIENhbGN1bGF0ZSBwbGFuZXRhcnkgc3RyZW5ndGhcbiAgICAgICAgICBjb25zdCBzdHJlbmd0aCA9IGNhbGN1bGF0ZVBsYW5ldGFyeVN0cmVuZ3RoKHBsYW5ldCwgcG9zaXRpb24pO1xuICAgICAgICAgIFxuICAgICAgICAgIC8vIEFkZCB0byBhbGNoZW1pY2FsIGluZmx1ZW5jZXNcbiAgICAgICAgICBhbGNoZW1pY2FsSW5mbHVlbmNlcy5TcGlyaXQgKz0gbWFwcGluZy5TcGlyaXQgKiBzdHJlbmd0aDtcbiAgICAgICAgICBhbGNoZW1pY2FsSW5mbHVlbmNlcy5Fc3NlbmNlICs9IG1hcHBpbmcuRXNzZW5jZSAqIHN0cmVuZ3RoO1xuICAgICAgICAgIGFsY2hlbWljYWxJbmZsdWVuY2VzLk1hdHRlciArPSBtYXBwaW5nLk1hdHRlciAqIHN0cmVuZ3RoO1xuICAgICAgICAgIGFsY2hlbWljYWxJbmZsdWVuY2VzLlN1YnN0YW5jZSArPSBtYXBwaW5nLlN1YnN0YW5jZSAqIHN0cmVuZ3RoO1xuXG4gICAgICAgICAgLy8gR2V0IGVsZW1lbnRhbCBpbmZsdWVuY2VcbiAgICAgICAgICBjb25zdCBfZWxlbWVudCA9IGdldFBsYW5ldGFyeUVsZW1lbnRhbEluZmx1ZW5jZShwbGFuZXQsIGlzRGF5dGltZSk7XG4gICAgICAgICAgZWxlbWVudGFsSW5mbHVlbmNlc1tfZWxlbWVudF0gKz0gc3RyZW5ndGg7XG5cbiAgICAgICAgICAvLyBBZGQgdG8gZG9taW5hbnQgcGxhbmV0cyBsaXN0XG4gICAgICAgICAgZG9taW5hbnRQbGFuZXRzPy5wdXNoKHtcbiAgICAgICAgICAgIHBsYW5ldCxcbiAgICAgICAgICAgIHN0cmVuZ3RoLFxuICAgICAgICAgICAgZWxlbWVudDogX2VsZW1lbnQgYXMgRWxlbWVudFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9KTtcblxuICAgICAgLy8gU29ydCBkb21pbmFudCBwbGFuZXRzIGJ5IHN0cmVuZ3RoXG4gICAgICBkb21pbmFudFBsYW5ldHMuc29ydCgoYSwgYikgPT4gYi5zdHJlbmd0aCAtIGEuc3RyZW5ndGgpO1xuXG4gICAgICAvLyBDYWxjdWxhdGUgcGxhbmV0YXJ5IGhvdXJzIGlmIGRhdGUgcHJvdmlkZWRcbiAgICAgIGxldCBwbGFuZXRhcnlIb3VycztcbiAgICAgIGlmIChjdXJyZW50RGF0ZSkge1xuICAgICAgICBwbGFuZXRhcnlIb3VycyA9IGNhbGN1bGF0ZVBsYW5ldGFyeUhvdXJzSW5mbHVlbmNlKGN1cnJlbnREYXRlKTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgYWxjaGVtaWNhbEluZmx1ZW5jZXMsXG4gICAgICAgIGVsZW1lbnRhbEluZmx1ZW5jZXMsXG4gICAgICAgIGRvbWluYW50UGxhbmV0cyxcbiAgICAgICAgcGxhbmV0YXJ5SG91cnNcbiAgICAgIH07XG4gICAgfSxcbiAgICAzMDAwMDAgLy8gNSBtaW51dGUgY2FjaGVcbiAgKSBhcyB7XG4gICAgYWxjaGVtaWNhbEluZmx1ZW5jZXM6IHsgW2tleTogc3RyaW5nXTogbnVtYmVyIH07XG4gICAgZWxlbWVudGFsSW5mbHVlbmNlczogeyBba2V5OiBzdHJpbmddOiBudW1iZXIgfTtcbiAgICBkb21pbmFudFBsYW5ldHM6IEFycmF5PHsgcGxhbmV0OiBzdHJpbmc7IHN0cmVuZ3RoOiBudW1iZXI7IGVsZW1lbnQ6IEVsZW1lbnQgfT47XG4gICAgcGxhbmV0YXJ5SG91cnM/OiB7IGRheVJ1bGVyOiBzdHJpbmc7IGhvdXJSdWxlcjogc3RyaW5nOyBpbmZsdWVuY2U6IG51bWJlciB9O1xuICB9O1xufVxuXG4vKipcbiAqIEdldCBjdWxpbmFyeSByZWNvbW1lbmRhdGlvbnMgYmFzZWQgb24gcGxhbmV0YXJ5IGluZmx1ZW5jZXNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldFBsYW5ldGFyeUN1bGluYXJ5UmVjb21tZW5kYXRpb25zKFxuICBkb21pbmFudFBsYW5ldHM6IEFycmF5PHsgcGxhbmV0OiBzdHJpbmc7IHN0cmVuZ3RoOiBudW1iZXI7IGVsZW1lbnQ6IEVsZW1lbnQgfT5cbik6IHtcbiAgaW5ncmVkaWVudHM6IHN0cmluZ1tdO1xuICBjb29raW5nTWV0aG9kczogc3RyaW5nW107XG4gIGZsYXZvcnM6IHN0cmluZ1tdO1xuICB0aW1pbmc6IHN0cmluZ1tdO1xufSB7XG4gIGNvbnN0IHJlY29tbWVuZGF0aW9ucyA9IHtcbiAgICBpbmdyZWRpZW50czogW10gYXMgc3RyaW5nW10sXG4gICAgY29va2luZ01ldGhvZHM6IFtdIGFzIHN0cmluZ1tdLFxuICAgIGZsYXZvcnM6IFtdIGFzIHN0cmluZ1tdLFxuICAgIHRpbWluZzogW10gYXMgc3RyaW5nW11cbiAgfTtcblxuICAvLyBHZXQgdG9wIDMgZG9taW5hbnQgcGxhbmV0c1xuICBjb25zdCB0b3BQbGFuZXRzID0gZG9taW5hbnRQbGFuZXRzPy5zbGljZSgwLCAzKTtcblxuICAodG9wUGxhbmV0cyB8fCBbXSkuZm9yRWFjaCgoeyBwbGFuZXQsIGVsZW1lbnQgfSkgPT4ge1xuICAgIGNvbnN0IHBsYW5ldEtleSA9IHBsYW5ldD8udG9Mb3dlckNhc2UoKTtcblxuICAgIC8vIFBsYW5ldGFyeSBpbmdyZWRpZW50IGFzc29jaWF0aW9uc1xuICAgIHN3aXRjaCAocGxhbmV0S2V5KSB7XG4gICAgICBjYXNlICdTdW4nOlxuICAgICAgICByZWNvbW1lbmRhdGlvbnMuaW5ncmVkaWVudHM/LnB1c2goJ2NpdHJ1cyBmcnVpdHMnLCAnZ29sZGVuIGdyYWlucycsICdzdW5mbG93ZXIgb2lsJyk7XG4gICAgICAgIHJlY29tbWVuZGF0aW9ucy5jb29raW5nTWV0aG9kcz8ucHVzaCgnZ3JpbGxpbmcnLCAncm9hc3RpbmcnKTtcbiAgICAgICAgcmVjb21tZW5kYXRpb25zLmZsYXZvcnM/LnB1c2goJ2JyaWdodCcsICd3YXJtaW5nJywgJ2VuZXJnaXppbmcnKTtcbiAgICAgICAgcmVjb21tZW5kYXRpb25zLnRpbWluZz8ucHVzaCgnbWlkZGF5JywgJ3NvbGFyIGhvdXJzJyk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnTW9vbic6XG4gICAgICAgIHJlY29tbWVuZGF0aW9ucy5pbmdyZWRpZW50cz8ucHVzaCgnZEFpcnkgcHJvZHVjdHMnLCAnc2VhZm9vZCcsICd3aGl0ZSB2ZWdldGFibGVzJyk7XG4gICAgICAgIHJlY29tbWVuZGF0aW9ucy5jb29raW5nTWV0aG9kcz8ucHVzaCgnc3RlYW1pbmcnLCAncG9hY2hpbmcnKTtcbiAgICAgICAgcmVjb21tZW5kYXRpb25zLmZsYXZvcnM/LnB1c2goJ2Nvb2xpbmcnLCAnc29vdGhpbmcnLCAnbnVydHVyaW5nJyk7XG4gICAgICAgIHJlY29tbWVuZGF0aW9ucy50aW1pbmc/LnB1c2goJ2V2ZW5pbmcnLCAnbHVuYXIgaG91cnMnKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdNZXJjdXJ5JzpcbiAgICAgICAgcmVjb21tZW5kYXRpb25zLmluZ3JlZGllbnRzPy5wdXNoKCdudXRzJywgJ3NlZWRzJywgJ2xlYWZ5IGdyZWVucycpO1xuICAgICAgICByZWNvbW1lbmRhdGlvbnMuY29va2luZ01ldGhvZHM/LnB1c2goJ3F1aWNrIHNhdXTDqWluZycsICdzdGlyLWZyeWluZycpO1xuICAgICAgICByZWNvbW1lbmRhdGlvbnMuZmxhdm9ycz8ucHVzaCgnbGlnaHQnLCAnY3Jpc3AnLCAnc3RpbXVsYXRpbmcnKTtcbiAgICAgICAgcmVjb21tZW5kYXRpb25zLnRpbWluZz8ucHVzaCgnbW9ybmluZycsICdjb21tdW5pY2F0aW9uIGhvdXJzJyk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnVmVudXMnOlxuICAgICAgICByZWNvbW1lbmRhdGlvbnMuaW5ncmVkaWVudHM/LnB1c2goJ2ZydWl0cycsICdoZXJicycsICdzd2VldCB2ZWdldGFibGVzJyk7XG4gICAgICAgIHJlY29tbWVuZGF0aW9ucy5jb29raW5nTWV0aG9kcz8ucHVzaCgnZ2VudGxlIGNvb2tpbmcnLCAncmF3IHByZXBhcmF0aW9uJyk7XG4gICAgICAgIHJlY29tbWVuZGF0aW9ucy5mbGF2b3JzPy5wdXNoKCdzd2VldCcsICdoYXJtb25pb3VzJywgJ3BsZWFzYW50Jyk7XG4gICAgICAgIHJlY29tbWVuZGF0aW9ucy50aW1pbmc/LnB1c2goJ2FmdGVybm9vbicsICdzb2NpYWwgaG91cnMnKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdNYXJzJzpcbiAgICAgICAgcmVjb21tZW5kYXRpb25zLmluZ3JlZGllbnRzPy5wdXNoKCdzcGljeSBwZXBwZXJzJywgJ3JlZCBtZWF0JywgJ2dhcmxpYycpO1xuICAgICAgICByZWNvbW1lbmRhdGlvbnMuY29va2luZ01ldGhvZHM/LnB1c2goJ2hpZ2gtaGVhdCBjb29raW5nJywgJ2dyaWxsaW5nJyk7XG4gICAgICAgIHJlY29tbWVuZGF0aW9ucy5mbGF2b3JzPy5wdXNoKCdzcGljeScsICdpbnRlbnNlJywgJ2VuZXJnaXppbmcnKTtcbiAgICAgICAgcmVjb21tZW5kYXRpb25zLnRpbWluZz8ucHVzaCgnZWFybHkgbW9ybmluZycsICdhY3Rpb24gaG91cnMnKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdKdXBpdGVyJzpcbiAgICAgICAgcmVjb21tZW5kYXRpb25zLmluZ3JlZGllbnRzPy5wdXNoKCdsZWd1bWVzJywgJ3JpY2ggZm9vZHMnLCAnZXhvdGljIHNwaWNlcycpO1xuICAgICAgICByZWNvbW1lbmRhdGlvbnMuY29va2luZ01ldGhvZHM/LnB1c2goJ3Nsb3cgY29va2luZycsICdicmFpc2luZycpO1xuICAgICAgICByZWNvbW1lbmRhdGlvbnMuZmxhdm9ycz8ucHVzaCgncmljaCcsICdhYnVuZGFudCcsICdzYXRpc2Z5aW5nJyk7XG4gICAgICAgIHJlY29tbWVuZGF0aW9ucy50aW1pbmc/LnB1c2goJ2ZlYXN0IHRpbWVzJywgJ2V4cGFuc2lvbiBob3VycycpO1xuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ1NhdHVybic6XG4gICAgICAgIHJlY29tbWVuZGF0aW9ucy5pbmdyZWRpZW50cz8ucHVzaCgncm9vdCB2ZWdldGFibGVzJywgJ2FnZWQgZm9vZHMnLCAnZ3JhaW5zJyk7XG4gICAgICAgIHJlY29tbWVuZGF0aW9ucy5jb29raW5nTWV0aG9kcz8ucHVzaCgnc2xvdyByb2FzdGluZycsICdwcmVzZXJ2YXRpb24nKTtcbiAgICAgICAgcmVjb21tZW5kYXRpb25zLmZsYXZvcnM/LnB1c2goJ2VhcnRoeScsICdzdHJ1Y3R1cmVkJywgJ2dyb3VuZGluZycpO1xuICAgICAgICByZWNvbW1lbmRhdGlvbnMudGltaW5nPy5wdXNoKCdsYXRlIGV2ZW5pbmcnLCAnZGlzY2lwbGluZSBob3VycycpO1xuICAgICAgICBicmVhaztcbiAgICB9XG4gIH0pO1xuXG4gIHJldHVybiByZWNvbW1lbmRhdGlvbnM7XG59XG5cbmV4cG9ydCBkZWZhdWx0IHtcbiAgY2FsY3VsYXRlUGxhbmV0YXJ5SW5mbHVlbmNlcyxcbiAgY2FsY3VsYXRlUGxhbmV0YXJ5RGlnbml0eSxcbiAgY2FsY3VsYXRlUGxhbmV0YXJ5U3RyZW5ndGgsXG4gIGdldFBsYW5ldGFyeUVsZW1lbnRhbEluZmx1ZW5jZSxcbiAgY2FsY3VsYXRlUGxhbmV0YXJ5SG91cnNJbmZsdWVuY2UsXG4gIGdldFBsYW5ldGFyeUN1bGluYXJ5UmVjb21tZW5kYXRpb25zLFxuICBQTEFORVRBUllfQUxDSEVNSUNBTF9NQVBQSU5HUyxcbiAgUExBTkVUQVJZX0VMRU1FTlRBTF9NQVBQSU5HUyxcbiAgUExBTkVUQVJZX0RJR05JVElFU1xufTsgIl0sInZlcnNpb24iOjN9