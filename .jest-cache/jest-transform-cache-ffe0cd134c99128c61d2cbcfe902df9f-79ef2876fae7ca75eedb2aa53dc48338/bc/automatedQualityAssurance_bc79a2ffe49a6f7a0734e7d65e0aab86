a0e6c0ba9fe2cc5fc11f205150c067fb
"use strict";
/**
 * Automated Quality Assurance Integration
 *
 * This module implements automated quality assurance with agent hooks for:
 * - Automatic planetary data validation
 * - Ingredient consistency checking for elemental properties
 * - TypeScript campaign triggers for error threshold management
 * - Build quality monitoring for performance tracking
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.useAutomatedQualityAssurance = exports.getAutomatedQualityAssurance = exports.AutomatedQualityAssurance = exports.QA_THRESHOLDS = void 0;
const logger_1 = require("@/utils/logger");
const reliableAstronomy_1 = require("@/utils/reliableAstronomy");
const steeringFileIntelligence_1 = require("@/utils/steeringFileIntelligence");
// Quality assurance thresholds from campaign-integration.md
exports.QA_THRESHOLDS = {
    typescript: {
        criticalThreshold: 100,
        warningThreshold: 500,
        target: 0
    },
    linting: {
        criticalThreshold: 1000,
        warningThreshold: 2000,
        target: 0
    },
    performance: {
        renderTime: 16,
        memoryUsage: 50,
        bundleSize: 250,
        apiResponseTime: 2000 // 2 seconds
    },
    planetaryData: {
        positionAccuracy: 0.1,
        cacheValidityHours: 6,
        fallbackThresholdMs: 5000
    }
};
/**
 * Automated Quality Assurance System
 */
class AutomatedQualityAssurance {
    constructor(config) {
        this.lastValidation = 0;
        this.validationInterval = null;
        this.campaignTriggers = [];
        this.config = {
            enableAutomaticValidation: true,
            enableCampaignTriggers: true,
            enablePerformanceMonitoring: true,
            enablePlanetaryDataValidation: true,
            enableIngredientConsistencyChecking: true,
            thresholds: exports.QA_THRESHOLDS,
            ...config
        };
        this.metrics = this.initializeMetrics();
        this.startAutomaticValidation();
    }
    static getInstance(config) {
        if (!AutomatedQualityAssurance.instance) {
            AutomatedQualityAssurance.instance = new AutomatedQualityAssurance(config);
        }
        return AutomatedQualityAssurance.instance;
    }
    /**
     * Agent hook for automatic planetary data validation
     */
    async validatePlanetaryData(date = new Date()) {
        if (!this.config.enablePlanetaryDataValidation) {
            return this.createValidationResult(true, 1.0, [], []);
        }
        try {
            const startTime = performance.now();
            const positions = await (0, reliableAstronomy_1.getReliablePlanetaryPositions)(date);
            const responseTime = performance.now() - startTime;
            const issues = [];
            const recommendations = [];
            let score = 1.0;
            // Validate response time
            if (responseTime > this.config.thresholds.planetaryData.fallbackThresholdMs) {
                issues.push(`Planetary data fetch time (${responseTime.toFixed(0)}ms) exceeds threshold`);
                recommendations.push('Consider implementing more aggressive caching');
                score -= 0.2;
            }
            // Validate data completeness
            const requiredPlanets = ['sun', 'moon', 'mercury', 'venus', 'mars', 'jupiter', 'saturn'];
            const missingPlanets = requiredPlanets.filter(planet => !positions[planet]);
            if (missingPlanets.length > 0) {
                issues.push(`Missing planetary data for: ${missingPlanets.join(', ')}`);
                recommendations.push('Verify API connectivity and fallback mechanisms');
                score -= 0.1 * missingPlanets.length;
            }
            // Validate position accuracy (check for reasonable longitude values)
            Object.entries(positions).forEach(([planet, data]) => {
                if ((data === null || data === void 0 ? void 0 : data.exactLongitude) !== undefined) {
                    if (data.exactLongitude < 0 || data.exactLongitude >= 360) {
                        issues.push(`Invalid longitude for ${planet}: ${data.exactLongitude}`);
                        score -= 0.1;
                    }
                }
            });
            // Update metrics
            this.metrics.planetaryDataQuality = {
                accuracy: Math.max(0, score),
                freshness: this.calculateDataFreshness(positions),
                reliability: issues.length === 0 ? 1.0 : Math.max(0, 1.0 - (issues.length * 0.1))
            };
            // Check for campaign triggers
            this.checkCampaignTriggers('planetary', score);
            logger_1.logger.debug('Planetary data validation completed', { score, issues: issues.length });
            return this.createValidationResult(score >= 0.8, score, issues, recommendations);
        }
        catch (error) {
            logger_1.logger.error('Error validating planetary data:', error);
            return this.createValidationResult(false, 0, ['Planetary data validation failed'], ['Check API connectivity and error handling']);
        }
    }
    /**
     * Agent hook for ingredient consistency checking
     */
    validateIngredientConsistency(ingredients) {
        if (!this.config.enableIngredientConsistencyChecking) {
            return this.createValidationResult(true, 1.0, [], []);
        }
        const intelligence = (0, steeringFileIntelligence_1.getSteeringFileIntelligence)();
        const issues = [];
        const recommendations = [];
        let totalScore = 0;
        let validatedCount = 0;
        ingredients.forEach((ingredient, index) => {
            // Validate elemental properties structure
            const isValidStructure = intelligence.validateElementalProperties(ingredient.elementalProperties);
            if (!isValidStructure) {
                issues.push(`Invalid elemental properties for ingredient: ${ingredient.name}`);
                recommendations.push(`Fix elemental properties for ${ingredient.name} to meet minimum standards`);
            }
            else {
                validatedCount++;
                // Calculate elemental consistency score
                const elementalSum = Object.values(ingredient.elementalProperties).reduce((sum, val) => sum + val, 0);
                const consistencyScore = elementalSum > 0 ? Math.min(1.0, elementalSum / 1.0) : 0;
                totalScore += consistencyScore;
                // Check for elemental balance (no single element should dominate too much)
                const maxElement = Math.max(...Object.values(ingredient.elementalProperties));
                if (maxElement > 0.8) {
                    recommendations.push(`Consider balancing elemental properties for ${ingredient.name} (max: ${maxElement.toFixed(2)})`);
                }
            }
            // Validate compatibility with other ingredients
            if (index > 0) {
                const prevIngredient = ingredients[index - 1];
                const compatibility = intelligence.calculateCompatibility(ingredient.elementalProperties, prevIngredient.elementalProperties);
                if (compatibility < 0.7) {
                    issues.push(`Low compatibility between ${ingredient.name} and ${prevIngredient.name}: ${compatibility.toFixed(2)}`);
                    recommendations.push('Consider adjusting elemental properties to improve compatibility');
                }
            }
        });
        const averageScore = validatedCount > 0 ? totalScore / validatedCount : 0;
        // Update metrics
        this.metrics.ingredientConsistency = {
            elementalValidation: averageScore,
            compatibilityScores: issues.filter(issue => issue.includes('compatibility')).length === 0 ? 1.0 : 0.7,
            culturalSensitivity: this.validateCulturalSensitivity(ingredients.map(i => i.name))
        };
        // Check for campaign triggers
        this.checkCampaignTriggers('ingredient', averageScore);
        logger_1.logger.debug('Ingredient consistency validation completed', {
            score: averageScore,
            issues: issues.length,
            validatedCount
        });
        return this.createValidationResult(averageScore >= 0.8, averageScore, issues, recommendations);
    }
    /**
     * TypeScript campaign trigger for error threshold management
     */
    async checkTypeScriptErrorThreshold() {
        if (!this.config.enableCampaignTriggers) {
            return null;
        }
        try {
            // Simulate TypeScript error count check (in real implementation, this would run tsc)
            const errorCount = await this.getTypeScriptErrorCount();
            this.metrics.typeScriptErrors = errorCount;
            const trigger = {
                type: 'typescript',
                threshold: this.config.thresholds.typescript.criticalThreshold,
                currentValue: errorCount,
                action: this.determineAction('typescript', errorCount),
                triggered: errorCount > this.config.thresholds.typescript.criticalThreshold,
                timestamp: Date.now()
            };
            if (trigger.triggered) {
                logger_1.logger.warn(`TypeScript error threshold exceeded: ${errorCount} > ${trigger.threshold}`);
                this.campaignTriggers.push(trigger);
                // In a real implementation, this would trigger the campaign system
                this.triggerCampaign('typescript-error-elimination', {
                    errorCount,
                    threshold: trigger.threshold,
                    action: trigger.action
                });
            }
            return trigger;
        }
        catch (error) {
            logger_1.logger.error('Error checking TypeScript error threshold:', error);
            return null;
        }
    }
    /**
     * Build quality monitoring for performance tracking
     */
    monitorBuildQuality(buildMetrics) {
        if (!this.config.enablePerformanceMonitoring) {
            return this.createValidationResult(true, 1.0, [], []);
        }
        const issues = [];
        const recommendations = [];
        let score = 1.0;
        // Check build time
        if (buildMetrics.buildTime && buildMetrics.buildTime > 30000) { // 30 seconds
            issues.push(`Build time (${buildMetrics.buildTime}ms) exceeds recommended threshold`);
            recommendations.push('Consider optimizing build configuration and dependencies');
            score -= 0.2;
        }
        // Check bundle size
        if (buildMetrics.bundleSize && buildMetrics.bundleSize > this.config.thresholds.performance.bundleSize * 1024) {
            issues.push(`Bundle size (${Math.round(buildMetrics.bundleSize / 1024)}KB) exceeds threshold`);
            recommendations.push('Implement code splitting and tree shaking optimizations');
            score -= 0.2;
        }
        // Check memory usage
        if (buildMetrics.memoryUsage && buildMetrics.memoryUsage > this.config.thresholds.performance.memoryUsage) {
            issues.push(`Memory usage (${buildMetrics.memoryUsage}MB) exceeds threshold`);
            recommendations.push('Optimize memory usage and check for memory leaks');
            score -= 0.2;
        }
        // Check error count
        if (buildMetrics.errorCount && buildMetrics.errorCount > 0) {
            issues.push(`Build contains ${buildMetrics.errorCount} errors`);
            recommendations.push('Fix all build errors before deployment');
            score -= 0.3;
        }
        // Update performance metrics
        this.metrics.performanceMetrics = {
            renderTime: 0,
            memoryUsage: buildMetrics.memoryUsage || 0,
            bundleSize: buildMetrics.bundleSize || 0,
            apiResponseTime: 0 // Will be updated by API monitoring
        };
        // Check for campaign triggers
        this.checkCampaignTriggers('performance', score);
        logger_1.logger.debug('Build quality monitoring completed', { score, issues: issues.length });
        return this.createValidationResult(score >= 0.8, score, issues, recommendations);
    }
    /**
     * Get current quality metrics
     */
    getQualityMetrics() {
        return { ...this.metrics };
    }
    /**
     * Get active campaign triggers
     */
    getActiveCampaignTriggers() {
        return this.campaignTriggers.filter(trigger => Date.now() - trigger.timestamp < 24 * 60 * 60 * 1000 // Last 24 hours
        );
    }
    /**
     * Update configuration
     */
    updateConfig(newConfig) {
        this.config = { ...this.config, ...newConfig };
        logger_1.logger.debug('Quality assurance configuration updated', newConfig);
    }
    /**
     * Stop automatic validation
     */
    stop() {
        if (this.validationInterval) {
            clearInterval(this.validationInterval);
            this.validationInterval = null;
        }
    }
    // Private helper methods
    initializeMetrics() {
        return {
            typeScriptErrors: 0,
            lintingWarnings: 0,
            performanceMetrics: {
                renderTime: 0,
                memoryUsage: 0,
                bundleSize: 0,
                apiResponseTime: 0
            },
            planetaryDataQuality: {
                accuracy: 1.0,
                freshness: 1.0,
                reliability: 1.0
            },
            ingredientConsistency: {
                elementalValidation: 1.0,
                compatibilityScores: 1.0,
                culturalSensitivity: 1.0
            }
        };
    }
    startAutomaticValidation() {
        if (!this.config.enableAutomaticValidation) {
            return;
        }
        // Run validation every 5 minutes
        this.validationInterval = setInterval(async () => {
            try {
                await this.validatePlanetaryData();
                await this.checkTypeScriptErrorThreshold();
                logger_1.logger.debug('Automatic quality validation completed');
            }
            catch (error) {
                logger_1.logger.error('Error in automatic validation:', error);
            }
        }, 5 * 60 * 1000);
        logger_1.logger.debug('Automatic quality validation started');
    }
    createValidationResult(isValid, score, issues, recommendations) {
        return {
            isValid,
            score: Math.max(0, Math.min(1, score)),
            issues,
            recommendations,
            timestamp: Date.now()
        };
    }
    calculateDataFreshness(positions) {
        // In a real implementation, this would check the timestamp of the data
        // For now, return 1.0 (fresh) as a placeholder
        return 1.0;
    }
    validateCulturalSensitivity(ingredientNames) {
        // Check for potentially insensitive terms
        const sensitiveTerms = ['exotic', 'ethnic', 'primitive', 'weird'];
        const issues = ingredientNames.filter(name => sensitiveTerms.some(term => name.toLowerCase().includes(term)));
        return issues.length === 0 ? 1.0 : Math.max(0, 1.0 - (issues.length * 0.2));
    }
    checkCampaignTriggers(type, value) {
        if (!this.config.enableCampaignTriggers) {
            return;
        }
        const thresholds = this.getThresholdsForType(type);
        if (!thresholds)
            return;
        const trigger = {
            type,
            threshold: thresholds.critical,
            currentValue: value,
            action: this.determineAction(type, value),
            triggered: value < thresholds.critical,
            timestamp: Date.now()
        };
        if (trigger.triggered) {
            this.campaignTriggers.push(trigger);
            logger_1.logger.warn(`Campaign trigger activated for ${type}:`, trigger);
        }
    }
    getThresholdsForType(type) {
        switch (type) {
            case 'typescript':
                return { critical: this.config.thresholds.typescript.criticalThreshold, warning: this.config.thresholds.typescript.warningThreshold };
            case 'linting':
                return { critical: this.config.thresholds.linting.criticalThreshold, warning: this.config.thresholds.linting.warningThreshold };
            case 'performance':
            case 'planetary':
            case 'ingredient':
                return { critical: 0.8, warning: 0.9 }; // Score-based thresholds
            default:
                return null;
        }
    }
    determineAction(type, value) {
        const thresholds = this.getThresholdsForType(type);
        if (!thresholds)
            return 'monitor';
        if (type === 'typescript' || type === 'linting') {
            // For error counts, higher values are worse
            if (value > thresholds.critical)
                return 'emergency';
            if (value > thresholds.warning)
                return 'campaign';
            return 'monitor';
        }
        else {
            // For scores, lower values are worse
            if (value < 0.7)
                return 'emergency';
            if (value < thresholds.critical)
                return 'campaign';
            if (value < thresholds.warning)
                return 'warn';
            return 'monitor';
        }
    }
    async getTypeScriptErrorCount() {
        // In a real implementation, this would run: yarn tsc --noEmit --skipLibCheck 2>&1 | grep -c "error TS"
        // For now, return a simulated count
        return Math.floor(Math.random() * 50); // Simulate 0-50 errors
    }
    triggerCampaign(campaignType, context) {
        // In a real implementation, this would integrate with the campaign system
        logger_1.logger.info(`Campaign triggered: ${campaignType}`, context);
        // Simulate campaign system integration
        if (typeof window !== 'undefined') {
            // Dispatch custom event for campaign system integration
            window.dispatchEvent(new CustomEvent('kiro-campaign-trigger', {
                detail: { campaignType, context }
            }));
        }
    }
}
exports.AutomatedQualityAssurance = AutomatedQualityAssurance;
/**
 * Convenience function to get quality assurance instance
 */
function getAutomatedQualityAssurance(config) {
    return AutomatedQualityAssurance.getInstance(config);
}
exports.getAutomatedQualityAssurance = getAutomatedQualityAssurance;
/**
 * Hook for components to use automated quality assurance
 */
function useAutomatedQualityAssurance() {
    const qa = getAutomatedQualityAssurance();
    return {
        validatePlanetaryData: (date) => qa.validatePlanetaryData(date),
        validateIngredientConsistency: (ingredients) => qa.validateIngredientConsistency(ingredients),
        checkTypeScriptErrorThreshold: () => qa.checkTypeScriptErrorThreshold(),
        monitorBuildQuality: (metrics) => qa.monitorBuildQuality(metrics),
        getQualityMetrics: () => qa.getQualityMetrics(),
        getActiveCampaignTriggers: () => qa.getActiveCampaignTriggers(),
        updateConfig: (config) => qa.updateConfig(config)
    };
}
exports.useAutomatedQualityAssurance = useAutomatedQualityAssurance;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy91dGlscy9hdXRvbWF0ZWRRdWFsaXR5QXNzdXJhbmNlLnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7Ozs7R0FRRzs7O0FBRUgsMkNBQXdDO0FBQ3hDLGlFQUEwRTtBQUMxRSwrRUFBb0c7QUFFcEcsNERBQTREO0FBQy9DLFFBQUEsYUFBYSxHQUFHO0lBQzNCLFVBQVUsRUFBRTtRQUNWLGlCQUFpQixFQUFFLEdBQUc7UUFDdEIsZ0JBQWdCLEVBQUUsR0FBRztRQUNyQixNQUFNLEVBQUUsQ0FBQztLQUNWO0lBQ0QsT0FBTyxFQUFFO1FBQ1AsaUJBQWlCLEVBQUUsSUFBSTtRQUN2QixnQkFBZ0IsRUFBRSxJQUFJO1FBQ3RCLE1BQU0sRUFBRSxDQUFDO0tBQ1Y7SUFDRCxXQUFXLEVBQUU7UUFDWCxVQUFVLEVBQUUsRUFBRTtRQUNkLFdBQVcsRUFBRSxFQUFFO1FBQ2YsVUFBVSxFQUFFLEdBQUc7UUFDZixlQUFlLEVBQUUsSUFBSSxDQUFDLFlBQVk7S0FDbkM7SUFDRCxhQUFhLEVBQUU7UUFDYixnQkFBZ0IsRUFBRSxHQUFHO1FBQ3JCLGtCQUFrQixFQUFFLENBQUM7UUFDckIsbUJBQW1CLEVBQUUsSUFBSTtLQUMxQjtDQUNPLENBQUM7QUFpRFg7O0dBRUc7QUFDSCxNQUFhLHlCQUF5QjtJQVFwQyxZQUFvQixNQUF3QztRQUpwRCxtQkFBYyxHQUFXLENBQUMsQ0FBQztRQUMzQix1QkFBa0IsR0FBMEIsSUFBSSxDQUFDO1FBQ2pELHFCQUFnQixHQUFzQixFQUFFLENBQUM7UUFHL0MsSUFBSSxDQUFDLE1BQU0sR0FBRztZQUNaLHlCQUF5QixFQUFFLElBQUk7WUFDL0Isc0JBQXNCLEVBQUUsSUFBSTtZQUM1QiwyQkFBMkIsRUFBRSxJQUFJO1lBQ2pDLDZCQUE2QixFQUFFLElBQUk7WUFDbkMsbUNBQW1DLEVBQUUsSUFBSTtZQUN6QyxVQUFVLEVBQUUscUJBQWE7WUFDekIsR0FBRyxNQUFNO1NBQ1YsQ0FBQztRQUVG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LCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy91dGlscy9hdXRvbWF0ZWRRdWFsaXR5QXNzdXJhbmNlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQXV0b21hdGVkIFF1YWxpdHkgQXNzdXJhbmNlIEludGVncmF0aW9uXG4gKiBcbiAqIFRoaXMgbW9kdWxlIGltcGxlbWVudHMgYXV0b21hdGVkIHF1YWxpdHkgYXNzdXJhbmNlIHdpdGggYWdlbnQgaG9va3MgZm9yOlxuICogLSBBdXRvbWF0aWMgcGxhbmV0YXJ5IGRhdGEgdmFsaWRhdGlvblxuICogLSBJbmdyZWRpZW50IGNvbnNpc3RlbmN5IGNoZWNraW5nIGZvciBlbGVtZW50YWwgcHJvcGVydGllc1xuICogLSBUeXBlU2NyaXB0IGNhbXBhaWduIHRyaWdnZXJzIGZvciBlcnJvciB0aHJlc2hvbGQgbWFuYWdlbWVudFxuICogLSBCdWlsZCBxdWFsaXR5IG1vbml0b3JpbmcgZm9yIHBlcmZvcm1hbmNlIHRyYWNraW5nXG4gKi9cblxuaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSAnQC91dGlscy9sb2dnZXInO1xuaW1wb3J0IHsgZ2V0UmVsaWFibGVQbGFuZXRhcnlQb3NpdGlvbnMgfSBmcm9tICdAL3V0aWxzL3JlbGlhYmxlQXN0cm9ub215JztcbmltcG9ydCB7IEVsZW1lbnRhbFByb3BlcnRpZXMsIGdldFN0ZWVyaW5nRmlsZUludGVsbGlnZW5jZSB9IGZyb20gJ0AvdXRpbHMvc3RlZXJpbmdGaWxlSW50ZWxsaWdlbmNlJztcblxuLy8gUXVhbGl0eSBhc3N1cmFuY2UgdGhyZXNob2xkcyBmcm9tIGNhbXBhaWduLWludGVncmF0aW9uLm1kXG5leHBvcnQgY29uc3QgUUFfVEhSRVNIT0xEUyA9IHtcbiAgdHlwZXNjcmlwdDoge1xuICAgIGNyaXRpY2FsVGhyZXNob2xkOiAxMDAsXG4gICAgd2FybmluZ1RocmVzaG9sZDogNTAwLFxuICAgIHRhcmdldDogMFxuICB9LFxuICBsaW50aW5nOiB7XG4gICAgY3JpdGljYWxUaHJlc2hvbGQ6IDEwMDAsXG4gICAgd2FybmluZ1RocmVzaG9sZDogMjAwMCxcbiAgICB0YXJnZXQ6IDBcbiAgfSxcbiAgcGVyZm9ybWFuY2U6IHtcbiAgICByZW5kZXJUaW1lOiAxNiwgLy8gNjBmcHMgdGFyZ2V0XG4gICAgbWVtb3J5VXNhZ2U6IDUwLCAvLyBNQlxuICAgIGJ1bmRsZVNpemU6IDI1MCwgLy8gS0JcbiAgICBhcGlSZXNwb25zZVRpbWU6IDIwMDAgLy8gMiBzZWNvbmRzXG4gIH0sXG4gIHBsYW5ldGFyeURhdGE6IHtcbiAgICBwb3NpdGlvbkFjY3VyYWN5OiAwLjEsIC8vIGRlZ3JlZXNcbiAgICBjYWNoZVZhbGlkaXR5SG91cnM6IDYsXG4gICAgZmFsbGJhY2tUaHJlc2hvbGRNczogNTAwMFxuICB9XG59IGFzIGNvbnN0O1xuXG5leHBvcnQgaW50ZXJmYWNlIFF1YWxpdHlNZXRyaWNzIHtcbiAgdHlwZVNjcmlwdEVycm9yczogbnVtYmVyO1xuICBsaW50aW5nV2FybmluZ3M6IG51bWJlcjtcbiAgcGVyZm9ybWFuY2VNZXRyaWNzOiB7XG4gICAgcmVuZGVyVGltZTogbnVtYmVyO1xuICAgIG1lbW9yeVVzYWdlOiBudW1iZXI7XG4gICAgYnVuZGxlU2l6ZTogbnVtYmVyO1xuICAgIGFwaVJlc3BvbnNlVGltZTogbnVtYmVyO1xuICB9O1xuICBwbGFuZXRhcnlEYXRhUXVhbGl0eToge1xuICAgIGFjY3VyYWN5OiBudW1iZXI7XG4gICAgZnJlc2huZXNzOiBudW1iZXI7XG4gICAgcmVsaWFiaWxpdHk6IG51bWJlcjtcbiAgfTtcbiAgaW5ncmVkaWVudENvbnNpc3RlbmN5OiB7XG4gICAgZWxlbWVudGFsVmFsaWRhdGlvbjogbnVtYmVyO1xuICAgIGNvbXBhdGliaWxpdHlTY29yZXM6IG51bWJlcjtcbiAgICBjdWx0dXJhbFNlbnNpdGl2aXR5OiBudW1iZXI7XG4gIH07XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUXVhbGl0eUFzc3VyYW5jZUNvbmZpZyB7XG4gIGVuYWJsZUF1dG9tYXRpY1ZhbGlkYXRpb246IGJvb2xlYW47XG4gIGVuYWJsZUNhbXBhaWduVHJpZ2dlcnM6IGJvb2xlYW47XG4gIGVuYWJsZVBlcmZvcm1hbmNlTW9uaXRvcmluZzogYm9vbGVhbjtcbiAgZW5hYmxlUGxhbmV0YXJ5RGF0YVZhbGlkYXRpb246IGJvb2xlYW47XG4gIGVuYWJsZUluZ3JlZGllbnRDb25zaXN0ZW5jeUNoZWNraW5nOiBib29sZWFuO1xuICB0aHJlc2hvbGRzOiB0eXBlb2YgUUFfVEhSRVNIT0xEUztcbn1cblxuZXhwb3J0IGludGVyZmFjZSBWYWxpZGF0aW9uUmVzdWx0IHtcbiAgaXNWYWxpZDogYm9vbGVhbjtcbiAgc2NvcmU6IG51bWJlcjtcbiAgaXNzdWVzOiBzdHJpbmdbXTtcbiAgcmVjb21tZW5kYXRpb25zOiBzdHJpbmdbXTtcbiAgdGltZXN0YW1wOiBudW1iZXI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQ2FtcGFpZ25UcmlnZ2VyIHtcbiAgdHlwZTogJ3R5cGVzY3JpcHQnIHwgJ2xpbnRpbmcnIHwgJ3BlcmZvcm1hbmNlJyB8ICdwbGFuZXRhcnknIHwgJ2luZ3JlZGllbnQnO1xuICB0aHJlc2hvbGQ6IG51bWJlcjtcbiAgY3VycmVudFZhbHVlOiBudW1iZXI7XG4gIGFjdGlvbjogJ21vbml0b3InIHwgJ3dhcm4nIHwgJ2NhbXBhaWduJyB8ICdlbWVyZ2VuY3knO1xuICB0cmlnZ2VyZWQ6IGJvb2xlYW47XG4gIHRpbWVzdGFtcDogbnVtYmVyO1xufVxuXG4vKipcbiAqIEF1dG9tYXRlZCBRdWFsaXR5IEFzc3VyYW5jZSBTeXN0ZW1cbiAqL1xuZXhwb3J0IGNsYXNzIEF1dG9tYXRlZFF1YWxpdHlBc3N1cmFuY2Uge1xuICBwcml2YXRlIHN0YXRpYyBpbnN0YW5jZTogQXV0b21hdGVkUXVhbGl0eUFzc3VyYW5jZTtcbiAgcHJpdmF0ZSBjb25maWc6IFF1YWxpdHlBc3N1cmFuY2VDb25maWc7XG4gIHByaXZhdGUgbWV0cmljczogUXVhbGl0eU1ldHJpY3M7XG4gIHByaXZhdGUgbGFzdFZhbGlkYXRpb246IG51bWJlciA9IDA7XG4gIHByaXZhdGUgdmFsaWRhdGlvbkludGVydmFsOiBOb2RlSlMuVGltZW91dCB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIGNhbXBhaWduVHJpZ2dlcnM6IENhbXBhaWduVHJpZ2dlcltdID0gW107XG5cbiAgcHJpdmF0ZSBjb25zdHJ1Y3Rvcihjb25maWc/OiBQYXJ0aWFsPFF1YWxpdHlBc3N1cmFuY2VDb25maWc+KSB7XG4gICAgdGhpcy5jb25maWcgPSB7XG4gICAgICBlbmFibGVBdXRvbWF0aWNWYWxpZGF0aW9uOiB0cnVlLFxuICAgICAgZW5hYmxlQ2FtcGFpZ25UcmlnZ2VyczogdHJ1ZSxcbiAgICAgIGVuYWJsZVBlcmZvcm1hbmNlTW9uaXRvcmluZzogdHJ1ZSxcbiAgICAgIGVuYWJsZVBsYW5ldGFyeURhdGFWYWxpZGF0aW9uOiB0cnVlLFxuICAgICAgZW5hYmxlSW5ncmVkaWVudENvbnNpc3RlbmN5Q2hlY2tpbmc6IHRydWUsXG4gICAgICB0aHJlc2hvbGRzOiBRQV9USFJFU0hPTERTLFxuICAgICAgLi4uY29uZmlnXG4gICAgfTtcblxuICAgIHRoaXMubWV0cmljcyA9IHRoaXMuaW5pdGlhbGl6ZU1ldHJpY3MoKTtcbiAgICB0aGlzLnN0YXJ0QXV0b21hdGljVmFsaWRhdGlvbigpO1xuICB9XG5cbiAgcHVibGljIHN0YXRpYyBnZXRJbnN0YW5jZShjb25maWc/OiBQYXJ0aWFsPFF1YWxpdHlBc3N1cmFuY2VDb25maWc+KTogQXV0b21hdGVkUXVhbGl0eUFzc3VyYW5jZSB7XG4gICAgaWYgKCFBdXRvbWF0ZWRRdWFsaXR5QXNzdXJhbmNlLmluc3RhbmNlKSB7XG4gICAgICBBdXRvbWF0ZWRRdWFsaXR5QXNzdXJhbmNlLmluc3RhbmNlID0gbmV3IEF1dG9tYXRlZFF1YWxpdHlBc3N1cmFuY2UoY29uZmlnKTtcbiAgICB9XG4gICAgcmV0dXJuIEF1dG9tYXRlZFF1YWxpdHlBc3N1cmFuY2UuaW5zdGFuY2U7XG4gIH1cblxuICAvKipcbiAgICogQWdlbnQgaG9vayBmb3IgYXV0b21hdGljIHBsYW5ldGFyeSBkYXRhIHZhbGlkYXRpb25cbiAgICovXG4gIHB1YmxpYyBhc3luYyB2YWxpZGF0ZVBsYW5ldGFyeURhdGEoZGF0ZTogRGF0ZSA9IG5ldyBEYXRlKCkpOiBQcm9taXNlPFZhbGlkYXRpb25SZXN1bHQ+IHtcbiAgICBpZiAoIXRoaXMuY29uZmlnLmVuYWJsZVBsYW5ldGFyeURhdGFWYWxpZGF0aW9uKSB7XG4gICAgICByZXR1cm4gdGhpcy5jcmVhdGVWYWxpZGF0aW9uUmVzdWx0KHRydWUsIDEuMCwgW10sIFtdKTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgY29uc3Qgc3RhcnRUaW1lID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgICBjb25zdCBwb3NpdGlvbnMgPSBhd2FpdCBnZXRSZWxpYWJsZVBsYW5ldGFyeVBvc2l0aW9ucyhkYXRlKTtcbiAgICAgIGNvbnN0IHJlc3BvbnNlVGltZSA9IHBlcmZvcm1hbmNlLm5vdygpIC0gc3RhcnRUaW1lO1xuXG4gICAgICBjb25zdCBpc3N1ZXM6IHN0cmluZ1tdID0gW107XG4gICAgICBjb25zdCByZWNvbW1lbmRhdGlvbnM6IHN0cmluZ1tdID0gW107XG4gICAgICBsZXQgc2NvcmUgPSAxLjA7XG5cbiAgICAgIC8vIFZhbGlkYXRlIHJlc3BvbnNlIHRpbWVcbiAgICAgIGlmIChyZXNwb25zZVRpbWUgPiB0aGlzLmNvbmZpZy50aHJlc2hvbGRzLnBsYW5ldGFyeURhdGEuZmFsbGJhY2tUaHJlc2hvbGRNcykge1xuICAgICAgICBpc3N1ZXMucHVzaChgUGxhbmV0YXJ5IGRhdGEgZmV0Y2ggdGltZSAoJHtyZXNwb25zZVRpbWUudG9GaXhlZCgwKX1tcykgZXhjZWVkcyB0aHJlc2hvbGRgKTtcbiAgICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goJ0NvbnNpZGVyIGltcGxlbWVudGluZyBtb3JlIGFnZ3Jlc3NpdmUgY2FjaGluZycpO1xuICAgICAgICBzY29yZSAtPSAwLjI7XG4gICAgICB9XG5cbiAgICAgIC8vIFZhbGlkYXRlIGRhdGEgY29tcGxldGVuZXNzXG4gICAgICBjb25zdCByZXF1aXJlZFBsYW5ldHMgPSBbJ3N1bicsICdtb29uJywgJ21lcmN1cnknLCAndmVudXMnLCAnbWFycycsICdqdXBpdGVyJywgJ3NhdHVybiddO1xuICAgICAgY29uc3QgbWlzc2luZ1BsYW5ldHMgPSByZXF1aXJlZFBsYW5ldHMuZmlsdGVyKHBsYW5ldCA9PiAhcG9zaXRpb25zW3BsYW5ldF0pO1xuICAgICAgXG4gICAgICBpZiAobWlzc2luZ1BsYW5ldHMubGVuZ3RoID4gMCkge1xuICAgICAgICBpc3N1ZXMucHVzaChgTWlzc2luZyBwbGFuZXRhcnkgZGF0YSBmb3I6ICR7bWlzc2luZ1BsYW5ldHMuam9pbignLCAnKX1gKTtcbiAgICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goJ1ZlcmlmeSBBUEkgY29ubmVjdGl2aXR5IGFuZCBmYWxsYmFjayBtZWNoYW5pc21zJyk7XG4gICAgICAgIHNjb3JlIC09IDAuMSAqIG1pc3NpbmdQbGFuZXRzLmxlbmd0aDtcbiAgICAgIH1cblxuICAgICAgLy8gVmFsaWRhdGUgcG9zaXRpb24gYWNjdXJhY3kgKGNoZWNrIGZvciByZWFzb25hYmxlIGxvbmdpdHVkZSB2YWx1ZXMpXG4gICAgICBPYmplY3QuZW50cmllcyhwb3NpdGlvbnMpLmZvckVhY2goKFtwbGFuZXQsIGRhdGFdOiBbc3RyaW5nLCBhbnldKSA9PiB7XG4gICAgICAgIGlmIChkYXRhPy5leGFjdExvbmdpdHVkZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgaWYgKGRhdGEuZXhhY3RMb25naXR1ZGUgPCAwIHx8IGRhdGEuZXhhY3RMb25naXR1ZGUgPj0gMzYwKSB7XG4gICAgICAgICAgICBpc3N1ZXMucHVzaChgSW52YWxpZCBsb25naXR1ZGUgZm9yICR7cGxhbmV0fTogJHtkYXRhLmV4YWN0TG9uZ2l0dWRlfWApO1xuICAgICAgICAgICAgc2NvcmUgLT0gMC4xO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIC8vIFVwZGF0ZSBtZXRyaWNzXG4gICAgICB0aGlzLm1ldHJpY3MucGxhbmV0YXJ5RGF0YVF1YWxpdHkgPSB7XG4gICAgICAgIGFjY3VyYWN5OiBNYXRoLm1heCgwLCBzY29yZSksXG4gICAgICAgIGZyZXNobmVzczogdGhpcy5jYWxjdWxhdGVEYXRhRnJlc2huZXNzKHBvc2l0aW9ucyksXG4gICAgICAgIHJlbGlhYmlsaXR5OiBpc3N1ZXMubGVuZ3RoID09PSAwID8gMS4wIDogTWF0aC5tYXgoMCwgMS4wIC0gKGlzc3Vlcy5sZW5ndGggKiAwLjEpKVxuICAgICAgfTtcblxuICAgICAgLy8gQ2hlY2sgZm9yIGNhbXBhaWduIHRyaWdnZXJzXG4gICAgICB0aGlzLmNoZWNrQ2FtcGFpZ25UcmlnZ2VycygncGxhbmV0YXJ5Jywgc2NvcmUpO1xuXG4gICAgICBsb2dnZXIuZGVidWcoJ1BsYW5ldGFyeSBkYXRhIHZhbGlkYXRpb24gY29tcGxldGVkJywgeyBzY29yZSwgaXNzdWVzOiBpc3N1ZXMubGVuZ3RoIH0pO1xuICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlVmFsaWRhdGlvblJlc3VsdChzY29yZSA+PSAwLjgsIHNjb3JlLCBpc3N1ZXMsIHJlY29tbWVuZGF0aW9ucyk7XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdFcnJvciB2YWxpZGF0aW5nIHBsYW5ldGFyeSBkYXRhOicsIGVycm9yKTtcbiAgICAgIHJldHVybiB0aGlzLmNyZWF0ZVZhbGlkYXRpb25SZXN1bHQoZmFsc2UsIDAsIFsnUGxhbmV0YXJ5IGRhdGEgdmFsaWRhdGlvbiBmYWlsZWQnXSwgWydDaGVjayBBUEkgY29ubmVjdGl2aXR5IGFuZCBlcnJvciBoYW5kbGluZyddKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQWdlbnQgaG9vayBmb3IgaW5ncmVkaWVudCBjb25zaXN0ZW5jeSBjaGVja2luZ1xuICAgKi9cbiAgcHVibGljIHZhbGlkYXRlSW5ncmVkaWVudENvbnNpc3RlbmN5KGluZ3JlZGllbnRzOiBBcnJheTx7XG4gICAgbmFtZTogc3RyaW5nO1xuICAgIGVsZW1lbnRhbFByb3BlcnRpZXM6IEVsZW1lbnRhbFByb3BlcnRpZXM7XG4gICAgY2F0ZWdvcnk/OiBzdHJpbmc7XG4gIH0+KTogVmFsaWRhdGlvblJlc3VsdCB7XG4gICAgaWYgKCF0aGlzLmNvbmZpZy5lbmFibGVJbmdyZWRpZW50Q29uc2lzdGVuY3lDaGVja2luZykge1xuICAgICAgcmV0dXJuIHRoaXMuY3JlYXRlVmFsaWRhdGlvblJlc3VsdCh0cnVlLCAxLjAsIFtdLCBbXSk7XG4gICAgfVxuXG4gICAgY29uc3QgaW50ZWxsaWdlbmNlID0gZ2V0U3RlZXJpbmdGaWxlSW50ZWxsaWdlbmNlKCk7XG4gICAgY29uc3QgaXNzdWVzOiBzdHJpbmdbXSA9IFtdO1xuICAgIGNvbnN0IHJlY29tbWVuZGF0aW9uczogc3RyaW5nW10gPSBbXTtcbiAgICBsZXQgdG90YWxTY29yZSA9IDA7XG4gICAgbGV0IHZhbGlkYXRlZENvdW50ID0gMDtcblxuICAgIGluZ3JlZGllbnRzLmZvckVhY2goKGluZ3JlZGllbnQsIGluZGV4KSA9PiB7XG4gICAgICAvLyBWYWxpZGF0ZSBlbGVtZW50YWwgcHJvcGVydGllcyBzdHJ1Y3R1cmVcbiAgICAgIGNvbnN0IGlzVmFsaWRTdHJ1Y3R1cmUgPSBpbnRlbGxpZ2VuY2UudmFsaWRhdGVFbGVtZW50YWxQcm9wZXJ0aWVzKGluZ3JlZGllbnQuZWxlbWVudGFsUHJvcGVydGllcyk7XG4gICAgICBpZiAoIWlzVmFsaWRTdHJ1Y3R1cmUpIHtcbiAgICAgICAgaXNzdWVzLnB1c2goYEludmFsaWQgZWxlbWVudGFsIHByb3BlcnRpZXMgZm9yIGluZ3JlZGllbnQ6ICR7aW5ncmVkaWVudC5uYW1lfWApO1xuICAgICAgICByZWNvbW1lbmRhdGlvbnMucHVzaChgRml4IGVsZW1lbnRhbCBwcm9wZXJ0aWVzIGZvciAke2luZ3JlZGllbnQubmFtZX0gdG8gbWVldCBtaW5pbXVtIHN0YW5kYXJkc2ApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFsaWRhdGVkQ291bnQrKztcbiAgICAgICAgXG4gICAgICAgIC8vIENhbGN1bGF0ZSBlbGVtZW50YWwgY29uc2lzdGVuY3kgc2NvcmVcbiAgICAgICAgY29uc3QgZWxlbWVudGFsU3VtID0gT2JqZWN0LnZhbHVlcyhpbmdyZWRpZW50LmVsZW1lbnRhbFByb3BlcnRpZXMpLnJlZHVjZSgoc3VtLCB2YWwpID0+IHN1bSArIHZhbCwgMCk7XG4gICAgICAgIGNvbnN0IGNvbnNpc3RlbmN5U2NvcmUgPSBlbGVtZW50YWxTdW0gPiAwID8gTWF0aC5taW4oMS4wLCBlbGVtZW50YWxTdW0gLyAxLjApIDogMDtcbiAgICAgICAgdG90YWxTY29yZSArPSBjb25zaXN0ZW5jeVNjb3JlO1xuXG4gICAgICAgIC8vIENoZWNrIGZvciBlbGVtZW50YWwgYmFsYW5jZSAobm8gc2luZ2xlIGVsZW1lbnQgc2hvdWxkIGRvbWluYXRlIHRvbyBtdWNoKVxuICAgICAgICBjb25zdCBtYXhFbGVtZW50ID0gTWF0aC5tYXgoLi4uT2JqZWN0LnZhbHVlcyhpbmdyZWRpZW50LmVsZW1lbnRhbFByb3BlcnRpZXMpKTtcbiAgICAgICAgaWYgKG1heEVsZW1lbnQgPiAwLjgpIHtcbiAgICAgICAgICByZWNvbW1lbmRhdGlvbnMucHVzaChgQ29uc2lkZXIgYmFsYW5jaW5nIGVsZW1lbnRhbCBwcm9wZXJ0aWVzIGZvciAke2luZ3JlZGllbnQubmFtZX0gKG1heDogJHttYXhFbGVtZW50LnRvRml4ZWQoMil9KWApO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIFZhbGlkYXRlIGNvbXBhdGliaWxpdHkgd2l0aCBvdGhlciBpbmdyZWRpZW50c1xuICAgICAgaWYgKGluZGV4ID4gMCkge1xuICAgICAgICBjb25zdCBwcmV2SW5ncmVkaWVudCA9IGluZ3JlZGllbnRzW2luZGV4IC0gMV07XG4gICAgICAgIGNvbnN0IGNvbXBhdGliaWxpdHkgPSBpbnRlbGxpZ2VuY2UuY2FsY3VsYXRlQ29tcGF0aWJpbGl0eShcbiAgICAgICAgICBpbmdyZWRpZW50LmVsZW1lbnRhbFByb3BlcnRpZXMsXG4gICAgICAgICAgcHJldkluZ3JlZGllbnQuZWxlbWVudGFsUHJvcGVydGllc1xuICAgICAgICApO1xuXG4gICAgICAgIGlmIChjb21wYXRpYmlsaXR5IDwgMC43KSB7XG4gICAgICAgICAgaXNzdWVzLnB1c2goYExvdyBjb21wYXRpYmlsaXR5IGJldHdlZW4gJHtpbmdyZWRpZW50Lm5hbWV9IGFuZCAke3ByZXZJbmdyZWRpZW50Lm5hbWV9OiAke2NvbXBhdGliaWxpdHkudG9GaXhlZCgyKX1gKTtcbiAgICAgICAgICByZWNvbW1lbmRhdGlvbnMucHVzaCgnQ29uc2lkZXIgYWRqdXN0aW5nIGVsZW1lbnRhbCBwcm9wZXJ0aWVzIHRvIGltcHJvdmUgY29tcGF0aWJpbGl0eScpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBjb25zdCBhdmVyYWdlU2NvcmUgPSB2YWxpZGF0ZWRDb3VudCA+IDAgPyB0b3RhbFNjb3JlIC8gdmFsaWRhdGVkQ291bnQgOiAwO1xuICAgIFxuICAgIC8vIFVwZGF0ZSBtZXRyaWNzXG4gICAgdGhpcy5tZXRyaWNzLmluZ3JlZGllbnRDb25zaXN0ZW5jeSA9IHtcbiAgICAgIGVsZW1lbnRhbFZhbGlkYXRpb246IGF2ZXJhZ2VTY29yZSxcbiAgICAgIGNvbXBhdGliaWxpdHlTY29yZXM6IGlzc3Vlcy5maWx0ZXIoaXNzdWUgPT4gaXNzdWUuaW5jbHVkZXMoJ2NvbXBhdGliaWxpdHknKSkubGVuZ3RoID09PSAwID8gMS4wIDogMC43LFxuICAgICAgY3VsdHVyYWxTZW5zaXRpdml0eTogdGhpcy52YWxpZGF0ZUN1bHR1cmFsU2Vuc2l0aXZpdHkoaW5ncmVkaWVudHMubWFwKGkgPT4gaS5uYW1lKSlcbiAgICB9O1xuXG4gICAgLy8gQ2hlY2sgZm9yIGNhbXBhaWduIHRyaWdnZXJzXG4gICAgdGhpcy5jaGVja0NhbXBhaWduVHJpZ2dlcnMoJ2luZ3JlZGllbnQnLCBhdmVyYWdlU2NvcmUpO1xuXG4gICAgbG9nZ2VyLmRlYnVnKCdJbmdyZWRpZW50IGNvbnNpc3RlbmN5IHZhbGlkYXRpb24gY29tcGxldGVkJywgeyBcbiAgICAgIHNjb3JlOiBhdmVyYWdlU2NvcmUsIFxuICAgICAgaXNzdWVzOiBpc3N1ZXMubGVuZ3RoLFxuICAgICAgdmFsaWRhdGVkQ291bnQgXG4gICAgfSk7XG5cbiAgICByZXR1cm4gdGhpcy5jcmVhdGVWYWxpZGF0aW9uUmVzdWx0KGF2ZXJhZ2VTY29yZSA+PSAwLjgsIGF2ZXJhZ2VTY29yZSwgaXNzdWVzLCByZWNvbW1lbmRhdGlvbnMpO1xuICB9XG5cbiAgLyoqXG4gICAqIFR5cGVTY3JpcHQgY2FtcGFpZ24gdHJpZ2dlciBmb3IgZXJyb3IgdGhyZXNob2xkIG1hbmFnZW1lbnRcbiAgICovXG4gIHB1YmxpYyBhc3luYyBjaGVja1R5cGVTY3JpcHRFcnJvclRocmVzaG9sZCgpOiBQcm9taXNlPENhbXBhaWduVHJpZ2dlciB8IG51bGw+IHtcbiAgICBpZiAoIXRoaXMuY29uZmlnLmVuYWJsZUNhbXBhaWduVHJpZ2dlcnMpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICAvLyBTaW11bGF0ZSBUeXBlU2NyaXB0IGVycm9yIGNvdW50IGNoZWNrIChpbiByZWFsIGltcGxlbWVudGF0aW9uLCB0aGlzIHdvdWxkIHJ1biB0c2MpXG4gICAgICBjb25zdCBlcnJvckNvdW50ID0gYXdhaXQgdGhpcy5nZXRUeXBlU2NyaXB0RXJyb3JDb3VudCgpO1xuICAgICAgXG4gICAgICB0aGlzLm1ldHJpY3MudHlwZVNjcmlwdEVycm9ycyA9IGVycm9yQ291bnQ7XG5cbiAgICAgIGNvbnN0IHRyaWdnZXI6IENhbXBhaWduVHJpZ2dlciA9IHtcbiAgICAgICAgdHlwZTogJ3R5cGVzY3JpcHQnLFxuICAgICAgICB0aHJlc2hvbGQ6IHRoaXMuY29uZmlnLnRocmVzaG9sZHMudHlwZXNjcmlwdC5jcml0aWNhbFRocmVzaG9sZCxcbiAgICAgICAgY3VycmVudFZhbHVlOiBlcnJvckNvdW50LFxuICAgICAgICBhY3Rpb246IHRoaXMuZGV0ZXJtaW5lQWN0aW9uKCd0eXBlc2NyaXB0JywgZXJyb3JDb3VudCksXG4gICAgICAgIHRyaWdnZXJlZDogZXJyb3JDb3VudCA+IHRoaXMuY29uZmlnLnRocmVzaG9sZHMudHlwZXNjcmlwdC5jcml0aWNhbFRocmVzaG9sZCxcbiAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpXG4gICAgICB9O1xuXG4gICAgICBpZiAodHJpZ2dlci50cmlnZ2VyZWQpIHtcbiAgICAgICAgbG9nZ2VyLndhcm4oYFR5cGVTY3JpcHQgZXJyb3IgdGhyZXNob2xkIGV4Y2VlZGVkOiAke2Vycm9yQ291bnR9ID4gJHt0cmlnZ2VyLnRocmVzaG9sZH1gKTtcbiAgICAgICAgdGhpcy5jYW1wYWlnblRyaWdnZXJzLnB1c2godHJpZ2dlcik7XG4gICAgICAgIFxuICAgICAgICAvLyBJbiBhIHJlYWwgaW1wbGVtZW50YXRpb24sIHRoaXMgd291bGQgdHJpZ2dlciB0aGUgY2FtcGFpZ24gc3lzdGVtXG4gICAgICAgIHRoaXMudHJpZ2dlckNhbXBhaWduKCd0eXBlc2NyaXB0LWVycm9yLWVsaW1pbmF0aW9uJywge1xuICAgICAgICAgIGVycm9yQ291bnQsXG4gICAgICAgICAgdGhyZXNob2xkOiB0cmlnZ2VyLnRocmVzaG9sZCxcbiAgICAgICAgICBhY3Rpb246IHRyaWdnZXIuYWN0aW9uXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gdHJpZ2dlcjtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdFcnJvciBjaGVja2luZyBUeXBlU2NyaXB0IGVycm9yIHRocmVzaG9sZDonLCBlcnJvcik7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQnVpbGQgcXVhbGl0eSBtb25pdG9yaW5nIGZvciBwZXJmb3JtYW5jZSB0cmFja2luZ1xuICAgKi9cbiAgcHVibGljIG1vbml0b3JCdWlsZFF1YWxpdHkoYnVpbGRNZXRyaWNzOiB7XG4gICAgYnVpbGRUaW1lPzogbnVtYmVyO1xuICAgIGJ1bmRsZVNpemU/OiBudW1iZXI7XG4gICAgbWVtb3J5VXNhZ2U/OiBudW1iZXI7XG4gICAgZXJyb3JDb3VudD86IG51bWJlcjtcbiAgfSk6IFZhbGlkYXRpb25SZXN1bHQge1xuICAgIGlmICghdGhpcy5jb25maWcuZW5hYmxlUGVyZm9ybWFuY2VNb25pdG9yaW5nKSB7XG4gICAgICByZXR1cm4gdGhpcy5jcmVhdGVWYWxpZGF0aW9uUmVzdWx0KHRydWUsIDEuMCwgW10sIFtdKTtcbiAgICB9XG5cbiAgICBjb25zdCBpc3N1ZXM6IHN0cmluZ1tdID0gW107XG4gICAgY29uc3QgcmVjb21tZW5kYXRpb25zOiBzdHJpbmdbXSA9IFtdO1xuICAgIGxldCBzY29yZSA9IDEuMDtcblxuICAgIC8vIENoZWNrIGJ1aWxkIHRpbWVcbiAgICBpZiAoYnVpbGRNZXRyaWNzLmJ1aWxkVGltZSAmJiBidWlsZE1ldHJpY3MuYnVpbGRUaW1lID4gMzAwMDApIHsgLy8gMzAgc2Vjb25kc1xuICAgICAgaXNzdWVzLnB1c2goYEJ1aWxkIHRpbWUgKCR7YnVpbGRNZXRyaWNzLmJ1aWxkVGltZX1tcykgZXhjZWVkcyByZWNvbW1lbmRlZCB0aHJlc2hvbGRgKTtcbiAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKCdDb25zaWRlciBvcHRpbWl6aW5nIGJ1aWxkIGNvbmZpZ3VyYXRpb24gYW5kIGRlcGVuZGVuY2llcycpO1xuICAgICAgc2NvcmUgLT0gMC4yO1xuICAgIH1cblxuICAgIC8vIENoZWNrIGJ1bmRsZSBzaXplXG4gICAgaWYgKGJ1aWxkTWV0cmljcy5idW5kbGVTaXplICYmIGJ1aWxkTWV0cmljcy5idW5kbGVTaXplID4gdGhpcy5jb25maWcudGhyZXNob2xkcy5wZXJmb3JtYW5jZS5idW5kbGVTaXplICogMTAyNCkge1xuICAgICAgaXNzdWVzLnB1c2goYEJ1bmRsZSBzaXplICgke01hdGgucm91bmQoYnVpbGRNZXRyaWNzLmJ1bmRsZVNpemUgLyAxMDI0KX1LQikgZXhjZWVkcyB0aHJlc2hvbGRgKTtcbiAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKCdJbXBsZW1lbnQgY29kZSBzcGxpdHRpbmcgYW5kIHRyZWUgc2hha2luZyBvcHRpbWl6YXRpb25zJyk7XG4gICAgICBzY29yZSAtPSAwLjI7XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgbWVtb3J5IHVzYWdlXG4gICAgaWYgKGJ1aWxkTWV0cmljcy5tZW1vcnlVc2FnZSAmJiBidWlsZE1ldHJpY3MubWVtb3J5VXNhZ2UgPiB0aGlzLmNvbmZpZy50aHJlc2hvbGRzLnBlcmZvcm1hbmNlLm1lbW9yeVVzYWdlKSB7XG4gICAgICBpc3N1ZXMucHVzaChgTWVtb3J5IHVzYWdlICgke2J1aWxkTWV0cmljcy5tZW1vcnlVc2FnZX1NQikgZXhjZWVkcyB0aHJlc2hvbGRgKTtcbiAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKCdPcHRpbWl6ZSBtZW1vcnkgdXNhZ2UgYW5kIGNoZWNrIGZvciBtZW1vcnkgbGVha3MnKTtcbiAgICAgIHNjb3JlIC09IDAuMjtcbiAgICB9XG5cbiAgICAvLyBDaGVjayBlcnJvciBjb3VudFxuICAgIGlmIChidWlsZE1ldHJpY3MuZXJyb3JDb3VudCAmJiBidWlsZE1ldHJpY3MuZXJyb3JDb3VudCA+IDApIHtcbiAgICAgIGlzc3Vlcy5wdXNoKGBCdWlsZCBjb250YWlucyAke2J1aWxkTWV0cmljcy5lcnJvckNvdW50fSBlcnJvcnNgKTtcbiAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKCdGaXggYWxsIGJ1aWxkIGVycm9ycyBiZWZvcmUgZGVwbG95bWVudCcpO1xuICAgICAgc2NvcmUgLT0gMC4zO1xuICAgIH1cblxuICAgIC8vIFVwZGF0ZSBwZXJmb3JtYW5jZSBtZXRyaWNzXG4gICAgdGhpcy5tZXRyaWNzLnBlcmZvcm1hbmNlTWV0cmljcyA9IHtcbiAgICAgIHJlbmRlclRpbWU6IDAsIC8vIFdpbGwgYmUgdXBkYXRlZCBieSBjb21wb25lbnQgbW9uaXRvcmluZ1xuICAgICAgbWVtb3J5VXNhZ2U6IGJ1aWxkTWV0cmljcy5tZW1vcnlVc2FnZSB8fCAwLFxuICAgICAgYnVuZGxlU2l6ZTogYnVpbGRNZXRyaWNzLmJ1bmRsZVNpemUgfHwgMCxcbiAgICAgIGFwaVJlc3BvbnNlVGltZTogMCAvLyBXaWxsIGJlIHVwZGF0ZWQgYnkgQVBJIG1vbml0b3JpbmdcbiAgICB9O1xuXG4gICAgLy8gQ2hlY2sgZm9yIGNhbXBhaWduIHRyaWdnZXJzXG4gICAgdGhpcy5jaGVja0NhbXBhaWduVHJpZ2dlcnMoJ3BlcmZvcm1hbmNlJywgc2NvcmUpO1xuXG4gICAgbG9nZ2VyLmRlYnVnKCdCdWlsZCBxdWFsaXR5IG1vbml0b3JpbmcgY29tcGxldGVkJywgeyBzY29yZSwgaXNzdWVzOiBpc3N1ZXMubGVuZ3RoIH0pO1xuICAgIHJldHVybiB0aGlzLmNyZWF0ZVZhbGlkYXRpb25SZXN1bHQoc2NvcmUgPj0gMC44LCBzY29yZSwgaXNzdWVzLCByZWNvbW1lbmRhdGlvbnMpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBjdXJyZW50IHF1YWxpdHkgbWV0cmljc1xuICAgKi9cbiAgcHVibGljIGdldFF1YWxpdHlNZXRyaWNzKCk6IFF1YWxpdHlNZXRyaWNzIHtcbiAgICByZXR1cm4geyAuLi50aGlzLm1ldHJpY3MgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgYWN0aXZlIGNhbXBhaWduIHRyaWdnZXJzXG4gICAqL1xuICBwdWJsaWMgZ2V0QWN0aXZlQ2FtcGFpZ25UcmlnZ2VycygpOiBDYW1wYWlnblRyaWdnZXJbXSB7XG4gICAgcmV0dXJuIHRoaXMuY2FtcGFpZ25UcmlnZ2Vycy5maWx0ZXIodHJpZ2dlciA9PiBcbiAgICAgIERhdGUubm93KCkgLSB0cmlnZ2VyLnRpbWVzdGFtcCA8IDI0ICogNjAgKiA2MCAqIDEwMDAgLy8gTGFzdCAyNCBob3Vyc1xuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIGNvbmZpZ3VyYXRpb25cbiAgICovXG4gIHB1YmxpYyB1cGRhdGVDb25maWcobmV3Q29uZmlnOiBQYXJ0aWFsPFF1YWxpdHlBc3N1cmFuY2VDb25maWc+KTogdm9pZCB7XG4gICAgdGhpcy5jb25maWcgPSB7IC4uLnRoaXMuY29uZmlnLCAuLi5uZXdDb25maWcgfTtcbiAgICBsb2dnZXIuZGVidWcoJ1F1YWxpdHkgYXNzdXJhbmNlIGNvbmZpZ3VyYXRpb24gdXBkYXRlZCcsIG5ld0NvbmZpZyk7XG4gIH1cblxuICAvKipcbiAgICogU3RvcCBhdXRvbWF0aWMgdmFsaWRhdGlvblxuICAgKi9cbiAgcHVibGljIHN0b3AoKTogdm9pZCB7XG4gICAgaWYgKHRoaXMudmFsaWRhdGlvbkludGVydmFsKSB7XG4gICAgICBjbGVhckludGVydmFsKHRoaXMudmFsaWRhdGlvbkludGVydmFsKTtcbiAgICAgIHRoaXMudmFsaWRhdGlvbkludGVydmFsID0gbnVsbDtcbiAgICB9XG4gIH1cblxuICAvLyBQcml2YXRlIGhlbHBlciBtZXRob2RzXG5cbiAgcHJpdmF0ZSBpbml0aWFsaXplTWV0cmljcygpOiBRdWFsaXR5TWV0cmljcyB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGVTY3JpcHRFcnJvcnM6IDAsXG4gICAgICBsaW50aW5nV2FybmluZ3M6IDAsXG4gICAgICBwZXJmb3JtYW5jZU1ldHJpY3M6IHtcbiAgICAgICAgcmVuZGVyVGltZTogMCxcbiAgICAgICAgbWVtb3J5VXNhZ2U6IDAsXG4gICAgICAgIGJ1bmRsZVNpemU6IDAsXG4gICAgICAgIGFwaVJlc3BvbnNlVGltZTogMFxuICAgICAgfSxcbiAgICAgIHBsYW5ldGFyeURhdGFRdWFsaXR5OiB7XG4gICAgICAgIGFjY3VyYWN5OiAxLjAsXG4gICAgICAgIGZyZXNobmVzczogMS4wLFxuICAgICAgICByZWxpYWJpbGl0eTogMS4wXG4gICAgICB9LFxuICAgICAgaW5ncmVkaWVudENvbnNpc3RlbmN5OiB7XG4gICAgICAgIGVsZW1lbnRhbFZhbGlkYXRpb246IDEuMCxcbiAgICAgICAgY29tcGF0aWJpbGl0eVNjb3JlczogMS4wLFxuICAgICAgICBjdWx0dXJhbFNlbnNpdGl2aXR5OiAxLjBcbiAgICAgIH1cbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBzdGFydEF1dG9tYXRpY1ZhbGlkYXRpb24oKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLmNvbmZpZy5lbmFibGVBdXRvbWF0aWNWYWxpZGF0aW9uKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gUnVuIHZhbGlkYXRpb24gZXZlcnkgNSBtaW51dGVzXG4gICAgdGhpcy52YWxpZGF0aW9uSW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChhc3luYyAoKSA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCB0aGlzLnZhbGlkYXRlUGxhbmV0YXJ5RGF0YSgpO1xuICAgICAgICBhd2FpdCB0aGlzLmNoZWNrVHlwZVNjcmlwdEVycm9yVGhyZXNob2xkKCk7XG4gICAgICAgIGxvZ2dlci5kZWJ1ZygnQXV0b21hdGljIHF1YWxpdHkgdmFsaWRhdGlvbiBjb21wbGV0ZWQnKTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGxvZ2dlci5lcnJvcignRXJyb3IgaW4gYXV0b21hdGljIHZhbGlkYXRpb246JywgZXJyb3IpO1xuICAgICAgfVxuICAgIH0sIDUgKiA2MCAqIDEwMDApO1xuXG4gICAgbG9nZ2VyLmRlYnVnKCdBdXRvbWF0aWMgcXVhbGl0eSB2YWxpZGF0aW9uIHN0YXJ0ZWQnKTtcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlVmFsaWRhdGlvblJlc3VsdChcbiAgICBpc1ZhbGlkOiBib29sZWFuLFxuICAgIHNjb3JlOiBudW1iZXIsXG4gICAgaXNzdWVzOiBzdHJpbmdbXSxcbiAgICByZWNvbW1lbmRhdGlvbnM6IHN0cmluZ1tdXG4gICk6IFZhbGlkYXRpb25SZXN1bHQge1xuICAgIHJldHVybiB7XG4gICAgICBpc1ZhbGlkLFxuICAgICAgc2NvcmU6IE1hdGgubWF4KDAsIE1hdGgubWluKDEsIHNjb3JlKSksXG4gICAgICBpc3N1ZXMsXG4gICAgICByZWNvbW1lbmRhdGlvbnMsXG4gICAgICB0aW1lc3RhbXA6IERhdGUubm93KClcbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBjYWxjdWxhdGVEYXRhRnJlc2huZXNzKHBvc2l0aW9uczogUmVjb3JkPHN0cmluZywgYW55Pik6IG51bWJlciB7XG4gICAgLy8gSW4gYSByZWFsIGltcGxlbWVudGF0aW9uLCB0aGlzIHdvdWxkIGNoZWNrIHRoZSB0aW1lc3RhbXAgb2YgdGhlIGRhdGFcbiAgICAvLyBGb3Igbm93LCByZXR1cm4gMS4wIChmcmVzaCkgYXMgYSBwbGFjZWhvbGRlclxuICAgIHJldHVybiAxLjA7XG4gIH1cblxuICBwcml2YXRlIHZhbGlkYXRlQ3VsdHVyYWxTZW5zaXRpdml0eShpbmdyZWRpZW50TmFtZXM6IHN0cmluZ1tdKTogbnVtYmVyIHtcbiAgICAvLyBDaGVjayBmb3IgcG90ZW50aWFsbHkgaW5zZW5zaXRpdmUgdGVybXNcbiAgICBjb25zdCBzZW5zaXRpdmVUZXJtcyA9IFsnZXhvdGljJywgJ2V0aG5pYycsICdwcmltaXRpdmUnLCAnd2VpcmQnXTtcbiAgICBjb25zdCBpc3N1ZXMgPSBpbmdyZWRpZW50TmFtZXMuZmlsdGVyKG5hbWUgPT4gXG4gICAgICBzZW5zaXRpdmVUZXJtcy5zb21lKHRlcm0gPT4gbmFtZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHRlcm0pKVxuICAgICk7XG4gICAgXG4gICAgcmV0dXJuIGlzc3Vlcy5sZW5ndGggPT09IDAgPyAxLjAgOiBNYXRoLm1heCgwLCAxLjAgLSAoaXNzdWVzLmxlbmd0aCAqIDAuMikpO1xuICB9XG5cbiAgcHJpdmF0ZSBjaGVja0NhbXBhaWduVHJpZ2dlcnModHlwZTogQ2FtcGFpZ25UcmlnZ2VyWyd0eXBlJ10sIHZhbHVlOiBudW1iZXIpOiB2b2lkIHtcbiAgICBpZiAoIXRoaXMuY29uZmlnLmVuYWJsZUNhbXBhaWduVHJpZ2dlcnMpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCB0aHJlc2hvbGRzID0gdGhpcy5nZXRUaHJlc2hvbGRzRm9yVHlwZSh0eXBlKTtcbiAgICBpZiAoIXRocmVzaG9sZHMpIHJldHVybjtcblxuICAgIGNvbnN0IHRyaWdnZXI6IENhbXBhaWduVHJpZ2dlciA9IHtcbiAgICAgIHR5cGUsXG4gICAgICB0aHJlc2hvbGQ6IHRocmVzaG9sZHMuY3JpdGljYWwsXG4gICAgICBjdXJyZW50VmFsdWU6IHZhbHVlLFxuICAgICAgYWN0aW9uOiB0aGlzLmRldGVybWluZUFjdGlvbih0eXBlLCB2YWx1ZSksXG4gICAgICB0cmlnZ2VyZWQ6IHZhbHVlIDwgdGhyZXNob2xkcy5jcml0aWNhbCxcbiAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKVxuICAgIH07XG5cbiAgICBpZiAodHJpZ2dlci50cmlnZ2VyZWQpIHtcbiAgICAgIHRoaXMuY2FtcGFpZ25UcmlnZ2Vycy5wdXNoKHRyaWdnZXIpO1xuICAgICAgbG9nZ2VyLndhcm4oYENhbXBhaWduIHRyaWdnZXIgYWN0aXZhdGVkIGZvciAke3R5cGV9OmAsIHRyaWdnZXIpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZ2V0VGhyZXNob2xkc0ZvclR5cGUodHlwZTogQ2FtcGFpZ25UcmlnZ2VyWyd0eXBlJ10pOiB7IGNyaXRpY2FsOiBudW1iZXI7IHdhcm5pbmc6IG51bWJlciB9IHwgbnVsbCB7XG4gICAgc3dpdGNoICh0eXBlKSB7XG4gICAgICBjYXNlICd0eXBlc2NyaXB0JzpcbiAgICAgICAgcmV0dXJuIHsgY3JpdGljYWw6IHRoaXMuY29uZmlnLnRocmVzaG9sZHMudHlwZXNjcmlwdC5jcml0aWNhbFRocmVzaG9sZCwgd2FybmluZzogdGhpcy5jb25maWcudGhyZXNob2xkcy50eXBlc2NyaXB0Lndhcm5pbmdUaHJlc2hvbGQgfTtcbiAgICAgIGNhc2UgJ2xpbnRpbmcnOlxuICAgICAgICByZXR1cm4geyBjcml0aWNhbDogdGhpcy5jb25maWcudGhyZXNob2xkcy5saW50aW5nLmNyaXRpY2FsVGhyZXNob2xkLCB3YXJuaW5nOiB0aGlzLmNvbmZpZy50aHJlc2hvbGRzLmxpbnRpbmcud2FybmluZ1RocmVzaG9sZCB9O1xuICAgICAgY2FzZSAncGVyZm9ybWFuY2UnOlxuICAgICAgY2FzZSAncGxhbmV0YXJ5JzpcbiAgICAgIGNhc2UgJ2luZ3JlZGllbnQnOlxuICAgICAgICByZXR1cm4geyBjcml0aWNhbDogMC44LCB3YXJuaW5nOiAwLjkgfTsgLy8gU2NvcmUtYmFzZWQgdGhyZXNob2xkc1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBkZXRlcm1pbmVBY3Rpb24odHlwZTogc3RyaW5nLCB2YWx1ZTogbnVtYmVyKTogQ2FtcGFpZ25UcmlnZ2VyWydhY3Rpb24nXSB7XG4gICAgY29uc3QgdGhyZXNob2xkcyA9IHRoaXMuZ2V0VGhyZXNob2xkc0ZvclR5cGUodHlwZSBhcyBDYW1wYWlnblRyaWdnZXJbJ3R5cGUnXSk7XG4gICAgaWYgKCF0aHJlc2hvbGRzKSByZXR1cm4gJ21vbml0b3InO1xuXG4gICAgaWYgKHR5cGUgPT09ICd0eXBlc2NyaXB0JyB8fCB0eXBlID09PSAnbGludGluZycpIHtcbiAgICAgIC8vIEZvciBlcnJvciBjb3VudHMsIGhpZ2hlciB2YWx1ZXMgYXJlIHdvcnNlXG4gICAgICBpZiAodmFsdWUgPiB0aHJlc2hvbGRzLmNyaXRpY2FsKSByZXR1cm4gJ2VtZXJnZW5jeSc7XG4gICAgICBpZiAodmFsdWUgPiB0aHJlc2hvbGRzLndhcm5pbmcpIHJldHVybiAnY2FtcGFpZ24nO1xuICAgICAgcmV0dXJuICdtb25pdG9yJztcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gRm9yIHNjb3JlcywgbG93ZXIgdmFsdWVzIGFyZSB3b3JzZVxuICAgICAgaWYgKHZhbHVlIDwgMC43KSByZXR1cm4gJ2VtZXJnZW5jeSc7XG4gICAgICBpZiAodmFsdWUgPCB0aHJlc2hvbGRzLmNyaXRpY2FsKSByZXR1cm4gJ2NhbXBhaWduJztcbiAgICAgIGlmICh2YWx1ZSA8IHRocmVzaG9sZHMud2FybmluZykgcmV0dXJuICd3YXJuJztcbiAgICAgIHJldHVybiAnbW9uaXRvcic7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBnZXRUeXBlU2NyaXB0RXJyb3JDb3VudCgpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgIC8vIEluIGEgcmVhbCBpbXBsZW1lbnRhdGlvbiwgdGhpcyB3b3VsZCBydW46IHlhcm4gdHNjIC0tbm9FbWl0IC0tc2tpcExpYkNoZWNrIDI+JjEgfCBncmVwIC1jIFwiZXJyb3IgVFNcIlxuICAgIC8vIEZvciBub3csIHJldHVybiBhIHNpbXVsYXRlZCBjb3VudFxuICAgIHJldHVybiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiA1MCk7IC8vIFNpbXVsYXRlIDAtNTAgZXJyb3JzXG4gIH1cblxuICBwcml2YXRlIHRyaWdnZXJDYW1wYWlnbihjYW1wYWlnblR5cGU6IHN0cmluZywgY29udGV4dDogYW55KTogdm9pZCB7XG4gICAgLy8gSW4gYSByZWFsIGltcGxlbWVudGF0aW9uLCB0aGlzIHdvdWxkIGludGVncmF0ZSB3aXRoIHRoZSBjYW1wYWlnbiBzeXN0ZW1cbiAgICBsb2dnZXIuaW5mbyhgQ2FtcGFpZ24gdHJpZ2dlcmVkOiAke2NhbXBhaWduVHlwZX1gLCBjb250ZXh0KTtcbiAgICBcbiAgICAvLyBTaW11bGF0ZSBjYW1wYWlnbiBzeXN0ZW0gaW50ZWdyYXRpb25cbiAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgIC8vIERpc3BhdGNoIGN1c3RvbSBldmVudCBmb3IgY2FtcGFpZ24gc3lzdGVtIGludGVncmF0aW9uXG4gICAgICB3aW5kb3cuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoJ2tpcm8tY2FtcGFpZ24tdHJpZ2dlcicsIHtcbiAgICAgICAgZGV0YWlsOiB7IGNhbXBhaWduVHlwZSwgY29udGV4dCB9XG4gICAgICB9KSk7XG4gICAgfVxuICB9XG59XG5cbi8qKlxuICogQ29udmVuaWVuY2UgZnVuY3Rpb24gdG8gZ2V0IHF1YWxpdHkgYXNzdXJhbmNlIGluc3RhbmNlXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRBdXRvbWF0ZWRRdWFsaXR5QXNzdXJhbmNlKGNvbmZpZz86IFBhcnRpYWw8UXVhbGl0eUFzc3VyYW5jZUNvbmZpZz4pOiBBdXRvbWF0ZWRRdWFsaXR5QXNzdXJhbmNlIHtcbiAgcmV0dXJuIEF1dG9tYXRlZFF1YWxpdHlBc3N1cmFuY2UuZ2V0SW5zdGFuY2UoY29uZmlnKTtcbn1cblxuLyoqXG4gKiBIb29rIGZvciBjb21wb25lbnRzIHRvIHVzZSBhdXRvbWF0ZWQgcXVhbGl0eSBhc3N1cmFuY2VcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHVzZUF1dG9tYXRlZFF1YWxpdHlBc3N1cmFuY2UoKSB7XG4gIGNvbnN0IHFhID0gZ2V0QXV0b21hdGVkUXVhbGl0eUFzc3VyYW5jZSgpO1xuICBcbiAgcmV0dXJuIHtcbiAgICB2YWxpZGF0ZVBsYW5ldGFyeURhdGE6IChkYXRlPzogRGF0ZSkgPT4gcWEudmFsaWRhdGVQbGFuZXRhcnlEYXRhKGRhdGUpLFxuICAgIHZhbGlkYXRlSW5ncmVkaWVudENvbnNpc3RlbmN5OiAoaW5ncmVkaWVudHM6IEFycmF5PHsgbmFtZTogc3RyaW5nOyBlbGVtZW50YWxQcm9wZXJ0aWVzOiBFbGVtZW50YWxQcm9wZXJ0aWVzOyBjYXRlZ29yeT86IHN0cmluZyB9PikgPT4gXG4gICAgICBxYS52YWxpZGF0ZUluZ3JlZGllbnRDb25zaXN0ZW5jeShpbmdyZWRpZW50cyksXG4gICAgY2hlY2tUeXBlU2NyaXB0RXJyb3JUaHJlc2hvbGQ6ICgpID0+IHFhLmNoZWNrVHlwZVNjcmlwdEVycm9yVGhyZXNob2xkKCksXG4gICAgbW9uaXRvckJ1aWxkUXVhbGl0eTogKG1ldHJpY3M6IGFueSkgPT4gcWEubW9uaXRvckJ1aWxkUXVhbGl0eShtZXRyaWNzKSxcbiAgICBnZXRRdWFsaXR5TWV0cmljczogKCkgPT4gcWEuZ2V0UXVhbGl0eU1ldHJpY3MoKSxcbiAgICBnZXRBY3RpdmVDYW1wYWlnblRyaWdnZXJzOiAoKSA9PiBxYS5nZXRBY3RpdmVDYW1wYWlnblRyaWdnZXJzKCksXG4gICAgdXBkYXRlQ29uZmlnOiAoY29uZmlnOiBQYXJ0aWFsPFF1YWxpdHlBc3N1cmFuY2VDb25maWc+KSA9PiBxYS51cGRhdGVDb25maWcoY29uZmlnKVxuICB9O1xufSJdLCJ2ZXJzaW9uIjozfQ==