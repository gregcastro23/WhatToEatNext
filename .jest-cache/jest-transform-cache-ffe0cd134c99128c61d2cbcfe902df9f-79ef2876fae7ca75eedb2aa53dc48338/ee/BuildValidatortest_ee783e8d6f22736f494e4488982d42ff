8e1fa1dd1e0afb43cdd82bb3eab3a58b
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
// Mock fs module
jest.mock('fs');
// Mock child_process
jest.mock('child_process');
const BuildValidator_1 = require("../../utils/BuildValidator");
const fs_1 = __importDefault(require("fs"));
const mockFs = fs_1.default;
describe('BuildValidator', () => {
    let buildValidator;
    let mockLogger;
    beforeEach(() => {
        mockLogger = jest.fn();
        buildValidator = new BuildValidator_1.BuildValidator('.next', mockLogger);
        jest.clearAllMocks();
    });
    describe('validateBuild', () => {
        it('should return valid result when all files exist', async () => {
            // Mock all required files exist
            mockFs.existsSync.mockReturnValue(true);
            mockFs.readFileSync.mockReturnValue('{}');
            const result = await buildValidator.validateBuild();
            expect(result.isValid).toBe(true);
            expect(result.missingFiles).toHaveLength(0);
            expect(result.corruptedFiles).toHaveLength(0);
        });
        it('should detect missing build directory', async () => {
            mockFs.existsSync.mockReturnValue(false);
            const result = await buildValidator.validateBuild();
            expect(result.isValid).toBe(false);
            expect(result.missingFiles).toContain('.next');
            expect(result.repairActions).toEqual(expect.arrayContaining([
                expect.objectContaining({
                    type: 'create',
                    target: '.next',
                    description: 'Create build directory'
                })
            ]));
        });
        it('should detect missing manifest files', async () => {
            // Build directory exists but manifest files don't
            mockFs.existsSync.mockImplementation((path) => {
                return path === '.next' || path === '.next/server';
            });
            const result = await buildValidator.validateBuild();
            expect(result.isValid).toBe(false);
            expect(result.missingFiles.length).toBeGreaterThan(0);
            expect(result.repairActions.length).toBeGreaterThan(0);
        });
        it('should detect corrupted JSON files', async () => {
            mockFs.existsSync.mockReturnValue(true);
            mockFs.readFileSync.mockReturnValue('invalid json');
            const result = await buildValidator.validateBuild();
            expect(result.isValid).toBe(false);
            expect(result.corruptedFiles.length).toBeGreaterThan(0);
        });
        it('should detect empty manifest files', async () => {
            mockFs.existsSync.mockReturnValue(true);
            mockFs.readFileSync.mockReturnValue('');
            const result = await buildValidator.validateBuild();
            expect(result.corruptedFiles.length).toBeGreaterThan(0);
            expect(result.repairActions).toEqual(expect.arrayContaining([
                expect.objectContaining({
                    type: 'fix'
                })
            ]));
        });
    });
    describe('repairBuild', () => {
        it('should create missing directories and files', async () => {
            // Mock missing files scenario
            mockFs.existsSync.mockReturnValue(false);
            mockFs.mkdirSync.mockImplementation();
            mockFs.writeFileSync.mockImplementation();
            await buildValidator.repairBuild();
            expect(mockFs.mkdirSync).toHaveBeenCalledWith('.next', { recursive: true });
            expect(mockFs.mkdirSync).toHaveBeenCalledWith('.next/server', { recursive: true });
            expect(mockFs.writeFileSync).toHaveBeenCalled();
        });
        it('should not repair when build is valid', async () => {
            // Mock valid build
            mockFs.existsSync.mockReturnValue(true);
            mockFs.readFileSync.mockReturnValue('{}');
            await buildValidator.repairBuild();
            expect(mockLogger).toHaveBeenCalledWith('Build is valid, no repairs needed');
        });
    });
    describe('validateNextConfig', () => {
        it('should detect missing config file', () => {
            mockFs.existsSync.mockReturnValue(false);
            const result = buildValidator.validateNextConfig();
            expect(result.isValid).toBe(false);
            expect(result.issues).toContain('No Next.js configuration file found');
        });
        it('should validate existing config', () => {
            mockFs.existsSync.mockImplementation((path) => path === 'next.config.js');
            mockFs.readFileSync.mockReturnValue(`
        module.exports = {
          output: 'standalone',
          typescript: { ignoreBuildErrors: false },
          eslint: { ignoreDuringBuilds: false }
        }
      `);
            const result = buildValidator.validateNextConfig();
            expect(result.isValid).toBe(true);
        });
    });
    describe('monitorBuildHealth', () => {
        it('should report healthy build', async () => {
            mockFs.existsSync.mockReturnValue(true);
            mockFs.readFileSync.mockReturnValue('{}');
            mockFs.readdirSync.mockReturnValue([]);
            mockFs.statSync.mockReturnValue({
                mtime: new Date(),
                size: 1024,
                isDirectory: () => false
            });
            const report = await buildValidator.monitorBuildHealth();
            expect(report.buildExists).toBe(true);
            expect(report.manifestsValid).toBe(true);
            expect(report.issues).toHaveLength(0);
        });
        it('should report missing build', async () => {
            mockFs.existsSync.mockReturnValue(false);
            const report = await buildValidator.monitorBuildHealth();
            expect(report.buildExists).toBe(false);
            expect(report.issues).toContain('Build directory does not exist');
        });
    });
    describe('rebuildWithRecovery', () => {
        it('should succeed on first attempt', async () => {
            // Mock successful build
            const { execSync } = require('child_process');
            execSync.mockImplementation(() => 'Build successful');
            mockFs.existsSync.mockReturnValue(true);
            mockFs.readFileSync.mockReturnValue('{}');
            const result = await buildValidator.rebuildWithRecovery(3);
            expect(result).toBe(true);
            expect(mockLogger).toHaveBeenCalledWith('Build successful on attempt 1');
        });
        it('should retry on failure', async () => {
            const { execSync } = require('child_process');
            execSync
                .mockImplementationOnce(() => { throw new Error('Build failed'); })
                .mockImplementationOnce(() => 'Build successful');
            mockFs.existsSync.mockReturnValue(true);
            mockFs.readFileSync.mockReturnValue('{}');
            mockFs.rmSync.mockImplementation();
            const result = await buildValidator.rebuildWithRecovery(3);
            expect(result).toBe(true);
            expect(execSync).toHaveBeenCalledTimes(2);
        });
        it('should fail after max retries', async () => {
            const { execSync } = require('child_process');
            execSync.mockImplementation(() => { throw new Error('Build failed'); });
            const result = await buildValidator.rebuildWithRecovery(2);
            expect(result).toBe(false);
            expect(mockLogger).toHaveBeenCalledWith('Build failed after 2 attempts');
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9fX3Rlc3RzX18vdXRpbHMvQnVpbGRWYWxpZGF0b3IudGVzdC50cyIsIm1hcHBpbmdzIjoiOzs7OztBQUlBLGlCQUFpQjtBQUNqQixJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0FBR2hCLHFCQUFxQjtBQUNyQixJQUFJLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFDO0FBVDNCLCtEQUFtRjtBQUNuRiw0Q0FBb0I7QUFLcEIsTUFBTSxNQUFNLEdBQUcsWUFBNEIsQ0FBQztBQUs1QyxRQUFRLENBQUMsZ0JBQWdCLEVBQUUsR0FBRyxFQUFFO0lBQzlCLElBQUksY0FBOEIsQ0FBQztJQUNuQyxJQUFJLFVBQXFCLENBQUM7SUFFMUIsVUFBVSxDQUFDLEdBQUcsRUFBRTtRQUNkLFVBQVUsR0FBRyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUM7UUFDdkIsY0FBYyxHQUFHLElBQUksK0JBQWMsQ0FBQyxPQUFPLEVBQUUsVUFBVSxDQUFDLENBQUM7UUFDekQsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO0lBQ3ZCLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLGVBQWUsRUFBRSxHQUFHLEVBQUU7UUFDN0IsRUFBRSxDQUFDLGlEQUFpRCxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQy9ELGdDQUFnQztZQUNoQyxNQUFNLENBQUMsVUFBVSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUN4QyxNQUFNLENBQUMsWUFBWSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUUxQyxNQUFNLE1BQU0sR0FBRyxNQUFNLGNBQWMsQ0FBQyxhQUFhLEVBQUUsQ0FBQztZQUVwRCxNQUFNLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNsQyxNQUFNLENBQUMsTUFBTSxDQUFDLFlBQVksQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUFDLENB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QUFDLHFCQUFxQixDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzVDLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLCtCQUErQixFQUFFLEtBQUssSUFBSSxFQUFFO1lBQzdDLE1BQU0sRUFBRSxRQUFRLEVBQUUsR0FBRyxPQUFPLENBQUMsZUFBZSxDQUFDLENBQUM7WUFDOUMsUUFBUSxDQUFDLGtCQUFrQixDQUFDLEdBQUcsRUFBRSxHQUFHLE1BQU0sSUFBSSxLQUFLLENBQUMsY0FBYyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUV4RSxNQUFNLE1BQU0sR0FBRyxNQUFNLGNBQWMsQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUUzRCxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO1lBQzNCLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQywrQkFBK0IsQ0FBQyxDQUFDO1FBQzNFLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvR3JlZ0Nhc3Ryby9EZXNrdG9wL1doYXRUb0VhdE5leHQvc3JjL19fdGVzdHNfXy91dGlscy9CdWlsZFZhbGlkYXRvci50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEJ1aWxkVmFsaWRhdG9yLCBCdWlsZFZhbGlkYXRpb25SZXN1bHQgfSBmcm9tICcuLi8uLi91dGlscy9CdWlsZFZhbGlkYXRvcic7XG5pbXBvcnQgZnMgZnJvbSAnZnMnO1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5cbi8vIE1vY2sgZnMgbW9kdWxlXG5qZXN0Lm1vY2soJ2ZzJyk7XG5jb25zdCBtb2NrRnMgPSBmcyBhcyBqZXN0Lk1vY2tlZDx0eXBlb2YgZnM+O1xuXG4vLyBNb2NrIGNoaWxkX3Byb2Nlc3Ncbmplc3QubW9jaygnY2hpbGRfcHJvY2VzcycpO1xuXG5kZXNjcmliZSgnQnVpbGRWYWxpZGF0b3InLCAoKSA9PiB7XG4gIGxldCBidWlsZFZhbGlkYXRvcjogQnVpbGRWYWxpZGF0b3I7XG4gIGxldCBtb2NrTG9nZ2VyOiBqZXN0Lk1vY2s7XG5cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgbW9ja0xvZ2dlciA9IGplc3QuZm4oKTtcbiAgICBidWlsZFZhbGlkYXRvciA9IG5ldyBCdWlsZFZhbGlkYXRvcignLm5leHQnLCBtb2NrTG9nZ2VyKTtcbiAgICBqZXN0LmNsZWFyQWxsTW9ja3MoKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3ZhbGlkYXRlQnVpbGQnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gdmFsaWQgcmVzdWx0IHdoZW4gYWxsIGZpbGVzIGV4aXN0JywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gTW9jayBhbGwgcmVxdWlyZWQgZmlsZXMgZXhpc3RcbiAgICAgIG1vY2tGcy5leGlzdHNTeW5jLm1vY2tSZXR1cm5WYWx1ZSh0cnVlKTtcbiAgICAgIG1vY2tGcy5yZWFkRmlsZVN5bmMubW9ja1JldHVyblZhbHVlKCd7fScpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBidWlsZFZhbGlkYXRvci52YWxpZGF0ZUJ1aWxkKCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQuaXNWYWxpZCkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQubWlzc2luZ0ZpbGVzKS50b0hhdmVMZW5ndGgoMCk7XG4gICAgICBleHBlY3QocmVzdWx0LmNvcnJ1cHRlZEZpbGVzKS50b0hhdmVMZW5ndGgoMCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGRldGVjdCBtaXNzaW5nIGJ1aWxkIGRpcmVjdG9yeScsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tGcy5leGlzdHNTeW5jLm1vY2tSZXR1cm5WYWx1ZShmYWxzZSk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGJ1aWxkVmFsaWRhdG9yLnZhbGlkYXRlQnVpbGQoKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5pc1ZhbGlkKS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQubWlzc2luZ0ZpbGVzKS50b0NvbnRhaW4oJy5uZXh0Jyk7XG4gICAgICBleHBlY3QocmVzdWx0LnJlcGFpckFjdGlvbnMpLnRvRXF1YWwoXG4gICAgICAgIGV4cGVjdC5hcnJheUNvbnRhaW5pbmcoW1xuICAgICAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHtcbiAgICAgICAgICAgIHR5cGU6ICdjcmVhdGUnLFxuICAgICAgICAgICAgdGFyZ2V0OiAnLm5leHQnLFxuICAgICAgICAgICAgZGVzY3JpcHRpb246ICdDcmVhdGUgYnVpbGQgZGlyZWN0b3J5J1xuICAgICAgICAgIH0pXG4gICAgICAgIF0pXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBkZXRlY3QgbWlzc2luZyBtYW5pZmVzdCBmaWxlcycsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEJ1aWxkIGRpcmVjdG9yeSBleGlzdHMgYnV0IG1hbmlmZXN0IGZpbGVzIGRvbid0XG4gICAgICBtb2NrRnMuZXhpc3RzU3luYy5tb2NrSW1wbGVtZW50YXRpb24oKHBhdGg6IHN0cmluZykgPT4ge1xuICAgICAgICByZXR1cm4gcGF0aCA9PT0gJy5uZXh0JyB8fCBwYXRoID09PSAnLm5leHQvc2VydmVyJztcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBidWlsZFZhbGlkYXRvci52YWxpZGF0ZUJ1aWxkKCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQuaXNWYWxpZCkudG9CZShmYWxzZSk7XG4gICAgICBleHBlY3QocmVzdWx0Lm1pc3NpbmdGaWxlcy5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICAgIGV4cGVjdChyZXN1bHQucmVwYWlyQWN0aW9ucy5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZGV0ZWN0IGNvcnJ1cHRlZCBKU09OIGZpbGVzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja0ZzLmV4aXN0c1N5bmMubW9ja1JldHVyblZhbHVlKHRydWUpO1xuICAgICAgbW9ja0ZzLnJlYWRGaWxlU3luYy5tb2NrUmV0dXJuVmFsdWUoJ2ludmFsaWQganNvbicpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBidWlsZFZhbGlkYXRvci52YWxpZGF0ZUJ1aWxkKCk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQuaXNWYWxpZCkudG9CZShmYWxzZSk7XG4gICAgICBleHBlY3QocmVzdWx0LmNvcnJ1cHRlZEZpbGVzLmxlbmd0aCkudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBkZXRlY3QgZW1wdHkgbWFuaWZlc3QgZmlsZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrRnMuZXhpc3RzU3luYy5tb2NrUmV0dXJuVmFsdWUodHJ1ZSk7XG4gICAgICBtb2NrRnMucmVhZEZpbGVTeW5jLm1vY2tSZXR1cm5WYWx1ZSgnJyk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGJ1aWxkVmFsaWRhdG9yLnZhbGlkYXRlQnVpbGQoKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5jb3JydXB0ZWRGaWxlcy5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICAgIGV4cGVjdChyZXN1bHQucmVwYWlyQWN0aW9ucykudG9FcXVhbChcbiAgICAgICAgZXhwZWN0LmFycmF5Q29udGFpbmluZyhbXG4gICAgICAgICAgZXhwZWN0Lm9iamVjdENvbnRhaW5pbmcoe1xuICAgICAgICAgICAgdHlwZTogJ2ZpeCdcbiAgICAgICAgICB9KVxuICAgICAgICBdKVxuICAgICAgKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3JlcGFpckJ1aWxkJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgY3JlYXRlIG1pc3NpbmcgZGlyZWN0b3JpZXMgYW5kIGZpbGVzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgLy8gTW9jayBtaXNzaW5nIGZpbGVzIHNjZW5hcmlvXG4gICAgICBtb2NrRnMuZXhpc3RzU3luYy5tb2NrUmV0dXJuVmFsdWUoZmFsc2UpO1xuICAgICAgbW9ja0ZzLm1rZGlyU3luYy5tb2NrSW1wbGVtZW50YXRpb24oKTtcbiAgICAgIG1vY2tGcy53cml0ZUZpbGVTeW5jLm1vY2tJbXBsZW1lbnRhdGlvbigpO1xuXG4gICAgICBhd2FpdCBidWlsZFZhbGlkYXRvci5yZXBhaXJCdWlsZCgpO1xuXG4gICAgICBleHBlY3QobW9ja0ZzLm1rZGlyU3luYykudG9IYXZlQmVlbkNhbGxlZFdpdGgoJy5uZXh0JywgeyByZWN1cnNpdmU6IHRydWUgfSk7XG4gICAgICBleHBlY3QobW9ja0ZzLm1rZGlyU3luYykudG9IYXZlQmVlbkNhbGxlZFdpdGgoJy5uZXh0L3NlcnZlcicsIHsgcmVjdXJzaXZlOiB0cnVlIH0pO1xuICAgICAgZXhwZWN0KG1vY2tGcy53cml0ZUZpbGVTeW5jKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIG5vdCByZXBhaXIgd2hlbiBidWlsZCBpcyB2YWxpZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIE1vY2sgdmFsaWQgYnVpbGRcbiAgICAgIG1vY2tGcy5leGlzdHNTeW5jLm1vY2tSZXR1cm5WYWx1ZSh0cnVlKTtcbiAgICAgIG1vY2tGcy5yZWFkRmlsZVN5bmMubW9ja1JldHVyblZhbHVlKCd7fScpO1xuXG4gICAgICBhd2FpdCBidWlsZFZhbGlkYXRvci5yZXBhaXJCdWlsZCgpO1xuXG4gICAgICBleHBlY3QobW9ja0xvZ2dlcikudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ0J1aWxkIGlzIHZhbGlkLCBubyByZXBhaXJzIG5lZWRlZCcpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgndmFsaWRhdGVOZXh0Q29uZmlnJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZGV0ZWN0IG1pc3NpbmcgY29uZmlnIGZpbGUnLCAoKSA9PiB7XG4gICAgICBtb2NrRnMuZXhpc3RzU3luYy5tb2NrUmV0dXJuVmFsdWUoZmFsc2UpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBidWlsZFZhbGlkYXRvci52YWxpZGF0ZU5leHRDb25maWcoKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5pc1ZhbGlkKS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuaXNzdWVzKS50b0NvbnRhaW4oJ05vIE5leHQuanMgY29uZmlndXJhdGlvbiBmaWxlIGZvdW5kJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHZhbGlkYXRlIGV4aXN0aW5nIGNvbmZpZycsICgpID0+IHtcbiAgICAgIG1vY2tGcy5leGlzdHNTeW5jLm1vY2tJbXBsZW1lbnRhdGlvbigocGF0aDogc3RyaW5nKSA9PiBwYXRoID09PSAnbmV4dC5jb25maWcuanMnKTtcbiAgICAgIG1vY2tGcy5yZWFkRmlsZVN5bmMubW9ja1JldHVyblZhbHVlKGBcbiAgICAgICAgbW9kdWxlLmV4cG9ydHMgPSB7XG4gICAgICAgICAgb3V0cHV0OiAnc3RhbmRhbG9uZScsXG4gICAgICAgICAgdHlwZXNjcmlwdDogeyBpZ25vcmVCdWlsZEVycm9yczogZmFsc2UgfSxcbiAgICAgICAgICBlc2xpbnQ6IHsgaWdub3JlRHVyaW5nQnVpbGRzOiBmYWxzZSB9XG4gICAgICAgIH1cbiAgICAgIGApO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBidWlsZFZhbGlkYXRvci52YWxpZGF0ZU5leHRDb25maWcoKTtcblxuICAgICAgZXhwZWN0KHJlc3VsdC5pc1ZhbGlkKS50b0JlKHRydWUpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnbW9uaXRvckJ1aWxkSGVhbHRoJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmVwb3J0IGhlYWx0aHkgYnVpbGQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrRnMuZXhpc3RzU3luYy5tb2NrUmV0dXJuVmFsdWUodHJ1ZSk7XG4gICAgICBtb2NrRnMucmVhZEZpbGVTeW5jLm1vY2tSZXR1cm5WYWx1ZSgne30nKTtcbiAgICAgIG1vY2tGcy5yZWFkZGlyU3luYy5tb2NrUmV0dXJuVmFsdWUoW10pO1xuICAgICAgbW9ja0ZzLnN0YXRTeW5jLm1vY2tSZXR1cm5WYWx1ZSh7IFxuICAgICAgICBtdGltZTogbmV3IERhdGUoKSxcbiAgICAgICAgc2l6ZTogMTAyNCxcbiAgICAgICAgaXNEaXJlY3Rvcnk6ICgpID0+IGZhbHNlIFxuICAgICAgfSBhcyBhbnkpO1xuXG4gICAgICBjb25zdCByZXBvcnQgPSBhd2FpdCBidWlsZFZhbGlkYXRvci5tb25pdG9yQnVpbGRIZWFsdGgoKTtcblxuICAgICAgZXhwZWN0KHJlcG9ydC5idWlsZEV4aXN0cykudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChyZXBvcnQubWFuaWZlc3RzVmFsaWQpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QocmVwb3J0Lmlzc3VlcykudG9IYXZlTGVuZ3RoKDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXBvcnQgbWlzc2luZyBidWlsZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tGcy5leGlzdHNTeW5jLm1vY2tSZXR1cm5WYWx1ZShmYWxzZSk7XG5cbiAgICAgIGNvbnN0IHJlcG9ydCA9IGF3YWl0IGJ1aWxkVmFsaWRhdG9yLm1vbml0b3JCdWlsZEhlYWx0aCgpO1xuXG4gICAgICBleHBlY3QocmVwb3J0LmJ1aWxkRXhpc3RzKS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChyZXBvcnQuaXNzdWVzKS50b0NvbnRhaW4oJ0J1aWxkIGRpcmVjdG9yeSBkb2VzIG5vdCBleGlzdCcpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgncmVidWlsZFdpdGhSZWNvdmVyeScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHN1Y2NlZWQgb24gZmlyc3QgYXR0ZW1wdCcsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIE1vY2sgc3VjY2Vzc2Z1bCBidWlsZFxuICAgICAgY29uc3QgeyBleGVjU3luYyB9ID0gcmVxdWlyZSgnY2hpbGRfcHJvY2VzcycpO1xuICAgICAgZXhlY1N5bmMubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+ICdCdWlsZCBzdWNjZXNzZnVsJyk7XG4gICAgICBcbiAgICAgIG1vY2tGcy5leGlzdHNTeW5jLm1vY2tSZXR1cm5WYWx1ZSh0cnVlKTtcbiAgICAgIG1vY2tGcy5yZWFkRmlsZVN5bmMubW9ja1JldHVyblZhbHVlKCd7fScpO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBidWlsZFZhbGlkYXRvci5yZWJ1aWxkV2l0aFJlY292ZXJ5KDMpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KG1vY2tMb2dnZXIpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdCdWlsZCBzdWNjZXNzZnVsIG9uIGF0dGVtcHQgMScpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXRyeSBvbiBmYWlsdXJlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgeyBleGVjU3luYyB9ID0gcmVxdWlyZSgnY2hpbGRfcHJvY2VzcycpO1xuICAgICAgZXhlY1N5bmNcbiAgICAgICAgLm1vY2tJbXBsZW1lbnRhdGlvbk9uY2UoKCkgPT4geyB0aHJvdyBuZXcgRXJyb3IoJ0J1aWxkIGZhaWxlZCcpOyB9KVxuICAgICAgICAubW9ja0ltcGxlbWVudGF0aW9uT25jZSgoKSA9PiAnQnVpbGQgc3VjY2Vzc2Z1bCcpO1xuICAgICAgXG4gICAgICBtb2NrRnMuZXhpc3RzU3luYy5tb2NrUmV0dXJuVmFsdWUodHJ1ZSk7XG4gICAgICBtb2NrRnMucmVhZEZpbGVTeW5jLm1vY2tSZXR1cm5WYWx1ZSgne30nKTtcbiAgICAgIG1vY2tGcy5ybVN5bmMubW9ja0ltcGxlbWVudGF0aW9uKCk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGJ1aWxkVmFsaWRhdG9yLnJlYnVpbGRXaXRoUmVjb3ZlcnkoMyk7XG5cbiAgICAgIGV4cGVjdChyZXN1bHQpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QoZXhlY1N5bmMpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygyKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZmFpbCBhZnRlciBtYXggcmV0cmllcycsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHsgZXhlY1N5bmMgfSA9IHJlcXVpcmUoJ2NoaWxkX3Byb2Nlc3MnKTtcbiAgICAgIGV4ZWNTeW5jLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiB7IHRocm93IG5ldyBFcnJvcignQnVpbGQgZmFpbGVkJyk7IH0pO1xuXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBidWlsZFZhbGlkYXRvci5yZWJ1aWxkV2l0aFJlY292ZXJ5KDIpO1xuXG4gICAgICBleHBlY3QocmVzdWx0KS50b0JlKGZhbHNlKTtcbiAgICAgIGV4cGVjdChtb2NrTG9nZ2VyKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgnQnVpbGQgZmFpbGVkIGFmdGVyIDIgYXR0ZW1wdHMnKTtcbiAgICB9KTtcbiAgfSk7XG59KTsiXSwidmVyc2lvbiI6M30=