800ad8a6d86da0d1186be266a25b4eb0
"use strict";
/**
 * Enhanced Metrics Collection System
 * Perfect Codebase Campaign - Real-time Comprehensive Metrics
 * Requirements: 6.1, 6.2, 6.3
 */
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.MetricsCollectionSystem = void 0;
const child_process_1 = require("child_process");
const fs = __importStar(require("fs"));
class MetricsCollectionSystem {
    constructor() {
        this.snapshots = [];
        this.collectionInterval = null;
        this.isCollecting = false;
    }
    /**
     * Start real-time metrics collection
     */
    startRealTimeCollection(intervalMs = 30000) {
        if (this.isCollecting) {
            console.log('ðŸ“Š Metrics collection already running');
            return;
        }
        this.isCollecting = true;
        console.log(`ðŸ“Š Starting real-time metrics collection (interval: ${intervalMs}ms)`);
        this.collectionInterval = setInterval(async () => {
            try {
                await this.collectSnapshot();
            }
            catch (error) {
                console.error('âŒ Error during metrics collection:', error.message);
            }
        }, intervalMs);
        // Collect initial snapshot
        this.collectSnapshot();
    }
    /**
     * Stop real-time metrics collection
     */
    stopRealTimeCollection() {
        if (this.collectionInterval) {
            clearInterval(this.collectionInterval);
            this.collectionInterval = null;
        }
        this.isCollecting = false;
        console.log('ðŸ“Š Stopped real-time metrics collection');
    }
    /**
     * Collect comprehensive metrics snapshot
     */
    async collectSnapshot(phase, milestone, notes) {
        const timestamp = new Date();
        const id = `snapshot_${timestamp.getTime()}`;
        console.log('ðŸ“Š Collecting metrics snapshot...');
        const metrics = await this.collectDetailedMetrics();
        const snapshot = {
            id,
            timestamp,
            metrics,
            phase: phase || 'unknown',
            milestone,
            notes
        };
        this.snapshots.push(snapshot);
        // Keep only recent snapshots to prevent memory issues
        if (this.snapshots.length > 1000) {
            this.snapshots = this.snapshots.slice(-500);
        }
        console.log(`ðŸ“Š Snapshot collected: ${id}`);
        return snapshot;
    }
    /**
     * Collect detailed metrics with comprehensive analysis
     */
    async collectDetailedMetrics() {
        const [typeScriptMetrics, lintingMetrics, buildMetrics, resourceMetrics, enterpriseSystemCount] = await Promise.all([
            this.collectTypeScriptMetrics(),
            this.collectLintingMetrics(),
            this.collectBuildMetrics(),
            this.collectResourceMetrics(),
            this.getEnterpriseSystemCount()
        ]);
        const trendData = this.calculateTrendData();
        const detailedMetrics = {
            timestamp: new Date(),
            typeScriptErrors: {
                current: typeScriptMetrics.count,
                target: 0,
                reduction: Math.max(0, 86 - typeScriptMetrics.count),
                percentage: typeScriptMetrics.count >= 0 ? Math.round(((86 - typeScriptMetrics.count) / 86) * 100) : 0
            },
            lintingWarnings: {
                current: lintingMetrics.count,
                target: 0,
                reduction: Math.max(0, 4506 - lintingMetrics.count),
                percentage: lintingMetrics.count >= 0 ? Math.round(((4506 - lintingMetrics.count) / 4506) * 100) : 0
            },
            buildPerformance: {
                currentTime: buildMetrics.buildTime,
                targetTime: 10,
                cacheHitRate: buildMetrics.cacheHitRate,
                memoryUsage: buildMetrics.memoryUsage
            },
            enterpriseSystems: {
                current: enterpriseSystemCount,
                target: 200,
                transformedExports: Math.max(0, enterpriseSystemCount - 0)
            },
            errorBreakdown: typeScriptMetrics.breakdown,
            warningBreakdown: lintingMetrics.breakdown,
            buildMetrics,
            resourceMetrics,
            trendData
        };
        return detailedMetrics;
    }
    /**
     * Collect TypeScript error metrics with detailed breakdown
     */
    async collectTypeScriptMetrics() {
        try {
            // Get total error count
            const countOutput = (0, child_process_1.execSync)('yarn tsc --noEmit --skipLibCheck 2>&1 | grep -c "error TS" || echo "0"', {
                encoding: 'utf8',
                stdio: 'pipe'
            });
            const count = parseInt(countOutput.trim()) || 0;
            // Get detailed breakdown by error type
            const breakdown = {};
            if (count > 0) {
                try {
                    const breakdownOutput = (0, child_process_1.execSync)('yarn tsc --noEmit --skipLibCheck 2>&1 | grep -E "error TS" | sed \'s/.*error //\' | cut -d\':\' -f1 | sort | uniq -c | sort -nr', {
                        encoding: 'utf8',
                        stdio: 'pipe'
                    });
                    const lines = breakdownOutput.trim().split('\n').filter(line => line.trim());
                    for (const line of lines) {
                        const match = line.trim().match(/^\s*(\d+)\s+(.+)$/);
                        if (match) {
                            const errorCount = parseInt(match[1]);
                            const errorType = match[2].trim();
                            breakdown[errorType] = errorCount;
                        }
                    }
                }
                catch (error) {
                    console.warn('Could not get TypeScript error breakdown:', error.message);
                }
            }
            return { count, breakdown };
        }
        catch (error) {
            console.warn('Could not collect TypeScript metrics:', error.message);
            return { count: -1, breakdown: {} };
        }
    }
    /**
     * Collect linting warning metrics with categorized breakdown
     */
    async collectLintingMetrics() {
        try {
            // Get total warning count
            const countOutput = (0, child_process_1.execSync)('yarn lint 2>&1 | grep -c "warning" || echo "0"', {
                encoding: 'utf8',
                stdio: 'pipe'
            });
            const count = parseInt(countOutput.trim()) || 0;
            // Get detailed breakdown by warning type
            const breakdown = {};
            if (count > 0) {
                try {
                    const lintOutput = (0, child_process_1.execSync)('yarn lint 2>&1', {
                        encoding: 'utf8',
                        stdio: 'pipe'
                    });
                    const lines = lintOutput.split('\n');
                    for (const line of lines) {
                        // Look for ESLint warning patterns
                        const warningMatch = line.match(/warning\s+(.+?)\s+(@typescript-eslint\/[\w-]+|[\w-]+)/);
                        if (warningMatch) {
                            const ruleType = warningMatch[2];
                            breakdown[ruleType] = (breakdown[ruleType] || 0) + 1;
                        }
                    }
                }
                catch (error) {
                    console.warn('Could not get linting warning breakdown:', error.message);
                }
            }
            return { count, breakdown };
        }
        catch (error) {
            console.warn('Could not collect linting metrics:', error.message);
            return { count: -1, breakdown: {} };
        }
    }
    /**
     * Collect comprehensive build performance metrics
     */
    async collectBuildMetrics() {
        const startTime = Date.now();
        let buildTime = -1;
        let bundleSize = 0;
        let compilationSpeed = 0;
        try {
            // Measure build time
            const buildStart = Date.now();
            (0, child_process_1.execSync)('yarn build', {
                encoding: 'utf8',
                stdio: 'pipe'
            });
            buildTime = (Date.now() - buildStart) / 1000;
            // Calculate compilation speed (rough estimate)
            const sourceFiles = this.countSourceFiles();
            compilationSpeed = sourceFiles / buildTime;
        }
        catch (error) {
            console.warn('Build failed during metrics collection:', error.message);
        }
        try {
            // Get bundle size
            bundleSize = await this.getBundleSize();
        }
        catch (error) {
            console.warn('Could not measure bundle size:', error.message);
        }
        return {
            buildTime,
            bundleSize,
            cacheHitRate: await this.estimateCacheHitRate(),
            memoryUsage: this.getMemoryUsage(),
            cpuUsage: await this.getCpuUsage(),
            diskUsage: await this.getDiskUsage(),
            compilationSpeed
        };
    }
    /**
     * Collect system resource metrics
     */
    async collectResourceMetrics() {
        const nodeMemoryUsage = process.memoryUsage();
        return {
            nodeMemoryUsage,
            systemMemory: await this.getSystemMemory(),
            diskSpace: await this.getDiskSpace()
        };
    }
    /**
     * Calculate trend data based on historical snapshots
     */
    calculateTrendData() {
        if (this.snapshots.length < 2) {
            return {
                errorReductionRate: 0,
                warningReductionRate: 0,
                buildTimeImprovement: 0,
                systemGrowthRate: 0
            };
        }
        const recent = this.snapshots.slice(-10); // Last 10 snapshots
        const timeSpanHours = (recent[recent.length - 1].timestamp.getTime() - recent[0].timestamp.getTime()) / (1000 * 60 * 60);
        if (timeSpanHours === 0) {
            return {
                errorReductionRate: 0,
                warningReductionRate: 0,
                buildTimeImprovement: 0,
                systemGrowthRate: 0
            };
        }
        const errorReduction = recent[0].metrics.typeScriptErrors.current - recent[recent.length - 1].metrics.typeScriptErrors.current;
        const warningReduction = recent[0].metrics.lintingWarnings.current - recent[recent.length - 1].metrics.lintingWarnings.current;
        const buildTimeImprovement = recent[0].metrics.buildPerformance.currentTime - recent[recent.length - 1].metrics.buildPerformance.currentTime;
        const systemGrowth = recent[recent.length - 1].metrics.enterpriseSystems.current - recent[0].metrics.enterpriseSystems.current;
        return {
            errorReductionRate: errorReduction / timeSpanHours,
            warningReductionRate: warningReduction / timeSpanHours,
            buildTimeImprovement: buildTimeImprovement / timeSpanHours,
            systemGrowthRate: systemGrowth / timeSpanHours
        };
    }
    /**
     * Helper methods for metrics collection
     */
    async getEnterpriseSystemCount() {
        try {
            const output = (0, child_process_1.execSync)('grep -r "INTELLIGENCE_SYSTEM" src/ | wc -l', {
                encoding: 'utf8',
                stdio: 'pipe'
            });
            return parseInt(output.trim()) || 0;
        }
        catch (error) {
            return 0;
        }
    }
    async getBundleSize() {
        try {
            const buildDirs = ['.next', 'dist', 'build'];
            let totalSize = 0;
            for (const dir of buildDirs) {
                if (fs.existsSync(dir)) {
                    const output = (0, child_process_1.execSync)(`du -sk ${dir} | cut -f1`, {
                        encoding: 'utf8',
                        stdio: 'pipe'
                    });
                    totalSize += parseInt(output.trim()) || 0;
                }
            }
            return totalSize;
        }
        catch (error) {
            return 0;
        }
    }
    async estimateCacheHitRate() {
        // This is a simplified estimation - in a real implementation,
        // you'd integrate with the actual build system's cache metrics
        return 0.8; // 80% default estimate
    }
    getMemoryUsage() {
        const memUsage = process.memoryUsage();
        return Math.round(memUsage.heapUsed / 1024 / 1024);
    }
    async getCpuUsage() {
        try {
            const output = (0, child_process_1.execSync)('ps -o %cpu -p $$ | tail -1', {
                encoding: 'utf8',
                stdio: 'pipe'
            });
            return parseFloat(output.trim()) || 0;
        }
        catch (error) {
            return 0;
        }
    }
    async getDiskUsage() {
        try {
            const output = (0, child_process_1.execSync)('du -sh . | cut -f1', {
                encoding: 'utf8',
                stdio: 'pipe'
            });
            // Convert to MB (rough estimation)
            const sizeStr = output.trim();
            if (sizeStr.includes('G')) {
                return parseFloat(sizeStr) * 1024;
            }
            else if (sizeStr.includes('M')) {
                return parseFloat(sizeStr);
            }
            return 0;
        }
        catch (error) {
            return 0;
        }
    }
    countSourceFiles() {
        try {
            const output = (0, child_process_1.execSync)('find src -name "*.ts" -o -name "*.tsx" | wc -l', {
                encoding: 'utf8',
                stdio: 'pipe'
            });
            return parseInt(output.trim()) || 0;
        }
        catch (error) {
            return 0;
        }
    }
    async getSystemMemory() {
        try {
            const output = (0, child_process_1.execSync)('free -m | grep Mem', {
                encoding: 'utf8',
                stdio: 'pipe'
            });
            const match = output.match(/Mem:\s+(\d+)\s+(\d+)\s+(\d+)/);
            if (match) {
                const total = parseInt(match[1]);
                const used = parseInt(match[2]);
                const free = parseInt(match[3]);
                return {
                    total,
                    used,
                    free,
                    percentage: Math.round((used / total) * 100)
                };
            }
        }
        catch (error) {
            // Fallback for non-Linux systems
        }
        return {
            total: 0,
            used: 0,
            free: 0,
            percentage: 0
        };
    }
    async getDiskSpace() {
        try {
            const output = (0, child_process_1.execSync)('df -h . | tail -1', {
                encoding: 'utf8',
                stdio: 'pipe'
            });
            const parts = output.trim().split(/\s+/);
            if (parts.length >= 4) {
                const total = this.parseSize(parts[1]);
                const used = this.parseSize(parts[2]);
                const free = this.parseSize(parts[3]);
                return {
                    total,
                    used,
                    free,
                    percentage: Math.round((used / total) * 100)
                };
            }
        }
        catch (error) {
            // Handle error
        }
        return {
            total: 0,
            used: 0,
            free: 0,
            percentage: 0
        };
    }
    parseSize(sizeStr) {
        const num = parseFloat(sizeStr);
        if (sizeStr.includes('G'))
            return num * 1024;
        if (sizeStr.includes('M'))
            return num;
        if (sizeStr.includes('K'))
            return num / 1024;
        return num;
    }
    /**
     * Export methods for external access
     */
    getSnapshots() {
        return [...this.snapshots];
    }
    getLatestSnapshot() {
        return this.snapshots.length > 0 ? this.snapshots[this.snapshots.length - 1] : null;
    }
    async exportSnapshots(filePath) {
        const exportData = {
            timestamp: new Date().toISOString(),
            totalSnapshots: this.snapshots.length,
            snapshots: this.snapshots,
            summary: {
                collectionPeriod: this.snapshots.length > 0 ? {
                    start: this.snapshots[0].timestamp,
                    end: this.snapshots[this.snapshots.length - 1].timestamp
                } : null,
                trends: this.calculateTrendData()
            }
        };
        fs.writeFileSync(filePath, JSON.stringify(exportData, null, 2));
        console.log(`ðŸ“Š Metrics snapshots exported to: ${filePath}`);
    }
    clearSnapshots() {
        this.snapshots = [];
        console.log('ðŸ“Š Metrics snapshots cleared');
    }
}
exports.MetricsCollectionSystem = MetricsCollectionSystem;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9zZXJ2aWNlcy9jYW1wYWlnbi9NZXRyaWNzQ29sbGVjdGlvblN5c3RlbS50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7R0FJRzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFSCxpREFBeUM7QUFDekMsdUNBQXlCO0FBMkR6QixNQUFhLHVCQUF1QjtJQUFwQztRQUNVLGNBQVMsR0FBc0IsRUFBRSxDQUFDO1FBQ2xDLHVCQUFrQixHQUEwQixJQUFJLENBQUM7UUFDakQsaUJBQVksR0FBRyxLQUFLLENBQUM7SUF1Zi9CLENBQUM7SUFyZkM7O09BRUc7SUFDSCx1QkFBdUIsQ0FBQyxhQUFxQixLQUFLO1FBQ2hELElBQUksSUFBSSxDQUFDLFlBQVksRUFBRTtZQUNyQixPQUFPLENBQUMsR0FBRyxDQUFDLHVDQUF1QyxDQUFDLENBQUM7WUFDckQsT0FBTztTQUNSO1FBRUQsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUM7UUFDekIsT0FBTyxDQUFDLEdBQUcsQ0FBQyx1REFBdUQsVUFBVSxLQUFLLENBQUMsQ0FBQztRQUVwRixJQUFJLENBQUMsa0JBQWtCLEdBQUcsV0FBVyxDQUFDLEtBQUssSUFBSSxFQUFFO1lBQy9DLElBQUk7Z0JBQ0YsTUFBTSxJQUFJLENBQUMsZUFBZSxFQUFFLENBQUM7YUFDOUI7WUFBQyxPQUFPLEtBQUssRUFBRTtnQkFDZCxPQUFPLENBQUMsS0FBSyxDQUFDLG9DQUFvQyxFQUFFLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQzthQUNwRTtRQUNILENBQUMsRUFBRSxVQUFVLENBQUMsQ0FBQztRQUVmLDJCQUEyQjtRQUMzQixJQUFJLENBQUMsZUFBZSxFQUFFLENBQUM7SUFDekIsQ0FBQztJQUVEOztPQUVHO0lBQ0gsc0JBQXNCO1FBQ3BCLElBQUksSUFBSSxDQUFDLGtCQUFrQixFQUFFO1lBQzNCLGFBQWEsQ0FBQyxJQUFJLENBQUMsa0JBQWtCLENBQUMsQ0FBQztZQUN2QyxJQUFJ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LFNBQVMsR0FBRyxFQUFFLENBQUM7UUFDcEIsT0FBTyxDQUFDLEdBQUcsQ0FBQyw4QkFBOEIsQ0FBQyxDQUFDO0lBQzlDLENBQUM7Q0FDRjtBQTFmRCwwREEwZkMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9zZXJ2aWNlcy9jYW1wYWlnbi9NZXRyaWNzQ29sbGVjdGlvblN5c3RlbS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEVuaGFuY2VkIE1ldHJpY3MgQ29sbGVjdGlvbiBTeXN0ZW1cbiAqIFBlcmZlY3QgQ29kZWJhc2UgQ2FtcGFpZ24gLSBSZWFsLXRpbWUgQ29tcHJlaGVuc2l2ZSBNZXRyaWNzXG4gKiBSZXF1aXJlbWVudHM6IDYuMSwgNi4yLCA2LjNcbiAqL1xuXG5pbXBvcnQgeyBleGVjU3luYyB9IGZyb20gJ2NoaWxkX3Byb2Nlc3MnO1xuaW1wb3J0ICogYXMgZnMgZnJvbSAnZnMnO1xuaW1wb3J0ICogYXMgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCB7XG4gIFByb2dyZXNzTWV0cmljcyxcbiAgRXJyb3JDYXRlZ29yeSxcbiAgVmFsaWRhdGlvblJlc3VsdFxufSBmcm9tICcuLi8uLi90eXBlcy9jYW1wYWlnbic7XG5cbmV4cG9ydCBpbnRlcmZhY2UgRGV0YWlsZWRNZXRyaWNzIGV4dGVuZHMgUHJvZ3Jlc3NNZXRyaWNzIHtcbiAgdGltZXN0YW1wOiBEYXRlO1xuICBlcnJvckJyZWFrZG93bjogUmVjb3JkPHN0cmluZywgbnVtYmVyPjtcbiAgd2FybmluZ0JyZWFrZG93bjogUmVjb3JkPHN0cmluZywgbnVtYmVyPjtcbiAgYnVpbGRNZXRyaWNzOiBCdWlsZE1ldHJpY3M7XG4gIHJlc291cmNlTWV0cmljczogUmVzb3VyY2VNZXRyaWNzO1xuICB0cmVuZERhdGE6IFRyZW5kRGF0YTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBCdWlsZE1ldHJpY3Mge1xuICBidWlsZFRpbWU6IG51bWJlcjtcbiAgYnVuZGxlU2l6ZTogbnVtYmVyO1xuICBjYWNoZUhpdFJhdGU6IG51bWJlcjtcbiAgbWVtb3J5VXNhZ2U6IG51bWJlcjtcbiAgY3B1VXNhZ2U6IG51bWJlcjtcbiAgZGlza1VzYWdlOiBudW1iZXI7XG4gIGNvbXBpbGF0aW9uU3BlZWQ6IG51bWJlcjsgLy8gZmlsZXMgcGVyIHNlY29uZFxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFJlc291cmNlTWV0cmljcyB7XG4gIG5vZGVNZW1vcnlVc2FnZTogTm9kZUpTLk1lbW9yeVVzYWdlO1xuICBzeXN0ZW1NZW1vcnk6IHtcbiAgICB0b3RhbDogbnVtYmVyO1xuICAgIGZyZWU6IG51bWJlcjtcbiAgICB1c2VkOiBudW1iZXI7XG4gICAgcGVyY2VudGFnZTogbnVtYmVyO1xuICB9O1xuICBkaXNrU3BhY2U6IHtcbiAgICB0b3RhbDogbnVtYmVyO1xuICAgIGZyZWU6IG51bWJlcjtcbiAgICB1c2VkOiBudW1iZXI7XG4gICAgcGVyY2VudGFnZTogbnVtYmVyO1xuICB9O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFRyZW5kRGF0YSB7XG4gIGVycm9yUmVkdWN0aW9uUmF0ZTogbnVtYmVyOyAvLyBlcnJvcnMgcmVkdWNlZCBwZXIgaG91clxuICB3YXJuaW5nUmVkdWN0aW9uUmF0ZTogbnVtYmVyOyAvLyB3YXJuaW5ncyByZWR1Y2VkIHBlciBob3VyXG4gIGJ1aWxkVGltZUltcHJvdmVtZW50OiBudW1iZXI7IC8vIHNlY29uZHMgaW1wcm92ZWQgcGVyIGhvdXJcbiAgc3lzdGVtR3Jvd3RoUmF0ZTogbnVtYmVyOyAvLyBlbnRlcnByaXNlIHN5c3RlbXMgYWRkZWQgcGVyIGhvdXJcbn1cblxuZXhwb3J0IGludGVyZmFjZSBNZXRyaWNzU25hcHNob3Qge1xuICBpZDogc3RyaW5nO1xuICB0aW1lc3RhbXA6IERhdGU7XG4gIG1ldHJpY3M6IERldGFpbGVkTWV0cmljcztcbiAgcGhhc2U6IHN0cmluZztcbiAgbWlsZXN0b25lPzogc3RyaW5nO1xuICBub3Rlcz86IHN0cmluZztcbn1cblxuZXhwb3J0IGNsYXNzIE1ldHJpY3NDb2xsZWN0aW9uU3lzdGVtIHtcbiAgcHJpdmF0ZSBzbmFwc2hvdHM6IE1ldHJpY3NTbmFwc2hvdFtdID0gW107XG4gIHByaXZhdGUgY29sbGVjdGlvbkludGVydmFsOiBOb2RlSlMuVGltZW91dCB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIGlzQ29sbGVjdGluZyA9IGZhbHNlO1xuXG4gIC8qKlxuICAgKiBTdGFydCByZWFsLXRpbWUgbWV0cmljcyBjb2xsZWN0aW9uXG4gICAqL1xuICBzdGFydFJlYWxUaW1lQ29sbGVjdGlvbihpbnRlcnZhbE1zOiBudW1iZXIgPSAzMDAwMCk6IHZvaWQge1xuICAgIGlmICh0aGlzLmlzQ29sbGVjdGluZykge1xuICAgICAgY29uc29sZS5sb2coJ/Cfk4ogTWV0cmljcyBjb2xsZWN0aW9uIGFscmVhZHkgcnVubmluZycpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuaXNDb2xsZWN0aW5nID0gdHJ1ZTtcbiAgICBjb25zb2xlLmxvZyhg8J+TiiBTdGFydGluZyByZWFsLXRpbWUgbWV0cmljcyBjb2xsZWN0aW9uIChpbnRlcnZhbDogJHtpbnRlcnZhbE1zfW1zKWApO1xuXG4gICAgdGhpcy5jb2xsZWN0aW9uSW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChhc3luYyAoKSA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCB0aGlzLmNvbGxlY3RTbmFwc2hvdCgpO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIGR1cmluZyBtZXRyaWNzIGNvbGxlY3Rpb246JywgZXJyb3IubWVzc2FnZSk7XG4gICAgICB9XG4gICAgfSwgaW50ZXJ2YWxNcyk7XG5cbiAgICAvLyBDb2xsZWN0IGluaXRpYWwgc25hcHNob3RcbiAgICB0aGlzLmNvbGxlY3RTbmFwc2hvdCgpO1xuICB9XG5cbiAgLyoqXG4gICAqIFN0b3AgcmVhbC10aW1lIG1ldHJpY3MgY29sbGVjdGlvblxuICAgKi9cbiAgc3RvcFJlYWxUaW1lQ29sbGVjdGlvbigpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5jb2xsZWN0aW9uSW50ZXJ2YWwpIHtcbiAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5jb2xsZWN0aW9uSW50ZXJ2YWwpO1xuICAgICAgdGhpcy5jb2xsZWN0aW9uSW50ZXJ2YWwgPSBudWxsO1xuICAgIH1cbiAgICB0aGlzLmlzQ29sbGVjdGluZyA9IGZhbHNlO1xuICAgIGNvbnNvbGUubG9nKCfwn5OKIFN0b3BwZWQgcmVhbC10aW1lIG1ldHJpY3MgY29sbGVjdGlvbicpO1xuICB9XG5cbiAgLyoqXG4gICAqIENvbGxlY3QgY29tcHJlaGVuc2l2ZSBtZXRyaWNzIHNuYXBzaG90XG4gICAqL1xuICBhc3luYyBjb2xsZWN0U25hcHNob3QocGhhc2U/OiBzdHJpbmcsIG1pbGVzdG9uZT86IHN0cmluZywgbm90ZXM/OiBzdHJpbmcpOiBQcm9taXNlPE1ldHJpY3NTbmFwc2hvdD4ge1xuICAgIGNvbnN0IHRpbWVzdGFtcCA9IG5ldyBEYXRlKCk7XG4gICAgY29uc3QgaWQgPSBgc25hcHNob3RfJHt0aW1lc3RhbXAuZ2V0VGltZSgpfWA7XG5cbiAgICBjb25zb2xlLmxvZygn8J+TiiBDb2xsZWN0aW5nIG1ldHJpY3Mgc25hcHNob3QuLi4nKTtcblxuICAgIGNvbnN0IG1ldHJpY3MgPSBhd2FpdCB0aGlzLmNvbGxlY3REZXRhaWxlZE1ldHJpY3MoKTtcbiAgICBcbiAgICBjb25zdCBzbmFwc2hvdDogTWV0cmljc1NuYXBzaG90ID0ge1xuICAgICAgaWQsXG4gICAgICB0aW1lc3RhbXAsXG4gICAgICBtZXRyaWNzLFxuICAgICAgcGhhc2U6IHBoYXNlIHx8ICd1bmtub3duJyxcbiAgICAgIG1pbGVzdG9uZSxcbiAgICAgIG5vdGVzXG4gICAgfTtcblxuICAgIHRoaXMuc25hcHNob3RzLnB1c2goc25hcHNob3QpO1xuXG4gICAgLy8gS2VlcCBvbmx5IHJlY2VudCBzbmFwc2hvdHMgdG8gcHJldmVudCBtZW1vcnkgaXNzdWVzXG4gICAgaWYgKHRoaXMuc25hcHNob3RzLmxlbmd0aCA+IDEwMDApIHtcbiAgICAgIHRoaXMuc25hcHNob3RzID0gdGhpcy5zbmFwc2hvdHMuc2xpY2UoLTUwMCk7XG4gICAgfVxuXG4gICAgY29uc29sZS5sb2coYPCfk4ogU25hcHNob3QgY29sbGVjdGVkOiAke2lkfWApO1xuICAgIHJldHVybiBzbmFwc2hvdDtcbiAgfVxuXG4gIC8qKlxuICAgKiBDb2xsZWN0IGRldGFpbGVkIG1ldHJpY3Mgd2l0aCBjb21wcmVoZW5zaXZlIGFuYWx5c2lzXG4gICAqL1xuICBhc3luYyBjb2xsZWN0RGV0YWlsZWRNZXRyaWNzKCk6IFByb21pc2U8RGV0YWlsZWRNZXRyaWNzPiB7XG4gICAgY29uc3QgW1xuICAgICAgdHlwZVNjcmlwdE1ldHJpY3MsXG4gICAgICBsaW50aW5nTWV0cmljcyxcbiAgICAgIGJ1aWxkTWV0cmljcyxcbiAgICAgIHJlc291cmNlTWV0cmljcyxcbiAgICAgIGVudGVycHJpc2VTeXN0ZW1Db3VudFxuICAgIF0gPSBhd2FpdCBQcm9taXNlLmFsbChbXG4gICAgICB0aGlzLmNvbGxlY3RUeXBlU2NyaXB0TWV0cmljcygpLFxuICAgICAgdGhpcy5jb2xsZWN0TGludGluZ01ldHJpY3MoKSxcbiAgICAgIHRoaXMuY29sbGVjdEJ1aWxkTWV0cmljcygpLFxuICAgICAgdGhpcy5jb2xsZWN0UmVzb3VyY2VNZXRyaWNzKCksXG4gICAgICB0aGlzLmdldEVudGVycHJpc2VTeXN0ZW1Db3VudCgpXG4gICAgXSk7XG5cbiAgICBjb25zdCB0cmVuZERhdGEgPSB0aGlzLmNhbGN1bGF0ZVRyZW5kRGF0YSgpO1xuXG4gICAgY29uc3QgZGV0YWlsZWRNZXRyaWNzOiBEZXRhaWxlZE1ldHJpY3MgPSB7XG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAgICB0eXBlU2NyaXB0RXJyb3JzOiB7XG4gICAgICAgIGN1cnJlbnQ6IHR5cGVTY3JpcHRNZXRyaWNzLmNvdW50LFxuICAgICAgICB0YXJnZXQ6IDAsXG4gICAgICAgIHJlZHVjdGlvbjogTWF0aC5tYXgoMCwgODYgLSB0eXBlU2NyaXB0TWV0cmljcy5jb3VudCksXG4gICAgICAgIHBlcmNlbnRhZ2U6IHR5cGVTY3JpcHRNZXRyaWNzLmNvdW50ID49IDAgPyBNYXRoLnJvdW5kKCgoODYgLSB0eXBlU2NyaXB0TWV0cmljcy5jb3VudCkgLyA4NikgKiAxMDApIDogMFxuICAgICAgfSxcbiAgICAgIGxpbnRpbmdXYXJuaW5nczoge1xuICAgICAgICBjdXJyZW50OiBsaW50aW5nTWV0cmljcy5jb3VudCxcbiAgICAgICAgdGFyZ2V0OiAwLFxuICAgICAgICByZWR1Y3Rpb246IE1hdGgubWF4KDAsIDQ1MDYgLSBsaW50aW5nTWV0cmljcy5jb3VudCksXG4gICAgICAgIHBlcmNlbnRhZ2U6IGxpbnRpbmdNZXRyaWNzLmNvdW50ID49IDAgPyBNYXRoLnJvdW5kKCgoNDUwNiAtIGxpbnRpbmdNZXRyaWNzLmNvdW50KSAvIDQ1MDYpICogMTAwKSA6IDBcbiAgICAgIH0sXG4gICAgICBidWlsZFBlcmZvcm1hbmNlOiB7XG4gICAgICAgIGN1cnJlbnRUaW1lOiBidWlsZE1ldHJpY3MuYnVpbGRUaW1lLFxuICAgICAgICB0YXJnZXRUaW1lOiAxMCxcbiAgICAgICAgY2FjaGVIaXRSYXRlOiBidWlsZE1ldHJpY3MuY2FjaGVIaXRSYXRlLFxuICAgICAgICBtZW1vcnlVc2FnZTogYnVpbGRNZXRyaWNzLm1lbW9yeVVzYWdlXG4gICAgICB9LFxuICAgICAgZW50ZXJwcmlzZVN5c3RlbXM6IHtcbiAgICAgICAgY3VycmVudDogZW50ZXJwcmlzZVN5c3RlbUNvdW50LFxuICAgICAgICB0YXJnZXQ6IDIwMCxcbiAgICAgICAgdHJhbnNmb3JtZWRFeHBvcnRzOiBNYXRoLm1heCgwLCBlbnRlcnByaXNlU3lzdGVtQ291bnQgLSAwKVxuICAgICAgfSxcbiAgICAgIGVycm9yQnJlYWtkb3duOiB0eXBlU2NyaXB0TWV0cmljcy5icmVha2Rvd24sXG4gICAgICB3YXJuaW5nQnJlYWtkb3duOiBsaW50aW5nTWV0cmljcy5icmVha2Rvd24sXG4gICAgICBidWlsZE1ldHJpY3MsXG4gICAgICByZXNvdXJjZU1ldHJpY3MsXG4gICAgICB0cmVuZERhdGFcbiAgICB9O1xuXG4gICAgcmV0dXJuIGRldGFpbGVkTWV0cmljcztcbiAgfVxuXG4gIC8qKlxuICAgKiBDb2xsZWN0IFR5cGVTY3JpcHQgZXJyb3IgbWV0cmljcyB3aXRoIGRldGFpbGVkIGJyZWFrZG93blxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBjb2xsZWN0VHlwZVNjcmlwdE1ldHJpY3MoKTogUHJvbWlzZTx7Y291bnQ6IG51bWJlciwgYnJlYWtkb3duOiBSZWNvcmQ8c3RyaW5nLCBudW1iZXI+fT4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBHZXQgdG90YWwgZXJyb3IgY291bnRcbiAgICAgIGNvbnN0IGNvdW50T3V0cHV0ID0gZXhlY1N5bmMoJ3lhcm4gdHNjIC0tbm9FbWl0IC0tc2tpcExpYkNoZWNrIDI+JjEgfCBncmVwIC1jIFwiZXJyb3IgVFNcIiB8fCBlY2hvIFwiMFwiJywge1xuICAgICAgICBlbmNvZGluZzogJ3V0ZjgnLFxuICAgICAgICBzdGRpbzogJ3BpcGUnXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgY29uc3QgY291bnQgPSBwYXJzZUludChjb3VudE91dHB1dC50cmltKCkpIHx8IDA7XG5cbiAgICAgIC8vIEdldCBkZXRhaWxlZCBicmVha2Rvd24gYnkgZXJyb3IgdHlwZVxuICAgICAgY29uc3QgYnJlYWtkb3duOiBSZWNvcmQ8c3RyaW5nLCBudW1iZXI+ID0ge307XG4gICAgICBcbiAgICAgIGlmIChjb3VudCA+IDApIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zdCBicmVha2Rvd25PdXRwdXQgPSBleGVjU3luYygneWFybiB0c2MgLS1ub0VtaXQgLS1za2lwTGliQ2hlY2sgMj4mMSB8IGdyZXAgLUUgXCJlcnJvciBUU1wiIHwgc2VkIFxcJ3MvLiplcnJvciAvL1xcJyB8IGN1dCAtZFxcJzpcXCcgLWYxIHwgc29ydCB8IHVuaXEgLWMgfCBzb3J0IC1ucicsIHtcbiAgICAgICAgICAgIGVuY29kaW5nOiAndXRmOCcsXG4gICAgICAgICAgICBzdGRpbzogJ3BpcGUnXG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICBjb25zdCBsaW5lcyA9IGJyZWFrZG93bk91dHB1dC50cmltKCkuc3BsaXQoJ1xcbicpLmZpbHRlcihsaW5lID0+IGxpbmUudHJpbSgpKTtcbiAgICAgICAgICBmb3IgKGNvbnN0IGxpbmUgb2YgbGluZXMpIHtcbiAgICAgICAgICAgIGNvbnN0IG1hdGNoID0gbGluZS50cmltKCkubWF0Y2goL15cXHMqKFxcZCspXFxzKyguKykkLyk7XG4gICAgICAgICAgICBpZiAobWF0Y2gpIHtcbiAgICAgICAgICAgICAgY29uc3QgZXJyb3JDb3VudCA9IHBhcnNlSW50KG1hdGNoWzFdKTtcbiAgICAgICAgICAgICAgY29uc3QgZXJyb3JUeXBlID0gbWF0Y2hbMl0udHJpbSgpO1xuICAgICAgICAgICAgICBicmVha2Rvd25bZXJyb3JUeXBlXSA9IGVycm9yQ291bnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUud2FybignQ291bGQgbm90IGdldCBUeXBlU2NyaXB0IGVycm9yIGJyZWFrZG93bjonLCBlcnJvci5tZXNzYWdlKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4geyBjb3VudCwgYnJlYWtkb3duIH07XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS53YXJuKCdDb3VsZCBub3QgY29sbGVjdCBUeXBlU2NyaXB0IG1ldHJpY3M6JywgZXJyb3IubWVzc2FnZSk7XG4gICAgICByZXR1cm4geyBjb3VudDogLTEsIGJyZWFrZG93bjoge30gfTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ29sbGVjdCBsaW50aW5nIHdhcm5pbmcgbWV0cmljcyB3aXRoIGNhdGVnb3JpemVkIGJyZWFrZG93blxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBjb2xsZWN0TGludGluZ01ldHJpY3MoKTogUHJvbWlzZTx7Y291bnQ6IG51bWJlciwgYnJlYWtkb3duOiBSZWNvcmQ8c3RyaW5nLCBudW1iZXI+fT4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBHZXQgdG90YWwgd2FybmluZyBjb3VudFxuICAgICAgY29uc3QgY291bnRPdXRwdXQgPSBleGVjU3luYygneWFybiBsaW50IDI+JjEgfCBncmVwIC1jIFwid2FybmluZ1wiIHx8IGVjaG8gXCIwXCInLCB7XG4gICAgICAgIGVuY29kaW5nOiAndXRmOCcsXG4gICAgICAgIHN0ZGlvOiAncGlwZSdcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBjb25zdCBjb3VudCA9IHBhcnNlSW50KGNvdW50T3V0cHV0LnRyaW0oKSkgfHwgMDtcblxuICAgICAgLy8gR2V0IGRldGFpbGVkIGJyZWFrZG93biBieSB3YXJuaW5nIHR5cGVcbiAgICAgIGNvbnN0IGJyZWFrZG93bjogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9O1xuICAgICAgXG4gICAgICBpZiAoY291bnQgPiAwKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3QgbGludE91dHB1dCA9IGV4ZWNTeW5jKCd5YXJuIGxpbnQgMj4mMScsIHtcbiAgICAgICAgICAgIGVuY29kaW5nOiAndXRmOCcsXG4gICAgICAgICAgICBzdGRpbzogJ3BpcGUnXG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgICBjb25zdCBsaW5lcyA9IGxpbnRPdXRwdXQuc3BsaXQoJ1xcbicpO1xuICAgICAgICAgIGZvciAoY29uc3QgbGluZSBvZiBsaW5lcykge1xuICAgICAgICAgICAgLy8gTG9vayBmb3IgRVNMaW50IHdhcm5pbmcgcGF0dGVybnNcbiAgICAgICAgICAgIGNvbnN0IHdhcm5pbmdNYXRjaCA9IGxpbmUubWF0Y2goL3dhcm5pbmdcXHMrKC4rPylcXHMrKEB0eXBlc2NyaXB0LWVzbGludFxcL1tcXHctXSt8W1xcdy1dKykvKTtcbiAgICAgICAgICAgIGlmICh3YXJuaW5nTWF0Y2gpIHtcbiAgICAgICAgICAgICAgY29uc3QgcnVsZVR5cGUgPSB3YXJuaW5nTWF0Y2hbMl07XG4gICAgICAgICAgICAgIGJyZWFrZG93bltydWxlVHlwZV0gPSAoYnJlYWtkb3duW3J1bGVUeXBlXSB8fCAwKSArIDE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUud2FybignQ291bGQgbm90IGdldCBsaW50aW5nIHdhcm5pbmcgYnJlYWtkb3duOicsIGVycm9yLm1lc3NhZ2UpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB7IGNvdW50LCBicmVha2Rvd24gfTtcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLndhcm4oJ0NvdWxkIG5vdCBjb2xsZWN0IGxpbnRpbmcgbWV0cmljczonLCBlcnJvci5tZXNzYWdlKTtcbiAgICAgIHJldHVybiB7IGNvdW50OiAtMSwgYnJlYWtkb3duOiB7fSB9O1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDb2xsZWN0IGNvbXByZWhlbnNpdmUgYnVpbGQgcGVyZm9ybWFuY2UgbWV0cmljc1xuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBjb2xsZWN0QnVpbGRNZXRyaWNzKCk6IFByb21pc2U8QnVpbGRNZXRyaWNzPiB7XG4gICAgY29uc3Qgc3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICBsZXQgYnVpbGRUaW1lID0gLTE7XG4gICAgbGV0IGJ1bmRsZVNpemUgPSAwO1xuICAgIGxldCBjb21waWxhdGlvblNwZWVkID0gMDtcblxuICAgIHRyeSB7XG4gICAgICAvLyBNZWFzdXJlIGJ1aWxkIHRpbWVcbiAgICAgIGNvbnN0IGJ1aWxkU3RhcnQgPSBEYXRlLm5vdygpO1xuICAgICAgZXhlY1N5bmMoJ3lhcm4gYnVpbGQnLCB7XG4gICAgICAgIGVuY29kaW5nOiAndXRmOCcsXG4gICAgICAgIHN0ZGlvOiAncGlwZSdcbiAgICAgIH0pO1xuICAgICAgYnVpbGRUaW1lID0gKERhdGUubm93KCkgLSBidWlsZFN0YXJ0KSAvIDEwMDA7XG5cbiAgICAgIC8vIENhbGN1bGF0ZSBjb21waWxhdGlvbiBzcGVlZCAocm91Z2ggZXN0aW1hdGUpXG4gICAgICBjb25zdCBzb3VyY2VGaWxlcyA9IHRoaXMuY291bnRTb3VyY2VGaWxlcygpO1xuICAgICAgY29tcGlsYXRpb25TcGVlZCA9IHNvdXJjZUZpbGVzIC8gYnVpbGRUaW1lO1xuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUud2FybignQnVpbGQgZmFpbGVkIGR1cmluZyBtZXRyaWNzIGNvbGxlY3Rpb246JywgZXJyb3IubWVzc2FnZSk7XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIC8vIEdldCBidW5kbGUgc2l6ZVxuICAgICAgYnVuZGxlU2l6ZSA9IGF3YWl0IHRoaXMuZ2V0QnVuZGxlU2l6ZSgpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLndhcm4oJ0NvdWxkIG5vdCBtZWFzdXJlIGJ1bmRsZSBzaXplOicsIGVycm9yLm1lc3NhZ2UpO1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICBidWlsZFRpbWUsXG4gICAgICBidW5kbGVTaXplLFxuICAgICAgY2FjaGVIaXRSYXRlOiBhd2FpdCB0aGlzLmVzdGltYXRlQ2FjaGVIaXRSYXRlKCksXG4gICAgICBtZW1vcnlVc2FnZTogdGhpcy5nZXRNZW1vcnlVc2FnZSgpLFxuICAgICAgY3B1VXNhZ2U6IGF3YWl0IHRoaXMuZ2V0Q3B1VXNhZ2UoKSxcbiAgICAgIGRpc2tVc2FnZTogYXdhaXQgdGhpcy5nZXREaXNrVXNhZ2UoKSxcbiAgICAgIGNvbXBpbGF0aW9uU3BlZWRcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIENvbGxlY3Qgc3lzdGVtIHJlc291cmNlIG1ldHJpY3NcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgY29sbGVjdFJlc291cmNlTWV0cmljcygpOiBQcm9taXNlPFJlc291cmNlTWV0cmljcz4ge1xuICAgIGNvbnN0IG5vZGVNZW1vcnlVc2FnZSA9IHByb2Nlc3MubWVtb3J5VXNhZ2UoKTtcbiAgICBcbiAgICByZXR1cm4ge1xuICAgICAgbm9kZU1lbW9yeVVzYWdlLFxuICAgICAgc3lzdGVtTWVtb3J5OiBhd2FpdCB0aGlzLmdldFN5c3RlbU1lbW9yeSgpLFxuICAgICAgZGlza1NwYWNlOiBhd2FpdCB0aGlzLmdldERpc2tTcGFjZSgpXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDYWxjdWxhdGUgdHJlbmQgZGF0YSBiYXNlZCBvbiBoaXN0b3JpY2FsIHNuYXBzaG90c1xuICAgKi9cbiAgcHJpdmF0ZSBjYWxjdWxhdGVUcmVuZERhdGEoKTogVHJlbmREYXRhIHtcbiAgICBpZiAodGhpcy5zbmFwc2hvdHMubGVuZ3RoIDwgMikge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZXJyb3JSZWR1Y3Rpb25SYXRlOiAwLFxuICAgICAgICB3YXJuaW5nUmVkdWN0aW9uUmF0ZTogMCxcbiAgICAgICAgYnVpbGRUaW1lSW1wcm92ZW1lbnQ6IDAsXG4gICAgICAgIHN5c3RlbUdyb3d0aFJhdGU6IDBcbiAgICAgIH07XG4gICAgfVxuXG4gICAgY29uc3QgcmVjZW50ID0gdGhpcy5zbmFwc2hvdHMuc2xpY2UoLTEwKTsgLy8gTGFzdCAxMCBzbmFwc2hvdHNcbiAgICBjb25zdCB0aW1lU3BhbkhvdXJzID0gKHJlY2VudFtyZWNlbnQubGVuZ3RoIC0gMV0udGltZXN0YW1wLmdldFRpbWUoKSAtIHJlY2VudFswXS50aW1lc3RhbXAuZ2V0VGltZSgpKSAvICgxMDAwICogNjAgKiA2MCk7XG5cbiAgICBpZiAodGltZVNwYW5Ib3VycyA9PT0gMCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZXJyb3JSZWR1Y3Rpb25SYXRlOiAwLFxuICAgICAgICB3YXJuaW5nUmVkdWN0aW9uUmF0ZTogMCxcbiAgICAgICAgYnVpbGRUaW1lSW1wcm92ZW1lbnQ6IDAsXG4gICAgICAgIHN5c3RlbUdyb3d0aFJhdGU6IDBcbiAgICAgIH07XG4gICAgfVxuXG4gICAgY29uc3QgZXJyb3JSZWR1Y3Rpb24gPSByZWNlbnRbMF0ubWV0cmljcy50eXBlU2NyaXB0RXJyb3JzLmN1cnJlbnQgLSByZWNlbnRbcmVjZW50Lmxlbmd0aCAtIDFdLm1ldHJpY3MudHlwZVNjcmlwdEVycm9ycy5jdXJyZW50O1xuICAgIGNvbnN0IHdhcm5pbmdSZWR1Y3Rpb24gPSByZWNlbnRbMF0ubWV0cmljcy5saW50aW5nV2FybmluZ3MuY3VycmVudCAtIHJlY2VudFtyZWNlbnQubGVuZ3RoIC0gMV0ubWV0cmljcy5saW50aW5nV2FybmluZ3MuY3VycmVudDtcbiAgICBjb25zdCBidWlsZFRpbWVJbXByb3ZlbWVudCA9IHJlY2VudFswXS5tZXRyaWNzLmJ1aWxkUGVyZm9ybWFuY2UuY3VycmVudFRpbWUgLSByZWNlbnRbcmVjZW50Lmxlbmd0aCAtIDFdLm1ldHJpY3MuYnVpbGRQZXJmb3JtYW5jZS5jdXJyZW50VGltZTtcbiAgICBjb25zdCBzeXN0ZW1Hcm93dGggPSByZWNlbnRbcmVjZW50Lmxlbmd0aCAtIDFdLm1ldHJpY3MuZW50ZXJwcmlzZVN5c3RlbXMuY3VycmVudCAtIHJlY2VudFswXS5tZXRyaWNzLmVudGVycHJpc2VTeXN0ZW1zLmN1cnJlbnQ7XG5cbiAgICByZXR1cm4ge1xuICAgICAgZXJyb3JSZWR1Y3Rpb25SYXRlOiBlcnJvclJlZHVjdGlvbiAvIHRpbWVTcGFuSG91cnMsXG4gICAgICB3YXJuaW5nUmVkdWN0aW9uUmF0ZTogd2FybmluZ1JlZHVjdGlvbiAvIHRpbWVTcGFuSG91cnMsXG4gICAgICBidWlsZFRpbWVJbXByb3ZlbWVudDogYnVpbGRUaW1lSW1wcm92ZW1lbnQgLyB0aW1lU3BhbkhvdXJzLFxuICAgICAgc3lzdGVtR3Jvd3RoUmF0ZTogc3lzdGVtR3Jvd3RoIC8gdGltZVNwYW5Ib3Vyc1xuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogSGVscGVyIG1ldGhvZHMgZm9yIG1ldHJpY3MgY29sbGVjdGlvblxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBnZXRFbnRlcnByaXNlU3lzdGVtQ291bnQoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3Qgb3V0cHV0ID0gZXhlY1N5bmMoJ2dyZXAgLXIgXCJJTlRFTExJR0VOQ0VfU1lTVEVNXCIgc3JjLyB8IHdjIC1sJywge1xuICAgICAgICBlbmNvZGluZzogJ3V0ZjgnLFxuICAgICAgICBzdGRpbzogJ3BpcGUnXG4gICAgICB9KTtcbiAgICAgIHJldHVybiBwYXJzZUludChvdXRwdXQudHJpbSgpKSB8fCAwO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICByZXR1cm4gMDtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGdldEJ1bmRsZVNpemUoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgYnVpbGREaXJzID0gWycubmV4dCcsICdkaXN0JywgJ2J1aWxkJ107XG4gICAgICBsZXQgdG90YWxTaXplID0gMDtcblxuICAgICAgZm9yIChjb25zdCBkaXIgb2YgYnVpbGREaXJzKSB7XG4gICAgICAgIGlmIChmcy5leGlzdHNTeW5jKGRpcikpIHtcbiAgICAgICAgICBjb25zdCBvdXRwdXQgPSBleGVjU3luYyhgZHUgLXNrICR7ZGlyfSB8IGN1dCAtZjFgLCB7XG4gICAgICAgICAgICBlbmNvZGluZzogJ3V0ZjgnLFxuICAgICAgICAgICAgc3RkaW86ICdwaXBlJ1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIHRvdGFsU2l6ZSArPSBwYXJzZUludChvdXRwdXQudHJpbSgpKSB8fCAwO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0b3RhbFNpemU7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZXN0aW1hdGVDYWNoZUhpdFJhdGUoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICAvLyBUaGlzIGlzIGEgc2ltcGxpZmllZCBlc3RpbWF0aW9uIC0gaW4gYSByZWFsIGltcGxlbWVudGF0aW9uLFxuICAgIC8vIHlvdSdkIGludGVncmF0ZSB3aXRoIHRoZSBhY3R1YWwgYnVpbGQgc3lzdGVtJ3MgY2FjaGUgbWV0cmljc1xuICAgIHJldHVybiAwLjg7IC8vIDgwJSBkZWZhdWx0IGVzdGltYXRlXG4gIH1cblxuICBwcml2YXRlIGdldE1lbW9yeVVzYWdlKCk6IG51bWJlciB7XG4gICAgY29uc3QgbWVtVXNhZ2UgPSBwcm9jZXNzLm1lbW9yeVVzYWdlKCk7XG4gICAgcmV0dXJuIE1hdGgucm91bmQobWVtVXNhZ2UuaGVhcFVzZWQgLyAxMDI0IC8gMTAyNCk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGdldENwdVVzYWdlKCk6IFByb21pc2U8bnVtYmVyPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IG91dHB1dCA9IGV4ZWNTeW5jKCdwcyAtbyAlY3B1IC1wICQkIHwgdGFpbCAtMScsIHtcbiAgICAgICAgZW5jb2Rpbmc6ICd1dGY4JyxcbiAgICAgICAgc3RkaW86ICdwaXBlJ1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gcGFyc2VGbG9hdChvdXRwdXQudHJpbSgpKSB8fCAwO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICByZXR1cm4gMDtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGdldERpc2tVc2FnZSgpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBvdXRwdXQgPSBleGVjU3luYygnZHUgLXNoIC4gfCBjdXQgLWYxJywge1xuICAgICAgICBlbmNvZGluZzogJ3V0ZjgnLFxuICAgICAgICBzdGRpbzogJ3BpcGUnXG4gICAgICB9KTtcbiAgICAgIC8vIENvbnZlcnQgdG8gTUIgKHJvdWdoIGVzdGltYXRpb24pXG4gICAgICBjb25zdCBzaXplU3RyID0gb3V0cHV0LnRyaW0oKTtcbiAgICAgIGlmIChzaXplU3RyLmluY2x1ZGVzKCdHJykpIHtcbiAgICAgICAgcmV0dXJuIHBhcnNlRmxvYXQoc2l6ZVN0cikgKiAxMDI0O1xuICAgICAgfSBlbHNlIGlmIChzaXplU3RyLmluY2x1ZGVzKCdNJykpIHtcbiAgICAgICAgcmV0dXJuIHBhcnNlRmxvYXQoc2l6ZVN0cik7XG4gICAgICB9XG4gICAgICByZXR1cm4gMDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgcmV0dXJuIDA7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBjb3VudFNvdXJjZUZpbGVzKCk6IG51bWJlciB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IG91dHB1dCA9IGV4ZWNTeW5jKCdmaW5kIHNyYyAtbmFtZSBcIioudHNcIiAtbyAtbmFtZSBcIioudHN4XCIgfCB3YyAtbCcsIHtcbiAgICAgICAgZW5jb2Rpbmc6ICd1dGY4JyxcbiAgICAgICAgc3RkaW86ICdwaXBlJ1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gcGFyc2VJbnQob3V0cHV0LnRyaW0oKSkgfHwgMDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgcmV0dXJuIDA7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBnZXRTeXN0ZW1NZW1vcnkoKTogUHJvbWlzZTxSZXNvdXJjZU1ldHJpY3NbJ3N5c3RlbU1lbW9yeSddPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IG91dHB1dCA9IGV4ZWNTeW5jKCdmcmVlIC1tIHwgZ3JlcCBNZW0nLCB7XG4gICAgICAgIGVuY29kaW5nOiAndXRmOCcsXG4gICAgICAgIHN0ZGlvOiAncGlwZSdcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBjb25zdCBtYXRjaCA9IG91dHB1dC5tYXRjaCgvTWVtOlxccysoXFxkKylcXHMrKFxcZCspXFxzKyhcXGQrKS8pO1xuICAgICAgaWYgKG1hdGNoKSB7XG4gICAgICAgIGNvbnN0IHRvdGFsID0gcGFyc2VJbnQobWF0Y2hbMV0pO1xuICAgICAgICBjb25zdCB1c2VkID0gcGFyc2VJbnQobWF0Y2hbMl0pO1xuICAgICAgICBjb25zdCBmcmVlID0gcGFyc2VJbnQobWF0Y2hbM10pO1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHRvdGFsLFxuICAgICAgICAgIHVzZWQsXG4gICAgICAgICAgZnJlZSxcbiAgICAgICAgICBwZXJjZW50YWdlOiBNYXRoLnJvdW5kKCh1c2VkIC8gdG90YWwpICogMTAwKVxuICAgICAgICB9O1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAvLyBGYWxsYmFjayBmb3Igbm9uLUxpbnV4IHN5c3RlbXNcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgdG90YWw6IDAsXG4gICAgICB1c2VkOiAwLFxuICAgICAgZnJlZTogMCxcbiAgICAgIHBlcmNlbnRhZ2U6IDBcbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBnZXREaXNrU3BhY2UoKTogUHJvbWlzZTxSZXNvdXJjZU1ldHJpY3NbJ2Rpc2tTcGFjZSddPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IG91dHB1dCA9IGV4ZWNTeW5jKCdkZiAtaCAuIHwgdGFpbCAtMScsIHtcbiAgICAgICAgZW5jb2Rpbmc6ICd1dGY4JyxcbiAgICAgICAgc3RkaW86ICdwaXBlJ1xuICAgICAgfSk7XG4gICAgICBcbiAgICAgIGNvbnN0IHBhcnRzID0gb3V0cHV0LnRyaW0oKS5zcGxpdCgvXFxzKy8pO1xuICAgICAgaWYgKHBhcnRzLmxlbmd0aCA+PSA0KSB7XG4gICAgICAgIGNvbnN0IHRvdGFsID0gdGhpcy5wYXJzZVNpemUocGFydHNbMV0pO1xuICAgICAgICBjb25zdCB1c2VkID0gdGhpcy5wYXJzZVNpemUocGFydHNbMl0pO1xuICAgICAgICBjb25zdCBmcmVlID0gdGhpcy5wYXJzZVNpemUocGFydHNbM10pO1xuICAgICAgICBcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB0b3RhbCxcbiAgICAgICAgICB1c2VkLFxuICAgICAgICAgIGZyZWUsXG4gICAgICAgICAgcGVyY2VudGFnZTogTWF0aC5yb3VuZCgodXNlZCAvIHRvdGFsKSAqIDEwMClcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgLy8gSGFuZGxlIGVycm9yXG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIHRvdGFsOiAwLFxuICAgICAgdXNlZDogMCxcbiAgICAgIGZyZWU6IDAsXG4gICAgICBwZXJjZW50YWdlOiAwXG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgcGFyc2VTaXplKHNpemVTdHI6IHN0cmluZyk6IG51bWJlciB7XG4gICAgY29uc3QgbnVtID0gcGFyc2VGbG9hdChzaXplU3RyKTtcbiAgICBpZiAoc2l6ZVN0ci5pbmNsdWRlcygnRycpKSByZXR1cm4gbnVtICogMTAyNDtcbiAgICBpZiAoc2l6ZVN0ci5pbmNsdWRlcygnTScpKSByZXR1cm4gbnVtO1xuICAgIGlmIChzaXplU3RyLmluY2x1ZGVzKCdLJykpIHJldHVybiBudW0gLyAxMDI0O1xuICAgIHJldHVybiBudW07XG4gIH1cblxuICAvKipcbiAgICogRXhwb3J0IG1ldGhvZHMgZm9yIGV4dGVybmFsIGFjY2Vzc1xuICAgKi9cbiAgZ2V0U25hcHNob3RzKCk6IE1ldHJpY3NTbmFwc2hvdFtdIHtcbiAgICByZXR1cm4gWy4uLnRoaXMuc25hcHNob3RzXTtcbiAgfVxuXG4gIGdldExhdGVzdFNuYXBzaG90KCk6IE1ldHJpY3NTbmFwc2hvdCB8IG51bGwge1xuICAgIHJldHVybiB0aGlzLnNuYXBzaG90cy5sZW5ndGggPiAwID8gdGhpcy5zbmFwc2hvdHNbdGhpcy5zbmFwc2hvdHMubGVuZ3RoIC0gMV0gOiBudWxsO1xuICB9XG5cbiAgYXN5bmMgZXhwb3J0U25hcHNob3RzKGZpbGVQYXRoOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBleHBvcnREYXRhID0ge1xuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICB0b3RhbFNuYXBzaG90czogdGhpcy5zbmFwc2hvdHMubGVuZ3RoLFxuICAgICAgc25hcHNob3RzOiB0aGlzLnNuYXBzaG90cyxcbiAgICAgIHN1bW1hcnk6IHtcbiAgICAgICAgY29sbGVjdGlvblBlcmlvZDogdGhpcy5zbmFwc2hvdHMubGVuZ3RoID4gMCA/IHtcbiAgICAgICAgICBzdGFydDogdGhpcy5zbmFwc2hvdHNbMF0udGltZXN0YW1wLFxuICAgICAgICAgIGVuZDogdGhpcy5zbmFwc2hvdHNbdGhpcy5zbmFwc2hvdHMubGVuZ3RoIC0gMV0udGltZXN0YW1wXG4gICAgICAgIH0gOiBudWxsLFxuICAgICAgICB0cmVuZHM6IHRoaXMuY2FsY3VsYXRlVHJlbmREYXRhKClcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgZnMud3JpdGVGaWxlU3luYyhmaWxlUGF0aCwgSlNPTi5zdHJpbmdpZnkoZXhwb3J0RGF0YSwgbnVsbCwgMikpO1xuICAgIGNvbnNvbGUubG9nKGDwn5OKIE1ldHJpY3Mgc25hcHNob3RzIGV4cG9ydGVkIHRvOiAke2ZpbGVQYXRofWApO1xuICB9XG5cbiAgY2xlYXJTbmFwc2hvdHMoKTogdm9pZCB7XG4gICAgdGhpcy5zbmFwc2hvdHMgPSBbXTtcbiAgICBjb25zb2xlLmxvZygn8J+TiiBNZXRyaWNzIHNuYXBzaG90cyBjbGVhcmVkJyk7XG4gIH1cbn0iXSwidmVyc2lvbiI6M30=