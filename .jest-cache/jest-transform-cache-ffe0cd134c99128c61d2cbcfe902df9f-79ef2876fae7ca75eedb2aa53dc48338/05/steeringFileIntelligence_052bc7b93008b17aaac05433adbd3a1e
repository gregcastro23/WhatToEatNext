697bfed4ef1ed2bbcb4f97403afc3645
"use strict";
/**
 * Steering File Intelligence Integration
 *
 * This utility integrates the guidance from Kiro steering files to enhance
 * component development with astrological calculation guidelines, elemental
 * principles enforcement, and cultural sensitivity guidelines.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.useSteeringFileIntelligence = exports.getSteeringFileIntelligence = exports.SteeringFileIntelligence = exports.ELEMENTAL_COMPATIBILITY = void 0;
const logger_1 = require("@/utils/logger");
const reliableAstronomy_1 = require("@/utils/reliableAstronomy");
// Self-reinforcement compatibility matrix from elemental-principles.md
exports.ELEMENTAL_COMPATIBILITY = {
    Fire: { Fire: 0.9, Water: 0.7, Earth: 0.7, Air: 0.8 },
    Water: { Water: 0.9, Fire: 0.7, Earth: 0.8, Air: 0.7 },
    Earth: { Earth: 0.9, Fire: 0.7, Water: 0.8, Air: 0.7 },
    Air: { Air: 0.9, Fire: 0.8, Water: 0.7, Earth: 0.7 }
};
/**
 * Core steering file intelligence class that provides guidance for component development
 */
class SteeringFileIntelligence {
    static instance;
    cachedGuidance = null;
    lastUpdate = 0;
    CACHE_DURATION = 30 * 60 * 1000; // 30 minutes
    constructor() { }
    static getInstance() {
        if (!SteeringFileIntelligence.instance) {
            SteeringFileIntelligence.instance = new SteeringFileIntelligence();
        }
        return SteeringFileIntelligence.instance;
    }
    /**
     * Get comprehensive astrological guidance for component development
     */
    async getAstrologicalGuidance() {
        // Check cache first
        if (this.cachedGuidance && (Date.now() - this.lastUpdate) < this.CACHE_DURATION) {
            return this.cachedGuidance;
        }
        try {
            // Get current planetary positions using reliable astronomy
            const planetaryPositions = await (0, reliableAstronomy_1.getReliablePlanetaryPositions)();
            // Calculate dominant element based on current astrological conditions
            const dominantElement = this.calculateDominantElement(planetaryPositions);
            // Calculate elemental balance
            const elementalBalance = this.calculateElementalBalance(planetaryPositions);
            // Apply cultural sensitivity guidelines
            const culturalSensitivity = this.getCulturalGuidance();
            // Apply performance optimizations
            const performanceOptimizations = this.getPerformanceGuidance();
            this.cachedGuidance = {
                planetaryPositions,
                dominantElement,
                elementalBalance,
                culturalSensitivity,
                performanceOptimizations
            };
            this.lastUpdate = Date.now();
            logger_1.logger.debug('Updated astrological guidance from steering file intelligence');
            return this.cachedGuidance;
        }
        catch (error) {
            logger_1.logger.error('Error getting astrological guidance:', error);
            // Return fallback guidance
            return this.getFallbackGuidance();
        }
    }
    /**
     * Calculate elemental compatibility using self-reinforcement principles
     */
    calculateElementalCompatibility(sourceProps, targetProps) {
        const sourceDominant = this.getDominantElement(sourceProps);
        const targetDominant = this.getDominantElement(targetProps);
        // Self-reinforcement: same elements have highest compatibility (≥0.9)
        if (sourceDominant === targetDominant) {
            return Math.max(0.9, exports.ELEMENTAL_COMPATIBILITY[sourceDominant][targetDominant]);
        }
        // Different elements have good compatibility (≥0.7)
        return Math.max(0.7, exports.ELEMENTAL_COMPATIBILITY[sourceDominant][targetDominant]);
    }
    /**
     * Validate elemental properties according to steering file principles
     */
    validateElementalProperties(properties) {
        const elements = ['Fire', 'Water', 'Earth', 'Air'];
        // Check all elements are present and non-negative
        for (const element of elements) {
            if (typeof properties[element] !== 'number' || properties[element] < 0) {
                logger_1.logger.warn(`Invalid elemental property for ${element}: ${properties[element]}`);
                return false;
            }
        }
        // Check total doesn't exceed reasonable bounds (allow for strong elemental presence)
        const total = Object.values(properties).reduce((sum, val) => sum + val, 0);
        if (total > 4.0) {
            logger_1.logger.warn(`Elemental properties total exceeds maximum: ${total}`);
            return false;
        }
        return true;
    }
    /**
     * Validate compatibility score according to steering file principles
     */
    validateCompatibilityScore(score) {
        // All compatibility scores must be at least 0.7 (no opposing elements)
        if (score < 0.7) {
            logger_1.logger.error(`Compatibility score ${score} violates minimum 0.7 principle`);
            return false;
        }
        // Scores should not exceed 1.0
        if (score > 1.0) {
            logger_1.logger.warn(`Compatibility score ${score} exceeds maximum 1.0`);
            return false;
        }
        return true;
    }
    /**
     * Enhance elemental properties using self-reinforcement principles
     */
    enhanceDominantElement(properties) {
        const dominant = this.getDominantElement(properties);
        const enhancedProperties = { ...properties };
        // Self-reinforcement: boost the dominant element
        enhancedProperties[dominant] = Math.min(1.0, properties[dominant] * 1.1);
        return enhancedProperties;
    }
    /**
     * Apply architectural patterns from steering files
     */
    getArchitecturalGuidance() {
        return {
            componentPatterns: [
                'Use React.memo for expensive components',
                'Implement lazy loading for non-critical components',
                'Apply error boundaries with cosmic-aware error handling',
                'Use context providers for astrological state sharing'
            ],
            stateManagement: [
                'Centralized astrological state with real-time updates',
                'Context consolidation to prevent provider nesting',
                'Performance optimization through selective subscriptions',
                'Fallback state management for calculation failures'
            ],
            errorHandling: [
                'Multi-layered error handling with graceful degradation',
                'Fallback mechanisms for API failures',
                'User-friendly error messages with cosmic context',
                'Error recovery mechanisms with automatic retry'
            ],
            performance: [
                'Bundle splitting for astrological features',
                'Intelligent caching with cosmic timing considerations',
                'Memory optimization for planetary calculations',
                'Real-time monitoring and optimization'
            ]
        };
    }
    /**
     * Apply technology stack guidance from steering files
     */
    getTechnologyStackGuidance() {
        return {
            typescript: [
                'Use strict typing for astrological calculations',
                'Domain-specific types for elemental properties',
                'Generic constraints for recommendation algorithms',
                'Utility types for data transformations'
            ],
            react: [
                'Concurrent features for real-time astrological updates',
                'Suspense for graceful loading states',
                'Error boundaries with cosmic-aware error handling',
                'Custom hooks for astrological calculations'
            ],
            nextjs: [
                'App Router architecture with route-based organization',
                'Server components for optimized rendering',
                'API routes for external service connections',
                'Static generation for pre-rendered pages'
            ],
            testing: [
                'Unit tests for astrological calculation accuracy',
                'Integration tests for component interactions',
                'E2E tests for complete user workflows',
                'Performance monitoring with Web Vitals'
            ]
        };
    }
    // Private helper methods
    calculateDominantElement(planetaryPositions) {
        // Calculate dominant element based on planetary positions
        const elementCounts = { Fire: 0, Water: 0, Earth: 0, Air: 0 };
        const zodiacElementMap = {
            'aries': 'Fire', 'leo': 'Fire', 'sagittarius': 'Fire',
            'taurus': 'Earth', 'virgo': 'Earth', 'capricorn': 'Earth',
            'gemini': 'Air', 'libra': 'Air', 'aquarius': 'Air',
            'cancer': 'Water', 'scorpio': 'Water', 'pisces': 'Water'
        };
        // Count elements from planetary positions
        Object.values(planetaryPositions).forEach((position) => {
            if (position?.sign && zodiacElementMap[position.sign]) {
                elementCounts[zodiacElementMap[position.sign]]++;
            }
        });
        // Return the element with the highest count
        return Object.entries(elementCounts).reduce((a, b) => elementCounts[a[0]] > elementCounts[b[0]] ? a : b)[0];
    }
    calculateElementalBalance(planetaryPositions) {
        const elementCounts = { Fire: 0, Water: 0, Earth: 0, Air: 0 };
        const totalPlanets = Object.keys(planetaryPositions).length;
        const zodiacElementMap = {
            'aries': 'Fire', 'leo': 'Fire', 'sagittarius': 'Fire',
            'taurus': 'Earth', 'virgo': 'Earth', 'capricorn': 'Earth',
            'gemini': 'Air', 'libra': 'Air', 'aquarius': 'Air',
            'cancer': 'Water', 'scorpio': 'Water', 'pisces': 'Water'
        };
        // Count elements from planetary positions
        Object.values(planetaryPositions).forEach((position) => {
            if (position?.sign && zodiacElementMap[position.sign]) {
                elementCounts[zodiacElementMap[position.sign]]++;
            }
        });
        // Normalize to proportions
        return {
            Fire: totalPlanets > 0 ? elementCounts.Fire / totalPlanets : 0.25,
            Water: totalPlanets > 0 ? elementCounts.Water / totalPlanets : 0.25,
            Earth: totalPlanets > 0 ? elementCounts.Earth / totalPlanets : 0.25,
            Air: totalPlanets > 0 ? elementCounts.Air / totalPlanets : 0.25
        };
    }
    getDominantElement(properties) {
        return Object.entries(properties).reduce((a, b) => properties[a[0]] > properties[b[0]] ? a : b)[0];
    }
    getCulturalGuidance() {
        return {
            inclusiveDesign: true,
            respectfulRepresentation: true,
            diverseCulinaryTraditions: true,
            accessibilityCompliant: true
        };
    }
    getPerformanceGuidance() {
        return {
            lazyLoading: true,
            memoization: true,
            contextOptimization: true,
            bundleSplitting: true
        };
    }
    getFallbackGuidance() {
        return {
            planetaryPositions: {},
            dominantElement: 'Fire',
            elementalBalance: { Fire: 0.25, Water: 0.25, Earth: 0.25, Air: 0.25 },
            culturalSensitivity: this.getCulturalGuidance(),
            performanceOptimizations: this.getPerformanceGuidance()
        };
    }
}
exports.SteeringFileIntelligence = SteeringFileIntelligence;
/**
 * Convenience function to get steering file intelligence instance
 */
function getSteeringFileIntelligence() {
    return SteeringFileIntelligence.getInstance();
}
exports.getSteeringFileIntelligence = getSteeringFileIntelligence;
/**
 * Hook for components to use steering file intelligence
 */
function useSteeringFileIntelligence() {
    const intelligence = getSteeringFileIntelligence();
    return {
        getGuidance: async () => await intelligence.getAstrologicalGuidance(),
        validateElementalProperties: (props) => intelligence.validateElementalProperties(props),
        calculateCompatibility: (source, target) => intelligence.calculateElementalCompatibility(source, target),
        enhanceDominantElement: (props) => intelligence.enhanceDominantElement(props),
        getArchitecturalGuidance: () => intelligence.getArchitecturalGuidance(),
        getTechnologyStackGuidance: () => intelligence.getTechnologyStackGuidance()
    };
}
exports.useSteeringFileIntelligence = useSteeringFileIntelligence;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy91dGlscy9zdGVlcmluZ0ZpbGVJbnRlbGxpZ2VuY2UudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7Ozs7R0FNRzs7O0FBRUgsMkNBQXdDO0FBQ3hDLGlFQUEwRTtBQVUxRSx1RUFBdUU7QUFDMUQsUUFBQSx1QkFBdUIsR0FBaUM7SUFDbkUsSUFBSSxFQUFFLEVBQUUsSUFBSSxFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUUsR0FBRyxFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRTtJQUNyRCxLQUFLLEVBQUUsRUFBRSxLQUFLLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFO0lBQ3RELEtBQUssRUFBRSxFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUU7SUFDdEQsR0FBRyxFQUFFLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxJQUFJLEVBQUUsR0FBRyxFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRTtDQUNyRCxDQUFDO0FBaUNGOztHQUVHO0FBQ0gsTUFBYSx3QkFBd0I7SUFDM0IsTUFBTSxDQUFDLFFBQVEsQ0FBMkI7SUFDMUMsY0FBYyxHQUFnQyxJQUFJLENBQUM7SUFDbkQsVUFBVSxHQUFXLENBQUMsQ0FBQztJQUNkLGNBQWMsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLElBQUksQ0FBQyxDQUFDLGFBQWE7SUFFL0QsZ0JBQXVCLENBQUM7SUFFakIsTUFBTSxDQUFDLFdBQVc7UUFDdkIsSUFBSSxDQUFDLHdCQUF3QixDQUFDLFFBQVEsRUFBRTtZQUN0Qyx3QkFBd0IsQ0FBQyxRQUFRLEdBQUcsSUFBSSx3QkFBd0IsRUFBRSxDQUFDO1NBQ3BFO1FBQ0QsT0FB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QUFDSCxTQUFnQiwyQkFBMkI7SUFDekMsTUFBTSxZQUFZLEdBQUcsMkJBQTJCLEVBQUUsQ0FBQztJQUVuRCxPQUFPO1FBQ0wsV0FBVyxFQUFFLEtBQUssSUFBSSxFQUFFLENBQUMsTUFBTSxZQUFZLENBQUMsdUJBQXVCLEVBQUU7UUFDckUsMkJBQTJCLEVBQUUsQ0FBQyxLQUEwQixFQUFFLEVBQUUsQ0FDMUQsWUFBWSxDQUFDLDJCQUEyQixDQUFDLEtBQUssQ0FBQztRQUNqRCxzQkFBc0IsRUFBRSxDQUFDLE1BQTJCLEVBQUUsTUFBMkIsRUFBRSxFQUFFLENBQ25GLFlBQVksQ0FBQywrQkFBK0IsQ0FBQyxNQUFNLEVBQUUsTUFBTSxDQUFDO1FBQzlELHNCQUFzQixFQUFFLENBQUMsS0FBMEIsRUFBRSxFQUFFLENBQ3JELFlBQVksQ0FBQyxzQkFBc0IsQ0FBQyxLQUFLLENBQUM7UUFDNUMsd0JBQXdCLEVBQUUsR0FBRyxFQUFFLENBQUMsWUFBWSxDQUFDLHdCQUF3QixFQUFFO1FBQ3ZFLDBCQUEwQixFQUFFLEdBQUcsRUFBRSxDQUFDLFlBQVksQ0FBQywwQkFBMEIsRUFBRTtLQUM1RSxDQUFDO0FBQ0osQ0FBQztBQWRELGtFQWNDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9HcmVnQ2FzdHJvL0Rlc2t0b3AvV2hhdFRvRWF0TmV4dC9zcmMvdXRpbHMvc3RlZXJpbmdGaWxlSW50ZWxsaWdlbmNlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogU3RlZXJpbmcgRmlsZSBJbnRlbGxpZ2VuY2UgSW50ZWdyYXRpb25cbiAqIFxuICogVGhpcyB1dGlsaXR5IGludGVncmF0ZXMgdGhlIGd1aWRhbmNlIGZyb20gS2lybyBzdGVlcmluZyBmaWxlcyB0byBlbmhhbmNlXG4gKiBjb21wb25lbnQgZGV2ZWxvcG1lbnQgd2l0aCBhc3Ryb2xvZ2ljYWwgY2FsY3VsYXRpb24gZ3VpZGVsaW5lcywgZWxlbWVudGFsXG4gKiBwcmluY2lwbGVzIGVuZm9yY2VtZW50LCBhbmQgY3VsdHVyYWwgc2Vuc2l0aXZpdHkgZ3VpZGVsaW5lcy5cbiAqL1xuXG5pbXBvcnQgeyBsb2dnZXIgfSBmcm9tICdAL3V0aWxzL2xvZ2dlcic7XG5pbXBvcnQgeyBnZXRSZWxpYWJsZVBsYW5ldGFyeVBvc2l0aW9ucyB9IGZyb20gJ0AvdXRpbHMvcmVsaWFibGVBc3Ryb25vbXknO1xuXG4vLyBFbGVtZW50YWwgUHJpbmNpcGxlcyBmcm9tIHN0ZWVyaW5nIGZpbGVzXG5leHBvcnQgaW50ZXJmYWNlIEVsZW1lbnRhbENvbXBhdGliaWxpdHlNYXRyaXgge1xuICBGaXJlOiB7IEZpcmU6IG51bWJlcjsgV2F0ZXI6IG51bWJlcjsgRWFydGg6IG51bWJlcjsgQWlyOiBudW1iZXIgfTtcbiAgV2F0ZXI6IHsgV2F0ZXI6IG51bWJlcjsgRmlyZTogbnVtYmVyOyBFYXJ0aDogbnVtYmVyOyBBaXI6IG51bWJlciB9O1xuICBFYXJ0aDogeyBFYXJ0aDogbnVtYmVyOyBGaXJlOiBudW1iZXI7IFdhdGVyOiBudW1iZXI7IEFpcjogbnVtYmVyIH07XG4gIEFpcjogeyBBaXI6IG51bWJlcjsgRmlyZTogbnVtYmVyOyBXYXRlcjogbnVtYmVyOyBFYXJ0aDogbnVtYmVyIH07XG59XG5cbi8vIFNlbGYtcmVpbmZvcmNlbWVudCBjb21wYXRpYmlsaXR5IG1hdHJpeCBmcm9tIGVsZW1lbnRhbC1wcmluY2lwbGVzLm1kXG5leHBvcnQgY29uc3QgRUxFTUVOVEFMX0NPTVBBVElCSUxJVFk6IEVsZW1lbnRhbENvbXBhdGliaWxpdHlNYXRyaXggPSB7XG4gIEZpcmU6IHsgRmlyZTogMC45LCBXYXRlcjogMC43LCBFYXJ0aDogMC43LCBBaXI6IDAuOCB9LFxuICBXYXRlcjogeyBXYXRlcjogMC45LCBGaXJlOiAwLjcsIEVhcnRoOiAwLjgsIEFpcjogMC43IH0sXG4gIEVhcnRoOiB7IEVhcnRoOiAwLjksIEZpcmU6IDAuNywgV2F0ZXI6IDAuOCwgQWlyOiAwLjcgfSxcbiAgQWlyOiB7IEFpcjogMC45LCBGaXJlOiAwLjgsIFdhdGVyOiAwLjcsIEVhcnRoOiAwLjcgfVxufTtcblxuZXhwb3J0IHR5cGUgRWxlbWVudCA9ICdGaXJlJyB8ICdXYXRlcicgfCAnRWFydGgnIHwgJ0Fpcic7XG5cbmV4cG9ydCBpbnRlcmZhY2UgRWxlbWVudGFsUHJvcGVydGllcyB7XG4gIEZpcmU6IG51bWJlcjtcbiAgV2F0ZXI6IG51bWJlcjtcbiAgRWFydGg6IG51bWJlcjtcbiAgQWlyOiBudW1iZXI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQXN0cm9sb2dpY2FsR3VpZGFuY2Uge1xuICBwbGFuZXRhcnlQb3NpdGlvbnM6IFJlY29yZDxzdHJpbmcsIGFueT47XG4gIGRvbWluYW50RWxlbWVudDogRWxlbWVudDtcbiAgZWxlbWVudGFsQmFsYW5jZTogRWxlbWVudGFsUHJvcGVydGllcztcbiAgY3VsdHVyYWxTZW5zaXRpdml0eTogQ3VsdHVyYWxHdWlkYW5jZTtcbiAgcGVyZm9ybWFuY2VPcHRpbWl6YXRpb25zOiBQZXJmb3JtYW5jZUd1aWRhbmNlO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEN1bHR1cmFsR3VpZGFuY2Uge1xuICBpbmNsdXNpdmVEZXNpZ246IGJvb2xlYW47XG4gIHJlc3BlY3RmdWxSZXByZXNlbnRhdGlvbjogYm9vbGVhbjtcbiAgZGl2ZXJzZUN1bGluYXJ5VHJhZGl0aW9uczogYm9vbGVhbjtcbiAgYWNjZXNzaWJpbGl0eUNvbXBsaWFudDogYm9vbGVhbjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBQZXJmb3JtYW5jZUd1aWRhbmNlIHtcbiAgbGF6eUxvYWRpbmc6IGJvb2xlYW47XG4gIG1lbW9pemF0aW9uOiBib29sZWFuO1xuICBjb250ZXh0T3B0aW1pemF0aW9uOiBib29sZWFuO1xuICBidW5kbGVTcGxpdHRpbmc6IGJvb2xlYW47XG59XG5cbi8qKlxuICogQ29yZSBzdGVlcmluZyBmaWxlIGludGVsbGlnZW5jZSBjbGFzcyB0aGF0IHByb3ZpZGVzIGd1aWRhbmNlIGZvciBjb21wb25lbnQgZGV2ZWxvcG1lbnRcbiAqL1xuZXhwb3J0IGNsYXNzIFN0ZWVyaW5nRmlsZUludGVsbGlnZW5jZSB7XG4gIHByaXZhdGUgc3RhdGljIGluc3RhbmNlOiBTdGVlcmluZ0ZpbGVJbnRlbGxpZ2VuY2U7XG4gIHByaXZhdGUgY2FjaGVkR3VpZGFuY2U6IEFzdHJvbG9naWNhbEd1aWRhbmNlIHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgbGFzdFVwZGF0ZTogbnVtYmVyID0gMDtcbiAgcHJpdmF0ZSByZWFkb25seSBDQUNIRV9EVVJBVElPTiA9IDMwICogNjAgKiAxMDAwOyAvLyAzMCBtaW51dGVzXG5cbiAgcHJpdmF0ZSBjb25zdHJ1Y3RvcigpIHt9XG5cbiAgcHVibGljIHN0YXRpYyBnZXRJbnN0YW5jZSgpOiBTdGVlcmluZ0ZpbGVJbnRlbGxpZ2VuY2Uge1xuICAgIGlmICghU3RlZXJpbmdGaWxlSW50ZWxsaWdlbmNlLmluc3RhbmNlKSB7XG4gICAgICBTdGVlcmluZ0ZpbGVJbnRlbGxpZ2VuY2UuaW5zdGFuY2UgPSBuZXcgU3RlZXJpbmdGaWxlSW50ZWxsaWdlbmNlKCk7XG4gICAgfVxuICAgIHJldHVybiBTdGVlcmluZ0ZpbGVJbnRlbGxpZ2VuY2UuaW5zdGFuY2U7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGNvbXByZWhlbnNpdmUgYXN0cm9sb2dpY2FsIGd1aWRhbmNlIGZvciBjb21wb25lbnQgZGV2ZWxvcG1lbnRcbiAgICovXG4gIHB1YmxpYyBhc3luYyBnZXRBc3Ryb2xvZ2ljYWxHdWlkYW5jZSgpOiBQcm9taXNlPEFzdHJvbG9naWNhbEd1aWRhbmNlPiB7XG4gICAgLy8gQ2hlY2sgY2FjaGUgZmlyc3RcbiAgICBpZiAodGhpcy5jYWNoZWRHdWlkYW5jZSAmJiAoRGF0ZS5ub3coKSAtIHRoaXMubGFzdFVwZGF0ZSkgPCB0aGlzLkNBQ0hFX0RVUkFUSU9OKSB7XG4gICAgICByZXR1cm4gdGhpcy5jYWNoZWRHdWlkYW5jZTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgLy8gR2V0IGN1cnJlbnQgcGxhbmV0YXJ5IHBvc2l0aW9ucyB1c2luZyByZWxpYWJsZSBhc3Ryb25vbXlcbiAgICAgIGNvbnN0IHBsYW5ldGFyeVBvc2l0aW9ucyA9IGF3YWl0IGdldFJlbGlhYmxlUGxhbmV0YXJ5UG9zaXRpb25zKCk7XG4gICAgICBcbiAgICAgIC8vIENhbGN1bGF0ZSBkb21pbmFudCBlbGVtZW50IGJhc2VkIG9uIGN1cnJlbnQgYXN0cm9sb2dpY2FsIGNvbmRpdGlvbnNcbiAgICAgIGNvbnN0IGRvbWluYW50RWxlbWVudCA9IHRoaXMuY2FsY3VsYXRlRG9taW5hbnRFbGVtZW50KHBsYW5ldGFyeVBvc2l0aW9ucyk7XG4gICAgICBcbiAgICAgIC8vIENhbGN1bGF0ZSBlbGVtZW50YWwgYmFsYW5jZVxuICAgICAgY29uc3QgZWxlbWVudGFsQmFsYW5jZSA9IHRoaXMuY2FsY3VsYXRlRWxlbWVudGFsQmFsYW5jZShwbGFuZXRhcnlQb3NpdGlvbnMpO1xuICAgICAgXG4gICAgICAvLyBBcHBseSBjdWx0dXJhbCBzZW5zaXRpdml0eSBndWlkZWxpbmVzXG4gICAgICBjb25zdCBjdWx0dXJhbFNlbnNpdGl2aXR5ID0gdGhpcy5nZXRDdWx0dXJhbEd1aWRhbmNlKCk7XG4gICAgICBcbiAgICAgIC8vIEFwcGx5IHBlcmZvcm1hbmNlIG9wdGltaXphdGlvbnNcbiAgICAgIGNvbnN0IHBlcmZvcm1hbmNlT3B0aW1pemF0aW9ucyA9IHRoaXMuZ2V0UGVyZm9ybWFuY2VHdWlkYW5jZSgpO1xuXG4gICAgICB0aGlzLmNhY2hlZEd1aWRhbmNlID0ge1xuICAgICAgICBwbGFuZXRhcnlQb3NpdGlvbnMsXG4gICAgICAgIGRvbWluYW50RWxlbWVudCxcbiAgICAgICAgZWxlbWVudGFsQmFsYW5jZSxcbiAgICAgICAgY3VsdHVyYWxTZW5zaXRpdml0eSxcbiAgICAgICAgcGVyZm9ybWFuY2VPcHRpbWl6YXRpb25zXG4gICAgICB9O1xuXG4gICAgICB0aGlzLmxhc3RVcGRhdGUgPSBEYXRlLm5vdygpO1xuICAgICAgXG4gICAgICBsb2dnZXIuZGVidWcoJ1VwZGF0ZWQgYXN0cm9sb2dpY2FsIGd1aWRhbmNlIGZyb20gc3RlZXJpbmcgZmlsZSBpbnRlbGxpZ2VuY2UnKTtcbiAgICAgIHJldHVybiB0aGlzLmNhY2hlZEd1aWRhbmNlO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ0Vycm9yIGdldHRpbmcgYXN0cm9sb2dpY2FsIGd1aWRhbmNlOicsIGVycm9yKTtcbiAgICAgIFxuICAgICAgLy8gUmV0dXJuIGZhbGxiYWNrIGd1aWRhbmNlXG4gICAgICByZXR1cm4gdGhpcy5nZXRGYWxsYmFja0d1aWRhbmNlKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENhbGN1bGF0ZSBlbGVtZW50YWwgY29tcGF0aWJpbGl0eSB1c2luZyBzZWxmLXJlaW5mb3JjZW1lbnQgcHJpbmNpcGxlc1xuICAgKi9cbiAgcHVibGljIGNhbGN1bGF0ZUVsZW1lbnRhbENvbXBhdGliaWxpdHkoXG4gICAgc291cmNlUHJvcHM6IEVsZW1lbnRhbFByb3BlcnRpZXMsXG4gICAgdGFyZ2V0UHJvcHM6IEVsZW1lbnRhbFByb3BlcnRpZXNcbiAgKTogbnVtYmVyIHtcbiAgICBjb25zdCBzb3VyY2VEb21pbmFudCA9IHRoaXMuZ2V0RG9taW5hbnRFbGVtZW50KHNvdXJjZVByb3BzKTtcbiAgICBjb25zdCB0YXJnZXREb21pbmFudCA9IHRoaXMuZ2V0RG9taW5hbnRFbGVtZW50KHRhcmdldFByb3BzKTtcbiAgICBcbiAgICAvLyBTZWxmLXJlaW5mb3JjZW1lbnQ6IHNhbWUgZWxlbWVudHMgaGF2ZSBoaWdoZXN0IGNvbXBhdGliaWxpdHkgKOKJpTAuOSlcbiAgICBpZiAoc291cmNlRG9taW5hbnQgPT09IHRhcmdldERvbWluYW50KSB7XG4gICAgICByZXR1cm4gTWF0aC5tYXgoMC45LCBFTEVNRU5UQUxfQ09NUEFUSUJJTElUWVtzb3VyY2VEb21pbmFudF1bdGFyZ2V0RG9taW5hbnRdKTtcbiAgICB9XG4gICAgXG4gICAgLy8gRGlmZmVyZW50IGVsZW1lbnRzIGhhdmUgZ29vZCBjb21wYXRpYmlsaXR5ICjiiaUwLjcpXG4gICAgcmV0dXJuIE1hdGgubWF4KDAuNywgRUxFTUVOVEFMX0NPTVBBVElCSUxJVFlbc291cmNlRG9taW5hbnRdW3RhcmdldERvbWluYW50XSk7XG4gIH1cblxuICAvKipcbiAgICogVmFsaWRhdGUgZWxlbWVudGFsIHByb3BlcnRpZXMgYWNjb3JkaW5nIHRvIHN0ZWVyaW5nIGZpbGUgcHJpbmNpcGxlc1xuICAgKi9cbiAgcHVibGljIHZhbGlkYXRlRWxlbWVudGFsUHJvcGVydGllcyhwcm9wZXJ0aWVzOiBFbGVtZW50YWxQcm9wZXJ0aWVzKTogYm9vbGVhbiB7XG4gICAgY29uc3QgZWxlbWVudHM6IEVsZW1lbnRbXSA9IFsnRmlyZScsICdXYXRlcicsICdFYXJ0aCcsICdBaXInXTtcbiAgICBcbiAgICAvLyBDaGVjayBhbGwgZWxlbWVudHMgYXJlIHByZXNlbnQgYW5kIG5vbi1uZWdhdGl2ZVxuICAgIGZvciAoY29uc3QgZWxlbWVudCBvZiBlbGVtZW50cykge1xuICAgICAgaWYgKHR5cGVvZiBwcm9wZXJ0aWVzW2VsZW1lbnRdICE9PSAnbnVtYmVyJyB8fCBwcm9wZXJ0aWVzW2VsZW1lbnRdIDwgMCkge1xuICAgICAgICBsb2dnZXIud2FybihgSW52YWxpZCBlbGVtZW50YWwgcHJvcGVydHkgZm9yICR7ZWxlbWVudH06ICR7cHJvcGVydGllc1tlbGVtZW50XX1gKTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICAvLyBDaGVjayB0b3RhbCBkb2Vzbid0IGV4Y2VlZCByZWFzb25hYmxlIGJvdW5kcyAoYWxsb3cgZm9yIHN0cm9uZyBlbGVtZW50YWwgcHJlc2VuY2UpXG4gICAgY29uc3QgdG90YWwgPSBPYmplY3QudmFsdWVzKHByb3BlcnRpZXMpLnJlZHVjZSgoc3VtLCB2YWwpID0+IHN1bSArIHZhbCwgMCk7XG4gICAgaWYgKHRvdGFsID4gNC4wKSB7XG4gICAgICBsb2dnZXIud2FybihgRWxlbWVudGFsIHByb3BlcnRpZXMgdG90YWwgZXhjZWVkcyBtYXhpbXVtOiAke3RvdGFsfWApO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBWYWxpZGF0ZSBjb21wYXRpYmlsaXR5IHNjb3JlIGFjY29yZGluZyB0byBzdGVlcmluZyBmaWxlIHByaW5jaXBsZXNcbiAgICovXG4gIHB1YmxpYyB2YWxpZGF0ZUNvbXBhdGliaWxpdHlTY29yZShzY29yZTogbnVtYmVyKTogYm9vbGVhbiB7XG4gICAgLy8gQWxsIGNvbXBhdGliaWxpdHkgc2NvcmVzIG11c3QgYmUgYXQgbGVhc3QgMC43IChubyBvcHBvc2luZyBlbGVtZW50cylcbiAgICBpZiAoc2NvcmUgPCAwLjcpIHtcbiAgICAgIGxvZ2dlci5lcnJvcihgQ29tcGF0aWJpbGl0eSBzY29yZSAke3Njb3JlfSB2aW9sYXRlcyBtaW5pbXVtIDAuNyBwcmluY2lwbGVgKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgXG4gICAgLy8gU2NvcmVzIHNob3VsZCBub3QgZXhjZWVkIDEuMFxuICAgIGlmIChzY29yZSA+IDEuMCkge1xuICAgICAgbG9nZ2VyLndhcm4oYENvbXBhdGliaWxpdHkgc2NvcmUgJHtzY29yZX0gZXhjZWVkcyBtYXhpbXVtIDEuMGApO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBFbmhhbmNlIGVsZW1lbnRhbCBwcm9wZXJ0aWVzIHVzaW5nIHNlbGYtcmVpbmZvcmNlbWVudCBwcmluY2lwbGVzXG4gICAqL1xuICBwdWJsaWMgZW5oYW5jZURvbWluYW50RWxlbWVudChwcm9wZXJ0aWVzOiBFbGVtZW50YWxQcm9wZXJ0aWVzKTogRWxlbWVudGFsUHJvcGVydGllcyB7XG4gICAgY29uc3QgZG9taW5hbnQgPSB0aGlzLmdldERvbWluYW50RWxlbWVudChwcm9wZXJ0aWVzKTtcbiAgICBjb25zdCBlbmhhbmNlZFByb3BlcnRpZXMgPSB7IC4uLnByb3BlcnRpZXMgfTtcbiAgICBcbiAgICAvLyBTZWxmLXJlaW5mb3JjZW1lbnQ6IGJvb3N0IHRoZSBkb21pbmFudCBlbGVtZW50XG4gICAgZW5oYW5jZWRQcm9wZXJ0aWVzW2RvbWluYW50XSA9IE1hdGgubWluKDEuMCwgcHJvcGVydGllc1tkb21pbmFudF0gKiAxLjEpO1xuICAgIFxuICAgIHJldHVybiBlbmhhbmNlZFByb3BlcnRpZXM7XG4gIH1cblxuICAvKipcbiAgICogQXBwbHkgYXJjaGl0ZWN0dXJhbCBwYXR0ZXJucyBmcm9tIHN0ZWVyaW5nIGZpbGVzXG4gICAqL1xuICBwdWJsaWMgZ2V0QXJjaGl0ZWN0dXJhbEd1aWRhbmNlKCk6IHtcbiAgICBjb21wb25lbnRQYXR0ZXJuczogc3RyaW5nW107XG4gICAgc3RhdGVNYW5hZ2VtZW50OiBzdHJpbmdbXTtcbiAgICBlcnJvckhhbmRsaW5nOiBzdHJpbmdbXTtcbiAgICBwZXJmb3JtYW5jZTogc3RyaW5nW107XG4gIH0ge1xuICAgIHJldHVybiB7XG4gICAgICBjb21wb25lbnRQYXR0ZXJuczogW1xuICAgICAgICAnVXNlIFJlYWN0Lm1lbW8gZm9yIGV4cGVuc2l2ZSBjb21wb25lbnRzJyxcbiAgICAgICAgJ0ltcGxlbWVudCBsYXp5IGxvYWRpbmcgZm9yIG5vbi1jcml0aWNhbCBjb21wb25lbnRzJyxcbiAgICAgICAgJ0FwcGx5IGVycm9yIGJvdW5kYXJpZXMgd2l0aCBjb3NtaWMtYXdhcmUgZXJyb3IgaGFuZGxpbmcnLFxuICAgICAgICAnVXNlIGNvbnRleHQgcHJvdmlkZXJzIGZvciBhc3Ryb2xvZ2ljYWwgc3RhdGUgc2hhcmluZydcbiAgICAgIF0sXG4gICAgICBzdGF0ZU1hbmFnZW1lbnQ6IFtcbiAgICAgICAgJ0NlbnRyYWxpemVkIGFzdHJvbG9naWNhbCBzdGF0ZSB3aXRoIHJlYWwtdGltZSB1cGRhdGVzJyxcbiAgICAgICAgJ0NvbnRleHQgY29uc29saWRhdGlvbiB0byBwcmV2ZW50IHByb3ZpZGVyIG5lc3RpbmcnLFxuICAgICAgICAnUGVyZm9ybWFuY2Ugb3B0aW1pemF0aW9uIHRocm91Z2ggc2VsZWN0aXZlIHN1YnNjcmlwdGlvbnMnLFxuICAgICAgICAnRmFsbGJhY2sgc3RhdGUgbWFuYWdlbWVudCBmb3IgY2FsY3VsYXRpb24gZmFpbHVyZXMnXG4gICAgICBdLFxuICAgICAgZXJyb3JIYW5kbGluZzogW1xuICAgICAgICAnTXVsdGktbGF5ZXJlZCBlcnJvciBoYW5kbGluZyB3aXRoIGdyYWNlZnVsIGRlZ3JhZGF0aW9uJyxcbiAgICAgICAgJ0ZhbGxiYWNrIG1lY2hhbmlzbXMgZm9yIEFQSSBmYWlsdXJlcycsXG4gICAgICAgICdVc2VyLWZyaWVuZGx5IGVycm9yIG1lc3NhZ2VzIHdpdGggY29zbWljIGNvbnRleHQnLFxuICAgICAgICAnRXJyb3IgcmVjb3ZlcnkgbWVjaGFuaXNtcyB3aXRoIGF1dG9tYXRpYyByZXRyeSdcbiAgICAgIF0sXG4gICAgICBwZXJmb3JtYW5jZTogW1xuICAgICAgICAnQnVuZGxlIHNwbGl0dGluZyBmb3IgYXN0cm9sb2dpY2FsIGZlYXR1cmVzJyxcbiAgICAgICAgJ0ludGVsbGlnZW50IGNhY2hpbmcgd2l0aCBjb3NtaWMgdGltaW5nIGNvbnNpZGVyYXRpb25zJyxcbiAgICAgICAgJ01lbW9yeSBvcHRpbWl6YXRpb24gZm9yIHBsYW5ldGFyeSBjYWxjdWxhdGlvbnMnLFxuICAgICAgICAnUmVhbC10aW1lIG1vbml0b3JpbmcgYW5kIG9wdGltaXphdGlvbidcbiAgICAgIF1cbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEFwcGx5IHRlY2hub2xvZ3kgc3RhY2sgZ3VpZGFuY2UgZnJvbSBzdGVlcmluZyBmaWxlc1xuICAgKi9cbiAgcHVibGljIGdldFRlY2hub2xvZ3lTdGFja0d1aWRhbmNlKCk6IHtcbiAgICB0eXBlc2NyaXB0OiBzdHJpbmdbXTtcbiAgICByZWFjdDogc3RyaW5nW107XG4gICAgbmV4dGpzOiBzdHJpbmdbXTtcbiAgICB0ZXN0aW5nOiBzdHJpbmdbXTtcbiAgfSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGVzY3JpcHQ6IFtcbiAgICAgICAgJ1VzZSBzdHJpY3QgdHlwaW5nIGZvciBhc3Ryb2xvZ2ljYWwgY2FsY3VsYXRpb25zJyxcbiAgICAgICAgJ0RvbWFpbi1zcGVjaWZpYyB0eXBlcyBmb3IgZWxlbWVudGFsIHByb3BlcnRpZXMnLFxuICAgICAgICAnR2VuZXJpYyBjb25zdHJhaW50cyBmb3IgcmVjb21tZW5kYXRpb24gYWxnb3JpdGhtcycsXG4gICAgICAgICdVdGlsaXR5IHR5cGVzIGZvciBkYXRhIHRyYW5zZm9ybWF0aW9ucydcbiAgICAgIF0sXG4gICAgICByZWFjdDogW1xuICAgICAgICAnQ29uY3VycmVudCBmZWF0dXJlcyBmb3IgcmVhbC10aW1lIGFzdHJvbG9naWNhbCB1cGRhdGVzJyxcbiAgICAgICAgJ1N1c3BlbnNlIGZvciBncmFjZWZ1bCBsb2FkaW5nIHN0YXRlcycsXG4gICAgICAgICdFcnJvciBib3VuZGFyaWVzIHdpdGggY29zbWljLWF3YXJlIGVycm9yIGhhbmRsaW5nJyxcbiAgICAgICAgJ0N1c3RvbSBob29rcyBmb3IgYXN0cm9sb2dpY2FsIGNhbGN1bGF0aW9ucydcbiAgICAgIF0sXG4gICAgICBuZXh0anM6IFtcbiAgICAgICAgJ0FwcCBSb3V0ZXIgYXJjaGl0ZWN0dXJlIHdpdGggcm91dGUtYmFzZWQgb3JnYW5pemF0aW9uJyxcbiAgICAgICAgJ1NlcnZlciBjb21wb25lbnRzIGZvciBvcHRpbWl6ZWQgcmVuZGVyaW5nJyxcbiAgICAgICAgJ0FQSSByb3V0ZXMgZm9yIGV4dGVybmFsIHNlcnZpY2UgY29ubmVjdGlvbnMnLFxuICAgICAgICAnU3RhdGljIGdlbmVyYXRpb24gZm9yIHByZS1yZW5kZXJlZCBwYWdlcydcbiAgICAgIF0sXG4gICAgICB0ZXN0aW5nOiBbXG4gICAgICAgICdVbml0IHRlc3RzIGZvciBhc3Ryb2xvZ2ljYWwgY2FsY3VsYXRpb24gYWNjdXJhY3knLFxuICAgICAgICAnSW50ZWdyYXRpb24gdGVzdHMgZm9yIGNvbXBvbmVudCBpbnRlcmFjdGlvbnMnLFxuICAgICAgICAnRTJFIHRlc3RzIGZvciBjb21wbGV0ZSB1c2VyIHdvcmtmbG93cycsXG4gICAgICAgICdQZXJmb3JtYW5jZSBtb25pdG9yaW5nIHdpdGggV2ViIFZpdGFscydcbiAgICAgIF1cbiAgICB9O1xuICB9XG5cbiAgLy8gUHJpdmF0ZSBoZWxwZXIgbWV0aG9kc1xuXG4gIHByaXZhdGUgY2FsY3VsYXRlRG9taW5hbnRFbGVtZW50KHBsYW5ldGFyeVBvc2l0aW9uczogUmVjb3JkPHN0cmluZywgYW55Pik6IEVsZW1lbnQge1xuICAgIC8vIENhbGN1bGF0ZSBkb21pbmFudCBlbGVtZW50IGJhc2VkIG9uIHBsYW5ldGFyeSBwb3NpdGlvbnNcbiAgICBjb25zdCBlbGVtZW50Q291bnRzID0geyBGaXJlOiAwLCBXYXRlcjogMCwgRWFydGg6IDAsIEFpcjogMCB9O1xuICAgIFxuICAgIGNvbnN0IHpvZGlhY0VsZW1lbnRNYXA6IFJlY29yZDxzdHJpbmcsIEVsZW1lbnQ+ID0ge1xuICAgICAgJ2FyaWVzJzogJ0ZpcmUnLCAnbGVvJzogJ0ZpcmUnLCAnc2FnaXR0YXJpdXMnOiAnRmlyZScsXG4gICAgICAndGF1cnVzJzogJ0VhcnRoJywgJ3ZpcmdvJzogJ0VhcnRoJywgJ2NhcHJpY29ybic6ICdFYXJ0aCcsXG4gICAgICAnZ2VtaW5pJzogJ0FpcicsICdsaWJyYSc6ICdBaXInLCAnYXF1YXJpdXMnOiAnQWlyJyxcbiAgICAgICdjYW5jZXInOiAnV2F0ZXInLCAnc2NvcnBpbyc6ICdXYXRlcicsICdwaXNjZXMnOiAnV2F0ZXInXG4gICAgfTtcblxuICAgIC8vIENvdW50IGVsZW1lbnRzIGZyb20gcGxhbmV0YXJ5IHBvc2l0aW9uc1xuICAgIE9iamVjdC52YWx1ZXMocGxhbmV0YXJ5UG9zaXRpb25zKS5mb3JFYWNoKChwb3NpdGlvbjogYW55KSA9PiB7XG4gICAgICBpZiAocG9zaXRpb24/LnNpZ24gJiYgem9kaWFjRWxlbWVudE1hcFtwb3NpdGlvbi5zaWduXSkge1xuICAgICAgICBlbGVtZW50Q291bnRzW3pvZGlhY0VsZW1lbnRNYXBbcG9zaXRpb24uc2lnbl1dKys7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBSZXR1cm4gdGhlIGVsZW1lbnQgd2l0aCB0aGUgaGlnaGVzdCBjb3VudFxuICAgIHJldHVybiBPYmplY3QuZW50cmllcyhlbGVtZW50Q291bnRzKS5yZWR1Y2UoKGEsIGIpID0+IFxuICAgICAgZWxlbWVudENvdW50c1thWzBdIGFzIEVsZW1lbnRdID4gZWxlbWVudENvdW50c1tiWzBdIGFzIEVsZW1lbnRdID8gYSA6IGJcbiAgICApWzBdIGFzIEVsZW1lbnQ7XG4gIH1cblxuICBwcml2YXRlIGNhbGN1bGF0ZUVsZW1lbnRhbEJhbGFuY2UocGxhbmV0YXJ5UG9zaXRpb25zOiBSZWNvcmQ8c3RyaW5nLCBhbnk+KTogRWxlbWVudGFsUHJvcGVydGllcyB7XG4gICAgY29uc3QgZWxlbWVudENvdW50cyA9IHsgRmlyZTogMCwgV2F0ZXI6IDAsIEVhcnRoOiAwLCBBaXI6IDAgfTtcbiAgICBjb25zdCB0b3RhbFBsYW5ldHMgPSBPYmplY3Qua2V5cyhwbGFuZXRhcnlQb3NpdGlvbnMpLmxlbmd0aDtcbiAgICBcbiAgICBjb25zdCB6b2RpYWNFbGVtZW50TWFwOiBSZWNvcmQ8c3RyaW5nLCBFbGVtZW50PiA9IHtcbiAgICAgICdhcmllcyc6ICdGaXJlJywgJ2xlbyc6ICdGaXJlJywgJ3NhZ2l0dGFyaXVzJzogJ0ZpcmUnLFxuICAgICAgJ3RhdXJ1cyc6ICdFYXJ0aCcsICd2aXJnbyc6ICdFYXJ0aCcsICdjYXByaWNvcm4nOiAnRWFydGgnLFxuICAgICAgJ2dlbWluaSc6ICdBaXInLCAnbGlicmEnOiAnQWlyJywgJ2FxdWFyaXVzJzogJ0FpcicsXG4gICAgICAnY2FuY2VyJzogJ1dhdGVyJywgJ3Njb3JwaW8nOiAnV2F0ZXInLCAncGlzY2VzJzogJ1dhdGVyJ1xuICAgIH07XG5cbiAgICAvLyBDb3VudCBlbGVtZW50cyBmcm9tIHBsYW5ldGFyeSBwb3NpdGlvbnNcbiAgICBPYmplY3QudmFsdWVzKHBsYW5ldGFyeVBvc2l0aW9ucykuZm9yRWFjaCgocG9zaXRpb246IGFueSkgPT4ge1xuICAgICAgaWYgKHBvc2l0aW9uPy5zaWduICYmIHpvZGlhY0VsZW1lbnRNYXBbcG9zaXRpb24uc2lnbl0pIHtcbiAgICAgICAgZWxlbWVudENvdW50c1t6b2RpYWNFbGVtZW50TWFwW3Bvc2l0aW9uLnNpZ25dXSsrO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gTm9ybWFsaXplIHRvIHByb3BvcnRpb25zXG4gICAgcmV0dXJuIHtcbiAgICAgIEZpcmU6IHRvdGFsUGxhbmV0cyA+IDAgPyBlbGVtZW50Q291bnRzLkZpcmUgLyB0b3RhbFBsYW5ldHMgOiAwLjI1LFxuICAgICAgV2F0ZXI6IHRvdGFsUGxhbmV0cyA+IDAgPyBlbGVtZW50Q291bnRzLldhdGVyIC8gdG90YWxQbGFuZXRzIDogMC4yNSxcbiAgICAgIEVhcnRoOiB0b3RhbFBsYW5ldHMgPiAwID8gZWxlbWVudENvdW50cy5FYXJ0aCAvIHRvdGFsUGxhbmV0cyA6IDAuMjUsXG4gICAgICBBaXI6IHRvdGFsUGxhbmV0cyA+IDAgPyBlbGVtZW50Q291bnRzLkFpciAvIHRvdGFsUGxhbmV0cyA6IDAuMjVcbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBnZXREb21pbmFudEVsZW1lbnQocHJvcGVydGllczogRWxlbWVudGFsUHJvcGVydGllcyk6IEVsZW1lbnQge1xuICAgIHJldHVybiBPYmplY3QuZW50cmllcyhwcm9wZXJ0aWVzKS5yZWR1Y2UoKGEsIGIpID0+IFxuICAgICAgcHJvcGVydGllc1thWzBdIGFzIEVsZW1lbnRdID4gcHJvcGVydGllc1tiWzBdIGFzIEVsZW1lbnRdID8gYSA6IGJcbiAgICApWzBdIGFzIEVsZW1lbnQ7XG4gIH1cblxuICBwcml2YXRlIGdldEN1bHR1cmFsR3VpZGFuY2UoKTogQ3VsdHVyYWxHdWlkYW5jZSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGluY2x1c2l2ZURlc2lnbjogdHJ1ZSxcbiAgICAgIHJlc3BlY3RmdWxSZXByZXNlbnRhdGlvbjogdHJ1ZSxcbiAgICAgIGRpdmVyc2VDdWxpbmFyeVRyYWRpdGlvbnM6IHRydWUsXG4gICAgICBhY2Nlc3NpYmlsaXR5Q29tcGxpYW50OiB0cnVlXG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0UGVyZm9ybWFuY2VHdWlkYW5jZSgpOiBQZXJmb3JtYW5jZUd1aWRhbmNlIHtcbiAgICByZXR1cm4ge1xuICAgICAgbGF6eUxvYWRpbmc6IHRydWUsXG4gICAgICBtZW1vaXphdGlvbjogdHJ1ZSxcbiAgICAgIGNvbnRleHRPcHRpbWl6YXRpb246IHRydWUsXG4gICAgICBidW5kbGVTcGxpdHRpbmc6IHRydWVcbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRGYWxsYmFja0d1aWRhbmNlKCk6IEFzdHJvbG9naWNhbEd1aWRhbmNlIHtcbiAgICByZXR1cm4ge1xuICAgICAgcGxhbmV0YXJ5UG9zaXRpb25zOiB7fSxcbiAgICAgIGRvbWluYW50RWxlbWVudDogJ0ZpcmUnLFxuICAgICAgZWxlbWVudGFsQmFsYW5jZTogeyBGaXJlOiAwLjI1LCBXYXRlcjogMC4yNSwgRWFydGg6IDAuMjUsIEFpcjogMC4yNSB9LFxuICAgICAgY3VsdHVyYWxTZW5zaXRpdml0eTogdGhpcy5nZXRDdWx0dXJhbEd1aWRhbmNlKCksXG4gICAgICBwZXJmb3JtYW5jZU9wdGltaXphdGlvbnM6IHRoaXMuZ2V0UGVyZm9ybWFuY2VHdWlkYW5jZSgpXG4gICAgfTtcbiAgfVxufVxuXG4vKipcbiAqIENvbnZlbmllbmNlIGZ1bmN0aW9uIHRvIGdldCBzdGVlcmluZyBmaWxlIGludGVsbGlnZW5jZSBpbnN0YW5jZVxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0U3RlZXJpbmdGaWxlSW50ZWxsaWdlbmNlKCk6IFN0ZWVyaW5nRmlsZUludGVsbGlnZW5jZSB7XG4gIHJldHVybiBTdGVlcmluZ0ZpbGVJbnRlbGxpZ2VuY2UuZ2V0SW5zdGFuY2UoKTtcbn1cblxuLyoqXG4gKiBIb29rIGZvciBjb21wb25lbnRzIHRvIHVzZSBzdGVlcmluZyBmaWxlIGludGVsbGlnZW5jZVxuICovXG5leHBvcnQgZnVuY3Rpb24gdXNlU3RlZXJpbmdGaWxlSW50ZWxsaWdlbmNlKCkge1xuICBjb25zdCBpbnRlbGxpZ2VuY2UgPSBnZXRTdGVlcmluZ0ZpbGVJbnRlbGxpZ2VuY2UoKTtcbiAgXG4gIHJldHVybiB7XG4gICAgZ2V0R3VpZGFuY2U6IGFzeW5jICgpID0+IGF3YWl0IGludGVsbGlnZW5jZS5nZXRBc3Ryb2xvZ2ljYWxHdWlkYW5jZSgpLFxuICAgIHZhbGlkYXRlRWxlbWVudGFsUHJvcGVydGllczogKHByb3BzOiBFbGVtZW50YWxQcm9wZXJ0aWVzKSA9PiBcbiAgICAgIGludGVsbGlnZW5jZS52YWxpZGF0ZUVsZW1lbnRhbFByb3BlcnRpZXMocHJvcHMpLFxuICAgIGNhbGN1bGF0ZUNvbXBhdGliaWxpdHk6IChzb3VyY2U6IEVsZW1lbnRhbFByb3BlcnRpZXMsIHRhcmdldDogRWxlbWVudGFsUHJvcGVydGllcykgPT4gXG4gICAgICBpbnRlbGxpZ2VuY2UuY2FsY3VsYXRlRWxlbWVudGFsQ29tcGF0aWJpbGl0eShzb3VyY2UsIHRhcmdldCksXG4gICAgZW5oYW5jZURvbWluYW50RWxlbWVudDogKHByb3BzOiBFbGVtZW50YWxQcm9wZXJ0aWVzKSA9PiBcbiAgICAgIGludGVsbGlnZW5jZS5lbmhhbmNlRG9taW5hbnRFbGVtZW50KHByb3BzKSxcbiAgICBnZXRBcmNoaXRlY3R1cmFsR3VpZGFuY2U6ICgpID0+IGludGVsbGlnZW5jZS5nZXRBcmNoaXRlY3R1cmFsR3VpZGFuY2UoKSxcbiAgICBnZXRUZWNobm9sb2d5U3RhY2tHdWlkYW5jZTogKCkgPT4gaW50ZWxsaWdlbmNlLmdldFRlY2hub2xvZ3lTdGFja0d1aWRhbmNlKClcbiAgfTtcbn0iXSwidmVyc2lvbiI6M30=