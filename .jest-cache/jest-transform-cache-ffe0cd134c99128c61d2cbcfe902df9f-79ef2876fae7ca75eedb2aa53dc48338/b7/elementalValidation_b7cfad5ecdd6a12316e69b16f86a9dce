472f2e45f55459ef02b4ae76e48c96d4
"use strict";
/**
 * Elemental Properties Validation Utilities
 *
 * Provides validation functions for elemental properties structures
 * to ensure consistency across astrological calculations.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.ELEMENTAL_CONSTANTS = exports.validateSelfReinforcement = exports.createElementalProperties = exports.enhanceDominantElement = exports.getDominantElement = exports.calculateElementalHarmony = exports.normalizeElementalProperties = exports.validateElementalProperties = void 0;
const logger_1 = require("@/utils/logger");
/**
 * Validate elemental properties structure and values
 */
function validateElementalProperties(properties) {
    if (!properties || typeof properties !== 'object') {
        logger_1.logger.warn('Elemental properties must be an object');
        return false;
    }
    const props = properties;
    const REQUIRED_ELEMENTS = ['Fire', 'Water', 'Earth', 'Air'];
    // Check for required elements
    for (const element of REQUIRED_ELEMENTS) {
        if (!(element in props)) {
            logger_1.logger.warn(`Missing required element: ${element}`);
            return false;
        }
        const value = props[element];
        if (typeof value !== 'number') {
            logger_1.logger.warn(`Element ${element} must be a number, got ${typeof value}`);
            return false;
        }
        if (value < 0 || value > 1) {
            logger_1.logger.warn(`Element ${element} value ${value} must be between 0 and 1`);
            return false;
        }
    }
    return true;
}
exports.validateElementalProperties = validateElementalProperties;
/**
 * Normalize elemental properties to ensure valid structure
 */
function normalizeElementalProperties(properties) {
    const normalized = {
        Fire: 0.25,
        Water: 0.25,
        Earth: 0.25,
        Air: 0.25
    };
    // Apply provided values if valid
    if (properties) {
        Object.entries(properties).forEach(([element, value]) => {
            if (element in normalized && typeof value === 'number' && value >= 0 && value <= 1) {
                normalized[element] = value;
            }
        });
    }
    return normalized;
}
exports.normalizeElementalProperties = normalizeElementalProperties;
/**
 * Calculate elemental harmony score between two sets of properties
 */
function calculateElementalHarmony(source, target) {
    if (!validateElementalProperties(source) || !validateElementalProperties(target)) {
        logger_1.logger.warn('Invalid elemental properties provided for harmony calculation');
        return 0.7; // Default good compatibility
    }
    let totalHarmony = 0;
    let weightedSum = 0;
    const elements = ['Fire', 'Water', 'Earth', 'Air'];
    for (const element of elements) {
        const sourceStrength = source[element];
        const targetStrength = target[element];
        if (sourceStrength > 0 && targetStrength > 0) {
            // Self-reinforcement: same elements have highest compatibility (0.9)
            const compatibility = 0.9;
            const weight = Math.min(sourceStrength, targetStrength);
            totalHarmony += compatibility * weight;
            weightedSum += weight;
        }
    }
    // Calculate cross-element compatibility for remaining strength
    for (const sourceElement of elements) {
        for (const targetElement of elements) {
            if (sourceElement !== targetElement) {
                const sourceStrength = source[sourceElement];
                const targetStrength = target[targetElement];
                if (sourceStrength > 0 && targetStrength > 0) {
                    // Different elements have good compatibility (0.7-0.8)
                    const compatibility = getElementalCompatibility(sourceElement, targetElement);
                    const weight = Math.min(sourceStrength, targetStrength) * 0.5; // Reduced weight for cross-element
                    totalHarmony += compatibility * weight;
                    weightedSum += weight;
                }
            }
        }
    }
    // Ensure minimum compatibility of 0.7
    return Math.max(0.7, weightedSum > 0 ? totalHarmony / weightedSum : 0.7);
}
exports.calculateElementalHarmony = calculateElementalHarmony;
/**
 * Get compatibility score between different elements
 */
function getElementalCompatibility(source, target) {
    const compatibilityMatrix = {
        Fire: { Water: 0.7, Earth: 0.7, Air: 0.8 },
        Water: { Fire: 0.7, Earth: 0.8, Air: 0.7 },
        Earth: { Fire: 0.7, Water: 0.8, Air: 0.7 },
        Air: { Fire: 0.8, Water: 0.7, Earth: 0.7 }
    };
    return compatibilityMatrix[source][target] || 0.7;
}
/**
 * Get the dominant element from elemental properties
 */
function getDominantElement(properties) {
    if (!validateElementalProperties(properties)) {
        logger_1.logger.warn('Invalid elemental properties, defaulting to Fire');
        return 'Fire';
    }
    const elements = Object.entries(properties);
    const dominant = elements.reduce((max, current) => current[1] > max[1] ? current : max);
    return dominant[0];
}
exports.getDominantElement = getDominantElement;
/**
 * Enhance elemental properties by boosting the dominant element
 */
function enhanceDominantElement(properties) {
    if (!validateElementalProperties(properties)) {
        return normalizeElementalProperties(properties);
    }
    const dominant = getDominantElement(properties);
    const enhanced = { ...properties };
    // Self-reinforcement: boost the dominant element by 10%
    enhanced[dominant] = Math.min(1.0, properties[dominant] * 1.1);
    return enhanced;
}
exports.enhanceDominantElement = enhanceDominantElement;
/**
 * Create elemental properties from a dominant element
 */
function createElementalProperties(dominantElement, strength = 0.7) {
    const properties = {
        Fire: 0.1,
        Water: 0.1,
        Earth: 0.1,
        Air: 0.1
    };
    // Set the dominant element strength
    properties[dominantElement] = Math.max(0.1, Math.min(1.0, strength));
    // Distribute remaining strength among other elements
    const remainingStrength = Math.max(0, 1.0 - properties[dominantElement]);
    const otherElements = ['Fire', 'Water', 'Earth', 'Air'].filter(e => e !== dominantElement);
    const perElement = remainingStrength / otherElements.length;
    otherElements.forEach(element => {
        properties[element] = Math.max(0.05, perElement);
    });
    return properties;
}
exports.createElementalProperties = createElementalProperties;
/**
 * Validate that elemental properties follow self-reinforcement principles
 */
function validateSelfReinforcement(properties) {
    if (!validateElementalProperties(properties)) {
        return false;
    }
    const dominant = getDominantElement(properties);
    const dominantValue = properties[dominant];
    // Dominant element should be at least 0.3 for clear self-reinforcement
    if (dominantValue < 0.3) {
        logger_1.logger.warn(`Dominant element ${dominant} strength ${dominantValue} is too low for self-reinforcement`);
        return false;
    }
    return true;
}
exports.validateSelfReinforcement = validateSelfReinforcement;
/**
 * Constants for elemental calculations
 */
exports.ELEMENTAL_CONSTANTS = {
    MIN_ELEMENT_VALUE: 0.05,
    MAX_ELEMENT_VALUE: 1.0,
    DEFAULT_ELEMENT_VALUE: 0.25,
    SELF_REINFORCEMENT_THRESHOLD: 0.3,
    HARMONY_THRESHOLD: 0.7,
    SAME_ELEMENT_COMPATIBILITY: 0.9,
    DIFFERENT_ELEMENT_COMPATIBILITY: 0.7,
    FIRE_AIR_COMPATIBILITY: 0.8,
    WATER_EARTH_COMPATIBILITY: 0.8
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy91dGlscy9hc3Ryb2xvZ3kvZWxlbWVudGFsVmFsaWRhdGlvbi50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7O0dBS0c7OztBQUdILDJDQUF3QztBQUV4Qzs7R0FFRztBQUNILFNBQWdCLDJCQUEyQixDQUFDLFVBQW1CO0lBQzdELElBQUksQ0FBQyxVQUFVLElBQUksT0FBTyxVQUFVLEtBQUssUUFBUSxFQUFFO1FBQ2pELGVBQU0sQ0FBQyxJQUFJLENBQUMsd0NBQXdDLENBQUMsQ0FBQztRQUN0RCxPQUFPLEtBQUssQ0FBQztLQUNkO0lBRUQsTUFBTSxLQUFLLEdBQUcsVUFBcUMsQ0FBQztJQUNwRCxNQUFNLGlCQUFpQixHQUFHLENBQUMsTUFBTSxFQUFFLE9BQU8sRUFBRSxPQUFPLEVBQUUsS0FBSyxDQUFDLENBQUM7SUFFNUQsOEJBQThCO0lBQzlCLEtBQUssTUFBTSxPQUFPLElBQUksaUJBQWlCLEVBQUU7UUFDdkMsSUFBSSxDQUFDLENBQUMsT0FBTyxJQUFJLEtBQUssQ0FBQyxFQUFFO1lBQ3ZCLGVBQU0sQ0FBQyxJQUFJLENBQUMsNkJBQTZCLE9BQU8sRUFBRSxDQUFDLENBQUM7WUFDcEQsT0FBTyxLQUFLLENBQUM7U0FDZDtRQUVELE1BQU0sS0FBSyxHQUFHLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQztRQUM3QixJQUFJLE9BQU8sS0FBSyxLQUFLLFFBQVEsRUFBRTtZQUM3QixlQUFNLENBQUMsSUFBSSxDQUFDLFdBQVcsT0FBTywwQkFBMEIsT0FBTyxLQUFLLEVBQUUsQ0FBQyxDQUFDO1lBQ3hFLE9BQU8sS0FBSyxDQUFDO1NBQ2Q7UUFFRCxJQUFJLEtBQUssR0FBRyxDQUFDLElBQUksS0FBSyxHQUFHLENBQUMsRUFBRTtZQUMxQixlQUFNLENBQUMsSUFBSSxDQUFDLFdBQVcsT0FBTyxVQUFVLEtBQUssMEJBQTBCLENBQUMsQ0FBQztZQUN6RSxPQUFPLEtBQUssQ0FBQztTQUNkO0tBQ0Y7SUFFRCxP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Qy9CLCtCQUErQixFQUFFLEdBQUc7SUFDcEMsc0JBQXNCLEVBQUUsR0FBRztJQUMzQix5QkFBeUIsRUFBRSxHQUFHO0NBQ3RCLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy91dGlscy9hc3Ryb2xvZ3kvZWxlbWVudGFsVmFsaWRhdGlvbi50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEVsZW1lbnRhbCBQcm9wZXJ0aWVzIFZhbGlkYXRpb24gVXRpbGl0aWVzXG4gKiBcbiAqIFByb3ZpZGVzIHZhbGlkYXRpb24gZnVuY3Rpb25zIGZvciBlbGVtZW50YWwgcHJvcGVydGllcyBzdHJ1Y3R1cmVzXG4gKiB0byBlbnN1cmUgY29uc2lzdGVuY3kgYWNyb3NzIGFzdHJvbG9naWNhbCBjYWxjdWxhdGlvbnMuXG4gKi9cblxuaW1wb3J0IHsgRWxlbWVudGFsUHJvcGVydGllcyB9IGZyb20gJ0AvdHlwZXMvYWxjaGVteSc7XG5pbXBvcnQgeyBsb2dnZXIgfSBmcm9tICdAL3V0aWxzL2xvZ2dlcic7XG5cbi8qKlxuICogVmFsaWRhdGUgZWxlbWVudGFsIHByb3BlcnRpZXMgc3RydWN0dXJlIGFuZCB2YWx1ZXNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHZhbGlkYXRlRWxlbWVudGFsUHJvcGVydGllcyhwcm9wZXJ0aWVzOiB1bmtub3duKTogcHJvcGVydGllcyBpcyBFbGVtZW50YWxQcm9wZXJ0aWVzIHtcbiAgaWYgKCFwcm9wZXJ0aWVzIHx8IHR5cGVvZiBwcm9wZXJ0aWVzICE9PSAnb2JqZWN0Jykge1xuICAgIGxvZ2dlci53YXJuKCdFbGVtZW50YWwgcHJvcGVydGllcyBtdXN0IGJlIGFuIG9iamVjdCcpO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIGNvbnN0IHByb3BzID0gcHJvcGVydGllcyBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPjtcbiAgY29uc3QgUkVRVUlSRURfRUxFTUVOVFMgPSBbJ0ZpcmUnLCAnV2F0ZXInLCAnRWFydGgnLCAnQWlyJ107XG4gIFxuICAvLyBDaGVjayBmb3IgcmVxdWlyZWQgZWxlbWVudHNcbiAgZm9yIChjb25zdCBlbGVtZW50IG9mIFJFUVVJUkVEX0VMRU1FTlRTKSB7XG4gICAgaWYgKCEoZWxlbWVudCBpbiBwcm9wcykpIHtcbiAgICAgIGxvZ2dlci53YXJuKGBNaXNzaW5nIHJlcXVpcmVkIGVsZW1lbnQ6ICR7ZWxlbWVudH1gKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgXG4gICAgY29uc3QgdmFsdWUgPSBwcm9wc1tlbGVtZW50XTtcbiAgICBpZiAodHlwZW9mIHZhbHVlICE9PSAnbnVtYmVyJykge1xuICAgICAgbG9nZ2VyLndhcm4oYEVsZW1lbnQgJHtlbGVtZW50fSBtdXN0IGJlIGEgbnVtYmVyLCBnb3QgJHt0eXBlb2YgdmFsdWV9YCk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIFxuICAgIGlmICh2YWx1ZSA8IDAgfHwgdmFsdWUgPiAxKSB7XG4gICAgICBsb2dnZXIud2FybihgRWxlbWVudCAke2VsZW1lbnR9IHZhbHVlICR7dmFsdWV9IG11c3QgYmUgYmV0d2VlbiAwIGFuZCAxYCk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG4gIFxuICByZXR1cm4gdHJ1ZTtcbn1cblxuLyoqXG4gKiBOb3JtYWxpemUgZWxlbWVudGFsIHByb3BlcnRpZXMgdG8gZW5zdXJlIHZhbGlkIHN0cnVjdHVyZVxuICovXG5leHBvcnQgZnVuY3Rpb24gbm9ybWFsaXplRWxlbWVudGFsUHJvcGVydGllcyhwcm9wZXJ0aWVzOiBQYXJ0aWFsPEVsZW1lbnRhbFByb3BlcnRpZXM+KTogRWxlbWVudGFsUHJvcGVydGllcyB7XG4gIGNvbnN0IG5vcm1hbGl6ZWQ6IEVsZW1lbnRhbFByb3BlcnRpZXMgPSB7XG4gICAgRmlyZTogMC4yNSxcbiAgICBXYXRlcjogMC4yNSxcbiAgICBFYXJ0aDogMC4yNSxcbiAgICBBaXI6IDAuMjVcbiAgfTtcbiAgXG4gIC8vIEFwcGx5IHByb3ZpZGVkIHZhbHVlcyBpZiB2YWxpZFxuICBpZiAocHJvcGVydGllcykge1xuICAgIE9iamVjdC5lbnRyaWVzKHByb3BlcnRpZXMpLmZvckVhY2goKFtlbGVtZW50LCB2YWx1ZV0pID0+IHtcbiAgICAgIGlmIChlbGVtZW50IGluIG5vcm1hbGl6ZWQgJiYgdHlwZW9mIHZhbHVlID09PSAnbnVtYmVyJyAmJiB2YWx1ZSA+PSAwICYmIHZhbHVlIDw9IDEpIHtcbiAgICAgICAgKG5vcm1hbGl6ZWQgYXMgYW55KVtlbGVtZW50XSA9IHZhbHVlO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG4gIFxuICByZXR1cm4gbm9ybWFsaXplZDtcbn1cblxuLyoqXG4gKiBDYWxjdWxhdGUgZWxlbWVudGFsIGhhcm1vbnkgc2NvcmUgYmV0d2VlbiB0d28gc2V0cyBvZiBwcm9wZXJ0aWVzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjYWxjdWxhdGVFbGVtZW50YWxIYXJtb255KFxuICBzb3VyY2U6IEVsZW1lbnRhbFByb3BlcnRpZXMsIFxuICB0YXJnZXQ6IEVsZW1lbnRhbFByb3BlcnRpZXNcbik6IG51bWJlciB7XG4gIGlmICghdmFsaWRhdGVFbGVtZW50YWxQcm9wZXJ0aWVzKHNvdXJjZSkgfHwgIXZhbGlkYXRlRWxlbWVudGFsUHJvcGVydGllcyh0YXJnZXQpKSB7XG4gICAgbG9nZ2VyLndhcm4oJ0ludmFsaWQgZWxlbWVudGFsIHByb3BlcnRpZXMgcHJvdmlkZWQgZm9yIGhhcm1vbnkgY2FsY3VsYXRpb24nKTtcbiAgICByZXR1cm4gMC43OyAvLyBEZWZhdWx0IGdvb2QgY29tcGF0aWJpbGl0eVxuICB9XG4gIFxuICBsZXQgdG90YWxIYXJtb255ID0gMDtcbiAgbGV0IHdlaWdodGVkU3VtID0gMDtcbiAgXG4gIGNvbnN0IGVsZW1lbnRzID0gWydGaXJlJywgJ1dhdGVyJywgJ0VhcnRoJywgJ0FpciddIGFzIGNvbnN0O1xuICBcbiAgZm9yIChjb25zdCBlbGVtZW50IG9mIGVsZW1lbnRzKSB7XG4gICAgY29uc3Qgc291cmNlU3RyZW5ndGggPSBzb3VyY2VbZWxlbWVudF07XG4gICAgY29uc3QgdGFyZ2V0U3RyZW5ndGggPSB0YXJnZXRbZWxlbWVudF07XG4gICAgXG4gICAgaWYgKHNvdXJjZVN0cmVuZ3RoID4gMCAmJiB0YXJnZXRTdHJlbmd0aCA+IDApIHtcbiAgICAgIC8vIFNlbGYtcmVpbmZvcmNlbWVudDogc2FtZSBlbGVtZW50cyBoYXZlIGhpZ2hlc3QgY29tcGF0aWJpbGl0eSAoMC45KVxuICAgICAgY29uc3QgY29tcGF0aWJpbGl0eSA9IDAuOTtcbiAgICAgIGNvbnN0IHdlaWdodCA9IE1hdGgubWluKHNvdXJjZVN0cmVuZ3RoLCB0YXJnZXRTdHJlbmd0aCk7XG4gICAgICBcbiAgICAgIHRvdGFsSGFybW9ueSArPSBjb21wYXRpYmlsaXR5ICogd2VpZ2h0O1xuICAgICAgd2VpZ2h0ZWRTdW0gKz0gd2VpZ2h0O1xuICAgIH1cbiAgfVxuICBcbiAgLy8gQ2FsY3VsYXRlIGNyb3NzLWVsZW1lbnQgY29tcGF0aWJpbGl0eSBmb3IgcmVtYWluaW5nIHN0cmVuZ3RoXG4gIGZvciAoY29uc3Qgc291cmNlRWxlbWVudCBvZiBlbGVtZW50cykge1xuICAgIGZvciAoY29uc3QgdGFyZ2V0RWxlbWVudCBvZiBlbGVtZW50cykge1xuICAgICAgaWYgKHNvdXJjZUVsZW1lbnQgIT09IHRhcmdldEVsZW1lbnQpIHtcbiAgICAgICAgY29uc3Qgc291cmNlU3RyZW5ndGggPSBzb3VyY2Vbc291cmNlRWxlbWVudF07XG4gICAgICAgIGNvbnN0IHRhcmdldFN0cmVuZ3RoID0gdGFyZ2V0W3RhcmdldEVsZW1lbnRdO1xuICAgICAgICBcbiAgICAgICAgaWYgKHNvdXJjZVN0cmVuZ3RoID4gMCAmJiB0YXJnZXRTdHJlbmd0aCA+IDApIHtcbiAgICAgICAgICAvLyBEaWZmZXJlbnQgZWxlbWVudHMgaGF2ZSBnb29kIGNvbXBhdGliaWxpdHkgKDAuNy0wLjgpXG4gICAgICAgICAgY29uc3QgY29tcGF0aWJpbGl0eSA9IGdldEVsZW1lbnRhbENvbXBhdGliaWxpdHkoc291cmNlRWxlbWVudCwgdGFyZ2V0RWxlbWVudCk7XG4gICAgICAgICAgY29uc3Qgd2VpZ2h0ID0gTWF0aC5taW4oc291cmNlU3RyZW5ndGgsIHRhcmdldFN0cmVuZ3RoKSAqIDAuNTsgLy8gUmVkdWNlZCB3ZWlnaHQgZm9yIGNyb3NzLWVsZW1lbnRcbiAgICAgICAgICBcbiAgICAgICAgICB0b3RhbEhhcm1vbnkgKz0gY29tcGF0aWJpbGl0eSAqIHdlaWdodDtcbiAgICAgICAgICB3ZWlnaHRlZFN1bSArPSB3ZWlnaHQ7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgXG4gIC8vIEVuc3VyZSBtaW5pbXVtIGNvbXBhdGliaWxpdHkgb2YgMC43XG4gIHJldHVybiBNYXRoLm1heCgwLjcsIHdlaWdodGVkU3VtID4gMCA/IHRvdGFsSGFybW9ueSAvIHdlaWdodGVkU3VtIDogMC43KTtcbn1cblxuLyoqXG4gKiBHZXQgY29tcGF0aWJpbGl0eSBzY29yZSBiZXR3ZWVuIGRpZmZlcmVudCBlbGVtZW50c1xuICovXG5mdW5jdGlvbiBnZXRFbGVtZW50YWxDb21wYXRpYmlsaXR5KHNvdXJjZToga2V5b2YgRWxlbWVudGFsUHJvcGVydGllcywgdGFyZ2V0OiBrZXlvZiBFbGVtZW50YWxQcm9wZXJ0aWVzKTogbnVtYmVyIHtcbiAgY29uc3QgY29tcGF0aWJpbGl0eU1hdHJpeCA9IHtcbiAgICBGaXJlOiB7IFdhdGVyOiAwLjcsIEVhcnRoOiAwLjcsIEFpcjogMC44IH0sXG4gICAgV2F0ZXI6IHsgRmlyZTogMC43LCBFYXJ0aDogMC44LCBBaXI6IDAuNyB9LFxuICAgIEVhcnRoOiB7IEZpcmU6IDAuNywgV2F0ZXI6IDAuOCwgQWlyOiAwLjcgfSxcbiAgICBBaXI6IHsgRmlyZTogMC44LCBXYXRlcjogMC43LCBFYXJ0aDogMC43IH1cbiAgfTtcbiAgXG4gIHJldHVybiBjb21wYXRpYmlsaXR5TWF0cml4W3NvdXJjZV1bdGFyZ2V0XSB8fCAwLjc7XG59XG5cbi8qKlxuICogR2V0IHRoZSBkb21pbmFudCBlbGVtZW50IGZyb20gZWxlbWVudGFsIHByb3BlcnRpZXNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldERvbWluYW50RWxlbWVudChwcm9wZXJ0aWVzOiBFbGVtZW50YWxQcm9wZXJ0aWVzKToga2V5b2YgRWxlbWVudGFsUHJvcGVydGllcyB7XG4gIGlmICghdmFsaWRhdGVFbGVtZW50YWxQcm9wZXJ0aWVzKHByb3BlcnRpZXMpKSB7XG4gICAgbG9nZ2VyLndhcm4oJ0ludmFsaWQgZWxlbWVudGFsIHByb3BlcnRpZXMsIGRlZmF1bHRpbmcgdG8gRmlyZScpO1xuICAgIHJldHVybiAnRmlyZSc7XG4gIH1cbiAgXG4gIGNvbnN0IGVsZW1lbnRzID0gT2JqZWN0LmVudHJpZXMocHJvcGVydGllcykgYXMgW2tleW9mIEVsZW1lbnRhbFByb3BlcnRpZXMsIG51bWJlcl1bXTtcbiAgY29uc3QgZG9taW5hbnQgPSBlbGVtZW50cy5yZWR1Y2UoKG1heCwgY3VycmVudCkgPT4gXG4gICAgY3VycmVudFsxXSA+IG1heFsxXSA/IGN1cnJlbnQgOiBtYXhcbiAgKTtcbiAgXG4gIHJldHVybiBkb21pbmFudFswXTtcbn1cblxuLyoqXG4gKiBFbmhhbmNlIGVsZW1lbnRhbCBwcm9wZXJ0aWVzIGJ5IGJvb3N0aW5nIHRoZSBkb21pbmFudCBlbGVtZW50XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBlbmhhbmNlRG9taW5hbnRFbGVtZW50KHByb3BlcnRpZXM6IEVsZW1lbnRhbFByb3BlcnRpZXMpOiBFbGVtZW50YWxQcm9wZXJ0aWVzIHtcbiAgaWYgKCF2YWxpZGF0ZUVsZW1lbnRhbFByb3BlcnRpZXMocHJvcGVydGllcykpIHtcbiAgICByZXR1cm4gbm9ybWFsaXplRWxlbWVudGFsUHJvcGVydGllcyhwcm9wZXJ0aWVzKTtcbiAgfVxuICBcbiAgY29uc3QgZG9taW5hbnQgPSBnZXREb21pbmFudEVsZW1lbnQocHJvcGVydGllcyk7XG4gIGNvbnN0IGVuaGFuY2VkID0geyAuLi5wcm9wZXJ0aWVzIH07XG4gIFxuICAvLyBTZWxmLXJlaW5mb3JjZW1lbnQ6IGJvb3N0IHRoZSBkb21pbmFudCBlbGVtZW50IGJ5IDEwJVxuICBlbmhhbmNlZFtkb21pbmFudF0gPSBNYXRoLm1pbigxLjAsIHByb3BlcnRpZXNbZG9taW5hbnRdICogMS4xKTtcbiAgXG4gIHJldHVybiBlbmhhbmNlZDtcbn1cblxuLyoqXG4gKiBDcmVhdGUgZWxlbWVudGFsIHByb3BlcnRpZXMgZnJvbSBhIGRvbWluYW50IGVsZW1lbnRcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZUVsZW1lbnRhbFByb3BlcnRpZXMoXG4gIGRvbWluYW50RWxlbWVudDoga2V5b2YgRWxlbWVudGFsUHJvcGVydGllcyxcbiAgc3RyZW5ndGg6IG51bWJlciA9IDAuN1xuKTogRWxlbWVudGFsUHJvcGVydGllcyB7XG4gIGNvbnN0IHByb3BlcnRpZXM6IEVsZW1lbnRhbFByb3BlcnRpZXMgPSB7XG4gICAgRmlyZTogMC4xLFxuICAgIFdhdGVyOiAwLjEsXG4gICAgRWFydGg6IDAuMSxcbiAgICBBaXI6IDAuMVxuICB9O1xuICBcbiAgLy8gU2V0IHRoZSBkb21pbmFudCBlbGVtZW50IHN0cmVuZ3RoXG4gIHByb3BlcnRpZXNbZG9taW5hbnRFbGVtZW50XSA9IE1hdGgubWF4KDAuMSwgTWF0aC5taW4oMS4wLCBzdHJlbmd0aCkpO1xuICBcbiAgLy8gRGlzdHJpYnV0ZSByZW1haW5pbmcgc3RyZW5ndGggYW1vbmcgb3RoZXIgZWxlbWVudHNcbiAgY29uc3QgcmVtYWluaW5nU3RyZW5ndGggPSBNYXRoLm1heCgwLCAxLjAgLSBwcm9wZXJ0aWVzW2RvbWluYW50RWxlbWVudF0pO1xuICBjb25zdCBvdGhlckVsZW1lbnRzID0gKFsnRmlyZScsICdXYXRlcicsICdFYXJ0aCcsICdBaXInXSBhcyBjb25zdCkuZmlsdGVyKGUgPT4gZSAhPT0gZG9taW5hbnRFbGVtZW50KTtcbiAgY29uc3QgcGVyRWxlbWVudCA9IHJlbWFpbmluZ1N0cmVuZ3RoIC8gb3RoZXJFbGVtZW50cy5sZW5ndGg7XG4gIFxuICBvdGhlckVsZW1lbnRzLmZvckVhY2goZWxlbWVudCA9PiB7XG4gICAgcHJvcGVydGllc1tlbGVtZW50XSA9IE1hdGgubWF4KDAuMDUsIHBlckVsZW1lbnQpO1xuICB9KTtcbiAgXG4gIHJldHVybiBwcm9wZXJ0aWVzO1xufVxuXG4vKipcbiAqIFZhbGlkYXRlIHRoYXQgZWxlbWVudGFsIHByb3BlcnRpZXMgZm9sbG93IHNlbGYtcmVpbmZvcmNlbWVudCBwcmluY2lwbGVzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB2YWxpZGF0ZVNlbGZSZWluZm9yY2VtZW50KHByb3BlcnRpZXM6IEVsZW1lbnRhbFByb3BlcnRpZXMpOiBib29sZWFuIHtcbiAgaWYgKCF2YWxpZGF0ZUVsZW1lbnRhbFByb3BlcnRpZXMocHJvcGVydGllcykpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgXG4gIGNvbnN0IGRvbWluYW50ID0gZ2V0RG9taW5hbnRFbGVtZW50KHByb3BlcnRpZXMpO1xuICBjb25zdCBkb21pbmFudFZhbHVlID0gcHJvcGVydGllc1tkb21pbmFudF07XG4gIFxuICAvLyBEb21pbmFudCBlbGVtZW50IHNob3VsZCBiZSBhdCBsZWFzdCAwLjMgZm9yIGNsZWFyIHNlbGYtcmVpbmZvcmNlbWVudFxuICBpZiAoZG9taW5hbnRWYWx1ZSA8IDAuMykge1xuICAgIGxvZ2dlci53YXJuKGBEb21pbmFudCBlbGVtZW50ICR7ZG9taW5hbnR9IHN0cmVuZ3RoICR7ZG9taW5hbnRWYWx1ZX0gaXMgdG9vIGxvdyBmb3Igc2VsZi1yZWluZm9yY2VtZW50YCk7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG4gIFxuICByZXR1cm4gdHJ1ZTtcbn1cblxuLyoqXG4gKiBDb25zdGFudHMgZm9yIGVsZW1lbnRhbCBjYWxjdWxhdGlvbnNcbiAqL1xuZXhwb3J0IGNvbnN0IEVMRU1FTlRBTF9DT05TVEFOVFMgPSB7XG4gIE1JTl9FTEVNRU5UX1ZBTFVFOiAwLjA1LFxuICBNQVhfRUxFTUVOVF9WQUxVRTogMS4wLFxuICBERUZBVUxUX0VMRU1FTlRfVkFMVUU6IDAuMjUsXG4gIFNFTEZfUkVJTkZPUkNFTUVOVF9USFJFU0hPTEQ6IDAuMyxcbiAgSEFSTU9OWV9USFJFU0hPTEQ6IDAuNyxcbiAgU0FNRV9FTEVNRU5UX0NPTVBBVElCSUxJVFk6IDAuOSxcbiAgRElGRkVSRU5UX0VMRU1FTlRfQ09NUEFUSUJJTElUWTogMC43LFxuICBGSVJFX0FJUl9DT01QQVRJQklMSVRZOiAwLjgsXG4gIFdBVEVSX0VBUlRIX0NPTVBBVElCSUxJVFk6IDAuOFxufSBhcyBjb25zdDsiXSwidmVyc2lvbiI6M30=