9f58c90337d84bc85efbadabdf485c57
"use strict";
/**
 * Monica/Kalchm Constant Calculation System
 *
 * This module implements the core alchemical calculations for the Kalchm and Monica Constant system,
 * demonstrating the fundamental thermodynamic metrics used in astrological food recommendations.
 *
 * Based on: docs/notebooks/Kalchm_Monica_Constant_Calculations.ipynb
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.MonicaKalchmCalculations = exports.performEnhancedAnalysis = exports.calculateKalchmHarmony = exports.calculateMomentMonicaConstant = exports.calculateMonicaKalchmCompatibility = exports.calculateThermodynamicMetrics = exports.elementalToAlchemical = exports.calculateMonicaConstant = exports.calculateKAlchm = exports.calculateGregsEnergy = exports.calculateReactivity = exports.calculateEntropy = exports.calculateHeat = void 0;
// ========== CORE CALCULATION FUNCTIONS ==========
/**
 * Calculate Heat: Measures active energy (Spirit & Fire vs all other properties)
 * Formula: Heat = (Spirit² + Fire²) / (Substance + Essence + Matter + Water + Air + Earth)²
 */
function calculateHeat(spirit, fire, substance, essence, matter, water, air, earth) {
    const numerator = Math.pow(spirit, 2) + Math.pow(fire, 2);
    const denominator = Math.pow(substance + essence + matter + water + air + earth, 2);
    return denominator > 0 ? numerator / denominator : 0;
}
exports.calculateHeat = calculateHeat;
/**
 * Calculate Entropy: Measures disorder (active properties vs passive properties)
 * Formula: Entropy = (Spirit² + Substance² + Fire² + Air²) / (Essence + Matter + Earth + Water)²
 */
function calculateEntropy(spirit, substance, fire, air, essence, matter, earth, water) {
    const numerator = Math.pow(spirit, 2) + Math.pow(substance, 2) + Math.pow(fire, 2) + Math.pow(air, 2);
    const denominator = Math.pow(essence + matter + earth + water, 2);
    return denominator > 0 ? numerator / denominator : 0;
}
exports.calculateEntropy = calculateEntropy;
/**
 * Calculate Reactivity: Measures potential for change (volatile properties vs stable properties)
 * Formula: Reactivity = (Spirit² + Substance² + Essence² + Fire² + Air² + Water²) / (Matter + Earth)²
 */
function calculateReactivity(spirit, substance, essence, fire, air, water, matter, earth) {
    const numerator = Math.pow(spirit, 2) + Math.pow(substance, 2) + Math.pow(essence, 2) +
        Math.pow(fire, 2) + Math.pow(air, 2) + Math.pow(water, 2);
    const denominator = Math.pow(matter + earth, 2);
    return denominator > 0 ? numerator / denominator : 0;
}
exports.calculateReactivity = calculateReactivity;
/**
 * Calculate Greg's Energy: Overall energy balance
 * Formula: Greg's Energy = Heat - (Entropy × Reactivity)
 */
function calculateGregsEnergy(heat, entropy, reactivity) {
    return heat - (entropy * reactivity);
}
exports.calculateGregsEnergy = calculateGregsEnergy;
/**
 * Calculate Kalchm (K_alchm): Alchemical equilibrium constant
 * Formula: K_alchm = (Spirit^Spirit × Essence^Essence) / (Matter^Matter × Substance^Substance)
 */
function calculateKAlchm(spirit, essence, matter, substance) {
    // Ensure positive values and handle edge cases
    const safeSpirit = Math.max(0.01, spirit);
    const safeEssence = Math.max(0.01, essence);
    const safeMatter = Math.max(0.01, matter);
    const safeSubstance = Math.max(0.01, substance);
    const numerator = Math.pow(safeSpirit, safeSpirit) * Math.pow(safeEssence, safeEssence);
    const denominator = Math.pow(safeMatter, safeMatter) * Math.pow(safeSubstance, safeSubstance);
    return denominator > 0 ? numerator / denominator : 1;
}
exports.calculateKAlchm = calculateKAlchm;
/**
 * Calculate Monica Constant: Dynamic system constant relating energy to equilibrium
 * Formula: M = -Greg's Energy / (Reactivity × ln(K_alchm))
 */
function calculateMonicaConstant(gregsEnergy, reactivity, K_alchm) {
    const ln_K = Math.log(K_alchm);
    if (K_alchm > 0 && ln_K !== 0 && reactivity !== 0) {
        return -gregsEnergy / (reactivity * ln_K);
    }
    else {
        return 1.0; // Default neutral value
    }
}
exports.calculateMonicaConstant = calculateMonicaConstant;
// ========== HELPER FUNCTIONS ==========
/**
 * Convert elemental properties to default alchemical properties
 * This provides a reasonable mapping when alchemical properties aren't available
 */
function elementalToAlchemical(elemental) {
    return {
        Spirit: elemental.Fire + (elemental.Air * 0.5),
        Essence: elemental.Water + (elemental.Air * 0.5),
        Matter: elemental.Earth + (elemental.Water * 0.3),
        Substance: elemental.Earth + (elemental.Fire * 0.2) // Foundation, structure
    };
}
exports.elementalToAlchemical = elementalToAlchemical;
/**
 * Calculate complete thermodynamic metrics from properties
 */
function calculateThermodynamicMetrics(alchemical, elemental) {
    const { Spirit, Essence, Matter, Substance } = alchemical;
    const { Fire, Water, Air, Earth } = elemental;
    const heat = calculateHeat(Spirit, Fire, Substance, Essence, Matter, Water, Air, Earth);
    const entropy = calculateEntropy(Spirit, Substance, Fire, Air, Essence, Matter, Earth, Water);
    const reactivity = calculateReactivity(Spirit, Substance, Essence, Fire, Air, Water, Matter, Earth);
    const gregsEnergy = calculateGregsEnergy(heat, entropy, reactivity);
    const kalchm = calculateKAlchm(Spirit, Essence, Matter, Substance);
    const monica = calculateMonicaConstant(gregsEnergy, reactivity, kalchm);
    return {
        heat,
        entropy,
        reactivity,
        gregsEnergy,
        kalchm,
        monica
    };
}
exports.calculateThermodynamicMetrics = calculateThermodynamicMetrics;
/**
 * Calculate compatibility between two sets of properties using Monica/Kalchm metrics
 */
function calculateMonicaKalchmCompatibility(properties1, properties2) {
    // Convert elemental to alchemical if needed
    const alchemical1 = properties1.alchemical || elementalToAlchemical(properties1.elemental);
    const alchemical2 = properties2.alchemical || elementalToAlchemical(properties2.elemental);
    // Calculate thermodynamic metrics for both
    const metrics1 = calculateThermodynamicMetrics(alchemical1, properties1.elemental);
    const metrics2 = calculateThermodynamicMetrics(alchemical2, properties2.elemental);
    // Calculate compatibility based on Monica constant similarity
    const monicaDiff = Math.abs(metrics1.monica - metrics2.monica);
    const kalchmRatio = Math.min(metrics1.kalchm, metrics2.kalchm) / Math.max(metrics1.kalchm, metrics2.kalchm);
    const energyHarmony = 1 - Math.abs(metrics1.gregsEnergy - metrics2.gregsEnergy) / 10; // Normalize to 0-1
    // Weighted compatibility score
    const compatibility = ((1 - Math.min(monicaDiff / 5, 1)) * 0.4 + // Monica similarity (40%)
        kalchmRatio * 0.3 + // Kalchm harmony (30%)
        Math.max(0, energyHarmony) * 0.3 // Energy harmony (30%)
    );
    return Math.max(0, Math.min(1, compatibility));
}
exports.calculateMonicaKalchmCompatibility = calculateMonicaKalchmCompatibility;
/**
 * Calculate moment Monica constant from current elemental state
 * Used for real-time compatibility calculations
 */
function calculateMomentMonicaConstant(elementalProfile) {
    const alchemical = elementalToAlchemical(elementalProfile);
    const metrics = calculateThermodynamicMetrics(alchemical, elementalProfile);
    return metrics.monica;
}
exports.calculateMomentMonicaConstant = calculateMomentMonicaConstant;
/**
 * Calculate Kalchm harmony for multiple items (e.g., cuisine combinations)
 */
function calculateKalchmHarmony(items) {
    if (items.length === 0)
        return 0.5;
    if (items.length === 1)
        return 0.8;
    let totalHarmony = 0;
    let comparisons = 0;
    // Compare each item with every other item
    for (let i = 0; i < items.length; i++) {
        for (let j = i + 1; j < items.length; j++) {
            const compatibility = calculateMonicaKalchmCompatibility(items[i], items[j]);
            totalHarmony += compatibility;
            comparisons++;
        }
    }
    return comparisons > 0 ? totalHarmony / comparisons : 0.5;
}
exports.calculateKalchmHarmony = calculateKalchmHarmony;
/**
 * Enhanced analysis with confidence scoring
 */
function performEnhancedAnalysis(item, referenceProfile) {
    const alchemical = item.alchemical || elementalToAlchemical(item.elemental);
    const thermodynamicMetrics = calculateThermodynamicMetrics(alchemical, item.elemental);
    const compatibilityScore = calculateMonicaKalchmCompatibility({ alchemical, elemental: item.elemental }, { elemental: referenceProfile });
    // Calculate confidence based on metric stability
    const confidence = Math.min(1, Math.max(0.3, 1 - (Math.abs(thermodynamicMetrics.monica - 1) / 5) // Higher confidence when Monica is closer to 1
    ));
    return {
        alchemicalProperties: alchemical,
        elementalProperties: item.elemental,
        thermodynamicMetrics,
        compatibilityScore,
        confidence
    };
}
exports.performEnhancedAnalysis = performEnhancedAnalysis;
// ========== EXPORT DEFAULT CALCULATION SUITE ==========
exports.MonicaKalchmCalculations = {
    calculateHeat,
    calculateEntropy,
    calculateReactivity,
    calculateGregsEnergy,
    calculateKAlchm,
    calculateMonicaConstant,
    calculateThermodynamicMetrics,
    calculateMonicaKalchmCompatibility,
    calculateMomentMonicaConstant,
    calculateKalchmHarmony,
    performEnhancedAnalysis,
    elementalToAlchemical
};
exports.default = exports.MonicaKalchmCalculations;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy91dGlscy9tb25pY2FLYWxjaG1DYWxjdWxhdGlvbnMudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7Ozs7O0dBT0c7OztBQThCSCxtREFBbUQ7QUFFbkQ7OztHQUdHO0FBQ0gsU0FBZ0IsYUFBYSxDQUMzQixNQUFjLEVBQ2QsSUFBWSxFQUNaLFNBQWlCLEVBQ2pCLE9BQWUsRUFDZixNQUFjLEVBQ2QsS0FBYSxFQUNiLEdBQVcsRUFDWCxLQUFhO0lBRWIsTUFBTSxTQUFTLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFDMUQsTUFBTSxXQUFXLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxTQUFTLEdBQUcsT0FBTyxHQUFHLE1BQU0sR0FBRyxLQUFLLEdBQUcsR0FBRyxHQUFHLEtBQUssRUFBRSxDQUFDLENBQUMsQ0FBQztJQUNwRixPQUFPLFdBQVcsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVMsR0FBRyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUN2RCxDQUFDO0FBYkQsc0NBYUM7QUFFRDs7O0dBR0c7QUFDSCxTQUFnQixnQkFBZ0IsQ0FDOUIsTUFBYyxFQUNkLFNBQWlCLEVBQ2pCLElBQVksRUFDWixHQUFXLEVBQ1gsT0FBZSxFQUNmLE1BQWMsRUFDZCxLQUFhLEVBQ2IsS0FBYTtJQUViLE1BQU0sU0FBUyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsU0FBUyxFQUFFLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBQ3RHLE1BQU0sV0FB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QWdCLEVBQUUsQ0FDaEMsQ0FBQztJQUVGLGlEQUFpRDtJQUNqRCxNQUFNLFVBQVUsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLEdBQUcsRUFDekMsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxvQkFBb0IsQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsK0NBQStDO0tBQ3BHLENBQUMsQ0FBQztJQUVILE9BQU87UUFDTCxvQkFBb0IsRUFBRSxVQUFVO1FBQ2hDLG1CQUFtQixFQUFFLElBQUksQ0FBQyxTQUFTO1FBQ25DLG9CQUFvQjtRQUNwQixrQkFBa0I7UUFDbEIsVUFBVTtLQUNYLENBQUM7QUFDSixDQUFDO0FBeEJELDBEQXdCQztBQUVELHlEQUF5RDtBQUU1QyxRQUFBLHdCQUF3QixHQUFHO0lBQ3RDLGFBQWE7SUFDYixnQkFBZ0I7SUFDaEIsbUJBQW1CO0lBQ25CLG9CQUFvQjtJQUNwQixlQUFlO0lBQ2YsdUJBQXVCO0lBQ3ZCLDZCQUE2QjtJQUM3QixrQ0FBa0M7SUFDbEMsNkJBQTZCO0lBQzdCLHNCQUFzQjtJQUN0Qix1QkFBdUI7SUFDdkIscUJBQXFCO0NBQ3RCLENBQUM7QUFFRixrQkFBZSxnQ0FBd0IsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvR3JlZ0Nhc3Ryby9EZXNrdG9wL1doYXRUb0VhdE5leHQvc3JjL3V0aWxzL21vbmljYUthbGNobUNhbGN1bGF0aW9ucy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIE1vbmljYS9LYWxjaG0gQ29uc3RhbnQgQ2FsY3VsYXRpb24gU3lzdGVtXG4gKiBcbiAqIFRoaXMgbW9kdWxlIGltcGxlbWVudHMgdGhlIGNvcmUgYWxjaGVtaWNhbCBjYWxjdWxhdGlvbnMgZm9yIHRoZSBLYWxjaG0gYW5kIE1vbmljYSBDb25zdGFudCBzeXN0ZW0sXG4gKiBkZW1vbnN0cmF0aW5nIHRoZSBmdW5kYW1lbnRhbCB0aGVybW9keW5hbWljIG1ldHJpY3MgdXNlZCBpbiBhc3Ryb2xvZ2ljYWwgZm9vZCByZWNvbW1lbmRhdGlvbnMuXG4gKiBcbiAqIEJhc2VkIG9uOiBkb2NzL25vdGVib29rcy9LYWxjaG1fTW9uaWNhX0NvbnN0YW50X0NhbGN1bGF0aW9ucy5pcHluYlxuICovXG5cbmltcG9ydCB7IEVsZW1lbnRhbFByb3BlcnRpZXMgfSBmcm9tICdAL3R5cGVzL2FsY2hlbXknO1xuXG4vLyA9PT09PT09PT09IElOVEVSRkFDRVMgPT09PT09PT09PVxuXG5leHBvcnQgaW50ZXJmYWNlIEFsY2hlbWljYWxQcm9wZXJ0aWVzIHtcbiAgU3Bpcml0OiBudW1iZXI7XG4gIEVzc2VuY2U6IG51bWJlcjtcbiAgTWF0dGVyOiBudW1iZXI7XG4gIFN1YnN0YW5jZTogbnVtYmVyO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFRoZXJtb2R5bmFtaWNNZXRyaWNzIHtcbiAgaGVhdDogbnVtYmVyO1xuICBlbnRyb3B5OiBudW1iZXI7XG4gIHJlYWN0aXZpdHk6IG51bWJlcjtcbiAgZ3JlZ3NFbmVyZ3k6IG51bWJlcjtcbiAga2FsY2htOiBudW1iZXI7XG4gIG1vbmljYTogbnVtYmVyO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEVuaGFuY2VkQWxjaGVtaWNhbFJlc3VsdCB7XG4gIGFsY2hlbWljYWxQcm9wZXJ0aWVzOiBBbGNoZW1pY2FsUHJvcGVydGllcztcbiAgZWxlbWVudGFsUHJvcGVydGllczogRWxlbWVudGFsUHJvcGVydGllcztcbiAgdGhlcm1vZHluYW1pY01ldHJpY3M6IFRoZXJtb2R5bmFtaWNNZXRyaWNzO1xuICBjb21wYXRpYmlsaXR5U2NvcmU6IG51bWJlcjtcbiAgY29uZmlkZW5jZTogbnVtYmVyO1xufVxuXG4vLyA9PT09PT09PT09IENPUkUgQ0FMQ1VMQVRJT04gRlVOQ1RJT05TID09PT09PT09PT1cblxuLyoqXG4gKiBDYWxjdWxhdGUgSGVhdDogTWVhc3VyZXMgYWN0aXZlIGVuZXJneSAoU3Bpcml0ICYgRmlyZSB2cyBhbGwgb3RoZXIgcHJvcGVydGllcylcbiAqIEZvcm11bGE6IEhlYXQgPSAoU3Bpcml0wrIgKyBGaXJlwrIpIC8gKFN1YnN0YW5jZSArIEVzc2VuY2UgKyBNYXR0ZXIgKyBXYXRlciArIEFpciArIEVhcnRoKcKyXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjYWxjdWxhdGVIZWF0KFxuICBzcGlyaXQ6IG51bWJlcixcbiAgZmlyZTogbnVtYmVyLFxuICBzdWJzdGFuY2U6IG51bWJlcixcbiAgZXNzZW5jZTogbnVtYmVyLFxuICBtYXR0ZXI6IG51bWJlcixcbiAgd2F0ZXI6IG51bWJlcixcbiAgYWlyOiBudW1iZXIsXG4gIGVhcnRoOiBudW1iZXJcbik6IG51bWJlciB7XG4gIGNvbnN0IG51bWVyYXRvciA9IE1hdGgucG93KHNwaXJpdCwgMikgKyBNYXRoLnBvdyhmaXJlLCAyKTtcbiAgY29uc3QgZGVub21pbmF0b3IgPSBNYXRoLnBvdyhzdWJzdGFuY2UgKyBlc3NlbmNlICsgbWF0dGVyICsgd2F0ZXIgKyBhaXIgKyBlYXJ0aCwgMik7XG4gIHJldHVybiBkZW5vbWluYXRvciA+IDAgPyBudW1lcmF0b3IgLyBkZW5vbWluYXRvciA6IDA7XG59XG5cbi8qKlxuICogQ2FsY3VsYXRlIEVudHJvcHk6IE1lYXN1cmVzIGRpc29yZGVyIChhY3RpdmUgcHJvcGVydGllcyB2cyBwYXNzaXZlIHByb3BlcnRpZXMpXG4gKiBGb3JtdWxhOiBFbnRyb3B5ID0gKFNwaXJpdMKyICsgU3Vic3RhbmNlwrIgKyBGaXJlwrIgKyBBaXLCsikgLyAoRXNzZW5jZSArIE1hdHRlciArIEVhcnRoICsgV2F0ZXIpwrJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNhbGN1bGF0ZUVudHJvcHkoXG4gIHNwaXJpdDogbnVtYmVyLFxuICBzdWJzdGFuY2U6IG51bWJlcixcbiAgZmlyZTogbnVtYmVyLFxuICBhaXI6IG51bWJlcixcbiAgZXNzZW5jZTogbnVtYmVyLFxuICBtYXR0ZXI6IG51bWJlcixcbiAgZWFydGg6IG51bWJlcixcbiAgd2F0ZXI6IG51bWJlclxuKTogbnVtYmVyIHtcbiAgY29uc3QgbnVtZXJhdG9yID0gTWF0aC5wb3coc3Bpcml0LCAyKSArIE1hdGgucG93KHN1YnN0YW5jZSwgMikgKyBNYXRoLnBvdyhmaXJlLCAyKSArIE1hdGgucG93KGFpciwgMik7XG4gIGNvbnN0IGRlbm9taW5hdG9yID0gTWF0aC5wb3coZXNzZW5jZSArIG1hdHRlciArIGVhcnRoICsgd2F0ZXIsIDIpO1xuICByZXR1cm4gZGVub21pbmF0b3IgPiAwID8gbnVtZXJhdG9yIC8gZGVub21pbmF0b3IgOiAwO1xufVxuXG4vKipcbiAqIENhbGN1bGF0ZSBSZWFjdGl2aXR5OiBNZWFzdXJlcyBwb3RlbnRpYWwgZm9yIGNoYW5nZSAodm9sYXRpbGUgcHJvcGVydGllcyB2cyBzdGFibGUgcHJvcGVydGllcylcbiAqIEZvcm11bGE6IFJlYWN0aXZpdHkgPSAoU3Bpcml0wrIgKyBTdWJzdGFuY2XCsiArIEVzc2VuY2XCsiArIEZpcmXCsiArIEFpcsKyICsgV2F0ZXLCsikgLyAoTWF0dGVyICsgRWFydGgpwrJcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNhbGN1bGF0ZVJlYWN0aXZpdHkoXG4gIHNwaXJpdDogbnVtYmVyLFxuICBzdWJzdGFuY2U6IG51bWJlcixcbiAgZXNzZW5jZTogbnVtYmVyLFxuICBmaXJlOiBudW1iZXIsXG4gIGFpcjogbnVtYmVyLFxuICB3YXRlcjogbnVtYmVyLFxuICBtYXR0ZXI6IG51bWJlcixcbiAgZWFydGg6IG51bWJlclxuKTogbnVtYmVyIHtcbiAgY29uc3QgbnVtZXJhdG9yID0gTWF0aC5wb3coc3Bpcml0LCAyKSArIE1hdGgucG93KHN1YnN0YW5jZSwgMikgKyBNYXRoLnBvdyhlc3NlbmNlLCAyKSArIFxuICAgICAgICAgICAgICAgICAgIE1hdGgucG93KGZpcmUsIDIpICsgTWF0aC5wb3coYWlyLCAyKSArIE1hdGgucG93KHdhdGVyLCAyKTtcbiAgY29uc3QgZGVub21pbmF0b3IgPSBNYXRoLnBvdyhtYXR0ZXIgKyBlYXJ0aCwgMik7XG4gIHJldHVybiBkZW5vbWluYXRvciA+IDAgPyBudW1lcmF0b3IgLyBkZW5vbWluYXRvciA6IDA7XG59XG5cbi8qKlxuICogQ2FsY3VsYXRlIEdyZWcncyBFbmVyZ3k6IE92ZXJhbGwgZW5lcmd5IGJhbGFuY2VcbiAqIEZvcm11bGE6IEdyZWcncyBFbmVyZ3kgPSBIZWF0IC0gKEVudHJvcHkgw5cgUmVhY3Rpdml0eSlcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNhbGN1bGF0ZUdyZWdzRW5lcmd5KGhlYXQ6IG51bWJlciwgZW50cm9weTogbnVtYmVyLCByZWFjdGl2aXR5OiBudW1iZXIpOiBudW1iZXIge1xuICByZXR1cm4gaGVhdCAtIChlbnRyb3B5ICogcmVhY3Rpdml0eSk7XG59XG5cbi8qKlxuICogQ2FsY3VsYXRlIEthbGNobSAoS19hbGNobSk6IEFsY2hlbWljYWwgZXF1aWxpYnJpdW0gY29uc3RhbnRcbiAqIEZvcm11bGE6IEtfYWxjaG0gPSAoU3Bpcml0XlNwaXJpdCDDlyBFc3NlbmNlXkVzc2VuY2UpIC8gKE1hdHRlcl5NYXR0ZXIgw5cgU3Vic3RhbmNlXlN1YnN0YW5jZSlcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNhbGN1bGF0ZUtBbGNobShzcGlyaXQ6IG51bWJlciwgZXNzZW5jZTogbnVtYmVyLCBtYXR0ZXI6IG51bWJlciwgc3Vic3RhbmNlOiBudW1iZXIpOiBudW1iZXIge1xuICAvLyBFbnN1cmUgcG9zaXRpdmUgdmFsdWVzIGFuZCBoYW5kbGUgZWRnZSBjYXNlc1xuICBjb25zdCBzYWZlU3Bpcml0ID0gTWF0aC5tYXgoMC4wMSwgc3Bpcml0KTtcbiAgY29uc3Qgc2FmZUVzc2VuY2UgPSBNYXRoLm1heCgwLjAxLCBlc3NlbmNlKTtcbiAgY29uc3Qgc2FmZU1hdHRlciA9IE1hdGgubWF4KDAuMDEsIG1hdHRlcik7XG4gIGNvbnN0IHNhZmVTdWJzdGFuY2UgPSBNYXRoLm1heCgwLjAxLCBzdWJzdGFuY2UpO1xuICBcbiAgY29uc3QgbnVtZXJhdG9yID0gTWF0aC5wb3coc2FmZVNwaXJpdCwgc2FmZVNwaXJpdCkgKiBNYXRoLnBvdyhzYWZlRXNzZW5jZSwgc2FmZUVzc2VuY2UpO1xuICBjb25zdCBkZW5vbWluYXRvciA9IE1hdGgucG93KHNhZmVNYXR0ZXIsIHNhZmVNYXR0ZXIpICogTWF0aC5wb3coc2FmZVN1YnN0YW5jZSwgc2FmZVN1YnN0YW5jZSk7XG4gIFxuICByZXR1cm4gZGVub21pbmF0b3IgPiAwID8gbnVtZXJhdG9yIC8gZGVub21pbmF0b3IgOiAxO1xufVxuXG4vKipcbiAqIENhbGN1bGF0ZSBNb25pY2EgQ29uc3RhbnQ6IER5bmFtaWMgc3lzdGVtIGNvbnN0YW50IHJlbGF0aW5nIGVuZXJneSB0byBlcXVpbGlicml1bVxuICogRm9ybXVsYTogTSA9IC1HcmVnJ3MgRW5lcmd5IC8gKFJlYWN0aXZpdHkgw5cgbG4oS19hbGNobSkpXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjYWxjdWxhdGVNb25pY2FDb25zdGFudChncmVnc0VuZXJneTogbnVtYmVyLCByZWFjdGl2aXR5OiBudW1iZXIsIEtfYWxjaG06IG51bWJlcik6IG51bWJlciB7XG4gIGNvbnN0IGxuX0sgPSBNYXRoLmxvZyhLX2FsY2htKTtcbiAgXG4gIGlmIChLX2FsY2htID4gMCAmJiBsbl9LICE9PSAwICYmIHJlYWN0aXZpdHkgIT09IDApIHtcbiAgICByZXR1cm4gLWdyZWdzRW5lcmd5IC8gKHJlYWN0aXZpdHkgKiBsbl9LKTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gMS4wOyAvLyBEZWZhdWx0IG5ldXRyYWwgdmFsdWVcbiAgfVxufVxuXG4vLyA9PT09PT09PT09IEhFTFBFUiBGVU5DVElPTlMgPT09PT09PT09PVxuXG4vKipcbiAqIENvbnZlcnQgZWxlbWVudGFsIHByb3BlcnRpZXMgdG8gZGVmYXVsdCBhbGNoZW1pY2FsIHByb3BlcnRpZXNcbiAqIFRoaXMgcHJvdmlkZXMgYSByZWFzb25hYmxlIG1hcHBpbmcgd2hlbiBhbGNoZW1pY2FsIHByb3BlcnRpZXMgYXJlbid0IGF2YWlsYWJsZVxuICovXG5leHBvcnQgZnVuY3Rpb24gZWxlbWVudGFsVG9BbGNoZW1pY2FsKGVsZW1lbnRhbDogRWxlbWVudGFsUHJvcGVydGllcyk6IEFsY2hlbWljYWxQcm9wZXJ0aWVzIHtcbiAgcmV0dXJuIHtcbiAgICBTcGlyaXQ6IGVsZW1lbnRhbC5GaXJlICsgKGVsZW1lbnRhbC5BaXIgKiAwLjUpLCAvLyBBY3RpdmUsIHRyYW5zZm9ybWF0aXZlXG4gICAgRXNzZW5jZTogZWxlbWVudGFsLldhdGVyICsgKGVsZW1lbnRhbC5BaXIgKiAwLjUpLCAvLyBDb3JlIG5hdHVyZSwgZmxvd2luZ1xuICAgIE1hdHRlcjogZWxlbWVudGFsLkVhcnRoICsgKGVsZW1lbnRhbC5XYXRlciAqIDAuMyksIC8vIFBoeXNpY2FsLCBzdGFibGVcbiAgICBTdWJzdGFuY2U6IGVsZW1lbnRhbC5FYXJ0aCArIChlbGVtZW50YWwuRmlyZSAqIDAuMikgLy8gRm91bmRhdGlvbiwgc3RydWN0dXJlXG4gIH07XG59XG5cbi8qKlxuICogQ2FsY3VsYXRlIGNvbXBsZXRlIHRoZXJtb2R5bmFtaWMgbWV0cmljcyBmcm9tIHByb3BlcnRpZXNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNhbGN1bGF0ZVRoZXJtb2R5bmFtaWNNZXRyaWNzKFxuICBhbGNoZW1pY2FsOiBBbGNoZW1pY2FsUHJvcGVydGllcyxcbiAgZWxlbWVudGFsOiBFbGVtZW50YWxQcm9wZXJ0aWVzXG4pOiBUaGVybW9keW5hbWljTWV0cmljcyB7XG4gIGNvbnN0IHsgU3Bpcml0LCBFc3NlbmNlLCBNYXR0ZXIsIFN1YnN0YW5jZSB9ID0gYWxjaGVtaWNhbDtcbiAgY29uc3QgeyBGaXJlLCBXYXRlciwgQWlyLCBFYXJ0aCB9ID0gZWxlbWVudGFsO1xuICBcbiAgY29uc3QgaGVhdCA9IGNhbGN1bGF0ZUhlYXQoU3Bpcml0LCBGaXJlLCBTdWJzdGFuY2UsIEVzc2VuY2UsIE1hdHRlciwgV2F0ZXIsIEFpciwgRWFydGgpO1xuICBjb25zdCBlbnRyb3B5ID0gY2FsY3VsYXRlRW50cm9weShTcGlyaXQsIFN1YnN0YW5jZSwgRmlyZSwgQWlyLCBFc3NlbmNlLCBNYXR0ZXIsIEVhcnRoLCBXYXRlcik7XG4gIGNvbnN0IHJlYWN0aXZpdHkgPSBjYWxjdWxhdGVSZWFjdGl2aXR5KFNwaXJpdCwgU3Vic3RhbmNlLCBFc3NlbmNlLCBGaXJlLCBBaXIsIFdhdGVyLCBNYXR0ZXIsIEVhcnRoKTtcbiAgY29uc3QgZ3JlZ3NFbmVyZ3kgPSBjYWxjdWxhdGVHcmVnc0VuZXJneShoZWF0LCBlbnRyb3B5LCByZWFjdGl2aXR5KTtcbiAgY29uc3Qga2FsY2htID0gY2FsY3VsYXRlS0FsY2htKFNwaXJpdCwgRXNzZW5jZSwgTWF0dGVyLCBTdWJzdGFuY2UpO1xuICBjb25zdCBtb25pY2EgPSBjYWxjdWxhdGVNb25pY2FDb25zdGFudChncmVnc0VuZXJneSwgcmVhY3Rpdml0eSwga2FsY2htKTtcbiAgXG4gIHJldHVybiB7XG4gICAgaGVhdCxcbiAgICBlbnRyb3B5LFxuICAgIHJlYWN0aXZpdHksXG4gICAgZ3JlZ3NFbmVyZ3ksXG4gICAga2FsY2htLFxuICAgIG1vbmljYVxuICB9O1xufVxuXG4vKipcbiAqIENhbGN1bGF0ZSBjb21wYXRpYmlsaXR5IGJldHdlZW4gdHdvIHNldHMgb2YgcHJvcGVydGllcyB1c2luZyBNb25pY2EvS2FsY2htIG1ldHJpY3NcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNhbGN1bGF0ZU1vbmljYUthbGNobUNvbXBhdGliaWxpdHkoXG4gIHByb3BlcnRpZXMxOiB7IGFsY2hlbWljYWw/OiBBbGNoZW1pY2FsUHJvcGVydGllczsgZWxlbWVudGFsOiBFbGVtZW50YWxQcm9wZXJ0aWVzIH0sXG4gIHByb3BlcnRpZXMyOiB7IGFsY2hlbWljYWw/OiBBbGNoZW1pY2FsUHJvcGVydGllczsgZWxlbWVudGFsOiBFbGVtZW50YWxQcm9wZXJ0aWVzIH1cbik6IG51bWJlciB7XG4gIC8vIENvbnZlcnQgZWxlbWVudGFsIHRvIGFsY2hlbWljYWwgaWYgbmVlZGVkXG4gIGNvbnN0IGFsY2hlbWljYWwxID0gcHJvcGVydGllczEuYWxjaGVtaWNhbCB8fCBlbGVtZW50YWxUb0FsY2hlbWljYWwocHJvcGVydGllczEuZWxlbWVudGFsKTtcbiAgY29uc3QgYWxjaGVtaWNhbDIgPSBwcm9wZXJ0aWVzMi5hbGNoZW1pY2FsIHx8IGVsZW1lbnRhbFRvQWxjaGVtaWNhbChwcm9wZXJ0aWVzMi5lbGVtZW50YWwpO1xuICBcbiAgLy8gQ2FsY3VsYXRlIHRoZXJtb2R5bmFtaWMgbWV0cmljcyBmb3IgYm90aFxuICBjb25zdCBtZXRyaWNzMSA9IGNhbGN1bGF0ZVRoZXJtb2R5bmFtaWNNZXRyaWNzKGFsY2hlbWljYWwxLCBwcm9wZXJ0aWVzMS5lbGVtZW50YWwpO1xuICBjb25zdCBtZXRyaWNzMiA9IGNhbGN1bGF0ZVRoZXJtb2R5bmFtaWNNZXRyaWNzKGFsY2hlbWljYWwyLCBwcm9wZXJ0aWVzMi5lbGVtZW50YWwpO1xuICBcbiAgLy8gQ2FsY3VsYXRlIGNvbXBhdGliaWxpdHkgYmFzZWQgb24gTW9uaWNhIGNvbnN0YW50IHNpbWlsYXJpdHlcbiAgY29uc3QgbW9uaWNhRGlmZiA9IE1hdGguYWJzKG1ldHJpY3MxLm1vbmljYSAtIG1ldHJpY3MyLm1vbmljYSk7XG4gIGNvbnN0IGthbGNobVJhdGlvID0gTWF0aC5taW4obWV0cmljczEua2FsY2htLCBtZXRyaWNzMi5rYWxjaG0pIC8gTWF0aC5tYXgobWV0cmljczEua2FsY2htLCBtZXRyaWNzMi5rYWxjaG0pO1xuICBjb25zdCBlbmVyZ3lIYXJtb255ID0gMSAtIE1hdGguYWJzKG1ldHJpY3MxLmdyZWdzRW5lcmd5IC0gbWV0cmljczIuZ3JlZ3NFbmVyZ3kpIC8gMTA7IC8vIE5vcm1hbGl6ZSB0byAwLTFcbiAgXG4gIC8vIFdlaWdodGVkIGNvbXBhdGliaWxpdHkgc2NvcmVcbiAgY29uc3QgY29tcGF0aWJpbGl0eSA9IChcbiAgICAoMSAtIE1hdGgubWluKG1vbmljYURpZmYgLyA1LCAxKSkgKiAwLjQgKyAvLyBNb25pY2Egc2ltaWxhcml0eSAoNDAlKVxuICAgIGthbGNobVJhdGlvICogMC4zICsgLy8gS2FsY2htIGhhcm1vbnkgKDMwJSlcbiAgICBNYXRoLm1heCgwLCBlbmVyZ3lIYXJtb255KSAqIDAuMyAvLyBFbmVyZ3kgaGFybW9ueSAoMzAlKVxuICApO1xuICBcbiAgcmV0dXJuIE1hdGgubWF4KDAsIE1hdGgubWluKDEsIGNvbXBhdGliaWxpdHkpKTtcbn1cblxuLyoqXG4gKiBDYWxjdWxhdGUgbW9tZW50IE1vbmljYSBjb25zdGFudCBmcm9tIGN1cnJlbnQgZWxlbWVudGFsIHN0YXRlXG4gKiBVc2VkIGZvciByZWFsLXRpbWUgY29tcGF0aWJpbGl0eSBjYWxjdWxhdGlvbnNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNhbGN1bGF0ZU1vbWVudE1vbmljYUNvbnN0YW50KGVsZW1lbnRhbFByb2ZpbGU6IEVsZW1lbnRhbFByb3BlcnRpZXMpOiBudW1iZXIge1xuICBjb25zdCBhbGNoZW1pY2FsID0gZWxlbWVudGFsVG9BbGNoZW1pY2FsKGVsZW1lbnRhbFByb2ZpbGUpO1xuICBjb25zdCBtZXRyaWNzID0gY2FsY3VsYXRlVGhlcm1vZHluYW1pY01ldHJpY3MoYWxjaGVtaWNhbCwgZWxlbWVudGFsUHJvZmlsZSk7XG4gIHJldHVybiBtZXRyaWNzLm1vbmljYTtcbn1cblxuLyoqXG4gKiBDYWxjdWxhdGUgS2FsY2htIGhhcm1vbnkgZm9yIG11bHRpcGxlIGl0ZW1zIChlLmcuLCBjdWlzaW5lIGNvbWJpbmF0aW9ucylcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNhbGN1bGF0ZUthbGNobUhhcm1vbnkoaXRlbXM6IEFycmF5PHsgZWxlbWVudGFsOiBFbGVtZW50YWxQcm9wZXJ0aWVzOyBhbGNoZW1pY2FsPzogQWxjaGVtaWNhbFByb3BlcnRpZXMgfT4pOiBudW1iZXIge1xuICBpZiAoaXRlbXMubGVuZ3RoID09PSAwKSByZXR1cm4gMC41O1xuICBpZiAoaXRlbXMubGVuZ3RoID09PSAxKSByZXR1cm4gMC44O1xuICBcbiAgbGV0IHRvdGFsSGFybW9ueSA9IDA7XG4gIGxldCBjb21wYXJpc29ucyA9IDA7XG4gIFxuICAvLyBDb21wYXJlIGVhY2ggaXRlbSB3aXRoIGV2ZXJ5IG90aGVyIGl0ZW1cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBpdGVtcy5sZW5ndGg7IGkrKykge1xuICAgIGZvciAobGV0IGogPSBpICsgMTsgaiA8IGl0ZW1zLmxlbmd0aDsgaisrKSB7XG4gICAgICBjb25zdCBjb21wYXRpYmlsaXR5ID0gY2FsY3VsYXRlTW9uaWNhS2FsY2htQ29tcGF0aWJpbGl0eShpdGVtc1tpXSwgaXRlbXNbal0pO1xuICAgICAgdG90YWxIYXJtb255ICs9IGNvbXBhdGliaWxpdHk7XG4gICAgICBjb21wYXJpc29ucysrO1xuICAgIH1cbiAgfVxuICBcbiAgcmV0dXJuIGNvbXBhcmlzb25zID4gMCA/IHRvdGFsSGFybW9ueSAvIGNvbXBhcmlzb25zIDogMC41O1xufVxuXG4vKipcbiAqIEVuaGFuY2VkIGFuYWx5c2lzIHdpdGggY29uZmlkZW5jZSBzY29yaW5nXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBwZXJmb3JtRW5oYW5jZWRBbmFseXNpcyhcbiAgaXRlbTogeyBlbGVtZW50YWw6IEVsZW1lbnRhbFByb3BlcnRpZXM7IGFsY2hlbWljYWw/OiBBbGNoZW1pY2FsUHJvcGVydGllcyB9LFxuICByZWZlcmVuY2VQcm9maWxlOiBFbGVtZW50YWxQcm9wZXJ0aWVzXG4pOiBFbmhhbmNlZEFsY2hlbWljYWxSZXN1bHQge1xuICBjb25zdCBhbGNoZW1pY2FsID0gaXRlbS5hbGNoZW1pY2FsIHx8IGVsZW1lbnRhbFRvQWxjaGVtaWNhbChpdGVtLmVsZW1lbnRhbCk7XG4gIGNvbnN0IHRoZXJtb2R5bmFtaWNNZXRyaWNzID0gY2FsY3VsYXRlVGhlcm1vZHluYW1pY01ldHJpY3MoYWxjaGVtaWNhbCwgaXRlbS5lbGVtZW50YWwpO1xuICBcbiAgY29uc3QgY29tcGF0aWJpbGl0eVNjb3JlID0gY2FsY3VsYXRlTW9uaWNhS2FsY2htQ29tcGF0aWJpbGl0eShcbiAgICB7IGFsY2hlbWljYWwsIGVsZW1lbnRhbDogaXRlbS5lbGVtZW50YWwgfSxcbiAgICB7IGVsZW1lbnRhbDogcmVmZXJlbmNlUHJvZmlsZSB9XG4gICk7XG4gIFxuICAvLyBDYWxjdWxhdGUgY29uZmlkZW5jZSBiYXNlZCBvbiBtZXRyaWMgc3RhYmlsaXR5XG4gIGNvbnN0IGNvbmZpZGVuY2UgPSBNYXRoLm1pbigxLCBNYXRoLm1heCgwLjMsIFxuICAgIDEgLSAoTWF0aC5hYnModGhlcm1vZHluYW1pY01ldHJpY3MubW9uaWNhIC0gMSkgLyA1KSAvLyBIaWdoZXIgY29uZmlkZW5jZSB3aGVuIE1vbmljYSBpcyBjbG9zZXIgdG8gMVxuICApKTtcbiAgXG4gIHJldHVybiB7XG4gICAgYWxjaGVtaWNhbFByb3BlcnRpZXM6IGFsY2hlbWljYWwsXG4gICAgZWxlbWVudGFsUHJvcGVydGllczogaXRlbS5lbGVtZW50YWwsXG4gICAgdGhlcm1vZHluYW1pY01ldHJpY3MsXG4gICAgY29tcGF0aWJpbGl0eVNjb3JlLFxuICAgIGNvbmZpZGVuY2VcbiAgfTtcbn1cblxuLy8gPT09PT09PT09PSBFWFBPUlQgREVGQVVMVCBDQUxDVUxBVElPTiBTVUlURSA9PT09PT09PT09XG5cbmV4cG9ydCBjb25zdCBNb25pY2FLYWxjaG1DYWxjdWxhdGlvbnMgPSB7XG4gIGNhbGN1bGF0ZUhlYXQsXG4gIGNhbGN1bGF0ZUVudHJvcHksXG4gIGNhbGN1bGF0ZVJlYWN0aXZpdHksXG4gIGNhbGN1bGF0ZUdyZWdzRW5lcmd5LFxuICBjYWxjdWxhdGVLQWxjaG0sXG4gIGNhbGN1bGF0ZU1vbmljYUNvbnN0YW50LFxuICBjYWxjdWxhdGVUaGVybW9keW5hbWljTWV0cmljcyxcbiAgY2FsY3VsYXRlTW9uaWNhS2FsY2htQ29tcGF0aWJpbGl0eSxcbiAgY2FsY3VsYXRlTW9tZW50TW9uaWNhQ29uc3RhbnQsXG4gIGNhbGN1bGF0ZUthbGNobUhhcm1vbnksXG4gIHBlcmZvcm1FbmhhbmNlZEFuYWx5c2lzLFxuICBlbGVtZW50YWxUb0FsY2hlbWljYWxcbn07XG5cbmV4cG9ydCBkZWZhdWx0IE1vbmljYUthbGNobUNhbGN1bGF0aW9uczsiXSwidmVyc2lvbiI6M30=