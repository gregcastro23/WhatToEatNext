afd2435bcc380969c4b4e6a84954d7bb
"use strict";
/**
 * Progress Tracking Infrastructure
 * Perfect Codebase Campaign - Real-time Metrics Collection
 */
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.ProgressTracker = void 0;
const child_process_1 = require("child_process");
const fs = __importStar(require("fs"));
const campaign_1 = require("../../types/campaign");
class ProgressTracker {
    constructor() {
        this.metricsHistory = [];
        this.lastMetricsUpdate = new Date();
    }
    /**
     * Get current TypeScript error count using proven command pattern
     */
    async getTypeScriptErrorCount() {
        try {
            // Using the proven pattern from existing scripts and Makefile
            const output = (0, child_process_1.execSync)('yarn tsc --noEmit --skipLibCheck 2>&1 | grep -c "error TS"', {
                encoding: 'utf8',
                stdio: 'pipe'
            });
            const count = parseInt(output.trim()) || 0;
            return count;
        }
        catch (error) {
            // If grep finds no matches, it returns exit code 1, but that means 0 errors
            if (error.status === 1) {
                return 0;
            }
            console.warn(`Warning: Could not get TypeScript error count: ${error.message}`);
            return -1; // Indicates measurement failure
        }
    }
    /**
     * Get detailed TypeScript error breakdown by type
     */
    async getTypeScriptErrorBreakdown() {
        try {
            const output = (0, child_process_1.execSync)('yarn tsc --noEmit --skipLibCheck 2>&1 | grep -E "error TS" | sed \'s/.*error //\' | cut -d\':\' -f1 | sort | uniq -c | sort -nr', {
                encoding: 'utf8',
                stdio: 'pipe'
            });
            const breakdown = {};
            const lines = output.trim().split('\n').filter(line => line.trim());
            for (const line of lines) {
                const match = line.trim().match(/^\s*(\d+)\s+(.+)$/);
                if (match) {
                    const count = parseInt(match[1]);
                    const errorType = match[2].trim();
                    breakdown[errorType] = count;
                }
            }
            return breakdown;
        }
        catch (error) {
            console.warn(`Warning: Could not get TypeScript error breakdown: ${error.message}`);
            return {};
        }
    }
    /**
     * Get current linting warning count
     */
    async getLintingWarningCount() {
        try {
            // Using yarn lint to get warning count
            const output = (0, child_process_1.execSync)('yarn lint 2>&1 | grep -c "warning"', {
                encoding: 'utf8',
                stdio: 'pipe'
            });
            const count = parseInt(output.trim()) || 0;
            return count;
        }
        catch (error) {
            // If grep finds no matches, it returns exit code 1, but that means 0 warnings
            if (error.status === 1) {
                return 0;
            }
            console.warn(`Warning: Could not get linting warning count: ${error.message}`);
            return -1; // Indicates measurement failure
        }
    }
    /**
     * Get detailed linting warning breakdown by type
     */
    async getLintingWarningBreakdown() {
        try {
            const output = (0, child_process_1.execSync)('yarn lint 2>&1', {
                encoding: 'utf8',
                stdio: 'pipe'
            });
            const breakdown = {};
            const lines = output.split('\n');
            for (const line of lines) {
                // Look for ESLint warning patterns
                const warningMatch = line.match(/warning\s+(.+?)\s+(@typescript-eslint\/[\w-]+|[\w-]+)/);
                if (warningMatch) {
                    const ruleType = warningMatch[2];
                    breakdown[ruleType] = (breakdown[ruleType] || 0) + 1;
                }
            }
            return breakdown;
        }
        catch (error) {
            console.warn(`Warning: Could not get linting warning breakdown: ${error.message}`);
            return {};
        }
    }
    /**
     * Measure build time using time command
     */
    async getBuildTime() {
        try {
            const startTime = Date.now();
            // Run build command and measure time
            (0, child_process_1.execSync)('yarn build', {
                encoding: 'utf8',
                stdio: 'pipe'
            });
            const endTime = Date.now();
            const buildTimeSeconds = (endTime - startTime) / 1000;
            return buildTimeSeconds;
        }
        catch (error) {
            console.warn(`Warning: Build failed during timing: ${error.message}`);
            return -1; // Indicates build failure
        }
    }
    /**
     * Get enterprise system count using intelligence system pattern
     */
    async getEnterpriseSystemCount() {
        try {
            // Count INTELLIGENCE_SYSTEM patterns in source code
            const output = (0, child_process_1.execSync)('grep -r "INTELLIGENCE_SYSTEM" src/ | wc -l', {
                encoding: 'utf8',
                stdio: 'pipe'
            });
            const count = parseInt(output.trim()) || 0;
            return count;
        }
        catch (error) {
            console.warn(`Warning: Could not count enterprise systems: ${error.message}`);
            return 0;
        }
    }
    /**
     * Get cache hit rate from build system
     */
    async getCacheHitRate() {
        try {
            // This would need to be implemented based on the specific build system
            // For now, return a mock value based on typical performance
            return 0.8; // 80% cache hit rate
        }
        catch (error) {
            console.warn(`Warning: Could not measure cache hit rate: ${error.message}`);
            return 0;
        }
    }
    /**
     * Get current memory usage during build
     */
    async getMemoryUsage() {
        try {
            // Get Node.js process memory usage
            const memUsage = process.memoryUsage();
            const memoryMB = memUsage.heapUsed / 1024 / 1024;
            return Math.round(memoryMB);
        }
        catch (error) {
            console.warn(`Warning: Could not measure memory usage: ${error.message}`);
            return 0;
        }
    }
    /**
     * Get bundle size information
     */
    async getBundleSize() {
        try {
            // Check for build output directory
            const buildDirs = ['.next', 'dist', 'build'];
            let totalSize = 0;
            for (const dir of buildDirs) {
                if (fs.existsSync(dir)) {
                    const output = (0, child_process_1.execSync)(`du -sk ${dir} | cut -f1`, {
                        encoding: 'utf8',
                        stdio: 'pipe'
                    });
                    const sizeKB = parseInt(output.trim()) || 0;
                    totalSize += sizeKB;
                }
            }
            return totalSize;
        }
        catch (error) {
            console.warn(`Warning: Could not measure bundle size: ${error.message}`);
            return 0;
        }
    }
    /**
     * Get comprehensive progress metrics
     */
    async getProgressMetrics() {
        const typeScriptErrorCount = await this.getTypeScriptErrorCount();
        const lintingWarningCount = await this.getLintingWarningCount();
        const buildTime = await this.getBuildTime();
        const enterpriseSystemCount = await this.getEnterpriseSystemCount();
        const cacheHitRate = await this.getCacheHitRate();
        const memoryUsage = await this.getMemoryUsage();
        const metrics = {
            typeScriptErrors: {
                current: typeScriptErrorCount,
                target: 0,
                reduction: Math.max(0, 86 - typeScriptErrorCount),
                percentage: typeScriptErrorCount >= 0 ? Math.round(((86 - typeScriptErrorCount) / 86) * 100) : 0
            },
            lintingWarnings: {
                current: lintingWarningCount,
                target: 0,
                reduction: Math.max(0, 4506 - lintingWarningCount),
                percentage: lintingWarningCount >= 0 ? Math.round(((4506 - lintingWarningCount) / 4506) * 100) : 0
            },
            buildPerformance: {
                currentTime: buildTime,
                targetTime: 10,
                cacheHitRate: cacheHitRate,
                memoryUsage: memoryUsage
            },
            enterpriseSystems: {
                current: enterpriseSystemCount,
                target: 200,
                transformedExports: Math.max(0, enterpriseSystemCount - 0) // Assuming starting from 0
            }
        };
        // Store metrics in history
        this.metricsHistory.push(metrics);
        this.lastMetricsUpdate = new Date();
        // Keep only recent history to prevent memory issues
        if (this.metricsHistory.length > 100) {
            this.metricsHistory = this.metricsHistory.slice(-50);
        }
        return metrics;
    }
    /**
     * Validate milestone achievement
     */
    async validateMilestone(milestone) {
        const metrics = await this.getProgressMetrics();
        switch (milestone) {
            case 'zero-typescript-errors':
                return metrics.typeScriptErrors.current === 0;
            case 'zero-linting-warnings':
                return metrics.lintingWarnings.current === 0;
            case 'build-time-under-10s':
                return metrics.buildPerformance.currentTime <= 10;
            case 'enterprise-systems-200':
                return metrics.enterpriseSystems.current >= 200;
            case 'phase-1-complete':
                return metrics.typeScriptErrors.current === 0;
            case 'phase-2-complete':
                return metrics.lintingWarnings.current === 0;
            case 'phase-3-complete':
                return metrics.enterpriseSystems.current >= 200;
            case 'phase-4-complete':
                return (metrics.buildPerformance.currentTime <= 10 &&
                    metrics.buildPerformance.cacheHitRate >= 0.8 &&
                    metrics.buildPerformance.memoryUsage <= 50);
            default:
                console.warn(`Unknown milestone: ${milestone}`);
                return false;
        }
    }
    /**
     * Generate comprehensive progress report
     */
    async generateProgressReport() {
        const currentMetrics = await this.getProgressMetrics();
        const targetMetrics = {
            typeScriptErrors: {
                current: 0,
                target: 0,
                reduction: 86,
                percentage: 100
            },
            lintingWarnings: {
                current: 0,
                target: 0,
                reduction: 4506,
                percentage: 100
            },
            buildPerformance: {
                currentTime: 8,
                targetTime: 10,
                cacheHitRate: 0.8,
                memoryUsage: 45
            },
            enterpriseSystems: {
                current: 200,
                target: 200,
                transformedExports: 200
            }
        };
        // Calculate overall progress
        const typeScriptProgress = currentMetrics.typeScriptErrors.percentage;
        const lintingProgress = currentMetrics.lintingWarnings.percentage;
        const buildProgress = currentMetrics.buildPerformance.currentTime <= 10 ? 100 : 0;
        const enterpriseProgress = (currentMetrics.enterpriseSystems.current / 200) * 100;
        const overallProgress = Math.round((typeScriptProgress + lintingProgress + buildProgress + enterpriseProgress) / 4);
        // Generate phase reports
        const phases = [
            {
                phaseId: 'phase1',
                phaseName: 'TypeScript Error Elimination',
                startTime: new Date(),
                status: currentMetrics.typeScriptErrors.current === 0 ? campaign_1.PhaseStatus.COMPLETED : campaign_1.PhaseStatus.IN_PROGRESS,
                metrics: currentMetrics,
                achievements: currentMetrics.typeScriptErrors.current === 0 ? ['Zero TypeScript errors achieved'] : [],
                issues: currentMetrics.typeScriptErrors.current > 0 ? [`${currentMetrics.typeScriptErrors.current} TypeScript errors remaining`] : [],
                recommendations: currentMetrics.typeScriptErrors.current > 0 ? ['Continue with Enhanced TypeScript Error Fixer v3.0'] : []
            },
            {
                phaseId: 'phase2',
                phaseName: 'Linting Excellence Achievement',
                startTime: new Date(),
                status: currentMetrics.lintingWarnings.current === 0 ? campaign_1.PhaseStatus.COMPLETED : campaign_1.PhaseStatus.IN_PROGRESS,
                metrics: currentMetrics,
                achievements: currentMetrics.lintingWarnings.current === 0 ? ['Zero linting warnings achieved'] : [],
                issues: currentMetrics.lintingWarnings.current > 0 ? [`${currentMetrics.lintingWarnings.current} linting warnings remaining`] : [],
                recommendations: currentMetrics.lintingWarnings.current > 0 ? ['Continue with systematic linting fixes'] : []
            }
        ];
        // Estimate completion time based on current progress rate
        const estimatedCompletion = new Date();
        estimatedCompletion.setDate(estimatedCompletion.getDate() + Math.ceil((100 - overallProgress) / 10)); // Rough estimate
        return {
            campaignId: 'perfect-codebase-campaign',
            overallProgress,
            phases,
            currentMetrics,
            targetMetrics,
            estimatedCompletion
        };
    }
    /**
     * Get metrics history for trend analysis
     */
    getMetricsHistory() {
        return [...this.metricsHistory];
    }
    /**
     * Get metrics improvement over time
     */
    getMetricsImprovement() {
        if (this.metricsHistory.length < 2) {
            return {
                typeScriptErrorsReduced: 0,
                lintingWarningsReduced: 0,
                buildTimeImproved: 0,
                enterpriseSystemsAdded: 0
            };
        }
        const first = this.metricsHistory[0];
        const latest = this.metricsHistory[this.metricsHistory.length - 1];
        return {
            typeScriptErrorsReduced: first.typeScriptErrors.current - latest.typeScriptErrors.current,
            lintingWarningsReduced: first.lintingWarnings.current - latest.lintingWarnings.current,
            buildTimeImproved: first.buildPerformance.currentTime - latest.buildPerformance.currentTime,
            enterpriseSystemsAdded: latest.enterpriseSystems.current - first.enterpriseSystems.current
        };
    }
    /**
     * Export metrics to JSON for external analysis
     */
    async exportMetrics(filePath) {
        try {
            const report = await this.generateProgressReport();
            const exportData = {
                timestamp: new Date().toISOString(),
                report,
                history: this.metricsHistory,
                improvement: this.getMetricsImprovement()
            };
            fs.writeFileSync(filePath, JSON.stringify(exportData, null, 2));
            console.log(`ðŸ“Š Metrics exported to: ${filePath}`);
        }
        catch (error) {
            throw new Error(`Failed to export metrics: ${error.message}`);
        }
    }
    /**
     * Reset metrics history (for testing or fresh start)
     */
    resetMetricsHistory() {
        this.metricsHistory = [];
        this.lastMetricsUpdate = new Date();
        console.log('ðŸ“Š Metrics history reset');
    }
}
exports.ProgressTracker = ProgressTracker;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9zZXJ2aWNlcy9jYW1wYWlnbi9Qcm9ncmVzc1RyYWNrZXIudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7R0FHRzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFSCxpREFBeUM7QUFDekMsdUNBQXlCO0FBRXpCLG1EQU84QjtBQUU5QixNQUFhLGVBQWU7SUFBNUI7UUFDVSxtQkFBYyxHQUFzQixFQUFFLENBQUM7UUFDdkMsc0JBQWlCLEdBQVMsSUFBSSxJQUFJLEVBQUUsQ0FBQztJQWljL0MsQ0FBQztJQS9iQzs7T0FFRztJQUNILEtBQUssQ0FBQyx1QkFBdUI7UUFDM0IsSUFBSTtZQUNGLDhEQUE4RDtZQUM5RCxNQUFNLE1BQU0sR0FBRyxJQUFBLHdCQUFRLEVBQUMsNERBQTRELEVBQUU7Z0JBQ3BGLFFBQVEsRUFBRSxNQUFNO2dCQUNoQixLQUFLLEVBQUUsTUFBTTthQUNkLENBQUMsQ0FBQztZQUVILE1BQU0sS0FBSyxHQUFHLFFBQVEsQ0FBQyxNQUFNLENBQUMsSUFBSSxFQUFFLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDM0MsT0FBTyxLQUFLLENBQUM7U0FFZDtRQUFDLE9BQU8sS0FBSyxFQUFFO1lBQ2QsNEVBQTRFO1lBQzVFLElBQUksS0FBSyxDQUFDLE1BQU0sS0FBSyxDQUFDLEVBQUU7Z0JBQ3RCLE9BQU8sQ0FBQyxDQUFDO2FBQ1Y7WUFFRCxPQUFPLENBQUMsSUFBSSxDQUFDLGtEQUFrRCxLQUFLLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQztZQUNoRixPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsZ0NBQWdDO1NBQzVDO0lBQ0gsQ0FBQztJQUVEOztPQUVHO0lBQ0gsS0FBSyxDQUFDLDJCQUEyQjtRQUMvQixJQUFJO1lBQ0YsTUFBTSxNQUFNLEdBQUcsSUFBQSx3QkFBUSxFQUFDLGlJQUFpSSxFQUFFO2dCQUN6SixRQUFRLEVBQUUsTUFBTTtnQkFDaEIsS0FBSyxFQUFFLE1BQU07YUFDZCxDQUFD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LENBQUM7UUFDekIsSUFBSSxDQUFDLGlCQUFpQixHQUFHLElBQUksSUFBSSxFQUFFLENBQUM7UUFDcEMsT0FBTyxDQUFDLEdBQUcsQ0FBQywwQkFBMEIsQ0FBQyxDQUFDO0lBQzFDLENBQUM7Q0FDRjtBQW5jRCwwQ0FtY0MiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9zZXJ2aWNlcy9jYW1wYWlnbi9Qcm9ncmVzc1RyYWNrZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBQcm9ncmVzcyBUcmFja2luZyBJbmZyYXN0cnVjdHVyZVxuICogUGVyZmVjdCBDb2RlYmFzZSBDYW1wYWlnbiAtIFJlYWwtdGltZSBNZXRyaWNzIENvbGxlY3Rpb25cbiAqL1xuXG5pbXBvcnQgeyBleGVjU3luYyB9IGZyb20gJ2NoaWxkX3Byb2Nlc3MnO1xuaW1wb3J0ICogYXMgZnMgZnJvbSAnZnMnO1xuaW1wb3J0ICogYXMgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCB7XG4gIFByb2dyZXNzTWV0cmljcyxcbiAgVmFsaWRhdGlvblJlc3VsdCxcbiAgTWlsZXN0b25lLFxuICBQcm9ncmVzc1JlcG9ydCxcbiAgUGhhc2VSZXBvcnQsXG4gIFBoYXNlU3RhdHVzXG59IGZyb20gJy4uLy4uL3R5cGVzL2NhbXBhaWduJztcblxuZXhwb3J0IGNsYXNzIFByb2dyZXNzVHJhY2tlciB7XG4gIHByaXZhdGUgbWV0cmljc0hpc3Rvcnk6IFByb2dyZXNzTWV0cmljc1tdID0gW107XG4gIHByaXZhdGUgbGFzdE1ldHJpY3NVcGRhdGU6IERhdGUgPSBuZXcgRGF0ZSgpO1xuXG4gIC8qKlxuICAgKiBHZXQgY3VycmVudCBUeXBlU2NyaXB0IGVycm9yIGNvdW50IHVzaW5nIHByb3ZlbiBjb21tYW5kIHBhdHRlcm5cbiAgICovXG4gIGFzeW5jIGdldFR5cGVTY3JpcHRFcnJvckNvdW50KCk6IFByb21pc2U8bnVtYmVyPiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIFVzaW5nIHRoZSBwcm92ZW4gcGF0dGVybiBmcm9tIGV4aXN0aW5nIHNjcmlwdHMgYW5kIE1ha2VmaWxlXG4gICAgICBjb25zdCBvdXRwdXQgPSBleGVjU3luYygneWFybiB0c2MgLS1ub0VtaXQgLS1za2lwTGliQ2hlY2sgMj4mMSB8IGdyZXAgLWMgXCJlcnJvciBUU1wiJywge1xuICAgICAgICBlbmNvZGluZzogJ3V0ZjgnLFxuICAgICAgICBzdGRpbzogJ3BpcGUnXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgY29uc3QgY291bnQgPSBwYXJzZUludChvdXRwdXQudHJpbSgpKSB8fCAwO1xuICAgICAgcmV0dXJuIGNvdW50O1xuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIC8vIElmIGdyZXAgZmluZHMgbm8gbWF0Y2hlcywgaXQgcmV0dXJucyBleGl0IGNvZGUgMSwgYnV0IHRoYXQgbWVhbnMgMCBlcnJvcnNcbiAgICAgIGlmIChlcnJvci5zdGF0dXMgPT09IDEpIHtcbiAgICAgICAgcmV0dXJuIDA7XG4gICAgICB9XG4gICAgICBcbiAgICAgIGNvbnNvbGUud2FybihgV2FybmluZzogQ291bGQgbm90IGdldCBUeXBlU2NyaXB0IGVycm9yIGNvdW50OiAke2Vycm9yLm1lc3NhZ2V9YCk7XG4gICAgICByZXR1cm4gLTE7IC8vIEluZGljYXRlcyBtZWFzdXJlbWVudCBmYWlsdXJlXG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldCBkZXRhaWxlZCBUeXBlU2NyaXB0IGVycm9yIGJyZWFrZG93biBieSB0eXBlXG4gICAqL1xuICBhc3luYyBnZXRUeXBlU2NyaXB0RXJyb3JCcmVha2Rvd24oKTogUHJvbWlzZTxSZWNvcmQ8c3RyaW5nLCBudW1iZXI+PiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IG91dHB1dCA9IGV4ZWNTeW5jKCd5YXJuIHRzYyAtLW5vRW1pdCAtLXNraXBMaWJDaGVjayAyPiYxIHwgZ3JlcCAtRSBcImVycm9yIFRTXCIgfCBzZWQgXFwncy8uKmVycm9yIC8vXFwnIHwgY3V0IC1kXFwnOlxcJyAtZjEgfCBzb3J0IHwgdW5pcSAtYyB8IHNvcnQgLW5yJywge1xuICAgICAgICBlbmNvZGluZzogJ3V0ZjgnLFxuICAgICAgICBzdGRpbzogJ3BpcGUnXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgYnJlYWtkb3duOiBSZWNvcmQ8c3RyaW5nLCBudW1iZXI+ID0ge307XG4gICAgICBjb25zdCBsaW5lcyA9IG91dHB1dC50cmltKCkuc3BsaXQoJ1xcbicpLmZpbHRlcihsaW5lID0+IGxpbmUudHJpbSgpKTtcblxuICAgICAgZm9yIChjb25zdCBsaW5lIG9mIGxpbmVzKSB7XG4gICAgICAgIGNvbnN0IG1hdGNoID0gbGluZS50cmltKCkubWF0Y2goL15cXHMqKFxcZCspXFxzKyguKykkLyk7XG4gICAgICAgIGlmIChtYXRjaCkge1xuICAgICAgICAgIGNvbnN0IGNvdW50ID0gcGFyc2VJbnQobWF0Y2hbMV0pO1xuICAgICAgICAgIGNvbnN0IGVycm9yVHlwZSA9IG1hdGNoWzJdLnRyaW0oKTtcbiAgICAgICAgICBicmVha2Rvd25bZXJyb3JUeXBlXSA9IGNvdW50O1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBicmVha2Rvd247XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS53YXJuKGBXYXJuaW5nOiBDb3VsZCBub3QgZ2V0IFR5cGVTY3JpcHQgZXJyb3IgYnJlYWtkb3duOiAke2Vycm9yLm1lc3NhZ2V9YCk7XG4gICAgICByZXR1cm4ge307XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldCBjdXJyZW50IGxpbnRpbmcgd2FybmluZyBjb3VudFxuICAgKi9cbiAgYXN5bmMgZ2V0TGludGluZ1dhcm5pbmdDb3VudCgpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBVc2luZyB5YXJuIGxpbnQgdG8gZ2V0IHdhcm5pbmcgY291bnRcbiAgICAgIGNvbnN0IG91dHB1dCA9IGV4ZWNTeW5jKCd5YXJuIGxpbnQgMj4mMSB8IGdyZXAgLWMgXCJ3YXJuaW5nXCInLCB7XG4gICAgICAgIGVuY29kaW5nOiAndXRmOCcsXG4gICAgICAgIHN0ZGlvOiAncGlwZSdcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBjb25zdCBjb3VudCA9IHBhcnNlSW50KG91dHB1dC50cmltKCkpIHx8IDA7XG4gICAgICByZXR1cm4gY291bnQ7XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgLy8gSWYgZ3JlcCBmaW5kcyBubyBtYXRjaGVzLCBpdCByZXR1cm5zIGV4aXQgY29kZSAxLCBidXQgdGhhdCBtZWFucyAwIHdhcm5pbmdzXG4gICAgICBpZiAoZXJyb3Iuc3RhdHVzID09PSAxKSB7XG4gICAgICAgIHJldHVybiAwO1xuICAgICAgfVxuICAgICAgXG4gICAgICBjb25zb2xlLndhcm4oYFdhcm5pbmc6IENvdWxkIG5vdCBnZXQgbGludGluZyB3YXJuaW5nIGNvdW50OiAke2Vycm9yLm1lc3NhZ2V9YCk7XG4gICAgICByZXR1cm4gLTE7IC8vIEluZGljYXRlcyBtZWFzdXJlbWVudCBmYWlsdXJlXG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldCBkZXRhaWxlZCBsaW50aW5nIHdhcm5pbmcgYnJlYWtkb3duIGJ5IHR5cGVcbiAgICovXG4gIGFzeW5jIGdldExpbnRpbmdXYXJuaW5nQnJlYWtkb3duKCk6IFByb21pc2U8UmVjb3JkPHN0cmluZywgbnVtYmVyPj4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBvdXRwdXQgPSBleGVjU3luYygneWFybiBsaW50IDI+JjEnLCB7XG4gICAgICAgIGVuY29kaW5nOiAndXRmOCcsXG4gICAgICAgIHN0ZGlvOiAncGlwZSdcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBicmVha2Rvd246IFJlY29yZDxzdHJpbmcsIG51bWJlcj4gPSB7fTtcbiAgICAgIGNvbnN0IGxpbmVzID0gb3V0cHV0LnNwbGl0KCdcXG4nKTtcblxuICAgICAgZm9yIChjb25zdCBsaW5lIG9mIGxpbmVzKSB7XG4gICAgICAgIC8vIExvb2sgZm9yIEVTTGludCB3YXJuaW5nIHBhdHRlcm5zXG4gICAgICAgIGNvbnN0IHdhcm5pbmdNYXRjaCA9IGxpbmUubWF0Y2goL3dhcm5pbmdcXHMrKC4rPylcXHMrKEB0eXBlc2NyaXB0LWVzbGludFxcL1tcXHctXSt8W1xcdy1dKykvKTtcbiAgICAgICAgaWYgKHdhcm5pbmdNYXRjaCkge1xuICAgICAgICAgIGNvbnN0IHJ1bGVUeXBlID0gd2FybmluZ01hdGNoWzJdO1xuICAgICAgICAgIGJyZWFrZG93bltydWxlVHlwZV0gPSAoYnJlYWtkb3duW3J1bGVUeXBlXSB8fCAwKSArIDE7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIGJyZWFrZG93bjtcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLndhcm4oYFdhcm5pbmc6IENvdWxkIG5vdCBnZXQgbGludGluZyB3YXJuaW5nIGJyZWFrZG93bjogJHtlcnJvci5tZXNzYWdlfWApO1xuICAgICAgcmV0dXJuIHt9O1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBNZWFzdXJlIGJ1aWxkIHRpbWUgdXNpbmcgdGltZSBjb21tYW5kXG4gICAqL1xuICBhc3luYyBnZXRCdWlsZFRpbWUoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3Qgc3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICAgIFxuICAgICAgLy8gUnVuIGJ1aWxkIGNvbW1hbmQgYW5kIG1lYXN1cmUgdGltZVxuICAgICAgZXhlY1N5bmMoJ3lhcm4gYnVpbGQnLCB7XG4gICAgICAgIGVuY29kaW5nOiAndXRmOCcsXG4gICAgICAgIHN0ZGlvOiAncGlwZSdcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBjb25zdCBlbmRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICAgIGNvbnN0IGJ1aWxkVGltZVNlY29uZHMgPSAoZW5kVGltZSAtIHN0YXJ0VGltZSkgLyAxMDAwO1xuICAgICAgXG4gICAgICByZXR1cm4gYnVpbGRUaW1lU2Vjb25kcztcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLndhcm4oYFdhcm5pbmc6IEJ1aWxkIGZhaWxlZCBkdXJpbmcgdGltaW5nOiAke2Vycm9yLm1lc3NhZ2V9YCk7XG4gICAgICByZXR1cm4gLTE7IC8vIEluZGljYXRlcyBidWlsZCBmYWlsdXJlXG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldCBlbnRlcnByaXNlIHN5c3RlbSBjb3VudCB1c2luZyBpbnRlbGxpZ2VuY2Ugc3lzdGVtIHBhdHRlcm5cbiAgICovXG4gIGFzeW5jIGdldEVudGVycHJpc2VTeXN0ZW1Db3VudCgpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBDb3VudCBJTlRFTExJR0VOQ0VfU1lTVEVNIHBhdHRlcm5zIGluIHNvdXJjZSBjb2RlXG4gICAgICBjb25zdCBvdXRwdXQgPSBleGVjU3luYygnZ3JlcCAtciBcIklOVEVMTElHRU5DRV9TWVNURU1cIiBzcmMvIHwgd2MgLWwnLCB7XG4gICAgICAgIGVuY29kaW5nOiAndXRmOCcsXG4gICAgICAgIHN0ZGlvOiAncGlwZSdcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBjb25zdCBjb3VudCA9IHBhcnNlSW50KG91dHB1dC50cmltKCkpIHx8IDA7XG4gICAgICByZXR1cm4gY291bnQ7XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS53YXJuKGBXYXJuaW5nOiBDb3VsZCBub3QgY291bnQgZW50ZXJwcmlzZSBzeXN0ZW1zOiAke2Vycm9yLm1lc3NhZ2V9YCk7XG4gICAgICByZXR1cm4gMDtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2V0IGNhY2hlIGhpdCByYXRlIGZyb20gYnVpbGQgc3lzdGVtXG4gICAqL1xuICBhc3luYyBnZXRDYWNoZUhpdFJhdGUoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICB0cnkge1xuICAgICAgLy8gVGhpcyB3b3VsZCBuZWVkIHRvIGJlIGltcGxlbWVudGVkIGJhc2VkIG9uIHRoZSBzcGVjaWZpYyBidWlsZCBzeXN0ZW1cbiAgICAgIC8vIEZvciBub3csIHJldHVybiBhIG1vY2sgdmFsdWUgYmFzZWQgb24gdHlwaWNhbCBwZXJmb3JtYW5jZVxuICAgICAgcmV0dXJuIDAuODsgLy8gODAlIGNhY2hlIGhpdCByYXRlXG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS53YXJuKGBXYXJuaW5nOiBDb3VsZCBub3QgbWVhc3VyZSBjYWNoZSBoaXQgcmF0ZTogJHtlcnJvci5tZXNzYWdlfWApO1xuICAgICAgcmV0dXJuIDA7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldCBjdXJyZW50IG1lbW9yeSB1c2FnZSBkdXJpbmcgYnVpbGRcbiAgICovXG4gIGFzeW5jIGdldE1lbW9yeVVzYWdlKCk6IFByb21pc2U8bnVtYmVyPiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIEdldCBOb2RlLmpzIHByb2Nlc3MgbWVtb3J5IHVzYWdlXG4gICAgICBjb25zdCBtZW1Vc2FnZSA9IHByb2Nlc3MubWVtb3J5VXNhZ2UoKTtcbiAgICAgIGNvbnN0IG1lbW9yeU1CID0gbWVtVXNhZ2UuaGVhcFVzZWQgLyAxMDI0IC8gMTAyNDtcbiAgICAgIFxuICAgICAgcmV0dXJuIE1hdGgucm91bmQobWVtb3J5TUIpO1xuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUud2FybihgV2FybmluZzogQ291bGQgbm90IG1lYXN1cmUgbWVtb3J5IHVzYWdlOiAke2Vycm9yLm1lc3NhZ2V9YCk7XG4gICAgICByZXR1cm4gMDtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2V0IGJ1bmRsZSBzaXplIGluZm9ybWF0aW9uXG4gICAqL1xuICBhc3luYyBnZXRCdW5kbGVTaXplKCk6IFByb21pc2U8bnVtYmVyPiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIENoZWNrIGZvciBidWlsZCBvdXRwdXQgZGlyZWN0b3J5XG4gICAgICBjb25zdCBidWlsZERpcnMgPSBbJy5uZXh0JywgJ2Rpc3QnLCAnYnVpbGQnXTtcbiAgICAgIGxldCB0b3RhbFNpemUgPSAwO1xuXG4gICAgICBmb3IgKGNvbnN0IGRpciBvZiBidWlsZERpcnMpIHtcbiAgICAgICAgaWYgKGZzLmV4aXN0c1N5bmMoZGlyKSkge1xuICAgICAgICAgIGNvbnN0IG91dHB1dCA9IGV4ZWNTeW5jKGBkdSAtc2sgJHtkaXJ9IHwgY3V0IC1mMWAsIHtcbiAgICAgICAgICAgIGVuY29kaW5nOiAndXRmOCcsXG4gICAgICAgICAgICBzdGRpbzogJ3BpcGUnXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgXG4gICAgICAgICAgY29uc3Qgc2l6ZUtCID0gcGFyc2VJbnQob3V0cHV0LnRyaW0oKSkgfHwgMDtcbiAgICAgICAgICB0b3RhbFNpemUgKz0gc2l6ZUtCO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0b3RhbFNpemU7XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS53YXJuKGBXYXJuaW5nOiBDb3VsZCBub3QgbWVhc3VyZSBidW5kbGUgc2l6ZTogJHtlcnJvci5tZXNzYWdlfWApO1xuICAgICAgcmV0dXJuIDA7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldCBjb21wcmVoZW5zaXZlIHByb2dyZXNzIG1ldHJpY3NcbiAgICovXG4gIGFzeW5jIGdldFByb2dyZXNzTWV0cmljcygpOiBQcm9taXNlPFByb2dyZXNzTWV0cmljcz4ge1xuICAgIGNvbnN0IHR5cGVTY3JpcHRFcnJvckNvdW50ID0gYXdhaXQgdGhpcy5nZXRUeXBlU2NyaXB0RXJyb3JDb3VudCgpO1xuICAgIGNvbnN0IGxpbnRpbmdXYXJuaW5nQ291bnQgPSBhd2FpdCB0aGlzLmdldExpbnRpbmdXYXJuaW5nQ291bnQoKTtcbiAgICBjb25zdCBidWlsZFRpbWUgPSBhd2FpdCB0aGlzLmdldEJ1aWxkVGltZSgpO1xuICAgIGNvbnN0IGVudGVycHJpc2VTeXN0ZW1Db3VudCA9IGF3YWl0IHRoaXMuZ2V0RW50ZXJwcmlzZVN5c3RlbUNvdW50KCk7XG4gICAgY29uc3QgY2FjaGVIaXRSYXRlID0gYXdhaXQgdGhpcy5nZXRDYWNoZUhpdFJhdGUoKTtcbiAgICBjb25zdCBtZW1vcnlVc2FnZSA9IGF3YWl0IHRoaXMuZ2V0TWVtb3J5VXNhZ2UoKTtcblxuICAgIGNvbnN0IG1ldHJpY3M6IFByb2dyZXNzTWV0cmljcyA9IHtcbiAgICAgIHR5cGVTY3JpcHRFcnJvcnM6IHtcbiAgICAgICAgY3VycmVudDogdHlwZVNjcmlwdEVycm9yQ291bnQsXG4gICAgICAgIHRhcmdldDogMCxcbiAgICAgICAgcmVkdWN0aW9uOiBNYXRoLm1heCgwLCA4NiAtIHR5cGVTY3JpcHRFcnJvckNvdW50KSwgLy8gQmFzZWQgb24gaW5pdGlhbCA4NiBlcnJvcnNcbiAgICAgICAgcGVyY2VudGFnZTogdHlwZVNjcmlwdEVycm9yQ291bnQgPj0gMCA/IE1hdGgucm91bmQoKCg4NiAtIHR5cGVTY3JpcHRFcnJvckNvdW50KSAvIDg2KSAqIDEwMCkgOiAwXG4gICAgICB9LFxuICAgICAgbGludGluZ1dhcm5pbmdzOiB7XG4gICAgICAgIGN1cnJlbnQ6IGxpbnRpbmdXYXJuaW5nQ291bnQsXG4gICAgICAgIHRhcmdldDogMCxcbiAgICAgICAgcmVkdWN0aW9uOiBNYXRoLm1heCgwLCA0NTA2IC0gbGludGluZ1dhcm5pbmdDb3VudCksIC8vIEJhc2VkIG9uIGluaXRpYWwgNDUwNiB3YXJuaW5nc1xuICAgICAgICBwZXJjZW50YWdlOiBsaW50aW5nV2FybmluZ0NvdW50ID49IDAgPyBNYXRoLnJvdW5kKCgoNDUwNiAtIGxpbnRpbmdXYXJuaW5nQ291bnQpIC8gNDUwNikgKiAxMDApIDogMFxuICAgICAgfSxcbiAgICAgIGJ1aWxkUGVyZm9ybWFuY2U6IHtcbiAgICAgICAgY3VycmVudFRpbWU6IGJ1aWxkVGltZSxcbiAgICAgICAgdGFyZ2V0VGltZTogMTAsXG4gICAgICAgIGNhY2hlSGl0UmF0ZTogY2FjaGVIaXRSYXRlLFxuICAgICAgICBtZW1vcnlVc2FnZTogbWVtb3J5VXNhZ2VcbiAgICAgIH0sXG4gICAgICBlbnRlcnByaXNlU3lzdGVtczoge1xuICAgICAgICBjdXJyZW50OiBlbnRlcnByaXNlU3lzdGVtQ291bnQsXG4gICAgICAgIHRhcmdldDogMjAwLFxuICAgICAgICB0cmFuc2Zvcm1lZEV4cG9ydHM6IE1hdGgubWF4KDAsIGVudGVycHJpc2VTeXN0ZW1Db3VudCAtIDApIC8vIEFzc3VtaW5nIHN0YXJ0aW5nIGZyb20gMFxuICAgICAgfVxuICAgIH07XG5cbiAgICAvLyBTdG9yZSBtZXRyaWNzIGluIGhpc3RvcnlcbiAgICB0aGlzLm1ldHJpY3NIaXN0b3J5LnB1c2gobWV0cmljcyk7XG4gICAgdGhpcy5sYXN0TWV0cmljc1VwZGF0ZSA9IG5ldyBEYXRlKCk7XG5cbiAgICAvLyBLZWVwIG9ubHkgcmVjZW50IGhpc3RvcnkgdG8gcHJldmVudCBtZW1vcnkgaXNzdWVzXG4gICAgaWYgKHRoaXMubWV0cmljc0hpc3RvcnkubGVuZ3RoID4gMTAwKSB7XG4gICAgICB0aGlzLm1ldHJpY3NIaXN0b3J5ID0gdGhpcy5tZXRyaWNzSGlzdG9yeS5zbGljZSgtNTApO1xuICAgIH1cblxuICAgIHJldHVybiBtZXRyaWNzO1xuICB9XG5cbiAgLyoqXG4gICAqIFZhbGlkYXRlIG1pbGVzdG9uZSBhY2hpZXZlbWVudFxuICAgKi9cbiAgYXN5bmMgdmFsaWRhdGVNaWxlc3RvbmUobWlsZXN0b25lOiBNaWxlc3RvbmUpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICBjb25zdCBtZXRyaWNzID0gYXdhaXQgdGhpcy5nZXRQcm9ncmVzc01ldHJpY3MoKTtcblxuICAgIHN3aXRjaCAobWlsZXN0b25lKSB7XG4gICAgICBjYXNlICd6ZXJvLXR5cGVzY3JpcHQtZXJyb3JzJzpcbiAgICAgICAgcmV0dXJuIG1ldHJpY3MudHlwZVNjcmlwdEVycm9ycy5jdXJyZW50ID09PSAwO1xuICAgICAgXG4gICAgICBjYXNlICd6ZXJvLWxpbnRpbmctd2FybmluZ3MnOlxuICAgICAgICByZXR1cm4gbWV0cmljcy5saW50aW5nV2FybmluZ3MuY3VycmVudCA9PT0gMDtcbiAgICAgIFxuICAgICAgY2FzZSAnYnVpbGQtdGltZS11bmRlci0xMHMnOlxuICAgICAgICByZXR1cm4gbWV0cmljcy5idWlsZFBlcmZvcm1hbmNlLmN1cnJlbnRUaW1lIDw9IDEwO1xuICAgICAgXG4gICAgICBjYXNlICdlbnRlcnByaXNlLXN5c3RlbXMtMjAwJzpcbiAgICAgICAgcmV0dXJuIG1ldHJpY3MuZW50ZXJwcmlzZVN5c3RlbXMuY3VycmVudCA+PSAyMDA7XG4gICAgICBcbiAgICAgIGNhc2UgJ3BoYXNlLTEtY29tcGxldGUnOlxuICAgICAgICByZXR1cm4gbWV0cmljcy50eXBlU2NyaXB0RXJyb3JzLmN1cnJlbnQgPT09IDA7XG4gICAgICBcbiAgICAgIGNhc2UgJ3BoYXNlLTItY29tcGxldGUnOlxuICAgICAgICByZXR1cm4gbWV0cmljcy5saW50aW5nV2FybmluZ3MuY3VycmVudCA9PT0gMDtcbiAgICAgIFxuICAgICAgY2FzZSAncGhhc2UtMy1jb21wbGV0ZSc6XG4gICAgICAgIHJldHVybiBtZXRyaWNzLmVudGVycHJpc2VTeXN0ZW1zLmN1cnJlbnQgPj0gMjAwO1xuICAgICAgXG4gICAgICBjYXNlICdwaGFzZS00LWNvbXBsZXRlJzpcbiAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICBtZXRyaWNzLmJ1aWxkUGVyZm9ybWFuY2UuY3VycmVudFRpbWUgPD0gMTAgJiZcbiAgICAgICAgICBtZXRyaWNzLmJ1aWxkUGVyZm9ybWFuY2UuY2FjaGVIaXRSYXRlID49IDAuOCAmJlxuICAgICAgICAgIG1ldHJpY3MuYnVpbGRQZXJmb3JtYW5jZS5tZW1vcnlVc2FnZSA8PSA1MFxuICAgICAgICApO1xuICAgICAgXG4gICAgICBkZWZhdWx0OlxuICAgICAgICBjb25zb2xlLndhcm4oYFVua25vd24gbWlsZXN0b25lOiAke21pbGVzdG9uZX1gKTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZSBjb21wcmVoZW5zaXZlIHByb2dyZXNzIHJlcG9ydFxuICAgKi9cbiAgYXN5bmMgZ2VuZXJhdGVQcm9ncmVzc1JlcG9ydCgpOiBQcm9taXNlPFByb2dyZXNzUmVwb3J0PiB7XG4gICAgY29uc3QgY3VycmVudE1ldHJpY3MgPSBhd2FpdCB0aGlzLmdldFByb2dyZXNzTWV0cmljcygpO1xuICAgIGNvbnN0IHRhcmdldE1ldHJpY3M6IFByb2dyZXNzTWV0cmljcyA9IHtcbiAgICAgIHR5cGVTY3JpcHRFcnJvcnM6IHtcbiAgICAgICAgY3VycmVudDogMCxcbiAgICAgICAgdGFyZ2V0OiAwLFxuICAgICAgICByZWR1Y3Rpb246IDg2LFxuICAgICAgICBwZXJjZW50YWdlOiAxMDBcbiAgICAgIH0sXG4gICAgICBsaW50aW5nV2FybmluZ3M6IHtcbiAgICAgICAgY3VycmVudDogMCxcbiAgICAgICAgdGFyZ2V0OiAwLFxuICAgICAgICByZWR1Y3Rpb246IDQ1MDYsXG4gICAgICAgIHBlcmNlbnRhZ2U6IDEwMFxuICAgICAgfSxcbiAgICAgIGJ1aWxkUGVyZm9ybWFuY2U6IHtcbiAgICAgICAgY3VycmVudFRpbWU6IDgsXG4gICAgICAgIHRhcmdldFRpbWU6IDEwLFxuICAgICAgICBjYWNoZUhpdFJhdGU6IDAuOCxcbiAgICAgICAgbWVtb3J5VXNhZ2U6IDQ1XG4gICAgICB9LFxuICAgICAgZW50ZXJwcmlzZVN5c3RlbXM6IHtcbiAgICAgICAgY3VycmVudDogMjAwLFxuICAgICAgICB0YXJnZXQ6IDIwMCxcbiAgICAgICAgdHJhbnNmb3JtZWRFeHBvcnRzOiAyMDBcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgLy8gQ2FsY3VsYXRlIG92ZXJhbGwgcHJvZ3Jlc3NcbiAgICBjb25zdCB0eXBlU2NyaXB0UHJvZ3Jlc3MgPSBjdXJyZW50TWV0cmljcy50eXBlU2NyaXB0RXJyb3JzLnBlcmNlbnRhZ2U7XG4gICAgY29uc3QgbGludGluZ1Byb2dyZXNzID0gY3VycmVudE1ldHJpY3MubGludGluZ1dhcm5pbmdzLnBlcmNlbnRhZ2U7XG4gICAgY29uc3QgYnVpbGRQcm9ncmVzcyA9IGN1cnJlbnRNZXRyaWNzLmJ1aWxkUGVyZm9ybWFuY2UuY3VycmVudFRpbWUgPD0gMTAgPyAxMDAgOiAwO1xuICAgIGNvbnN0IGVudGVycHJpc2VQcm9ncmVzcyA9IChjdXJyZW50TWV0cmljcy5lbnRlcnByaXNlU3lzdGVtcy5jdXJyZW50IC8gMjAwKSAqIDEwMDtcbiAgICBcbiAgICBjb25zdCBvdmVyYWxsUHJvZ3Jlc3MgPSBNYXRoLnJvdW5kKCh0eXBlU2NyaXB0UHJvZ3Jlc3MgKyBsaW50aW5nUHJvZ3Jlc3MgKyBidWlsZFByb2dyZXNzICsgZW50ZXJwcmlzZVByb2dyZXNzKSAvIDQpO1xuXG4gICAgLy8gR2VuZXJhdGUgcGhhc2UgcmVwb3J0c1xuICAgIGNvbnN0IHBoYXNlczogUGhhc2VSZXBvcnRbXSA9IFtcbiAgICAgIHtcbiAgICAgICAgcGhhc2VJZDogJ3BoYXNlMScsXG4gICAgICAgIHBoYXNlTmFtZTogJ1R5cGVTY3JpcHQgRXJyb3IgRWxpbWluYXRpb24nLFxuICAgICAgICBzdGFydFRpbWU6IG5ldyBEYXRlKCksIC8vIFRoaXMgc2hvdWxkIGJlIHRyYWNrZWQgcHJvcGVybHlcbiAgICAgICAgc3RhdHVzOiBjdXJyZW50TWV0cmljcy50eXBlU2NyaXB0RXJyb3JzLmN1cnJlbnQgPT09IDAgPyBQaGFzZVN0YXR1cy5DT01QTEVURUQgOiBQaGFzZVN0YXR1cy5JTl9QUk9HUkVTUyxcbiAgICAgICAgbWV0cmljczogY3VycmVudE1ldHJpY3MsXG4gICAgICAgIGFjaGlldmVtZW50czogY3VycmVudE1ldHJpY3MudHlwZVNjcmlwdEVycm9ycy5jdXJyZW50ID09PSAwID8gWydaZXJvIFR5cGVTY3JpcHQgZXJyb3JzIGFjaGlldmVkJ10gOiBbXSxcbiAgICAgICAgaXNzdWVzOiBjdXJyZW50TWV0cmljcy50eXBlU2NyaXB0RXJyb3JzLmN1cnJlbnQgPiAwID8gW2Ake2N1cnJlbnRNZXRyaWNzLnR5cGVTY3JpcHRFcnJvcnMuY3VycmVudH0gVHlwZVNjcmlwdCBlcnJvcnMgcmVtYWluaW5nYF0gOiBbXSxcbiAgICAgICAgcmVjb21tZW5kYXRpb25zOiBjdXJyZW50TWV0cmljcy50eXBlU2NyaXB0RXJyb3JzLmN1cnJlbnQgPiAwID8gWydDb250aW51ZSB3aXRoIEVuaGFuY2VkIFR5cGVTY3JpcHQgRXJyb3IgRml4ZXIgdjMuMCddIDogW11cbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIHBoYXNlSWQ6ICdwaGFzZTInLFxuICAgICAgICBwaGFzZU5hbWU6ICdMaW50aW5nIEV4Y2VsbGVuY2UgQWNoaWV2ZW1lbnQnLFxuICAgICAgICBzdGFydFRpbWU6IG5ldyBEYXRlKCksXG4gICAgICAgIHN0YXR1czogY3VycmVudE1ldHJpY3MubGludGluZ1dhcm5pbmdzLmN1cnJlbnQgPT09IDAgPyBQaGFzZVN0YXR1cy5DT01QTEVURUQgOiBQaGFzZVN0YXR1cy5JTl9QUk9HUkVTUyxcbiAgICAgICAgbWV0cmljczogY3VycmVudE1ldHJpY3MsXG4gICAgICAgIGFjaGlldmVtZW50czogY3VycmVudE1ldHJpY3MubGludGluZ1dhcm5pbmdzLmN1cnJlbnQgPT09IDAgPyBbJ1plcm8gbGludGluZyB3YXJuaW5ncyBhY2hpZXZlZCddIDogW10sXG4gICAgICAgIGlzc3VlczogY3VycmVudE1ldHJpY3MubGludGluZ1dhcm5pbmdzLmN1cnJlbnQgPiAwID8gW2Ake2N1cnJlbnRNZXRyaWNzLmxpbnRpbmdXYXJuaW5ncy5jdXJyZW50fSBsaW50aW5nIHdhcm5pbmdzIHJlbWFpbmluZ2BdIDogW10sXG4gICAgICAgIHJlY29tbWVuZGF0aW9uczogY3VycmVudE1ldHJpY3MubGludGluZ1dhcm5pbmdzLmN1cnJlbnQgPiAwID8gWydDb250aW51ZSB3aXRoIHN5c3RlbWF0aWMgbGludGluZyBmaXhlcyddIDogW11cbiAgICAgIH1cbiAgICBdO1xuXG4gICAgLy8gRXN0aW1hdGUgY29tcGxldGlvbiB0aW1lIGJhc2VkIG9uIGN1cnJlbnQgcHJvZ3Jlc3MgcmF0ZVxuICAgIGNvbnN0IGVzdGltYXRlZENvbXBsZXRpb24gPSBuZXcgRGF0ZSgpO1xuICAgIGVzdGltYXRlZENvbXBsZXRpb24uc2V0RGF0ZShlc3RpbWF0ZWRDb21wbGV0aW9uLmdldERhdGUoKSArIE1hdGguY2VpbCgoMTAwIC0gb3ZlcmFsbFByb2dyZXNzKSAvIDEwKSk7IC8vIFJvdWdoIGVzdGltYXRlXG5cbiAgICByZXR1cm4ge1xuICAgICAgY2FtcGFpZ25JZDogJ3BlcmZlY3QtY29kZWJhc2UtY2FtcGFpZ24nLFxuICAgICAgb3ZlcmFsbFByb2dyZXNzLFxuICAgICAgcGhhc2VzLFxuICAgICAgY3VycmVudE1ldHJpY3MsXG4gICAgICB0YXJnZXRNZXRyaWNzLFxuICAgICAgZXN0aW1hdGVkQ29tcGxldGlvblxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogR2V0IG1ldHJpY3MgaGlzdG9yeSBmb3IgdHJlbmQgYW5hbHlzaXNcbiAgICovXG4gIGdldE1ldHJpY3NIaXN0b3J5KCk6IFByb2dyZXNzTWV0cmljc1tdIHtcbiAgICByZXR1cm4gWy4uLnRoaXMubWV0cmljc0hpc3RvcnldO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBtZXRyaWNzIGltcHJvdmVtZW50IG92ZXIgdGltZVxuICAgKi9cbiAgZ2V0TWV0cmljc0ltcHJvdmVtZW50KCk6IHtcbiAgICB0eXBlU2NyaXB0RXJyb3JzUmVkdWNlZDogbnVtYmVyO1xuICAgIGxpbnRpbmdXYXJuaW5nc1JlZHVjZWQ6IG51bWJlcjtcbiAgICBidWlsZFRpbWVJbXByb3ZlZDogbnVtYmVyO1xuICAgIGVudGVycHJpc2VTeXN0ZW1zQWRkZWQ6IG51bWJlcjtcbiAgfSB7XG4gICAgaWYgKHRoaXMubWV0cmljc0hpc3RvcnkubGVuZ3RoIDwgMikge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdHlwZVNjcmlwdEVycm9yc1JlZHVjZWQ6IDAsXG4gICAgICAgIGxpbnRpbmdXYXJuaW5nc1JlZHVjZWQ6IDAsXG4gICAgICAgIGJ1aWxkVGltZUltcHJvdmVkOiAwLFxuICAgICAgICBlbnRlcnByaXNlU3lzdGVtc0FkZGVkOiAwXG4gICAgICB9O1xuICAgIH1cblxuICAgIGNvbnN0IGZpcnN0ID0gdGhpcy5tZXRyaWNzSGlzdG9yeVswXTtcbiAgICBjb25zdCBsYXRlc3QgPSB0aGlzLm1ldHJpY3NIaXN0b3J5W3RoaXMubWV0cmljc0hpc3RvcnkubGVuZ3RoIC0gMV07XG5cbiAgICByZXR1cm4ge1xuICAgICAgdHlwZVNjcmlwdEVycm9yc1JlZHVjZWQ6IGZpcnN0LnR5cGVTY3JpcHRFcnJvcnMuY3VycmVudCAtIGxhdGVzdC50eXBlU2NyaXB0RXJyb3JzLmN1cnJlbnQsXG4gICAgICBsaW50aW5nV2FybmluZ3NSZWR1Y2VkOiBmaXJzdC5saW50aW5nV2FybmluZ3MuY3VycmVudCAtIGxhdGVzdC5saW50aW5nV2FybmluZ3MuY3VycmVudCxcbiAgICAgIGJ1aWxkVGltZUltcHJvdmVkOiBmaXJzdC5idWlsZFBlcmZvcm1hbmNlLmN1cnJlbnRUaW1lIC0gbGF0ZXN0LmJ1aWxkUGVyZm9ybWFuY2UuY3VycmVudFRpbWUsXG4gICAgICBlbnRlcnByaXNlU3lzdGVtc0FkZGVkOiBsYXRlc3QuZW50ZXJwcmlzZVN5c3RlbXMuY3VycmVudCAtIGZpcnN0LmVudGVycHJpc2VTeXN0ZW1zLmN1cnJlbnRcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEV4cG9ydCBtZXRyaWNzIHRvIEpTT04gZm9yIGV4dGVybmFsIGFuYWx5c2lzXG4gICAqL1xuICBhc3luYyBleHBvcnRNZXRyaWNzKGZpbGVQYXRoOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVwb3J0ID0gYXdhaXQgdGhpcy5nZW5lcmF0ZVByb2dyZXNzUmVwb3J0KCk7XG4gICAgICBjb25zdCBleHBvcnREYXRhID0ge1xuICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcbiAgICAgICAgcmVwb3J0LFxuICAgICAgICBoaXN0b3J5OiB0aGlzLm1ldHJpY3NIaXN0b3J5LFxuICAgICAgICBpbXByb3ZlbWVudDogdGhpcy5nZXRNZXRyaWNzSW1wcm92ZW1lbnQoKVxuICAgICAgfTtcblxuICAgICAgZnMud3JpdGVGaWxlU3luYyhmaWxlUGF0aCwgSlNPTi5zdHJpbmdpZnkoZXhwb3J0RGF0YSwgbnVsbCwgMikpO1xuICAgICAgY29uc29sZS5sb2coYPCfk4ogTWV0cmljcyBleHBvcnRlZCB0bzogJHtmaWxlUGF0aH1gKTtcblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBleHBvcnQgbWV0cmljczogJHtlcnJvci5tZXNzYWdlfWApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBSZXNldCBtZXRyaWNzIGhpc3RvcnkgKGZvciB0ZXN0aW5nIG9yIGZyZXNoIHN0YXJ0KVxuICAgKi9cbiAgcmVzZXRNZXRyaWNzSGlzdG9yeSgpOiB2b2lkIHtcbiAgICB0aGlzLm1ldHJpY3NIaXN0b3J5ID0gW107XG4gICAgdGhpcy5sYXN0TWV0cmljc1VwZGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgY29uc29sZS5sb2coJ/Cfk4ogTWV0cmljcyBoaXN0b3J5IHJlc2V0Jyk7XG4gIH1cbn0iXSwidmVyc2lvbiI6M30=