8d58ad73f665bed60309b18b855a1a3b
"use strict";
/**
 * Agent Hooks for Automated Quality Assurance
 *
 * This module provides React hooks that integrate with Kiro's agent hook system
 * for automatic planetary data validation, ingredient consistency checking,
 * and campaign trigger management.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.useAgentHookConfiguration = exports.useQualityMetricsHook = exports.useBuildQualityMonitoringHook = exports.useTypeScriptCampaignHook = exports.useIngredientConsistencyHook = exports.usePlanetaryDataValidationHook = exports.useAgentHooks = void 0;
const react_1 = require("react");
const automatedQualityAssurance_1 = require("@/utils/automatedQualityAssurance");
const logger_1 = require("@/utils/logger");
/**
 * Main agent hook for automated quality assurance integration
 */
function useAgentHooks(config = {}) {
    const defaultConfig = {
        enablePlanetaryValidation: true,
        enableIngredientValidation: true,
        enableCampaignTriggers: true,
        enablePerformanceMonitoring: true,
        validationInterval: 5 // 5 minutes
    };
    const finalConfig = { ...defaultConfig, ...config };
    const qa = (0, automatedQualityAssurance_1.getAutomatedQualityAssurance)();
    const [hookState, setHookState] = (0, react_1.useState)({
        isActive: false,
        lastValidation: 0,
        validationResults: {},
        campaignTriggers: [],
        qualityMetrics: qa.getQualityMetrics()
    });
    const intervalRef = (0, react_1.useRef)(null);
    // Start agent hooks
    const startAgentHooks = (0, react_1.useCallback)(() => {
        if (hookState.isActive)
            return;
        setHookState(prev => ({ ...prev, isActive: true }));
        // Set up validation interval
        intervalRef.current = setInterval(async () => {
            try {
                const results = {};
                // Planetary data validation
                if (finalConfig.enablePlanetaryValidation) {
                    const planetaryResult = await qa.validatePlanetaryData();
                    results.planetary = planetaryResult;
                    if (!planetaryResult.isValid) {
                        logger_1.logger.warn('Planetary data validation failed:', planetaryResult.issues);
                    }
                }
                // TypeScript error threshold check
                if (finalConfig.enableCampaignTriggers) {
                    const trigger = await qa.checkTypeScriptErrorThreshold();
                    if (trigger?.triggered) {
                        logger_1.logger.warn('TypeScript campaign trigger activated:', trigger);
                    }
                }
                // Update state
                setHookState(prev => ({
                    ...prev,
                    lastValidation: Date.now(),
                    validationResults: { ...prev.validationResults, ...results },
                    campaignTriggers: qa.getActiveCampaignTriggers(),
                    qualityMetrics: qa.getQualityMetrics()
                }));
                logger_1.logger.debug('Agent hooks validation cycle completed');
            }
            catch (error) {
                logger_1.logger.error('Error in agent hooks validation cycle:', error);
            }
        }, finalConfig.validationInterval * 60 * 1000);
        logger_1.logger.info('Agent hooks started with config:', finalConfig);
    }, [finalConfig, hookState.isActive, qa]);
    // Stop agent hooks
    const stopAgentHooks = (0, react_1.useCallback)(() => {
        if (intervalRef.current) {
            clearInterval(intervalRef.current);
            intervalRef.current = null;
        }
        setHookState(prev => ({ ...prev, isActive: false }));
        logger_1.logger.info('Agent hooks stopped');
    }, []);
    // Manual validation trigger
    const triggerValidation = (0, react_1.useCallback)(async (type) => {
        try {
            const results = {};
            if (!type || type === 'all' || type === 'planetary') {
                results.planetary = await qa.validatePlanetaryData();
            }
            if (!type || type === 'all' || type === 'typescript') {
                const trigger = await qa.checkTypeScriptErrorThreshold();
                if (trigger) {
                    setHookState(prev => ({
                        ...prev,
                        campaignTriggers: [...prev.campaignTriggers, trigger]
                    }));
                }
            }
            setHookState(prev => ({
                ...prev,
                lastValidation: Date.now(),
                validationResults: { ...prev.validationResults, ...results },
                qualityMetrics: qa.getQualityMetrics()
            }));
            logger_1.logger.debug('Manual validation triggered:', { type, results });
            return results;
        }
        catch (error) {
            logger_1.logger.error('Error in manual validation:', error);
            throw error;
        }
    }, [qa]);
    // Cleanup on unmount
    (0, react_1.useEffect)(() => {
        return () => {
            stopAgentHooks();
        };
    }, [stopAgentHooks]);
    return {
        hookState,
        startAgentHooks,
        stopAgentHooks,
        triggerValidation,
        isActive: hookState.isActive
    };
}
exports.useAgentHooks = useAgentHooks;
/**
 * Agent hook specifically for planetary data validation
 */
function usePlanetaryDataValidationHook(autoStart = true) {
    const qa = (0, automatedQualityAssurance_1.getAutomatedQualityAssurance)();
    const [validationResult, setValidationResult] = (0, react_1.useState)(null);
    const [isValidating, setIsValidating] = (0, react_1.useState)(false);
    const validatePlanetaryData = (0, react_1.useCallback)(async (date) => {
        setIsValidating(true);
        try {
            const result = await qa.validatePlanetaryData(date);
            setValidationResult(result);
            if (!result.isValid) {
                logger_1.logger.warn('Planetary data validation hook detected issues:', result.issues);
                // Dispatch event for external systems
                if (typeof window !== 'undefined') {
                    window.dispatchEvent(new CustomEvent('planetary-validation-failed', {
                        detail: result
                    }));
                }
            }
            return result;
        }
        catch (error) {
            logger_1.logger.error('Error in planetary data validation hook:', error);
            throw error;
        }
        finally {
            setIsValidating(false);
        }
    }, [qa]);
    // Auto-start validation
    (0, react_1.useEffect)(() => {
        if (autoStart) {
            validatePlanetaryData();
        }
    }, [autoStart, validatePlanetaryData]);
    return {
        validationResult,
        isValidating,
        validatePlanetaryData,
        isValid: validationResult?.isValid ?? null
    };
}
exports.usePlanetaryDataValidationHook = usePlanetaryDataValidationHook;
/**
 * Agent hook for ingredient consistency checking
 */
function useIngredientConsistencyHook() {
    const qa = (0, automatedQualityAssurance_1.getAutomatedQualityAssurance)();
    const [validationResult, setValidationResult] = (0, react_1.useState)(null);
    const [isValidating, setIsValidating] = (0, react_1.useState)(false);
    const validateIngredients = (0, react_1.useCallback)(async (ingredients) => {
        if (ingredients.length === 0) {
            return null;
        }
        setIsValidating(true);
        try {
            const result = qa.validateIngredientConsistency(ingredients);
            setValidationResult(result);
            if (!result.isValid) {
                logger_1.logger.warn('Ingredient consistency validation detected issues:', result.issues);
                // Dispatch event for external systems
                if (typeof window !== 'undefined') {
                    window.dispatchEvent(new CustomEvent('ingredient-validation-failed', {
                        detail: { result, ingredients }
                    }));
                }
            }
            return result;
        }
        catch (error) {
            logger_1.logger.error('Error in ingredient consistency validation:', error);
            throw error;
        }
        finally {
            setIsValidating(false);
        }
    }, [qa]);
    return {
        validationResult,
        isValidating,
        validateIngredients,
        isValid: validationResult?.isValid ?? null
    };
}
exports.useIngredientConsistencyHook = useIngredientConsistencyHook;
/**
 * Agent hook for TypeScript campaign triggers
 */
function useTypeScriptCampaignHook(autoCheck = true) {
    const qa = (0, automatedQualityAssurance_1.getAutomatedQualityAssurance)();
    const [campaignTrigger, setCampaignTrigger] = (0, react_1.useState)(null);
    const [isChecking, setIsChecking] = (0, react_1.useState)(false);
    const checkErrorThreshold = (0, react_1.useCallback)(async () => {
        setIsChecking(true);
        try {
            const trigger = await qa.checkTypeScriptErrorThreshold();
            setCampaignTrigger(trigger);
            if (trigger?.triggered) {
                logger_1.logger.warn('TypeScript campaign trigger activated:', trigger);
                // Dispatch event for campaign system integration
                if (typeof window !== 'undefined') {
                    window.dispatchEvent(new CustomEvent('typescript-campaign-trigger', {
                        detail: trigger
                    }));
                }
            }
            return trigger;
        }
        catch (error) {
            logger_1.logger.error('Error checking TypeScript error threshold:', error);
            throw error;
        }
        finally {
            setIsChecking(false);
        }
    }, [qa]);
    // Auto-check on mount and periodically
    (0, react_1.useEffect)(() => {
        if (autoCheck) {
            checkErrorThreshold();
            // Check every 10 minutes
            const interval = setInterval(checkErrorThreshold, 10 * 60 * 1000);
            return () => clearInterval(interval);
        }
    }, [autoCheck, checkErrorThreshold]);
    return {
        campaignTrigger,
        isChecking,
        checkErrorThreshold,
        isTriggered: campaignTrigger?.triggered ?? false
    };
}
exports.useTypeScriptCampaignHook = useTypeScriptCampaignHook;
/**
 * Agent hook for build quality monitoring
 */
function useBuildQualityMonitoringHook() {
    const qa = (0, automatedQualityAssurance_1.getAutomatedQualityAssurance)();
    const [qualityResult, setQualityResult] = (0, react_1.useState)(null);
    const [isMonitoring, setIsMonitoring] = (0, react_1.useState)(false);
    const monitorBuildQuality = (0, react_1.useCallback)(async (buildMetrics) => {
        setIsMonitoring(true);
        try {
            const result = qa.monitorBuildQuality(buildMetrics);
            setQualityResult(result);
            if (!result.isValid) {
                logger_1.logger.warn('Build quality monitoring detected issues:', result.issues);
                // Dispatch event for external systems
                if (typeof window !== 'undefined') {
                    window.dispatchEvent(new CustomEvent('build-quality-issues', {
                        detail: { result, buildMetrics }
                    }));
                }
            }
            return result;
        }
        catch (error) {
            logger_1.logger.error('Error in build quality monitoring:', error);
            throw error;
        }
        finally {
            setIsMonitoring(false);
        }
    }, [qa]);
    return {
        qualityResult,
        isMonitoring,
        monitorBuildQuality,
        isQualityGood: qualityResult?.isValid ?? null
    };
}
exports.useBuildQualityMonitoringHook = useBuildQualityMonitoringHook;
/**
 * Agent hook for comprehensive quality metrics monitoring
 */
function useQualityMetricsHook(updateInterval = 30000) {
    const qa = (0, automatedQualityAssurance_1.getAutomatedQualityAssurance)();
    const [metrics, setMetrics] = (0, react_1.useState)(qa.getQualityMetrics());
    const [lastUpdate, setLastUpdate] = (0, react_1.useState)(Date.now());
    const updateMetrics = (0, react_1.useCallback)(() => {
        const newMetrics = qa.getQualityMetrics();
        setMetrics(newMetrics);
        setLastUpdate(Date.now());
    }, [qa]);
    // Update metrics periodically
    (0, react_1.useEffect)(() => {
        const interval = setInterval(updateMetrics, updateInterval);
        return () => clearInterval(interval);
    }, [updateMetrics, updateInterval]);
    return {
        metrics,
        lastUpdate,
        updateMetrics
    };
}
exports.useQualityMetricsHook = useQualityMetricsHook;
/**
 * Agent hook configuration management
 */
function useAgentHookConfiguration() {
    const qa = (0, automatedQualityAssurance_1.getAutomatedQualityAssurance)();
    const updateConfiguration = (0, react_1.useCallback)((config) => {
        qa.updateConfig(config);
        logger_1.logger.info('Agent hook configuration updated:', config);
    }, [qa]);
    const getActiveTriggers = (0, react_1.useCallback)(() => {
        return qa.getActiveCampaignTriggers();
    }, [qa]);
    return {
        updateConfiguration,
        getActiveTriggers
    };
}
exports.useAgentHookConfiguration = useAgentHookConfiguration;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9ob29rcy91c2VBZ2VudEhvb2tzLnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7O0dBTUc7OztBQUVILGlDQUFpRTtBQUVqRSxpRkFNMkM7QUFDM0MsMkNBQXdDO0FBbUJ4Qzs7R0FFRztBQUNILFNBQWdCLGFBQWEsQ0FBQyxTQUFtQyxFQUFFO0lBQ2pFLE1BQU0sYUFBYSxHQUFvQjtRQUNyQyx5QkFBeUIsRUFBRSxJQUFJO1FBQy9CLDBCQUEwQixFQUFFLElBQUk7UUFDaEMsc0JBQXNCLEVBQUUsSUFBSTtRQUM1QiwyQkFBMkIsRUFBRSxJQUFJO1FBQ2pDLGtCQUFrQixFQUFFLENBQUMsQ0FBQyxZQUFZO0tBQ25DLENBQUM7SUFFRixNQUFNLFdBQVcsR0FBRyxFQUFFLEdBQUcsYUFBYSxFQUFFLEdBQUcsTUFBTSxFQUFFLENBQUM7SUFDcEQsTUFBTSxFQUFFLEdBQUcsSUFBQSx3REFBNEIsR0FBRSxDQUFDO0lBRTFDLE1BQU0sQ0FBQyxTQUFTLEVBQUUsWUFBWSxDQUFDLEdBQUcsSUFBQSxnQkFBUSxFQUFpQjtRQUN6RCxRQUFRLEVBQUUsS0FBSztRQUNmLGNBQWMsRUFBRSxDQUFDO1FBQ2pCLGlCQUFpQixFQUFFLEVBQUU7UUFDckIsZ0JBQWdCLEVBQUUsRUFBRTtRQUNwQixjQUFjLEVBQUUsRUFBRSxDQUFDLGlCQUFpQixFQUFFO0tBQ3ZDLENBQUMsQ0FBQztJQUVILE1BQU0sV0FBVyxHQUFHLElBQUEsY0FBTSxFQUF3QixJQUFJLENBQUMsQ0FBQztJQUV4RCxvQkFBb0I7SUFDcEIsTUFBTSxlQUFlLEdBQUcsSUFBQSxtQkFBVyxFQUFDLEdBQUcsRUFBRTtRQUN2QyxJQUFJLFNBQVMsQ0FBQyxRQUFRO1lBQUUsT0FBTztRQUUvQixZQUFZLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsR0FBRyxJQUFJLEVBQUUsUUFBUSxFQUFFLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQztRQUVwRCw2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QixHQUFFLENBQUM7SUFFMUMsTUFBTSxtQkFBbUIsR0FBRyxJQUFBLG1CQUFXLEVBQUMsQ0FBQyxNQUF1QyxFQUFFLEVBQUU7UUFDbEYsRUFBRSxDQUFDLFlBQVksQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUN4QixlQUFNLENBQUMsSUFBSSxDQUFDLG1DQUFtQyxFQUFFLE1BQU0sQ0FBQyxDQUFDO0lBQzNELENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7SUFFVCxNQUFNLGlCQUFpQixHQUFHLElBQUEsbUJBQVcsRUFBQyxHQUFHLEVBQUU7UUFDekMsT0FBTyxFQUFFLENBQUMseUJBQXlCLEVBQUUsQ0FBQztJQUN4QyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBRVQsT0FBTztRQUNMLG1CQUFtQjtRQUNuQixpQkFBaUI7S0FDbEIsQ0FBQztBQUNKLENBQUM7QUFoQkQsOERBZ0JDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9HcmVnQ2FzdHJvL0Rlc2t0b3AvV2hhdFRvRWF0TmV4dC9zcmMvaG9va3MvdXNlQWdlbnRIb29rcy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEFnZW50IEhvb2tzIGZvciBBdXRvbWF0ZWQgUXVhbGl0eSBBc3N1cmFuY2VcbiAqIFxuICogVGhpcyBtb2R1bGUgcHJvdmlkZXMgUmVhY3QgaG9va3MgdGhhdCBpbnRlZ3JhdGUgd2l0aCBLaXJvJ3MgYWdlbnQgaG9vayBzeXN0ZW1cbiAqIGZvciBhdXRvbWF0aWMgcGxhbmV0YXJ5IGRhdGEgdmFsaWRhdGlvbiwgaW5ncmVkaWVudCBjb25zaXN0ZW5jeSBjaGVja2luZyxcbiAqIGFuZCBjYW1wYWlnbiB0cmlnZ2VyIG1hbmFnZW1lbnQuXG4gKi9cblxuaW1wb3J0IHsgdXNlRWZmZWN0LCB1c2VDYWxsYmFjaywgdXNlU3RhdGUsIHVzZVJlZiB9IGZyb20gJ3JlYWN0JztcblxuaW1wb3J0IHsgXG4gIGdldEF1dG9tYXRlZFF1YWxpdHlBc3N1cmFuY2UsIFxuICBWYWxpZGF0aW9uUmVzdWx0LCBcbiAgQ2FtcGFpZ25UcmlnZ2VyLCBcbiAgUXVhbGl0eU1ldHJpY3MsXG4gIFF1YWxpdHlBc3N1cmFuY2VDb25maWcgXG59IGZyb20gJ0AvdXRpbHMvYXV0b21hdGVkUXVhbGl0eUFzc3VyYW5jZSc7XG5pbXBvcnQgeyBsb2dnZXIgfSBmcm9tICdAL3V0aWxzL2xvZ2dlcic7XG5pbXBvcnQgeyBFbGVtZW50YWxQcm9wZXJ0aWVzIH0gZnJvbSAnQC91dGlscy9zdGVlcmluZ0ZpbGVJbnRlbGxpZ2VuY2UnO1xuXG5leHBvcnQgaW50ZXJmYWNlIEFnZW50SG9va0NvbmZpZyB7XG4gIGVuYWJsZVBsYW5ldGFyeVZhbGlkYXRpb246IGJvb2xlYW47XG4gIGVuYWJsZUluZ3JlZGllbnRWYWxpZGF0aW9uOiBib29sZWFuO1xuICBlbmFibGVDYW1wYWlnblRyaWdnZXJzOiBib29sZWFuO1xuICBlbmFibGVQZXJmb3JtYW5jZU1vbml0b3Jpbmc6IGJvb2xlYW47XG4gIHZhbGlkYXRpb25JbnRlcnZhbDogbnVtYmVyOyAvLyBtaW51dGVzXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQWdlbnRIb29rU3RhdGUge1xuICBpc0FjdGl2ZTogYm9vbGVhbjtcbiAgbGFzdFZhbGlkYXRpb246IG51bWJlcjtcbiAgdmFsaWRhdGlvblJlc3VsdHM6IFJlY29yZDxzdHJpbmcsIFZhbGlkYXRpb25SZXN1bHQ+O1xuICBjYW1wYWlnblRyaWdnZXJzOiBDYW1wYWlnblRyaWdnZXJbXTtcbiAgcXVhbGl0eU1ldHJpY3M6IFF1YWxpdHlNZXRyaWNzO1xufVxuXG4vKipcbiAqIE1haW4gYWdlbnQgaG9vayBmb3IgYXV0b21hdGVkIHF1YWxpdHkgYXNzdXJhbmNlIGludGVncmF0aW9uXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB1c2VBZ2VudEhvb2tzKGNvbmZpZzogUGFydGlhbDxBZ2VudEhvb2tDb25maWc+ID0ge30pIHtcbiAgY29uc3QgZGVmYXVsdENvbmZpZzogQWdlbnRIb29rQ29uZmlnID0ge1xuICAgIGVuYWJsZVBsYW5ldGFyeVZhbGlkYXRpb246IHRydWUsXG4gICAgZW5hYmxlSW5ncmVkaWVudFZhbGlkYXRpb246IHRydWUsXG4gICAgZW5hYmxlQ2FtcGFpZ25UcmlnZ2VyczogdHJ1ZSxcbiAgICBlbmFibGVQZXJmb3JtYW5jZU1vbml0b3Jpbmc6IHRydWUsXG4gICAgdmFsaWRhdGlvbkludGVydmFsOiA1IC8vIDUgbWludXRlc1xuICB9O1xuXG4gIGNvbnN0IGZpbmFsQ29uZmlnID0geyAuLi5kZWZhdWx0Q29uZmlnLCAuLi5jb25maWcgfTtcbiAgY29uc3QgcWEgPSBnZXRBdXRvbWF0ZWRRdWFsaXR5QXNzdXJhbmNlKCk7XG4gIFxuICBjb25zdCBbaG9va1N0YXRlLCBzZXRIb29rU3RhdGVdID0gdXNlU3RhdGU8QWdlbnRIb29rU3RhdGU+KHtcbiAgICBpc0FjdGl2ZTogZmFsc2UsXG4gICAgbGFzdFZhbGlkYXRpb246IDAsXG4gICAgdmFsaWRhdGlvblJlc3VsdHM6IHt9LFxuICAgIGNhbXBhaWduVHJpZ2dlcnM6IFtdLFxuICAgIHF1YWxpdHlNZXRyaWNzOiBxYS5nZXRRdWFsaXR5TWV0cmljcygpXG4gIH0pO1xuXG4gIGNvbnN0IGludGVydmFsUmVmID0gdXNlUmVmPE5vZGVKUy5UaW1lb3V0IHwgbnVsbD4obnVsbCk7XG5cbiAgLy8gU3RhcnQgYWdlbnQgaG9va3NcbiAgY29uc3Qgc3RhcnRBZ2VudEhvb2tzID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgIGlmIChob29rU3RhdGUuaXNBY3RpdmUpIHJldHVybjtcblxuICAgIHNldEhvb2tTdGF0ZShwcmV2ID0+ICh7IC4uLnByZXYsIGlzQWN0aXZlOiB0cnVlIH0pKTtcbiAgICBcbiAgICAvLyBTZXQgdXAgdmFsaWRhdGlvbiBpbnRlcnZhbFxuICAgIGludGVydmFsUmVmLmN1cnJlbnQgPSBzZXRJbnRlcnZhbChhc3luYyAoKSA9PiB7XG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCByZXN1bHRzOiBSZWNvcmQ8c3RyaW5nLCBWYWxpZGF0aW9uUmVzdWx0PiA9IHt9O1xuICAgICAgICBcbiAgICAgICAgLy8gUGxhbmV0YXJ5IGRhdGEgdmFsaWRhdGlvblxuICAgICAgICBpZiAoZmluYWxDb25maWcuZW5hYmxlUGxhbmV0YXJ5VmFsaWRhdGlvbikge1xuICAgICAgICAgIGNvbnN0IHBsYW5ldGFyeVJlc3VsdCA9IGF3YWl0IHFhLnZhbGlkYXRlUGxhbmV0YXJ5RGF0YSgpO1xuICAgICAgICAgIHJlc3VsdHMucGxhbmV0YXJ5ID0gcGxhbmV0YXJ5UmVzdWx0O1xuICAgICAgICAgIFxuICAgICAgICAgIGlmICghcGxhbmV0YXJ5UmVzdWx0LmlzVmFsaWQpIHtcbiAgICAgICAgICAgIGxvZ2dlci53YXJuKCdQbGFuZXRhcnkgZGF0YSB2YWxpZGF0aW9uIGZhaWxlZDonLCBwbGFuZXRhcnlSZXN1bHQuaXNzdWVzKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICAvLyBUeXBlU2NyaXB0IGVycm9yIHRocmVzaG9sZCBjaGVja1xuICAgICAgICBpZiAoZmluYWxDb25maWcuZW5hYmxlQ2FtcGFpZ25UcmlnZ2Vycykge1xuICAgICAgICAgIGNvbnN0IHRyaWdnZXIgPSBhd2FpdCBxYS5jaGVja1R5cGVTY3JpcHRFcnJvclRocmVzaG9sZCgpO1xuICAgICAgICAgIGlmICh0cmlnZ2VyPy50cmlnZ2VyZWQpIHtcbiAgICAgICAgICAgIGxvZ2dlci53YXJuKCdUeXBlU2NyaXB0IGNhbXBhaWduIHRyaWdnZXIgYWN0aXZhdGVkOicsIHRyaWdnZXIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFVwZGF0ZSBzdGF0ZVxuICAgICAgICBzZXRIb29rU3RhdGUocHJldiA9PiAoe1xuICAgICAgICAgIC4uLnByZXYsXG4gICAgICAgICAgbGFzdFZhbGlkYXRpb246IERhdGUubm93KCksXG4gICAgICAgICAgdmFsaWRhdGlvblJlc3VsdHM6IHsgLi4ucHJldi52YWxpZGF0aW9uUmVzdWx0cywgLi4ucmVzdWx0cyB9LFxuICAgICAgICAgIGNhbXBhaWduVHJpZ2dlcnM6IHFhLmdldEFjdGl2ZUNhbXBhaWduVHJpZ2dlcnMoKSxcbiAgICAgICAgICBxdWFsaXR5TWV0cmljczogcWEuZ2V0UXVhbGl0eU1ldHJpY3MoKVxuICAgICAgICB9KSk7XG5cbiAgICAgICAgbG9nZ2VyLmRlYnVnKCdBZ2VudCBob29rcyB2YWxpZGF0aW9uIGN5Y2xlIGNvbXBsZXRlZCcpO1xuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgbG9nZ2VyLmVycm9yKCdFcnJvciBpbiBhZ2VudCBob29rcyB2YWxpZGF0aW9uIGN5Y2xlOicsIGVycm9yKTtcbiAgICAgIH1cbiAgICB9LCBmaW5hbENvbmZpZy52YWxpZGF0aW9uSW50ZXJ2YWwgKiA2MCAqIDEwMDApO1xuXG4gICAgbG9nZ2VyLmluZm8oJ0FnZW50IGhvb2tzIHN0YXJ0ZWQgd2l0aCBjb25maWc6JywgZmluYWxDb25maWcpO1xuICB9LCBbZmluYWxDb25maWcsIGhvb2tTdGF0ZS5pc0FjdGl2ZSwgcWFdKTtcblxuICAvLyBTdG9wIGFnZW50IGhvb2tzXG4gIGNvbnN0IHN0b3BBZ2VudEhvb2tzID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgIGlmIChpbnRlcnZhbFJlZi5jdXJyZW50KSB7XG4gICAgICBjbGVhckludGVydmFsKGludGVydmFsUmVmLmN1cnJlbnQpO1xuICAgICAgaW50ZXJ2YWxSZWYuY3VycmVudCA9IG51bGw7XG4gICAgfVxuICAgIFxuICAgIHNldEhvb2tTdGF0ZShwcmV2ID0+ICh7IC4uLnByZXYsIGlzQWN0aXZlOiBmYWxzZSB9KSk7XG4gICAgbG9nZ2VyLmluZm8oJ0FnZW50IGhvb2tzIHN0b3BwZWQnKTtcbiAgfSwgW10pO1xuXG4gIC8vIE1hbnVhbCB2YWxpZGF0aW9uIHRyaWdnZXJcbiAgY29uc3QgdHJpZ2dlclZhbGlkYXRpb24gPSB1c2VDYWxsYmFjayhhc3luYyAodHlwZT86ICdwbGFuZXRhcnknIHwgJ2luZ3JlZGllbnQnIHwgJ3R5cGVzY3JpcHQnIHwgJ2FsbCcpID0+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzdWx0czogUmVjb3JkPHN0cmluZywgVmFsaWRhdGlvblJlc3VsdD4gPSB7fTtcbiAgICAgIFxuICAgICAgaWYgKCF0eXBlIHx8IHR5cGUgPT09ICdhbGwnIHx8IHR5cGUgPT09ICdwbGFuZXRhcnknKSB7XG4gICAgICAgIHJlc3VsdHMucGxhbmV0YXJ5ID0gYXdhaXQgcWEudmFsaWRhdGVQbGFuZXRhcnlEYXRhKCk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIGlmICghdHlwZSB8fCB0eXBlID09PSAnYWxsJyB8fCB0eXBlID09PSAndHlwZXNjcmlwdCcpIHtcbiAgICAgICAgY29uc3QgdHJpZ2dlciA9IGF3YWl0IHFhLmNoZWNrVHlwZVNjcmlwdEVycm9yVGhyZXNob2xkKCk7XG4gICAgICAgIGlmICh0cmlnZ2VyKSB7XG4gICAgICAgICAgc2V0SG9va1N0YXRlKHByZXYgPT4gKHtcbiAgICAgICAgICAgIC4uLnByZXYsXG4gICAgICAgICAgICBjYW1wYWlnblRyaWdnZXJzOiBbLi4ucHJldi5jYW1wYWlnblRyaWdnZXJzLCB0cmlnZ2VyXVxuICAgICAgICAgIH0pKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBzZXRIb29rU3RhdGUocHJldiA9PiAoe1xuICAgICAgICAuLi5wcmV2LFxuICAgICAgICBsYXN0VmFsaWRhdGlvbjogRGF0ZS5ub3coKSxcbiAgICAgICAgdmFsaWRhdGlvblJlc3VsdHM6IHsgLi4ucHJldi52YWxpZGF0aW9uUmVzdWx0cywgLi4ucmVzdWx0cyB9LFxuICAgICAgICBxdWFsaXR5TWV0cmljczogcWEuZ2V0UXVhbGl0eU1ldHJpY3MoKVxuICAgICAgfSkpO1xuXG4gICAgICBsb2dnZXIuZGVidWcoJ01hbnVhbCB2YWxpZGF0aW9uIHRyaWdnZXJlZDonLCB7IHR5cGUsIHJlc3VsdHMgfSk7XG4gICAgICByZXR1cm4gcmVzdWx0cztcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdFcnJvciBpbiBtYW51YWwgdmFsaWRhdGlvbjonLCBlcnJvcik7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH0sIFtxYV0pO1xuXG4gIC8vIENsZWFudXAgb24gdW5tb3VudFxuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICBzdG9wQWdlbnRIb29rcygpO1xuICAgIH07XG4gIH0sIFtzdG9wQWdlbnRIb29rc10pO1xuXG4gIHJldHVybiB7XG4gICAgaG9va1N0YXRlLFxuICAgIHN0YXJ0QWdlbnRIb29rcyxcbiAgICBzdG9wQWdlbnRIb29rcyxcbiAgICB0cmlnZ2VyVmFsaWRhdGlvbixcbiAgICBpc0FjdGl2ZTogaG9va1N0YXRlLmlzQWN0aXZlXG4gIH07XG59XG5cbi8qKlxuICogQWdlbnQgaG9vayBzcGVjaWZpY2FsbHkgZm9yIHBsYW5ldGFyeSBkYXRhIHZhbGlkYXRpb25cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHVzZVBsYW5ldGFyeURhdGFWYWxpZGF0aW9uSG9vayhhdXRvU3RhcnQ6IGJvb2xlYW4gPSB0cnVlKSB7XG4gIGNvbnN0IHFhID0gZ2V0QXV0b21hdGVkUXVhbGl0eUFzc3VyYW5jZSgpO1xuICBjb25zdCBbdmFsaWRhdGlvblJlc3VsdCwgc2V0VmFsaWRhdGlvblJlc3VsdF0gPSB1c2VTdGF0ZTxWYWxpZGF0aW9uUmVzdWx0IHwgbnVsbD4obnVsbCk7XG4gIGNvbnN0IFtpc1ZhbGlkYXRpbmcsIHNldElzVmFsaWRhdGluZ10gPSB1c2VTdGF0ZShmYWxzZSk7XG5cbiAgY29uc3QgdmFsaWRhdGVQbGFuZXRhcnlEYXRhID0gdXNlQ2FsbGJhY2soYXN5bmMgKGRhdGU/OiBEYXRlKSA9PiB7XG4gICAgc2V0SXNWYWxpZGF0aW5nKHRydWUpO1xuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBxYS52YWxpZGF0ZVBsYW5ldGFyeURhdGEoZGF0ZSk7XG4gICAgICBzZXRWYWxpZGF0aW9uUmVzdWx0KHJlc3VsdCk7XG4gICAgICBcbiAgICAgIGlmICghcmVzdWx0LmlzVmFsaWQpIHtcbiAgICAgICAgbG9nZ2VyLndhcm4oJ1BsYW5ldGFyeSBkYXRhIHZhbGlkYXRpb24gaG9vayBkZXRlY3RlZCBpc3N1ZXM6JywgcmVzdWx0Lmlzc3Vlcyk7XG4gICAgICAgIFxuICAgICAgICAvLyBEaXNwYXRjaCBldmVudCBmb3IgZXh0ZXJuYWwgc3lzdGVtc1xuICAgICAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICB3aW5kb3cuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoJ3BsYW5ldGFyeS12YWxpZGF0aW9uLWZhaWxlZCcsIHtcbiAgICAgICAgICAgIGRldGFpbDogcmVzdWx0XG4gICAgICAgICAgfSkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignRXJyb3IgaW4gcGxhbmV0YXJ5IGRhdGEgdmFsaWRhdGlvbiBob29rOicsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH0gZmluYWxseSB7XG4gICAgICBzZXRJc1ZhbGlkYXRpbmcoZmFsc2UpO1xuICAgIH1cbiAgfSwgW3FhXSk7XG5cbiAgLy8gQXV0by1zdGFydCB2YWxpZGF0aW9uXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgaWYgKGF1dG9TdGFydCkge1xuICAgICAgdmFsaWRhdGVQbGFuZXRhcnlEYXRhKCk7XG4gICAgfVxuICB9LCBbYXV0b1N0YXJ0LCB2YWxpZGF0ZVBsYW5ldGFyeURhdGFdKTtcblxuICByZXR1cm4ge1xuICAgIHZhbGlkYXRpb25SZXN1bHQsXG4gICAgaXNWYWxpZGF0aW5nLFxuICAgIHZhbGlkYXRlUGxhbmV0YXJ5RGF0YSxcbiAgICBpc1ZhbGlkOiB2YWxpZGF0aW9uUmVzdWx0Py5pc1ZhbGlkID8/IG51bGxcbiAgfTtcbn1cblxuLyoqXG4gKiBBZ2VudCBob29rIGZvciBpbmdyZWRpZW50IGNvbnNpc3RlbmN5IGNoZWNraW5nXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB1c2VJbmdyZWRpZW50Q29uc2lzdGVuY3lIb29rKCkge1xuICBjb25zdCBxYSA9IGdldEF1dG9tYXRlZFF1YWxpdHlBc3N1cmFuY2UoKTtcbiAgY29uc3QgW3ZhbGlkYXRpb25SZXN1bHQsIHNldFZhbGlkYXRpb25SZXN1bHRdID0gdXNlU3RhdGU8VmFsaWRhdGlvblJlc3VsdCB8IG51bGw+KG51bGwpO1xuICBjb25zdCBbaXNWYWxpZGF0aW5nLCBzZXRJc1ZhbGlkYXRpbmddID0gdXNlU3RhdGUoZmFsc2UpO1xuXG4gIGNvbnN0IHZhbGlkYXRlSW5ncmVkaWVudHMgPSB1c2VDYWxsYmFjayhhc3luYyAoaW5ncmVkaWVudHM6IEFycmF5PHtcbiAgICBuYW1lOiBzdHJpbmc7XG4gICAgZWxlbWVudGFsUHJvcGVydGllczogRWxlbWVudGFsUHJvcGVydGllcztcbiAgICBjYXRlZ29yeT86IHN0cmluZztcbiAgfT4pID0+IHtcbiAgICBpZiAoaW5ncmVkaWVudHMubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBzZXRJc1ZhbGlkYXRpbmcodHJ1ZSk7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IHFhLnZhbGlkYXRlSW5ncmVkaWVudENvbnNpc3RlbmN5KGluZ3JlZGllbnRzKTtcbiAgICAgIHNldFZhbGlkYXRpb25SZXN1bHQocmVzdWx0KTtcbiAgICAgIFxuICAgICAgaWYgKCFyZXN1bHQuaXNWYWxpZCkge1xuICAgICAgICBsb2dnZXIud2FybignSW5ncmVkaWVudCBjb25zaXN0ZW5jeSB2YWxpZGF0aW9uIGRldGVjdGVkIGlzc3VlczonLCByZXN1bHQuaXNzdWVzKTtcbiAgICAgICAgXG4gICAgICAgIC8vIERpc3BhdGNoIGV2ZW50IGZvciBleHRlcm5hbCBzeXN0ZW1zXG4gICAgICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgIHdpbmRvdy5kaXNwYXRjaEV2ZW50KG5ldyBDdXN0b21FdmVudCgnaW5ncmVkaWVudC12YWxpZGF0aW9uLWZhaWxlZCcsIHtcbiAgICAgICAgICAgIGRldGFpbDogeyByZXN1bHQsIGluZ3JlZGllbnRzIH1cbiAgICAgICAgICB9KSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIFxuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdFcnJvciBpbiBpbmdyZWRpZW50IGNvbnNpc3RlbmN5IHZhbGlkYXRpb246JywgZXJyb3IpO1xuICAgICAgdGhyb3cgZXJyb3I7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIHNldElzVmFsaWRhdGluZyhmYWxzZSk7XG4gICAgfVxuICB9LCBbcWFdKTtcblxuICByZXR1cm4ge1xuICAgIHZhbGlkYXRpb25SZXN1bHQsXG4gICAgaXNWYWxpZGF0aW5nLFxuICAgIHZhbGlkYXRlSW5ncmVkaWVudHMsXG4gICAgaXNWYWxpZDogdmFsaWRhdGlvblJlc3VsdD8uaXNWYWxpZCA/PyBudWxsXG4gIH07XG59XG5cbi8qKlxuICogQWdlbnQgaG9vayBmb3IgVHlwZVNjcmlwdCBjYW1wYWlnbiB0cmlnZ2Vyc1xuICovXG5leHBvcnQgZnVuY3Rpb24gdXNlVHlwZVNjcmlwdENhbXBhaWduSG9vayhhdXRvQ2hlY2s6IGJvb2xlYW4gPSB0cnVlKSB7XG4gIGNvbnN0IHFhID0gZ2V0QXV0b21hdGVkUXVhbGl0eUFzc3VyYW5jZSgpO1xuICBjb25zdCBbY2FtcGFpZ25UcmlnZ2VyLCBzZXRDYW1wYWlnblRyaWdnZXJdID0gdXNlU3RhdGU8Q2FtcGFpZ25UcmlnZ2VyIHwgbnVsbD4obnVsbCk7XG4gIGNvbnN0IFtpc0NoZWNraW5nLCBzZXRJc0NoZWNraW5nXSA9IHVzZVN0YXRlKGZhbHNlKTtcblxuICBjb25zdCBjaGVja0Vycm9yVGhyZXNob2xkID0gdXNlQ2FsbGJhY2soYXN5bmMgKCkgPT4ge1xuICAgIHNldElzQ2hlY2tpbmcodHJ1ZSk7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHRyaWdnZXIgPSBhd2FpdCBxYS5jaGVja1R5cGVTY3JpcHRFcnJvclRocmVzaG9sZCgpO1xuICAgICAgc2V0Q2FtcGFpZ25UcmlnZ2VyKHRyaWdnZXIpO1xuICAgICAgXG4gICAgICBpZiAodHJpZ2dlcj8udHJpZ2dlcmVkKSB7XG4gICAgICAgIGxvZ2dlci53YXJuKCdUeXBlU2NyaXB0IGNhbXBhaWduIHRyaWdnZXIgYWN0aXZhdGVkOicsIHRyaWdnZXIpO1xuICAgICAgICBcbiAgICAgICAgLy8gRGlzcGF0Y2ggZXZlbnQgZm9yIGNhbXBhaWduIHN5c3RlbSBpbnRlZ3JhdGlvblxuICAgICAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICB3aW5kb3cuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoJ3R5cGVzY3JpcHQtY2FtcGFpZ24tdHJpZ2dlcicsIHtcbiAgICAgICAgICAgIGRldGFpbDogdHJpZ2dlclxuICAgICAgICAgIH0pKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgXG4gICAgICByZXR1cm4gdHJpZ2dlcjtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdFcnJvciBjaGVja2luZyBUeXBlU2NyaXB0IGVycm9yIHRocmVzaG9sZDonLCBlcnJvcik7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9IGZpbmFsbHkge1xuICAgICAgc2V0SXNDaGVja2luZyhmYWxzZSk7XG4gICAgfVxuICB9LCBbcWFdKTtcblxuICAvLyBBdXRvLWNoZWNrIG9uIG1vdW50IGFuZCBwZXJpb2RpY2FsbHlcbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBpZiAoYXV0b0NoZWNrKSB7XG4gICAgICBjaGVja0Vycm9yVGhyZXNob2xkKCk7XG4gICAgICBcbiAgICAgIC8vIENoZWNrIGV2ZXJ5IDEwIG1pbnV0ZXNcbiAgICAgIGNvbnN0IGludGVydmFsID0gc2V0SW50ZXJ2YWwoY2hlY2tFcnJvclRocmVzaG9sZCwgMTAgKiA2MCAqIDEwMDApO1xuICAgICAgcmV0dXJuICgpID0+IGNsZWFySW50ZXJ2YWwoaW50ZXJ2YWwpO1xuICAgIH1cbiAgfSwgW2F1dG9DaGVjaywgY2hlY2tFcnJvclRocmVzaG9sZF0pO1xuXG4gIHJldHVybiB7XG4gICAgY2FtcGFpZ25UcmlnZ2VyLFxuICAgIGlzQ2hlY2tpbmcsXG4gICAgY2hlY2tFcnJvclRocmVzaG9sZCxcbiAgICBpc1RyaWdnZXJlZDogY2FtcGFpZ25UcmlnZ2VyPy50cmlnZ2VyZWQgPz8gZmFsc2VcbiAgfTtcbn1cblxuLyoqXG4gKiBBZ2VudCBob29rIGZvciBidWlsZCBxdWFsaXR5IG1vbml0b3JpbmdcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHVzZUJ1aWxkUXVhbGl0eU1vbml0b3JpbmdIb29rKCkge1xuICBjb25zdCBxYSA9IGdldEF1dG9tYXRlZFF1YWxpdHlBc3N1cmFuY2UoKTtcbiAgY29uc3QgW3F1YWxpdHlSZXN1bHQsIHNldFF1YWxpdHlSZXN1bHRdID0gdXNlU3RhdGU8VmFsaWRhdGlvblJlc3VsdCB8IG51bGw+KG51bGwpO1xuICBjb25zdCBbaXNNb25pdG9yaW5nLCBzZXRJc01vbml0b3JpbmddID0gdXNlU3RhdGUoZmFsc2UpO1xuXG4gIGNvbnN0IG1vbml0b3JCdWlsZFF1YWxpdHkgPSB1c2VDYWxsYmFjayhhc3luYyAoYnVpbGRNZXRyaWNzOiB7XG4gICAgYnVpbGRUaW1lPzogbnVtYmVyO1xuICAgIGJ1bmRsZVNpemU/OiBudW1iZXI7XG4gICAgbWVtb3J5VXNhZ2U/OiBudW1iZXI7XG4gICAgZXJyb3JDb3VudD86IG51bWJlcjtcbiAgfSkgPT4ge1xuICAgIHNldElzTW9uaXRvcmluZyh0cnVlKTtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzdWx0ID0gcWEubW9uaXRvckJ1aWxkUXVhbGl0eShidWlsZE1ldHJpY3MpO1xuICAgICAgc2V0UXVhbGl0eVJlc3VsdChyZXN1bHQpO1xuICAgICAgXG4gICAgICBpZiAoIXJlc3VsdC5pc1ZhbGlkKSB7XG4gICAgICAgIGxvZ2dlci53YXJuKCdCdWlsZCBxdWFsaXR5IG1vbml0b3JpbmcgZGV0ZWN0ZWQgaXNzdWVzOicsIHJlc3VsdC5pc3N1ZXMpO1xuICAgICAgICBcbiAgICAgICAgLy8gRGlzcGF0Y2ggZXZlbnQgZm9yIGV4dGVybmFsIHN5c3RlbXNcbiAgICAgICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgd2luZG93LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KCdidWlsZC1xdWFsaXR5LWlzc3VlcycsIHtcbiAgICAgICAgICAgIGRldGFpbDogeyByZXN1bHQsIGJ1aWxkTWV0cmljcyB9XG4gICAgICAgICAgfSkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBcbiAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignRXJyb3IgaW4gYnVpbGQgcXVhbGl0eSBtb25pdG9yaW5nOicsIGVycm9yKTtcbiAgICAgIHRocm93IGVycm9yO1xuICAgIH0gZmluYWxseSB7XG4gICAgICBzZXRJc01vbml0b3JpbmcoZmFsc2UpO1xuICAgIH1cbiAgfSwgW3FhXSk7XG5cbiAgcmV0dXJuIHtcbiAgICBxdWFsaXR5UmVzdWx0LFxuICAgIGlzTW9uaXRvcmluZyxcbiAgICBtb25pdG9yQnVpbGRRdWFsaXR5LFxuICAgIGlzUXVhbGl0eUdvb2Q6IHF1YWxpdHlSZXN1bHQ/LmlzVmFsaWQgPz8gbnVsbFxuICB9O1xufVxuXG4vKipcbiAqIEFnZW50IGhvb2sgZm9yIGNvbXByZWhlbnNpdmUgcXVhbGl0eSBtZXRyaWNzIG1vbml0b3JpbmdcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHVzZVF1YWxpdHlNZXRyaWNzSG9vayh1cGRhdGVJbnRlcnZhbDogbnVtYmVyID0gMzAwMDApIHsgLy8gMzAgc2Vjb25kc1xuICBjb25zdCBxYSA9IGdldEF1dG9tYXRlZFF1YWxpdHlBc3N1cmFuY2UoKTtcbiAgY29uc3QgW21ldHJpY3MsIHNldE1ldHJpY3NdID0gdXNlU3RhdGU8UXVhbGl0eU1ldHJpY3M+KHFhLmdldFF1YWxpdHlNZXRyaWNzKCkpO1xuICBjb25zdCBbbGFzdFVwZGF0ZSwgc2V0TGFzdFVwZGF0ZV0gPSB1c2VTdGF0ZShEYXRlLm5vdygpKTtcblxuICBjb25zdCB1cGRhdGVNZXRyaWNzID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgIGNvbnN0IG5ld01ldHJpY3MgPSBxYS5nZXRRdWFsaXR5TWV0cmljcygpO1xuICAgIHNldE1ldHJpY3MobmV3TWV0cmljcyk7XG4gICAgc2V0TGFzdFVwZGF0ZShEYXRlLm5vdygpKTtcbiAgfSwgW3FhXSk7XG5cbiAgLy8gVXBkYXRlIG1ldHJpY3MgcGVyaW9kaWNhbGx5XG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgY29uc3QgaW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCh1cGRhdGVNZXRyaWNzLCB1cGRhdGVJbnRlcnZhbCk7XG4gICAgcmV0dXJuICgpID0+IGNsZWFySW50ZXJ2YWwoaW50ZXJ2YWwpO1xuICB9LCBbdXBkYXRlTWV0cmljcywgdXBkYXRlSW50ZXJ2YWxdKTtcblxuICByZXR1cm4ge1xuICAgIG1ldHJpY3MsXG4gICAgbGFzdFVwZGF0ZSxcbiAgICB1cGRhdGVNZXRyaWNzXG4gIH07XG59XG5cbi8qKlxuICogQWdlbnQgaG9vayBjb25maWd1cmF0aW9uIG1hbmFnZW1lbnRcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHVzZUFnZW50SG9va0NvbmZpZ3VyYXRpb24oKSB7XG4gIGNvbnN0IHFhID0gZ2V0QXV0b21hdGVkUXVhbGl0eUFzc3VyYW5jZSgpO1xuICBcbiAgY29uc3QgdXBkYXRlQ29uZmlndXJhdGlvbiA9IHVzZUNhbGxiYWNrKChjb25maWc6IFBhcnRpYWw8UXVhbGl0eUFzc3VyYW5jZUNvbmZpZz4pID0+IHtcbiAgICBxYS51cGRhdGVDb25maWcoY29uZmlnKTtcbiAgICBsb2dnZXIuaW5mbygnQWdlbnQgaG9vayBjb25maWd1cmF0aW9uIHVwZGF0ZWQ6JywgY29uZmlnKTtcbiAgfSwgW3FhXSk7XG5cbiAgY29uc3QgZ2V0QWN0aXZlVHJpZ2dlcnMgPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgcmV0dXJuIHFhLmdldEFjdGl2ZUNhbXBhaWduVHJpZ2dlcnMoKTtcbiAgfSwgW3FhXSk7XG5cbiAgcmV0dXJuIHtcbiAgICB1cGRhdGVDb25maWd1cmF0aW9uLFxuICAgIGdldEFjdGl2ZVRyaWdnZXJzXG4gIH07XG59Il0sInZlcnNpb24iOjN9