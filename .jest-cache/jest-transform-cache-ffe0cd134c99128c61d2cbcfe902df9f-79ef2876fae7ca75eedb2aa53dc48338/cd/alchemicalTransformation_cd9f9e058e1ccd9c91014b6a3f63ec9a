f18e84a40b907f7a77f0b5dc8c6ee34b
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.transformItemsWithPlanetaryPositions = exports.transformItemWithPlanetaryPositions = void 0;
const alchemicalCalculations_1 = require("./alchemicalCalculations");
const planetaryFoodAssociations_1 = require("../constants/planetaryFoodAssociations");
const logger_1 = require("@/utils/logger");
// Create a component-specific logger
const logger = (0, logger_1.createLogger)('AlchemicalTransformation');
/**
 * Transform an item with elemental data using current planetary positions
 *
 * @param item The original item with elemental data
 * @param planetPositions Current planetary positions/strengths
 * @param isDaytime Whether it's day or night
 * @param currentZodiac Current zodiac sign (optional)
 * @param lunarPhase Current lunar phase (optional)
 * @returns Item transformed with alchemical properties
 */
const transformItemWithPlanetaryPositions = (item, planetPositions, isDaytime, currentZodiac, lunarPhase) => {
    try {
        // Validate and sanitize input values
        const sanitizedItem = {
            ...item,
            elementalProperties: Object.fromEntries(Object.entries(item.elementalProperties).map(([key, value]) => [
                key,
                Number.isFinite(value) ? value : 0.1
            ]))
        };
        // Calculate alchemical properties based on planetary positions
        const alchemicalResults = (0, alchemicalCalculations_1.calculateAlchemicalProperties)(planetPositions, isDaytime);
        // Calculate planetary boost based on ingredient's characteristics
        const { boost: planetaryBoost, dominantPlanets, dignities: planetaryDignities } = (0, planetaryFoodAssociations_1.calculatePlanetaryBoost)(sanitizedItem, planetPositions, currentZodiac || null, lunarPhase || null);
        // Transform elemental properties based on planetary influences
        // Apply the planetary boost to increase the effect
        const transformedElementalProperties = transformElementalProperties(sanitizedItem.elementalProperties, alchemicalResults, planetaryBoost, currentZodiac === null || currentZodiac === void 0 ? void 0 : currentZodiac.toLowerCase());
        // Calculate dominant element and alchemical property
        const dominantElement = getDominantElement(transformedElementalProperties);
        const dominantAlchemicalProperty = getDominantAlchemicalProperty(alchemicalResults.alchemicalCounts);
        // Apply safety checks for energy metrics
        const safeHeat = Number.isFinite(alchemicalResults.heat) ?
            Math.max(0.1, Math.min(1.0, alchemicalResults.heat * planetaryBoost * 2.5)) : 0.5;
        const safeEntropy = Number.isFinite(alchemicalResults.entropy) ?
            Math.max(0.1, Math.min(1.0, alchemicalResults.entropy * 1.5)) : 0.5;
        const safeReactivity = Number.isFinite(alchemicalResults.reactivity) ?
            Math.max(0.1, Math.min(1.0, alchemicalResults.reactivity * 1.5)) : 0.5;
        // Calculate gregsEnergy using the original formula: heat - (reactivity * entropy)
        // Then scale to the 0-1 range for UI friendliness
        const rawGregsEnergy = safeHeat - (safeReactivity * safeEntropy);
        // Instead of a simple scaling, apply more varied calculations based on multiple factors
        // This will create more distinct recommendations with a wider range
        const baseScaledEnergy = (rawGregsEnergy + 1) / 2; // Convert from range (-1,1) to (0,1)
        // Apply element-specific influence for each dominant element
        let elementalModifier = 0;
        if (dominantElement === 'Fire') {
            elementalModifier = 0.25 * (transformedElementalProperties.Fire - 0.25);
        }
        else if (dominantElement === 'Water') {
            elementalModifier = 0.20 * (transformedElementalProperties.Water - 0.25);
        }
        else if (dominantElement === 'Earth') {
            elementalModifier = 0.18 * (transformedElementalProperties.Earth - 0.25);
        }
        else if (dominantElement === 'Air') {
            elementalModifier = 0.15 * (transformedElementalProperties.Air - 0.25);
        }
        // Apply alchemical property influence with increased impact
        let alchemicalModifier = 0;
        if (dominantAlchemicalProperty === 'Spirit') {
            alchemicalModifier = 0.22 * (alchemicalResults.alchemicalCounts.Spirit - 0.25);
        }
        else if (dominantAlchemicalProperty === 'Essence') {
            alchemicalModifier = 0.20 * (alchemicalResults.alchemicalCounts.Essence - 0.25);
        }
        else if (dominantAlchemicalProperty === 'Matter') {
            alchemicalModifier = 0.18 * (alchemicalResults.alchemicalCounts.Matter - 0.25);
        }
        else if (dominantAlchemicalProperty === 'Substance') {
            alchemicalModifier = 0.15 * (alchemicalResults.alchemicalCounts.Substance - 0.25);
        }
        // Apply zodiac influence if available with stronger effect
        let zodiacModifier = 0;
        if (currentZodiac === null || currentZodiac === void 0 ? void 0 : currentZodiac.toLowerCase()) {
            const zodiacSign = currentZodiac.toLowerCase();
            const zodiacElementMap = {
                aries: 'Fire', leo: 'Fire', sagittarius: 'Fire',
                taurus: 'Earth', virgo: 'Earth', capricorn: 'Earth',
                gemini: 'Air', libra: 'Air', aquarius: 'Air',
                cancer: 'Water', scorpio: 'Water', pisces: 'Water'
            };
            const zodiacElement = zodiacElementMap[zodiacSign];
            if (zodiacElement && zodiacElement === dominantElement) {
                zodiacModifier = 0.25; // Increased bonus for matching zodiac element
            }
            else if (zodiacElement) {
                // Calculate compatibility based on elemental relationships with wider variance
                if ((zodiacElement === 'Fire' && dominantElement === 'Air') ||
                    (zodiacElement === 'Air' && dominantElement === 'Fire')) {
                    zodiacModifier = 0.18; // Fire and Air are complementary
                }
                else if ((zodiacElement === 'Earth' && dominantElement === 'Water') ||
                    (zodiacElement === 'Water' && dominantElement === 'Earth')) {
                    zodiacModifier = 0.18; // Earth and Water are complementary
                }
                else if ((zodiacElement === 'Fire' && dominantElement === 'Earth') ||
                    (zodiacElement === 'Earth' && dominantElement === 'Fire')) {
                    zodiacModifier = 0.12; // Fire and Earth have moderate compatibility
                }
                else if ((zodiacElement === 'Water' && dominantElement === 'Air') ||
                    (zodiacElement === 'Air' && dominantElement === 'Water')) {
                    zodiacModifier = 0.12; // Water and Air have moderate compatibility
                }
                else {
                    zodiacModifier = 0.05; // Other combinations have lower compatibility
                }
            }
        }
        // Calculate boost from planetary influence with more differentiation
        const planetaryModifier = Math.min(0.25, (planetaryBoost - 1.0) * 0.8);
        // Add randomized factor to create more variance (Â±7%)
        const randomVariance = (Math.random() * 0.14) - 0.07;
        // Combine all influences for a more varied energy calculation
        const adjustedEnergy = baseScaledEnergy + elementalModifier + alchemicalModifier + zodiacModifier + planetaryModifier + randomVariance;
        // Ensure the final value is within valid range but allowing more variance (wider range)
        const safeGregsEnergy = Math.max(0.20, Math.min(0.98, adjustedEnergy));
        // Add more debug logging
        logger.debug(`[Ingredient: ${sanitizedItem.name}] Raw heat: ${alchemicalResults.heat}, Boosted heat: ${safeHeat}, Planetary boost: ${planetaryBoost}`);
        return {
            ...sanitizedItem,
            alchemicalProperties: alchemicalResults.alchemicalCounts,
            transformedElementalProperties,
            heat: safeHeat,
            entropy: safeEntropy,
            reactivity: safeReactivity,
            gregsEnergy: safeGregsEnergy,
            dominantElement,
            dominantAlchemicalProperty,
            planetaryBoost,
            dominantPlanets,
            planetaryDignities
        };
    }
    catch (error) {
        logger.error(`Error transforming item ${item.name}:`, error);
        // Return a safe fallback with original values preserved
        return {
            ...item,
            alchemicalProperties: {
                Spirit: 0.25,
                Essence: 0.25,
                Matter: 0.25,
                Substance: 0.25
            },
            transformedElementalProperties: { ...item.elementalProperties },
            heat: 0.5,
            entropy: 0.5,
            reactivity: 0.5,
            gregsEnergy: 0.5,
            dominantElement: getDominantElement(item.elementalProperties),
            dominantAlchemicalProperty: 'Essence',
            planetaryBoost: 1.0,
            dominantPlanets: [],
            planetaryDignities: {}
        };
    }
};
exports.transformItemWithPlanetaryPositions = transformItemWithPlanetaryPositions;
/**
 * Transform a collection of items using current planetary positions
 */
const transformItemsWithPlanetaryPositions = (items, planetPositions, isDaytime, currentZodiac, lunarPhase) => {
    try {
        return items.map(item => (0, exports.transformItemWithPlanetaryPositions)(item, planetPositions, isDaytime, currentZodiac, lunarPhase));
    }
    catch (error) {
        logger.error('Error transforming multiple items:', error);
        // Return the original items with minimal transformation if batch processing fails
        return items.map(item => ({
            ...item,
            alchemicalProperties: {
                Spirit: 0.25,
                Essence: 0.25,
                Matter: 0.25,
                Substance: 0.25
            },
            transformedElementalProperties: { ...item.elementalProperties },
            heat: 0.5,
            entropy: 0.5,
            reactivity: 0.5,
            gregsEnergy: 0.5,
            dominantElement: getDominantElement(item.elementalProperties),
            dominantAlchemicalProperty: 'Essence',
            planetaryBoost: 1.0,
            dominantPlanets: [],
            planetaryDignities: {}
        }));
    }
};
exports.transformItemsWithPlanetaryPositions = transformItemsWithPlanetaryPositions;
/**
 * Transform elemental properties using alchemical results and planetary boost
 * This applies the alchemical influence to the base elemental properties
 */
const transformElementalProperties = (originalProperties, alchemicalResults, planetaryBoost = 1.0, zodiacSign) => {
    try {
        // Create a copy of the original properties
        const transformedProperties = { ...originalProperties };
        // Calculate base enhancement factor - stronger effect on dominant elements
        // Enhanced by planetary boost, but cap the enhancement factor to prevent excessive values
        const enhancementFactor = Math.min(0.10, 0.15 * planetaryBoost) * 0.5;
        // Get the dominant original element to preserve character
        const dominantElement = getDominantElement(originalProperties);
        // Apply transformations based on alchemical properties, with reduced enhancers
        // Spirit enhances Fire more if Fire is already present
        transformedProperties.Fire +=
            (alchemicalResults.alchemicalCounts.Spirit * enhancementFactor * (originalProperties.Fire + 0.15)) * 0.8;
        // Essence enhances Water more if Water is already present
        transformedProperties.Water +=
            (alchemicalResults.alchemicalCounts.Essence * enhancementFactor * (originalProperties.Water + 0.15)) * 0.7;
        // Matter enhances Earth more if Earth is already present
        transformedProperties.Earth +=
            (alchemicalResults.alchemicalCounts.Matter * enhancementFactor * (originalProperties.Earth + 0.15)) * 0.7;
        // Substance enhances Air more if Air is already present
        transformedProperties.Air +=
            (alchemicalResults.alchemicalCounts.Substance * enhancementFactor * (originalProperties.Air + 0.15)) * 0.7;
        // Apply cross-element influences with more dynamic calculations, with reduced strength
        applyElementalInfluences(transformedProperties, alchemicalResults.elementalCounts, originalProperties, Math.min(1.0, planetaryBoost * 0.7));
        // Boost the dominant element slightly to preserve ingredient character, but cap the boost
        transformedProperties[dominantElement] *= Math.min(1.05, 1.1 * planetaryBoost);
        // Apply zodiac-specific boost if available
        if (zodiacSign) {
            applyZodiacBoost(transformedProperties, zodiacSign);
        }
        // Normalize the values so they sum to 1.0
        normalizeValues(transformedProperties);
        return transformedProperties;
    }
    catch (error) {
        logger.error('Error transforming elemental properties:', error);
        // Return the original properties if there's an error
        return { ...originalProperties };
    }
};
/**
 * Apply zodiac-specific boosts to elemental properties
 */
const applyZodiacBoost = (transformedProperties, zodiacSign) => {
    try {
        const zodiacElementMap = {
            aries: 'Fire',
            taurus: 'Earth',
            gemini: 'Air',
            cancer: 'Water',
            leo: 'Fire',
            virgo: 'Earth',
            libra: 'Air',
            scorpio: 'Water',
            sagittarius: 'Fire',
            capricorn: 'Earth',
            aquarius: 'Air',
            pisces: 'Water'
        };
        const zodiacElement = zodiacElementMap[zodiacSign];
        if (zodiacElement) {
            // Apply a small boost to the corresponding element
            transformedProperties[zodiacElement] *= 1.05;
        }
    }
    catch (error) {
        logger.error(`Error applying zodiac boost for ${zodiacSign}:`, error);
        // No modifications to transformedProperties needed in case of error
    }
};
/**
 * Apply cross-element influences based on elemental counts and boost
 */
const applyElementalInfluences = (transformedProperties, elementalCounts, originalProperties, planetaryBoost = 1.0) => {
    try {
        // Calculate influence factors based on elemental counts
        const fireInfluence = elementalCounts.Fire * 0.08 * planetaryBoost;
        const waterInfluence = elementalCounts.Water * 0.06 * planetaryBoost;
        const earthInfluence = elementalCounts.Earth * 0.07 * planetaryBoost;
        const airInfluence = elementalCounts.Air * 0.05 * planetaryBoost;
        // Fire influences - increases Earth, decreases Water
        transformedProperties.Earth += fireInfluence * (originalProperties.Earth * 0.5);
        transformedProperties.Water -= fireInfluence * (originalProperties.Water * 0.1);
        // Water influences - increases Air, decreases Fire
        transformedProperties.Air += waterInfluence * (originalProperties.Air * 0.5);
        transformedProperties.Fire -= waterInfluence * (originalProperties.Fire * 0.1);
        // Earth influences - increases Water, decreases Air 
        transformedProperties.Water += earthInfluence * (originalProperties.Water * 0.5);
        transformedProperties.Air -= earthInfluence * (originalProperties.Air * 0.1);
        // Air influences - increases Fire, decreases Earth
        transformedProperties.Fire += airInfluence * (originalProperties.Fire * 0.5);
        transformedProperties.Earth -= airInfluence * (originalProperties.Earth * 0.1);
        // Ensure all values remain positive
        Object.keys(transformedProperties).forEach(key => {
            transformedProperties[key] = Math.max(0.05, transformedProperties[key]);
        });
    }
    catch (error) {
        logger.error('Error applying elemental influences:', error);
        // Leave transformedProperties unchanged in case of error
    }
};
/**
 * Calculate the dominant element from a set of elemental properties
 */
const getDominantElement = (transformedProperties) => {
    try {
        let maxValue = -Infinity;
        let dominantElement = 'Fire'; // Default
        Object.entries(transformedProperties).forEach(([element, value]) => {
            // Pattern KK-8: Advanced calculation safety for comparison operations
            const numericValue = Number(value) || 0;
            const numericMaxValue = Number(maxValue) || -Infinity;
            if (numericValue > numericMaxValue) {
                maxValue = numericValue;
                dominantElement = element;
            }
        });
        return dominantElement;
    }
    catch (error) {
        logger.error('Error determining dominant element:', error);
        return 'Fire'; // Default fallback
    }
};
/**
 * Calculate the dominant alchemical property from alchemical counts
 */
const getDominantAlchemicalProperty = (alchemicalCounts) => {
    try {
        let maxValue = -Infinity;
        let dominantProperty = 'Spirit'; // Default
        Object.entries(alchemicalCounts).forEach(([property, value]) => {
            // Pattern KK-8: Advanced calculation safety for comparison operations
            const numericValue = Number(value) || 0;
            const numericMaxValue = Number(maxValue) || -Infinity;
            if (numericValue > numericMaxValue) {
                maxValue = numericValue;
                dominantProperty = property;
            }
        });
        return dominantProperty;
    }
    catch (error) {
        logger.error('Error determining dominant alchemical property:', error);
        return 'Spirit'; // Default fallback
    }
};
/**
 * Normalize values in a record to sum to 1.0
 */
const normalizeValues = (record) => {
    try {
        // Pattern KK-8: Advanced calculation safety for reduction and division
        const sum = Object.values(record).reduce((acc, val) => {
            const numericAcc = Number(acc) || 0;
            const numericVal = Number(val) || 0;
            return numericAcc + numericVal;
        }, 0);
        const numericSum = Number(sum) || 0;
        if (numericSum > 0) {
            Object.keys(record).forEach(key => {
                const currentValue = Number(record[key]) || 0;
                record[key] = currentValue / numericSum;
            });
        }
    }
    catch (error) {
        logger.error('Error normalizing values:', error);
        // If normalization fails, leave values as they are
    }
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9jYWxjdWxhdGlvbnMvYWxjaGVtaWNhbFRyYW5zZm9ybWF0aW9uLnRzIiwibWFwcGluZ3MiOiI7OztBQU1BLHFFQUE0RjtBQUM1RixzRkFHZ0Q7QUFDaEQsMkNBQThDO0FBRzlDLHFDQUFxQztBQUNyQyxNQUFNLE1BQU0sR0FBRyxJQUFBLHFCQUFZLEVBQUMsMEJBQTBCLENBQUMsQ0FBQztBQThCeEQ7Ozs7Ozs7OztHQVNHO0FBQ0ksTUFBTSxtQ0FBbUMsR0FBRyxDQUNqRCxJQUFtQixFQUNuQixlQUFrRCxFQUNsRCxTQUFrQixFQUNsQixhQUE2QixFQUM3QixVQUF3QyxFQUN4QixFQUFFO0lBQ2xCLElBQUk7UUFDRixxQ0FBcUM7UUFDckMsTUFBTSxhQUFhLEdBQUc7WUFDcEIsR0FBRyxJQUFJO1lBQ1AsbUJBQW1CLEVBQUUsTUFBTSxDQUFDLFdBQVcsQ0FDckMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsbUJBQW1CLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLEdBQUcsRUFBRSxLQUFLLENBQUMsRUFBRSxFQUFFLENBQUM7Z0JBQzdELEdBQUc7Z0JBQ0gsTUFBTSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxHQUFHO2FBQ3JDLENBQUMsQ0FDbUM7U0FDeEMsQ0FBQztRQUVGLCtEQUErRDtRQUMvRCxNQUFNLGlCQUFpQixHQUFHLElBQUEsc0RBQTZCLEVBQ3JELGVBQXNCLEVBQ3RCLFNBQVMsQ0FDVixDQUFDO1FBRUYsa0VBQWtFO1FBQ2xFLE1BQU0sRUFBRSxLQUFLLEVBQUUsY0FBYyxFQUFFLGVBQWUsRUFBRSxTQUFTLEVBQUUsa0JBQWtCLEVBQUUsR0FDN0UsSUFBQSxtREFBdUIsRUFDckIsYUFBYSxFQUNiLGVBQWUsRUFDZixhQUFhLElBQUksSUFBSSxFQUNyQixVQUFVLElBQUksSUFBSSxDQUNuQixDQUFDO1FBRUos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QUFDLEdBQUcsQ0FBQyxFQUFFO2dCQUNoQyxNQUFNLFlBQVksR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLEdBQVEsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDO2dCQUNuRCxNQUFNLENBQUMsR0FBUSxDQUFDLEdBQUcsWUFBWSxHQUFHLFVBQVUsQ0FBQztZQUMvQyxDQUFDLENBQUMsQ0FBQztTQUNKO0tBQ0Y7SUFBQyxPQUFPLEtBQUssRUFBRTtRQUNkLE1BQU0sQ0FBQyxLQUFLLENBQUMsMkJBQTJCLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDakQsbURBQW1EO0tBQ3BEO0FBQ0gsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9HcmVnQ2FzdHJvL0Rlc2t0b3AvV2hhdFRvRWF0TmV4dC9zcmMvY2FsY3VsYXRpb25zL2FsY2hlbWljYWxUcmFuc2Zvcm1hdGlvbi50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBcbiAgRWxlbWVudGFsQ2hhcmFjdGVyLCBcbiAgQWxjaGVtaWNhbFByb3BlcnR5LFxuICBab2RpYWNTaWduLFxuICBMdW5hclBoYXNlV2l0aFNwYWNlc1xufSBmcm9tICdAL3R5cGVzL2FsY2hlbXknO1xuaW1wb3J0IHsgQWxjaGVtaWNhbFJlc3VsdHMsIGNhbGN1bGF0ZUFsY2hlbWljYWxQcm9wZXJ0aWVzIH0gZnJvbSAnLi9hbGNoZW1pY2FsQ2FsY3VsYXRpb25zJztcbmltcG9ydCB7XG4gIGNhbGN1bGF0ZVBsYW5ldGFyeUJvb3N0LFxuICBQbGFuZXRhcnlEaWduaXR5RGV0YWlsc1xufSBmcm9tICcuLi9jb25zdGFudHMvcGxhbmV0YXJ5Rm9vZEFzc29jaWF0aW9ucyc7XG5pbXBvcnQgeyBjcmVhdGVMb2dnZXIgfSBmcm9tICdAL3V0aWxzL2xvZ2dlcic7XG5pbXBvcnQgeyBDZWxlc3RpYWxQb3NpdGlvbiB9IGZyb20gJ0AvdHlwZXMvY2VsZXN0aWFsJztcblxuLy8gQ3JlYXRlIGEgY29tcG9uZW50LXNwZWNpZmljIGxvZ2dlclxuY29uc3QgbG9nZ2VyID0gY3JlYXRlTG9nZ2VyKCdBbGNoZW1pY2FsVHJhbnNmb3JtYXRpb24nKTtcblxuLyoqXG4gKiBJbnRlcmZhY2UgZm9yIGl0ZW1zIHdpdGggZWxlbWVudGFsIGRhdGEgKGluZ3JlZGllbnRzLCBtZXRob2RzLCBjdWlzaW5lcylcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBFbGVtZW50YWxJdGVtIHtcbiAgaWQ6IHN0cmluZztcbiAgbmFtZTogc3RyaW5nO1xuICBlbGVtZW50YWxQcm9wZXJ0aWVzOiBSZWNvcmQ8RWxlbWVudGFsQ2hhcmFjdGVyLCBudW1iZXI+O1xuICBba2V5OiBzdHJpbmddOiB1bmtub3duOyAvLyBBbGxvdyBvdGhlciBwcm9wZXJ0aWVzXG59XG5cbi8qKlxuICogSW50ZXJmYWNlIGZvciB0cmFuc2Zvcm1lZCBpdGVtcyB3aXRoIGJvdGggZWxlbWVudGFsIGFuZCBhbGNoZW1pY2FsIGRhdGFcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBBbGNoZW1pY2FsSXRlbSBleHRlbmRzIEVsZW1lbnRhbEl0ZW0ge1xuICBhbGNoZW1pY2FsUHJvcGVydGllczogUmVjb3JkPEFsY2hlbWljYWxQcm9wZXJ0eSwgbnVtYmVyPjtcbiAgdHJhbnNmb3JtZWRFbGVtZW50YWxQcm9wZXJ0aWVzOiBSZWNvcmQ8RWxlbWVudGFsQ2hhcmFjdGVyLCBudW1iZXI+O1xuICBoZWF0OiBudW1iZXI7XG4gIGVudHJvcHk6IG51bWJlcjtcbiAgcmVhY3Rpdml0eTogbnVtYmVyO1xuICBncmVnc0VuZXJneTogbnVtYmVyO1xuICBkb21pbmFudEVsZW1lbnQ6IEVsZW1lbnRhbENoYXJhY3RlcjtcbiAgZG9taW5hbnRBbGNoZW1pY2FsUHJvcGVydHk6IEFsY2hlbWljYWxQcm9wZXJ0eTtcbiAgLy8gTmV3IHBsYW5ldGFyeSBpbmZsdWVuY2UgcHJvcGVydGllc1xuICBwbGFuZXRhcnlCb29zdDogbnVtYmVyO1xuICBkb21pbmFudFBsYW5ldHM6IHN0cmluZ1tdO1xuICBwbGFuZXRhcnlEaWduaXRpZXM6IFJlY29yZDxzdHJpbmcsIFBsYW5ldGFyeURpZ25pdHlEZXRhaWxzPjtcbn1cblxuLyoqXG4gKiBUcmFuc2Zvcm0gYW4gaXRlbSB3aXRoIGVsZW1lbnRhbCBkYXRhIHVzaW5nIGN1cnJlbnQgcGxhbmV0YXJ5IHBvc2l0aW9uc1xuICogXG4gKiBAcGFyYW0gaXRlbSBUaGUgb3JpZ2luYWwgaXRlbSB3aXRoIGVsZW1lbnRhbCBkYXRhXG4gKiBAcGFyYW0gcGxhbmV0UG9zaXRpb25zIEN1cnJlbnQgcGxhbmV0YXJ5IHBvc2l0aW9ucy9zdHJlbmd0aHNcbiAqIEBwYXJhbSBpc0RheXRpbWUgV2hldGhlciBpdCdzIGRheSBvciBuaWdodFxuICogQHBhcmFtIGN1cnJlbnRab2RpYWMgQ3VycmVudCB6b2RpYWMgc2lnbiAob3B0aW9uYWwpXG4gKiBAcGFyYW0gbHVuYXJQaGFzZSBDdXJyZW50IGx1bmFyIHBoYXNlIChvcHRpb25hbClcbiAqIEByZXR1cm5zIEl0ZW0gdHJhbnNmb3JtZWQgd2l0aCBhbGNoZW1pY2FsIHByb3BlcnRpZXNcbiAqL1xuZXhwb3J0IGNvbnN0IHRyYW5zZm9ybUl0ZW1XaXRoUGxhbmV0YXJ5UG9zaXRpb25zID0gKFxuICBpdGVtOiBFbGVtZW50YWxJdGVtLFxuICBwbGFuZXRQb3NpdGlvbnM6IFJlY29yZDxzdHJpbmcsIENlbGVzdGlhbFBvc2l0aW9uPixcbiAgaXNEYXl0aW1lOiBib29sZWFuLFxuICBjdXJyZW50Wm9kaWFjPzogc3RyaW5nIHwgbnVsbCxcbiAgbHVuYXJQaGFzZT86IEx1bmFyUGhhc2VXaXRoU3BhY2VzIHwgbnVsbFxuKTogQWxjaGVtaWNhbEl0ZW0gPT4ge1xuICB0cnkge1xuICAgIC8vIFZhbGlkYXRlIGFuZCBzYW5pdGl6ZSBpbnB1dCB2YWx1ZXNcbiAgICBjb25zdCBzYW5pdGl6ZWRJdGVtID0ge1xuICAgICAgLi4uaXRlbSxcbiAgICAgIGVsZW1lbnRhbFByb3BlcnRpZXM6IE9iamVjdC5mcm9tRW50cmllcyhcbiAgICAgICAgT2JqZWN0LmVudHJpZXMoaXRlbS5lbGVtZW50YWxQcm9wZXJ0aWVzKS5tYXAoKFtrZXksIHZhbHVlXSkgPT4gW1xuICAgICAgICAgIGtleSxcbiAgICAgICAgICBOdW1iZXIuaXNGaW5pdGUodmFsdWUpID8gdmFsdWUgOiAwLjFcbiAgICAgICAgXSlcbiAgICAgICkgYXMgUmVjb3JkPEVsZW1lbnRhbENoYXJhY3RlciwgbnVtYmVyPlxuICAgIH07XG5cbiAgICAvLyBDYWxjdWxhdGUgYWxjaGVtaWNhbCBwcm9wZXJ0aWVzIGJhc2VkIG9uIHBsYW5ldGFyeSBwb3NpdGlvbnNcbiAgICBjb25zdCBhbGNoZW1pY2FsUmVzdWx0cyA9IGNhbGN1bGF0ZUFsY2hlbWljYWxQcm9wZXJ0aWVzKFxuICAgICAgcGxhbmV0UG9zaXRpb25zIGFzIGFueSxcbiAgICAgIGlzRGF5dGltZVxuICAgICk7XG4gICAgXG4gICAgLy8gQ2FsY3VsYXRlIHBsYW5ldGFyeSBib29zdCBiYXNlZCBvbiBpbmdyZWRpZW50J3MgY2hhcmFjdGVyaXN0aWNzXG4gICAgY29uc3QgeyBib29zdDogcGxhbmV0YXJ5Qm9vc3QsIGRvbWluYW50UGxhbmV0cywgZGlnbml0aWVzOiBwbGFuZXRhcnlEaWduaXRpZXMgfSA9IFxuICAgICAgY2FsY3VsYXRlUGxhbmV0YXJ5Qm9vc3QoXG4gICAgICAgIHNhbml0aXplZEl0ZW0sIFxuICAgICAgICBwbGFuZXRQb3NpdGlvbnMsIFxuICAgICAgICBjdXJyZW50Wm9kaWFjIHx8IG51bGwsXG4gICAgICAgIGx1bmFyUGhhc2UgfHwgbnVsbFxuICAgICAgKTtcbiAgICBcbiAgICAvLyBUcmFuc2Zvcm0gZWxlbWVudGFsIHByb3BlcnRpZXMgYmFzZWQgb24gcGxhbmV0YXJ5IGluZmx1ZW5jZXNcbiAgICAvLyBBcHBseSB0aGUgcGxhbmV0YXJ5IGJvb3N0IHRvIGluY3JlYXNlIHRoZSBlZmZlY3RcbiAgICBjb25zdCB0cmFuc2Zvcm1lZEVsZW1lbnRhbFByb3BlcnRpZXMgPSB0cmFuc2Zvcm1FbGVtZW50YWxQcm9wZXJ0aWVzKFxuICAgICAgc2FuaXRpemVkSXRlbS5lbGVtZW50YWxQcm9wZXJ0aWVzLFxuICAgICAgYWxjaGVtaWNhbFJlc3VsdHMsXG4gICAgICBwbGFuZXRhcnlCb29zdCxcbiAgICAgIGN1cnJlbnRab2RpYWM/LnRvTG93ZXJDYXNlKCkgYXMgWm9kaWFjU2lnblxuICAgICk7XG4gICAgXG4gICAgLy8gQ2FsY3VsYXRlIGRvbWluYW50IGVsZW1lbnQgYW5kIGFsY2hlbWljYWwgcHJvcGVydHlcbiAgICBjb25zdCBkb21pbmFudEVsZW1lbnQgPSBnZXREb21pbmFudEVsZW1lbnQodHJhbnNmb3JtZWRFbGVtZW50YWxQcm9wZXJ0aWVzKTtcbiAgICBjb25zdCBkb21pbmFudEFsY2hlbWljYWxQcm9wZXJ0eSA9IGdldERvbWluYW50QWxjaGVtaWNhbFByb3BlcnR5KGFsY2hlbWljYWxSZXN1bHRzLmFsY2hlbWljYWxDb3VudHMpO1xuICAgIFxuICAgIC8vIEFwcGx5IHNhZmV0eSBjaGVja3MgZm9yIGVuZXJneSBtZXRyaWNzXG4gICAgY29uc3Qgc2FmZUhlYXQgPSBOdW1iZXIuaXNGaW5pdGUoYWxjaGVtaWNhbFJlc3VsdHMuaGVhdCkgPyBcbiAgICAgIE1hdGgubWF4KDAuMSwgTWF0aC5taW4oMS4wLCBhbGNoZW1pY2FsUmVzdWx0cy5oZWF0ICogcGxhbmV0YXJ5Qm9vc3QgKiAyLjUpKSA6IDAuNTtcbiAgICBcbiAgICBjb25zdCBzYWZlRW50cm9weSA9IE51bWJlci5pc0Zpbml0ZShhbGNoZW1pY2FsUmVzdWx0cy5lbnRyb3B5KSA/IFxuICAgICAgTWF0aC5tYXgoMC4xLCBNYXRoLm1pbigxLjAsIGFsY2hlbWljYWxSZXN1bHRzLmVudHJvcHkgKiAxLjUpKSA6IDAuNTtcbiAgICBcbiAgICBjb25zdCBzYWZlUmVhY3Rpdml0eSA9IE51bWJlci5pc0Zpbml0ZShhbGNoZW1pY2FsUmVzdWx0cy5yZWFjdGl2aXR5KSA/IFxuICAgICAgTWF0aC5tYXgoMC4xLCBNYXRoLm1pbigxLjAsIGFsY2hlbWljYWxSZXN1bHRzLnJlYWN0aXZpdHkgKiAxLjUpKSA6IDAuNTtcbiAgICBcbiAgICAvLyBDYWxjdWxhdGUgZ3JlZ3NFbmVyZ3kgdXNpbmcgdGhlIG9yaWdpbmFsIGZvcm11bGE6IGhlYXQgLSAocmVhY3Rpdml0eSAqIGVudHJvcHkpXG4gICAgLy8gVGhlbiBzY2FsZSB0byB0aGUgMC0xIHJhbmdlIGZvciBVSSBmcmllbmRsaW5lc3NcbiAgICBjb25zdCByYXdHcmVnc0VuZXJneSA9IHNhZmVIZWF0IC0gKHNhZmVSZWFjdGl2aXR5ICogc2FmZUVudHJvcHkpO1xuICAgIFxuICAgIC8vIEluc3RlYWQgb2YgYSBzaW1wbGUgc2NhbGluZywgYXBwbHkgbW9yZSB2YXJpZWQgY2FsY3VsYXRpb25zIGJhc2VkIG9uIG11bHRpcGxlIGZhY3RvcnNcbiAgICAvLyBUaGlzIHdpbGwgY3JlYXRlIG1vcmUgZGlzdGluY3QgcmVjb21tZW5kYXRpb25zIHdpdGggYSB3aWRlciByYW5nZVxuICAgIGNvbnN0IGJhc2VTY2FsZWRFbmVyZ3kgPSAocmF3R3JlZ3NFbmVyZ3kgKyAxKSAvIDI7IC8vIENvbnZlcnQgZnJvbSByYW5nZSAoLTEsMSkgdG8gKDAsMSlcbiAgICBcbiAgICAvLyBBcHBseSBlbGVtZW50LXNwZWNpZmljIGluZmx1ZW5jZSBmb3IgZWFjaCBkb21pbmFudCBlbGVtZW50XG4gICAgbGV0IGVsZW1lbnRhbE1vZGlmaWVyID0gMDtcbiAgICBpZiAoZG9taW5hbnRFbGVtZW50ID09PSAnRmlyZScpIHtcbiAgICAgIGVsZW1lbnRhbE1vZGlmaWVyID0gMC4yNSAqICh0cmFuc2Zvcm1lZEVsZW1lbnRhbFByb3BlcnRpZXMuRmlyZSAtIDAuMjUpO1xuICAgIH0gZWxzZSBpZiAoZG9taW5hbnRFbGVtZW50ID09PSAnV2F0ZXInKSB7XG4gICAgICBlbGVtZW50YWxNb2RpZmllciA9IDAuMjAgKiAodHJhbnNmb3JtZWRFbGVtZW50YWxQcm9wZXJ0aWVzLldhdGVyIC0gMC4yNSk7XG4gICAgfSBlbHNlIGlmIChkb21pbmFudEVsZW1lbnQgPT09ICdFYXJ0aCcpIHtcbiAgICAgIGVsZW1lbnRhbE1vZGlmaWVyID0gMC4xOCAqICh0cmFuc2Zvcm1lZEVsZW1lbnRhbFByb3BlcnRpZXMuRWFydGggLSAwLjI1KTtcbiAgICB9IGVsc2UgaWYgKGRvbWluYW50RWxlbWVudCA9PT0gJ0FpcicpIHtcbiAgICAgIGVsZW1lbnRhbE1vZGlmaWVyID0gMC4xNSAqICh0cmFuc2Zvcm1lZEVsZW1lbnRhbFByb3BlcnRpZXMuQWlyIC0gMC4yNSk7XG4gICAgfVxuICAgIFxuICAgIC8vIEFwcGx5IGFsY2hlbWljYWwgcHJvcGVydHkgaW5mbHVlbmNlIHdpdGggaW5jcmVhc2VkIGltcGFjdFxuICAgIGxldCBhbGNoZW1pY2FsTW9kaWZpZXIgPSAwO1xuICAgIGlmIChkb21pbmFudEFsY2hlbWljYWxQcm9wZXJ0eSA9PT0gJ1NwaXJpdCcpIHtcbiAgICAgIGFsY2hlbWljYWxNb2RpZmllciA9IDAuMjIgKiAoYWxjaGVtaWNhbFJlc3VsdHMuYWxjaGVtaWNhbENvdW50cy5TcGlyaXQgLSAwLjI1KTtcbiAgICB9IGVsc2UgaWYgKGRvbWluYW50QWxjaGVtaWNhbFByb3BlcnR5ID09PSAnRXNzZW5jZScpIHtcbiAgICAgIGFsY2hlbWljYWxNb2RpZmllciA9IDAuMjAgKiAoYWxjaGVtaWNhbFJlc3VsdHMuYWxjaGVtaWNhbENvdW50cy5Fc3NlbmNlIC0gMC4yNSk7XG4gICAgfSBlbHNlIGlmIChkb21pbmFudEFsY2hlbWljYWxQcm9wZXJ0eSA9PT0gJ01hdHRlcicpIHtcbiAgICAgIGFsY2hlbWljYWxNb2RpZmllciA9IDAuMTggKiAoYWxjaGVtaWNhbFJlc3VsdHMuYWxjaGVtaWNhbENvdW50cy5NYXR0ZXIgLSAwLjI1KTtcbiAgICB9IGVsc2UgaWYgKGRvbWluYW50QWxjaGVtaWNhbFByb3BlcnR5ID09PSAnU3Vic3RhbmNlJykge1xuICAgICAgYWxjaGVtaWNhbE1vZGlmaWVyID0gMC4xNSAqIChhbGNoZW1pY2FsUmVzdWx0cy5hbGNoZW1pY2FsQ291bnRzLlN1YnN0YW5jZSAtIDAuMjUpO1xuICAgIH1cbiAgICBcbiAgICAvLyBBcHBseSB6b2RpYWMgaW5mbHVlbmNlIGlmIGF2YWlsYWJsZSB3aXRoIHN0cm9uZ2VyIGVmZmVjdFxuICAgIGxldCB6b2RpYWNNb2RpZmllciA9IDA7XG4gICAgaWYgKGN1cnJlbnRab2RpYWM/LnRvTG93ZXJDYXNlKCkgYXMgWm9kaWFjU2lnbikge1xuICAgICAgY29uc3Qgem9kaWFjU2lnbiA9IGN1cnJlbnRab2RpYWMudG9Mb3dlckNhc2UoKSBhcyBab2RpYWNTaWduO1xuICAgICAgY29uc3Qgem9kaWFjRWxlbWVudE1hcDogUmVjb3JkPFpvZGlhY1NpZ24sIEVsZW1lbnRhbENoYXJhY3Rlcj4gPSB7XG4gICAgICAgIGFyaWVzOiAnRmlyZScsIGxlbzogJ0ZpcmUnLCBzYWdpdHRhcml1czogJ0ZpcmUnLFxuICAgICAgICB0YXVydXM6ICdFYXJ0aCcsIHZpcmdvOiAnRWFydGgnLCBjYXByaWNvcm46ICdFYXJ0aCcsXG4gICAgICAgIGdlbWluaTogJ0FpcicsIGxpYnJhOiAnQWlyJywgYXF1YXJpdXM6ICdBaXInLFxuICAgICAgICBjYW5jZXI6ICdXYXRlcicsIHNjb3JwaW86ICdXYXRlcicsIHBpc2NlczogJ1dhdGVyJ1xuICAgICAgfTtcbiAgICAgIFxuICAgICAgY29uc3Qgem9kaWFjRWxlbWVudCA9IHpvZGlhY0VsZW1lbnRNYXBbem9kaWFjU2lnbl07XG4gICAgICBpZiAoem9kaWFjRWxlbWVudCAmJiB6b2RpYWNFbGVtZW50ID09PSBkb21pbmFudEVsZW1lbnQpIHtcbiAgICAgICAgem9kaWFjTW9kaWZpZXIgPSAwLjI1OyAvLyBJbmNyZWFzZWQgYm9udXMgZm9yIG1hdGNoaW5nIHpvZGlhYyBlbGVtZW50XG4gICAgICB9IGVsc2UgaWYgKHpvZGlhY0VsZW1lbnQpIHtcbiAgICAgICAgLy8gQ2FsY3VsYXRlIGNvbXBhdGliaWxpdHkgYmFzZWQgb24gZWxlbWVudGFsIHJlbGF0aW9uc2hpcHMgd2l0aCB3aWRlciB2YXJpYW5jZVxuICAgICAgICBpZiAoKHpvZGlhY0VsZW1lbnQgPT09ICdGaXJlJyAmJiBkb21pbmFudEVsZW1lbnQgPT09ICdBaXInKSB8fCBcbiAgICAgICAgICAgICh6b2RpYWNFbGVtZW50ID09PSAnQWlyJyAmJiBkb21pbmFudEVsZW1lbnQgPT09ICdGaXJlJykpIHtcbiAgICAgICAgICB6b2RpYWNNb2RpZmllciA9IDAuMTg7IC8vIEZpcmUgYW5kIEFpciBhcmUgY29tcGxlbWVudGFyeVxuICAgICAgICB9IGVsc2UgaWYgKCh6b2RpYWNFbGVtZW50ID09PSAnRWFydGgnICYmIGRvbWluYW50RWxlbWVudCA9PT0gJ1dhdGVyJykgfHwgXG4gICAgICAgICAgICAgICAgICAoem9kaWFjRWxlbWVudCA9PT0gJ1dhdGVyJyAmJiBkb21pbmFudEVsZW1lbnQgPT09ICdFYXJ0aCcpKSB7XG4gICAgICAgICAgem9kaWFjTW9kaWZpZXIgPSAwLjE4OyAvLyBFYXJ0aCBhbmQgV2F0ZXIgYXJlIGNvbXBsZW1lbnRhcnlcbiAgICAgICAgfSBlbHNlIGlmICgoem9kaWFjRWxlbWVudCA9PT0gJ0ZpcmUnICYmIGRvbWluYW50RWxlbWVudCA9PT0gJ0VhcnRoJykgfHwgXG4gICAgICAgICAgICAgICAgICAoem9kaWFjRWxlbWVudCA9PT0gJ0VhcnRoJyAmJiBkb21pbmFudEVsZW1lbnQgPT09ICdGaXJlJykpIHtcbiAgICAgICAgICB6b2RpYWNNb2RpZmllciA9IDAuMTI7IC8vIEZpcmUgYW5kIEVhcnRoIGhhdmUgbW9kZXJhdGUgY29tcGF0aWJpbGl0eVxuICAgICAgICB9IGVsc2UgaWYgKCh6b2RpYWNFbGVtZW50ID09PSAnV2F0ZXInICYmIGRvbWluYW50RWxlbWVudCA9PT0gJ0FpcicpIHx8IFxuICAgICAgICAgICAgICAgICAgKHpvZGlhY0VsZW1lbnQgPT09ICdBaXInICYmIGRvbWluYW50RWxlbWVudCA9PT0gJ1dhdGVyJykpIHtcbiAgICAgICAgICB6b2RpYWNNb2RpZmllciA9IDAuMTI7IC8vIFdhdGVyIGFuZCBBaXIgaGF2ZSBtb2RlcmF0ZSBjb21wYXRpYmlsaXR5XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgem9kaWFjTW9kaWZpZXIgPSAwLjA1OyAvLyBPdGhlciBjb21iaW5hdGlvbnMgaGF2ZSBsb3dlciBjb21wYXRpYmlsaXR5XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgLy8gQ2FsY3VsYXRlIGJvb3N0IGZyb20gcGxhbmV0YXJ5IGluZmx1ZW5jZSB3aXRoIG1vcmUgZGlmZmVyZW50aWF0aW9uXG4gICAgY29uc3QgcGxhbmV0YXJ5TW9kaWZpZXIgPSBNYXRoLm1pbigwLjI1LCAocGxhbmV0YXJ5Qm9vc3QgLSAxLjApICogMC44KTtcbiAgICBcbiAgICAvLyBBZGQgcmFuZG9taXplZCBmYWN0b3IgdG8gY3JlYXRlIG1vcmUgdmFyaWFuY2UgKMKxNyUpXG4gICAgY29uc3QgcmFuZG9tVmFyaWFuY2UgPSAoTWF0aC5yYW5kb20oKSAqIDAuMTQpIC0gMC4wNztcbiAgICBcbiAgICAvLyBDb21iaW5lIGFsbCBpbmZsdWVuY2VzIGZvciBhIG1vcmUgdmFyaWVkIGVuZXJneSBjYWxjdWxhdGlvblxuICAgIGNvbnN0IGFkanVzdGVkRW5lcmd5ID0gYmFzZVNjYWxlZEVuZXJneSArIGVsZW1lbnRhbE1vZGlmaWVyICsgYWxjaGVtaWNhbE1vZGlmaWVyICsgem9kaWFjTW9kaWZpZXIgKyBwbGFuZXRhcnlNb2RpZmllciArIHJhbmRvbVZhcmlhbmNlO1xuICAgIFxuICAgIC8vIEVuc3VyZSB0aGUgZmluYWwgdmFsdWUgaXMgd2l0aGluIHZhbGlkIHJhbmdlIGJ1dCBhbGxvd2luZyBtb3JlIHZhcmlhbmNlICh3aWRlciByYW5nZSlcbiAgICBjb25zdCBzYWZlR3JlZ3NFbmVyZ3kgPSBNYXRoLm1heCgwLjIwLCBNYXRoLm1pbigwLjk4LCBhZGp1c3RlZEVuZXJneSkpO1xuICAgIFxuICAgIC8vIEFkZCBtb3JlIGRlYnVnIGxvZ2dpbmdcbiAgICBsb2dnZXIuZGVidWcoYFtJbmdyZWRpZW50OiAke3Nhbml0aXplZEl0ZW0ubmFtZX1dIFJhdyBoZWF0OiAke2FsY2hlbWljYWxSZXN1bHRzLmhlYXR9LCBCb29zdGVkIGhlYXQ6ICR7c2FmZUhlYXR9LCBQbGFuZXRhcnkgYm9vc3Q6ICR7cGxhbmV0YXJ5Qm9vc3R9YCk7XG4gICAgXG4gICAgcmV0dXJuIHtcbiAgICAgIC4uLnNhbml0aXplZEl0ZW0sXG4gICAgICBhbGNoZW1pY2FsUHJvcGVydGllczogYWxjaGVtaWNhbFJlc3VsdHMuYWxjaGVtaWNhbENvdW50cyxcbiAgICAgIHRyYW5zZm9ybWVkRWxlbWVudGFsUHJvcGVydGllcyxcbiAgICAgIGhlYXQ6IHNhZmVIZWF0LFxuICAgICAgZW50cm9weTogc2FmZUVudHJvcHksXG4gICAgICByZWFjdGl2aXR5OiBzYWZlUmVhY3Rpdml0eSxcbiAgICAgIGdyZWdzRW5lcmd5OiBzYWZlR3JlZ3NFbmVyZ3ksXG4gICAgICBkb21pbmFudEVsZW1lbnQsXG4gICAgICBkb21pbmFudEFsY2hlbWljYWxQcm9wZXJ0eSxcbiAgICAgIHBsYW5ldGFyeUJvb3N0LFxuICAgICAgZG9taW5hbnRQbGFuZXRzLFxuICAgICAgcGxhbmV0YXJ5RGlnbml0aWVzXG4gICAgfTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBsb2dnZXIuZXJyb3IoYEVycm9yIHRyYW5zZm9ybWluZyBpdGVtICR7aXRlbS5uYW1lfTpgLCBlcnJvcik7XG4gICAgLy8gUmV0dXJuIGEgc2FmZSBmYWxsYmFjayB3aXRoIG9yaWdpbmFsIHZhbHVlcyBwcmVzZXJ2ZWRcbiAgICByZXR1cm4ge1xuICAgICAgLi4uaXRlbSxcbiAgICAgIGFsY2hlbWljYWxQcm9wZXJ0aWVzOiB7XG4gICAgICAgIFNwaXJpdDogMC4yNSxcbiAgICAgICAgRXNzZW5jZTogMC4yNSxcbiAgICAgICAgTWF0dGVyOiAwLjI1LFxuICAgICAgICBTdWJzdGFuY2U6IDAuMjVcbiAgICAgIH0sXG4gICAgICB0cmFuc2Zvcm1lZEVsZW1lbnRhbFByb3BlcnRpZXM6IHsuLi5pdGVtLmVsZW1lbnRhbFByb3BlcnRpZXN9LFxuICAgICAgaGVhdDogMC41LFxuICAgICAgZW50cm9weTogMC41LFxuICAgICAgcmVhY3Rpdml0eTogMC41LFxuICAgICAgZ3JlZ3NFbmVyZ3k6IDAuNSxcbiAgICAgIGRvbWluYW50RWxlbWVudDogZ2V0RG9taW5hbnRFbGVtZW50KGl0ZW0uZWxlbWVudGFsUHJvcGVydGllcyksXG4gICAgICBkb21pbmFudEFsY2hlbWljYWxQcm9wZXJ0eTogJ0Vzc2VuY2UnLFxuICAgICAgcGxhbmV0YXJ5Qm9vc3Q6IDEuMCxcbiAgICAgIGRvbWluYW50UGxhbmV0czogW10sXG4gICAgICBwbGFuZXRhcnlEaWduaXRpZXM6IHt9XG4gICAgfTtcbiAgfVxufTtcblxuLyoqXG4gKiBUcmFuc2Zvcm0gYSBjb2xsZWN0aW9uIG9mIGl0ZW1zIHVzaW5nIGN1cnJlbnQgcGxhbmV0YXJ5IHBvc2l0aW9uc1xuICovXG5leHBvcnQgY29uc3QgdHJhbnNmb3JtSXRlbXNXaXRoUGxhbmV0YXJ5UG9zaXRpb25zID0gKFxuICBpdGVtczogRWxlbWVudGFsSXRlbVtdLFxuICBwbGFuZXRQb3NpdGlvbnM6IFJlY29yZDxzdHJpbmcsIENlbGVzdGlhbFBvc2l0aW9uPixcbiAgaXNEYXl0aW1lOiBib29sZWFuLFxuICBjdXJyZW50Wm9kaWFjPzogc3RyaW5nIHwgbnVsbCxcbiAgbHVuYXJQaGFzZT86IEx1bmFyUGhhc2VXaXRoU3BhY2VzIHwgbnVsbFxuKTogQWxjaGVtaWNhbEl0ZW1bXSA9PiB7XG4gIHRyeSB7XG4gICAgcmV0dXJuIGl0ZW1zLm1hcChpdGVtID0+IFxuICAgICAgdHJhbnNmb3JtSXRlbVdpdGhQbGFuZXRhcnlQb3NpdGlvbnMoXG4gICAgICAgIGl0ZW0sIFxuICAgICAgICBwbGFuZXRQb3NpdGlvbnMsIFxuICAgICAgICBpc0RheXRpbWUsXG4gICAgICAgIGN1cnJlbnRab2RpYWMsXG4gICAgICAgIGx1bmFyUGhhc2VcbiAgICAgIClcbiAgICApO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGxvZ2dlci5lcnJvcignRXJyb3IgdHJhbnNmb3JtaW5nIG11bHRpcGxlIGl0ZW1zOicsIGVycm9yKTtcbiAgICAvLyBSZXR1cm4gdGhlIG9yaWdpbmFsIGl0ZW1zIHdpdGggbWluaW1hbCB0cmFuc2Zvcm1hdGlvbiBpZiBiYXRjaCBwcm9jZXNzaW5nIGZhaWxzXG4gICAgcmV0dXJuIGl0ZW1zLm1hcChpdGVtID0+ICh7XG4gICAgICAuLi5pdGVtLFxuICAgICAgYWxjaGVtaWNhbFByb3BlcnRpZXM6IHtcbiAgICAgICAgU3Bpcml0OiAwLjI1LFxuICAgICAgICBFc3NlbmNlOiAwLjI1LFxuICAgICAgICBNYXR0ZXI6IDAuMjUsXG4gICAgICAgIFN1YnN0YW5jZTogMC4yNVxuICAgICAgfSxcbiAgICAgIHRyYW5zZm9ybWVkRWxlbWVudGFsUHJvcGVydGllczogey4uLml0ZW0uZWxlbWVudGFsUHJvcGVydGllc30sXG4gICAgICBoZWF0OiAwLjUsXG4gICAgICBlbnRyb3B5OiAwLjUsXG4gICAgICByZWFjdGl2aXR5OiAwLjUsXG4gICAgICBncmVnc0VuZXJneTogMC41LFxuICAgICAgZG9taW5hbnRFbGVtZW50OiBnZXREb21pbmFudEVsZW1lbnQoaXRlbS5lbGVtZW50YWxQcm9wZXJ0aWVzKSxcbiAgICAgIGRvbWluYW50QWxjaGVtaWNhbFByb3BlcnR5OiAnRXNzZW5jZScgYXMgQWxjaGVtaWNhbFByb3BlcnR5LFxuICAgICAgcGxhbmV0YXJ5Qm9vc3Q6IDEuMCxcbiAgICAgIGRvbWluYW50UGxhbmV0czogW10sXG4gICAgICBwbGFuZXRhcnlEaWduaXRpZXM6IHt9XG4gICAgfSkpO1xuICB9XG59O1xuXG4vKipcbiAqIFRyYW5zZm9ybSBlbGVtZW50YWwgcHJvcGVydGllcyB1c2luZyBhbGNoZW1pY2FsIHJlc3VsdHMgYW5kIHBsYW5ldGFyeSBib29zdFxuICogVGhpcyBhcHBsaWVzIHRoZSBhbGNoZW1pY2FsIGluZmx1ZW5jZSB0byB0aGUgYmFzZSBlbGVtZW50YWwgcHJvcGVydGllc1xuICovXG5jb25zdCB0cmFuc2Zvcm1FbGVtZW50YWxQcm9wZXJ0aWVzID0gKFxuICBvcmlnaW5hbFByb3BlcnRpZXM6IFJlY29yZDxFbGVtZW50YWxDaGFyYWN0ZXIsIG51bWJlcj4sXG4gIGFsY2hlbWljYWxSZXN1bHRzOiBBbGNoZW1pY2FsUmVzdWx0cyxcbiAgcGxhbmV0YXJ5Qm9vc3Q6IG51bWJlciA9IDEuMCxcbiAgem9kaWFjU2lnbj86IFpvZGlhY1NpZ25cbik6IFJlY29yZDxFbGVtZW50YWxDaGFyYWN0ZXIsIG51bWJlcj4gPT4ge1xuICB0cnkge1xuICAgIC8vIENyZWF0ZSBhIGNvcHkgb2YgdGhlIG9yaWdpbmFsIHByb3BlcnRpZXNcbiAgICBjb25zdCB0cmFuc2Zvcm1lZFByb3BlcnRpZXM6IFJlY29yZDxFbGVtZW50YWxDaGFyYWN0ZXIsIG51bWJlcj4gPSB7IC4uLm9yaWdpbmFsUHJvcGVydGllcyB9O1xuICAgIFxuICAgIC8vIENhbGN1bGF0ZSBiYXNlIGVuaGFuY2VtZW50IGZhY3RvciAtIHN0cm9uZ2VyIGVmZmVjdCBvbiBkb21pbmFudCBlbGVtZW50c1xuICAgIC8vIEVuaGFuY2VkIGJ5IHBsYW5ldGFyeSBib29zdCwgYnV0IGNhcCB0aGUgZW5oYW5jZW1lbnQgZmFjdG9yIHRvIHByZXZlbnQgZXhjZXNzaXZlIHZhbHVlc1xuICAgIGNvbnN0IGVuaGFuY2VtZW50RmFjdG9yID0gTWF0aC5taW4oMC4xMCwgMC4xNSAqIHBsYW5ldGFyeUJvb3N0KSAqIDAuNTtcbiAgICBcbiAgICAvLyBHZXQgdGhlIGRvbWluYW50IG9yaWdpbmFsIGVsZW1lbnQgdG8gcHJlc2VydmUgY2hhcmFjdGVyXG4gICAgY29uc3QgZG9taW5hbnRFbGVtZW50ID0gZ2V0RG9taW5hbnRFbGVtZW50KG9yaWdpbmFsUHJvcGVydGllcyk7XG4gICAgXG4gICAgLy8gQXBwbHkgdHJhbnNmb3JtYXRpb25zIGJhc2VkIG9uIGFsY2hlbWljYWwgcHJvcGVydGllcywgd2l0aCByZWR1Y2VkIGVuaGFuY2Vyc1xuICAgIC8vIFNwaXJpdCBlbmhhbmNlcyBGaXJlIG1vcmUgaWYgRmlyZSBpcyBhbHJlYWR5IHByZXNlbnRcbiAgICB0cmFuc2Zvcm1lZFByb3BlcnRpZXMuRmlyZSArPSBcbiAgICAgIChhbGNoZW1pY2FsUmVzdWx0cy5hbGNoZW1pY2FsQ291bnRzLlNwaXJpdCAqIGVuaGFuY2VtZW50RmFjdG9yICogKG9yaWdpbmFsUHJvcGVydGllcy5GaXJlICsgMC4xNSkpICogMC44O1xuICAgIFxuICAgIC8vIEVzc2VuY2UgZW5oYW5jZXMgV2F0ZXIgbW9yZSBpZiBXYXRlciBpcyBhbHJlYWR5IHByZXNlbnRcbiAgICB0cmFuc2Zvcm1lZFByb3BlcnRpZXMuV2F0ZXIgKz0gXG4gICAgICAoYWxjaGVtaWNhbFJlc3VsdHMuYWxjaGVtaWNhbENvdW50cy5Fc3NlbmNlICogZW5oYW5jZW1lbnRGYWN0b3IgKiAob3JpZ2luYWxQcm9wZXJ0aWVzLldhdGVyICsgMC4xNSkpICogMC43O1xuICAgIFxuICAgIC8vIE1hdHRlciBlbmhhbmNlcyBFYXJ0aCBtb3JlIGlmIEVhcnRoIGlzIGFscmVhZHkgcHJlc2VudFxuICAgIHRyYW5zZm9ybWVkUHJvcGVydGllcy5FYXJ0aCArPSBcbiAgICAgIChhbGNoZW1pY2FsUmVzdWx0cy5hbGNoZW1pY2FsQ291bnRzLk1hdHRlciAqIGVuaGFuY2VtZW50RmFjdG9yICogKG9yaWdpbmFsUHJvcGVydGllcy5FYXJ0aCArIDAuMTUpKSAqIDAuNztcbiAgICBcbiAgICAvLyBTdWJzdGFuY2UgZW5oYW5jZXMgQWlyIG1vcmUgaWYgQWlyIGlzIGFscmVhZHkgcHJlc2VudFxuICAgIHRyYW5zZm9ybWVkUHJvcGVydGllcy5BaXIgKz0gXG4gICAgICAoYWxjaGVtaWNhbFJlc3VsdHMuYWxjaGVtaWNhbENvdW50cy5TdWJzdGFuY2UgKiBlbmhhbmNlbWVudEZhY3RvciAqIChvcmlnaW5hbFByb3BlcnRpZXMuQWlyICsgMC4xNSkpICogMC43O1xuICAgIFxuICAgIC8vIEFwcGx5IGNyb3NzLWVsZW1lbnQgaW5mbHVlbmNlcyB3aXRoIG1vcmUgZHluYW1pYyBjYWxjdWxhdGlvbnMsIHdpdGggcmVkdWNlZCBzdHJlbmd0aFxuICAgIGFwcGx5RWxlbWVudGFsSW5mbHVlbmNlcyh0cmFuc2Zvcm1lZFByb3BlcnRpZXMsIGFsY2hlbWljYWxSZXN1bHRzLmVsZW1lbnRhbENvdW50cywgb3JpZ2luYWxQcm9wZXJ0aWVzLCBNYXRoLm1pbigxLjAsIHBsYW5ldGFyeUJvb3N0ICogMC43KSk7XG4gICAgXG4gICAgLy8gQm9vc3QgdGhlIGRvbWluYW50IGVsZW1lbnQgc2xpZ2h0bHkgdG8gcHJlc2VydmUgaW5ncmVkaWVudCBjaGFyYWN0ZXIsIGJ1dCBjYXAgdGhlIGJvb3N0XG4gICAgdHJhbnNmb3JtZWRQcm9wZXJ0aWVzW2RvbWluYW50RWxlbWVudF0gKj0gTWF0aC5taW4oMS4wNSwgMS4xICogcGxhbmV0YXJ5Qm9vc3QpO1xuICAgIFxuICAgIC8vIEFwcGx5IHpvZGlhYy1zcGVjaWZpYyBib29zdCBpZiBhdmFpbGFibGVcbiAgICBpZiAoem9kaWFjU2lnbikge1xuICAgICAgYXBwbHlab2RpYWNCb29zdCh0cmFuc2Zvcm1lZFByb3BlcnRpZXMsIHpvZGlhY1NpZ24pO1xuICAgIH1cbiAgICBcbiAgICAvLyBOb3JtYWxpemUgdGhlIHZhbHVlcyBzbyB0aGV5IHN1bSB0byAxLjBcbiAgICBub3JtYWxpemVWYWx1ZXModHJhbnNmb3JtZWRQcm9wZXJ0aWVzKTtcbiAgICBcbiAgICByZXR1cm4gdHJhbnNmb3JtZWRQcm9wZXJ0aWVzO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGxvZ2dlci5lcnJvcignRXJyb3IgdHJhbnNmb3JtaW5nIGVsZW1lbnRhbCBwcm9wZXJ0aWVzOicsIGVycm9yKTtcbiAgICAvLyBSZXR1cm4gdGhlIG9yaWdpbmFsIHByb3BlcnRpZXMgaWYgdGhlcmUncyBhbiBlcnJvclxuICAgIHJldHVybiB7IC4uLm9yaWdpbmFsUHJvcGVydGllcyB9O1xuICB9XG59O1xuXG4vKipcbiAqIEFwcGx5IHpvZGlhYy1zcGVjaWZpYyBib29zdHMgdG8gZWxlbWVudGFsIHByb3BlcnRpZXNcbiAqL1xuY29uc3QgYXBwbHlab2RpYWNCb29zdCA9IChcbiAgdHJhbnNmb3JtZWRQcm9wZXJ0aWVzOiBSZWNvcmQ8RWxlbWVudGFsQ2hhcmFjdGVyLCBudW1iZXI+LFxuICB6b2RpYWNTaWduOiBab2RpYWNTaWduXG4pOiB2b2lkID0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCB6b2RpYWNFbGVtZW50TWFwOiBSZWNvcmQ8Wm9kaWFjU2lnbiwgRWxlbWVudGFsQ2hhcmFjdGVyPiA9IHtcbiAgICAgIGFyaWVzOiAnRmlyZScsXG4gICAgICB0YXVydXM6ICdFYXJ0aCcsXG4gICAgICBnZW1pbmk6ICdBaXInLFxuICAgICAgY2FuY2VyOiAnV2F0ZXInLFxuICAgICAgbGVvOiAnRmlyZScsXG4gICAgICB2aXJnbzogJ0VhcnRoJyxcbiAgICAgIGxpYnJhOiAnQWlyJyxcbiAgICAgIHNjb3JwaW86ICdXYXRlcicsXG4gICAgICBzYWdpdHRhcml1czogJ0ZpcmUnLFxuICAgICAgY2Fwcmljb3JuOiAnRWFydGgnLFxuICAgICAgYXF1YXJpdXM6ICdBaXInLFxuICAgICAgcGlzY2VzOiAnV2F0ZXInXG4gICAgfTtcbiAgICBcbiAgICBjb25zdCB6b2RpYWNFbGVtZW50ID0gem9kaWFjRWxlbWVudE1hcFt6b2RpYWNTaWduXTtcbiAgICBpZiAoem9kaWFjRWxlbWVudCkge1xuICAgICAgLy8gQXBwbHkgYSBzbWFsbCBib29zdCB0byB0aGUgY29ycmVzcG9uZGluZyBlbGVtZW50XG4gICAgICB0cmFuc2Zvcm1lZFByb3BlcnRpZXNbem9kaWFjRWxlbWVudF0gKj0gMS4wNTtcbiAgICB9XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgbG9nZ2VyLmVycm9yKGBFcnJvciBhcHBseWluZyB6b2RpYWMgYm9vc3QgZm9yICR7em9kaWFjU2lnbn06YCwgZXJyb3IpO1xuICAgIC8vIE5vIG1vZGlmaWNhdGlvbnMgdG8gdHJhbnNmb3JtZWRQcm9wZXJ0aWVzIG5lZWRlZCBpbiBjYXNlIG9mIGVycm9yXG4gIH1cbn07XG5cbi8qKlxuICogQXBwbHkgY3Jvc3MtZWxlbWVudCBpbmZsdWVuY2VzIGJhc2VkIG9uIGVsZW1lbnRhbCBjb3VudHMgYW5kIGJvb3N0XG4gKi9cbmNvbnN0IGFwcGx5RWxlbWVudGFsSW5mbHVlbmNlcyA9IChcbiAgdHJhbnNmb3JtZWRQcm9wZXJ0aWVzOiBSZWNvcmQ8RWxlbWVudGFsQ2hhcmFjdGVyLCBudW1iZXI+LFxuICBlbGVtZW50YWxDb3VudHM6IFJlY29yZDxFbGVtZW50YWxDaGFyYWN0ZXIsIG51bWJlcj4sXG4gIG9yaWdpbmFsUHJvcGVydGllczogUmVjb3JkPEVsZW1lbnRhbENoYXJhY3RlciwgbnVtYmVyPixcbiAgcGxhbmV0YXJ5Qm9vc3Q6IG51bWJlciA9IDEuMFxuKTogdm9pZCA9PiB7XG4gIHRyeSB7XG4gICAgLy8gQ2FsY3VsYXRlIGluZmx1ZW5jZSBmYWN0b3JzIGJhc2VkIG9uIGVsZW1lbnRhbCBjb3VudHNcbiAgICBjb25zdCBmaXJlSW5mbHVlbmNlID0gZWxlbWVudGFsQ291bnRzLkZpcmUgKiAwLjA4ICogcGxhbmV0YXJ5Qm9vc3Q7XG4gICAgY29uc3Qgd2F0ZXJJbmZsdWVuY2UgPSBlbGVtZW50YWxDb3VudHMuV2F0ZXIgKiAwLjA2ICogcGxhbmV0YXJ5Qm9vc3Q7XG4gICAgY29uc3QgZWFydGhJbmZsdWVuY2UgPSBlbGVtZW50YWxDb3VudHMuRWFydGggKiAwLjA3ICogcGxhbmV0YXJ5Qm9vc3Q7XG4gICAgY29uc3QgYWlySW5mbHVlbmNlID0gZWxlbWVudGFsQ291bnRzLkFpciAqIDAuMDUgKiBwbGFuZXRhcnlCb29zdDtcbiAgICBcbiAgICAvLyBGaXJlIGluZmx1ZW5jZXMgLSBpbmNyZWFzZXMgRWFydGgsIGRlY3JlYXNlcyBXYXRlclxuICAgIHRyYW5zZm9ybWVkUHJvcGVydGllcy5FYXJ0aCArPSBmaXJlSW5mbHVlbmNlICogKG9yaWdpbmFsUHJvcGVydGllcy5FYXJ0aCAqIDAuNSk7XG4gICAgdHJhbnNmb3JtZWRQcm9wZXJ0aWVzLldhdGVyIC09IGZpcmVJbmZsdWVuY2UgKiAob3JpZ2luYWxQcm9wZXJ0aWVzLldhdGVyICogMC4xKTtcbiAgICBcbiAgICAvLyBXYXRlciBpbmZsdWVuY2VzIC0gaW5jcmVhc2VzIEFpciwgZGVjcmVhc2VzIEZpcmVcbiAgICB0cmFuc2Zvcm1lZFByb3BlcnRpZXMuQWlyICs9IHdhdGVySW5mbHVlbmNlICogKG9yaWdpbmFsUHJvcGVydGllcy5BaXIgKiAwLjUpO1xuICAgIHRyYW5zZm9ybWVkUHJvcGVydGllcy5GaXJlIC09IHdhdGVySW5mbHVlbmNlICogKG9yaWdpbmFsUHJvcGVydGllcy5GaXJlICogMC4xKTtcbiAgICBcbiAgICAvLyBFYXJ0aCBpbmZsdWVuY2VzIC0gaW5jcmVhc2VzIFdhdGVyLCBkZWNyZWFzZXMgQWlyIFxuICAgIHRyYW5zZm9ybWVkUHJvcGVydGllcy5XYXRlciArPSBlYXJ0aEluZmx1ZW5jZSAqIChvcmlnaW5hbFByb3BlcnRpZXMuV2F0ZXIgKiAwLjUpO1xuICAgIHRyYW5zZm9ybWVkUHJvcGVydGllcy5BaXIgLT0gZWFydGhJbmZsdWVuY2UgKiAob3JpZ2luYWxQcm9wZXJ0aWVzLkFpciAqIDAuMSk7XG4gICAgXG4gICAgLy8gQWlyIGluZmx1ZW5jZXMgLSBpbmNyZWFzZXMgRmlyZSwgZGVjcmVhc2VzIEVhcnRoXG4gICAgdHJhbnNmb3JtZWRQcm9wZXJ0aWVzLkZpcmUgKz0gYWlySW5mbHVlbmNlICogKG9yaWdpbmFsUHJvcGVydGllcy5GaXJlICogMC41KTtcbiAgICB0cmFuc2Zvcm1lZFByb3BlcnRpZXMuRWFydGggLT0gYWlySW5mbHVlbmNlICogKG9yaWdpbmFsUHJvcGVydGllcy5FYXJ0aCAqIDAuMSk7XG4gICAgXG4gICAgLy8gRW5zdXJlIGFsbCB2YWx1ZXMgcmVtYWluIHBvc2l0aXZlXG4gICAgT2JqZWN0LmtleXModHJhbnNmb3JtZWRQcm9wZXJ0aWVzKS5mb3JFYWNoKGtleSA9PiB7XG4gICAgICB0cmFuc2Zvcm1lZFByb3BlcnRpZXNba2V5IGFzIEVsZW1lbnRhbENoYXJhY3Rlcl0gPSBNYXRoLm1heCgwLjA1LCB0cmFuc2Zvcm1lZFByb3BlcnRpZXNba2V5IGFzIEVsZW1lbnRhbENoYXJhY3Rlcl0pO1xuICAgIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGxvZ2dlci5lcnJvcignRXJyb3IgYXBwbHlpbmcgZWxlbWVudGFsIGluZmx1ZW5jZXM6JywgZXJyb3IpO1xuICAgIC8vIExlYXZlIHRyYW5zZm9ybWVkUHJvcGVydGllcyB1bmNoYW5nZWQgaW4gY2FzZSBvZiBlcnJvclxuICB9XG59O1xuXG4vKipcbiAqIENhbGN1bGF0ZSB0aGUgZG9taW5hbnQgZWxlbWVudCBmcm9tIGEgc2V0IG9mIGVsZW1lbnRhbCBwcm9wZXJ0aWVzXG4gKi9cbmNvbnN0IGdldERvbWluYW50RWxlbWVudCA9IChcbiAgdHJhbnNmb3JtZWRQcm9wZXJ0aWVzOiBSZWNvcmQ8RWxlbWVudGFsQ2hhcmFjdGVyLCBudW1iZXI+XG4pOiBFbGVtZW50YWxDaGFyYWN0ZXIgPT4ge1xuICB0cnkge1xuICAgIGxldCBtYXhWYWx1ZSA9IC1JbmZpbml0eTtcbiAgICBsZXQgZG9taW5hbnRFbGVtZW50OiBFbGVtZW50YWxDaGFyYWN0ZXIgPSAnRmlyZSc7IC8vIERlZmF1bHRcbiAgICBcbiAgICAoT2JqZWN0LmVudHJpZXModHJhbnNmb3JtZWRQcm9wZXJ0aWVzKSBhcyBbRWxlbWVudGFsQ2hhcmFjdGVyLCBudW1iZXJdW10pLmZvckVhY2goKFtlbGVtZW50LCB2YWx1ZV0pID0+IHtcbiAgICAgIC8vIFBhdHRlcm4gS0stODogQWR2YW5jZWQgY2FsY3VsYXRpb24gc2FmZXR5IGZvciBjb21wYXJpc29uIG9wZXJhdGlvbnNcbiAgICAgIGNvbnN0IG51bWVyaWNWYWx1ZSA9IE51bWJlcih2YWx1ZSkgfHwgMDtcbiAgICAgIGNvbnN0IG51bWVyaWNNYXhWYWx1ZSA9IE51bWJlcihtYXhWYWx1ZSkgfHwgLUluZmluaXR5O1xuICAgICAgaWYgKG51bWVyaWNWYWx1ZSA+IG51bWVyaWNNYXhWYWx1ZSkge1xuICAgICAgICBtYXhWYWx1ZSA9IG51bWVyaWNWYWx1ZTtcbiAgICAgICAgZG9taW5hbnRFbGVtZW50ID0gZWxlbWVudDtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBcbiAgICByZXR1cm4gZG9taW5hbnRFbGVtZW50O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGxvZ2dlci5lcnJvcignRXJyb3IgZGV0ZXJtaW5pbmcgZG9taW5hbnQgZWxlbWVudDonLCBlcnJvcik7XG4gICAgcmV0dXJuICdGaXJlJzsgLy8gRGVmYXVsdCBmYWxsYmFja1xuICB9XG59O1xuXG4vKipcbiAqIENhbGN1bGF0ZSB0aGUgZG9taW5hbnQgYWxjaGVtaWNhbCBwcm9wZXJ0eSBmcm9tIGFsY2hlbWljYWwgY291bnRzXG4gKi9cbmNvbnN0IGdldERvbWluYW50QWxjaGVtaWNhbFByb3BlcnR5ID0gKFxuICBhbGNoZW1pY2FsQ291bnRzOiBSZWNvcmQ8QWxjaGVtaWNhbFByb3BlcnR5LCBudW1iZXI+XG4pOiBBbGNoZW1pY2FsUHJvcGVydHkgPT4ge1xuICB0cnkge1xuICAgIGxldCBtYXhWYWx1ZSA9IC1JbmZpbml0eTtcbiAgICBsZXQgZG9taW5hbnRQcm9wZXJ0eTogQWxjaGVtaWNhbFByb3BlcnR5ID0gJ1NwaXJpdCc7IC8vIERlZmF1bHRcbiAgICBcbiAgICAoT2JqZWN0LmVudHJpZXMoYWxjaGVtaWNhbENvdW50cykgYXMgW0FsY2hlbWljYWxQcm9wZXJ0eSwgbnVtYmVyXVtdKS5mb3JFYWNoKChbcHJvcGVydHksIHZhbHVlXSkgPT4ge1xuICAgICAgLy8gUGF0dGVybiBLSy04OiBBZHZhbmNlZCBjYWxjdWxhdGlvbiBzYWZldHkgZm9yIGNvbXBhcmlzb24gb3BlcmF0aW9uc1xuICAgICAgY29uc3QgbnVtZXJpY1ZhbHVlID0gTnVtYmVyKHZhbHVlKSB8fCAwO1xuICAgICAgY29uc3QgbnVtZXJpY01heFZhbHVlID0gTnVtYmVyKG1heFZhbHVlKSB8fCAtSW5maW5pdHk7XG4gICAgICBpZiAobnVtZXJpY1ZhbHVlID4gbnVtZXJpY01heFZhbHVlKSB7XG4gICAgICAgIG1heFZhbHVlID0gbnVtZXJpY1ZhbHVlO1xuICAgICAgICBkb21pbmFudFByb3BlcnR5ID0gcHJvcGVydHk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgXG4gICAgcmV0dXJuIGRvbWluYW50UHJvcGVydHk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgbG9nZ2VyLmVycm9yKCdFcnJvciBkZXRlcm1pbmluZyBkb21pbmFudCBhbGNoZW1pY2FsIHByb3BlcnR5OicsIGVycm9yKTtcbiAgICByZXR1cm4gJ1NwaXJpdCc7IC8vIERlZmF1bHQgZmFsbGJhY2tcbiAgfVxufTtcblxuLyoqXG4gKiBOb3JtYWxpemUgdmFsdWVzIGluIGEgcmVjb3JkIHRvIHN1bSB0byAxLjBcbiAqL1xuY29uc3Qgbm9ybWFsaXplVmFsdWVzID0gPFQgZXh0ZW5kcyBzdHJpbmc+KHJlY29yZDogUmVjb3JkPFQsIG51bWJlcj4pOiB2b2lkID0+IHtcbiAgdHJ5IHtcbiAgICAvLyBQYXR0ZXJuIEtLLTg6IEFkdmFuY2VkIGNhbGN1bGF0aW9uIHNhZmV0eSBmb3IgcmVkdWN0aW9uIGFuZCBkaXZpc2lvblxuICAgIGNvbnN0IHN1bSA9IE9iamVjdC52YWx1ZXMocmVjb3JkKS5yZWR1Y2UoKGFjYywgdmFsKSA9PiB7XG4gICAgICBjb25zdCBudW1lcmljQWNjID0gTnVtYmVyKGFjYykgfHwgMDtcbiAgICAgIGNvbnN0IG51bWVyaWNWYWwgPSBOdW1iZXIodmFsKSB8fCAwO1xuICAgICAgcmV0dXJuIG51bWVyaWNBY2MgKyBudW1lcmljVmFsO1xuICAgIH0sIDApO1xuICAgIGNvbnN0IG51bWVyaWNTdW0gPSBOdW1iZXIoc3VtKSB8fCAwO1xuICAgIGlmIChudW1lcmljU3VtID4gMCkge1xuICAgICAgT2JqZWN0LmtleXMocmVjb3JkKS5mb3JFYWNoKGtleSA9PiB7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRWYWx1ZSA9IE51bWJlcihyZWNvcmRba2V5IGFzIFRdKSB8fCAwO1xuICAgICAgICByZWNvcmRba2V5IGFzIFRdID0gY3VycmVudFZhbHVlIC8gbnVtZXJpY1N1bTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBsb2dnZXIuZXJyb3IoJ0Vycm9yIG5vcm1hbGl6aW5nIHZhbHVlczonLCBlcnJvcik7XG4gICAgLy8gSWYgbm9ybWFsaXphdGlvbiBmYWlscywgbGVhdmUgdmFsdWVzIGFzIHRoZXkgYXJlXG4gIH1cbn07ICJdLCJ2ZXJzaW9uIjozfQ==