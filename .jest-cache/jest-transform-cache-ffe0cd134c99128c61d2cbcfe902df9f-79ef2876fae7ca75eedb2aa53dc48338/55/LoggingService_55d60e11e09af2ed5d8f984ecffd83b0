d4bd364b862ed4a8a675ac5c9dba26b3
"use strict";
/**
 * Centralized Logging Service for WhatToEatNext
 *
 * Provides structured logging with different levels and contexts.
 * Replaces console.log statements in production code while preserving
 * console.warn and console.error for debugging purposes.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.LoggingService = exports.log = exports.LogLevel = void 0;
var LogLevel;
(function (LogLevel) {
    LogLevel[LogLevel["DEBUG"] = 0] = "DEBUG";
    LogLevel[LogLevel["INFO"] = 1] = "INFO";
    LogLevel[LogLevel["WARN"] = 2] = "WARN";
    LogLevel[LogLevel["ERROR"] = 3] = "ERROR";
    LogLevel[LogLevel["SILENT"] = 4] = "SILENT";
})(LogLevel || (exports.LogLevel = LogLevel = {}));
class LoggingService {
    static instance;
    logLevel = LogLevel.INFO;
    isDevelopment;
    logBuffer = [];
    maxBufferSize = 1000;
    constructor() {
        this.isDevelopment = process.env.NODE_ENV === 'development';
        // Set log level based on environment
        if (this.isDevelopment) {
            this.logLevel = LogLevel.DEBUG;
        }
        else if (process.env.NODE_ENV === 'test') {
            this.logLevel = LogLevel.WARN;
        }
        else {
            this.logLevel = LogLevel.INFO;
        }
    }
    static getInstance() {
        if (!LoggingService.instance) {
            LoggingService.instance = new LoggingService();
        }
        return LoggingService.instance;
    }
    setLogLevel(level) {
        this.logLevel = level;
    }
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    debug(message, context, data) {
        this.log(LogLevel.DEBUG, message, context, undefined, data);
    }
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    info(message, context, data) {
        this.log(LogLevel.INFO, message, context, undefined, data);
    }
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    warn(message, context, data) {
        this.log(LogLevel.WARN, message, context, undefined, data);
    }
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    error(message, context, error, data) {
        this.log(LogLevel.ERROR, message, context, error, data);
    }
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    log(level, message, context, error, data) {
        if (level < this.logLevel) {
            return;
        }
        const logEntry = {
            timestamp: new Date(),
            level,
            message,
            context,
            error,
            data
        };
        // Add to buffer
        this.addToBuffer(logEntry);
        // Output to console based on level and environment
        this.outputToConsole(logEntry);
    }
    addToBuffer(entry) {
        this.logBuffer.push(entry);
        // Maintain buffer size
        if (this.logBuffer.length > this.maxBufferSize) {
            this.logBuffer.shift();
        }
    }
    outputToConsole(entry) {
        const timestamp = entry.timestamp.toISOString();
        const contextStr = entry.context ? this.formatContext(entry.context) : '';
        const levelStr = LogLevel[entry.level];
        const baseMessage = `[${timestamp}] ${levelStr}: ${entry.message}${contextStr}`;
        switch (entry.level) {
            case LogLevel.DEBUG:
                if (this.isDevelopment) {
                    exports.log.info(`ðŸ› ${baseMessage}`, entry.data || '');
                }
                break;
            case LogLevel.INFO:
                exports.log.info(`â„¹ï¸ ${baseMessage}`, entry.data || '');
                break;
            case LogLevel.WARN:
                console.warn(`âš ï¸ ${baseMessage}`, entry.data || '');
                break;
            case LogLevel.ERROR:
                console.error(`âŒ ${baseMessage}`, entry.error || entry.data || '');
                break;
        }
    }
    formatContext(context) {
        const parts = [];
        if (context.component)
            parts.push(`component=${context.component}`);
        if (context.service)
            parts.push(`service=${context.service}`);
        if (context.function)
            parts.push(`function=${context.function}`);
        if (context.userId)
            parts.push(`user=${context.userId}`);
        if (context.sessionId)
            parts.push(`session=${context.sessionId}`);
        if (context.requestId)
            parts.push(`request=${context.requestId}`);
        // Add other context properties
        Object.keys(context).forEach(key => {
            if (!['component', 'service', 'function', 'userId', 'sessionId', 'requestId'].includes(key)) {
                parts.push(`${key}=${context[key]}`);
            }
        });
        return parts.length > 0 ? ` [${parts.join(', ')}]` : '';
    }
    getLogBuffer() {
        return [...this.logBuffer];
    }
    clearLogBuffer() {
        this.logBuffer = [];
    }
    exportLogs() {
        return this.logBuffer
            .map(entry => {
            const timestamp = entry.timestamp.toISOString();
            const level = LogLevel[entry.level];
            const context = entry.context ? this.formatContext(entry.context) : '';
            const errorStr = entry.error ? ` ERROR: ${entry.error.message}` : '';
            const dataStr = entry.data ? ` DATA: ${JSON.stringify(entry.data)}` : '';
            return `[${timestamp}] ${level}: ${entry.message}${context}${errorStr}${dataStr}`;
        })
            .join('\n');
    }
}
exports.LoggingService = LoggingService;
// Create singleton instance
const logger = LoggingService.getInstance();
// Export convenience functions
// eslint-disable-next-line @typescript-eslint/no-explicit-any
exports.log = {
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    debug: (message, context, data) => logger.debug(message, context, data),
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    info: (message, context, data) => logger.info(message, context, data),
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    warn: (message, context, data) => logger.warn(message, context, data),
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    error: (message, context, error, data) => logger.error(message, context, error, data),
};
exports.default = logger;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9zZXJ2aWNlcy9Mb2dnaW5nU2VydmljZS50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7OztHQU1HOzs7QUFFSCxJQUFZLFFBTVg7QUFORCxXQUFZLFFBQVE7SUFDbEIseUNBQVMsQ0FBQTtJQUNULHVDQUFRLENBQUE7SUFDUix1Q0FBUSxDQUFBO0lBQ1IseUNBQVMsQ0FBQTtJQUNULDJDQUFVLENBQUE7QUFDWixDQUFDLEVBTlcsUUFBUSx3QkFBUixRQUFRLFFBTW5CO0FBeUJELE1BQU0sY0FBYztJQUNWLE1BQU0sQ0FBQyxRQUFRLENBQWlCO0lBQ2hDLFFBQVEsR0FBYSxRQUFRLENBQUMsSUFBSSxDQUFDO0lBQ25DLGFBQWEsQ0FBVTtJQUN2QixTQUFTLEdBQWUsRUFBRSxDQUFDO0lBQzNCLGFBQWEsR0FBRyxJQUFJLENBQUM7SUFFN0I7UUFDRSxJQUFJLENBQUMsYUFBYSxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsUUFBUSxLQUFLLGFBQWEsQ0FBQztRQUU1RCxxQ0FBcUM7UUFDckMsSUFBSSxJQUFJLENBQUMsYUFBYSxFQUFFO1lBQ3RCLElBQUksQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFDLEtBQUssQ0FBQztTQUNoQzthQUFNLElBQUksT0FBTyxDQUFDLEdBQUcsQ0FBQyxRQUFRLEtBQUssTUFBTSxFQUFFO1lBQzFDLElBQUksQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQztTQUMvQjthQUFNO1lBQ0wsSUFBSSxDQUFDLFFBQVEsR0FBRyxRQUFRLENBQUMsSUFBSSxDQUFDO1NBQy9CO0lBQ0gsQ0FBQztJQUVNLE1BQU0sQ0FBQyxXQUFXO1FBQ3ZCLElBQUksQ0FBQyxjQUFjLENBQUMsUUFBUSxFQUFFO1lBQzVCLGNBQWMsQ0FBQyxRQUFRLEdBQUcsSUFBSSxjQUFjLEVBQUUsQ0FBQztTQUNoRDtRQUNELE9BQU8sY0FBYyxDQUFDLFFBQVEsQ0FBQztJQUNqQyxDQUFDO0lBRU0sV0FBVyxD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LEVBQUUsS0FBYSxFQUFFLElBQVUsRUFBRSxFQUFFLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxPQUFPLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxJQUFJLENBQUM7Q0FDekgsQ0FBQztBQUlGLGtCQUFlLE1BQU0sQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvR3JlZ0Nhc3Ryby9EZXNrdG9wL1doYXRUb0VhdE5leHQvc3JjL3NlcnZpY2VzL0xvZ2dpbmdTZXJ2aWNlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ2VudHJhbGl6ZWQgTG9nZ2luZyBTZXJ2aWNlIGZvciBXaGF0VG9FYXROZXh0XG4gKiBcbiAqIFByb3ZpZGVzIHN0cnVjdHVyZWQgbG9nZ2luZyB3aXRoIGRpZmZlcmVudCBsZXZlbHMgYW5kIGNvbnRleHRzLlxuICogUmVwbGFjZXMgY29uc29sZS5sb2cgc3RhdGVtZW50cyBpbiBwcm9kdWN0aW9uIGNvZGUgd2hpbGUgcHJlc2VydmluZ1xuICogY29uc29sZS53YXJuIGFuZCBjb25zb2xlLmVycm9yIGZvciBkZWJ1Z2dpbmcgcHVycG9zZXMuXG4gKi9cblxuZXhwb3J0IGVudW0gTG9nTGV2ZWwge1xuICBERUJVRyA9IDAsXG4gIElORk8gPSAxLFxuICBXQVJOID0gMixcbiAgRVJST1IgPSAzLFxuICBTSUxFTlQgPSA0XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgTG9nQ29udGV4dCB7XG4gIGNvbXBvbmVudD86IHN0cmluZztcbiAgc2VydmljZT86IHN0cmluZztcbiAgZnVuY3Rpb24/OiBzdHJpbmc7XG4gIHVzZXJJZD86IHN0cmluZztcbiAgc2Vzc2lvbklkPzogc3RyaW5nO1xuICByZXF1ZXN0SWQ/OiBzdHJpbmc7XG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4gIC8vIEludGVudGlvbmFsbHkgYW55OiBMb2dnaW5nIGNvbnRleHQgbmVlZHMgZmxleGliaWxpdHkgZm9yIHZhcmlvdXMgbWV0YWRhdGFcbiAgW2tleTogc3RyaW5nXTogYW55O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIExvZ0VudHJ5IHtcbiAgdGltZXN0YW1wOiBEYXRlO1xuICBsZXZlbDogTG9nTGV2ZWw7XG4gIG1lc3NhZ2U6IHN0cmluZztcbiAgY29udGV4dD86IExvZ0NvbnRleHQ7XG4gIGVycm9yPzogRXJyb3I7XG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4gIC8vIEludGVudGlvbmFsbHkgYW55OiBMb2cgZGF0YSBjYW4gYmUgb2YgYW55IHR5cGUgZm9yIGRlYnVnZ2luZyBwdXJwb3Nlc1xuICBkYXRhPzogYW55O1xufVxuXG5jbGFzcyBMb2dnaW5nU2VydmljZSB7XG4gIHByaXZhdGUgc3RhdGljIGluc3RhbmNlOiBMb2dnaW5nU2VydmljZTtcbiAgcHJpdmF0ZSBsb2dMZXZlbDogTG9nTGV2ZWwgPSBMb2dMZXZlbC5JTkZPO1xuICBwcml2YXRlIGlzRGV2ZWxvcG1lbnQ6IGJvb2xlYW47XG4gIHByaXZhdGUgbG9nQnVmZmVyOiBMb2dFbnRyeVtdID0gW107XG4gIHByaXZhdGUgbWF4QnVmZmVyU2l6ZSA9IDEwMDA7XG5cbiAgcHJpdmF0ZSBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLmlzRGV2ZWxvcG1lbnQgPSBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ2RldmVsb3BtZW50JztcbiAgICBcbiAgICAvLyBTZXQgbG9nIGxldmVsIGJhc2VkIG9uIGVudmlyb25tZW50XG4gICAgaWYgKHRoaXMuaXNEZXZlbG9wbWVudCkge1xuICAgICAgdGhpcy5sb2dMZXZlbCA9IExvZ0xldmVsLkRFQlVHO1xuICAgIH0gZWxzZSBpZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICd0ZXN0Jykge1xuICAgICAgdGhpcy5sb2dMZXZlbCA9IExvZ0xldmVsLldBUk47XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMubG9nTGV2ZWwgPSBMb2dMZXZlbC5JTkZPO1xuICAgIH1cbiAgfVxuXG4gIHB1YmxpYyBzdGF0aWMgZ2V0SW5zdGFuY2UoKTogTG9nZ2luZ1NlcnZpY2Uge1xuICAgIGlmICghTG9nZ2luZ1NlcnZpY2UuaW5zdGFuY2UpIHtcbiAgICAgIExvZ2dpbmdTZXJ2aWNlLmluc3RhbmNlID0gbmV3IExvZ2dpbmdTZXJ2aWNlKCk7XG4gICAgfVxuICAgIHJldHVybiBMb2dnaW5nU2VydmljZS5pbnN0YW5jZTtcbiAgfVxuXG4gIHB1YmxpYyBzZXRMb2dMZXZlbChsZXZlbDogTG9nTGV2ZWwpOiB2b2lkIHtcbiAgICB0aGlzLmxvZ0xldmVsID0gbGV2ZWw7XG4gIH1cblxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICBwdWJsaWMgZGVidWcobWVzc2FnZTogc3RyaW5nLCBjb250ZXh0PzogTG9nQ29udGV4dCwgZGF0YT86IGFueSk6IHZvaWQge1xuICAgIHRoaXMubG9nKExvZ0xldmVsLkRFQlVHLCBtZXNzYWdlLCBjb250ZXh0LCB1bmRlZmluZWQsIGRhdGEpO1xuICB9XG5cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbiAgcHVibGljIGluZm8obWVzc2FnZTogc3RyaW5nLCBjb250ZXh0PzogTG9nQ29udGV4dCwgZGF0YT86IGFueSk6IHZvaWQge1xuICAgIHRoaXMubG9nKExvZ0xldmVsLklORk8sIG1lc3NhZ2UsIGNvbnRleHQsIHVuZGVmaW5lZCwgZGF0YSk7XG4gIH1cblxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICBwdWJsaWMgd2FybihtZXNzYWdlOiBzdHJpbmcsIGNvbnRleHQ/OiBMb2dDb250ZXh0LCBkYXRhPzogYW55KTogdm9pZCB7XG4gICAgdGhpcy5sb2coTG9nTGV2ZWwuV0FSTiwgbWVzc2FnZSwgY29udGV4dCwgdW5kZWZpbmVkLCBkYXRhKTtcbiAgfVxuXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4gIHB1YmxpYyBlcnJvcihtZXNzYWdlOiBzdHJpbmcsIGNvbnRleHQ/OiBMb2dDb250ZXh0LCBlcnJvcj86IEVycm9yLCBkYXRhPzogYW55KTogdm9pZCB7XG4gICAgdGhpcy5sb2coTG9nTGV2ZWwuRVJST1IsIG1lc3NhZ2UsIGNvbnRleHQsIGVycm9yLCBkYXRhKTtcbiAgfVxuXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4gIHByaXZhdGUgbG9nKGxldmVsOiBMb2dMZXZlbCwgbWVzc2FnZTogc3RyaW5nLCBjb250ZXh0PzogTG9nQ29udGV4dCwgZXJyb3I/OiBFcnJvciwgZGF0YT86IGFueSk6IHZvaWQge1xuICAgIGlmIChsZXZlbCA8IHRoaXMubG9nTGV2ZWwpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBsb2dFbnRyeTogTG9nRW50cnkgPSB7XG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAgICBsZXZlbCxcbiAgICAgIG1lc3NhZ2UsXG4gICAgICBjb250ZXh0LFxuICAgICAgZXJyb3IsXG4gICAgICBkYXRhXG4gICAgfTtcblxuICAgIC8vIEFkZCB0byBidWZmZXJcbiAgICB0aGlzLmFkZFRvQnVmZmVyKGxvZ0VudHJ5KTtcblxuICAgIC8vIE91dHB1dCB0byBjb25zb2xlIGJhc2VkIG9uIGxldmVsIGFuZCBlbnZpcm9ubWVudFxuICAgIHRoaXMub3V0cHV0VG9Db25zb2xlKGxvZ0VudHJ5KTtcbiAgfVxuXG4gIHByaXZhdGUgYWRkVG9CdWZmZXIoZW50cnk6IExvZ0VudHJ5KTogdm9pZCB7XG4gICAgdGhpcy5sb2dCdWZmZXIucHVzaChlbnRyeSk7XG4gICAgXG4gICAgLy8gTWFpbnRhaW4gYnVmZmVyIHNpemVcbiAgICBpZiAodGhpcy5sb2dCdWZmZXIubGVuZ3RoID4gdGhpcy5tYXhCdWZmZXJTaXplKSB7XG4gICAgICB0aGlzLmxvZ0J1ZmZlci5zaGlmdCgpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgb3V0cHV0VG9Db25zb2xlKGVudHJ5OiBMb2dFbnRyeSk6IHZvaWQge1xuICAgIGNvbnN0IHRpbWVzdGFtcCA9IGVudHJ5LnRpbWVzdGFtcC50b0lTT1N0cmluZygpO1xuICAgIGNvbnN0IGNvbnRleHRTdHIgPSBlbnRyeS5jb250ZXh0ID8gdGhpcy5mb3JtYXRDb250ZXh0KGVudHJ5LmNvbnRleHQpIDogJyc7XG4gICAgY29uc3QgbGV2ZWxTdHIgPSBMb2dMZXZlbFtlbnRyeS5sZXZlbF07XG4gICAgXG4gICAgY29uc3QgYmFzZU1lc3NhZ2UgPSBgWyR7dGltZXN0YW1wfV0gJHtsZXZlbFN0cn06ICR7ZW50cnkubWVzc2FnZX0ke2NvbnRleHRTdHJ9YDtcblxuICAgIHN3aXRjaCAoZW50cnkubGV2ZWwpIHtcbiAgICAgIGNhc2UgTG9nTGV2ZWwuREVCVUc6XG4gICAgICAgIGlmICh0aGlzLmlzRGV2ZWxvcG1lbnQpIHtcbiAgICAgICAgICBsb2cuaW5mbyhg8J+QmyAke2Jhc2VNZXNzYWdlfWAsIGVudHJ5LmRhdGEgfHwgJycpO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgICAgXG4gICAgICBjYXNlIExvZ0xldmVsLklORk86XG4gICAgICAgIGxvZy5pbmZvKGDihLnvuI8gJHtiYXNlTWVzc2FnZX1gLCBlbnRyeS5kYXRhIHx8ICcnKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBcbiAgICAgIGNhc2UgTG9nTGV2ZWwuV0FSTjpcbiAgICAgICAgY29uc29sZS53YXJuKGDimqDvuI8gJHtiYXNlTWVzc2FnZX1gLCBlbnRyeS5kYXRhIHx8ICcnKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBcbiAgICAgIGNhc2UgTG9nTGV2ZWwuRVJST1I6XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoYOKdjCAke2Jhc2VNZXNzYWdlfWAsIGVudHJ5LmVycm9yIHx8IGVudHJ5LmRhdGEgfHwgJycpO1xuICAgICAgICBicmVhaztcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGZvcm1hdENvbnRleHQoY29udGV4dDogTG9nQ29udGV4dCk6IHN0cmluZyB7XG4gICAgY29uc3QgcGFydHM6IHN0cmluZ1tdID0gW107XG4gICAgXG4gICAgaWYgKGNvbnRleHQuY29tcG9uZW50KSBwYXJ0cy5wdXNoKGBjb21wb25lbnQ9JHtjb250ZXh0LmNvbXBvbmVudH1gKTtcbiAgICBpZiAoY29udGV4dC5zZXJ2aWNlKSBwYXJ0cy5wdXNoKGBzZXJ2aWNlPSR7Y29udGV4dC5zZXJ2aWNlfWApO1xuICAgIGlmIChjb250ZXh0LmZ1bmN0aW9uKSBwYXJ0cy5wdXNoKGBmdW5jdGlvbj0ke2NvbnRleHQuZnVuY3Rpb259YCk7XG4gICAgaWYgKGNvbnRleHQudXNlcklkKSBwYXJ0cy5wdXNoKGB1c2VyPSR7Y29udGV4dC51c2VySWR9YCk7XG4gICAgaWYgKGNvbnRleHQuc2Vzc2lvbklkKSBwYXJ0cy5wdXNoKGBzZXNzaW9uPSR7Y29udGV4dC5zZXNzaW9uSWR9YCk7XG4gICAgaWYgKGNvbnRleHQucmVxdWVzdElkKSBwYXJ0cy5wdXNoKGByZXF1ZXN0PSR7Y29udGV4dC5yZXF1ZXN0SWR9YCk7XG4gICAgXG4gICAgLy8gQWRkIG90aGVyIGNvbnRleHQgcHJvcGVydGllc1xuICAgIE9iamVjdC5rZXlzKGNvbnRleHQpLmZvckVhY2goa2V5ID0+IHtcbiAgICAgIGlmICghWydjb21wb25lbnQnLCAnc2VydmljZScsICdmdW5jdGlvbicsICd1c2VySWQnLCAnc2Vzc2lvbklkJywgJ3JlcXVlc3RJZCddLmluY2x1ZGVzKGtleSkpIHtcbiAgICAgICAgcGFydHMucHVzaChgJHtrZXl9PSR7Y29udGV4dFtrZXldfWApO1xuICAgICAgfVxuICAgIH0pO1xuICAgIFxuICAgIHJldHVybiBwYXJ0cy5sZW5ndGggPiAwID8gYCBbJHtwYXJ0cy5qb2luKCcsICcpfV1gIDogJyc7XG4gIH1cblxuICBwdWJsaWMgZ2V0TG9nQnVmZmVyKCk6IExvZ0VudHJ5W10ge1xuICAgIHJldHVybiBbLi4udGhpcy5sb2dCdWZmZXJdO1xuICB9XG5cbiAgcHVibGljIGNsZWFyTG9nQnVmZmVyKCk6IHZvaWQge1xuICAgIHRoaXMubG9nQnVmZmVyID0gW107XG4gIH1cblxuICBwdWJsaWMgZXhwb3J0TG9ncygpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLmxvZ0J1ZmZlclxuICAgICAgLm1hcChlbnRyeSA9PiB7XG4gICAgICAgIGNvbnN0IHRpbWVzdGFtcCA9IGVudHJ5LnRpbWVzdGFtcC50b0lTT1N0cmluZygpO1xuICAgICAgICBjb25zdCBsZXZlbCA9IExvZ0xldmVsW2VudHJ5LmxldmVsXTtcbiAgICAgICAgY29uc3QgY29udGV4dCA9IGVudHJ5LmNvbnRleHQgPyB0aGlzLmZvcm1hdENvbnRleHQoZW50cnkuY29udGV4dCkgOiAnJztcbiAgICAgICAgY29uc3QgZXJyb3JTdHIgPSBlbnRyeS5lcnJvciA/IGAgRVJST1I6ICR7ZW50cnkuZXJyb3IubWVzc2FnZX1gIDogJyc7XG4gICAgICAgIGNvbnN0IGRhdGFTdHIgPSBlbnRyeS5kYXRhID8gYCBEQVRBOiAke0pTT04uc3RyaW5naWZ5KGVudHJ5LmRhdGEpfWAgOiAnJztcbiAgICAgICAgXG4gICAgICAgIHJldHVybiBgWyR7dGltZXN0YW1wfV0gJHtsZXZlbH06ICR7ZW50cnkubWVzc2FnZX0ke2NvbnRleHR9JHtlcnJvclN0cn0ke2RhdGFTdHJ9YDtcbiAgICAgIH0pXG4gICAgICAuam9pbignXFxuJyk7XG4gIH1cbn1cblxuLy8gQ3JlYXRlIHNpbmdsZXRvbiBpbnN0YW5jZVxuY29uc3QgbG9nZ2VyID0gTG9nZ2luZ1NlcnZpY2UuZ2V0SW5zdGFuY2UoKTtcblxuLy8gRXhwb3J0IGNvbnZlbmllbmNlIGZ1bmN0aW9uc1xuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbmV4cG9ydCBjb25zdCBsb2cgPSB7XG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4gIGRlYnVnOiAobWVzc2FnZTogc3RyaW5nLCBjb250ZXh0PzogTG9nQ29udGV4dCwgZGF0YT86IGFueSkgPT4gbG9nZ2VyLmRlYnVnKG1lc3NhZ2UsIGNvbnRleHQsIGRhdGEpLFxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICBpbmZvOiAobWVzc2FnZTogc3RyaW5nLCBjb250ZXh0PzogTG9nQ29udGV4dCwgZGF0YT86IGFueSkgPT4gbG9nZ2VyLmluZm8obWVzc2FnZSwgY29udGV4dCwgZGF0YSksXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4gIHdhcm46IChtZXNzYWdlOiBzdHJpbmcsIGNvbnRleHQ/OiBMb2dDb250ZXh0LCBkYXRhPzogYW55KSA9PiBsb2dnZXIud2FybihtZXNzYWdlLCBjb250ZXh0LCBkYXRhKSxcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbiAgZXJyb3I6IChtZXNzYWdlOiBzdHJpbmcsIGNvbnRleHQ/OiBMb2dDb250ZXh0LCBlcnJvcj86IEVycm9yLCBkYXRhPzogYW55KSA9PiBsb2dnZXIuZXJyb3IobWVzc2FnZSwgY29udGV4dCwgZXJyb3IsIGRhdGEpLFxufTtcblxuLy8gRXhwb3J0IHNlcnZpY2UgZm9yIGFkdmFuY2VkIHVzYWdlXG5leHBvcnQgeyBMb2dnaW5nU2VydmljZSB9O1xuZXhwb3J0IGRlZmF1bHQgbG9nZ2VyOyJdLCJ2ZXJzaW9uIjozfQ==