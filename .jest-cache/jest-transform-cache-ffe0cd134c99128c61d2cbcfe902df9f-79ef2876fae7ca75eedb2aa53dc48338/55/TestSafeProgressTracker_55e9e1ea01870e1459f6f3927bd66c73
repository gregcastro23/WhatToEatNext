81e5bbfcbdef7a58ba9d4a947ede40db
"use strict";
/**
 * Test-Safe Progress Tracker
 *
 * Memory-efficient progress tracking system designed specifically for test environments.
 * Prevents memory leaks and provides controlled progress simulation.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.TestSafeProgressTracker = void 0;
const TestMemoryMonitor_1 = require("./TestMemoryMonitor");
const campaign_1 = require("../../types/campaign");
/**
 * Test-safe progress tracker that prevents memory leaks and provides
 * controlled progress simulation for testing campaign systems.
 */
class TestSafeProgressTracker {
    constructor(config) {
        this.memoryMonitor = null;
        this.progressHistory = [];
        this.isTracking = false;
        this.trackingStartTime = 0;
        this.progressUpdateTimer = null;
        this.memoryCheckCounter = 0;
        this.config = {
            maxHistorySize: 20,
            memoryCheckFrequency: 5,
            enableMemoryMonitoring: true,
            simulateRealProgress: false,
            progressUpdateInterval: 1000,
            ...config
        };
        this.currentMetrics = this.createInitialMetrics();
        if (this.config.enableMemoryMonitoring) {
            this.memoryMonitor = new TestMemoryMonitor_1.TestMemoryMonitor({
                warningThreshold: 50,
                errorThreshold: 100,
                leakThreshold: 25
            });
        }
    }
    /**
     * Start progress tracking with memory monitoring
     */
    startTracking(testName) {
        if (this.isTracking) {
            console.warn('Progress tracking already active');
            return;
        }
        this.isTracking = true;
        this.trackingStartTime = Date.now();
        if (this.memoryMonitor) {
            this.memoryMonitor.takeSnapshot(`tracking-start-${testName || 'unknown'}`);
        }
        // Take initial snapshot
        this.takeProgressSnapshot(`start-${testName || 'tracking'}`);
        // Start simulated progress updates if enabled
        if (this.config.simulateRealProgress) {
            this.startProgressSimulation();
        }
        console.log(`Test-safe progress tracking started${testName ? ` for ${testName}` : ''}`);
    }
    /**
     * Stop progress tracking and perform cleanup
     */
    stopTracking(testName) {
        if (!this.isTracking) {
            return;
        }
        this.isTracking = false;
        // Stop progress simulation
        if (this.progressUpdateTimer) {
            clearInterval(this.progressUpdateTimer);
            this.progressUpdateTimer = null;
        }
        // Take final snapshot
        this.takeProgressSnapshot(`stop-${testName || 'tracking'}`);
        // Perform memory cleanup
        this.performMemoryCleanup(testName);
        console.log(`Test-safe progress tracking stopped${testName ? ` for ${testName}` : ''}`);
    }
    /**
     * Get current progress metrics without running actual measurements
     */
    async getProgressMetrics() {
        this.checkMemoryPeriodically();
        return { ...this.currentMetrics };
    }
    /**
     * Update progress metrics for testing scenarios
     */
    updateMetrics(updates, testName) {
        // Deep merge the updates
        this.currentMetrics = this.deepMergeMetrics(this.currentMetrics, updates);
        // Take snapshot of the update
        this.takeProgressSnapshot(`update-${testName || 'manual'}`);
        this.checkMemoryPeriodically();
    }
    /**
     * Simulate progress over time for realistic testing
     */
    simulateProgress(targetMetrics, durationMs, testName) {
        return new Promise((resolve) => {
            const startTime = Date.now();
            const startMetrics = { ...this.currentMetrics };
            const steps = Math.max(1, Math.floor(durationMs / 100)); // Update every 100ms
            let currentStep = 0;
            const progressInterval = setInterval(() => {
                currentStep++;
                const progress = Math.min(1, currentStep / steps);
                // Interpolate between start and target metrics
                const interpolatedMetrics = this.interpolateMetrics(startMetrics, targetMetrics, progress);
                this.currentMetrics = interpolatedMetrics;
                this.takeProgressSnapshot(`simulate-step-${currentStep}-${testName || 'auto'}`);
                if (currentStep >= steps) {
                    clearInterval(progressInterval);
                    resolve();
                }
            }, 100);
        });
    }
    /**
     * Generate test-safe progress report
     */
    async generateProgressReport(testName) {
        const currentMetrics = await this.getProgressMetrics();
        const targetMetrics = this.createTargetMetrics();
        // Calculate overall progress
        const overallProgress = this.calculateOverallProgress(currentMetrics, targetMetrics);
        // Generate mock phase reports
        const phases = [
            {
                phaseId: 'test-phase-1',
                phaseName: 'Test Phase 1',
                startTime: new Date(this.trackingStartTime),
                status: campaign_1.PhaseStatus.COMPLETED,
                metrics: currentMetrics,
                achievements: this.generateMockAchievements(currentMetrics),
                issues: this.generateMockIssues(currentMetrics),
                recommendations: this.generateMockRecommendations(currentMetrics)
            }
        ];
        const report = {
            campaignId: `test-campaign-${testName || 'default'}`,
            overallProgress,
            phases,
            currentMetrics,
            targetMetrics,
            estimatedCompletion: new Date(Date.now() + 3600000) // 1 hour from now
        };
        // Take snapshot for report generation
        this.takeProgressSnapshot(`report-${testName || 'generated'}`);
        return report;
    }
    /**
     * Get progress history with memory-safe access
     */
    getProgressHistory() {
        return [...this.progressHistory]; // Return copy to prevent external modification
    }
    /**
     * Get memory usage statistics
     */
    getMemoryStatistics() {
        if (!this.memoryMonitor) {
            return null;
        }
        const summary = this.memoryMonitor.getMemorySummary();
        return {
            currentUsage: `${summary.currentMemory.toFixed(2)}MB`,
            peakUsage: `${summary.peakMemory.toFixed(2)}MB`,
            snapshotCount: summary.snapshotCount,
            memoryEfficient: summary.totalIncrease < 25 // Less than 25MB increase is efficient
        };
    }
    /**
     * Validate progress tracking state
     */
    validateTrackingState() {
        const errors = [];
        const warnings = [];
        // Check memory usage
        if (this.memoryMonitor) {
            const memoryCheck = this.memoryMonitor.checkMemoryUsage('validation');
            errors.push(...memoryCheck.errors);
            warnings.push(...memoryCheck.warnings);
        }
        // Check history size
        if (this.progressHistory.length > this.config.maxHistorySize) {
            warnings.push(`Progress history size (${this.progressHistory.length}) exceeds maximum (${this.config.maxHistorySize})`);
        }
        // Check for tracking consistency
        if (this.isTracking && this.trackingStartTime === 0) {
            errors.push('Tracking is active but start time is not set');
        }
        return {
            success: errors.length === 0,
            errors,
            warnings
        };
    }
    /**
     * Reset tracker state for clean test isolation
     */
    reset() {
        // Stop any active tracking
        if (this.isTracking) {
            this.stopTracking('reset');
        }
        // Clear history
        this.progressHistory = [];
        // Reset metrics
        this.currentMetrics = this.createInitialMetrics();
        // Reset counters
        this.memoryCheckCounter = 0;
        this.trackingStartTime = 0;
        // Reset memory monitor
        if (this.memoryMonitor) {
            this.memoryMonitor = new TestMemoryMonitor_1.TestMemoryMonitor({
                warningThreshold: 50,
                errorThreshold: 100,
                leakThreshold: 25
            });
        }
        console.log('Test-safe progress tracker reset');
    }
    /**
     * Cleanup resources and prevent memory leaks
     */
    cleanup() {
        // Stop tracking if active
        if (this.isTracking) {
            this.stopTracking('cleanup');
        }
        // Clear all timers
        if (this.progressUpdateTimer) {
            clearInterval(this.progressUpdateTimer);
            this.progressUpdateTimer = null;
        }
        // Clear history
        this.progressHistory = [];
        // Cleanup memory monitor
        if (this.memoryMonitor) {
            this.memoryMonitor.cleanup('tracker-cleanup');
        }
        console.log('Test-safe progress tracker cleaned up');
    }
    // Private helper methods
    takeProgressSnapshot(testName) {
        const snapshot = {
            timestamp: Date.now(),
            metrics: { ...this.currentMetrics },
            testName,
            memoryUsage: this.memoryMonitor ? process.memoryUsage().heapUsed : undefined
        };
        this.progressHistory.push(snapshot);
        // Maintain history size limit to prevent memory issues
        if (this.progressHistory.length > this.config.maxHistorySize) {
            const excessCount = this.progressHistory.length - this.config.maxHistorySize;
            this.progressHistory.splice(0, excessCount);
        }
    }
    checkMemoryPeriodically() {
        this.memoryCheckCounter++;
        if (this.memoryCheckCounter % this.config.memoryCheckFrequency === 0 && this.memoryMonitor) {
            const memoryCheck = this.memoryMonitor.checkMemoryUsage(`periodic-${this.memoryCheckCounter}`);
            if (!memoryCheck.isWithinLimits) {
                console.warn('Memory check failed in progress tracker:', memoryCheck.errors);
                this.performMemoryCleanup('periodic-check');
            }
        }
    }
    performMemoryCleanup(reason) {
        // Trim progress history
        if (this.progressHistory.length > this.config.maxHistorySize / 2) {
            const keepCount = Math.floor(this.config.maxHistorySize / 2);
            this.progressHistory = this.progressHistory.slice(-keepCount);
        }
        // Force memory cleanup if monitor is available
        if (this.memoryMonitor) {
            this.memoryMonitor.cleanup(reason || 'progress-tracker-cleanup');
        }
        // Force garbage collection if available
        if (global.gc) {
            try {
                global.gc();
            }
            catch (error) {
                console.warn('Failed to force garbage collection:', error);
            }
        }
    }
    startProgressSimulation() {
        if (this.progressUpdateTimer) {
            return;
        }
        this.progressUpdateTimer = setInterval(() => {
            // Simulate small progress increments
            const updates = {
                typeScriptErrors: {
                    ...this.currentMetrics.typeScriptErrors,
                    current: Math.max(0, this.currentMetrics.typeScriptErrors.current - 1)
                },
                lintingWarnings: {
                    ...this.currentMetrics.lintingWarnings,
                    current: Math.max(0, this.currentMetrics.lintingWarnings.current - 5)
                }
            };
            this.updateMetrics(updates, 'simulation');
        }, this.config.progressUpdateInterval);
    }
    createInitialMetrics() {
        return {
            typeScriptErrors: {
                current: 86,
                target: 0,
                reduction: 0,
                percentage: 0
            },
            lintingWarnings: {
                current: 4506,
                target: 0,
                reduction: 0,
                percentage: 0
            },
            buildPerformance: {
                currentTime: 12.5,
                targetTime: 10,
                cacheHitRate: 0.6,
                memoryUsage: 60
            },
            enterpriseSystems: {
                current: 0,
                target: 200,
                transformedExports: 0
            }
        };
    }
    createTargetMetrics() {
        return {
            typeScriptErrors: {
                current: 0,
                target: 0,
                reduction: 86,
                percentage: 100
            },
            lintingWarnings: {
                current: 0,
                target: 0,
                reduction: 4506,
                percentage: 100
            },
            buildPerformance: {
                currentTime: 8,
                targetTime: 10,
                cacheHitRate: 0.8,
                memoryUsage: 45
            },
            enterpriseSystems: {
                current: 200,
                target: 200,
                transformedExports: 200
            }
        };
    }
    deepMergeMetrics(current, updates) {
        const result = { ...current };
        Object.keys(updates).forEach(key => {
            const updateValue = updates[key];
            if (updateValue && typeof updateValue === 'object') {
                result[key] = {
                    ...current[key],
                    ...updateValue
                };
            }
        });
        return result;
    }
    interpolateMetrics(start, target, progress) {
        var _a, _b;
        const result = { ...start };
        // Interpolate TypeScript errors
        if (((_a = target.typeScriptErrors) === null || _a === void 0 ? void 0 : _a.current) !== undefined) {
            const startValue = start.typeScriptErrors.current;
            const targetValue = target.typeScriptErrors.current;
            result.typeScriptErrors.current = Math.round(startValue + (targetValue - startValue) * progress);
        }
        // Interpolate linting warnings
        if (((_b = target.lintingWarnings) === null || _b === void 0 ? void 0 : _b.current) !== undefined) {
            const startValue = start.lintingWarnings.current;
            const targetValue = target.lintingWarnings.current;
            result.lintingWarnings.current = Math.round(startValue + (targetValue - startValue) * progress);
        }
        return result;
    }
    calculateOverallProgress(current, target) {
        const tsProgress = target.typeScriptErrors.current === 0
            ? (1 - current.typeScriptErrors.current / 86) * 100
            : 0;
        const lintProgress = target.lintingWarnings.current === 0
            ? (1 - current.lintingWarnings.current / 4506) * 100
            : 0;
        const buildProgress = current.buildPerformance.currentTime <= target.buildPerformance.currentTime
            ? 100
            : 0;
        const enterpriseProgress = (current.enterpriseSystems.current / target.enterpriseSystems.current) * 100;
        return Math.round((tsProgress + lintProgress + buildProgress + enterpriseProgress) / 4);
    }
    generateMockAchievements(metrics) {
        const achievements = [];
        if (metrics.typeScriptErrors.current === 0) {
            achievements.push('Zero TypeScript errors achieved');
        }
        if (metrics.lintingWarnings.current === 0) {
            achievements.push('Zero linting warnings achieved');
        }
        if (metrics.buildPerformance.currentTime <= 10) {
            achievements.push('Build time under 10 seconds');
        }
        return achievements;
    }
    generateMockIssues(metrics) {
        const issues = [];
        if (metrics.typeScriptErrors.current > 0) {
            issues.push(`${metrics.typeScriptErrors.current} TypeScript errors remaining`);
        }
        if (metrics.lintingWarnings.current > 1000) {
            issues.push(`High linting warning count: ${metrics.lintingWarnings.current}`);
        }
        return issues;
    }
    generateMockRecommendations(metrics) {
        const recommendations = [];
        if (metrics.typeScriptErrors.current > 0) {
            recommendations.push('Continue with TypeScript error elimination');
        }
        if (metrics.lintingWarnings.current > 0) {
            recommendations.push('Apply systematic linting fixes');
        }
        return recommendations;
    }
}
exports.TestSafeProgressTracker = TestSafeProgressTracker;
exports.default = TestSafeProgressTracker;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9fX3Rlc3RzX18vdXRpbHMvVGVzdFNhZmVQcm9ncmVzc1RyYWNrZXIudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7OztHQUtHOzs7QUFFSCwyREFBd0Q7QUFDeEQsbURBTThCO0FBaUI5Qjs7O0dBR0c7QUFDSCxNQUFhLHVCQUF1QjtJQVVsQyxZQUFZLE1BQW9DO1FBUnhDLGtCQUFhLEdBQTZCLElBQUksQ0FBQztRQUMvQyxvQkFBZSxHQUF1QixFQUFFLENBQUM7UUFFekMsZUFBVSxHQUFZLEtBQUssQ0FBQztRQUM1QixzQkFBaUIsR0FBVyxDQUFDLENBQUM7UUFDOUIsd0JBQW1CLEdBQTBCLElBQUksQ0FBQztRQUNsRCx1QkFBa0IsR0FBVyxDQUFDLENBQUM7UUFHckMsSUFBSSxDQUFDLE1BQU0sR0FBRztZQUNaLGNBQWMsRUFBRSxFQUFFO1lBQ2xCLG9CQUFvQixFQUFFLENBQUM7WUFDdkIsc0JBQXNCLEVBQUUsSUFBSTtZQUM1QixvQkFBb0IsRUFBRSxLQUFLO1lBQzNCLHNCQUFzQixFQUFFLElBQUk7WUFDNUIsR0FBRyxNQUFNO1NBQ1YsQ0FBQztRQUVGLElBQUksQ0FBQyxjQUFjLEdBQUcsSUFBSSxDQUFDLG9CQUFvQixFQUFFLENBQUM7UUFFbEQsSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLHNCQUFzQixFQUFFO1lBQ3RDLElBQUksQ0FBQyxhQUFhLEdBQUcsSUFBSSxxQ0FBaUIsQ0FBQztnQkFDekMsZ0JBQWdCLEVBQUUsRUFBRTtnQkFDcEIsY0FBYyxFQUFFLEdBQUc7Z0JBQ25CLGFBQWEsRUFBRSxFQUFFO2FBQ2xCLENBQUMsQ0FBQztTQUNKO0lBQ0gsQ0FBQztJQUVEOztPQUVHO0lBQ0gsYUFBYSxDQUFDLFFBQWlCO1FBQzdCLElBQUksSUFBSSxDQUFDLFVBQVUsRUFBRTtZQUNuQixPQUFPLENBQUMsSUFBSSxDQUFDLGtDQUFrQyxDQUFDLENBQUM7WUFDakQsT0FBTztTQUNSO1FBRUQsSUFBSSxD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QUUsQ0FBQyxDQUFDO1NBQy9FO1FBRUQsT0FBTyxNQUFNLENBQUM7SUFDaEIsQ0FBQztJQUVPLDJCQUEyQixDQUFDLE9BQXdCO1FBQzFELE1BQU0sZUFBZSxHQUFhLEVBQUUsQ0FBQztRQUVyQyxJQUFJLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLEdBQUcsQ0FBQyxFQUFFO1lBQ3hDLGVBQWUsQ0FBQyxJQUFJLENBQUMsNENBQTRDLENBQUMsQ0FBQztTQUNwRTtRQUVELElBQUksT0FBTyxDQUFDLGVBQWUsQ0FBQyxPQUFPLEdBQUcsQ0FBQyxFQUFFO1lBQ3ZDLGVBQWUsQ0FBQyxJQUFJLENBQUMsZ0NBQWdDLENBQUMsQ0FBQztTQUN4RDtRQUVELE9BQU8sZUFBZSxDQUFDO0lBQ3pCLENBQUM7Q0FDRjtBQXBoQkQsMERBb2hCQztBQUVELGtCQUFlLHVCQUF1QixDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9HcmVnQ2FzdHJvL0Rlc2t0b3AvV2hhdFRvRWF0TmV4dC9zcmMvX190ZXN0c19fL3V0aWxzL1Rlc3RTYWZlUHJvZ3Jlc3NUcmFja2VyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogVGVzdC1TYWZlIFByb2dyZXNzIFRyYWNrZXJcbiAqIFxuICogTWVtb3J5LWVmZmljaWVudCBwcm9ncmVzcyB0cmFja2luZyBzeXN0ZW0gZGVzaWduZWQgc3BlY2lmaWNhbGx5IGZvciB0ZXN0IGVudmlyb25tZW50cy5cbiAqIFByZXZlbnRzIG1lbW9yeSBsZWFrcyBhbmQgcHJvdmlkZXMgY29udHJvbGxlZCBwcm9ncmVzcyBzaW11bGF0aW9uLlxuICovXG5cbmltcG9ydCB7IFRlc3RNZW1vcnlNb25pdG9yIH0gZnJvbSAnLi9UZXN0TWVtb3J5TW9uaXRvcic7XG5pbXBvcnQge1xuICBQcm9ncmVzc01ldHJpY3MsXG4gIFByb2dyZXNzUmVwb3J0LFxuICBQaGFzZVJlcG9ydCxcbiAgUGhhc2VTdGF0dXMsXG4gIFZhbGlkYXRpb25SZXN1bHRcbn0gZnJvbSAnLi4vLi4vdHlwZXMvY2FtcGFpZ24nO1xuXG5pbnRlcmZhY2UgVGVzdFByb2dyZXNzQ29uZmlnIHtcbiAgbWF4SGlzdG9yeVNpemU6IG51bWJlcjtcbiAgbWVtb3J5Q2hlY2tGcmVxdWVuY3k6IG51bWJlcjtcbiAgZW5hYmxlTWVtb3J5TW9uaXRvcmluZzogYm9vbGVhbjtcbiAgc2ltdWxhdGVSZWFsUHJvZ3Jlc3M6IGJvb2xlYW47XG4gIHByb2dyZXNzVXBkYXRlSW50ZXJ2YWw6IG51bWJlcjtcbn1cblxuaW50ZXJmYWNlIFByb2dyZXNzU25hcHNob3Qge1xuICB0aW1lc3RhbXA6IG51bWJlcjtcbiAgbWV0cmljczogUHJvZ3Jlc3NNZXRyaWNzO1xuICB0ZXN0TmFtZT86IHN0cmluZztcbiAgbWVtb3J5VXNhZ2U/OiBudW1iZXI7XG59XG5cbi8qKlxuICogVGVzdC1zYWZlIHByb2dyZXNzIHRyYWNrZXIgdGhhdCBwcmV2ZW50cyBtZW1vcnkgbGVha3MgYW5kIHByb3ZpZGVzXG4gKiBjb250cm9sbGVkIHByb2dyZXNzIHNpbXVsYXRpb24gZm9yIHRlc3RpbmcgY2FtcGFpZ24gc3lzdGVtcy5cbiAqL1xuZXhwb3J0IGNsYXNzIFRlc3RTYWZlUHJvZ3Jlc3NUcmFja2VyIHtcbiAgcHJpdmF0ZSBjb25maWc6IFRlc3RQcm9ncmVzc0NvbmZpZztcbiAgcHJpdmF0ZSBtZW1vcnlNb25pdG9yOiBUZXN0TWVtb3J5TW9uaXRvciB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIHByb2dyZXNzSGlzdG9yeTogUHJvZ3Jlc3NTbmFwc2hvdFtdID0gW107XG4gIHByaXZhdGUgY3VycmVudE1ldHJpY3M6IFByb2dyZXNzTWV0cmljcztcbiAgcHJpdmF0ZSBpc1RyYWNraW5nOiBib29sZWFuID0gZmFsc2U7XG4gIHByaXZhdGUgdHJhY2tpbmdTdGFydFRpbWU6IG51bWJlciA9IDA7XG4gIHByaXZhdGUgcHJvZ3Jlc3NVcGRhdGVUaW1lcjogTm9kZUpTLlRpbWVvdXQgfCBudWxsID0gbnVsbDtcbiAgcHJpdmF0ZSBtZW1vcnlDaGVja0NvdW50ZXI6IG51bWJlciA9IDA7XG5cbiAgY29uc3RydWN0b3IoY29uZmlnPzogUGFydGlhbDxUZXN0UHJvZ3Jlc3NDb25maWc+KSB7XG4gICAgdGhpcy5jb25maWcgPSB7XG4gICAgICBtYXhIaXN0b3J5U2l6ZTogMjAsIC8vIEtlZXAgb25seSAyMCBzbmFwc2hvdHMgdG8gcHJldmVudCBtZW1vcnkgaXNzdWVzXG4gICAgICBtZW1vcnlDaGVja0ZyZXF1ZW5jeTogNSwgLy8gQ2hlY2sgbWVtb3J5IGV2ZXJ5IDUgb3BlcmF0aW9uc1xuICAgICAgZW5hYmxlTWVtb3J5TW9uaXRvcmluZzogdHJ1ZSxcbiAgICAgIHNpbXVsYXRlUmVhbFByb2dyZXNzOiBmYWxzZSxcbiAgICAgIHByb2dyZXNzVXBkYXRlSW50ZXJ2YWw6IDEwMDAsIC8vIDEgc2Vjb25kIGZvciBzaW11bGF0ZWQgcHJvZ3Jlc3NcbiAgICAgIC4uLmNvbmZpZ1xuICAgIH07XG5cbiAgICB0aGlzLmN1cnJlbnRNZXRyaWNzID0gdGhpcy5jcmVhdGVJbml0aWFsTWV0cmljcygpO1xuICAgIFxuICAgIGlmICh0aGlzLmNvbmZpZy5lbmFibGVNZW1vcnlNb25pdG9yaW5nKSB7XG4gICAgICB0aGlzLm1lbW9yeU1vbml0b3IgPSBuZXcgVGVzdE1lbW9yeU1vbml0b3Ioe1xuICAgICAgICB3YXJuaW5nVGhyZXNob2xkOiA1MCwgLy8gTG93ZXIgdGhyZXNob2xkIGZvciB0ZXN0c1xuICAgICAgICBlcnJvclRocmVzaG9sZDogMTAwLFxuICAgICAgICBsZWFrVGhyZXNob2xkOiAyNVxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFN0YXJ0IHByb2dyZXNzIHRyYWNraW5nIHdpdGggbWVtb3J5IG1vbml0b3JpbmdcbiAgICovXG4gIHN0YXJ0VHJhY2tpbmcodGVzdE5hbWU/OiBzdHJpbmcpOiB2b2lkIHtcbiAgICBpZiAodGhpcy5pc1RyYWNraW5nKSB7XG4gICAgICBjb25zb2xlLndhcm4oJ1Byb2dyZXNzIHRyYWNraW5nIGFscmVhZHkgYWN0aXZlJyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5pc1RyYWNraW5nID0gdHJ1ZTtcbiAgICB0aGlzLnRyYWNraW5nU3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICBcbiAgICBpZiAodGhpcy5tZW1vcnlNb25pdG9yKSB7XG4gICAgICB0aGlzLm1lbW9yeU1vbml0b3IudGFrZVNuYXBzaG90KGB0cmFja2luZy1zdGFydC0ke3Rlc3ROYW1lIHx8ICd1bmtub3duJ31gKTtcbiAgICB9XG5cbiAgICAvLyBUYWtlIGluaXRpYWwgc25hcHNob3RcbiAgICB0aGlzLnRha2VQcm9ncmVzc1NuYXBzaG90KGBzdGFydC0ke3Rlc3ROYW1lIHx8ICd0cmFja2luZyd9YCk7XG5cbiAgICAvLyBTdGFydCBzaW11bGF0ZWQgcHJvZ3Jlc3MgdXBkYXRlcyBpZiBlbmFibGVkXG4gICAgaWYgKHRoaXMuY29uZmlnLnNpbXVsYXRlUmVhbFByb2dyZXNzKSB7XG4gICAgICB0aGlzLnN0YXJ0UHJvZ3Jlc3NTaW11bGF0aW9uKCk7XG4gICAgfVxuXG4gICAgY29uc29sZS5sb2coYFRlc3Qtc2FmZSBwcm9ncmVzcyB0cmFja2luZyBzdGFydGVkJHt0ZXN0TmFtZSA/IGAgZm9yICR7dGVzdE5hbWV9YCA6ICcnfWApO1xuICB9XG5cbiAgLyoqXG4gICAqIFN0b3AgcHJvZ3Jlc3MgdHJhY2tpbmcgYW5kIHBlcmZvcm0gY2xlYW51cFxuICAgKi9cbiAgc3RvcFRyYWNraW5nKHRlc3ROYW1lPzogc3RyaW5nKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLmlzVHJhY2tpbmcpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICB0aGlzLmlzVHJhY2tpbmcgPSBmYWxzZTtcblxuICAgIC8vIFN0b3AgcHJvZ3Jlc3Mgc2ltdWxhdGlvblxuICAgIGlmICh0aGlzLnByb2dyZXNzVXBkYXRlVGltZXIpIHtcbiAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5wcm9ncmVzc1VwZGF0ZVRpbWVyKTtcbiAgICAgIHRoaXMucHJvZ3Jlc3NVcGRhdGVUaW1lciA9IG51bGw7XG4gICAgfVxuXG4gICAgLy8gVGFrZSBmaW5hbCBzbmFwc2hvdFxuICAgIHRoaXMudGFrZVByb2dyZXNzU25hcHNob3QoYHN0b3AtJHt0ZXN0TmFtZSB8fCAndHJhY2tpbmcnfWApO1xuXG4gICAgLy8gUGVyZm9ybSBtZW1vcnkgY2xlYW51cFxuICAgIHRoaXMucGVyZm9ybU1lbW9yeUNsZWFudXAodGVzdE5hbWUpO1xuXG4gICAgY29uc29sZS5sb2coYFRlc3Qtc2FmZSBwcm9ncmVzcyB0cmFja2luZyBzdG9wcGVkJHt0ZXN0TmFtZSA/IGAgZm9yICR7dGVzdE5hbWV9YCA6ICcnfWApO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBjdXJyZW50IHByb2dyZXNzIG1ldHJpY3Mgd2l0aG91dCBydW5uaW5nIGFjdHVhbCBtZWFzdXJlbWVudHNcbiAgICovXG4gIGFzeW5jIGdldFByb2dyZXNzTWV0cmljcygpOiBQcm9taXNlPFByb2dyZXNzTWV0cmljcz4ge1xuICAgIHRoaXMuY2hlY2tNZW1vcnlQZXJpb2RpY2FsbHkoKTtcbiAgICByZXR1cm4geyAuLi50aGlzLmN1cnJlbnRNZXRyaWNzIH07XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIHByb2dyZXNzIG1ldHJpY3MgZm9yIHRlc3Rpbmcgc2NlbmFyaW9zXG4gICAqL1xuICB1cGRhdGVNZXRyaWNzKHVwZGF0ZXM6IFBhcnRpYWw8UHJvZ3Jlc3NNZXRyaWNzPiwgdGVzdE5hbWU/OiBzdHJpbmcpOiB2b2lkIHtcbiAgICAvLyBEZWVwIG1lcmdlIHRoZSB1cGRhdGVzXG4gICAgdGhpcy5jdXJyZW50TWV0cmljcyA9IHRoaXMuZGVlcE1lcmdlTWV0cmljcyh0aGlzLmN1cnJlbnRNZXRyaWNzLCB1cGRhdGVzKTtcbiAgICBcbiAgICAvLyBUYWtlIHNuYXBzaG90IG9mIHRoZSB1cGRhdGVcbiAgICB0aGlzLnRha2VQcm9ncmVzc1NuYXBzaG90KGB1cGRhdGUtJHt0ZXN0TmFtZSB8fCAnbWFudWFsJ31gKTtcbiAgICBcbiAgICB0aGlzLmNoZWNrTWVtb3J5UGVyaW9kaWNhbGx5KCk7XG4gIH1cblxuICAvKipcbiAgICogU2ltdWxhdGUgcHJvZ3Jlc3Mgb3ZlciB0aW1lIGZvciByZWFsaXN0aWMgdGVzdGluZ1xuICAgKi9cbiAgc2ltdWxhdGVQcm9ncmVzcyhcbiAgICB0YXJnZXRNZXRyaWNzOiBQYXJ0aWFsPFByb2dyZXNzTWV0cmljcz4sXG4gICAgZHVyYXRpb25NczogbnVtYmVyLFxuICAgIHRlc3ROYW1lPzogc3RyaW5nXG4gICk6IFByb21pc2U8dm9pZD4ge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4ge1xuICAgICAgY29uc3Qgc3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICAgIGNvbnN0IHN0YXJ0TWV0cmljcyA9IHsgLi4udGhpcy5jdXJyZW50TWV0cmljcyB9O1xuICAgICAgY29uc3Qgc3RlcHMgPSBNYXRoLm1heCgxLCBNYXRoLmZsb29yKGR1cmF0aW9uTXMgLyAxMDApKTsgLy8gVXBkYXRlIGV2ZXJ5IDEwMG1zXG4gICAgICBsZXQgY3VycmVudFN0ZXAgPSAwO1xuXG4gICAgICBjb25zdCBwcm9ncmVzc0ludGVydmFsID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xuICAgICAgICBjdXJyZW50U3RlcCsrO1xuICAgICAgICBjb25zdCBwcm9ncmVzcyA9IE1hdGgubWluKDEsIGN1cnJlbnRTdGVwIC8gc3RlcHMpO1xuICAgICAgICBcbiAgICAgICAgLy8gSW50ZXJwb2xhdGUgYmV0d2VlbiBzdGFydCBhbmQgdGFyZ2V0IG1ldHJpY3NcbiAgICAgICAgY29uc3QgaW50ZXJwb2xhdGVkTWV0cmljcyA9IHRoaXMuaW50ZXJwb2xhdGVNZXRyaWNzKFxuICAgICAgICAgIHN0YXJ0TWV0cmljcyxcbiAgICAgICAgICB0YXJnZXRNZXRyaWNzLFxuICAgICAgICAgIHByb2dyZXNzXG4gICAgICAgICk7XG4gICAgICAgIFxuICAgICAgICB0aGlzLmN1cnJlbnRNZXRyaWNzID0gaW50ZXJwb2xhdGVkTWV0cmljcztcbiAgICAgICAgdGhpcy50YWtlUHJvZ3Jlc3NTbmFwc2hvdChgc2ltdWxhdGUtc3RlcC0ke2N1cnJlbnRTdGVwfS0ke3Rlc3ROYW1lIHx8ICdhdXRvJ31gKTtcblxuICAgICAgICBpZiAoY3VycmVudFN0ZXAgPj0gc3RlcHMpIHtcbiAgICAgICAgICBjbGVhckludGVydmFsKHByb2dyZXNzSW50ZXJ2YWwpO1xuICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgfVxuICAgICAgfSwgMTAwKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZSB0ZXN0LXNhZmUgcHJvZ3Jlc3MgcmVwb3J0XG4gICAqL1xuICBhc3luYyBnZW5lcmF0ZVByb2dyZXNzUmVwb3J0KHRlc3ROYW1lPzogc3RyaW5nKTogUHJvbWlzZTxQcm9ncmVzc1JlcG9ydD4ge1xuICAgIGNvbnN0IGN1cnJlbnRNZXRyaWNzID0gYXdhaXQgdGhpcy5nZXRQcm9ncmVzc01ldHJpY3MoKTtcbiAgICBjb25zdCB0YXJnZXRNZXRyaWNzID0gdGhpcy5jcmVhdGVUYXJnZXRNZXRyaWNzKCk7XG4gICAgXG4gICAgLy8gQ2FsY3VsYXRlIG92ZXJhbGwgcHJvZ3Jlc3NcbiAgICBjb25zdCBvdmVyYWxsUHJvZ3Jlc3MgPSB0aGlzLmNhbGN1bGF0ZU92ZXJhbGxQcm9ncmVzcyhjdXJyZW50TWV0cmljcywgdGFyZ2V0TWV0cmljcyk7XG5cbiAgICAvLyBHZW5lcmF0ZSBtb2NrIHBoYXNlIHJlcG9ydHNcbiAgICBjb25zdCBwaGFzZXM6IFBoYXNlUmVwb3J0W10gPSBbXG4gICAgICB7XG4gICAgICAgIHBoYXNlSWQ6ICd0ZXN0LXBoYXNlLTEnLFxuICAgICAgICBwaGFzZU5hbWU6ICdUZXN0IFBoYXNlIDEnLFxuICAgICAgICBzdGFydFRpbWU6IG5ldyBEYXRlKHRoaXMudHJhY2tpbmdTdGFydFRpbWUpLFxuICAgICAgICBzdGF0dXM6IFBoYXNlU3RhdHVzLkNPTVBMRVRFRCxcbiAgICAgICAgbWV0cmljczogY3VycmVudE1ldHJpY3MsXG4gICAgICAgIGFjaGlldmVtZW50czogdGhpcy5nZW5lcmF0ZU1vY2tBY2hpZXZlbWVudHMoY3VycmVudE1ldHJpY3MpLFxuICAgICAgICBpc3N1ZXM6IHRoaXMuZ2VuZXJhdGVNb2NrSXNzdWVzKGN1cnJlbnRNZXRyaWNzKSxcbiAgICAgICAgcmVjb21tZW5kYXRpb25zOiB0aGlzLmdlbmVyYXRlTW9ja1JlY29tbWVuZGF0aW9ucyhjdXJyZW50TWV0cmljcylcbiAgICAgIH1cbiAgICBdO1xuXG4gICAgY29uc3QgcmVwb3J0OiBQcm9ncmVzc1JlcG9ydCA9IHtcbiAgICAgIGNhbXBhaWduSWQ6IGB0ZXN0LWNhbXBhaWduLSR7dGVzdE5hbWUgfHwgJ2RlZmF1bHQnfWAsXG4gICAgICBvdmVyYWxsUHJvZ3Jlc3MsXG4gICAgICBwaGFzZXMsXG4gICAgICBjdXJyZW50TWV0cmljcyxcbiAgICAgIHRhcmdldE1ldHJpY3MsXG4gICAgICBlc3RpbWF0ZWRDb21wbGV0aW9uOiBuZXcgRGF0ZShEYXRlLm5vdygpICsgMzYwMDAwMCkgLy8gMSBob3VyIGZyb20gbm93XG4gICAgfTtcblxuICAgIC8vIFRha2Ugc25hcHNob3QgZm9yIHJlcG9ydCBnZW5lcmF0aW9uXG4gICAgdGhpcy50YWtlUHJvZ3Jlc3NTbmFwc2hvdChgcmVwb3J0LSR7dGVzdE5hbWUgfHwgJ2dlbmVyYXRlZCd9YCk7XG5cbiAgICByZXR1cm4gcmVwb3J0O1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBwcm9ncmVzcyBoaXN0b3J5IHdpdGggbWVtb3J5LXNhZmUgYWNjZXNzXG4gICAqL1xuICBnZXRQcm9ncmVzc0hpc3RvcnkoKTogUHJvZ3Jlc3NTbmFwc2hvdFtdIHtcbiAgICByZXR1cm4gWy4uLnRoaXMucHJvZ3Jlc3NIaXN0b3J5XTsgLy8gUmV0dXJuIGNvcHkgdG8gcHJldmVudCBleHRlcm5hbCBtb2RpZmljYXRpb25cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgbWVtb3J5IHVzYWdlIHN0YXRpc3RpY3NcbiAgICovXG4gIGdldE1lbW9yeVN0YXRpc3RpY3MoKToge1xuICAgIGN1cnJlbnRVc2FnZTogc3RyaW5nO1xuICAgIHBlYWtVc2FnZTogc3RyaW5nO1xuICAgIHNuYXBzaG90Q291bnQ6IG51bWJlcjtcbiAgICBtZW1vcnlFZmZpY2llbnQ6IGJvb2xlYW47XG4gIH0gfCBudWxsIHtcbiAgICBpZiAoIXRoaXMubWVtb3J5TW9uaXRvcikge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgY29uc3Qgc3VtbWFyeSA9IHRoaXMubWVtb3J5TW9uaXRvci5nZXRNZW1vcnlTdW1tYXJ5KCk7XG4gICAgXG4gICAgcmV0dXJuIHtcbiAgICAgIGN1cnJlbnRVc2FnZTogYCR7c3VtbWFyeS5jdXJyZW50TWVtb3J5LnRvRml4ZWQoMil9TUJgLFxuICAgICAgcGVha1VzYWdlOiBgJHtzdW1tYXJ5LnBlYWtNZW1vcnkudG9GaXhlZCgyKX1NQmAsXG4gICAgICBzbmFwc2hvdENvdW50OiBzdW1tYXJ5LnNuYXBzaG90Q291bnQsXG4gICAgICBtZW1vcnlFZmZpY2llbnQ6IHN1bW1hcnkudG90YWxJbmNyZWFzZSA8IDI1IC8vIExlc3MgdGhhbiAyNU1CIGluY3JlYXNlIGlzIGVmZmljaWVudFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogVmFsaWRhdGUgcHJvZ3Jlc3MgdHJhY2tpbmcgc3RhdGVcbiAgICovXG4gIHZhbGlkYXRlVHJhY2tpbmdTdGF0ZSgpOiBWYWxpZGF0aW9uUmVzdWx0IHtcbiAgICBjb25zdCBlcnJvcnM6IHN0cmluZ1tdID0gW107XG4gICAgY29uc3Qgd2FybmluZ3M6IHN0cmluZ1tdID0gW107XG5cbiAgICAvLyBDaGVjayBtZW1vcnkgdXNhZ2VcbiAgICBpZiAodGhpcy5tZW1vcnlNb25pdG9yKSB7XG4gICAgICBjb25zdCBtZW1vcnlDaGVjayA9IHRoaXMubWVtb3J5TW9uaXRvci5jaGVja01lbW9yeVVzYWdlKCd2YWxpZGF0aW9uJyk7XG4gICAgICBlcnJvcnMucHVzaCguLi5tZW1vcnlDaGVjay5lcnJvcnMpO1xuICAgICAgd2FybmluZ3MucHVzaCguLi5tZW1vcnlDaGVjay53YXJuaW5ncyk7XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgaGlzdG9yeSBzaXplXG4gICAgaWYgKHRoaXMucHJvZ3Jlc3NIaXN0b3J5Lmxlbmd0aCA+IHRoaXMuY29uZmlnLm1heEhpc3RvcnlTaXplKSB7XG4gICAgICB3YXJuaW5ncy5wdXNoKGBQcm9ncmVzcyBoaXN0b3J5IHNpemUgKCR7dGhpcy5wcm9ncmVzc0hpc3RvcnkubGVuZ3RofSkgZXhjZWVkcyBtYXhpbXVtICgke3RoaXMuY29uZmlnLm1heEhpc3RvcnlTaXplfSlgKTtcbiAgICB9XG5cbiAgICAvLyBDaGVjayBmb3IgdHJhY2tpbmcgY29uc2lzdGVuY3lcbiAgICBpZiAodGhpcy5pc1RyYWNraW5nICYmIHRoaXMudHJhY2tpbmdTdGFydFRpbWUgPT09IDApIHtcbiAgICAgIGVycm9ycy5wdXNoKCdUcmFja2luZyBpcyBhY3RpdmUgYnV0IHN0YXJ0IHRpbWUgaXMgbm90IHNldCcpO1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiBlcnJvcnMubGVuZ3RoID09PSAwLFxuICAgICAgZXJyb3JzLFxuICAgICAgd2FybmluZ3NcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIFJlc2V0IHRyYWNrZXIgc3RhdGUgZm9yIGNsZWFuIHRlc3QgaXNvbGF0aW9uXG4gICAqL1xuICByZXNldCgpOiB2b2lkIHtcbiAgICAvLyBTdG9wIGFueSBhY3RpdmUgdHJhY2tpbmdcbiAgICBpZiAodGhpcy5pc1RyYWNraW5nKSB7XG4gICAgICB0aGlzLnN0b3BUcmFja2luZygncmVzZXQnKTtcbiAgICB9XG5cbiAgICAvLyBDbGVhciBoaXN0b3J5XG4gICAgdGhpcy5wcm9ncmVzc0hpc3RvcnkgPSBbXTtcbiAgICBcbiAgICAvLyBSZXNldCBtZXRyaWNzXG4gICAgdGhpcy5jdXJyZW50TWV0cmljcyA9IHRoaXMuY3JlYXRlSW5pdGlhbE1ldHJpY3MoKTtcbiAgICBcbiAgICAvLyBSZXNldCBjb3VudGVyc1xuICAgIHRoaXMubWVtb3J5Q2hlY2tDb3VudGVyID0gMDtcbiAgICB0aGlzLnRyYWNraW5nU3RhcnRUaW1lID0gMDtcblxuICAgIC8vIFJlc2V0IG1lbW9yeSBtb25pdG9yXG4gICAgaWYgKHRoaXMubWVtb3J5TW9uaXRvcikge1xuICAgICAgdGhpcy5tZW1vcnlNb25pdG9yID0gbmV3IFRlc3RNZW1vcnlNb25pdG9yKHtcbiAgICAgICAgd2FybmluZ1RocmVzaG9sZDogNTAsXG4gICAgICAgIGVycm9yVGhyZXNob2xkOiAxMDAsXG4gICAgICAgIGxlYWtUaHJlc2hvbGQ6IDI1XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBjb25zb2xlLmxvZygnVGVzdC1zYWZlIHByb2dyZXNzIHRyYWNrZXIgcmVzZXQnKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDbGVhbnVwIHJlc291cmNlcyBhbmQgcHJldmVudCBtZW1vcnkgbGVha3NcbiAgICovXG4gIGNsZWFudXAoKTogdm9pZCB7XG4gICAgLy8gU3RvcCB0cmFja2luZyBpZiBhY3RpdmVcbiAgICBpZiAodGhpcy5pc1RyYWNraW5nKSB7XG4gICAgICB0aGlzLnN0b3BUcmFja2luZygnY2xlYW51cCcpO1xuICAgIH1cblxuICAgIC8vIENsZWFyIGFsbCB0aW1lcnNcbiAgICBpZiAodGhpcy5wcm9ncmVzc1VwZGF0ZVRpbWVyKSB7XG4gICAgICBjbGVhckludGVydmFsKHRoaXMucHJvZ3Jlc3NVcGRhdGVUaW1lcik7XG4gICAgICB0aGlzLnByb2dyZXNzVXBkYXRlVGltZXIgPSBudWxsO1xuICAgIH1cblxuICAgIC8vIENsZWFyIGhpc3RvcnlcbiAgICB0aGlzLnByb2dyZXNzSGlzdG9yeSA9IFtdO1xuXG4gICAgLy8gQ2xlYW51cCBtZW1vcnkgbW9uaXRvclxuICAgIGlmICh0aGlzLm1lbW9yeU1vbml0b3IpIHtcbiAgICAgIHRoaXMubWVtb3J5TW9uaXRvci5jbGVhbnVwKCd0cmFja2VyLWNsZWFudXAnKTtcbiAgICB9XG5cbiAgICBjb25zb2xlLmxvZygnVGVzdC1zYWZlIHByb2dyZXNzIHRyYWNrZXIgY2xlYW5lZCB1cCcpO1xuICB9XG5cbiAgLy8gUHJpdmF0ZSBoZWxwZXIgbWV0aG9kc1xuXG4gIHByaXZhdGUgdGFrZVByb2dyZXNzU25hcHNob3QodGVzdE5hbWU6IHN0cmluZyk6IHZvaWQge1xuICAgIGNvbnN0IHNuYXBzaG90OiBQcm9ncmVzc1NuYXBzaG90ID0ge1xuICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLFxuICAgICAgbWV0cmljczogeyAuLi50aGlzLmN1cnJlbnRNZXRyaWNzIH0sXG4gICAgICB0ZXN0TmFtZSxcbiAgICAgIG1lbW9yeVVzYWdlOiB0aGlzLm1lbW9yeU1vbml0b3IgPyBwcm9jZXNzLm1lbW9yeVVzYWdlKCkuaGVhcFVzZWQgOiB1bmRlZmluZWRcbiAgICB9O1xuXG4gICAgdGhpcy5wcm9ncmVzc0hpc3RvcnkucHVzaChzbmFwc2hvdCk7XG5cbiAgICAvLyBNYWludGFpbiBoaXN0b3J5IHNpemUgbGltaXQgdG8gcHJldmVudCBtZW1vcnkgaXNzdWVzXG4gICAgaWYgKHRoaXMucHJvZ3Jlc3NIaXN0b3J5Lmxlbmd0aCA+IHRoaXMuY29uZmlnLm1heEhpc3RvcnlTaXplKSB7XG4gICAgICBjb25zdCBleGNlc3NDb3VudCA9IHRoaXMucHJvZ3Jlc3NIaXN0b3J5Lmxlbmd0aCAtIHRoaXMuY29uZmlnLm1heEhpc3RvcnlTaXplO1xuICAgICAgdGhpcy5wcm9ncmVzc0hpc3Rvcnkuc3BsaWNlKDAsIGV4Y2Vzc0NvdW50KTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNoZWNrTWVtb3J5UGVyaW9kaWNhbGx5KCk6IHZvaWQge1xuICAgIHRoaXMubWVtb3J5Q2hlY2tDb3VudGVyKys7XG4gICAgXG4gICAgaWYgKHRoaXMubWVtb3J5Q2hlY2tDb3VudGVyICUgdGhpcy5jb25maWcubWVtb3J5Q2hlY2tGcmVxdWVuY3kgPT09IDAgJiYgdGhpcy5tZW1vcnlNb25pdG9yKSB7XG4gICAgICBjb25zdCBtZW1vcnlDaGVjayA9IHRoaXMubWVtb3J5TW9uaXRvci5jaGVja01lbW9yeVVzYWdlKGBwZXJpb2RpYy0ke3RoaXMubWVtb3J5Q2hlY2tDb3VudGVyfWApO1xuICAgICAgXG4gICAgICBpZiAoIW1lbW9yeUNoZWNrLmlzV2l0aGluTGltaXRzKSB7XG4gICAgICAgIGNvbnNvbGUud2FybignTWVtb3J5IGNoZWNrIGZhaWxlZCBpbiBwcm9ncmVzcyB0cmFja2VyOicsIG1lbW9yeUNoZWNrLmVycm9ycyk7XG4gICAgICAgIHRoaXMucGVyZm9ybU1lbW9yeUNsZWFudXAoJ3BlcmlvZGljLWNoZWNrJyk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBwZXJmb3JtTWVtb3J5Q2xlYW51cChyZWFzb24/OiBzdHJpbmcpOiB2b2lkIHtcbiAgICAvLyBUcmltIHByb2dyZXNzIGhpc3RvcnlcbiAgICBpZiAodGhpcy5wcm9ncmVzc0hpc3RvcnkubGVuZ3RoID4gdGhpcy5jb25maWcubWF4SGlzdG9yeVNpemUgLyAyKSB7XG4gICAgICBjb25zdCBrZWVwQ291bnQgPSBNYXRoLmZsb29yKHRoaXMuY29uZmlnLm1heEhpc3RvcnlTaXplIC8gMik7XG4gICAgICB0aGlzLnByb2dyZXNzSGlzdG9yeSA9IHRoaXMucHJvZ3Jlc3NIaXN0b3J5LnNsaWNlKC1rZWVwQ291bnQpO1xuICAgIH1cblxuICAgIC8vIEZvcmNlIG1lbW9yeSBjbGVhbnVwIGlmIG1vbml0b3IgaXMgYXZhaWxhYmxlXG4gICAgaWYgKHRoaXMubWVtb3J5TW9uaXRvcikge1xuICAgICAgdGhpcy5tZW1vcnlNb25pdG9yLmNsZWFudXAocmVhc29uIHx8ICdwcm9ncmVzcy10cmFja2VyLWNsZWFudXAnKTtcbiAgICB9XG5cbiAgICAvLyBGb3JjZSBnYXJiYWdlIGNvbGxlY3Rpb24gaWYgYXZhaWxhYmxlXG4gICAgaWYgKGdsb2JhbC5nYykge1xuICAgICAgdHJ5IHtcbiAgICAgICAgZ2xvYmFsLmdjKCk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLndhcm4oJ0ZhaWxlZCB0byBmb3JjZSBnYXJiYWdlIGNvbGxlY3Rpb246JywgZXJyb3IpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgc3RhcnRQcm9ncmVzc1NpbXVsYXRpb24oKTogdm9pZCB7XG4gICAgaWYgKHRoaXMucHJvZ3Jlc3NVcGRhdGVUaW1lcikge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMucHJvZ3Jlc3NVcGRhdGVUaW1lciA9IHNldEludGVydmFsKCgpID0+IHtcbiAgICAgIC8vIFNpbXVsYXRlIHNtYWxsIHByb2dyZXNzIGluY3JlbWVudHNcbiAgICAgIGNvbnN0IHVwZGF0ZXM6IFBhcnRpYWw8UHJvZ3Jlc3NNZXRyaWNzPiA9IHtcbiAgICAgICAgdHlwZVNjcmlwdEVycm9yczoge1xuICAgICAgICAgIC4uLnRoaXMuY3VycmVudE1ldHJpY3MudHlwZVNjcmlwdEVycm9ycyxcbiAgICAgICAgICBjdXJyZW50OiBNYXRoLm1heCgwLCB0aGlzLmN1cnJlbnRNZXRyaWNzLnR5cGVTY3JpcHRFcnJvcnMuY3VycmVudCAtIDEpXG4gICAgICAgIH0sXG4gICAgICAgIGxpbnRpbmdXYXJuaW5nczoge1xuICAgICAgICAgIC4uLnRoaXMuY3VycmVudE1ldHJpY3MubGludGluZ1dhcm5pbmdzLFxuICAgICAgICAgIGN1cnJlbnQ6IE1hdGgubWF4KDAsIHRoaXMuY3VycmVudE1ldHJpY3MubGludGluZ1dhcm5pbmdzLmN1cnJlbnQgLSA1KVxuICAgICAgICB9XG4gICAgICB9O1xuXG4gICAgICB0aGlzLnVwZGF0ZU1ldHJpY3ModXBkYXRlcywgJ3NpbXVsYXRpb24nKTtcbiAgICB9LCB0aGlzLmNvbmZpZy5wcm9ncmVzc1VwZGF0ZUludGVydmFsKTtcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlSW5pdGlhbE1ldHJpY3MoKTogUHJvZ3Jlc3NNZXRyaWNzIHtcbiAgICByZXR1cm4ge1xuICAgICAgdHlwZVNjcmlwdEVycm9yczoge1xuICAgICAgICBjdXJyZW50OiA4NixcbiAgICAgICAgdGFyZ2V0OiAwLFxuICAgICAgICByZWR1Y3Rpb246IDAsXG4gICAgICAgIHBlcmNlbnRhZ2U6IDBcbiAgICAgIH0sXG4gICAgICBsaW50aW5nV2FybmluZ3M6IHtcbiAgICAgICAgY3VycmVudDogNDUwNixcbiAgICAgICAgdGFyZ2V0OiAwLFxuICAgICAgICByZWR1Y3Rpb246IDAsXG4gICAgICAgIHBlcmNlbnRhZ2U6IDBcbiAgICAgIH0sXG4gICAgICBidWlsZFBlcmZvcm1hbmNlOiB7XG4gICAgICAgIGN1cnJlbnRUaW1lOiAxMi41LFxuICAgICAgICB0YXJnZXRUaW1lOiAxMCxcbiAgICAgICAgY2FjaGVIaXRSYXRlOiAwLjYsXG4gICAgICAgIG1lbW9yeVVzYWdlOiA2MFxuICAgICAgfSxcbiAgICAgIGVudGVycHJpc2VTeXN0ZW1zOiB7XG4gICAgICAgIGN1cnJlbnQ6IDAsXG4gICAgICAgIHRhcmdldDogMjAwLFxuICAgICAgICB0cmFuc2Zvcm1lZEV4cG9ydHM6IDBcbiAgICAgIH1cbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVUYXJnZXRNZXRyaWNzKCk6IFByb2dyZXNzTWV0cmljcyB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHR5cGVTY3JpcHRFcnJvcnM6IHtcbiAgICAgICAgY3VycmVudDogMCxcbiAgICAgICAgdGFyZ2V0OiAwLFxuICAgICAgICByZWR1Y3Rpb246IDg2LFxuICAgICAgICBwZXJjZW50YWdlOiAxMDBcbiAgICAgIH0sXG4gICAgICBsaW50aW5nV2FybmluZ3M6IHtcbiAgICAgICAgY3VycmVudDogMCxcbiAgICAgICAgdGFyZ2V0OiAwLFxuICAgICAgICByZWR1Y3Rpb246IDQ1MDYsXG4gICAgICAgIHBlcmNlbnRhZ2U6IDEwMFxuICAgICAgfSxcbiAgICAgIGJ1aWxkUGVyZm9ybWFuY2U6IHtcbiAgICAgICAgY3VycmVudFRpbWU6IDgsXG4gICAgICAgIHRhcmdldFRpbWU6IDEwLFxuICAgICAgICBjYWNoZUhpdFJhdGU6IDAuOCxcbiAgICAgICAgbWVtb3J5VXNhZ2U6IDQ1XG4gICAgICB9LFxuICAgICAgZW50ZXJwcmlzZVN5c3RlbXM6IHtcbiAgICAgICAgY3VycmVudDogMjAwLFxuICAgICAgICB0YXJnZXQ6IDIwMCxcbiAgICAgICAgdHJhbnNmb3JtZWRFeHBvcnRzOiAyMDBcbiAgICAgIH1cbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBkZWVwTWVyZ2VNZXRyaWNzKGN1cnJlbnQ6IFByb2dyZXNzTWV0cmljcywgdXBkYXRlczogUGFydGlhbDxQcm9ncmVzc01ldHJpY3M+KTogUHJvZ3Jlc3NNZXRyaWNzIHtcbiAgICBjb25zdCByZXN1bHQgPSB7IC4uLmN1cnJlbnQgfTtcbiAgICBcbiAgICBPYmplY3Qua2V5cyh1cGRhdGVzKS5mb3JFYWNoKGtleSA9PiB7XG4gICAgICBjb25zdCB1cGRhdGVWYWx1ZSA9IHVwZGF0ZXNba2V5IGFzIGtleW9mIFByb2dyZXNzTWV0cmljc107XG4gICAgICBpZiAodXBkYXRlVmFsdWUgJiYgdHlwZW9mIHVwZGF0ZVZhbHVlID09PSAnb2JqZWN0Jykge1xuICAgICAgICByZXN1bHRba2V5IGFzIGtleW9mIFByb2dyZXNzTWV0cmljc10gPSB7XG4gICAgICAgICAgLi4uY3VycmVudFtrZXkgYXMga2V5b2YgUHJvZ3Jlc3NNZXRyaWNzXSxcbiAgICAgICAgICAuLi51cGRhdGVWYWx1ZVxuICAgICAgICB9IGFzIGFueTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICBcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgcHJpdmF0ZSBpbnRlcnBvbGF0ZU1ldHJpY3MoXG4gICAgc3RhcnQ6IFByb2dyZXNzTWV0cmljcyxcbiAgICB0YXJnZXQ6IFBhcnRpYWw8UHJvZ3Jlc3NNZXRyaWNzPixcbiAgICBwcm9ncmVzczogbnVtYmVyXG4gICk6IFByb2dyZXNzTWV0cmljcyB7XG4gICAgY29uc3QgcmVzdWx0ID0geyAuLi5zdGFydCB9O1xuICAgIFxuICAgIC8vIEludGVycG9sYXRlIFR5cGVTY3JpcHQgZXJyb3JzXG4gICAgaWYgKHRhcmdldC50eXBlU2NyaXB0RXJyb3JzPy5jdXJyZW50ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIGNvbnN0IHN0YXJ0VmFsdWUgPSBzdGFydC50eXBlU2NyaXB0RXJyb3JzLmN1cnJlbnQ7XG4gICAgICBjb25zdCB0YXJnZXRWYWx1ZSA9IHRhcmdldC50eXBlU2NyaXB0RXJyb3JzLmN1cnJlbnQ7XG4gICAgICByZXN1bHQudHlwZVNjcmlwdEVycm9ycy5jdXJyZW50ID0gTWF0aC5yb3VuZChzdGFydFZhbHVlICsgKHRhcmdldFZhbHVlIC0gc3RhcnRWYWx1ZSkgKiBwcm9ncmVzcyk7XG4gICAgfVxuICAgIFxuICAgIC8vIEludGVycG9sYXRlIGxpbnRpbmcgd2FybmluZ3NcbiAgICBpZiAodGFyZ2V0LmxpbnRpbmdXYXJuaW5ncz8uY3VycmVudCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBjb25zdCBzdGFydFZhbHVlID0gc3RhcnQubGludGluZ1dhcm5pbmdzLmN1cnJlbnQ7XG4gICAgICBjb25zdCB0YXJnZXRWYWx1ZSA9IHRhcmdldC5saW50aW5nV2FybmluZ3MuY3VycmVudDtcbiAgICAgIHJlc3VsdC5saW50aW5nV2FybmluZ3MuY3VycmVudCA9IE1hdGgucm91bmQoc3RhcnRWYWx1ZSArICh0YXJnZXRWYWx1ZSAtIHN0YXJ0VmFsdWUpICogcHJvZ3Jlc3MpO1xuICAgIH1cbiAgICBcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgcHJpdmF0ZSBjYWxjdWxhdGVPdmVyYWxsUHJvZ3Jlc3MoY3VycmVudDogUHJvZ3Jlc3NNZXRyaWNzLCB0YXJnZXQ6IFByb2dyZXNzTWV0cmljcyk6IG51bWJlciB7XG4gICAgY29uc3QgdHNQcm9ncmVzcyA9IHRhcmdldC50eXBlU2NyaXB0RXJyb3JzLmN1cnJlbnQgPT09IDAgXG4gICAgICA/ICgxIC0gY3VycmVudC50eXBlU2NyaXB0RXJyb3JzLmN1cnJlbnQgLyA4NikgKiAxMDAgXG4gICAgICA6IDA7XG4gICAgXG4gICAgY29uc3QgbGludFByb2dyZXNzID0gdGFyZ2V0LmxpbnRpbmdXYXJuaW5ncy5jdXJyZW50ID09PSAwIFxuICAgICAgPyAoMSAtIGN1cnJlbnQubGludGluZ1dhcm5pbmdzLmN1cnJlbnQgLyA0NTA2KSAqIDEwMCBcbiAgICAgIDogMDtcbiAgICBcbiAgICBjb25zdCBidWlsZFByb2dyZXNzID0gY3VycmVudC5idWlsZFBlcmZvcm1hbmNlLmN1cnJlbnRUaW1lIDw9IHRhcmdldC5idWlsZFBlcmZvcm1hbmNlLmN1cnJlbnRUaW1lIFxuICAgICAgPyAxMDAgXG4gICAgICA6IDA7XG4gICAgXG4gICAgY29uc3QgZW50ZXJwcmlzZVByb2dyZXNzID0gKGN1cnJlbnQuZW50ZXJwcmlzZVN5c3RlbXMuY3VycmVudCAvIHRhcmdldC5lbnRlcnByaXNlU3lzdGVtcy5jdXJyZW50KSAqIDEwMDtcbiAgICBcbiAgICByZXR1cm4gTWF0aC5yb3VuZCgodHNQcm9ncmVzcyArIGxpbnRQcm9ncmVzcyArIGJ1aWxkUHJvZ3Jlc3MgKyBlbnRlcnByaXNlUHJvZ3Jlc3MpIC8gNCk7XG4gIH1cblxuICBwcml2YXRlIGdlbmVyYXRlTW9ja0FjaGlldmVtZW50cyhtZXRyaWNzOiBQcm9ncmVzc01ldHJpY3MpOiBzdHJpbmdbXSB7XG4gICAgY29uc3QgYWNoaWV2ZW1lbnRzOiBzdHJpbmdbXSA9IFtdO1xuICAgIFxuICAgIGlmIChtZXRyaWNzLnR5cGVTY3JpcHRFcnJvcnMuY3VycmVudCA9PT0gMCkge1xuICAgICAgYWNoaWV2ZW1lbnRzLnB1c2goJ1plcm8gVHlwZVNjcmlwdCBlcnJvcnMgYWNoaWV2ZWQnKTtcbiAgICB9XG4gICAgXG4gICAgaWYgKG1ldHJpY3MubGludGluZ1dhcm5pbmdzLmN1cnJlbnQgPT09IDApIHtcbiAgICAgIGFjaGlldmVtZW50cy5wdXNoKCdaZXJvIGxpbnRpbmcgd2FybmluZ3MgYWNoaWV2ZWQnKTtcbiAgICB9XG4gICAgXG4gICAgaWYgKG1ldHJpY3MuYnVpbGRQZXJmb3JtYW5jZS5jdXJyZW50VGltZSA8PSAxMCkge1xuICAgICAgYWNoaWV2ZW1lbnRzLnB1c2goJ0J1aWxkIHRpbWUgdW5kZXIgMTAgc2Vjb25kcycpO1xuICAgIH1cbiAgICBcbiAgICByZXR1cm4gYWNoaWV2ZW1lbnRzO1xuICB9XG5cbiAgcHJpdmF0ZSBnZW5lcmF0ZU1vY2tJc3N1ZXMobWV0cmljczogUHJvZ3Jlc3NNZXRyaWNzKTogc3RyaW5nW10ge1xuICAgIGNvbnN0IGlzc3Vlczogc3RyaW5nW10gPSBbXTtcbiAgICBcbiAgICBpZiAobWV0cmljcy50eXBlU2NyaXB0RXJyb3JzLmN1cnJlbnQgPiAwKSB7XG4gICAgICBpc3N1ZXMucHVzaChgJHttZXRyaWNzLnR5cGVTY3JpcHRFcnJvcnMuY3VycmVudH0gVHlwZVNjcmlwdCBlcnJvcnMgcmVtYWluaW5nYCk7XG4gICAgfVxuICAgIFxuICAgIGlmIChtZXRyaWNzLmxpbnRpbmdXYXJuaW5ncy5jdXJyZW50ID4gMTAwMCkge1xuICAgICAgaXNzdWVzLnB1c2goYEhpZ2ggbGludGluZyB3YXJuaW5nIGNvdW50OiAke21ldHJpY3MubGludGluZ1dhcm5pbmdzLmN1cnJlbnR9YCk7XG4gICAgfVxuICAgIFxuICAgIHJldHVybiBpc3N1ZXM7XG4gIH1cblxuICBwcml2YXRlIGdlbmVyYXRlTW9ja1JlY29tbWVuZGF0aW9ucyhtZXRyaWNzOiBQcm9ncmVzc01ldHJpY3MpOiBzdHJpbmdbXSB7XG4gICAgY29uc3QgcmVjb21tZW5kYXRpb25zOiBzdHJpbmdbXSA9IFtdO1xuICAgIFxuICAgIGlmIChtZXRyaWNzLnR5cGVTY3JpcHRFcnJvcnMuY3VycmVudCA+IDApIHtcbiAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKCdDb250aW51ZSB3aXRoIFR5cGVTY3JpcHQgZXJyb3IgZWxpbWluYXRpb24nKTtcbiAgICB9XG4gICAgXG4gICAgaWYgKG1ldHJpY3MubGludGluZ1dhcm5pbmdzLmN1cnJlbnQgPiAwKSB7XG4gICAgICByZWNvbW1lbmRhdGlvbnMucHVzaCgnQXBwbHkgc3lzdGVtYXRpYyBsaW50aW5nIGZpeGVzJyk7XG4gICAgfVxuICAgIFxuICAgIHJldHVybiByZWNvbW1lbmRhdGlvbnM7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgVGVzdFNhZmVQcm9ncmVzc1RyYWNrZXI7Il0sInZlcnNpb24iOjN9