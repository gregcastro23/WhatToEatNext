38f90cda5e410dd36374f5bdb8939f6b
"use strict";
/**
 * Export Transformation Engine Tests
 * Perfect Codebase Campaign - Phase 3 Implementation
 */
Object.defineProperty(exports, "__esModule", { value: true });
// Mock dependencies
jest.mock('./UnusedExportAnalyzer');
jest.mock('./EnterpriseIntelligenceGenerator');
jest.mock('./SafetyProtocol');
jest.mock('./ProgressTracker');
jest.mock('child_process');
const ExportTransformationEngine_1 = require("./ExportTransformationEngine");
const UnusedExportAnalyzer_1 = require("./UnusedExportAnalyzer");
const EnterpriseIntelligenceGenerator_1 = require("./EnterpriseIntelligenceGenerator");
const SafetyProtocol_1 = require("./SafetyProtocol");
const ProgressTracker_1 = require("./ProgressTracker");
const mockAnalyzer = UnusedExportAnalyzer_1.UnusedExportAnalyzer;
const mockGenerator = EnterpriseIntelligenceGenerator_1.EnterpriseIntelligenceGenerator;
const mockSafetyProtocol = SafetyProtocol_1.SafetyProtocol;
const mockProgressTracker = ProgressTracker_1.ProgressTracker;
describe('ExportTransformationEngine', () => {
    let engine;
    beforeEach(() => {
        jest.clearAllMocks();
        // Mock analyzer
        mockAnalyzer.prototype.analyzeUnusedExports = jest.fn().mockResolvedValue({
            totalFiles: 10,
            totalUnusedExports: 25,
            highPriorityFiles: [
                {
                    filePath: '/test/high1.ts',
                    priority: 'HIGH',
                    unusedExports: [],
                    safetyScore: 90,
                    transformationCandidates: [
                        {
                            export: {
                                exportName: 'testExport1',
                                exportType: 'function',
                                complexity: 5,
                            },
                            intelligenceSystemName: 'TEST_EXPORT_1_INTELLIGENCE_SYSTEM',
                            transformationComplexity: 'MODERATE',
                            safetyScore: 85,
                            estimatedBenefit: 75,
                        },
                    ],
                    category: 'CORE',
                },
            ],
            mediumPriorityFiles: [
                {
                    filePath: '/test/medium1.ts',
                    priority: 'MEDIUM',
                    unusedExports: [],
                    safetyScore: 85,
                    transformationCandidates: [
                        {
                            export: {
                                exportName: 'testExport2',
                                exportType: 'class',
                                complexity: 8,
                            },
                            intelligenceSystemName: 'TEST_EXPORT_2_INTELLIGENCE_SYSTEM',
                            transformationComplexity: 'COMPLEX',
                            safetyScore: 80,
                            estimatedBenefit: 80,
                        },
                    ],
                    category: 'CORE',
                },
            ],
            lowPriorityFiles: [],
            summary: {
                recipeFiles: 2,
                coreFiles: 8,
                externalFiles: 0,
                totalTransformationCandidates: 2,
                averageSafetyScore: 87.5,
                estimatedIntelligenceSystems: 2,
            },
        });
        // Mock generator
        mockGenerator.prototype.generateIntelligenceSystems = jest
            .fn()
            .mockResolvedValue([
            {
                systemName: 'TEST_SYSTEM_1',
                filePath: '/output/TEST_SYSTEM_1.ts',
                originalExport: { exportName: 'testExport1', exportType: 'function' },
                generatedCode: 'generated code',
                capabilities: [],
                integrationPoints: [],
                estimatedValue: 75,
                complexity: 'MODERATE',
            },
        ]);
        mockGenerator.prototype.generateSummary = jest.fn().mockReturnValue({
            totalSystemsGenerated: 1,
            totalCapabilitiesAdded: 3,
            totalIntegrationPoints: 2,
            averageComplexity: 2.5,
            estimatedTotalValue: 75,
            generationsByCategory: { function: 1 },
        });
        // Mock safety protocol
        mockSafetyProtocol.prototype.createSafetyCheckpoint = jest
            .fn()
            .mockResolvedValue('checkpoint-123');
        mockSafetyProtocol.prototype.rollbackToCheckpoint = jest
            .fn()
            .mockResolvedValue(undefined);
        mockSafetyProtocol.prototype.emergencyRollback = jest
            .fn()
            .mockResolvedValue(undefined);
        // Mock progress tracker
        mockProgressTracker.prototype.updateProgress = jest
            .fn()
            .mockResolvedValue(undefined);
        engine = new ExportTransformationEngine_1.ExportTransformationEngine({
            batchSize: 5,
            safetyThreshold: 80,
            dryRun: true, // Use dry run for tests
        });
    });
    describe('constructor', () => {
        it('should initialize with default configuration', () => {
            const defaultEngine = new ExportTransformationEngine_1.ExportTransformationEngine();
            const config = defaultEngine.getConfig();
            expect(config.batchSize).toBe(10);
            expect(config.safetyThreshold).toBe(80);
            expect(config.buildValidationEnabled).toBe(true);
            expect(config.testValidationEnabled).toBe(true);
            expect(config.rollbackOnFailure).toBe(true);
        });
        it('should initialize with custom configuration', () => {
            const customEngine = new ExportTransformationEngine_1.ExportTransformationEngine({
                batchSize: 15,
                safetyThreshold: 90,
                dryRun: true,
            });
            const config = customEngine.getConfig();
            expect(config.batchSize).toBe(15);
            expect(config.safetyThreshold).toBe(90);
            expect(config.dryRun).toBe(true);
        });
    });
    describe('executeTransformation', () => {
        it('should execute complete transformation campaign', async () => {
            const summary = await engine.executeTransformation();
            expect(summary).toHaveProperty('totalBatches');
            expect(summary).toHaveProperty('successfulBatches');
            expect(summary).toHaveProperty('totalFilesProcessed');
            expect(summary).toHaveProperty('totalSystemsGenerated');
            expect(summary).toHaveProperty('successRate');
            expect(summary).toHaveProperty('generationSummary');
        });
        it('should perform analysis phase', async () => {
            await engine.executeTransformation();
            expect(mockAnalyzer.prototype.analyzeUnusedExports).toHaveBeenCalledTimes(1);
        });
        it('should create safety checkpoints', async () => {
            await engine.executeTransformation();
            expect(mockSafetyProtocol.prototype.createSafetyCheckpoint).toHaveBeenCalledWith('transformation-start');
        });
        it('should handle critical failures', async () => {
            mockAnalyzer.prototype.analyzeUnusedExports.mockRejectedValueOnce(new Error('Analysis failed'));
            await expect(engine.executeTransformation()).rejects.toThrow('Analysis failed');
            expect(mockSafetyProtocol.prototype.emergencyRollback).toHaveBeenCalled();
        });
    });
    describe('batch planning', () => {
        it('should create batches based on priority', async () => {
            const summary = await engine.executeTransformation();
            // Should have created batches for high and medium priority files
            expect(summary.totalBatches).toBeGreaterThan(0);
        });
        it('should respect batch size configuration', async () => {
            const smallBatchEngine = new ExportTransformationEngine_1.ExportTransformationEngine({
                batchSize: 1,
                dryRun: true,
            });
            const summary = await smallBatchEngine.executeTransformation();
            // With batch size 1 and 2 files, should create 2 batches
            expect(summary.totalBatches).toBe(2);
        });
    });
    describe('batch execution', () => {
        it('should execute batches in priority order', async () => {
            const summary = await engine.executeTransformation();
            expect(summary.successfulBatches).toBeGreaterThan(0);
            expect(summary.successRate).toBe(100); // Dry run should always succeed
        });
        it('should handle batch failures with rollback', async () => {
            const failingEngine = new ExportTransformationEngine_1.ExportTransformationEngine({
                dryRun: false,
                rollbackOnFailure: true,
            });
            mockGenerator.prototype.generateIntelligenceSystems.mockRejectedValueOnce(new Error('Generation failed'));
            const summary = await failingEngine.executeTransformation();
            expect(summary.failedBatches).toBeGreaterThan(0);
            expect(mockSafetyProtocol.prototype.rollbackToCheckpoint).toHaveBeenCalled();
        });
        it('should skip rollback when disabled', async () => {
            const noRollbackEngine = new ExportTransformationEngine_1.ExportTransformationEngine({
                dryRun: false,
                rollbackOnFailure: false,
            });
            mockGenerator.prototype.generateIntelligenceSystems.mockRejectedValueOnce(new Error('Generation failed'));
            await noRollbackEngine.executeTransformation();
            expect(mockSafetyProtocol.prototype.rollbackToCheckpoint).not.toHaveBeenCalled();
        });
    });
    describe('safety validation', () => {
        it('should enforce safety threshold', async () => {
            const strictEngine = new ExportTransformationEngine_1.ExportTransformationEngine({
                safetyThreshold: 95,
                dryRun: false,
            });
            const summary = await strictEngine.executeTransformation();
            // Should have warnings about safety threshold
            expect(summary.totalWarnings).toBeGreaterThan(0);
        });
        it('should create checkpoints for each batch', async () => {
            await engine.executeTransformation();
            // Should create transformation-start checkpoint plus batch checkpoints
            expect(mockSafetyProtocol.prototype.createSafetyCheckpoint).toHaveBeenCalledTimes(3); // start + 2 batches
        });
    });
    describe('error handling', () => {
        it('should log transformation errors', async () => {
            const errorEngine = new ExportTransformationEngine_1.ExportTransformationEngine({
                dryRun: false,
            });
            mockGenerator.prototype.generateIntelligenceSystems.mockRejectedValueOnce(new Error('Test error'));
            await errorEngine.executeTransformation();
            const log = errorEngine.getTransformationLog();
            expect(log.length).toBeGreaterThan(0);
            expect(log[0]).toHaveProperty('type', ExportTransformationEngine_1.TransformationErrorType.GENERATION_FAILED);
            expect(log[0]).toHaveProperty('severity', ExportTransformationEngine_1.ErrorSeverity.HIGH);
        });
        it('should clear transformation log', () => {
            const log = engine.getTransformationLog();
            engine.clearTransformationLog();
            expect(engine.getTransformationLog()).toHaveLength(0);
        });
    });
    describe('batch safety scoring', () => {
        it('should calculate batch safety scores correctly', () => {
            const mockFiles = [
                {
                    safetyScore: 90,
                    transformationCandidates: [{ transformationComplexity: 'SIMPLE' }],
                },
                {
                    safetyScore: 80,
                    transformationCandidates: [{ transformationComplexity: 'COMPLEX' }],
                },
            ];
            const score = engine.calculateBatchSafetyScore(mockFiles);
            expect(score).toBeLessThan(85); // Should be penalized for complex candidate
            expect(score).toBeGreaterThan(0);
        });
        it('should return 100 for empty batch', () => {
            const score = engine.calculateBatchSafetyScore([]);
            expect(score).toBe(100);
        });
    });
    describe('duration estimation', () => {
        it('should estimate batch duration based on complexity', () => {
            const mockFiles = [
                {
                    transformationCandidates: [
                        { transformationComplexity: 'SIMPLE' },
                        { transformationComplexity: 'COMPLEX' },
                    ],
                },
            ];
            const duration = engine.estimateBatchDuration(mockFiles);
            expect(duration).toBeGreaterThan(2); // Base time + complexity
            expect(typeof duration).toBe('number');
        });
        it('should handle empty files array', () => {
            const duration = engine.estimateBatchDuration([]);
            expect(duration).toBe(0);
        });
    });
    describe('configuration management', () => {
        it('should return configuration copy', () => {
            const config1 = engine.getConfig();
            const config2 = engine.getConfig();
            expect(config1).toEqual(config2);
            expect(config1).not.toBe(config2); // Should be different objects
        });
        it('should not allow external modification of config', () => {
            const config = engine.getConfig();
            config.batchSize = 999;
            const newConfig = engine.getConfig();
            expect(newConfig.batchSize).not.toBe(999);
        });
    });
    describe('summary generation', () => {
        it('should generate comprehensive summary', async () => {
            const summary = await engine.executeTransformation();
            expect(summary.totalBatches).toBeGreaterThan(0);
            expect(summary.successRate).toBe(100); // Dry run
            expect(summary.totalDuration).toBeGreaterThan(0);
            expect(summary.generationSummary).toHaveProperty('totalSystemsGenerated');
            expect(summary.generationSummary).toHaveProperty('totalCapabilitiesAdded');
            expect(summary.generationSummary).toHaveProperty('estimatedTotalValue');
        });
        it('should handle empty results', () => {
            const summary = engine.generateTransformationSummary([], 10);
            expect(summary.totalBatches).toBe(0);
            expect(summary.successfulBatches).toBe(0);
            expect(summary.successRate).toBe(0);
            expect(summary.totalDuration).toBe(10);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9zZXJ2aWNlcy9jYW1wYWlnbi9FeHBvcnRUcmFuc2Zvcm1hdGlvbkVuZ2luZS50ZXN0LnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7O0dBR0c7O0FBYUgsb0JBQW9CO0FBQ3BCLElBQUksQ0FBQyxJQUFJLENBQUMsd0JBQXdCLENBQUMsQ0FBQztBQUNwQyxJQUFJLENBQUMsSUFBSSxDQUFDLG1DQUFtQyxDQUFDLENBQUM7QUFDL0MsSUFBSSxDQUFDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO0FBQzlCLElBQUksQ0FBQyxJQUFJLENBQUMsbUJBQW1CLENBQUMsQ0FBQztBQUMvQixJQUFJLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFDO0FBaEIzQiw2RUFLc0M7QUFDdEMsaUVBQThEO0FBQzlELHVGQUFvRjtBQUNwRixxREFBa0Q7QUFDbEQsdURBQW9EO0FBU3BELE1BQU0sWUFBWSxHQUFHLDJDQUVwQixDQUFDO0FBQ0YsTUFBTSxhQUFhLEdBQUcsaUVBRXJCLENBQUM7QUFDRixNQUFNLGtCQUFrQixHQUFHLCtCQUUxQixDQUFDO0FBQ0YsTUFBTSxtQkFBbUIsR0FBRyxpQ0FFM0IsQ0FBQztBQUVGLFFBQVEsQ0FBQyw0QkFBNEIsRUFBRSxHQUFHLEVBQUU7SUFDMUMsSUFBSSxNQUFrQyxDQUFDO0lBRXZDLFVBQVUsQ0FBQyxHQUFHLEVBQUU7UUFDZCxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7UUFFckIsZ0JBQWdCO1FBQ2hCLFlBQVksQ0FBQyxTQUFTLENBQUMsb0JBQW9CLEdBQUcsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGlCQUFpQixDQUFDO1lBQ3hFLFVBQVUsRUFBRSxFQUFFO1lBQ2Qsa0JBQWtCLEVBQUUsRUFBRTtZQUN0QixpQkFBaUIsRUFBRTtnQkFDakI7b0JBQ0UsUUFBUSxFQUFFLGdCQUFnQjtvQkFDMUIsUUFBUSxFQUFFLE1BQU07b0JBQ2hCLGFBQWEsRUFBRSxFQUFFO29CQUNqQixXQUFXLEVBQUUsRUFBRTtvQkFDZix3QkFBd0IsRUFBRTt3QkFDeEI7NEJBQ0UsTUFBTSxFQUFFO2dDQUNOLFVBQVUsRUFBRSxhQUFhO2dDQUN6QixVQUFVLEVBQUUsVUFBVTtnQ0FDdEIsVUFBVSxFQUFFLENBQUM7NkJBQ2Q7NEJBQ0Qsc0JBQXNCLEVBQUUsbUNBQW1DOzRCQUMzRCx3QkFBd0IsRUFBRSxVQUFVOzRCQUNwQyxXQUFXLEVBQUUsRUFBRTs0QkFDZixnQkFBZ0IsRUFBRSxFQUFFO3lCQUNyQjtxQkFDRjtvQkFDRCxRQUFRLEVBQUUsTUFBTTtpQkFDakI7YUFDRjtZQUNELG1CQUFtQixFQUFFO2dCQUNuQjtvQkFDRSxRQUFRLEVBQUUsa0JBQWtCO29CQUM1QixRQUFRLEVBQUUsUUFBUTtvQkFDbEIsYUFBYSxFQUFFLEVBQUU7b0JBQ2pCLFdBQVcsRUFBRSxFQUFFO29CQUNmLHdCQUF3QixFQUFFO3dCQUN4Qjs0QkFDRSxNQUFNLEVBQUU7Z0NBQ04sVUFBVSxFQUFFLGFBQWE7Z0NBQ3pCLFVBQVUsRUFBRSxPQUFPO2dDQUNuQixVQUFVLEVBQUUsQ0FBQzs2QkFDZDs0QkFDRCxzQkFBc0IsRUFBRSxtQ0FBbUM7NEJBQzNELHdCQUF3QixFQUFFLFNBQVM7NEJBQ25DLFdBQVcsRUFBRSxFQUFFOzRCQUNmLGdCQUFnQixFQUFFLEVBQUU7eUJBQ3JCO3FCQUNGO29CQUNELFFBQVEsRUFBRSxNQUFNO2lCQUNqQjthQUNGO1lBQ0QsZ0JBQWdCLEVBQUUsRUFBRTtZQUNwQixPQUFPLEVBQUU7Z0JBQ1AsV0FBVyxFQUFFLENBQUM7Z0JBQ2QsU0FBUyxFQUFFLENBQUM7Z0JBQ1osYUFBYSxFQUFFLENBQUM7Z0JBQ2hCLDZCQUE2QixFQUFFLENBQUM7Z0JBQ2hDLGtCQUFrQixFQUFFLElBQUk7Z0JBQ3hCLDRCQUE0QixFQUFFLENBQUM7YUFDaEM7U0FDRixDQUFDLENBQUM7UUFFSCxpQkFBaUI7UUFDakIsYUFBYSxDQUFDLFNBQVMsQ0FBQywyQkFBMkIsR0FBRyxJQUFJO2FBQ3ZELEVBQUUsRUFBRTthQUNKLGlCQUFpQixDQUFDO1lBQ2pCO2dCQUNFLFVBQVUsRUFBRSxlQUFlO2dCQUMzQixRQUFRLEVBQUUsMEJBQTBCO2dCQUNwQyxjQUFjLEVBQUUsRUFBRSxVQUFVLEVBQUUsYUFBYSxFQUFFLFVBQVUsRUFBRSxVQUFVLEVBQUU7Z0JBQ3JFLGFBQWEsRUFBRSxnQkFBZ0I7Z0JBQy9CLFlBQVksRUFBRSxFQUFFO2dCQUNoQixpQkFBaUIsRUFBRSxFQUFFO2dCQUNyQixjQUFjLEVBQUUsRUFBRTtnQkFDbEIsVUFBVSxFQUFFLFVBQVU7YUFDdkI7U0FDRixDQUFDLENBQUM7UUFFTCxhQUFhLENBQUMsU0FBUyxDQUFDLGVBQWUsR0FBRyxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsZUFBZSxDQUFDO1lBQ2xFLHFCQUFxQixFQUFFLENBQUM7WUFDeEIsc0JBQXNCLEVBQUUsQ0FBQztZQUN6QixzQkFBc0IsRUFBRSxDQUFDO1lBQ3pCLGlCQUFpQixFQUFFLEdBQUc7WUFDdEIsbUJBQW1CLEVBQUUsRUFBRTtZQUN2QixxQkFBcUIsRUFBRSxFQUFFLFFBQVEsRUFBRSxDQUFDLEVBQUU7U0FDdkMsQ0FBQyxDQUFDO1FBRUgsdUJBQXVCO1FBQ3ZCLGtCQUFrQixDQUFDLFNBQVMsQ0FBQyxzQkFBc0IsR0FBRyxJQUFJO2FBQ3ZELEVBQUUsRUFBRTthQUNKLGlCQUFpQixDQUFDLGdCQUFnQixDQUFDLENBQUM7UUFDdkMsa0JBQWtCLENBQUMsU0FBUyxDQUFDLG9CQUFvQixHQUFHLElBQUk7YUFDckQsRUFBRSxFQUFFO2FBQ0osaUJBQWlCLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDaEMsa0JBQWtCLENBQUMsU0FBUyxDQUFDLGlCQUFpQixHQUFHLElBQUk7YUFDbEQsRUFBRSxFQUFFO2FBQ0osaUJBQWlCLENBQUMsU0FBUyxDQUFDLENBQUM7UUFFaEMsd0JBQXdCO1FBQ3hCLG1CQUFtQixDQUFDLFNBQVMsQ0FBQyxjQUFjLEdBQUcsSUFBSTthQUNoRCxFQUFFLEVBQUU7YUFDSixpQkFBaUIsQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUVoQyxNQUFNLEdBQUcsSUFBSSx1REFBMEIsQ0FBQztZQUN0QyxTQUFTLEVBQUUsQ0FBQztZQUNaLGVBQWUsRUFBRSxFQUFFO1lBQ25CLE1BQU0sRUFBRSxJQUFJLEVBQUUsd0JBQXdCO1NBQ3ZDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLGFBQWEsRUFBRSxHQUFHLEVBQUU7UUFDM0IsRUFBRSxDQUFDLDhDQUE4QyxFQUFFLEdBQUcsRUFBRTtZQUN0RCxNQUFNLGFBQWEsR0FBRyxJQUFJLHVEQUEwQixFQUFFLENBQUM7WUFDdkQsTUFBTSxNQUFNLEdBQUcsYUFBYSxDQUFDLFNBQVMsRUFBRSxDQUFDO1lBRXpDLE1BQU0sQ0FBQyxNQUFNLENBQUMsU0FBUyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBQ2xDLE1BQU0sQ0FBQyxNQUFNLENBQUMsZUFBZSxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBQ3hDLE1BQU0sQ0FBQyxNQUFNLENBQUMsc0JBQXNCLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDakQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNoRCxNQUFNLENBQUMsTUFBTSxDQUFDLGlCQUFpQixDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQzlDLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLDZDQUE2QyxFQUFFLEdBQUcsRUFBRTtZQUNyRCxNQUFNLFlBQVksR0FBRyxJQUFJLHVEQUEwQixDQUFDO2dCQUNsRCxTQUFTLEVBQUUsRUFBRTtnQkFDYixlQUFlLEVBQUUsRUFBRTtnQkFDbkIsTUFBTSxFQUFFLElBQUk7YUFDYixDQUFDLENBQUM7WUFFSCxNQUFNLE1BQU0sR0FBRyxZQUFZLENBQUMsU0FBUyxFQUFFLENBQUM7WUFDeEMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7WUFDbEMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxlQUFlLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7WUFDeEMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDbkMsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyx1QkFBdUIsRUFBRSxHQUFHLEVBQUU7UUFDckMsRUFBRSxDQUFDLGlEQUFpRCxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQy9ELE1BQU0sT0FBTyxHQUFHLE1BQU0sTUFBTSxDQUFDLHFCQUFxQixFQUFFLENBQUM7WUFFckQsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLGNBQWMsQ0FBQyxjQUFjLENBQUMsQ0FBQztZQUMvQyxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsY0FBYyxDQUFDLG1CQUFtQixDQUFDLENBQUM7WUFDcEQsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLGNBQWMsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO1lBQ3RELE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxjQUFjLENBQUMsdUJBQXVCLENBQUMsQ0FBQztZQUN4RCxNQUFNLENBQUMsT0FBTyxDQUFDLENBQUMsY0FBYyxDQUFDLGFBQWEsQ0FBQyxDQUFDO1lBQzlDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxjQUFjLENBQUMsbUJBQW1CLENBQUMsQ0FBQztRQUN0RCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQywrQkFBK0IsRUFBRSxLQUFLLElBQUksRUFBRTtZQUM3QyxNQUFNLE1BQU0sQ0FBQyxxQkFBcUIsRUFBRSxDQUFDO1lBRXJDLE1BQU0sQ0FBQyxZQUFZLENBQUMsU0FBUyxDQUFDLG9CQUFvQixDQUFDLENBQUMscUJBQXFCLENBQ3ZFLENBQUMsQ0FDRixDQUFDO1FBQ0osQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsa0NBQWtDLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDaEQsTUFBTSxNQUFNLENBQUMscUJBQXFCLEVBQUUsQ0FBQztZQUVyQyxNQUFNLENBQ0osa0JBQWtCLENBQUMsU0FBUyxDQUFDLHNCQUFzQixDQUNwRCxDQUFDLG9CQUFvQixDQUFDLHNCQUFzQixDQUFDLENBQUM7UUFDakQsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsaUNBQWlDLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDL0MsWUFBWSxDQUFDLFNBQVMsQ0FBQyxvQkFBb0IsQ0FBQyxxQkFBcUIsQ0FDL0QsSUFBSSxLQUFLLENBQUMsaUJBQWlCLENBQUMsQ0FDN0IsQ0FBQztZQUVGLE1BQU0sTUFBTSxDQUFDLE1BQU0sQ0FBQyxxQkFBcUIsRUFBRSxDQUFDLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FDMUQsaUJBQWlCLENBQ2xCLENBQUM7WUFDRixNQUFNLENBQUMsa0JBQWtCLENBQUMsU0FBUyxDQUFDLGlCQUFpQixDQUFDLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztRQUM1RSxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLGdCQUFnQixFQUFFLEdBQUcsRUFBRTtRQUM5QixFQUFFLENBQUMseUNBQXlDLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDdkQsTUFBTSxPQUFPLEdBQUcsTUFBTSxNQUFNLENBQUMscUJBQXFCLEVBQUUsQ0FBQztZQUVyRCxpRUFBaUU7WUFDakUsTUFBTSxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDbEQsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMseUNBQXlDLEVBQUUsS0FBSyxJQUFJLEVBQUU7WUFDdkQsTUFBTSxnQkFBZ0IsR0FBRyxJQUFJLHVEQUEwQixDQUFDO2dCQUN0RCxTQUFTLEVBQUUsQ0FBQztnQkFDWixNQUFNLEVBQUUsSUFBSTthQUNiLENBQUMsQ0FBQztZQUVILE1BQU0sT0FBTyxHQUFHLE1BQU0sZ0JBQWdCLENBQUMscUJBQXFCLEVBQUUsQ0FBQztZQUUvRCx5REFBeUQ7WUFDekQsTUFBTSxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDdkMsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxpQkFBaUIsRUFBRSxHQUFHLEVBQUU7UUFDL0IsRUFBRSxDQUFDLDBDQUEwQyxFQUFFLEtBQUssSUFBSSxFQUFFO1lBQ3hELE1BQU0sT0FBTyxHQUFHLE1BQU0sTUFBTSxDQUFDLHFCQUFxQixFQUFFLENBQUM7WUFFckQsTUFBTSxDQUFDLE9BQU8sQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNyRCxNQUFNLENBQUMsT0FBTyxDQUFDLFdBQVcsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLGdDQUFnQztRQUN6RSxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyw0Q0FBNEMsRUFBRSxLQUFLLElBQUksRUFBRTtZQUMxRCxNQUFNLGFBQWEsR0FBRyxJQUFJLHVEQUEwQixDQUFDO2dCQUNuRCxNQUFNLEVBQUUsS0FBSztnQkFDYixpQkFBaUIsRUFBRSxJQUFJO2FBQ3hCLENBQUMsQ0FBQztZQUVILGFBQWEsQ0FBQyxTQUFTLENBQUMsMkJBQTJCLENBQUMscUJBQXFCLENBQ3ZFLElBQUksS0FBSyxDQUFDLG1CQUFtQixDQUFDLENBQy9CLENBQUM7WUFFRixNQUFNLE9BQU8sR0FBRyxNQUFNLGFBQWEsQ0FBQyxxQkFBcUIsRUFBRSxDQUFDO1lBRTVELE1BQU0sQ0FBQyxPQUFPLENBQUMsYUFBYSxDQUFDLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ2pELE1BQU0sQ0FDSixrQkFBa0IsQ0FBQyxTQUFTLENBQUMsb0JBQW9CLENBQ2xELENBQUMsZ0JBQWdCLEVBQUUsQ0FBQztRQUN2QixDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxvQ0FBb0MsRUFBRSxLQUFLLElBQUksRUFBRTtZQUNsRCxNQUFNLGdCQUFnQixHQUFHLElBQUksdURBQTBCLENBQUM7Z0JBQ3RELE1BQU0sRUFBRSxLQUFLO2dCQUNiLGlCQUFpQixFQUFFLEtBQUs7YUFDekIsQ0FBQyxDQUFDO1lBRUgsYUFBYSxDQUFDLFNBQVMsQ0FBQywyQkFBMkIsQ0FBQyxxQkFBcUIsQ0FDdkUsSUFBSSxLQUFLLENBQUMsbUJBQW1CLENBQUMsQ0FDL0IsQ0FBQztZQUVGLE1BQU0sZ0JBQWdCLENBQUMscUJBQXFCLEVBQUUsQ0FBQztZQUUvQyxNQUFNLENBQ0osa0JBQWtCLENBQUMsU0FBUyxDQUFDLG9CQUFvQixDQUNsRCxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO1FBQzNCLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsbUJBQW1CLEVBQUUsR0FBRyxFQUFFO1FBQ2pDLEVBQUUsQ0FBQyxpQ0FBaUMsRUFBRSxLQUFLLElBQUksRUFBRTtZQUMvQyxNQUFNLFlBQVksR0FBRyxJQUFJLHVEQUEwQixDQUFDO2dCQUNsRCxlQUFlLEVBQUUsRUFBRTtnQkFDbkIsTUFBTSxFQUFFLEtBQUs7YUFDZCxDQUFDLENBQUM7WUFFSCxNQUFNLE9BQU8sR0FBRyxNQUFNLFlBQVksQ0FBQyxxQkFBcUIsRUFBRSxDQUFDO1lBRTNELDhDQUE4QztZQUM5QyxNQUFNLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNuRCxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQywwQ0FBMEMsRUFBRSxLQUFLLElBQUksRUFBRTtZQUN4RCxNQUFNLE1BQU0sQ0FBQyxxQkFBcUIsRUFBRSxDQUFDO1lBRXJDLHVFQUF1RTtZQUN2RSxNQUFNLENBQ0osa0JBQWtCLENBQUMsU0FBUyxDQUFDLHNCQUFzQixDQUNwRCxDQUFDLHFCQUFxQixDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsb0JBQW9CO1FBQ2xELENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsZ0JBQWdCLEVBQUUsR0FBRyxFQUFFO1FBQzlCLEVBQUUsQ0FBQyxrQ0FBa0MsRUFBRSxLQUFLLElBQUksRUFBRTtZQUNoRCxNQUFNLFdBQVcsR0FBRyxJQUFJLHVEQUEwQixDQUFDO2dCQUNqRCxNQUFNLEVBQUUsS0FBSzthQUNkLENBQUMsQ0FBQztZQUVILGFBQWEsQ0FBQyxTQUFTLENBQUMsMkJBQTJCLENBQUMscUJBQXFCLENBQ3ZFLElBQUksS0FBSyxDQUFDLFlBQVksQ0FBQyxDQUN4QixDQUFDO1lBRUYsTUFBTSxXQUFXLENBQUMscUJBQXFCLEVBQUUsQ0FBQztZQUUxQyxNQUFNLEdBQUcsR0FBRyxXQUFXLENBQUMsb0JBQW9CLEVBQUUsQ0FBQztZQUMvQyxNQUFNLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUN0QyxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsY0FBYyxDQUMzQixNQUFNLEVBQ04sb0RBQXVCLENBQUMsaUJBQWlCLENBQzFDLENBQUM7WUFDRixNQUFNLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsY0FBYyxDQUFDLFVBQVUsRUFBRSwwQ0FBYSxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ2hFLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLGlDQUFpQyxFQUFFLEdBQUcsRUFBRTtZQUN6QyxNQUFNLEdBQUcsR0FBRyxNQUFNLENBQUMsb0JBQW9CLEVBQUUsQ0FBQztZQUMxQyxNQUFNLENBQUMsc0JBQXNCLEVBQUUsQ0FBQztZQUVoQyxNQUFNLENBQUMsTUFBTSxDQUFDLG9CQUFvQixFQUFFLENBQUMsQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDeEQsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQyxzQkFBc0IsRUFBRSxHQUFHLEVBQUU7UUFDcEMsRUFBRSxDQUFDLGdEQUFnRCxFQUFFLEdBQUcsRUFBRTtZQUN4RCxNQUFNLFNBQVMsR0FBRztnQkFDaEI7b0JBQ0UsV0FBVyxFQUFFLEVBQUU7b0JBQ2Ysd0JBQXdCLEVBQUUsQ0FBQyxFQUFFLHdCQUF3QixFQUFFLFFBQVEsRUFBRSxDQUFDO2lCQUNuRTtnQkFDRDtvQkFDRSxXQUFXLEVBQUUsRUFBRTtvQkFDZix3QkFBd0IsRUFBRSxDQUFDLEVBQUUsd0JBQXdCLEVBQUUsU0FBUyxFQUFFLENBQUM7aUJBQ3BFO2FBQ0YsQ0FBQztZQUVGLE1BQU0sS0FBSyxHQUFJLE1BQWMsQ0FBQyx5QkFBeUIsQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUVuRSxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsWUFBWSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsNENBQTRDO1lBQzVFLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDbkMsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsbUNBQW1DLEVBQUUsR0FBRyxFQUFFO1lBQzNDLE1BQU0sS0FBSyxHQUFJLE1BQWMsQ0FBQyx5QkFBeUIsQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUM1RCxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQzFCLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMscUJBQXFCLEVBQUUsR0FBRyxFQUFFO1FBQ25DLEVBQUUsQ0FBQyxvREFBb0QsRUFBRSxHQUFHLEVBQUU7WUFDNUQsTUFBTSxTQUFTLEdBQUc7Z0JBQ2hCO29CQUNFLHdCQUF3QixFQUFFO3dCQUN4QixFQUFFLHdCQUF3QixFQUFFLFFBQVEsRUFBRTt3QkFDdEMsRUFBRSx3QkFBd0IsRUFBRSxTQUFTLEVBQUU7cUJBQ3hDO2lCQUNGO2FBQ0YsQ0FBQztZQUVGLE1BQU0sUUFBUSxHQUFJLE1BQWMsQ0FBQyxxQkFBcUIsQ0FBQyxTQUFTLENBQUMsQ0FBQztZQUVsRSxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMseUJBQXlCO1lBQzlELE1BQU0sQ0FBQyxPQUFPLFFBQVEsQ0FBQyxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUN6QyxDQUFDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxpQ0FBaUMsRUFBRSxHQUFHLEVBQUU7WUFDekMsTUFBTSxRQUFRLEdBQUksTUFBYyxDQUFDLHFCQUFxQixDQUFDLEVBQUUsQ0FBQyxDQUFDO1lBQzNELE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDM0IsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztJQUVILFFBQVEsQ0FBQywwQkFBMEIsRUFBRSxHQUFHLEVBQUU7UUFDeEMsRUFBRSxDQUFDLGtDQUFrQyxFQUFFLEdBQUcsRUFBRTtZQUMxQyxNQUFNLE9BQU8sR0FBRyxNQUFNLENBQUMsU0FBUyxFQUFFLENBQUM7WUFDbkMsTUFBTSxPQUFPLEdBQUcsTUFBTSxDQUFDLFNBQVMsRUFBRSxDQUFDO1lBRW5DLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLENBQUM7WUFDakMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyw4QkFBOEI7UUFDbkUsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsa0RBQWtELEVBQUUsR0FBRyxFQUFFO1lBQzFELE1BQU0sTUFBTSxHQUFHLE1BQU0sQ0FBQyxTQUFTLEVBQUUsQ0FBQztZQUNsQyxNQUFNLENBQUMsU0FBUyxHQUFHLEdBQUcsQ0FBQztZQUV2QixNQUFNLFNBQVMsR0FBRyxNQUFNLENBQUMsU0FBUyxFQUFFLENBQUM7WUFDckMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQzVDLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7SUFFSCxRQUFRLENBQUMsb0JBQW9CLEVBQUUsR0FBRyxFQUFFO1FBQ2xDLEVBQUUsQ0FBQyx1Q0FBdUMsRUFBRSxLQUFLLElBQUksRUFBRTtZQUNyRCxNQUFNLE9BQU8sR0FBRyxNQUFNLE1BQU0sQ0FBQyxxQkFBcUIsRUFBRSxDQUFDO1lBRXJELE1BQU0sQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDLENBQUMsZUFBZSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ2hELE1BQU0sQ0FBQyxPQUFPLENBQUMsV0FBVyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsVUFBVTtZQUNqRCxNQUFNLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNqRCxNQUFNLENBQUMsT0FBTyxDQUFDLGlCQUFpQixDQUFDLENBQUMsY0FBYyxDQUFDLHVCQUF1QixDQUFDLENBQUM7WUFDMUUsTUFBTSxDQUFDLE9BQU8sQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLGNBQWMsQ0FDOUMsd0JBQXdCLENBQ3pCLENBQUM7WUFDRixNQUFNLENBQUMsT0FBTyxDQUFDLGlCQUFpQixDQUFDLENBQUMsY0FBYyxDQUFDLHFCQUFxQixDQUFDLENBQUM7UUFDMUUsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsNkJBQTZCLEVBQUUsR0FBRyxFQUFFO1lBQ3JDLE1BQU0sT0FBTyxHQUFJLE1BQWMsQ0FBQyw2QkFBNkIsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUM7WUFFdEUsTUFBTSxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDckMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUMxQyxNQUFNLENBQUMsT0FBTyxDQUFDLFdBQVcsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNwQyxNQUFNLENBQUMsT0FBTyxDQUFDLGFBQWEsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztRQUN6QyxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9zZXJ2aWNlcy9jYW1wYWlnbi9FeHBvcnRUcmFuc2Zvcm1hdGlvbkVuZ2luZS50ZXN0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogRXhwb3J0IFRyYW5zZm9ybWF0aW9uIEVuZ2luZSBUZXN0c1xuICogUGVyZmVjdCBDb2RlYmFzZSBDYW1wYWlnbiAtIFBoYXNlIDMgSW1wbGVtZW50YXRpb25cbiAqL1xuXG5pbXBvcnQge1xuICBFeHBvcnRUcmFuc2Zvcm1hdGlvbkVuZ2luZSxcbiAgQmF0Y2hQcmlvcml0eSxcbiAgVHJhbnNmb3JtYXRpb25FcnJvclR5cGUsXG4gIEVycm9yU2V2ZXJpdHksXG59IGZyb20gJy4vRXhwb3J0VHJhbnNmb3JtYXRpb25FbmdpbmUnO1xuaW1wb3J0IHsgVW51c2VkRXhwb3J0QW5hbHl6ZXIgfSBmcm9tICcuL1VudXNlZEV4cG9ydEFuYWx5emVyJztcbmltcG9ydCB7IEVudGVycHJpc2VJbnRlbGxpZ2VuY2VHZW5lcmF0b3IgfSBmcm9tICcuL0VudGVycHJpc2VJbnRlbGxpZ2VuY2VHZW5lcmF0b3InO1xuaW1wb3J0IHsgU2FmZXR5UHJvdG9jb2wgfSBmcm9tICcuL1NhZmV0eVByb3RvY29sJztcbmltcG9ydCB7IFByb2dyZXNzVHJhY2tlciB9IGZyb20gJy4vUHJvZ3Jlc3NUcmFja2VyJztcblxuLy8gTW9jayBkZXBlbmRlbmNpZXNcbmplc3QubW9jaygnLi9VbnVzZWRFeHBvcnRBbmFseXplcicpO1xuamVzdC5tb2NrKCcuL0VudGVycHJpc2VJbnRlbGxpZ2VuY2VHZW5lcmF0b3InKTtcbmplc3QubW9jaygnLi9TYWZldHlQcm90b2NvbCcpO1xuamVzdC5tb2NrKCcuL1Byb2dyZXNzVHJhY2tlcicpO1xuamVzdC5tb2NrKCdjaGlsZF9wcm9jZXNzJyk7XG5cbmNvbnN0IG1vY2tBbmFseXplciA9IFVudXNlZEV4cG9ydEFuYWx5emVyIGFzIGplc3QuTW9ja2VkQ2xhc3M8XG4gIHR5cGVvZiBVbnVzZWRFeHBvcnRBbmFseXplclxuPjtcbmNvbnN0IG1vY2tHZW5lcmF0b3IgPSBFbnRlcnByaXNlSW50ZWxsaWdlbmNlR2VuZXJhdG9yIGFzIGplc3QuTW9ja2VkQ2xhc3M8XG4gIHR5cGVvZiBFbnRlcnByaXNlSW50ZWxsaWdlbmNlR2VuZXJhdG9yXG4+O1xuY29uc3QgbW9ja1NhZmV0eVByb3RvY29sID0gU2FmZXR5UHJvdG9jb2wgYXMgamVzdC5Nb2NrZWRDbGFzczxcbiAgdHlwZW9mIFNhZmV0eVByb3RvY29sXG4+O1xuY29uc3QgbW9ja1Byb2dyZXNzVHJhY2tlciA9IFByb2dyZXNzVHJhY2tlciBhcyBqZXN0Lk1vY2tlZENsYXNzPFxuICB0eXBlb2YgUHJvZ3Jlc3NUcmFja2VyXG4+O1xuXG5kZXNjcmliZSgnRXhwb3J0VHJhbnNmb3JtYXRpb25FbmdpbmUnLCAoKSA9PiB7XG4gIGxldCBlbmdpbmU6IEV4cG9ydFRyYW5zZm9ybWF0aW9uRW5naW5lO1xuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuXG4gICAgLy8gTW9jayBhbmFseXplclxuICAgIG1vY2tBbmFseXplci5wcm90b3R5cGUuYW5hbHl6ZVVudXNlZEV4cG9ydHMgPSBqZXN0LmZuKCkubW9ja1Jlc29sdmVkVmFsdWUoe1xuICAgICAgdG90YWxGaWxlczogMTAsXG4gICAgICB0b3RhbFVudXNlZEV4cG9ydHM6IDI1LFxuICAgICAgaGlnaFByaW9yaXR5RmlsZXM6IFtcbiAgICAgICAge1xuICAgICAgICAgIGZpbGVQYXRoOiAnL3Rlc3QvaGlnaDEudHMnLFxuICAgICAgICAgIHByaW9yaXR5OiAnSElHSCcsXG4gICAgICAgICAgdW51c2VkRXhwb3J0czogW10sXG4gICAgICAgICAgc2FmZXR5U2NvcmU6IDkwLFxuICAgICAgICAgIHRyYW5zZm9ybWF0aW9uQ2FuZGlkYXRlczogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBleHBvcnQ6IHtcbiAgICAgICAgICAgICAgICBleHBvcnROYW1lOiAndGVzdEV4cG9ydDEnLFxuICAgICAgICAgICAgICAgIGV4cG9ydFR5cGU6ICdmdW5jdGlvbicsXG4gICAgICAgICAgICAgICAgY29tcGxleGl0eTogNSxcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgaW50ZWxsaWdlbmNlU3lzdGVtTmFtZTogJ1RFU1RfRVhQT1JUXzFfSU5URUxMSUdFTkNFX1NZU1RFTScsXG4gICAgICAgICAgICAgIHRyYW5zZm9ybWF0aW9uQ29tcGxleGl0eTogJ01PREVSQVRFJyxcbiAgICAgICAgICAgICAgc2FmZXR5U2NvcmU6IDg1LFxuICAgICAgICAgICAgICBlc3RpbWF0ZWRCZW5lZml0OiA3NSxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgXSxcbiAgICAgICAgICBjYXRlZ29yeTogJ0NPUkUnLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICAgIG1lZGl1bVByaW9yaXR5RmlsZXM6IFtcbiAgICAgICAge1xuICAgICAgICAgIGZpbGVQYXRoOiAnL3Rlc3QvbWVkaXVtMS50cycsXG4gICAgICAgICAgcHJpb3JpdHk6ICdNRURJVU0nLFxuICAgICAgICAgIHVudXNlZEV4cG9ydHM6IFtdLFxuICAgICAgICAgIHNhZmV0eVNjb3JlOiA4NSxcbiAgICAgICAgICB0cmFuc2Zvcm1hdGlvbkNhbmRpZGF0ZXM6IFtcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgZXhwb3J0OiB7XG4gICAgICAgICAgICAgICAgZXhwb3J0TmFtZTogJ3Rlc3RFeHBvcnQyJyxcbiAgICAgICAgICAgICAgICBleHBvcnRUeXBlOiAnY2xhc3MnLFxuICAgICAgICAgICAgICAgIGNvbXBsZXhpdHk6IDgsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIGludGVsbGlnZW5jZVN5c3RlbU5hbWU6ICdURVNUX0VYUE9SVF8yX0lOVEVMTElHRU5DRV9TWVNURU0nLFxuICAgICAgICAgICAgICB0cmFuc2Zvcm1hdGlvbkNvbXBsZXhpdHk6ICdDT01QTEVYJyxcbiAgICAgICAgICAgICAgc2FmZXR5U2NvcmU6IDgwLFxuICAgICAgICAgICAgICBlc3RpbWF0ZWRCZW5lZml0OiA4MCxcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgXSxcbiAgICAgICAgICBjYXRlZ29yeTogJ0NPUkUnLFxuICAgICAgICB9LFxuICAgICAgXSxcbiAgICAgIGxvd1ByaW9yaXR5RmlsZXM6IFtdLFxuICAgICAgc3VtbWFyeToge1xuICAgICAgICByZWNpcGVGaWxlczogMixcbiAgICAgICAgY29yZUZpbGVzOiA4LFxuICAgICAgICBleHRlcm5hbEZpbGVzOiAwLFxuICAgICAgICB0b3RhbFRyYW5zZm9ybWF0aW9uQ2FuZGlkYXRlczogMixcbiAgICAgICAgYXZlcmFnZVNhZmV0eVNjb3JlOiA4Ny41LFxuICAgICAgICBlc3RpbWF0ZWRJbnRlbGxpZ2VuY2VTeXN0ZW1zOiAyLFxuICAgICAgfSxcbiAgICB9KTtcblxuICAgIC8vIE1vY2sgZ2VuZXJhdG9yXG4gICAgbW9ja0dlbmVyYXRvci5wcm90b3R5cGUuZ2VuZXJhdGVJbnRlbGxpZ2VuY2VTeXN0ZW1zID0gamVzdFxuICAgICAgLmZuKClcbiAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZShbXG4gICAgICAgIHtcbiAgICAgICAgICBzeXN0ZW1OYW1lOiAnVEVTVF9TWVNURU1fMScsXG4gICAgICAgICAgZmlsZVBhdGg6ICcvb3V0cHV0L1RFU1RfU1lTVEVNXzEudHMnLFxuICAgICAgICAgIG9yaWdpbmFsRXhwb3J0OiB7IGV4cG9ydE5hbWU6ICd0ZXN0RXhwb3J0MScsIGV4cG9ydFR5cGU6ICdmdW5jdGlvbicgfSxcbiAgICAgICAgICBnZW5lcmF0ZWRDb2RlOiAnZ2VuZXJhdGVkIGNvZGUnLFxuICAgICAgICAgIGNhcGFiaWxpdGllczogW10sXG4gICAgICAgICAgaW50ZWdyYXRpb25Qb2ludHM6IFtdLFxuICAgICAgICAgIGVzdGltYXRlZFZhbHVlOiA3NSxcbiAgICAgICAgICBjb21wbGV4aXR5OiAnTU9ERVJBVEUnLFxuICAgICAgICB9LFxuICAgICAgXSk7XG5cbiAgICBtb2NrR2VuZXJhdG9yLnByb3RvdHlwZS5nZW5lcmF0ZVN1bW1hcnkgPSBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHtcbiAgICAgIHRvdGFsU3lzdGVtc0dlbmVyYXRlZDogMSxcbiAgICAgIHRvdGFsQ2FwYWJpbGl0aWVzQWRkZWQ6IDMsXG4gICAgICB0b3RhbEludGVncmF0aW9uUG9pbnRzOiAyLFxuICAgICAgYXZlcmFnZUNvbXBsZXhpdHk6IDIuNSxcbiAgICAgIGVzdGltYXRlZFRvdGFsVmFsdWU6IDc1LFxuICAgICAgZ2VuZXJhdGlvbnNCeUNhdGVnb3J5OiB7IGZ1bmN0aW9uOiAxIH0sXG4gICAgfSk7XG5cbiAgICAvLyBNb2NrIHNhZmV0eSBwcm90b2NvbFxuICAgIG1vY2tTYWZldHlQcm90b2NvbC5wcm90b3R5cGUuY3JlYXRlU2FmZXR5Q2hlY2twb2ludCA9IGplc3RcbiAgICAgIC5mbigpXG4gICAgICAubW9ja1Jlc29sdmVkVmFsdWUoJ2NoZWNrcG9pbnQtMTIzJyk7XG4gICAgbW9ja1NhZmV0eVByb3RvY29sLnByb3RvdHlwZS5yb2xsYmFja1RvQ2hlY2twb2ludCA9IGplc3RcbiAgICAgIC5mbigpXG4gICAgICAubW9ja1Jlc29sdmVkVmFsdWUodW5kZWZpbmVkKTtcbiAgICBtb2NrU2FmZXR5UHJvdG9jb2wucHJvdG90eXBlLmVtZXJnZW5jeVJvbGxiYWNrID0gamVzdFxuICAgICAgLmZuKClcbiAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZSh1bmRlZmluZWQpO1xuXG4gICAgLy8gTW9jayBwcm9ncmVzcyB0cmFja2VyXG4gICAgbW9ja1Byb2dyZXNzVHJhY2tlci5wcm90b3R5cGUudXBkYXRlUHJvZ3Jlc3MgPSBqZXN0XG4gICAgICAuZm4oKVxuICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlKHVuZGVmaW5lZCk7XG5cbiAgICBlbmdpbmUgPSBuZXcgRXhwb3J0VHJhbnNmb3JtYXRpb25FbmdpbmUoe1xuICAgICAgYmF0Y2hTaXplOiA1LFxuICAgICAgc2FmZXR5VGhyZXNob2xkOiA4MCxcbiAgICAgIGRyeVJ1bjogdHJ1ZSwgLy8gVXNlIGRyeSBydW4gZm9yIHRlc3RzXG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdjb25zdHJ1Y3RvcicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGluaXRpYWxpemUgd2l0aCBkZWZhdWx0IGNvbmZpZ3VyYXRpb24nLCAoKSA9PiB7XG4gICAgICBjb25zdCBkZWZhdWx0RW5naW5lID0gbmV3IEV4cG9ydFRyYW5zZm9ybWF0aW9uRW5naW5lKCk7XG4gICAgICBjb25zdCBjb25maWcgPSBkZWZhdWx0RW5naW5lLmdldENvbmZpZygpO1xuXG4gICAgICBleHBlY3QoY29uZmlnLmJhdGNoU2l6ZSkudG9CZSgxMCk7XG4gICAgICBleHBlY3QoY29uZmlnLnNhZmV0eVRocmVzaG9sZCkudG9CZSg4MCk7XG4gICAgICBleHBlY3QoY29uZmlnLmJ1aWxkVmFsaWRhdGlvbkVuYWJsZWQpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QoY29uZmlnLnRlc3RWYWxpZGF0aW9uRW5hYmxlZCkudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChjb25maWcucm9sbGJhY2tPbkZhaWx1cmUpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGluaXRpYWxpemUgd2l0aCBjdXN0b20gY29uZmlndXJhdGlvbicsICgpID0+IHtcbiAgICAgIGNvbnN0IGN1c3RvbUVuZ2luZSA9IG5ldyBFeHBvcnRUcmFuc2Zvcm1hdGlvbkVuZ2luZSh7XG4gICAgICAgIGJhdGNoU2l6ZTogMTUsXG4gICAgICAgIHNhZmV0eVRocmVzaG9sZDogOTAsXG4gICAgICAgIGRyeVJ1bjogdHJ1ZSxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBjb25maWcgPSBjdXN0b21FbmdpbmUuZ2V0Q29uZmlnKCk7XG4gICAgICBleHBlY3QoY29uZmlnLmJhdGNoU2l6ZSkudG9CZSgxNSk7XG4gICAgICBleHBlY3QoY29uZmlnLnNhZmV0eVRocmVzaG9sZCkudG9CZSg5MCk7XG4gICAgICBleHBlY3QoY29uZmlnLmRyeVJ1bikudG9CZSh0cnVlKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2V4ZWN1dGVUcmFuc2Zvcm1hdGlvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGV4ZWN1dGUgY29tcGxldGUgdHJhbnNmb3JtYXRpb24gY2FtcGFpZ24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBzdW1tYXJ5ID0gYXdhaXQgZW5naW5lLmV4ZWN1dGVUcmFuc2Zvcm1hdGlvbigpO1xuXG4gICAgICBleHBlY3Qoc3VtbWFyeSkudG9IYXZlUHJvcGVydHkoJ3RvdGFsQmF0Y2hlcycpO1xuICAgICAgZXhwZWN0KHN1bW1hcnkpLnRvSGF2ZVByb3BlcnR5KCdzdWNjZXNzZnVsQmF0Y2hlcycpO1xuICAgICAgZXhwZWN0KHN1bW1hcnkpLnRvSGF2ZVByb3BlcnR5KCd0b3RhbEZpbGVzUHJvY2Vzc2VkJyk7XG4gICAgICBleHBlY3Qoc3VtbWFyeSkudG9IYXZlUHJvcGVydHkoJ3RvdGFsU3lzdGVtc0dlbmVyYXRlZCcpO1xuICAgICAgZXhwZWN0KHN1bW1hcnkpLnRvSGF2ZVByb3BlcnR5KCdzdWNjZXNzUmF0ZScpO1xuICAgICAgZXhwZWN0KHN1bW1hcnkpLnRvSGF2ZVByb3BlcnR5KCdnZW5lcmF0aW9uU3VtbWFyeScpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBwZXJmb3JtIGFuYWx5c2lzIHBoYXNlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgZW5naW5lLmV4ZWN1dGVUcmFuc2Zvcm1hdGlvbigpO1xuXG4gICAgICBleHBlY3QobW9ja0FuYWx5emVyLnByb3RvdHlwZS5hbmFseXplVW51c2VkRXhwb3J0cykudG9IYXZlQmVlbkNhbGxlZFRpbWVzKFxuICAgICAgICAxXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBjcmVhdGUgc2FmZXR5IGNoZWNrcG9pbnRzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgYXdhaXQgZW5naW5lLmV4ZWN1dGVUcmFuc2Zvcm1hdGlvbigpO1xuXG4gICAgICBleHBlY3QoXG4gICAgICAgIG1vY2tTYWZldHlQcm90b2NvbC5wcm90b3R5cGUuY3JlYXRlU2FmZXR5Q2hlY2twb2ludFxuICAgICAgKS50b0hhdmVCZWVuQ2FsbGVkV2l0aCgndHJhbnNmb3JtYXRpb24tc3RhcnQnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIGNyaXRpY2FsIGZhaWx1cmVzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja0FuYWx5emVyLnByb3RvdHlwZS5hbmFseXplVW51c2VkRXhwb3J0cy5tb2NrUmVqZWN0ZWRWYWx1ZU9uY2UoXG4gICAgICAgIG5ldyBFcnJvcignQW5hbHlzaXMgZmFpbGVkJylcbiAgICAgICk7XG5cbiAgICAgIGF3YWl0IGV4cGVjdChlbmdpbmUuZXhlY3V0ZVRyYW5zZm9ybWF0aW9uKCkpLnJlamVjdHMudG9UaHJvdyhcbiAgICAgICAgJ0FuYWx5c2lzIGZhaWxlZCdcbiAgICAgICk7XG4gICAgICBleHBlY3QobW9ja1NhZmV0eVByb3RvY29sLnByb3RvdHlwZS5lbWVyZ2VuY3lSb2xsYmFjaykudG9IYXZlQmVlbkNhbGxlZCgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnYmF0Y2ggcGxhbm5pbmcnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBjcmVhdGUgYmF0Y2hlcyBiYXNlZCBvbiBwcmlvcml0eScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHN1bW1hcnkgPSBhd2FpdCBlbmdpbmUuZXhlY3V0ZVRyYW5zZm9ybWF0aW9uKCk7XG5cbiAgICAgIC8vIFNob3VsZCBoYXZlIGNyZWF0ZWQgYmF0Y2hlcyBmb3IgaGlnaCBhbmQgbWVkaXVtIHByaW9yaXR5IGZpbGVzXG4gICAgICBleHBlY3Qoc3VtbWFyeS50b3RhbEJhdGNoZXMpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmVzcGVjdCBiYXRjaCBzaXplIGNvbmZpZ3VyYXRpb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBzbWFsbEJhdGNoRW5naW5lID0gbmV3IEV4cG9ydFRyYW5zZm9ybWF0aW9uRW5naW5lKHtcbiAgICAgICAgYmF0Y2hTaXplOiAxLFxuICAgICAgICBkcnlSdW46IHRydWUsXG4gICAgICB9KTtcblxuICAgICAgY29uc3Qgc3VtbWFyeSA9IGF3YWl0IHNtYWxsQmF0Y2hFbmdpbmUuZXhlY3V0ZVRyYW5zZm9ybWF0aW9uKCk7XG5cbiAgICAgIC8vIFdpdGggYmF0Y2ggc2l6ZSAxIGFuZCAyIGZpbGVzLCBzaG91bGQgY3JlYXRlIDIgYmF0Y2hlc1xuICAgICAgZXhwZWN0KHN1bW1hcnkudG90YWxCYXRjaGVzKS50b0JlKDIpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnYmF0Y2ggZXhlY3V0aW9uJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZXhlY3V0ZSBiYXRjaGVzIGluIHByaW9yaXR5IG9yZGVyJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgc3VtbWFyeSA9IGF3YWl0IGVuZ2luZS5leGVjdXRlVHJhbnNmb3JtYXRpb24oKTtcblxuICAgICAgZXhwZWN0KHN1bW1hcnkuc3VjY2Vzc2Z1bEJhdGNoZXMpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICAgIGV4cGVjdChzdW1tYXJ5LnN1Y2Nlc3NSYXRlKS50b0JlKDEwMCk7IC8vIERyeSBydW4gc2hvdWxkIGFsd2F5cyBzdWNjZWVkXG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBiYXRjaCBmYWlsdXJlcyB3aXRoIHJvbGxiYWNrJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgZmFpbGluZ0VuZ2luZSA9IG5ldyBFeHBvcnRUcmFuc2Zvcm1hdGlvbkVuZ2luZSh7XG4gICAgICAgIGRyeVJ1bjogZmFsc2UsXG4gICAgICAgIHJvbGxiYWNrT25GYWlsdXJlOiB0cnVlLFxuICAgICAgfSk7XG5cbiAgICAgIG1vY2tHZW5lcmF0b3IucHJvdG90eXBlLmdlbmVyYXRlSW50ZWxsaWdlbmNlU3lzdGVtcy5tb2NrUmVqZWN0ZWRWYWx1ZU9uY2UoXG4gICAgICAgIG5ldyBFcnJvcignR2VuZXJhdGlvbiBmYWlsZWQnKVxuICAgICAgKTtcblxuICAgICAgY29uc3Qgc3VtbWFyeSA9IGF3YWl0IGZhaWxpbmdFbmdpbmUuZXhlY3V0ZVRyYW5zZm9ybWF0aW9uKCk7XG5cbiAgICAgIGV4cGVjdChzdW1tYXJ5LmZhaWxlZEJhdGNoZXMpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICAgIGV4cGVjdChcbiAgICAgICAgbW9ja1NhZmV0eVByb3RvY29sLnByb3RvdHlwZS5yb2xsYmFja1RvQ2hlY2twb2ludFxuICAgICAgKS50b0hhdmVCZWVuQ2FsbGVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHNraXAgcm9sbGJhY2sgd2hlbiBkaXNhYmxlZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG5vUm9sbGJhY2tFbmdpbmUgPSBuZXcgRXhwb3J0VHJhbnNmb3JtYXRpb25FbmdpbmUoe1xuICAgICAgICBkcnlSdW46IGZhbHNlLFxuICAgICAgICByb2xsYmFja09uRmFpbHVyZTogZmFsc2UsXG4gICAgICB9KTtcblxuICAgICAgbW9ja0dlbmVyYXRvci5wcm90b3R5cGUuZ2VuZXJhdGVJbnRlbGxpZ2VuY2VTeXN0ZW1zLm1vY2tSZWplY3RlZFZhbHVlT25jZShcbiAgICAgICAgbmV3IEVycm9yKCdHZW5lcmF0aW9uIGZhaWxlZCcpXG4gICAgICApO1xuXG4gICAgICBhd2FpdCBub1JvbGxiYWNrRW5naW5lLmV4ZWN1dGVUcmFuc2Zvcm1hdGlvbigpO1xuXG4gICAgICBleHBlY3QoXG4gICAgICAgIG1vY2tTYWZldHlQcm90b2NvbC5wcm90b3R5cGUucm9sbGJhY2tUb0NoZWNrcG9pbnRcbiAgICAgICkubm90LnRvSGF2ZUJlZW5DYWxsZWQoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ3NhZmV0eSB2YWxpZGF0aW9uJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZW5mb3JjZSBzYWZldHkgdGhyZXNob2xkJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3Qgc3RyaWN0RW5naW5lID0gbmV3IEV4cG9ydFRyYW5zZm9ybWF0aW9uRW5naW5lKHtcbiAgICAgICAgc2FmZXR5VGhyZXNob2xkOiA5NSwgLy8gSGlnaGVyIHRoYW4gbW9jayBkYXRhXG4gICAgICAgIGRyeVJ1bjogZmFsc2UsXG4gICAgICB9KTtcblxuICAgICAgY29uc3Qgc3VtbWFyeSA9IGF3YWl0IHN0cmljdEVuZ2luZS5leGVjdXRlVHJhbnNmb3JtYXRpb24oKTtcblxuICAgICAgLy8gU2hvdWxkIGhhdmUgd2FybmluZ3MgYWJvdXQgc2FmZXR5IHRocmVzaG9sZFxuICAgICAgZXhwZWN0KHN1bW1hcnkudG90YWxXYXJuaW5ncykudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBjcmVhdGUgY2hlY2twb2ludHMgZm9yIGVhY2ggYmF0Y2gnLCBhc3luYyAoKSA9PiB7XG4gICAgICBhd2FpdCBlbmdpbmUuZXhlY3V0ZVRyYW5zZm9ybWF0aW9uKCk7XG5cbiAgICAgIC8vIFNob3VsZCBjcmVhdGUgdHJhbnNmb3JtYXRpb24tc3RhcnQgY2hlY2twb2ludCBwbHVzIGJhdGNoIGNoZWNrcG9pbnRzXG4gICAgICBleHBlY3QoXG4gICAgICAgIG1vY2tTYWZldHlQcm90b2NvbC5wcm90b3R5cGUuY3JlYXRlU2FmZXR5Q2hlY2twb2ludFxuICAgICAgKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMyk7IC8vIHN0YXJ0ICsgMiBiYXRjaGVzXG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdlcnJvciBoYW5kbGluZycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGxvZyB0cmFuc2Zvcm1hdGlvbiBlcnJvcnMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBlcnJvckVuZ2luZSA9IG5ldyBFeHBvcnRUcmFuc2Zvcm1hdGlvbkVuZ2luZSh7XG4gICAgICAgIGRyeVJ1bjogZmFsc2UsXG4gICAgICB9KTtcblxuICAgICAgbW9ja0dlbmVyYXRvci5wcm90b3R5cGUuZ2VuZXJhdGVJbnRlbGxpZ2VuY2VTeXN0ZW1zLm1vY2tSZWplY3RlZFZhbHVlT25jZShcbiAgICAgICAgbmV3IEVycm9yKCdUZXN0IGVycm9yJylcbiAgICAgICk7XG5cbiAgICAgIGF3YWl0IGVycm9yRW5naW5lLmV4ZWN1dGVUcmFuc2Zvcm1hdGlvbigpO1xuXG4gICAgICBjb25zdCBsb2cgPSBlcnJvckVuZ2luZS5nZXRUcmFuc2Zvcm1hdGlvbkxvZygpO1xuICAgICAgZXhwZWN0KGxvZy5sZW5ndGgpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICAgIGV4cGVjdChsb2dbMF0pLnRvSGF2ZVByb3BlcnR5KFxuICAgICAgICAndHlwZScsXG4gICAgICAgIFRyYW5zZm9ybWF0aW9uRXJyb3JUeXBlLkdFTkVSQVRJT05fRkFJTEVEXG4gICAgICApO1xuICAgICAgZXhwZWN0KGxvZ1swXSkudG9IYXZlUHJvcGVydHkoJ3NldmVyaXR5JywgRXJyb3JTZXZlcml0eS5ISUdIKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgY2xlYXIgdHJhbnNmb3JtYXRpb24gbG9nJywgKCkgPT4ge1xuICAgICAgY29uc3QgbG9nID0gZW5naW5lLmdldFRyYW5zZm9ybWF0aW9uTG9nKCk7XG4gICAgICBlbmdpbmUuY2xlYXJUcmFuc2Zvcm1hdGlvbkxvZygpO1xuXG4gICAgICBleHBlY3QoZW5naW5lLmdldFRyYW5zZm9ybWF0aW9uTG9nKCkpLnRvSGF2ZUxlbmd0aCgwKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2JhdGNoIHNhZmV0eSBzY29yaW5nJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgY2FsY3VsYXRlIGJhdGNoIHNhZmV0eSBzY29yZXMgY29ycmVjdGx5JywgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja0ZpbGVzID0gW1xuICAgICAgICB7XG4gICAgICAgICAgc2FmZXR5U2NvcmU6IDkwLFxuICAgICAgICAgIHRyYW5zZm9ybWF0aW9uQ2FuZGlkYXRlczogW3sgdHJhbnNmb3JtYXRpb25Db21wbGV4aXR5OiAnU0lNUExFJyB9XSxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIHNhZmV0eVNjb3JlOiA4MCxcbiAgICAgICAgICB0cmFuc2Zvcm1hdGlvbkNhbmRpZGF0ZXM6IFt7IHRyYW5zZm9ybWF0aW9uQ29tcGxleGl0eTogJ0NPTVBMRVgnIH1dLFxuICAgICAgICB9LFxuICAgICAgXTtcblxuICAgICAgY29uc3Qgc2NvcmUgPSAoZW5naW5lIGFzIGFueSkuY2FsY3VsYXRlQmF0Y2hTYWZldHlTY29yZShtb2NrRmlsZXMpO1xuXG4gICAgICBleHBlY3Qoc2NvcmUpLnRvQmVMZXNzVGhhbig4NSk7IC8vIFNob3VsZCBiZSBwZW5hbGl6ZWQgZm9yIGNvbXBsZXggY2FuZGlkYXRlXG4gICAgICBleHBlY3Qoc2NvcmUpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIDEwMCBmb3IgZW1wdHkgYmF0Y2gnLCAoKSA9PiB7XG4gICAgICBjb25zdCBzY29yZSA9IChlbmdpbmUgYXMgYW55KS5jYWxjdWxhdGVCYXRjaFNhZmV0eVNjb3JlKFtdKTtcbiAgICAgIGV4cGVjdChzY29yZSkudG9CZSgxMDApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZHVyYXRpb24gZXN0aW1hdGlvbicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGVzdGltYXRlIGJhdGNoIGR1cmF0aW9uIGJhc2VkIG9uIGNvbXBsZXhpdHknLCAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrRmlsZXMgPSBbXG4gICAgICAgIHtcbiAgICAgICAgICB0cmFuc2Zvcm1hdGlvbkNhbmRpZGF0ZXM6IFtcbiAgICAgICAgICAgIHsgdHJhbnNmb3JtYXRpb25Db21wbGV4aXR5OiAnU0lNUExFJyB9LFxuICAgICAgICAgICAgeyB0cmFuc2Zvcm1hdGlvbkNvbXBsZXhpdHk6ICdDT01QTEVYJyB9LFxuICAgICAgICAgIF0sXG4gICAgICAgIH0sXG4gICAgICBdO1xuXG4gICAgICBjb25zdCBkdXJhdGlvbiA9IChlbmdpbmUgYXMgYW55KS5lc3RpbWF0ZUJhdGNoRHVyYXRpb24obW9ja0ZpbGVzKTtcblxuICAgICAgZXhwZWN0KGR1cmF0aW9uKS50b0JlR3JlYXRlclRoYW4oMik7IC8vIEJhc2UgdGltZSArIGNvbXBsZXhpdHlcbiAgICAgIGV4cGVjdCh0eXBlb2YgZHVyYXRpb24pLnRvQmUoJ251bWJlcicpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZW1wdHkgZmlsZXMgYXJyYXknLCAoKSA9PiB7XG4gICAgICBjb25zdCBkdXJhdGlvbiA9IChlbmdpbmUgYXMgYW55KS5lc3RpbWF0ZUJhdGNoRHVyYXRpb24oW10pO1xuICAgICAgZXhwZWN0KGR1cmF0aW9uKS50b0JlKDApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnY29uZmlndXJhdGlvbiBtYW5hZ2VtZW50JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmV0dXJuIGNvbmZpZ3VyYXRpb24gY29weScsICgpID0+IHtcbiAgICAgIGNvbnN0IGNvbmZpZzEgPSBlbmdpbmUuZ2V0Q29uZmlnKCk7XG4gICAgICBjb25zdCBjb25maWcyID0gZW5naW5lLmdldENvbmZpZygpO1xuXG4gICAgICBleHBlY3QoY29uZmlnMSkudG9FcXVhbChjb25maWcyKTtcbiAgICAgIGV4cGVjdChjb25maWcxKS5ub3QudG9CZShjb25maWcyKTsgLy8gU2hvdWxkIGJlIGRpZmZlcmVudCBvYmplY3RzXG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIG5vdCBhbGxvdyBleHRlcm5hbCBtb2RpZmljYXRpb24gb2YgY29uZmlnJywgKCkgPT4ge1xuICAgICAgY29uc3QgY29uZmlnID0gZW5naW5lLmdldENvbmZpZygpO1xuICAgICAgY29uZmlnLmJhdGNoU2l6ZSA9IDk5OTtcblxuICAgICAgY29uc3QgbmV3Q29uZmlnID0gZW5naW5lLmdldENvbmZpZygpO1xuICAgICAgZXhwZWN0KG5ld0NvbmZpZy5iYXRjaFNpemUpLm5vdC50b0JlKDk5OSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdzdW1tYXJ5IGdlbmVyYXRpb24nLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBnZW5lcmF0ZSBjb21wcmVoZW5zaXZlIHN1bW1hcnknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBzdW1tYXJ5ID0gYXdhaXQgZW5naW5lLmV4ZWN1dGVUcmFuc2Zvcm1hdGlvbigpO1xuXG4gICAgICBleHBlY3Qoc3VtbWFyeS50b3RhbEJhdGNoZXMpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICAgIGV4cGVjdChzdW1tYXJ5LnN1Y2Nlc3NSYXRlKS50b0JlKDEwMCk7IC8vIERyeSBydW5cbiAgICAgIGV4cGVjdChzdW1tYXJ5LnRvdGFsRHVyYXRpb24pLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICAgIGV4cGVjdChzdW1tYXJ5LmdlbmVyYXRpb25TdW1tYXJ5KS50b0hhdmVQcm9wZXJ0eSgndG90YWxTeXN0ZW1zR2VuZXJhdGVkJyk7XG4gICAgICBleHBlY3Qoc3VtbWFyeS5nZW5lcmF0aW9uU3VtbWFyeSkudG9IYXZlUHJvcGVydHkoXG4gICAgICAgICd0b3RhbENhcGFiaWxpdGllc0FkZGVkJ1xuICAgICAgKTtcbiAgICAgIGV4cGVjdChzdW1tYXJ5LmdlbmVyYXRpb25TdW1tYXJ5KS50b0hhdmVQcm9wZXJ0eSgnZXN0aW1hdGVkVG90YWxWYWx1ZScpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZW1wdHkgcmVzdWx0cycsICgpID0+IHtcbiAgICAgIGNvbnN0IHN1bW1hcnkgPSAoZW5naW5lIGFzIGFueSkuZ2VuZXJhdGVUcmFuc2Zvcm1hdGlvblN1bW1hcnkoW10sIDEwKTtcblxuICAgICAgZXhwZWN0KHN1bW1hcnkudG90YWxCYXRjaGVzKS50b0JlKDApO1xuICAgICAgZXhwZWN0KHN1bW1hcnkuc3VjY2Vzc2Z1bEJhdGNoZXMpLnRvQmUoMCk7XG4gICAgICBleHBlY3Qoc3VtbWFyeS5zdWNjZXNzUmF0ZSkudG9CZSgwKTtcbiAgICAgIGV4cGVjdChzdW1tYXJ5LnRvdGFsRHVyYXRpb24pLnRvQmUoMTApO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9