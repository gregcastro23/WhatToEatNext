96d89e453e717facb0a505e830ee1b42
"use strict";
/**
 * ConsoleStatementRemovalSystem.test.ts
 *
 * Test suite for ConsoleStatementRemovalSystem
 * Validates selective removal and critical statement preservation
 */
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
// Mock dependencies
jest.mock('child_process');
jest.mock('fs');
const ConsoleStatementRemovalSystem_1 = require("./ConsoleStatementRemovalSystem");
const child_process_1 = require("child_process");
const fs = __importStar(require("fs"));
const mockExecSync = child_process_1.execSync;
const mockFs = fs;
describe('ConsoleStatementRemovalSystem', () => {
    let removalSystem;
    beforeEach(() => {
        removalSystem = new ConsoleStatementRemovalSystem_1.ConsoleStatementRemovalSystem();
        jest.clearAllMocks();
        // Mock fs.existsSync to return true for script path
        mockFs.existsSync.mockReturnValue(true);
    });
    describe('constructor', () => {
        it('should initialize with default configuration', () => {
            const system = new ConsoleStatementRemovalSystem_1.ConsoleStatementRemovalSystem();
            expect(system).toBeDefined();
        });
        it('should accept custom configuration', () => {
            const config = {
                maxFiles: 15,
                dryRun: false,
                preserveDebugCritical: false,
                selectiveRemoval: false
            };
            const system = new ConsoleStatementRemovalSystem_1.ConsoleStatementRemovalSystem(config);
            expect(system).toBeDefined();
        });
    });
    describe('analyzeFileConsoleStatements', () => {
        it('should detect console statements in file content', () => {
            const content = `
console.log('debug message');
console.error('error message');
console.warn('warning message');
console.info('info message');
console.debug('debug message');
      `;
            const statements = removalSystem.analyzeFileConsoleStatements('/test/file.ts', content);
            expect(statements).toHaveLength(5);
            expect(statements[0].type).toBe('log');
            expect(statements[1].type).toBe('error');
            expect(statements[2].type).toBe('warn');
            expect(statements[3].type).toBe('info');
            expect(statements[4].type).toBe('debug');
        });
        it('should extract correct line and column information', () => {
            const content = `
const test = 'value';
console.log('test message');
const another = 'value';
      `;
            const statements = removalSystem.analyzeFileConsoleStatements('/test/file.ts', content);
            expect(statements).toHaveLength(1);
            expect(statements[0].line).toBe(3);
            expect(statements[0].content).toBe("console.log('test message')");
        });
    });
    describe('isConsoleStatementCritical', () => {
        it('should mark error statements as critical', () => {
            const isCritical = removalSystem.isConsoleStatementCritical('/test/file.ts', 'console.error("Something went wrong")', 'try { } catch (e) { console.error("Something went wrong"); }', 'error');
            expect(isCritical).toBe(true);
        });
        it('should mark statements in debug files as critical', () => {
            const isCritical = removalSystem.isConsoleStatementCritical('/test/debug.ts', 'console.log("Debug info")', 'console.log("Debug info");', 'log');
            expect(isCritical).toBe(true);
        });
        it('should mark statements in test files as critical', () => {
            const isCritical = removalSystem.isConsoleStatementCritical('/test/file.test.ts', 'console.log("Test output")', 'console.log("Test output");', 'log');
            expect(isCritical).toBe(true);
        });
        it('should mark statements with error handling context as critical', () => {
            const context = `
        try {
          doSomething();
        } catch (error) {
          console.log("Error occurred");
        }
      `;
            const isCritical = removalSystem.isConsoleStatementCritical('/test/file.ts', 'console.log("Error occurred")', context, 'log');
            expect(isCritical).toBe(true);
        });
        it('should mark statements with important patterns as critical', () => {
            const isCritical = removalSystem.isConsoleStatementCritical('/test/file.ts', 'console.log("API request failed")', 'console.log("API request failed");', 'log');
            expect(isCritical).toBe(true);
        });
        it('should mark warn statements in production code as critical', () => {
            const isCritical = removalSystem.isConsoleStatementCritical('/src/components/Component.ts', 'console.warn("Deprecated feature")', 'console.warn("Deprecated feature");', 'warn');
            expect(isCritical).toBe(true);
        });
        it('should not mark simple log statements as critical', () => {
            const isCritical = removalSystem.isConsoleStatementCritical('/src/components/Component.ts', 'console.log("Simple debug")', 'console.log("Simple debug");', 'log');
            expect(isCritical).toBe(false);
        });
    });
    describe('validatePreConditions', () => {
        it('should validate script exists', async () => {
            mockFs.existsSync.mockReturnValue(false);
            await expect(removalSystem.validatePreConditions()).rejects.toThrow('Console removal script not found');
        });
        it('should check git status when git stash is enabled', async () => {
            mockExecSync.mockReturnValue('');
            await expect(removalSystem.validatePreConditions()).resolves.not.toThrow();
            expect(mockExecSync).toHaveBeenCalledWith('git status --porcelain', { encoding: 'utf-8' });
        });
    });
    describe('createSafetyStash', () => {
        it('should create git stash with timestamp', async () => {
            mockExecSync.mockReturnValue('');
            const stashId = await removalSystem.createSafetyStash();
            expect(stashId).toContain('console-removal-');
            expect(mockExecSync).toHaveBeenCalledWith(expect.stringContaining('git stash push -m "console-removal-'), { encoding: 'utf-8' });
        });
        it('should handle git stash errors gracefully', async () => {
            mockExecSync.mockImplementation(() => {
                throw new Error('Git error');
            });
            const stashId = await removalSystem.createSafetyStash();
            expect(stashId).toBe('');
        });
    });
    describe('executeScript', () => {
        it('should execute script with correct arguments for dry run', async () => {
            const config = { dryRun: true, maxFiles: 10 };
            const system = new ConsoleStatementRemovalSystem_1.ConsoleStatementRemovalSystem(config);
            const mockAnalysis = [
                {
                    file: '/test/file.ts',
                    line: 1,
                    column: 1,
                    type: 'log',
                    content: 'console.log("test")',
                    context: 'console.log("test");',
                    isCritical: false,
                    shouldPreserve: false
                }
            ];
            mockExecSync.mockReturnValue('Files processed: 5\nTotal console statements fixed: 10');
            const result = await system.executeScript(mockAnalysis);
            expect(result.success).toBe(true);
            expect(result.filesProcessed).toBe(5);
            expect(result.consoleStatementsRemoved).toBe(10);
            expect(mockExecSync).toHaveBeenCalledWith(expect.stringContaining('--dry-run --max-files 10'), expect.any(Object));
        });
        it('should calculate preserved statements correctly', async () => {
            const mockAnalysis = [
                {
                    file: '/test/file.ts',
                    line: 1,
                    column: 1,
                    type: 'error',
                    content: 'console.error("critical")',
                    context: 'console.error("critical");',
                    isCritical: true,
                    shouldPreserve: true
                },
                {
                    file: '/test/file.ts',
                    line: 2,
                    column: 1,
                    type: 'log',
                    content: 'console.log("normal")',
                    context: 'console.log("normal");',
                    isCritical: false,
                    shouldPreserve: false
                }
            ];
            mockExecSync.mockReturnValue('Files processed: 1\nTotal console statements fixed: 1');
            const result = await removalSystem.executeScript(mockAnalysis);
            expect(result.consoleStatementsPreserved).toBe(1);
            expect(result.preservedFiles).toContain('/test/file.ts');
        });
        it('should handle script execution errors', async () => {
            mockExecSync.mockImplementation(() => {
                throw new Error('Script execution failed');
            });
            const result = await removalSystem.executeScript([]);
            expect(result.success).toBe(false);
            expect(result.errors).toContain(expect.stringContaining('Script execution failed'));
        });
        it('should parse warnings and errors from output', async () => {
            const output = `
        Files processed: 5
        ⚠️ Warning: Some statements preserved
        ❌ Error: Failed to process file
        Total console statements fixed: 10
      `;
            mockExecSync.mockReturnValue(output);
            const result = await removalSystem.executeScript([]);
            expect(result.warnings).toHaveLength(1);
            expect(result.errors).toHaveLength(1);
            expect(result.warnings[0]).toContain('Warning: Some statements preserved');
            expect(result.errors[0]).toContain('Error: Failed to process file');
        });
    });
    describe('generateReport', () => {
        it('should generate single execution report', () => {
            const result = {
                success: true,
                filesProcessed: 10,
                consoleStatementsRemoved: 25,
                consoleStatementsPreserved: 5,
                buildTime: 2000,
                errors: [],
                warnings: ['Test warning'],
                preservedFiles: ['/test/debug.ts']
            };
            const report = removalSystem.generateReport(result);
            expect(report).toContain('Console Statement Removal Report');
            expect(report).toContain('Success: ✅');
            expect(report).toContain('Files Processed: 10');
            expect(report).toContain('Console Statements Removed: 25');
            expect(report).toContain('Console Statements Preserved: 5');
            expect(report).toContain('Build Time: 2000ms');
            expect(report).toContain('/test/debug.ts');
            expect(report).toContain('Test warning');
        });
        it('should generate failure report', () => {
            const result = {
                success: false,
                filesProcessed: 0,
                consoleStatementsRemoved: 0,
                consoleStatementsPreserved: 0,
                buildTime: 0,
                errors: ['Test error'],
                warnings: [],
                preservedFiles: []
            };
            const report = removalSystem.generateReport(result);
            expect(report).toContain('Success: ❌');
            expect(report).toContain('Test error');
            expect(report).toContain('Console removal failed');
        });
    });
    describe('estimateFilesWithConsoleStatements', () => {
        it('should return default estimate when analyzer fails', async () => {
            // Mock the dynamic import to fail
            jest.doMock('./LintingWarningAnalyzer.js', () => {
                throw new Error('Module not found');
            });
            const estimate = await removalSystem.estimateFilesWithConsoleStatements();
            expect(estimate).toBe(50);
        });
    });
    describe('saveMetrics', () => {
        it('should save metrics to file', async () => {
            const result = {
                success: true,
                filesProcessed: 5,
                consoleStatementsRemoved: 10,
                consoleStatementsPreserved: 2,
                buildTime: 1500,
                errors: [],
                warnings: [],
                preservedFiles: ['/test/debug.ts']
            };
            mockFs.writeFileSync.mockImplementation(() => { });
            await removalSystem.saveMetrics(result);
            expect(mockFs.writeFileSync).toHaveBeenCalledWith(expect.stringContaining('.console-removal-metrics.json'), expect.stringContaining('"success":true'));
        });
        it('should handle save metrics errors gracefully', async () => {
            const result = {
                success: true,
                filesProcessed: 5,
                consoleStatementsRemoved: 10,
                consoleStatementsPreserved: 2,
                buildTime: 1500,
                errors: [],
                warnings: [],
                preservedFiles: []
            };
            mockFs.writeFileSync.mockImplementation(() => {
                throw new Error('Write failed');
            });
            await expect(removalSystem.saveMetrics(result)).resolves.not.toThrow();
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9zZXJ2aWNlcy9jYW1wYWlnbi9Db25zb2xlU3RhdGVtZW50UmVtb3ZhbFN5c3RlbS50ZXN0LnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7R0FLRzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQU1ILG9CQUFvQjtBQUNwQixJQUFJLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFDO0FBQzNCLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7QUFOaEIsbUZBQTZKO0FBQzdKLGlEQUF5QztBQUN6Qyx1Q0FBeUI7QUFNekIsTUFBTSxZQUFZLEdBQUcsd0JBQWdELENBQUM7QUFDdEUsTUFBTSxNQUFNLEdBQUcsRUFBNEIsQ0FBQztBQUU1QyxRQUFRLENBQUMsK0JBQStCLEVBQUUsR0FBRyxFQUFFO0lBQzdDLElBQUksYUFBNEMsQ0FBQztJQUVqRCxVQUFVLENBQUMsR0FBRyxFQUFFO1FBQ2QsYUFBYSxHQUFHLElBQUksNkRBQTZCLEVBQUUsQ0FBQztRQUNwRCxJQUFJLENBQUMsYUFBYSxFQUFFLENBQUM7UUFFckIsb0RBQW9EO1FBQ3BELE1BQU0sQ0FBQyxVQUFVLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQzFDLENBQUMsQ0FBQyxDQUFDO0lBRUgsUUFBUSxDQUFDLGFBQWEsRUFBRSxHQUFHLEVBQUU7UUFDM0IsRUFBRSxDQUFDLDhDQUE4QyxFQUFFLEdBQUcsRUFBRTtZQUN0RCxNQUFNLE1BQU0sR0FBRyxJQUFJLDZEQUE2QixFQUFFLENBQUM7WUFDbkQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1FBQy9CLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLG9DQUFvQyxFQUFFLEdBQUcsRUFBRTtZQUM1QyxNQUFNLE1BQU0sR0FBa0M7Z0JBQzVDLFFBQVEsRUFBRSxFQUFFO2dCQUNaLE1BQU0sRUFBRSxLQUFLO2dCQUNiLHFCQUFxQixFQUFF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Z0JBQ1YsUUFBUSxFQUFFLEVBQUU7Z0JBQ1osY0FBYyxFQUFFLEVBQUU7YUFDbkIsQ0FBQztZQUVGLE1BQU0sQ0FBQyxhQUFhLENBQUMsa0JBQWtCLENBQUMsR0FBRyxFQUFFO2dCQUMzQyxNQUFNLElBQUksS0FBSyxDQUFDLGNBQWMsQ0FBQyxDQUFDO1lBQ2xDLENBQUMsQ0FBQyxDQUFDO1lBRUgsTUFBTSxNQUFNLENBQUUsYUFBcUIsQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxRQUFRLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBQ2xGLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvR3JlZ0Nhc3Ryby9EZXNrdG9wL1doYXRUb0VhdE5leHQvc3JjL3NlcnZpY2VzL2NhbXBhaWduL0NvbnNvbGVTdGF0ZW1lbnRSZW1vdmFsU3lzdGVtLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb25zb2xlU3RhdGVtZW50UmVtb3ZhbFN5c3RlbS50ZXN0LnRzXG4gKiBcbiAqIFRlc3Qgc3VpdGUgZm9yIENvbnNvbGVTdGF0ZW1lbnRSZW1vdmFsU3lzdGVtXG4gKiBWYWxpZGF0ZXMgc2VsZWN0aXZlIHJlbW92YWwgYW5kIGNyaXRpY2FsIHN0YXRlbWVudCBwcmVzZXJ2YXRpb25cbiAqL1xuXG5pbXBvcnQgeyBDb25zb2xlU3RhdGVtZW50UmVtb3ZhbFN5c3RlbSwgdHlwZSBDb25zb2xlUmVtb3ZhbENvbmZpZywgdHlwZSBDb25zb2xlUmVtb3ZhbFJlc3VsdCwgdHlwZSBDb25zb2xlU3RhdGVtZW50IH0gZnJvbSAnLi9Db25zb2xlU3RhdGVtZW50UmVtb3ZhbFN5c3RlbSc7XG5pbXBvcnQgeyBleGVjU3luYyB9IGZyb20gJ2NoaWxkX3Byb2Nlc3MnO1xuaW1wb3J0ICogYXMgZnMgZnJvbSAnZnMnO1xuXG4vLyBNb2NrIGRlcGVuZGVuY2llc1xuamVzdC5tb2NrKCdjaGlsZF9wcm9jZXNzJyk7XG5qZXN0Lm1vY2soJ2ZzJyk7XG5cbmNvbnN0IG1vY2tFeGVjU3luYyA9IGV4ZWNTeW5jIGFzIGplc3QuTW9ja2VkRnVuY3Rpb248dHlwZW9mIGV4ZWNTeW5jPjtcbmNvbnN0IG1vY2tGcyA9IGZzIGFzIGplc3QuTW9ja2VkPHR5cGVvZiBmcz47XG5cbmRlc2NyaWJlKCdDb25zb2xlU3RhdGVtZW50UmVtb3ZhbFN5c3RlbScsICgpID0+IHtcbiAgbGV0IHJlbW92YWxTeXN0ZW06IENvbnNvbGVTdGF0ZW1lbnRSZW1vdmFsU3lzdGVtO1xuICBcbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgcmVtb3ZhbFN5c3RlbSA9IG5ldyBDb25zb2xlU3RhdGVtZW50UmVtb3ZhbFN5c3RlbSgpO1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICAgIFxuICAgIC8vIE1vY2sgZnMuZXhpc3RzU3luYyB0byByZXR1cm4gdHJ1ZSBmb3Igc2NyaXB0IHBhdGhcbiAgICBtb2NrRnMuZXhpc3RzU3luYy5tb2NrUmV0dXJuVmFsdWUodHJ1ZSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdjb25zdHJ1Y3RvcicsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGluaXRpYWxpemUgd2l0aCBkZWZhdWx0IGNvbmZpZ3VyYXRpb24nLCAoKSA9PiB7XG4gICAgICBjb25zdCBzeXN0ZW0gPSBuZXcgQ29uc29sZVN0YXRlbWVudFJlbW92YWxTeXN0ZW0oKTtcbiAgICAgIGV4cGVjdChzeXN0ZW0pLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGFjY2VwdCBjdXN0b20gY29uZmlndXJhdGlvbicsICgpID0+IHtcbiAgICAgIGNvbnN0IGNvbmZpZzogUGFydGlhbDxDb25zb2xlUmVtb3ZhbENvbmZpZz4gPSB7XG4gICAgICAgIG1heEZpbGVzOiAxNSxcbiAgICAgICAgZHJ5UnVuOiBmYWxzZSxcbiAgICAgICAgcHJlc2VydmVEZWJ1Z0NyaXRpY2FsOiBmYWxzZSxcbiAgICAgICAgc2VsZWN0aXZlUmVtb3ZhbDogZmFsc2VcbiAgICAgIH07XG4gICAgICBcbiAgICAgIGNvbnN0IHN5c3RlbSA9IG5ldyBDb25zb2xlU3RhdGVtZW50UmVtb3ZhbFN5c3RlbShjb25maWcpO1xuICAgICAgZXhwZWN0KHN5c3RlbSkudG9CZURlZmluZWQoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2FuYWx5emVGaWxlQ29uc29sZVN0YXRlbWVudHMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBkZXRlY3QgY29uc29sZSBzdGF0ZW1lbnRzIGluIGZpbGUgY29udGVudCcsICgpID0+IHtcbiAgICAgIGNvbnN0IGNvbnRlbnQgPSBgXG5jb25zb2xlLmxvZygnZGVidWcgbWVzc2FnZScpO1xuY29uc29sZS5lcnJvcignZXJyb3IgbWVzc2FnZScpO1xuY29uc29sZS53YXJuKCd3YXJuaW5nIG1lc3NhZ2UnKTtcbmNvbnNvbGUuaW5mbygnaW5mbyBtZXNzYWdlJyk7XG5jb25zb2xlLmRlYnVnKCdkZWJ1ZyBtZXNzYWdlJyk7XG4gICAgICBgO1xuICAgICAgXG4gICAgICBjb25zdCBzdGF0ZW1lbnRzID0gKHJlbW92YWxTeXN0ZW0gYXMgYW55KS5hbmFseXplRmlsZUNvbnNvbGVTdGF0ZW1lbnRzKCcvdGVzdC9maWxlLnRzJywgY29udGVudCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChzdGF0ZW1lbnRzKS50b0hhdmVMZW5ndGgoNSk7XG4gICAgICBleHBlY3Qoc3RhdGVtZW50c1swXS50eXBlKS50b0JlKCdsb2cnKTtcbiAgICAgIGV4cGVjdChzdGF0ZW1lbnRzWzFdLnR5cGUpLnRvQmUoJ2Vycm9yJyk7XG4gICAgICBleHBlY3Qoc3RhdGVtZW50c1syXS50eXBlKS50b0JlKCd3YXJuJyk7XG4gICAgICBleHBlY3Qoc3RhdGVtZW50c1szXS50eXBlKS50b0JlKCdpbmZvJyk7XG4gICAgICBleHBlY3Qoc3RhdGVtZW50c1s0XS50eXBlKS50b0JlKCdkZWJ1ZycpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBleHRyYWN0IGNvcnJlY3QgbGluZSBhbmQgY29sdW1uIGluZm9ybWF0aW9uJywgKCkgPT4ge1xuICAgICAgY29uc3QgY29udGVudCA9IGBcbmNvbnN0IHRlc3QgPSAndmFsdWUnO1xuY29uc29sZS5sb2coJ3Rlc3QgbWVzc2FnZScpO1xuY29uc3QgYW5vdGhlciA9ICd2YWx1ZSc7XG4gICAgICBgO1xuICAgICAgXG4gICAgICBjb25zdCBzdGF0ZW1lbnRzID0gKHJlbW92YWxTeXN0ZW0gYXMgYW55KS5hbmFseXplRmlsZUNvbnNvbGVTdGF0ZW1lbnRzKCcvdGVzdC9maWxlLnRzJywgY29udGVudCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChzdGF0ZW1lbnRzKS50b0hhdmVMZW5ndGgoMSk7XG4gICAgICBleHBlY3Qoc3RhdGVtZW50c1swXS5saW5lKS50b0JlKDMpO1xuICAgICAgZXhwZWN0KHN0YXRlbWVudHNbMF0uY29udGVudCkudG9CZShcImNvbnNvbGUubG9nKCd0ZXN0IG1lc3NhZ2UnKVwiKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2lzQ29uc29sZVN0YXRlbWVudENyaXRpY2FsJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgbWFyayBlcnJvciBzdGF0ZW1lbnRzIGFzIGNyaXRpY2FsJywgKCkgPT4ge1xuICAgICAgY29uc3QgaXNDcml0aWNhbCA9IChyZW1vdmFsU3lzdGVtIGFzIGFueSkuaXNDb25zb2xlU3RhdGVtZW50Q3JpdGljYWwoXG4gICAgICAgICcvdGVzdC9maWxlLnRzJyxcbiAgICAgICAgJ2NvbnNvbGUuZXJyb3IoXCJTb21ldGhpbmcgd2VudCB3cm9uZ1wiKScsXG4gICAgICAgICd0cnkgeyB9IGNhdGNoIChlKSB7IGNvbnNvbGUuZXJyb3IoXCJTb21ldGhpbmcgd2VudCB3cm9uZ1wiKTsgfScsXG4gICAgICAgICdlcnJvcidcbiAgICAgICk7XG4gICAgICBcbiAgICAgIGV4cGVjdChpc0NyaXRpY2FsKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBtYXJrIHN0YXRlbWVudHMgaW4gZGVidWcgZmlsZXMgYXMgY3JpdGljYWwnLCAoKSA9PiB7XG4gICAgICBjb25zdCBpc0NyaXRpY2FsID0gKHJlbW92YWxTeXN0ZW0gYXMgYW55KS5pc0NvbnNvbGVTdGF0ZW1lbnRDcml0aWNhbChcbiAgICAgICAgJy90ZXN0L2RlYnVnLnRzJyxcbiAgICAgICAgJ2NvbnNvbGUubG9nKFwiRGVidWcgaW5mb1wiKScsXG4gICAgICAgICdjb25zb2xlLmxvZyhcIkRlYnVnIGluZm9cIik7JyxcbiAgICAgICAgJ2xvZydcbiAgICAgICk7XG4gICAgICBcbiAgICAgIGV4cGVjdChpc0NyaXRpY2FsKS50b0JlKHRydWUpO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBtYXJrIHN0YXRlbWVudHMgaW4gdGVzdCBmaWxlcyBhcyBjcml0aWNhbCcsICgpID0+IHtcbiAgICAgIGNvbnN0IGlzQ3JpdGljYWwgPSAocmVtb3ZhbFN5c3RlbSBhcyBhbnkpLmlzQ29uc29sZVN0YXRlbWVudENyaXRpY2FsKFxuICAgICAgICAnL3Rlc3QvZmlsZS50ZXN0LnRzJyxcbiAgICAgICAgJ2NvbnNvbGUubG9nKFwiVGVzdCBvdXRwdXRcIiknLFxuICAgICAgICAnY29uc29sZS5sb2coXCJUZXN0IG91dHB1dFwiKTsnLFxuICAgICAgICAnbG9nJ1xuICAgICAgKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KGlzQ3JpdGljYWwpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIG1hcmsgc3RhdGVtZW50cyB3aXRoIGVycm9yIGhhbmRsaW5nIGNvbnRleHQgYXMgY3JpdGljYWwnLCAoKSA9PiB7XG4gICAgICBjb25zdCBjb250ZXh0ID0gYFxuICAgICAgICB0cnkge1xuICAgICAgICAgIGRvU29tZXRoaW5nKCk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coXCJFcnJvciBvY2N1cnJlZFwiKTtcbiAgICAgICAgfVxuICAgICAgYDtcbiAgICAgIFxuICAgICAgY29uc3QgaXNDcml0aWNhbCA9IChyZW1vdmFsU3lzdGVtIGFzIGFueSkuaXNDb25zb2xlU3RhdGVtZW50Q3JpdGljYWwoXG4gICAgICAgICcvdGVzdC9maWxlLnRzJyxcbiAgICAgICAgJ2NvbnNvbGUubG9nKFwiRXJyb3Igb2NjdXJyZWRcIiknLFxuICAgICAgICBjb250ZXh0LFxuICAgICAgICAnbG9nJ1xuICAgICAgKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KGlzQ3JpdGljYWwpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIG1hcmsgc3RhdGVtZW50cyB3aXRoIGltcG9ydGFudCBwYXR0ZXJucyBhcyBjcml0aWNhbCcsICgpID0+IHtcbiAgICAgIGNvbnN0IGlzQ3JpdGljYWwgPSAocmVtb3ZhbFN5c3RlbSBhcyBhbnkpLmlzQ29uc29sZVN0YXRlbWVudENyaXRpY2FsKFxuICAgICAgICAnL3Rlc3QvZmlsZS50cycsXG4gICAgICAgICdjb25zb2xlLmxvZyhcIkFQSSByZXF1ZXN0IGZhaWxlZFwiKScsXG4gICAgICAgICdjb25zb2xlLmxvZyhcIkFQSSByZXF1ZXN0IGZhaWxlZFwiKTsnLFxuICAgICAgICAnbG9nJ1xuICAgICAgKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KGlzQ3JpdGljYWwpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIG1hcmsgd2FybiBzdGF0ZW1lbnRzIGluIHByb2R1Y3Rpb24gY29kZSBhcyBjcml0aWNhbCcsICgpID0+IHtcbiAgICAgIGNvbnN0IGlzQ3JpdGljYWwgPSAocmVtb3ZhbFN5c3RlbSBhcyBhbnkpLmlzQ29uc29sZVN0YXRlbWVudENyaXRpY2FsKFxuICAgICAgICAnL3NyYy9jb21wb25lbnRzL0NvbXBvbmVudC50cycsXG4gICAgICAgICdjb25zb2xlLndhcm4oXCJEZXByZWNhdGVkIGZlYXR1cmVcIiknLFxuICAgICAgICAnY29uc29sZS53YXJuKFwiRGVwcmVjYXRlZCBmZWF0dXJlXCIpOycsXG4gICAgICAgICd3YXJuJ1xuICAgICAgKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KGlzQ3JpdGljYWwpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIG5vdCBtYXJrIHNpbXBsZSBsb2cgc3RhdGVtZW50cyBhcyBjcml0aWNhbCcsICgpID0+IHtcbiAgICAgIGNvbnN0IGlzQ3JpdGljYWwgPSAocmVtb3ZhbFN5c3RlbSBhcyBhbnkpLmlzQ29uc29sZVN0YXRlbWVudENyaXRpY2FsKFxuICAgICAgICAnL3NyYy9jb21wb25lbnRzL0NvbXBvbmVudC50cycsXG4gICAgICAgICdjb25zb2xlLmxvZyhcIlNpbXBsZSBkZWJ1Z1wiKScsXG4gICAgICAgICdjb25zb2xlLmxvZyhcIlNpbXBsZSBkZWJ1Z1wiKTsnLFxuICAgICAgICAnbG9nJ1xuICAgICAgKTtcbiAgICAgIFxuICAgICAgZXhwZWN0KGlzQ3JpdGljYWwpLnRvQmUoZmFsc2UpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgndmFsaWRhdGVQcmVDb25kaXRpb25zJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgdmFsaWRhdGUgc2NyaXB0IGV4aXN0cycsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tGcy5leGlzdHNTeW5jLm1vY2tSZXR1cm5WYWx1ZShmYWxzZSk7XG4gICAgICBcbiAgICAgIGF3YWl0IGV4cGVjdCgocmVtb3ZhbFN5c3RlbSBhcyBhbnkpLnZhbGlkYXRlUHJlQ29uZGl0aW9ucygpKS5yZWplY3RzLnRvVGhyb3coJ0NvbnNvbGUgcmVtb3ZhbCBzY3JpcHQgbm90IGZvdW5kJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGNoZWNrIGdpdCBzdGF0dXMgd2hlbiBnaXQgc3Rhc2ggaXMgZW5hYmxlZCcsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tFeGVjU3luYy5tb2NrUmV0dXJuVmFsdWUoJycpO1xuICAgICAgXG4gICAgICBhd2FpdCBleHBlY3QoKHJlbW92YWxTeXN0ZW0gYXMgYW55KS52YWxpZGF0ZVByZUNvbmRpdGlvbnMoKSkucmVzb2x2ZXMubm90LnRvVGhyb3coKTtcbiAgICAgIGV4cGVjdChtb2NrRXhlY1N5bmMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCdnaXQgc3RhdHVzIC0tcG9yY2VsYWluJywgeyBlbmNvZGluZzogJ3V0Zi04JyB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2NyZWF0ZVNhZmV0eVN0YXNoJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgY3JlYXRlIGdpdCBzdGFzaCB3aXRoIHRpbWVzdGFtcCcsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tFeGVjU3luYy5tb2NrUmV0dXJuVmFsdWUoJycpO1xuICAgICAgXG4gICAgICBjb25zdCBzdGFzaElkID0gYXdhaXQgKHJlbW92YWxTeXN0ZW0gYXMgYW55KS5jcmVhdGVTYWZldHlTdGFzaCgpO1xuICAgICAgXG4gICAgICBleHBlY3Qoc3Rhc2hJZCkudG9Db250YWluKCdjb25zb2xlLXJlbW92YWwtJyk7XG4gICAgICBleHBlY3QobW9ja0V4ZWNTeW5jKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgZXhwZWN0LnN0cmluZ0NvbnRhaW5pbmcoJ2dpdCBzdGFzaCBwdXNoIC1tIFwiY29uc29sZS1yZW1vdmFsLScpLFxuICAgICAgICB7IGVuY29kaW5nOiAndXRmLTgnIH1cbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBnaXQgc3Rhc2ggZXJyb3JzIGdyYWNlZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrRXhlY1N5bmMubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdHaXQgZXJyb3InKTtcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBjb25zdCBzdGFzaElkID0gYXdhaXQgKHJlbW92YWxTeXN0ZW0gYXMgYW55KS5jcmVhdGVTYWZldHlTdGFzaCgpO1xuICAgICAgZXhwZWN0KHN0YXNoSWQpLnRvQmUoJycpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZXhlY3V0ZVNjcmlwdCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGV4ZWN1dGUgc2NyaXB0IHdpdGggY29ycmVjdCBhcmd1bWVudHMgZm9yIGRyeSBydW4nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBjb25maWcgPSB7IGRyeVJ1bjogdHJ1ZSwgbWF4RmlsZXM6IDEwIH07XG4gICAgICBjb25zdCBzeXN0ZW0gPSBuZXcgQ29uc29sZVN0YXRlbWVudFJlbW92YWxTeXN0ZW0oY29uZmlnKTtcbiAgICAgIFxuICAgICAgY29uc3QgbW9ja0FuYWx5c2lzOiBDb25zb2xlU3RhdGVtZW50W10gPSBbXG4gICAgICAgIHtcbiAgICAgICAgICBmaWxlOiAnL3Rlc3QvZmlsZS50cycsXG4gICAgICAgICAgbGluZTogMSxcbiAgICAgICAgICBjb2x1bW46IDEsXG4gICAgICAgICAgdHlwZTogJ2xvZycsXG4gICAgICAgICAgY29udGVudDogJ2NvbnNvbGUubG9nKFwidGVzdFwiKScsXG4gICAgICAgICAgY29udGV4dDogJ2NvbnNvbGUubG9nKFwidGVzdFwiKTsnLFxuICAgICAgICAgIGlzQ3JpdGljYWw6IGZhbHNlLFxuICAgICAgICAgIHNob3VsZFByZXNlcnZlOiBmYWxzZVxuICAgICAgICB9XG4gICAgICBdO1xuICAgICAgXG4gICAgICBtb2NrRXhlY1N5bmMubW9ja1JldHVyblZhbHVlKCdGaWxlcyBwcm9jZXNzZWQ6IDVcXG5Ub3RhbCBjb25zb2xlIHN0YXRlbWVudHMgZml4ZWQ6IDEwJyk7XG4gICAgICBcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IChzeXN0ZW0gYXMgYW55KS5leGVjdXRlU2NyaXB0KG1vY2tBbmFseXNpcyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHQuc3VjY2VzcykudG9CZSh0cnVlKTtcbiAgICAgIGV4cGVjdChyZXN1bHQuZmlsZXNQcm9jZXNzZWQpLnRvQmUoNSk7XG4gICAgICBleHBlY3QocmVzdWx0LmNvbnNvbGVTdGF0ZW1lbnRzUmVtb3ZlZCkudG9CZSgxMCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChtb2NrRXhlY1N5bmMpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBleHBlY3Quc3RyaW5nQ29udGFpbmluZygnLS1kcnktcnVuIC0tbWF4LWZpbGVzIDEwJyksXG4gICAgICAgIGV4cGVjdC5hbnkoT2JqZWN0KVxuICAgICAgKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgY2FsY3VsYXRlIHByZXNlcnZlZCBzdGF0ZW1lbnRzIGNvcnJlY3RseScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tBbmFseXNpczogQ29uc29sZVN0YXRlbWVudFtdID0gW1xuICAgICAgICB7XG4gICAgICAgICAgZmlsZTogJy90ZXN0L2ZpbGUudHMnLFxuICAgICAgICAgIGxpbmU6IDEsXG4gICAgICAgICAgY29sdW1uOiAxLFxuICAgICAgICAgIHR5cGU6ICdlcnJvcicsXG4gICAgICAgICAgY29udGVudDogJ2NvbnNvbGUuZXJyb3IoXCJjcml0aWNhbFwiKScsXG4gICAgICAgICAgY29udGV4dDogJ2NvbnNvbGUuZXJyb3IoXCJjcml0aWNhbFwiKTsnLFxuICAgICAgICAgIGlzQ3JpdGljYWw6IHRydWUsXG4gICAgICAgICAgc2hvdWxkUHJlc2VydmU6IHRydWVcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIGZpbGU6ICcvdGVzdC9maWxlLnRzJyxcbiAgICAgICAgICBsaW5lOiAyLFxuICAgICAgICAgIGNvbHVtbjogMSxcbiAgICAgICAgICB0eXBlOiAnbG9nJyxcbiAgICAgICAgICBjb250ZW50OiAnY29uc29sZS5sb2coXCJub3JtYWxcIiknLFxuICAgICAgICAgIGNvbnRleHQ6ICdjb25zb2xlLmxvZyhcIm5vcm1hbFwiKTsnLFxuICAgICAgICAgIGlzQ3JpdGljYWw6IGZhbHNlLFxuICAgICAgICAgIHNob3VsZFByZXNlcnZlOiBmYWxzZVxuICAgICAgICB9XG4gICAgICBdO1xuICAgICAgXG4gICAgICBtb2NrRXhlY1N5bmMubW9ja1JldHVyblZhbHVlKCdGaWxlcyBwcm9jZXNzZWQ6IDFcXG5Ub3RhbCBjb25zb2xlIHN0YXRlbWVudHMgZml4ZWQ6IDEnKTtcbiAgICAgIFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgKHJlbW92YWxTeXN0ZW0gYXMgYW55KS5leGVjdXRlU2NyaXB0KG1vY2tBbmFseXNpcyk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXN1bHQuY29uc29sZVN0YXRlbWVudHNQcmVzZXJ2ZWQpLnRvQmUoMSk7XG4gICAgICBleHBlY3QocmVzdWx0LnByZXNlcnZlZEZpbGVzKS50b0NvbnRhaW4oJy90ZXN0L2ZpbGUudHMnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIHNjcmlwdCBleGVjdXRpb24gZXJyb3JzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja0V4ZWNTeW5jLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignU2NyaXB0IGV4ZWN1dGlvbiBmYWlsZWQnKTtcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCAocmVtb3ZhbFN5c3RlbSBhcyBhbnkpLmV4ZWN1dGVTY3JpcHQoW10pO1xuICAgICAgXG4gICAgICBleHBlY3QocmVzdWx0LnN1Y2Nlc3MpLnRvQmUoZmFsc2UpO1xuICAgICAgZXhwZWN0KHJlc3VsdC5lcnJvcnMpLnRvQ29udGFpbihleHBlY3Quc3RyaW5nQ29udGFpbmluZygnU2NyaXB0IGV4ZWN1dGlvbiBmYWlsZWQnKSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHBhcnNlIHdhcm5pbmdzIGFuZCBlcnJvcnMgZnJvbSBvdXRwdXQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBvdXRwdXQgPSBgXG4gICAgICAgIEZpbGVzIHByb2Nlc3NlZDogNVxuICAgICAgICDimqDvuI8gV2FybmluZzogU29tZSBzdGF0ZW1lbnRzIHByZXNlcnZlZFxuICAgICAgICDinYwgRXJyb3I6IEZhaWxlZCB0byBwcm9jZXNzIGZpbGVcbiAgICAgICAgVG90YWwgY29uc29sZSBzdGF0ZW1lbnRzIGZpeGVkOiAxMFxuICAgICAgYDtcbiAgICAgIFxuICAgICAgbW9ja0V4ZWNTeW5jLm1vY2tSZXR1cm5WYWx1ZShvdXRwdXQpO1xuICAgICAgXG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCAocmVtb3ZhbFN5c3RlbSBhcyBhbnkpLmV4ZWN1dGVTY3JpcHQoW10pO1xuICAgICAgXG4gICAgICBleHBlY3QocmVzdWx0Lndhcm5pbmdzKS50b0hhdmVMZW5ndGgoMSk7XG4gICAgICBleHBlY3QocmVzdWx0LmVycm9ycykudG9IYXZlTGVuZ3RoKDEpO1xuICAgICAgZXhwZWN0KHJlc3VsdC53YXJuaW5nc1swXSkudG9Db250YWluKCdXYXJuaW5nOiBTb21lIHN0YXRlbWVudHMgcHJlc2VydmVkJyk7XG4gICAgICBleHBlY3QocmVzdWx0LmVycm9yc1swXSkudG9Db250YWluKCdFcnJvcjogRmFpbGVkIHRvIHByb2Nlc3MgZmlsZScpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2VuZXJhdGVSZXBvcnQnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBnZW5lcmF0ZSBzaW5nbGUgZXhlY3V0aW9uIHJlcG9ydCcsICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdDogQ29uc29sZVJlbW92YWxSZXN1bHQgPSB7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGZpbGVzUHJvY2Vzc2VkOiAxMCxcbiAgICAgICAgY29uc29sZVN0YXRlbWVudHNSZW1vdmVkOiAyNSxcbiAgICAgICAgY29uc29sZVN0YXRlbWVudHNQcmVzZXJ2ZWQ6IDUsXG4gICAgICAgIGJ1aWxkVGltZTogMjAwMCxcbiAgICAgICAgZXJyb3JzOiBbXSxcbiAgICAgICAgd2FybmluZ3M6IFsnVGVzdCB3YXJuaW5nJ10sXG4gICAgICAgIHByZXNlcnZlZEZpbGVzOiBbJy90ZXN0L2RlYnVnLnRzJ11cbiAgICAgIH07XG4gICAgICBcbiAgICAgIGNvbnN0IHJlcG9ydCA9IHJlbW92YWxTeXN0ZW0uZ2VuZXJhdGVSZXBvcnQocmVzdWx0KTtcbiAgICAgIFxuICAgICAgZXhwZWN0KHJlcG9ydCkudG9Db250YWluKCdDb25zb2xlIFN0YXRlbWVudCBSZW1vdmFsIFJlcG9ydCcpO1xuICAgICAgZXhwZWN0KHJlcG9ydCkudG9Db250YWluKCdTdWNjZXNzOiDinIUnKTtcbiAgICAgIGV4cGVjdChyZXBvcnQpLnRvQ29udGFpbignRmlsZXMgUHJvY2Vzc2VkOiAxMCcpO1xuICAgICAgZXhwZWN0KHJlcG9ydCkudG9Db250YWluKCdDb25zb2xlIFN0YXRlbWVudHMgUmVtb3ZlZDogMjUnKTtcbiAgICAgIGV4cGVjdChyZXBvcnQpLnRvQ29udGFpbignQ29uc29sZSBTdGF0ZW1lbnRzIFByZXNlcnZlZDogNScpO1xuICAgICAgZXhwZWN0KHJlcG9ydCkudG9Db250YWluKCdCdWlsZCBUaW1lOiAyMDAwbXMnKTtcbiAgICAgIGV4cGVjdChyZXBvcnQpLnRvQ29udGFpbignL3Rlc3QvZGVidWcudHMnKTtcbiAgICAgIGV4cGVjdChyZXBvcnQpLnRvQ29udGFpbignVGVzdCB3YXJuaW5nJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGdlbmVyYXRlIGZhaWx1cmUgcmVwb3J0JywgKCkgPT4ge1xuICAgICAgY29uc3QgcmVzdWx0OiBDb25zb2xlUmVtb3ZhbFJlc3VsdCA9IHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGZpbGVzUHJvY2Vzc2VkOiAwLFxuICAgICAgICBjb25zb2xlU3RhdGVtZW50c1JlbW92ZWQ6IDAsXG4gICAgICAgIGNvbnNvbGVTdGF0ZW1lbnRzUHJlc2VydmVkOiAwLFxuICAgICAgICBidWlsZFRpbWU6IDAsXG4gICAgICAgIGVycm9yczogWydUZXN0IGVycm9yJ10sXG4gICAgICAgIHdhcm5pbmdzOiBbXSxcbiAgICAgICAgcHJlc2VydmVkRmlsZXM6IFtdXG4gICAgICB9O1xuICAgICAgXG4gICAgICBjb25zdCByZXBvcnQgPSByZW1vdmFsU3lzdGVtLmdlbmVyYXRlUmVwb3J0KHJlc3VsdCk7XG4gICAgICBcbiAgICAgIGV4cGVjdChyZXBvcnQpLnRvQ29udGFpbignU3VjY2Vzczog4p2MJyk7XG4gICAgICBleHBlY3QocmVwb3J0KS50b0NvbnRhaW4oJ1Rlc3QgZXJyb3InKTtcbiAgICAgIGV4cGVjdChyZXBvcnQpLnRvQ29udGFpbignQ29uc29sZSByZW1vdmFsIGZhaWxlZCcpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZXN0aW1hdGVGaWxlc1dpdGhDb25zb2xlU3RhdGVtZW50cycsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIHJldHVybiBkZWZhdWx0IGVzdGltYXRlIHdoZW4gYW5hbHl6ZXIgZmFpbHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICAvLyBNb2NrIHRoZSBkeW5hbWljIGltcG9ydCB0byBmYWlsXG4gICAgICBqZXN0LmRvTW9jaygnLi9MaW50aW5nV2FybmluZ0FuYWx5emVyLmpzJywgKCkgPT4ge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ01vZHVsZSBub3QgZm91bmQnKTtcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICBjb25zdCBlc3RpbWF0ZSA9IGF3YWl0IChyZW1vdmFsU3lzdGVtIGFzIGFueSkuZXN0aW1hdGVGaWxlc1dpdGhDb25zb2xlU3RhdGVtZW50cygpO1xuICAgICAgXG4gICAgICBleHBlY3QoZXN0aW1hdGUpLnRvQmUoNTApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnc2F2ZU1ldHJpY3MnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBzYXZlIG1ldHJpY3MgdG8gZmlsZScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IHJlc3VsdDogQ29uc29sZVJlbW92YWxSZXN1bHQgPSB7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGZpbGVzUHJvY2Vzc2VkOiA1LFxuICAgICAgICBjb25zb2xlU3RhdGVtZW50c1JlbW92ZWQ6IDEwLFxuICAgICAgICBjb25zb2xlU3RhdGVtZW50c1ByZXNlcnZlZDogMixcbiAgICAgICAgYnVpbGRUaW1lOiAxNTAwLFxuICAgICAgICBlcnJvcnM6IFtdLFxuICAgICAgICB3YXJuaW5nczogW10sXG4gICAgICAgIHByZXNlcnZlZEZpbGVzOiBbJy90ZXN0L2RlYnVnLnRzJ11cbiAgICAgIH07XG4gICAgICBcbiAgICAgIG1vY2tGcy53cml0ZUZpbGVTeW5jLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiB7fSk7XG4gICAgICBcbiAgICAgIGF3YWl0IChyZW1vdmFsU3lzdGVtIGFzIGFueSkuc2F2ZU1ldHJpY3MocmVzdWx0KTtcbiAgICAgIFxuICAgICAgZXhwZWN0KG1vY2tGcy53cml0ZUZpbGVTeW5jKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgZXhwZWN0LnN0cmluZ0NvbnRhaW5pbmcoJy5jb25zb2xlLXJlbW92YWwtbWV0cmljcy5qc29uJyksXG4gICAgICAgIGV4cGVjdC5zdHJpbmdDb250YWluaW5nKCdcInN1Y2Nlc3NcIjp0cnVlJylcbiAgICAgICk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGhhbmRsZSBzYXZlIG1ldHJpY3MgZXJyb3JzIGdyYWNlZnVsbHknLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZXN1bHQ6IENvbnNvbGVSZW1vdmFsUmVzdWx0ID0ge1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBmaWxlc1Byb2Nlc3NlZDogNSxcbiAgICAgICAgY29uc29sZVN0YXRlbWVudHNSZW1vdmVkOiAxMCxcbiAgICAgICAgY29uc29sZVN0YXRlbWVudHNQcmVzZXJ2ZWQ6IDIsXG4gICAgICAgIGJ1aWxkVGltZTogMTUwMCxcbiAgICAgICAgZXJyb3JzOiBbXSxcbiAgICAgICAgd2FybmluZ3M6IFtdLFxuICAgICAgICBwcmVzZXJ2ZWRGaWxlczogW11cbiAgICAgIH07XG4gICAgICBcbiAgICAgIG1vY2tGcy53cml0ZUZpbGVTeW5jLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignV3JpdGUgZmFpbGVkJyk7XG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgYXdhaXQgZXhwZWN0KChyZW1vdmFsU3lzdGVtIGFzIGFueSkuc2F2ZU1ldHJpY3MocmVzdWx0KSkucmVzb2x2ZXMubm90LnRvVGhyb3coKTtcbiAgICB9KTtcbiAgfSk7XG59KTsiXSwidmVyc2lvbiI6M30=