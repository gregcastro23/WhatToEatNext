9af81487a7694b7ce546ef60c6643bce
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.createErrorBoundaryForType = exports.useErrorHandler = exports.handleSyncError = exports.handleAsyncError = exports.globalErrorHandler = exports.ErrorHandler = exports.classifyError = exports.createEnhancedError = exports.ErrorSeverity = exports.ErrorType = void 0;
const react_1 = __importDefault(require("react"));
const logger_1 = require("@/utils/logger");
const ErrorBoundary_1 = __importDefault(require("@/components/error-boundaries/ErrorBoundary"));
// Error types for better categorization
var ErrorType;
(function (ErrorType) {
    ErrorType["NETWORK"] = "NETWORK";
    ErrorType["VALIDATION"] = "VALIDATION";
    ErrorType["AUTHENTICATION"] = "AUTHENTICATION";
    ErrorType["AUTHORIZATION"] = "AUTHORIZATION";
    ErrorType["NOT_FOUND"] = "NOT_FOUND";
    ErrorType["SERVER_ERROR"] = "SERVER_ERROR";
    ErrorType["CLIENT_ERROR"] = "CLIENT_ERROR";
    ErrorType["ASTROLOGICAL_CALCULATION"] = "ASTROLOGICAL_CALCULATION";
    ErrorType["DATA_PROCESSING"] = "DATA_PROCESSING";
    ErrorType["COMPONENT_ERROR"] = "COMPONENT_ERROR";
    ErrorType["UNKNOWN"] = "UNKNOWN";
})(ErrorType || (exports.ErrorType = ErrorType = {}));
// Error severity levels
var ErrorSeverity;
(function (ErrorSeverity) {
    ErrorSeverity["LOW"] = "LOW";
    ErrorSeverity["MEDIUM"] = "MEDIUM";
    ErrorSeverity["HIGH"] = "HIGH";
    ErrorSeverity["CRITICAL"] = "CRITICAL";
})(ErrorSeverity || (exports.ErrorSeverity = ErrorSeverity = {}));
// User-friendly error messages
const USER_FRIENDLY_MESSAGES = {
    [ErrorType.NETWORK]: 'Unable to connect to the server. Please check your internet connection and try again.',
    [ErrorType.VALIDATION]: 'Please check your input and try again.',
    [ErrorType.AUTHENTICATION]: 'Please log in to continue.',
    [ErrorType.AUTHORIZATION]: 'You don\'t have permission to access this resource.',
    [ErrorType.NOT_FOUND]: 'The requested information could not be found.',
    [ErrorType.SERVER_ERROR]: 'A server error occurred. Please try again later.',
    [ErrorType.CLIENT_ERROR]: 'An error occurred while processing your request.',
    [ErrorType.ASTROLOGICAL_CALCULATION]: 'Unable to calculate astrological data. Using cached information.',
    [ErrorType.DATA_PROCESSING]: 'Error processing data. Please try again.',
    [ErrorType.COMPONENT_ERROR]: 'A component failed to load. Please refresh the page.',
    [ErrorType.UNKNOWN]: 'An unexpected error occurred. Please try again.'
};
// Create enhanced error
function createEnhancedError(message, type = ErrorType.UNKNOWN, severity = ErrorSeverity.MEDIUM, context, originalError) {
    const error = new Error(message);
    error.type = type;
    error.severity = severity;
    error.context = context;
    error.userMessage = USER_FRIENDLY_MESSAGES[type];
    error.recoverable = isRecoverable(type);
    error.retryable = isRetryable(type);
    error.timestamp = new Date();
    error.errorId = `error_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
    // Preserve original error stack if available
    if (originalError) {
        error.stack = originalError.stack;
        error.cause = originalError;
    }
    return error;
}
exports.createEnhancedError = createEnhancedError;
// Determine if error is recoverable
function isRecoverable(type) {
    return [
        ErrorType.NETWORK,
        ErrorType.ASTROLOGICAL_CALCULATION,
        ErrorType.DATA_PROCESSING,
        ErrorType.COMPONENT_ERROR
    ].includes(type);
}
// Determine if error is retryable
function isRetryable(type) {
    return [
        ErrorType.NETWORK,
        ErrorType.SERVER_ERROR,
        ErrorType.ASTROLOGICAL_CALCULATION,
        ErrorType.DATA_PROCESSING
    ].includes(type);
}
// Error classification based on error message or type
function classifyError(error) {
    const message = typeof error === 'string' ? error : error.message;
    const lowerMessage = message.toLowerCase();
    if (lowerMessage.includes('network') || lowerMessage.includes('fetch') || lowerMessage.includes('connection')) {
        return ErrorType.NETWORK;
    }
    if (lowerMessage.includes('validation') || lowerMessage.includes('invalid')) {
        return ErrorType.VALIDATION;
    }
    if (lowerMessage.includes('unauthorized') || lowerMessage.includes('authentication')) {
        return ErrorType.AUTHENTICATION;
    }
    if (lowerMessage.includes('forbidden') || lowerMessage.includes('permission')) {
        return ErrorType.AUTHORIZATION;
    }
    if (lowerMessage.includes('not found') || lowerMessage.includes('404')) {
        return ErrorType.NOT_FOUND;
    }
    if (lowerMessage.includes('server') || lowerMessage.includes('500') || lowerMessage.includes('503')) {
        return ErrorType.SERVER_ERROR;
    }
    if (lowerMessage.includes('planetary') || lowerMessage.includes('astrological') || lowerMessage.includes('zodiac')) {
        return ErrorType.ASTROLOGICAL_CALCULATION;
    }
    if (lowerMessage.includes('component') || lowerMessage.includes('render')) {
        return ErrorType.COMPONENT_ERROR;
    }
    return ErrorType.UNKNOWN;
}
exports.classifyError = classifyError;
// Error handler class
class ErrorHandler {
    constructor() {
        this.recoveryStrategies = [];
        this.errorQueue = [];
        this.maxQueueSize = 50;
    }
    // Add recovery strategy
    addRecoveryStrategy(strategy) {
        this.recoveryStrategies.push(strategy);
    }
    // Handle error with recovery attempts
    async handleError(error, context) {
        let enhancedError;
        if ('type' in error && 'severity' in error) {
            enhancedError = error;
        }
        else {
            const type = classifyError(error);
            const severity = this.determineSeverity(type);
            enhancedError = createEnhancedError(error.message, type, severity, context, error);
        }
        // Log the error
        this.logError(enhancedError);
        // Add to error queue
        this.addToQueue(enhancedError);
        // Attempt recovery
        const recoveryResult = await this.attemptRecovery(enhancedError);
        if (recoveryResult.success) {
            logger_1.logger.info(`Error recovered successfully: ${enhancedError.errorId}`);
            return recoveryResult.data;
        }
        // If recovery failed, throw the enhanced error
        throw enhancedError;
    }
    // Attempt error recovery
    async attemptRecovery(error) {
        for (const strategy of this.recoveryStrategies) {
            if (strategy.canRecover(error)) {
                try {
                    const result = await strategy.recover(error);
                    return { success: true, data: result };
                }
                catch (recoveryError) {
                    logger_1.logger.warn(`Recovery strategy failed for error ${error.errorId}:`, recoveryError);
                    // Try fallback if available
                    if (strategy.fallback) {
                        try {
                            const fallbackResult = strategy.fallback();
                            return { success: true, data: fallbackResult };
                        }
                        catch (fallbackError) {
                            logger_1.logger.warn(`Fallback strategy failed for error ${error.errorId}:`, fallbackError);
                        }
                    }
                }
            }
        }
        return { success: false };
    }
    // Determine error severity
    determineSeverity(type) {
        switch (type) {
            case ErrorType.AUTHENTICATION:
            case ErrorType.AUTHORIZATION:
                return ErrorSeverity.HIGH;
            case ErrorType.SERVER_ERROR:
                return ErrorSeverity.HIGH;
            case ErrorType.NETWORK:
            case ErrorType.ASTROLOGICAL_CALCULATION:
                return ErrorSeverity.MEDIUM;
            case ErrorType.VALIDATION:
            case ErrorType.NOT_FOUND:
                return ErrorSeverity.LOW;
            default:
                return ErrorSeverity.MEDIUM;
        }
    }
    // Log error with appropriate level
    logError(error) {
        const logData = {
            errorId: error.errorId,
            type: error.type,
            severity: error.severity,
            message: error.message,
            userMessage: error.userMessage,
            context: error.context,
            timestamp: error.timestamp,
            stack: error.stack
        };
        switch (error.severity) {
            case ErrorSeverity.CRITICAL:
            case ErrorSeverity.HIGH:
                logger_1.logger.error('High severity error:', logData);
                break;
            case ErrorSeverity.MEDIUM:
                logger_1.logger.warn('Medium severity error:', logData);
                break;
            case ErrorSeverity.LOW:
                logger_1.logger.info('Low severity error:', logData);
                break;
        }
    }
    // Add error to queue for analysis
    addToQueue(error) {
        this.errorQueue.push(error);
        // Maintain queue size
        if (this.errorQueue.length > this.maxQueueSize) {
            this.errorQueue.shift();
        }
    }
    // Get error statistics
    getErrorStats() {
        const byType = {};
        const bySeverity = {};
        this.errorQueue.forEach(error => {
            byType[error.type] = (byType[error.type] || 0) + 1;
            bySeverity[error.severity] = (bySeverity[error.severity] || 0) + 1;
        });
        return {
            total: this.errorQueue.length,
            byType,
            bySeverity,
            recent: this.errorQueue.slice(-10) // Last 10 errors
        };
    }
    // Clear error queue
    clearErrorQueue() {
        this.errorQueue = [];
    }
}
exports.ErrorHandler = ErrorHandler;
// Global error handler instance
exports.globalErrorHandler = new ErrorHandler();
// Default recovery strategies
exports.globalErrorHandler.addRecoveryStrategy({
    canRecover: (error) => error.type === ErrorType.ASTROLOGICAL_CALCULATION,
    recover: async (error) => {
        logger_1.logger.info(`Attempting to recover from astrological calculation error: ${error.errorId}`);
        // Return cached astrological data
        const cachedData = localStorage.getItem('cachedAstrologicalData');
        if (cachedData) {
            return JSON.parse(cachedData);
        }
        throw new Error('No cached astrological data available');
    },
    fallback: () => {
        // Return default astrological state
        return {
            zodiacSign: 'aries',
            lunarPhase: 'new moon',
            elementalState: { Fire: 0.25, Water: 0.25, Earth: 0.25, Air: 0.25 }
        };
    }
});
exports.globalErrorHandler.addRecoveryStrategy({
    canRecover: (error) => error.type === ErrorType.NETWORK,
    recover: async (error) => {
        var _a;
        logger_1.logger.info(`Attempting to recover from network error: ${error.errorId}`);
        // Try to use cached data
        const cacheKey = (_a = error.context) === null || _a === void 0 ? void 0 : _a.cacheKey;
        if (cacheKey) {
            const cachedData = localStorage.getItem(cacheKey);
            if (cachedData) {
                return JSON.parse(cachedData);
            }
        }
        throw new Error('No cached data available for network recovery');
    }
});
// Utility functions for common error scenarios
function handleAsyncError(promise, context) {
    return promise.catch(error => {
        return exports.globalErrorHandler.handleError(error, context);
    });
}
exports.handleAsyncError = handleAsyncError;
function handleSyncError(fn, context) {
    try {
        return fn();
    }
    catch (error) {
        throw exports.globalErrorHandler.handleError(error, context);
    }
}
exports.handleSyncError = handleSyncError;
// React hook for error handling
function useErrorHandler() {
    const handleError = react_1.default.useCallback(async (error, context) => {
        try {
            return await exports.globalErrorHandler.handleError(error, context);
        }
        catch (enhancedError) {
            // Re-throw enhanced error for component error boundaries to catch
            throw enhancedError;
        }
    }, []);
    const getErrorStats = react_1.default.useCallback(() => {
        return exports.globalErrorHandler.getErrorStats();
    }, []);
    return { handleError, getErrorStats };
}
exports.useErrorHandler = useErrorHandler;
// Error boundary helper for specific error types
function createErrorBoundaryForType(errorType) {
    return function ErrorBoundaryForType({ children }) {
        return react_1.default.createElement(ErrorBoundary_1.default, {
            fallback: (error, errorInfo) => {
                const enhancedError = createEnhancedError(error.message, errorType, ErrorSeverity.MEDIUM, { componentStack: errorInfo.componentStack });
                return react_1.default.createElement('div', {
                    className: "bg-yellow-50 border border-yellow-200 rounded-lg p-4 m-2"
                }, [
                    react_1.default.createElement('h4', {
                        key: 'title',
                        className: "text-yellow-800 font-medium mb-2"
                    }, `${errorType} Error`),
                    react_1.default.createElement('p', {
                        key: 'message',
                        className: "text-yellow-700 text-sm mb-3"
                    }, enhancedError.userMessage),
                    react_1.default.createElement('button', {
                        key: 'button',
                        onClick: () => window.location.reload(),
                        className: "bg-yellow-600 text-white px-3 py-1 rounded text-sm hover:bg-yellow-700 transition-colors"
                    }, 'Reload Page')
                ]);
            }
        }, children);
    };
}
exports.createErrorBoundaryForType = createErrorBoundaryForType;
exports.default = ErrorHandler;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy91dGlscy9lcnJvckhhbmRsaW5nLnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLGtEQUEwQjtBQUMxQiwyQ0FBd0M7QUFDeEMsZ0dBQXdFO0FBRXhFLHdDQUF3QztBQUN4QyxJQUFZLFNBWVg7QUFaRCxXQUFZLFNBQVM7SUFDbkIsZ0NBQW1CLENBQUE7SUFDbkIsc0NBQXlCLENBQUE7SUFDekIsOENBQWlDLENBQUE7SUFDakMsNENBQStCLENBQUE7SUFDL0Isb0NBQXVCLENBQUE7SUFDdkIsMENBQTZCLENBQUE7SUFDN0IsMENBQTZCLENBQUE7SUFDN0Isa0VBQXFELENBQUE7SUFDckQsZ0RBQW1DLENBQUE7SUFDbkMsZ0RBQW1DLENBQUE7SUFDbkMsZ0NBQW1CLENBQUE7QUFDckIsQ0FBQyxFQVpXLFNBQVMseUJBQVQsU0FBUyxRQVlwQjtBQUVELHdCQUF3QjtBQUN4QixJQUFZLGFBS1g7QUFMRCxXQUFZLGFBQWE7SUFDdkIsNEJBQVcsQ0FBQTtJQUNYLGtDQUFpQixDQUFBO0lBQ2pCLDhCQUFhLENBQUE7SUFDYixzQ0FBcUIsQ0FBQTtBQUN2QixDQUFDLEVBTFcsYUFBYSw2QkFBYixhQUFhLFFBS3hCO0FBcUJELCtCQUErQjtBQUMvQixNQUFNLHNCQUFzQixHQUE4QjtJQUN4RCxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsRUFBRSx1RkFBdUY7SUFDNUcsQ0FBQyxTQUFTLENBQUMsVUFBVSxDQUFDLEVBQUUsd0NBQXdDO0lBQ2hFLENBQUMsU0FBUyxDQUFDLGNBQWMsQ0FBQyxFQUFFLDRCQUE0QjtJQUN4RCxDQUFDLFNBQVMsQ0FBQyxhQUFhLENBQUMsRUFBRSxxREFBcUQ7SUFDaEYsQ0FBQyxTQUFTLENBQUMsU0FBUyxDQUFDLEVBQUUsK0NBQStDO0lBQ3RFLENBQUMsU0FBUyxDQUFDLFlBQVksQ0FBQyxFQUFFLGtEQUFrRDtJQUM1RSxDQUFDLFNBQVMsQ0FBQyxZQUFZLENBQUMsRUFBRSxrREFBa0Q7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LEVBQUU7d0JBQ3ZDLFNBQVMsRUFBRSwwRkFBMEY7cUJBQ3RHLEVBQUUsYUFBYSxDQUFDO2lCQUNsQixDQUFDLENBQUM7WUFDTCxDQUFDO1NBQ0YsRUFBRSxRQUFRLENBQUMsQ0FBQztJQUNmLENBQUMsQ0FBQztBQUNKLENBQUM7QUEvQkQsZ0VBK0JDO0FBRUQsa0JBQWUsWUFBWSxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9HcmVnQ2FzdHJvL0Rlc2t0b3AvV2hhdFRvRWF0TmV4dC9zcmMvdXRpbHMvZXJyb3JIYW5kbGluZy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSAnQC91dGlscy9sb2dnZXInO1xuaW1wb3J0IEVycm9yQm91bmRhcnkgZnJvbSAnQC9jb21wb25lbnRzL2Vycm9yLWJvdW5kYXJpZXMvRXJyb3JCb3VuZGFyeSc7XG5cbi8vIEVycm9yIHR5cGVzIGZvciBiZXR0ZXIgY2F0ZWdvcml6YXRpb25cbmV4cG9ydCBlbnVtIEVycm9yVHlwZSB7XG4gIE5FVFdPUksgPSAnTkVUV09SSycsXG4gIFZBTElEQVRJT04gPSAnVkFMSURBVElPTicsXG4gIEFVVEhFTlRJQ0FUSU9OID0gJ0FVVEhFTlRJQ0FUSU9OJyxcbiAgQVVUSE9SSVpBVElPTiA9ICdBVVRIT1JJWkFUSU9OJyxcbiAgTk9UX0ZPVU5EID0gJ05PVF9GT1VORCcsXG4gIFNFUlZFUl9FUlJPUiA9ICdTRVJWRVJfRVJST1InLFxuICBDTElFTlRfRVJST1IgPSAnQ0xJRU5UX0VSUk9SJyxcbiAgQVNUUk9MT0dJQ0FMX0NBTENVTEFUSU9OID0gJ0FTVFJPTE9HSUNBTF9DQUxDVUxBVElPTicsXG4gIERBVEFfUFJPQ0VTU0lORyA9ICdEQVRBX1BST0NFU1NJTkcnLFxuICBDT01QT05FTlRfRVJST1IgPSAnQ09NUE9ORU5UX0VSUk9SJyxcbiAgVU5LTk9XTiA9ICdVTktOT1dOJ1xufVxuXG4vLyBFcnJvciBzZXZlcml0eSBsZXZlbHNcbmV4cG9ydCBlbnVtIEVycm9yU2V2ZXJpdHkge1xuICBMT1cgPSAnTE9XJyxcbiAgTUVESVVNID0gJ01FRElVTScsXG4gIEhJR0ggPSAnSElHSCcsXG4gIENSSVRJQ0FMID0gJ0NSSVRJQ0FMJ1xufVxuXG4vLyBFbmhhbmNlZCBlcnJvciBpbnRlcmZhY2VcbmV4cG9ydCBpbnRlcmZhY2UgRW5oYW5jZWRFcnJvciBleHRlbmRzIEVycm9yIHtcbiAgdHlwZTogRXJyb3JUeXBlO1xuICBzZXZlcml0eTogRXJyb3JTZXZlcml0eTtcbiAgY29udGV4dD86IFJlY29yZDxzdHJpbmcsIGFueT47XG4gIHVzZXJNZXNzYWdlPzogc3RyaW5nO1xuICByZWNvdmVyYWJsZT86IGJvb2xlYW47XG4gIHJldHJ5YWJsZT86IGJvb2xlYW47XG4gIHRpbWVzdGFtcDogRGF0ZTtcbiAgZXJyb3JJZDogc3RyaW5nO1xufVxuXG4vLyBFcnJvciByZWNvdmVyeSBzdHJhdGVnaWVzXG5leHBvcnQgaW50ZXJmYWNlIEVycm9yUmVjb3ZlcnlTdHJhdGVneSB7XG4gIGNhblJlY292ZXI6IChlcnJvcjogRW5oYW5jZWRFcnJvcikgPT4gYm9vbGVhbjtcbiAgcmVjb3ZlcjogKGVycm9yOiBFbmhhbmNlZEVycm9yKSA9PiBQcm9taXNlPGFueT4gfCBhbnk7XG4gIGZhbGxiYWNrPzogKCkgPT4gYW55O1xufVxuXG4vLyBVc2VyLWZyaWVuZGx5IGVycm9yIG1lc3NhZ2VzXG5jb25zdCBVU0VSX0ZSSUVORExZX01FU1NBR0VTOiBSZWNvcmQ8RXJyb3JUeXBlLCBzdHJpbmc+ID0ge1xuICBbRXJyb3JUeXBlLk5FVFdPUktdOiAnVW5hYmxlIHRvIGNvbm5lY3QgdG8gdGhlIHNlcnZlci4gUGxlYXNlIGNoZWNrIHlvdXIgaW50ZXJuZXQgY29ubmVjdGlvbiBhbmQgdHJ5IGFnYWluLicsXG4gIFtFcnJvclR5cGUuVkFMSURBVElPTl06ICdQbGVhc2UgY2hlY2sgeW91ciBpbnB1dCBhbmQgdHJ5IGFnYWluLicsXG4gIFtFcnJvclR5cGUuQVVUSEVOVElDQVRJT05dOiAnUGxlYXNlIGxvZyBpbiB0byBjb250aW51ZS4nLFxuICBbRXJyb3JUeXBlLkFVVEhPUklaQVRJT05dOiAnWW91IGRvblxcJ3QgaGF2ZSBwZXJtaXNzaW9uIHRvIGFjY2VzcyB0aGlzIHJlc291cmNlLicsXG4gIFtFcnJvclR5cGUuTk9UX0ZPVU5EXTogJ1RoZSByZXF1ZXN0ZWQgaW5mb3JtYXRpb24gY291bGQgbm90IGJlIGZvdW5kLicsXG4gIFtFcnJvclR5cGUuU0VSVkVSX0VSUk9SXTogJ0Egc2VydmVyIGVycm9yIG9jY3VycmVkLiBQbGVhc2UgdHJ5IGFnYWluIGxhdGVyLicsXG4gIFtFcnJvclR5cGUuQ0xJRU5UX0VSUk9SXTogJ0FuIGVycm9yIG9jY3VycmVkIHdoaWxlIHByb2Nlc3NpbmcgeW91ciByZXF1ZXN0LicsXG4gIFtFcnJvclR5cGUuQVNUUk9MT0dJQ0FMX0NBTENVTEFUSU9OXTogJ1VuYWJsZSB0byBjYWxjdWxhdGUgYXN0cm9sb2dpY2FsIGRhdGEuIFVzaW5nIGNhY2hlZCBpbmZvcm1hdGlvbi4nLFxuICBbRXJyb3JUeXBlLkRBVEFfUFJPQ0VTU0lOR106ICdFcnJvciBwcm9jZXNzaW5nIGRhdGEuIFBsZWFzZSB0cnkgYWdhaW4uJyxcbiAgW0Vycm9yVHlwZS5DT01QT05FTlRfRVJST1JdOiAnQSBjb21wb25lbnQgZmFpbGVkIHRvIGxvYWQuIFBsZWFzZSByZWZyZXNoIHRoZSBwYWdlLicsXG4gIFtFcnJvclR5cGUuVU5LTk9XTl06ICdBbiB1bmV4cGVjdGVkIGVycm9yIG9jY3VycmVkLiBQbGVhc2UgdHJ5IGFnYWluLidcbn07XG5cbi8vIENyZWF0ZSBlbmhhbmNlZCBlcnJvclxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZUVuaGFuY2VkRXJyb3IoXG4gIG1lc3NhZ2U6IHN0cmluZyxcbiAgdHlwZTogRXJyb3JUeXBlID0gRXJyb3JUeXBlLlVOS05PV04sXG4gIHNldmVyaXR5OiBFcnJvclNldmVyaXR5ID0gRXJyb3JTZXZlcml0eS5NRURJVU0sXG4gIGNvbnRleHQ/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+LFxuICBvcmlnaW5hbEVycm9yPzogRXJyb3Jcbik6IEVuaGFuY2VkRXJyb3Ige1xuICBjb25zdCBlcnJvciA9IG5ldyBFcnJvcihtZXNzYWdlKSBhcyBFbmhhbmNlZEVycm9yO1xuICBcbiAgZXJyb3IudHlwZSA9IHR5cGU7XG4gIGVycm9yLnNldmVyaXR5ID0gc2V2ZXJpdHk7XG4gIGVycm9yLmNvbnRleHQgPSBjb250ZXh0O1xuICBlcnJvci51c2VyTWVzc2FnZSA9IFVTRVJfRlJJRU5ETFlfTUVTU0FHRVNbdHlwZV07XG4gIGVycm9yLnJlY292ZXJhYmxlID0gaXNSZWNvdmVyYWJsZSh0eXBlKTtcbiAgZXJyb3IucmV0cnlhYmxlID0gaXNSZXRyeWFibGUodHlwZSk7XG4gIGVycm9yLnRpbWVzdGFtcCA9IG5ldyBEYXRlKCk7XG4gIGVycm9yLmVycm9ySWQgPSBgZXJyb3JfJHtEYXRlLm5vdygpfV8ke01hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cigyLCA5KX1gO1xuICBcbiAgLy8gUHJlc2VydmUgb3JpZ2luYWwgZXJyb3Igc3RhY2sgaWYgYXZhaWxhYmxlXG4gIGlmIChvcmlnaW5hbEVycm9yKSB7XG4gICAgZXJyb3Iuc3RhY2sgPSBvcmlnaW5hbEVycm9yLnN0YWNrO1xuICAgIGVycm9yLmNhdXNlID0gb3JpZ2luYWxFcnJvcjtcbiAgfVxuICBcbiAgcmV0dXJuIGVycm9yO1xufVxuXG4vLyBEZXRlcm1pbmUgaWYgZXJyb3IgaXMgcmVjb3ZlcmFibGVcbmZ1bmN0aW9uIGlzUmVjb3ZlcmFibGUodHlwZTogRXJyb3JUeXBlKTogYm9vbGVhbiB7XG4gIHJldHVybiBbXG4gICAgRXJyb3JUeXBlLk5FVFdPUkssXG4gICAgRXJyb3JUeXBlLkFTVFJPTE9HSUNBTF9DQUxDVUxBVElPTixcbiAgICBFcnJvclR5cGUuREFUQV9QUk9DRVNTSU5HLFxuICAgIEVycm9yVHlwZS5DT01QT05FTlRfRVJST1JcbiAgXS5pbmNsdWRlcyh0eXBlKTtcbn1cblxuLy8gRGV0ZXJtaW5lIGlmIGVycm9yIGlzIHJldHJ5YWJsZVxuZnVuY3Rpb24gaXNSZXRyeWFibGUodHlwZTogRXJyb3JUeXBlKTogYm9vbGVhbiB7XG4gIHJldHVybiBbXG4gICAgRXJyb3JUeXBlLk5FVFdPUkssXG4gICAgRXJyb3JUeXBlLlNFUlZFUl9FUlJPUixcbiAgICBFcnJvclR5cGUuQVNUUk9MT0dJQ0FMX0NBTENVTEFUSU9OLFxuICAgIEVycm9yVHlwZS5EQVRBX1BST0NFU1NJTkdcbiAgXS5pbmNsdWRlcyh0eXBlKTtcbn1cblxuLy8gRXJyb3IgY2xhc3NpZmljYXRpb24gYmFzZWQgb24gZXJyb3IgbWVzc2FnZSBvciB0eXBlXG5leHBvcnQgZnVuY3Rpb24gY2xhc3NpZnlFcnJvcihlcnJvcjogRXJyb3IgfCBzdHJpbmcpOiBFcnJvclR5cGUge1xuICBjb25zdCBtZXNzYWdlID0gdHlwZW9mIGVycm9yID09PSAnc3RyaW5nJyA/IGVycm9yIDogZXJyb3IubWVzc2FnZTtcbiAgY29uc3QgbG93ZXJNZXNzYWdlID0gbWVzc2FnZS50b0xvd2VyQ2FzZSgpO1xuICBcbiAgaWYgKGxvd2VyTWVzc2FnZS5pbmNsdWRlcygnbmV0d29yaycpIHx8IGxvd2VyTWVzc2FnZS5pbmNsdWRlcygnZmV0Y2gnKSB8fCBsb3dlck1lc3NhZ2UuaW5jbHVkZXMoJ2Nvbm5lY3Rpb24nKSkge1xuICAgIHJldHVybiBFcnJvclR5cGUuTkVUV09SSztcbiAgfVxuICBcbiAgaWYgKGxvd2VyTWVzc2FnZS5pbmNsdWRlcygndmFsaWRhdGlvbicpIHx8IGxvd2VyTWVzc2FnZS5pbmNsdWRlcygnaW52YWxpZCcpKSB7XG4gICAgcmV0dXJuIEVycm9yVHlwZS5WQUxJREFUSU9OO1xuICB9XG4gIFxuICBpZiAobG93ZXJNZXNzYWdlLmluY2x1ZGVzKCd1bmF1dGhvcml6ZWQnKSB8fCBsb3dlck1lc3NhZ2UuaW5jbHVkZXMoJ2F1dGhlbnRpY2F0aW9uJykpIHtcbiAgICByZXR1cm4gRXJyb3JUeXBlLkFVVEhFTlRJQ0FUSU9OO1xuICB9XG4gIFxuICBpZiAobG93ZXJNZXNzYWdlLmluY2x1ZGVzKCdmb3JiaWRkZW4nKSB8fCBsb3dlck1lc3NhZ2UuaW5jbHVkZXMoJ3Blcm1pc3Npb24nKSkge1xuICAgIHJldHVybiBFcnJvclR5cGUuQVVUSE9SSVpBVElPTjtcbiAgfVxuICBcbiAgaWYgKGxvd2VyTWVzc2FnZS5pbmNsdWRlcygnbm90IGZvdW5kJykgfHwgbG93ZXJNZXNzYWdlLmluY2x1ZGVzKCc0MDQnKSkge1xuICAgIHJldHVybiBFcnJvclR5cGUuTk9UX0ZPVU5EO1xuICB9XG4gIFxuICBpZiAobG93ZXJNZXNzYWdlLmluY2x1ZGVzKCdzZXJ2ZXInKSB8fCBsb3dlck1lc3NhZ2UuaW5jbHVkZXMoJzUwMCcpIHx8IGxvd2VyTWVzc2FnZS5pbmNsdWRlcygnNTAzJykpIHtcbiAgICByZXR1cm4gRXJyb3JUeXBlLlNFUlZFUl9FUlJPUjtcbiAgfVxuICBcbiAgaWYgKGxvd2VyTWVzc2FnZS5pbmNsdWRlcygncGxhbmV0YXJ5JykgfHwgbG93ZXJNZXNzYWdlLmluY2x1ZGVzKCdhc3Ryb2xvZ2ljYWwnKSB8fCBsb3dlck1lc3NhZ2UuaW5jbHVkZXMoJ3pvZGlhYycpKSB7XG4gICAgcmV0dXJuIEVycm9yVHlwZS5BU1RST0xPR0lDQUxfQ0FMQ1VMQVRJT047XG4gIH1cbiAgXG4gIGlmIChsb3dlck1lc3NhZ2UuaW5jbHVkZXMoJ2NvbXBvbmVudCcpIHx8IGxvd2VyTWVzc2FnZS5pbmNsdWRlcygncmVuZGVyJykpIHtcbiAgICByZXR1cm4gRXJyb3JUeXBlLkNPTVBPTkVOVF9FUlJPUjtcbiAgfVxuICBcbiAgcmV0dXJuIEVycm9yVHlwZS5VTktOT1dOO1xufVxuXG4vLyBFcnJvciBoYW5kbGVyIGNsYXNzXG5leHBvcnQgY2xhc3MgRXJyb3JIYW5kbGVyIHtcbiAgcHJpdmF0ZSByZWNvdmVyeVN0cmF0ZWdpZXM6IEVycm9yUmVjb3ZlcnlTdHJhdGVneVtdID0gW107XG4gIHByaXZhdGUgZXJyb3JRdWV1ZTogRW5oYW5jZWRFcnJvcltdID0gW107XG4gIHByaXZhdGUgbWF4UXVldWVTaXplID0gNTA7XG5cbiAgLy8gQWRkIHJlY292ZXJ5IHN0cmF0ZWd5XG4gIGFkZFJlY292ZXJ5U3RyYXRlZ3koc3RyYXRlZ3k6IEVycm9yUmVjb3ZlcnlTdHJhdGVneSkge1xuICAgIHRoaXMucmVjb3ZlcnlTdHJhdGVnaWVzLnB1c2goc3RyYXRlZ3kpO1xuICB9XG5cbiAgLy8gSGFuZGxlIGVycm9yIHdpdGggcmVjb3ZlcnkgYXR0ZW1wdHNcbiAgYXN5bmMgaGFuZGxlRXJyb3IoZXJyb3I6IEVycm9yIHwgRW5oYW5jZWRFcnJvciwgY29udGV4dD86IFJlY29yZDxzdHJpbmcsIGFueT4pOiBQcm9taXNlPGFueT4ge1xuICAgIGxldCBlbmhhbmNlZEVycm9yOiBFbmhhbmNlZEVycm9yO1xuICAgIFxuICAgIGlmICgndHlwZScgaW4gZXJyb3IgJiYgJ3NldmVyaXR5JyBpbiBlcnJvcikge1xuICAgICAgZW5oYW5jZWRFcnJvciA9IGVycm9yIGFzIEVuaGFuY2VkRXJyb3I7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IHR5cGUgPSBjbGFzc2lmeUVycm9yKGVycm9yKTtcbiAgICAgIGNvbnN0IHNldmVyaXR5ID0gdGhpcy5kZXRlcm1pbmVTZXZlcml0eSh0eXBlKTtcbiAgICAgIGVuaGFuY2VkRXJyb3IgPSBjcmVhdGVFbmhhbmNlZEVycm9yKGVycm9yLm1lc3NhZ2UsIHR5cGUsIHNldmVyaXR5LCBjb250ZXh0LCBlcnJvcik7XG4gICAgfVxuXG4gICAgLy8gTG9nIHRoZSBlcnJvclxuICAgIHRoaXMubG9nRXJyb3IoZW5oYW5jZWRFcnJvcik7XG4gICAgXG4gICAgLy8gQWRkIHRvIGVycm9yIHF1ZXVlXG4gICAgdGhpcy5hZGRUb1F1ZXVlKGVuaGFuY2VkRXJyb3IpO1xuICAgIFxuICAgIC8vIEF0dGVtcHQgcmVjb3ZlcnlcbiAgICBjb25zdCByZWNvdmVyeVJlc3VsdCA9IGF3YWl0IHRoaXMuYXR0ZW1wdFJlY292ZXJ5KGVuaGFuY2VkRXJyb3IpO1xuICAgIFxuICAgIGlmIChyZWNvdmVyeVJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICBsb2dnZXIuaW5mbyhgRXJyb3IgcmVjb3ZlcmVkIHN1Y2Nlc3NmdWxseTogJHtlbmhhbmNlZEVycm9yLmVycm9ySWR9YCk7XG4gICAgICByZXR1cm4gcmVjb3ZlcnlSZXN1bHQuZGF0YTtcbiAgICB9XG4gICAgXG4gICAgLy8gSWYgcmVjb3ZlcnkgZmFpbGVkLCB0aHJvdyB0aGUgZW5oYW5jZWQgZXJyb3JcbiAgICB0aHJvdyBlbmhhbmNlZEVycm9yO1xuICB9XG5cbiAgLy8gQXR0ZW1wdCBlcnJvciByZWNvdmVyeVxuICBwcml2YXRlIGFzeW5jIGF0dGVtcHRSZWNvdmVyeShlcnJvcjogRW5oYW5jZWRFcnJvcik6IFByb21pc2U8eyBzdWNjZXNzOiBib29sZWFuOyBkYXRhPzogYW55IH0+IHtcbiAgICBmb3IgKGNvbnN0IHN0cmF0ZWd5IG9mIHRoaXMucmVjb3ZlcnlTdHJhdGVnaWVzKSB7XG4gICAgICBpZiAoc3RyYXRlZ3kuY2FuUmVjb3ZlcihlcnJvcikpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzdHJhdGVneS5yZWNvdmVyKGVycm9yKTtcbiAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBkYXRhOiByZXN1bHQgfTtcbiAgICAgICAgfSBjYXRjaCAocmVjb3ZlcnlFcnJvcikge1xuICAgICAgICAgIGxvZ2dlci53YXJuKGBSZWNvdmVyeSBzdHJhdGVneSBmYWlsZWQgZm9yIGVycm9yICR7ZXJyb3IuZXJyb3JJZH06YCwgcmVjb3ZlcnlFcnJvcik7XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gVHJ5IGZhbGxiYWNrIGlmIGF2YWlsYWJsZVxuICAgICAgICAgIGlmIChzdHJhdGVneS5mYWxsYmFjaykge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgY29uc3QgZmFsbGJhY2tSZXN1bHQgPSBzdHJhdGVneS5mYWxsYmFjaygpO1xuICAgICAgICAgICAgICByZXR1cm4geyBzdWNjZXNzOiB0cnVlLCBkYXRhOiBmYWxsYmFja1Jlc3VsdCB9O1xuICAgICAgICAgICAgfSBjYXRjaCAoZmFsbGJhY2tFcnJvcikge1xuICAgICAgICAgICAgICBsb2dnZXIud2FybihgRmFsbGJhY2sgc3RyYXRlZ3kgZmFpbGVkIGZvciBlcnJvciAke2Vycm9yLmVycm9ySWR9OmAsIGZhbGxiYWNrRXJyb3IpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSB9O1xuICB9XG5cbiAgLy8gRGV0ZXJtaW5lIGVycm9yIHNldmVyaXR5XG4gIHByaXZhdGUgZGV0ZXJtaW5lU2V2ZXJpdHkodHlwZTogRXJyb3JUeXBlKTogRXJyb3JTZXZlcml0eSB7XG4gICAgc3dpdGNoICh0eXBlKSB7XG4gICAgICBjYXNlIEVycm9yVHlwZS5BVVRIRU5USUNBVElPTjpcbiAgICAgIGNhc2UgRXJyb3JUeXBlLkFVVEhPUklaQVRJT046XG4gICAgICAgIHJldHVybiBFcnJvclNldmVyaXR5LkhJR0g7XG4gICAgICBcbiAgICAgIGNhc2UgRXJyb3JUeXBlLlNFUlZFUl9FUlJPUjpcbiAgICAgICAgcmV0dXJuIEVycm9yU2V2ZXJpdHkuSElHSDtcbiAgICAgIFxuICAgICAgY2FzZSBFcnJvclR5cGUuTkVUV09SSzpcbiAgICAgIGNhc2UgRXJyb3JUeXBlLkFTVFJPTE9HSUNBTF9DQUxDVUxBVElPTjpcbiAgICAgICAgcmV0dXJuIEVycm9yU2V2ZXJpdHkuTUVESVVNO1xuICAgICAgXG4gICAgICBjYXNlIEVycm9yVHlwZS5WQUxJREFUSU9OOlxuICAgICAgY2FzZSBFcnJvclR5cGUuTk9UX0ZPVU5EOlxuICAgICAgICByZXR1cm4gRXJyb3JTZXZlcml0eS5MT1c7XG4gICAgICBcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybiBFcnJvclNldmVyaXR5Lk1FRElVTTtcbiAgICB9XG4gIH1cblxuICAvLyBMb2cgZXJyb3Igd2l0aCBhcHByb3ByaWF0ZSBsZXZlbFxuICBwcml2YXRlIGxvZ0Vycm9yKGVycm9yOiBFbmhhbmNlZEVycm9yKSB7XG4gICAgY29uc3QgbG9nRGF0YSA9IHtcbiAgICAgIGVycm9ySWQ6IGVycm9yLmVycm9ySWQsXG4gICAgICB0eXBlOiBlcnJvci50eXBlLFxuICAgICAgc2V2ZXJpdHk6IGVycm9yLnNldmVyaXR5LFxuICAgICAgbWVzc2FnZTogZXJyb3IubWVzc2FnZSxcbiAgICAgIHVzZXJNZXNzYWdlOiBlcnJvci51c2VyTWVzc2FnZSxcbiAgICAgIGNvbnRleHQ6IGVycm9yLmNvbnRleHQsXG4gICAgICB0aW1lc3RhbXA6IGVycm9yLnRpbWVzdGFtcCxcbiAgICAgIHN0YWNrOiBlcnJvci5zdGFja1xuICAgIH07XG5cbiAgICBzd2l0Y2ggKGVycm9yLnNldmVyaXR5KSB7XG4gICAgICBjYXNlIEVycm9yU2V2ZXJpdHkuQ1JJVElDQUw6XG4gICAgICBjYXNlIEVycm9yU2V2ZXJpdHkuSElHSDpcbiAgICAgICAgbG9nZ2VyLmVycm9yKCdIaWdoIHNldmVyaXR5IGVycm9yOicsIGxvZ0RhdGEpO1xuICAgICAgICBicmVhaztcbiAgICAgIFxuICAgICAgY2FzZSBFcnJvclNldmVyaXR5Lk1FRElVTTpcbiAgICAgICAgbG9nZ2VyLndhcm4oJ01lZGl1bSBzZXZlcml0eSBlcnJvcjonLCBsb2dEYXRhKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBcbiAgICAgIGNhc2UgRXJyb3JTZXZlcml0eS5MT1c6XG4gICAgICAgIGxvZ2dlci5pbmZvKCdMb3cgc2V2ZXJpdHkgZXJyb3I6JywgbG9nRGF0YSk7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuXG4gIC8vIEFkZCBlcnJvciB0byBxdWV1ZSBmb3IgYW5hbHlzaXNcbiAgcHJpdmF0ZSBhZGRUb1F1ZXVlKGVycm9yOiBFbmhhbmNlZEVycm9yKSB7XG4gICAgdGhpcy5lcnJvclF1ZXVlLnB1c2goZXJyb3IpO1xuICAgIFxuICAgIC8vIE1haW50YWluIHF1ZXVlIHNpemVcbiAgICBpZiAodGhpcy5lcnJvclF1ZXVlLmxlbmd0aCA+IHRoaXMubWF4UXVldWVTaXplKSB7XG4gICAgICB0aGlzLmVycm9yUXVldWUuc2hpZnQoKTtcbiAgICB9XG4gIH1cblxuICAvLyBHZXQgZXJyb3Igc3RhdGlzdGljc1xuICBnZXRFcnJvclN0YXRzKCk6IHtcbiAgICB0b3RhbDogbnVtYmVyO1xuICAgIGJ5VHlwZTogUmVjb3JkPEVycm9yVHlwZSwgbnVtYmVyPjtcbiAgICBieVNldmVyaXR5OiBSZWNvcmQ8RXJyb3JTZXZlcml0eSwgbnVtYmVyPjtcbiAgICByZWNlbnQ6IEVuaGFuY2VkRXJyb3JbXTtcbiAgfSB7XG4gICAgY29uc3QgYnlUeXBlID0ge30gYXMgUmVjb3JkPEVycm9yVHlwZSwgbnVtYmVyPjtcbiAgICBjb25zdCBieVNldmVyaXR5ID0ge30gYXMgUmVjb3JkPEVycm9yU2V2ZXJpdHksIG51bWJlcj47XG4gICAgXG4gICAgdGhpcy5lcnJvclF1ZXVlLmZvckVhY2goZXJyb3IgPT4ge1xuICAgICAgYnlUeXBlW2Vycm9yLnR5cGVdID0gKGJ5VHlwZVtlcnJvci50eXBlXSB8fCAwKSArIDE7XG4gICAgICBieVNldmVyaXR5W2Vycm9yLnNldmVyaXR5XSA9IChieVNldmVyaXR5W2Vycm9yLnNldmVyaXR5XSB8fCAwKSArIDE7XG4gICAgfSk7XG4gICAgXG4gICAgcmV0dXJuIHtcbiAgICAgIHRvdGFsOiB0aGlzLmVycm9yUXVldWUubGVuZ3RoLFxuICAgICAgYnlUeXBlLFxuICAgICAgYnlTZXZlcml0eSxcbiAgICAgIHJlY2VudDogdGhpcy5lcnJvclF1ZXVlLnNsaWNlKC0xMCkgLy8gTGFzdCAxMCBlcnJvcnNcbiAgICB9O1xuICB9XG5cbiAgLy8gQ2xlYXIgZXJyb3IgcXVldWVcbiAgY2xlYXJFcnJvclF1ZXVlKCkge1xuICAgIHRoaXMuZXJyb3JRdWV1ZSA9IFtdO1xuICB9XG59XG5cbi8vIEdsb2JhbCBlcnJvciBoYW5kbGVyIGluc3RhbmNlXG5leHBvcnQgY29uc3QgZ2xvYmFsRXJyb3JIYW5kbGVyID0gbmV3IEVycm9ySGFuZGxlcigpO1xuXG4vLyBEZWZhdWx0IHJlY292ZXJ5IHN0cmF0ZWdpZXNcbmdsb2JhbEVycm9ySGFuZGxlci5hZGRSZWNvdmVyeVN0cmF0ZWd5KHtcbiAgY2FuUmVjb3ZlcjogKGVycm9yKSA9PiBlcnJvci50eXBlID09PSBFcnJvclR5cGUuQVNUUk9MT0dJQ0FMX0NBTENVTEFUSU9OLFxuICByZWNvdmVyOiBhc3luYyAoZXJyb3IpID0+IHtcbiAgICBsb2dnZXIuaW5mbyhgQXR0ZW1wdGluZyB0byByZWNvdmVyIGZyb20gYXN0cm9sb2dpY2FsIGNhbGN1bGF0aW9uIGVycm9yOiAke2Vycm9yLmVycm9ySWR9YCk7XG4gICAgLy8gUmV0dXJuIGNhY2hlZCBhc3Ryb2xvZ2ljYWwgZGF0YVxuICAgIGNvbnN0IGNhY2hlZERhdGEgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnY2FjaGVkQXN0cm9sb2dpY2FsRGF0YScpO1xuICAgIGlmIChjYWNoZWREYXRhKSB7XG4gICAgICByZXR1cm4gSlNPTi5wYXJzZShjYWNoZWREYXRhKTtcbiAgICB9XG4gICAgdGhyb3cgbmV3IEVycm9yKCdObyBjYWNoZWQgYXN0cm9sb2dpY2FsIGRhdGEgYXZhaWxhYmxlJyk7XG4gIH0sXG4gIGZhbGxiYWNrOiAoKSA9PiB7XG4gICAgLy8gUmV0dXJuIGRlZmF1bHQgYXN0cm9sb2dpY2FsIHN0YXRlXG4gICAgcmV0dXJuIHtcbiAgICAgIHpvZGlhY1NpZ246ICdhcmllcycsXG4gICAgICBsdW5hclBoYXNlOiAnbmV3IG1vb24nLFxuICAgICAgZWxlbWVudGFsU3RhdGU6IHsgRmlyZTogMC4yNSwgV2F0ZXI6IDAuMjUsIEVhcnRoOiAwLjI1LCBBaXI6IDAuMjUgfVxuICAgIH07XG4gIH1cbn0pO1xuXG5nbG9iYWxFcnJvckhhbmRsZXIuYWRkUmVjb3ZlcnlTdHJhdGVneSh7XG4gIGNhblJlY292ZXI6IChlcnJvcikgPT4gZXJyb3IudHlwZSA9PT0gRXJyb3JUeXBlLk5FVFdPUkssXG4gIHJlY292ZXI6IGFzeW5jIChlcnJvcikgPT4ge1xuICAgIGxvZ2dlci5pbmZvKGBBdHRlbXB0aW5nIHRvIHJlY292ZXIgZnJvbSBuZXR3b3JrIGVycm9yOiAke2Vycm9yLmVycm9ySWR9YCk7XG4gICAgLy8gVHJ5IHRvIHVzZSBjYWNoZWQgZGF0YVxuICAgIGNvbnN0IGNhY2hlS2V5ID0gZXJyb3IuY29udGV4dD8uY2FjaGVLZXk7XG4gICAgaWYgKGNhY2hlS2V5KSB7XG4gICAgICBjb25zdCBjYWNoZWREYXRhID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oY2FjaGVLZXkpO1xuICAgICAgaWYgKGNhY2hlZERhdGEpIHtcbiAgICAgICAgcmV0dXJuIEpTT04ucGFyc2UoY2FjaGVkRGF0YSk7XG4gICAgICB9XG4gICAgfVxuICAgIHRocm93IG5ldyBFcnJvcignTm8gY2FjaGVkIGRhdGEgYXZhaWxhYmxlIGZvciBuZXR3b3JrIHJlY292ZXJ5Jyk7XG4gIH1cbn0pO1xuXG4vLyBVdGlsaXR5IGZ1bmN0aW9ucyBmb3IgY29tbW9uIGVycm9yIHNjZW5hcmlvc1xuZXhwb3J0IGZ1bmN0aW9uIGhhbmRsZUFzeW5jRXJyb3I8VD4oXG4gIHByb21pc2U6IFByb21pc2U8VD4sXG4gIGNvbnRleHQ/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+XG4pOiBQcm9taXNlPFQ+IHtcbiAgcmV0dXJuIHByb21pc2UuY2F0Y2goZXJyb3IgPT4ge1xuICAgIHJldHVybiBnbG9iYWxFcnJvckhhbmRsZXIuaGFuZGxlRXJyb3IoZXJyb3IsIGNvbnRleHQpO1xuICB9KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGhhbmRsZVN5bmNFcnJvcjxUPihcbiAgZm46ICgpID0+IFQsXG4gIGNvbnRleHQ/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+XG4pOiBUIHtcbiAgdHJ5IHtcbiAgICByZXR1cm4gZm4oKTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICB0aHJvdyBnbG9iYWxFcnJvckhhbmRsZXIuaGFuZGxlRXJyb3IoZXJyb3IgYXMgRXJyb3IsIGNvbnRleHQpO1xuICB9XG59XG5cbi8vIFJlYWN0IGhvb2sgZm9yIGVycm9yIGhhbmRsaW5nXG5leHBvcnQgZnVuY3Rpb24gdXNlRXJyb3JIYW5kbGVyKCkge1xuICBjb25zdCBoYW5kbGVFcnJvciA9IFJlYWN0LnVzZUNhbGxiYWNrKGFzeW5jIChlcnJvcjogRXJyb3IsIGNvbnRleHQ/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+KSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIHJldHVybiBhd2FpdCBnbG9iYWxFcnJvckhhbmRsZXIuaGFuZGxlRXJyb3IoZXJyb3IsIGNvbnRleHQpO1xuICAgIH0gY2F0Y2ggKGVuaGFuY2VkRXJyb3IpIHtcbiAgICAgIC8vIFJlLXRocm93IGVuaGFuY2VkIGVycm9yIGZvciBjb21wb25lbnQgZXJyb3IgYm91bmRhcmllcyB0byBjYXRjaFxuICAgICAgdGhyb3cgZW5oYW5jZWRFcnJvcjtcbiAgICB9XG4gIH0sIFtdKTtcblxuICBjb25zdCBnZXRFcnJvclN0YXRzID0gUmVhY3QudXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgIHJldHVybiBnbG9iYWxFcnJvckhhbmRsZXIuZ2V0RXJyb3JTdGF0cygpO1xuICB9LCBbXSk7XG5cbiAgcmV0dXJuIHsgaGFuZGxlRXJyb3IsIGdldEVycm9yU3RhdHMgfTtcbn1cblxuLy8gRXJyb3IgYm91bmRhcnkgaGVscGVyIGZvciBzcGVjaWZpYyBlcnJvciB0eXBlc1xuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZUVycm9yQm91bmRhcnlGb3JUeXBlKGVycm9yVHlwZTogRXJyb3JUeXBlKSB7XG4gIHJldHVybiBmdW5jdGlvbiBFcnJvckJvdW5kYXJ5Rm9yVHlwZSh7IGNoaWxkcmVuIH06IHsgY2hpbGRyZW46IFJlYWN0LlJlYWN0Tm9kZSB9KSB7XG4gICAgcmV0dXJuIFJlYWN0LmNyZWF0ZUVsZW1lbnQoRXJyb3JCb3VuZGFyeSwge1xuICAgICAgZmFsbGJhY2s6IChlcnJvcjogRXJyb3IsIGVycm9ySW5mbzogUmVhY3QuRXJyb3JJbmZvKSA9PiB7XG4gICAgICAgIGNvbnN0IGVuaGFuY2VkRXJyb3IgPSBjcmVhdGVFbmhhbmNlZEVycm9yKFxuICAgICAgICAgIGVycm9yLm1lc3NhZ2UsXG4gICAgICAgICAgZXJyb3JUeXBlLFxuICAgICAgICAgIEVycm9yU2V2ZXJpdHkuTUVESVVNLFxuICAgICAgICAgIHsgY29tcG9uZW50U3RhY2s6IGVycm9ySW5mby5jb21wb25lbnRTdGFjayB9XG4gICAgICAgICk7XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gUmVhY3QuY3JlYXRlRWxlbWVudCgnZGl2Jywge1xuICAgICAgICAgIGNsYXNzTmFtZTogXCJiZy15ZWxsb3ctNTAgYm9yZGVyIGJvcmRlci15ZWxsb3ctMjAwIHJvdW5kZWQtbGcgcC00IG0tMlwiXG4gICAgICAgIH0sIFtcbiAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCdoNCcsIHtcbiAgICAgICAgICAgIGtleTogJ3RpdGxlJyxcbiAgICAgICAgICAgIGNsYXNzTmFtZTogXCJ0ZXh0LXllbGxvdy04MDAgZm9udC1tZWRpdW0gbWItMlwiXG4gICAgICAgICAgfSwgYCR7ZXJyb3JUeXBlfSBFcnJvcmApLFxuICAgICAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoJ3AnLCB7XG4gICAgICAgICAgICBrZXk6ICdtZXNzYWdlJyxcbiAgICAgICAgICAgIGNsYXNzTmFtZTogXCJ0ZXh0LXllbGxvdy03MDAgdGV4dC1zbSBtYi0zXCJcbiAgICAgICAgICB9LCBlbmhhbmNlZEVycm9yLnVzZXJNZXNzYWdlKSxcbiAgICAgICAgICBSZWFjdC5jcmVhdGVFbGVtZW50KCdidXR0b24nLCB7XG4gICAgICAgICAgICBrZXk6ICdidXR0b24nLFxuICAgICAgICAgICAgb25DbGljazogKCkgPT4gd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpLFxuICAgICAgICAgICAgY2xhc3NOYW1lOiBcImJnLXllbGxvdy02MDAgdGV4dC13aGl0ZSBweC0zIHB5LTEgcm91bmRlZCB0ZXh0LXNtIGhvdmVyOmJnLXllbGxvdy03MDAgdHJhbnNpdGlvbi1jb2xvcnNcIlxuICAgICAgICAgIH0sICdSZWxvYWQgUGFnZScpXG4gICAgICAgIF0pO1xuICAgICAgfVxuICAgIH0sIGNoaWxkcmVuKTtcbiAgfTtcbn1cblxuZXhwb3J0IGRlZmF1bHQgRXJyb3JIYW5kbGVyOyJdLCJ2ZXJzaW9uIjozfQ==