ddeaa4ae9d03f46ab95d271ba0224589
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
// Mock the dependencies
jest.mock('../BuildPerformanceMonitor', () => ({
    buildPerformanceMonitor: {
        subscribe: jest.fn(),
        getPerformanceSummary: jest.fn(() => ({
            averageBuildTime: 45000,
            averageCompilationTime: 30000,
            averageBundleSize: 3 * 1024 * 1024,
            averageMemoryUsage: 256 * 1024 * 1024,
            cacheEfficiency: 85,
            performanceScore: 75
        }))
    }
}));
jest.mock('../ErrorTrackingSystem', () => ({
    errorTrackingSystem: {
        subscribe: jest.fn(),
        getErrorSummary: jest.fn(() => ({
            totalActiveErrors: 150,
            totalActiveLintViolations: 300,
            totalRecentFailures: 2,
            criticalIssues: 5,
            automationOpportunities: 10
        })),
        getCurrentQualityMetrics: jest.fn(() => ({
            codeQualityScore: 75,
            technicalDebtScore: 45,
            maintainabilityIndex: 80,
            errorRate: 0.05,
            warningRate: 0.1
        }))
    }
}));
jest.mock('../QualityMetricsService', () => ({
    qualityMetricsService: {
        subscribe: jest.fn()
    }
}));
const AlertingSystem_1 = __importDefault(require("../AlertingSystem"));
describe('AlertingSystem', () => {
    let alertingSystem;
    let mockSubscriber;
    beforeEach(() => {
        // Clear all mocks
        jest.clearAllMocks();
        // Create a new instance for each test
        alertingSystem = new AlertingSystem_1.default();
        // Reset the instance to ensure clean state
        alertingSystem.reset();
        // Mock subscriber
        mockSubscriber = jest.fn();
        alertingSystem.subscribe(mockSubscriber);
    });
    afterEach(() => {
        if (alertingSystem) {
            alertingSystem.reset();
        }
    });
    describe('Alert Rule Management', () => {
        test('should add new alert rule', () => {
            const rule = {
                name: 'Test Rule',
                description: 'Test alert rule',
                type: 'performance',
                metric: 'build_time',
                condition: 'greater_than',
                threshold: 60000,
                severity: 'warning',
                enabled: true,
                cooldownMinutes: 10,
                escalationMinutes: 30,
                autoResponse: false,
                responseActions: [],
                notificationChannels: ['console']
            };
            const ruleId = alertingSystem.addAlertRule(rule);
            expect(ruleId).toBeDefined();
            expect(ruleId).toMatch(/^rule-\d+$/);
            const rules = alertingSystem.getAlertRules();
            const addedRule = rules.find(r => r.id === ruleId);
            expect(addedRule).toBeDefined();
            expect(addedRule === null || addedRule === void 0 ? void 0 : addedRule.name).toBe('Test Rule');
        });
        test('should update existing alert rule', () => {
            const rule = {
                name: 'Test Rule',
                description: 'Test alert rule',
                type: 'performance',
                metric: 'build_time',
                condition: 'greater_than',
                threshold: 60000,
                severity: 'warning',
                enabled: true,
                cooldownMinutes: 10,
                escalationMinutes: 30,
                autoResponse: false,
                responseActions: [],
                notificationChannels: ['console']
            };
            const ruleId = alertingSystem.addAlertRule(rule);
            const updated = alertingSystem.updateAlertRule(ruleId, {
                threshold: 90000,
                severity: 'error'
            });
            expect(updated).toBe(true);
            const rules = alertingSystem.getAlertRules();
            const updatedRule = rules.find(r => r.id === ruleId);
            expect(updatedRule === null || updatedRule === void 0 ? void 0 : updatedRule.threshold).toBe(90000);
            expect(updatedRule === null || updatedRule === void 0 ? void 0 : updatedRule.severity).toBe('error');
        });
        test('should delete alert rule', () => {
            const rule = {
                name: 'Test Rule',
                description: 'Test alert rule',
                type: 'performance',
                metric: 'build_time',
                condition: 'greater_than',
                threshold: 60000,
                severity: 'warning',
                enabled: true,
                cooldownMinutes: 10,
                escalationMinutes: 30,
                autoResponse: false,
                responseActions: [],
                notificationChannels: ['console']
            };
            const ruleId = alertingSystem.addAlertRule(rule);
            const deleted = alertingSystem.deleteAlertRule(ruleId);
            expect(deleted).toBe(true);
            const rules = alertingSystem.getAlertRules();
            const deletedRule = rules.find(r => r.id === ruleId);
            expect(deletedRule).toBeUndefined();
        });
    });
    describe('Alert Generation', () => {
        test('should create alert when threshold is exceeded', () => {
            // Add a rule that should trigger based on mocked data
            const ruleId = alertingSystem.addAlertRule({
                name: 'High Error Count',
                description: 'Too many TypeScript errors',
                type: 'error',
                metric: 'typescript_errors',
                condition: 'greater_than',
                threshold: 100,
                severity: 'warning',
                enabled: true,
                cooldownMinutes: 5,
                escalationMinutes: 15,
                autoResponse: false,
                responseActions: [],
                notificationChannels: ['console']
            });
            // Manually trigger rule evaluation (in real system this happens automatically)
            const rule = alertingSystem.getAlertRules().find(r => r.id === ruleId);
            if (rule) {
                alertingSystem.evaluateRule(rule);
            }
            // Check if alert was created
            const alerts = alertingSystem.getAlerts({ resolved: false });
            expect(alerts.length).toBeGreaterThan(0);
            const alert = alerts.find(a => a.title === 'High Error Count');
            expect(alert).toBeDefined();
            expect(alert === null || alert === void 0 ? void 0 : alert.currentValue).toBe(150);
            expect(alert === null || alert === void 0 ? void 0 : alert.threshold).toBe(100);
            expect(alert === null || alert === void 0 ? void 0 : alert.severity).toBe('warning');
        });
        test('should not create alert when threshold is not exceeded', () => {
            // Add a rule that should NOT trigger based on mocked data
            const ruleId = alertingSystem.addAlertRule({
                name: 'Very High Error Count',
                description: 'Extremely high TypeScript errors',
                type: 'error',
                metric: 'typescript_errors',
                condition: 'greater_than',
                threshold: 1000,
                severity: 'critical',
                enabled: true,
                cooldownMinutes: 5,
                escalationMinutes: 15,
                autoResponse: false,
                responseActions: [],
                notificationChannels: ['console']
            });
            // Manually trigger rule evaluation
            const rule = alertingSystem.getAlertRules().find(r => r.id === ruleId);
            if (rule) {
                alertingSystem.evaluateRule(rule);
            }
            // Check that no alert was created for this rule
            const alerts = alertingSystem.getAlerts({ resolved: false });
            const alert = alerts.find(a => a.title === 'Very High Error Count');
            expect(alert).toBeUndefined();
        });
        test('should respect cooldown period', () => {
            const ruleId = alertingSystem.addAlertRule({
                name: 'Cooldown Test',
                description: 'Test cooldown functionality',
                type: 'error',
                metric: 'typescript_errors',
                condition: 'greater_than',
                threshold: 100,
                severity: 'warning',
                enabled: true,
                cooldownMinutes: 0.01,
                escalationMinutes: 120,
                autoResponse: false,
                responseActions: [],
                notificationChannels: ['console']
            });
            const rule = alertingSystem.getAlertRules().find(r => r.id === ruleId);
            if (rule) {
                // First evaluation should create alert
                alertingSystem.evaluateRule(rule);
                // Second evaluation should be blocked by cooldown (immediate)
                alertingSystem.evaluateRule(rule);
            }
            // Should only have one alert despite two evaluations
            const alerts = alertingSystem.getAlerts({ resolved: false });
            const cooldownAlerts = alerts.filter(a => a.title === 'Cooldown Test');
            expect(cooldownAlerts.length).toBe(1);
        });
    });
    describe('Alert Management', () => {
        test('should acknowledge alert', () => {
            // Create an alert first
            const ruleId = alertingSystem.addAlertRule({
                name: 'Test Alert',
                description: 'Test alert for acknowledgment',
                type: 'error',
                metric: 'typescript_errors',
                condition: 'greater_than',
                threshold: 100,
                severity: 'warning',
                enabled: true,
                cooldownMinutes: 5,
                escalationMinutes: 15,
                autoResponse: false,
                responseActions: [],
                notificationChannels: ['console']
            });
            const rule = alertingSystem.getAlertRules().find(r => r.id === ruleId);
            if (rule) {
                alertingSystem.evaluateRule(rule);
            }
            const alerts = alertingSystem.getAlerts({ resolved: false });
            const alert = alerts.find(a => a.title === 'Test Alert');
            expect(alert).toBeDefined();
            expect(alert === null || alert === void 0 ? void 0 : alert.acknowledged).toBe(false);
            // Acknowledge the alert
            const acknowledged = alertingSystem.acknowledgeAlert(alert.id);
            expect(acknowledged).toBe(true);
            // Check that alert is now acknowledged
            const updatedAlerts = alertingSystem.getAlerts({ resolved: false });
            const acknowledgedAlert = updatedAlerts.find(a => a.id === alert.id);
            expect(acknowledgedAlert === null || acknowledgedAlert === void 0 ? void 0 : acknowledgedAlert.acknowledged).toBe(true);
        });
        test('should resolve alert', () => {
            // Create an alert first
            const ruleId = alertingSystem.addAlertRule({
                name: 'Test Alert',
                description: 'Test alert for resolution',
                type: 'error',
                metric: 'typescript_errors',
                condition: 'greater_than',
                threshold: 100,
                severity: 'warning',
                enabled: true,
                cooldownMinutes: 5,
                escalationMinutes: 15,
                autoResponse: false,
                responseActions: [],
                notificationChannels: ['console']
            });
            const rule = alertingSystem.getAlertRules().find(r => r.id === ruleId);
            if (rule) {
                alertingSystem.evaluateRule(rule);
            }
            const alerts = alertingSystem.getAlerts({ resolved: false });
            const alert = alerts.find(a => a.title === 'Test Alert');
            expect(alert).toBeDefined();
            expect(alert === null || alert === void 0 ? void 0 : alert.resolved).toBe(false);
            // Resolve the alert
            const resolved = alertingSystem.resolveAlert(alert.id);
            expect(resolved).toBe(true);
            // Check that alert is now resolved
            const unresolvedAlerts = alertingSystem.getAlerts({ resolved: false });
            const unresolvedAlert = unresolvedAlerts.find(a => a.id === alert.id);
            expect(unresolvedAlert).toBeUndefined();
            const resolvedAlerts = alertingSystem.getAlerts({ resolved: true });
            const resolvedAlert = resolvedAlerts.find(a => a.id === alert.id);
            expect(resolvedAlert === null || resolvedAlert === void 0 ? void 0 : resolvedAlert.resolved).toBe(true);
            expect(resolvedAlert === null || resolvedAlert === void 0 ? void 0 : resolvedAlert.resolvedAt).toBeDefined();
        });
    });
    describe('Alert Filtering', () => {
        beforeEach(() => {
            // Create multiple alerts for testing
            const rules = [
                {
                    name: 'Performance Alert',
                    type: 'performance',
                    severity: 'warning',
                    metric: 'build_time',
                    threshold: 30000
                },
                {
                    name: 'Error Alert',
                    type: 'error',
                    severity: 'error',
                    metric: 'typescript_errors',
                    threshold: 100
                },
                {
                    name: 'Critical Quality Alert',
                    type: 'quality',
                    severity: 'critical',
                    metric: 'code_quality_score',
                    threshold: 80 // Mock returns 75, so this should trigger with less_than condition
                }
            ];
            for (const ruleConfig of rules) {
                const ruleId = alertingSystem.addAlertRule({
                    ...ruleConfig,
                    description: `Test ${ruleConfig.name}`,
                    condition: ruleConfig.type === 'quality' ? 'less_than' : 'greater_than',
                    enabled: true,
                    cooldownMinutes: 5,
                    escalationMinutes: 15,
                    autoResponse: false,
                    responseActions: [],
                    notificationChannels: ['console']
                });
                const rule = alertingSystem.getAlertRules().find(r => r.id === ruleId);
                if (rule) {
                    alertingSystem.evaluateRule(rule);
                }
            }
        });
        test('should filter alerts by type', () => {
            const performanceAlerts = alertingSystem.getAlerts({ type: 'performance' });
            expect(performanceAlerts.length).toBe(1);
            expect(performanceAlerts[0].type).toBe('performance');
            const errorAlerts = alertingSystem.getAlerts({ type: 'error' });
            expect(errorAlerts.length).toBe(1);
            expect(errorAlerts[0].type).toBe('error');
        });
        test('should filter alerts by severity', () => {
            const criticalAlerts = alertingSystem.getAlerts({ severity: 'critical' });
            expect(criticalAlerts.length).toBe(1);
            expect(criticalAlerts[0].severity).toBe('critical');
            const warningAlerts = alertingSystem.getAlerts({ severity: 'warning' });
            expect(warningAlerts.length).toBe(1);
            expect(warningAlerts[0].severity).toBe('warning');
        });
        test('should limit number of alerts returned', () => {
            const limitedAlerts = alertingSystem.getAlerts({ limit: 2 });
            expect(limitedAlerts.length).toBe(2);
        });
    });
    describe('Alert Summary', () => {
        test('should provide accurate alert summary', () => {
            // Create some test alerts
            const ruleId = alertingSystem.addAlertRule({
                name: 'Summary Test Alert',
                description: 'Test alert for summary',
                type: 'error',
                metric: 'typescript_errors',
                condition: 'greater_than',
                threshold: 100,
                severity: 'critical',
                enabled: true,
                cooldownMinutes: 5,
                escalationMinutes: 15,
                autoResponse: false,
                responseActions: [],
                notificationChannels: ['console']
            });
            const rule = alertingSystem.getAlertRules().find(r => r.id === ruleId);
            if (rule) {
                alertingSystem.evaluateRule(rule);
            }
            const summary = alertingSystem.getAlertSummary();
            expect(summary.totalAlerts).toBeGreaterThan(0);
            expect(summary.unresolvedAlerts).toBeGreaterThan(0);
            expect(summary.criticalAlerts).toBeGreaterThan(0);
            expect(summary.alertsByType).toBeDefined();
            expect(summary.alertsBySeverity).toBeDefined();
            expect(typeof summary.responseSuccessRate).toBe('number');
            expect(typeof summary.averageResolutionTime).toBe('number');
        });
    });
    describe('Test Alert Functionality', () => {
        test('should create test alert', () => {
            const ruleId = alertingSystem.addAlertRule({
                name: 'Test Rule for Testing',
                description: 'Rule to test alert creation',
                type: 'performance',
                metric: 'build_time',
                condition: 'greater_than',
                threshold: 60000,
                severity: 'warning',
                enabled: true,
                cooldownMinutes: 5,
                escalationMinutes: 15,
                autoResponse: false,
                responseActions: [],
                notificationChannels: ['console']
            });
            const testResult = alertingSystem.testAlert(ruleId);
            expect(testResult).toBe(true);
            // Check that test alert was created
            const alerts = alertingSystem.getAlerts({ resolved: false });
            const testAlert = alerts.find(a => a.title === 'Test Rule for Testing');
            expect(testAlert).toBeDefined();
            expect(testAlert === null || testAlert === void 0 ? void 0 : testAlert.currentValue).toBe(60001); // threshold + 1
        });
        test('should return false for non-existent rule', () => {
            const testResult = alertingSystem.testAlert('non-existent-rule');
            expect(testResult).toBe(false);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9zZXJ2aWNlcy9fX3Rlc3RzX18vQWxlcnRpbmdTeXN0ZW0udGVzdC50cyIsIm1hcHBpbmdzIjoiOzs7OztBQUVBLHdCQUF3QjtBQUN4QixJQUFJLENBQUMsSUFBSSxDQUFDLDRCQUE0QixFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDN0MsdUJBQXVCLEVBQUU7UUFDdkIsU0FBUyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDcEIscUJBQXFCLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDO1lBQ3BDLGdCQUFnQixFQUFFLEtBQUs7WUFDdkIsc0JBQXNCLEVBQUUsS0FBSztZQUM3QixpQkFBaUIsRUFBRSxDQUFDLEdBQUcsSUFBSSxHQUFHLElBQUk7WUFDbEMsa0JBQWtCLEVBQUUsR0FBRyxHQUFHLElBQUksR0FBRyxJQUFJO1lBQ3JDLGVBQWUsRUFBRSxFQUFFO1lBQ25CLGdCQUFnQixFQUFFLEVBQUU7U0FDckIsQ0FBQyxDQUFDO0tBQ0o7Q0FDRixDQUFDLENBQUMsQ0FBQztBQUVKLElBQUksQ0FBQyxJQUFJLENBQUMsd0JBQXdCLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUN6QyxtQkFBbUIsRUFBRTtRQUNuQixTQUFTLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUNwQixlQUFlLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDO1lBQzlCLGlCQUFpQixFQUFFLEdBQUc7WUFDdEIseUJBQXlCLEVBQUUsR0FBRztZQUM5QixtQkFBbUIsRUFBRSxDQUFDO1lBQ3RCLGNBQWMsRUFBRSxDQUFDO1lBQ2pCLHVCQUF1QixFQUFFLEVBQUU7U0FDNUIsQ0FBQyxDQUFDO1FBQ0gsd0JBQXdCLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDO1lBQ3ZDLGdCQUFnQixFQUFFLEVBQUU7WUFDcEIsa0JBQWtC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LENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEtBQUssS0FBSyx1QkFBdUIsQ0FBQyxDQUFDO1lBQ3hFLE1BQU0sQ0FBQyxTQUFTLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztZQUNoQyxNQUFNLENBQUMsU0FBUyxhQUFULFNBQVMsdUJBQVQsU0FBUyxDQUFFLFlBQVksQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLGdCQUFnQjtRQUMvRCxDQUFDLENBQUMsQ0FBQztRQUVILElBQUksQ0FBQywyQ0FBMkMsRUFBRSxHQUFHLEVBQUU7WUFDckQsTUFBTSxVQUFVLEdBQUcsY0FBYyxDQUFDLFNBQVMsQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDO1lBQ2pFLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDakMsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9HcmVnQ2FzdHJvL0Rlc2t0b3AvV2hhdFRvRWF0TmV4dC9zcmMvc2VydmljZXMvX190ZXN0c19fL0FsZXJ0aW5nU3lzdGVtLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEFsZXJ0aW5nU3lzdGVtLCB7IEFsZXJ0LCBBbGVydFJ1bGUgfSBmcm9tICcuLi9BbGVydGluZ1N5c3RlbSc7XG5cbi8vIE1vY2sgdGhlIGRlcGVuZGVuY2llc1xuamVzdC5tb2NrKCcuLi9CdWlsZFBlcmZvcm1hbmNlTW9uaXRvcicsICgpID0+ICh7XG4gIGJ1aWxkUGVyZm9ybWFuY2VNb25pdG9yOiB7XG4gICAgc3Vic2NyaWJlOiBqZXN0LmZuKCksXG4gICAgZ2V0UGVyZm9ybWFuY2VTdW1tYXJ5OiBqZXN0LmZuKCgpID0+ICh7XG4gICAgICBhdmVyYWdlQnVpbGRUaW1lOiA0NTAwMCxcbiAgICAgIGF2ZXJhZ2VDb21waWxhdGlvblRpbWU6IDMwMDAwLFxuICAgICAgYXZlcmFnZUJ1bmRsZVNpemU6IDMgKiAxMDI0ICogMTAyNCxcbiAgICAgIGF2ZXJhZ2VNZW1vcnlVc2FnZTogMjU2ICogMTAyNCAqIDEwMjQsXG4gICAgICBjYWNoZUVmZmljaWVuY3k6IDg1LFxuICAgICAgcGVyZm9ybWFuY2VTY29yZTogNzVcbiAgICB9KSlcbiAgfVxufSkpO1xuXG5qZXN0Lm1vY2soJy4uL0Vycm9yVHJhY2tpbmdTeXN0ZW0nLCAoKSA9PiAoe1xuICBlcnJvclRyYWNraW5nU3lzdGVtOiB7XG4gICAgc3Vic2NyaWJlOiBqZXN0LmZuKCksXG4gICAgZ2V0RXJyb3JTdW1tYXJ5OiBqZXN0LmZuKCgpID0+ICh7XG4gICAgICB0b3RhbEFjdGl2ZUVycm9yczogMTUwLFxuICAgICAgdG90YWxBY3RpdmVMaW50VmlvbGF0aW9uczogMzAwLFxuICAgICAgdG90YWxSZWNlbnRGYWlsdXJlczogMixcbiAgICAgIGNyaXRpY2FsSXNzdWVzOiA1LFxuICAgICAgYXV0b21hdGlvbk9wcG9ydHVuaXRpZXM6IDEwXG4gICAgfSkpLFxuICAgIGdldEN1cnJlbnRRdWFsaXR5TWV0cmljczogamVzdC5mbigoKSA9PiAoe1xuICAgICAgY29kZVF1YWxpdHlTY29yZTogNzUsXG4gICAgICB0ZWNobmljYWxEZWJ0U2NvcmU6IDQ1LFxuICAgICAgbWFpbnRhaW5hYmlsaXR5SW5kZXg6IDgwLFxuICAgICAgZXJyb3JSYXRlOiAwLjA1LFxuICAgICAgd2FybmluZ1JhdGU6IDAuMVxuICAgIH0pKVxuICB9XG59KSk7XG5cbmplc3QubW9jaygnLi4vUXVhbGl0eU1ldHJpY3NTZXJ2aWNlJywgKCkgPT4gKHtcbiAgcXVhbGl0eU1ldHJpY3NTZXJ2aWNlOiB7XG4gICAgc3Vic2NyaWJlOiBqZXN0LmZuKClcbiAgfVxufSkpO1xuXG5kZXNjcmliZSgnQWxlcnRpbmdTeXN0ZW0nLCAoKSA9PiB7XG4gIGxldCBhbGVydGluZ1N5c3RlbTogQWxlcnRpbmdTeXN0ZW07XG4gIGxldCBtb2NrU3Vic2NyaWJlcjogamVzdC5Nb2NrO1xuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIC8vIENsZWFyIGFsbCBtb2Nrc1xuICAgIGplc3QuY2xlYXJBbGxNb2NrcygpO1xuICAgIFxuICAgIC8vIENyZWF0ZSBhIG5ldyBpbnN0YW5jZSBmb3IgZWFjaCB0ZXN0XG4gICAgYWxlcnRpbmdTeXN0ZW0gPSBuZXcgKEFsZXJ0aW5nU3lzdGVtIGFzIGFueSkoKTtcbiAgICBcbiAgICAvLyBSZXNldCB0aGUgaW5zdGFuY2UgdG8gZW5zdXJlIGNsZWFuIHN0YXRlXG4gICAgYWxlcnRpbmdTeXN0ZW0ucmVzZXQoKTtcbiAgICBcbiAgICAvLyBNb2NrIHN1YnNjcmliZXJcbiAgICBtb2NrU3Vic2NyaWJlciA9IGplc3QuZm4oKTtcbiAgICBhbGVydGluZ1N5c3RlbS5zdWJzY3JpYmUobW9ja1N1YnNjcmliZXIpO1xuICB9KTtcblxuICBhZnRlckVhY2goKCkgPT4ge1xuICAgIGlmIChhbGVydGluZ1N5c3RlbSkge1xuICAgICAgYWxlcnRpbmdTeXN0ZW0ucmVzZXQoKTtcbiAgICB9XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdBbGVydCBSdWxlIE1hbmFnZW1lbnQnLCAoKSA9PiB7XG4gICAgdGVzdCgnc2hvdWxkIGFkZCBuZXcgYWxlcnQgcnVsZScsICgpID0+IHtcbiAgICAgIGNvbnN0IHJ1bGU6IE9taXQ8QWxlcnRSdWxlLCAnaWQnPiA9IHtcbiAgICAgICAgbmFtZTogJ1Rlc3QgUnVsZScsXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnVGVzdCBhbGVydCBydWxlJyxcbiAgICAgICAgdHlwZTogJ3BlcmZvcm1hbmNlJyxcbiAgICAgICAgbWV0cmljOiAnYnVpbGRfdGltZScsXG4gICAgICAgIGNvbmRpdGlvbjogJ2dyZWF0ZXJfdGhhbicsXG4gICAgICAgIHRocmVzaG9sZDogNjAwMDAsXG4gICAgICAgIHNldmVyaXR5OiAnd2FybmluZycsXG4gICAgICAgIGVuYWJsZWQ6IHRydWUsXG4gICAgICAgIGNvb2xkb3duTWludXRlczogMTAsXG4gICAgICAgIGVzY2FsYXRpb25NaW51dGVzOiAzMCxcbiAgICAgICAgYXV0b1Jlc3BvbnNlOiBmYWxzZSxcbiAgICAgICAgcmVzcG9uc2VBY3Rpb25zOiBbXSxcbiAgICAgICAgbm90aWZpY2F0aW9uQ2hhbm5lbHM6IFsnY29uc29sZSddXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBydWxlSWQgPSBhbGVydGluZ1N5c3RlbS5hZGRBbGVydFJ1bGUocnVsZSk7XG4gICAgICBleHBlY3QocnVsZUlkKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHJ1bGVJZCkudG9NYXRjaCgvXnJ1bGUtXFxkKyQvKTtcblxuICAgICAgY29uc3QgcnVsZXMgPSBhbGVydGluZ1N5c3RlbS5nZXRBbGVydFJ1bGVzKCk7XG4gICAgICBjb25zdCBhZGRlZFJ1bGUgPSBydWxlcy5maW5kKHIgPT4gci5pZCA9PT0gcnVsZUlkKTtcbiAgICAgIGV4cGVjdChhZGRlZFJ1bGUpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QoYWRkZWRSdWxlPy5uYW1lKS50b0JlKCdUZXN0IFJ1bGUnKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCB1cGRhdGUgZXhpc3RpbmcgYWxlcnQgcnVsZScsICgpID0+IHtcbiAgICAgIGNvbnN0IHJ1bGU6IE9taXQ8QWxlcnRSdWxlLCAnaWQnPiA9IHtcbiAgICAgICAgbmFtZTogJ1Rlc3QgUnVsZScsXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnVGVzdCBhbGVydCBydWxlJyxcbiAgICAgICAgdHlwZTogJ3BlcmZvcm1hbmNlJyxcbiAgICAgICAgbWV0cmljOiAnYnVpbGRfdGltZScsXG4gICAgICAgIGNvbmRpdGlvbjogJ2dyZWF0ZXJfdGhhbicsXG4gICAgICAgIHRocmVzaG9sZDogNjAwMDAsXG4gICAgICAgIHNldmVyaXR5OiAnd2FybmluZycsXG4gICAgICAgIGVuYWJsZWQ6IHRydWUsXG4gICAgICAgIGNvb2xkb3duTWludXRlczogMTAsXG4gICAgICAgIGVzY2FsYXRpb25NaW51dGVzOiAzMCxcbiAgICAgICAgYXV0b1Jlc3BvbnNlOiBmYWxzZSxcbiAgICAgICAgcmVzcG9uc2VBY3Rpb25zOiBbXSxcbiAgICAgICAgbm90aWZpY2F0aW9uQ2hhbm5lbHM6IFsnY29uc29sZSddXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBydWxlSWQgPSBhbGVydGluZ1N5c3RlbS5hZGRBbGVydFJ1bGUocnVsZSk7XG4gICAgICBjb25zdCB1cGRhdGVkID0gYWxlcnRpbmdTeXN0ZW0udXBkYXRlQWxlcnRSdWxlKHJ1bGVJZCwgeyBcbiAgICAgICAgdGhyZXNob2xkOiA5MDAwMCxcbiAgICAgICAgc2V2ZXJpdHk6ICdlcnJvcidcbiAgICAgIH0pO1xuXG4gICAgICBleHBlY3QodXBkYXRlZCkudG9CZSh0cnVlKTtcblxuICAgICAgY29uc3QgcnVsZXMgPSBhbGVydGluZ1N5c3RlbS5nZXRBbGVydFJ1bGVzKCk7XG4gICAgICBjb25zdCB1cGRhdGVkUnVsZSA9IHJ1bGVzLmZpbmQociA9PiByLmlkID09PSBydWxlSWQpO1xuICAgICAgZXhwZWN0KHVwZGF0ZWRSdWxlPy50aHJlc2hvbGQpLnRvQmUoOTAwMDApO1xuICAgICAgZXhwZWN0KHVwZGF0ZWRSdWxlPy5zZXZlcml0eSkudG9CZSgnZXJyb3InKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBkZWxldGUgYWxlcnQgcnVsZScsICgpID0+IHtcbiAgICAgIGNvbnN0IHJ1bGU6IE9taXQ8QWxlcnRSdWxlLCAnaWQnPiA9IHtcbiAgICAgICAgbmFtZTogJ1Rlc3QgUnVsZScsXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnVGVzdCBhbGVydCBydWxlJyxcbiAgICAgICAgdHlwZTogJ3BlcmZvcm1hbmNlJyxcbiAgICAgICAgbWV0cmljOiAnYnVpbGRfdGltZScsXG4gICAgICAgIGNvbmRpdGlvbjogJ2dyZWF0ZXJfdGhhbicsXG4gICAgICAgIHRocmVzaG9sZDogNjAwMDAsXG4gICAgICAgIHNldmVyaXR5OiAnd2FybmluZycsXG4gICAgICAgIGVuYWJsZWQ6IHRydWUsXG4gICAgICAgIGNvb2xkb3duTWludXRlczogMTAsXG4gICAgICAgIGVzY2FsYXRpb25NaW51dGVzOiAzMCxcbiAgICAgICAgYXV0b1Jlc3BvbnNlOiBmYWxzZSxcbiAgICAgICAgcmVzcG9uc2VBY3Rpb25zOiBbXSxcbiAgICAgICAgbm90aWZpY2F0aW9uQ2hhbm5lbHM6IFsnY29uc29sZSddXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBydWxlSWQgPSBhbGVydGluZ1N5c3RlbS5hZGRBbGVydFJ1bGUocnVsZSk7XG4gICAgICBjb25zdCBkZWxldGVkID0gYWxlcnRpbmdTeXN0ZW0uZGVsZXRlQWxlcnRSdWxlKHJ1bGVJZCk7XG5cbiAgICAgIGV4cGVjdChkZWxldGVkKS50b0JlKHRydWUpO1xuXG4gICAgICBjb25zdCBydWxlcyA9IGFsZXJ0aW5nU3lzdGVtLmdldEFsZXJ0UnVsZXMoKTtcbiAgICAgIGNvbnN0IGRlbGV0ZWRSdWxlID0gcnVsZXMuZmluZChyID0+IHIuaWQgPT09IHJ1bGVJZCk7XG4gICAgICBleHBlY3QoZGVsZXRlZFJ1bGUpLnRvQmVVbmRlZmluZWQoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0FsZXJ0IEdlbmVyYXRpb24nLCAoKSA9PiB7XG4gICAgdGVzdCgnc2hvdWxkIGNyZWF0ZSBhbGVydCB3aGVuIHRocmVzaG9sZCBpcyBleGNlZWRlZCcsICgpID0+IHtcbiAgICAgIC8vIEFkZCBhIHJ1bGUgdGhhdCBzaG91bGQgdHJpZ2dlciBiYXNlZCBvbiBtb2NrZWQgZGF0YVxuICAgICAgY29uc3QgcnVsZUlkID0gYWxlcnRpbmdTeXN0ZW0uYWRkQWxlcnRSdWxlKHtcbiAgICAgICAgbmFtZTogJ0hpZ2ggRXJyb3IgQ291bnQnLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ1RvbyBtYW55IFR5cGVTY3JpcHQgZXJyb3JzJyxcbiAgICAgICAgdHlwZTogJ2Vycm9yJyxcbiAgICAgICAgbWV0cmljOiAndHlwZXNjcmlwdF9lcnJvcnMnLFxuICAgICAgICBjb25kaXRpb246ICdncmVhdGVyX3RoYW4nLFxuICAgICAgICB0aHJlc2hvbGQ6IDEwMCwgLy8gTW9jayByZXR1cm5zIDE1MCwgc28gdGhpcyBzaG91bGQgdHJpZ2dlclxuICAgICAgICBzZXZlcml0eTogJ3dhcm5pbmcnLFxuICAgICAgICBlbmFibGVkOiB0cnVlLFxuICAgICAgICBjb29sZG93bk1pbnV0ZXM6IDUsXG4gICAgICAgIGVzY2FsYXRpb25NaW51dGVzOiAxNSxcbiAgICAgICAgYXV0b1Jlc3BvbnNlOiBmYWxzZSxcbiAgICAgICAgcmVzcG9uc2VBY3Rpb25zOiBbXSxcbiAgICAgICAgbm90aWZpY2F0aW9uQ2hhbm5lbHM6IFsnY29uc29sZSddXG4gICAgICB9KTtcblxuICAgICAgLy8gTWFudWFsbHkgdHJpZ2dlciBydWxlIGV2YWx1YXRpb24gKGluIHJlYWwgc3lzdGVtIHRoaXMgaGFwcGVucyBhdXRvbWF0aWNhbGx5KVxuICAgICAgY29uc3QgcnVsZSA9IGFsZXJ0aW5nU3lzdGVtLmdldEFsZXJ0UnVsZXMoKS5maW5kKHIgPT4gci5pZCA9PT0gcnVsZUlkKTtcbiAgICAgIGlmIChydWxlKSB7XG4gICAgICAgIChhbGVydGluZ1N5c3RlbSBhcyBhbnkpLmV2YWx1YXRlUnVsZShydWxlKTtcbiAgICAgIH1cblxuICAgICAgLy8gQ2hlY2sgaWYgYWxlcnQgd2FzIGNyZWF0ZWRcbiAgICAgIGNvbnN0IGFsZXJ0cyA9IGFsZXJ0aW5nU3lzdGVtLmdldEFsZXJ0cyh7IHJlc29sdmVkOiBmYWxzZSB9KTtcbiAgICAgIGV4cGVjdChhbGVydHMubGVuZ3RoKS50b0JlR3JlYXRlclRoYW4oMCk7XG4gICAgICBcbiAgICAgIGNvbnN0IGFsZXJ0ID0gYWxlcnRzLmZpbmQoYSA9PiBhLnRpdGxlID09PSAnSGlnaCBFcnJvciBDb3VudCcpO1xuICAgICAgZXhwZWN0KGFsZXJ0KS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KGFsZXJ0Py5jdXJyZW50VmFsdWUpLnRvQmUoMTUwKTtcbiAgICAgIGV4cGVjdChhbGVydD8udGhyZXNob2xkKS50b0JlKDEwMCk7XG4gICAgICBleHBlY3QoYWxlcnQ/LnNldmVyaXR5KS50b0JlKCd3YXJuaW5nJyk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgbm90IGNyZWF0ZSBhbGVydCB3aGVuIHRocmVzaG9sZCBpcyBub3QgZXhjZWVkZWQnLCAoKSA9PiB7XG4gICAgICAvLyBBZGQgYSBydWxlIHRoYXQgc2hvdWxkIE5PVCB0cmlnZ2VyIGJhc2VkIG9uIG1vY2tlZCBkYXRhXG4gICAgICBjb25zdCBydWxlSWQgPSBhbGVydGluZ1N5c3RlbS5hZGRBbGVydFJ1bGUoe1xuICAgICAgICBuYW1lOiAnVmVyeSBIaWdoIEVycm9yIENvdW50JyxcbiAgICAgICAgZGVzY3JpcHRpb246ICdFeHRyZW1lbHkgaGlnaCBUeXBlU2NyaXB0IGVycm9ycycsXG4gICAgICAgIHR5cGU6ICdlcnJvcicsXG4gICAgICAgIG1ldHJpYzogJ3R5cGVzY3JpcHRfZXJyb3JzJyxcbiAgICAgICAgY29uZGl0aW9uOiAnZ3JlYXRlcl90aGFuJyxcbiAgICAgICAgdGhyZXNob2xkOiAxMDAwLCAvLyBNb2NrIHJldHVybnMgMTUwLCBzbyB0aGlzIHNob3VsZCBOT1QgdHJpZ2dlclxuICAgICAgICBzZXZlcml0eTogJ2NyaXRpY2FsJyxcbiAgICAgICAgZW5hYmxlZDogdHJ1ZSxcbiAgICAgICAgY29vbGRvd25NaW51dGVzOiA1LFxuICAgICAgICBlc2NhbGF0aW9uTWludXRlczogMTUsXG4gICAgICAgIGF1dG9SZXNwb25zZTogZmFsc2UsXG4gICAgICAgIHJlc3BvbnNlQWN0aW9uczogW10sXG4gICAgICAgIG5vdGlmaWNhdGlvbkNoYW5uZWxzOiBbJ2NvbnNvbGUnXVxuICAgICAgfSk7XG5cbiAgICAgIC8vIE1hbnVhbGx5IHRyaWdnZXIgcnVsZSBldmFsdWF0aW9uXG4gICAgICBjb25zdCBydWxlID0gYWxlcnRpbmdTeXN0ZW0uZ2V0QWxlcnRSdWxlcygpLmZpbmQociA9PiByLmlkID09PSBydWxlSWQpO1xuICAgICAgaWYgKHJ1bGUpIHtcbiAgICAgICAgKGFsZXJ0aW5nU3lzdGVtIGFzIGFueSkuZXZhbHVhdGVSdWxlKHJ1bGUpO1xuICAgICAgfVxuXG4gICAgICAvLyBDaGVjayB0aGF0IG5vIGFsZXJ0IHdhcyBjcmVhdGVkIGZvciB0aGlzIHJ1bGVcbiAgICAgIGNvbnN0IGFsZXJ0cyA9IGFsZXJ0aW5nU3lzdGVtLmdldEFsZXJ0cyh7IHJlc29sdmVkOiBmYWxzZSB9KTtcbiAgICAgIGNvbnN0IGFsZXJ0ID0gYWxlcnRzLmZpbmQoYSA9PiBhLnRpdGxlID09PSAnVmVyeSBIaWdoIEVycm9yIENvdW50Jyk7XG4gICAgICBleHBlY3QoYWxlcnQpLnRvQmVVbmRlZmluZWQoKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCByZXNwZWN0IGNvb2xkb3duIHBlcmlvZCcsICgpID0+IHtcbiAgICAgIGNvbnN0IHJ1bGVJZCA9IGFsZXJ0aW5nU3lzdGVtLmFkZEFsZXJ0UnVsZSh7XG4gICAgICAgIG5hbWU6ICdDb29sZG93biBUZXN0JyxcbiAgICAgICAgZGVzY3JpcHRpb246ICdUZXN0IGNvb2xkb3duIGZ1bmN0aW9uYWxpdHknLFxuICAgICAgICB0eXBlOiAnZXJyb3InLFxuICAgICAgICBtZXRyaWM6ICd0eXBlc2NyaXB0X2Vycm9ycycsXG4gICAgICAgIGNvbmRpdGlvbjogJ2dyZWF0ZXJfdGhhbicsXG4gICAgICAgIHRocmVzaG9sZDogMTAwLFxuICAgICAgICBzZXZlcml0eTogJ3dhcm5pbmcnLFxuICAgICAgICBlbmFibGVkOiB0cnVlLFxuICAgICAgICBjb29sZG93bk1pbnV0ZXM6IDAuMDEsIC8vIFZlcnkgc2hvcnQgY29vbGRvd24gZm9yIHRlc3RpbmcgKDAuNiBzZWNvbmRzKVxuICAgICAgICBlc2NhbGF0aW9uTWludXRlczogMTIwLFxuICAgICAgICBhdXRvUmVzcG9uc2U6IGZhbHNlLFxuICAgICAgICByZXNwb25zZUFjdGlvbnM6IFtdLFxuICAgICAgICBub3RpZmljYXRpb25DaGFubmVsczogWydjb25zb2xlJ11cbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBydWxlID0gYWxlcnRpbmdTeXN0ZW0uZ2V0QWxlcnRSdWxlcygpLmZpbmQociA9PiByLmlkID09PSBydWxlSWQpO1xuICAgICAgaWYgKHJ1bGUpIHtcbiAgICAgICAgLy8gRmlyc3QgZXZhbHVhdGlvbiBzaG91bGQgY3JlYXRlIGFsZXJ0XG4gICAgICAgIChhbGVydGluZ1N5c3RlbSBhcyBhbnkpLmV2YWx1YXRlUnVsZShydWxlKTtcbiAgICAgICAgXG4gICAgICAgIC8vIFNlY29uZCBldmFsdWF0aW9uIHNob3VsZCBiZSBibG9ja2VkIGJ5IGNvb2xkb3duIChpbW1lZGlhdGUpXG4gICAgICAgIChhbGVydGluZ1N5c3RlbSBhcyBhbnkpLmV2YWx1YXRlUnVsZShydWxlKTtcbiAgICAgIH1cblxuICAgICAgLy8gU2hvdWxkIG9ubHkgaGF2ZSBvbmUgYWxlcnQgZGVzcGl0ZSB0d28gZXZhbHVhdGlvbnNcbiAgICAgIGNvbnN0IGFsZXJ0cyA9IGFsZXJ0aW5nU3lzdGVtLmdldEFsZXJ0cyh7IHJlc29sdmVkOiBmYWxzZSB9KTtcbiAgICAgIGNvbnN0IGNvb2xkb3duQWxlcnRzID0gYWxlcnRzLmZpbHRlcihhID0+IGEudGl0bGUgPT09ICdDb29sZG93biBUZXN0Jyk7XG4gICAgICBleHBlY3QoY29vbGRvd25BbGVydHMubGVuZ3RoKS50b0JlKDEpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnQWxlcnQgTWFuYWdlbWVudCcsICgpID0+IHtcbiAgICB0ZXN0KCdzaG91bGQgYWNrbm93bGVkZ2UgYWxlcnQnLCAoKSA9PiB7XG4gICAgICAvLyBDcmVhdGUgYW4gYWxlcnQgZmlyc3RcbiAgICAgIGNvbnN0IHJ1bGVJZCA9IGFsZXJ0aW5nU3lzdGVtLmFkZEFsZXJ0UnVsZSh7XG4gICAgICAgIG5hbWU6ICdUZXN0IEFsZXJ0JyxcbiAgICAgICAgZGVzY3JpcHRpb246ICdUZXN0IGFsZXJ0IGZvciBhY2tub3dsZWRnbWVudCcsXG4gICAgICAgIHR5cGU6ICdlcnJvcicsXG4gICAgICAgIG1ldHJpYzogJ3R5cGVzY3JpcHRfZXJyb3JzJyxcbiAgICAgICAgY29uZGl0aW9uOiAnZ3JlYXRlcl90aGFuJyxcbiAgICAgICAgdGhyZXNob2xkOiAxMDAsXG4gICAgICAgIHNldmVyaXR5OiAnd2FybmluZycsXG4gICAgICAgIGVuYWJsZWQ6IHRydWUsXG4gICAgICAgIGNvb2xkb3duTWludXRlczogNSxcbiAgICAgICAgZXNjYWxhdGlvbk1pbnV0ZXM6IDE1LFxuICAgICAgICBhdXRvUmVzcG9uc2U6IGZhbHNlLFxuICAgICAgICByZXNwb25zZUFjdGlvbnM6IFtdLFxuICAgICAgICBub3RpZmljYXRpb25DaGFubmVsczogWydjb25zb2xlJ11cbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBydWxlID0gYWxlcnRpbmdTeXN0ZW0uZ2V0QWxlcnRSdWxlcygpLmZpbmQociA9PiByLmlkID09PSBydWxlSWQpO1xuICAgICAgaWYgKHJ1bGUpIHtcbiAgICAgICAgKGFsZXJ0aW5nU3lzdGVtIGFzIGFueSkuZXZhbHVhdGVSdWxlKHJ1bGUpO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBhbGVydHMgPSBhbGVydGluZ1N5c3RlbS5nZXRBbGVydHMoeyByZXNvbHZlZDogZmFsc2UgfSk7XG4gICAgICBjb25zdCBhbGVydCA9IGFsZXJ0cy5maW5kKGEgPT4gYS50aXRsZSA9PT0gJ1Rlc3QgQWxlcnQnKTtcbiAgICAgIGV4cGVjdChhbGVydCkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChhbGVydD8uYWNrbm93bGVkZ2VkKS50b0JlKGZhbHNlKTtcblxuICAgICAgLy8gQWNrbm93bGVkZ2UgdGhlIGFsZXJ0XG4gICAgICBjb25zdCBhY2tub3dsZWRnZWQgPSBhbGVydGluZ1N5c3RlbS5hY2tub3dsZWRnZUFsZXJ0KGFsZXJ0IS5pZCk7XG4gICAgICBleHBlY3QoYWNrbm93bGVkZ2VkKS50b0JlKHRydWUpO1xuXG4gICAgICAvLyBDaGVjayB0aGF0IGFsZXJ0IGlzIG5vdyBhY2tub3dsZWRnZWRcbiAgICAgIGNvbnN0IHVwZGF0ZWRBbGVydHMgPSBhbGVydGluZ1N5c3RlbS5nZXRBbGVydHMoeyByZXNvbHZlZDogZmFsc2UgfSk7XG4gICAgICBjb25zdCBhY2tub3dsZWRnZWRBbGVydCA9IHVwZGF0ZWRBbGVydHMuZmluZChhID0+IGEuaWQgPT09IGFsZXJ0IS5pZCk7XG4gICAgICBleHBlY3QoYWNrbm93bGVkZ2VkQWxlcnQ/LmFja25vd2xlZGdlZCkudG9CZSh0cnVlKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCByZXNvbHZlIGFsZXJ0JywgKCkgPT4ge1xuICAgICAgLy8gQ3JlYXRlIGFuIGFsZXJ0IGZpcnN0XG4gICAgICBjb25zdCBydWxlSWQgPSBhbGVydGluZ1N5c3RlbS5hZGRBbGVydFJ1bGUoe1xuICAgICAgICBuYW1lOiAnVGVzdCBBbGVydCcsXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnVGVzdCBhbGVydCBmb3IgcmVzb2x1dGlvbicsXG4gICAgICAgIHR5cGU6ICdlcnJvcicsXG4gICAgICAgIG1ldHJpYzogJ3R5cGVzY3JpcHRfZXJyb3JzJyxcbiAgICAgICAgY29uZGl0aW9uOiAnZ3JlYXRlcl90aGFuJyxcbiAgICAgICAgdGhyZXNob2xkOiAxMDAsXG4gICAgICAgIHNldmVyaXR5OiAnd2FybmluZycsXG4gICAgICAgIGVuYWJsZWQ6IHRydWUsXG4gICAgICAgIGNvb2xkb3duTWludXRlczogNSxcbiAgICAgICAgZXNjYWxhdGlvbk1pbnV0ZXM6IDE1LFxuICAgICAgICBhdXRvUmVzcG9uc2U6IGZhbHNlLFxuICAgICAgICByZXNwb25zZUFjdGlvbnM6IFtdLFxuICAgICAgICBub3RpZmljYXRpb25DaGFubmVsczogWydjb25zb2xlJ11cbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBydWxlID0gYWxlcnRpbmdTeXN0ZW0uZ2V0QWxlcnRSdWxlcygpLmZpbmQociA9PiByLmlkID09PSBydWxlSWQpO1xuICAgICAgaWYgKHJ1bGUpIHtcbiAgICAgICAgKGFsZXJ0aW5nU3lzdGVtIGFzIGFueSkuZXZhbHVhdGVSdWxlKHJ1bGUpO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBhbGVydHMgPSBhbGVydGluZ1N5c3RlbS5nZXRBbGVydHMoeyByZXNvbHZlZDogZmFsc2UgfSk7XG4gICAgICBjb25zdCBhbGVydCA9IGFsZXJ0cy5maW5kKGEgPT4gYS50aXRsZSA9PT0gJ1Rlc3QgQWxlcnQnKTtcbiAgICAgIGV4cGVjdChhbGVydCkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChhbGVydD8ucmVzb2x2ZWQpLnRvQmUoZmFsc2UpO1xuXG4gICAgICAvLyBSZXNvbHZlIHRoZSBhbGVydFxuICAgICAgY29uc3QgcmVzb2x2ZWQgPSBhbGVydGluZ1N5c3RlbS5yZXNvbHZlQWxlcnQoYWxlcnQhLmlkKTtcbiAgICAgIGV4cGVjdChyZXNvbHZlZCkudG9CZSh0cnVlKTtcblxuICAgICAgLy8gQ2hlY2sgdGhhdCBhbGVydCBpcyBub3cgcmVzb2x2ZWRcbiAgICAgIGNvbnN0IHVucmVzb2x2ZWRBbGVydHMgPSBhbGVydGluZ1N5c3RlbS5nZXRBbGVydHMoeyByZXNvbHZlZDogZmFsc2UgfSk7XG4gICAgICBjb25zdCB1bnJlc29sdmVkQWxlcnQgPSB1bnJlc29sdmVkQWxlcnRzLmZpbmQoYSA9PiBhLmlkID09PSBhbGVydCEuaWQpO1xuICAgICAgZXhwZWN0KHVucmVzb2x2ZWRBbGVydCkudG9CZVVuZGVmaW5lZCgpO1xuXG4gICAgICBjb25zdCByZXNvbHZlZEFsZXJ0cyA9IGFsZXJ0aW5nU3lzdGVtLmdldEFsZXJ0cyh7IHJlc29sdmVkOiB0cnVlIH0pO1xuICAgICAgY29uc3QgcmVzb2x2ZWRBbGVydCA9IHJlc29sdmVkQWxlcnRzLmZpbmQoYSA9PiBhLmlkID09PSBhbGVydCEuaWQpO1xuICAgICAgZXhwZWN0KHJlc29sdmVkQWxlcnQ/LnJlc29sdmVkKS50b0JlKHRydWUpO1xuICAgICAgZXhwZWN0KHJlc29sdmVkQWxlcnQ/LnJlc29sdmVkQXQpLnRvQmVEZWZpbmVkKCk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdBbGVydCBGaWx0ZXJpbmcnLCAoKSA9PiB7XG4gICAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgICAvLyBDcmVhdGUgbXVsdGlwbGUgYWxlcnRzIGZvciB0ZXN0aW5nXG4gICAgICBjb25zdCBydWxlcyA9IFtcbiAgICAgICAge1xuICAgICAgICAgIG5hbWU6ICdQZXJmb3JtYW5jZSBBbGVydCcsXG4gICAgICAgICAgdHlwZTogJ3BlcmZvcm1hbmNlJyBhcyBjb25zdCxcbiAgICAgICAgICBzZXZlcml0eTogJ3dhcm5pbmcnIGFzIGNvbnN0LFxuICAgICAgICAgIG1ldHJpYzogJ2J1aWxkX3RpbWUnLFxuICAgICAgICAgIHRocmVzaG9sZDogMzAwMDBcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIG5hbWU6ICdFcnJvciBBbGVydCcsXG4gICAgICAgICAgdHlwZTogJ2Vycm9yJyBhcyBjb25zdCxcbiAgICAgICAgICBzZXZlcml0eTogJ2Vycm9yJyBhcyBjb25zdCxcbiAgICAgICAgICBtZXRyaWM6ICd0eXBlc2NyaXB0X2Vycm9ycycsXG4gICAgICAgICAgdGhyZXNob2xkOiAxMDBcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIG5hbWU6ICdDcml0aWNhbCBRdWFsaXR5IEFsZXJ0JyxcbiAgICAgICAgICB0eXBlOiAncXVhbGl0eScgYXMgY29uc3QsXG4gICAgICAgICAgc2V2ZXJpdHk6ICdjcml0aWNhbCcgYXMgY29uc3QsXG4gICAgICAgICAgbWV0cmljOiAnY29kZV9xdWFsaXR5X3Njb3JlJyxcbiAgICAgICAgICB0aHJlc2hvbGQ6IDgwIC8vIE1vY2sgcmV0dXJucyA3NSwgc28gdGhpcyBzaG91bGQgdHJpZ2dlciB3aXRoIGxlc3NfdGhhbiBjb25kaXRpb25cbiAgICAgICAgfVxuICAgICAgXTtcblxuICAgICAgZm9yIChjb25zdCBydWxlQ29uZmlnIG9mIHJ1bGVzKSB7XG4gICAgICAgIGNvbnN0IHJ1bGVJZCA9IGFsZXJ0aW5nU3lzdGVtLmFkZEFsZXJ0UnVsZSh7XG4gICAgICAgICAgLi4ucnVsZUNvbmZpZyxcbiAgICAgICAgICBkZXNjcmlwdGlvbjogYFRlc3QgJHtydWxlQ29uZmlnLm5hbWV9YCxcbiAgICAgICAgICBjb25kaXRpb246IHJ1bGVDb25maWcudHlwZSA9PT0gJ3F1YWxpdHknID8gJ2xlc3NfdGhhbicgOiAnZ3JlYXRlcl90aGFuJyxcbiAgICAgICAgICBlbmFibGVkOiB0cnVlLFxuICAgICAgICAgIGNvb2xkb3duTWludXRlczogNSxcbiAgICAgICAgICBlc2NhbGF0aW9uTWludXRlczogMTUsXG4gICAgICAgICAgYXV0b1Jlc3BvbnNlOiBmYWxzZSxcbiAgICAgICAgICByZXNwb25zZUFjdGlvbnM6IFtdLFxuICAgICAgICAgIG5vdGlmaWNhdGlvbkNoYW5uZWxzOiBbJ2NvbnNvbGUnXVxuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCBydWxlID0gYWxlcnRpbmdTeXN0ZW0uZ2V0QWxlcnRSdWxlcygpLmZpbmQociA9PiByLmlkID09PSBydWxlSWQpO1xuICAgICAgICBpZiAocnVsZSkge1xuICAgICAgICAgIChhbGVydGluZ1N5c3RlbSBhcyBhbnkpLmV2YWx1YXRlUnVsZShydWxlKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIGZpbHRlciBhbGVydHMgYnkgdHlwZScsICgpID0+IHtcbiAgICAgIGNvbnN0IHBlcmZvcm1hbmNlQWxlcnRzID0gYWxlcnRpbmdTeXN0ZW0uZ2V0QWxlcnRzKHsgdHlwZTogJ3BlcmZvcm1hbmNlJyB9KTtcbiAgICAgIGV4cGVjdChwZXJmb3JtYW5jZUFsZXJ0cy5sZW5ndGgpLnRvQmUoMSk7XG4gICAgICBleHBlY3QocGVyZm9ybWFuY2VBbGVydHNbMF0udHlwZSkudG9CZSgncGVyZm9ybWFuY2UnKTtcblxuICAgICAgY29uc3QgZXJyb3JBbGVydHMgPSBhbGVydGluZ1N5c3RlbS5nZXRBbGVydHMoeyB0eXBlOiAnZXJyb3InIH0pO1xuICAgICAgZXhwZWN0KGVycm9yQWxlcnRzLmxlbmd0aCkudG9CZSgxKTtcbiAgICAgIGV4cGVjdChlcnJvckFsZXJ0c1swXS50eXBlKS50b0JlKCdlcnJvcicpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIGZpbHRlciBhbGVydHMgYnkgc2V2ZXJpdHknLCAoKSA9PiB7XG4gICAgICBjb25zdCBjcml0aWNhbEFsZXJ0cyA9IGFsZXJ0aW5nU3lzdGVtLmdldEFsZXJ0cyh7IHNldmVyaXR5OiAnY3JpdGljYWwnIH0pO1xuICAgICAgZXhwZWN0KGNyaXRpY2FsQWxlcnRzLmxlbmd0aCkudG9CZSgxKTtcbiAgICAgIGV4cGVjdChjcml0aWNhbEFsZXJ0c1swXS5zZXZlcml0eSkudG9CZSgnY3JpdGljYWwnKTtcblxuICAgICAgY29uc3Qgd2FybmluZ0FsZXJ0cyA9IGFsZXJ0aW5nU3lzdGVtLmdldEFsZXJ0cyh7IHNldmVyaXR5OiAnd2FybmluZycgfSk7XG4gICAgICBleHBlY3Qod2FybmluZ0FsZXJ0cy5sZW5ndGgpLnRvQmUoMSk7XG4gICAgICBleHBlY3Qod2FybmluZ0FsZXJ0c1swXS5zZXZlcml0eSkudG9CZSgnd2FybmluZycpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnc2hvdWxkIGxpbWl0IG51bWJlciBvZiBhbGVydHMgcmV0dXJuZWQnLCAoKSA9PiB7XG4gICAgICBjb25zdCBsaW1pdGVkQWxlcnRzID0gYWxlcnRpbmdTeXN0ZW0uZ2V0QWxlcnRzKHsgbGltaXQ6IDIgfSk7XG4gICAgICBleHBlY3QobGltaXRlZEFsZXJ0cy5sZW5ndGgpLnRvQmUoMik7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdBbGVydCBTdW1tYXJ5JywgKCkgPT4ge1xuICAgIHRlc3QoJ3Nob3VsZCBwcm92aWRlIGFjY3VyYXRlIGFsZXJ0IHN1bW1hcnknLCAoKSA9PiB7XG4gICAgICAvLyBDcmVhdGUgc29tZSB0ZXN0IGFsZXJ0c1xuICAgICAgY29uc3QgcnVsZUlkID0gYWxlcnRpbmdTeXN0ZW0uYWRkQWxlcnRSdWxlKHtcbiAgICAgICAgbmFtZTogJ1N1bW1hcnkgVGVzdCBBbGVydCcsXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnVGVzdCBhbGVydCBmb3Igc3VtbWFyeScsXG4gICAgICAgIHR5cGU6ICdlcnJvcicsXG4gICAgICAgIG1ldHJpYzogJ3R5cGVzY3JpcHRfZXJyb3JzJyxcbiAgICAgICAgY29uZGl0aW9uOiAnZ3JlYXRlcl90aGFuJyxcbiAgICAgICAgdGhyZXNob2xkOiAxMDAsXG4gICAgICAgIHNldmVyaXR5OiAnY3JpdGljYWwnLFxuICAgICAgICBlbmFibGVkOiB0cnVlLFxuICAgICAgICBjb29sZG93bk1pbnV0ZXM6IDUsXG4gICAgICAgIGVzY2FsYXRpb25NaW51dGVzOiAxNSxcbiAgICAgICAgYXV0b1Jlc3BvbnNlOiBmYWxzZSxcbiAgICAgICAgcmVzcG9uc2VBY3Rpb25zOiBbXSxcbiAgICAgICAgbm90aWZpY2F0aW9uQ2hhbm5lbHM6IFsnY29uc29sZSddXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgcnVsZSA9IGFsZXJ0aW5nU3lzdGVtLmdldEFsZXJ0UnVsZXMoKS5maW5kKHIgPT4gci5pZCA9PT0gcnVsZUlkKTtcbiAgICAgIGlmIChydWxlKSB7XG4gICAgICAgIChhbGVydGluZ1N5c3RlbSBhcyBhbnkpLmV2YWx1YXRlUnVsZShydWxlKTtcbiAgICAgIH1cblxuICAgICAgY29uc3Qgc3VtbWFyeSA9IGFsZXJ0aW5nU3lzdGVtLmdldEFsZXJ0U3VtbWFyeSgpO1xuICAgICAgXG4gICAgICBleHBlY3Qoc3VtbWFyeS50b3RhbEFsZXJ0cykudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgICAgZXhwZWN0KHN1bW1hcnkudW5yZXNvbHZlZEFsZXJ0cykudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgICAgZXhwZWN0KHN1bW1hcnkuY3JpdGljYWxBbGVydHMpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICAgIGV4cGVjdChzdW1tYXJ5LmFsZXJ0c0J5VHlwZSkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdChzdW1tYXJ5LmFsZXJ0c0J5U2V2ZXJpdHkpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QodHlwZW9mIHN1bW1hcnkucmVzcG9uc2VTdWNjZXNzUmF0ZSkudG9CZSgnbnVtYmVyJyk7XG4gICAgICBleHBlY3QodHlwZW9mIHN1bW1hcnkuYXZlcmFnZVJlc29sdXRpb25UaW1lKS50b0JlKCdudW1iZXInKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ1Rlc3QgQWxlcnQgRnVuY3Rpb25hbGl0eScsICgpID0+IHtcbiAgICB0ZXN0KCdzaG91bGQgY3JlYXRlIHRlc3QgYWxlcnQnLCAoKSA9PiB7XG4gICAgICBjb25zdCBydWxlSWQgPSBhbGVydGluZ1N5c3RlbS5hZGRBbGVydFJ1bGUoe1xuICAgICAgICBuYW1lOiAnVGVzdCBSdWxlIGZvciBUZXN0aW5nJyxcbiAgICAgICAgZGVzY3JpcHRpb246ICdSdWxlIHRvIHRlc3QgYWxlcnQgY3JlYXRpb24nLFxuICAgICAgICB0eXBlOiAncGVyZm9ybWFuY2UnLFxuICAgICAgICBtZXRyaWM6ICdidWlsZF90aW1lJyxcbiAgICAgICAgY29uZGl0aW9uOiAnZ3JlYXRlcl90aGFuJyxcbiAgICAgICAgdGhyZXNob2xkOiA2MDAwMCxcbiAgICAgICAgc2V2ZXJpdHk6ICd3YXJuaW5nJyxcbiAgICAgICAgZW5hYmxlZDogdHJ1ZSxcbiAgICAgICAgY29vbGRvd25NaW51dGVzOiA1LFxuICAgICAgICBlc2NhbGF0aW9uTWludXRlczogMTUsXG4gICAgICAgIGF1dG9SZXNwb25zZTogZmFsc2UsXG4gICAgICAgIHJlc3BvbnNlQWN0aW9uczogW10sXG4gICAgICAgIG5vdGlmaWNhdGlvbkNoYW5uZWxzOiBbJ2NvbnNvbGUnXVxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHRlc3RSZXN1bHQgPSBhbGVydGluZ1N5c3RlbS50ZXN0QWxlcnQocnVsZUlkKTtcbiAgICAgIGV4cGVjdCh0ZXN0UmVzdWx0KS50b0JlKHRydWUpO1xuXG4gICAgICAvLyBDaGVjayB0aGF0IHRlc3QgYWxlcnQgd2FzIGNyZWF0ZWRcbiAgICAgIGNvbnN0IGFsZXJ0cyA9IGFsZXJ0aW5nU3lzdGVtLmdldEFsZXJ0cyh7IHJlc29sdmVkOiBmYWxzZSB9KTtcbiAgICAgIGNvbnN0IHRlc3RBbGVydCA9IGFsZXJ0cy5maW5kKGEgPT4gYS50aXRsZSA9PT0gJ1Rlc3QgUnVsZSBmb3IgVGVzdGluZycpO1xuICAgICAgZXhwZWN0KHRlc3RBbGVydCkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdCh0ZXN0QWxlcnQ/LmN1cnJlbnRWYWx1ZSkudG9CZSg2MDAwMSk7IC8vIHRocmVzaG9sZCArIDFcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCByZXR1cm4gZmFsc2UgZm9yIG5vbi1leGlzdGVudCBydWxlJywgKCkgPT4ge1xuICAgICAgY29uc3QgdGVzdFJlc3VsdCA9IGFsZXJ0aW5nU3lzdGVtLnRlc3RBbGVydCgnbm9uLWV4aXN0ZW50LXJ1bGUnKTtcbiAgICAgIGV4cGVjdCh0ZXN0UmVzdWx0KS50b0JlKGZhbHNlKTtcbiAgICB9KTtcbiAgfSk7XG59KTsiXSwidmVyc2lvbiI6M30=