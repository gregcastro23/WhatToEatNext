c1634878f636866fe2eae954dacc5f0c
"use strict";
/**
 * Advanced logger utility to standardize logging across the application.
 * This module provides component-specific logging capabilities and consistent formatting.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.errorLog = exports.warnLog = exports.infoLog = exports.debugLog = exports.createLogger = exports.logger = void 0;
// Get environment
const isDev = process.env.NODE_ENV !== 'production';
const isBrowser = typeof window !== 'undefined';
/**
 * Logger class providing centralized logging capabilities
 */
class Logger {
    constructor() {
        this.logLevel = isDev ? 'debug' : 'info';
        this.recentErrors = [];
        this.MAX_ERRORS = 20;
        // Track components that have created loggers
        this.componentLoggers = new Set();
    }
    /**
     * Set the minimum log level
     */
    setLevel(level) {
        this.logLevel = level;
    }
    /**
     * Create a component-specific logger
     * @param component The name of the component or module
     * @returns An object with logging methods specific to the component
     */
    createLogger(component) {
        this.componentLoggers.add(component);
        return {
            debug: (message, ...args) => this.debug(message, ...args, { component }),
            log: (message, ...args) => this.info(message, ...args, { component }),
            info: (message, ...args) => this.info(message, ...args, { component }),
            warn: (message, ...args) => this.warn(message, ...args, { component }),
            error: (message, ...args) => this.error(message, ...args, { component }),
        };
    }
    /**
     * Log debug information (only in development)
     */
    debug(message, ...args) {
        if (this.shouldLog('debug')) {
            const options = this.extractOptions(args);
            const component = options.component ? `[${options.component}]` : '';
            console.debug(`[DEBUG]${component} ${message}`, ...options.rest);
        }
    }
    /**
     * Log general information
     */
    info(message, ...args) {
        if (this.shouldLog('info')) {
            const options = this.extractOptions(args);
            const component = options.component ? `[${options.component}]` : '';
            console.info(`[INFO]${component} ${message}`, ...options.rest);
        }
    }
    /**
     * Log warnings
     */
    warn(message, ...args) {
        if (this.shouldLog('warn')) {
            const options = this.extractOptions(args);
            const component = options.component ? `[${options.component}]` : '';
            console.warn(`[WARN]${component} ${message}`, ...options.rest);
        }
    }
    /**
     * Log errors
     */
    error(message, ...args) {
        if (this.shouldLog('error')) {
            const options = this.extractOptions(args);
            const component = options.component ? `[${options.component}]` : '';
            console.error(`[ERROR]${component} ${message}`, ...options.rest);
            // Store error for summary
            this.storeError(message, options.component);
        }
    }
    /**
     * Extract options from args, if last arg is an object with component property
     */
    extractOptions(args) {
        const last = args[args.length - 1];
        if (last &&
            typeof last === 'object' &&
            !Array.isArray(last) &&
            'component' in last) {
            return {
                component: last.component,
                rest: args.slice(0, args.length - 1),
            };
        }
        return { rest: args };
    }
    /**
     * Store error in recent errors list
     */
    storeError(message, component) {
        this.recentErrors.unshift({
            message,
            timestamp: Date.now(),
            component,
        });
        // Keep list at max length
        if (this.recentErrors.length > this.MAX_ERRORS) {
            this.recentErrors.pop();
        }
    }
    /**
     * Get a summary of recent errors
     */
    getErrorSummary() {
        if (this.recentErrors.length === 0) {
            return 'No recent errors';
        }
        return this.recentErrors
            .map(err => {
            const date = new Date(err.timestamp).toLocaleTimeString();
            const component = err.component ? `[${err.component}]` : '';
            return `[${date}]${component} ${err.message}`;
        })
            .join('\n');
    }
    /**
     * Get a list of all registered components
     */
    getComponents() {
        return [...this.componentLoggers];
    }
    /**
     * Check if we should log at this level
     */
    shouldLog(level) {
        const levels = ['debug', 'info', 'warn', 'error'];
        const currentLevelIndex = levels.indexOf(this.logLevel);
        const targetLevelIndex = levels.indexOf(level);
        return targetLevelIndex >= currentLevelIndex;
    }
}
// Singleton instance of the logger
exports.logger = new Logger();
// Helper functions for creating component-specific loggers
const createLogger = (component) => exports.logger.createLogger(component);
exports.createLogger = createLogger;
// Utility functions for direct use (for backwards compatibility)
const debugLog = (message, ...args) => exports.logger.debug(message, ...args);
exports.debugLog = debugLog;
const infoLog = (message, ...args) => exports.logger.info(message, ...args);
exports.infoLog = infoLog;
const warnLog = (message, ...args) => exports.logger.warn(message, ...args);
exports.warnLog = warnLog;
const errorLog = (message, ...args) => exports.logger.error(message, ...args);
exports.errorLog = errorLog;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy91dGlscy9sb2dnZXIudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7R0FHRzs7O0FBSUgsa0JBQWtCO0FBQ2xCLE1BQU0sS0FBSyxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsUUFBUSxLQUFLLFlBQVksQ0FBQztBQUNwRCxNQUFNLFNBQVMsR0FBRyxPQUFPLE1BQU0sS0FBSyxXQUFXLENBQUM7QUFFaEQ7O0dBRUc7QUFDSCxNQUFNLE1BQU07SUFBWjtRQUNVLGFBQVEsR0FBYSxLQUFLLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDO1FBQzlDLGlCQUFZLEdBSWYsRUFBRSxDQUFDO1FBQ1MsZUFBVSxHQUFHLEVBQUUsQ0FBQztRQUVqQyw2Q0FBNkM7UUFDckMscUJBQWdCLEdBQWdCLElBQUksR0FBRyxFQUFFLENBQUM7SUFtSnBELENBQUM7SUFqSkM7O09BRUc7SUFDSCxRQUFRLENBQUMsS0FBZTtRQUN0QixJQUFJLENBQUMsUUFBUSxHQUFHLEtBQUssQ0FBQztJQUN4QixDQUFDO0lBRUQ7Ozs7T0FJRztJQUNILFlBQVksQ0FBQyxTQUFpQjtRQUM1QixJQUFJLENBQUMsZ0JBQWdCLENBQUMsR0FBRyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBRXJDLE9BQU87WUFDTCxLQUFLLEVBQUUsQ0FBQyxPQUFlLEVBQUUsR0FBRyxJQUFlLEVBQVEsRUFBRSxDQUNuRCxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sRUFBRSxHQUFHLElBQUksRUFBRSxFQUFFLFNBQVMsRUFBRSxDQUFDO1lBQzdDLEdBQUcsRUFBRSxDQUFDLE9BQWUsRUFBRSxHQUFHLElBQWUsRUFBUSxFQUFFLENBQ2pELElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLEdBQUcsSUFBSSxFQUFFLEVBQUUsU0FBUyxFQUFFLENBQUM7WUFDNUMsSUFBSSxFQUFFLENBQUMsT0FBZSxFQUFFLEdBQUcsSUFBZSxFQUFRLEVBQUUsQ0FDbEQsSUFBSSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsR0FBRyxJQUFJLEVBQUUsRUFBRSxTQUFTLEVBQUUsQ0FBQztZQUM1QyxJQUFJLEVBQUUsQ0FBQyxPQUFlLEVBQUUsR0FBRyxJQUFlLEVBQVEsRUFBRSxDQUNsRCxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxHQUFHLElBQUksRUFBRSxFQUFFLFNBQVMsRUFBRSxDQUFDO1lBQzVDLEtBQUssRUFBRSxDQUFDLE9BQWUsRUFBRSxHQUFHLElBQWUsRUFBUSxFQUFFLENBQ25ELElBQUksQ0FBQyxLQUFLLENBQUMsT0FBTyxFQUFFLEdBQUcsSUFBSSxFQUFFLEVBQUUsU0FBUyxFQUFFLENBQUM7U0FDOUMsQ0FBQztJQUNKLENBQUM7SUFFRDs7T0FFRztJQUNILEtBQUssQ0FBQyxPQUFlLEVBQUUsR0FBRyxJQUFlO1FBQ3ZDLElBQUksSUFBSSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsRUFBRTtZQUMzQixNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQzFDLE1BQU0sU0FBUyxHQUFHLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLElBQUksT0FBTyxDQUFDLFNBQVMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7WUFDcEUsT0FBTyxDQUFDLEtBQUssQ0FBQyxVQUFVLFNBQVMsSUFBSSxPQUFPLEVBQUUsRUFBRSxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztTQUNsRTtJQUNILENBQUM7SUFFRDs7T0FFRztJQUNILElBQUksQ0FBQyxPQUFlLEVBQUUsR0FBRyxJQUFlO1FBQ3RDLElBQUksSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsRUFBRTtZQUMxQixNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQzFDLE1BQU0sU0FBUyxHQUFHLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLElBQUksT0FBTyxDQUFDLFNBQVMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7WUFDcEUsT0FBTyxDQUFDLElBQUksQ0FBQyxTQUFTLFNBQVMsSUFBSSxPQUFPLEVBQUUsRUFBRSxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztTQUNoRTtJQUNILENBQUM7SUFFRDs7T0FFRztJQUNILElBQUksQ0FBQyxPQUFlLEVBQUUsR0FBRyxJQUFlO1FBQ3RDLElBQUksSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsRUFBRTtZQUMxQixNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQzFDLE1BQU0sU0FBUyxHQUFHLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLElBQUksT0FBTyxDQUFDLFNBQVMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7WUFDcEUsT0FBTyxDQUFDLElBQUksQ0FBQyxTQUFTLFNBQVMsSUFBSSxPQUFPLEVBQUUsRUFBRSxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztTQUNoRTtJQUNILENBQUM7SUFFRDs7T0FFRztJQUNILEtBQUssQ0FBQyxPQUFlLEVBQUUsR0FBRyxJQUFlO1FBQ3ZDLElBQUksSUFBSSxDQUFDLFNBQVMsQ0FBQyxPQUFPLENBQUMsRUFBRTtZQUMzQixNQUFNLE9BQU8sR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQzFDLE1BQU0sU0FBUyxHQUFHLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLElBQUksT0FBTyxDQUFDLFNBQVMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7WUFDcEUsT0FBTyxDQUFDLEtBQUssQ0FBQyxVQUFVLFNBQVMsSUFBSSxPQUFPLEVBQUUsRUFBRSxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUVqRSwwQkFBMEI7WUFDMUIsSUFBSSxDQUFDLFVBQVUsQ0FBQyxPQUFPLEVBQUUsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDO1NB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QUEsUUFBUSxZQUNZO0FBQzFCLE1BQU0sT0FBTyxHQUFHLENBQUMsT0FBZSxFQUFFLEdBQUcsSUFBZSxFQUFRLEVBQUUsQ0FDbkUsY0FBTSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsR0FBRyxJQUFJLENBQUMsQ0FBQztBQURuQixRQUFBLE9BQU8sV0FDWTtBQUN6QixNQUFNLE9BQU8sR0FBRyxDQUFDLE9BQWUsRUFBRSxHQUFHLElBQWUsRUFBUSxFQUFFLENBQ25FLGNBQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLEdBQUcsSUFBSSxDQUFDLENBQUM7QUFEbkIsUUFBQSxPQUFPLFdBQ1k7QUFDekIsTUFBTSxRQUFRLEdBQUcsQ0FBQyxPQUFlLEVBQUUsR0FBRyxJQUFlLEVBQVEsRUFBRSxDQUNwRSxjQUFNLENBQUMsS0FBSyxDQUFDLE9BQU8sRUFBRSxHQUFHLElBQUksQ0FBQyxDQUFDO0FBRHBCLFFBQUEsUUFBUSxZQUNZIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9HcmVnQ2FzdHJvL0Rlc2t0b3AvV2hhdFRvRWF0TmV4dC9zcmMvdXRpbHMvbG9nZ2VyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQWR2YW5jZWQgbG9nZ2VyIHV0aWxpdHkgdG8gc3RhbmRhcmRpemUgbG9nZ2luZyBhY3Jvc3MgdGhlIGFwcGxpY2F0aW9uLlxuICogVGhpcyBtb2R1bGUgcHJvdmlkZXMgY29tcG9uZW50LXNwZWNpZmljIGxvZ2dpbmcgY2FwYWJpbGl0aWVzIGFuZCBjb25zaXN0ZW50IGZvcm1hdHRpbmcuXG4gKi9cblxudHlwZSBMb2dMZXZlbCA9ICdkZWJ1ZycgfCAnaW5mbycgfCAnd2FybicgfCAnZXJyb3InO1xuXG4vLyBHZXQgZW52aXJvbm1lbnRcbmNvbnN0IGlzRGV2ID0gcHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJztcbmNvbnN0IGlzQnJvd3NlciA9IHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnO1xuXG4vKipcbiAqIExvZ2dlciBjbGFzcyBwcm92aWRpbmcgY2VudHJhbGl6ZWQgbG9nZ2luZyBjYXBhYmlsaXRpZXNcbiAqL1xuY2xhc3MgTG9nZ2VyIHtcbiAgcHJpdmF0ZSBsb2dMZXZlbDogTG9nTGV2ZWwgPSBpc0RldiA/ICdkZWJ1ZycgOiAnaW5mbyc7XG4gIHByaXZhdGUgcmVjZW50RXJyb3JzOiBBcnJheTx7XG4gICAgbWVzc2FnZTogc3RyaW5nO1xuICAgIHRpbWVzdGFtcDogbnVtYmVyO1xuICAgIGNvbXBvbmVudD86IHN0cmluZztcbiAgfT4gPSBbXTtcbiAgcHJpdmF0ZSByZWFkb25seSBNQVhfRVJST1JTID0gMjA7XG5cbiAgLy8gVHJhY2sgY29tcG9uZW50cyB0aGF0IGhhdmUgY3JlYXRlZCBsb2dnZXJzXG4gIHByaXZhdGUgY29tcG9uZW50TG9nZ2VyczogU2V0PHN0cmluZz4gPSBuZXcgU2V0KCk7XG5cbiAgLyoqXG4gICAqIFNldCB0aGUgbWluaW11bSBsb2cgbGV2ZWxcbiAgICovXG4gIHNldExldmVsKGxldmVsOiBMb2dMZXZlbCk6IHZvaWQge1xuICAgIHRoaXMubG9nTGV2ZWwgPSBsZXZlbDtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgYSBjb21wb25lbnQtc3BlY2lmaWMgbG9nZ2VyXG4gICAqIEBwYXJhbSBjb21wb25lbnQgVGhlIG5hbWUgb2YgdGhlIGNvbXBvbmVudCBvciBtb2R1bGVcbiAgICogQHJldHVybnMgQW4gb2JqZWN0IHdpdGggbG9nZ2luZyBtZXRob2RzIHNwZWNpZmljIHRvIHRoZSBjb21wb25lbnRcbiAgICovXG4gIGNyZWF0ZUxvZ2dlcihjb21wb25lbnQ6IHN0cmluZykge1xuICAgIHRoaXMuY29tcG9uZW50TG9nZ2Vycy5hZGQoY29tcG9uZW50KTtcblxuICAgIHJldHVybiB7XG4gICAgICBkZWJ1ZzogKG1lc3NhZ2U6IHN0cmluZywgLi4uYXJnczogdW5rbm93bltdKTogdm9pZCA9PlxuICAgICAgICB0aGlzLmRlYnVnKG1lc3NhZ2UsIC4uLmFyZ3MsIHsgY29tcG9uZW50IH0pLFxuICAgICAgbG9nOiAobWVzc2FnZTogc3RyaW5nLCAuLi5hcmdzOiB1bmtub3duW10pOiB2b2lkID0+XG4gICAgICAgIHRoaXMuaW5mbyhtZXNzYWdlLCAuLi5hcmdzLCB7IGNvbXBvbmVudCB9KSxcbiAgICAgIGluZm86IChtZXNzYWdlOiBzdHJpbmcsIC4uLmFyZ3M6IHVua25vd25bXSk6IHZvaWQgPT5cbiAgICAgICAgdGhpcy5pbmZvKG1lc3NhZ2UsIC4uLmFyZ3MsIHsgY29tcG9uZW50IH0pLFxuICAgICAgd2FybjogKG1lc3NhZ2U6IHN0cmluZywgLi4uYXJnczogdW5rbm93bltdKTogdm9pZCA9PlxuICAgICAgICB0aGlzLndhcm4obWVzc2FnZSwgLi4uYXJncywgeyBjb21wb25lbnQgfSksXG4gICAgICBlcnJvcjogKG1lc3NhZ2U6IHN0cmluZywgLi4uYXJnczogdW5rbm93bltdKTogdm9pZCA9PlxuICAgICAgICB0aGlzLmVycm9yKG1lc3NhZ2UsIC4uLmFyZ3MsIHsgY29tcG9uZW50IH0pLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogTG9nIGRlYnVnIGluZm9ybWF0aW9uIChvbmx5IGluIGRldmVsb3BtZW50KVxuICAgKi9cbiAgZGVidWcobWVzc2FnZTogc3RyaW5nLCAuLi5hcmdzOiB1bmtub3duW10pOiB2b2lkIHtcbiAgICBpZiAodGhpcy5zaG91bGRMb2coJ2RlYnVnJykpIHtcbiAgICAgIGNvbnN0IG9wdGlvbnMgPSB0aGlzLmV4dHJhY3RPcHRpb25zKGFyZ3MpO1xuICAgICAgY29uc3QgY29tcG9uZW50ID0gb3B0aW9ucy5jb21wb25lbnQgPyBgWyR7b3B0aW9ucy5jb21wb25lbnR9XWAgOiAnJztcbiAgICAgIGNvbnNvbGUuZGVidWcoYFtERUJVR10ke2NvbXBvbmVudH0gJHttZXNzYWdlfWAsIC4uLm9wdGlvbnMucmVzdCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIExvZyBnZW5lcmFsIGluZm9ybWF0aW9uXG4gICAqL1xuICBpbmZvKG1lc3NhZ2U6IHN0cmluZywgLi4uYXJnczogdW5rbm93bltdKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuc2hvdWxkTG9nKCdpbmZvJykpIHtcbiAgICAgIGNvbnN0IG9wdGlvbnMgPSB0aGlzLmV4dHJhY3RPcHRpb25zKGFyZ3MpO1xuICAgICAgY29uc3QgY29tcG9uZW50ID0gb3B0aW9ucy5jb21wb25lbnQgPyBgWyR7b3B0aW9ucy5jb21wb25lbnR9XWAgOiAnJztcbiAgICAgIGNvbnNvbGUuaW5mbyhgW0lORk9dJHtjb21wb25lbnR9ICR7bWVzc2FnZX1gLCAuLi5vcHRpb25zLnJlc3QpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBMb2cgd2FybmluZ3NcbiAgICovXG4gIHdhcm4obWVzc2FnZTogc3RyaW5nLCAuLi5hcmdzOiB1bmtub3duW10pOiB2b2lkIHtcbiAgICBpZiAodGhpcy5zaG91bGRMb2coJ3dhcm4nKSkge1xuICAgICAgY29uc3Qgb3B0aW9ucyA9IHRoaXMuZXh0cmFjdE9wdGlvbnMoYXJncyk7XG4gICAgICBjb25zdCBjb21wb25lbnQgPSBvcHRpb25zLmNvbXBvbmVudCA/IGBbJHtvcHRpb25zLmNvbXBvbmVudH1dYCA6ICcnO1xuICAgICAgY29uc29sZS53YXJuKGBbV0FSTl0ke2NvbXBvbmVudH0gJHttZXNzYWdlfWAsIC4uLm9wdGlvbnMucmVzdCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIExvZyBlcnJvcnNcbiAgICovXG4gIGVycm9yKG1lc3NhZ2U6IHN0cmluZywgLi4uYXJnczogdW5rbm93bltdKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuc2hvdWxkTG9nKCdlcnJvcicpKSB7XG4gICAgICBjb25zdCBvcHRpb25zID0gdGhpcy5leHRyYWN0T3B0aW9ucyhhcmdzKTtcbiAgICAgIGNvbnN0IGNvbXBvbmVudCA9IG9wdGlvbnMuY29tcG9uZW50ID8gYFske29wdGlvbnMuY29tcG9uZW50fV1gIDogJyc7XG4gICAgICBjb25zb2xlLmVycm9yKGBbRVJST1JdJHtjb21wb25lbnR9ICR7bWVzc2FnZX1gLCAuLi5vcHRpb25zLnJlc3QpO1xuXG4gICAgICAvLyBTdG9yZSBlcnJvciBmb3Igc3VtbWFyeVxuICAgICAgdGhpcy5zdG9yZUVycm9yKG1lc3NhZ2UsIG9wdGlvbnMuY29tcG9uZW50KTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRXh0cmFjdCBvcHRpb25zIGZyb20gYXJncywgaWYgbGFzdCBhcmcgaXMgYW4gb2JqZWN0IHdpdGggY29tcG9uZW50IHByb3BlcnR5XG4gICAqL1xuICBwcml2YXRlIGV4dHJhY3RPcHRpb25zKGFyZ3M6IHVua25vd25bXSkge1xuICAgIGNvbnN0IGxhc3QgPSBhcmdzW2FyZ3MubGVuZ3RoIC0gMV07XG4gICAgaWYgKFxuICAgICAgbGFzdCAmJlxuICAgICAgdHlwZW9mIGxhc3QgPT09ICdvYmplY3QnICYmXG4gICAgICAhQXJyYXkuaXNBcnJheShsYXN0KSAmJlxuICAgICAgJ2NvbXBvbmVudCcgaW4gbGFzdFxuICAgICkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgY29tcG9uZW50OiBsYXN0LmNvbXBvbmVudCBhcyBzdHJpbmcsXG4gICAgICAgIHJlc3Q6IGFyZ3Muc2xpY2UoMCwgYXJncy5sZW5ndGggLSAxKSxcbiAgICAgIH07XG4gICAgfVxuICAgIHJldHVybiB7IHJlc3Q6IGFyZ3MgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTdG9yZSBlcnJvciBpbiByZWNlbnQgZXJyb3JzIGxpc3RcbiAgICovXG4gIHByaXZhdGUgc3RvcmVFcnJvcihtZXNzYWdlOiBzdHJpbmcsIGNvbXBvbmVudD86IHN0cmluZyk6IHZvaWQge1xuICAgIHRoaXMucmVjZW50RXJyb3JzLnVuc2hpZnQoe1xuICAgICAgbWVzc2FnZSxcbiAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICAgIGNvbXBvbmVudCxcbiAgICB9KTtcblxuICAgIC8vIEtlZXAgbGlzdCBhdCBtYXggbGVuZ3RoXG4gICAgaWYgKHRoaXMucmVjZW50RXJyb3JzLmxlbmd0aCA+IHRoaXMuTUFYX0VSUk9SUykge1xuICAgICAgdGhpcy5yZWNlbnRFcnJvcnMucG9wKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldCBhIHN1bW1hcnkgb2YgcmVjZW50IGVycm9yc1xuICAgKi9cbiAgZ2V0RXJyb3JTdW1tYXJ5KCk6IHN0cmluZyB7XG4gICAgaWYgKHRoaXMucmVjZW50RXJyb3JzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuICdObyByZWNlbnQgZXJyb3JzJztcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5yZWNlbnRFcnJvcnNcbiAgICAgIC5tYXAoZXJyID0+IHtcbiAgICAgICAgY29uc3QgZGF0ZSA9IG5ldyBEYXRlKGVyci50aW1lc3RhbXApLnRvTG9jYWxlVGltZVN0cmluZygpO1xuICAgICAgICBjb25zdCBjb21wb25lbnQgPSBlcnIuY29tcG9uZW50ID8gYFske2Vyci5jb21wb25lbnR9XWAgOiAnJztcbiAgICAgICAgcmV0dXJuIGBbJHtkYXRlfV0ke2NvbXBvbmVudH0gJHtlcnIubWVzc2FnZX1gO1xuICAgICAgfSlcbiAgICAgIC5qb2luKCdcXG4nKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgYSBsaXN0IG9mIGFsbCByZWdpc3RlcmVkIGNvbXBvbmVudHNcbiAgICovXG4gIGdldENvbXBvbmVudHMoKTogc3RyaW5nW10ge1xuICAgIHJldHVybiBbLi4udGhpcy5jb21wb25lbnRMb2dnZXJzXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVjayBpZiB3ZSBzaG91bGQgbG9nIGF0IHRoaXMgbGV2ZWxcbiAgICovXG4gIHByaXZhdGUgc2hvdWxkTG9nKGxldmVsOiBMb2dMZXZlbCk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IGxldmVsczogTG9nTGV2ZWxbXSA9IFsnZGVidWcnLCAnaW5mbycsICd3YXJuJywgJ2Vycm9yJ107XG4gICAgY29uc3QgY3VycmVudExldmVsSW5kZXggPSBsZXZlbHMuaW5kZXhPZih0aGlzLmxvZ0xldmVsKTtcbiAgICBjb25zdCB0YXJnZXRMZXZlbEluZGV4ID0gbGV2ZWxzLmluZGV4T2YobGV2ZWwpO1xuXG4gICAgcmV0dXJuIHRhcmdldExldmVsSW5kZXggPj0gY3VycmVudExldmVsSW5kZXg7XG4gIH1cbn1cblxuLy8gU2luZ2xldG9uIGluc3RhbmNlIG9mIHRoZSBsb2dnZXJcbmV4cG9ydCBjb25zdCBsb2dnZXIgPSBuZXcgTG9nZ2VyKCk7XG5cbi8vIEhlbHBlciBmdW5jdGlvbnMgZm9yIGNyZWF0aW5nIGNvbXBvbmVudC1zcGVjaWZpYyBsb2dnZXJzXG5leHBvcnQgY29uc3QgY3JlYXRlTG9nZ2VyID0gKGNvbXBvbmVudDogc3RyaW5nKSA9PlxuICBsb2dnZXIuY3JlYXRlTG9nZ2VyKGNvbXBvbmVudCk7XG5cbi8vIFV0aWxpdHkgZnVuY3Rpb25zIGZvciBkaXJlY3QgdXNlIChmb3IgYmFja3dhcmRzIGNvbXBhdGliaWxpdHkpXG5leHBvcnQgY29uc3QgZGVidWdMb2cgPSAobWVzc2FnZTogc3RyaW5nLCAuLi5hcmdzOiB1bmtub3duW10pOiB2b2lkID0+XG4gIGxvZ2dlci5kZWJ1ZyhtZXNzYWdlLCAuLi5hcmdzKTtcbmV4cG9ydCBjb25zdCBpbmZvTG9nID0gKG1lc3NhZ2U6IHN0cmluZywgLi4uYXJnczogdW5rbm93bltdKTogdm9pZCA9PlxuICBsb2dnZXIuaW5mbyhtZXNzYWdlLCAuLi5hcmdzKTtcbmV4cG9ydCBjb25zdCB3YXJuTG9nID0gKG1lc3NhZ2U6IHN0cmluZywgLi4uYXJnczogdW5rbm93bltdKTogdm9pZCA9PlxuICBsb2dnZXIud2FybihtZXNzYWdlLCAuLi5hcmdzKTtcbmV4cG9ydCBjb25zdCBlcnJvckxvZyA9IChtZXNzYWdlOiBzdHJpbmcsIC4uLmFyZ3M6IHVua25vd25bXSk6IHZvaWQgPT5cbiAgbG9nZ2VyLmVycm9yKG1lc3NhZ2UsIC4uLmFyZ3MpO1xuIl0sInZlcnNpb24iOjN9