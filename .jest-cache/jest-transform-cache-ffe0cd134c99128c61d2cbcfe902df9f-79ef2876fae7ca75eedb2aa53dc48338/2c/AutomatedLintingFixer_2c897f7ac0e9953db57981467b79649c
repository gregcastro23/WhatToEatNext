7f2ee45a03699707b8505a516199cf81
"use strict";
/**
 * AutomatedLintingFixer - Automated error resolution system with safety protocols
 *
 * This class implements comprehensive automated fixing capabilities with batch processing,
 * safety validation, and rollback mechanisms for ESLint issues.
 */
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.AutomatedLintingFixer = void 0;
const child_process_1 = require("child_process");
const fs = __importStar(require("fs"));
const path = __importStar(require("path"));
/**
 * Main AutomatedLintingFixer class
 */
class AutomatedLintingFixer {
    constructor(workspaceRoot = process.cwd(), safetyProtocols = {}) {
        this.workspaceRoot = workspaceRoot;
        this.eslintConfigPath = path.join(workspaceRoot, 'eslint.config.cjs');
        // Default safety protocols
        this.safetyProtocols = {
            enableRollback: true,
            validateBeforeFix: true,
            validateAfterFix: true,
            maxFailuresBeforeStop: 5,
            requireManualApproval: false,
            preservePatterns: [
                '**/calculations/**',
                '**/data/planets/**',
                '**/*astrological*',
                '**/*campaign*'
            ],
            ...safetyProtocols
        };
    }
    /**
     * Apply automated fixes with batch processing and safety protocols
     */
    async applyAutomatedFixes(categorizedErrors, options = {}) {
        var _a, _b;
        const startTime = new Date();
        console.log('üîß Starting automated linting fixes with safety protocols...');
        const batchOptions = {
            batchSize: 10,
            maxConcurrentBatches: 1,
            validateAfterEachBatch: true,
            continueOnError: false,
            createBackups: true,
            dryRun: false,
            ...options
        };
        const result = {
            success: false,
            fixedIssues: 0,
            failedIssues: 0,
            processedFiles: [],
            errors: [],
            validationResults: [],
            metrics: {
                startTime,
                endTime: new Date(),
                totalTime: 0,
                filesProcessed: 0,
                issuesAttempted: 0,
                issuesFixed: 0,
                issuesFailed: 0,
                validationTime: 0,
                rollbacksPerformed: 0
            }
        };
        try {
            // Step 1: Pre-fix validation
            if (this.safetyProtocols.validateBeforeFix) {
                console.log('üîç Running pre-fix validation...');
                const preValidation = await this.runValidation();
                result.validationResults.push(...preValidation);
                if (preValidation.some(v => !v.success && v.type === 'build')) {
                    throw new Error('Pre-fix validation failed - build is broken');
                }
            }
            // Step 2: Create backup/stash if enabled
            if (batchOptions.createBackups && this.safetyProtocols.enableRollback) {
                console.log('üíæ Creating backup...');
                this.currentRollbackInfo = await this.createBackup();
                result.rollbackInfo = this.currentRollbackInfo;
            }
            // Step 3: Process auto-fixable issues in batches
            const autoFixableIssues = categorizedErrors.autoFixable.filter(issue => this.isSafeToAutoFix(issue));
            console.log(`üéØ Processing ${autoFixableIssues.length} auto-fixable issues in batches of ${batchOptions.batchSize}`);
            const batches = this.createBatches(autoFixableIssues, batchOptions.batchSize);
            let failureCount = 0;
            for (let i = 0; i < batches.length; i++) {
                const batch = batches[i];
                console.log(`üì¶ Processing batch ${i + 1}/${batches.length} (${batch.length} issues)`);
                try {
                    const batchResult = await this.processBatch(batch, batchOptions);
                    result.fixedIssues += batchResult.fixedIssues;
                    result.failedIssues += batchResult.failedIssues;
                    result.processedFiles.push(...batchResult.processedFiles);
                    result.errors.push(...batchResult.errors);
                    // Validate after each batch if enabled
                    if (batchOptions.validateAfterEachBatch) {
                        const batchValidation = await this.runValidation();
                        result.validationResults.push(...batchValidation);
                        if (batchValidation.some(v => !v.success && v.type === 'build')) {
                            console.warn('‚ö†Ô∏è Batch validation failed - performing rollback');
                            await this.performRollback();
                            result.metrics.rollbacksPerformed++;
                            failureCount++;
                            if (failureCount >= this.safetyProtocols.maxFailuresBeforeStop) {
                                throw new Error('Maximum failures reached - stopping automated fixes');
                            }
                        }
                    }
                }
                catch (error) {
                    console.error(`‚ùå Batch ${i + 1} failed:`, error);
                    result.errors.push({
                        file: 'batch-processing',
                        rule: 'batch-error',
                        message: `Batch ${i + 1} processing failed`,
                        error: error instanceof Error ? error.message : String(error),
                        severity: 'error'
                    });
                    failureCount++;
                    if (!batchOptions.continueOnError || failureCount >= this.safetyProtocols.maxFailuresBeforeStop) {
                        break;
                    }
                }
            }
            // Step 4: Final validation
            if (this.safetyProtocols.validateAfterFix) {
                console.log('‚úÖ Running final validation...');
                const finalValidation = await this.runValidation();
                result.validationResults.push(...finalValidation);
                const buildSuccess = (_b = (_a = finalValidation.find(v => v.type === 'build')) === null || _a === void 0 ? void 0 : _a.success) !== null && _b !== void 0 ? _b : true;
                result.success = buildSuccess && result.fixedIssues > 0;
            }
            else {
                result.success = result.fixedIssues > 0;
            }
            // Update metrics
            const endTime = new Date();
            result.metrics.endTime = endTime;
            result.metrics.totalTime = endTime.getTime() - startTime.getTime();
            result.metrics.filesProcessed = new Set(result.processedFiles).size;
            result.metrics.issuesAttempted = autoFixableIssues.length;
            result.metrics.issuesFixed = result.fixedIssues;
            result.metrics.issuesFailed = result.failedIssues;
            console.log(`‚úÖ Automated fixes complete: ${result.fixedIssues} fixed, ${result.failedIssues} failed`);
            return result;
        }
        catch (error) {
            console.error('‚ùå Automated fixing failed:', error);
            // Attempt rollback on critical failure
            if (this.currentRollbackInfo && this.safetyProtocols.enableRollback) {
                console.log('üîÑ Performing emergency rollback...');
                await this.performRollback();
                result.metrics.rollbacksPerformed++;
            }
            result.success = false;
            result.errors.push({
                file: 'system',
                rule: 'critical-error',
                message: 'Critical failure during automated fixing',
                error: error instanceof Error ? error.message : String(error),
                severity: 'critical'
            });
            return result;
        }
    }
    /**
     * Handle unused variable removal with underscore prefixing
     */
    async handleUnusedVariables(issues, options = {}) {
        var _a, _b;
        console.log('üßπ Handling unused variables...');
        const fixOptions = {
            prefixWithUnderscore: true,
            removeCompletely: false,
            preservePatterns: [
                '**/calculations/**',
                '**/data/planets/**',
                '**/*astrological*'
            ],
            skipTestFiles: false,
            skipDomainFiles: true,
            ...options
        };
        const unusedVarIssues = issues.filter(issue => issue.rule.includes('no-unused-vars') ||
            issue.rule.includes('unused-vars'));
        const result = {
            success: false,
            fixedIssues: 0,
            failedIssues: 0,
            processedFiles: [],
            errors: [],
            validationResults: [],
            metrics: {
                startTime: new Date(),
                endTime: new Date(),
                totalTime: 0,
                filesProcessed: 0,
                issuesAttempted: unusedVarIssues.length,
                issuesFixed: 0,
                issuesFailed: 0,
                validationTime: 0,
                rollbacksPerformed: 0
            }
        };
        for (const issue of unusedVarIssues) {
            try {
                // Skip if file should be preserved
                if (this.shouldPreserveFile(issue.file, fixOptions.preservePatterns)) {
                    console.log(`‚è≠Ô∏è Skipping preserved file: ${issue.file}`);
                    continue;
                }
                // Skip domain files if configured
                if (fixOptions.skipDomainFiles && ((_a = issue.domainContext) === null || _a === void 0 ? void 0 : _a.requiresSpecialHandling)) {
                    console.log(`‚è≠Ô∏è Skipping domain file: ${issue.file}`);
                    continue;
                }
                // Skip test files if configured
                if (fixOptions.skipTestFiles && ((_b = issue.domainContext) === null || _b === void 0 ? void 0 : _b.isTestFile)) {
                    console.log(`‚è≠Ô∏è Skipping test file: ${issue.file}`);
                    continue;
                }
                const fixed = await this.fixUnusedVariable(issue, fixOptions);
                if (fixed) {
                    result.fixedIssues++;
                    if (!result.processedFiles.includes(issue.file)) {
                        result.processedFiles.push(issue.file);
                    }
                }
                else {
                    result.failedIssues++;
                }
            }
            catch (error) {
                result.failedIssues++;
                result.errors.push({
                    file: issue.file,
                    rule: issue.rule,
                    message: `Failed to fix unused variable: ${issue.message}`,
                    error: error instanceof Error ? error.message : String(error),
                    severity: 'error'
                });
            }
        }
        result.success = result.fixedIssues > 0;
        result.metrics.endTime = new Date();
        result.metrics.totalTime = result.metrics.endTime.getTime() - result.metrics.startTime.getTime();
        result.metrics.filesProcessed = result.processedFiles.length;
        result.metrics.issuesFixed = result.fixedIssues;
        result.metrics.issuesFailed = result.failedIssues;
        console.log(`üßπ Unused variables handled: ${result.fixedIssues} fixed, ${result.failedIssues} failed`);
        return result;
    }
    /**
     * Optimize import statements and remove duplicates
     */
    async optimizeImports(issues, options = {}) {
        console.log('üì¶ Optimizing import statements...');
        const importOptions = {
            removeDuplicates: true,
            organizeImports: true,
            removeUnused: true,
            preserveComments: true,
            sortImports: true,
            ...options
        };
        const importIssues = issues.filter(issue => issue.category.primary === 'import' ||
            issue.rule.startsWith('import/'));
        const result = {
            success: false,
            fixedIssues: 0,
            failedIssues: 0,
            processedFiles: [],
            errors: [],
            validationResults: [],
            metrics: {
                startTime: new Date(),
                endTime: new Date(),
                totalTime: 0,
                filesProcessed: 0,
                issuesAttempted: importIssues.length,
                issuesFixed: 0,
                issuesFailed: 0,
                validationTime: 0,
                rollbacksPerformed: 0
            }
        };
        // Group issues by file for batch processing
        const issuesByFile = new Map();
        for (const issue of importIssues) {
            if (!issuesByFile.has(issue.file)) {
                issuesByFile.set(issue.file, []);
            }
            issuesByFile.get(issue.file).push(issue);
        }
        for (const [filePath, fileIssues] of issuesByFile) {
            try {
                // Skip if file should be preserved
                if (this.shouldPreserveFile(filePath, this.safetyProtocols.preservePatterns)) {
                    console.log(`‚è≠Ô∏è Skipping preserved file: ${filePath}`);
                    continue;
                }
                const fixed = await this.optimizeFileImports(filePath, fileIssues, importOptions);
                if (fixed) {
                    result.fixedIssues += fileIssues.length;
                    result.processedFiles.push(filePath);
                }
                else {
                    result.failedIssues += fileIssues.length;
                }
            }
            catch (error) {
                result.failedIssues += fileIssues.length;
                result.errors.push({
                    file: filePath,
                    rule: 'import-optimization',
                    message: `Failed to optimize imports`,
                    error: error instanceof Error ? error.message : String(error),
                    severity: 'error'
                });
            }
        }
        result.success = result.fixedIssues > 0;
        result.metrics.endTime = new Date();
        result.metrics.totalTime = result.metrics.endTime.getTime() - result.metrics.startTime.getTime();
        result.metrics.filesProcessed = result.processedFiles.length;
        result.metrics.issuesFixed = result.fixedIssues;
        result.metrics.issuesFailed = result.failedIssues;
        console.log(`üì¶ Import optimization complete: ${result.fixedIssues} fixed, ${result.failedIssues} failed`);
        return result;
    }
    /**
     * Improve type annotations for simple cases
     */
    async improveTypeAnnotations(issues, options = {}) {
        console.log('üè∑Ô∏è Improving type annotations...');
        const typeOptions = {
            inferFromUsage: true,
            useStrictTypes: false,
            preserveExplicitAny: [
                '**/calculations/**',
                '**/data/planets/**'
            ],
            maxComplexity: 'simple',
            ...options
        };
        const typeIssues = issues.filter(issue => issue.rule.includes('no-explicit-any') ||
            issue.rule.includes('no-implicit-any') ||
            issue.category.primary === 'typescript');
        const result = {
            success: false,
            fixedIssues: 0,
            failedIssues: 0,
            processedFiles: [],
            errors: [],
            validationResults: [],
            metrics: {
                startTime: new Date(),
                endTime: new Date(),
                totalTime: 0,
                filesProcessed: 0,
                issuesAttempted: typeIssues.length,
                issuesFixed: 0,
                issuesFailed: 0,
                validationTime: 0,
                rollbacksPerformed: 0
            }
        };
        for (const issue of typeIssues) {
            try {
                // Skip if file should preserve explicit any
                if (this.shouldPreserveFile(issue.file, typeOptions.preserveExplicitAny)) {
                    console.log(`‚è≠Ô∏è Preserving explicit any in: ${issue.file}`);
                    continue;
                }
                // Only handle simple cases based on complexity setting
                if (typeOptions.maxComplexity === 'simple' && !this.isSimpleTypeIssue(issue)) {
                    console.log(`‚è≠Ô∏è Skipping complex type issue: ${issue.rule} in ${issue.file}`);
                    continue;
                }
                const fixed = await this.improveTypeAnnotation(issue, typeOptions);
                if (fixed) {
                    result.fixedIssues++;
                    if (!result.processedFiles.includes(issue.file)) {
                        result.processedFiles.push(issue.file);
                    }
                }
                else {
                    result.failedIssues++;
                }
            }
            catch (error) {
                result.failedIssues++;
                result.errors.push({
                    file: issue.file,
                    rule: issue.rule,
                    message: `Failed to improve type annotation: ${issue.message}`,
                    error: error instanceof Error ? error.message : String(error),
                    severity: 'error'
                });
            }
        }
        result.success = result.fixedIssues > 0;
        result.metrics.endTime = new Date();
        result.metrics.totalTime = result.metrics.endTime.getTime() - result.metrics.startTime.getTime();
        result.metrics.filesProcessed = result.processedFiles.length;
        result.metrics.issuesFixed = result.fixedIssues;
        result.metrics.issuesFailed = result.failedIssues;
        console.log(`üè∑Ô∏è Type annotation improvement complete: ${result.fixedIssues} fixed, ${result.failedIssues} failed`);
        return result;
    }
    /**
     * Validate fixes with comprehensive checks
     */
    async validateFixes() {
        console.log('üîç Running comprehensive validation...');
        return await this.runValidation();
    }
    /**
     * Perform rollback to previous state
     */
    async performRollback() {
        if (!this.currentRollbackInfo || !this.safetyProtocols.enableRollback) {
            console.warn('‚ö†Ô∏è No rollback information available');
            return false;
        }
        try {
            console.log(`üîÑ Rolling back to stash: ${this.currentRollbackInfo.stashId}`);
            (0, child_process_1.execSync)(this.currentRollbackInfo.rollbackCommand, {
                cwd: this.workspaceRoot,
                stdio: 'pipe'
            });
            console.log('‚úÖ Rollback completed successfully');
            return true;
        }
        catch (error) {
            console.error('‚ùå Rollback failed:', error);
            return false;
        }
    }
    // Private helper methods
    async createBackup() {
        var _a;
        const timestamp = new Date();
        const stashMessage = `automated-linting-fixes-${timestamp.toISOString()}`;
        try {
            (0, child_process_1.execSync)(`git add -A && git stash push -m "${stashMessage}"`, {
                cwd: this.workspaceRoot,
                stdio: 'pipe'
            });
            const stashList = (0, child_process_1.execSync)('git stash list', {
                cwd: this.workspaceRoot,
                encoding: 'utf8'
            });
            const stashId = ((_a = stashList.split('\n')[0]) === null || _a === void 0 ? void 0 : _a.split(':')[0]) || 'stash@{0}';
            return {
                stashId,
                timestamp,
                affectedFiles: [],
                rollbackCommand: `git stash pop ${stashId}`
            };
        }
        catch (error) {
            throw new Error(`Failed to create backup: ${error}`);
        }
    }
    async runValidation() {
        const results = [];
        const validationStart = Date.now();
        // Build validation
        try {
            (0, child_process_1.execSync)('npm run build', {
                cwd: this.workspaceRoot,
                stdio: 'pipe',
                timeout: 60000 // 1 minute timeout
            });
            results.push({
                type: 'build',
                success: true,
                message: 'Build passed successfully'
            });
        }
        catch (error) {
            results.push({
                type: 'build',
                success: false,
                message: 'Build failed',
                details: error instanceof Error ? error.message : String(error)
            });
        }
        // Type check validation
        try {
            (0, child_process_1.execSync)('npx tsc --noEmit', {
                cwd: this.workspaceRoot,
                stdio: 'pipe',
                timeout: 30000 // 30 second timeout
            });
            results.push({
                type: 'type-check',
                success: true,
                message: 'Type checking passed'
            });
        }
        catch (error) {
            results.push({
                type: 'type-check',
                success: false,
                message: 'Type checking failed',
                details: error instanceof Error ? error.message : String(error)
            });
        }
        // Lint validation
        try {
            (0, child_process_1.execSync)(`npx eslint --config ${this.eslintConfigPath} src`, {
                cwd: this.workspaceRoot,
                stdio: 'pipe',
                timeout: 30000 // 30 second timeout
            });
            results.push({
                type: 'lint',
                success: true,
                message: 'Linting passed'
            });
        }
        catch (error) {
            // ESLint returns non-zero exit code for warnings/errors, which is expected
            results.push({
                type: 'lint',
                success: true,
                message: 'Linting completed (may have remaining issues)'
            });
        }
        // Test validation (if tests exist)
        if (fs.existsSync(path.join(this.workspaceRoot, 'jest.config.js'))) {
            try {
                (0, child_process_1.execSync)('npm test -- --passWithNoTests', {
                    cwd: this.workspaceRoot,
                    stdio: 'pipe',
                    timeout: 120000 // 2 minute timeout
                });
                results.push({
                    type: 'test',
                    success: true,
                    message: 'Tests passed'
                });
            }
            catch (error) {
                results.push({
                    type: 'test',
                    success: false,
                    message: 'Tests failed',
                    details: error instanceof Error ? error.message : String(error)
                });
            }
        }
        const validationTime = Date.now() - validationStart;
        console.log(`üîç Validation completed in ${validationTime}ms`);
        return results;
    }
    isSafeToAutoFix(issue) {
        var _a;
        // Check if file should be preserved
        if (this.shouldPreserveFile(issue.file, this.safetyProtocols.preservePatterns)) {
            return false;
        }
        // Check if issue requires special handling
        if ((_a = issue.domainContext) === null || _a === void 0 ? void 0 : _a.requiresSpecialHandling) {
            return false;
        }
        // Only auto-fix issues with high confidence
        if (issue.resolutionStrategy.confidence < 0.7) {
            return false;
        }
        // Only auto-fix low to medium risk issues
        if (issue.resolutionStrategy.riskLevel === 'high') {
            return false;
        }
        return issue.autoFixable;
    }
    shouldPreserveFile(filePath, patterns) {
        return patterns.some(pattern => {
            const regex = new RegExp(pattern.replace(/\*\*/g, '.*').replace(/\*/g, '[^/]*'));
            return regex.test(filePath);
        });
    }
    createBatches(items, batchSize) {
        const batches = [];
        for (let i = 0; i < items.length; i += batchSize) {
            batches.push(items.slice(i, i + batchSize));
        }
        return batches;
    }
    async processBatch(batch, options) {
        const result = {
            success: false,
            fixedIssues: 0,
            failedIssues: 0,
            processedFiles: [],
            errors: [],
            validationResults: [],
            metrics: {
                startTime: new Date(),
                endTime: new Date(),
                totalTime: 0,
                filesProcessed: 0,
                issuesAttempted: batch.length,
                issuesFixed: 0,
                issuesFailed: 0,
                validationTime: 0,
                rollbacksPerformed: 0
            }
        };
        // Group issues by file for efficient processing
        const issuesByFile = new Map();
        for (const issue of batch) {
            if (!issuesByFile.has(issue.file)) {
                issuesByFile.set(issue.file, []);
            }
            issuesByFile.get(issue.file).push(issue);
        }
        // Process each file
        for (const [filePath, fileIssues] of issuesByFile) {
            try {
                if (options.dryRun) {
                    console.log(`üîç [DRY RUN] Would fix ${fileIssues.length} issues in ${filePath}`);
                    result.fixedIssues += fileIssues.length;
                }
                else {
                    const fixed = await this.fixFileIssues(filePath, fileIssues);
                    if (fixed) {
                        result.fixedIssues += fileIssues.length;
                        result.processedFiles.push(filePath);
                    }
                    else {
                        result.failedIssues += fileIssues.length;
                    }
                }
            }
            catch (error) {
                result.failedIssues += fileIssues.length;
                result.errors.push({
                    file: filePath,
                    rule: 'batch-processing',
                    message: `Failed to process file in batch`,
                    error: error instanceof Error ? error.message : String(error),
                    severity: 'error'
                });
            }
        }
        result.success = result.fixedIssues > 0;
        result.metrics.endTime = new Date();
        result.metrics.totalTime = result.metrics.endTime.getTime() - result.metrics.startTime.getTime();
        result.metrics.filesProcessed = result.processedFiles.length;
        result.metrics.issuesFixed = result.fixedIssues;
        result.metrics.issuesFailed = result.failedIssues;
        return result;
    }
    async fixFileIssues(filePath, issues) {
        try {
            // Use ESLint's auto-fix capability for the specific file
            const command = `npx eslint --config ${this.eslintConfigPath} --fix "${filePath}"`;
            (0, child_process_1.execSync)(command, {
                cwd: this.workspaceRoot,
                stdio: 'pipe'
            });
            return true;
        }
        catch (error) {
            console.warn(`‚ö†Ô∏è Failed to fix issues in ${filePath}:`, error);
            return false;
        }
    }
    async fixUnusedVariable(issue, options) {
        try {
            const filePath = path.join(this.workspaceRoot, issue.file);
            const content = fs.readFileSync(filePath, 'utf8');
            const lines = content.split('\n');
            // Find the line with the unused variable
            const lineIndex = issue.line - 1;
            if (lineIndex >= 0 && lineIndex < lines.length) {
                const line = lines[lineIndex];
                // Extract variable name from the message
                const varNameMatch = issue.message.match(/'([^']+)' is (defined but never used|assigned a value but never used)/);
                if (varNameMatch) {
                    const varName = varNameMatch[1];
                    if (options.prefixWithUnderscore && !varName.startsWith('_')) {
                        // Prefix with underscore to indicate intentional non-use
                        const newLine = line.replace(new RegExp(`\\b${varName}\\b`), `_${varName}`);
                        lines[lineIndex] = newLine;
                        fs.writeFileSync(filePath, lines.join('\n'));
                        return true;
                    }
                }
            }
            return false;
        }
        catch (error) {
            console.warn(`‚ö†Ô∏è Failed to fix unused variable in ${issue.file}:`, error);
            return false;
        }
    }
    async optimizeFileImports(filePath, issues, options) {
        try {
            // Use ESLint's auto-fix for import-related rules
            const importRules = issues.map(i => i.rule).filter(rule => rule.startsWith('import/'));
            if (importRules.length > 0) {
                const command = `npx eslint --config ${this.eslintConfigPath} --fix "${filePath}"`;
                (0, child_process_1.execSync)(command, {
                    cwd: this.workspaceRoot,
                    stdio: 'pipe'
                });
                return true;
            }
            return false;
        }
        catch (error) {
            console.warn(`‚ö†Ô∏è Failed to optimize imports in ${filePath}:`, error);
            return false;
        }
    }
    isSimpleTypeIssue(issue) {
        // Consider simple type issues that can be safely auto-fixed
        const simplePatterns = [
            /no-explicit-any.*parameter/,
            /no-explicit-any.*return type/,
            /no-explicit-any.*variable declaration/
        ];
        return simplePatterns.some(pattern => pattern.test(issue.message));
    }
    async improveTypeAnnotation(issue, options) {
        // For now, only handle very simple cases
        // More complex type inference would require AST parsing and analysis
        if (options.maxComplexity === 'simple' && this.isSimpleTypeIssue(issue)) {
            try {
                // Use ESLint auto-fix if available
                if (issue.autoFixable) {
                    const command = `npx eslint --config ${this.eslintConfigPath} --fix "${issue.file}"`;
                    (0, child_process_1.execSync)(command, {
                        cwd: this.workspaceRoot,
                        stdio: 'pipe'
                    });
                    return true;
                }
            }
            catch (error) {
                console.warn(`‚ö†Ô∏è Failed to improve type annotation in ${issue.file}:`, error);
            }
        }
        return false;
    }
}
exports.AutomatedLintingFixer = AutomatedLintingFixer;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9zZXJ2aWNlcy9saW50aW5nL0F1dG9tYXRlZExpbnRpbmdGaXhlci50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7O0dBS0c7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBRUgsaURBQXlDO0FBQ3pDLHVDQUF5QjtBQUN6QiwyQ0FBNkI7QUEwRjdCOztHQUVHO0FBQ0gsTUFBYSxxQkFBcUI7SUFNaEMsWUFDRSxnQkFBd0IsT0FBTyxDQUFDLEdBQUcsRUFBRSxFQUNyQyxrQkFBNEMsRUFBRTtRQUU5QyxJQUFJLENBQUMsYUFBYSxHQUFHLGFBQWEsQ0FBQztRQUNuQyxJQUFJLENBQUMsZ0JBQWdCLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxhQUFhLEVBQUUsbUJBQW1CLENBQUMsQ0FBQztRQUV0RSwyQkFBMkI7UUFDM0IsSUFBSSxDQUFDLGVBQWUsR0FBRztZQUNyQixjQUFjLEVBQUUsSUFBSTtZQUNwQixpQkFBaUIsRUFBRSxJQUFJO1lBQ3ZCLGdCQUFnQixFQUFFLElBQUk7WUFDdEIscUJBQXFCLEVBQUUsQ0FBQztZQUN4QixxQkFBcUIsRUFBRSxLQUFLO1lBQzVCLGdCQUFnQixFQUFFO2dCQUNoQixvQkFBb0I7Z0JBQ3BCLG9CQUFvQjtnQkFDcEIsbUJBQW1CO2dCQUNuQixlQUFlO2FBQ2hCO1lBQ0QsR0FBRyxlQUFlO1NBQ25CLENBQUM7SUFDSixDQUFDO0lBRUQ7O09BRUc7SUFDSCxLQUFLLENBQUMsbUJBQW1CLENBQ3ZCLGlCQUFvQyxFQUNwQyxVQUEyQyxFQUFFOztRQUU3QyxNQUFNLFNBQVMsR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDO1FBQzdCLE9BQU8sQ0FBQyxHQUFHLENBQUMsOERBQThELENBQUMsQ0FBQztRQUU1RSxNQUFNLFlBQVksR0FBMkI7WUFDM0MsU0FBUyxFQUFFLEVBQUU7WUFDYixvQkFBb0IsRUFBRSxDQUFDO1lBQ3ZCLHNCQUFzQixFQUFFLElBQUk7WUFDNUIsZUFBZSxFQUFF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MkMsS0FBSyxDQUFDLElBQUksR0FBRyxFQUFFLEtBQUssQ0FBQyxDQUFDO2FBQy9FO1NBQ0Y7UUFFRCxPQUFPLEtBQUssQ0FBQztJQUNmLENBQUM7Q0FDRjtBQTMxQkQsc0RBMjFCQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvR3JlZ0Nhc3Ryby9EZXNrdG9wL1doYXRUb0VhdE5leHQvc3JjL3NlcnZpY2VzL2xpbnRpbmcvQXV0b21hdGVkTGludGluZ0ZpeGVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQXV0b21hdGVkTGludGluZ0ZpeGVyIC0gQXV0b21hdGVkIGVycm9yIHJlc29sdXRpb24gc3lzdGVtIHdpdGggc2FmZXR5IHByb3RvY29sc1xuICogXG4gKiBUaGlzIGNsYXNzIGltcGxlbWVudHMgY29tcHJlaGVuc2l2ZSBhdXRvbWF0ZWQgZml4aW5nIGNhcGFiaWxpdGllcyB3aXRoIGJhdGNoIHByb2Nlc3NpbmcsXG4gKiBzYWZldHkgdmFsaWRhdGlvbiwgYW5kIHJvbGxiYWNrIG1lY2hhbmlzbXMgZm9yIEVTTGludCBpc3N1ZXMuXG4gKi9cblxuaW1wb3J0IHsgZXhlY1N5bmMgfSBmcm9tICdjaGlsZF9wcm9jZXNzJztcbmltcG9ydCAqIGFzIGZzIGZyb20gJ2ZzJztcbmltcG9ydCAqIGFzIHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgeyBMaW50aW5nSXNzdWUsIENhdGVnb3JpemVkRXJyb3JzIH0gZnJvbSAnLi9MaW50aW5nRXJyb3JBbmFseXplcic7XG5pbXBvcnQgeyBSZXNvbHV0aW9uU3RyYXRlZ3kgfSBmcm9tICcuL1Jlc29sdXRpb25TdHJhdGVneUdlbmVyYXRvcic7XG5cbmV4cG9ydCBpbnRlcmZhY2UgQXV0b21hdGVkRml4UmVzdWx0IHtcbiAgc3VjY2VzczogYm9vbGVhbjtcbiAgZml4ZWRJc3N1ZXM6IG51bWJlcjtcbiAgZmFpbGVkSXNzdWVzOiBudW1iZXI7XG4gIHByb2Nlc3NlZEZpbGVzOiBzdHJpbmdbXTtcbiAgZXJyb3JzOiBGaXhFcnJvcltdO1xuICB2YWxpZGF0aW9uUmVzdWx0czogVmFsaWRhdGlvblJlc3VsdFtdO1xuICByb2xsYmFja0luZm8/OiBSb2xsYmFja0luZm87XG4gIG1ldHJpY3M6IEZpeE1ldHJpY3M7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgRml4RXJyb3Ige1xuICBmaWxlOiBzdHJpbmc7XG4gIHJ1bGU6IHN0cmluZztcbiAgbWVzc2FnZTogc3RyaW5nO1xuICBlcnJvcjogc3RyaW5nO1xuICBzZXZlcml0eTogJ3dhcm5pbmcnIHwgJ2Vycm9yJyB8ICdjcml0aWNhbCc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVmFsaWRhdGlvblJlc3VsdCB7XG4gIHR5cGU6ICdidWlsZCcgfCAndGVzdCcgfCAndHlwZS1jaGVjaycgfCAnbGludCc7XG4gIHN1Y2Nlc3M6IGJvb2xlYW47XG4gIG1lc3NhZ2U6IHN0cmluZztcbiAgZGV0YWlscz86IHN0cmluZztcbn1cblxuZXhwb3J0IGludGVyZmFjZSBSb2xsYmFja0luZm8ge1xuICBzdGFzaElkOiBzdHJpbmc7XG4gIHRpbWVzdGFtcDogRGF0ZTtcbiAgYWZmZWN0ZWRGaWxlczogc3RyaW5nW107XG4gIHJvbGxiYWNrQ29tbWFuZDogc3RyaW5nO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEZpeE1ldHJpY3Mge1xuICBzdGFydFRpbWU6IERhdGU7XG4gIGVuZFRpbWU6IERhdGU7XG4gIHRvdGFsVGltZTogbnVtYmVyOyAvLyBtaWxsaXNlY29uZHNcbiAgZmlsZXNQcm9jZXNzZWQ6IG51bWJlcjtcbiAgaXNzdWVzQXR0ZW1wdGVkOiBudW1iZXI7XG4gIGlzc3Vlc0ZpeGVkOiBudW1iZXI7XG4gIGlzc3Vlc0ZhaWxlZDogbnVtYmVyO1xuICB2YWxpZGF0aW9uVGltZTogbnVtYmVyO1xuICByb2xsYmFja3NQZXJmb3JtZWQ6IG51bWJlcjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBCYXRjaFByb2Nlc3NpbmdPcHRpb25zIHtcbiAgYmF0Y2hTaXplOiBudW1iZXI7XG4gIG1heENvbmN1cnJlbnRCYXRjaGVzOiBudW1iZXI7XG4gIHZhbGlkYXRlQWZ0ZXJFYWNoQmF0Y2g6IGJvb2xlYW47XG4gIGNvbnRpbnVlT25FcnJvcjogYm9vbGVhbjtcbiAgY3JlYXRlQmFja3VwczogYm9vbGVhbjtcbiAgZHJ5UnVuOiBib29sZWFuO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFNhZmV0eVByb3RvY29scyB7XG4gIGVuYWJsZVJvbGxiYWNrOiBib29sZWFuO1xuICB2YWxpZGF0ZUJlZm9yZUZpeDogYm9vbGVhbjtcbiAgdmFsaWRhdGVBZnRlckZpeDogYm9vbGVhbjtcbiAgbWF4RmFpbHVyZXNCZWZvcmVTdG9wOiBudW1iZXI7XG4gIHJlcXVpcmVNYW51YWxBcHByb3ZhbDogYm9vbGVhbjtcbiAgcHJlc2VydmVQYXR0ZXJuczogc3RyaW5nW107XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVW51c2VkVmFyaWFibGVGaXhPcHRpb25zIHtcbiAgcHJlZml4V2l0aFVuZGVyc2NvcmU6IGJvb2xlYW47XG4gIHJlbW92ZUNvbXBsZXRlbHk6IGJvb2xlYW47XG4gIHByZXNlcnZlUGF0dGVybnM6IHN0cmluZ1tdO1xuICBza2lwVGVzdEZpbGVzOiBib29sZWFuO1xuICBza2lwRG9tYWluRmlsZXM6IGJvb2xlYW47XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSW1wb3J0T3B0aW1pemF0aW9uT3B0aW9ucyB7XG4gIHJlbW92ZUR1cGxpY2F0ZXM6IGJvb2xlYW47XG4gIG9yZ2FuaXplSW1wb3J0czogYm9vbGVhbjtcbiAgcmVtb3ZlVW51c2VkOiBib29sZWFuO1xuICBwcmVzZXJ2ZUNvbW1lbnRzOiBib29sZWFuO1xuICBzb3J0SW1wb3J0czogYm9vbGVhbjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBUeXBlQW5ub3RhdGlvbk9wdGlvbnMge1xuICBpbmZlckZyb21Vc2FnZTogYm9vbGVhbjtcbiAgdXNlU3RyaWN0VHlwZXM6IGJvb2xlYW47XG4gIHByZXNlcnZlRXhwbGljaXRBbnk6IHN0cmluZ1tdO1xuICBtYXhDb21wbGV4aXR5OiAnc2ltcGxlJyB8ICdtb2RlcmF0ZScgfCAnY29tcGxleCc7XG59XG5cbi8qKlxuICogTWFpbiBBdXRvbWF0ZWRMaW50aW5nRml4ZXIgY2xhc3NcbiAqL1xuZXhwb3J0IGNsYXNzIEF1dG9tYXRlZExpbnRpbmdGaXhlciB7XG4gIHByaXZhdGUgd29ya3NwYWNlUm9vdDogc3RyaW5nO1xuICBwcml2YXRlIGVzbGludENvbmZpZ1BhdGg6IHN0cmluZztcbiAgcHJpdmF0ZSBzYWZldHlQcm90b2NvbHM6IFNhZmV0eVByb3RvY29scztcbiAgcHJpdmF0ZSBjdXJyZW50Um9sbGJhY2tJbmZvPzogUm9sbGJhY2tJbmZvO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHdvcmtzcGFjZVJvb3Q6IHN0cmluZyA9IHByb2Nlc3MuY3dkKCksXG4gICAgc2FmZXR5UHJvdG9jb2xzOiBQYXJ0aWFsPFNhZmV0eVByb3RvY29scz4gPSB7fVxuICApIHtcbiAgICB0aGlzLndvcmtzcGFjZVJvb3QgPSB3b3Jrc3BhY2VSb290O1xuICAgIHRoaXMuZXNsaW50Q29uZmlnUGF0aCA9IHBhdGguam9pbih3b3Jrc3BhY2VSb290LCAnZXNsaW50LmNvbmZpZy5janMnKTtcbiAgICBcbiAgICAvLyBEZWZhdWx0IHNhZmV0eSBwcm90b2NvbHNcbiAgICB0aGlzLnNhZmV0eVByb3RvY29scyA9IHtcbiAgICAgIGVuYWJsZVJvbGxiYWNrOiB0cnVlLFxuICAgICAgdmFsaWRhdGVCZWZvcmVGaXg6IHRydWUsXG4gICAgICB2YWxpZGF0ZUFmdGVyRml4OiB0cnVlLFxuICAgICAgbWF4RmFpbHVyZXNCZWZvcmVTdG9wOiA1LFxuICAgICAgcmVxdWlyZU1hbnVhbEFwcHJvdmFsOiBmYWxzZSxcbiAgICAgIHByZXNlcnZlUGF0dGVybnM6IFtcbiAgICAgICAgJyoqL2NhbGN1bGF0aW9ucy8qKicsXG4gICAgICAgICcqKi9kYXRhL3BsYW5ldHMvKionLFxuICAgICAgICAnKiovKmFzdHJvbG9naWNhbConLFxuICAgICAgICAnKiovKmNhbXBhaWduKidcbiAgICAgIF0sXG4gICAgICAuLi5zYWZldHlQcm90b2NvbHNcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEFwcGx5IGF1dG9tYXRlZCBmaXhlcyB3aXRoIGJhdGNoIHByb2Nlc3NpbmcgYW5kIHNhZmV0eSBwcm90b2NvbHNcbiAgICovXG4gIGFzeW5jIGFwcGx5QXV0b21hdGVkRml4ZXMoXG4gICAgY2F0ZWdvcml6ZWRFcnJvcnM6IENhdGVnb3JpemVkRXJyb3JzLFxuICAgIG9wdGlvbnM6IFBhcnRpYWw8QmF0Y2hQcm9jZXNzaW5nT3B0aW9ucz4gPSB7fVxuICApOiBQcm9taXNlPEF1dG9tYXRlZEZpeFJlc3VsdD4ge1xuICAgIGNvbnN0IHN0YXJ0VGltZSA9IG5ldyBEYXRlKCk7XG4gICAgY29uc29sZS5sb2coJ/CflKcgU3RhcnRpbmcgYXV0b21hdGVkIGxpbnRpbmcgZml4ZXMgd2l0aCBzYWZldHkgcHJvdG9jb2xzLi4uJyk7XG4gICAgXG4gICAgY29uc3QgYmF0Y2hPcHRpb25zOiBCYXRjaFByb2Nlc3NpbmdPcHRpb25zID0ge1xuICAgICAgYmF0Y2hTaXplOiAxMCxcbiAgICAgIG1heENvbmN1cnJlbnRCYXRjaGVzOiAxLFxuICAgICAgdmFsaWRhdGVBZnRlckVhY2hCYXRjaDogdHJ1ZSxcbiAgICAgIGNvbnRpbnVlT25FcnJvcjogZmFsc2UsXG4gICAgICBjcmVhdGVCYWNrdXBzOiB0cnVlLFxuICAgICAgZHJ5UnVuOiBmYWxzZSxcbiAgICAgIC4uLm9wdGlvbnNcbiAgICB9O1xuXG4gICAgY29uc3QgcmVzdWx0OiBBdXRvbWF0ZWRGaXhSZXN1bHQgPSB7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIGZpeGVkSXNzdWVzOiAwLFxuICAgICAgZmFpbGVkSXNzdWVzOiAwLFxuICAgICAgcHJvY2Vzc2VkRmlsZXM6IFtdLFxuICAgICAgZXJyb3JzOiBbXSxcbiAgICAgIHZhbGlkYXRpb25SZXN1bHRzOiBbXSxcbiAgICAgIG1ldHJpY3M6IHtcbiAgICAgICAgc3RhcnRUaW1lLFxuICAgICAgICBlbmRUaW1lOiBuZXcgRGF0ZSgpLFxuICAgICAgICB0b3RhbFRpbWU6IDAsXG4gICAgICAgIGZpbGVzUHJvY2Vzc2VkOiAwLFxuICAgICAgICBpc3N1ZXNBdHRlbXB0ZWQ6IDAsXG4gICAgICAgIGlzc3Vlc0ZpeGVkOiAwLFxuICAgICAgICBpc3N1ZXNGYWlsZWQ6IDAsXG4gICAgICAgIHZhbGlkYXRpb25UaW1lOiAwLFxuICAgICAgICByb2xsYmFja3NQZXJmb3JtZWQ6IDBcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgdHJ5IHtcbiAgICAgIC8vIFN0ZXAgMTogUHJlLWZpeCB2YWxpZGF0aW9uXG4gICAgICBpZiAodGhpcy5zYWZldHlQcm90b2NvbHMudmFsaWRhdGVCZWZvcmVGaXgpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ/CflI0gUnVubmluZyBwcmUtZml4IHZhbGlkYXRpb24uLi4nKTtcbiAgICAgICAgY29uc3QgcHJlVmFsaWRhdGlvbiA9IGF3YWl0IHRoaXMucnVuVmFsaWRhdGlvbigpO1xuICAgICAgICByZXN1bHQudmFsaWRhdGlvblJlc3VsdHMucHVzaCguLi5wcmVWYWxpZGF0aW9uKTtcbiAgICAgICAgXG4gICAgICAgIGlmIChwcmVWYWxpZGF0aW9uLnNvbWUodiA9PiAhdi5zdWNjZXNzICYmIHYudHlwZSA9PT0gJ2J1aWxkJykpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1ByZS1maXggdmFsaWRhdGlvbiBmYWlsZWQgLSBidWlsZCBpcyBicm9rZW4nKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBTdGVwIDI6IENyZWF0ZSBiYWNrdXAvc3Rhc2ggaWYgZW5hYmxlZFxuICAgICAgaWYgKGJhdGNoT3B0aW9ucy5jcmVhdGVCYWNrdXBzICYmIHRoaXMuc2FmZXR5UHJvdG9jb2xzLmVuYWJsZVJvbGxiYWNrKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCfwn5K+IENyZWF0aW5nIGJhY2t1cC4uLicpO1xuICAgICAgICB0aGlzLmN1cnJlbnRSb2xsYmFja0luZm8gPSBhd2FpdCB0aGlzLmNyZWF0ZUJhY2t1cCgpO1xuICAgICAgICByZXN1bHQucm9sbGJhY2tJbmZvID0gdGhpcy5jdXJyZW50Um9sbGJhY2tJbmZvO1xuICAgICAgfVxuXG4gICAgICAvLyBTdGVwIDM6IFByb2Nlc3MgYXV0by1maXhhYmxlIGlzc3VlcyBpbiBiYXRjaGVzXG4gICAgICBjb25zdCBhdXRvRml4YWJsZUlzc3VlcyA9IGNhdGVnb3JpemVkRXJyb3JzLmF1dG9GaXhhYmxlLmZpbHRlcihpc3N1ZSA9PiBcbiAgICAgICAgdGhpcy5pc1NhZmVUb0F1dG9GaXgoaXNzdWUpXG4gICAgICApO1xuXG4gICAgICBjb25zb2xlLmxvZyhg8J+OryBQcm9jZXNzaW5nICR7YXV0b0ZpeGFibGVJc3N1ZXMubGVuZ3RofSBhdXRvLWZpeGFibGUgaXNzdWVzIGluIGJhdGNoZXMgb2YgJHtiYXRjaE9wdGlvbnMuYmF0Y2hTaXplfWApO1xuICAgICAgXG4gICAgICBjb25zdCBiYXRjaGVzID0gdGhpcy5jcmVhdGVCYXRjaGVzKGF1dG9GaXhhYmxlSXNzdWVzLCBiYXRjaE9wdGlvbnMuYmF0Y2hTaXplKTtcbiAgICAgIGxldCBmYWlsdXJlQ291bnQgPSAwO1xuXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGJhdGNoZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgY29uc3QgYmF0Y2ggPSBiYXRjaGVzW2ldO1xuICAgICAgICBjb25zb2xlLmxvZyhg8J+TpiBQcm9jZXNzaW5nIGJhdGNoICR7aSArIDF9LyR7YmF0Y2hlcy5sZW5ndGh9ICgke2JhdGNoLmxlbmd0aH0gaXNzdWVzKWApO1xuICAgICAgICBcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zdCBiYXRjaFJlc3VsdCA9IGF3YWl0IHRoaXMucHJvY2Vzc0JhdGNoKGJhdGNoLCBiYXRjaE9wdGlvbnMpO1xuICAgICAgICAgIFxuICAgICAgICAgIHJlc3VsdC5maXhlZElzc3VlcyArPSBiYXRjaFJlc3VsdC5maXhlZElzc3VlcztcbiAgICAgICAgICByZXN1bHQuZmFpbGVkSXNzdWVzICs9IGJhdGNoUmVzdWx0LmZhaWxlZElzc3VlcztcbiAgICAgICAgICByZXN1bHQucHJvY2Vzc2VkRmlsZXMucHVzaCguLi5iYXRjaFJlc3VsdC5wcm9jZXNzZWRGaWxlcyk7XG4gICAgICAgICAgcmVzdWx0LmVycm9ycy5wdXNoKC4uLmJhdGNoUmVzdWx0LmVycm9ycyk7XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gVmFsaWRhdGUgYWZ0ZXIgZWFjaCBiYXRjaCBpZiBlbmFibGVkXG4gICAgICAgICAgaWYgKGJhdGNoT3B0aW9ucy52YWxpZGF0ZUFmdGVyRWFjaEJhdGNoKSB7XG4gICAgICAgICAgICBjb25zdCBiYXRjaFZhbGlkYXRpb24gPSBhd2FpdCB0aGlzLnJ1blZhbGlkYXRpb24oKTtcbiAgICAgICAgICAgIHJlc3VsdC52YWxpZGF0aW9uUmVzdWx0cy5wdXNoKC4uLmJhdGNoVmFsaWRhdGlvbik7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmIChiYXRjaFZhbGlkYXRpb24uc29tZSh2ID0+ICF2LnN1Y2Nlc3MgJiYgdi50eXBlID09PSAnYnVpbGQnKSkge1xuICAgICAgICAgICAgICBjb25zb2xlLndhcm4oJ+KaoO+4jyBCYXRjaCB2YWxpZGF0aW9uIGZhaWxlZCAtIHBlcmZvcm1pbmcgcm9sbGJhY2snKTtcbiAgICAgICAgICAgICAgYXdhaXQgdGhpcy5wZXJmb3JtUm9sbGJhY2soKTtcbiAgICAgICAgICAgICAgcmVzdWx0Lm1ldHJpY3Mucm9sbGJhY2tzUGVyZm9ybWVkKys7XG4gICAgICAgICAgICAgIGZhaWx1cmVDb3VudCsrO1xuICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgaWYgKGZhaWx1cmVDb3VudCA+PSB0aGlzLnNhZmV0eVByb3RvY29scy5tYXhGYWlsdXJlc0JlZm9yZVN0b3ApIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ01heGltdW0gZmFpbHVyZXMgcmVhY2hlZCAtIHN0b3BwaW5nIGF1dG9tYXRlZCBmaXhlcycpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIFxuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYOKdjCBCYXRjaCAke2kgKyAxfSBmYWlsZWQ6YCwgZXJyb3IpO1xuICAgICAgICAgIHJlc3VsdC5lcnJvcnMucHVzaCh7XG4gICAgICAgICAgICBmaWxlOiAnYmF0Y2gtcHJvY2Vzc2luZycsXG4gICAgICAgICAgICBydWxlOiAnYmF0Y2gtZXJyb3InLFxuICAgICAgICAgICAgbWVzc2FnZTogYEJhdGNoICR7aSArIDF9IHByb2Nlc3NpbmcgZmFpbGVkYCxcbiAgICAgICAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IFN0cmluZyhlcnJvciksXG4gICAgICAgICAgICBzZXZlcml0eTogJ2Vycm9yJ1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIFxuICAgICAgICAgIGZhaWx1cmVDb3VudCsrO1xuICAgICAgICAgIGlmICghYmF0Y2hPcHRpb25zLmNvbnRpbnVlT25FcnJvciB8fCBmYWlsdXJlQ291bnQgPj0gdGhpcy5zYWZldHlQcm90b2NvbHMubWF4RmFpbHVyZXNCZWZvcmVTdG9wKSB7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gU3RlcCA0OiBGaW5hbCB2YWxpZGF0aW9uXG4gICAgICBpZiAodGhpcy5zYWZldHlQcm90b2NvbHMudmFsaWRhdGVBZnRlckZpeCkge1xuICAgICAgICBjb25zb2xlLmxvZygn4pyFIFJ1bm5pbmcgZmluYWwgdmFsaWRhdGlvbi4uLicpO1xuICAgICAgICBjb25zdCBmaW5hbFZhbGlkYXRpb24gPSBhd2FpdCB0aGlzLnJ1blZhbGlkYXRpb24oKTtcbiAgICAgICAgcmVzdWx0LnZhbGlkYXRpb25SZXN1bHRzLnB1c2goLi4uZmluYWxWYWxpZGF0aW9uKTtcbiAgICAgICAgXG4gICAgICAgIGNvbnN0IGJ1aWxkU3VjY2VzcyA9IGZpbmFsVmFsaWRhdGlvbi5maW5kKHYgPT4gdi50eXBlID09PSAnYnVpbGQnKT8uc3VjY2VzcyA/PyB0cnVlO1xuICAgICAgICByZXN1bHQuc3VjY2VzcyA9IGJ1aWxkU3VjY2VzcyAmJiByZXN1bHQuZml4ZWRJc3N1ZXMgPiAwO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVzdWx0LnN1Y2Nlc3MgPSByZXN1bHQuZml4ZWRJc3N1ZXMgPiAwO1xuICAgICAgfVxuXG4gICAgICAvLyBVcGRhdGUgbWV0cmljc1xuICAgICAgY29uc3QgZW5kVGltZSA9IG5ldyBEYXRlKCk7XG4gICAgICByZXN1bHQubWV0cmljcy5lbmRUaW1lID0gZW5kVGltZTtcbiAgICAgIHJlc3VsdC5tZXRyaWNzLnRvdGFsVGltZSA9IGVuZFRpbWUuZ2V0VGltZSgpIC0gc3RhcnRUaW1lLmdldFRpbWUoKTtcbiAgICAgIHJlc3VsdC5tZXRyaWNzLmZpbGVzUHJvY2Vzc2VkID0gbmV3IFNldChyZXN1bHQucHJvY2Vzc2VkRmlsZXMpLnNpemU7XG4gICAgICByZXN1bHQubWV0cmljcy5pc3N1ZXNBdHRlbXB0ZWQgPSBhdXRvRml4YWJsZUlzc3Vlcy5sZW5ndGg7XG4gICAgICByZXN1bHQubWV0cmljcy5pc3N1ZXNGaXhlZCA9IHJlc3VsdC5maXhlZElzc3VlcztcbiAgICAgIHJlc3VsdC5tZXRyaWNzLmlzc3Vlc0ZhaWxlZCA9IHJlc3VsdC5mYWlsZWRJc3N1ZXM7XG5cbiAgICAgIGNvbnNvbGUubG9nKGDinIUgQXV0b21hdGVkIGZpeGVzIGNvbXBsZXRlOiAke3Jlc3VsdC5maXhlZElzc3Vlc30gZml4ZWQsICR7cmVzdWx0LmZhaWxlZElzc3Vlc30gZmFpbGVkYCk7XG4gICAgICBcbiAgICAgIHJldHVybiByZXN1bHQ7XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIEF1dG9tYXRlZCBmaXhpbmcgZmFpbGVkOicsIGVycm9yKTtcbiAgICAgIFxuICAgICAgLy8gQXR0ZW1wdCByb2xsYmFjayBvbiBjcml0aWNhbCBmYWlsdXJlXG4gICAgICBpZiAodGhpcy5jdXJyZW50Um9sbGJhY2tJbmZvICYmIHRoaXMuc2FmZXR5UHJvdG9jb2xzLmVuYWJsZVJvbGxiYWNrKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCfwn5SEIFBlcmZvcm1pbmcgZW1lcmdlbmN5IHJvbGxiYWNrLi4uJyk7XG4gICAgICAgIGF3YWl0IHRoaXMucGVyZm9ybVJvbGxiYWNrKCk7XG4gICAgICAgIHJlc3VsdC5tZXRyaWNzLnJvbGxiYWNrc1BlcmZvcm1lZCsrO1xuICAgICAgfVxuICAgICAgXG4gICAgICByZXN1bHQuc3VjY2VzcyA9IGZhbHNlO1xuICAgICAgcmVzdWx0LmVycm9ycy5wdXNoKHtcbiAgICAgICAgZmlsZTogJ3N5c3RlbScsXG4gICAgICAgIHJ1bGU6ICdjcml0aWNhbC1lcnJvcicsXG4gICAgICAgIG1lc3NhZ2U6ICdDcml0aWNhbCBmYWlsdXJlIGR1cmluZyBhdXRvbWF0ZWQgZml4aW5nJyxcbiAgICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKSxcbiAgICAgICAgc2V2ZXJpdHk6ICdjcml0aWNhbCdcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBIYW5kbGUgdW51c2VkIHZhcmlhYmxlIHJlbW92YWwgd2l0aCB1bmRlcnNjb3JlIHByZWZpeGluZ1xuICAgKi9cbiAgYXN5bmMgaGFuZGxlVW51c2VkVmFyaWFibGVzKFxuICAgIGlzc3VlczogTGludGluZ0lzc3VlW10sXG4gICAgb3B0aW9uczogUGFydGlhbDxVbnVzZWRWYXJpYWJsZUZpeE9wdGlvbnM+ID0ge31cbiAgKTogUHJvbWlzZTxBdXRvbWF0ZWRGaXhSZXN1bHQ+IHtcbiAgICBjb25zb2xlLmxvZygn8J+nuSBIYW5kbGluZyB1bnVzZWQgdmFyaWFibGVzLi4uJyk7XG4gICAgXG4gICAgY29uc3QgZml4T3B0aW9uczogVW51c2VkVmFyaWFibGVGaXhPcHRpb25zID0ge1xuICAgICAgcHJlZml4V2l0aFVuZGVyc2NvcmU6IHRydWUsXG4gICAgICByZW1vdmVDb21wbGV0ZWx5OiBmYWxzZSxcbiAgICAgIHByZXNlcnZlUGF0dGVybnM6IFtcbiAgICAgICAgJyoqL2NhbGN1bGF0aW9ucy8qKicsXG4gICAgICAgICcqKi9kYXRhL3BsYW5ldHMvKionLFxuICAgICAgICAnKiovKmFzdHJvbG9naWNhbConXG4gICAgICBdLFxuICAgICAgc2tpcFRlc3RGaWxlczogZmFsc2UsXG4gICAgICBza2lwRG9tYWluRmlsZXM6IHRydWUsXG4gICAgICAuLi5vcHRpb25zXG4gICAgfTtcblxuICAgIGNvbnN0IHVudXNlZFZhcklzc3VlcyA9IGlzc3Vlcy5maWx0ZXIoaXNzdWUgPT4gXG4gICAgICBpc3N1ZS5ydWxlLmluY2x1ZGVzKCduby11bnVzZWQtdmFycycpIHx8IFxuICAgICAgaXNzdWUucnVsZS5pbmNsdWRlcygndW51c2VkLXZhcnMnKVxuICAgICk7XG5cbiAgICBjb25zdCByZXN1bHQ6IEF1dG9tYXRlZEZpeFJlc3VsdCA9IHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgZml4ZWRJc3N1ZXM6IDAsXG4gICAgICBmYWlsZWRJc3N1ZXM6IDAsXG4gICAgICBwcm9jZXNzZWRGaWxlczogW10sXG4gICAgICBlcnJvcnM6IFtdLFxuICAgICAgdmFsaWRhdGlvblJlc3VsdHM6IFtdLFxuICAgICAgbWV0cmljczoge1xuICAgICAgICBzdGFydFRpbWU6IG5ldyBEYXRlKCksXG4gICAgICAgIGVuZFRpbWU6IG5ldyBEYXRlKCksXG4gICAgICAgIHRvdGFsVGltZTogMCxcbiAgICAgICAgZmlsZXNQcm9jZXNzZWQ6IDAsXG4gICAgICAgIGlzc3Vlc0F0dGVtcHRlZDogdW51c2VkVmFySXNzdWVzLmxlbmd0aCxcbiAgICAgICAgaXNzdWVzRml4ZWQ6IDAsXG4gICAgICAgIGlzc3Vlc0ZhaWxlZDogMCxcbiAgICAgICAgdmFsaWRhdGlvblRpbWU6IDAsXG4gICAgICAgIHJvbGxiYWNrc1BlcmZvcm1lZDogMFxuICAgICAgfVxuICAgIH07XG5cbiAgICBmb3IgKGNvbnN0IGlzc3VlIG9mIHVudXNlZFZhcklzc3Vlcykge1xuICAgICAgdHJ5IHtcbiAgICAgICAgLy8gU2tpcCBpZiBmaWxlIHNob3VsZCBiZSBwcmVzZXJ2ZWRcbiAgICAgICAgaWYgKHRoaXMuc2hvdWxkUHJlc2VydmVGaWxlKGlzc3VlLmZpbGUsIGZpeE9wdGlvbnMucHJlc2VydmVQYXR0ZXJucykpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhg4o+t77iPIFNraXBwaW5nIHByZXNlcnZlZCBmaWxlOiAke2lzc3VlLmZpbGV9YCk7XG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBTa2lwIGRvbWFpbiBmaWxlcyBpZiBjb25maWd1cmVkXG4gICAgICAgIGlmIChmaXhPcHRpb25zLnNraXBEb21haW5GaWxlcyAmJiBpc3N1ZS5kb21haW5Db250ZXh0Py5yZXF1aXJlc1NwZWNpYWxIYW5kbGluZykge1xuICAgICAgICAgIGNvbnNvbGUubG9nKGDij63vuI8gU2tpcHBpbmcgZG9tYWluIGZpbGU6ICR7aXNzdWUuZmlsZX1gKTtcbiAgICAgICAgICBjb250aW51ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIFNraXAgdGVzdCBmaWxlcyBpZiBjb25maWd1cmVkXG4gICAgICAgIGlmIChmaXhPcHRpb25zLnNraXBUZXN0RmlsZXMgJiYgaXNzdWUuZG9tYWluQ29udGV4dD8uaXNUZXN0RmlsZSkge1xuICAgICAgICAgIGNvbnNvbGUubG9nKGDij63vuI8gU2tpcHBpbmcgdGVzdCBmaWxlOiAke2lzc3VlLmZpbGV9YCk7XG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBmaXhlZCA9IGF3YWl0IHRoaXMuZml4VW51c2VkVmFyaWFibGUoaXNzdWUsIGZpeE9wdGlvbnMpO1xuICAgICAgICBpZiAoZml4ZWQpIHtcbiAgICAgICAgICByZXN1bHQuZml4ZWRJc3N1ZXMrKztcbiAgICAgICAgICBpZiAoIXJlc3VsdC5wcm9jZXNzZWRGaWxlcy5pbmNsdWRlcyhpc3N1ZS5maWxlKSkge1xuICAgICAgICAgICAgcmVzdWx0LnByb2Nlc3NlZEZpbGVzLnB1c2goaXNzdWUuZmlsZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlc3VsdC5mYWlsZWRJc3N1ZXMrKztcbiAgICAgICAgfVxuXG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICByZXN1bHQuZmFpbGVkSXNzdWVzKys7XG4gICAgICAgIHJlc3VsdC5lcnJvcnMucHVzaCh7XG4gICAgICAgICAgZmlsZTogaXNzdWUuZmlsZSxcbiAgICAgICAgICBydWxlOiBpc3N1ZS5ydWxlLFxuICAgICAgICAgIG1lc3NhZ2U6IGBGYWlsZWQgdG8gZml4IHVudXNlZCB2YXJpYWJsZTogJHtpc3N1ZS5tZXNzYWdlfWAsXG4gICAgICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKSxcbiAgICAgICAgICBzZXZlcml0eTogJ2Vycm9yJ1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXN1bHQuc3VjY2VzcyA9IHJlc3VsdC5maXhlZElzc3VlcyA+IDA7XG4gICAgcmVzdWx0Lm1ldHJpY3MuZW5kVGltZSA9IG5ldyBEYXRlKCk7XG4gICAgcmVzdWx0Lm1ldHJpY3MudG90YWxUaW1lID0gcmVzdWx0Lm1ldHJpY3MuZW5kVGltZS5nZXRUaW1lKCkgLSByZXN1bHQubWV0cmljcy5zdGFydFRpbWUuZ2V0VGltZSgpO1xuICAgIHJlc3VsdC5tZXRyaWNzLmZpbGVzUHJvY2Vzc2VkID0gcmVzdWx0LnByb2Nlc3NlZEZpbGVzLmxlbmd0aDtcbiAgICByZXN1bHQubWV0cmljcy5pc3N1ZXNGaXhlZCA9IHJlc3VsdC5maXhlZElzc3VlcztcbiAgICByZXN1bHQubWV0cmljcy5pc3N1ZXNGYWlsZWQgPSByZXN1bHQuZmFpbGVkSXNzdWVzO1xuXG4gICAgY29uc29sZS5sb2coYPCfp7kgVW51c2VkIHZhcmlhYmxlcyBoYW5kbGVkOiAke3Jlc3VsdC5maXhlZElzc3Vlc30gZml4ZWQsICR7cmVzdWx0LmZhaWxlZElzc3Vlc30gZmFpbGVkYCk7XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIC8qKlxuICAgKiBPcHRpbWl6ZSBpbXBvcnQgc3RhdGVtZW50cyBhbmQgcmVtb3ZlIGR1cGxpY2F0ZXNcbiAgICovXG4gIGFzeW5jIG9wdGltaXplSW1wb3J0cyhcbiAgICBpc3N1ZXM6IExpbnRpbmdJc3N1ZVtdLFxuICAgIG9wdGlvbnM6IFBhcnRpYWw8SW1wb3J0T3B0aW1pemF0aW9uT3B0aW9ucz4gPSB7fVxuICApOiBQcm9taXNlPEF1dG9tYXRlZEZpeFJlc3VsdD4ge1xuICAgIGNvbnNvbGUubG9nKCfwn5OmIE9wdGltaXppbmcgaW1wb3J0IHN0YXRlbWVudHMuLi4nKTtcbiAgICBcbiAgICBjb25zdCBpbXBvcnRPcHRpb25zOiBJbXBvcnRPcHRpbWl6YXRpb25PcHRpb25zID0ge1xuICAgICAgcmVtb3ZlRHVwbGljYXRlczogdHJ1ZSxcbiAgICAgIG9yZ2FuaXplSW1wb3J0czogdHJ1ZSxcbiAgICAgIHJlbW92ZVVudXNlZDogdHJ1ZSxcbiAgICAgIHByZXNlcnZlQ29tbWVudHM6IHRydWUsXG4gICAgICBzb3J0SW1wb3J0czogdHJ1ZSxcbiAgICAgIC4uLm9wdGlvbnNcbiAgICB9O1xuXG4gICAgY29uc3QgaW1wb3J0SXNzdWVzID0gaXNzdWVzLmZpbHRlcihpc3N1ZSA9PiBcbiAgICAgIGlzc3VlLmNhdGVnb3J5LnByaW1hcnkgPT09ICdpbXBvcnQnIHx8XG4gICAgICBpc3N1ZS5ydWxlLnN0YXJ0c1dpdGgoJ2ltcG9ydC8nKVxuICAgICk7XG5cbiAgICBjb25zdCByZXN1bHQ6IEF1dG9tYXRlZEZpeFJlc3VsdCA9IHtcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgZml4ZWRJc3N1ZXM6IDAsXG4gICAgICBmYWlsZWRJc3N1ZXM6IDAsXG4gICAgICBwcm9jZXNzZWRGaWxlczogW10sXG4gICAgICBlcnJvcnM6IFtdLFxuICAgICAgdmFsaWRhdGlvblJlc3VsdHM6IFtdLFxuICAgICAgbWV0cmljczoge1xuICAgICAgICBzdGFydFRpbWU6IG5ldyBEYXRlKCksXG4gICAgICAgIGVuZFRpbWU6IG5ldyBEYXRlKCksXG4gICAgICAgIHRvdGFsVGltZTogMCxcbiAgICAgICAgZmlsZXNQcm9jZXNzZWQ6IDAsXG4gICAgICAgIGlzc3Vlc0F0dGVtcHRlZDogaW1wb3J0SXNzdWVzLmxlbmd0aCxcbiAgICAgICAgaXNzdWVzRml4ZWQ6IDAsXG4gICAgICAgIGlzc3Vlc0ZhaWxlZDogMCxcbiAgICAgICAgdmFsaWRhdGlvblRpbWU6IDAsXG4gICAgICAgIHJvbGxiYWNrc1BlcmZvcm1lZDogMFxuICAgICAgfVxuICAgIH07XG5cbiAgICAvLyBHcm91cCBpc3N1ZXMgYnkgZmlsZSBmb3IgYmF0Y2ggcHJvY2Vzc2luZ1xuICAgIGNvbnN0IGlzc3Vlc0J5RmlsZSA9IG5ldyBNYXA8c3RyaW5nLCBMaW50aW5nSXNzdWVbXT4oKTtcbiAgICBmb3IgKGNvbnN0IGlzc3VlIG9mIGltcG9ydElzc3Vlcykge1xuICAgICAgaWYgKCFpc3N1ZXNCeUZpbGUuaGFzKGlzc3VlLmZpbGUpKSB7XG4gICAgICAgIGlzc3Vlc0J5RmlsZS5zZXQoaXNzdWUuZmlsZSwgW10pO1xuICAgICAgfVxuICAgICAgaXNzdWVzQnlGaWxlLmdldChpc3N1ZS5maWxlKSEucHVzaChpc3N1ZSk7XG4gICAgfVxuXG4gICAgZm9yIChjb25zdCBbZmlsZVBhdGgsIGZpbGVJc3N1ZXNdIG9mIGlzc3Vlc0J5RmlsZSkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgLy8gU2tpcCBpZiBmaWxlIHNob3VsZCBiZSBwcmVzZXJ2ZWRcbiAgICAgICAgaWYgKHRoaXMuc2hvdWxkUHJlc2VydmVGaWxlKGZpbGVQYXRoLCB0aGlzLnNhZmV0eVByb3RvY29scy5wcmVzZXJ2ZVBhdHRlcm5zKSkge1xuICAgICAgICAgIGNvbnNvbGUubG9nKGDij63vuI8gU2tpcHBpbmcgcHJlc2VydmVkIGZpbGU6ICR7ZmlsZVBhdGh9YCk7XG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBmaXhlZCA9IGF3YWl0IHRoaXMub3B0aW1pemVGaWxlSW1wb3J0cyhmaWxlUGF0aCwgZmlsZUlzc3VlcywgaW1wb3J0T3B0aW9ucyk7XG4gICAgICAgIGlmIChmaXhlZCkge1xuICAgICAgICAgIHJlc3VsdC5maXhlZElzc3VlcyArPSBmaWxlSXNzdWVzLmxlbmd0aDtcbiAgICAgICAgICByZXN1bHQucHJvY2Vzc2VkRmlsZXMucHVzaChmaWxlUGF0aCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmVzdWx0LmZhaWxlZElzc3VlcyArPSBmaWxlSXNzdWVzLmxlbmd0aDtcbiAgICAgICAgfVxuXG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICByZXN1bHQuZmFpbGVkSXNzdWVzICs9IGZpbGVJc3N1ZXMubGVuZ3RoO1xuICAgICAgICByZXN1bHQuZXJyb3JzLnB1c2goe1xuICAgICAgICAgIGZpbGU6IGZpbGVQYXRoLFxuICAgICAgICAgIHJ1bGU6ICdpbXBvcnQtb3B0aW1pemF0aW9uJyxcbiAgICAgICAgICBtZXNzYWdlOiBgRmFpbGVkIHRvIG9wdGltaXplIGltcG9ydHNgLFxuICAgICAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IFN0cmluZyhlcnJvciksXG4gICAgICAgICAgc2V2ZXJpdHk6ICdlcnJvcidcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmVzdWx0LnN1Y2Nlc3MgPSByZXN1bHQuZml4ZWRJc3N1ZXMgPiAwO1xuICAgIHJlc3VsdC5tZXRyaWNzLmVuZFRpbWUgPSBuZXcgRGF0ZSgpO1xuICAgIHJlc3VsdC5tZXRyaWNzLnRvdGFsVGltZSA9IHJlc3VsdC5tZXRyaWNzLmVuZFRpbWUuZ2V0VGltZSgpIC0gcmVzdWx0Lm1ldHJpY3Muc3RhcnRUaW1lLmdldFRpbWUoKTtcbiAgICByZXN1bHQubWV0cmljcy5maWxlc1Byb2Nlc3NlZCA9IHJlc3VsdC5wcm9jZXNzZWRGaWxlcy5sZW5ndGg7XG4gICAgcmVzdWx0Lm1ldHJpY3MuaXNzdWVzRml4ZWQgPSByZXN1bHQuZml4ZWRJc3N1ZXM7XG4gICAgcmVzdWx0Lm1ldHJpY3MuaXNzdWVzRmFpbGVkID0gcmVzdWx0LmZhaWxlZElzc3VlcztcblxuICAgIGNvbnNvbGUubG9nKGDwn5OmIEltcG9ydCBvcHRpbWl6YXRpb24gY29tcGxldGU6ICR7cmVzdWx0LmZpeGVkSXNzdWVzfSBmaXhlZCwgJHtyZXN1bHQuZmFpbGVkSXNzdWVzfSBmYWlsZWRgKTtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgLyoqXG4gICAqIEltcHJvdmUgdHlwZSBhbm5vdGF0aW9ucyBmb3Igc2ltcGxlIGNhc2VzXG4gICAqL1xuICBhc3luYyBpbXByb3ZlVHlwZUFubm90YXRpb25zKFxuICAgIGlzc3VlczogTGludGluZ0lzc3VlW10sXG4gICAgb3B0aW9uczogUGFydGlhbDxUeXBlQW5ub3RhdGlvbk9wdGlvbnM+ID0ge31cbiAgKTogUHJvbWlzZTxBdXRvbWF0ZWRGaXhSZXN1bHQ+IHtcbiAgICBjb25zb2xlLmxvZygn8J+Pt++4jyBJbXByb3ZpbmcgdHlwZSBhbm5vdGF0aW9ucy4uLicpO1xuICAgIFxuICAgIGNvbnN0IHR5cGVPcHRpb25zOiBUeXBlQW5ub3RhdGlvbk9wdGlvbnMgPSB7XG4gICAgICBpbmZlckZyb21Vc2FnZTogdHJ1ZSxcbiAgICAgIHVzZVN0cmljdFR5cGVzOiBmYWxzZSxcbiAgICAgIHByZXNlcnZlRXhwbGljaXRBbnk6IFtcbiAgICAgICAgJyoqL2NhbGN1bGF0aW9ucy8qKicsXG4gICAgICAgICcqKi9kYXRhL3BsYW5ldHMvKionXG4gICAgICBdLFxuICAgICAgbWF4Q29tcGxleGl0eTogJ3NpbXBsZScsXG4gICAgICAuLi5vcHRpb25zXG4gICAgfTtcblxuICAgIGNvbnN0IHR5cGVJc3N1ZXMgPSBpc3N1ZXMuZmlsdGVyKGlzc3VlID0+IFxuICAgICAgaXNzdWUucnVsZS5pbmNsdWRlcygnbm8tZXhwbGljaXQtYW55JykgfHxcbiAgICAgIGlzc3VlLnJ1bGUuaW5jbHVkZXMoJ25vLWltcGxpY2l0LWFueScpIHx8XG4gICAgICBpc3N1ZS5jYXRlZ29yeS5wcmltYXJ5ID09PSAndHlwZXNjcmlwdCdcbiAgICApO1xuXG4gICAgY29uc3QgcmVzdWx0OiBBdXRvbWF0ZWRGaXhSZXN1bHQgPSB7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIGZpeGVkSXNzdWVzOiAwLFxuICAgICAgZmFpbGVkSXNzdWVzOiAwLFxuICAgICAgcHJvY2Vzc2VkRmlsZXM6IFtdLFxuICAgICAgZXJyb3JzOiBbXSxcbiAgICAgIHZhbGlkYXRpb25SZXN1bHRzOiBbXSxcbiAgICAgIG1ldHJpY3M6IHtcbiAgICAgICAgc3RhcnRUaW1lOiBuZXcgRGF0ZSgpLFxuICAgICAgICBlbmRUaW1lOiBuZXcgRGF0ZSgpLFxuICAgICAgICB0b3RhbFRpbWU6IDAsXG4gICAgICAgIGZpbGVzUHJvY2Vzc2VkOiAwLFxuICAgICAgICBpc3N1ZXNBdHRlbXB0ZWQ6IHR5cGVJc3N1ZXMubGVuZ3RoLFxuICAgICAgICBpc3N1ZXNGaXhlZDogMCxcbiAgICAgICAgaXNzdWVzRmFpbGVkOiAwLFxuICAgICAgICB2YWxpZGF0aW9uVGltZTogMCxcbiAgICAgICAgcm9sbGJhY2tzUGVyZm9ybWVkOiAwXG4gICAgICB9XG4gICAgfTtcblxuICAgIGZvciAoY29uc3QgaXNzdWUgb2YgdHlwZUlzc3Vlcykge1xuICAgICAgdHJ5IHtcbiAgICAgICAgLy8gU2tpcCBpZiBmaWxlIHNob3VsZCBwcmVzZXJ2ZSBleHBsaWNpdCBhbnlcbiAgICAgICAgaWYgKHRoaXMuc2hvdWxkUHJlc2VydmVGaWxlKGlzc3VlLmZpbGUsIHR5cGVPcHRpb25zLnByZXNlcnZlRXhwbGljaXRBbnkpKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coYOKPre+4jyBQcmVzZXJ2aW5nIGV4cGxpY2l0IGFueSBpbjogJHtpc3N1ZS5maWxlfWApO1xuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gT25seSBoYW5kbGUgc2ltcGxlIGNhc2VzIGJhc2VkIG9uIGNvbXBsZXhpdHkgc2V0dGluZ1xuICAgICAgICBpZiAodHlwZU9wdGlvbnMubWF4Q29tcGxleGl0eSA9PT0gJ3NpbXBsZScgJiYgIXRoaXMuaXNTaW1wbGVUeXBlSXNzdWUoaXNzdWUpKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coYOKPre+4jyBTa2lwcGluZyBjb21wbGV4IHR5cGUgaXNzdWU6ICR7aXNzdWUucnVsZX0gaW4gJHtpc3N1ZS5maWxlfWApO1xuICAgICAgICAgIGNvbnRpbnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgZml4ZWQgPSBhd2FpdCB0aGlzLmltcHJvdmVUeXBlQW5ub3RhdGlvbihpc3N1ZSwgdHlwZU9wdGlvbnMpO1xuICAgICAgICBpZiAoZml4ZWQpIHtcbiAgICAgICAgICByZXN1bHQuZml4ZWRJc3N1ZXMrKztcbiAgICAgICAgICBpZiAoIXJlc3VsdC5wcm9jZXNzZWRGaWxlcy5pbmNsdWRlcyhpc3N1ZS5maWxlKSkge1xuICAgICAgICAgICAgcmVzdWx0LnByb2Nlc3NlZEZpbGVzLnB1c2goaXNzdWUuZmlsZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlc3VsdC5mYWlsZWRJc3N1ZXMrKztcbiAgICAgICAgfVxuXG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICByZXN1bHQuZmFpbGVkSXNzdWVzKys7XG4gICAgICAgIHJlc3VsdC5lcnJvcnMucHVzaCh7XG4gICAgICAgICAgZmlsZTogaXNzdWUuZmlsZSxcbiAgICAgICAgICBydWxlOiBpc3N1ZS5ydWxlLFxuICAgICAgICAgIG1lc3NhZ2U6IGBGYWlsZWQgdG8gaW1wcm92ZSB0eXBlIGFubm90YXRpb246ICR7aXNzdWUubWVzc2FnZX1gLFxuICAgICAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IFN0cmluZyhlcnJvciksXG4gICAgICAgICAgc2V2ZXJpdHk6ICdlcnJvcidcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmVzdWx0LnN1Y2Nlc3MgPSByZXN1bHQuZml4ZWRJc3N1ZXMgPiAwO1xuICAgIHJlc3VsdC5tZXRyaWNzLmVuZFRpbWUgPSBuZXcgRGF0ZSgpO1xuICAgIHJlc3VsdC5tZXRyaWNzLnRvdGFsVGltZSA9IHJlc3VsdC5tZXRyaWNzLmVuZFRpbWUuZ2V0VGltZSgpIC0gcmVzdWx0Lm1ldHJpY3Muc3RhcnRUaW1lLmdldFRpbWUoKTtcbiAgICByZXN1bHQubWV0cmljcy5maWxlc1Byb2Nlc3NlZCA9IHJlc3VsdC5wcm9jZXNzZWRGaWxlcy5sZW5ndGg7XG4gICAgcmVzdWx0Lm1ldHJpY3MuaXNzdWVzRml4ZWQgPSByZXN1bHQuZml4ZWRJc3N1ZXM7XG4gICAgcmVzdWx0Lm1ldHJpY3MuaXNzdWVzRmFpbGVkID0gcmVzdWx0LmZhaWxlZElzc3VlcztcblxuICAgIGNvbnNvbGUubG9nKGDwn4+377iPIFR5cGUgYW5ub3RhdGlvbiBpbXByb3ZlbWVudCBjb21wbGV0ZTogJHtyZXN1bHQuZml4ZWRJc3N1ZXN9IGZpeGVkLCAke3Jlc3VsdC5mYWlsZWRJc3N1ZXN9IGZhaWxlZGApO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICAvKipcbiAgICogVmFsaWRhdGUgZml4ZXMgd2l0aCBjb21wcmVoZW5zaXZlIGNoZWNrc1xuICAgKi9cbiAgYXN5bmMgdmFsaWRhdGVGaXhlcygpOiBQcm9taXNlPFZhbGlkYXRpb25SZXN1bHRbXT4ge1xuICAgIGNvbnNvbGUubG9nKCfwn5SNIFJ1bm5pbmcgY29tcHJlaGVuc2l2ZSB2YWxpZGF0aW9uLi4uJyk7XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMucnVuVmFsaWRhdGlvbigpO1xuICB9XG5cbiAgLyoqXG4gICAqIFBlcmZvcm0gcm9sbGJhY2sgdG8gcHJldmlvdXMgc3RhdGVcbiAgICovXG4gIGFzeW5jIHBlcmZvcm1Sb2xsYmFjaygpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICBpZiAoIXRoaXMuY3VycmVudFJvbGxiYWNrSW5mbyB8fCAhdGhpcy5zYWZldHlQcm90b2NvbHMuZW5hYmxlUm9sbGJhY2spIHtcbiAgICAgIGNvbnNvbGUud2Fybign4pqg77iPIE5vIHJvbGxiYWNrIGluZm9ybWF0aW9uIGF2YWlsYWJsZScpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHRyeSB7XG4gICAgICBjb25zb2xlLmxvZyhg8J+UhCBSb2xsaW5nIGJhY2sgdG8gc3Rhc2g6ICR7dGhpcy5jdXJyZW50Um9sbGJhY2tJbmZvLnN0YXNoSWR9YCk7XG4gICAgICBleGVjU3luYyh0aGlzLmN1cnJlbnRSb2xsYmFja0luZm8ucm9sbGJhY2tDb21tYW5kLCB7XG4gICAgICAgIGN3ZDogdGhpcy53b3Jrc3BhY2VSb290LFxuICAgICAgICBzdGRpbzogJ3BpcGUnXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgY29uc29sZS5sb2coJ+KchSBSb2xsYmFjayBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5Jyk7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIFxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgUm9sbGJhY2sgZmFpbGVkOicsIGVycm9yKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cblxuICAvLyBQcml2YXRlIGhlbHBlciBtZXRob2RzXG5cbiAgcHJpdmF0ZSBhc3luYyBjcmVhdGVCYWNrdXAoKTogUHJvbWlzZTxSb2xsYmFja0luZm8+IHtcbiAgICBjb25zdCB0aW1lc3RhbXAgPSBuZXcgRGF0ZSgpO1xuICAgIGNvbnN0IHN0YXNoTWVzc2FnZSA9IGBhdXRvbWF0ZWQtbGludGluZy1maXhlcy0ke3RpbWVzdGFtcC50b0lTT1N0cmluZygpfWA7XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIGV4ZWNTeW5jKGBnaXQgYWRkIC1BICYmIGdpdCBzdGFzaCBwdXNoIC1tIFwiJHtzdGFzaE1lc3NhZ2V9XCJgLCB7XG4gICAgICAgIGN3ZDogdGhpcy53b3Jrc3BhY2VSb290LFxuICAgICAgICBzdGRpbzogJ3BpcGUnXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgY29uc3Qgc3Rhc2hMaXN0ID0gZXhlY1N5bmMoJ2dpdCBzdGFzaCBsaXN0Jywge1xuICAgICAgICBjd2Q6IHRoaXMud29ya3NwYWNlUm9vdCxcbiAgICAgICAgZW5jb2Rpbmc6ICd1dGY4J1xuICAgICAgfSk7XG4gICAgICBcbiAgICAgIGNvbnN0IHN0YXNoSWQgPSBzdGFzaExpc3Quc3BsaXQoJ1xcbicpWzBdPy5zcGxpdCgnOicpWzBdIHx8ICdzdGFzaEB7MH0nO1xuICAgICAgXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdGFzaElkLFxuICAgICAgICB0aW1lc3RhbXAsXG4gICAgICAgIGFmZmVjdGVkRmlsZXM6IFtdLFxuICAgICAgICByb2xsYmFja0NvbW1hbmQ6IGBnaXQgc3Rhc2ggcG9wICR7c3Rhc2hJZH1gXG4gICAgICB9O1xuICAgICAgXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIGNyZWF0ZSBiYWNrdXA6ICR7ZXJyb3J9YCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBydW5WYWxpZGF0aW9uKCk6IFByb21pc2U8VmFsaWRhdGlvblJlc3VsdFtdPiB7XG4gICAgY29uc3QgcmVzdWx0czogVmFsaWRhdGlvblJlc3VsdFtdID0gW107XG4gICAgY29uc3QgdmFsaWRhdGlvblN0YXJ0ID0gRGF0ZS5ub3coKTtcblxuICAgIC8vIEJ1aWxkIHZhbGlkYXRpb25cbiAgICB0cnkge1xuICAgICAgZXhlY1N5bmMoJ25wbSBydW4gYnVpbGQnLCB7XG4gICAgICAgIGN3ZDogdGhpcy53b3Jrc3BhY2VSb290LFxuICAgICAgICBzdGRpbzogJ3BpcGUnLFxuICAgICAgICB0aW1lb3V0OiA2MDAwMCAvLyAxIG1pbnV0ZSB0aW1lb3V0XG4gICAgICB9KTtcbiAgICAgIHJlc3VsdHMucHVzaCh7XG4gICAgICAgIHR5cGU6ICdidWlsZCcsXG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIG1lc3NhZ2U6ICdCdWlsZCBwYXNzZWQgc3VjY2Vzc2Z1bGx5J1xuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHJlc3VsdHMucHVzaCh7XG4gICAgICAgIHR5cGU6ICdidWlsZCcsXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnQnVpbGQgZmFpbGVkJyxcbiAgICAgICAgZGV0YWlsczogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBTdHJpbmcoZXJyb3IpXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBUeXBlIGNoZWNrIHZhbGlkYXRpb25cbiAgICB0cnkge1xuICAgICAgZXhlY1N5bmMoJ25weCB0c2MgLS1ub0VtaXQnLCB7XG4gICAgICAgIGN3ZDogdGhpcy53b3Jrc3BhY2VSb290LFxuICAgICAgICBzdGRpbzogJ3BpcGUnLFxuICAgICAgICB0aW1lb3V0OiAzMDAwMCAvLyAzMCBzZWNvbmQgdGltZW91dFxuICAgICAgfSk7XG4gICAgICByZXN1bHRzLnB1c2goe1xuICAgICAgICB0eXBlOiAndHlwZS1jaGVjaycsXG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIG1lc3NhZ2U6ICdUeXBlIGNoZWNraW5nIHBhc3NlZCdcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICByZXN1bHRzLnB1c2goe1xuICAgICAgICB0eXBlOiAndHlwZS1jaGVjaycsXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBtZXNzYWdlOiAnVHlwZSBjaGVja2luZyBmYWlsZWQnLFxuICAgICAgICBkZXRhaWxzOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IFN0cmluZyhlcnJvcilcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIExpbnQgdmFsaWRhdGlvblxuICAgIHRyeSB7XG4gICAgICBleGVjU3luYyhgbnB4IGVzbGludCAtLWNvbmZpZyAke3RoaXMuZXNsaW50Q29uZmlnUGF0aH0gc3JjYCwge1xuICAgICAgICBjd2Q6IHRoaXMud29ya3NwYWNlUm9vdCxcbiAgICAgICAgc3RkaW86ICdwaXBlJyxcbiAgICAgICAgdGltZW91dDogMzAwMDAgLy8gMzAgc2Vjb25kIHRpbWVvdXRcbiAgICAgIH0pO1xuICAgICAgcmVzdWx0cy5wdXNoKHtcbiAgICAgICAgdHlwZTogJ2xpbnQnLFxuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBtZXNzYWdlOiAnTGludGluZyBwYXNzZWQnXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgLy8gRVNMaW50IHJldHVybnMgbm9uLXplcm8gZXhpdCBjb2RlIGZvciB3YXJuaW5ncy9lcnJvcnMsIHdoaWNoIGlzIGV4cGVjdGVkXG4gICAgICByZXN1bHRzLnB1c2goe1xuICAgICAgICB0eXBlOiAnbGludCcsXG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIG1lc3NhZ2U6ICdMaW50aW5nIGNvbXBsZXRlZCAobWF5IGhhdmUgcmVtYWluaW5nIGlzc3VlcyknXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBUZXN0IHZhbGlkYXRpb24gKGlmIHRlc3RzIGV4aXN0KVxuICAgIGlmIChmcy5leGlzdHNTeW5jKHBhdGguam9pbih0aGlzLndvcmtzcGFjZVJvb3QsICdqZXN0LmNvbmZpZy5qcycpKSkge1xuICAgICAgdHJ5IHtcbiAgICAgICAgZXhlY1N5bmMoJ25wbSB0ZXN0IC0tIC0tcGFzc1dpdGhOb1Rlc3RzJywge1xuICAgICAgICAgIGN3ZDogdGhpcy53b3Jrc3BhY2VSb290LFxuICAgICAgICAgIHN0ZGlvOiAncGlwZScsXG4gICAgICAgICAgdGltZW91dDogMTIwMDAwIC8vIDIgbWludXRlIHRpbWVvdXRcbiAgICAgICAgfSk7XG4gICAgICAgIHJlc3VsdHMucHVzaCh7XG4gICAgICAgICAgdHlwZTogJ3Rlc3QnLFxuICAgICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgICAgbWVzc2FnZTogJ1Rlc3RzIHBhc3NlZCdcbiAgICAgICAgfSk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICByZXN1bHRzLnB1c2goe1xuICAgICAgICAgIHR5cGU6ICd0ZXN0JyxcbiAgICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgICBtZXNzYWdlOiAnVGVzdHMgZmFpbGVkJyxcbiAgICAgICAgICBkZXRhaWxzOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IFN0cmluZyhlcnJvcilcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgY29uc3QgdmFsaWRhdGlvblRpbWUgPSBEYXRlLm5vdygpIC0gdmFsaWRhdGlvblN0YXJ0O1xuICAgIGNvbnNvbGUubG9nKGDwn5SNIFZhbGlkYXRpb24gY29tcGxldGVkIGluICR7dmFsaWRhdGlvblRpbWV9bXNgKTtcblxuICAgIHJldHVybiByZXN1bHRzO1xuICB9XG5cbiAgcHJpdmF0ZSBpc1NhZmVUb0F1dG9GaXgoaXNzdWU6IExpbnRpbmdJc3N1ZSk6IGJvb2xlYW4ge1xuICAgIC8vIENoZWNrIGlmIGZpbGUgc2hvdWxkIGJlIHByZXNlcnZlZFxuICAgIGlmICh0aGlzLnNob3VsZFByZXNlcnZlRmlsZShpc3N1ZS5maWxlLCB0aGlzLnNhZmV0eVByb3RvY29scy5wcmVzZXJ2ZVBhdHRlcm5zKSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIC8vIENoZWNrIGlmIGlzc3VlIHJlcXVpcmVzIHNwZWNpYWwgaGFuZGxpbmdcbiAgICBpZiAoaXNzdWUuZG9tYWluQ29udGV4dD8ucmVxdWlyZXNTcGVjaWFsSGFuZGxpbmcpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICAvLyBPbmx5IGF1dG8tZml4IGlzc3VlcyB3aXRoIGhpZ2ggY29uZmlkZW5jZVxuICAgIGlmIChpc3N1ZS5yZXNvbHV0aW9uU3RyYXRlZ3kuY29uZmlkZW5jZSA8IDAuNykge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIC8vIE9ubHkgYXV0by1maXggbG93IHRvIG1lZGl1bSByaXNrIGlzc3Vlc1xuICAgIGlmIChpc3N1ZS5yZXNvbHV0aW9uU3RyYXRlZ3kucmlza0xldmVsID09PSAnaGlnaCcpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICByZXR1cm4gaXNzdWUuYXV0b0ZpeGFibGU7XG4gIH1cblxuICBwcml2YXRlIHNob3VsZFByZXNlcnZlRmlsZShmaWxlUGF0aDogc3RyaW5nLCBwYXR0ZXJuczogc3RyaW5nW10pOiBib29sZWFuIHtcbiAgICByZXR1cm4gcGF0dGVybnMuc29tZShwYXR0ZXJuID0+IHtcbiAgICAgIGNvbnN0IHJlZ2V4ID0gbmV3IFJlZ0V4cChwYXR0ZXJuLnJlcGxhY2UoL1xcKlxcKi9nLCAnLionKS5yZXBsYWNlKC9cXCovZywgJ1teL10qJykpO1xuICAgICAgcmV0dXJuIHJlZ2V4LnRlc3QoZmlsZVBhdGgpO1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVCYXRjaGVzPFQ+KGl0ZW1zOiBUW10sIGJhdGNoU2l6ZTogbnVtYmVyKTogVFtdW10ge1xuICAgIGNvbnN0IGJhdGNoZXM6IFRbXVtdID0gW107XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBpdGVtcy5sZW5ndGg7IGkgKz0gYmF0Y2hTaXplKSB7XG4gICAgICBiYXRjaGVzLnB1c2goaXRlbXMuc2xpY2UoaSwgaSArIGJhdGNoU2l6ZSkpO1xuICAgIH1cbiAgICByZXR1cm4gYmF0Y2hlcztcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgcHJvY2Vzc0JhdGNoKFxuICAgIGJhdGNoOiBMaW50aW5nSXNzdWVbXSxcbiAgICBvcHRpb25zOiBCYXRjaFByb2Nlc3NpbmdPcHRpb25zXG4gICk6IFByb21pc2U8QXV0b21hdGVkRml4UmVzdWx0PiB7XG4gICAgY29uc3QgcmVzdWx0OiBBdXRvbWF0ZWRGaXhSZXN1bHQgPSB7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIGZpeGVkSXNzdWVzOiAwLFxuICAgICAgZmFpbGVkSXNzdWVzOiAwLFxuICAgICAgcHJvY2Vzc2VkRmlsZXM6IFtdLFxuICAgICAgZXJyb3JzOiBbXSxcbiAgICAgIHZhbGlkYXRpb25SZXN1bHRzOiBbXSxcbiAgICAgIG1ldHJpY3M6IHtcbiAgICAgICAgc3RhcnRUaW1lOiBuZXcgRGF0ZSgpLFxuICAgICAgICBlbmRUaW1lOiBuZXcgRGF0ZSgpLFxuICAgICAgICB0b3RhbFRpbWU6IDAsXG4gICAgICAgIGZpbGVzUHJvY2Vzc2VkOiAwLFxuICAgICAgICBpc3N1ZXNBdHRlbXB0ZWQ6IGJhdGNoLmxlbmd0aCxcbiAgICAgICAgaXNzdWVzRml4ZWQ6IDAsXG4gICAgICAgIGlzc3Vlc0ZhaWxlZDogMCxcbiAgICAgICAgdmFsaWRhdGlvblRpbWU6IDAsXG4gICAgICAgIHJvbGxiYWNrc1BlcmZvcm1lZDogMFxuICAgICAgfVxuICAgIH07XG5cbiAgICAvLyBHcm91cCBpc3N1ZXMgYnkgZmlsZSBmb3IgZWZmaWNpZW50IHByb2Nlc3NpbmdcbiAgICBjb25zdCBpc3N1ZXNCeUZpbGUgPSBuZXcgTWFwPHN0cmluZywgTGludGluZ0lzc3VlW10+KCk7XG4gICAgZm9yIChjb25zdCBpc3N1ZSBvZiBiYXRjaCkge1xuICAgICAgaWYgKCFpc3N1ZXNCeUZpbGUuaGFzKGlzc3VlLmZpbGUpKSB7XG4gICAgICAgIGlzc3Vlc0J5RmlsZS5zZXQoaXNzdWUuZmlsZSwgW10pO1xuICAgICAgfVxuICAgICAgaXNzdWVzQnlGaWxlLmdldChpc3N1ZS5maWxlKSEucHVzaChpc3N1ZSk7XG4gICAgfVxuXG4gICAgLy8gUHJvY2VzcyBlYWNoIGZpbGVcbiAgICBmb3IgKGNvbnN0IFtmaWxlUGF0aCwgZmlsZUlzc3Vlc10gb2YgaXNzdWVzQnlGaWxlKSB7XG4gICAgICB0cnkge1xuICAgICAgICBpZiAob3B0aW9ucy5kcnlSdW4pIHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhg8J+UjSBbRFJZIFJVTl0gV291bGQgZml4ICR7ZmlsZUlzc3Vlcy5sZW5ndGh9IGlzc3VlcyBpbiAke2ZpbGVQYXRofWApO1xuICAgICAgICAgIHJlc3VsdC5maXhlZElzc3VlcyArPSBmaWxlSXNzdWVzLmxlbmd0aDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBjb25zdCBmaXhlZCA9IGF3YWl0IHRoaXMuZml4RmlsZUlzc3VlcyhmaWxlUGF0aCwgZmlsZUlzc3Vlcyk7XG4gICAgICAgICAgaWYgKGZpeGVkKSB7XG4gICAgICAgICAgICByZXN1bHQuZml4ZWRJc3N1ZXMgKz0gZmlsZUlzc3Vlcy5sZW5ndGg7XG4gICAgICAgICAgICByZXN1bHQucHJvY2Vzc2VkRmlsZXMucHVzaChmaWxlUGF0aCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJlc3VsdC5mYWlsZWRJc3N1ZXMgKz0gZmlsZUlzc3Vlcy5sZW5ndGg7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICByZXN1bHQuZmFpbGVkSXNzdWVzICs9IGZpbGVJc3N1ZXMubGVuZ3RoO1xuICAgICAgICByZXN1bHQuZXJyb3JzLnB1c2goe1xuICAgICAgICAgIGZpbGU6IGZpbGVQYXRoLFxuICAgICAgICAgIHJ1bGU6ICdiYXRjaC1wcm9jZXNzaW5nJyxcbiAgICAgICAgICBtZXNzYWdlOiBgRmFpbGVkIHRvIHByb2Nlc3MgZmlsZSBpbiBiYXRjaGAsXG4gICAgICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogU3RyaW5nKGVycm9yKSxcbiAgICAgICAgICBzZXZlcml0eTogJ2Vycm9yJ1xuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXN1bHQuc3VjY2VzcyA9IHJlc3VsdC5maXhlZElzc3VlcyA+IDA7XG4gICAgcmVzdWx0Lm1ldHJpY3MuZW5kVGltZSA9IG5ldyBEYXRlKCk7XG4gICAgcmVzdWx0Lm1ldHJpY3MudG90YWxUaW1lID0gcmVzdWx0Lm1ldHJpY3MuZW5kVGltZS5nZXRUaW1lKCkgLSByZXN1bHQubWV0cmljcy5zdGFydFRpbWUuZ2V0VGltZSgpO1xuICAgIHJlc3VsdC5tZXRyaWNzLmZpbGVzUHJvY2Vzc2VkID0gcmVzdWx0LnByb2Nlc3NlZEZpbGVzLmxlbmd0aDtcbiAgICByZXN1bHQubWV0cmljcy5pc3N1ZXNGaXhlZCA9IHJlc3VsdC5maXhlZElzc3VlcztcbiAgICByZXN1bHQubWV0cmljcy5pc3N1ZXNGYWlsZWQgPSByZXN1bHQuZmFpbGVkSXNzdWVzO1xuXG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZml4RmlsZUlzc3VlcyhmaWxlUGF0aDogc3RyaW5nLCBpc3N1ZXM6IExpbnRpbmdJc3N1ZVtdKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIFVzZSBFU0xpbnQncyBhdXRvLWZpeCBjYXBhYmlsaXR5IGZvciB0aGUgc3BlY2lmaWMgZmlsZVxuICAgICAgY29uc3QgY29tbWFuZCA9IGBucHggZXNsaW50IC0tY29uZmlnICR7dGhpcy5lc2xpbnRDb25maWdQYXRofSAtLWZpeCBcIiR7ZmlsZVBhdGh9XCJgO1xuICAgICAgZXhlY1N5bmMoY29tbWFuZCwge1xuICAgICAgICBjd2Q6IHRoaXMud29ya3NwYWNlUm9vdCxcbiAgICAgICAgc3RkaW86ICdwaXBlJ1xuICAgICAgfSk7XG4gICAgICBcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLndhcm4oYOKaoO+4jyBGYWlsZWQgdG8gZml4IGlzc3VlcyBpbiAke2ZpbGVQYXRofTpgLCBlcnJvcik7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBmaXhVbnVzZWRWYXJpYWJsZShcbiAgICBpc3N1ZTogTGludGluZ0lzc3VlLFxuICAgIG9wdGlvbnM6IFVudXNlZFZhcmlhYmxlRml4T3B0aW9uc1xuICApOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgZmlsZVBhdGggPSBwYXRoLmpvaW4odGhpcy53b3Jrc3BhY2VSb290LCBpc3N1ZS5maWxlKTtcbiAgICAgIGNvbnN0IGNvbnRlbnQgPSBmcy5yZWFkRmlsZVN5bmMoZmlsZVBhdGgsICd1dGY4Jyk7XG4gICAgICBjb25zdCBsaW5lcyA9IGNvbnRlbnQuc3BsaXQoJ1xcbicpO1xuICAgICAgXG4gICAgICAvLyBGaW5kIHRoZSBsaW5lIHdpdGggdGhlIHVudXNlZCB2YXJpYWJsZVxuICAgICAgY29uc3QgbGluZUluZGV4ID0gaXNzdWUubGluZSAtIDE7XG4gICAgICBpZiAobGluZUluZGV4ID49IDAgJiYgbGluZUluZGV4IDwgbGluZXMubGVuZ3RoKSB7XG4gICAgICAgIGNvbnN0IGxpbmUgPSBsaW5lc1tsaW5lSW5kZXhdO1xuICAgICAgICBcbiAgICAgICAgLy8gRXh0cmFjdCB2YXJpYWJsZSBuYW1lIGZyb20gdGhlIG1lc3NhZ2VcbiAgICAgICAgY29uc3QgdmFyTmFtZU1hdGNoID0gaXNzdWUubWVzc2FnZS5tYXRjaCgvJyhbXiddKyknIGlzIChkZWZpbmVkIGJ1dCBuZXZlciB1c2VkfGFzc2lnbmVkIGEgdmFsdWUgYnV0IG5ldmVyIHVzZWQpLyk7XG4gICAgICAgIGlmICh2YXJOYW1lTWF0Y2gpIHtcbiAgICAgICAgICBjb25zdCB2YXJOYW1lID0gdmFyTmFtZU1hdGNoWzFdO1xuICAgICAgICAgIFxuICAgICAgICAgIGlmIChvcHRpb25zLnByZWZpeFdpdGhVbmRlcnNjb3JlICYmICF2YXJOYW1lLnN0YXJ0c1dpdGgoJ18nKSkge1xuICAgICAgICAgICAgLy8gUHJlZml4IHdpdGggdW5kZXJzY29yZSB0byBpbmRpY2F0ZSBpbnRlbnRpb25hbCBub24tdXNlXG4gICAgICAgICAgICBjb25zdCBuZXdMaW5lID0gbGluZS5yZXBsYWNlKG5ldyBSZWdFeHAoYFxcXFxiJHt2YXJOYW1lfVxcXFxiYCksIGBfJHt2YXJOYW1lfWApO1xuICAgICAgICAgICAgbGluZXNbbGluZUluZGV4XSA9IG5ld0xpbmU7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGZzLndyaXRlRmlsZVN5bmMoZmlsZVBhdGgsIGxpbmVzLmpvaW4oJ1xcbicpKTtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgXG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUud2Fybihg4pqg77iPIEZhaWxlZCB0byBmaXggdW51c2VkIHZhcmlhYmxlIGluICR7aXNzdWUuZmlsZX06YCwgZXJyb3IpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgb3B0aW1pemVGaWxlSW1wb3J0cyhcbiAgICBmaWxlUGF0aDogc3RyaW5nLFxuICAgIGlzc3VlczogTGludGluZ0lzc3VlW10sXG4gICAgb3B0aW9uczogSW1wb3J0T3B0aW1pemF0aW9uT3B0aW9uc1xuICApOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICB0cnkge1xuICAgICAgLy8gVXNlIEVTTGludCdzIGF1dG8tZml4IGZvciBpbXBvcnQtcmVsYXRlZCBydWxlc1xuICAgICAgY29uc3QgaW1wb3J0UnVsZXMgPSBpc3N1ZXMubWFwKGkgPT4gaS5ydWxlKS5maWx0ZXIocnVsZSA9PiBydWxlLnN0YXJ0c1dpdGgoJ2ltcG9ydC8nKSk7XG4gICAgICBpZiAoaW1wb3J0UnVsZXMubGVuZ3RoID4gMCkge1xuICAgICAgICBjb25zdCBjb21tYW5kID0gYG5weCBlc2xpbnQgLS1jb25maWcgJHt0aGlzLmVzbGludENvbmZpZ1BhdGh9IC0tZml4IFwiJHtmaWxlUGF0aH1cImA7XG4gICAgICAgIGV4ZWNTeW5jKGNvbW1hbmQsIHtcbiAgICAgICAgICBjd2Q6IHRoaXMud29ya3NwYWNlUm9vdCxcbiAgICAgICAgICBzdGRpbzogJ3BpcGUnXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLndhcm4oYOKaoO+4jyBGYWlsZWQgdG8gb3B0aW1pemUgaW1wb3J0cyBpbiAke2ZpbGVQYXRofTpgLCBlcnJvcik7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBpc1NpbXBsZVR5cGVJc3N1ZShpc3N1ZTogTGludGluZ0lzc3VlKTogYm9vbGVhbiB7XG4gICAgLy8gQ29uc2lkZXIgc2ltcGxlIHR5cGUgaXNzdWVzIHRoYXQgY2FuIGJlIHNhZmVseSBhdXRvLWZpeGVkXG4gICAgY29uc3Qgc2ltcGxlUGF0dGVybnMgPSBbXG4gICAgICAvbm8tZXhwbGljaXQtYW55LipwYXJhbWV0ZXIvLFxuICAgICAgL25vLWV4cGxpY2l0LWFueS4qcmV0dXJuIHR5cGUvLFxuICAgICAgL25vLWV4cGxpY2l0LWFueS4qdmFyaWFibGUgZGVjbGFyYXRpb24vXG4gICAgXTtcbiAgICBcbiAgICByZXR1cm4gc2ltcGxlUGF0dGVybnMuc29tZShwYXR0ZXJuID0+IHBhdHRlcm4udGVzdChpc3N1ZS5tZXNzYWdlKSk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGltcHJvdmVUeXBlQW5ub3RhdGlvbihcbiAgICBpc3N1ZTogTGludGluZ0lzc3VlLFxuICAgIG9wdGlvbnM6IFR5cGVBbm5vdGF0aW9uT3B0aW9uc1xuICApOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICAvLyBGb3Igbm93LCBvbmx5IGhhbmRsZSB2ZXJ5IHNpbXBsZSBjYXNlc1xuICAgIC8vIE1vcmUgY29tcGxleCB0eXBlIGluZmVyZW5jZSB3b3VsZCByZXF1aXJlIEFTVCBwYXJzaW5nIGFuZCBhbmFseXNpc1xuICAgIFxuICAgIGlmIChvcHRpb25zLm1heENvbXBsZXhpdHkgPT09ICdzaW1wbGUnICYmIHRoaXMuaXNTaW1wbGVUeXBlSXNzdWUoaXNzdWUpKSB7XG4gICAgICB0cnkge1xuICAgICAgICAvLyBVc2UgRVNMaW50IGF1dG8tZml4IGlmIGF2YWlsYWJsZVxuICAgICAgICBpZiAoaXNzdWUuYXV0b0ZpeGFibGUpIHtcbiAgICAgICAgICBjb25zdCBjb21tYW5kID0gYG5weCBlc2xpbnQgLS1jb25maWcgJHt0aGlzLmVzbGludENvbmZpZ1BhdGh9IC0tZml4IFwiJHtpc3N1ZS5maWxlfVwiYDtcbiAgICAgICAgICBleGVjU3luYyhjb21tYW5kLCB7XG4gICAgICAgICAgICBjd2Q6IHRoaXMud29ya3NwYWNlUm9vdCxcbiAgICAgICAgICAgIHN0ZGlvOiAncGlwZSdcbiAgICAgICAgICB9KTtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS53YXJuKGDimqDvuI8gRmFpbGVkIHRvIGltcHJvdmUgdHlwZSBhbm5vdGF0aW9uIGluICR7aXNzdWUuZmlsZX06YCwgZXJyb3IpO1xuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbn0iXSwidmVyc2lvbiI6M30=