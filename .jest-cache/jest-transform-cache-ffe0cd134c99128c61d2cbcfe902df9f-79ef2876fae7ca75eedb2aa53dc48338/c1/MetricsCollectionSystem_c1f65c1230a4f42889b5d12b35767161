c39ea009855f9d611eec50acd34275be
"use strict";
/**
 * Enhanced Metrics Collection System
 * Perfect Codebase Campaign - Real-time Comprehensive Metrics
 * Requirements: 6.1, 6.2, 6.3
 */
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.MetricsCollectionSystem = void 0;
const child_process_1 = require("child_process");
const fs = __importStar(require("fs"));
class MetricsCollectionSystem {
    constructor() {
        this.snapshots = [];
        this.collectionInterval = null;
        this.isCollecting = false;
    }
    /**
     * Start real-time metrics collection
     */
    startRealTimeCollection(intervalMs = 30000) {
        if (this.isCollecting) {
            console.log('📊 Metrics collection already running');
            return;
        }
        this.isCollecting = true;
        console.log(`📊 Starting real-time metrics collection (interval: ${intervalMs}ms)`);
        this.collectionInterval = setInterval(async () => {
            try {
                await this.collectSnapshot();
            }
            catch (error) {
                console.error('❌ Error during metrics collection:', error.message);
            }
        }, intervalMs);
        // Collect initial snapshot
        this.collectSnapshot();
    }
    /**
     * Stop real-time metrics collection
     */
    stopRealTimeCollection() {
        if (this.collectionInterval) {
            clearInterval(this.collectionInterval);
            this.collectionInterval = null;
        }
        this.isCollecting = false;
        console.log('📊 Stopped real-time metrics collection');
    }
    /**
     * Collect comprehensive metrics snapshot
     */
    async collectSnapshot(phase, milestone, notes) {
        const timestamp = new Date();
        const id = `snapshot_${timestamp.getTime()}`;
        console.log('📊 Collecting metrics snapshot...');
        const metrics = await this.collectDetailedMetrics();
        const snapshot = {
            id,
            timestamp,
            metrics,
            phase: phase || 'unknown',
            milestone,
            notes,
        };
        this.snapshots.push(snapshot);
        // Keep only recent snapshots to prevent memory issues
        if (this.snapshots.length > 1000) {
            this.snapshots = this.snapshots.slice(-500);
        }
        console.log(`📊 Snapshot collected: ${id}`);
        return snapshot;
    }
    /**
     * Collect detailed metrics with comprehensive analysis
     */
    async collectDetailedMetrics() {
        const [typeScriptMetrics, lintingMetrics, buildMetrics, resourceMetrics, enterpriseSystemCount,] = await Promise.all([
            this.collectTypeScriptMetrics(),
            this.collectLintingMetrics(),
            this.collectBuildMetrics(),
            this.collectResourceMetrics(),
            this.getEnterpriseSystemCount(),
        ]);
        const trendData = this.calculateTrendData();
        const detailedMetrics = {
            timestamp: new Date(),
            typeScriptErrors: {
                current: typeScriptMetrics.count,
                target: 0,
                reduction: Math.max(0, 86 - typeScriptMetrics.count),
                percentage: typeScriptMetrics.count >= 0
                    ? Math.round(((86 - typeScriptMetrics.count) / 86) * 100)
                    : 0,
            },
            lintingWarnings: {
                current: lintingMetrics.count,
                target: 0,
                reduction: Math.max(0, 4506 - lintingMetrics.count),
                percentage: lintingMetrics.count >= 0
                    ? Math.round(((4506 - lintingMetrics.count) / 4506) * 100)
                    : 0,
            },
            buildPerformance: {
                currentTime: buildMetrics.buildTime,
                targetTime: 10,
                cacheHitRate: buildMetrics.cacheHitRate,
                memoryUsage: buildMetrics.memoryUsage,
            },
            enterpriseSystems: {
                current: enterpriseSystemCount,
                target: 200,
                transformedExports: Math.max(0, enterpriseSystemCount - 0),
            },
            errorBreakdown: typeScriptMetrics.breakdown,
            warningBreakdown: lintingMetrics.breakdown,
            buildMetrics,
            resourceMetrics,
            trendData,
        };
        return detailedMetrics;
    }
    /**
     * Collect TypeScript error metrics with detailed breakdown
     */
    async collectTypeScriptMetrics() {
        try {
            // Get total error count
            const countOutput = (0, child_process_1.execSync)('yarn tsc --noEmit --skipLibCheck 2>&1 | grep -c "error TS" || echo "0"', {
                encoding: 'utf8',
                stdio: 'pipe',
            });
            const count = parseInt(countOutput.trim()) || 0;
            // Get detailed breakdown by error type
            const breakdown = {};
            if (count > 0) {
                try {
                    const breakdownOutput = (0, child_process_1.execSync)("yarn tsc --noEmit --skipLibCheck 2>&1 | grep -E \"error TS\" | sed 's/.*error //' | cut -d':' -f1 | sort | uniq -c | sort -nr", {
                        encoding: 'utf8',
                        stdio: 'pipe',
                    });
                    const lines = breakdownOutput
                        .trim()
                        .split('\n')
                        .filter(line => line.trim());
                    for (const line of lines) {
                        const match = line.trim().match(/^\s*(\d+)\s+(.+)$/);
                        if (match) {
                            const errorCount = parseInt(match[1]);
                            const errorType = match[2].trim();
                            breakdown[errorType] = errorCount;
                        }
                    }
                }
                catch (error) {
                    console.warn('Could not get TypeScript error breakdown:', error.message);
                }
            }
            return { count, breakdown };
        }
        catch (error) {
            console.warn('Could not collect TypeScript metrics:', error.message);
            return { count: -1, breakdown: {} };
        }
    }
    /**
     * Collect linting warning metrics with categorized breakdown
     */
    async collectLintingMetrics() {
        try {
            // Get total warning count
            const countOutput = (0, child_process_1.execSync)('yarn lint 2>&1 | grep -c "warning" || echo "0"', {
                encoding: 'utf8',
                stdio: 'pipe',
            });
            const count = parseInt(countOutput.trim()) || 0;
            // Get detailed breakdown by warning type
            const breakdown = {};
            if (count > 0) {
                try {
                    const lintOutput = (0, child_process_1.execSync)('yarn lint 2>&1', {
                        encoding: 'utf8',
                        stdio: 'pipe',
                    });
                    const lines = lintOutput.split('\n');
                    for (const line of lines) {
                        // Look for ESLint warning patterns
                        const warningMatch = line.match(/warning\s+(.+?)\s+(@typescript-eslint\/[\w-]+|[\w-]+)/);
                        if (warningMatch) {
                            const ruleType = warningMatch[2];
                            breakdown[ruleType] = (breakdown[ruleType] || 0) + 1;
                        }
                    }
                }
                catch (error) {
                    console.warn('Could not get linting warning breakdown:', error.message);
                }
            }
            return { count, breakdown };
        }
        catch (error) {
            console.warn('Could not collect linting metrics:', error.message);
            return { count: -1, breakdown: {} };
        }
    }
    /**
     * Collect comprehensive build performance metrics
     */
    async collectBuildMetrics() {
        const startTime = Date.now();
        let buildTime = -1;
        let bundleSize = 0;
        let compilationSpeed = 0;
        try {
            // Measure build time
            const buildStart = Date.now();
            (0, child_process_1.execSync)('yarn build', {
                encoding: 'utf8',
                stdio: 'pipe',
            });
            buildTime = (Date.now() - buildStart) / 1000;
            // Calculate compilation speed (rough estimate)
            const sourceFiles = this.countSourceFiles();
            compilationSpeed = sourceFiles / buildTime;
        }
        catch (error) {
            console.warn('Build failed during metrics collection:', error.message);
        }
        try {
            // Get bundle size
            bundleSize = await this.getBundleSize();
        }
        catch (error) {
            console.warn('Could not measure bundle size:', error.message);
        }
        return {
            buildTime,
            bundleSize,
            cacheHitRate: await this.estimateCacheHitRate(),
            memoryUsage: this.getMemoryUsage(),
            cpuUsage: await this.getCpuUsage(),
            diskUsage: await this.getDiskUsage(),
            compilationSpeed,
        };
    }
    /**
     * Collect system resource metrics
     */
    async collectResourceMetrics() {
        const nodeMemoryUsage = process.memoryUsage();
        return {
            nodeMemoryUsage,
            systemMemory: await this.getSystemMemory(),
            diskSpace: await this.getDiskSpace(),
        };
    }
    /**
     * Calculate trend data based on historical snapshots
     */
    calculateTrendData() {
        if (this.snapshots.length < 2) {
            return {
                errorReductionRate: 0,
                warningReductionRate: 0,
                buildTimeImprovement: 0,
                systemGrowthRate: 0,
            };
        }
        const recent = this.snapshots.slice(-10); // Last 10 snapshots
        const timeSpanHours = (recent[recent.length - 1].timestamp.getTime() -
            recent[0].timestamp.getTime()) /
            (1000 * 60 * 60);
        if (timeSpanHours === 0) {
            return {
                errorReductionRate: 0,
                warningReductionRate: 0,
                buildTimeImprovement: 0,
                systemGrowthRate: 0,
            };
        }
        const errorReduction = recent[0].metrics.typeScriptErrors.current -
            recent[recent.length - 1].metrics.typeScriptErrors.current;
        const warningReduction = recent[0].metrics.lintingWarnings.current -
            recent[recent.length - 1].metrics.lintingWarnings.current;
        const buildTimeImprovement = recent[0].metrics.buildPerformance.currentTime -
            recent[recent.length - 1].metrics.buildPerformance.currentTime;
        const systemGrowth = recent[recent.length - 1].metrics.enterpriseSystems.current -
            recent[0].metrics.enterpriseSystems.current;
        return {
            errorReductionRate: errorReduction / timeSpanHours,
            warningReductionRate: warningReduction / timeSpanHours,
            buildTimeImprovement: buildTimeImprovement / timeSpanHours,
            systemGrowthRate: systemGrowth / timeSpanHours,
        };
    }
    /**
     * Helper methods for metrics collection
     */
    async getEnterpriseSystemCount() {
        try {
            const output = (0, child_process_1.execSync)('grep -r "INTELLIGENCE_SYSTEM" src/ | wc -l', {
                encoding: 'utf8',
                stdio: 'pipe',
            });
            return parseInt(output.trim()) || 0;
        }
        catch (error) {
            return 0;
        }
    }
    async getBundleSize() {
        try {
            const buildDirs = ['.next', 'dist', 'build'];
            let totalSize = 0;
            for (const dir of buildDirs) {
                if (fs.existsSync(dir)) {
                    const output = (0, child_process_1.execSync)(`du -sk ${dir} | cut -f1`, {
                        encoding: 'utf8',
                        stdio: 'pipe',
                    });
                    totalSize += parseInt(output.trim()) || 0;
                }
            }
            return totalSize;
        }
        catch (error) {
            return 0;
        }
    }
    async estimateCacheHitRate() {
        // This is a simplified estimation - in a real implementation,
        // you'd integrate with the actual build system's cache metrics
        return 0.8; // 80% default estimate
    }
    getMemoryUsage() {
        const memUsage = process.memoryUsage();
        return Math.round(memUsage.heapUsed / 1024 / 1024);
    }
    async getCpuUsage() {
        try {
            const output = (0, child_process_1.execSync)('ps -o %cpu -p $$ | tail -1', {
                encoding: 'utf8',
                stdio: 'pipe',
            });
            return parseFloat(output.trim()) || 0;
        }
        catch (error) {
            return 0;
        }
    }
    async getDiskUsage() {
        try {
            const output = (0, child_process_1.execSync)('du -sh . | cut -f1', {
                encoding: 'utf8',
                stdio: 'pipe',
            });
            // Convert to MB (rough estimation)
            const sizeStr = output.trim();
            if (sizeStr.includes('G')) {
                return parseFloat(sizeStr) * 1024;
            }
            else if (sizeStr.includes('M')) {
                return parseFloat(sizeStr);
            }
            return 0;
        }
        catch (error) {
            return 0;
        }
    }
    countSourceFiles() {
        try {
            const output = (0, child_process_1.execSync)('find src -name "*.ts" -o -name "*.tsx" | wc -l', {
                encoding: 'utf8',
                stdio: 'pipe',
            });
            return parseInt(output.trim()) || 0;
        }
        catch (error) {
            return 0;
        }
    }
    async getSystemMemory() {
        try {
            const output = (0, child_process_1.execSync)('free -m | grep Mem', {
                encoding: 'utf8',
                stdio: 'pipe',
            });
            const match = output.match(/Mem:\s+(\d+)\s+(\d+)\s+(\d+)/);
            if (match) {
                const total = parseInt(match[1]);
                const used = parseInt(match[2]);
                const free = parseInt(match[3]);
                return {
                    total,
                    used,
                    free,
                    percentage: Math.round((used / total) * 100),
                };
            }
        }
        catch (error) {
            // Fallback for non-Linux systems
        }
        return {
            total: 0,
            used: 0,
            free: 0,
            percentage: 0,
        };
    }
    async getDiskSpace() {
        try {
            const output = (0, child_process_1.execSync)('df -h . | tail -1', {
                encoding: 'utf8',
                stdio: 'pipe',
            });
            const parts = output.trim().split(/\s+/);
            if (parts.length >= 4) {
                const total = this.parseSize(parts[1]);
                const used = this.parseSize(parts[2]);
                const free = this.parseSize(parts[3]);
                return {
                    total,
                    used,
                    free,
                    percentage: Math.round((used / total) * 100),
                };
            }
        }
        catch (error) {
            // Handle error
        }
        return {
            total: 0,
            used: 0,
            free: 0,
            percentage: 0,
        };
    }
    parseSize(sizeStr) {
        const num = parseFloat(sizeStr);
        if (sizeStr.includes('G'))
            return num * 1024;
        if (sizeStr.includes('M'))
            return num;
        if (sizeStr.includes('K'))
            return num / 1024;
        return num;
    }
    /**
     * Export methods for external access
     */
    getSnapshots() {
        return [...this.snapshots];
    }
    getLatestSnapshot() {
        return this.snapshots.length > 0
            ? this.snapshots[this.snapshots.length - 1]
            : null;
    }
    async exportSnapshots(filePath) {
        const exportData = {
            timestamp: new Date().toISOString(),
            totalSnapshots: this.snapshots.length,
            snapshots: this.snapshots,
            summary: {
                collectionPeriod: this.snapshots.length > 0
                    ? {
                        start: this.snapshots[0].timestamp,
                        end: this.snapshots[this.snapshots.length - 1].timestamp,
                    }
                    : null,
                trends: this.calculateTrendData(),
            },
        };
        fs.writeFileSync(filePath, JSON.stringify(exportData, null, 2));
        console.log(`📊 Metrics snapshots exported to: ${filePath}`);
    }
    clearSnapshots() {
        this.snapshots = [];
        console.log('📊 Metrics snapshots cleared');
    }
}
exports.MetricsCollectionSystem = MetricsCollectionSystem;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9zZXJ2aWNlcy9jYW1wYWlnbi9NZXRyaWNzQ29sbGVjdGlvblN5c3RlbS50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7R0FJRzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFSCxpREFBeUM7QUFDekMsdUNBQXlCO0FBMkR6QixNQUFhLHVCQUF1QjtJQUFwQztRQUNVLGNBQVMsR0FBc0IsRUFBRSxDQUFDO1FBQ2xDLHVCQUFrQixHQUEwQixJQUFJLENBQUM7UUFDakQsaUJBQVksR0FBRyxLQUFLLENBQUM7SUE2aUIvQixDQUFDO0lBM2lCQzs7T0FFRztJQUNILHVCQUF1QixDQUFDLGFBQXFCLEtBQUs7UUFDaEQsSUFBSSxJQUFJLENBQUMsWUFBWSxFQUFFO1lBQ3JCLE9BQU8sQ0FBQyxHQUFHLENBQUMsdUNBQXVDLENBQUMsQ0FBQztZQUNyRCxPQUFPO1NBQ1I7UUFFRCxJQUFJLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQztRQUN6QixPQUFPLENBQUMsR0FBRyxDQUNULHVEQUF1RCxVQUFVLEtBQUssQ0FDdkUsQ0FBQztRQUVGLElBQUksQ0FBQyxrQkFBa0IsR0FBRyxXQUFXLENBQUMsS0FBSyxJQUFJLEVBQUU7WUFDL0MsSUFBSTtnQkFDRixNQUFNLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQzthQUM5QjtZQUFDLE9BQU8sS0FBSyxFQUFFO2dCQUNkLE9BQU8sQ0FBQyxLQUFLLENBQUMsb0NBQW9DLEVBQUUsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDO2FBQ3BFO1FBQ0gsQ0FBQyxFQUFFLFVBQVUsQ0FBQyxDQUFDO1FBRWYsMkJBQTJCO1FBQzNCLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQztJQUN6QixDQUFDO0lBRUQ7O09BRUc7SUFDSCxzQkFBc0I7UUFDcEIsSUFBSSxJQUFJLENBQUMsa0JBQWtCLEVBQUU7WUFDM0IsYUFBYSxDQUFDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDO1lBQ3ZDLElB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L0QsQ0FBQztJQUVELGNBQWM7UUFDWixJQUFJLENBQUMsU0FBUyxHQUFHLEVBQUUsQ0FBQztRQUNwQixPQUFPLENBQUMsR0FBRyxDQUFDLDhCQUE4QixDQUFDLENBQUM7SUFDOUMsQ0FBQztDQUNGO0FBaGpCRCwwREFnakJDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9HcmVnQ2FzdHJvL0Rlc2t0b3AvV2hhdFRvRWF0TmV4dC9zcmMvc2VydmljZXMvY2FtcGFpZ24vTWV0cmljc0NvbGxlY3Rpb25TeXN0ZW0udHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBFbmhhbmNlZCBNZXRyaWNzIENvbGxlY3Rpb24gU3lzdGVtXG4gKiBQZXJmZWN0IENvZGViYXNlIENhbXBhaWduIC0gUmVhbC10aW1lIENvbXByZWhlbnNpdmUgTWV0cmljc1xuICogUmVxdWlyZW1lbnRzOiA2LjEsIDYuMiwgNi4zXG4gKi9cblxuaW1wb3J0IHsgZXhlY1N5bmMgfSBmcm9tICdjaGlsZF9wcm9jZXNzJztcbmltcG9ydCAqIGFzIGZzIGZyb20gJ2ZzJztcbmltcG9ydCAqIGFzIHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQge1xuICBQcm9ncmVzc01ldHJpY3MsXG4gIEVycm9yQ2F0ZWdvcnksXG4gIFZhbGlkYXRpb25SZXN1bHQsXG59IGZyb20gJy4uLy4uL3R5cGVzL2NhbXBhaWduJztcblxuZXhwb3J0IGludGVyZmFjZSBEZXRhaWxlZE1ldHJpY3MgZXh0ZW5kcyBQcm9ncmVzc01ldHJpY3Mge1xuICB0aW1lc3RhbXA6IERhdGU7XG4gIGVycm9yQnJlYWtkb3duOiBSZWNvcmQ8c3RyaW5nLCBudW1iZXI+O1xuICB3YXJuaW5nQnJlYWtkb3duOiBSZWNvcmQ8c3RyaW5nLCBudW1iZXI+O1xuICBidWlsZE1ldHJpY3M6IEJ1aWxkTWV0cmljcztcbiAgcmVzb3VyY2VNZXRyaWNzOiBSZXNvdXJjZU1ldHJpY3M7XG4gIHRyZW5kRGF0YTogVHJlbmREYXRhO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEJ1aWxkTWV0cmljcyB7XG4gIGJ1aWxkVGltZTogbnVtYmVyO1xuICBidW5kbGVTaXplOiBudW1iZXI7XG4gIGNhY2hlSGl0UmF0ZTogbnVtYmVyO1xuICBtZW1vcnlVc2FnZTogbnVtYmVyO1xuICBjcHVVc2FnZTogbnVtYmVyO1xuICBkaXNrVXNhZ2U6IG51bWJlcjtcbiAgY29tcGlsYXRpb25TcGVlZDogbnVtYmVyOyAvLyBmaWxlcyBwZXIgc2Vjb25kXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUmVzb3VyY2VNZXRyaWNzIHtcbiAgbm9kZU1lbW9yeVVzYWdlOiBOb2RlSlMuTWVtb3J5VXNhZ2U7XG4gIHN5c3RlbU1lbW9yeToge1xuICAgIHRvdGFsOiBudW1iZXI7XG4gICAgZnJlZTogbnVtYmVyO1xuICAgIHVzZWQ6IG51bWJlcjtcbiAgICBwZXJjZW50YWdlOiBudW1iZXI7XG4gIH07XG4gIGRpc2tTcGFjZToge1xuICAgIHRvdGFsOiBudW1iZXI7XG4gICAgZnJlZTogbnVtYmVyO1xuICAgIHVzZWQ6IG51bWJlcjtcbiAgICBwZXJjZW50YWdlOiBudW1iZXI7XG4gIH07XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVHJlbmREYXRhIHtcbiAgZXJyb3JSZWR1Y3Rpb25SYXRlOiBudW1iZXI7IC8vIGVycm9ycyByZWR1Y2VkIHBlciBob3VyXG4gIHdhcm5pbmdSZWR1Y3Rpb25SYXRlOiBudW1iZXI7IC8vIHdhcm5pbmdzIHJlZHVjZWQgcGVyIGhvdXJcbiAgYnVpbGRUaW1lSW1wcm92ZW1lbnQ6IG51bWJlcjsgLy8gc2Vjb25kcyBpbXByb3ZlZCBwZXIgaG91clxuICBzeXN0ZW1Hcm93dGhSYXRlOiBudW1iZXI7IC8vIGVudGVycHJpc2Ugc3lzdGVtcyBhZGRlZCBwZXIgaG91clxufVxuXG5leHBvcnQgaW50ZXJmYWNlIE1ldHJpY3NTbmFwc2hvdCB7XG4gIGlkOiBzdHJpbmc7XG4gIHRpbWVzdGFtcDogRGF0ZTtcbiAgbWV0cmljczogRGV0YWlsZWRNZXRyaWNzO1xuICBwaGFzZTogc3RyaW5nO1xuICBtaWxlc3RvbmU/OiBzdHJpbmc7XG4gIG5vdGVzPzogc3RyaW5nO1xufVxuXG5leHBvcnQgY2xhc3MgTWV0cmljc0NvbGxlY3Rpb25TeXN0ZW0ge1xuICBwcml2YXRlIHNuYXBzaG90czogTWV0cmljc1NuYXBzaG90W10gPSBbXTtcbiAgcHJpdmF0ZSBjb2xsZWN0aW9uSW50ZXJ2YWw6IE5vZGVKUy5UaW1lb3V0IHwgbnVsbCA9IG51bGw7XG4gIHByaXZhdGUgaXNDb2xsZWN0aW5nID0gZmFsc2U7XG5cbiAgLyoqXG4gICAqIFN0YXJ0IHJlYWwtdGltZSBtZXRyaWNzIGNvbGxlY3Rpb25cbiAgICovXG4gIHN0YXJ0UmVhbFRpbWVDb2xsZWN0aW9uKGludGVydmFsTXM6IG51bWJlciA9IDMwMDAwKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuaXNDb2xsZWN0aW5nKSB7XG4gICAgICBjb25zb2xlLmxvZygn8J+TiiBNZXRyaWNzIGNvbGxlY3Rpb24gYWxyZWFkeSBydW5uaW5nJyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy5pc0NvbGxlY3RpbmcgPSB0cnVlO1xuICAgIGNvbnNvbGUubG9nKFxuICAgICAgYPCfk4ogU3RhcnRpbmcgcmVhbC10aW1lIG1ldHJpY3MgY29sbGVjdGlvbiAoaW50ZXJ2YWw6ICR7aW50ZXJ2YWxNc31tcylgXG4gICAgKTtcblxuICAgIHRoaXMuY29sbGVjdGlvbkludGVydmFsID0gc2V0SW50ZXJ2YWwoYXN5bmMgKCkgPT4ge1xuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgdGhpcy5jb2xsZWN0U25hcHNob3QoKTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBkdXJpbmcgbWV0cmljcyBjb2xsZWN0aW9uOicsIGVycm9yLm1lc3NhZ2UpO1xuICAgICAgfVxuICAgIH0sIGludGVydmFsTXMpO1xuXG4gICAgLy8gQ29sbGVjdCBpbml0aWFsIHNuYXBzaG90XG4gICAgdGhpcy5jb2xsZWN0U25hcHNob3QoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTdG9wIHJlYWwtdGltZSBtZXRyaWNzIGNvbGxlY3Rpb25cbiAgICovXG4gIHN0b3BSZWFsVGltZUNvbGxlY3Rpb24oKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuY29sbGVjdGlvbkludGVydmFsKSB7XG4gICAgICBjbGVhckludGVydmFsKHRoaXMuY29sbGVjdGlvbkludGVydmFsKTtcbiAgICAgIHRoaXMuY29sbGVjdGlvbkludGVydmFsID0gbnVsbDtcbiAgICB9XG4gICAgdGhpcy5pc0NvbGxlY3RpbmcgPSBmYWxzZTtcbiAgICBjb25zb2xlLmxvZygn8J+TiiBTdG9wcGVkIHJlYWwtdGltZSBtZXRyaWNzIGNvbGxlY3Rpb24nKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDb2xsZWN0IGNvbXByZWhlbnNpdmUgbWV0cmljcyBzbmFwc2hvdFxuICAgKi9cbiAgYXN5bmMgY29sbGVjdFNuYXBzaG90KFxuICAgIHBoYXNlPzogc3RyaW5nLFxuICAgIG1pbGVzdG9uZT86IHN0cmluZyxcbiAgICBub3Rlcz86IHN0cmluZ1xuICApOiBQcm9taXNlPE1ldHJpY3NTbmFwc2hvdD4ge1xuICAgIGNvbnN0IHRpbWVzdGFtcCA9IG5ldyBEYXRlKCk7XG4gICAgY29uc3QgaWQgPSBgc25hcHNob3RfJHt0aW1lc3RhbXAuZ2V0VGltZSgpfWA7XG5cbiAgICBjb25zb2xlLmxvZygn8J+TiiBDb2xsZWN0aW5nIG1ldHJpY3Mgc25hcHNob3QuLi4nKTtcblxuICAgIGNvbnN0IG1ldHJpY3MgPSBhd2FpdCB0aGlzLmNvbGxlY3REZXRhaWxlZE1ldHJpY3MoKTtcblxuICAgIGNvbnN0IHNuYXBzaG90OiBNZXRyaWNzU25hcHNob3QgPSB7XG4gICAgICBpZCxcbiAgICAgIHRpbWVzdGFtcCxcbiAgICAgIG1ldHJpY3MsXG4gICAgICBwaGFzZTogcGhhc2UgfHwgJ3Vua25vd24nLFxuICAgICAgbWlsZXN0b25lLFxuICAgICAgbm90ZXMsXG4gICAgfTtcblxuICAgIHRoaXMuc25hcHNob3RzLnB1c2goc25hcHNob3QpO1xuXG4gICAgLy8gS2VlcCBvbmx5IHJlY2VudCBzbmFwc2hvdHMgdG8gcHJldmVudCBtZW1vcnkgaXNzdWVzXG4gICAgaWYgKHRoaXMuc25hcHNob3RzLmxlbmd0aCA+IDEwMDApIHtcbiAgICAgIHRoaXMuc25hcHNob3RzID0gdGhpcy5zbmFwc2hvdHMuc2xpY2UoLTUwMCk7XG4gICAgfVxuXG4gICAgY29uc29sZS5sb2coYPCfk4ogU25hcHNob3QgY29sbGVjdGVkOiAke2lkfWApO1xuICAgIHJldHVybiBzbmFwc2hvdDtcbiAgfVxuXG4gIC8qKlxuICAgKiBDb2xsZWN0IGRldGFpbGVkIG1ldHJpY3Mgd2l0aCBjb21wcmVoZW5zaXZlIGFuYWx5c2lzXG4gICAqL1xuICBhc3luYyBjb2xsZWN0RGV0YWlsZWRNZXRyaWNzKCk6IFByb21pc2U8RGV0YWlsZWRNZXRyaWNzPiB7XG4gICAgY29uc3QgW1xuICAgICAgdHlwZVNjcmlwdE1ldHJpY3MsXG4gICAgICBsaW50aW5nTWV0cmljcyxcbiAgICAgIGJ1aWxkTWV0cmljcyxcbiAgICAgIHJlc291cmNlTWV0cmljcyxcbiAgICAgIGVudGVycHJpc2VTeXN0ZW1Db3VudCxcbiAgICBdID0gYXdhaXQgUHJvbWlzZS5hbGwoW1xuICAgICAgdGhpcy5jb2xsZWN0VHlwZVNjcmlwdE1ldHJpY3MoKSxcbiAgICAgIHRoaXMuY29sbGVjdExpbnRpbmdNZXRyaWNzKCksXG4gICAgICB0aGlzLmNvbGxlY3RCdWlsZE1ldHJpY3MoKSxcbiAgICAgIHRoaXMuY29sbGVjdFJlc291cmNlTWV0cmljcygpLFxuICAgICAgdGhpcy5nZXRFbnRlcnByaXNlU3lzdGVtQ291bnQoKSxcbiAgICBdKTtcblxuICAgIGNvbnN0IHRyZW5kRGF0YSA9IHRoaXMuY2FsY3VsYXRlVHJlbmREYXRhKCk7XG5cbiAgICBjb25zdCBkZXRhaWxlZE1ldHJpY3M6IERldGFpbGVkTWV0cmljcyA9IHtcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgIHR5cGVTY3JpcHRFcnJvcnM6IHtcbiAgICAgICAgY3VycmVudDogdHlwZVNjcmlwdE1ldHJpY3MuY291bnQsXG4gICAgICAgIHRhcmdldDogMCxcbiAgICAgICAgcmVkdWN0aW9uOiBNYXRoLm1heCgwLCA4NiAtIHR5cGVTY3JpcHRNZXRyaWNzLmNvdW50KSxcbiAgICAgICAgcGVyY2VudGFnZTpcbiAgICAgICAgICB0eXBlU2NyaXB0TWV0cmljcy5jb3VudCA+PSAwXG4gICAgICAgICAgICA/IE1hdGgucm91bmQoKCg4NiAtIHR5cGVTY3JpcHRNZXRyaWNzLmNvdW50KSAvIDg2KSAqIDEwMClcbiAgICAgICAgICAgIDogMCxcbiAgICAgIH0sXG4gICAgICBsaW50aW5nV2FybmluZ3M6IHtcbiAgICAgICAgY3VycmVudDogbGludGluZ01ldHJpY3MuY291bnQsXG4gICAgICAgIHRhcmdldDogMCxcbiAgICAgICAgcmVkdWN0aW9uOiBNYXRoLm1heCgwLCA0NTA2IC0gbGludGluZ01ldHJpY3MuY291bnQpLFxuICAgICAgICBwZXJjZW50YWdlOlxuICAgICAgICAgIGxpbnRpbmdNZXRyaWNzLmNvdW50ID49IDBcbiAgICAgICAgICAgID8gTWF0aC5yb3VuZCgoKDQ1MDYgLSBsaW50aW5nTWV0cmljcy5jb3VudCkgLyA0NTA2KSAqIDEwMClcbiAgICAgICAgICAgIDogMCxcbiAgICAgIH0sXG4gICAgICBidWlsZFBlcmZvcm1hbmNlOiB7XG4gICAgICAgIGN1cnJlbnRUaW1lOiBidWlsZE1ldHJpY3MuYnVpbGRUaW1lLFxuICAgICAgICB0YXJnZXRUaW1lOiAxMCxcbiAgICAgICAgY2FjaGVIaXRSYXRlOiBidWlsZE1ldHJpY3MuY2FjaGVIaXRSYXRlLFxuICAgICAgICBtZW1vcnlVc2FnZTogYnVpbGRNZXRyaWNzLm1lbW9yeVVzYWdlLFxuICAgICAgfSxcbiAgICAgIGVudGVycHJpc2VTeXN0ZW1zOiB7XG4gICAgICAgIGN1cnJlbnQ6IGVudGVycHJpc2VTeXN0ZW1Db3VudCxcbiAgICAgICAgdGFyZ2V0OiAyMDAsXG4gICAgICAgIHRyYW5zZm9ybWVkRXhwb3J0czogTWF0aC5tYXgoMCwgZW50ZXJwcmlzZVN5c3RlbUNvdW50IC0gMCksXG4gICAgICB9LFxuICAgICAgZXJyb3JCcmVha2Rvd246IHR5cGVTY3JpcHRNZXRyaWNzLmJyZWFrZG93bixcbiAgICAgIHdhcm5pbmdCcmVha2Rvd246IGxpbnRpbmdNZXRyaWNzLmJyZWFrZG93bixcbiAgICAgIGJ1aWxkTWV0cmljcyxcbiAgICAgIHJlc291cmNlTWV0cmljcyxcbiAgICAgIHRyZW5kRGF0YSxcbiAgICB9O1xuXG4gICAgcmV0dXJuIGRldGFpbGVkTWV0cmljcztcbiAgfVxuXG4gIC8qKlxuICAgKiBDb2xsZWN0IFR5cGVTY3JpcHQgZXJyb3IgbWV0cmljcyB3aXRoIGRldGFpbGVkIGJyZWFrZG93blxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBjb2xsZWN0VHlwZVNjcmlwdE1ldHJpY3MoKTogUHJvbWlzZTx7XG4gICAgY291bnQ6IG51bWJlcjtcbiAgICBicmVha2Rvd246IFJlY29yZDxzdHJpbmcsIG51bWJlcj47XG4gIH0+IHtcbiAgICB0cnkge1xuICAgICAgLy8gR2V0IHRvdGFsIGVycm9yIGNvdW50XG4gICAgICBjb25zdCBjb3VudE91dHB1dCA9IGV4ZWNTeW5jKFxuICAgICAgICAneWFybiB0c2MgLS1ub0VtaXQgLS1za2lwTGliQ2hlY2sgMj4mMSB8IGdyZXAgLWMgXCJlcnJvciBUU1wiIHx8IGVjaG8gXCIwXCInLFxuICAgICAgICB7XG4gICAgICAgICAgZW5jb2Rpbmc6ICd1dGY4JyxcbiAgICAgICAgICBzdGRpbzogJ3BpcGUnLFxuICAgICAgICB9XG4gICAgICApO1xuXG4gICAgICBjb25zdCBjb3VudCA9IHBhcnNlSW50KGNvdW50T3V0cHV0LnRyaW0oKSkgfHwgMDtcblxuICAgICAgLy8gR2V0IGRldGFpbGVkIGJyZWFrZG93biBieSBlcnJvciB0eXBlXG4gICAgICBjb25zdCBicmVha2Rvd246IFJlY29yZDxzdHJpbmcsIG51bWJlcj4gPSB7fTtcblxuICAgICAgaWYgKGNvdW50ID4gMCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IGJyZWFrZG93bk91dHB1dCA9IGV4ZWNTeW5jKFxuICAgICAgICAgICAgXCJ5YXJuIHRzYyAtLW5vRW1pdCAtLXNraXBMaWJDaGVjayAyPiYxIHwgZ3JlcCAtRSBcXFwiZXJyb3IgVFNcXFwiIHwgc2VkICdzLy4qZXJyb3IgLy8nIHwgY3V0IC1kJzonIC1mMSB8IHNvcnQgfCB1bmlxIC1jIHwgc29ydCAtbnJcIixcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgZW5jb2Rpbmc6ICd1dGY4JyxcbiAgICAgICAgICAgICAgc3RkaW86ICdwaXBlJyxcbiAgICAgICAgICAgIH1cbiAgICAgICAgICApO1xuXG4gICAgICAgICAgY29uc3QgbGluZXMgPSBicmVha2Rvd25PdXRwdXRcbiAgICAgICAgICAgIC50cmltKClcbiAgICAgICAgICAgIC5zcGxpdCgnXFxuJylcbiAgICAgICAgICAgIC5maWx0ZXIobGluZSA9PiBsaW5lLnRyaW0oKSk7XG4gICAgICAgICAgZm9yIChjb25zdCBsaW5lIG9mIGxpbmVzKSB7XG4gICAgICAgICAgICBjb25zdCBtYXRjaCA9IGxpbmUudHJpbSgpLm1hdGNoKC9eXFxzKihcXGQrKVxccysoLispJC8pO1xuICAgICAgICAgICAgaWYgKG1hdGNoKSB7XG4gICAgICAgICAgICAgIGNvbnN0IGVycm9yQ291bnQgPSBwYXJzZUludChtYXRjaFsxXSk7XG4gICAgICAgICAgICAgIGNvbnN0IGVycm9yVHlwZSA9IG1hdGNoWzJdLnRyaW0oKTtcbiAgICAgICAgICAgICAgYnJlYWtkb3duW2Vycm9yVHlwZV0gPSBlcnJvckNvdW50O1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLndhcm4oXG4gICAgICAgICAgICAnQ291bGQgbm90IGdldCBUeXBlU2NyaXB0IGVycm9yIGJyZWFrZG93bjonLFxuICAgICAgICAgICAgZXJyb3IubWVzc2FnZVxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHsgY291bnQsIGJyZWFrZG93biB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLndhcm4oJ0NvdWxkIG5vdCBjb2xsZWN0IFR5cGVTY3JpcHQgbWV0cmljczonLCBlcnJvci5tZXNzYWdlKTtcbiAgICAgIHJldHVybiB7IGNvdW50OiAtMSwgYnJlYWtkb3duOiB7fSB9O1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDb2xsZWN0IGxpbnRpbmcgd2FybmluZyBtZXRyaWNzIHdpdGggY2F0ZWdvcml6ZWQgYnJlYWtkb3duXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGNvbGxlY3RMaW50aW5nTWV0cmljcygpOiBQcm9taXNlPHtcbiAgICBjb3VudDogbnVtYmVyO1xuICAgIGJyZWFrZG93bjogUmVjb3JkPHN0cmluZywgbnVtYmVyPjtcbiAgfT4ge1xuICAgIHRyeSB7XG4gICAgICAvLyBHZXQgdG90YWwgd2FybmluZyBjb3VudFxuICAgICAgY29uc3QgY291bnRPdXRwdXQgPSBleGVjU3luYyhcbiAgICAgICAgJ3lhcm4gbGludCAyPiYxIHwgZ3JlcCAtYyBcIndhcm5pbmdcIiB8fCBlY2hvIFwiMFwiJyxcbiAgICAgICAge1xuICAgICAgICAgIGVuY29kaW5nOiAndXRmOCcsXG4gICAgICAgICAgc3RkaW86ICdwaXBlJyxcbiAgICAgICAgfVxuICAgICAgKTtcblxuICAgICAgY29uc3QgY291bnQgPSBwYXJzZUludChjb3VudE91dHB1dC50cmltKCkpIHx8IDA7XG5cbiAgICAgIC8vIEdldCBkZXRhaWxlZCBicmVha2Rvd24gYnkgd2FybmluZyB0eXBlXG4gICAgICBjb25zdCBicmVha2Rvd246IFJlY29yZDxzdHJpbmcsIG51bWJlcj4gPSB7fTtcblxuICAgICAgaWYgKGNvdW50ID4gMCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IGxpbnRPdXRwdXQgPSBleGVjU3luYygneWFybiBsaW50IDI+JjEnLCB7XG4gICAgICAgICAgICBlbmNvZGluZzogJ3V0ZjgnLFxuICAgICAgICAgICAgc3RkaW86ICdwaXBlJyxcbiAgICAgICAgICB9KTtcblxuICAgICAgICAgIGNvbnN0IGxpbmVzID0gbGludE91dHB1dC5zcGxpdCgnXFxuJyk7XG4gICAgICAgICAgZm9yIChjb25zdCBsaW5lIG9mIGxpbmVzKSB7XG4gICAgICAgICAgICAvLyBMb29rIGZvciBFU0xpbnQgd2FybmluZyBwYXR0ZXJuc1xuICAgICAgICAgICAgY29uc3Qgd2FybmluZ01hdGNoID0gbGluZS5tYXRjaChcbiAgICAgICAgICAgICAgL3dhcm5pbmdcXHMrKC4rPylcXHMrKEB0eXBlc2NyaXB0LWVzbGludFxcL1tcXHctXSt8W1xcdy1dKykvXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgaWYgKHdhcm5pbmdNYXRjaCkge1xuICAgICAgICAgICAgICBjb25zdCBydWxlVHlwZSA9IHdhcm5pbmdNYXRjaFsyXTtcbiAgICAgICAgICAgICAgYnJlYWtkb3duW3J1bGVUeXBlXSA9IChicmVha2Rvd25bcnVsZVR5cGVdIHx8IDApICsgMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS53YXJuKFxuICAgICAgICAgICAgJ0NvdWxkIG5vdCBnZXQgbGludGluZyB3YXJuaW5nIGJyZWFrZG93bjonLFxuICAgICAgICAgICAgZXJyb3IubWVzc2FnZVxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHsgY291bnQsIGJyZWFrZG93biB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLndhcm4oJ0NvdWxkIG5vdCBjb2xsZWN0IGxpbnRpbmcgbWV0cmljczonLCBlcnJvci5tZXNzYWdlKTtcbiAgICAgIHJldHVybiB7IGNvdW50OiAtMSwgYnJlYWtkb3duOiB7fSB9O1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDb2xsZWN0IGNvbXByZWhlbnNpdmUgYnVpbGQgcGVyZm9ybWFuY2UgbWV0cmljc1xuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBjb2xsZWN0QnVpbGRNZXRyaWNzKCk6IFByb21pc2U8QnVpbGRNZXRyaWNzPiB7XG4gICAgY29uc3Qgc3RhcnRUaW1lID0gRGF0ZS5ub3coKTtcbiAgICBsZXQgYnVpbGRUaW1lID0gLTE7XG4gICAgbGV0IGJ1bmRsZVNpemUgPSAwO1xuICAgIGxldCBjb21waWxhdGlvblNwZWVkID0gMDtcblxuICAgIHRyeSB7XG4gICAgICAvLyBNZWFzdXJlIGJ1aWxkIHRpbWVcbiAgICAgIGNvbnN0IGJ1aWxkU3RhcnQgPSBEYXRlLm5vdygpO1xuICAgICAgZXhlY1N5bmMoJ3lhcm4gYnVpbGQnLCB7XG4gICAgICAgIGVuY29kaW5nOiAndXRmOCcsXG4gICAgICAgIHN0ZGlvOiAncGlwZScsXG4gICAgICB9KTtcbiAgICAgIGJ1aWxkVGltZSA9IChEYXRlLm5vdygpIC0gYnVpbGRTdGFydCkgLyAxMDAwO1xuXG4gICAgICAvLyBDYWxjdWxhdGUgY29tcGlsYXRpb24gc3BlZWQgKHJvdWdoIGVzdGltYXRlKVxuICAgICAgY29uc3Qgc291cmNlRmlsZXMgPSB0aGlzLmNvdW50U291cmNlRmlsZXMoKTtcbiAgICAgIGNvbXBpbGF0aW9uU3BlZWQgPSBzb3VyY2VGaWxlcyAvIGJ1aWxkVGltZTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS53YXJuKCdCdWlsZCBmYWlsZWQgZHVyaW5nIG1ldHJpY3MgY29sbGVjdGlvbjonLCBlcnJvci5tZXNzYWdlKTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgLy8gR2V0IGJ1bmRsZSBzaXplXG4gICAgICBidW5kbGVTaXplID0gYXdhaXQgdGhpcy5nZXRCdW5kbGVTaXplKCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUud2FybignQ291bGQgbm90IG1lYXN1cmUgYnVuZGxlIHNpemU6JywgZXJyb3IubWVzc2FnZSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIGJ1aWxkVGltZSxcbiAgICAgIGJ1bmRsZVNpemUsXG4gICAgICBjYWNoZUhpdFJhdGU6IGF3YWl0IHRoaXMuZXN0aW1hdGVDYWNoZUhpdFJhdGUoKSxcbiAgICAgIG1lbW9yeVVzYWdlOiB0aGlzLmdldE1lbW9yeVVzYWdlKCksXG4gICAgICBjcHVVc2FnZTogYXdhaXQgdGhpcy5nZXRDcHVVc2FnZSgpLFxuICAgICAgZGlza1VzYWdlOiBhd2FpdCB0aGlzLmdldERpc2tVc2FnZSgpLFxuICAgICAgY29tcGlsYXRpb25TcGVlZCxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIENvbGxlY3Qgc3lzdGVtIHJlc291cmNlIG1ldHJpY3NcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgY29sbGVjdFJlc291cmNlTWV0cmljcygpOiBQcm9taXNlPFJlc291cmNlTWV0cmljcz4ge1xuICAgIGNvbnN0IG5vZGVNZW1vcnlVc2FnZSA9IHByb2Nlc3MubWVtb3J5VXNhZ2UoKTtcblxuICAgIHJldHVybiB7XG4gICAgICBub2RlTWVtb3J5VXNhZ2UsXG4gICAgICBzeXN0ZW1NZW1vcnk6IGF3YWl0IHRoaXMuZ2V0U3lzdGVtTWVtb3J5KCksXG4gICAgICBkaXNrU3BhY2U6IGF3YWl0IHRoaXMuZ2V0RGlza1NwYWNlKCksXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDYWxjdWxhdGUgdHJlbmQgZGF0YSBiYXNlZCBvbiBoaXN0b3JpY2FsIHNuYXBzaG90c1xuICAgKi9cbiAgcHJpdmF0ZSBjYWxjdWxhdGVUcmVuZERhdGEoKTogVHJlbmREYXRhIHtcbiAgICBpZiAodGhpcy5zbmFwc2hvdHMubGVuZ3RoIDwgMikge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZXJyb3JSZWR1Y3Rpb25SYXRlOiAwLFxuICAgICAgICB3YXJuaW5nUmVkdWN0aW9uUmF0ZTogMCxcbiAgICAgICAgYnVpbGRUaW1lSW1wcm92ZW1lbnQ6IDAsXG4gICAgICAgIHN5c3RlbUdyb3d0aFJhdGU6IDAsXG4gICAgICB9O1xuICAgIH1cblxuICAgIGNvbnN0IHJlY2VudCA9IHRoaXMuc25hcHNob3RzLnNsaWNlKC0xMCk7IC8vIExhc3QgMTAgc25hcHNob3RzXG4gICAgY29uc3QgdGltZVNwYW5Ib3VycyA9XG4gICAgICAocmVjZW50W3JlY2VudC5sZW5ndGggLSAxXS50aW1lc3RhbXAuZ2V0VGltZSgpIC1cbiAgICAgICAgcmVjZW50WzBdLnRpbWVzdGFtcC5nZXRUaW1lKCkpIC9cbiAgICAgICgxMDAwICogNjAgKiA2MCk7XG5cbiAgICBpZiAodGltZVNwYW5Ib3VycyA9PT0gMCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZXJyb3JSZWR1Y3Rpb25SYXRlOiAwLFxuICAgICAgICB3YXJuaW5nUmVkdWN0aW9uUmF0ZTogMCxcbiAgICAgICAgYnVpbGRUaW1lSW1wcm92ZW1lbnQ6IDAsXG4gICAgICAgIHN5c3RlbUdyb3d0aFJhdGU6IDAsXG4gICAgICB9O1xuICAgIH1cblxuICAgIGNvbnN0IGVycm9yUmVkdWN0aW9uID1cbiAgICAgIHJlY2VudFswXS5tZXRyaWNzLnR5cGVTY3JpcHRFcnJvcnMuY3VycmVudCAtXG4gICAgICByZWNlbnRbcmVjZW50Lmxlbmd0aCAtIDFdLm1ldHJpY3MudHlwZVNjcmlwdEVycm9ycy5jdXJyZW50O1xuICAgIGNvbnN0IHdhcm5pbmdSZWR1Y3Rpb24gPVxuICAgICAgcmVjZW50WzBdLm1ldHJpY3MubGludGluZ1dhcm5pbmdzLmN1cnJlbnQgLVxuICAgICAgcmVjZW50W3JlY2VudC5sZW5ndGggLSAxXS5tZXRyaWNzLmxpbnRpbmdXYXJuaW5ncy5jdXJyZW50O1xuICAgIGNvbnN0IGJ1aWxkVGltZUltcHJvdmVtZW50ID1cbiAgICAgIHJlY2VudFswXS5tZXRyaWNzLmJ1aWxkUGVyZm9ybWFuY2UuY3VycmVudFRpbWUgLVxuICAgICAgcmVjZW50W3JlY2VudC5sZW5ndGggLSAxXS5tZXRyaWNzLmJ1aWxkUGVyZm9ybWFuY2UuY3VycmVudFRpbWU7XG4gICAgY29uc3Qgc3lzdGVtR3Jvd3RoID1cbiAgICAgIHJlY2VudFtyZWNlbnQubGVuZ3RoIC0gMV0ubWV0cmljcy5lbnRlcnByaXNlU3lzdGVtcy5jdXJyZW50IC1cbiAgICAgIHJlY2VudFswXS5tZXRyaWNzLmVudGVycHJpc2VTeXN0ZW1zLmN1cnJlbnQ7XG5cbiAgICByZXR1cm4ge1xuICAgICAgZXJyb3JSZWR1Y3Rpb25SYXRlOiBlcnJvclJlZHVjdGlvbiAvIHRpbWVTcGFuSG91cnMsXG4gICAgICB3YXJuaW5nUmVkdWN0aW9uUmF0ZTogd2FybmluZ1JlZHVjdGlvbiAvIHRpbWVTcGFuSG91cnMsXG4gICAgICBidWlsZFRpbWVJbXByb3ZlbWVudDogYnVpbGRUaW1lSW1wcm92ZW1lbnQgLyB0aW1lU3BhbkhvdXJzLFxuICAgICAgc3lzdGVtR3Jvd3RoUmF0ZTogc3lzdGVtR3Jvd3RoIC8gdGltZVNwYW5Ib3VycyxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEhlbHBlciBtZXRob2RzIGZvciBtZXRyaWNzIGNvbGxlY3Rpb25cbiAgICovXG4gIHByaXZhdGUgYXN5bmMgZ2V0RW50ZXJwcmlzZVN5c3RlbUNvdW50KCk6IFByb21pc2U8bnVtYmVyPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IG91dHB1dCA9IGV4ZWNTeW5jKCdncmVwIC1yIFwiSU5URUxMSUdFTkNFX1NZU1RFTVwiIHNyYy8gfCB3YyAtbCcsIHtcbiAgICAgICAgZW5jb2Rpbmc6ICd1dGY4JyxcbiAgICAgICAgc3RkaW86ICdwaXBlJyxcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHBhcnNlSW50KG91dHB1dC50cmltKCkpIHx8IDA7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZ2V0QnVuZGxlU2l6ZSgpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBidWlsZERpcnMgPSBbJy5uZXh0JywgJ2Rpc3QnLCAnYnVpbGQnXTtcbiAgICAgIGxldCB0b3RhbFNpemUgPSAwO1xuXG4gICAgICBmb3IgKGNvbnN0IGRpciBvZiBidWlsZERpcnMpIHtcbiAgICAgICAgaWYgKGZzLmV4aXN0c1N5bmMoZGlyKSkge1xuICAgICAgICAgIGNvbnN0IG91dHB1dCA9IGV4ZWNTeW5jKGBkdSAtc2sgJHtkaXJ9IHwgY3V0IC1mMWAsIHtcbiAgICAgICAgICAgIGVuY29kaW5nOiAndXRmOCcsXG4gICAgICAgICAgICBzdGRpbzogJ3BpcGUnLFxuICAgICAgICAgIH0pO1xuICAgICAgICAgIHRvdGFsU2l6ZSArPSBwYXJzZUludChvdXRwdXQudHJpbSgpKSB8fCAwO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0b3RhbFNpemU7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZXN0aW1hdGVDYWNoZUhpdFJhdGUoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICAvLyBUaGlzIGlzIGEgc2ltcGxpZmllZCBlc3RpbWF0aW9uIC0gaW4gYSByZWFsIGltcGxlbWVudGF0aW9uLFxuICAgIC8vIHlvdSdkIGludGVncmF0ZSB3aXRoIHRoZSBhY3R1YWwgYnVpbGQgc3lzdGVtJ3MgY2FjaGUgbWV0cmljc1xuICAgIHJldHVybiAwLjg7IC8vIDgwJSBkZWZhdWx0IGVzdGltYXRlXG4gIH1cblxuICBwcml2YXRlIGdldE1lbW9yeVVzYWdlKCk6IG51bWJlciB7XG4gICAgY29uc3QgbWVtVXNhZ2UgPSBwcm9jZXNzLm1lbW9yeVVzYWdlKCk7XG4gICAgcmV0dXJuIE1hdGgucm91bmQobWVtVXNhZ2UuaGVhcFVzZWQgLyAxMDI0IC8gMTAyNCk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGdldENwdVVzYWdlKCk6IFByb21pc2U8bnVtYmVyPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IG91dHB1dCA9IGV4ZWNTeW5jKCdwcyAtbyAlY3B1IC1wICQkIHwgdGFpbCAtMScsIHtcbiAgICAgICAgZW5jb2Rpbmc6ICd1dGY4JyxcbiAgICAgICAgc3RkaW86ICdwaXBlJyxcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHBhcnNlRmxvYXQob3V0cHV0LnRyaW0oKSkgfHwgMDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgcmV0dXJuIDA7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBnZXREaXNrVXNhZ2UoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3Qgb3V0cHV0ID0gZXhlY1N5bmMoJ2R1IC1zaCAuIHwgY3V0IC1mMScsIHtcbiAgICAgICAgZW5jb2Rpbmc6ICd1dGY4JyxcbiAgICAgICAgc3RkaW86ICdwaXBlJyxcbiAgICAgIH0pO1xuICAgICAgLy8gQ29udmVydCB0byBNQiAocm91Z2ggZXN0aW1hdGlvbilcbiAgICAgIGNvbnN0IHNpemVTdHIgPSBvdXRwdXQudHJpbSgpO1xuICAgICAgaWYgKHNpemVTdHIuaW5jbHVkZXMoJ0cnKSkge1xuICAgICAgICByZXR1cm4gcGFyc2VGbG9hdChzaXplU3RyKSAqIDEwMjQ7XG4gICAgICB9IGVsc2UgaWYgKHNpemVTdHIuaW5jbHVkZXMoJ00nKSkge1xuICAgICAgICByZXR1cm4gcGFyc2VGbG9hdChzaXplU3RyKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiAwO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICByZXR1cm4gMDtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNvdW50U291cmNlRmlsZXMoKTogbnVtYmVyIHtcbiAgICB0cnkge1xuICAgICAgY29uc3Qgb3V0cHV0ID0gZXhlY1N5bmMoXG4gICAgICAgICdmaW5kIHNyYyAtbmFtZSBcIioudHNcIiAtbyAtbmFtZSBcIioudHN4XCIgfCB3YyAtbCcsXG4gICAgICAgIHtcbiAgICAgICAgICBlbmNvZGluZzogJ3V0ZjgnLFxuICAgICAgICAgIHN0ZGlvOiAncGlwZScsXG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgICByZXR1cm4gcGFyc2VJbnQob3V0cHV0LnRyaW0oKSkgfHwgMDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgcmV0dXJuIDA7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBnZXRTeXN0ZW1NZW1vcnkoKTogUHJvbWlzZTxSZXNvdXJjZU1ldHJpY3NbJ3N5c3RlbU1lbW9yeSddPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IG91dHB1dCA9IGV4ZWNTeW5jKCdmcmVlIC1tIHwgZ3JlcCBNZW0nLCB7XG4gICAgICAgIGVuY29kaW5nOiAndXRmOCcsXG4gICAgICAgIHN0ZGlvOiAncGlwZScsXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgbWF0Y2ggPSBvdXRwdXQubWF0Y2goL01lbTpcXHMrKFxcZCspXFxzKyhcXGQrKVxccysoXFxkKykvKTtcbiAgICAgIGlmIChtYXRjaCkge1xuICAgICAgICBjb25zdCB0b3RhbCA9IHBhcnNlSW50KG1hdGNoWzFdKTtcbiAgICAgICAgY29uc3QgdXNlZCA9IHBhcnNlSW50KG1hdGNoWzJdKTtcbiAgICAgICAgY29uc3QgZnJlZSA9IHBhcnNlSW50KG1hdGNoWzNdKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB0b3RhbCxcbiAgICAgICAgICB1c2VkLFxuICAgICAgICAgIGZyZWUsXG4gICAgICAgICAgcGVyY2VudGFnZTogTWF0aC5yb3VuZCgodXNlZCAvIHRvdGFsKSAqIDEwMCksXG4gICAgICAgIH07XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIC8vIEZhbGxiYWNrIGZvciBub24tTGludXggc3lzdGVtc1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICB0b3RhbDogMCxcbiAgICAgIHVzZWQ6IDAsXG4gICAgICBmcmVlOiAwLFxuICAgICAgcGVyY2VudGFnZTogMCxcbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBnZXREaXNrU3BhY2UoKTogUHJvbWlzZTxSZXNvdXJjZU1ldHJpY3NbJ2Rpc2tTcGFjZSddPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IG91dHB1dCA9IGV4ZWNTeW5jKCdkZiAtaCAuIHwgdGFpbCAtMScsIHtcbiAgICAgICAgZW5jb2Rpbmc6ICd1dGY4JyxcbiAgICAgICAgc3RkaW86ICdwaXBlJyxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBwYXJ0cyA9IG91dHB1dC50cmltKCkuc3BsaXQoL1xccysvKTtcbiAgICAgIGlmIChwYXJ0cy5sZW5ndGggPj0gNCkge1xuICAgICAgICBjb25zdCB0b3RhbCA9IHRoaXMucGFyc2VTaXplKHBhcnRzWzFdKTtcbiAgICAgICAgY29uc3QgdXNlZCA9IHRoaXMucGFyc2VTaXplKHBhcnRzWzJdKTtcbiAgICAgICAgY29uc3QgZnJlZSA9IHRoaXMucGFyc2VTaXplKHBhcnRzWzNdKTtcblxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIHRvdGFsLFxuICAgICAgICAgIHVzZWQsXG4gICAgICAgICAgZnJlZSxcbiAgICAgICAgICBwZXJjZW50YWdlOiBNYXRoLnJvdW5kKCh1c2VkIC8gdG90YWwpICogMTAwKSxcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgLy8gSGFuZGxlIGVycm9yXG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIHRvdGFsOiAwLFxuICAgICAgdXNlZDogMCxcbiAgICAgIGZyZWU6IDAsXG4gICAgICBwZXJjZW50YWdlOiAwLFxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIHBhcnNlU2l6ZShzaXplU3RyOiBzdHJpbmcpOiBudW1iZXIge1xuICAgIGNvbnN0IG51bSA9IHBhcnNlRmxvYXQoc2l6ZVN0cik7XG4gICAgaWYgKHNpemVTdHIuaW5jbHVkZXMoJ0cnKSkgcmV0dXJuIG51bSAqIDEwMjQ7XG4gICAgaWYgKHNpemVTdHIuaW5jbHVkZXMoJ00nKSkgcmV0dXJuIG51bTtcbiAgICBpZiAoc2l6ZVN0ci5pbmNsdWRlcygnSycpKSByZXR1cm4gbnVtIC8gMTAyNDtcbiAgICByZXR1cm4gbnVtO1xuICB9XG5cbiAgLyoqXG4gICAqIEV4cG9ydCBtZXRob2RzIGZvciBleHRlcm5hbCBhY2Nlc3NcbiAgICovXG4gIGdldFNuYXBzaG90cygpOiBNZXRyaWNzU25hcHNob3RbXSB7XG4gICAgcmV0dXJuIFsuLi50aGlzLnNuYXBzaG90c107XG4gIH1cblxuICBnZXRMYXRlc3RTbmFwc2hvdCgpOiBNZXRyaWNzU25hcHNob3QgfCBudWxsIHtcbiAgICByZXR1cm4gdGhpcy5zbmFwc2hvdHMubGVuZ3RoID4gMFxuICAgICAgPyB0aGlzLnNuYXBzaG90c1t0aGlzLnNuYXBzaG90cy5sZW5ndGggLSAxXVxuICAgICAgOiBudWxsO1xuICB9XG5cbiAgYXN5bmMgZXhwb3J0U25hcHNob3RzKGZpbGVQYXRoOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBleHBvcnREYXRhID0ge1xuICAgICAgdGltZXN0YW1wOiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICB0b3RhbFNuYXBzaG90czogdGhpcy5zbmFwc2hvdHMubGVuZ3RoLFxuICAgICAgc25hcHNob3RzOiB0aGlzLnNuYXBzaG90cyxcbiAgICAgIHN1bW1hcnk6IHtcbiAgICAgICAgY29sbGVjdGlvblBlcmlvZDpcbiAgICAgICAgICB0aGlzLnNuYXBzaG90cy5sZW5ndGggPiAwXG4gICAgICAgICAgICA/IHtcbiAgICAgICAgICAgICAgICBzdGFydDogdGhpcy5zbmFwc2hvdHNbMF0udGltZXN0YW1wLFxuICAgICAgICAgICAgICAgIGVuZDogdGhpcy5zbmFwc2hvdHNbdGhpcy5zbmFwc2hvdHMubGVuZ3RoIC0gMV0udGltZXN0YW1wLFxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICA6IG51bGwsXG4gICAgICAgIHRyZW5kczogdGhpcy5jYWxjdWxhdGVUcmVuZERhdGEoKSxcbiAgICAgIH0sXG4gICAgfTtcblxuICAgIGZzLndyaXRlRmlsZVN5bmMoZmlsZVBhdGgsIEpTT04uc3RyaW5naWZ5KGV4cG9ydERhdGEsIG51bGwsIDIpKTtcbiAgICBjb25zb2xlLmxvZyhg8J+TiiBNZXRyaWNzIHNuYXBzaG90cyBleHBvcnRlZCB0bzogJHtmaWxlUGF0aH1gKTtcbiAgfVxuXG4gIGNsZWFyU25hcHNob3RzKCk6IHZvaWQge1xuICAgIHRoaXMuc25hcHNob3RzID0gW107XG4gICAgY29uc29sZS5sb2coJ/Cfk4ogTWV0cmljcyBzbmFwc2hvdHMgY2xlYXJlZCcpO1xuICB9XG59XG4iXSwidmVyc2lvbiI6M30=