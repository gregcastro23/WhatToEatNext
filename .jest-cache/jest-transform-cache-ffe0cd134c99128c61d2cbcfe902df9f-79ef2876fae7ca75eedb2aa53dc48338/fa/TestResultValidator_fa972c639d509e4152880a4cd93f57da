331093396005b5f5e5d904ef947fc110
"use strict";
/**
 * Test Result Validation and Consistency Checking
 *
 * Provides comprehensive validation of test results to ensure
 * consistency, reliability, and proper error handling across
 * the test suite.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.createConsistencyCheck = exports.createValidationRule = exports.validateTestConsistency = exports.validateTestResult = exports.TestResultValidator = void 0;
class TestResultValidator {
    static instance;
    validationRules = new Map();
    consistencyChecks = new Map();
    static getInstance() {
        if (!this.instance) {
            this.instance = new TestResultValidator();
            this.instance.initializeDefaultRules();
        }
        return this.instance;
    }
    /**
     * Initialize default validation rules
     */
    initializeDefaultRules() {
        // Performance test validation rules
        this.addValidationRules('performance', [
            {
                name: 'execution_time',
                validator: (result) => typeof result.executionTime === 'number' && result.executionTime > 0,
                errorMessage: 'Execution time must be a positive number',
                severity: 'error'
            },
            {
                name: 'memory_usage',
                validator: (result) => typeof result.memoryUsage === 'number' && result.memoryUsage >= 0,
                errorMessage: 'Memory usage must be a non-negative number',
                severity: 'error'
            },
            {
                name: 'reasonable_execution_time',
                validator: (result) => result.executionTime < 60000,
                errorMessage: 'Execution time exceeds reasonable limit (60 seconds)',
                severity: 'warning'
            },
            {
                name: 'memory_efficiency',
                validator: (result) => result.memoryUsage < 1024 * 1024 * 1024,
                errorMessage: 'Memory usage exceeds efficiency threshold (1GB)',
                severity: 'warning'
            }
        ]);
        // Real-time monitoring test validation rules
        this.addValidationRules('realtime', [
            {
                name: 'response_time',
                validator: (result) => result.responseTime < 5000,
                errorMessage: 'Real-time response time exceeds acceptable limit (5 seconds)',
                severity: 'error'
            },
            {
                name: 'monitoring_accuracy',
                validator: (result) => result.accuracy >= 0.95,
                errorMessage: 'Monitoring accuracy below acceptable threshold (95%)',
                severity: 'error'
            },
            {
                name: 'resource_cleanup',
                validator: (result) => result.resourcesCleanedUp === true,
                errorMessage: 'Resources were not properly cleaned up',
                severity: 'warning'
            }
        ]);
        // Build and compilation test validation rules
        this.addValidationRules('build', [
            {
                name: 'build_success',
                validator: (result) => result.success === true,
                errorMessage: 'Build did not complete successfully',
                severity: 'error'
            },
            {
                name: 'error_count',
                validator: (result) => typeof result.errorCount === 'number' && result.errorCount >= 0,
                errorMessage: 'Error count must be a non-negative number',
                severity: 'error'
            },
            {
                name: 'build_time',
                validator: (result) => result.buildTime < 120000,
                errorMessage: 'Build time exceeds acceptable limit (2 minutes)',
                severity: 'warning'
            }
        ]);
        // Memory test validation rules
        this.addValidationRules('memory', [
            {
                name: 'memory_leak_check',
                validator: (result) => result.memoryLeakDetected !== true,
                errorMessage: 'Memory leak detected during test execution',
                severity: 'error'
            },
            {
                name: 'peak_memory',
                validator: (result) => result.peakMemory < 2048 * 1024 * 1024,
                errorMessage: 'Peak memory usage exceeds limit (2GB)',
                severity: 'error'
            },
            {
                name: 'memory_stability',
                validator: (result) => result.memoryVariance < 0.3,
                errorMessage: 'Memory usage variance exceeds stability threshold (30%)',
                severity: 'warning'
            }
        ]);
    }
    /**
     * Add validation rules for a specific test category
     */
    addValidationRules(category, rules) {
        this.validationRules.set(category, rules);
    }
    /**
     * Add consistency check for a test
     */
    addConsistencyCheck(testName, check) {
        this.consistencyChecks.set(testName, check);
    }
    /**
     * Validate a single test result
     */
    validateResult(result, category) {
        const validationResult = {
            isValid: true,
            errors: [],
            warnings: [],
            info: [],
            summary: {
                totalChecks: 0,
                passedChecks: 0,
                failedChecks: 0,
                warningChecks: 0
            }
        };
        const rules = this.validationRules.get(category) || [];
        validationResult.summary.totalChecks = rules.length;
        for (const rule of rules) {
            try {
                const isValid = rule.validator(result);
                if (isValid) {
                    validationResult.summary.passedChecks++;
                }
                else {
                    switch (rule.severity) {
                        case 'error':
                            validationResult.errors.push(`${rule.name}: ${rule.errorMessage}`);
                            validationResult.summary.failedChecks++;
                            validationResult.isValid = false;
                            break;
                        case 'warning':
                            validationResult.warnings.push(`${rule.name}: ${rule.errorMessage}`);
                            validationResult.summary.warningChecks++;
                            break;
                        case 'info':
                            validationResult.info.push(`${rule.name}: ${rule.errorMessage}`);
                            break;
                    }
                }
            }
            catch (error) {
                validationResult.errors.push(`${rule.name}: Validation error - ${error}`);
                validationResult.summary.failedChecks++;
                validationResult.isValid = false;
            }
        }
        return validationResult;
    }
    /**
     * Validate multiple test results for consistency
     */
    validateConsistency(testName, results) {
        const validationResult = {
            isValid: true,
            errors: [],
            warnings: [],
            info: [],
            summary: {
                totalChecks: 0,
                passedChecks: 0,
                failedChecks: 0,
                warningChecks: 0
            }
        };
        const check = this.consistencyChecks.get(testName);
        if (!check) {
            validationResult.warnings.push(`No consistency check defined for test: ${testName}`);
            return validationResult;
        }
        validationResult.summary.totalChecks = 1;
        try {
            // Check if all results are of expected type
            const typeCheck = results.every(result => typeof result === check.expectedType);
            if (!typeCheck) {
                validationResult.errors.push(`Results type mismatch. Expected: ${check.expectedType}`);
                validationResult.isValid = false;
                validationResult.summary.failedChecks++;
                return validationResult;
            }
            // Check required fields if specified
            if (check.requiredFields) {
                for (const field of check.requiredFields) {
                    const fieldCheck = results.every(result => typeof result === 'object' && result !== null && field in result);
                    if (!fieldCheck) {
                        validationResult.errors.push(`Required field missing: ${field}`);
                        validationResult.isValid = false;
                        validationResult.summary.failedChecks++;
                    }
                }
            }
            // Check tolerance for numeric results
            if (check.tolerancePercent && check.expectedType === 'number') {
                const numericResults = results.filter(r => typeof r === 'number');
                if (numericResults.length > 1) {
                    const mean = numericResults.reduce((a, b) => a + b, 0) / numericResults.length;
                    const variance = this.calculateVariance(numericResults, mean);
                    const variancePercent = (variance / mean) * 100;
                    if (variancePercent > check.tolerancePercent) {
                        validationResult.warnings.push(`Variance ${variancePercent.toFixed(2)}% exceeds tolerance ${check.tolerancePercent}%`);
                        validationResult.summary.warningChecks++;
                    }
                    else {
                        validationResult.summary.passedChecks++;
                    }
                }
            }
            // Run custom validator if provided
            if (check.customValidator) {
                const customResult = check.customValidator(results);
                if (customResult) {
                    validationResult.summary.passedChecks++;
                }
                else {
                    validationResult.errors.push('Custom validation failed');
                    validationResult.isValid = false;
                    validationResult.summary.failedChecks++;
                }
            }
            // If no specific checks failed, mark as passed
            if (validationResult.summary.failedChecks === 0 && validationResult.summary.passedChecks === 0) {
                validationResult.summary.passedChecks = 1;
            }
        }
        catch (error) {
            validationResult.errors.push(`Consistency validation error: ${error}`);
            validationResult.isValid = false;
            validationResult.summary.failedChecks++;
        }
        return validationResult;
    }
    /**
     * Validate test suite results
     */
    validateTestSuite(suiteResults, categoryMapping) {
        const validationResults = new Map();
        for (const [testName, result] of suiteResults) {
            const category = categoryMapping.get(testName) || 'default';
            const validation = this.validateResult(result, category);
            validationResults.set(testName, validation);
        }
        return validationResults;
    }
    /**
     * Generate validation summary report
     */
    generateSummaryReport(validationResults) {
        const summary = {
            overallValid: true,
            totalTests: validationResults.size,
            validTests: 0,
            invalidTests: 0,
            totalErrors: 0,
            totalWarnings: 0,
            details: []
        };
        for (const [testName, result] of validationResults) {
            if (result.isValid) {
                summary.validTests++;
            }
            else {
                summary.invalidTests++;
                summary.overallValid = false;
            }
            summary.totalErrors += result.errors.length;
            summary.totalWarnings += result.warnings.length;
            summary.details.push({
                testName,
                isValid: result.isValid,
                errorCount: result.errors.length,
                warningCount: result.warnings.length,
                issues: [...result.errors, ...result.warnings]
            });
        }
        return summary;
    }
    /**
     * Calculate variance for numeric array
     */
    calculateVariance(numbers, mean) {
        const squaredDiffs = numbers.map(x => Math.pow(x - mean, 2));
        return Math.sqrt(squaredDiffs.reduce((a, b) => a + b, 0) / squaredDiffs.length);
    }
    /**
     * Clear all validation rules and checks
     */
    clear() {
        this.validationRules.clear();
        this.consistencyChecks.clear();
    }
    /**
     * Get validation rules for a category
     */
    getValidationRules(category) {
        return this.validationRules.get(category) || [];
    }
    /**
     * Get consistency check for a test
     */
    getConsistencyCheck(testName) {
        return this.consistencyChecks.get(testName);
    }
}
exports.TestResultValidator = TestResultValidator;
/**
 * Convenience function for validating a single test result
 */
function validateTestResult(result, category) {
    const validator = TestResultValidator.getInstance();
    return validator.validateResult(result, category);
}
exports.validateTestResult = validateTestResult;
/**
 * Convenience function for validating test consistency
 */
function validateTestConsistency(testName, results) {
    const validator = TestResultValidator.getInstance();
    return validator.validateConsistency(testName, results);
}
exports.validateTestConsistency = validateTestConsistency;
/**
 * Convenience function for creating custom validation rules
 */
function createValidationRule(name, validator, errorMessage, severity = 'error') {
    return { name, validator, errorMessage, severity };
}
exports.createValidationRule = createValidationRule;
/**
 * Convenience function for creating consistency checks
 */
function createConsistencyCheck(testName, expectedType, options = {}) {
    return {
        testName,
        expectedType,
        ...options
    };
}
exports.createConsistencyCheck = createConsistencyCheck;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9fX3Rlc3RzX18vdXRpbHMvVGVzdFJlc3VsdFZhbGlkYXRvci50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7OztHQU1HOzs7QUE4QkgsTUFBYSxtQkFBbUI7SUFDdEIsTUFBTSxDQUFDLFFBQVEsQ0FBc0I7SUFDckMsZUFBZSxHQUFzQyxJQUFJLEdBQUcsRUFBRSxDQUFDO0lBQy9ELGlCQUFpQixHQUFzQyxJQUFJLEdBQUcsRUFBRSxDQUFDO0lBRXpFLE1BQU0sQ0FBQyxXQUFXO1FBQ2hCLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxFQUFFO1lBQ2xCLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxtQkFBbUIsRUFBRSxDQUFDO1lBQzFDLElBQUksQ0FBQyxRQUFRLENBQUMsc0JBQXNCLEVBQUUsQ0FBQztTQUN4QztRQUNELE9BQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQztJQUN2QixDQUFDO0lBRUQ7O09BRUc7SUFDSyxzQkFBc0I7UUFDNUIsb0NBQW9DO1FBQ3BDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxhQUFhLEVBQUU7WUFDckM7Z0JBQ0UsSUFBSSxFQUFFLGdCQUFnQjtnQkFDdEIsU0FBUyxFQUFFLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FBQyxPQUFPLE1BQU0sQ0FBQyxhQUFhLEtBQUssUUFBUSxJQUFJLE1BQU0sQ0FBQyxhQUFhLEdBQUcsQ0FBQztnQkFDM0YsWUFBWSxFQUFFLDBDQUEwQztnQkFDeEQsUUFBUSxFQUFFLE9BQU87YUFDbEI7WUFDRDtnQkFDRSxJQUFJLEVBQUUsY0FBYztnQkFDcEIsU0FBUyxFQUFFLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FBQyxPQUFPLE1BQU0sQ0FBQyxXQUFXLEtBQUssUUFBUSxJQUFJLE1BQU0sQ0FBQyxXQUFXLElBQUksQ0FBQztnQkFDeEYsWUFBWSxFQUFFLDRDQUE0QztnQkFDMUQsUUFBUSxFQUFFLE9BQU87YUFDbEI7WUFDRDtnQkFDRSxJQUFJLEVBQUUsMkJB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RyxtQkFBbUIsQ0FBQyxXQUFXLEVBQUUsQ0FBQztJQUNwRCxPQUFPLFNBQVMsQ0FBQyxjQUFjLENBQUMsTUFBTSxFQUFFLFFBQVEsQ0FBQyxDQUFDO0FBQ3BELENBQUM7QUFIRCxnREFHQztBQUVEOztHQUVHO0FBQ0gsU0FBZ0IsdUJBQXVCLENBQUMsUUFBZ0IsRUFBRSxPQUFjO0lBQ3RFLE1BQU0sU0FBUyxHQUFHLG1CQUFtQixDQUFDLFdBQVcsRUFBRSxDQUFDO0lBQ3BELE9BQU8sU0FBUyxDQUFDLG1CQUFtQixDQUFDLFFBQVEsRUFBRSxPQUFPLENBQUMsQ0FBQztBQUMxRCxDQUFDO0FBSEQsMERBR0M7QUFFRDs7R0FFRztBQUNILFNBQWdCLG9CQUFvQixDQUNsQyxJQUFZLEVBQ1osU0FBbUMsRUFDbkMsWUFBb0IsRUFDcEIsV0FBeUMsT0FBTztJQUVoRCxPQUFPLEVBQUUsSUFBSSxFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUUsUUFBUSxFQUFFLENBQUM7QUFDckQsQ0FBQztBQVBELG9EQU9DO0FBRUQ7O0dBRUc7QUFDSCxTQUFnQixzQkFBc0IsQ0FDcEMsUUFBZ0IsRUFDaEIsWUFBb0IsRUFDcEIsVUFJSSxFQUFFO0lBRU4sT0FBTztRQUNMLFFBQVE7UUFDUixZQUFZO1FBQ1osR0FBRyxPQUFPO0tBQ1gsQ0FBQztBQUNKLENBQUM7QUFkRCx3REFjQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvR3JlZ0Nhc3Ryby9EZXNrdG9wL1doYXRUb0VhdE5leHQvc3JjL19fdGVzdHNfXy91dGlscy9UZXN0UmVzdWx0VmFsaWRhdG9yLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogVGVzdCBSZXN1bHQgVmFsaWRhdGlvbiBhbmQgQ29uc2lzdGVuY3kgQ2hlY2tpbmdcbiAqXG4gKiBQcm92aWRlcyBjb21wcmVoZW5zaXZlIHZhbGlkYXRpb24gb2YgdGVzdCByZXN1bHRzIHRvIGVuc3VyZVxuICogY29uc2lzdGVuY3ksIHJlbGlhYmlsaXR5LCBhbmQgcHJvcGVyIGVycm9yIGhhbmRsaW5nIGFjcm9zc1xuICogdGhlIHRlc3Qgc3VpdGUuXG4gKi9cblxuZXhwb3J0IGludGVyZmFjZSBUZXN0VmFsaWRhdGlvblJ1bGUge1xuICBuYW1lOiBzdHJpbmc7XG4gIHZhbGlkYXRvcjogKHJlc3VsdDogYW55KSA9PiBib29sZWFuO1xuICBlcnJvck1lc3NhZ2U6IHN0cmluZztcbiAgc2V2ZXJpdHk6ICdlcnJvcicgfCAnd2FybmluZycgfCAnaW5mbyc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVGVzdENvbnNpc3RlbmN5Q2hlY2sge1xuICB0ZXN0TmFtZTogc3RyaW5nO1xuICBleHBlY3RlZFR5cGU6IHN0cmluZztcbiAgdG9sZXJhbmNlUGVyY2VudD86IG51bWJlcjtcbiAgcmVxdWlyZWRGaWVsZHM/OiBzdHJpbmdbXTtcbiAgY3VzdG9tVmFsaWRhdG9yPzogKHJlc3VsdHM6IGFueVtdKSA9PiBib29sZWFuO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFZhbGlkYXRpb25SZXN1bHQge1xuICBpc1ZhbGlkOiBib29sZWFuO1xuICBlcnJvcnM6IHN0cmluZ1tdO1xuICB3YXJuaW5nczogc3RyaW5nW107XG4gIGluZm86IHN0cmluZ1tdO1xuICBzdW1tYXJ5OiB7XG4gICAgdG90YWxDaGVja3M6IG51bWJlcjtcbiAgICBwYXNzZWRDaGVja3M6IG51bWJlcjtcbiAgICBmYWlsZWRDaGVja3M6IG51bWJlcjtcbiAgICB3YXJuaW5nQ2hlY2tzOiBudW1iZXI7XG4gIH07XG59XG5cbmV4cG9ydCBjbGFzcyBUZXN0UmVzdWx0VmFsaWRhdG9yIHtcbiAgcHJpdmF0ZSBzdGF0aWMgaW5zdGFuY2U6IFRlc3RSZXN1bHRWYWxpZGF0b3I7XG4gIHByaXZhdGUgdmFsaWRhdGlvblJ1bGVzOiBNYXA8c3RyaW5nLCBUZXN0VmFsaWRhdGlvblJ1bGVbXT4gPSBuZXcgTWFwKCk7XG4gIHByaXZhdGUgY29uc2lzdGVuY3lDaGVja3M6IE1hcDxzdHJpbmcsIFRlc3RDb25zaXN0ZW5jeUNoZWNrPiA9IG5ldyBNYXAoKTtcblxuICBzdGF0aWMgZ2V0SW5zdGFuY2UoKTogVGVzdFJlc3VsdFZhbGlkYXRvciB7XG4gICAgaWYgKCF0aGlzLmluc3RhbmNlKSB7XG4gICAgICB0aGlzLmluc3RhbmNlID0gbmV3IFRlc3RSZXN1bHRWYWxpZGF0b3IoKTtcbiAgICAgIHRoaXMuaW5zdGFuY2UuaW5pdGlhbGl6ZURlZmF1bHRSdWxlcygpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5pbnN0YW5jZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBJbml0aWFsaXplIGRlZmF1bHQgdmFsaWRhdGlvbiBydWxlc1xuICAgKi9cbiAgcHJpdmF0ZSBpbml0aWFsaXplRGVmYXVsdFJ1bGVzKCk6IHZvaWQge1xuICAgIC8vIFBlcmZvcm1hbmNlIHRlc3QgdmFsaWRhdGlvbiBydWxlc1xuICAgIHRoaXMuYWRkVmFsaWRhdGlvblJ1bGVzKCdwZXJmb3JtYW5jZScsIFtcbiAgICAgIHtcbiAgICAgICAgbmFtZTogJ2V4ZWN1dGlvbl90aW1lJyxcbiAgICAgICAgdmFsaWRhdG9yOiAocmVzdWx0KSA9PiB0eXBlb2YgcmVzdWx0LmV4ZWN1dGlvblRpbWUgPT09ICdudW1iZXInICYmIHJlc3VsdC5leGVjdXRpb25UaW1lID4gMCxcbiAgICAgICAgZXJyb3JNZXNzYWdlOiAnRXhlY3V0aW9uIHRpbWUgbXVzdCBiZSBhIHBvc2l0aXZlIG51bWJlcicsXG4gICAgICAgIHNldmVyaXR5OiAnZXJyb3InXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBuYW1lOiAnbWVtb3J5X3VzYWdlJyxcbiAgICAgICAgdmFsaWRhdG9yOiAocmVzdWx0KSA9PiB0eXBlb2YgcmVzdWx0Lm1lbW9yeVVzYWdlID09PSAnbnVtYmVyJyAmJiByZXN1bHQubWVtb3J5VXNhZ2UgPj0gMCxcbiAgICAgICAgZXJyb3JNZXNzYWdlOiAnTWVtb3J5IHVzYWdlIG11c3QgYmUgYSBub24tbmVnYXRpdmUgbnVtYmVyJyxcbiAgICAgICAgc2V2ZXJpdHk6ICdlcnJvcidcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIG5hbWU6ICdyZWFzb25hYmxlX2V4ZWN1dGlvbl90aW1lJyxcbiAgICAgICAgdmFsaWRhdG9yOiAocmVzdWx0KSA9PiByZXN1bHQuZXhlY3V0aW9uVGltZSA8IDYwMDAwLCAvLyAxIG1pbnV0ZVxuICAgICAgICBlcnJvck1lc3NhZ2U6ICdFeGVjdXRpb24gdGltZSBleGNlZWRzIHJlYXNvbmFibGUgbGltaXQgKDYwIHNlY29uZHMpJyxcbiAgICAgICAgc2V2ZXJpdHk6ICd3YXJuaW5nJ1xuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgbmFtZTogJ21lbW9yeV9lZmZpY2llbmN5JyxcbiAgICAgICAgdmFsaWRhdG9yOiAocmVzdWx0KSA9PiByZXN1bHQubWVtb3J5VXNhZ2UgPCAxMDI0ICogMTAyNCAqIDEwMjQsIC8vIDFHQlxuICAgICAgICBlcnJvck1lc3NhZ2U6ICdNZW1vcnkgdXNhZ2UgZXhjZWVkcyBlZmZpY2llbmN5IHRocmVzaG9sZCAoMUdCKScsXG4gICAgICAgIHNldmVyaXR5OiAnd2FybmluZydcbiAgICAgIH1cbiAgICBdKTtcblxuICAgIC8vIFJlYWwtdGltZSBtb25pdG9yaW5nIHRlc3QgdmFsaWRhdGlvbiBydWxlc1xuICAgIHRoaXMuYWRkVmFsaWRhdGlvblJ1bGVzKCdyZWFsdGltZScsIFtcbiAgICAgIHtcbiAgICAgICAgbmFtZTogJ3Jlc3BvbnNlX3RpbWUnLFxuICAgICAgICB2YWxpZGF0b3I6IChyZXN1bHQpID0+IHJlc3VsdC5yZXNwb25zZVRpbWUgPCA1MDAwLCAvLyA1IHNlY29uZHNcbiAgICAgICAgZXJyb3JNZXNzYWdlOiAnUmVhbC10aW1lIHJlc3BvbnNlIHRpbWUgZXhjZWVkcyBhY2NlcHRhYmxlIGxpbWl0ICg1IHNlY29uZHMpJyxcbiAgICAgICAgc2V2ZXJpdHk6ICdlcnJvcidcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIG5hbWU6ICdtb25pdG9yaW5nX2FjY3VyYWN5JyxcbiAgICAgICAgdmFsaWRhdG9yOiAocmVzdWx0KSA9PiByZXN1bHQuYWNjdXJhY3kgPj0gMC45NSwgLy8gOTUlIGFjY3VyYWN5XG4gICAgICAgIGVycm9yTWVzc2FnZTogJ01vbml0b3JpbmcgYWNjdXJhY3kgYmVsb3cgYWNjZXB0YWJsZSB0aHJlc2hvbGQgKDk1JSknLFxuICAgICAgICBzZXZlcml0eTogJ2Vycm9yJ1xuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgbmFtZTogJ3Jlc291cmNlX2NsZWFudXAnLFxuICAgICAgICB2YWxpZGF0b3I6IChyZXN1bHQpID0+IHJlc3VsdC5yZXNvdXJjZXNDbGVhbmVkVXAgPT09IHRydWUsXG4gICAgICAgIGVycm9yTWVzc2FnZTogJ1Jlc291cmNlcyB3ZXJlIG5vdCBwcm9wZXJseSBjbGVhbmVkIHVwJyxcbiAgICAgICAgc2V2ZXJpdHk6ICd3YXJuaW5nJ1xuICAgICAgfVxuICAgIF0pO1xuXG4gICAgLy8gQnVpbGQgYW5kIGNvbXBpbGF0aW9uIHRlc3QgdmFsaWRhdGlvbiBydWxlc1xuICAgIHRoaXMuYWRkVmFsaWRhdGlvblJ1bGVzKCdidWlsZCcsIFtcbiAgICAgIHtcbiAgICAgICAgbmFtZTogJ2J1aWxkX3N1Y2Nlc3MnLFxuICAgICAgICB2YWxpZGF0b3I6IChyZXN1bHQpID0+IHJlc3VsdC5zdWNjZXNzID09PSB0cnVlLFxuICAgICAgICBlcnJvck1lc3NhZ2U6ICdCdWlsZCBkaWQgbm90IGNvbXBsZXRlIHN1Y2Nlc3NmdWxseScsXG4gICAgICAgIHNldmVyaXR5OiAnZXJyb3InXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBuYW1lOiAnZXJyb3JfY291bnQnLFxuICAgICAgICB2YWxpZGF0b3I6IChyZXN1bHQpID0+IHR5cGVvZiByZXN1bHQuZXJyb3JDb3VudCA9PT0gJ251bWJlcicgJiYgcmVzdWx0LmVycm9yQ291bnQgPj0gMCxcbiAgICAgICAgZXJyb3JNZXNzYWdlOiAnRXJyb3IgY291bnQgbXVzdCBiZSBhIG5vbi1uZWdhdGl2ZSBudW1iZXInLFxuICAgICAgICBzZXZlcml0eTogJ2Vycm9yJ1xuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgbmFtZTogJ2J1aWxkX3RpbWUnLFxuICAgICAgICB2YWxpZGF0b3I6IChyZXN1bHQpID0+IHJlc3VsdC5idWlsZFRpbWUgPCAxMjAwMDAsIC8vIDIgbWludXRlc1xuICAgICAgICBlcnJvck1lc3NhZ2U6ICdCdWlsZCB0aW1lIGV4Y2VlZHMgYWNjZXB0YWJsZSBsaW1pdCAoMiBtaW51dGVzKScsXG4gICAgICAgIHNldmVyaXR5OiAnd2FybmluZydcbiAgICAgIH1cbiAgICBdKTtcblxuICAgIC8vIE1lbW9yeSB0ZXN0IHZhbGlkYXRpb24gcnVsZXNcbiAgICB0aGlzLmFkZFZhbGlkYXRpb25SdWxlcygnbWVtb3J5JywgW1xuICAgICAge1xuICAgICAgICBuYW1lOiAnbWVtb3J5X2xlYWtfY2hlY2snLFxuICAgICAgICB2YWxpZGF0b3I6IChyZXN1bHQpID0+IHJlc3VsdC5tZW1vcnlMZWFrRGV0ZWN0ZWQgIT09IHRydWUsXG4gICAgICAgIGVycm9yTWVzc2FnZTogJ01lbW9yeSBsZWFrIGRldGVjdGVkIGR1cmluZyB0ZXN0IGV4ZWN1dGlvbicsXG4gICAgICAgIHNldmVyaXR5OiAnZXJyb3InXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBuYW1lOiAncGVha19tZW1vcnknLFxuICAgICAgICB2YWxpZGF0b3I6IChyZXN1bHQpID0+IHJlc3VsdC5wZWFrTWVtb3J5IDwgMjA0OCAqIDEwMjQgKiAxMDI0LCAvLyAyR0JcbiAgICAgICAgZXJyb3JNZXNzYWdlOiAnUGVhayBtZW1vcnkgdXNhZ2UgZXhjZWVkcyBsaW1pdCAoMkdCKScsXG4gICAgICAgIHNldmVyaXR5OiAnZXJyb3InXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBuYW1lOiAnbWVtb3J5X3N0YWJpbGl0eScsXG4gICAgICAgIHZhbGlkYXRvcjogKHJlc3VsdCkgPT4gcmVzdWx0Lm1lbW9yeVZhcmlhbmNlIDwgMC4zLCAvLyAzMCUgdmFyaWFuY2VcbiAgICAgICAgZXJyb3JNZXNzYWdlOiAnTWVtb3J5IHVzYWdlIHZhcmlhbmNlIGV4Y2VlZHMgc3RhYmlsaXR5IHRocmVzaG9sZCAoMzAlKScsXG4gICAgICAgIHNldmVyaXR5OiAnd2FybmluZydcbiAgICAgIH1cbiAgICBdKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBZGQgdmFsaWRhdGlvbiBydWxlcyBmb3IgYSBzcGVjaWZpYyB0ZXN0IGNhdGVnb3J5XG4gICAqL1xuICBhZGRWYWxpZGF0aW9uUnVsZXMoY2F0ZWdvcnk6IHN0cmluZywgcnVsZXM6IFRlc3RWYWxpZGF0aW9uUnVsZVtdKTogdm9pZCB7XG4gICAgdGhpcy52YWxpZGF0aW9uUnVsZXMuc2V0KGNhdGVnb3J5LCBydWxlcyk7XG4gIH1cblxuICAvKipcbiAgICogQWRkIGNvbnNpc3RlbmN5IGNoZWNrIGZvciBhIHRlc3RcbiAgICovXG4gIGFkZENvbnNpc3RlbmN5Q2hlY2sodGVzdE5hbWU6IHN0cmluZywgY2hlY2s6IFRlc3RDb25zaXN0ZW5jeUNoZWNrKTogdm9pZCB7XG4gICAgdGhpcy5jb25zaXN0ZW5jeUNoZWNrcy5zZXQodGVzdE5hbWUsIGNoZWNrKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBWYWxpZGF0ZSBhIHNpbmdsZSB0ZXN0IHJlc3VsdFxuICAgKi9cbiAgdmFsaWRhdGVSZXN1bHQocmVzdWx0OiBhbnksIGNhdGVnb3J5OiBzdHJpbmcpOiBWYWxpZGF0aW9uUmVzdWx0IHtcbiAgICBjb25zdCB2YWxpZGF0aW9uUmVzdWx0OiBWYWxpZGF0aW9uUmVzdWx0ID0ge1xuICAgICAgaXNWYWxpZDogdHJ1ZSxcbiAgICAgIGVycm9yczogW10sXG4gICAgICB3YXJuaW5nczogW10sXG4gICAgICBpbmZvOiBbXSxcbiAgICAgIHN1bW1hcnk6IHtcbiAgICAgICAgdG90YWxDaGVja3M6IDAsXG4gICAgICAgIHBhc3NlZENoZWNrczogMCxcbiAgICAgICAgZmFpbGVkQ2hlY2tzOiAwLFxuICAgICAgICB3YXJuaW5nQ2hlY2tzOiAwXG4gICAgICB9XG4gICAgfTtcblxuICAgIGNvbnN0IHJ1bGVzID0gdGhpcy52YWxpZGF0aW9uUnVsZXMuZ2V0KGNhdGVnb3J5KSB8fCBbXTtcbiAgICB2YWxpZGF0aW9uUmVzdWx0LnN1bW1hcnkudG90YWxDaGVja3MgPSBydWxlcy5sZW5ndGg7XG5cbiAgICBmb3IgKGNvbnN0IHJ1bGUgb2YgcnVsZXMpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IGlzVmFsaWQgPSBydWxlLnZhbGlkYXRvcihyZXN1bHQpO1xuXG4gICAgICAgIGlmIChpc1ZhbGlkKSB7XG4gICAgICAgICAgdmFsaWRhdGlvblJlc3VsdC5zdW1tYXJ5LnBhc3NlZENoZWNrcysrO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHN3aXRjaCAocnVsZS5zZXZlcml0eSkge1xuICAgICAgICAgICAgY2FzZSAnZXJyb3InOlxuICAgICAgICAgICAgICB2YWxpZGF0aW9uUmVzdWx0LmVycm9ycy5wdXNoKGAke3J1bGUubmFtZX06ICR7cnVsZS5lcnJvck1lc3NhZ2V9YCk7XG4gICAgICAgICAgICAgIHZhbGlkYXRpb25SZXN1bHQuc3VtbWFyeS5mYWlsZWRDaGVja3MrKztcbiAgICAgICAgICAgICAgdmFsaWRhdGlvblJlc3VsdC5pc1ZhbGlkID0gZmFsc2U7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnd2FybmluZyc6XG4gICAgICAgICAgICAgIHZhbGlkYXRpb25SZXN1bHQud2FybmluZ3MucHVzaChgJHtydWxlLm5hbWV9OiAke3J1bGUuZXJyb3JNZXNzYWdlfWApO1xuICAgICAgICAgICAgICB2YWxpZGF0aW9uUmVzdWx0LnN1bW1hcnkud2FybmluZ0NoZWNrcysrO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2luZm8nOlxuICAgICAgICAgICAgICB2YWxpZGF0aW9uUmVzdWx0LmluZm8ucHVzaChgJHtydWxlLm5hbWV9OiAke3J1bGUuZXJyb3JNZXNzYWdlfWApO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIHZhbGlkYXRpb25SZXN1bHQuZXJyb3JzLnB1c2goYCR7cnVsZS5uYW1lfTogVmFsaWRhdGlvbiBlcnJvciAtICR7ZXJyb3J9YCk7XG4gICAgICAgIHZhbGlkYXRpb25SZXN1bHQuc3VtbWFyeS5mYWlsZWRDaGVja3MrKztcbiAgICAgICAgdmFsaWRhdGlvblJlc3VsdC5pc1ZhbGlkID0gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHZhbGlkYXRpb25SZXN1bHQ7XG4gIH1cblxuICAvKipcbiAgICogVmFsaWRhdGUgbXVsdGlwbGUgdGVzdCByZXN1bHRzIGZvciBjb25zaXN0ZW5jeVxuICAgKi9cbiAgdmFsaWRhdGVDb25zaXN0ZW5jeSh0ZXN0TmFtZTogc3RyaW5nLCByZXN1bHRzOiBhbnlbXSk6IFZhbGlkYXRpb25SZXN1bHQge1xuICAgIGNvbnN0IHZhbGlkYXRpb25SZXN1bHQ6IFZhbGlkYXRpb25SZXN1bHQgPSB7XG4gICAgICBpc1ZhbGlkOiB0cnVlLFxuICAgICAgZXJyb3JzOiBbXSxcbiAgICAgIHdhcm5pbmdzOiBbXSxcbiAgICAgIGluZm86IFtdLFxuICAgICAgc3VtbWFyeToge1xuICAgICAgICB0b3RhbENoZWNrczogMCxcbiAgICAgICAgcGFzc2VkQ2hlY2tzOiAwLFxuICAgICAgICBmYWlsZWRDaGVja3M6IDAsXG4gICAgICAgIHdhcm5pbmdDaGVja3M6IDBcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgY29uc3QgY2hlY2sgPSB0aGlzLmNvbnNpc3RlbmN5Q2hlY2tzLmdldCh0ZXN0TmFtZSk7XG4gICAgaWYgKCFjaGVjaykge1xuICAgICAgdmFsaWRhdGlvblJlc3VsdC53YXJuaW5ncy5wdXNoKGBObyBjb25zaXN0ZW5jeSBjaGVjayBkZWZpbmVkIGZvciB0ZXN0OiAke3Rlc3ROYW1lfWApO1xuICAgICAgcmV0dXJuIHZhbGlkYXRpb25SZXN1bHQ7XG4gICAgfVxuXG4gICAgdmFsaWRhdGlvblJlc3VsdC5zdW1tYXJ5LnRvdGFsQ2hlY2tzID0gMTtcblxuICAgIHRyeSB7XG4gICAgICAvLyBDaGVjayBpZiBhbGwgcmVzdWx0cyBhcmUgb2YgZXhwZWN0ZWQgdHlwZVxuICAgICAgY29uc3QgdHlwZUNoZWNrID0gcmVzdWx0cy5ldmVyeShyZXN1bHQgPT4gdHlwZW9mIHJlc3VsdCA9PT0gY2hlY2suZXhwZWN0ZWRUeXBlKTtcbiAgICAgIGlmICghdHlwZUNoZWNrKSB7XG4gICAgICAgIHZhbGlkYXRpb25SZXN1bHQuZXJyb3JzLnB1c2goYFJlc3VsdHMgdHlwZSBtaXNtYXRjaC4gRXhwZWN0ZWQ6ICR7Y2hlY2suZXhwZWN0ZWRUeXBlfWApO1xuICAgICAgICB2YWxpZGF0aW9uUmVzdWx0LmlzVmFsaWQgPSBmYWxzZTtcbiAgICAgICAgdmFsaWRhdGlvblJlc3VsdC5zdW1tYXJ5LmZhaWxlZENoZWNrcysrO1xuICAgICAgICByZXR1cm4gdmFsaWRhdGlvblJlc3VsdDtcbiAgICAgIH1cblxuICAgICAgLy8gQ2hlY2sgcmVxdWlyZWQgZmllbGRzIGlmIHNwZWNpZmllZFxuICAgICAgaWYgKGNoZWNrLnJlcXVpcmVkRmllbGRzKSB7XG4gICAgICAgIGZvciAoY29uc3QgZmllbGQgb2YgY2hlY2sucmVxdWlyZWRGaWVsZHMpIHtcbiAgICAgICAgICBjb25zdCBmaWVsZENoZWNrID0gcmVzdWx0cy5ldmVyeShyZXN1bHQgPT5cbiAgICAgICAgICAgIHR5cGVvZiByZXN1bHQgPT09ICdvYmplY3QnICYmIHJlc3VsdCAhPT0gbnVsbCAmJiBmaWVsZCBpbiByZXN1bHRcbiAgICAgICAgICApO1xuICAgICAgICAgIGlmICghZmllbGRDaGVjaykge1xuICAgICAgICAgICAgdmFsaWRhdGlvblJlc3VsdC5lcnJvcnMucHVzaChgUmVxdWlyZWQgZmllbGQgbWlzc2luZzogJHtmaWVsZH1gKTtcbiAgICAgICAgICAgIHZhbGlkYXRpb25SZXN1bHQuaXNWYWxpZCA9IGZhbHNlO1xuICAgICAgICAgICAgdmFsaWRhdGlvblJlc3VsdC5zdW1tYXJ5LmZhaWxlZENoZWNrcysrO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBDaGVjayB0b2xlcmFuY2UgZm9yIG51bWVyaWMgcmVzdWx0c1xuICAgICAgaWYgKGNoZWNrLnRvbGVyYW5jZVBlcmNlbnQgJiYgY2hlY2suZXhwZWN0ZWRUeXBlID09PSAnbnVtYmVyJykge1xuICAgICAgICBjb25zdCBudW1lcmljUmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKHIgPT4gdHlwZW9mIHIgPT09ICdudW1iZXInKTtcbiAgICAgICAgaWYgKG51bWVyaWNSZXN1bHRzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICBjb25zdCBtZWFuID0gbnVtZXJpY1Jlc3VsdHMucmVkdWNlKChhLCBiKSA9PiBhICsgYiwgMCkgLyBudW1lcmljUmVzdWx0cy5sZW5ndGg7XG4gICAgICAgICAgY29uc3QgdmFyaWFuY2UgPSB0aGlzLmNhbGN1bGF0ZVZhcmlhbmNlKG51bWVyaWNSZXN1bHRzLCBtZWFuKTtcbiAgICAgICAgICBjb25zdCB2YXJpYW5jZVBlcmNlbnQgPSAodmFyaWFuY2UgLyBtZWFuKSAqIDEwMDtcblxuICAgICAgICAgIGlmICh2YXJpYW5jZVBlcmNlbnQgPiBjaGVjay50b2xlcmFuY2VQZXJjZW50KSB7XG4gICAgICAgICAgICB2YWxpZGF0aW9uUmVzdWx0Lndhcm5pbmdzLnB1c2goXG4gICAgICAgICAgICAgIGBWYXJpYW5jZSAke3ZhcmlhbmNlUGVyY2VudC50b0ZpeGVkKDIpfSUgZXhjZWVkcyB0b2xlcmFuY2UgJHtjaGVjay50b2xlcmFuY2VQZXJjZW50fSVgXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgdmFsaWRhdGlvblJlc3VsdC5zdW1tYXJ5Lndhcm5pbmdDaGVja3MrKztcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdmFsaWRhdGlvblJlc3VsdC5zdW1tYXJ5LnBhc3NlZENoZWNrcysrO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBSdW4gY3VzdG9tIHZhbGlkYXRvciBpZiBwcm92aWRlZFxuICAgICAgaWYgKGNoZWNrLmN1c3RvbVZhbGlkYXRvcikge1xuICAgICAgICBjb25zdCBjdXN0b21SZXN1bHQgPSBjaGVjay5jdXN0b21WYWxpZGF0b3IocmVzdWx0cyk7XG4gICAgICAgIGlmIChjdXN0b21SZXN1bHQpIHtcbiAgICAgICAgICB2YWxpZGF0aW9uUmVzdWx0LnN1bW1hcnkucGFzc2VkQ2hlY2tzKys7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdmFsaWRhdGlvblJlc3VsdC5lcnJvcnMucHVzaCgnQ3VzdG9tIHZhbGlkYXRpb24gZmFpbGVkJyk7XG4gICAgICAgICAgdmFsaWRhdGlvblJlc3VsdC5pc1ZhbGlkID0gZmFsc2U7XG4gICAgICAgICAgdmFsaWRhdGlvblJlc3VsdC5zdW1tYXJ5LmZhaWxlZENoZWNrcysrO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIElmIG5vIHNwZWNpZmljIGNoZWNrcyBmYWlsZWQsIG1hcmsgYXMgcGFzc2VkXG4gICAgICBpZiAodmFsaWRhdGlvblJlc3VsdC5zdW1tYXJ5LmZhaWxlZENoZWNrcyA9PT0gMCAmJiB2YWxpZGF0aW9uUmVzdWx0LnN1bW1hcnkucGFzc2VkQ2hlY2tzID09PSAwKSB7XG4gICAgICAgIHZhbGlkYXRpb25SZXN1bHQuc3VtbWFyeS5wYXNzZWRDaGVja3MgPSAxO1xuICAgICAgfVxuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHZhbGlkYXRpb25SZXN1bHQuZXJyb3JzLnB1c2goYENvbnNpc3RlbmN5IHZhbGlkYXRpb24gZXJyb3I6ICR7ZXJyb3J9YCk7XG4gICAgICB2YWxpZGF0aW9uUmVzdWx0LmlzVmFsaWQgPSBmYWxzZTtcbiAgICAgIHZhbGlkYXRpb25SZXN1bHQuc3VtbWFyeS5mYWlsZWRDaGVja3MrKztcbiAgICB9XG5cbiAgICByZXR1cm4gdmFsaWRhdGlvblJlc3VsdDtcbiAgfVxuXG4gIC8qKlxuICAgKiBWYWxpZGF0ZSB0ZXN0IHN1aXRlIHJlc3VsdHNcbiAgICovXG4gIHZhbGlkYXRlVGVzdFN1aXRlKFxuICAgIHN1aXRlUmVzdWx0czogTWFwPHN0cmluZywgYW55PixcbiAgICBjYXRlZ29yeU1hcHBpbmc6IE1hcDxzdHJpbmcsIHN0cmluZz5cbiAgKTogTWFwPHN0cmluZywgVmFsaWRhdGlvblJlc3VsdD4ge1xuICAgIGNvbnN0IHZhbGlkYXRpb25SZXN1bHRzID0gbmV3IE1hcDxzdHJpbmcsIFZhbGlkYXRpb25SZXN1bHQ+KCk7XG5cbiAgICBmb3IgKGNvbnN0IFt0ZXN0TmFtZSwgcmVzdWx0XSBvZiBzdWl0ZVJlc3VsdHMpIHtcbiAgICAgIGNvbnN0IGNhdGVnb3J5ID0gY2F0ZWdvcnlNYXBwaW5nLmdldCh0ZXN0TmFtZSkgfHwgJ2RlZmF1bHQnO1xuICAgICAgY29uc3QgdmFsaWRhdGlvbiA9IHRoaXMudmFsaWRhdGVSZXN1bHQocmVzdWx0LCBjYXRlZ29yeSk7XG4gICAgICB2YWxpZGF0aW9uUmVzdWx0cy5zZXQodGVzdE5hbWUsIHZhbGlkYXRpb24pO1xuICAgIH1cblxuICAgIHJldHVybiB2YWxpZGF0aW9uUmVzdWx0cztcbiAgfVxuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZSB2YWxpZGF0aW9uIHN1bW1hcnkgcmVwb3J0XG4gICAqL1xuICBnZW5lcmF0ZVN1bW1hcnlSZXBvcnQodmFsaWRhdGlvblJlc3VsdHM6IE1hcDxzdHJpbmcsIFZhbGlkYXRpb25SZXN1bHQ+KToge1xuICAgIG92ZXJhbGxWYWxpZDogYm9vbGVhbjtcbiAgICB0b3RhbFRlc3RzOiBudW1iZXI7XG4gICAgdmFsaWRUZXN0czogbnVtYmVyO1xuICAgIGludmFsaWRUZXN0czogbnVtYmVyO1xuICAgIHRvdGFsRXJyb3JzOiBudW1iZXI7XG4gICAgdG90YWxXYXJuaW5nczogbnVtYmVyO1xuICAgIGRldGFpbHM6IEFycmF5PHtcbiAgICAgIHRlc3ROYW1lOiBzdHJpbmc7XG4gICAgICBpc1ZhbGlkOiBib29sZWFuO1xuICAgICAgZXJyb3JDb3VudDogbnVtYmVyO1xuICAgICAgd2FybmluZ0NvdW50OiBudW1iZXI7XG4gICAgICBpc3N1ZXM6IHN0cmluZ1tdO1xuICAgIH0+O1xuICB9IHtcbiAgICBjb25zdCBzdW1tYXJ5ID0ge1xuICAgICAgb3ZlcmFsbFZhbGlkOiB0cnVlLFxuICAgICAgdG90YWxUZXN0czogdmFsaWRhdGlvblJlc3VsdHMuc2l6ZSxcbiAgICAgIHZhbGlkVGVzdHM6IDAsXG4gICAgICBpbnZhbGlkVGVzdHM6IDAsXG4gICAgICB0b3RhbEVycm9yczogMCxcbiAgICAgIHRvdGFsV2FybmluZ3M6IDAsXG4gICAgICBkZXRhaWxzOiBbXSBhcyBBcnJheTx7XG4gICAgICAgIHRlc3ROYW1lOiBzdHJpbmc7XG4gICAgICAgIGlzVmFsaWQ6IGJvb2xlYW47XG4gICAgICAgIGVycm9yQ291bnQ6IG51bWJlcjtcbiAgICAgICAgd2FybmluZ0NvdW50OiBudW1iZXI7XG4gICAgICAgIGlzc3Vlczogc3RyaW5nW107XG4gICAgICB9PlxuICAgIH07XG5cbiAgICBmb3IgKGNvbnN0IFt0ZXN0TmFtZSwgcmVzdWx0XSBvZiB2YWxpZGF0aW9uUmVzdWx0cykge1xuICAgICAgaWYgKHJlc3VsdC5pc1ZhbGlkKSB7XG4gICAgICAgIHN1bW1hcnkudmFsaWRUZXN0cysrO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc3VtbWFyeS5pbnZhbGlkVGVzdHMrKztcbiAgICAgICAgc3VtbWFyeS5vdmVyYWxsVmFsaWQgPSBmYWxzZTtcbiAgICAgIH1cblxuICAgICAgc3VtbWFyeS50b3RhbEVycm9ycyArPSByZXN1bHQuZXJyb3JzLmxlbmd0aDtcbiAgICAgIHN1bW1hcnkudG90YWxXYXJuaW5ncyArPSByZXN1bHQud2FybmluZ3MubGVuZ3RoO1xuXG4gICAgICBzdW1tYXJ5LmRldGFpbHMucHVzaCh7XG4gICAgICAgIHRlc3ROYW1lLFxuICAgICAgICBpc1ZhbGlkOiByZXN1bHQuaXNWYWxpZCxcbiAgICAgICAgZXJyb3JDb3VudDogcmVzdWx0LmVycm9ycy5sZW5ndGgsXG4gICAgICAgIHdhcm5pbmdDb3VudDogcmVzdWx0Lndhcm5pbmdzLmxlbmd0aCxcbiAgICAgICAgaXNzdWVzOiBbLi4ucmVzdWx0LmVycm9ycywgLi4ucmVzdWx0Lndhcm5pbmdzXVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHN1bW1hcnk7XG4gIH1cblxuICAvKipcbiAgICogQ2FsY3VsYXRlIHZhcmlhbmNlIGZvciBudW1lcmljIGFycmF5XG4gICAqL1xuICBwcml2YXRlIGNhbGN1bGF0ZVZhcmlhbmNlKG51bWJlcnM6IG51bWJlcltdLCBtZWFuOiBudW1iZXIpOiBudW1iZXIge1xuICAgIGNvbnN0IHNxdWFyZWREaWZmcyA9IG51bWJlcnMubWFwKHggPT4gTWF0aC5wb3coeCAtIG1lYW4sIDIpKTtcbiAgICByZXR1cm4gTWF0aC5zcXJ0KHNxdWFyZWREaWZmcy5yZWR1Y2UoKGEsIGIpID0+IGEgKyBiLCAwKSAvIHNxdWFyZWREaWZmcy5sZW5ndGgpO1xuICB9XG5cbiAgLyoqXG4gICAqIENsZWFyIGFsbCB2YWxpZGF0aW9uIHJ1bGVzIGFuZCBjaGVja3NcbiAgICovXG4gIGNsZWFyKCk6IHZvaWQge1xuICAgIHRoaXMudmFsaWRhdGlvblJ1bGVzLmNsZWFyKCk7XG4gICAgdGhpcy5jb25zaXN0ZW5jeUNoZWNrcy5jbGVhcigpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB2YWxpZGF0aW9uIHJ1bGVzIGZvciBhIGNhdGVnb3J5XG4gICAqL1xuICBnZXRWYWxpZGF0aW9uUnVsZXMoY2F0ZWdvcnk6IHN0cmluZyk6IFRlc3RWYWxpZGF0aW9uUnVsZVtdIHtcbiAgICByZXR1cm4gdGhpcy52YWxpZGF0aW9uUnVsZXMuZ2V0KGNhdGVnb3J5KSB8fCBbXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgY29uc2lzdGVuY3kgY2hlY2sgZm9yIGEgdGVzdFxuICAgKi9cbiAgZ2V0Q29uc2lzdGVuY3lDaGVjayh0ZXN0TmFtZTogc3RyaW5nKTogVGVzdENvbnNpc3RlbmN5Q2hlY2sgfCB1bmRlZmluZWQge1xuICAgIHJldHVybiB0aGlzLmNvbnNpc3RlbmN5Q2hlY2tzLmdldCh0ZXN0TmFtZSk7XG4gIH1cbn1cblxuLyoqXG4gKiBDb252ZW5pZW5jZSBmdW5jdGlvbiBmb3IgdmFsaWRhdGluZyBhIHNpbmdsZSB0ZXN0IHJlc3VsdFxuICovXG5leHBvcnQgZnVuY3Rpb24gdmFsaWRhdGVUZXN0UmVzdWx0KHJlc3VsdDogYW55LCBjYXRlZ29yeTogc3RyaW5nKTogVmFsaWRhdGlvblJlc3VsdCB7XG4gIGNvbnN0IHZhbGlkYXRvciA9IFRlc3RSZXN1bHRWYWxpZGF0b3IuZ2V0SW5zdGFuY2UoKTtcbiAgcmV0dXJuIHZhbGlkYXRvci52YWxpZGF0ZVJlc3VsdChyZXN1bHQsIGNhdGVnb3J5KTtcbn1cblxuLyoqXG4gKiBDb252ZW5pZW5jZSBmdW5jdGlvbiBmb3IgdmFsaWRhdGluZyB0ZXN0IGNvbnNpc3RlbmN5XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB2YWxpZGF0ZVRlc3RDb25zaXN0ZW5jeSh0ZXN0TmFtZTogc3RyaW5nLCByZXN1bHRzOiBhbnlbXSk6IFZhbGlkYXRpb25SZXN1bHQge1xuICBjb25zdCB2YWxpZGF0b3IgPSBUZXN0UmVzdWx0VmFsaWRhdG9yLmdldEluc3RhbmNlKCk7XG4gIHJldHVybiB2YWxpZGF0b3IudmFsaWRhdGVDb25zaXN0ZW5jeSh0ZXN0TmFtZSwgcmVzdWx0cyk7XG59XG5cbi8qKlxuICogQ29udmVuaWVuY2UgZnVuY3Rpb24gZm9yIGNyZWF0aW5nIGN1c3RvbSB2YWxpZGF0aW9uIHJ1bGVzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVWYWxpZGF0aW9uUnVsZShcbiAgbmFtZTogc3RyaW5nLFxuICB2YWxpZGF0b3I6IChyZXN1bHQ6IGFueSkgPT4gYm9vbGVhbixcbiAgZXJyb3JNZXNzYWdlOiBzdHJpbmcsXG4gIHNldmVyaXR5OiAnZXJyb3InIHwgJ3dhcm5pbmcnIHwgJ2luZm8nID0gJ2Vycm9yJ1xuKTogVGVzdFZhbGlkYXRpb25SdWxlIHtcbiAgcmV0dXJuIHsgbmFtZSwgdmFsaWRhdG9yLCBlcnJvck1lc3NhZ2UsIHNldmVyaXR5IH07XG59XG5cbi8qKlxuICogQ29udmVuaWVuY2UgZnVuY3Rpb24gZm9yIGNyZWF0aW5nIGNvbnNpc3RlbmN5IGNoZWNrc1xuICovXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlQ29uc2lzdGVuY3lDaGVjayhcbiAgdGVzdE5hbWU6IHN0cmluZyxcbiAgZXhwZWN0ZWRUeXBlOiBzdHJpbmcsXG4gIG9wdGlvbnM6IHtcbiAgICB0b2xlcmFuY2VQZXJjZW50PzogbnVtYmVyO1xuICAgIHJlcXVpcmVkRmllbGRzPzogc3RyaW5nW107XG4gICAgY3VzdG9tVmFsaWRhdG9yPzogKHJlc3VsdHM6IGFueVtdKSA9PiBib29sZWFuO1xuICB9ID0ge31cbik6IFRlc3RDb25zaXN0ZW5jeUNoZWNrIHtcbiAgcmV0dXJuIHtcbiAgICB0ZXN0TmFtZSxcbiAgICBleHBlY3RlZFR5cGUsXG4gICAgLi4ub3B0aW9uc1xuICB9O1xufVxuIl0sInZlcnNpb24iOjN9