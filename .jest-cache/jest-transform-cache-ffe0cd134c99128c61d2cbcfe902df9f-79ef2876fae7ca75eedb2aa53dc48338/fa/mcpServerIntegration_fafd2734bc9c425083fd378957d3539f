f5f0e2975789566dd526e5f433eae277
"use strict";
/**
 * MCP Server Integration for Reliable External APIs
 *
 * This module implements Model Context Protocol (MCP) server integration for:
 * - Astrological API connections with NASA JPL Horizons fallback
 * - Nutritional database access with USDA API integration
 * - Recipe API connections with rate limiting and caching
 * - Multi-tier fallback strategy for API reliability
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.useMCPServerIntegration = exports.getMCPServerIntegration = exports.MCPServerIntegration = void 0;
const logger_1 = require("@/utils/logger");
// Default MCP server configurations based on steering file examples
const DEFAULT_MCP_SERVERS = {
    'nasa-horizons': {
        name: 'nasa-horizons',
        command: 'uvx',
        args: ['nasa-horizons-mcp-server@latest'],
        env: {
            FASTMCP_LOG_LEVEL: 'ERROR',
            NASA_API_KEY: process.env.NASA_API_KEY || '',
        },
        disabled: false,
        autoApprove: ['get_planetary_positions', 'get_ephemeris_data'],
        timeout: 10000,
        retryAttempts: 3,
        fallbackEnabled: true,
    },
    'usda-nutrition': {
        name: 'usda-nutrition',
        command: 'uvx',
        args: ['usda-nutrition-mcp-server@latest'],
        env: {
            FASTMCP_LOG_LEVEL: 'ERROR',
            USDA_API_KEY: process.env.USDA_API_KEY || '',
        },
        disabled: false,
        autoApprove: ['get_nutrition_data', 'search_ingredients'],
        timeout: 8000,
        retryAttempts: 2,
        fallbackEnabled: true,
    },
    'spoonacular-recipes': {
        name: 'spoonacular-recipes',
        command: 'uvx',
        args: ['spoonacular-mcp-server@latest'],
        env: {
            FASTMCP_LOG_LEVEL: 'ERROR',
            SPOONACULAR_API_KEY: process.env.SPOONACULAR_API_KEY || '',
        },
        disabled: false,
        autoApprove: ['search_recipes', 'get_recipe_details'],
        timeout: 6000,
        retryAttempts: 2,
        fallbackEnabled: true,
    },
};
// Rate limiting configurations
const RATE_LIMITS = {
    'nasa-horizons': {
        requestsPerMinute: 60,
        requestsPerHour: 1000,
        requestsPerDay: 10000,
        burstLimit: 10,
    },
    'usda-nutrition': {
        requestsPerMinute: 30,
        requestsPerHour: 500,
        requestsPerDay: 5000,
        burstLimit: 5,
    },
    'spoonacular-recipes': {
        requestsPerMinute: 10,
        requestsPerHour: 150,
        requestsPerDay: 150,
        burstLimit: 3,
    },
};
/**
 * MCP Server Integration Manager
 */
class MCPServerIntegration {
    constructor() {
        this.servers = new Map();
        this.cache = new Map();
        this.rateLimiters = new Map();
        this.connectionStatus = new Map();
        this.initializeServers();
        this.initializeRateLimiters();
        this.startHealthChecks();
    }
    static getInstance() {
        if (!MCPServerIntegration.instance) {
            MCPServerIntegration.instance = new MCPServerIntegration();
        }
        return MCPServerIntegration.instance;
    }
    /**
     * Astrological API connections with NASA JPL Horizons fallback
     */
    async getAstrologicalData(date = new Date()) {
        const cacheKey = `astrological_${date.toISOString().split('T')[0]}`;
        // Check cache first
        const cached = this.getFromCache(cacheKey);
        if (cached) {
            return {
                success: true,
                data: cached.data,
                source: 'cache',
                responseTime: 0,
                timestamp: Date.now(),
            };
        }
        // Primary: NASA Horizons MCP server
        try {
            const result = await this.callMCPServer('nasa-horizons', 'get_planetary_positions', { date });
            if (result.success) {
                this.setCache(cacheKey, result.data, 6 * 60 * 60 * 1000); // 6 hours TTL
                return { ...result, source: 'primary' };
            }
        }
        catch (error) {
            logger_1.logger.warn('NASA Horizons MCP server failed:', error);
        }
        // Secondary: Direct NASA API call
        try {
            const result = await this.callDirectNASAAPI(date);
            if (result.success) {
                this.setCache(cacheKey, result.data, 6 * 60 * 60 * 1000);
                return { ...result, source: 'secondary' };
            }
        }
        catch (error) {
            logger_1.logger.warn('Direct NASA API failed:', error);
        }
        // Fallback: Local ephemeris data
        try {
            const fallbackData = await this.getFallbackAstrologicalData(date);
            return {
                success: true,
                data: fallbackData,
                source: 'fallback',
                responseTime: 0,
                timestamp: Date.now(),
            };
        }
        catch (error) {
            logger_1.logger.error('All astrological data sources failed:', error);
            return {
                success: false,
                error: 'All astrological data sources unavailable',
                source: 'fallback',
                responseTime: 0,
                timestamp: Date.now(),
            };
        }
    }
    /**
     * Nutritional database access with USDA API integration
     */
    async getNutritionalData(ingredient) {
        const cacheKey = `nutrition_${ingredient.toLowerCase().replace(/\s+/g, '_')}`;
        // Check cache first
        const cached = this.getFromCache(cacheKey);
        if (cached) {
            return {
                success: true,
                data: cached.data,
                source: 'cache',
                responseTime: 0,
                timestamp: Date.now(),
            };
        }
        // Check rate limits
        if (!this.checkRateLimit('usda-nutrition')) {
            logger_1.logger.warn('USDA nutrition API rate limit exceeded');
            return this.getRateLimitedResponse();
        }
        // Primary: USDA Nutrition MCP server
        try {
            const result = await this.callMCPServer('usda-nutrition', 'get_nutrition_data', { ingredient });
            if (result.success) {
                this.setCache(cacheKey, result.data, 24 * 60 * 60 * 1000); // 24 hours TTL
                return { ...result, source: 'primary' };
            }
        }
        catch (error) {
            logger_1.logger.warn('USDA Nutrition MCP server failed:', error);
        }
        // Secondary: Direct USDA API call
        try {
            const result = await this.callDirectUSDAAPI(ingredient);
            if (result.success) {
                this.setCache(cacheKey, result.data, 24 * 60 * 60 * 1000);
                return { ...result, source: 'secondary' };
            }
        }
        catch (error) {
            logger_1.logger.warn('Direct USDA API failed:', error);
        }
        // Fallback: Local nutrition database
        try {
            const fallbackData = await this.getFallbackNutritionalData(ingredient);
            return {
                success: true,
                data: fallbackData,
                source: 'fallback',
                responseTime: 0,
                timestamp: Date.now(),
            };
        }
        catch (error) {
            logger_1.logger.error('All nutritional data sources failed:', error);
            return {
                success: false,
                error: 'Nutritional data unavailable',
                source: 'fallback',
                responseTime: 0,
                timestamp: Date.now(),
            };
        }
    }
    /**
     * Recipe API connections with rate limiting and caching
     */
    async getRecipeData(query, options = {}) {
        const cacheKey = `recipes_${query.toLowerCase().replace(/\s+/g, '_')}_${JSON.stringify(options)}`;
        // Check cache first
        const cached = this.getFromCache(cacheKey);
        if (cached) {
            return {
                success: true,
                data: cached.data,
                source: 'cache',
                responseTime: 0,
                timestamp: Date.now(),
            };
        }
        // Check rate limits (Spoonacular has strict daily limits)
        if (!this.checkRateLimit('spoonacular-recipes')) {
            logger_1.logger.warn('Spoonacular recipe API rate limit exceeded');
            return this.getRateLimitedResponse();
        }
        // Primary: Spoonacular MCP server
        try {
            const result = await this.callMCPServer('spoonacular-recipes', 'search_recipes', { query, ...options });
            if (result.success) {
                this.setCache(cacheKey, result.data, 12 * 60 * 60 * 1000); // 12 hours TTL
                return { ...result, source: 'primary' };
            }
        }
        catch (error) {
            logger_1.logger.warn('Spoonacular MCP server failed:', error);
        }
        // Secondary: Direct Spoonacular API call
        try {
            const result = await this.callDirectSpoonacularAPI(query, options);
            if (result.success) {
                this.setCache(cacheKey, result.data, 12 * 60 * 60 * 1000);
                return { ...result, source: 'secondary' };
            }
        }
        catch (error) {
            logger_1.logger.warn('Direct Spoonacular API failed:', error);
        }
        // Fallback: Local recipe database
        try {
            const fallbackData = await this.getFallbackRecipeData(query, options);
            return {
                success: true,
                data: fallbackData,
                source: 'fallback',
                responseTime: 0,
                timestamp: Date.now(),
            };
        }
        catch (error) {
            logger_1.logger.error('All recipe data sources failed:', error);
            return {
                success: false,
                error: 'Recipe data unavailable',
                source: 'fallback',
                responseTime: 0,
                timestamp: Date.now(),
            };
        }
    }
    /**
     * Test multi-tier fallback strategy
     */
    async testFallbackStrategy() {
        logger_1.logger.info('Testing MCP server fallback strategy...');
        const results = await Promise.allSettled([
            this.getAstrologicalData(),
            this.getNutritionalData('apple'),
            this.getRecipeData('pasta'),
        ]);
        const astrological = results[0].status === 'fulfilled'
            ? results[0].value
            : this.createErrorResponse('Astrological test failed');
        const nutritional = results[1].status === 'fulfilled'
            ? results[1].value
            : this.createErrorResponse('Nutritional test failed');
        const recipes = results[2].status === 'fulfilled'
            ? results[2].value
            : this.createErrorResponse('Recipe test failed');
        const successCount = [astrological, nutritional, recipes].filter(r => r.success).length;
        const overallReliability = successCount / 3;
        logger_1.logger.info('Fallback strategy test completed', {
            astrological: astrological.success ? astrological.source : 'failed',
            nutritional: nutritional.success ? nutritional.source : 'failed',
            recipes: recipes.success ? recipes.source : 'failed',
            overallReliability,
        });
        return { astrological, nutritional, recipes, overallReliability };
    }
    /**
     * Get server connection status
     */
    getServerStatus() {
        const status = {};
        for (const [name, config] of this.servers) {
            status[name] = {
                connected: this.connectionStatus.get(name) || false,
                lastCheck: Date.now(),
                responseTime: 0,
                errorCount: 0, // Would be tracked in real implementation
            };
        }
        return status;
    }
    // Private helper methods
    initializeServers() {
        Object.values(DEFAULT_MCP_SERVERS).forEach(config => {
            if (!config.disabled) {
                this.servers.set(config.name, config);
                this.connectionStatus.set(config.name, false);
            }
        });
        logger_1.logger.info('MCP servers initialized:', Array.from(this.servers.keys()));
    }
    initializeRateLimiters() {
        Object.entries(RATE_LIMITS).forEach(([serverName, config]) => {
            this.rateLimiters.set(serverName, new RateLimiter(config));
        });
        logger_1.logger.info('Rate limiters initialized for MCP servers');
    }
    startHealthChecks() {
        // Check server health every 5 minutes
        setInterval(async () => {
            for (const [name, config] of this.servers) {
                try {
                    const isHealthy = await this.checkServerHealth(name);
                    this.connectionStatus.set(name, isHealthy);
                }
                catch (error) {
                    logger_1.logger.warn(`Health check failed for MCP server ${name}:`, error);
                    this.connectionStatus.set(name, false);
                }
            }
        }, 5 * 60 * 1000);
    }
    async callMCPServer(serverName, method, params) {
        const config = this.servers.get(serverName);
        if (!config) {
            throw new Error(`MCP server ${serverName} not configured`);
        }
        const startTime = performance.now();
        try {
            // In a real implementation, this would use the actual MCP protocol
            // For now, we simulate the MCP server call
            const result = await this.simulateMCPCall(serverName, method, params);
            const responseTime = performance.now() - startTime;
            return {
                success: true,
                data: result,
                source: 'primary',
                responseTime,
                timestamp: Date.now(),
            };
        }
        catch (error) {
            const responseTime = performance.now() - startTime;
            logger_1.logger.error(`MCP server ${serverName} call failed:`, error);
            return {
                success: false,
                error: error instanceof Error ? error.message : 'Unknown error',
                source: 'primary',
                responseTime,
                timestamp: Date.now(),
            };
        }
    }
    async simulateMCPCall(serverName, method, params) {
        // Simulate MCP server calls for demonstration
        await new Promise(resolve => setTimeout(resolve, Math.random() * 1000 + 500)); // 500-1500ms delay
        switch (serverName) {
            case 'nasa-horizons':
                if (method === 'get_planetary_positions') {
                    return this.generateMockPlanetaryData(params.date);
                }
                break;
            case 'usda-nutrition':
                if (method === 'get_nutrition_data') {
                    return this.generateMockNutritionalData(params.ingredient);
                }
                break;
            case 'spoonacular-recipes':
                if (method === 'search_recipes') {
                    return this.generateMockRecipeData(params.query, params);
                }
                break;
        }
        throw new Error(`Unknown method ${method} for server ${serverName}`);
    }
    async checkServerHealth(serverName) {
        try {
            // In a real implementation, this would ping the MCP server
            // For now, simulate health check
            await new Promise(resolve => setTimeout(resolve, 100));
            return Math.random() > 0.1; // 90% uptime simulation
        }
        catch (error) {
            return false;
        }
    }
    checkRateLimit(serverName) {
        const rateLimiter = this.rateLimiters.get(serverName);
        return rateLimiter ? rateLimiter.checkLimit() : true;
    }
    getFromCache(key) {
        const entry = this.cache.get(key);
        if (!entry)
            return null;
        if (Date.now() - entry.timestamp > entry.ttl) {
            this.cache.delete(key);
            return null;
        }
        return entry;
    }
    setCache(key, data, ttl) {
        this.cache.set(key, {
            data,
            timestamp: Date.now(),
            ttl,
            source: 'cache',
        });
    }
    getRateLimitedResponse() {
        return {
            success: false,
            error: 'Rate limit exceeded',
            source: 'primary',
            responseTime: 0,
            timestamp: Date.now(),
        };
    }
    createErrorResponse(error) {
        return {
            success: false,
            error,
            source: 'fallback',
            responseTime: 0,
            timestamp: Date.now(),
        };
    }
    // Direct API call methods (fallback implementations)
    async callDirectNASAAPI(date) {
        // Simulate direct NASA API call
        await new Promise(resolve => setTimeout(resolve, 2000));
        return {
            success: true,
            data: this.generateMockPlanetaryData(date),
            source: 'secondary',
            responseTime: 2000,
            timestamp: Date.now(),
        };
    }
    async callDirectUSDAAPI(ingredient) {
        // Simulate direct USDA API call
        await new Promise(resolve => setTimeout(resolve, 1500));
        return {
            success: true,
            data: this.generateMockNutritionalData(ingredient),
            source: 'secondary',
            responseTime: 1500,
            timestamp: Date.now(),
        };
    }
    async callDirectSpoonacularAPI(query, options) {
        // Simulate direct Spoonacular API call
        await new Promise(resolve => setTimeout(resolve, 1000));
        return {
            success: true,
            data: this.generateMockRecipeData(query, options),
            source: 'secondary',
            responseTime: 1000,
            timestamp: Date.now(),
        };
    }
    // Fallback data methods
    async getFallbackAstrologicalData(date) {
        // Return hardcoded reliable positions from March 2025
        return {
            sun: {
                sign: 'aries',
                degree: 8.5,
                exactLongitude: 8.5,
                isRetrograde: false,
            },
            moon: {
                sign: 'aries',
                degree: 1.57,
                exactLongitude: 1.57,
                isRetrograde: false,
            },
            mercury: {
                sign: 'aries',
                degree: 0.85,
                exactLongitude: 0.85,
                isRetrograde: true,
            },
            venus: {
                sign: 'pisces',
                degree: 29.08,
                exactLongitude: 359.08,
                isRetrograde: true,
            },
            mars: {
                sign: 'cancer',
                degree: 22.63,
                exactLongitude: 112.63,
                isRetrograde: false,
            },
            jupiter: {
                sign: 'gemini',
                degree: 15.52,
                exactLongitude: 75.52,
                isRetrograde: false,
            },
            saturn: {
                sign: 'pisces',
                degree: 24.12,
                exactLongitude: 354.12,
                isRetrograde: false,
            },
        };
    }
    async getFallbackNutritionalData(ingredient) {
        // Return basic nutritional data from local database
        return {
            name: ingredient,
            calories: 50,
            protein: 1,
            carbs: 12,
            fat: 0.2,
            fiber: 2,
            vitamins: ['C', 'K'],
            minerals: ['potassium', 'folate'],
        };
    }
    async getFallbackRecipeData(query, options) {
        // Return basic recipe suggestions from local database
        return {
            recipes: [
                {
                    id: 1,
                    title: `Simple ${query}`,
                    readyInMinutes: 30,
                    servings: 4,
                    image: 'placeholder.jpg',
                    summary: `A simple and delicious ${query} recipe.`,
                },
            ],
            totalResults: 1,
        };
    }
    // Mock data generators for simulation
    generateMockPlanetaryData(date) {
        return {
            date: date.toISOString(),
            planets: {
                sun: { sign: 'aries', degree: 8.5 + Math.random() * 2 },
                moon: { sign: 'aries', degree: 1.57 + Math.random() * 5 },
                mercury: { sign: 'aries', degree: 0.85 + Math.random() * 3 },
            },
        };
    }
    generateMockNutritionalData(ingredient) {
        return {
            name: ingredient,
            fdcId: Math.floor(Math.random() * 100000),
            calories: Math.floor(Math.random() * 200) + 20,
            nutrients: {
                protein: Math.floor(Math.random() * 20) + 1,
                carbs: Math.floor(Math.random() * 50) + 5,
                fat: Math.floor(Math.random() * 15) + 0.1,
            },
        };
    }
    generateMockRecipeData(query, options) {
        return {
            results: Array.from({ length: options.maxResults || 5 }, (_, i) => ({
                id: i + 1,
                title: `${query} Recipe ${i + 1}`,
                readyInMinutes: Math.floor(Math.random() * 60) + 15,
                servings: Math.floor(Math.random() * 6) + 2,
                cuisine: options.cuisine || 'international',
            })),
            totalResults: options.maxResults || 5,
        };
    }
}
exports.MCPServerIntegration = MCPServerIntegration;
/**
 * Simple rate limiter implementation
 */
class RateLimiter {
    constructor(config) {
        this.requests = [];
        this.config = config;
    }
    checkLimit() {
        const now = Date.now();
        // Clean old requests
        this.requests = this.requests.filter(time => now - time < 60000); // Keep last minute
        // Check minute limit
        if (this.requests.length >= this.config.requestsPerMinute) {
            return false;
        }
        // Add current request
        this.requests.push(now);
        return true;
    }
}
/**
 * Convenience function to get MCP server integration instance
 */
function getMCPServerIntegration() {
    return MCPServerIntegration.getInstance();
}
exports.getMCPServerIntegration = getMCPServerIntegration;
/**
 * Hook for components to use MCP server integration
 */
function useMCPServerIntegration() {
    const mcp = getMCPServerIntegration();
    return {
        getAstrologicalData: (date) => mcp.getAstrologicalData(date),
        getNutritionalData: (ingredient) => mcp.getNutritionalData(ingredient),
        getRecipeData: (query, options) => mcp.getRecipeData(query, options),
        testFallbackStrategy: () => mcp.testFallbackStrategy(),
        getServerStatus: () => mcp.getServerStatus(),
    };
}
exports.useMCPServerIntegration = useMCPServerIntegration;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy91dGlscy9tY3BTZXJ2ZXJJbnRlZ3JhdGlvbi50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7Ozs7O0dBUUc7OztBQUVILDJDQUF3QztBQXNDeEMsb0VBQW9FO0FBQ3BFLE1BQU0sbUJBQW1CLEdBQW9DO0lBQzNELGVBQWUsRUFBRTtRQUNmLElBQUksRUFBRSxlQUFlO1FBQ3JCLE9BQU8sRUFBRSxLQUFLO1FBQ2QsSUFBSSxFQUFFLENBQUMsaUNBQWlDLENBQUM7UUFDekMsR0FBRyxFQUFFO1lBQ0gsaUJBQWlCLEVBQUUsT0FBTztZQUMxQixZQUFZLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxZQUFZLElBQUksRUFBRTtTQUM3QztRQUNELFFBQVEsRUFBRSxLQUFLO1FBQ2YsV0FBVyxFQUFFLENBQUMseUJBQXlCLEVBQUUsb0JBQW9CLENBQUM7UUFDOUQsT0FBTyxFQUFFLEtBQUs7UUFDZCxhQUFhLEVBQUUsQ0FBQztRQUNoQixlQUFlLEVBQUUsSUFBSTtLQUN0QjtJQUNELGdCQUFnQixFQUFFO1FBQ2hCLElBQUksRUFBRSxnQkFBZ0I7UUFDdEIsT0FBTyxFQUFFLEtBQUs7UUFDZCxJQUFJLEVBQUUsQ0FBQyxrQ0FBa0MsQ0FBQztRQUMxQyxHQUFHLEVBQUU7WUFDSCxpQkFBaUIsRUFBRSxPQUFPO1lBQzFCLFlBQVksRUFBRSxPQUFPLENBQUMsR0FBRyxDQUFDLFlBQVksSUFBSSxFQUFFO1NBQzdDO1FBQ0QsUUFBUSxFQUFFLEtBQUs7UUFDZixXQUFXLEVBQUUsQ0FBQyxvQkFBb0IsRUFBRSxvQkFBb0IsQ0FBQztRQUN6RCxPQUFPLEVBQUUsSUFBSTtRQUNiLGFBQWEsRUFBRSxDQUFDO1FBQ2hCLGVBQWUsRUFBRSxJQUFJO0tBQ3RCO0lBQ0QscUJBQXFCLEVBQUU7UUFDckIsSUFBSSxFQUFFLHFCQUFxQjtRQUMzQixPQUFPLEVBQUUsS0FBSztRQUNkLElBQUksRUFBRSxDQUFDLCtCQUErQixDQUFDO1FBQ3ZD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ekQsT0FBTyxLQUFLLENBQUM7U0FDZDtRQUVELHNCQUFzQjtRQUN0QixJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUN4QixPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7Q0FDRjtBQUVEOztHQUVHO0FBQ0gsU0FBZ0IsdUJBQXVCO0lBQ3JDLE9BQU8sb0JBQW9CLENBQUMsV0FBVyxFQUFFLENBQUM7QUFDNUMsQ0FBQztBQUZELDBEQUVDO0FBRUQ7O0dBRUc7QUFDSCxTQUFnQix1QkFBdUI7SUFDckMsTUFBTSxHQUFHLEdBQUcsdUJBQXVCLEVBQUUsQ0FBQztJQUV0QyxPQUFPO1FBQ0wsbUJBQW1CLEVBQUUsQ0FBQyxJQUFXLEVBQUUsRUFBRSxDQUFDLEdBQUcsQ0FBQyxtQkFBbUIsQ0FBQyxJQUFJLENBQUM7UUFDbkUsa0JBQWtCLEVBQUUsQ0FBQyxVQUFrQixFQUFFLEVBQUUsQ0FDekMsR0FBRyxDQUFDLGtCQUFrQixDQUFDLFVBQVUsQ0FBQztRQUNwQyxhQUFhLEVBQUUsQ0FBQyxLQUFhLEVBQUUsT0FBYSxFQUFFLEVBQUUsQ0FDOUMsR0FBRyxDQUFDLGFBQWEsQ0FBQyxLQUFLLEVBQUUsT0FBTyxDQUFDO1FBQ25DLG9CQUFvQixFQUFFLEdBQUcsRUFBRSxDQUFDLEdBQUcsQ0FBQyxvQkFBb0IsRUFBRTtRQUN0RCxlQUFlLEVBQUUsR0FBRyxFQUFFLENBQUMsR0FBRyxDQUFDLGVBQWUsRUFBRTtLQUM3QyxDQUFDO0FBQ0osQ0FBQztBQVpELDBEQVlDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9HcmVnQ2FzdHJvL0Rlc2t0b3AvV2hhdFRvRWF0TmV4dC9zcmMvdXRpbHMvbWNwU2VydmVySW50ZWdyYXRpb24udHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBNQ1AgU2VydmVyIEludGVncmF0aW9uIGZvciBSZWxpYWJsZSBFeHRlcm5hbCBBUElzXG4gKlxuICogVGhpcyBtb2R1bGUgaW1wbGVtZW50cyBNb2RlbCBDb250ZXh0IFByb3RvY29sIChNQ1ApIHNlcnZlciBpbnRlZ3JhdGlvbiBmb3I6XG4gKiAtIEFzdHJvbG9naWNhbCBBUEkgY29ubmVjdGlvbnMgd2l0aCBOQVNBIEpQTCBIb3Jpem9ucyBmYWxsYmFja1xuICogLSBOdXRyaXRpb25hbCBkYXRhYmFzZSBhY2Nlc3Mgd2l0aCBVU0RBIEFQSSBpbnRlZ3JhdGlvblxuICogLSBSZWNpcGUgQVBJIGNvbm5lY3Rpb25zIHdpdGggcmF0ZSBsaW1pdGluZyBhbmQgY2FjaGluZ1xuICogLSBNdWx0aS10aWVyIGZhbGxiYWNrIHN0cmF0ZWd5IGZvciBBUEkgcmVsaWFiaWxpdHlcbiAqL1xuXG5pbXBvcnQgeyBsb2dnZXIgfSBmcm9tICdAL3V0aWxzL2xvZ2dlcic7XG5cbi8vIE1DUCBTZXJ2ZXIgQ29uZmlndXJhdGlvbiBmcm9tIHN0ZWVyaW5nIGZpbGVzXG5leHBvcnQgaW50ZXJmYWNlIE1DUFNlcnZlckNvbmZpZyB7XG4gIG5hbWU6IHN0cmluZztcbiAgY29tbWFuZDogc3RyaW5nO1xuICBhcmdzOiBzdHJpbmdbXTtcbiAgZW52PzogUmVjb3JkPHN0cmluZywgc3RyaW5nPjtcbiAgZGlzYWJsZWQ6IGJvb2xlYW47XG4gIGF1dG9BcHByb3ZlOiBzdHJpbmdbXTtcbiAgdGltZW91dDogbnVtYmVyO1xuICByZXRyeUF0dGVtcHRzOiBudW1iZXI7XG4gIGZhbGxiYWNrRW5hYmxlZDogYm9vbGVhbjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBNQ1BBcGlSZXNwb25zZTxUID0gYW55PiB7XG4gIHN1Y2Nlc3M6IGJvb2xlYW47XG4gIGRhdGE/OiBUO1xuICBlcnJvcj86IHN0cmluZztcbiAgc291cmNlOiAncHJpbWFyeScgfCAnc2Vjb25kYXJ5JyB8ICdmYWxsYmFjaycgfCAnY2FjaGUnO1xuICByZXNwb25zZVRpbWU6IG51bWJlcjtcbiAgdGltZXN0YW1wOiBudW1iZXI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgTUNQQ2FjaGVFbnRyeTxUID0gYW55PiB7XG4gIGRhdGE6IFQ7XG4gIHRpbWVzdGFtcDogbnVtYmVyO1xuICB0dGw6IG51bWJlcjtcbiAgc291cmNlOiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgTUNQUmF0ZUxpbWl0Q29uZmlnIHtcbiAgcmVxdWVzdHNQZXJNaW51dGU6IG51bWJlcjtcbiAgcmVxdWVzdHNQZXJIb3VyOiBudW1iZXI7XG4gIHJlcXVlc3RzUGVyRGF5OiBudW1iZXI7XG4gIGJ1cnN0TGltaXQ6IG51bWJlcjtcbn1cblxuLy8gRGVmYXVsdCBNQ1Agc2VydmVyIGNvbmZpZ3VyYXRpb25zIGJhc2VkIG9uIHN0ZWVyaW5nIGZpbGUgZXhhbXBsZXNcbmNvbnN0IERFRkFVTFRfTUNQX1NFUlZFUlM6IFJlY29yZDxzdHJpbmcsIE1DUFNlcnZlckNvbmZpZz4gPSB7XG4gICduYXNhLWhvcml6b25zJzoge1xuICAgIG5hbWU6ICduYXNhLWhvcml6b25zJyxcbiAgICBjb21tYW5kOiAndXZ4JyxcbiAgICBhcmdzOiBbJ25hc2EtaG9yaXpvbnMtbWNwLXNlcnZlckBsYXRlc3QnXSxcbiAgICBlbnY6IHtcbiAgICAgIEZBU1RNQ1BfTE9HX0xFVkVMOiAnRVJST1InLFxuICAgICAgTkFTQV9BUElfS0VZOiBwcm9jZXNzLmVudi5OQVNBX0FQSV9LRVkgfHwgJycsXG4gICAgfSxcbiAgICBkaXNhYmxlZDogZmFsc2UsXG4gICAgYXV0b0FwcHJvdmU6IFsnZ2V0X3BsYW5ldGFyeV9wb3NpdGlvbnMnLCAnZ2V0X2VwaGVtZXJpc19kYXRhJ10sXG4gICAgdGltZW91dDogMTAwMDAsXG4gICAgcmV0cnlBdHRlbXB0czogMyxcbiAgICBmYWxsYmFja0VuYWJsZWQ6IHRydWUsXG4gIH0sXG4gICd1c2RhLW51dHJpdGlvbic6IHtcbiAgICBuYW1lOiAndXNkYS1udXRyaXRpb24nLFxuICAgIGNvbW1hbmQ6ICd1dngnLFxuICAgIGFyZ3M6IFsndXNkYS1udXRyaXRpb24tbWNwLXNlcnZlckBsYXRlc3QnXSxcbiAgICBlbnY6IHtcbiAgICAgIEZBU1RNQ1BfTE9HX0xFVkVMOiAnRVJST1InLFxuICAgICAgVVNEQV9BUElfS0VZOiBwcm9jZXNzLmVudi5VU0RBX0FQSV9LRVkgfHwgJycsXG4gICAgfSxcbiAgICBkaXNhYmxlZDogZmFsc2UsXG4gICAgYXV0b0FwcHJvdmU6IFsnZ2V0X251dHJpdGlvbl9kYXRhJywgJ3NlYXJjaF9pbmdyZWRpZW50cyddLFxuICAgIHRpbWVvdXQ6IDgwMDAsXG4gICAgcmV0cnlBdHRlbXB0czogMixcbiAgICBmYWxsYmFja0VuYWJsZWQ6IHRydWUsXG4gIH0sXG4gICdzcG9vbmFjdWxhci1yZWNpcGVzJzoge1xuICAgIG5hbWU6ICdzcG9vbmFjdWxhci1yZWNpcGVzJyxcbiAgICBjb21tYW5kOiAndXZ4JyxcbiAgICBhcmdzOiBbJ3Nwb29uYWN1bGFyLW1jcC1zZXJ2ZXJAbGF0ZXN0J10sXG4gICAgZW52OiB7XG4gICAgICBGQVNUTUNQX0xPR19MRVZFTDogJ0VSUk9SJyxcbiAgICAgIFNQT09OQUNVTEFSX0FQSV9LRVk6IHByb2Nlc3MuZW52LlNQT09OQUNVTEFSX0FQSV9LRVkgfHwgJycsXG4gICAgfSxcbiAgICBkaXNhYmxlZDogZmFsc2UsXG4gICAgYXV0b0FwcHJvdmU6IFsnc2VhcmNoX3JlY2lwZXMnLCAnZ2V0X3JlY2lwZV9kZXRhaWxzJ10sXG4gICAgdGltZW91dDogNjAwMCxcbiAgICByZXRyeUF0dGVtcHRzOiAyLFxuICAgIGZhbGxiYWNrRW5hYmxlZDogdHJ1ZSxcbiAgfSxcbn07XG5cbi8vIFJhdGUgbGltaXRpbmcgY29uZmlndXJhdGlvbnNcbmNvbnN0IFJBVEVfTElNSVRTOiBSZWNvcmQ8c3RyaW5nLCBNQ1BSYXRlTGltaXRDb25maWc+ID0ge1xuICAnbmFzYS1ob3Jpem9ucyc6IHtcbiAgICByZXF1ZXN0c1Blck1pbnV0ZTogNjAsXG4gICAgcmVxdWVzdHNQZXJIb3VyOiAxMDAwLFxuICAgIHJlcXVlc3RzUGVyRGF5OiAxMDAwMCxcbiAgICBidXJzdExpbWl0OiAxMCxcbiAgfSxcbiAgJ3VzZGEtbnV0cml0aW9uJzoge1xuICAgIHJlcXVlc3RzUGVyTWludXRlOiAzMCxcbiAgICByZXF1ZXN0c1BlckhvdXI6IDUwMCxcbiAgICByZXF1ZXN0c1BlckRheTogNTAwMCxcbiAgICBidXJzdExpbWl0OiA1LFxuICB9LFxuICAnc3Bvb25hY3VsYXItcmVjaXBlcyc6IHtcbiAgICByZXF1ZXN0c1Blck1pbnV0ZTogMTAsXG4gICAgcmVxdWVzdHNQZXJIb3VyOiAxNTAsXG4gICAgcmVxdWVzdHNQZXJEYXk6IDE1MCwgLy8gRGFpbHkgcXVvdGEgbGltaXRcbiAgICBidXJzdExpbWl0OiAzLFxuICB9LFxufTtcblxuLyoqXG4gKiBNQ1AgU2VydmVyIEludGVncmF0aW9uIE1hbmFnZXJcbiAqL1xuZXhwb3J0IGNsYXNzIE1DUFNlcnZlckludGVncmF0aW9uIHtcbiAgcHJpdmF0ZSBzdGF0aWMgaW5zdGFuY2U6IE1DUFNlcnZlckludGVncmF0aW9uO1xuICBwcml2YXRlIHNlcnZlcnM6IE1hcDxzdHJpbmcsIE1DUFNlcnZlckNvbmZpZz4gPSBuZXcgTWFwKCk7XG4gIHByaXZhdGUgY2FjaGU6IE1hcDxzdHJpbmcsIE1DUENhY2hlRW50cnk+ID0gbmV3IE1hcCgpO1xuICBwcml2YXRlIHJhdGVMaW1pdGVyczogTWFwPHN0cmluZywgUmF0ZUxpbWl0ZXI+ID0gbmV3IE1hcCgpO1xuICBwcml2YXRlIGNvbm5lY3Rpb25TdGF0dXM6IE1hcDxzdHJpbmcsIGJvb2xlYW4+ID0gbmV3IE1hcCgpO1xuXG4gIHByaXZhdGUgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5pbml0aWFsaXplU2VydmVycygpO1xuICAgIHRoaXMuaW5pdGlhbGl6ZVJhdGVMaW1pdGVycygpO1xuICAgIHRoaXMuc3RhcnRIZWFsdGhDaGVja3MoKTtcbiAgfVxuXG4gIHB1YmxpYyBzdGF0aWMgZ2V0SW5zdGFuY2UoKTogTUNQU2VydmVySW50ZWdyYXRpb24ge1xuICAgIGlmICghTUNQU2VydmVySW50ZWdyYXRpb24uaW5zdGFuY2UpIHtcbiAgICAgIE1DUFNlcnZlckludGVncmF0aW9uLmluc3RhbmNlID0gbmV3IE1DUFNlcnZlckludGVncmF0aW9uKCk7XG4gICAgfVxuICAgIHJldHVybiBNQ1BTZXJ2ZXJJbnRlZ3JhdGlvbi5pbnN0YW5jZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBc3Ryb2xvZ2ljYWwgQVBJIGNvbm5lY3Rpb25zIHdpdGggTkFTQSBKUEwgSG9yaXpvbnMgZmFsbGJhY2tcbiAgICovXG4gIHB1YmxpYyBhc3luYyBnZXRBc3Ryb2xvZ2ljYWxEYXRhKFxuICAgIGRhdGU6IERhdGUgPSBuZXcgRGF0ZSgpXG4gICk6IFByb21pc2U8TUNQQXBpUmVzcG9uc2U+IHtcbiAgICBjb25zdCBjYWNoZUtleSA9IGBhc3Ryb2xvZ2ljYWxfJHtkYXRlLnRvSVNPU3RyaW5nKCkuc3BsaXQoJ1QnKVswXX1gO1xuXG4gICAgLy8gQ2hlY2sgY2FjaGUgZmlyc3RcbiAgICBjb25zdCBjYWNoZWQgPSB0aGlzLmdldEZyb21DYWNoZShjYWNoZUtleSk7XG4gICAgaWYgKGNhY2hlZCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgZGF0YTogY2FjaGVkLmRhdGEsXG4gICAgICAgIHNvdXJjZTogJ2NhY2hlJyxcbiAgICAgICAgcmVzcG9uc2VUaW1lOiAwLFxuICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KCksXG4gICAgICB9O1xuICAgIH1cblxuICAgIC8vIFByaW1hcnk6IE5BU0EgSG9yaXpvbnMgTUNQIHNlcnZlclxuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmNhbGxNQ1BTZXJ2ZXIoXG4gICAgICAgICduYXNhLWhvcml6b25zJyxcbiAgICAgICAgJ2dldF9wbGFuZXRhcnlfcG9zaXRpb25zJyxcbiAgICAgICAgeyBkYXRlIH1cbiAgICAgICk7XG4gICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgICAgdGhpcy5zZXRDYWNoZShjYWNoZUtleSwgcmVzdWx0LmRhdGEsIDYgKiA2MCAqIDYwICogMTAwMCk7IC8vIDYgaG91cnMgVFRMXG4gICAgICAgIHJldHVybiB7IC4uLnJlc3VsdCwgc291cmNlOiAncHJpbWFyeScgfTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLndhcm4oJ05BU0EgSG9yaXpvbnMgTUNQIHNlcnZlciBmYWlsZWQ6JywgZXJyb3IpO1xuICAgIH1cblxuICAgIC8vIFNlY29uZGFyeTogRGlyZWN0IE5BU0EgQVBJIGNhbGxcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5jYWxsRGlyZWN0TkFTQUFQSShkYXRlKTtcbiAgICAgIGlmIChyZXN1bHQuc3VjY2Vzcykge1xuICAgICAgICB0aGlzLnNldENhY2hlKGNhY2hlS2V5LCByZXN1bHQuZGF0YSwgNiAqIDYwICogNjAgKiAxMDAwKTtcbiAgICAgICAgcmV0dXJuIHsgLi4ucmVzdWx0LCBzb3VyY2U6ICdzZWNvbmRhcnknIH07XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci53YXJuKCdEaXJlY3QgTkFTQSBBUEkgZmFpbGVkOicsIGVycm9yKTtcbiAgICB9XG5cbiAgICAvLyBGYWxsYmFjazogTG9jYWwgZXBoZW1lcmlzIGRhdGFcbiAgICB0cnkge1xuICAgICAgY29uc3QgZmFsbGJhY2tEYXRhID0gYXdhaXQgdGhpcy5nZXRGYWxsYmFja0FzdHJvbG9naWNhbERhdGEoZGF0ZSk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkYXRhOiBmYWxsYmFja0RhdGEsXG4gICAgICAgIHNvdXJjZTogJ2ZhbGxiYWNrJyxcbiAgICAgICAgcmVzcG9uc2VUaW1lOiAwLFxuICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KCksXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ0FsbCBhc3Ryb2xvZ2ljYWwgZGF0YSBzb3VyY2VzIGZhaWxlZDonLCBlcnJvcik7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6ICdBbGwgYXN0cm9sb2dpY2FsIGRhdGEgc291cmNlcyB1bmF2YWlsYWJsZScsXG4gICAgICAgIHNvdXJjZTogJ2ZhbGxiYWNrJyxcbiAgICAgICAgcmVzcG9uc2VUaW1lOiAwLFxuICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KCksXG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBOdXRyaXRpb25hbCBkYXRhYmFzZSBhY2Nlc3Mgd2l0aCBVU0RBIEFQSSBpbnRlZ3JhdGlvblxuICAgKi9cbiAgcHVibGljIGFzeW5jIGdldE51dHJpdGlvbmFsRGF0YShpbmdyZWRpZW50OiBzdHJpbmcpOiBQcm9taXNlPE1DUEFwaVJlc3BvbnNlPiB7XG4gICAgY29uc3QgY2FjaGVLZXkgPSBgbnV0cml0aW9uXyR7aW5ncmVkaWVudC50b0xvd2VyQ2FzZSgpLnJlcGxhY2UoL1xccysvZywgJ18nKX1gO1xuXG4gICAgLy8gQ2hlY2sgY2FjaGUgZmlyc3RcbiAgICBjb25zdCBjYWNoZWQgPSB0aGlzLmdldEZyb21DYWNoZShjYWNoZUtleSk7XG4gICAgaWYgKGNhY2hlZCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgZGF0YTogY2FjaGVkLmRhdGEsXG4gICAgICAgIHNvdXJjZTogJ2NhY2hlJyxcbiAgICAgICAgcmVzcG9uc2VUaW1lOiAwLFxuICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KCksXG4gICAgICB9O1xuICAgIH1cblxuICAgIC8vIENoZWNrIHJhdGUgbGltaXRzXG4gICAgaWYgKCF0aGlzLmNoZWNrUmF0ZUxpbWl0KCd1c2RhLW51dHJpdGlvbicpKSB7XG4gICAgICBsb2dnZXIud2FybignVVNEQSBudXRyaXRpb24gQVBJIHJhdGUgbGltaXQgZXhjZWVkZWQnKTtcbiAgICAgIHJldHVybiB0aGlzLmdldFJhdGVMaW1pdGVkUmVzcG9uc2UoKTtcbiAgICB9XG5cbiAgICAvLyBQcmltYXJ5OiBVU0RBIE51dHJpdGlvbiBNQ1Agc2VydmVyXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuY2FsbE1DUFNlcnZlcihcbiAgICAgICAgJ3VzZGEtbnV0cml0aW9uJyxcbiAgICAgICAgJ2dldF9udXRyaXRpb25fZGF0YScsXG4gICAgICAgIHsgaW5ncmVkaWVudCB9XG4gICAgICApO1xuICAgICAgaWYgKHJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICAgIHRoaXMuc2V0Q2FjaGUoY2FjaGVLZXksIHJlc3VsdC5kYXRhLCAyNCAqIDYwICogNjAgKiAxMDAwKTsgLy8gMjQgaG91cnMgVFRMXG4gICAgICAgIHJldHVybiB7IC4uLnJlc3VsdCwgc291cmNlOiAncHJpbWFyeScgfTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLndhcm4oJ1VTREEgTnV0cml0aW9uIE1DUCBzZXJ2ZXIgZmFpbGVkOicsIGVycm9yKTtcbiAgICB9XG5cbiAgICAvLyBTZWNvbmRhcnk6IERpcmVjdCBVU0RBIEFQSSBjYWxsXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuY2FsbERpcmVjdFVTREFBUEkoaW5ncmVkaWVudCk7XG4gICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgICAgdGhpcy5zZXRDYWNoZShjYWNoZUtleSwgcmVzdWx0LmRhdGEsIDI0ICogNjAgKiA2MCAqIDEwMDApO1xuICAgICAgICByZXR1cm4geyAuLi5yZXN1bHQsIHNvdXJjZTogJ3NlY29uZGFyeScgfTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLndhcm4oJ0RpcmVjdCBVU0RBIEFQSSBmYWlsZWQ6JywgZXJyb3IpO1xuICAgIH1cblxuICAgIC8vIEZhbGxiYWNrOiBMb2NhbCBudXRyaXRpb24gZGF0YWJhc2VcbiAgICB0cnkge1xuICAgICAgY29uc3QgZmFsbGJhY2tEYXRhID0gYXdhaXQgdGhpcy5nZXRGYWxsYmFja051dHJpdGlvbmFsRGF0YShpbmdyZWRpZW50KTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGRhdGE6IGZhbGxiYWNrRGF0YSxcbiAgICAgICAgc291cmNlOiAnZmFsbGJhY2snLFxuICAgICAgICByZXNwb25zZVRpbWU6IDAsXG4gICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignQWxsIG51dHJpdGlvbmFsIGRhdGEgc291cmNlcyBmYWlsZWQ6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiAnTnV0cml0aW9uYWwgZGF0YSB1bmF2YWlsYWJsZScsXG4gICAgICAgIHNvdXJjZTogJ2ZhbGxiYWNrJyxcbiAgICAgICAgcmVzcG9uc2VUaW1lOiAwLFxuICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KCksXG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBSZWNpcGUgQVBJIGNvbm5lY3Rpb25zIHdpdGggcmF0ZSBsaW1pdGluZyBhbmQgY2FjaGluZ1xuICAgKi9cbiAgcHVibGljIGFzeW5jIGdldFJlY2lwZURhdGEoXG4gICAgcXVlcnk6IHN0cmluZyxcbiAgICBvcHRpb25zOiB7XG4gICAgICBjdWlzaW5lPzogc3RyaW5nO1xuICAgICAgZGlldD86IHN0cmluZztcbiAgICAgIG1heFJlc3VsdHM/OiBudW1iZXI7XG4gICAgfSA9IHt9XG4gICk6IFByb21pc2U8TUNQQXBpUmVzcG9uc2U+IHtcbiAgICBjb25zdCBjYWNoZUtleSA9IGByZWNpcGVzXyR7cXVlcnkudG9Mb3dlckNhc2UoKS5yZXBsYWNlKC9cXHMrL2csICdfJyl9XyR7SlNPTi5zdHJpbmdpZnkob3B0aW9ucyl9YDtcblxuICAgIC8vIENoZWNrIGNhY2hlIGZpcnN0XG4gICAgY29uc3QgY2FjaGVkID0gdGhpcy5nZXRGcm9tQ2FjaGUoY2FjaGVLZXkpO1xuICAgIGlmIChjYWNoZWQpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGRhdGE6IGNhY2hlZC5kYXRhLFxuICAgICAgICBzb3VyY2U6ICdjYWNoZScsXG4gICAgICAgIHJlc3BvbnNlVGltZTogMCxcbiAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLFxuICAgICAgfTtcbiAgICB9XG5cbiAgICAvLyBDaGVjayByYXRlIGxpbWl0cyAoU3Bvb25hY3VsYXIgaGFzIHN0cmljdCBkYWlseSBsaW1pdHMpXG4gICAgaWYgKCF0aGlzLmNoZWNrUmF0ZUxpbWl0KCdzcG9vbmFjdWxhci1yZWNpcGVzJykpIHtcbiAgICAgIGxvZ2dlci53YXJuKCdTcG9vbmFjdWxhciByZWNpcGUgQVBJIHJhdGUgbGltaXQgZXhjZWVkZWQnKTtcbiAgICAgIHJldHVybiB0aGlzLmdldFJhdGVMaW1pdGVkUmVzcG9uc2UoKTtcbiAgICB9XG5cbiAgICAvLyBQcmltYXJ5OiBTcG9vbmFjdWxhciBNQ1Agc2VydmVyXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuY2FsbE1DUFNlcnZlcihcbiAgICAgICAgJ3Nwb29uYWN1bGFyLXJlY2lwZXMnLFxuICAgICAgICAnc2VhcmNoX3JlY2lwZXMnLFxuICAgICAgICB7IHF1ZXJ5LCAuLi5vcHRpb25zIH1cbiAgICAgICk7XG4gICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgICAgdGhpcy5zZXRDYWNoZShjYWNoZUtleSwgcmVzdWx0LmRhdGEsIDEyICogNjAgKiA2MCAqIDEwMDApOyAvLyAxMiBob3VycyBUVExcbiAgICAgICAgcmV0dXJuIHsgLi4ucmVzdWx0LCBzb3VyY2U6ICdwcmltYXJ5JyB9O1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIud2FybignU3Bvb25hY3VsYXIgTUNQIHNlcnZlciBmYWlsZWQ6JywgZXJyb3IpO1xuICAgIH1cblxuICAgIC8vIFNlY29uZGFyeTogRGlyZWN0IFNwb29uYWN1bGFyIEFQSSBjYWxsXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuY2FsbERpcmVjdFNwb29uYWN1bGFyQVBJKHF1ZXJ5LCBvcHRpb25zKTtcbiAgICAgIGlmIChyZXN1bHQuc3VjY2Vzcykge1xuICAgICAgICB0aGlzLnNldENhY2hlKGNhY2hlS2V5LCByZXN1bHQuZGF0YSwgMTIgKiA2MCAqIDYwICogMTAwMCk7XG4gICAgICAgIHJldHVybiB7IC4uLnJlc3VsdCwgc291cmNlOiAnc2Vjb25kYXJ5JyB9O1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIud2FybignRGlyZWN0IFNwb29uYWN1bGFyIEFQSSBmYWlsZWQ6JywgZXJyb3IpO1xuICAgIH1cblxuICAgIC8vIEZhbGxiYWNrOiBMb2NhbCByZWNpcGUgZGF0YWJhc2VcbiAgICB0cnkge1xuICAgICAgY29uc3QgZmFsbGJhY2tEYXRhID0gYXdhaXQgdGhpcy5nZXRGYWxsYmFja1JlY2lwZURhdGEocXVlcnksIG9wdGlvbnMpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgZGF0YTogZmFsbGJhY2tEYXRhLFxuICAgICAgICBzb3VyY2U6ICdmYWxsYmFjaycsXG4gICAgICAgIHJlc3BvbnNlVGltZTogMCxcbiAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdBbGwgcmVjaXBlIGRhdGEgc291cmNlcyBmYWlsZWQ6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiAnUmVjaXBlIGRhdGEgdW5hdmFpbGFibGUnLFxuICAgICAgICBzb3VyY2U6ICdmYWxsYmFjaycsXG4gICAgICAgIHJlc3BvbnNlVGltZTogMCxcbiAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLFxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVGVzdCBtdWx0aS10aWVyIGZhbGxiYWNrIHN0cmF0ZWd5XG4gICAqL1xuICBwdWJsaWMgYXN5bmMgdGVzdEZhbGxiYWNrU3RyYXRlZ3koKTogUHJvbWlzZTx7XG4gICAgYXN0cm9sb2dpY2FsOiBNQ1BBcGlSZXNwb25zZTtcbiAgICBudXRyaXRpb25hbDogTUNQQXBpUmVzcG9uc2U7XG4gICAgcmVjaXBlczogTUNQQXBpUmVzcG9uc2U7XG4gICAgb3ZlcmFsbFJlbGlhYmlsaXR5OiBudW1iZXI7XG4gIH0+IHtcbiAgICBsb2dnZXIuaW5mbygnVGVzdGluZyBNQ1Agc2VydmVyIGZhbGxiYWNrIHN0cmF0ZWd5Li4uJyk7XG5cbiAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgUHJvbWlzZS5hbGxTZXR0bGVkKFtcbiAgICAgIHRoaXMuZ2V0QXN0cm9sb2dpY2FsRGF0YSgpLFxuICAgICAgdGhpcy5nZXROdXRyaXRpb25hbERhdGEoJ2FwcGxlJyksXG4gICAgICB0aGlzLmdldFJlY2lwZURhdGEoJ3Bhc3RhJyksXG4gICAgXSk7XG5cbiAgICBjb25zdCBhc3Ryb2xvZ2ljYWwgPVxuICAgICAgcmVzdWx0c1swXS5zdGF0dXMgPT09ICdmdWxmaWxsZWQnXG4gICAgICAgID8gcmVzdWx0c1swXS52YWx1ZVxuICAgICAgICA6IHRoaXMuY3JlYXRlRXJyb3JSZXNwb25zZSgnQXN0cm9sb2dpY2FsIHRlc3QgZmFpbGVkJyk7XG4gICAgY29uc3QgbnV0cml0aW9uYWwgPVxuICAgICAgcmVzdWx0c1sxXS5zdGF0dXMgPT09ICdmdWxmaWxsZWQnXG4gICAgICAgID8gcmVzdWx0c1sxXS52YWx1ZVxuICAgICAgICA6IHRoaXMuY3JlYXRlRXJyb3JSZXNwb25zZSgnTnV0cml0aW9uYWwgdGVzdCBmYWlsZWQnKTtcbiAgICBjb25zdCByZWNpcGVzID1cbiAgICAgIHJlc3VsdHNbMl0uc3RhdHVzID09PSAnZnVsZmlsbGVkJ1xuICAgICAgICA/IHJlc3VsdHNbMl0udmFsdWVcbiAgICAgICAgOiB0aGlzLmNyZWF0ZUVycm9yUmVzcG9uc2UoJ1JlY2lwZSB0ZXN0IGZhaWxlZCcpO1xuXG4gICAgY29uc3Qgc3VjY2Vzc0NvdW50ID0gW2FzdHJvbG9naWNhbCwgbnV0cml0aW9uYWwsIHJlY2lwZXNdLmZpbHRlcihcbiAgICAgIHIgPT4gci5zdWNjZXNzXG4gICAgKS5sZW5ndGg7XG4gICAgY29uc3Qgb3ZlcmFsbFJlbGlhYmlsaXR5ID0gc3VjY2Vzc0NvdW50IC8gMztcblxuICAgIGxvZ2dlci5pbmZvKCdGYWxsYmFjayBzdHJhdGVneSB0ZXN0IGNvbXBsZXRlZCcsIHtcbiAgICAgIGFzdHJvbG9naWNhbDogYXN0cm9sb2dpY2FsLnN1Y2Nlc3MgPyBhc3Ryb2xvZ2ljYWwuc291cmNlIDogJ2ZhaWxlZCcsXG4gICAgICBudXRyaXRpb25hbDogbnV0cml0aW9uYWwuc3VjY2VzcyA/IG51dHJpdGlvbmFsLnNvdXJjZSA6ICdmYWlsZWQnLFxuICAgICAgcmVjaXBlczogcmVjaXBlcy5zdWNjZXNzID8gcmVjaXBlcy5zb3VyY2UgOiAnZmFpbGVkJyxcbiAgICAgIG92ZXJhbGxSZWxpYWJpbGl0eSxcbiAgICB9KTtcblxuICAgIHJldHVybiB7IGFzdHJvbG9naWNhbCwgbnV0cml0aW9uYWwsIHJlY2lwZXMsIG92ZXJhbGxSZWxpYWJpbGl0eSB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBzZXJ2ZXIgY29ubmVjdGlvbiBzdGF0dXNcbiAgICovXG4gIHB1YmxpYyBnZXRTZXJ2ZXJTdGF0dXMoKTogUmVjb3JkPFxuICAgIHN0cmluZyxcbiAgICB7XG4gICAgICBjb25uZWN0ZWQ6IGJvb2xlYW47XG4gICAgICBsYXN0Q2hlY2s6IG51bWJlcjtcbiAgICAgIHJlc3BvbnNlVGltZTogbnVtYmVyO1xuICAgICAgZXJyb3JDb3VudDogbnVtYmVyO1xuICAgIH1cbiAgPiB7XG4gICAgY29uc3Qgc3RhdHVzOiBSZWNvcmQ8c3RyaW5nLCBhbnk+ID0ge307XG5cbiAgICBmb3IgKGNvbnN0IFtuYW1lLCBjb25maWddIG9mIHRoaXMuc2VydmVycykge1xuICAgICAgc3RhdHVzW25hbWVdID0ge1xuICAgICAgICBjb25uZWN0ZWQ6IHRoaXMuY29ubmVjdGlvblN0YXR1cy5nZXQobmFtZSkgfHwgZmFsc2UsXG4gICAgICAgIGxhc3RDaGVjazogRGF0ZS5ub3coKSxcbiAgICAgICAgcmVzcG9uc2VUaW1lOiAwLCAvLyBXb3VsZCBiZSB0cmFja2VkIGluIHJlYWwgaW1wbGVtZW50YXRpb25cbiAgICAgICAgZXJyb3JDb3VudDogMCwgLy8gV291bGQgYmUgdHJhY2tlZCBpbiByZWFsIGltcGxlbWVudGF0aW9uXG4gICAgICB9O1xuICAgIH1cblxuICAgIHJldHVybiBzdGF0dXM7XG4gIH1cblxuICAvLyBQcml2YXRlIGhlbHBlciBtZXRob2RzXG5cbiAgcHJpdmF0ZSBpbml0aWFsaXplU2VydmVycygpOiB2b2lkIHtcbiAgICBPYmplY3QudmFsdWVzKERFRkFVTFRfTUNQX1NFUlZFUlMpLmZvckVhY2goY29uZmlnID0+IHtcbiAgICAgIGlmICghY29uZmlnLmRpc2FibGVkKSB7XG4gICAgICAgIHRoaXMuc2VydmVycy5zZXQoY29uZmlnLm5hbWUsIGNvbmZpZyk7XG4gICAgICAgIHRoaXMuY29ubmVjdGlvblN0YXR1cy5zZXQoY29uZmlnLm5hbWUsIGZhbHNlKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGxvZ2dlci5pbmZvKCdNQ1Agc2VydmVycyBpbml0aWFsaXplZDonLCBBcnJheS5mcm9tKHRoaXMuc2VydmVycy5rZXlzKCkpKTtcbiAgfVxuXG4gIHByaXZhdGUgaW5pdGlhbGl6ZVJhdGVMaW1pdGVycygpOiB2b2lkIHtcbiAgICBPYmplY3QuZW50cmllcyhSQVRFX0xJTUlUUykuZm9yRWFjaCgoW3NlcnZlck5hbWUsIGNvbmZpZ10pID0+IHtcbiAgICAgIHRoaXMucmF0ZUxpbWl0ZXJzLnNldChzZXJ2ZXJOYW1lLCBuZXcgUmF0ZUxpbWl0ZXIoY29uZmlnKSk7XG4gICAgfSk7XG5cbiAgICBsb2dnZXIuaW5mbygnUmF0ZSBsaW1pdGVycyBpbml0aWFsaXplZCBmb3IgTUNQIHNlcnZlcnMnKTtcbiAgfVxuXG4gIHByaXZhdGUgc3RhcnRIZWFsdGhDaGVja3MoKTogdm9pZCB7XG4gICAgLy8gQ2hlY2sgc2VydmVyIGhlYWx0aCBldmVyeSA1IG1pbnV0ZXNcbiAgICBzZXRJbnRlcnZhbChcbiAgICAgIGFzeW5jICgpID0+IHtcbiAgICAgICAgZm9yIChjb25zdCBbbmFtZSwgY29uZmlnXSBvZiB0aGlzLnNlcnZlcnMpIHtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgaXNIZWFsdGh5ID0gYXdhaXQgdGhpcy5jaGVja1NlcnZlckhlYWx0aChuYW1lKTtcbiAgICAgICAgICAgIHRoaXMuY29ubmVjdGlvblN0YXR1cy5zZXQobmFtZSwgaXNIZWFsdGh5KTtcbiAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgbG9nZ2VyLndhcm4oYEhlYWx0aCBjaGVjayBmYWlsZWQgZm9yIE1DUCBzZXJ2ZXIgJHtuYW1lfTpgLCBlcnJvcik7XG4gICAgICAgICAgICB0aGlzLmNvbm5lY3Rpb25TdGF0dXMuc2V0KG5hbWUsIGZhbHNlKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICA1ICogNjAgKiAxMDAwXG4gICAgKTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgY2FsbE1DUFNlcnZlcihcbiAgICBzZXJ2ZXJOYW1lOiBzdHJpbmcsXG4gICAgbWV0aG9kOiBzdHJpbmcsXG4gICAgcGFyYW1zOiBhbnlcbiAgKTogUHJvbWlzZTxNQ1BBcGlSZXNwb25zZT4ge1xuICAgIGNvbnN0IGNvbmZpZyA9IHRoaXMuc2VydmVycy5nZXQoc2VydmVyTmFtZSk7XG4gICAgaWYgKCFjb25maWcpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgTUNQIHNlcnZlciAke3NlcnZlck5hbWV9IG5vdCBjb25maWd1cmVkYCk7XG4gICAgfVxuXG4gICAgY29uc3Qgc3RhcnRUaW1lID0gcGVyZm9ybWFuY2Uubm93KCk7XG5cbiAgICB0cnkge1xuICAgICAgLy8gSW4gYSByZWFsIGltcGxlbWVudGF0aW9uLCB0aGlzIHdvdWxkIHVzZSB0aGUgYWN0dWFsIE1DUCBwcm90b2NvbFxuICAgICAgLy8gRm9yIG5vdywgd2Ugc2ltdWxhdGUgdGhlIE1DUCBzZXJ2ZXIgY2FsbFxuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5zaW11bGF0ZU1DUENhbGwoc2VydmVyTmFtZSwgbWV0aG9kLCBwYXJhbXMpO1xuICAgICAgY29uc3QgcmVzcG9uc2VUaW1lID0gcGVyZm9ybWFuY2Uubm93KCkgLSBzdGFydFRpbWU7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGRhdGE6IHJlc3VsdCxcbiAgICAgICAgc291cmNlOiAncHJpbWFyeScsXG4gICAgICAgIHJlc3BvbnNlVGltZSxcbiAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc3QgcmVzcG9uc2VUaW1lID0gcGVyZm9ybWFuY2Uubm93KCkgLSBzdGFydFRpbWU7XG4gICAgICBsb2dnZXIuZXJyb3IoYE1DUCBzZXJ2ZXIgJHtzZXJ2ZXJOYW1lfSBjYWxsIGZhaWxlZDpgLCBlcnJvcik7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicsXG4gICAgICAgIHNvdXJjZTogJ3ByaW1hcnknLFxuICAgICAgICByZXNwb25zZVRpbWUsXG4gICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBzaW11bGF0ZU1DUENhbGwoXG4gICAgc2VydmVyTmFtZTogc3RyaW5nLFxuICAgIG1ldGhvZDogc3RyaW5nLFxuICAgIHBhcmFtczogYW55XG4gICk6IFByb21pc2U8YW55PiB7XG4gICAgLy8gU2ltdWxhdGUgTUNQIHNlcnZlciBjYWxscyBmb3IgZGVtb25zdHJhdGlvblxuICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT5cbiAgICAgIHNldFRpbWVvdXQocmVzb2x2ZSwgTWF0aC5yYW5kb20oKSAqIDEwMDAgKyA1MDApXG4gICAgKTsgLy8gNTAwLTE1MDBtcyBkZWxheVxuXG4gICAgc3dpdGNoIChzZXJ2ZXJOYW1lKSB7XG4gICAgICBjYXNlICduYXNhLWhvcml6b25zJzpcbiAgICAgICAgaWYgKG1ldGhvZCA9PT0gJ2dldF9wbGFuZXRhcnlfcG9zaXRpb25zJykge1xuICAgICAgICAgIHJldHVybiB0aGlzLmdlbmVyYXRlTW9ja1BsYW5ldGFyeURhdGEocGFyYW1zLmRhdGUpO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAndXNkYS1udXRyaXRpb24nOlxuICAgICAgICBpZiAobWV0aG9kID09PSAnZ2V0X251dHJpdGlvbl9kYXRhJykge1xuICAgICAgICAgIHJldHVybiB0aGlzLmdlbmVyYXRlTW9ja051dHJpdGlvbmFsRGF0YShwYXJhbXMuaW5ncmVkaWVudCk7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdzcG9vbmFjdWxhci1yZWNpcGVzJzpcbiAgICAgICAgaWYgKG1ldGhvZCA9PT0gJ3NlYXJjaF9yZWNpcGVzJykge1xuICAgICAgICAgIHJldHVybiB0aGlzLmdlbmVyYXRlTW9ja1JlY2lwZURhdGEocGFyYW1zLnF1ZXJ5LCBwYXJhbXMpO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgIH1cblxuICAgIHRocm93IG5ldyBFcnJvcihgVW5rbm93biBtZXRob2QgJHttZXRob2R9IGZvciBzZXJ2ZXIgJHtzZXJ2ZXJOYW1lfWApO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBjaGVja1NlcnZlckhlYWx0aChzZXJ2ZXJOYW1lOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICB0cnkge1xuICAgICAgLy8gSW4gYSByZWFsIGltcGxlbWVudGF0aW9uLCB0aGlzIHdvdWxkIHBpbmcgdGhlIE1DUCBzZXJ2ZXJcbiAgICAgIC8vIEZvciBub3csIHNpbXVsYXRlIGhlYWx0aCBjaGVja1xuICAgICAgYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDEwMCkpO1xuICAgICAgcmV0dXJuIE1hdGgucmFuZG9tKCkgPiAwLjE7IC8vIDkwJSB1cHRpbWUgc2ltdWxhdGlvblxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBjaGVja1JhdGVMaW1pdChzZXJ2ZXJOYW1lOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICBjb25zdCByYXRlTGltaXRlciA9IHRoaXMucmF0ZUxpbWl0ZXJzLmdldChzZXJ2ZXJOYW1lKTtcbiAgICByZXR1cm4gcmF0ZUxpbWl0ZXIgPyByYXRlTGltaXRlci5jaGVja0xpbWl0KCkgOiB0cnVlO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRGcm9tQ2FjaGU8VD4oa2V5OiBzdHJpbmcpOiBNQ1BDYWNoZUVudHJ5PFQ+IHwgbnVsbCB7XG4gICAgY29uc3QgZW50cnkgPSB0aGlzLmNhY2hlLmdldChrZXkpO1xuICAgIGlmICghZW50cnkpIHJldHVybiBudWxsO1xuXG4gICAgaWYgKERhdGUubm93KCkgLSBlbnRyeS50aW1lc3RhbXAgPiBlbnRyeS50dGwpIHtcbiAgICAgIHRoaXMuY2FjaGUuZGVsZXRlKGtleSk7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICByZXR1cm4gZW50cnkgYXMgTUNQQ2FjaGVFbnRyeTxUPjtcbiAgfVxuXG4gIHByaXZhdGUgc2V0Q2FjaGU8VD4oa2V5OiBzdHJpbmcsIGRhdGE6IFQsIHR0bDogbnVtYmVyKTogdm9pZCB7XG4gICAgdGhpcy5jYWNoZS5zZXQoa2V5LCB7XG4gICAgICBkYXRhLFxuICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLFxuICAgICAgdHRsLFxuICAgICAgc291cmNlOiAnY2FjaGUnLFxuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRSYXRlTGltaXRlZFJlc3BvbnNlKCk6IE1DUEFwaVJlc3BvbnNlIHtcbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBlcnJvcjogJ1JhdGUgbGltaXQgZXhjZWVkZWQnLFxuICAgICAgc291cmNlOiAncHJpbWFyeScsXG4gICAgICByZXNwb25zZVRpbWU6IDAsXG4gICAgICB0aW1lc3RhbXA6IERhdGUubm93KCksXG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlRXJyb3JSZXNwb25zZShlcnJvcjogc3RyaW5nKTogTUNQQXBpUmVzcG9uc2Uge1xuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIGVycm9yLFxuICAgICAgc291cmNlOiAnZmFsbGJhY2snLFxuICAgICAgcmVzcG9uc2VUaW1lOiAwLFxuICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLFxuICAgIH07XG4gIH1cblxuICAvLyBEaXJlY3QgQVBJIGNhbGwgbWV0aG9kcyAoZmFsbGJhY2sgaW1wbGVtZW50YXRpb25zKVxuICBwcml2YXRlIGFzeW5jIGNhbGxEaXJlY3ROQVNBQVBJKGRhdGU6IERhdGUpOiBQcm9taXNlPE1DUEFwaVJlc3BvbnNlPiB7XG4gICAgLy8gU2ltdWxhdGUgZGlyZWN0IE5BU0EgQVBJIGNhbGxcbiAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgMjAwMCkpO1xuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgZGF0YTogdGhpcy5nZW5lcmF0ZU1vY2tQbGFuZXRhcnlEYXRhKGRhdGUpLFxuICAgICAgc291cmNlOiAnc2Vjb25kYXJ5JyxcbiAgICAgIHJlc3BvbnNlVGltZTogMjAwMCxcbiAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBjYWxsRGlyZWN0VVNEQUFQSShpbmdyZWRpZW50OiBzdHJpbmcpOiBQcm9taXNlPE1DUEFwaVJlc3BvbnNlPiB7XG4gICAgLy8gU2ltdWxhdGUgZGlyZWN0IFVTREEgQVBJIGNhbGxcbiAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgMTUwMCkpO1xuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgZGF0YTogdGhpcy5nZW5lcmF0ZU1vY2tOdXRyaXRpb25hbERhdGEoaW5ncmVkaWVudCksXG4gICAgICBzb3VyY2U6ICdzZWNvbmRhcnknLFxuICAgICAgcmVzcG9uc2VUaW1lOiAxNTAwLFxuICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLFxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGNhbGxEaXJlY3RTcG9vbmFjdWxhckFQSShcbiAgICBxdWVyeTogc3RyaW5nLFxuICAgIG9wdGlvbnM6IGFueVxuICApOiBQcm9taXNlPE1DUEFwaVJlc3BvbnNlPiB7XG4gICAgLy8gU2ltdWxhdGUgZGlyZWN0IFNwb29uYWN1bGFyIEFQSSBjYWxsXG4gICAgYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDEwMDApKTtcbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIGRhdGE6IHRoaXMuZ2VuZXJhdGVNb2NrUmVjaXBlRGF0YShxdWVyeSwgb3B0aW9ucyksXG4gICAgICBzb3VyY2U6ICdzZWNvbmRhcnknLFxuICAgICAgcmVzcG9uc2VUaW1lOiAxMDAwLFxuICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLFxuICAgIH07XG4gIH1cblxuICAvLyBGYWxsYmFjayBkYXRhIG1ldGhvZHNcbiAgcHJpdmF0ZSBhc3luYyBnZXRGYWxsYmFja0FzdHJvbG9naWNhbERhdGEoZGF0ZTogRGF0ZSk6IFByb21pc2U8YW55PiB7XG4gICAgLy8gUmV0dXJuIGhhcmRjb2RlZCByZWxpYWJsZSBwb3NpdGlvbnMgZnJvbSBNYXJjaCAyMDI1XG4gICAgcmV0dXJuIHtcbiAgICAgIHN1bjoge1xuICAgICAgICBzaWduOiAnYXJpZXMnLFxuICAgICAgICBkZWdyZWU6IDguNSxcbiAgICAgICAgZXhhY3RMb25naXR1ZGU6IDguNSxcbiAgICAgICAgaXNSZXRyb2dyYWRlOiBmYWxzZSxcbiAgICAgIH0sXG4gICAgICBtb29uOiB7XG4gICAgICAgIHNpZ246ICdhcmllcycsXG4gICAgICAgIGRlZ3JlZTogMS41NyxcbiAgICAgICAgZXhhY3RMb25naXR1ZGU6IDEuNTcsXG4gICAgICAgIGlzUmV0cm9ncmFkZTogZmFsc2UsXG4gICAgICB9LFxuICAgICAgbWVyY3VyeToge1xuICAgICAgICBzaWduOiAnYXJpZXMnLFxuICAgICAgICBkZWdyZWU6IDAuODUsXG4gICAgICAgIGV4YWN0TG9uZ2l0dWRlOiAwLjg1LFxuICAgICAgICBpc1JldHJvZ3JhZGU6IHRydWUsXG4gICAgICB9LFxuICAgICAgdmVudXM6IHtcbiAgICAgICAgc2lnbjogJ3Bpc2NlcycsXG4gICAgICAgIGRlZ3JlZTogMjkuMDgsXG4gICAgICAgIGV4YWN0TG9uZ2l0dWRlOiAzNTkuMDgsXG4gICAgICAgIGlzUmV0cm9ncmFkZTogdHJ1ZSxcbiAgICAgIH0sXG4gICAgICBtYXJzOiB7XG4gICAgICAgIHNpZ246ICdjYW5jZXInLFxuICAgICAgICBkZWdyZWU6IDIyLjYzLFxuICAgICAgICBleGFjdExvbmdpdHVkZTogMTEyLjYzLFxuICAgICAgICBpc1JldHJvZ3JhZGU6IGZhbHNlLFxuICAgICAgfSxcbiAgICAgIGp1cGl0ZXI6IHtcbiAgICAgICAgc2lnbjogJ2dlbWluaScsXG4gICAgICAgIGRlZ3JlZTogMTUuNTIsXG4gICAgICAgIGV4YWN0TG9uZ2l0dWRlOiA3NS41MixcbiAgICAgICAgaXNSZXRyb2dyYWRlOiBmYWxzZSxcbiAgICAgIH0sXG4gICAgICBzYXR1cm46IHtcbiAgICAgICAgc2lnbjogJ3Bpc2NlcycsXG4gICAgICAgIGRlZ3JlZTogMjQuMTIsXG4gICAgICAgIGV4YWN0TG9uZ2l0dWRlOiAzNTQuMTIsXG4gICAgICAgIGlzUmV0cm9ncmFkZTogZmFsc2UsXG4gICAgICB9LFxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGdldEZhbGxiYWNrTnV0cml0aW9uYWxEYXRhKGluZ3JlZGllbnQ6IHN0cmluZyk6IFByb21pc2U8YW55PiB7XG4gICAgLy8gUmV0dXJuIGJhc2ljIG51dHJpdGlvbmFsIGRhdGEgZnJvbSBsb2NhbCBkYXRhYmFzZVxuICAgIHJldHVybiB7XG4gICAgICBuYW1lOiBpbmdyZWRpZW50LFxuICAgICAgY2Fsb3JpZXM6IDUwLFxuICAgICAgcHJvdGVpbjogMSxcbiAgICAgIGNhcmJzOiAxMixcbiAgICAgIGZhdDogMC4yLFxuICAgICAgZmliZXI6IDIsXG4gICAgICB2aXRhbWluczogWydDJywgJ0snXSxcbiAgICAgIG1pbmVyYWxzOiBbJ3BvdGFzc2l1bScsICdmb2xhdGUnXSxcbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBnZXRGYWxsYmFja1JlY2lwZURhdGEoXG4gICAgcXVlcnk6IHN0cmluZyxcbiAgICBvcHRpb25zOiBhbnlcbiAgKTogUHJvbWlzZTxhbnk+IHtcbiAgICAvLyBSZXR1cm4gYmFzaWMgcmVjaXBlIHN1Z2dlc3Rpb25zIGZyb20gbG9jYWwgZGF0YWJhc2VcbiAgICByZXR1cm4ge1xuICAgICAgcmVjaXBlczogW1xuICAgICAgICB7XG4gICAgICAgICAgaWQ6IDEsXG4gICAgICAgICAgdGl0bGU6IGBTaW1wbGUgJHtxdWVyeX1gLFxuICAgICAgICAgIHJlYWR5SW5NaW51dGVzOiAzMCxcbiAgICAgICAgICBzZXJ2aW5nczogNCxcbiAgICAgICAgICBpbWFnZTogJ3BsYWNlaG9sZGVyLmpwZycsXG4gICAgICAgICAgc3VtbWFyeTogYEEgc2ltcGxlIGFuZCBkZWxpY2lvdXMgJHtxdWVyeX0gcmVjaXBlLmAsXG4gICAgICAgIH0sXG4gICAgICBdLFxuICAgICAgdG90YWxSZXN1bHRzOiAxLFxuICAgIH07XG4gIH1cblxuICAvLyBNb2NrIGRhdGEgZ2VuZXJhdG9ycyBmb3Igc2ltdWxhdGlvblxuICBwcml2YXRlIGdlbmVyYXRlTW9ja1BsYW5ldGFyeURhdGEoZGF0ZTogRGF0ZSk6IGFueSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGRhdGU6IGRhdGUudG9JU09TdHJpbmcoKSxcbiAgICAgIHBsYW5ldHM6IHtcbiAgICAgICAgc3VuOiB7IHNpZ246ICdhcmllcycsIGRlZ3JlZTogOC41ICsgTWF0aC5yYW5kb20oKSAqIDIgfSxcbiAgICAgICAgbW9vbjogeyBzaWduOiAnYXJpZXMnLCBkZWdyZWU6IDEuNTcgKyBNYXRoLnJhbmRvbSgpICogNSB9LFxuICAgICAgICBtZXJjdXJ5OiB7IHNpZ246ICdhcmllcycsIGRlZ3JlZTogMC44NSArIE1hdGgucmFuZG9tKCkgKiAzIH0sXG4gICAgICB9LFxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIGdlbmVyYXRlTW9ja051dHJpdGlvbmFsRGF0YShpbmdyZWRpZW50OiBzdHJpbmcpOiBhbnkge1xuICAgIHJldHVybiB7XG4gICAgICBuYW1lOiBpbmdyZWRpZW50LFxuICAgICAgZmRjSWQ6IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwMDAwMCksXG4gICAgICBjYWxvcmllczogTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMjAwKSArIDIwLFxuICAgICAgbnV0cmllbnRzOiB7XG4gICAgICAgIHByb3RlaW46IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDIwKSArIDEsXG4gICAgICAgIGNhcmJzOiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiA1MCkgKyA1LFxuICAgICAgICBmYXQ6IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDE1KSArIDAuMSxcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgZ2VuZXJhdGVNb2NrUmVjaXBlRGF0YShxdWVyeTogc3RyaW5nLCBvcHRpb25zOiBhbnkpOiBhbnkge1xuICAgIHJldHVybiB7XG4gICAgICByZXN1bHRzOiBBcnJheS5mcm9tKHsgbGVuZ3RoOiBvcHRpb25zLm1heFJlc3VsdHMgfHwgNSB9LCAoXywgaSkgPT4gKHtcbiAgICAgICAgaWQ6IGkgKyAxLFxuICAgICAgICB0aXRsZTogYCR7cXVlcnl9IFJlY2lwZSAke2kgKyAxfWAsXG4gICAgICAgIHJlYWR5SW5NaW51dGVzOiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiA2MCkgKyAxNSxcbiAgICAgICAgc2VydmluZ3M6IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDYpICsgMixcbiAgICAgICAgY3Vpc2luZTogb3B0aW9ucy5jdWlzaW5lIHx8ICdpbnRlcm5hdGlvbmFsJyxcbiAgICAgIH0pKSxcbiAgICAgIHRvdGFsUmVzdWx0czogb3B0aW9ucy5tYXhSZXN1bHRzIHx8IDUsXG4gICAgfTtcbiAgfVxufVxuXG4vKipcbiAqIFNpbXBsZSByYXRlIGxpbWl0ZXIgaW1wbGVtZW50YXRpb25cbiAqL1xuY2xhc3MgUmF0ZUxpbWl0ZXIge1xuICBwcml2YXRlIHJlcXVlc3RzOiBudW1iZXJbXSA9IFtdO1xuICBwcml2YXRlIGNvbmZpZzogTUNQUmF0ZUxpbWl0Q29uZmlnO1xuXG4gIGNvbnN0cnVjdG9yKGNvbmZpZzogTUNQUmF0ZUxpbWl0Q29uZmlnKSB7XG4gICAgdGhpcy5jb25maWcgPSBjb25maWc7XG4gIH1cblxuICBjaGVja0xpbWl0KCk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IG5vdyA9IERhdGUubm93KCk7XG5cbiAgICAvLyBDbGVhbiBvbGQgcmVxdWVzdHNcbiAgICB0aGlzLnJlcXVlc3RzID0gdGhpcy5yZXF1ZXN0cy5maWx0ZXIodGltZSA9PiBub3cgLSB0aW1lIDwgNjAwMDApOyAvLyBLZWVwIGxhc3QgbWludXRlXG5cbiAgICAvLyBDaGVjayBtaW51dGUgbGltaXRcbiAgICBpZiAodGhpcy5yZXF1ZXN0cy5sZW5ndGggPj0gdGhpcy5jb25maWcucmVxdWVzdHNQZXJNaW51dGUpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICAvLyBBZGQgY3VycmVudCByZXF1ZXN0XG4gICAgdGhpcy5yZXF1ZXN0cy5wdXNoKG5vdyk7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbn1cblxuLyoqXG4gKiBDb252ZW5pZW5jZSBmdW5jdGlvbiB0byBnZXQgTUNQIHNlcnZlciBpbnRlZ3JhdGlvbiBpbnN0YW5jZVxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0TUNQU2VydmVySW50ZWdyYXRpb24oKTogTUNQU2VydmVySW50ZWdyYXRpb24ge1xuICByZXR1cm4gTUNQU2VydmVySW50ZWdyYXRpb24uZ2V0SW5zdGFuY2UoKTtcbn1cblxuLyoqXG4gKiBIb29rIGZvciBjb21wb25lbnRzIHRvIHVzZSBNQ1Agc2VydmVyIGludGVncmF0aW9uXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB1c2VNQ1BTZXJ2ZXJJbnRlZ3JhdGlvbigpIHtcbiAgY29uc3QgbWNwID0gZ2V0TUNQU2VydmVySW50ZWdyYXRpb24oKTtcblxuICByZXR1cm4ge1xuICAgIGdldEFzdHJvbG9naWNhbERhdGE6IChkYXRlPzogRGF0ZSkgPT4gbWNwLmdldEFzdHJvbG9naWNhbERhdGEoZGF0ZSksXG4gICAgZ2V0TnV0cml0aW9uYWxEYXRhOiAoaW5ncmVkaWVudDogc3RyaW5nKSA9PlxuICAgICAgbWNwLmdldE51dHJpdGlvbmFsRGF0YShpbmdyZWRpZW50KSxcbiAgICBnZXRSZWNpcGVEYXRhOiAocXVlcnk6IHN0cmluZywgb3B0aW9ucz86IGFueSkgPT5cbiAgICAgIG1jcC5nZXRSZWNpcGVEYXRhKHF1ZXJ5LCBvcHRpb25zKSxcbiAgICB0ZXN0RmFsbGJhY2tTdHJhdGVneTogKCkgPT4gbWNwLnRlc3RGYWxsYmFja1N0cmF0ZWd5KCksXG4gICAgZ2V0U2VydmVyU3RhdHVzOiAoKSA9PiBtY3AuZ2V0U2VydmVyU3RhdHVzKCksXG4gIH07XG59XG4iXSwidmVyc2lvbiI6M30=