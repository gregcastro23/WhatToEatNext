f39d242104ec38d67e6dc194ce622c53
"use strict";
/**
 * Steering File Intelligence Integration
 *
 * This utility integrates the guidance from Kiro steering files to enhance
 * component development with astrological calculation guidelines, elemental
 * principles enforcement, and cultural sensitivity guidelines.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.useSteeringFileIntelligence = exports.getSteeringFileIntelligence = exports.SteeringFileIntelligence = exports.ELEMENTAL_COMPATIBILITY = void 0;
const logger_1 = require("@/utils/logger");
const reliableAstronomy_1 = require("@/utils/reliableAstronomy");
// Self-reinforcement compatibility matrix from elemental-principles.md
exports.ELEMENTAL_COMPATIBILITY = {
    Fire: { Fire: 0.9, Water: 0.7, Earth: 0.7, Air: 0.8 },
    Water: { Water: 0.9, Fire: 0.7, Earth: 0.8, Air: 0.7 },
    Earth: { Earth: 0.9, Fire: 0.7, Water: 0.8, Air: 0.7 },
    Air: { Air: 0.9, Fire: 0.8, Water: 0.7, Earth: 0.7 }
};
/**
 * Core steering file intelligence class that provides guidance for component development
 */
class SteeringFileIntelligence {
    constructor() {
        this.cachedGuidance = null;
        this.lastUpdate = 0;
        this.CACHE_DURATION = 30 * 60 * 1000; // 30 minutes
    }
    static getInstance() {
        if (!SteeringFileIntelligence.instance) {
            SteeringFileIntelligence.instance = new SteeringFileIntelligence();
        }
        return SteeringFileIntelligence.instance;
    }
    /**
     * Get comprehensive astrological guidance for component development
     */
    async getAstrologicalGuidance() {
        // Check cache first
        if (this.cachedGuidance && (Date.now() - this.lastUpdate) < this.CACHE_DURATION) {
            return this.cachedGuidance;
        }
        try {
            // Get current planetary positions using reliable astronomy
            const planetaryPositions = await (0, reliableAstronomy_1.getReliablePlanetaryPositions)();
            // Calculate dominant element based on current astrological conditions
            const dominantElement = this.calculateDominantElement(planetaryPositions);
            // Calculate elemental balance
            const elementalBalance = this.calculateElementalBalance(planetaryPositions);
            // Apply cultural sensitivity guidelines
            const culturalSensitivity = this.getCulturalGuidance();
            // Apply performance optimizations
            const performanceOptimizations = this.getPerformanceGuidance();
            this.cachedGuidance = {
                planetaryPositions,
                dominantElement,
                elementalBalance,
                culturalSensitivity,
                performanceOptimizations
            };
            this.lastUpdate = Date.now();
            logger_1.logger.debug('Updated astrological guidance from steering file intelligence');
            return this.cachedGuidance;
        }
        catch (error) {
            logger_1.logger.error('Error getting astrological guidance:', error);
            // Return fallback guidance
            return this.getFallbackGuidance();
        }
    }
    /**
     * Calculate elemental compatibility using self-reinforcement principles
     */
    calculateElementalCompatibility(sourceProps, targetProps) {
        const sourceDominant = this.getDominantElement(sourceProps);
        const targetDominant = this.getDominantElement(targetProps);
        // Self-reinforcement: same elements have highest compatibility (≥0.9)
        if (sourceDominant === targetDominant) {
            return Math.max(0.9, exports.ELEMENTAL_COMPATIBILITY[sourceDominant][targetDominant]);
        }
        // Different elements have good compatibility (≥0.7)
        return Math.max(0.7, exports.ELEMENTAL_COMPATIBILITY[sourceDominant][targetDominant]);
    }
    /**
     * Validate elemental properties according to steering file principles
     */
    validateElementalProperties(properties) {
        const elements = ['Fire', 'Water', 'Earth', 'Air'];
        // Check all elements are present and non-negative
        for (const element of elements) {
            if (typeof properties[element] !== 'number' || properties[element] < 0) {
                logger_1.logger.warn(`Invalid elemental property for ${element}: ${properties[element]}`);
                return false;
            }
        }
        // Check total doesn't exceed reasonable bounds (allow for strong elemental presence)
        const total = Object.values(properties).reduce((sum, val) => sum + val, 0);
        if (total > 4.0) {
            logger_1.logger.warn(`Elemental properties total exceeds maximum: ${total}`);
            return false;
        }
        return true;
    }
    /**
     * Validate compatibility score according to steering file principles
     */
    validateCompatibilityScore(score) {
        // All compatibility scores must be at least 0.7 (no opposing elements)
        if (score < 0.7) {
            logger_1.logger.error(`Compatibility score ${score} violates minimum 0.7 principle`);
            return false;
        }
        // Scores should not exceed 1.0
        if (score > 1.0) {
            logger_1.logger.warn(`Compatibility score ${score} exceeds maximum 1.0`);
            return false;
        }
        return true;
    }
    /**
     * Enhance elemental properties using self-reinforcement principles
     */
    enhanceDominantElement(properties) {
        const dominant = this.getDominantElement(properties);
        const enhancedProperties = { ...properties };
        // Self-reinforcement: boost the dominant element
        enhancedProperties[dominant] = Math.min(1.0, properties[dominant] * 1.1);
        return enhancedProperties;
    }
    /**
     * Apply architectural patterns from steering files
     */
    getArchitecturalGuidance() {
        return {
            componentPatterns: [
                'Use React.memo for expensive components',
                'Implement lazy loading for non-critical components',
                'Apply error boundaries with cosmic-aware error handling',
                'Use context providers for astrological state sharing'
            ],
            stateManagement: [
                'Centralized astrological state with real-time updates',
                'Context consolidation to prevent provider nesting',
                'Performance optimization through selective subscriptions',
                'Fallback state management for calculation failures'
            ],
            errorHandling: [
                'Multi-layered error handling with graceful degradation',
                'Fallback mechanisms for API failures',
                'User-friendly error messages with cosmic context',
                'Error recovery mechanisms with automatic retry'
            ],
            performance: [
                'Bundle splitting for astrological features',
                'Intelligent caching with cosmic timing considerations',
                'Memory optimization for planetary calculations',
                'Real-time monitoring and optimization'
            ]
        };
    }
    /**
     * Apply technology stack guidance from steering files
     */
    getTechnologyStackGuidance() {
        return {
            typescript: [
                'Use strict typing for astrological calculations',
                'Domain-specific types for elemental properties',
                'Generic constraints for recommendation algorithms',
                'Utility types for data transformations'
            ],
            react: [
                'Concurrent features for real-time astrological updates',
                'Suspense for graceful loading states',
                'Error boundaries with cosmic-aware error handling',
                'Custom hooks for astrological calculations'
            ],
            nextjs: [
                'App Router architecture with route-based organization',
                'Server components for optimized rendering',
                'API routes for external service connections',
                'Static generation for pre-rendered pages'
            ],
            testing: [
                'Unit tests for astrological calculation accuracy',
                'Integration tests for component interactions',
                'E2E tests for complete user workflows',
                'Performance monitoring with Web Vitals'
            ]
        };
    }
    // Private helper methods
    calculateDominantElement(planetaryPositions) {
        // Calculate dominant element based on planetary positions
        const elementCounts = { Fire: 0, Water: 0, Earth: 0, Air: 0 };
        const zodiacElementMap = {
            'aries': 'Fire', 'leo': 'Fire', 'sagittarius': 'Fire',
            'taurus': 'Earth', 'virgo': 'Earth', 'capricorn': 'Earth',
            'gemini': 'Air', 'libra': 'Air', 'aquarius': 'Air',
            'cancer': 'Water', 'scorpio': 'Water', 'pisces': 'Water'
        };
        // Count elements from planetary positions
        Object.values(planetaryPositions).forEach((position) => {
            if ((position === null || position === void 0 ? void 0 : position.sign) && zodiacElementMap[position.sign]) {
                elementCounts[zodiacElementMap[position.sign]]++;
            }
        });
        // Return the element with the highest count
        return Object.entries(elementCounts).reduce((a, b) => elementCounts[a[0]] > elementCounts[b[0]] ? a : b)[0];
    }
    calculateElementalBalance(planetaryPositions) {
        const elementCounts = { Fire: 0, Water: 0, Earth: 0, Air: 0 };
        const totalPlanets = Object.keys(planetaryPositions).length;
        const zodiacElementMap = {
            'aries': 'Fire', 'leo': 'Fire', 'sagittarius': 'Fire',
            'taurus': 'Earth', 'virgo': 'Earth', 'capricorn': 'Earth',
            'gemini': 'Air', 'libra': 'Air', 'aquarius': 'Air',
            'cancer': 'Water', 'scorpio': 'Water', 'pisces': 'Water'
        };
        // Count elements from planetary positions
        Object.values(planetaryPositions).forEach((position) => {
            if ((position === null || position === void 0 ? void 0 : position.sign) && zodiacElementMap[position.sign]) {
                elementCounts[zodiacElementMap[position.sign]]++;
            }
        });
        // Normalize to proportions
        return {
            Fire: totalPlanets > 0 ? elementCounts.Fire / totalPlanets : 0.25,
            Water: totalPlanets > 0 ? elementCounts.Water / totalPlanets : 0.25,
            Earth: totalPlanets > 0 ? elementCounts.Earth / totalPlanets : 0.25,
            Air: totalPlanets > 0 ? elementCounts.Air / totalPlanets : 0.25
        };
    }
    getDominantElement(properties) {
        return Object.entries(properties).reduce((a, b) => properties[a[0]] > properties[b[0]] ? a : b)[0];
    }
    getCulturalGuidance() {
        return {
            inclusiveDesign: true,
            respectfulRepresentation: true,
            diverseCulinaryTraditions: true,
            accessibilityCompliant: true
        };
    }
    getPerformanceGuidance() {
        return {
            lazyLoading: true,
            memoization: true,
            contextOptimization: true,
            bundleSplitting: true
        };
    }
    getFallbackGuidance() {
        return {
            planetaryPositions: {},
            dominantElement: 'Fire',
            elementalBalance: { Fire: 0.25, Water: 0.25, Earth: 0.25, Air: 0.25 },
            culturalSensitivity: this.getCulturalGuidance(),
            performanceOptimizations: this.getPerformanceGuidance()
        };
    }
}
exports.SteeringFileIntelligence = SteeringFileIntelligence;
/**
 * Convenience function to get steering file intelligence instance
 */
function getSteeringFileIntelligence() {
    return SteeringFileIntelligence.getInstance();
}
exports.getSteeringFileIntelligence = getSteeringFileIntelligence;
/**
 * Hook for components to use steering file intelligence
 */
function useSteeringFileIntelligence() {
    const intelligence = getSteeringFileIntelligence();
    return {
        getGuidance: async () => await intelligence.getAstrologicalGuidance(),
        validateElementalProperties: (props) => intelligence.validateElementalProperties(props),
        calculateCompatibility: (source, target) => intelligence.calculateElementalCompatibility(source, target),
        enhanceDominantElement: (props) => intelligence.enhanceDominantElement(props),
        getArchitecturalGuidance: () => intelligence.getArchitecturalGuidance(),
        getTechnologyStackGuidance: () => intelligence.getTechnologyStackGuidance()
    };
}
exports.useSteeringFileIntelligence = useSteeringFileIntelligence;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy91dGlscy9zdGVlcmluZ0ZpbGVJbnRlbGxpZ2VuY2UudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7Ozs7R0FNRzs7O0FBRUgsMkNBQXdDO0FBQ3hDLGlFQUEwRTtBQVUxRSx1RUFBdUU7QUFDMUQsUUFBQSx1QkFBdUIsR0FBaUM7SUFDbkUsSUFBSSxFQUFFLEVBQUUsSUFBSSxFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUUsR0FBRyxFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRTtJQUNyRCxLQUFLLEVBQUUsRUFBRSxLQUFLLEVBQUUsR0FBRyxFQUFFLElBQUksRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFO0lBQ3RELEtBQUssRUFBRSxFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUUsSUFBSSxFQUFFLEdBQUcsRUFBRSxLQUFLLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLEVBQUU7SUFDdEQsR0FBRyxFQUFFLEVBQUUsR0FBRyxFQUFFLEdBQUcsRUFBRSxJQUFJLEVBQUUsR0FBRyxFQUFFLEtBQUssRUFBRSxHQUFHLEVBQUUsS0FBSyxFQUFFLEdBQUcsRUFBRTtDQUNyRCxDQUFDO0FBaUNGOztHQUVHO0FBQ0gsTUFBYSx3QkFBd0I7SUFNbkM7UUFKUSxtQkFBYyxHQUFnQyxJQUFJLENBQUM7UUFDbkQsZUFBVSxHQUFXLENBQUMsQ0FBQztRQUNkLG1CQUFjLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxJQUFJLENBQUMsQ0FBQyxhQUFhO0lBRXhDLENBQUM7SUFFakIsTUFBTSxDQUFDLFdBQVc7UUFDdkIsSUFBSSxDQUFDLHdCQUF3QixDQUFDLFFBQVEsRUFBRTtZQUN0Qyx3QkFBd0IsQ0FBQyxRQUFRLEdBQUcsSUFBSSx3QkFBd0IsRUFBRSxDQUFDO1NBQ3BFO1FBQ0QsT0FBTyx3QkFBd0IsQ0FBQyxRQUFRLENBQUM7SUFD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QUM7QUFGRCxrRUFFQztBQUVEOztHQUVHO0FBQ0gsU0FBZ0IsMkJBQTJCO0lBQ3pDLE1BQU0sWUFBWSxHQUFHLDJCQUEyQixFQUFFLENBQUM7SUFFbkQsT0FBTztRQUNMLFdBQVcsRUFBRSxLQUFLLElBQUksRUFBRSxDQUFDLE1BQU0sWUFBWSxDQUFDLHVCQUF1QixFQUFFO1FBQ3JFLDJCQUEyQixFQUFFLENBQUMsS0FBMEIsRUFBRSxFQUFFLENBQzFELFlBQVksQ0FBQywyQkFBMkIsQ0FBQyxLQUFLLENBQUM7UUFDakQsc0JBQXNCLEVBQUUsQ0FBQyxNQUEyQixFQUFFLE1BQTJCLEVBQUUsRUFBRSxDQUNuRixZQUFZLENBQUMsK0JBQStCLENBQUMsTUFBTSxFQUFFLE1BQU0sQ0FBQztRQUM5RCxzQkFBc0IsRUFBRSxDQUFDLEtBQTBCLEVBQUUsRUFBRSxDQUNyRCxZQUFZLENBQUMsc0JBQXNCLENBQUMsS0FBSyxDQUFDO1FBQzVDLHdCQUF3QixFQUFFLEdBQUcsRUFBRSxDQUFDLFlBQVksQ0FBQyx3QkFBd0IsRUFBRTtRQUN2RSwwQkFBMEIsRUFBRSxHQUFHLEVBQUUsQ0FBQyxZQUFZLENBQUMsMEJBQTBCLEVBQUU7S0FDNUUsQ0FBQztBQUNKLENBQUM7QUFkRCxrRUFjQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvR3JlZ0Nhc3Ryby9EZXNrdG9wL1doYXRUb0VhdE5leHQvc3JjL3V0aWxzL3N0ZWVyaW5nRmlsZUludGVsbGlnZW5jZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFN0ZWVyaW5nIEZpbGUgSW50ZWxsaWdlbmNlIEludGVncmF0aW9uXG4gKiBcbiAqIFRoaXMgdXRpbGl0eSBpbnRlZ3JhdGVzIHRoZSBndWlkYW5jZSBmcm9tIEtpcm8gc3RlZXJpbmcgZmlsZXMgdG8gZW5oYW5jZVxuICogY29tcG9uZW50IGRldmVsb3BtZW50IHdpdGggYXN0cm9sb2dpY2FsIGNhbGN1bGF0aW9uIGd1aWRlbGluZXMsIGVsZW1lbnRhbFxuICogcHJpbmNpcGxlcyBlbmZvcmNlbWVudCwgYW5kIGN1bHR1cmFsIHNlbnNpdGl2aXR5IGd1aWRlbGluZXMuXG4gKi9cblxuaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSAnQC91dGlscy9sb2dnZXInO1xuaW1wb3J0IHsgZ2V0UmVsaWFibGVQbGFuZXRhcnlQb3NpdGlvbnMgfSBmcm9tICdAL3V0aWxzL3JlbGlhYmxlQXN0cm9ub215JztcblxuLy8gRWxlbWVudGFsIFByaW5jaXBsZXMgZnJvbSBzdGVlcmluZyBmaWxlc1xuZXhwb3J0IGludGVyZmFjZSBFbGVtZW50YWxDb21wYXRpYmlsaXR5TWF0cml4IHtcbiAgRmlyZTogeyBGaXJlOiBudW1iZXI7IFdhdGVyOiBudW1iZXI7IEVhcnRoOiBudW1iZXI7IEFpcjogbnVtYmVyIH07XG4gIFdhdGVyOiB7IFdhdGVyOiBudW1iZXI7IEZpcmU6IG51bWJlcjsgRWFydGg6IG51bWJlcjsgQWlyOiBudW1iZXIgfTtcbiAgRWFydGg6IHsgRWFydGg6IG51bWJlcjsgRmlyZTogbnVtYmVyOyBXYXRlcjogbnVtYmVyOyBBaXI6IG51bWJlciB9O1xuICBBaXI6IHsgQWlyOiBudW1iZXI7IEZpcmU6IG51bWJlcjsgV2F0ZXI6IG51bWJlcjsgRWFydGg6IG51bWJlciB9O1xufVxuXG4vLyBTZWxmLXJlaW5mb3JjZW1lbnQgY29tcGF0aWJpbGl0eSBtYXRyaXggZnJvbSBlbGVtZW50YWwtcHJpbmNpcGxlcy5tZFxuZXhwb3J0IGNvbnN0IEVMRU1FTlRBTF9DT01QQVRJQklMSVRZOiBFbGVtZW50YWxDb21wYXRpYmlsaXR5TWF0cml4ID0ge1xuICBGaXJlOiB7IEZpcmU6IDAuOSwgV2F0ZXI6IDAuNywgRWFydGg6IDAuNywgQWlyOiAwLjggfSxcbiAgV2F0ZXI6IHsgV2F0ZXI6IDAuOSwgRmlyZTogMC43LCBFYXJ0aDogMC44LCBBaXI6IDAuNyB9LFxuICBFYXJ0aDogeyBFYXJ0aDogMC45LCBGaXJlOiAwLjcsIFdhdGVyOiAwLjgsIEFpcjogMC43IH0sXG4gIEFpcjogeyBBaXI6IDAuOSwgRmlyZTogMC44LCBXYXRlcjogMC43LCBFYXJ0aDogMC43IH1cbn07XG5cbmV4cG9ydCB0eXBlIEVsZW1lbnQgPSAnRmlyZScgfCAnV2F0ZXInIHwgJ0VhcnRoJyB8ICdBaXInO1xuXG5leHBvcnQgaW50ZXJmYWNlIEVsZW1lbnRhbFByb3BlcnRpZXMge1xuICBGaXJlOiBudW1iZXI7XG4gIFdhdGVyOiBudW1iZXI7XG4gIEVhcnRoOiBudW1iZXI7XG4gIEFpcjogbnVtYmVyO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEFzdHJvbG9naWNhbEd1aWRhbmNlIHtcbiAgcGxhbmV0YXJ5UG9zaXRpb25zOiBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xuICBkb21pbmFudEVsZW1lbnQ6IEVsZW1lbnQ7XG4gIGVsZW1lbnRhbEJhbGFuY2U6IEVsZW1lbnRhbFByb3BlcnRpZXM7XG4gIGN1bHR1cmFsU2Vuc2l0aXZpdHk6IEN1bHR1cmFsR3VpZGFuY2U7XG4gIHBlcmZvcm1hbmNlT3B0aW1pemF0aW9uczogUGVyZm9ybWFuY2VHdWlkYW5jZTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBDdWx0dXJhbEd1aWRhbmNlIHtcbiAgaW5jbHVzaXZlRGVzaWduOiBib29sZWFuO1xuICByZXNwZWN0ZnVsUmVwcmVzZW50YXRpb246IGJvb2xlYW47XG4gIGRpdmVyc2VDdWxpbmFyeVRyYWRpdGlvbnM6IGJvb2xlYW47XG4gIGFjY2Vzc2liaWxpdHlDb21wbGlhbnQ6IGJvb2xlYW47XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUGVyZm9ybWFuY2VHdWlkYW5jZSB7XG4gIGxhenlMb2FkaW5nOiBib29sZWFuO1xuICBtZW1vaXphdGlvbjogYm9vbGVhbjtcbiAgY29udGV4dE9wdGltaXphdGlvbjogYm9vbGVhbjtcbiAgYnVuZGxlU3BsaXR0aW5nOiBib29sZWFuO1xufVxuXG4vKipcbiAqIENvcmUgc3RlZXJpbmcgZmlsZSBpbnRlbGxpZ2VuY2UgY2xhc3MgdGhhdCBwcm92aWRlcyBndWlkYW5jZSBmb3IgY29tcG9uZW50IGRldmVsb3BtZW50XG4gKi9cbmV4cG9ydCBjbGFzcyBTdGVlcmluZ0ZpbGVJbnRlbGxpZ2VuY2Uge1xuICBwcml2YXRlIHN0YXRpYyBpbnN0YW5jZTogU3RlZXJpbmdGaWxlSW50ZWxsaWdlbmNlO1xuICBwcml2YXRlIGNhY2hlZEd1aWRhbmNlOiBBc3Ryb2xvZ2ljYWxHdWlkYW5jZSB8IG51bGwgPSBudWxsO1xuICBwcml2YXRlIGxhc3RVcGRhdGU6IG51bWJlciA9IDA7XG4gIHByaXZhdGUgcmVhZG9ubHkgQ0FDSEVfRFVSQVRJT04gPSAzMCAqIDYwICogMTAwMDsgLy8gMzAgbWludXRlc1xuXG4gIHByaXZhdGUgY29uc3RydWN0b3IoKSB7fVxuXG4gIHB1YmxpYyBzdGF0aWMgZ2V0SW5zdGFuY2UoKTogU3RlZXJpbmdGaWxlSW50ZWxsaWdlbmNlIHtcbiAgICBpZiAoIVN0ZWVyaW5nRmlsZUludGVsbGlnZW5jZS5pbnN0YW5jZSkge1xuICAgICAgU3RlZXJpbmdGaWxlSW50ZWxsaWdlbmNlLmluc3RhbmNlID0gbmV3IFN0ZWVyaW5nRmlsZUludGVsbGlnZW5jZSgpO1xuICAgIH1cbiAgICByZXR1cm4gU3RlZXJpbmdGaWxlSW50ZWxsaWdlbmNlLmluc3RhbmNlO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCBjb21wcmVoZW5zaXZlIGFzdHJvbG9naWNhbCBndWlkYW5jZSBmb3IgY29tcG9uZW50IGRldmVsb3BtZW50XG4gICAqL1xuICBwdWJsaWMgYXN5bmMgZ2V0QXN0cm9sb2dpY2FsR3VpZGFuY2UoKTogUHJvbWlzZTxBc3Ryb2xvZ2ljYWxHdWlkYW5jZT4ge1xuICAgIC8vIENoZWNrIGNhY2hlIGZpcnN0XG4gICAgaWYgKHRoaXMuY2FjaGVkR3VpZGFuY2UgJiYgKERhdGUubm93KCkgLSB0aGlzLmxhc3RVcGRhdGUpIDwgdGhpcy5DQUNIRV9EVVJBVElPTikge1xuICAgICAgcmV0dXJuIHRoaXMuY2FjaGVkR3VpZGFuY2U7XG4gICAgfVxuXG4gICAgdHJ5IHtcbiAgICAgIC8vIEdldCBjdXJyZW50IHBsYW5ldGFyeSBwb3NpdGlvbnMgdXNpbmcgcmVsaWFibGUgYXN0cm9ub215XG4gICAgICBjb25zdCBwbGFuZXRhcnlQb3NpdGlvbnMgPSBhd2FpdCBnZXRSZWxpYWJsZVBsYW5ldGFyeVBvc2l0aW9ucygpO1xuICAgICAgXG4gICAgICAvLyBDYWxjdWxhdGUgZG9taW5hbnQgZWxlbWVudCBiYXNlZCBvbiBjdXJyZW50IGFzdHJvbG9naWNhbCBjb25kaXRpb25zXG4gICAgICBjb25zdCBkb21pbmFudEVsZW1lbnQgPSB0aGlzLmNhbGN1bGF0ZURvbWluYW50RWxlbWVudChwbGFuZXRhcnlQb3NpdGlvbnMpO1xuICAgICAgXG4gICAgICAvLyBDYWxjdWxhdGUgZWxlbWVudGFsIGJhbGFuY2VcbiAgICAgIGNvbnN0IGVsZW1lbnRhbEJhbGFuY2UgPSB0aGlzLmNhbGN1bGF0ZUVsZW1lbnRhbEJhbGFuY2UocGxhbmV0YXJ5UG9zaXRpb25zKTtcbiAgICAgIFxuICAgICAgLy8gQXBwbHkgY3VsdHVyYWwgc2Vuc2l0aXZpdHkgZ3VpZGVsaW5lc1xuICAgICAgY29uc3QgY3VsdHVyYWxTZW5zaXRpdml0eSA9IHRoaXMuZ2V0Q3VsdHVyYWxHdWlkYW5jZSgpO1xuICAgICAgXG4gICAgICAvLyBBcHBseSBwZXJmb3JtYW5jZSBvcHRpbWl6YXRpb25zXG4gICAgICBjb25zdCBwZXJmb3JtYW5jZU9wdGltaXphdGlvbnMgPSB0aGlzLmdldFBlcmZvcm1hbmNlR3VpZGFuY2UoKTtcblxuICAgICAgdGhpcy5jYWNoZWRHdWlkYW5jZSA9IHtcbiAgICAgICAgcGxhbmV0YXJ5UG9zaXRpb25zLFxuICAgICAgICBkb21pbmFudEVsZW1lbnQsXG4gICAgICAgIGVsZW1lbnRhbEJhbGFuY2UsXG4gICAgICAgIGN1bHR1cmFsU2Vuc2l0aXZpdHksXG4gICAgICAgIHBlcmZvcm1hbmNlT3B0aW1pemF0aW9uc1xuICAgICAgfTtcblxuICAgICAgdGhpcy5sYXN0VXBkYXRlID0gRGF0ZS5ub3coKTtcbiAgICAgIFxuICAgICAgbG9nZ2VyLmRlYnVnKCdVcGRhdGVkIGFzdHJvbG9naWNhbCBndWlkYW5jZSBmcm9tIHN0ZWVyaW5nIGZpbGUgaW50ZWxsaWdlbmNlJyk7XG4gICAgICByZXR1cm4gdGhpcy5jYWNoZWRHdWlkYW5jZTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdFcnJvciBnZXR0aW5nIGFzdHJvbG9naWNhbCBndWlkYW5jZTonLCBlcnJvcik7XG4gICAgICBcbiAgICAgIC8vIFJldHVybiBmYWxsYmFjayBndWlkYW5jZVxuICAgICAgcmV0dXJuIHRoaXMuZ2V0RmFsbGJhY2tHdWlkYW5jZSgpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDYWxjdWxhdGUgZWxlbWVudGFsIGNvbXBhdGliaWxpdHkgdXNpbmcgc2VsZi1yZWluZm9yY2VtZW50IHByaW5jaXBsZXNcbiAgICovXG4gIHB1YmxpYyBjYWxjdWxhdGVFbGVtZW50YWxDb21wYXRpYmlsaXR5KFxuICAgIHNvdXJjZVByb3BzOiBFbGVtZW50YWxQcm9wZXJ0aWVzLFxuICAgIHRhcmdldFByb3BzOiBFbGVtZW50YWxQcm9wZXJ0aWVzXG4gICk6IG51bWJlciB7XG4gICAgY29uc3Qgc291cmNlRG9taW5hbnQgPSB0aGlzLmdldERvbWluYW50RWxlbWVudChzb3VyY2VQcm9wcyk7XG4gICAgY29uc3QgdGFyZ2V0RG9taW5hbnQgPSB0aGlzLmdldERvbWluYW50RWxlbWVudCh0YXJnZXRQcm9wcyk7XG4gICAgXG4gICAgLy8gU2VsZi1yZWluZm9yY2VtZW50OiBzYW1lIGVsZW1lbnRzIGhhdmUgaGlnaGVzdCBjb21wYXRpYmlsaXR5ICjiiaUwLjkpXG4gICAgaWYgKHNvdXJjZURvbWluYW50ID09PSB0YXJnZXREb21pbmFudCkge1xuICAgICAgcmV0dXJuIE1hdGgubWF4KDAuOSwgRUxFTUVOVEFMX0NPTVBBVElCSUxJVFlbc291cmNlRG9taW5hbnRdW3RhcmdldERvbWluYW50XSk7XG4gICAgfVxuICAgIFxuICAgIC8vIERpZmZlcmVudCBlbGVtZW50cyBoYXZlIGdvb2QgY29tcGF0aWJpbGl0eSAo4omlMC43KVxuICAgIHJldHVybiBNYXRoLm1heCgwLjcsIEVMRU1FTlRBTF9DT01QQVRJQklMSVRZW3NvdXJjZURvbWluYW50XVt0YXJnZXREb21pbmFudF0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFZhbGlkYXRlIGVsZW1lbnRhbCBwcm9wZXJ0aWVzIGFjY29yZGluZyB0byBzdGVlcmluZyBmaWxlIHByaW5jaXBsZXNcbiAgICovXG4gIHB1YmxpYyB2YWxpZGF0ZUVsZW1lbnRhbFByb3BlcnRpZXMocHJvcGVydGllczogRWxlbWVudGFsUHJvcGVydGllcyk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IGVsZW1lbnRzOiBFbGVtZW50W10gPSBbJ0ZpcmUnLCAnV2F0ZXInLCAnRWFydGgnLCAnQWlyJ107XG4gICAgXG4gICAgLy8gQ2hlY2sgYWxsIGVsZW1lbnRzIGFyZSBwcmVzZW50IGFuZCBub24tbmVnYXRpdmVcbiAgICBmb3IgKGNvbnN0IGVsZW1lbnQgb2YgZWxlbWVudHMpIHtcbiAgICAgIGlmICh0eXBlb2YgcHJvcGVydGllc1tlbGVtZW50XSAhPT0gJ251bWJlcicgfHwgcHJvcGVydGllc1tlbGVtZW50XSA8IDApIHtcbiAgICAgICAgbG9nZ2VyLndhcm4oYEludmFsaWQgZWxlbWVudGFsIHByb3BlcnR5IGZvciAke2VsZW1lbnR9OiAke3Byb3BlcnRpZXNbZWxlbWVudF19YCk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgLy8gQ2hlY2sgdG90YWwgZG9lc24ndCBleGNlZWQgcmVhc29uYWJsZSBib3VuZHMgKGFsbG93IGZvciBzdHJvbmcgZWxlbWVudGFsIHByZXNlbmNlKVxuICAgIGNvbnN0IHRvdGFsID0gT2JqZWN0LnZhbHVlcyhwcm9wZXJ0aWVzKS5yZWR1Y2UoKHN1bSwgdmFsKSA9PiBzdW0gKyB2YWwsIDApO1xuICAgIGlmICh0b3RhbCA+IDQuMCkge1xuICAgICAgbG9nZ2VyLndhcm4oYEVsZW1lbnRhbCBwcm9wZXJ0aWVzIHRvdGFsIGV4Y2VlZHMgbWF4aW11bTogJHt0b3RhbH1gKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICAvKipcbiAgICogVmFsaWRhdGUgY29tcGF0aWJpbGl0eSBzY29yZSBhY2NvcmRpbmcgdG8gc3RlZXJpbmcgZmlsZSBwcmluY2lwbGVzXG4gICAqL1xuICBwdWJsaWMgdmFsaWRhdGVDb21wYXRpYmlsaXR5U2NvcmUoc2NvcmU6IG51bWJlcik6IGJvb2xlYW4ge1xuICAgIC8vIEFsbCBjb21wYXRpYmlsaXR5IHNjb3JlcyBtdXN0IGJlIGF0IGxlYXN0IDAuNyAobm8gb3Bwb3NpbmcgZWxlbWVudHMpXG4gICAgaWYgKHNjb3JlIDwgMC43KSB7XG4gICAgICBsb2dnZXIuZXJyb3IoYENvbXBhdGliaWxpdHkgc2NvcmUgJHtzY29yZX0gdmlvbGF0ZXMgbWluaW11bSAwLjcgcHJpbmNpcGxlYCk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIFxuICAgIC8vIFNjb3JlcyBzaG91bGQgbm90IGV4Y2VlZCAxLjBcbiAgICBpZiAoc2NvcmUgPiAxLjApIHtcbiAgICAgIGxvZ2dlci53YXJuKGBDb21wYXRpYmlsaXR5IHNjb3JlICR7c2NvcmV9IGV4Y2VlZHMgbWF4aW11bSAxLjBgKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICAvKipcbiAgICogRW5oYW5jZSBlbGVtZW50YWwgcHJvcGVydGllcyB1c2luZyBzZWxmLXJlaW5mb3JjZW1lbnQgcHJpbmNpcGxlc1xuICAgKi9cbiAgcHVibGljIGVuaGFuY2VEb21pbmFudEVsZW1lbnQocHJvcGVydGllczogRWxlbWVudGFsUHJvcGVydGllcyk6IEVsZW1lbnRhbFByb3BlcnRpZXMge1xuICAgIGNvbnN0IGRvbWluYW50ID0gdGhpcy5nZXREb21pbmFudEVsZW1lbnQocHJvcGVydGllcyk7XG4gICAgY29uc3QgZW5oYW5jZWRQcm9wZXJ0aWVzID0geyAuLi5wcm9wZXJ0aWVzIH07XG4gICAgXG4gICAgLy8gU2VsZi1yZWluZm9yY2VtZW50OiBib29zdCB0aGUgZG9taW5hbnQgZWxlbWVudFxuICAgIGVuaGFuY2VkUHJvcGVydGllc1tkb21pbmFudF0gPSBNYXRoLm1pbigxLjAsIHByb3BlcnRpZXNbZG9taW5hbnRdICogMS4xKTtcbiAgICBcbiAgICByZXR1cm4gZW5oYW5jZWRQcm9wZXJ0aWVzO1xuICB9XG5cbiAgLyoqXG4gICAqIEFwcGx5IGFyY2hpdGVjdHVyYWwgcGF0dGVybnMgZnJvbSBzdGVlcmluZyBmaWxlc1xuICAgKi9cbiAgcHVibGljIGdldEFyY2hpdGVjdHVyYWxHdWlkYW5jZSgpOiB7XG4gICAgY29tcG9uZW50UGF0dGVybnM6IHN0cmluZ1tdO1xuICAgIHN0YXRlTWFuYWdlbWVudDogc3RyaW5nW107XG4gICAgZXJyb3JIYW5kbGluZzogc3RyaW5nW107XG4gICAgcGVyZm9ybWFuY2U6IHN0cmluZ1tdO1xuICB9IHtcbiAgICByZXR1cm4ge1xuICAgICAgY29tcG9uZW50UGF0dGVybnM6IFtcbiAgICAgICAgJ1VzZSBSZWFjdC5tZW1vIGZvciBleHBlbnNpdmUgY29tcG9uZW50cycsXG4gICAgICAgICdJbXBsZW1lbnQgbGF6eSBsb2FkaW5nIGZvciBub24tY3JpdGljYWwgY29tcG9uZW50cycsXG4gICAgICAgICdBcHBseSBlcnJvciBib3VuZGFyaWVzIHdpdGggY29zbWljLWF3YXJlIGVycm9yIGhhbmRsaW5nJyxcbiAgICAgICAgJ1VzZSBjb250ZXh0IHByb3ZpZGVycyBmb3IgYXN0cm9sb2dpY2FsIHN0YXRlIHNoYXJpbmcnXG4gICAgICBdLFxuICAgICAgc3RhdGVNYW5hZ2VtZW50OiBbXG4gICAgICAgICdDZW50cmFsaXplZCBhc3Ryb2xvZ2ljYWwgc3RhdGUgd2l0aCByZWFsLXRpbWUgdXBkYXRlcycsXG4gICAgICAgICdDb250ZXh0IGNvbnNvbGlkYXRpb24gdG8gcHJldmVudCBwcm92aWRlciBuZXN0aW5nJyxcbiAgICAgICAgJ1BlcmZvcm1hbmNlIG9wdGltaXphdGlvbiB0aHJvdWdoIHNlbGVjdGl2ZSBzdWJzY3JpcHRpb25zJyxcbiAgICAgICAgJ0ZhbGxiYWNrIHN0YXRlIG1hbmFnZW1lbnQgZm9yIGNhbGN1bGF0aW9uIGZhaWx1cmVzJ1xuICAgICAgXSxcbiAgICAgIGVycm9ySGFuZGxpbmc6IFtcbiAgICAgICAgJ011bHRpLWxheWVyZWQgZXJyb3IgaGFuZGxpbmcgd2l0aCBncmFjZWZ1bCBkZWdyYWRhdGlvbicsXG4gICAgICAgICdGYWxsYmFjayBtZWNoYW5pc21zIGZvciBBUEkgZmFpbHVyZXMnLFxuICAgICAgICAnVXNlci1mcmllbmRseSBlcnJvciBtZXNzYWdlcyB3aXRoIGNvc21pYyBjb250ZXh0JyxcbiAgICAgICAgJ0Vycm9yIHJlY292ZXJ5IG1lY2hhbmlzbXMgd2l0aCBhdXRvbWF0aWMgcmV0cnknXG4gICAgICBdLFxuICAgICAgcGVyZm9ybWFuY2U6IFtcbiAgICAgICAgJ0J1bmRsZSBzcGxpdHRpbmcgZm9yIGFzdHJvbG9naWNhbCBmZWF0dXJlcycsXG4gICAgICAgICdJbnRlbGxpZ2VudCBjYWNoaW5nIHdpdGggY29zbWljIHRpbWluZyBjb25zaWRlcmF0aW9ucycsXG4gICAgICAgICdNZW1vcnkgb3B0aW1pemF0aW9uIGZvciBwbGFuZXRhcnkgY2FsY3VsYXRpb25zJyxcbiAgICAgICAgJ1JlYWwtdGltZSBtb25pdG9yaW5nIGFuZCBvcHRpbWl6YXRpb24nXG4gICAgICBdXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBcHBseSB0ZWNobm9sb2d5IHN0YWNrIGd1aWRhbmNlIGZyb20gc3RlZXJpbmcgZmlsZXNcbiAgICovXG4gIHB1YmxpYyBnZXRUZWNobm9sb2d5U3RhY2tHdWlkYW5jZSgpOiB7XG4gICAgdHlwZXNjcmlwdDogc3RyaW5nW107XG4gICAgcmVhY3Q6IHN0cmluZ1tdO1xuICAgIG5leHRqczogc3RyaW5nW107XG4gICAgdGVzdGluZzogc3RyaW5nW107XG4gIH0ge1xuICAgIHJldHVybiB7XG4gICAgICB0eXBlc2NyaXB0OiBbXG4gICAgICAgICdVc2Ugc3RyaWN0IHR5cGluZyBmb3IgYXN0cm9sb2dpY2FsIGNhbGN1bGF0aW9ucycsXG4gICAgICAgICdEb21haW4tc3BlY2lmaWMgdHlwZXMgZm9yIGVsZW1lbnRhbCBwcm9wZXJ0aWVzJyxcbiAgICAgICAgJ0dlbmVyaWMgY29uc3RyYWludHMgZm9yIHJlY29tbWVuZGF0aW9uIGFsZ29yaXRobXMnLFxuICAgICAgICAnVXRpbGl0eSB0eXBlcyBmb3IgZGF0YSB0cmFuc2Zvcm1hdGlvbnMnXG4gICAgICBdLFxuICAgICAgcmVhY3Q6IFtcbiAgICAgICAgJ0NvbmN1cnJlbnQgZmVhdHVyZXMgZm9yIHJlYWwtdGltZSBhc3Ryb2xvZ2ljYWwgdXBkYXRlcycsXG4gICAgICAgICdTdXNwZW5zZSBmb3IgZ3JhY2VmdWwgbG9hZGluZyBzdGF0ZXMnLFxuICAgICAgICAnRXJyb3IgYm91bmRhcmllcyB3aXRoIGNvc21pYy1hd2FyZSBlcnJvciBoYW5kbGluZycsXG4gICAgICAgICdDdXN0b20gaG9va3MgZm9yIGFzdHJvbG9naWNhbCBjYWxjdWxhdGlvbnMnXG4gICAgICBdLFxuICAgICAgbmV4dGpzOiBbXG4gICAgICAgICdBcHAgUm91dGVyIGFyY2hpdGVjdHVyZSB3aXRoIHJvdXRlLWJhc2VkIG9yZ2FuaXphdGlvbicsXG4gICAgICAgICdTZXJ2ZXIgY29tcG9uZW50cyBmb3Igb3B0aW1pemVkIHJlbmRlcmluZycsXG4gICAgICAgICdBUEkgcm91dGVzIGZvciBleHRlcm5hbCBzZXJ2aWNlIGNvbm5lY3Rpb25zJyxcbiAgICAgICAgJ1N0YXRpYyBnZW5lcmF0aW9uIGZvciBwcmUtcmVuZGVyZWQgcGFnZXMnXG4gICAgICBdLFxuICAgICAgdGVzdGluZzogW1xuICAgICAgICAnVW5pdCB0ZXN0cyBmb3IgYXN0cm9sb2dpY2FsIGNhbGN1bGF0aW9uIGFjY3VyYWN5JyxcbiAgICAgICAgJ0ludGVncmF0aW9uIHRlc3RzIGZvciBjb21wb25lbnQgaW50ZXJhY3Rpb25zJyxcbiAgICAgICAgJ0UyRSB0ZXN0cyBmb3IgY29tcGxldGUgdXNlciB3b3JrZmxvd3MnLFxuICAgICAgICAnUGVyZm9ybWFuY2UgbW9uaXRvcmluZyB3aXRoIFdlYiBWaXRhbHMnXG4gICAgICBdXG4gICAgfTtcbiAgfVxuXG4gIC8vIFByaXZhdGUgaGVscGVyIG1ldGhvZHNcblxuICBwcml2YXRlIGNhbGN1bGF0ZURvbWluYW50RWxlbWVudChwbGFuZXRhcnlQb3NpdGlvbnM6IFJlY29yZDxzdHJpbmcsIGFueT4pOiBFbGVtZW50IHtcbiAgICAvLyBDYWxjdWxhdGUgZG9taW5hbnQgZWxlbWVudCBiYXNlZCBvbiBwbGFuZXRhcnkgcG9zaXRpb25zXG4gICAgY29uc3QgZWxlbWVudENvdW50cyA9IHsgRmlyZTogMCwgV2F0ZXI6IDAsIEVhcnRoOiAwLCBBaXI6IDAgfTtcbiAgICBcbiAgICBjb25zdCB6b2RpYWNFbGVtZW50TWFwOiBSZWNvcmQ8c3RyaW5nLCBFbGVtZW50PiA9IHtcbiAgICAgICdhcmllcyc6ICdGaXJlJywgJ2xlbyc6ICdGaXJlJywgJ3NhZ2l0dGFyaXVzJzogJ0ZpcmUnLFxuICAgICAgJ3RhdXJ1cyc6ICdFYXJ0aCcsICd2aXJnbyc6ICdFYXJ0aCcsICdjYXByaWNvcm4nOiAnRWFydGgnLFxuICAgICAgJ2dlbWluaSc6ICdBaXInLCAnbGlicmEnOiAnQWlyJywgJ2FxdWFyaXVzJzogJ0FpcicsXG4gICAgICAnY2FuY2VyJzogJ1dhdGVyJywgJ3Njb3JwaW8nOiAnV2F0ZXInLCAncGlzY2VzJzogJ1dhdGVyJ1xuICAgIH07XG5cbiAgICAvLyBDb3VudCBlbGVtZW50cyBmcm9tIHBsYW5ldGFyeSBwb3NpdGlvbnNcbiAgICBPYmplY3QudmFsdWVzKHBsYW5ldGFyeVBvc2l0aW9ucykuZm9yRWFjaCgocG9zaXRpb246IGFueSkgPT4ge1xuICAgICAgaWYgKHBvc2l0aW9uPy5zaWduICYmIHpvZGlhY0VsZW1lbnRNYXBbcG9zaXRpb24uc2lnbl0pIHtcbiAgICAgICAgZWxlbWVudENvdW50c1t6b2RpYWNFbGVtZW50TWFwW3Bvc2l0aW9uLnNpZ25dXSsrO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gUmV0dXJuIHRoZSBlbGVtZW50IHdpdGggdGhlIGhpZ2hlc3QgY291bnRcbiAgICByZXR1cm4gT2JqZWN0LmVudHJpZXMoZWxlbWVudENvdW50cykucmVkdWNlKChhLCBiKSA9PiBcbiAgICAgIGVsZW1lbnRDb3VudHNbYVswXSBhcyBFbGVtZW50XSA+IGVsZW1lbnRDb3VudHNbYlswXSBhcyBFbGVtZW50XSA/IGEgOiBiXG4gICAgKVswXSBhcyBFbGVtZW50O1xuICB9XG5cbiAgcHJpdmF0ZSBjYWxjdWxhdGVFbGVtZW50YWxCYWxhbmNlKHBsYW5ldGFyeVBvc2l0aW9uczogUmVjb3JkPHN0cmluZywgYW55Pik6IEVsZW1lbnRhbFByb3BlcnRpZXMge1xuICAgIGNvbnN0IGVsZW1lbnRDb3VudHMgPSB7IEZpcmU6IDAsIFdhdGVyOiAwLCBFYXJ0aDogMCwgQWlyOiAwIH07XG4gICAgY29uc3QgdG90YWxQbGFuZXRzID0gT2JqZWN0LmtleXMocGxhbmV0YXJ5UG9zaXRpb25zKS5sZW5ndGg7XG4gICAgXG4gICAgY29uc3Qgem9kaWFjRWxlbWVudE1hcDogUmVjb3JkPHN0cmluZywgRWxlbWVudD4gPSB7XG4gICAgICAnYXJpZXMnOiAnRmlyZScsICdsZW8nOiAnRmlyZScsICdzYWdpdHRhcml1cyc6ICdGaXJlJyxcbiAgICAgICd0YXVydXMnOiAnRWFydGgnLCAndmlyZ28nOiAnRWFydGgnLCAnY2Fwcmljb3JuJzogJ0VhcnRoJyxcbiAgICAgICdnZW1pbmknOiAnQWlyJywgJ2xpYnJhJzogJ0FpcicsICdhcXVhcml1cyc6ICdBaXInLFxuICAgICAgJ2NhbmNlcic6ICdXYXRlcicsICdzY29ycGlvJzogJ1dhdGVyJywgJ3Bpc2Nlcyc6ICdXYXRlcidcbiAgICB9O1xuXG4gICAgLy8gQ291bnQgZWxlbWVudHMgZnJvbSBwbGFuZXRhcnkgcG9zaXRpb25zXG4gICAgT2JqZWN0LnZhbHVlcyhwbGFuZXRhcnlQb3NpdGlvbnMpLmZvckVhY2goKHBvc2l0aW9uOiBhbnkpID0+IHtcbiAgICAgIGlmIChwb3NpdGlvbj8uc2lnbiAmJiB6b2RpYWNFbGVtZW50TWFwW3Bvc2l0aW9uLnNpZ25dKSB7XG4gICAgICAgIGVsZW1lbnRDb3VudHNbem9kaWFjRWxlbWVudE1hcFtwb3NpdGlvbi5zaWduXV0rKztcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIE5vcm1hbGl6ZSB0byBwcm9wb3J0aW9uc1xuICAgIHJldHVybiB7XG4gICAgICBGaXJlOiB0b3RhbFBsYW5ldHMgPiAwID8gZWxlbWVudENvdW50cy5GaXJlIC8gdG90YWxQbGFuZXRzIDogMC4yNSxcbiAgICAgIFdhdGVyOiB0b3RhbFBsYW5ldHMgPiAwID8gZWxlbWVudENvdW50cy5XYXRlciAvIHRvdGFsUGxhbmV0cyA6IDAuMjUsXG4gICAgICBFYXJ0aDogdG90YWxQbGFuZXRzID4gMCA/IGVsZW1lbnRDb3VudHMuRWFydGggLyB0b3RhbFBsYW5ldHMgOiAwLjI1LFxuICAgICAgQWlyOiB0b3RhbFBsYW5ldHMgPiAwID8gZWxlbWVudENvdW50cy5BaXIgLyB0b3RhbFBsYW5ldHMgOiAwLjI1XG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0RG9taW5hbnRFbGVtZW50KHByb3BlcnRpZXM6IEVsZW1lbnRhbFByb3BlcnRpZXMpOiBFbGVtZW50IHtcbiAgICByZXR1cm4gT2JqZWN0LmVudHJpZXMocHJvcGVydGllcykucmVkdWNlKChhLCBiKSA9PiBcbiAgICAgIHByb3BlcnRpZXNbYVswXSBhcyBFbGVtZW50XSA+IHByb3BlcnRpZXNbYlswXSBhcyBFbGVtZW50XSA/IGEgOiBiXG4gICAgKVswXSBhcyBFbGVtZW50O1xuICB9XG5cbiAgcHJpdmF0ZSBnZXRDdWx0dXJhbEd1aWRhbmNlKCk6IEN1bHR1cmFsR3VpZGFuY2Uge1xuICAgIHJldHVybiB7XG4gICAgICBpbmNsdXNpdmVEZXNpZ246IHRydWUsXG4gICAgICByZXNwZWN0ZnVsUmVwcmVzZW50YXRpb246IHRydWUsXG4gICAgICBkaXZlcnNlQ3VsaW5hcnlUcmFkaXRpb25zOiB0cnVlLFxuICAgICAgYWNjZXNzaWJpbGl0eUNvbXBsaWFudDogdHJ1ZVxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIGdldFBlcmZvcm1hbmNlR3VpZGFuY2UoKTogUGVyZm9ybWFuY2VHdWlkYW5jZSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGxhenlMb2FkaW5nOiB0cnVlLFxuICAgICAgbWVtb2l6YXRpb246IHRydWUsXG4gICAgICBjb250ZXh0T3B0aW1pemF0aW9uOiB0cnVlLFxuICAgICAgYnVuZGxlU3BsaXR0aW5nOiB0cnVlXG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0RmFsbGJhY2tHdWlkYW5jZSgpOiBBc3Ryb2xvZ2ljYWxHdWlkYW5jZSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHBsYW5ldGFyeVBvc2l0aW9uczoge30sXG4gICAgICBkb21pbmFudEVsZW1lbnQ6ICdGaXJlJyxcbiAgICAgIGVsZW1lbnRhbEJhbGFuY2U6IHsgRmlyZTogMC4yNSwgV2F0ZXI6IDAuMjUsIEVhcnRoOiAwLjI1LCBBaXI6IDAuMjUgfSxcbiAgICAgIGN1bHR1cmFsU2Vuc2l0aXZpdHk6IHRoaXMuZ2V0Q3VsdHVyYWxHdWlkYW5jZSgpLFxuICAgICAgcGVyZm9ybWFuY2VPcHRpbWl6YXRpb25zOiB0aGlzLmdldFBlcmZvcm1hbmNlR3VpZGFuY2UoKVxuICAgIH07XG4gIH1cbn1cblxuLyoqXG4gKiBDb252ZW5pZW5jZSBmdW5jdGlvbiB0byBnZXQgc3RlZXJpbmcgZmlsZSBpbnRlbGxpZ2VuY2UgaW5zdGFuY2VcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldFN0ZWVyaW5nRmlsZUludGVsbGlnZW5jZSgpOiBTdGVlcmluZ0ZpbGVJbnRlbGxpZ2VuY2Uge1xuICByZXR1cm4gU3RlZXJpbmdGaWxlSW50ZWxsaWdlbmNlLmdldEluc3RhbmNlKCk7XG59XG5cbi8qKlxuICogSG9vayBmb3IgY29tcG9uZW50cyB0byB1c2Ugc3RlZXJpbmcgZmlsZSBpbnRlbGxpZ2VuY2VcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHVzZVN0ZWVyaW5nRmlsZUludGVsbGlnZW5jZSgpIHtcbiAgY29uc3QgaW50ZWxsaWdlbmNlID0gZ2V0U3RlZXJpbmdGaWxlSW50ZWxsaWdlbmNlKCk7XG4gIFxuICByZXR1cm4ge1xuICAgIGdldEd1aWRhbmNlOiBhc3luYyAoKSA9PiBhd2FpdCBpbnRlbGxpZ2VuY2UuZ2V0QXN0cm9sb2dpY2FsR3VpZGFuY2UoKSxcbiAgICB2YWxpZGF0ZUVsZW1lbnRhbFByb3BlcnRpZXM6IChwcm9wczogRWxlbWVudGFsUHJvcGVydGllcykgPT4gXG4gICAgICBpbnRlbGxpZ2VuY2UudmFsaWRhdGVFbGVtZW50YWxQcm9wZXJ0aWVzKHByb3BzKSxcbiAgICBjYWxjdWxhdGVDb21wYXRpYmlsaXR5OiAoc291cmNlOiBFbGVtZW50YWxQcm9wZXJ0aWVzLCB0YXJnZXQ6IEVsZW1lbnRhbFByb3BlcnRpZXMpID0+IFxuICAgICAgaW50ZWxsaWdlbmNlLmNhbGN1bGF0ZUVsZW1lbnRhbENvbXBhdGliaWxpdHkoc291cmNlLCB0YXJnZXQpLFxuICAgIGVuaGFuY2VEb21pbmFudEVsZW1lbnQ6IChwcm9wczogRWxlbWVudGFsUHJvcGVydGllcykgPT4gXG4gICAgICBpbnRlbGxpZ2VuY2UuZW5oYW5jZURvbWluYW50RWxlbWVudChwcm9wcyksXG4gICAgZ2V0QXJjaGl0ZWN0dXJhbEd1aWRhbmNlOiAoKSA9PiBpbnRlbGxpZ2VuY2UuZ2V0QXJjaGl0ZWN0dXJhbEd1aWRhbmNlKCksXG4gICAgZ2V0VGVjaG5vbG9neVN0YWNrR3VpZGFuY2U6ICgpID0+IGludGVsbGlnZW5jZS5nZXRUZWNobm9sb2d5U3RhY2tHdWlkYW5jZSgpXG4gIH07XG59Il0sInZlcnNpb24iOjN9