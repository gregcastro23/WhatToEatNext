1c88a790c18dc8f5d76c51eb0f2b45cc
"use strict";
/**
 * Performance Monitoring System Tests
 * Perfect Codebase Campaign - Phase 4 Implementation Tests
 */
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
// Mock external dependencies
jest.mock('child_process');
jest.mock('fs');
const PerformanceMonitoringSystem_1 = require("./PerformanceMonitoringSystem");
const fs = __importStar(require("fs"));
const child_process_1 = require("child_process");
const mockExecSync = child_process_1.execSync;
const mockFs = fs;
describe('PerformanceMonitoringSystem', () => {
    let performanceMonitor;
    beforeEach(() => {
        performanceMonitor = new PerformanceMonitoringSystem_1.PerformanceMonitoringSystem();
        jest.clearAllMocks();
        // Mock process.hrtime.bigint for build time measurement
        const mockHrtime = jest.fn();
        mockHrtime.mockReturnValueOnce(BigInt(1000000000)); // 1 second in nanoseconds
        mockHrtime.mockReturnValueOnce(BigInt(9000000000)); // 9 seconds in nanoseconds
        process.hrtime = { bigint: mockHrtime };
        // Mock process.memoryUsage
        process.memoryUsage = jest.fn().mockReturnValue({
            heapUsed: 40 * 1024 * 1024,
            heapTotal: 50 * 1024 * 1024,
            external: 5 * 1024 * 1024,
            arrayBuffers: 1 * 1024 * 1024,
        });
    });
    afterEach(() => {
        performanceMonitor.stopMonitoring();
    });
    describe('measureBuildTime', () => {
        it('should measure build time using time command', async () => {
            mockExecSync.mockReturnValue('real 8.50\nuser 7.20\nsys 1.30\n');
            const buildTime = await performanceMonitor.measureBuildTime();
            expect(buildTime).toBe(8.5);
            expect(mockExecSync).toHaveBeenCalledWith('time -p yarn build 2>&1', {
                encoding: 'utf8',
                stdio: 'pipe',
            });
        });
        it('should fallback to simple timing if time command fails', async () => {
            mockExecSync
                .mockImplementationOnce(() => {
                throw new Error('time command not found');
            })
                .mockReturnValueOnce('Build completed successfully');
            // Mock Date.now for timing
            const mockDateNow = jest.spyOn(Date, 'now');
            mockDateNow.mockReturnValueOnce(1000).mockReturnValueOnce(9000); // 8 second difference
            const buildTime = await performanceMonitor.measureBuildTime();
            expect(buildTime).toBe(8); // 8 seconds
            expect(mockExecSync).toHaveBeenCalledWith('yarn build', {
                encoding: 'utf8',
                stdio: 'pipe',
            });
            mockDateNow.mockRestore();
        });
        it('should return -1 if build fails', async () => {
            mockExecSync.mockImplementation(() => {
                throw new Error('Build failed');
            });
            const buildTime = await performanceMonitor.measureBuildTime();
            expect(buildTime).toBe(-1);
        });
    });
    describe('monitorCacheHitRate', () => {
        it('should estimate cache hit rate from Next.js cache', async () => {
            mockFs.existsSync.mockImplementation((path) => {
                return path === '.next' || path === '.next/cache';
            });
            mockExecSync.mockReturnValue('150\n'); // 150 cache files
            const cacheHitRate = await performanceMonitor.monitorCacheHitRate();
            expect(cacheHitRate).toBeGreaterThan(0);
            expect(cacheHitRate).toBeLessThanOrEqual(1);
        });
        it('should estimate cache hit rate from other cache directories', async () => {
            mockFs.existsSync.mockImplementation((path) => {
                return path === '.yarn/cache';
            });
            mockExecSync.mockReturnValue('15000\n'); // 15MB cache size
            const cacheHitRate = await performanceMonitor.monitorCacheHitRate();
            expect(cacheHitRate).toBe(0.8); // Should return high hit rate for large cache
        });
        it('should return default estimate if cache monitoring fails', async () => {
            mockFs.existsSync.mockReturnValue(false);
            mockExecSync.mockImplementation(() => {
                throw new Error('Cache monitoring failed');
            });
            const cacheHitRate = await performanceMonitor.monitorCacheHitRate();
            expect(cacheHitRate).toBe(0.6); // Default estimate for small cache
        });
    });
    describe('trackMemoryUsage', () => {
        it('should track Node.js process memory usage', async () => {
            const memoryUsage = await performanceMonitor.trackMemoryUsage();
            expect(memoryUsage.current).toBe(40); // 40MB from mock
            expect(memoryUsage.peak).toBe(50); // 50MB from mock
        });
        it('should include system memory if available', async () => {
            mockExecSync.mockReturnValue('  1234  100000  51200  node\n'); // 50MB RSS
            const memoryUsage = await performanceMonitor.trackMemoryUsage();
            expect(memoryUsage.current).toBe(50); // Should use system memory (higher)
            expect(memoryUsage.peak).toBe(50);
        });
        it('should handle memory tracking errors gracefully', async () => {
            process.memoryUsage.mockImplementation(() => {
                throw new Error('Memory tracking failed');
            });
            const memoryUsage = await performanceMonitor.trackMemoryUsage();
            expect(memoryUsage.current).toBe(0);
            expect(memoryUsage.peak).toBe(0);
        });
    });
    describe('detectPerformanceRegression', () => {
        it('should detect build time regression', async () => {
            // Add performance history with increasing build times
            const mockMetrics1 = {
                buildTime: { current: 5, target: 10, average: 5, trend: 'stable' },
                cacheHitRate: {
                    current: 0.8,
                    target: 0.8,
                    average: 0.8,
                    trend: 'stable',
                },
                memoryUsage: { current: 40, target: 50, peak: 45, average: 40 },
                bundleSize: {
                    current: 400,
                    target: 420,
                    compressed: 280,
                    trend: 'stable',
                },
            };
            const mockMetrics2 = {
                ...mockMetrics1,
                buildTime: { current: 7, target: 10, average: 6, trend: 'degrading' },
            };
            const mockMetrics3 = {
                ...mockMetrics1,
                buildTime: { current: 9, target: 10, average: 7, trend: 'degrading' },
            };
            // Manually add to history
            performanceMonitor.performanceHistory = [
                mockMetrics1,
                mockMetrics2,
                mockMetrics3,
            ];
            const regressionDetected = await performanceMonitor.detectPerformanceRegression();
            expect(regressionDetected).toBe(true);
            const alerts = performanceMonitor.getCurrentAlerts();
            expect(alerts).toHaveLength(1);
            expect(alerts[0].type).toBe('build_time');
            expect(alerts[0].severity).toBe('warning');
        });
        it('should detect cache hit rate regression', async () => {
            const mockMetrics1 = {
                buildTime: { current: 8, target: 10, average: 8, trend: 'stable' },
                cacheHitRate: {
                    current: 0.9,
                    target: 0.8,
                    average: 0.9,
                    trend: 'stable',
                },
                memoryUsage: { current: 40, target: 50, peak: 45, average: 40 },
                bundleSize: {
                    current: 400,
                    target: 420,
                    compressed: 280,
                    trend: 'stable',
                },
            };
            const mockMetrics2 = {
                ...mockMetrics1,
                cacheHitRate: {
                    current: 0.75,
                    target: 0.8,
                    average: 0.825,
                    trend: 'degrading',
                },
            };
            const mockMetrics3 = {
                ...mockMetrics1,
                cacheHitRate: {
                    current: 0.6,
                    target: 0.8,
                    average: 0.75,
                    trend: 'degrading',
                },
            };
            performanceMonitor.performanceHistory = [
                mockMetrics1,
                mockMetrics2,
                mockMetrics3,
            ];
            const regressionDetected = await performanceMonitor.detectPerformanceRegression();
            expect(regressionDetected).toBe(true);
            const alerts = performanceMonitor.getCurrentAlerts();
            expect(alerts).toHaveLength(1);
            expect(alerts[0].type).toBe('cache_hit_rate');
        });
        it('should detect memory usage regression', async () => {
            const mockMetrics1 = {
                buildTime: { current: 8, target: 10, average: 8, trend: 'stable' },
                cacheHitRate: {
                    current: 0.8,
                    target: 0.8,
                    average: 0.8,
                    trend: 'stable',
                },
                memoryUsage: { current: 30, target: 50, peak: 35, average: 30 },
                bundleSize: {
                    current: 400,
                    target: 420,
                    compressed: 280,
                    trend: 'stable',
                },
            };
            const mockMetrics2 = {
                ...mockMetrics1,
                memoryUsage: { current: 40, target: 50, peak: 45, average: 35 },
            };
            const mockMetrics3 = {
                ...mockMetrics1,
                memoryUsage: { current: 55, target: 50, peak: 60, average: 42 },
            };
            performanceMonitor.performanceHistory = [
                mockMetrics1,
                mockMetrics2,
                mockMetrics3,
            ];
            const regressionDetected = await performanceMonitor.detectPerformanceRegression();
            expect(regressionDetected).toBe(true);
            const alerts = performanceMonitor.getCurrentAlerts();
            expect(alerts).toHaveLength(1);
            expect(alerts[0].type).toBe('memory_usage');
            expect(alerts[0].severity).toBe('critical');
        });
        it('should not detect regression with insufficient data', async () => {
            const regressionDetected = await performanceMonitor.detectPerformanceRegression();
            expect(regressionDetected).toBe(false);
        });
    });
    describe('getPerformanceMetrics', () => {
        it('should return comprehensive performance metrics', async () => {
            mockExecSync
                .mockReturnValueOnce('real 8.50\nuser 7.20\nsys 1.30\n') // build time
                .mockReturnValueOnce('150\n') // cache files
                .mockReturnValueOnce('400\n'); // bundle size
            mockFs.existsSync.mockImplementation((path) => {
                return path === '.next' || path === '.next/cache';
            });
            const metrics = await performanceMonitor.getPerformanceMetrics();
            expect(metrics).toHaveProperty('buildTime');
            expect(metrics).toHaveProperty('cacheHitRate');
            expect(metrics).toHaveProperty('memoryUsage');
            expect(metrics).toHaveProperty('bundleSize');
            expect(metrics.buildTime.current).toBe(8.5);
            expect(metrics.buildTime.target).toBe(10);
            expect(metrics.memoryUsage.current).toBe(40);
            expect(metrics.memoryUsage.target).toBe(50);
        });
        it('should calculate trends correctly', async () => {
            // First measurement
            mockExecSync.mockReturnValue('real 8.00\n');
            mockFs.existsSync.mockReturnValue(false);
            const metrics1 = await performanceMonitor.getPerformanceMetrics();
            // Add more measurements to establish trend (need at least 3 for trend calculation)
            mockExecSync.mockReturnValue('real 7.50\n');
            const metrics2 = await performanceMonitor.getPerformanceMetrics();
            // Third measurement with significant improvement
            mockExecSync.mockReturnValue('real 6.00\n');
            const metrics3 = await performanceMonitor.getPerformanceMetrics();
            expect(metrics3.buildTime.trend).toBe('improving');
        });
    });
    describe('generatePerformanceReport', () => {
        it('should generate comprehensive performance report', async () => {
            mockExecSync.mockReturnValue('real 8.50\n');
            mockFs.existsSync.mockReturnValue(false);
            const report = await performanceMonitor.generatePerformanceReport();
            expect(report).toHaveProperty('timestamp');
            expect(report).toHaveProperty('metrics');
            expect(report).toHaveProperty('alerts');
            expect(report).toHaveProperty('regressionDetected');
            expect(report).toHaveProperty('overallScore');
            expect(report).toHaveProperty('recommendations');
            expect(typeof report.overallScore).toBe('number');
            expect(report.overallScore).toBeGreaterThanOrEqual(0);
            expect(report.overallScore).toBeLessThanOrEqual(100);
        });
        it('should include recommendations for performance issues', async () => {
            mockExecSync.mockReturnValue('real 15.00\n'); // Exceeds 10s target
            mockFs.existsSync.mockReturnValue(false);
            const report = await performanceMonitor.generatePerformanceReport();
            expect(report.recommendations.length).toBeGreaterThan(0);
            expect(report.recommendations[0]).toContain('Build time');
            expect(report.recommendations[0]).toContain('exceeds target');
        });
    });
    describe('monitoring lifecycle', () => {
        it('should start and stop continuous monitoring', () => {
            jest.useFakeTimers();
            // Mock setInterval and clearInterval
            const mockSetInterval = jest.spyOn(global, 'setInterval');
            const mockClearInterval = jest.spyOn(global, 'clearInterval');
            performanceMonitor.startMonitoring(1); // 1 minute interval
            expect(mockSetInterval).toHaveBeenCalledWith(expect.any(Function), 60000);
            performanceMonitor.stopMonitoring();
            expect(mockClearInterval).toHaveBeenCalled();
            mockSetInterval.mockRestore();
            mockClearInterval.mockRestore();
            jest.useRealTimers();
        });
    });
    describe('data export', () => {
        it('should export performance data to file', async () => {
            mockFs.writeFileSync.mockImplementation(() => { });
            mockExecSync.mockReturnValue('real 8.50\n');
            mockFs.existsSync.mockReturnValue(false);
            await performanceMonitor.exportPerformanceData('./test-performance-data.json');
            expect(mockFs.writeFileSync).toHaveBeenCalledWith('./test-performance-data.json', expect.stringContaining('"timestamp"'));
        });
        it('should handle export errors gracefully', async () => {
            mockFs.writeFileSync.mockImplementation(() => {
                throw new Error('Write failed');
            });
            await expect(performanceMonitor.exportPerformanceData('./test-performance-data.json')).rejects.toThrow('Failed to export performance data');
        });
    });
    describe('alert management', () => {
        it('should manage alerts correctly', () => {
            const initialAlerts = performanceMonitor.getCurrentAlerts();
            expect(initialAlerts).toHaveLength(0);
            // Add alert through private method (simulate regression detection)
            const mockAlert = {
                type: 'build_time',
                severity: 'warning',
                message: 'Test alert',
                currentValue: 15,
                targetValue: 10,
                timestamp: new Date(),
                recommendations: ['Test recommendation'],
            };
            performanceMonitor.addAlert(mockAlert);
            const alertsAfterAdd = performanceMonitor.getCurrentAlerts();
            expect(alertsAfterAdd).toHaveLength(1);
            expect(alertsAfterAdd[0]).toEqual(mockAlert);
            performanceMonitor.clearAlerts();
            const alertsAfterClear = performanceMonitor.getCurrentAlerts();
            expect(alertsAfterClear).toHaveLength(0);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9zZXJ2aWNlcy9jYW1wYWlnbi9QZXJmb3JtYW5jZU1vbml0b3JpbmdTeXN0ZW0udGVzdC50cyIsIm1hcHBpbmdzIjoiO0FBQUE7OztHQUdHOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBVUgsNkJBQTZCO0FBQzdCLElBQUksQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDLENBQUM7QUFDM0IsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztBQVZoQiwrRUFJdUM7QUFDdkMsdUNBQXlCO0FBQ3pCLGlEQUF5QztBQU16QyxNQUFNLFlBQVksR0FBRyx3QkFBZ0QsQ0FBQztBQUN0RSxNQUFNLE1BQU0sR0FBRyxFQUE0QixDQUFDO0FBRTVDLFFBQVEsQ0FBQyw2QkFBNkIsRUFBRSxHQUFHLEVBQUU7SUFDM0MsSUFBSSxrQkFBK0MsQ0FBQztJQUVwRCxVQUFVLENBQUMsR0FBRyxFQUFFO1FBQ2Qsa0JBQWtCLEdBQUcsSUFBSSx5REFBMkIsRUFBRSxDQUFDO1FBQ3ZELElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztRQUVyQix3REFBd0Q7UUFDeEQsTUFBTSxVQUFVLEdBQUcsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDO1FBQzdCLFVBQVUsQ0FBQyxtQkFBbUIsQ0FBQyxNQUFNLENBQUMsVUFBVSxDQUFDLENBQUMsQ0FBQyxDQUFDLDBCQUEwQjtRQUM5RSxVQUFVLENBQUMsbUJBQW1CLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQywyQkFBMkI7UUFDOUUsT0FBTyxDQUFDLE1BQWMsR0FBRyxFQUFFLE1BQU0sRUFBRSxVQUFVLEVBQUUsQ0FBQztRQUVqRCwyQkFBMkI7UUFDMUIsT0FBTyxDQUFDLFdBQXlCLEdBQUcsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGVBQWUsQ0FBQztZQUM3RCxRQUFRLEVBQUUsRUFBRSxHQUFHLElBQUksR0FBRyxJQUFJO1lBQzFCLFNBQVMsRUFBRSxF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QUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9zZXJ2aWNlcy9jYW1wYWlnbi9QZXJmb3JtYW5jZU1vbml0b3JpbmdTeXN0ZW0udGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFBlcmZvcm1hbmNlIE1vbml0b3JpbmcgU3lzdGVtIFRlc3RzXG4gKiBQZXJmZWN0IENvZGViYXNlIENhbXBhaWduIC0gUGhhc2UgNCBJbXBsZW1lbnRhdGlvbiBUZXN0c1xuICovXG5cbmltcG9ydCB7XG4gIFBlcmZvcm1hbmNlTW9uaXRvcmluZ1N5c3RlbSxcbiAgUGVyZm9ybWFuY2VNZXRyaWNzLFxuICBQZXJmb3JtYW5jZUFsZXJ0LFxufSBmcm9tICcuL1BlcmZvcm1hbmNlTW9uaXRvcmluZ1N5c3RlbSc7XG5pbXBvcnQgKiBhcyBmcyBmcm9tICdmcyc7XG5pbXBvcnQgeyBleGVjU3luYyB9IGZyb20gJ2NoaWxkX3Byb2Nlc3MnO1xuXG4vLyBNb2NrIGV4dGVybmFsIGRlcGVuZGVuY2llc1xuamVzdC5tb2NrKCdjaGlsZF9wcm9jZXNzJyk7XG5qZXN0Lm1vY2soJ2ZzJyk7XG5cbmNvbnN0IG1vY2tFeGVjU3luYyA9IGV4ZWNTeW5jIGFzIGplc3QuTW9ja2VkRnVuY3Rpb248dHlwZW9mIGV4ZWNTeW5jPjtcbmNvbnN0IG1vY2tGcyA9IGZzIGFzIGplc3QuTW9ja2VkPHR5cGVvZiBmcz47XG5cbmRlc2NyaWJlKCdQZXJmb3JtYW5jZU1vbml0b3JpbmdTeXN0ZW0nLCAoKSA9PiB7XG4gIGxldCBwZXJmb3JtYW5jZU1vbml0b3I6IFBlcmZvcm1hbmNlTW9uaXRvcmluZ1N5c3RlbTtcblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBwZXJmb3JtYW5jZU1vbml0b3IgPSBuZXcgUGVyZm9ybWFuY2VNb25pdG9yaW5nU3lzdGVtKCk7XG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG5cbiAgICAvLyBNb2NrIHByb2Nlc3MuaHJ0aW1lLmJpZ2ludCBmb3IgYnVpbGQgdGltZSBtZWFzdXJlbWVudFxuICAgIGNvbnN0IG1vY2tIcnRpbWUgPSBqZXN0LmZuKCk7XG4gICAgbW9ja0hydGltZS5tb2NrUmV0dXJuVmFsdWVPbmNlKEJpZ0ludCgxMDAwMDAwMDAwKSk7IC8vIDEgc2Vjb25kIGluIG5hbm9zZWNvbmRzXG4gICAgbW9ja0hydGltZS5tb2NrUmV0dXJuVmFsdWVPbmNlKEJpZ0ludCg5MDAwMDAwMDAwKSk7IC8vIDkgc2Vjb25kcyBpbiBuYW5vc2Vjb25kc1xuICAgIChwcm9jZXNzLmhydGltZSBhcyBhbnkpID0geyBiaWdpbnQ6IG1vY2tIcnRpbWUgfTtcblxuICAgIC8vIE1vY2sgcHJvY2Vzcy5tZW1vcnlVc2FnZVxuICAgIChwcm9jZXNzLm1lbW9yeVVzYWdlIGFzIGplc3QuTW9jaykgPSBqZXN0LmZuKCkubW9ja1JldHVyblZhbHVlKHtcbiAgICAgIGhlYXBVc2VkOiA0MCAqIDEwMjQgKiAxMDI0LCAvLyA0ME1CXG4gICAgICBoZWFwVG90YWw6IDUwICogMTAyNCAqIDEwMjQsIC8vIDUwTUJcbiAgICAgIGV4dGVybmFsOiA1ICogMTAyNCAqIDEwMjQsXG4gICAgICBhcnJheUJ1ZmZlcnM6IDEgKiAxMDI0ICogMTAyNCxcbiAgICB9KTtcbiAgfSk7XG5cbiAgYWZ0ZXJFYWNoKCgpID0+IHtcbiAgICBwZXJmb3JtYW5jZU1vbml0b3Iuc3RvcE1vbml0b3JpbmcoKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ21lYXN1cmVCdWlsZFRpbWUnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBtZWFzdXJlIGJ1aWxkIHRpbWUgdXNpbmcgdGltZSBjb21tYW5kJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja0V4ZWNTeW5jLm1vY2tSZXR1cm5WYWx1ZSgncmVhbCA4LjUwXFxudXNlciA3LjIwXFxuc3lzIDEuMzBcXG4nKTtcblxuICAgICAgY29uc3QgYnVpbGRUaW1lID0gYXdhaXQgcGVyZm9ybWFuY2VNb25pdG9yLm1lYXN1cmVCdWlsZFRpbWUoKTtcblxuICAgICAgZXhwZWN0KGJ1aWxkVGltZSkudG9CZSg4LjUpO1xuICAgICAgZXhwZWN0KG1vY2tFeGVjU3luYykudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3RpbWUgLXAgeWFybiBidWlsZCAyPiYxJywge1xuICAgICAgICBlbmNvZGluZzogJ3V0ZjgnLFxuICAgICAgICBzdGRpbzogJ3BpcGUnLFxuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGZhbGxiYWNrIHRvIHNpbXBsZSB0aW1pbmcgaWYgdGltZSBjb21tYW5kIGZhaWxzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja0V4ZWNTeW5jXG4gICAgICAgIC5tb2NrSW1wbGVtZW50YXRpb25PbmNlKCgpID0+IHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ3RpbWUgY29tbWFuZCBub3QgZm91bmQnKTtcbiAgICAgICAgfSlcbiAgICAgICAgLm1vY2tSZXR1cm5WYWx1ZU9uY2UoJ0J1aWxkIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHknKTtcblxuICAgICAgLy8gTW9jayBEYXRlLm5vdyBmb3IgdGltaW5nXG4gICAgICBjb25zdCBtb2NrRGF0ZU5vdyA9IGplc3Quc3B5T24oRGF0ZSwgJ25vdycpO1xuICAgICAgbW9ja0RhdGVOb3cubW9ja1JldHVyblZhbHVlT25jZSgxMDAwKS5tb2NrUmV0dXJuVmFsdWVPbmNlKDkwMDApOyAvLyA4IHNlY29uZCBkaWZmZXJlbmNlXG5cbiAgICAgIGNvbnN0IGJ1aWxkVGltZSA9IGF3YWl0IHBlcmZvcm1hbmNlTW9uaXRvci5tZWFzdXJlQnVpbGRUaW1lKCk7XG5cbiAgICAgIGV4cGVjdChidWlsZFRpbWUpLnRvQmUoOCk7IC8vIDggc2Vjb25kc1xuICAgICAgZXhwZWN0KG1vY2tFeGVjU3luYykudG9IYXZlQmVlbkNhbGxlZFdpdGgoJ3lhcm4gYnVpbGQnLCB7XG4gICAgICAgIGVuY29kaW5nOiAndXRmOCcsXG4gICAgICAgIHN0ZGlvOiAncGlwZScsXG4gICAgICB9KTtcblxuICAgICAgbW9ja0RhdGVOb3cubW9ja1Jlc3RvcmUoKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIC0xIGlmIGJ1aWxkIGZhaWxzJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja0V4ZWNTeW5jLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignQnVpbGQgZmFpbGVkJyk7XG4gICAgICB9KTtcblxuICAgICAgY29uc3QgYnVpbGRUaW1lID0gYXdhaXQgcGVyZm9ybWFuY2VNb25pdG9yLm1lYXN1cmVCdWlsZFRpbWUoKTtcblxuICAgICAgZXhwZWN0KGJ1aWxkVGltZSkudG9CZSgtMSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdtb25pdG9yQ2FjaGVIaXRSYXRlJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZXN0aW1hdGUgY2FjaGUgaGl0IHJhdGUgZnJvbSBOZXh0LmpzIGNhY2hlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja0ZzLmV4aXN0c1N5bmMubW9ja0ltcGxlbWVudGF0aW9uKChwYXRoOiBzdHJpbmcpID0+IHtcbiAgICAgICAgcmV0dXJuIHBhdGggPT09ICcubmV4dCcgfHwgcGF0aCA9PT0gJy5uZXh0L2NhY2hlJztcbiAgICAgIH0pO1xuXG4gICAgICBtb2NrRXhlY1N5bmMubW9ja1JldHVyblZhbHVlKCcxNTBcXG4nKTsgLy8gMTUwIGNhY2hlIGZpbGVzXG5cbiAgICAgIGNvbnN0IGNhY2hlSGl0UmF0ZSA9IGF3YWl0IHBlcmZvcm1hbmNlTW9uaXRvci5tb25pdG9yQ2FjaGVIaXRSYXRlKCk7XG5cbiAgICAgIGV4cGVjdChjYWNoZUhpdFJhdGUpLnRvQmVHcmVhdGVyVGhhbigwKTtcbiAgICAgIGV4cGVjdChjYWNoZUhpdFJhdGUpLnRvQmVMZXNzVGhhbk9yRXF1YWwoMSk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGVzdGltYXRlIGNhY2hlIGhpdCByYXRlIGZyb20gb3RoZXIgY2FjaGUgZGlyZWN0b3JpZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrRnMuZXhpc3RzU3luYy5tb2NrSW1wbGVtZW50YXRpb24oKHBhdGg6IHN0cmluZykgPT4ge1xuICAgICAgICByZXR1cm4gcGF0aCA9PT0gJy55YXJuL2NhY2hlJztcbiAgICAgIH0pO1xuXG4gICAgICBtb2NrRXhlY1N5bmMubW9ja1JldHVyblZhbHVlKCcxNTAwMFxcbicpOyAvLyAxNU1CIGNhY2hlIHNpemVcblxuICAgICAgY29uc3QgY2FjaGVIaXRSYXRlID0gYXdhaXQgcGVyZm9ybWFuY2VNb25pdG9yLm1vbml0b3JDYWNoZUhpdFJhdGUoKTtcblxuICAgICAgZXhwZWN0KGNhY2hlSGl0UmF0ZSkudG9CZSgwLjgpOyAvLyBTaG91bGQgcmV0dXJuIGhpZ2ggaGl0IHJhdGUgZm9yIGxhcmdlIGNhY2hlXG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIHJldHVybiBkZWZhdWx0IGVzdGltYXRlIGlmIGNhY2hlIG1vbml0b3JpbmcgZmFpbHMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrRnMuZXhpc3RzU3luYy5tb2NrUmV0dXJuVmFsdWUoZmFsc2UpO1xuICAgICAgbW9ja0V4ZWNTeW5jLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignQ2FjaGUgbW9uaXRvcmluZyBmYWlsZWQnKTtcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBjYWNoZUhpdFJhdGUgPSBhd2FpdCBwZXJmb3JtYW5jZU1vbml0b3IubW9uaXRvckNhY2hlSGl0UmF0ZSgpO1xuXG4gICAgICBleHBlY3QoY2FjaGVIaXRSYXRlKS50b0JlKDAuNik7IC8vIERlZmF1bHQgZXN0aW1hdGUgZm9yIHNtYWxsIGNhY2hlXG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCd0cmFja01lbW9yeVVzYWdlJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgdHJhY2sgTm9kZS5qcyBwcm9jZXNzIG1lbW9yeSB1c2FnZScsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1lbW9yeVVzYWdlID0gYXdhaXQgcGVyZm9ybWFuY2VNb25pdG9yLnRyYWNrTWVtb3J5VXNhZ2UoKTtcblxuICAgICAgZXhwZWN0KG1lbW9yeVVzYWdlLmN1cnJlbnQpLnRvQmUoNDApOyAvLyA0ME1CIGZyb20gbW9ja1xuICAgICAgZXhwZWN0KG1lbW9yeVVzYWdlLnBlYWspLnRvQmUoNTApOyAvLyA1ME1CIGZyb20gbW9ja1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBpbmNsdWRlIHN5c3RlbSBtZW1vcnkgaWYgYXZhaWxhYmxlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja0V4ZWNTeW5jLm1vY2tSZXR1cm5WYWx1ZSgnICAxMjM0ICAxMDAwMDAgIDUxMjAwICBub2RlXFxuJyk7IC8vIDUwTUIgUlNTXG5cbiAgICAgIGNvbnN0IG1lbW9yeVVzYWdlID0gYXdhaXQgcGVyZm9ybWFuY2VNb25pdG9yLnRyYWNrTWVtb3J5VXNhZ2UoKTtcblxuICAgICAgZXhwZWN0KG1lbW9yeVVzYWdlLmN1cnJlbnQpLnRvQmUoNTApOyAvLyBTaG91bGQgdXNlIHN5c3RlbSBtZW1vcnkgKGhpZ2hlcilcbiAgICAgIGV4cGVjdChtZW1vcnlVc2FnZS5wZWFrKS50b0JlKDUwKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgaGFuZGxlIG1lbW9yeSB0cmFja2luZyBlcnJvcnMgZ3JhY2VmdWxseScsIGFzeW5jICgpID0+IHtcbiAgICAgIChwcm9jZXNzLm1lbW9yeVVzYWdlIGFzIGplc3QuTW9jaykubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdNZW1vcnkgdHJhY2tpbmcgZmFpbGVkJyk7XG4gICAgICB9KTtcblxuICAgICAgY29uc3QgbWVtb3J5VXNhZ2UgPSBhd2FpdCBwZXJmb3JtYW5jZU1vbml0b3IudHJhY2tNZW1vcnlVc2FnZSgpO1xuXG4gICAgICBleHBlY3QobWVtb3J5VXNhZ2UuY3VycmVudCkudG9CZSgwKTtcbiAgICAgIGV4cGVjdChtZW1vcnlVc2FnZS5wZWFrKS50b0JlKDApO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZGV0ZWN0UGVyZm9ybWFuY2VSZWdyZXNzaW9uJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZGV0ZWN0IGJ1aWxkIHRpbWUgcmVncmVzc2lvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEFkZCBwZXJmb3JtYW5jZSBoaXN0b3J5IHdpdGggaW5jcmVhc2luZyBidWlsZCB0aW1lc1xuICAgICAgY29uc3QgbW9ja01ldHJpY3MxOiBQZXJmb3JtYW5jZU1ldHJpY3MgPSB7XG4gICAgICAgIGJ1aWxkVGltZTogeyBjdXJyZW50OiA1LCB0YXJnZXQ6IDEwLCBhdmVyYWdlOiA1LCB0cmVuZDogJ3N0YWJsZScgfSxcbiAgICAgICAgY2FjaGVIaXRSYXRlOiB7XG4gICAgICAgICAgY3VycmVudDogMC44LFxuICAgICAgICAgIHRhcmdldDogMC44LFxuICAgICAgICAgIGF2ZXJhZ2U6IDAuOCxcbiAgICAgICAgICB0cmVuZDogJ3N0YWJsZScsXG4gICAgICAgIH0sXG4gICAgICAgIG1lbW9yeVVzYWdlOiB7IGN1cnJlbnQ6IDQwLCB0YXJnZXQ6IDUwLCBwZWFrOiA0NSwgYXZlcmFnZTogNDAgfSxcbiAgICAgICAgYnVuZGxlU2l6ZToge1xuICAgICAgICAgIGN1cnJlbnQ6IDQwMCxcbiAgICAgICAgICB0YXJnZXQ6IDQyMCxcbiAgICAgICAgICBjb21wcmVzc2VkOiAyODAsXG4gICAgICAgICAgdHJlbmQ6ICdzdGFibGUnLFxuICAgICAgICB9LFxuICAgICAgfTtcblxuICAgICAgY29uc3QgbW9ja01ldHJpY3MyOiBQZXJmb3JtYW5jZU1ldHJpY3MgPSB7XG4gICAgICAgIC4uLm1vY2tNZXRyaWNzMSxcbiAgICAgICAgYnVpbGRUaW1lOiB7IGN1cnJlbnQ6IDcsIHRhcmdldDogMTAsIGF2ZXJhZ2U6IDYsIHRyZW5kOiAnZGVncmFkaW5nJyB9LFxuICAgICAgfTtcblxuICAgICAgY29uc3QgbW9ja01ldHJpY3MzOiBQZXJmb3JtYW5jZU1ldHJpY3MgPSB7XG4gICAgICAgIC4uLm1vY2tNZXRyaWNzMSxcbiAgICAgICAgYnVpbGRUaW1lOiB7IGN1cnJlbnQ6IDksIHRhcmdldDogMTAsIGF2ZXJhZ2U6IDcsIHRyZW5kOiAnZGVncmFkaW5nJyB9LFxuICAgICAgfTtcblxuICAgICAgLy8gTWFudWFsbHkgYWRkIHRvIGhpc3RvcnlcbiAgICAgIChwZXJmb3JtYW5jZU1vbml0b3IgYXMgYW55KS5wZXJmb3JtYW5jZUhpc3RvcnkgPSBbXG4gICAgICAgIG1vY2tNZXRyaWNzMSxcbiAgICAgICAgbW9ja01ldHJpY3MyLFxuICAgICAgICBtb2NrTWV0cmljczMsXG4gICAgICBdO1xuXG4gICAgICBjb25zdCByZWdyZXNzaW9uRGV0ZWN0ZWQgPVxuICAgICAgICBhd2FpdCBwZXJmb3JtYW5jZU1vbml0b3IuZGV0ZWN0UGVyZm9ybWFuY2VSZWdyZXNzaW9uKCk7XG5cbiAgICAgIGV4cGVjdChyZWdyZXNzaW9uRGV0ZWN0ZWQpLnRvQmUodHJ1ZSk7XG5cbiAgICAgIGNvbnN0IGFsZXJ0cyA9IHBlcmZvcm1hbmNlTW9uaXRvci5nZXRDdXJyZW50QWxlcnRzKCk7XG4gICAgICBleHBlY3QoYWxlcnRzKS50b0hhdmVMZW5ndGgoMSk7XG4gICAgICBleHBlY3QoYWxlcnRzWzBdLnR5cGUpLnRvQmUoJ2J1aWxkX3RpbWUnKTtcbiAgICAgIGV4cGVjdChhbGVydHNbMF0uc2V2ZXJpdHkpLnRvQmUoJ3dhcm5pbmcnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgZGV0ZWN0IGNhY2hlIGhpdCByYXRlIHJlZ3Jlc3Npb24nLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrTWV0cmljczE6IFBlcmZvcm1hbmNlTWV0cmljcyA9IHtcbiAgICAgICAgYnVpbGRUaW1lOiB7IGN1cnJlbnQ6IDgsIHRhcmdldDogMTAsIGF2ZXJhZ2U6IDgsIHRyZW5kOiAnc3RhYmxlJyB9LFxuICAgICAgICBjYWNoZUhpdFJhdGU6IHtcbiAgICAgICAgICBjdXJyZW50OiAwLjksXG4gICAgICAgICAgdGFyZ2V0OiAwLjgsXG4gICAgICAgICAgYXZlcmFnZTogMC45LFxuICAgICAgICAgIHRyZW5kOiAnc3RhYmxlJyxcbiAgICAgICAgfSxcbiAgICAgICAgbWVtb3J5VXNhZ2U6IHsgY3VycmVudDogNDAsIHRhcmdldDogNTAsIHBlYWs6IDQ1LCBhdmVyYWdlOiA0MCB9LFxuICAgICAgICBidW5kbGVTaXplOiB7XG4gICAgICAgICAgY3VycmVudDogNDAwLFxuICAgICAgICAgIHRhcmdldDogNDIwLFxuICAgICAgICAgIGNvbXByZXNzZWQ6IDI4MCxcbiAgICAgICAgICB0cmVuZDogJ3N0YWJsZScsXG4gICAgICAgIH0sXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBtb2NrTWV0cmljczI6IFBlcmZvcm1hbmNlTWV0cmljcyA9IHtcbiAgICAgICAgLi4ubW9ja01ldHJpY3MxLFxuICAgICAgICBjYWNoZUhpdFJhdGU6IHtcbiAgICAgICAgICBjdXJyZW50OiAwLjc1LFxuICAgICAgICAgIHRhcmdldDogMC44LFxuICAgICAgICAgIGF2ZXJhZ2U6IDAuODI1LFxuICAgICAgICAgIHRyZW5kOiAnZGVncmFkaW5nJyxcbiAgICAgICAgfSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IG1vY2tNZXRyaWNzMzogUGVyZm9ybWFuY2VNZXRyaWNzID0ge1xuICAgICAgICAuLi5tb2NrTWV0cmljczEsXG4gICAgICAgIGNhY2hlSGl0UmF0ZToge1xuICAgICAgICAgIGN1cnJlbnQ6IDAuNixcbiAgICAgICAgICB0YXJnZXQ6IDAuOCxcbiAgICAgICAgICBhdmVyYWdlOiAwLjc1LFxuICAgICAgICAgIHRyZW5kOiAnZGVncmFkaW5nJyxcbiAgICAgICAgfSxcbiAgICAgIH07XG5cbiAgICAgIChwZXJmb3JtYW5jZU1vbml0b3IgYXMgYW55KS5wZXJmb3JtYW5jZUhpc3RvcnkgPSBbXG4gICAgICAgIG1vY2tNZXRyaWNzMSxcbiAgICAgICAgbW9ja01ldHJpY3MyLFxuICAgICAgICBtb2NrTWV0cmljczMsXG4gICAgICBdO1xuXG4gICAgICBjb25zdCByZWdyZXNzaW9uRGV0ZWN0ZWQgPVxuICAgICAgICBhd2FpdCBwZXJmb3JtYW5jZU1vbml0b3IuZGV0ZWN0UGVyZm9ybWFuY2VSZWdyZXNzaW9uKCk7XG5cbiAgICAgIGV4cGVjdChyZWdyZXNzaW9uRGV0ZWN0ZWQpLnRvQmUodHJ1ZSk7XG5cbiAgICAgIGNvbnN0IGFsZXJ0cyA9IHBlcmZvcm1hbmNlTW9uaXRvci5nZXRDdXJyZW50QWxlcnRzKCk7XG4gICAgICBleHBlY3QoYWxlcnRzKS50b0hhdmVMZW5ndGgoMSk7XG4gICAgICBleHBlY3QoYWxlcnRzWzBdLnR5cGUpLnRvQmUoJ2NhY2hlX2hpdF9yYXRlJyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGRldGVjdCBtZW1vcnkgdXNhZ2UgcmVncmVzc2lvbicsIGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tNZXRyaWNzMTogUGVyZm9ybWFuY2VNZXRyaWNzID0ge1xuICAgICAgICBidWlsZFRpbWU6IHsgY3VycmVudDogOCwgdGFyZ2V0OiAxMCwgYXZlcmFnZTogOCwgdHJlbmQ6ICdzdGFibGUnIH0sXG4gICAgICAgIGNhY2hlSGl0UmF0ZToge1xuICAgICAgICAgIGN1cnJlbnQ6IDAuOCxcbiAgICAgICAgICB0YXJnZXQ6IDAuOCxcbiAgICAgICAgICBhdmVyYWdlOiAwLjgsXG4gICAgICAgICAgdHJlbmQ6ICdzdGFibGUnLFxuICAgICAgICB9LFxuICAgICAgICBtZW1vcnlVc2FnZTogeyBjdXJyZW50OiAzMCwgdGFyZ2V0OiA1MCwgcGVhazogMzUsIGF2ZXJhZ2U6IDMwIH0sXG4gICAgICAgIGJ1bmRsZVNpemU6IHtcbiAgICAgICAgICBjdXJyZW50OiA0MDAsXG4gICAgICAgICAgdGFyZ2V0OiA0MjAsXG4gICAgICAgICAgY29tcHJlc3NlZDogMjgwLFxuICAgICAgICAgIHRyZW5kOiAnc3RhYmxlJyxcbiAgICAgICAgfSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IG1vY2tNZXRyaWNzMjogUGVyZm9ybWFuY2VNZXRyaWNzID0ge1xuICAgICAgICAuLi5tb2NrTWV0cmljczEsXG4gICAgICAgIG1lbW9yeVVzYWdlOiB7IGN1cnJlbnQ6IDQwLCB0YXJnZXQ6IDUwLCBwZWFrOiA0NSwgYXZlcmFnZTogMzUgfSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IG1vY2tNZXRyaWNzMzogUGVyZm9ybWFuY2VNZXRyaWNzID0ge1xuICAgICAgICAuLi5tb2NrTWV0cmljczEsXG4gICAgICAgIG1lbW9yeVVzYWdlOiB7IGN1cnJlbnQ6IDU1LCB0YXJnZXQ6IDUwLCBwZWFrOiA2MCwgYXZlcmFnZTogNDIgfSxcbiAgICAgIH07XG5cbiAgICAgIChwZXJmb3JtYW5jZU1vbml0b3IgYXMgYW55KS5wZXJmb3JtYW5jZUhpc3RvcnkgPSBbXG4gICAgICAgIG1vY2tNZXRyaWNzMSxcbiAgICAgICAgbW9ja01ldHJpY3MyLFxuICAgICAgICBtb2NrTWV0cmljczMsXG4gICAgICBdO1xuXG4gICAgICBjb25zdCByZWdyZXNzaW9uRGV0ZWN0ZWQgPVxuICAgICAgICBhd2FpdCBwZXJmb3JtYW5jZU1vbml0b3IuZGV0ZWN0UGVyZm9ybWFuY2VSZWdyZXNzaW9uKCk7XG5cbiAgICAgIGV4cGVjdChyZWdyZXNzaW9uRGV0ZWN0ZWQpLnRvQmUodHJ1ZSk7XG5cbiAgICAgIGNvbnN0IGFsZXJ0cyA9IHBlcmZvcm1hbmNlTW9uaXRvci5nZXRDdXJyZW50QWxlcnRzKCk7XG4gICAgICBleHBlY3QoYWxlcnRzKS50b0hhdmVMZW5ndGgoMSk7XG4gICAgICBleHBlY3QoYWxlcnRzWzBdLnR5cGUpLnRvQmUoJ21lbW9yeV91c2FnZScpO1xuICAgICAgZXhwZWN0KGFsZXJ0c1swXS5zZXZlcml0eSkudG9CZSgnY3JpdGljYWwnKTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgbm90IGRldGVjdCByZWdyZXNzaW9uIHdpdGggaW5zdWZmaWNpZW50IGRhdGEnLCBhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCByZWdyZXNzaW9uRGV0ZWN0ZWQgPVxuICAgICAgICBhd2FpdCBwZXJmb3JtYW5jZU1vbml0b3IuZGV0ZWN0UGVyZm9ybWFuY2VSZWdyZXNzaW9uKCk7XG5cbiAgICAgIGV4cGVjdChyZWdyZXNzaW9uRGV0ZWN0ZWQpLnRvQmUoZmFsc2UpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnZ2V0UGVyZm9ybWFuY2VNZXRyaWNzJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgcmV0dXJuIGNvbXByZWhlbnNpdmUgcGVyZm9ybWFuY2UgbWV0cmljcycsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tFeGVjU3luY1xuICAgICAgICAubW9ja1JldHVyblZhbHVlT25jZSgncmVhbCA4LjUwXFxudXNlciA3LjIwXFxuc3lzIDEuMzBcXG4nKSAvLyBidWlsZCB0aW1lXG4gICAgICAgIC5tb2NrUmV0dXJuVmFsdWVPbmNlKCcxNTBcXG4nKSAvLyBjYWNoZSBmaWxlc1xuICAgICAgICAubW9ja1JldHVyblZhbHVlT25jZSgnNDAwXFxuJyk7IC8vIGJ1bmRsZSBzaXplXG5cbiAgICAgIG1vY2tGcy5leGlzdHNTeW5jLm1vY2tJbXBsZW1lbnRhdGlvbigocGF0aDogc3RyaW5nKSA9PiB7XG4gICAgICAgIHJldHVybiBwYXRoID09PSAnLm5leHQnIHx8IHBhdGggPT09ICcubmV4dC9jYWNoZSc7XG4gICAgICB9KTtcblxuICAgICAgY29uc3QgbWV0cmljcyA9IGF3YWl0IHBlcmZvcm1hbmNlTW9uaXRvci5nZXRQZXJmb3JtYW5jZU1ldHJpY3MoKTtcblxuICAgICAgZXhwZWN0KG1ldHJpY3MpLnRvSGF2ZVByb3BlcnR5KCdidWlsZFRpbWUnKTtcbiAgICAgIGV4cGVjdChtZXRyaWNzKS50b0hhdmVQcm9wZXJ0eSgnY2FjaGVIaXRSYXRlJyk7XG4gICAgICBleHBlY3QobWV0cmljcykudG9IYXZlUHJvcGVydHkoJ21lbW9yeVVzYWdlJyk7XG4gICAgICBleHBlY3QobWV0cmljcykudG9IYXZlUHJvcGVydHkoJ2J1bmRsZVNpemUnKTtcblxuICAgICAgZXhwZWN0KG1ldHJpY3MuYnVpbGRUaW1lLmN1cnJlbnQpLnRvQmUoOC41KTtcbiAgICAgIGV4cGVjdChtZXRyaWNzLmJ1aWxkVGltZS50YXJnZXQpLnRvQmUoMTApO1xuICAgICAgZXhwZWN0KG1ldHJpY3MubWVtb3J5VXNhZ2UuY3VycmVudCkudG9CZSg0MCk7XG4gICAgICBleHBlY3QobWV0cmljcy5tZW1vcnlVc2FnZS50YXJnZXQpLnRvQmUoNTApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBjYWxjdWxhdGUgdHJlbmRzIGNvcnJlY3RseScsIGFzeW5jICgpID0+IHtcbiAgICAgIC8vIEZpcnN0IG1lYXN1cmVtZW50XG4gICAgICBtb2NrRXhlY1N5bmMubW9ja1JldHVyblZhbHVlKCdyZWFsIDguMDBcXG4nKTtcbiAgICAgIG1vY2tGcy5leGlzdHNTeW5jLm1vY2tSZXR1cm5WYWx1ZShmYWxzZSk7XG5cbiAgICAgIGNvbnN0IG1ldHJpY3MxID0gYXdhaXQgcGVyZm9ybWFuY2VNb25pdG9yLmdldFBlcmZvcm1hbmNlTWV0cmljcygpO1xuXG4gICAgICAvLyBBZGQgbW9yZSBtZWFzdXJlbWVudHMgdG8gZXN0YWJsaXNoIHRyZW5kIChuZWVkIGF0IGxlYXN0IDMgZm9yIHRyZW5kIGNhbGN1bGF0aW9uKVxuICAgICAgbW9ja0V4ZWNTeW5jLm1vY2tSZXR1cm5WYWx1ZSgncmVhbCA3LjUwXFxuJyk7XG4gICAgICBjb25zdCBtZXRyaWNzMiA9IGF3YWl0IHBlcmZvcm1hbmNlTW9uaXRvci5nZXRQZXJmb3JtYW5jZU1ldHJpY3MoKTtcblxuICAgICAgLy8gVGhpcmQgbWVhc3VyZW1lbnQgd2l0aCBzaWduaWZpY2FudCBpbXByb3ZlbWVudFxuICAgICAgbW9ja0V4ZWNTeW5jLm1vY2tSZXR1cm5WYWx1ZSgncmVhbCA2LjAwXFxuJyk7XG4gICAgICBjb25zdCBtZXRyaWNzMyA9IGF3YWl0IHBlcmZvcm1hbmNlTW9uaXRvci5nZXRQZXJmb3JtYW5jZU1ldHJpY3MoKTtcblxuICAgICAgZXhwZWN0KG1ldHJpY3MzLmJ1aWxkVGltZS50cmVuZCkudG9CZSgnaW1wcm92aW5nJyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCdnZW5lcmF0ZVBlcmZvcm1hbmNlUmVwb3J0JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZ2VuZXJhdGUgY29tcHJlaGVuc2l2ZSBwZXJmb3JtYW5jZSByZXBvcnQnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrRXhlY1N5bmMubW9ja1JldHVyblZhbHVlKCdyZWFsIDguNTBcXG4nKTtcbiAgICAgIG1vY2tGcy5leGlzdHNTeW5jLm1vY2tSZXR1cm5WYWx1ZShmYWxzZSk7XG5cbiAgICAgIGNvbnN0IHJlcG9ydCA9IGF3YWl0IHBlcmZvcm1hbmNlTW9uaXRvci5nZW5lcmF0ZVBlcmZvcm1hbmNlUmVwb3J0KCk7XG5cbiAgICAgIGV4cGVjdChyZXBvcnQpLnRvSGF2ZVByb3BlcnR5KCd0aW1lc3RhbXAnKTtcbiAgICAgIGV4cGVjdChyZXBvcnQpLnRvSGF2ZVByb3BlcnR5KCdtZXRyaWNzJyk7XG4gICAgICBleHBlY3QocmVwb3J0KS50b0hhdmVQcm9wZXJ0eSgnYWxlcnRzJyk7XG4gICAgICBleHBlY3QocmVwb3J0KS50b0hhdmVQcm9wZXJ0eSgncmVncmVzc2lvbkRldGVjdGVkJyk7XG4gICAgICBleHBlY3QocmVwb3J0KS50b0hhdmVQcm9wZXJ0eSgnb3ZlcmFsbFNjb3JlJyk7XG4gICAgICBleHBlY3QocmVwb3J0KS50b0hhdmVQcm9wZXJ0eSgncmVjb21tZW5kYXRpb25zJyk7XG5cbiAgICAgIGV4cGVjdCh0eXBlb2YgcmVwb3J0Lm92ZXJhbGxTY29yZSkudG9CZSgnbnVtYmVyJyk7XG4gICAgICBleHBlY3QocmVwb3J0Lm92ZXJhbGxTY29yZSkudG9CZUdyZWF0ZXJUaGFuT3JFcXVhbCgwKTtcbiAgICAgIGV4cGVjdChyZXBvcnQub3ZlcmFsbFNjb3JlKS50b0JlTGVzc1RoYW5PckVxdWFsKDEwMCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2hvdWxkIGluY2x1ZGUgcmVjb21tZW5kYXRpb25zIGZvciBwZXJmb3JtYW5jZSBpc3N1ZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBtb2NrRXhlY1N5bmMubW9ja1JldHVyblZhbHVlKCdyZWFsIDE1LjAwXFxuJyk7IC8vIEV4Y2VlZHMgMTBzIHRhcmdldFxuICAgICAgbW9ja0ZzLmV4aXN0c1N5bmMubW9ja1JldHVyblZhbHVlKGZhbHNlKTtcblxuICAgICAgY29uc3QgcmVwb3J0ID0gYXdhaXQgcGVyZm9ybWFuY2VNb25pdG9yLmdlbmVyYXRlUGVyZm9ybWFuY2VSZXBvcnQoKTtcblxuICAgICAgZXhwZWN0KHJlcG9ydC5yZWNvbW1lbmRhdGlvbnMubGVuZ3RoKS50b0JlR3JlYXRlclRoYW4oMCk7XG4gICAgICBleHBlY3QocmVwb3J0LnJlY29tbWVuZGF0aW9uc1swXSkudG9Db250YWluKCdCdWlsZCB0aW1lJyk7XG4gICAgICBleHBlY3QocmVwb3J0LnJlY29tbWVuZGF0aW9uc1swXSkudG9Db250YWluKCdleGNlZWRzIHRhcmdldCcpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnbW9uaXRvcmluZyBsaWZlY3ljbGUnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCBzdGFydCBhbmQgc3RvcCBjb250aW51b3VzIG1vbml0b3JpbmcnLCAoKSA9PiB7XG4gICAgICBqZXN0LnVzZUZha2VUaW1lcnMoKTtcblxuICAgICAgLy8gTW9jayBzZXRJbnRlcnZhbCBhbmQgY2xlYXJJbnRlcnZhbFxuICAgICAgY29uc3QgbW9ja1NldEludGVydmFsID0gamVzdC5zcHlPbihnbG9iYWwsICdzZXRJbnRlcnZhbCcpO1xuICAgICAgY29uc3QgbW9ja0NsZWFySW50ZXJ2YWwgPSBqZXN0LnNweU9uKGdsb2JhbCwgJ2NsZWFySW50ZXJ2YWwnKTtcblxuICAgICAgcGVyZm9ybWFuY2VNb25pdG9yLnN0YXJ0TW9uaXRvcmluZygxKTsgLy8gMSBtaW51dGUgaW50ZXJ2YWxcblxuICAgICAgZXhwZWN0KG1vY2tTZXRJbnRlcnZhbCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoZXhwZWN0LmFueShGdW5jdGlvbiksIDYwMDAwKTtcblxuICAgICAgcGVyZm9ybWFuY2VNb25pdG9yLnN0b3BNb25pdG9yaW5nKCk7XG5cbiAgICAgIGV4cGVjdChtb2NrQ2xlYXJJbnRlcnZhbCkudG9IYXZlQmVlbkNhbGxlZCgpO1xuXG4gICAgICBtb2NrU2V0SW50ZXJ2YWwubW9ja1Jlc3RvcmUoKTtcbiAgICAgIG1vY2tDbGVhckludGVydmFsLm1vY2tSZXN0b3JlKCk7XG4gICAgICBqZXN0LnVzZVJlYWxUaW1lcnMoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ2RhdGEgZXhwb3J0JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZXhwb3J0IHBlcmZvcm1hbmNlIGRhdGEgdG8gZmlsZScsIGFzeW5jICgpID0+IHtcbiAgICAgIG1vY2tGcy53cml0ZUZpbGVTeW5jLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiB7fSk7XG4gICAgICBtb2NrRXhlY1N5bmMubW9ja1JldHVyblZhbHVlKCdyZWFsIDguNTBcXG4nKTtcbiAgICAgIG1vY2tGcy5leGlzdHNTeW5jLm1vY2tSZXR1cm5WYWx1ZShmYWxzZSk7XG5cbiAgICAgIGF3YWl0IHBlcmZvcm1hbmNlTW9uaXRvci5leHBvcnRQZXJmb3JtYW5jZURhdGEoXG4gICAgICAgICcuL3Rlc3QtcGVyZm9ybWFuY2UtZGF0YS5qc29uJ1xuICAgICAgKTtcblxuICAgICAgZXhwZWN0KG1vY2tGcy53cml0ZUZpbGVTeW5jKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgJy4vdGVzdC1wZXJmb3JtYW5jZS1kYXRhLmpzb24nLFxuICAgICAgICBleHBlY3Quc3RyaW5nQ29udGFpbmluZygnXCJ0aW1lc3RhbXBcIicpXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCBoYW5kbGUgZXhwb3J0IGVycm9ycyBncmFjZWZ1bGx5JywgYXN5bmMgKCkgPT4ge1xuICAgICAgbW9ja0ZzLndyaXRlRmlsZVN5bmMubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdXcml0ZSBmYWlsZWQnKTtcbiAgICAgIH0pO1xuXG4gICAgICBhd2FpdCBleHBlY3QoXG4gICAgICAgIHBlcmZvcm1hbmNlTW9uaXRvci5leHBvcnRQZXJmb3JtYW5jZURhdGEoJy4vdGVzdC1wZXJmb3JtYW5jZS1kYXRhLmpzb24nKVxuICAgICAgKS5yZWplY3RzLnRvVGhyb3coJ0ZhaWxlZCB0byBleHBvcnQgcGVyZm9ybWFuY2UgZGF0YScpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnYWxlcnQgbWFuYWdlbWVudCcsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIG1hbmFnZSBhbGVydHMgY29ycmVjdGx5JywgKCkgPT4ge1xuICAgICAgY29uc3QgaW5pdGlhbEFsZXJ0cyA9IHBlcmZvcm1hbmNlTW9uaXRvci5nZXRDdXJyZW50QWxlcnRzKCk7XG4gICAgICBleHBlY3QoaW5pdGlhbEFsZXJ0cykudG9IYXZlTGVuZ3RoKDApO1xuXG4gICAgICAvLyBBZGQgYWxlcnQgdGhyb3VnaCBwcml2YXRlIG1ldGhvZCAoc2ltdWxhdGUgcmVncmVzc2lvbiBkZXRlY3Rpb24pXG4gICAgICBjb25zdCBtb2NrQWxlcnQ6IFBlcmZvcm1hbmNlQWxlcnQgPSB7XG4gICAgICAgIHR5cGU6ICdidWlsZF90aW1lJyxcbiAgICAgICAgc2V2ZXJpdHk6ICd3YXJuaW5nJyxcbiAgICAgICAgbWVzc2FnZTogJ1Rlc3QgYWxlcnQnLFxuICAgICAgICBjdXJyZW50VmFsdWU6IDE1LFxuICAgICAgICB0YXJnZXRWYWx1ZTogMTAsXG4gICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgICAgcmVjb21tZW5kYXRpb25zOiBbJ1Rlc3QgcmVjb21tZW5kYXRpb24nXSxcbiAgICAgIH07XG5cbiAgICAgIChwZXJmb3JtYW5jZU1vbml0b3IgYXMgYW55KS5hZGRBbGVydChtb2NrQWxlcnQpO1xuXG4gICAgICBjb25zdCBhbGVydHNBZnRlckFkZCA9IHBlcmZvcm1hbmNlTW9uaXRvci5nZXRDdXJyZW50QWxlcnRzKCk7XG4gICAgICBleHBlY3QoYWxlcnRzQWZ0ZXJBZGQpLnRvSGF2ZUxlbmd0aCgxKTtcbiAgICAgIGV4cGVjdChhbGVydHNBZnRlckFkZFswXSkudG9FcXVhbChtb2NrQWxlcnQpO1xuXG4gICAgICBwZXJmb3JtYW5jZU1vbml0b3IuY2xlYXJBbGVydHMoKTtcblxuICAgICAgY29uc3QgYWxlcnRzQWZ0ZXJDbGVhciA9IHBlcmZvcm1hbmNlTW9uaXRvci5nZXRDdXJyZW50QWxlcnRzKCk7XG4gICAgICBleHBlY3QoYWxlcnRzQWZ0ZXJDbGVhcikudG9IYXZlTGVuZ3RoKDApO1xuICAgIH0pO1xuICB9KTtcbn0pO1xuIl0sInZlcnNpb24iOjN9