15679fab41b6bec42a8ba3faa104c40a
"use strict";
// src/utils/elementalUtils.ts
Object.defineProperty(exports, "__esModule", { value: true });
exports.calculateElementalAffinity = exports.fixRawIngredientMappings = exports.fixIngredientMappings = exports.fixIngredientMapping = exports.ensureLowercaseFormat = exports.getDefaultElementalProperties = exports.getCurrentElementalState = exports.enhanceOilProperties = exports.enhanceVegetableTransformations = exports.getStrengtheningElement = exports.getElementalRelationship = exports.getBalancingElement = exports.ensureCompleteElementalProperties = exports.getElementStrength = exports.getPrimaryElement = exports.normalizeElementalValues = exports.transformItemsWithPlanetaryPositions = exports.elementalFunctions = exports.elementalInteractions = exports.elements = exports.elementalUtils = exports.getMissingElements = exports.validateElementalRequirements = exports.standardizeRecipeElements = exports.normalizeProperties = exports.validateElementalProperties = void 0;
const elementalConstants_1 = require("@/constants/elementalConstants");
const ElementalCalculator_1 = require("@/services/ElementalCalculator");
const elementalMappings_1 = require("./elementalMappings");
Object.defineProperty(exports, "elements", { enumerable: true, get: function () { return elementalMappings_1.elements; } });
Object.defineProperty(exports, "elementalInteractions", { enumerable: true, get: function () { return elementalMappings_1.elementalInteractions; } });
Object.defineProperty(exports, "elementalFunctions", { enumerable: true, get: function () { return elementalMappings_1.elementalFunctions; } });
const planetaryFoodAssociations_1 = require("@/constants/planetaryFoodAssociations");
const validation_1 = require("@/utils/validation");
// Missing ELEMENTAL_CHARACTERISTICS constant
const ELEMENTAL_CHARACTERISTICS = {
    Fire: {
        cookingTechniques: ['grilling', 'roasting', 'searing', 'flambéing'],
        timeOfDay: ['morning', 'noon'],
        qualities: ['energetic', 'transformative', 'intense'],
        temperature: 'hot'
    },
    Water: {
        cookingTechniques: ['boiling', 'steaming', 'poaching', 'braising'],
        timeOfDay: ['evening', 'night'],
        qualities: ['flowing', 'cooling', 'nurturing'],
        temperature: 'cool'
    },
    Earth: {
        cookingTechniques: ['baking', 'slow-cooking', 'roasting', 'smoking'],
        timeOfDay: ['afternoon', 'evening'],
        qualities: ['grounding', 'stable', 'nourishing'],
        temperature: 'moderate'
    },
    Air: {
        cookingTechniques: ['whipping', 'frying', 'sautéing', 'dehydrating'],
        timeOfDay: ['morning', 'midday'],
        qualities: ['light', 'airy', 'quick'],
        temperature: 'variable'
    }
};
// AlchemicalProperty type imported from @/constants/planetaryElements
/**
 * Validates that elemental properties contain valid values
 * @param properties The elemental properties to validate
 * @returns True if properties are valid, false otherwise
 */
const validateElementalProperties = (properties) => {
    // If properties is null or undefined, return false immediately
    if (!properties) {
        console.warn('Warning: properties is null or undefined in validateElementalProperties');
        return false;
    }
    // Check if all required elements exist
    const requiredElements = ['Fire', 'Water', 'Earth', 'Air'];
    for (const element of requiredElements) {
        if (typeof properties[element] !== 'number') {
            console.warn(`Warning: properties.${element} is not a number in validateElementalProperties`);
            return false;
        }
        // Check if values are between 0 and 1
        if (properties[element] < 0 || properties[element] > 1) {
            (0, validation_1.logUnexpectedValue)('validateElementalProperties', {
                message: `Element value out of range: ${element} = ${properties[element]}`,
                element,
                value: properties[element],
            });
            return false;
        }
    }
    // Optionally check if properties sum to 1 (or close to it due to floating point)
    const sum = Object.values(properties).reduce((acc, val) => acc + val, 0);
    const isCloseToOne = Math.abs(sum - 1) < 0.01;
    if (!isCloseToOne) {
        (0, validation_1.logUnexpectedValue)('validateElementalProperties', {
            message: `Elemental properties do not sum to 1: ${sum}`,
            sum,
            properties,
        });
    }
    return true;
};
exports.validateElementalProperties = validateElementalProperties;
/**
 * Normalizes elemental properties to ensure they sum to 1
 * @param properties The elemental properties to normalize
 * @returns Normalized elemental properties
 */
const normalizeProperties = (properties) => {
    var _a, _b, _c, _d;
    // Handle null or undefined
    if (!properties) {
        console.warn('Warning: properties is null or undefined in normalizeProperties');
        return { ...elementalConstants_1.DEFAULT_ELEMENTAL_PROPERTIES };
    }
    // Fill in any missing properties with defaults
    const completeProperties = {
        Fire: (_a = properties.Fire) !== null && _a !== void 0 ? _a : elementalConstants_1.DEFAULT_ELEMENTAL_PROPERTIES.Fire,
        Water: (_b = properties.Water) !== null && _b !== void 0 ? _b : elementalConstants_1.DEFAULT_ELEMENTAL_PROPERTIES.Water,
        Earth: (_c = properties.Earth) !== null && _c !== void 0 ? _c : elementalConstants_1.DEFAULT_ELEMENTAL_PROPERTIES.Earth,
        Air: (_d = properties.Air) !== null && _d !== void 0 ? _d : elementalConstants_1.DEFAULT_ELEMENTAL_PROPERTIES.Air,
    };
    const sum = Object.values(completeProperties).reduce((acc, val) => acc + val, 0);
    if (sum === 0) {
        // If sum is 0, return balanced default
        console.warn('Warning: properties sum is 0 in normalizeProperties');
        return { ...elementalConstants_1.DEFAULT_ELEMENTAL_PROPERTIES };
    }
    // Normalize each value
    return Object.entries(completeProperties).reduce((acc, [key, value]) => {
        if ((0, validation_1.isElementalPropertyKey)(key)) {
            acc[key] = value / sum;
        }
        else {
            // This shouldn't happen with the type-safety above, but just in case
            console.warn(`Warning: invalid key ${key} in normalizeProperties`);
        }
        return acc;
    }, { ...elementalConstants_1.DEFAULT_ELEMENTAL_PROPERTIES });
};
exports.normalizeProperties = normalizeProperties;
/**
 * Standardizes elemental properties for recipes, ensuring all recipes have
 * properly normalized elemental values
 * @param recipe The recipe to standardize
 * @returns Recipe with standardized elemental properties
 */
const standardizeRecipeElements = (recipe) => {
    // Handle null /undefined recipe
    if (!recipe) {
        console.warn('Warning: recipe is null or undefined in standardizeRecipeElements');
        return {
            elementalProperties: { ...elementalConstants_1.DEFAULT_ELEMENTAL_PROPERTIES }
        };
    }
    // If recipe doesn't have elemental properties, use current elemental state
    if (!recipe.elementalProperties) {
        const currentState = ElementalCalculator_1.ElementalCalculator.getCurrentElementalState();
        return {
            ...recipe,
            elementalProperties: currentState,
        };
    }
    // Normalize properties to ensure they sum to 1
    return {
        ...recipe,
        elementalProperties: (0, exports.normalizeProperties)(recipe.elementalProperties),
    };
};
exports.standardizeRecipeElements = standardizeRecipeElements;
const validateElementalRequirements = (properties) => {
    return (0, validation_1.isElementalProperties)(properties);
};
exports.validateElementalRequirements = validateElementalRequirements;
/**
 * Gets the elements that are missing or significantly lower than ideal balance in the provided properties
 * @param properties The elemental properties to check
 * @returns Array of elements that are missing or low
 */
function getMissingElements(properties) {
    if (!properties) {
        return ['Fire', 'Water', 'Earth', 'Air'];
    }
    const missing = [];
    const idealBalance = 0.25; // Each element should ideally be 25%
    const threshold = 0.15; // Consider missing if below 15%
    for (const element of ['Fire', 'Water', 'Earth', 'Air']) {
        const value = properties[element] || 0;
        if (value < threshold) {
            missing.push(element);
        }
    }
    return missing;
}
exports.getMissingElements = getMissingElements;
exports.elementalUtils = {
    validateProperties: exports.validateElementalRequirements,
    normalizeProperties: exports.normalizeProperties,
    standardizeRecipeElements: exports.standardizeRecipeElements,
    getMissingElements,
    calculateelementalState(recipe) {
        var _a;
        if (!((_a = recipe === null || recipe === void 0 ? void 0 : recipe.ingredients) === null || _a === void 0 ? void 0 : _a.length)) {
            return ElementalCalculator_1.ElementalCalculator.getCurrentElementalState();
        }
        // Create a safe default balance to start
        const balance = { ...elementalConstants_1.DEFAULT_ELEMENTAL_PROPERTIES };
        // Get total amount for percentage calculations
        const totalAmount = recipe.ingredients.reduce((sum, ing) => {
            var _a;
            const amount = (_a = ing.amount) !== null && _a !== void 0 ? _a : 1; // Default to 1 if amount is missing
            return sum + amount;
        }, 0);
        // Handle the special case where there are no ingredients with amount
        if (totalAmount === 0) {
            return balance;
        }
        // Initialize balance with 0 values
        Object.keys(balance).forEach(el => {
            if ((0, validation_1.isElementalPropertyKey)(el)) {
                balance[el] = 0;
            }
        });
        // Process each ingredient
        recipe.ingredients.forEach(ing => {
            var _a;
            const amount = (_a = ing.amount) !== null && _a !== void 0 ? _a : 1; // Default to 1 if amount is missing
            if (ing.elementalProperties) {
                // For each element in the ingredient
                Object.entries(ing.elementalProperties).forEach(([element, value]) => {
                    if ((0, validation_1.isElementalPropertyKey)(element)) {
                        balance[element] += (value * amount) / totalAmount;
                    }
                });
            }
        });
        // Normalize to ensure they sum to 1
        return (0, exports.normalizeProperties)(balance);
    },
    combineProperties(a, b, bWeight = 0.5) {
        const combinedProps = {};
        const aWeight = 1 - bWeight;
        Object.keys(a).forEach((key) => {
            const element = key;
            combinedProps[element] =
                a[element] * aWeight + (b[element] || 0) * bWeight;
        });
        return combinedProps;
    },
    getelementalState(recipe) {
        var _a;
        if (!((_a = recipe.ingredients) === null || _a === void 0 ? void 0 : _a.length)) {
            return ElementalCalculator_1.ElementalCalculator.getCurrentElementalState();
        }
        const combinedProperties = recipe.ingredients.reduce((acc, ingredient) => {
            const props = ingredient.elementalProperties ||
                ElementalCalculator_1.ElementalCalculator.getCurrentElementalState();
            return {
                Fire: acc.Fire + props.Fire,
                Water: acc.Water + props.Water,
                Earth: acc.Earth + props.Earth,
                Air: acc.Air + props.Air,
            };
        }, { Fire: 0, Water: 0, Earth: 0, Air: 0 });
        return (0, exports.normalizeProperties)(combinedProperties);
    },
    /**
     * Gets a complementary element that works well with the given element
     * All elements work well together in their own way
     * @param element The element to find a complement for
     * @returns The complementary element
     */
    getComplementaryElement(element) {
        // Each element complements all others, but we return one suggestion
        // based on traditional culinary pairings
        const complementary = {
            Fire: 'Fire',
            Water: 'Water',
            Earth: 'Earth',
            Air: 'Air', // Air reinforces itself
        };
        return complementary[element];
    },
    /**
     * Gets the elemental characteristics for a specific element
     * @param element The element to get characteristics for
     * @returns The elemental characteristics
     */
    getElementalCharacteristics(element) {
        return ELEMENTAL_CHARACTERISTICS[element];
    },
    /**
     * Gets a complete elemental profile that includes properties and characteristics
     * @param properties The elemental properties
     * @returns A complete elemental profile
     */
    getElementalProfile(properties) {
        // Find the dominant element
        const entries = Object.entries(properties);
        let dominantElement = 'Fire';
        let maxValue = 0;
        for (const [element, value] of entries) {
            if (value > maxValue) {
                dominantElement = element;
                maxValue = value;
            }
        }
        return {
            dominant: dominantElement,
            balance: properties,
            characteristics: [this.getElementalCharacteristics(dominantElement)],
        };
    },
    /**
     * Gets the suggested cooking techniques based on elemental properties
     * @param properties The elemental properties
     * @returns Array of recommended cooking techniques
     */
    getSuggestedCookingTechniques(properties) {
        const techniques = [];
        const threshold = 0.3; // Only consider elements above this threshold for recommendations
        if (properties.Fire > threshold) {
            techniques.push(...ELEMENTAL_CHARACTERISTICS.Fire.cookingTechniques.slice(0, 2));
        }
        if (properties.Water > threshold) {
            techniques.push(...ELEMENTAL_CHARACTERISTICS.Water.cookingTechniques.slice(0, 2));
        }
        if (properties.Earth > threshold) {
            techniques.push(...ELEMENTAL_CHARACTERISTICS.Earth.cookingTechniques.slice(0, 2));
        }
        if (properties.Air > threshold) {
            techniques.push(...ELEMENTAL_CHARACTERISTICS.Air.cookingTechniques.slice(0, 2));
        }
        // Return unique techniques or a default if none meet the threshold
        return techniques.length > 0
            ? Array.from(new Set(techniques))
            : ['Balanced cooking'];
    },
    /**
     * Gets the complementary ingredients based on elemental properties
     * @param properties The elemental properties
     * @returns Array of recommended complementary ingredients
     */
    getRecommendedTimeOfDay(properties) {
        const times = [];
        const threshold = 0.3; // Only consider elements above this threshold for recommendations
        const weightedTimes = [];
        // Add times based on the elemental balance, weighted by their values
        if (properties.Fire > threshold) {
            for (let i = 0; i < Math.ceil(properties.Fire * 10); i++) {
                weightedTimes.push(...ELEMENTAL_CHARACTERISTICS.Fire.timeOfDay);
            }
        }
        if (properties.Water > threshold) {
            for (let i = 0; i < Math.ceil(properties.Water * 10); i++) {
                weightedTimes.push(...ELEMENTAL_CHARACTERISTICS.Water.timeOfDay);
            }
        }
        if (properties.Earth > threshold) {
            for (let i = 0; i < Math.ceil(properties.Earth * 10); i++) {
                weightedTimes.push(...ELEMENTAL_CHARACTERISTICS.Earth.timeOfDay);
            }
        }
        if (properties.Air > threshold) {
            for (let i = 0; i < Math.ceil(properties.Air * 10); i++) {
                weightedTimes.push(...ELEMENTAL_CHARACTERISTICS.Air.timeOfDay);
            }
        }
        // Return unique times or a default if none meet the threshold
        return weightedTimes.length > 0
            ? Array.from(new Set(weightedTimes))
            : ['Any time'];
    },
    // Get the default elemental properties
    getDefaultElementalProperties() {
        return elementalConstants_1.DEFAULT_ELEMENTAL_PROPERTIES;
    },
    // Export the default elemental properties constant for direct access
    DEFAULT_ELEMENTAL_PROPERTIES: elementalConstants_1.DEFAULT_ELEMENTAL_PROPERTIES,
    /**
     * Gets the current elemental state from the ElementalCalculator service
     * Pattern OO-3: Utility Import Alignment - Standalone export for TS2614 compatibility
     */
    getCurrentElementalState() {
        return ElementalCalculator_1.ElementalCalculator.getCurrentElementalState();
    },
    /**
     * Pattern OO-3: Utility Import Alignment - Format consistency helper
     * Ensures elemental property keys are in lowercase format
     */
    ensureLowercaseFormat(properties) {
        if (!properties || typeof properties !== 'object') {
            return properties;
        }
        const lowercaseProps = {};
        for (const [key, value] of Object.entries(properties)) {
            // Convert capitalized element names to lowercase
            const lowerKey = key.toLowerCase();
            lowercaseProps[lowerKey] = value;
        }
        return lowercaseProps;
    },
};
exports.default = exports.elementalUtils;
/**
 * Transform a list of elemental items based on planetary positions
 *
 * @param items Items to transform
 * @param planetaryPositions Current planetary positions
 * @param isDaytime Whether it is currently day
 * @param currentZodiac Current zodiac sign
 * @param lunarPhase Current lunar phase
 * @param elementalBoosts Optional elemental boosts to apply
 * @param planetaryBoosts Optional planetary boosts to apply
 * @returns Transformed alchemical items
 */
const ELEMENT_WEIGHTS = {
    Fire: 1.8,
    Water: 1.2,
    Earth: 0.9,
    Air: 1.5,
};
// Add this function if uniqueness score is needed
function _calculateUniqueness(elements, planetaryInfluence) {
    // Calculate variance of elemental properties
    const values = Object.values(elements);
    const mean = values.reduce((sum, val) => sum + val, 0) / values.length;
    const variance = values.reduce((sum, val) => sum + Math.pow(val - mean, 2), 0) /
        values.length;
    // Combine with planetary influence
    return Math.min(1, variance * (1 + planetaryInfluence));
}
// Or modify the transformation to remove uniqueness score if not needed
function transformItemsWithPlanetaryPositions(items, planetaryPositions, isDaytime = true, currentZodiac, lunarPhase, tarotElementBoosts, tarotPlanetaryBoosts) {
    return items.map((item) => {
        const { boost: planetaryInfluence } = (0, planetaryFoodAssociations_1.calculatePlanetaryBoost)(item, planetaryPositions, currentZodiac, lunarPhase);
        // Scale elemental properties
        const scaledElements = Object.fromEntries(Object.entries(item.elementalProperties).map(([element, value]) => [
            element,
            value * (1 + (planetaryInfluence || 0)),
        ]));
        // Calculate alchemical properties from elemental properties
        // This follows the same relationships as in the alchemical system:
        // - Spirit is related to Fire (transformation) and Air (connection)
        // - Essence is related to Water (fluidity) and Fire (vitality)
        // - Matter is related to Earth (stability) and Water (cohesion)
        // - Substance is related to Air (structure) and Earth (form)
        const spirit = scaledElements.Fire * 0.6 + scaledElements.Air * 0.4;
        const essence = scaledElements.Water * 0.6 + scaledElements.Fire * 0.4;
        const matter = scaledElements.Earth * 0.7 + scaledElements.Water * 0.3;
        const substance = scaledElements.Air * 0.6 + scaledElements.Earth * 0.4;
        // Apply tarot boosts if available
        const boostedSpirit = spirit * ((tarotPlanetaryBoosts === null || tarotPlanetaryBoosts === void 0 ? void 0 : tarotPlanetaryBoosts.Spirit) || 1.0);
        const boostedEssence = essence * ((tarotPlanetaryBoosts === null || tarotPlanetaryBoosts === void 0 ? void 0 : tarotPlanetaryBoosts.Essence) || 1.0);
        const boostedMatter = matter * ((tarotPlanetaryBoosts === null || tarotPlanetaryBoosts === void 0 ? void 0 : tarotPlanetaryBoosts.Matter) || 1.0);
        const boostedSubstance = substance * ((tarotPlanetaryBoosts === null || tarotPlanetaryBoosts === void 0 ? void 0 : tarotPlanetaryBoosts.Substance) || 1.0);
        // Calculate energy metrics using the formulas from alchemicalCalculations.ts
        const fire = scaledElements.Fire;
        const water = scaledElements.Water;
        const air = scaledElements.Air;
        const earth = scaledElements.Earth;
        // Ensure we have non-zero values for denominator
        const safeValueForHeat = (val) => Math.max(val, 0.01);
        // Heat formula: (spirit^2 + fire^2) / ((substance || 1) + essence + matter + water + air + earth)^2
        const heat = (Math.pow(safeValueForHeat(boostedSpirit), 2) + Math.pow(safeValueForHeat(fire), 2)) /
            Math.pow(safeValueForHeat(boostedSubstance + boostedEssence + boostedMatter + water + air + earth), 2);
        // Entropy formula: (spirit^2 + substance^2 + fire^2 + air^2) / ((essence || 1) + matter + earth + water)^2
        const entropy = (Math.pow(safeValueForHeat(boostedSpirit), 2) + Math.pow(safeValueForHeat(boostedSubstance), 2) +
            Math.pow(safeValueForHeat(fire), 2) + Math.pow(safeValueForHeat(air), 2)) /
            Math.pow(safeValueForHeat(boostedEssence + boostedMatter + earth + water), 2);
        // Reactivity formula: (spirit^2 + substance^2 + essence^2 + fire^2 + air^2 + water^2) / ((matter || 1) + earth)^2
        const reactivity = (Math.pow(safeValueForHeat(boostedSpirit), 2) + Math.pow(safeValueForHeat(boostedSubstance), 2) +
            Math.pow(safeValueForHeat(boostedEssence), 2) + Math.pow(safeValueForHeat(fire), 2) +
            Math.pow(safeValueForHeat(air), 2) + Math.pow(safeValueForHeat(water), 2)) /
            Math.pow(safeValueForHeat(boostedMatter + earth), 2);
        // Greg's Energy formula with consistent scaling
        const rawGregsEnergy = heat - reactivity * entropy;
        const scaledGregsEnergy = (rawGregsEnergy + 1) / 2; // Convert from range (-1,1) to (0,1)
        const gregsEnergy = Math.max(0.1, Math.min(1.0, scaledGregsEnergy));
        // Normalize all energy values to ensure they're in the 0-1 range
        const normalizedHeat = Math.max(0.1, Math.min(1.0, heat));
        const normalizedEntropy = Math.max(0.1, Math.min(1.0, entropy));
        const normalizedReactivity = Math.max(0.1, Math.min(1.0, reactivity));
        // Calculate dominant element based on scaled elements
        const dominantElement = Object.entries(scaledElements).sort(([_keyA, valueA], [_keyB, valueB]) => valueB - valueA)[0][0];
        // Calculate dominant alchemical property
        const alchemicalProperties = {
            Spirit: boostedSpirit,
            Essence: boostedEssence,
            Matter: boostedMatter,
            Substance: boostedSubstance,
        };
        const dominantAlchemicalProperty = Object.entries(alchemicalProperties).sort(([_keyA, valueA], [_keyB, valueB]) => valueB - valueA)[0][0];
        // Extract dominant planets based on planetary positions if available
        let dominantPlanets = [];
        if (planetaryPositions) {
            // Get top 3 planets with highest values or dignity
            const planetEntries = Object.entries(planetaryPositions).filter(([planet, _]) => planet !== 'isDaytime' && planet !== 'currentZodiac');
            // Handle different position data formats
            dominantPlanets = planetEntries
                .sort(([_, valA], [__, valB]) => {
                // Sort by strength /dignity if available
                if (typeof valA === 'object' && typeof valB === 'object') {
                    const dataA = valA;
                    const dataB = valB;
                    const strengthA = Number(dataA === null || dataA === void 0 ? void 0 : dataA.strength) || 0;
                    const strengthB = Number(dataB === null || dataB === void 0 ? void 0 : dataB.strength) || 0;
                    return strengthB - strengthA;
                }
                // Default sort for simple numeric values
                return Number(valB) - Number(valA);
            })
                .slice(0, 3)
                .map(([planet, _]) => planet);
        }
        // Ensure we have planetary dignities data
        const planetaryDignities = {};
        // Handle NaN values or infinity for all properties
        const ensureSafeNumber = (val) => {
            if (isNaN(val) || !isFinite(val))
                return 0.2;
            return val;
        };
        // Apply safe arithmetic operations with proper type checking
        const safeValueForArithmetic = (val) => Math.max(val, 0.01);
        const safeAdd = (a, b) => safeValueForArithmetic(a) + safeValueForArithmetic(b);
        const safeMultiply = (a, b) => safeValueForArithmetic(a) * safeValueForArithmetic(b);
        return {
            id: item.id,
            name: item.name,
            elementalProperties: item.elementalProperties,
            transformedElementalProperties: scaledElements,
            alchemicalProperties: {
                Spirit: boostedSpirit,
                Essence: boostedEssence,
                Matter: boostedMatter,
                Substance: boostedSubstance,
            },
            heat: normalizedHeat,
            entropy: normalizedEntropy,
            reactivity: normalizedReactivity,
            gregsEnergy: gregsEnergy,
            dominantElement,
            dominantAlchemicalProperty,
            planetaryBoost: planetaryInfluence,
            dominantPlanets,
            planetaryDignities,
        };
    });
}
exports.transformItemsWithPlanetaryPositions = transformItemsWithPlanetaryPositions;
// New differentiation functions
const applyNonLinearScaling = (props) => ({
    Fire: Math.tanh(props.Fire * 2),
    Water: 1 - Math.exp(-props.Water * 3),
    Earth: props.Earth ** 1.5,
    Air: Math.sin((props.Air * Math.PI) / 2),
});
const calculateUniquenessScore = (item) => {
    const variance = Object.values(item.elementalProperties).reduce((acc, val) => acc + Math.abs(val - 0.5), 0);
    return Math.min(1, variance * 2);
};
// Add or update the normalizeElementalValues function
function normalizeElementalValues(values) {
    const total = Object.values(values).reduce((sum, val) => sum + val, 0);
    // If total is zero or close to zero, return default distribution
    if (total < 0.01) {
        return {
            Fire: 0.25,
            Water: 0.25,
            Earth: 0.25,
            Air: 0.25,
        };
    }
    // Normalize values to sum to 1.0
    return {
        Fire: values.Fire / total,
        Water: values.Water / total,
        Earth: values.Earth / total,
        Air: values.Air / total,
    };
}
exports.normalizeElementalValues = normalizeElementalValues;
// Get the primary element regardless of format
function getPrimaryElement(elementalAffinity) {
    const affinityData = elementalAffinity;
    return ((affinityData === null || affinityData === void 0 ? void 0 : affinityData.base) || (affinityData === null || affinityData === void 0 ? void 0 : affinityData.element) || 'Fire');
}
exports.getPrimaryElement = getPrimaryElement;
// Get element strength if available
function getElementStrength(elementalAffinity) {
    const affinityData = elementalAffinity;
    const strength = affinityData === null || affinityData === void 0 ? void 0 : affinityData.strength;
    return typeof strength === 'number' ? strength : 1;
}
exports.getElementStrength = getElementStrength;
/**
 * Ensures all required elemental properties are present
 * @param properties The elemental properties to validate and complete
 * @returns Complete elemental properties
 */
const ensureCompleteElementalProperties = (properties) => {
    var _a, _b, _c, _d;
    return {
        Fire: (_a = properties.Fire) !== null && _a !== void 0 ? _a : 0.25,
        Water: (_b = properties.Water) !== null && _b !== void 0 ? _b : 0.25,
        Earth: (_c = properties.Earth) !== null && _c !== void 0 ? _c : 0.25,
        Air: (_d = properties.Air) !== null && _d !== void 0 ? _d : 0.25,
    };
};
exports.ensureCompleteElementalProperties = ensureCompleteElementalProperties;
/**
 * WARNING: getBalancingElement is legacy and does not comply with current elemental logic principles (no opposing/balancing elements). Review usage and refactor/remove if not needed.
 */
function getBalancingElement(element) {
    // Elements work best with themselves - reinforcing the current energy
    return element;
}
exports.getBalancingElement = getBalancingElement;
/**
 * WARNING: getElementalRelationship is legacy and may not comply with current elemental logic principles.
 * All element combinations are harmonious; avoid using "opposing" or "controlling" logic.
 */
function getElementalRelationship(element1, element2) {
    if (element1 === element2) {
        return 'same';
    }
    // The generating cycle for 4-element system: Fire → Earth → Water → Air → Fire
    const generatingCycle = {
        Fire: 'Earth',
        Earth: 'Water',
        Water: 'Air',
        Air: 'Fire',
    };
    // The controlling cycle for 4-element system: Fire → Air → Earth → Water → Fire
    const controllingCycle = {
        Fire: 'Air',
        Air: 'Earth',
        Earth: 'Water',
        Water: 'Fire',
    };
    if (generatingCycle[element1] === element2) {
        return 'generating'; // element1 generates element2
    }
    else if (generatingCycle[element2] === element1) {
        return 'weakened-by'; // element2 generates element1
    }
    else if (controllingCycle[element1] === element2) {
        return 'controlling'; // element1 controls element2
    }
    else if (controllingCycle[element2] === element1) {
        return 'controlled-by'; // element2 controls element1
    }
    else {
        return 'neutral';
    }
}
exports.getElementalRelationship = getElementalRelationship;
/**
 * Gets the element that strengthens the provided element
 */
function getStrengtheningElement(element) {
    // The element that generates the provided element will strengthen it
    const strengthMap = {
        Fire: 'Air',
        Earth: 'Fire',
        Water: 'Earth',
        Air: 'Water', // Water strengthens Air
    };
    return strengthMap[element];
}
exports.getStrengtheningElement = getStrengtheningElement;
/**
 * Enhance vegetable transformations by adding thermodynamic effects to different cooking methods
 * @param vegetables The collection of vegetables to enhance
 * @returns Enhanced vegetables with complete transformation properties
 */
function enhanceVegetableTransformations(vegetables) {
    return Object.entries(vegetables).reduce((acc, [key, vegetable]) => {
        // Skip if not an object
        if (typeof vegetable !== 'object' || vegetable === null) {
            acc[key] = vegetable;
            return acc;
        }
        const enhanced = { ...vegetable };
        // Create transformation if it doesn't exist
        if (!enhanced.elementalTransformation) {
            // Get the dominant element
            const elementalProps = enhanced.elementalProperties || {
                Earth: 0.3,
                Water: 0.3,
                Air: 0.2,
                Fire: 0.2,
            };
            let dominantElement = 'Earth';
            let highestValue = 0;
            for (const [element, value] of Object.entries(elementalProps)) {
                if (typeof value === 'number' && value > highestValue) {
                    dominantElement = element;
                    highestValue = value;
                }
            }
            // Set default transformations based on dominant element
            enhanced.elementalTransformation = {
                whenCooked: { [dominantElement]: 0.1, Fire: 0.05 },
                whenDried: { Earth: 0.1, Air: 0.05 },
                whenFermented: { Water: 0.1, Air: 0.05 },
            };
        }
        // Add thermodynamic changes if they don't exist
        const transformation = enhanced.elementalTransformation;
        if (transformation &&
            !transformation.thermodynamicChanges) {
            transformation.thermodynamicChanges = {
                cooked: {
                    heat: 0.1,
                    entropy: 0.05,
                    reactivity: 0.05,
                },
                dried: {
                    heat: -0.05,
                    entropy: -0.1,
                    reactivity: -0.05,
                },
                fermented: {
                    entropy: 0.2,
                    reactivity: 0.15,
                    stabilityIndex: -0.1,
                },
                roasted: {
                    heat: 0.2,
                    entropy: 0.1,
                    energy: 0.15,
                },
                steamed: {
                    heat: 0.05,
                    moisture: 0.2,
                    reactivity: 0.05,
                },
            };
        }
        // Add elementalSignature if it doesn't exist
        if (!enhanced.elementalSignature && enhanced.elementalProperties) {
            enhanced.elementalSignature = Object.entries(enhanced.elementalProperties)
                .sort((a, b) => {
                // Apply Pattern KK-1: Explicit Type Assertion for arithmetic operations
                const valueA = Number(a[1]) || 0;
                const valueB = Number(b[1]) || 0;
                return valueB - valueA;
            })
                .map(([element, value]) => [element, Number(value)]);
        }
        // Add sensory profiles if they don't exist
        if (!enhanced.sensoryProfile) {
            // Default sensory profile based on vegetable subCategory
            const subCategory = enhanced.subCategory || 'vegetable';
            const profiles = {
                'leafy green': {
                    taste: {
                        bitter: 0.6,
                        sweet: 0.2,
                        umami: 0.1,
                        salty: 0.05,
                        sour: 0.05,
                        spicy: 0,
                    },
                    aroma: {
                        herbal: 0.5,
                        earthy: 0.3,
                        floral: 0.1,
                        fruity: 0.05,
                        woody: 0.05,
                        spicy: 0,
                    },
                    texture: {
                        crisp: 0.7,
                        tender: 0.2,
                        silky: 0.1,
                        chewy: 0,
                        creamy: 0,
                        crunchy: 0,
                    },
                },
                root: {
                    taste: {
                        sweet: 0.5,
                        earthy: 0.3,
                        bitter: 0.1,
                        umami: 0.1,
                        salty: 0,
                        spicy: 0,
                    },
                    aroma: {
                        earthy: 0.6,
                        woody: 0.2,
                        herbal: 0.1,
                        fruity: 0.1,
                        floral: 0,
                        spicy: 0,
                    },
                    texture: {
                        crunchy: 0.6,
                        chewy: 0.2,
                        tender: 0.2,
                        crisp: 0,
                        silky: 0,
                        creamy: 0,
                    },
                },
                allium: {
                    taste: {
                        pungent: 0.6,
                        sweet: 0.2,
                        umami: 0.2,
                        bitter: 0,
                        salty: 0,
                        sour: 0,
                    },
                    aroma: {
                        spicy: 0.7,
                        earthy: 0.2,
                        herbal: 0.1,
                        floral: 0,
                        fruity: 0,
                        woody: 0,
                    },
                    texture: {
                        crunchy: 0.5,
                        chewy: 0.3,
                        tender: 0.2,
                        crisp: 0,
                        silky: 0,
                        creamy: 0,
                    },
                },
                cruciferous: {
                    taste: {
                        bitter: 0.5,
                        sweet: 0.2,
                        spicy: 0.2,
                        umami: 0.1,
                        salty: 0,
                        sour: 0,
                    },
                    aroma: {
                        earthy: 0.4,
                        sulfurous: 0.3,
                        woody: 0.2,
                        herbal: 0.1,
                        floral: 0,
                        fruity: 0,
                    },
                    texture: {
                        crunchy: 0.7,
                        crisp: 0.2,
                        tender: 0.1,
                        chewy: 0,
                        silky: 0,
                        creamy: 0,
                    },
                },
                nightshade: {
                    taste: {
                        umami: 0.5,
                        sweet: 0.3,
                        sour: 0.1,
                        bitter: 0.1,
                        salty: 0,
                        spicy: 0,
                    },
                    aroma: {
                        fruity: 0.5,
                        earthy: 0.3,
                        herbal: 0.2,
                        floral: 0,
                        woody: 0,
                        spicy: 0,
                    },
                    texture: {
                        tender: 0.5,
                        juicy: 0.3,
                        chewy: 0.2,
                        crisp: 0,
                        crunchy: 0,
                        silky: 0,
                    },
                },
                squash: {
                    taste: {
                        sweet: 0.6,
                        earthy: 0.2,
                        nutty: 0.2,
                        bitter: 0,
                        salty: 0,
                        sour: 0,
                    },
                    aroma: {
                        earthy: 0.4,
                        sweet: 0.4,
                        woody: 0.1,
                        herbal: 0.1,
                        floral: 0,
                        spicy: 0,
                    },
                    texture: {
                        tender: 0.4,
                        creamy: 0.3,
                        chewy: 0.2,
                        crisp: 0.1,
                        crunchy: 0,
                        silky: 0,
                    },
                },
                legume: {
                    taste: {
                        earthy: 0.5,
                        sweet: 0.3,
                        umami: 0.2,
                        bitter: 0,
                        salty: 0,
                        sour: 0,
                    },
                    aroma: {
                        earthy: 0.6,
                        nutty: 0.3,
                        herbal: 0.1,
                        floral: 0,
                        fruity: 0,
                        spicy: 0,
                    },
                    texture: {
                        tender: 0.4,
                        creamy: 0.3,
                        chewy: 0.3,
                        crisp: 0,
                        crunchy: 0,
                        silky: 0,
                    },
                },
                starchy: {
                    taste: {
                        sweet: 0.5,
                        earthy: 0.3,
                        umami: 0.2,
                        bitter: 0,
                        salty: 0,
                        sour: 0,
                    },
                    aroma: {
                        earthy: 0.7,
                        nutty: 0.2,
                        herbal: 0.1,
                        floral: 0,
                        fruity: 0,
                        spicy: 0,
                    },
                    texture: {
                        starchy: 0.6,
                        tender: 0.2,
                        creamy: 0.2,
                        crisp: 0,
                        crunchy: 0,
                        silky: 0,
                    },
                },
            };
            // Select appropriate profile or use default
            const profile = profiles[String(subCategory)] || {
                taste: {
                    sweet: 0.25,
                    bitter: 0.25,
                    umami: 0.25,
                    salty: 0.15,
                    sour: 0.1,
                    spicy: 0,
                },
                aroma: {
                    earthy: 0.3,
                    herbal: 0.3,
                    woody: 0.2,
                    fruity: 0.1,
                    floral: 0.1,
                    spicy: 0,
                },
                texture: {
                    tender: 0.3,
                    crunchy: 0.3,
                    crisp: 0.2,
                    chewy: 0.1,
                    creamy: 0.1,
                    silky: 0,
                },
            };
            enhanced.sensoryProfile = profile;
        }
        acc[key] = enhanced;
        return acc;
    }, {});
}
exports.enhanceVegetableTransformations = enhanceVegetableTransformations;
/**
 * Enhances oil properties with additional culinary, sensory, and transformation details
 * @param oils Record of oil ingredients
 * @returns Enhanced oil ingredients with complete properties
 */
function enhanceOilProperties(oils) {
    return Object.entries(oils).reduce((acc, [key, oil]) => {
        // Start with the original oil
        const enhancedOil = { ...oil };
        // Ensure basic properties exist
        enhancedOil.category = String(enhancedOil.category || 'oil');
        enhancedOil.elementalProperties = String(JSON.stringify(enhancedOil.elementalProperties || {
            Fire: 0.3,
            Water: 0.2,
            Earth: 0.3,
            Air: 0.2,
        }));
        enhancedOil.qualities = String(Array.isArray(enhancedOil.qualities)
            ? JSON.stringify(enhancedOil.qualities)
            : JSON.stringify([]));
        // Create default sensory profile if none exists
        if (!enhancedOil.sensoryProfile) {
            const oilType = key.toLowerCase();
            const isFruity = oilType.includes('olive') || oilType.includes('avocado');
            const isNutty = oilType.includes('nut') ||
                oilType.includes('sesame') ||
                oilType.includes('walnut') ||
                oilType.includes('almond') ||
                oilType.includes('peanut');
            const isFloral = oilType.includes('sunflower') || oilType.includes('safflower');
            const isNeutral = oilType.includes('vegetable') ||
                oilType.includes('canola') ||
                oilType.includes('grapeseed');
            const isTropical = oilType.includes('coconut') || oilType.includes('palm');
            enhancedOil.sensoryProfile = String(JSON.stringify({
                taste: {
                    sweet: isFruity || isTropical ? 0.6 : 0.2,
                    bitter: isNutty ? 0.4 : 0.1,
                    umami: isNutty ? 0.5 : 0.2,
                    rich: isNutty || isFruity ? 0.7 : 0.4,
                },
                aroma: {
                    fruity: isFruity ? 0.8 : 0.1,
                    nutty: isNutty ? 0.8 : 0.1,
                    floral: isFloral ? 0.7 : 0.1,
                    neutral: isNeutral ? 0.9 : 0.2,
                    tropical: isTropical ? 0.8 : 0.1,
                },
                texture: {
                    viscosity: isTropical || oilType.includes('olive') ? 0.7 : 0.5,
                    mouthfeel: isFruity || isNutty ? 0.8 : 0.5,
                    richness: isFruity || isNutty || isTropical ? 0.7 : 0.4,
                },
            }));
        }
        // Enhance culinary applications if present
        if (enhancedOil.culinaryApplications) {
            // Ensure all application types are properly structured
            Object.entries(enhancedOil.culinaryApplications).forEach(([appType, application]) => {
                if (application && typeof application === 'object') {
                    const appData = application;
                    enhancedOil.culinaryApplications[appType] = String(JSON.stringify({
                        ...application,
                        elementalEffect: (appData === null || appData === void 0 ? void 0 : appData.elementalEffect) || {
                            Fire: appType === 'frying' ||
                                appType === 'cooking' ||
                                appType === 'highHeat'
                                ? 0.2
                                : 0.1,
                            Water: appType === 'dressing' || appType === 'marinade' ? 0.2 : 0.1,
                            Earth: appType === 'baking' || appType === 'roasting' ? 0.2 : 0.1,
                            Air: appType === 'emulsion' || appType === 'whipping' ? 0.2 : 0.1,
                        },
                        alchemicalEffect: (appData === null || appData === void 0 ? void 0 : appData.alchemicalEffect) || {
                            spirit: appType === 'finishing' || appType === 'infusion' ? 0.2 : 0.1,
                            essence: appType === 'dressing' || appType === 'marinade' ? 0.2 : 0.1,
                            matter: appType === 'baking' || appType === 'cooking' ? 0.2 : 0.1,
                            substance: appType === 'frying' || appType === 'highHeat' ? 0.2 : 0.1,
                        },
                    }));
                }
            });
        }
        else {
            // Create default culinary applications based on smoke point and oil type
            const smokePointData = enhancedOil.smokePoint;
            const smokePoint = Number(smokePointData === null || smokePointData === void 0 ? void 0 : smokePointData.fahrenheit) || 0;
            const isHighHeat = smokePoint > 400;
            const isMediumHeat = smokePoint > 325 && smokePoint <= 400;
            const isLowHeat = smokePoint <= 325;
            const isFinishing = key.toLowerCase().includes('olive') ||
                key.toLowerCase().includes('walnut') ||
                key.toLowerCase().includes('sesame') ||
                key.toLowerCase().includes('pumpkin');
            enhancedOil.culinaryApplications = String(JSON.stringify({
                ...(isHighHeat
                    ? {
                        frying: {
                            notes: ['Excellent for high-heat cooking'],
                            techniques: ['Deep frying', 'Stir-frying', 'Sautéing'],
                            elementalEffect: { Fire: 0.3, Earth: 0.1 },
                            alchemicalEffect: { substance: 0.3, matter: 0.2 },
                        },
                    }
                    : {}),
                ...(isMediumHeat
                    ? {
                        cooking: {
                            notes: ['Good for medium-heat cooking'],
                            techniques: ['Sautéing', 'Pan frying', 'Roasting'],
                            elementalEffect: { Fire: 0.2, Earth: 0.2 },
                            alchemicalEffect: { matter: 0.3, essence: 0.1 },
                        },
                    }
                    : {}),
                ...(isLowHeat || isFinishing
                    ? {
                        finishing: {
                            notes: ['Best used unheated or low heat'],
                            techniques: ['Drizzling', 'Dressings', 'Dips'],
                            elementalEffect: { Water: 0.3, Air: 0.2 },
                            alchemicalEffect: { spirit: 0.3, essence: 0.2 },
                        },
                    }
                    : {}),
                ...(enhancedOil.subCategory === 'baking' ||
                    key.toLowerCase().includes('coconut')
                    ? {
                        baking: {
                            notes: ['Suitable for baked goods'],
                            techniques: ['Cakes', 'Cookies', 'Breads'],
                            elementalEffect: { Earth: 0.3, Fire: 0.1 },
                            alchemicalEffect: { matter: 0.3, substance: 0.1 },
                        },
                    }
                    : {}),
            }));
        }
        // Add cooking transformations if they don't exist
        if (!enhancedOil.elementalTransformation) {
            enhancedOil.elementalTransformation = String(JSON.stringify({
                whenHeated: {
                    Fire: 0.2,
                    Air: 0.1,
                    Water: -0.1,
                    Earth: -0.05,
                },
                whenCooled: {
                    Water: 0.1,
                    Earth: 0.2,
                    Fire: -0.1,
                    Air: -0.05,
                },
                whenMixed: {
                    Air: 0.15,
                    Water: 0.1,
                    Fire: -0.05,
                    Earth: -0.05,
                },
                whenInfused: {
                    Air: 0.2,
                    Fire: 0.1,
                    Earth: -0.05,
                    Water: -0.05,
                },
            }));
        }
        // Add thermodynamic properties if they don't exist
        if (!enhancedOil.thermodynamicProperties) {
            // Base on smoke point if available
            const smokePointData = enhancedOil.smokePoint;
            const smokePoint = Number(smokePointData === null || smokePointData === void 0 ? void 0 : smokePointData.fahrenheit) || 350;
            const normalizedSmokePoint = (smokePoint - 300) / 250; // Normalize between 300-550°F
            const heatValue = 0.5 + normalizedSmokePoint * 0.4; // Scale 0.5-0.9
            enhancedOil.thermodynamicProperties = String(JSON.stringify({
                heat: Math.min(Math.max(heatValue, 0.3), 0.9),
                entropy: 0.4,
                reactivity: 0.6,
                energy: 0.7,
            }));
        }
        // Add recommended cooking methods if they don't exist
        if (!enhancedOil.recommendedCookingMethods) {
            const smokePointData = enhancedOil.smokePoint;
            const smokePoint = Number(smokePointData === null || smokePointData === void 0 ? void 0 : smokePointData.fahrenheit) || 0;
            const methods = [];
            if (smokePoint > 400) {
                methods.push({ name: 'deepFrying', potency: 0.9 });
                methods.push({ name: 'stirFrying', potency: 0.9 });
                methods.push({ name: 'sautéing', potency: 0.8 });
            }
            if (smokePoint > 350) {
                methods.push({ name: 'roasting', potency: 0.7 });
                methods.push({ name: 'baking', potency: 0.7 });
            }
            if (enhancedOil.subCategory === 'finishing' || smokePoint < 350) {
                methods.push({ name: 'dressing', potency: 0.9 });
                methods.push({ name: 'marinating', potency: 0.8 });
                methods.push({ name: 'drizzling', potency: 1.0 });
            }
            enhancedOil.recommendedCookingMethods = String(JSON.stringify(methods));
        }
        acc[key] = enhancedOil;
        return acc;
    }, {});
}
exports.enhanceOilProperties = enhanceOilProperties;
/**
 * Pattern OO-3: Utility Import Alignment - Standalone exports for TS2614 compatibility
 */
function getCurrentElementalState() {
    return ElementalCalculator_1.ElementalCalculator.getCurrentElementalState();
}
exports.getCurrentElementalState = getCurrentElementalState;
function getDefaultElementalProperties() {
    return elementalConstants_1.DEFAULT_ELEMENTAL_PROPERTIES;
}
exports.getDefaultElementalProperties = getDefaultElementalProperties;
function ensureLowercaseFormat(properties) {
    if (!properties || typeof properties !== 'object') {
        return properties;
    }
    const lowercaseProps = {};
    for (const [key, value] of Object.entries(properties)) {
        // Convert capitalized element names to lowercase
        const lowerKey = key.toLowerCase();
        lowercaseProps[lowerKey] = value;
    }
    return lowercaseProps;
}
exports.ensureLowercaseFormat = ensureLowercaseFormat;
/**
 * Ensures the returned object always matches the IngredientMapping interface at runtime.
 */
const fixIngredientMapping = (mapping, key) => {
    // Format key into a readable name if no name is provided
    const formattedName = key
        .split('_')
        .map((word) => word.charAt(0).toUpperCase() + word.slice(1))
        .join(' ');
    // Ensure all required elements exist in elementalProperties
    const elementalProperties = mapping.elementalProperties
        ? (0, exports.ensureCompleteElementalProperties)(mapping.elementalProperties)
        : elementalConstants_1.DEFAULT_ELEMENTAL_PROPERTIES;
    // Add runtime type guard (minimal, since normalization is already enforced)
    const requiredKeys = ['name', 'category', 'elementalProperties'];
    for (const k of requiredKeys) {
        if (!(k in mapping)) {
            throw new Error(`fixIngredientMapping: Missing required key '${k}' for ingredient '${key}'`);
        }
    }
    // Ensure astrologicalProfile has minimal structure if present but empty
    if (mapping.astrologicalProfile && typeof mapping.astrologicalProfile === 'object' && Object.keys(mapping.astrologicalProfile).length === 0) {
        mapping.astrologicalProfile = {
            rulingPlanets: [],
            favorableZodiac: []
        };
    }
    return {
        ...mapping,
        name: mapping.name || formattedName,
        elementalProperties,
    };
};
exports.fixIngredientMapping = fixIngredientMapping;
/**
 * Normalizes all ingredient mappings and guarantees type safety for downstream usage.
 */
const fixIngredientMappings = (ingredients) => {
    const result = {};
    Object.entries(ingredients).forEach(([key, mapping]) => {
        result[key] = (0, exports.fixIngredientMapping)(mapping, key);
    });
    return result;
};
exports.fixIngredientMappings = fixIngredientMappings;
/**
 * Fixes ingredient mappings by ensuring all required properties are present
 * @param ingredients Raw ingredient mappings
 * @returns Fixed ingredient mappings
 */
function fixRawIngredientMappings(ingredients) {
    return Object.entries(ingredients).reduce((acc, [key, value]) => {
        // Skip null or undefined values
        if (!value)
            return acc;
        const valueData = value;
        // Ensure elemental properties are normalized
        const elementalProperties = (0, exports.normalizeProperties)((valueData === null || valueData === void 0 ? void 0 : valueData.elementalProperties) || {});
        // Create a standardized astrological profile if one doesn't exist
        const astroProfile = (valueData === null || valueData === void 0 ? void 0 : valueData.astrologicalProfile) || {};
        // Determine base elemental affinity if not provided
        if (!astroProfile.elementalAffinity) {
            const strongestElement = Object.entries(elementalProperties)
                .sort(([, a], [, b]) => b - a)[0][0]
                .toLowerCase();
            astroProfile.elementalAffinity = {
                base: strongestElement,
            };
        }
        acc[key] = {
            ...value,
            name: (valueData === null || valueData === void 0 ? void 0 : valueData.name) || key.replace(/_/g, ' '),
            category: (valueData === null || valueData === void 0 ? void 0 : valueData.category) || 'ingredient',
            elementalProperties,
            astrologicalProfile: astroProfile,
        };
        return acc;
    }, {});
}
exports.fixRawIngredientMappings = fixRawIngredientMappings;
/**
 * Calculate the affinity between two elements based on the Five Elements theory
 * Returns a value between 0 and 1, where:
 * - 1.0: Same element (perfect affinity)
 * - 0.8: Element is generated by (child of) the other
 * - 0.6: Element generates (parent of) the other
 * - 0.4: Neutral relationship
 * - 0.2: Element is controlled by the other
 * - 0.0: Element controls the other (weakest affinity)
 */
function calculateElementalAffinity(element1, element2) {
    const relationship = getElementalRelationship(element1, element2);
    switch (relationship) {
        case 'same':
            return 1.0;
        case 'generating':
            return 0.8;
        case 'controlled-by':
            return 0.6;
        case 'neutral':
            return 0.4;
        case 'weakened-by':
            return 0.2;
        case 'controlling':
            return 0.0;
        default:
            return 0.4;
    }
}
exports.calculateElementalAffinity = calculateElementalAffinity;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy91dGlscy9lbGVtZW50YWxVdGlscy50cyIsIm1hcHBpbmdzIjoiO0FBQUEsOEJBQThCOzs7QUFFOUIsdUVBQThFO0FBVTlFLHdFQUFxRTtBQUNyRSwyREFJNkI7QUFzZHBCLHlGQXpkUCw0QkFBUSxPQXlkTztBQUFFLHNHQXhkakIseUNBQXFCLE9Bd2RpQjtBQUFFLG1HQXZkeEMsc0NBQWtCLE9BdWR3QztBQWhkNUQscUZBRytDO0FBQy9DLG1EQUk0QjtBQUU1Qiw2Q0FBNkM7QUFDN0MsTUFBTSx5QkFBeUIsR0FBRztJQUNoQyxJQUFJLEVBQUU7UUFDSixpQkFBaUIsRUFBRSxDQUFDLFVBQVUsRUFBRSxVQUFVLEVBQUUsU0FBUyxFQUFFLFdBQVcsQ0FBQztRQUNuRSxTQUFTLEVBQUUsQ0FBQyxTQUFTLEVBQUUsTUFBTSxDQUFDO1FBQzlCLFNBQVMsRUFBRSxDQUFDLFdBQVcsRUFBRSxnQkFBZ0IsRUFBRSxTQUFTLENBQUM7UUFDckQsV0FBVyxFQUFFLEtBQUs7S0FDbkI7SUFDRCxLQUFLLEVBQUU7UUFDTCxpQkFBaUIsRUFBRSxDQUFDLFNBQVMsRUFBRSxVQUFVLEVBQUUsVUFBVSxFQUFFLFVBQVUsQ0FBQztRQUNsRSxTQUFTLEVBQUUsQ0FBQyxTQUFTLEVBQUUsT0FBTyxDQUFDO1FBQy9CLFNBQVMsRUFBRSxDQUFDLFNBQVMsRUFBRSxTQUFTLEVBQUUsV0FBVyxDQUFDO1FBQzlDLFdBQVcsRUFBRSxNQUFNO0tBQ3BCO0lBQ0QsS0FBSyxFQUFFO1FBQ0wsaUJBQWlCLEVBQUUsQ0FBQyxRQUFRLEVBQUUsY0FBYyxFQUFFLFVBQVUsRUFBRSxTQUFTLENBQUM7UUFDcEUsU0FBUyxFQUFFLENBQUMsV0FBVyxFQUFFLFNBQVMsQ0FBQztRQUNuQyxTQUFTLEVBQUUsQ0FBQyxXQUFXLEVBQUUsUUFBUSxFQUFFLFlBQVksQ0FBQztRQUNoRCxXQUFXLEVBQUUsVUFBVTtLQUN4QjtJQUNELEdBQUcsRUFBRTtRQUNILGlC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LE9BQU8sR0FBRyxDQUFDO1FBQ2IsS0FBSyxlQUFlO1lBQ2xCLE9BQU8sR0FBRyxDQUFDO1FBQ2IsS0FBSyxTQUFTO1lBQ1osT0FBTyxHQUFHLENBQUM7UUFDYixLQUFLLGFBQWE7WUFDaEIsT0FBTyxHQUFHLENBQUM7UUFDYixLQUFLLGFBQWE7WUFDaEIsT0FBTyxHQUFHLENBQUM7UUFDYjtZQUNFLE9BQU8sR0FBRyxDQUFDO0tBQ2Q7QUFDSCxDQUFDO0FBdEJELGdFQXNCQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvR3JlZ0Nhc3Ryby9EZXNrdG9wL1doYXRUb0VhdE5leHQvc3JjL3V0aWxzL2VsZW1lbnRhbFV0aWxzLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIHNyYy91dGlscy9lbGVtZW50YWxVdGlscy50c1xuXG5pbXBvcnQgeyBERUZBVUxUX0VMRU1FTlRBTF9QUk9QRVJUSUVTIH0gZnJvbSAnQC9jb25zdGFudHMvZWxlbWVudGFsQ29uc3RhbnRzJztcbmltcG9ydCB0eXBlIHtcbiAgRWxlbWVudGFsUHJvcGVydGllcyxcbiAgUmVjaXBlLFxuICBFbGVtZW50YWxBZmZpbml0eSxcbiAgRWxlbWVudGFsQ2hhcmFjdGVyaXN0aWNzLFxuICBFbGVtZW50LFxuICBFbGVtZW50YWxQcm9maWxlLFxufSBmcm9tICdAL3R5cGVzL2FsY2hlbXknO1xuaW1wb3J0IHR5cGUgeyBJbmdyZWRpZW50TWFwcGluZyB9IGZyb20gJ0AvZGF0YS9pbmdyZWRpZW50cy90eXBlcyc7XG5pbXBvcnQgeyBFbGVtZW50YWxDYWxjdWxhdG9yIH0gZnJvbSAnQC9zZXJ2aWNlcy9FbGVtZW50YWxDYWxjdWxhdG9yJztcbmltcG9ydCB7XG4gIGVsZW1lbnRzLFxuICBlbGVtZW50YWxJbnRlcmFjdGlvbnMsXG4gIGVsZW1lbnRhbEZ1bmN0aW9ucyxcbn0gZnJvbSAnLi9lbGVtZW50YWxNYXBwaW5ncyc7XG5pbXBvcnQge1xuICBFbGVtZW50YWxJdGVtLFxufSBmcm9tICdAL3R5cGVzL2FsY2hlbXknO1xuaW1wb3J0IHsgQWxjaGVtaWNhbEl0ZW0gfSBmcm9tICdAL2NhbGN1bGF0aW9ucy9hbGNoZW1pY2FsVHJhbnNmb3JtYXRpb24nO1xuaW1wb3J0IHsgRWxlbWVudGFsQ2hhcmFjdGVyLCBBbGNoZW1pY2FsUHJvcGVydHkgfSBmcm9tICdAL2NvbnN0YW50cy9wbGFuZXRhcnlFbGVtZW50cyc7XG5pbXBvcnQge1xuICBMdW5hclBoYXNlLFxuICBjYWxjdWxhdGVQbGFuZXRhcnlCb29zdCxcbn0gZnJvbSAnQC9jb25zdGFudHMvcGxhbmV0YXJ5Rm9vZEFzc29jaWF0aW9ucyc7XG5pbXBvcnQgeyBcbiAgaXNFbGVtZW50YWxQcm9wZXJ0aWVzLCBcbiAgaXNFbGVtZW50YWxQcm9wZXJ0eUtleSwgXG4gIGxvZ1VuZXhwZWN0ZWRWYWx1ZSBcbn0gZnJvbSAnQC91dGlscy92YWxpZGF0aW9uJztcblxuLy8gTWlzc2luZyBFTEVNRU5UQUxfQ0hBUkFDVEVSSVNUSUNTIGNvbnN0YW50XG5jb25zdCBFTEVNRU5UQUxfQ0hBUkFDVEVSSVNUSUNTID0ge1xuICBGaXJlOiB7XG4gICAgY29va2luZ1RlY2huaXF1ZXM6IFsnZ3JpbGxpbmcnLCAncm9hc3RpbmcnLCAnc2VhcmluZycsICdmbGFtYsOpaW5nJ10sXG4gICAgdGltZU9mRGF5OiBbJ21vcm5pbmcnLCAnbm9vbiddLFxuICAgIHF1YWxpdGllczogWydlbmVyZ2V0aWMnLCAndHJhbnNmb3JtYXRpdmUnLCAnaW50ZW5zZSddLFxuICAgIHRlbXBlcmF0dXJlOiAnaG90J1xuICB9LFxuICBXYXRlcjoge1xuICAgIGNvb2tpbmdUZWNobmlxdWVzOiBbJ2JvaWxpbmcnLCAnc3RlYW1pbmcnLCAncG9hY2hpbmcnLCAnYnJhaXNpbmcnXSxcbiAgICB0aW1lT2ZEYXk6IFsnZXZlbmluZycsICduaWdodCddLFxuICAgIHF1YWxpdGllczogWydmbG93aW5nJywgJ2Nvb2xpbmcnLCAnbnVydHVyaW5nJ10sXG4gICAgdGVtcGVyYXR1cmU6ICdjb29sJ1xuICB9LFxuICBFYXJ0aDoge1xuICAgIGNvb2tpbmdUZWNobmlxdWVzOiBbJ2Jha2luZycsICdzbG93LWNvb2tpbmcnLCAncm9hc3RpbmcnLCAnc21va2luZyddLFxuICAgIHRpbWVPZkRheTogWydhZnRlcm5vb24nLCAnZXZlbmluZyddLFxuICAgIHF1YWxpdGllczogWydncm91bmRpbmcnLCAnc3RhYmxlJywgJ25vdXJpc2hpbmcnXSxcbiAgICB0ZW1wZXJhdHVyZTogJ21vZGVyYXRlJ1xuICB9LFxuICBBaXI6IHtcbiAgICBjb29raW5nVGVjaG5pcXVlczogWyd3aGlwcGluZycsICdmcnlpbmcnLCAnc2F1dMOpaW5nJywgJ2RlaHlkcmF0aW5nJ10sXG4gICAgdGltZU9mRGF5OiBbJ21vcm5pbmcnLCAnbWlkZGF5J10sXG4gICAgcXVhbGl0aWVzOiBbJ2xpZ2h0JywgJ2FpcnknLCAncXVpY2snXSxcbiAgICB0ZW1wZXJhdHVyZTogJ3ZhcmlhYmxlJ1xuICB9XG59O1xuXG4vLyBBbGNoZW1pY2FsUHJvcGVydHkgdHlwZSBpbXBvcnRlZCBmcm9tIEAvY29uc3RhbnRzL3BsYW5ldGFyeUVsZW1lbnRzXG5cbi8qKlxuICogVmFsaWRhdGVzIHRoYXQgZWxlbWVudGFsIHByb3BlcnRpZXMgY29udGFpbiB2YWxpZCB2YWx1ZXNcbiAqIEBwYXJhbSBwcm9wZXJ0aWVzIFRoZSBlbGVtZW50YWwgcHJvcGVydGllcyB0byB2YWxpZGF0ZVxuICogQHJldHVybnMgVHJ1ZSBpZiBwcm9wZXJ0aWVzIGFyZSB2YWxpZCwgZmFsc2Ugb3RoZXJ3aXNlXG4gKi9cbmV4cG9ydCBjb25zdCB2YWxpZGF0ZUVsZW1lbnRhbFByb3BlcnRpZXMgPSAoXG4gIHByb3BlcnRpZXM6IEVsZW1lbnRhbFByb3BlcnRpZXNcbik6IGJvb2xlYW4gPT4ge1xuICAvLyBJZiBwcm9wZXJ0aWVzIGlzIG51bGwgb3IgdW5kZWZpbmVkLCByZXR1cm4gZmFsc2UgaW1tZWRpYXRlbHlcbiAgaWYgKCFwcm9wZXJ0aWVzKSB7XG4gICAgY29uc29sZS53YXJuKCdXYXJuaW5nOiBwcm9wZXJ0aWVzIGlzIG51bGwgb3IgdW5kZWZpbmVkIGluIHZhbGlkYXRlRWxlbWVudGFsUHJvcGVydGllcycpO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIC8vIENoZWNrIGlmIGFsbCByZXF1aXJlZCBlbGVtZW50cyBleGlzdFxuICBjb25zdCByZXF1aXJlZEVsZW1lbnRzID0gWydGaXJlJywgJ1dhdGVyJywgJ0VhcnRoJywgJ0FpciddO1xuICBmb3IgKGNvbnN0IGVsZW1lbnQgb2YgcmVxdWlyZWRFbGVtZW50cykge1xuICAgIGlmICh0eXBlb2YgcHJvcGVydGllc1tlbGVtZW50XSAhPT0gJ251bWJlcicpIHtcbiAgICAgIGNvbnNvbGUud2FybihgV2FybmluZzogcHJvcGVydGllcy4ke2VsZW1lbnR9IGlzIG5vdCBhIG51bWJlciBpbiB2YWxpZGF0ZUVsZW1lbnRhbFByb3BlcnRpZXNgKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICAvLyBDaGVjayBpZiB2YWx1ZXMgYXJlIGJldHdlZW4gMCBhbmQgMVxuICAgIGlmIChwcm9wZXJ0aWVzW2VsZW1lbnRdIDwgMCB8fCBwcm9wZXJ0aWVzW2VsZW1lbnRdID4gMSkge1xuICAgICAgbG9nVW5leHBlY3RlZFZhbHVlKCd2YWxpZGF0ZUVsZW1lbnRhbFByb3BlcnRpZXMnLCB7XG4gICAgICAgIG1lc3NhZ2U6IGBFbGVtZW50IHZhbHVlIG91dCBvZiByYW5nZTogJHtlbGVtZW50fSA9ICR7cHJvcGVydGllc1tlbGVtZW50XX1gLFxuICAgICAgICBlbGVtZW50LFxuICAgICAgICB2YWx1ZTogcHJvcGVydGllc1tlbGVtZW50XSxcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIC8vIE9wdGlvbmFsbHkgY2hlY2sgaWYgcHJvcGVydGllcyBzdW0gdG8gMSAob3IgY2xvc2UgdG8gaXQgZHVlIHRvIGZsb2F0aW5nIHBvaW50KVxuICBjb25zdCBzdW0gPSBPYmplY3QudmFsdWVzKHByb3BlcnRpZXMpLnJlZHVjZSgoYWNjLCB2YWwpID0+IGFjYyArIHZhbCwgMCk7XG4gIGNvbnN0IGlzQ2xvc2VUb09uZSA9IE1hdGguYWJzKHN1bSAtIDEpIDwgMC4wMTtcblxuICBpZiAoIWlzQ2xvc2VUb09uZSkge1xuICAgIGxvZ1VuZXhwZWN0ZWRWYWx1ZSgndmFsaWRhdGVFbGVtZW50YWxQcm9wZXJ0aWVzJywge1xuICAgICAgbWVzc2FnZTogYEVsZW1lbnRhbCBwcm9wZXJ0aWVzIGRvIG5vdCBzdW0gdG8gMTogJHtzdW19YCxcbiAgICAgIHN1bSxcbiAgICAgIHByb3BlcnRpZXMsXG4gICAgfSk7XG4gIH1cblxuICByZXR1cm4gdHJ1ZTtcbn07XG5cbi8qKlxuICogTm9ybWFsaXplcyBlbGVtZW50YWwgcHJvcGVydGllcyB0byBlbnN1cmUgdGhleSBzdW0gdG8gMVxuICogQHBhcmFtIHByb3BlcnRpZXMgVGhlIGVsZW1lbnRhbCBwcm9wZXJ0aWVzIHRvIG5vcm1hbGl6ZVxuICogQHJldHVybnMgTm9ybWFsaXplZCBlbGVtZW50YWwgcHJvcGVydGllc1xuICovXG5leHBvcnQgY29uc3Qgbm9ybWFsaXplUHJvcGVydGllcyA9IChcbiAgcHJvcGVydGllczogUGFydGlhbDxFbGVtZW50YWxQcm9wZXJ0aWVzPlxuKTogRWxlbWVudGFsUHJvcGVydGllcyA9PiB7XG4gIC8vIEhhbmRsZSBudWxsIG9yIHVuZGVmaW5lZFxuICBpZiAoIXByb3BlcnRpZXMpIHtcbiAgICBjb25zb2xlLndhcm4oJ1dhcm5pbmc6IHByb3BlcnRpZXMgaXMgbnVsbCBvciB1bmRlZmluZWQgaW4gbm9ybWFsaXplUHJvcGVydGllcycpO1xuICAgIHJldHVybiB7IC4uLkRFRkFVTFRfRUxFTUVOVEFMX1BST1BFUlRJRVMgfTtcbiAgfVxuXG4gIC8vIEZpbGwgaW4gYW55IG1pc3NpbmcgcHJvcGVydGllcyB3aXRoIGRlZmF1bHRzXG4gIGNvbnN0IGNvbXBsZXRlUHJvcGVydGllczogRWxlbWVudGFsUHJvcGVydGllcyA9IHtcbiAgICBGaXJlOiBwcm9wZXJ0aWVzLkZpcmUgPz8gREVGQVVMVF9FTEVNRU5UQUxfUFJPUEVSVElFUy5GaXJlLFxuICAgIFdhdGVyOiBwcm9wZXJ0aWVzLldhdGVyID8/IERFRkFVTFRfRUxFTUVOVEFMX1BST1BFUlRJRVMuV2F0ZXIsXG4gICAgRWFydGg6IHByb3BlcnRpZXMuRWFydGggPz8gREVGQVVMVF9FTEVNRU5UQUxfUFJPUEVSVElFUy5FYXJ0aCxcbiAgICBBaXI6IHByb3BlcnRpZXMuQWlyID8/IERFRkFVTFRfRUxFTUVOVEFMX1BST1BFUlRJRVMuQWlyLFxuICB9O1xuXG4gIGNvbnN0IHN1bSA9IE9iamVjdC52YWx1ZXMoY29tcGxldGVQcm9wZXJ0aWVzKS5yZWR1Y2UoKGFjYywgdmFsKSA9PiBhY2MgKyB2YWwsIDApO1xuXG4gIGlmIChzdW0gPT09IDApIHtcbiAgICAvLyBJZiBzdW0gaXMgMCwgcmV0dXJuIGJhbGFuY2VkIGRlZmF1bHRcbiAgICBjb25zb2xlLndhcm4oJ1dhcm5pbmc6IHByb3BlcnRpZXMgc3VtIGlzIDAgaW4gbm9ybWFsaXplUHJvcGVydGllcycpO1xuICAgIHJldHVybiB7IC4uLkRFRkFVTFRfRUxFTUVOVEFMX1BST1BFUlRJRVMgfTtcbiAgfVxuXG4gIC8vIE5vcm1hbGl6ZSBlYWNoIHZhbHVlXG4gIHJldHVybiBPYmplY3QuZW50cmllcyhjb21wbGV0ZVByb3BlcnRpZXMpLnJlZHVjZSgoYWNjLCBba2V5LCB2YWx1ZV0pID0+IHtcbiAgICBpZiAoaXNFbGVtZW50YWxQcm9wZXJ0eUtleShrZXkpKSB7XG4gICAgICBhY2Nba2V5XSA9IHZhbHVlIC9zdW07XG4gICAgfSBlbHNlIHtcbiAgICAgIC8vIFRoaXMgc2hvdWxkbid0IGhhcHBlbiB3aXRoIHRoZSB0eXBlLXNhZmV0eSBhYm92ZSwgYnV0IGp1c3QgaW4gY2FzZVxuICAgICAgY29uc29sZS53YXJuKGBXYXJuaW5nOiBpbnZhbGlkIGtleSAke2tleX0gaW4gbm9ybWFsaXplUHJvcGVydGllc2ApO1xuICAgIH1cbiAgICByZXR1cm4gYWNjO1xuICB9LCB7IC4uLkRFRkFVTFRfRUxFTUVOVEFMX1BST1BFUlRJRVMgfSk7XG59O1xuXG4vKipcbiAqIFN0YW5kYXJkaXplcyBlbGVtZW50YWwgcHJvcGVydGllcyBmb3IgcmVjaXBlcywgZW5zdXJpbmcgYWxsIHJlY2lwZXMgaGF2ZVxuICogcHJvcGVybHkgbm9ybWFsaXplZCBlbGVtZW50YWwgdmFsdWVzXG4gKiBAcGFyYW0gcmVjaXBlIFRoZSByZWNpcGUgdG8gc3RhbmRhcmRpemVcbiAqIEByZXR1cm5zIFJlY2lwZSB3aXRoIHN0YW5kYXJkaXplZCBlbGVtZW50YWwgcHJvcGVydGllc1xuICovXG5leHBvcnQgY29uc3Qgc3RhbmRhcmRpemVSZWNpcGVFbGVtZW50cyA9IDxcbiAgVCBleHRlbmRzIHsgZWxlbWVudGFsUHJvcGVydGllcz86IFBhcnRpYWw8RWxlbWVudGFsUHJvcGVydGllcz4gfVxuPihcbiAgcmVjaXBlOiBUIHwgbnVsbCB8IHVuZGVmaW5lZFxuKTogVCAmIHsgZWxlbWVudGFsUHJvcGVydGllczogRWxlbWVudGFsUHJvcGVydGllcyB9ID0+IHtcbiAgLy8gSGFuZGxlIG51bGwgL3VuZGVmaW5lZCByZWNpcGVcbiAgaWYgKCFyZWNpcGUpIHtcbiAgICBjb25zb2xlLndhcm4oJ1dhcm5pbmc6IHJlY2lwZSBpcyBudWxsIG9yIHVuZGVmaW5lZCBpbiBzdGFuZGFyZGl6ZVJlY2lwZUVsZW1lbnRzJyk7XG4gICAgcmV0dXJuIHtcbiAgICAgIGVsZW1lbnRhbFByb3BlcnRpZXM6IHsgLi4uREVGQVVMVF9FTEVNRU5UQUxfUFJPUEVSVElFUyB9XG4gICAgfSBhcyBUICYgeyBlbGVtZW50YWxQcm9wZXJ0aWVzOiBFbGVtZW50YWxQcm9wZXJ0aWVzIH07XG4gIH1cblxuICAvLyBJZiByZWNpcGUgZG9lc24ndCBoYXZlIGVsZW1lbnRhbCBwcm9wZXJ0aWVzLCB1c2UgY3VycmVudCBlbGVtZW50YWwgc3RhdGVcbiAgaWYgKCFyZWNpcGUuZWxlbWVudGFsUHJvcGVydGllcykge1xuICAgIGNvbnN0IGN1cnJlbnRTdGF0ZSA9IEVsZW1lbnRhbENhbGN1bGF0b3IuZ2V0Q3VycmVudEVsZW1lbnRhbFN0YXRlKCk7XG4gICAgcmV0dXJuIHtcbiAgICAgIC4uLnJlY2lwZSxcbiAgICAgIGVsZW1lbnRhbFByb3BlcnRpZXM6IGN1cnJlbnRTdGF0ZSxcbiAgICB9O1xuICB9XG5cbiAgLy8gTm9ybWFsaXplIHByb3BlcnRpZXMgdG8gZW5zdXJlIHRoZXkgc3VtIHRvIDFcbiAgcmV0dXJuIHtcbiAgICAuLi5yZWNpcGUsXG4gICAgZWxlbWVudGFsUHJvcGVydGllczogbm9ybWFsaXplUHJvcGVydGllcyhyZWNpcGUuZWxlbWVudGFsUHJvcGVydGllcyksXG4gIH07XG59O1xuXG5leHBvcnQgY29uc3QgdmFsaWRhdGVFbGVtZW50YWxSZXF1aXJlbWVudHMgPSAoXG4gIHByb3BlcnRpZXM6IHVua25vd25cbik6IHByb3BlcnRpZXMgaXMgRWxlbWVudGFsUHJvcGVydGllcyA9PiB7XG4gIHJldHVybiBpc0VsZW1lbnRhbFByb3BlcnRpZXMocHJvcGVydGllcyk7XG59O1xuXG4vKipcbiAqIEdldHMgdGhlIGVsZW1lbnRzIHRoYXQgYXJlIG1pc3Npbmcgb3Igc2lnbmlmaWNhbnRseSBsb3dlciB0aGFuIGlkZWFsIGJhbGFuY2UgaW4gdGhlIHByb3ZpZGVkIHByb3BlcnRpZXNcbiAqIEBwYXJhbSBwcm9wZXJ0aWVzIFRoZSBlbGVtZW50YWwgcHJvcGVydGllcyB0byBjaGVja1xuICogQHJldHVybnMgQXJyYXkgb2YgZWxlbWVudHMgdGhhdCBhcmUgbWlzc2luZyBvciBsb3dcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldE1pc3NpbmdFbGVtZW50cyhcbiAgcHJvcGVydGllczogUGFydGlhbDxFbGVtZW50YWxQcm9wZXJ0aWVzPiB8IG51bGwgfCB1bmRlZmluZWRcbik6IEVsZW1lbnRbXSB7XG4gIGlmICghcHJvcGVydGllcykge1xuICAgIHJldHVybiBbJ0ZpcmUnLCAnV2F0ZXInLCAnRWFydGgnLCAnQWlyJ107XG4gIH1cblxuICBjb25zdCBtaXNzaW5nOiBFbGVtZW50W10gPSBbXTtcbiAgY29uc3QgaWRlYWxCYWxhbmNlID0gMC4yNTsgLy8gRWFjaCBlbGVtZW50IHNob3VsZCBpZGVhbGx5IGJlIDI1JVxuICBjb25zdCB0aHJlc2hvbGQgPSAwLjE1OyAvLyBDb25zaWRlciBtaXNzaW5nIGlmIGJlbG93IDE1JVxuXG4gIGZvciAoY29uc3QgZWxlbWVudCBvZiBbJ0ZpcmUnLCAnV2F0ZXInLCAnRWFydGgnLCAnQWlyJ10gYXMgRWxlbWVudFtdKSB7XG4gICAgY29uc3QgdmFsdWUgPSBwcm9wZXJ0aWVzW2VsZW1lbnRdIHx8IDA7XG4gICAgaWYgKHZhbHVlIDwgdGhyZXNob2xkKSB7XG4gICAgICBtaXNzaW5nLnB1c2goZWxlbWVudCk7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIG1pc3Npbmc7XG59XG5cbmV4cG9ydCBjb25zdCBlbGVtZW50YWxVdGlscyA9IHtcbiAgdmFsaWRhdGVQcm9wZXJ0aWVzOiB2YWxpZGF0ZUVsZW1lbnRhbFJlcXVpcmVtZW50cyxcbiAgbm9ybWFsaXplUHJvcGVydGllczogbm9ybWFsaXplUHJvcGVydGllcyxcbiAgc3RhbmRhcmRpemVSZWNpcGVFbGVtZW50czogc3RhbmRhcmRpemVSZWNpcGVFbGVtZW50cyxcbiAgZ2V0TWlzc2luZ0VsZW1lbnRzLFxuXG4gIGNhbGN1bGF0ZWVsZW1lbnRhbFN0YXRlKHJlY2lwZTogUmVjaXBlIHwgbnVsbCB8IHVuZGVmaW5lZCk6IEVsZW1lbnRhbFByb3BlcnRpZXMge1xuICAgIGlmICghcmVjaXBlPy5pbmdyZWRpZW50cz8ubGVuZ3RoKSB7XG4gICAgICByZXR1cm4gRWxlbWVudGFsQ2FsY3VsYXRvci5nZXRDdXJyZW50RWxlbWVudGFsU3RhdGUoKTtcbiAgICB9XG5cbiAgICAvLyBDcmVhdGUgYSBzYWZlIGRlZmF1bHQgYmFsYW5jZSB0byBzdGFydFxuICAgIGNvbnN0IGJhbGFuY2U6IEVsZW1lbnRhbFByb3BlcnRpZXMgPSB7IC4uLkRFRkFVTFRfRUxFTUVOVEFMX1BST1BFUlRJRVMgfTtcbiAgICBcbiAgICAvLyBHZXQgdG90YWwgYW1vdW50IGZvciBwZXJjZW50YWdlIGNhbGN1bGF0aW9uc1xuICAgIGNvbnN0IHRvdGFsQW1vdW50ID0gcmVjaXBlLmluZ3JlZGllbnRzLnJlZHVjZSgoc3VtLCBpbmcpID0+IHtcbiAgICAgIGNvbnN0IGFtb3VudCA9IGluZy5hbW91bnQgPz8gMTsgLy8gRGVmYXVsdCB0byAxIGlmIGFtb3VudCBpcyBtaXNzaW5nXG4gICAgICByZXR1cm4gc3VtICsgYW1vdW50O1xuICAgIH0sIDApO1xuXG4gICAgLy8gSGFuZGxlIHRoZSBzcGVjaWFsIGNhc2Ugd2hlcmUgdGhlcmUgYXJlIG5vIGluZ3JlZGllbnRzIHdpdGggYW1vdW50XG4gICAgaWYgKHRvdGFsQW1vdW50ID09PSAwKSB7XG4gICAgICByZXR1cm4gYmFsYW5jZTtcbiAgICB9XG5cbiAgICAvLyBJbml0aWFsaXplIGJhbGFuY2Ugd2l0aCAwIHZhbHVlc1xuICAgIE9iamVjdC5rZXlzKGJhbGFuY2UpLmZvckVhY2goZWwgPT4ge1xuICAgICAgaWYgKGlzRWxlbWVudGFsUHJvcGVydHlLZXkoZWwpKSB7XG4gICAgICAgIGJhbGFuY2VbZWxdID0gMDtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIFByb2Nlc3MgZWFjaCBpbmdyZWRpZW50XG4gICAgcmVjaXBlLmluZ3JlZGllbnRzLmZvckVhY2goaW5nID0+IHtcbiAgICAgIGNvbnN0IGFtb3VudCA9IGluZy5hbW91bnQgPz8gMTsgLy8gRGVmYXVsdCB0byAxIGlmIGFtb3VudCBpcyBtaXNzaW5nXG4gICAgICBcbiAgICAgIGlmIChpbmcuZWxlbWVudGFsUHJvcGVydGllcykge1xuICAgICAgICAvLyBGb3IgZWFjaCBlbGVtZW50IGluIHRoZSBpbmdyZWRpZW50XG4gICAgICAgIE9iamVjdC5lbnRyaWVzKGluZy5lbGVtZW50YWxQcm9wZXJ0aWVzKS5mb3JFYWNoKChbZWxlbWVudCwgdmFsdWVdKSA9PiB7XG4gICAgICAgICAgaWYgKGlzRWxlbWVudGFsUHJvcGVydHlLZXkoZWxlbWVudCkpIHtcbiAgICAgICAgICAgIGJhbGFuY2VbZWxlbWVudF0gKz0gKHZhbHVlICogYW1vdW50KSAvdG90YWxBbW91bnQ7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIE5vcm1hbGl6ZSB0byBlbnN1cmUgdGhleSBzdW0gdG8gMVxuICAgIHJldHVybiBub3JtYWxpemVQcm9wZXJ0aWVzKGJhbGFuY2UpO1xuICB9LFxuXG4gIGNvbWJpbmVQcm9wZXJ0aWVzKFxuICAgIGE6IEVsZW1lbnRhbFByb3BlcnRpZXMsXG4gICAgYjogRWxlbWVudGFsUHJvcGVydGllcyxcbiAgICBiV2VpZ2h0ID0gMC41XG4gICk6IEVsZW1lbnRhbFByb3BlcnRpZXMge1xuICAgIGNvbnN0IGNvbWJpbmVkUHJvcHMgPSB7fSBhcyBFbGVtZW50YWxQcm9wZXJ0aWVzO1xuICAgIGNvbnN0IGFXZWlnaHQgPSAxIC0gYldlaWdodDtcblxuICAgIE9iamVjdC5rZXlzKGEpLmZvckVhY2goKGtleSkgPT4ge1xuICAgICAgY29uc3QgZWxlbWVudCA9IGtleSBhcyBrZXlvZiBFbGVtZW50YWxQcm9wZXJ0aWVzO1xuICAgICAgY29tYmluZWRQcm9wc1tlbGVtZW50XSA9XG4gICAgICAgIGFbZWxlbWVudF0gKiBhV2VpZ2h0ICsgKGJbZWxlbWVudF0gfHwgMCkgKiBiV2VpZ2h0O1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIGNvbWJpbmVkUHJvcHM7XG4gIH0sXG5cbiAgZ2V0ZWxlbWVudGFsU3RhdGUocmVjaXBlOiBSZWNpcGUpOiBFbGVtZW50YWxQcm9wZXJ0aWVzIHtcbiAgICBpZiAoIXJlY2lwZS5pbmdyZWRpZW50cz8ubGVuZ3RoKSB7XG4gICAgICByZXR1cm4gRWxlbWVudGFsQ2FsY3VsYXRvci5nZXRDdXJyZW50RWxlbWVudGFsU3RhdGUoKTtcbiAgICB9XG5cbiAgICBjb25zdCBjb21iaW5lZFByb3BlcnRpZXMgPSByZWNpcGUuaW5ncmVkaWVudHMucmVkdWNlKFxuICAgICAgKGFjYywgaW5ncmVkaWVudCkgPT4ge1xuICAgICAgICBjb25zdCBwcm9wcyA9XG4gICAgICAgICAgaW5ncmVkaWVudC5lbGVtZW50YWxQcm9wZXJ0aWVzIHx8XG4gICAgICAgICAgRWxlbWVudGFsQ2FsY3VsYXRvci5nZXRDdXJyZW50RWxlbWVudGFsU3RhdGUoKTtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBGaXJlOiBhY2MuRmlyZSArIHByb3BzLkZpcmUsXG4gICAgICAgICAgV2F0ZXI6IGFjYy5XYXRlciArIHByb3BzLldhdGVyLFxuICAgICAgICAgIEVhcnRoOiBhY2MuRWFydGggKyBwcm9wcy5FYXJ0aCxcbiAgICAgICAgICBBaXI6IGFjYy5BaXIgKyBwcm9wcy5BaXIsXG4gICAgICAgIH07XG4gICAgICB9LFxuICAgICAgeyBGaXJlOiAwLCBXYXRlcjogMCwgRWFydGg6IDAsIEFpcjogMCB9XG4gICAgKTtcblxuICAgIHJldHVybiBub3JtYWxpemVQcm9wZXJ0aWVzKGNvbWJpbmVkUHJvcGVydGllcyk7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEdldHMgYSBjb21wbGVtZW50YXJ5IGVsZW1lbnQgdGhhdCB3b3JrcyB3ZWxsIHdpdGggdGhlIGdpdmVuIGVsZW1lbnRcbiAgICogQWxsIGVsZW1lbnRzIHdvcmsgd2VsbCB0b2dldGhlciBpbiB0aGVpciBvd24gd2F5XG4gICAqIEBwYXJhbSBlbGVtZW50IFRoZSBlbGVtZW50IHRvIGZpbmQgYSBjb21wbGVtZW50IGZvclxuICAgKiBAcmV0dXJucyBUaGUgY29tcGxlbWVudGFyeSBlbGVtZW50XG4gICAqL1xuICBnZXRDb21wbGVtZW50YXJ5RWxlbWVudChcbiAgICBlbGVtZW50OiBrZXlvZiBFbGVtZW50YWxQcm9wZXJ0aWVzXG4gICk6IGtleW9mIEVsZW1lbnRhbFByb3BlcnRpZXMge1xuICAgIC8vIEVhY2ggZWxlbWVudCBjb21wbGVtZW50cyBhbGwgb3RoZXJzLCBidXQgd2UgcmV0dXJuIG9uZSBzdWdnZXN0aW9uXG4gICAgLy8gYmFzZWQgb24gdHJhZGl0aW9uYWwgY3VsaW5hcnkgcGFpcmluZ3NcbiAgICBjb25zdCBjb21wbGVtZW50YXJ5OiBSZWNvcmQ8XG4gICAgICBrZXlvZiBFbGVtZW50YWxQcm9wZXJ0aWVzLFxuICAgICAga2V5b2YgRWxlbWVudGFsUHJvcGVydGllc1xuICAgID4gPSB7XG4gICAgICBGaXJlOiAnRmlyZScsIC8vIEZpcmUgcmVpbmZvcmNlcyBpdHNlbGZcbiAgICAgIFdhdGVyOiAnV2F0ZXInLCAvLyBXYXRlciByZWluZm9yY2VzIGl0c2VsZlxuICAgICAgRWFydGg6ICdFYXJ0aCcsIC8vIEVhcnRoIHJlaW5mb3JjZXMgaXRzZWxmXG4gICAgICBBaXI6ICdBaXInLCAvLyBBaXIgcmVpbmZvcmNlcyBpdHNlbGZcbiAgICB9O1xuICAgIHJldHVybiBjb21wbGVtZW50YXJ5W2VsZW1lbnRdO1xuICB9LFxuXG4gIC8qKlxuICAgKiBHZXRzIHRoZSBlbGVtZW50YWwgY2hhcmFjdGVyaXN0aWNzIGZvciBhIHNwZWNpZmljIGVsZW1lbnRcbiAgICogQHBhcmFtIGVsZW1lbnQgVGhlIGVsZW1lbnQgdG8gZ2V0IGNoYXJhY3RlcmlzdGljcyBmb3JcbiAgICogQHJldHVybnMgVGhlIGVsZW1lbnRhbCBjaGFyYWN0ZXJpc3RpY3NcbiAgICovXG4gIGdldEVsZW1lbnRhbENoYXJhY3RlcmlzdGljcyhlbGVtZW50OiBFbGVtZW50KTogRWxlbWVudGFsQ2hhcmFjdGVyaXN0aWNzIHtcbiAgICByZXR1cm4gRUxFTUVOVEFMX0NIQVJBQ1RFUklTVElDU1tlbGVtZW50XSBhcyB1bmtub3duIGFzIEVsZW1lbnRhbENoYXJhY3RlcmlzdGljcztcbiAgfSxcblxuICAvKipcbiAgICogR2V0cyBhIGNvbXBsZXRlIGVsZW1lbnRhbCBwcm9maWxlIHRoYXQgaW5jbHVkZXMgcHJvcGVydGllcyBhbmQgY2hhcmFjdGVyaXN0aWNzXG4gICAqIEBwYXJhbSBwcm9wZXJ0aWVzIFRoZSBlbGVtZW50YWwgcHJvcGVydGllc1xuICAgKiBAcmV0dXJucyBBIGNvbXBsZXRlIGVsZW1lbnRhbCBwcm9maWxlXG4gICAqL1xuICBnZXRFbGVtZW50YWxQcm9maWxlKFxuICAgIHByb3BlcnRpZXM6IEVsZW1lbnRhbFByb3BlcnRpZXNcbiAgKTogUGFydGlhbDxFbGVtZW50YWxQcm9maWxlPiB7XG4gICAgLy8gRmluZCB0aGUgZG9taW5hbnQgZWxlbWVudFxuICAgIGNvbnN0IGVudHJpZXMgPSBPYmplY3QuZW50cmllcyhwcm9wZXJ0aWVzKSBhcyBbRWxlbWVudCwgbnVtYmVyXVtdO1xuICAgIGxldCBkb21pbmFudEVsZW1lbnQ6IEVsZW1lbnQgPSAnRmlyZSc7XG4gICAgbGV0IG1heFZhbHVlID0gMDtcblxuICAgIGZvciAoY29uc3QgW2VsZW1lbnQsIHZhbHVlXSBvZiBlbnRyaWVzKSB7XG4gICAgICBpZiAodmFsdWUgPiBtYXhWYWx1ZSkge1xuICAgICAgICBkb21pbmFudEVsZW1lbnQgPSBlbGVtZW50O1xuICAgICAgICBtYXhWYWx1ZSA9IHZhbHVlO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICBkb21pbmFudDogZG9taW5hbnRFbGVtZW50IGFzICdGaXJlJyB8ICdXYXRlcicgfCAnRWFydGgnIHwgJ0FpcicsXG4gICAgICBiYWxhbmNlOiBwcm9wZXJ0aWVzLFxuICAgICAgY2hhcmFjdGVyaXN0aWNzOiBbdGhpcy5nZXRFbGVtZW50YWxDaGFyYWN0ZXJpc3RpY3MoZG9taW5hbnRFbGVtZW50IGFzIEVsZW1lbnQpXSxcbiAgICB9O1xuICB9LFxuXG4gIC8qKlxuICAgKiBHZXRzIHRoZSBzdWdnZXN0ZWQgY29va2luZyB0ZWNobmlxdWVzIGJhc2VkIG9uIGVsZW1lbnRhbCBwcm9wZXJ0aWVzXG4gICAqIEBwYXJhbSBwcm9wZXJ0aWVzIFRoZSBlbGVtZW50YWwgcHJvcGVydGllc1xuICAgKiBAcmV0dXJucyBBcnJheSBvZiByZWNvbW1lbmRlZCBjb29raW5nIHRlY2huaXF1ZXNcbiAgICovXG4gIGdldFN1Z2dlc3RlZENvb2tpbmdUZWNobmlxdWVzKHByb3BlcnRpZXM6IEVsZW1lbnRhbFByb3BlcnRpZXMpOiBzdHJpbmdbXSB7XG4gICAgY29uc3QgdGVjaG5pcXVlczogc3RyaW5nW10gPSBbXTtcbiAgICBjb25zdCB0aHJlc2hvbGQgPSAwLjM7IC8vIE9ubHkgY29uc2lkZXIgZWxlbWVudHMgYWJvdmUgdGhpcyB0aHJlc2hvbGQgZm9yIHJlY29tbWVuZGF0aW9uc1xuXG4gICAgaWYgKHByb3BlcnRpZXMuRmlyZSA+IHRocmVzaG9sZCkge1xuICAgICAgdGVjaG5pcXVlcy5wdXNoKFxuICAgICAgICAuLi5FTEVNRU5UQUxfQ0hBUkFDVEVSSVNUSUNTLkZpcmUuY29va2luZ1RlY2huaXF1ZXMuc2xpY2UoMCwgMilcbiAgICAgICk7XG4gICAgfVxuXG4gICAgaWYgKHByb3BlcnRpZXMuV2F0ZXIgPiB0aHJlc2hvbGQpIHtcbiAgICAgIHRlY2huaXF1ZXMucHVzaChcbiAgICAgICAgLi4uRUxFTUVOVEFMX0NIQVJBQ1RFUklTVElDUy5XYXRlci5jb29raW5nVGVjaG5pcXVlcy5zbGljZSgwLCAyKVxuICAgICAgKTtcbiAgICB9XG5cbiAgICBpZiAocHJvcGVydGllcy5FYXJ0aCA+IHRocmVzaG9sZCkge1xuICAgICAgdGVjaG5pcXVlcy5wdXNoKFxuICAgICAgICAuLi5FTEVNRU5UQUxfQ0hBUkFDVEVSSVNUSUNTLkVhcnRoLmNvb2tpbmdUZWNobmlxdWVzLnNsaWNlKDAsIDIpXG4gICAgICApO1xuICAgIH1cblxuICAgIGlmIChwcm9wZXJ0aWVzLkFpciA+IHRocmVzaG9sZCkge1xuICAgICAgdGVjaG5pcXVlcy5wdXNoKFxuICAgICAgICAuLi5FTEVNRU5UQUxfQ0hBUkFDVEVSSVNUSUNTLkFpci5jb29raW5nVGVjaG5pcXVlcy5zbGljZSgwLCAyKVxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyBSZXR1cm4gdW5pcXVlIHRlY2huaXF1ZXMgb3IgYSBkZWZhdWx0IGlmIG5vbmUgbWVldCB0aGUgdGhyZXNob2xkXG4gICAgcmV0dXJuIHRlY2huaXF1ZXMubGVuZ3RoID4gMFxuICAgICAgPyBBcnJheS5mcm9tKG5ldyBTZXQodGVjaG5pcXVlcykpXG4gICAgICA6IFsnQmFsYW5jZWQgY29va2luZyddO1xuICB9LFxuXG4gIC8qKlxuICAgKiBHZXRzIHRoZSBjb21wbGVtZW50YXJ5IGluZ3JlZGllbnRzIGJhc2VkIG9uIGVsZW1lbnRhbCBwcm9wZXJ0aWVzXG4gICAqIEBwYXJhbSBwcm9wZXJ0aWVzIFRoZSBlbGVtZW50YWwgcHJvcGVydGllc1xuICAgKiBAcmV0dXJucyBBcnJheSBvZiByZWNvbW1lbmRlZCBjb21wbGVtZW50YXJ5IGluZ3JlZGllbnRzXG4gICAqL1xuICBnZXRSZWNvbW1lbmRlZFRpbWVPZkRheShwcm9wZXJ0aWVzOiBFbGVtZW50YWxQcm9wZXJ0aWVzKTogc3RyaW5nW10ge1xuICAgIGNvbnN0IHRpbWVzOiBzdHJpbmdbXSA9IFtdO1xuICAgIGNvbnN0IHRocmVzaG9sZCA9IDAuMzsgLy8gT25seSBjb25zaWRlciBlbGVtZW50cyBhYm92ZSB0aGlzIHRocmVzaG9sZCBmb3IgcmVjb21tZW5kYXRpb25zXG4gICAgY29uc3Qgd2VpZ2h0ZWRUaW1lczogc3RyaW5nW10gPSBbXTtcblxuICAgIC8vIEFkZCB0aW1lcyBiYXNlZCBvbiB0aGUgZWxlbWVudGFsIGJhbGFuY2UsIHdlaWdodGVkIGJ5IHRoZWlyIHZhbHVlc1xuICAgIGlmIChwcm9wZXJ0aWVzLkZpcmUgPiB0aHJlc2hvbGQpIHtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgTWF0aC5jZWlsKHByb3BlcnRpZXMuRmlyZSAqIDEwKTsgaSsrKSB7XG4gICAgICAgIHdlaWdodGVkVGltZXMucHVzaCguLi5FTEVNRU5UQUxfQ0hBUkFDVEVSSVNUSUNTLkZpcmUudGltZU9mRGF5KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAocHJvcGVydGllcy5XYXRlciA+IHRocmVzaG9sZCkge1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBNYXRoLmNlaWwocHJvcGVydGllcy5XYXRlciAqIDEwKTsgaSsrKSB7XG4gICAgICAgIHdlaWdodGVkVGltZXMucHVzaCguLi5FTEVNRU5UQUxfQ0hBUkFDVEVSSVNUSUNTLldhdGVyLnRpbWVPZkRheSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKHByb3BlcnRpZXMuRWFydGggPiB0aHJlc2hvbGQpIHtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgTWF0aC5jZWlsKHByb3BlcnRpZXMuRWFydGggKiAxMCk7IGkrKykge1xuICAgICAgICB3ZWlnaHRlZFRpbWVzLnB1c2goLi4uRUxFTUVOVEFMX0NIQVJBQ1RFUklTVElDUy5FYXJ0aC50aW1lT2ZEYXkpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChwcm9wZXJ0aWVzLkFpciA+IHRocmVzaG9sZCkge1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBNYXRoLmNlaWwocHJvcGVydGllcy5BaXIgKiAxMCk7IGkrKykge1xuICAgICAgICB3ZWlnaHRlZFRpbWVzLnB1c2goLi4uRUxFTUVOVEFMX0NIQVJBQ1RFUklTVElDUy5BaXIudGltZU9mRGF5KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBSZXR1cm4gdW5pcXVlIHRpbWVzIG9yIGEgZGVmYXVsdCBpZiBub25lIG1lZXQgdGhlIHRocmVzaG9sZFxuICAgIHJldHVybiB3ZWlnaHRlZFRpbWVzLmxlbmd0aCA+IDBcbiAgICAgID8gQXJyYXkuZnJvbShuZXcgU2V0KHdlaWdodGVkVGltZXMpKVxuICAgICAgOiBbJ0FueSB0aW1lJ107XG4gIH0sXG5cbiAgLy8gR2V0IHRoZSBkZWZhdWx0IGVsZW1lbnRhbCBwcm9wZXJ0aWVzXG4gIGdldERlZmF1bHRFbGVtZW50YWxQcm9wZXJ0aWVzKCk6IEVsZW1lbnRhbFByb3BlcnRpZXMge1xuICAgIHJldHVybiBERUZBVUxUX0VMRU1FTlRBTF9QUk9QRVJUSUVTO1xuICB9LFxuXG4gIC8vIEV4cG9ydCB0aGUgZGVmYXVsdCBlbGVtZW50YWwgcHJvcGVydGllcyBjb25zdGFudCBmb3IgZGlyZWN0IGFjY2Vzc1xuICBERUZBVUxUX0VMRU1FTlRBTF9QUk9QRVJUSUVTLFxuXG4gIC8qKlxuICAgKiBHZXRzIHRoZSBjdXJyZW50IGVsZW1lbnRhbCBzdGF0ZSBmcm9tIHRoZSBFbGVtZW50YWxDYWxjdWxhdG9yIHNlcnZpY2VcbiAgICogUGF0dGVybiBPTy0zOiBVdGlsaXR5IEltcG9ydCBBbGlnbm1lbnQgLSBTdGFuZGFsb25lIGV4cG9ydCBmb3IgVFMyNjE0IGNvbXBhdGliaWxpdHlcbiAgICovXG4gIGdldEN1cnJlbnRFbGVtZW50YWxTdGF0ZSgpOiBFbGVtZW50YWxQcm9wZXJ0aWVzIHtcbiAgICByZXR1cm4gRWxlbWVudGFsQ2FsY3VsYXRvci5nZXRDdXJyZW50RWxlbWVudGFsU3RhdGUoKTtcbiAgfSxcblxuICAvKipcbiAgICogUGF0dGVybiBPTy0zOiBVdGlsaXR5IEltcG9ydCBBbGlnbm1lbnQgLSBGb3JtYXQgY29uc2lzdGVuY3kgaGVscGVyXG4gICAqIEVuc3VyZXMgZWxlbWVudGFsIHByb3BlcnR5IGtleXMgYXJlIGluIGxvd2VyY2FzZSBmb3JtYXRcbiAgICovXG4gIGVuc3VyZUxvd2VyY2FzZUZvcm1hdChwcm9wZXJ0aWVzOiB1bmtub3duKTogYW55IHtcbiAgICBpZiAoIXByb3BlcnRpZXMgfHwgdHlwZW9mIHByb3BlcnRpZXMgIT09ICdvYmplY3QnKSB7XG4gICAgICByZXR1cm4gcHJvcGVydGllcztcbiAgICB9XG4gICAgXG4gICAgY29uc3QgbG93ZXJjYXNlUHJvcHM6IFJlY29yZDxzdHJpbmcsIHVua25vd24+ID0ge307XG4gICAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgT2JqZWN0LmVudHJpZXMocHJvcGVydGllcykpIHtcbiAgICAgIC8vIENvbnZlcnQgY2FwaXRhbGl6ZWQgZWxlbWVudCBuYW1lcyB0byBsb3dlcmNhc2VcbiAgICAgIGNvbnN0IGxvd2VyS2V5ID0ga2V5LnRvTG93ZXJDYXNlKCk7XG4gICAgICBsb3dlcmNhc2VQcm9wc1tsb3dlcktleV0gPSB2YWx1ZTtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIGxvd2VyY2FzZVByb3BzO1xuICB9LFxufTtcblxuZXhwb3J0IGRlZmF1bHQgZWxlbWVudGFsVXRpbHM7XG5cbmV4cG9ydCB7IGVsZW1lbnRzLCBlbGVtZW50YWxJbnRlcmFjdGlvbnMsIGVsZW1lbnRhbEZ1bmN0aW9ucyB9O1xuXG4vKipcbiAqIFRyYW5zZm9ybSBhIGxpc3Qgb2YgZWxlbWVudGFsIGl0ZW1zIGJhc2VkIG9uIHBsYW5ldGFyeSBwb3NpdGlvbnNcbiAqXG4gKiBAcGFyYW0gaXRlbXMgSXRlbXMgdG8gdHJhbnNmb3JtXG4gKiBAcGFyYW0gcGxhbmV0YXJ5UG9zaXRpb25zIEN1cnJlbnQgcGxhbmV0YXJ5IHBvc2l0aW9uc1xuICogQHBhcmFtIGlzRGF5dGltZSBXaGV0aGVyIGl0IGlzIGN1cnJlbnRseSBkYXlcbiAqIEBwYXJhbSBjdXJyZW50Wm9kaWFjIEN1cnJlbnQgem9kaWFjIHNpZ25cbiAqIEBwYXJhbSBsdW5hclBoYXNlIEN1cnJlbnQgbHVuYXIgcGhhc2VcbiAqIEBwYXJhbSBlbGVtZW50YWxCb29zdHMgT3B0aW9uYWwgZWxlbWVudGFsIGJvb3N0cyB0byBhcHBseVxuICogQHBhcmFtIHBsYW5ldGFyeUJvb3N0cyBPcHRpb25hbCBwbGFuZXRhcnkgYm9vc3RzIHRvIGFwcGx5XG4gKiBAcmV0dXJucyBUcmFuc2Zvcm1lZCBhbGNoZW1pY2FsIGl0ZW1zXG4gKi9cbmNvbnN0IEVMRU1FTlRfV0VJR0hUUyA9IHtcbiAgRmlyZTogMS44LFxuICBXYXRlcjogMS4yLFxuICBFYXJ0aDogMC45LFxuICBBaXI6IDEuNSxcbn07XG5cbi8vIEFkZCB0aGlzIGZ1bmN0aW9uIGlmIHVuaXF1ZW5lc3Mgc2NvcmUgaXMgbmVlZGVkXG5mdW5jdGlvbiBfY2FsY3VsYXRlVW5pcXVlbmVzcyhcbiAgZWxlbWVudHM6IFJlY29yZDxFbGVtZW50YWxDaGFyYWN0ZXIsIG51bWJlcj4sXG4gIHBsYW5ldGFyeUluZmx1ZW5jZTogbnVtYmVyXG4pOiBudW1iZXIge1xuICAvLyBDYWxjdWxhdGUgdmFyaWFuY2Ugb2YgZWxlbWVudGFsIHByb3BlcnRpZXNcbiAgY29uc3QgdmFsdWVzID0gT2JqZWN0LnZhbHVlcyhlbGVtZW50cyk7XG4gIGNvbnN0IG1lYW4gPSB2YWx1ZXMucmVkdWNlKChzdW0sIHZhbCkgPT4gc3VtICsgdmFsLCAwKSAvIHZhbHVlcy5sZW5ndGg7XG4gIGNvbnN0IHZhcmlhbmNlID1cbiAgICB2YWx1ZXMucmVkdWNlKChzdW0sIHZhbCkgPT4gc3VtICsgTWF0aC5wb3codmFsIC0gbWVhbiwgMiksIDApIC9cbiAgICB2YWx1ZXMubGVuZ3RoO1xuXG4gIC8vIENvbWJpbmUgd2l0aCBwbGFuZXRhcnkgaW5mbHVlbmNlXG4gIHJldHVybiBNYXRoLm1pbigxLCB2YXJpYW5jZSAqICgxICsgcGxhbmV0YXJ5SW5mbHVlbmNlKSk7XG59XG5cbi8vIE9yIG1vZGlmeSB0aGUgdHJhbnNmb3JtYXRpb24gdG8gcmVtb3ZlIHVuaXF1ZW5lc3Mgc2NvcmUgaWYgbm90IG5lZWRlZFxuZXhwb3J0IGZ1bmN0aW9uIHRyYW5zZm9ybUl0ZW1zV2l0aFBsYW5ldGFyeVBvc2l0aW9ucyhcbiAgaXRlbXM6IEVsZW1lbnRhbEl0ZW1bXSxcbiAgcGxhbmV0YXJ5UG9zaXRpb25zOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPixcbiAgaXNEYXl0aW1lID0gdHJ1ZSxcbiAgY3VycmVudFpvZGlhYz86IHN0cmluZyxcbiAgbHVuYXJQaGFzZT86IEx1bmFyUGhhc2UsXG4gIHRhcm90RWxlbWVudEJvb3N0cz86IFJlY29yZDxFbGVtZW50YWxDaGFyYWN0ZXIsIG51bWJlcj4sXG4gIHRhcm90UGxhbmV0YXJ5Qm9vc3RzPzogUmVjb3JkPHN0cmluZywgbnVtYmVyPlxuKTogQWxjaGVtaWNhbEl0ZW1bXSB7XG4gIHJldHVybiBpdGVtcy5tYXAoKGl0ZW0pID0+IHtcbiAgICBjb25zdCB7IGJvb3N0OiBwbGFuZXRhcnlJbmZsdWVuY2UgfSA9IGNhbGN1bGF0ZVBsYW5ldGFyeUJvb3N0KFxuICAgICAgaXRlbSxcbiAgICAgIHBsYW5ldGFyeVBvc2l0aW9ucyxcbiAgICAgIGN1cnJlbnRab2RpYWMsXG4gICAgICBsdW5hclBoYXNlXG4gICAgKTtcblxuICAgIC8vIFNjYWxlIGVsZW1lbnRhbCBwcm9wZXJ0aWVzXG4gICAgY29uc3Qgc2NhbGVkRWxlbWVudHMgPSBPYmplY3QuZnJvbUVudHJpZXMoXG4gICAgICBPYmplY3QuZW50cmllcyhpdGVtLmVsZW1lbnRhbFByb3BlcnRpZXMpLm1hcCgoW2VsZW1lbnQsIHZhbHVlXSkgPT4gW1xuICAgICAgICBlbGVtZW50LFxuICAgICAgICB2YWx1ZSAqICgxICsgKHBsYW5ldGFyeUluZmx1ZW5jZSB8fCAwKSksXG4gICAgICBdKVxuICAgICkgYXMgUmVjb3JkPEVsZW1lbnRhbENoYXJhY3RlciwgbnVtYmVyPjtcblxuICAgIC8vIENhbGN1bGF0ZSBhbGNoZW1pY2FsIHByb3BlcnRpZXMgZnJvbSBlbGVtZW50YWwgcHJvcGVydGllc1xuICAgIC8vIFRoaXMgZm9sbG93cyB0aGUgc2FtZSByZWxhdGlvbnNoaXBzIGFzIGluIHRoZSBhbGNoZW1pY2FsIHN5c3RlbTpcbiAgICAvLyAtIFNwaXJpdCBpcyByZWxhdGVkIHRvIEZpcmUgKHRyYW5zZm9ybWF0aW9uKSBhbmQgQWlyIChjb25uZWN0aW9uKVxuICAgIC8vIC0gRXNzZW5jZSBpcyByZWxhdGVkIHRvIFdhdGVyIChmbHVpZGl0eSkgYW5kIEZpcmUgKHZpdGFsaXR5KVxuICAgIC8vIC0gTWF0dGVyIGlzIHJlbGF0ZWQgdG8gRWFydGggKHN0YWJpbGl0eSkgYW5kIFdhdGVyIChjb2hlc2lvbilcbiAgICAvLyAtIFN1YnN0YW5jZSBpcyByZWxhdGVkIHRvIEFpciAoc3RydWN0dXJlKSBhbmQgRWFydGggKGZvcm0pXG4gICAgY29uc3Qgc3Bpcml0ID0gc2NhbGVkRWxlbWVudHMuRmlyZSAqIDAuNiArIHNjYWxlZEVsZW1lbnRzLkFpciAqIDAuNDtcbiAgICBjb25zdCBlc3NlbmNlID0gc2NhbGVkRWxlbWVudHMuV2F0ZXIgKiAwLjYgKyBzY2FsZWRFbGVtZW50cy5GaXJlICogMC40O1xuICAgIGNvbnN0IG1hdHRlciA9IHNjYWxlZEVsZW1lbnRzLkVhcnRoICogMC43ICsgc2NhbGVkRWxlbWVudHMuV2F0ZXIgKiAwLjM7XG4gICAgY29uc3Qgc3Vic3RhbmNlID0gc2NhbGVkRWxlbWVudHMuQWlyICogMC42ICsgc2NhbGVkRWxlbWVudHMuRWFydGggKiAwLjQ7XG5cbiAgICAvLyBBcHBseSB0YXJvdCBib29zdHMgaWYgYXZhaWxhYmxlXG4gICAgY29uc3QgYm9vc3RlZFNwaXJpdCA9IHNwaXJpdCAqICh0YXJvdFBsYW5ldGFyeUJvb3N0cz8uU3Bpcml0IHx8IDEuMCk7XG4gICAgY29uc3QgYm9vc3RlZEVzc2VuY2UgPSBlc3NlbmNlICogKHRhcm90UGxhbmV0YXJ5Qm9vc3RzPy5Fc3NlbmNlIHx8IDEuMCk7XG4gICAgY29uc3QgYm9vc3RlZE1hdHRlciA9IG1hdHRlciAqICh0YXJvdFBsYW5ldGFyeUJvb3N0cz8uTWF0dGVyIHx8IDEuMCk7XG4gICAgY29uc3QgYm9vc3RlZFN1YnN0YW5jZSA9XG4gICAgICBzdWJzdGFuY2UgKiAodGFyb3RQbGFuZXRhcnlCb29zdHM/LlN1YnN0YW5jZSB8fCAxLjApO1xuXG4gICAgLy8gQ2FsY3VsYXRlIGVuZXJneSBtZXRyaWNzIHVzaW5nIHRoZSBmb3JtdWxhcyBmcm9tIGFsY2hlbWljYWxDYWxjdWxhdGlvbnMudHNcbiAgICBjb25zdCBmaXJlID0gc2NhbGVkRWxlbWVudHMuRmlyZTtcbiAgICBjb25zdCB3YXRlciA9IHNjYWxlZEVsZW1lbnRzLldhdGVyO1xuICAgIGNvbnN0IGFpciA9IHNjYWxlZEVsZW1lbnRzLkFpcjtcbiAgICBjb25zdCBlYXJ0aCA9IHNjYWxlZEVsZW1lbnRzLkVhcnRoO1xuXG4gICAgLy8gRW5zdXJlIHdlIGhhdmUgbm9uLXplcm8gdmFsdWVzIGZvciBkZW5vbWluYXRvclxuICAgIGNvbnN0IHNhZmVWYWx1ZUZvckhlYXQgPSAodmFsOiBudW1iZXIpID0+IE1hdGgubWF4KHZhbCwgMC4wMSk7XG5cbiAgICAvLyBIZWF0IGZvcm11bGE6IChzcGlyaXReMiArIGZpcmVeMikgLyAoKHN1YnN0YW5jZSB8fCAxKSArIGVzc2VuY2UgKyBtYXR0ZXIgKyB3YXRlciArIGFpciArIGVhcnRoKV4yXG4gICAgY29uc3QgaGVhdCA9XG4gICAgICAoTWF0aC5wb3coc2FmZVZhbHVlRm9ySGVhdChib29zdGVkU3Bpcml0KSwgMikgKyBNYXRoLnBvdyhzYWZlVmFsdWVGb3JIZWF0KGZpcmUpLCAyKSkgLyBcbiAgICAgIE1hdGgucG93KHNhZmVWYWx1ZUZvckhlYXQoYm9vc3RlZFN1YnN0YW5jZSArIGJvb3N0ZWRFc3NlbmNlICsgYm9vc3RlZE1hdHRlciArIHdhdGVyICsgYWlyICsgZWFydGgpLCAyKTtcblxuICAgIC8vIEVudHJvcHkgZm9ybXVsYTogKHNwaXJpdF4yICsgc3Vic3RhbmNlXjIgKyBmaXJlXjIgKyBhaXJeMikgLyAoKGVzc2VuY2UgfHwgMSkgKyBtYXR0ZXIgKyBlYXJ0aCArIHdhdGVyKV4yXG4gICAgY29uc3QgZW50cm9weSA9XG4gICAgICAoTWF0aC5wb3coc2FmZVZhbHVlRm9ySGVhdChib29zdGVkU3Bpcml0KSwgMikgKyBNYXRoLnBvdyhzYWZlVmFsdWVGb3JIZWF0KGJvb3N0ZWRTdWJzdGFuY2UpLCAyKSArIFxuICAgICAgTWF0aC5wb3coc2FmZVZhbHVlRm9ySGVhdChmaXJlKSwgMikgKyBNYXRoLnBvdyhzYWZlVmFsdWVGb3JIZWF0KGFpciksIDIpKSAvIFxuICAgICAgTWF0aC5wb3coc2FmZVZhbHVlRm9ySGVhdChib29zdGVkRXNzZW5jZSArIGJvb3N0ZWRNYXR0ZXIgKyBlYXJ0aCArIHdhdGVyKSwgMik7XG5cbiAgICAvLyBSZWFjdGl2aXR5IGZvcm11bGE6IChzcGlyaXReMiArIHN1YnN0YW5jZV4yICsgZXNzZW5jZV4yICsgZmlyZV4yICsgYWlyXjIgKyB3YXRlcl4yKSAvICgobWF0dGVyIHx8IDEpICsgZWFydGgpXjJcbiAgICBjb25zdCByZWFjdGl2aXR5ID1cbiAgICAgIChNYXRoLnBvdyhzYWZlVmFsdWVGb3JIZWF0KGJvb3N0ZWRTcGlyaXQpLCAyKSArIE1hdGgucG93KHNhZmVWYWx1ZUZvckhlYXQoYm9vc3RlZFN1YnN0YW5jZSksIDIpICsgXG4gICAgICBNYXRoLnBvdyhzYWZlVmFsdWVGb3JIZWF0KGJvb3N0ZWRFc3NlbmNlKSwgMikgKyBNYXRoLnBvdyhzYWZlVmFsdWVGb3JIZWF0KGZpcmUpLCAyKSArIFxuICAgICAgTWF0aC5wb3coc2FmZVZhbHVlRm9ySGVhdChhaXIpLCAyKSArIE1hdGgucG93KHNhZmVWYWx1ZUZvckhlYXQod2F0ZXIpLCAyKSkgLyBcbiAgICAgIE1hdGgucG93KHNhZmVWYWx1ZUZvckhlYXQoYm9vc3RlZE1hdHRlciArIGVhcnRoKSwgMik7XG5cbiAgICAvLyBHcmVnJ3MgRW5lcmd5IGZvcm11bGEgd2l0aCBjb25zaXN0ZW50IHNjYWxpbmdcbiAgICBjb25zdCByYXdHcmVnc0VuZXJneSA9IGhlYXQgLSByZWFjdGl2aXR5ICogZW50cm9weTtcbiAgICBjb25zdCBzY2FsZWRHcmVnc0VuZXJneSA9IChyYXdHcmVnc0VuZXJneSArIDEpIC8gMjsgLy8gQ29udmVydCBmcm9tIHJhbmdlICgtMSwxKSB0byAoMCwxKVxuICAgIGNvbnN0IGdyZWdzRW5lcmd5ID0gTWF0aC5tYXgoMC4xLCBNYXRoLm1pbigxLjAsIHNjYWxlZEdyZWdzRW5lcmd5KSk7XG5cbiAgICAvLyBOb3JtYWxpemUgYWxsIGVuZXJneSB2YWx1ZXMgdG8gZW5zdXJlIHRoZXkncmUgaW4gdGhlIDAtMSByYW5nZVxuICAgIGNvbnN0IG5vcm1hbGl6ZWRIZWF0ID0gTWF0aC5tYXgoMC4xLCBNYXRoLm1pbigxLjAsIGhlYXQpKTtcbiAgICBjb25zdCBub3JtYWxpemVkRW50cm9weSA9IE1hdGgubWF4KDAuMSwgTWF0aC5taW4oMS4wLCBlbnRyb3B5KSk7XG4gICAgY29uc3Qgbm9ybWFsaXplZFJlYWN0aXZpdHkgPSBNYXRoLm1heCgwLjEsIE1hdGgubWluKDEuMCwgcmVhY3Rpdml0eSkpO1xuXG4gICAgLy8gQ2FsY3VsYXRlIGRvbWluYW50IGVsZW1lbnQgYmFzZWQgb24gc2NhbGVkIGVsZW1lbnRzXG4gICAgY29uc3QgZG9taW5hbnRFbGVtZW50ID0gT2JqZWN0LmVudHJpZXMoc2NhbGVkRWxlbWVudHMpLnNvcnQoXG4gICAgICAoW19rZXlBLCB2YWx1ZUFdLCBbX2tleUIsIHZhbHVlQl0pID0+IHZhbHVlQiAtIHZhbHVlQVxuICAgIClbMF1bMF0gYXMgRWxlbWVudGFsQ2hhcmFjdGVyO1xuXG4gICAgLy8gQ2FsY3VsYXRlIGRvbWluYW50IGFsY2hlbWljYWwgcHJvcGVydHlcbiAgICBjb25zdCBhbGNoZW1pY2FsUHJvcGVydGllcyA9IHtcbiAgICAgIFNwaXJpdDogYm9vc3RlZFNwaXJpdCxcbiAgICAgIEVzc2VuY2U6IGJvb3N0ZWRFc3NlbmNlLFxuICAgICAgTWF0dGVyOiBib29zdGVkTWF0dGVyLFxuICAgICAgU3Vic3RhbmNlOiBib29zdGVkU3Vic3RhbmNlLFxuICAgIH07XG4gICAgY29uc3QgZG9taW5hbnRBbGNoZW1pY2FsUHJvcGVydHkgPSBPYmplY3QuZW50cmllcyhcbiAgICAgIGFsY2hlbWljYWxQcm9wZXJ0aWVzXG4gICAgKS5zb3J0KFxuICAgICAgKFtfa2V5QSwgdmFsdWVBXSwgW19rZXlCLCB2YWx1ZUJdKSA9PiB2YWx1ZUIgLSB2YWx1ZUFcbiAgICApWzBdWzBdIGFzIEFsY2hlbWljYWxQcm9wZXJ0eTtcblxuICAgIC8vIEV4dHJhY3QgZG9taW5hbnQgcGxhbmV0cyBiYXNlZCBvbiBwbGFuZXRhcnkgcG9zaXRpb25zIGlmIGF2YWlsYWJsZVxuICAgIGxldCBkb21pbmFudFBsYW5ldHM6IHN0cmluZ1tdID0gW107XG4gICAgaWYgKHBsYW5ldGFyeVBvc2l0aW9ucykge1xuICAgICAgLy8gR2V0IHRvcCAzIHBsYW5ldHMgd2l0aCBoaWdoZXN0IHZhbHVlcyBvciBkaWduaXR5XG4gICAgICBjb25zdCBwbGFuZXRFbnRyaWVzID0gT2JqZWN0LmVudHJpZXMocGxhbmV0YXJ5UG9zaXRpb25zKS5maWx0ZXIoXG4gICAgICAgIChbcGxhbmV0LCBfXSkgPT4gcGxhbmV0ICE9PSAnaXNEYXl0aW1lJyAmJiBwbGFuZXQgIT09ICdjdXJyZW50Wm9kaWFjJ1xuICAgICAgKTtcblxuICAgICAgLy8gSGFuZGxlIGRpZmZlcmVudCBwb3NpdGlvbiBkYXRhIGZvcm1hdHNcbiAgICAgIGRvbWluYW50UGxhbmV0cyA9IHBsYW5ldEVudHJpZXNcbiAgICAgICAgLnNvcnQoKFtfLCB2YWxBXSwgW19fLCB2YWxCXSkgPT4ge1xuICAgICAgICAgIC8vIFNvcnQgYnkgc3RyZW5ndGggL2RpZ25pdHkgaWYgYXZhaWxhYmxlXG4gICAgICAgICAgaWYgKHR5cGVvZiB2YWxBID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgdmFsQiA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgIGNvbnN0IGRhdGFBID0gdmFsQSBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPjtcbiAgICAgICAgICAgIGNvbnN0IGRhdGFCID0gdmFsQiBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPjtcbiAgICAgICAgICAgIGNvbnN0IHN0cmVuZ3RoQSA9IE51bWJlcihkYXRhQT8uc3RyZW5ndGgpIHx8IDA7XG4gICAgICAgICAgICBjb25zdCBzdHJlbmd0aEIgPSBOdW1iZXIoZGF0YUI/LnN0cmVuZ3RoKSB8fCAwO1xuICAgICAgICAgICAgcmV0dXJuIHN0cmVuZ3RoQiAtIHN0cmVuZ3RoQTtcbiAgICAgICAgICB9XG4gICAgICAgICAgLy8gRGVmYXVsdCBzb3J0IGZvciBzaW1wbGUgbnVtZXJpYyB2YWx1ZXNcbiAgICAgICAgICByZXR1cm4gTnVtYmVyKHZhbEIpIC0gTnVtYmVyKHZhbEEpO1xuICAgICAgICB9KVxuICAgICAgICAuc2xpY2UoMCwgMylcbiAgICAgICAgLm1hcCgoW3BsYW5ldCwgX10pID0+IHBsYW5ldCk7XG4gICAgfVxuXG4gICAgLy8gRW5zdXJlIHdlIGhhdmUgcGxhbmV0YXJ5IGRpZ25pdGllcyBkYXRhXG4gICAgY29uc3QgcGxhbmV0YXJ5RGlnbml0aWVzID0ge307XG5cbiAgICAvLyBIYW5kbGUgTmFOIHZhbHVlcyBvciBpbmZpbml0eSBmb3IgYWxsIHByb3BlcnRpZXNcbiAgICBjb25zdCBlbnN1cmVTYWZlTnVtYmVyID0gKHZhbDogbnVtYmVyKTogbnVtYmVyID0+IHtcbiAgICAgIGlmIChpc05hTih2YWwpIHx8ICFpc0Zpbml0ZSh2YWwpKSByZXR1cm4gMC4yO1xuICAgICAgcmV0dXJuIHZhbDtcbiAgICB9O1xuXG4gICAgLy8gQXBwbHkgc2FmZSBhcml0aG1ldGljIG9wZXJhdGlvbnMgd2l0aCBwcm9wZXIgdHlwZSBjaGVja2luZ1xuICAgIGNvbnN0IHNhZmVWYWx1ZUZvckFyaXRobWV0aWMgPSAodmFsOiBudW1iZXIpID0+IE1hdGgubWF4KHZhbCwgMC4wMSk7XG4gICAgY29uc3Qgc2FmZUFkZCA9IChhOiBudW1iZXIsIGI6IG51bWJlcikgPT4gc2FmZVZhbHVlRm9yQXJpdGhtZXRpYyhhKSArIHNhZmVWYWx1ZUZvckFyaXRobWV0aWMoYik7XG4gICAgY29uc3Qgc2FmZU11bHRpcGx5ID0gKGE6IG51bWJlciwgYjogbnVtYmVyKSA9PiBzYWZlVmFsdWVGb3JBcml0aG1ldGljKGEpICogc2FmZVZhbHVlRm9yQXJpdGhtZXRpYyhiKTtcblxuICAgIHJldHVybiB7XG4gICAgICBpZDogaXRlbS5pZCxcbiAgICAgIG5hbWU6IGl0ZW0ubmFtZSxcbiAgICAgIGVsZW1lbnRhbFByb3BlcnRpZXM6IGl0ZW0uZWxlbWVudGFsUHJvcGVydGllcyxcbiAgICAgIHRyYW5zZm9ybWVkRWxlbWVudGFsUHJvcGVydGllczogc2NhbGVkRWxlbWVudHMsXG4gICAgICBhbGNoZW1pY2FsUHJvcGVydGllczoge1xuICAgICAgICBTcGlyaXQ6IGJvb3N0ZWRTcGlyaXQsXG4gICAgICAgIEVzc2VuY2U6IGJvb3N0ZWRFc3NlbmNlLFxuICAgICAgICBNYXR0ZXI6IGJvb3N0ZWRNYXR0ZXIsXG4gICAgICAgIFN1YnN0YW5jZTogYm9vc3RlZFN1YnN0YW5jZSxcbiAgICAgIH0sXG4gICAgICBoZWF0OiBub3JtYWxpemVkSGVhdCxcbiAgICAgIGVudHJvcHk6IG5vcm1hbGl6ZWRFbnRyb3B5LFxuICAgICAgcmVhY3Rpdml0eTogbm9ybWFsaXplZFJlYWN0aXZpdHksXG4gICAgICBncmVnc0VuZXJneTogZ3JlZ3NFbmVyZ3ksXG4gICAgICBkb21pbmFudEVsZW1lbnQsXG4gICAgICBkb21pbmFudEFsY2hlbWljYWxQcm9wZXJ0eSxcbiAgICAgIHBsYW5ldGFyeUJvb3N0OiBwbGFuZXRhcnlJbmZsdWVuY2UsXG4gICAgICBkb21pbmFudFBsYW5ldHMsXG4gICAgICBwbGFuZXRhcnlEaWduaXRpZXMsXG4gICAgfSBhcyB1bmtub3duIGFzIEFsY2hlbWljYWxJdGVtO1xuICB9KTtcbn1cblxuLy8gTmV3IGRpZmZlcmVudGlhdGlvbiBmdW5jdGlvbnNcbmNvbnN0IGFwcGx5Tm9uTGluZWFyU2NhbGluZyA9IChcbiAgcHJvcHM6IEVsZW1lbnRhbFByb3BlcnRpZXNcbik6IEVsZW1lbnRhbFByb3BlcnRpZXMgPT4gKHtcbiAgRmlyZTogTWF0aC50YW5oKHByb3BzLkZpcmUgKiAyKSxcbiAgV2F0ZXI6IDEgLSBNYXRoLmV4cCgtcHJvcHMuV2F0ZXIgKiAzKSxcbiAgRWFydGg6IHByb3BzLkVhcnRoICoqIDEuNSxcbiAgQWlyOiBNYXRoLnNpbigocHJvcHMuQWlyICogTWF0aC5QSSkgLyAyKSxcbn0pO1xuXG5jb25zdCBjYWxjdWxhdGVVbmlxdWVuZXNzU2NvcmUgPSAoaXRlbTogRWxlbWVudGFsSXRlbSk6IG51bWJlciA9PiB7XG4gIGNvbnN0IHZhcmlhbmNlID0gT2JqZWN0LnZhbHVlcyhpdGVtLmVsZW1lbnRhbFByb3BlcnRpZXMpLnJlZHVjZShcbiAgICAoYWNjOiBudW1iZXIsIHZhbDogbnVtYmVyKSA9PiBhY2MgKyBNYXRoLmFicyh2YWwgLSAwLjUpLFxuICAgIDBcbiAgKTtcbiAgcmV0dXJuIE1hdGgubWluKDEsIHZhcmlhbmNlICogMik7XG59O1xuXG4vLyBBZGQgb3IgdXBkYXRlIHRoZSBub3JtYWxpemVFbGVtZW50YWxWYWx1ZXMgZnVuY3Rpb25cbmV4cG9ydCBmdW5jdGlvbiBub3JtYWxpemVFbGVtZW50YWxWYWx1ZXMoXG4gIHZhbHVlczogUmVjb3JkPEVsZW1lbnRhbENoYXJhY3RlciwgbnVtYmVyPlxuKTogUmVjb3JkPEVsZW1lbnRhbENoYXJhY3RlciwgbnVtYmVyPiB7XG4gIGNvbnN0IHRvdGFsID0gT2JqZWN0LnZhbHVlcyh2YWx1ZXMpLnJlZHVjZSgoc3VtLCB2YWwpID0+IHN1bSArIHZhbCwgMCk7XG5cbiAgLy8gSWYgdG90YWwgaXMgemVybyBvciBjbG9zZSB0byB6ZXJvLCByZXR1cm4gZGVmYXVsdCBkaXN0cmlidXRpb25cbiAgaWYgKHRvdGFsIDwgMC4wMSkge1xuICAgIHJldHVybiB7XG4gICAgICBGaXJlOiAwLjI1LFxuICAgICAgV2F0ZXI6IDAuMjUsXG4gICAgICBFYXJ0aDogMC4yNSxcbiAgICAgIEFpcjogMC4yNSxcbiAgICB9O1xuICB9XG5cbiAgLy8gTm9ybWFsaXplIHZhbHVlcyB0byBzdW0gdG8gMS4wXG4gIHJldHVybiB7XG4gICAgRmlyZTogdmFsdWVzLkZpcmUgLyB0b3RhbCxcbiAgICBXYXRlcjogdmFsdWVzLldhdGVyIC8gdG90YWwsXG4gICAgRWFydGg6IHZhbHVlcy5FYXJ0aCAvIHRvdGFsLFxuICAgIEFpcjogdmFsdWVzLkFpciAvIHRvdGFsLFxuICB9O1xufVxuXG4vLyBHZXQgdGhlIHByaW1hcnkgZWxlbWVudCByZWdhcmRsZXNzIG9mIGZvcm1hdFxuZXhwb3J0IGZ1bmN0aW9uIGdldFByaW1hcnlFbGVtZW50KFxuICBlbGVtZW50YWxBZmZpbml0eTogRWxlbWVudGFsQWZmaW5pdHlcbik6IHN0cmluZyB7XG4gIGNvbnN0IGFmZmluaXR5RGF0YSA9IGVsZW1lbnRhbEFmZmluaXR5IGFzIHVua25vd24gYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj47XG4gIHJldHVybiAoXG4gICAgYWZmaW5pdHlEYXRhPy5iYXNlIHx8IGFmZmluaXR5RGF0YT8uZWxlbWVudCB8fCAnRmlyZSdcbiAgKSBhcyBzdHJpbmc7XG59XG5cbi8vIEdldCBlbGVtZW50IHN0cmVuZ3RoIGlmIGF2YWlsYWJsZVxuZXhwb3J0IGZ1bmN0aW9uIGdldEVsZW1lbnRTdHJlbmd0aChcbiAgZWxlbWVudGFsQWZmaW5pdHk6IEVsZW1lbnRhbEFmZmluaXR5XG4pOiBudW1iZXIge1xuICBjb25zdCBhZmZpbml0eURhdGEgPSBlbGVtZW50YWxBZmZpbml0eSBhcyB1bmtub3duIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+O1xuICBjb25zdCBzdHJlbmd0aCA9IGFmZmluaXR5RGF0YT8uc3RyZW5ndGggYXMgbnVtYmVyO1xuICByZXR1cm4gdHlwZW9mIHN0cmVuZ3RoID09PSAnbnVtYmVyJyA/IHN0cmVuZ3RoIDogMTtcbn1cblxuLyoqXG4gKiBFbnN1cmVzIGFsbCByZXF1aXJlZCBlbGVtZW50YWwgcHJvcGVydGllcyBhcmUgcHJlc2VudFxuICogQHBhcmFtIHByb3BlcnRpZXMgVGhlIGVsZW1lbnRhbCBwcm9wZXJ0aWVzIHRvIHZhbGlkYXRlIGFuZCBjb21wbGV0ZVxuICogQHJldHVybnMgQ29tcGxldGUgZWxlbWVudGFsIHByb3BlcnRpZXNcbiAqL1xuZXhwb3J0IGNvbnN0IGVuc3VyZUNvbXBsZXRlRWxlbWVudGFsUHJvcGVydGllcyA9IChcbiAgcHJvcGVydGllczogUGFydGlhbDxFbGVtZW50YWxQcm9wZXJ0aWVzPlxuKTogRWxlbWVudGFsUHJvcGVydGllcyA9PiB7XG4gIHJldHVybiB7XG4gICAgRmlyZTogcHJvcGVydGllcy5GaXJlID8/IDAuMjUsXG4gICAgV2F0ZXI6IHByb3BlcnRpZXMuV2F0ZXIgPz8gMC4yNSxcbiAgICBFYXJ0aDogcHJvcGVydGllcy5FYXJ0aCA/PyAwLjI1LFxuICAgIEFpcjogcHJvcGVydGllcy5BaXIgPz8gMC4yNSxcbiAgfTtcbn07XG5cbi8qKlxuICogV0FSTklORzogZ2V0QmFsYW5jaW5nRWxlbWVudCBpcyBsZWdhY3kgYW5kIGRvZXMgbm90IGNvbXBseSB3aXRoIGN1cnJlbnQgZWxlbWVudGFsIGxvZ2ljIHByaW5jaXBsZXMgKG5vIG9wcG9zaW5nL2JhbGFuY2luZyBlbGVtZW50cykuIFJldmlldyB1c2FnZSBhbmQgcmVmYWN0b3IvcmVtb3ZlIGlmIG5vdCBuZWVkZWQuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRCYWxhbmNpbmdFbGVtZW50KGVsZW1lbnQpIHtcbiAgLy8gRWxlbWVudHMgd29yayBiZXN0IHdpdGggdGhlbXNlbHZlcyAtIHJlaW5mb3JjaW5nIHRoZSBjdXJyZW50IGVuZXJneVxuICByZXR1cm4gZWxlbWVudDtcbn1cblxuLyoqXG4gKiBXQVJOSU5HOiBnZXRFbGVtZW50YWxSZWxhdGlvbnNoaXAgaXMgbGVnYWN5IGFuZCBtYXkgbm90IGNvbXBseSB3aXRoIGN1cnJlbnQgZWxlbWVudGFsIGxvZ2ljIHByaW5jaXBsZXMuXG4gKiBBbGwgZWxlbWVudCBjb21iaW5hdGlvbnMgYXJlIGhhcm1vbmlvdXM7IGF2b2lkIHVzaW5nIFwib3Bwb3NpbmdcIiBvciBcImNvbnRyb2xsaW5nXCIgbG9naWMuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRFbGVtZW50YWxSZWxhdGlvbnNoaXAoXG4gIGVsZW1lbnQxOiBFbGVtZW50LFxuICBlbGVtZW50MjogRWxlbWVudFxuKTogRWxlbWVudGFsUmVsYXRpb25zaGlwIHtcbiAgaWYgKGVsZW1lbnQxID09PSBlbGVtZW50Mikge1xuICAgIHJldHVybiAnc2FtZSc7XG4gIH1cblxuICAvLyBUaGUgZ2VuZXJhdGluZyBjeWNsZSBmb3IgNC1lbGVtZW50IHN5c3RlbTogRmlyZSDihpIgRWFydGgg4oaSIFdhdGVyIOKGkiBBaXIg4oaSIEZpcmVcbiAgY29uc3QgZ2VuZXJhdGluZ0N5Y2xlOiB7IFtrZXkgaW4gRWxlbWVudF06IEVsZW1lbnQgfSA9IHtcbiAgICBGaXJlOiAnRWFydGgnLFxuICAgIEVhcnRoOiAnV2F0ZXInLCBcbiAgICBXYXRlcjogJ0FpcicsXG4gICAgQWlyOiAnRmlyZScsXG4gIH07XG5cbiAgLy8gVGhlIGNvbnRyb2xsaW5nIGN5Y2xlIGZvciA0LWVsZW1lbnQgc3lzdGVtOiBGaXJlIOKGkiBBaXIg4oaSIEVhcnRoIOKGkiBXYXRlciDihpIgRmlyZVxuICBjb25zdCBjb250cm9sbGluZ0N5Y2xlOiB7IFtrZXkgaW4gRWxlbWVudF06IEVsZW1lbnQgfSA9IHtcbiAgICBGaXJlOiAnQWlyJyxcbiAgICBBaXI6ICdFYXJ0aCcsIFxuICAgIEVhcnRoOiAnV2F0ZXInLFxuICAgIFdhdGVyOiAnRmlyZScsXG4gIH07XG5cbiAgaWYgKGdlbmVyYXRpbmdDeWNsZVtlbGVtZW50MV0gPT09IGVsZW1lbnQyKSB7XG4gICAgcmV0dXJuICdnZW5lcmF0aW5nJzsgLy8gZWxlbWVudDEgZ2VuZXJhdGVzIGVsZW1lbnQyXG4gIH0gZWxzZSBpZiAoZ2VuZXJhdGluZ0N5Y2xlW2VsZW1lbnQyXSA9PT0gZWxlbWVudDEpIHtcbiAgICByZXR1cm4gJ3dlYWtlbmVkLWJ5JzsgLy8gZWxlbWVudDIgZ2VuZXJhdGVzIGVsZW1lbnQxXG4gIH0gZWxzZSBpZiAoY29udHJvbGxpbmdDeWNsZVtlbGVtZW50MV0gPT09IGVsZW1lbnQyKSB7XG4gICAgcmV0dXJuICdjb250cm9sbGluZyc7IC8vIGVsZW1lbnQxIGNvbnRyb2xzIGVsZW1lbnQyXG4gIH0gZWxzZSBpZiAoY29udHJvbGxpbmdDeWNsZVtlbGVtZW50Ml0gPT09IGVsZW1lbnQxKSB7XG4gICAgcmV0dXJuICdjb250cm9sbGVkLWJ5JzsgLy8gZWxlbWVudDIgY29udHJvbHMgZWxlbWVudDFcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gJ25ldXRyYWwnO1xuICB9XG59XG5cbi8qKlxuICogR2V0cyB0aGUgZWxlbWVudCB0aGF0IHN0cmVuZ3RoZW5zIHRoZSBwcm92aWRlZCBlbGVtZW50XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRTdHJlbmd0aGVuaW5nRWxlbWVudChlbGVtZW50OiBFbGVtZW50KTogRWxlbWVudCB7XG4gIC8vIFRoZSBlbGVtZW50IHRoYXQgZ2VuZXJhdGVzIHRoZSBwcm92aWRlZCBlbGVtZW50IHdpbGwgc3RyZW5ndGhlbiBpdFxuICBjb25zdCBzdHJlbmd0aE1hcDogeyBba2V5IGluIEVsZW1lbnRdOiBFbGVtZW50IH0gPSB7XG4gICAgRmlyZTogJ0FpcicsIC8vIEFpciBzdHJlbmd0aGVucyBGaXJlXG4gICAgRWFydGg6ICdGaXJlJywgLy8gRmlyZSBzdHJlbmd0aGVucyBFYXJ0aFxuICAgIFdhdGVyOiAnRWFydGgnLCAvLyBFYXJ0aCBzdHJlbmd0aGVucyBXYXRlclxuICAgIEFpcjogJ1dhdGVyJywgLy8gV2F0ZXIgc3RyZW5ndGhlbnMgQWlyXG4gIH07XG5cbiAgcmV0dXJuIHN0cmVuZ3RoTWFwW2VsZW1lbnRdO1xufVxuXG4vKipcbiAqIEVuaGFuY2UgdmVnZXRhYmxlIHRyYW5zZm9ybWF0aW9ucyBieSBhZGRpbmcgdGhlcm1vZHluYW1pYyBlZmZlY3RzIHRvIGRpZmZlcmVudCBjb29raW5nIG1ldGhvZHNcbiAqIEBwYXJhbSB2ZWdldGFibGVzIFRoZSBjb2xsZWN0aW9uIG9mIHZlZ2V0YWJsZXMgdG8gZW5oYW5jZVxuICogQHJldHVybnMgRW5oYW5jZWQgdmVnZXRhYmxlcyB3aXRoIGNvbXBsZXRlIHRyYW5zZm9ybWF0aW9uIHByb3BlcnRpZXNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGVuaGFuY2VWZWdldGFibGVUcmFuc2Zvcm1hdGlvbnMoXG4gIHZlZ2V0YWJsZXM6IFJlY29yZDxzdHJpbmcsIFJlY29yZDxzdHJpbmcsIHVua25vd24+PlxuKTogUmVjb3JkPHN0cmluZywgUmVjb3JkPHN0cmluZywgdW5rbm93bj4+IHtcbiAgcmV0dXJuIE9iamVjdC5lbnRyaWVzKHZlZ2V0YWJsZXMpLnJlZHVjZSgoYWNjLCBba2V5LCB2ZWdldGFibGVdKSA9PiB7XG4gICAgLy8gU2tpcCBpZiBub3QgYW4gb2JqZWN0XG4gICAgaWYgKHR5cGVvZiB2ZWdldGFibGUgIT09ICdvYmplY3QnIHx8IHZlZ2V0YWJsZSA9PT0gbnVsbCkge1xuICAgICAgYWNjW2tleV0gPSB2ZWdldGFibGU7XG4gICAgICByZXR1cm4gYWNjO1xuICAgIH1cblxuICAgIGNvbnN0IGVuaGFuY2VkID0geyAuLi52ZWdldGFibGUgfTtcblxuICAgIC8vIENyZWF0ZSB0cmFuc2Zvcm1hdGlvbiBpZiBpdCBkb2Vzbid0IGV4aXN0XG4gICAgaWYgKCFlbmhhbmNlZC5lbGVtZW50YWxUcmFuc2Zvcm1hdGlvbikge1xuICAgICAgLy8gR2V0IHRoZSBkb21pbmFudCBlbGVtZW50XG4gICAgICBjb25zdCBlbGVtZW50YWxQcm9wcyA9IGVuaGFuY2VkLmVsZW1lbnRhbFByb3BlcnRpZXMgfHwge1xuICAgICAgICBFYXJ0aDogMC4zLFxuICAgICAgICBXYXRlcjogMC4zLFxuICAgICAgICBBaXI6IDAuMixcbiAgICAgICAgRmlyZTogMC4yLFxuICAgICAgfTtcbiAgICAgIGxldCBkb21pbmFudEVsZW1lbnQgPSAnRWFydGgnO1xuICAgICAgbGV0IGhpZ2hlc3RWYWx1ZSA9IDA7XG5cbiAgICAgIGZvciAoY29uc3QgW2VsZW1lbnQsIHZhbHVlXSBvZiBPYmplY3QuZW50cmllcyhlbGVtZW50YWxQcm9wcykpIHtcbiAgICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ251bWJlcicgJiYgdmFsdWUgPiBoaWdoZXN0VmFsdWUpIHtcbiAgICAgICAgICBkb21pbmFudEVsZW1lbnQgPSBlbGVtZW50O1xuICAgICAgICAgIGhpZ2hlc3RWYWx1ZSA9IHZhbHVlO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIFNldCBkZWZhdWx0IHRyYW5zZm9ybWF0aW9ucyBiYXNlZCBvbiBkb21pbmFudCBlbGVtZW50XG4gICAgICBlbmhhbmNlZC5lbGVtZW50YWxUcmFuc2Zvcm1hdGlvbiA9IHtcbiAgICAgICAgd2hlbkNvb2tlZDogeyBbZG9taW5hbnRFbGVtZW50XTogMC4xLCBGaXJlOiAwLjA1IH0sXG4gICAgICAgIHdoZW5EcmllZDogeyBFYXJ0aDogMC4xLCBBaXI6IDAuMDUgfSxcbiAgICAgICAgd2hlbkZlcm1lbnRlZDogeyBXYXRlcjogMC4xLCBBaXI6IDAuMDUgfSxcbiAgICAgIH07XG4gICAgfVxuXG4gICAgLy8gQWRkIHRoZXJtb2R5bmFtaWMgY2hhbmdlcyBpZiB0aGV5IGRvbid0IGV4aXN0XG4gICAgY29uc3QgdHJhbnNmb3JtYXRpb24gPSBlbmhhbmNlZC5lbGVtZW50YWxUcmFuc2Zvcm1hdGlvbiBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPjtcbiAgICBpZiAoXG4gICAgICB0cmFuc2Zvcm1hdGlvbiAmJlxuICAgICAgIXRyYW5zZm9ybWF0aW9uLnRoZXJtb2R5bmFtaWNDaGFuZ2VzXG4gICAgKSB7XG4gICAgICB0cmFuc2Zvcm1hdGlvbi50aGVybW9keW5hbWljQ2hhbmdlcyA9IHtcbiAgICAgICAgY29va2VkOiB7XG4gICAgICAgICAgaGVhdDogMC4xLFxuICAgICAgICAgIGVudHJvcHk6IDAuMDUsXG4gICAgICAgICAgcmVhY3Rpdml0eTogMC4wNSxcbiAgICAgICAgfSxcbiAgICAgICAgZHJpZWQ6IHtcbiAgICAgICAgICBoZWF0OiAtMC4wNSxcbiAgICAgICAgICBlbnRyb3B5OiAtMC4xLFxuICAgICAgICAgIHJlYWN0aXZpdHk6IC0wLjA1LFxuICAgICAgICB9LFxuICAgICAgICBmZXJtZW50ZWQ6IHtcbiAgICAgICAgICBlbnRyb3B5OiAwLjIsXG4gICAgICAgICAgcmVhY3Rpdml0eTogMC4xNSxcbiAgICAgICAgICBzdGFiaWxpdHlJbmRleDogLTAuMSxcbiAgICAgICAgfSxcbiAgICAgICAgcm9hc3RlZDoge1xuICAgICAgICAgIGhlYXQ6IDAuMixcbiAgICAgICAgICBlbnRyb3B5OiAwLjEsXG4gICAgICAgICAgZW5lcmd5OiAwLjE1LFxuICAgICAgICB9LFxuICAgICAgICBzdGVhbWVkOiB7XG4gICAgICAgICAgaGVhdDogMC4wNSxcbiAgICAgICAgICBtb2lzdHVyZTogMC4yLFxuICAgICAgICAgIHJlYWN0aXZpdHk6IDAuMDUsXG4gICAgICAgIH0sXG4gICAgICB9O1xuICAgIH1cblxuICAgIC8vIEFkZCBlbGVtZW50YWxTaWduYXR1cmUgaWYgaXQgZG9lc24ndCBleGlzdFxuICAgIGlmICghZW5oYW5jZWQuZWxlbWVudGFsU2lnbmF0dXJlICYmIGVuaGFuY2VkLmVsZW1lbnRhbFByb3BlcnRpZXMpIHtcbiAgICAgIGVuaGFuY2VkLmVsZW1lbnRhbFNpZ25hdHVyZSA9IE9iamVjdC5lbnRyaWVzKGVuaGFuY2VkLmVsZW1lbnRhbFByb3BlcnRpZXMpXG4gICAgICAgIC5zb3J0KChhLCBiKSA9PiB7XG4gICAgICAgICAgLy8gQXBwbHkgUGF0dGVybiBLSy0xOiBFeHBsaWNpdCBUeXBlIEFzc2VydGlvbiBmb3IgYXJpdGhtZXRpYyBvcGVyYXRpb25zXG4gICAgICAgICAgY29uc3QgdmFsdWVBID0gTnVtYmVyKGFbMV0pIHx8IDA7XG4gICAgICAgICAgY29uc3QgdmFsdWVCID0gTnVtYmVyKGJbMV0pIHx8IDA7XG4gICAgICAgICAgcmV0dXJuIHZhbHVlQiAtIHZhbHVlQTtcbiAgICAgICAgfSlcbiAgICAgICAgLm1hcCgoW2VsZW1lbnQsIHZhbHVlXSkgPT4gW2VsZW1lbnQsIE51bWJlcih2YWx1ZSldKTtcbiAgICB9XG5cbiAgICAvLyBBZGQgc2Vuc29yeSBwcm9maWxlcyBpZiB0aGV5IGRvbid0IGV4aXN0XG4gICAgaWYgKCFlbmhhbmNlZC5zZW5zb3J5UHJvZmlsZSkge1xuICAgICAgLy8gRGVmYXVsdCBzZW5zb3J5IHByb2ZpbGUgYmFzZWQgb24gdmVnZXRhYmxlIHN1YkNhdGVnb3J5XG4gICAgICBjb25zdCBzdWJDYXRlZ29yeSA9IGVuaGFuY2VkLnN1YkNhdGVnb3J5IHx8ICd2ZWdldGFibGUnO1xuXG4gICAgICBjb25zdCBwcm9maWxlcyA9IHtcbiAgICAgICAgJ2xlYWZ5IGdyZWVuJzoge1xuICAgICAgICAgIHRhc3RlOiB7XG4gICAgICAgICAgICBiaXR0ZXI6IDAuNixcbiAgICAgICAgICAgIHN3ZWV0OiAwLjIsXG4gICAgICAgICAgICB1bWFtaTogMC4xLFxuICAgICAgICAgICAgc2FsdHk6IDAuMDUsXG4gICAgICAgICAgICBzb3VyOiAwLjA1LFxuICAgICAgICAgICAgc3BpY3k6IDAsXG4gICAgICAgICAgfSxcbiAgICAgICAgICBhcm9tYToge1xuICAgICAgICAgICAgaGVyYmFsOiAwLjUsXG4gICAgICAgICAgICBlYXJ0aHk6IDAuMyxcbiAgICAgICAgICAgIGZsb3JhbDogMC4xLFxuICAgICAgICAgICAgZnJ1aXR5OiAwLjA1LFxuICAgICAgICAgICAgd29vZHk6IDAuMDUsXG4gICAgICAgICAgICBzcGljeTogMCxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHRleHR1cmU6IHtcbiAgICAgICAgICAgIGNyaXNwOiAwLjcsXG4gICAgICAgICAgICB0ZW5kZXI6IDAuMixcbiAgICAgICAgICAgIHNpbGt5OiAwLjEsXG4gICAgICAgICAgICBjaGV3eTogMCxcbiAgICAgICAgICAgIGNyZWFteTogMCxcbiAgICAgICAgICAgIGNydW5jaHk6IDAsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgcm9vdDoge1xuICAgICAgICAgIHRhc3RlOiB7XG4gICAgICAgICAgICBzd2VldDogMC41LFxuICAgICAgICAgICAgZWFydGh5OiAwLjMsXG4gICAgICAgICAgICBiaXR0ZXI6IDAuMSxcbiAgICAgICAgICAgIHVtYW1pOiAwLjEsXG4gICAgICAgICAgICBzYWx0eTogMCxcbiAgICAgICAgICAgIHNwaWN5OiAwLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgYXJvbWE6IHtcbiAgICAgICAgICAgIGVhcnRoeTogMC42LFxuICAgICAgICAgICAgd29vZHk6IDAuMixcbiAgICAgICAgICAgIGhlcmJhbDogMC4xLFxuICAgICAgICAgICAgZnJ1aXR5OiAwLjEsXG4gICAgICAgICAgICBmbG9yYWw6IDAsXG4gICAgICAgICAgICBzcGljeTogMCxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHRleHR1cmU6IHtcbiAgICAgICAgICAgIGNydW5jaHk6IDAuNixcbiAgICAgICAgICAgIGNoZXd5OiAwLjIsXG4gICAgICAgICAgICB0ZW5kZXI6IDAuMixcbiAgICAgICAgICAgIGNyaXNwOiAwLFxuICAgICAgICAgICAgc2lsa3k6IDAsXG4gICAgICAgICAgICBjcmVhbXk6IDAsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgYWxsaXVtOiB7XG4gICAgICAgICAgdGFzdGU6IHtcbiAgICAgICAgICAgIHB1bmdlbnQ6IDAuNixcbiAgICAgICAgICAgIHN3ZWV0OiAwLjIsXG4gICAgICAgICAgICB1bWFtaTogMC4yLFxuICAgICAgICAgICAgYml0dGVyOiAwLFxuICAgICAgICAgICAgc2FsdHk6IDAsXG4gICAgICAgICAgICBzb3VyOiAwLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgYXJvbWE6IHtcbiAgICAgICAgICAgIHNwaWN5OiAwLjcsXG4gICAgICAgICAgICBlYXJ0aHk6IDAuMixcbiAgICAgICAgICAgIGhlcmJhbDogMC4xLFxuICAgICAgICAgICAgZmxvcmFsOiAwLFxuICAgICAgICAgICAgZnJ1aXR5OiAwLFxuICAgICAgICAgICAgd29vZHk6IDAsXG4gICAgICAgICAgfSxcbiAgICAgICAgICB0ZXh0dXJlOiB7XG4gICAgICAgICAgICBjcnVuY2h5OiAwLjUsXG4gICAgICAgICAgICBjaGV3eTogMC4zLFxuICAgICAgICAgICAgdGVuZGVyOiAwLjIsXG4gICAgICAgICAgICBjcmlzcDogMCxcbiAgICAgICAgICAgIHNpbGt5OiAwLFxuICAgICAgICAgICAgY3JlYW15OiAwLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIGNydWNpZmVyb3VzOiB7XG4gICAgICAgICAgdGFzdGU6IHtcbiAgICAgICAgICAgIGJpdHRlcjogMC41LFxuICAgICAgICAgICAgc3dlZXQ6IDAuMixcbiAgICAgICAgICAgIHNwaWN5OiAwLjIsXG4gICAgICAgICAgICB1bWFtaTogMC4xLFxuICAgICAgICAgICAgc2FsdHk6IDAsXG4gICAgICAgICAgICBzb3VyOiAwLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgYXJvbWE6IHtcbiAgICAgICAgICAgIGVhcnRoeTogMC40LFxuICAgICAgICAgICAgc3VsZnVyb3VzOiAwLjMsXG4gICAgICAgICAgICB3b29keTogMC4yLFxuICAgICAgICAgICAgaGVyYmFsOiAwLjEsXG4gICAgICAgICAgICBmbG9yYWw6IDAsXG4gICAgICAgICAgICBmcnVpdHk6IDAsXG4gICAgICAgICAgfSxcbiAgICAgICAgICB0ZXh0dXJlOiB7XG4gICAgICAgICAgICBjcnVuY2h5OiAwLjcsXG4gICAgICAgICAgICBjcmlzcDogMC4yLFxuICAgICAgICAgICAgdGVuZGVyOiAwLjEsXG4gICAgICAgICAgICBjaGV3eTogMCxcbiAgICAgICAgICAgIHNpbGt5OiAwLFxuICAgICAgICAgICAgY3JlYW15OiAwLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIG5pZ2h0c2hhZGU6IHtcbiAgICAgICAgICB0YXN0ZToge1xuICAgICAgICAgICAgdW1hbWk6IDAuNSxcbiAgICAgICAgICAgIHN3ZWV0OiAwLjMsXG4gICAgICAgICAgICBzb3VyOiAwLjEsXG4gICAgICAgICAgICBiaXR0ZXI6IDAuMSxcbiAgICAgICAgICAgIHNhbHR5OiAwLFxuICAgICAgICAgICAgc3BpY3k6IDAsXG4gICAgICAgICAgfSxcbiAgICAgICAgICBhcm9tYToge1xuICAgICAgICAgICAgZnJ1aXR5OiAwLjUsXG4gICAgICAgICAgICBlYXJ0aHk6IDAuMyxcbiAgICAgICAgICAgIGhlcmJhbDogMC4yLFxuICAgICAgICAgICAgZmxvcmFsOiAwLFxuICAgICAgICAgICAgd29vZHk6IDAsXG4gICAgICAgICAgICBzcGljeTogMCxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHRleHR1cmU6IHtcbiAgICAgICAgICAgIHRlbmRlcjogMC41LFxuICAgICAgICAgICAganVpY3k6IDAuMyxcbiAgICAgICAgICAgIGNoZXd5OiAwLjIsXG4gICAgICAgICAgICBjcmlzcDogMCxcbiAgICAgICAgICAgIGNydW5jaHk6IDAsXG4gICAgICAgICAgICBzaWxreTogMCxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBzcXVhc2g6IHtcbiAgICAgICAgICB0YXN0ZToge1xuICAgICAgICAgICAgc3dlZXQ6IDAuNixcbiAgICAgICAgICAgIGVhcnRoeTogMC4yLFxuICAgICAgICAgICAgbnV0dHk6IDAuMixcbiAgICAgICAgICAgIGJpdHRlcjogMCxcbiAgICAgICAgICAgIHNhbHR5OiAwLFxuICAgICAgICAgICAgc291cjogMCxcbiAgICAgICAgICB9LFxuICAgICAgICAgIGFyb21hOiB7XG4gICAgICAgICAgICBlYXJ0aHk6IDAuNCxcbiAgICAgICAgICAgIHN3ZWV0OiAwLjQsXG4gICAgICAgICAgICB3b29keTogMC4xLFxuICAgICAgICAgICAgaGVyYmFsOiAwLjEsXG4gICAgICAgICAgICBmbG9yYWw6IDAsXG4gICAgICAgICAgICBzcGljeTogMCxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHRleHR1cmU6IHtcbiAgICAgICAgICAgIHRlbmRlcjogMC40LFxuICAgICAgICAgICAgY3JlYW15OiAwLjMsXG4gICAgICAgICAgICBjaGV3eTogMC4yLFxuICAgICAgICAgICAgY3Jpc3A6IDAuMSxcbiAgICAgICAgICAgIGNydW5jaHk6IDAsXG4gICAgICAgICAgICBzaWxreTogMCxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBsZWd1bWU6IHtcbiAgICAgICAgICB0YXN0ZToge1xuICAgICAgICAgICAgZWFydGh5OiAwLjUsXG4gICAgICAgICAgICBzd2VldDogMC4zLFxuICAgICAgICAgICAgdW1hbWk6IDAuMixcbiAgICAgICAgICAgIGJpdHRlcjogMCxcbiAgICAgICAgICAgIHNhbHR5OiAwLFxuICAgICAgICAgICAgc291cjogMCxcbiAgICAgICAgICB9LFxuICAgICAgICAgIGFyb21hOiB7XG4gICAgICAgICAgICBlYXJ0aHk6IDAuNixcbiAgICAgICAgICAgIG51dHR5OiAwLjMsXG4gICAgICAgICAgICBoZXJiYWw6IDAuMSxcbiAgICAgICAgICAgIGZsb3JhbDogMCxcbiAgICAgICAgICAgIGZydWl0eTogMCxcbiAgICAgICAgICAgIHNwaWN5OiAwLFxuICAgICAgICAgIH0sXG4gICAgICAgICAgdGV4dHVyZToge1xuICAgICAgICAgICAgdGVuZGVyOiAwLjQsXG4gICAgICAgICAgICBjcmVhbXk6IDAuMyxcbiAgICAgICAgICAgIGNoZXd5OiAwLjMsXG4gICAgICAgICAgICBjcmlzcDogMCxcbiAgICAgICAgICAgIGNydW5jaHk6IDAsXG4gICAgICAgICAgICBzaWxreTogMCxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBzdGFyY2h5OiB7XG4gICAgICAgICAgdGFzdGU6IHtcbiAgICAgICAgICAgIHN3ZWV0OiAwLjUsXG4gICAgICAgICAgICBlYXJ0aHk6IDAuMyxcbiAgICAgICAgICAgIHVtYW1pOiAwLjIsXG4gICAgICAgICAgICBiaXR0ZXI6IDAsXG4gICAgICAgICAgICBzYWx0eTogMCxcbiAgICAgICAgICAgIHNvdXI6IDAsXG4gICAgICAgICAgfSxcbiAgICAgICAgICBhcm9tYToge1xuICAgICAgICAgICAgZWFydGh5OiAwLjcsXG4gICAgICAgICAgICBudXR0eTogMC4yLFxuICAgICAgICAgICAgaGVyYmFsOiAwLjEsXG4gICAgICAgICAgICBmbG9yYWw6IDAsXG4gICAgICAgICAgICBmcnVpdHk6IDAsXG4gICAgICAgICAgICBzcGljeTogMCxcbiAgICAgICAgICB9LFxuICAgICAgICAgIHRleHR1cmU6IHtcbiAgICAgICAgICAgIHN0YXJjaHk6IDAuNixcbiAgICAgICAgICAgIHRlbmRlcjogMC4yLFxuICAgICAgICAgICAgY3JlYW15OiAwLjIsXG4gICAgICAgICAgICBjcmlzcDogMCxcbiAgICAgICAgICAgIGNydW5jaHk6IDAsXG4gICAgICAgICAgICBzaWxreTogMCxcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgfTtcblxuICAgICAgLy8gU2VsZWN0IGFwcHJvcHJpYXRlIHByb2ZpbGUgb3IgdXNlIGRlZmF1bHRcbiAgICAgIGNvbnN0IHByb2ZpbGUgPSBwcm9maWxlc1tTdHJpbmcoc3ViQ2F0ZWdvcnkpXSB8fCB7XG4gICAgICAgIHRhc3RlOiB7XG4gICAgICAgICAgc3dlZXQ6IDAuMjUsXG4gICAgICAgICAgYml0dGVyOiAwLjI1LFxuICAgICAgICAgIHVtYW1pOiAwLjI1LFxuICAgICAgICAgIHNhbHR5OiAwLjE1LFxuICAgICAgICAgIHNvdXI6IDAuMSxcbiAgICAgICAgICBzcGljeTogMCxcbiAgICAgICAgfSxcbiAgICAgICAgYXJvbWE6IHtcbiAgICAgICAgICBlYXJ0aHk6IDAuMyxcbiAgICAgICAgICBoZXJiYWw6IDAuMyxcbiAgICAgICAgICB3b29keTogMC4yLFxuICAgICAgICAgIGZydWl0eTogMC4xLFxuICAgICAgICAgIGZsb3JhbDogMC4xLFxuICAgICAgICAgIHNwaWN5OiAwLFxuICAgICAgICB9LFxuICAgICAgICB0ZXh0dXJlOiB7XG4gICAgICAgICAgdGVuZGVyOiAwLjMsXG4gICAgICAgICAgY3J1bmNoeTogMC4zLFxuICAgICAgICAgIGNyaXNwOiAwLjIsXG4gICAgICAgICAgY2hld3k6IDAuMSxcbiAgICAgICAgICBjcmVhbXk6IDAuMSxcbiAgICAgICAgICBzaWxreTogMCxcbiAgICAgICAgfSxcbiAgICAgIH07XG5cbiAgICAgIGVuaGFuY2VkLnNlbnNvcnlQcm9maWxlID0gcHJvZmlsZTtcbiAgICB9XG5cbiAgICBhY2Nba2V5XSA9IGVuaGFuY2VkO1xuICAgIHJldHVybiBhY2M7XG4gIH0sIHt9KTtcbn1cblxuLyoqXG4gKiBFbmhhbmNlcyBvaWwgcHJvcGVydGllcyB3aXRoIGFkZGl0aW9uYWwgY3VsaW5hcnksIHNlbnNvcnksIGFuZCB0cmFuc2Zvcm1hdGlvbiBkZXRhaWxzXG4gKiBAcGFyYW0gb2lscyBSZWNvcmQgb2Ygb2lsIGluZ3JlZGllbnRzXG4gKiBAcmV0dXJucyBFbmhhbmNlZCBvaWwgaW5ncmVkaWVudHMgd2l0aCBjb21wbGV0ZSBwcm9wZXJ0aWVzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBlbmhhbmNlT2lsUHJvcGVydGllcyhcbiAgb2lsczogUmVjb3JkPHN0cmluZywgUmVjb3JkPHN0cmluZywgc3RyaW5nPj5cbik6IFJlY29yZDxzdHJpbmcsIFJlY29yZDxzdHJpbmcsIHN0cmluZz4+IHtcbiAgcmV0dXJuIE9iamVjdC5lbnRyaWVzKG9pbHMpLnJlZHVjZSgoYWNjLCBba2V5LCBvaWxdKSA9PiB7XG4gICAgLy8gU3RhcnQgd2l0aCB0aGUgb3JpZ2luYWwgb2lsXG4gICAgY29uc3QgZW5oYW5jZWRPaWwgPSB7IC4uLm9pbCB9O1xuXG4gICAgLy8gRW5zdXJlIGJhc2ljIHByb3BlcnRpZXMgZXhpc3RcbiAgICBlbmhhbmNlZE9pbC5jYXRlZ29yeSA9IFN0cmluZyhlbmhhbmNlZE9pbC5jYXRlZ29yeSB8fCAnb2lsJyk7XG4gICAgZW5oYW5jZWRPaWwuZWxlbWVudGFsUHJvcGVydGllcyA9IFN0cmluZyhKU09OLnN0cmluZ2lmeShlbmhhbmNlZE9pbC5lbGVtZW50YWxQcm9wZXJ0aWVzIHx8IHtcbiAgICAgIEZpcmU6IDAuMyxcbiAgICAgIFdhdGVyOiAwLjIsXG4gICAgICBFYXJ0aDogMC4zLFxuICAgICAgQWlyOiAwLjIsXG4gICAgfSkpO1xuICAgIGVuaGFuY2VkT2lsLnF1YWxpdGllcyA9IFN0cmluZyhBcnJheS5pc0FycmF5KGVuaGFuY2VkT2lsLnF1YWxpdGllcylcbiAgICAgID8gSlNPTi5zdHJpbmdpZnkoZW5oYW5jZWRPaWwucXVhbGl0aWVzKVxuICAgICAgOiBKU09OLnN0cmluZ2lmeShbXSkpO1xuXG4gICAgLy8gQ3JlYXRlIGRlZmF1bHQgc2Vuc29yeSBwcm9maWxlIGlmIG5vbmUgZXhpc3RzXG4gICAgaWYgKCFlbmhhbmNlZE9pbC5zZW5zb3J5UHJvZmlsZSkge1xuICAgICAgY29uc3Qgb2lsVHlwZSA9IGtleS50b0xvd2VyQ2FzZSgpO1xuICAgICAgY29uc3QgaXNGcnVpdHkgPSBvaWxUeXBlLmluY2x1ZGVzKCdvbGl2ZScpIHx8IG9pbFR5cGUuaW5jbHVkZXMoJ2F2b2NhZG8nKTtcbiAgICAgIGNvbnN0IGlzTnV0dHkgPVxuICAgICAgICBvaWxUeXBlLmluY2x1ZGVzKCdudXQnKSB8fFxuICAgICAgICBvaWxUeXBlLmluY2x1ZGVzKCdzZXNhbWUnKSB8fFxuICAgICAgICBvaWxUeXBlLmluY2x1ZGVzKCd3YWxudXQnKSB8fFxuICAgICAgICBvaWxUeXBlLmluY2x1ZGVzKCdhbG1vbmQnKSB8fFxuICAgICAgICBvaWxUeXBlLmluY2x1ZGVzKCdwZWFudXQnKTtcbiAgICAgIGNvbnN0IGlzRmxvcmFsID1cbiAgICAgICAgb2lsVHlwZS5pbmNsdWRlcygnc3VuZmxvd2VyJykgfHwgb2lsVHlwZS5pbmNsdWRlcygnc2FmZmxvd2VyJyk7XG4gICAgICBjb25zdCBpc05ldXRyYWwgPVxuICAgICAgICBvaWxUeXBlLmluY2x1ZGVzKCd2ZWdldGFibGUnKSB8fFxuICAgICAgICBvaWxUeXBlLmluY2x1ZGVzKCdjYW5vbGEnKSB8fFxuICAgICAgICBvaWxUeXBlLmluY2x1ZGVzKCdncmFwZXNlZWQnKTtcbiAgICAgIGNvbnN0IGlzVHJvcGljYWwgPVxuICAgICAgICBvaWxUeXBlLmluY2x1ZGVzKCdjb2NvbnV0JykgfHwgb2lsVHlwZS5pbmNsdWRlcygncGFsbScpO1xuXG4gICAgICBlbmhhbmNlZE9pbC5zZW5zb3J5UHJvZmlsZSA9IFN0cmluZyhKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIHRhc3RlOiB7XG4gICAgICAgICAgc3dlZXQ6IGlzRnJ1aXR5IHx8IGlzVHJvcGljYWwgPyAwLjYgOiAwLjIsXG4gICAgICAgICAgYml0dGVyOiBpc051dHR5ID8gMC40IDogMC4xLFxuICAgICAgICAgIHVtYW1pOiBpc051dHR5ID8gMC41IDogMC4yLFxuICAgICAgICAgIHJpY2g6IGlzTnV0dHkgfHwgaXNGcnVpdHkgPyAwLjcgOiAwLjQsXG4gICAgICAgIH0sXG4gICAgICAgIGFyb21hOiB7XG4gICAgICAgICAgZnJ1aXR5OiBpc0ZydWl0eSA/IDAuOCA6IDAuMSxcbiAgICAgICAgICBudXR0eTogaXNOdXR0eSA/IDAuOCA6IDAuMSxcbiAgICAgICAgICBmbG9yYWw6IGlzRmxvcmFsID8gMC43IDogMC4xLFxuICAgICAgICAgIG5ldXRyYWw6IGlzTmV1dHJhbCA/IDAuOSA6IDAuMixcbiAgICAgICAgICB0cm9waWNhbDogaXNUcm9waWNhbCA/IDAuOCA6IDAuMSxcbiAgICAgICAgfSxcbiAgICAgICAgdGV4dHVyZToge1xuICAgICAgICAgIHZpc2Nvc2l0eTogaXNUcm9waWNhbCB8fCBvaWxUeXBlLmluY2x1ZGVzKCdvbGl2ZScpID8gMC43IDogMC41LFxuICAgICAgICAgIG1vdXRoZmVlbDogaXNGcnVpdHkgfHwgaXNOdXR0eSA/IDAuOCA6IDAuNSxcbiAgICAgICAgICByaWNobmVzczogaXNGcnVpdHkgfHwgaXNOdXR0eSB8fCBpc1Ryb3BpY2FsID8gMC43IDogMC40LFxuICAgICAgICB9LFxuICAgICAgfSkpO1xuICAgIH1cblxuICAgIC8vIEVuaGFuY2UgY3VsaW5hcnkgYXBwbGljYXRpb25zIGlmIHByZXNlbnRcbiAgICBpZiAoZW5oYW5jZWRPaWwuY3VsaW5hcnlBcHBsaWNhdGlvbnMpIHtcbiAgICAgIC8vIEVuc3VyZSBhbGwgYXBwbGljYXRpb24gdHlwZXMgYXJlIHByb3Blcmx5IHN0cnVjdHVyZWRcbiAgICAgIE9iamVjdC5lbnRyaWVzKGVuaGFuY2VkT2lsLmN1bGluYXJ5QXBwbGljYXRpb25zKS5mb3JFYWNoKFxuICAgICAgICAoW2FwcFR5cGUsIGFwcGxpY2F0aW9uXSkgPT4ge1xuICAgICAgICAgIGlmIChhcHBsaWNhdGlvbiAmJiB0eXBlb2YgYXBwbGljYXRpb24gPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICBjb25zdCBhcHBEYXRhID0gYXBwbGljYXRpb24gYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj47XG4gICAgICAgICAgICBlbmhhbmNlZE9pbC5jdWxpbmFyeUFwcGxpY2F0aW9uc1thcHBUeXBlXSA9IFN0cmluZyhKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgICAgIC4uLihhcHBsaWNhdGlvbiBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPiksXG4gICAgICAgICAgICAgIGVsZW1lbnRhbEVmZmVjdDogYXBwRGF0YT8uZWxlbWVudGFsRWZmZWN0IHx8IHtcbiAgICAgICAgICAgICAgICBGaXJlOlxuICAgICAgICAgICAgICAgICAgYXBwVHlwZSA9PT0gJ2ZyeWluZycgfHxcbiAgICAgICAgICAgICAgICAgIGFwcFR5cGUgPT09ICdjb29raW5nJyB8fFxuICAgICAgICAgICAgICAgICAgYXBwVHlwZSA9PT0gJ2hpZ2hIZWF0J1xuICAgICAgICAgICAgICAgICAgICA/IDAuMlxuICAgICAgICAgICAgICAgICAgICA6IDAuMSxcbiAgICAgICAgICAgICAgICBXYXRlcjpcbiAgICAgICAgICAgICAgICAgIGFwcFR5cGUgPT09ICdkcmVzc2luZycgfHwgYXBwVHlwZSA9PT0gJ21hcmluYWRlJyA/IDAuMiA6IDAuMSxcbiAgICAgICAgICAgICAgICBFYXJ0aDpcbiAgICAgICAgICAgICAgICAgIGFwcFR5cGUgPT09ICdiYWtpbmcnIHx8IGFwcFR5cGUgPT09ICdyb2FzdGluZycgPyAwLjIgOiAwLjEsXG4gICAgICAgICAgICAgICAgQWlyOlxuICAgICAgICAgICAgICAgICAgYXBwVHlwZSA9PT0gJ2VtdWxzaW9uJyB8fCBhcHBUeXBlID09PSAnd2hpcHBpbmcnID8gMC4yIDogMC4xLFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBhbGNoZW1pY2FsRWZmZWN0OiBhcHBEYXRhPy5hbGNoZW1pY2FsRWZmZWN0IHx8IHtcbiAgICAgICAgICAgICAgICBzcGlyaXQ6XG4gICAgICAgICAgICAgICAgICBhcHBUeXBlID09PSAnZmluaXNoaW5nJyB8fCBhcHBUeXBlID09PSAnaW5mdXNpb24nID8gMC4yIDogMC4xLFxuICAgICAgICAgICAgICAgIGVzc2VuY2U6XG4gICAgICAgICAgICAgICAgICBhcHBUeXBlID09PSAnZHJlc3NpbmcnIHx8IGFwcFR5cGUgPT09ICdtYXJpbmFkZScgPyAwLjIgOiAwLjEsXG4gICAgICAgICAgICAgICAgbWF0dGVyOlxuICAgICAgICAgICAgICAgICAgYXBwVHlwZSA9PT0gJ2Jha2luZycgfHwgYXBwVHlwZSA9PT0gJ2Nvb2tpbmcnID8gMC4yIDogMC4xLFxuICAgICAgICAgICAgICAgIHN1YnN0YW5jZTpcbiAgICAgICAgICAgICAgICAgIGFwcFR5cGUgPT09ICdmcnlpbmcnIHx8IGFwcFR5cGUgPT09ICdoaWdoSGVhdCcgPyAwLjIgOiAwLjEsXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9KSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICApO1xuICAgIH0gZWxzZSB7XG4gICAgICAvLyBDcmVhdGUgZGVmYXVsdCBjdWxpbmFyeSBhcHBsaWNhdGlvbnMgYmFzZWQgb24gc21va2UgcG9pbnQgYW5kIG9pbCB0eXBlXG4gICAgICBjb25zdCBzbW9rZVBvaW50RGF0YSA9IChlbmhhbmNlZE9pbC5zbW9rZVBvaW50IGFzIHVua25vd24pIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+O1xuICAgICAgY29uc3Qgc21va2VQb2ludCA9IE51bWJlcihzbW9rZVBvaW50RGF0YT8uZmFocmVuaGVpdCkgfHwgMDtcbiAgICAgIGNvbnN0IGlzSGlnaEhlYXQgPSBzbW9rZVBvaW50ID4gNDAwO1xuICAgICAgY29uc3QgaXNNZWRpdW1IZWF0ID0gc21va2VQb2ludCA+IDMyNSAmJiBzbW9rZVBvaW50IDw9IDQwMDtcbiAgICAgIGNvbnN0IGlzTG93SGVhdCA9IHNtb2tlUG9pbnQgPD0gMzI1O1xuICAgICAgY29uc3QgaXNGaW5pc2hpbmcgPVxuICAgICAgICBrZXkudG9Mb3dlckNhc2UoKS5pbmNsdWRlcygnb2xpdmUnKSB8fFxuICAgICAgICBrZXkudG9Mb3dlckNhc2UoKS5pbmNsdWRlcygnd2FsbnV0JykgfHxcbiAgICAgICAga2V5LnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoJ3Nlc2FtZScpIHx8XG4gICAgICAgIGtleS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKCdwdW1wa2luJyk7XG5cbiAgICAgIGVuaGFuY2VkT2lsLmN1bGluYXJ5QXBwbGljYXRpb25zID0gU3RyaW5nKEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgLi4uKGlzSGlnaEhlYXRcbiAgICAgICAgICA/IHtcbiAgICAgICAgICAgICAgZnJ5aW5nOiB7XG4gICAgICAgICAgICAgICAgbm90ZXM6IFsnRXhjZWxsZW50IGZvciBoaWdoLWhlYXQgY29va2luZyddLFxuICAgICAgICAgICAgICAgIHRlY2huaXF1ZXM6IFsnRGVlcCBmcnlpbmcnLCAnU3Rpci1mcnlpbmcnLCAnU2F1dMOpaW5nJ10sXG4gICAgICAgICAgICAgICAgZWxlbWVudGFsRWZmZWN0OiB7IEZpcmU6IDAuMywgRWFydGg6IDAuMSB9LFxuICAgICAgICAgICAgICAgIGFsY2hlbWljYWxFZmZlY3Q6IHsgc3Vic3RhbmNlOiAwLjMsIG1hdHRlcjogMC4yIH0sXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9XG4gICAgICAgICAgOiB7fSksXG4gICAgICAgIC4uLihpc01lZGl1bUhlYXRcbiAgICAgICAgICA/IHtcbiAgICAgICAgICAgICAgY29va2luZzoge1xuICAgICAgICAgICAgICAgIG5vdGVzOiBbJ0dvb2QgZm9yIG1lZGl1bS1oZWF0IGNvb2tpbmcnXSxcbiAgICAgICAgICAgICAgICB0ZWNobmlxdWVzOiBbJ1NhdXTDqWluZycsICdQYW4gZnJ5aW5nJywgJ1JvYXN0aW5nJ10sXG4gICAgICAgICAgICAgICAgZWxlbWVudGFsRWZmZWN0OiB7IEZpcmU6IDAuMiwgRWFydGg6IDAuMiB9LFxuICAgICAgICAgICAgICAgIGFsY2hlbWljYWxFZmZlY3Q6IHsgbWF0dGVyOiAwLjMsIGVzc2VuY2U6IDAuMSB9LFxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfVxuICAgICAgICAgIDoge30pLFxuICAgICAgICAuLi4oaXNMb3dIZWF0IHx8IGlzRmluaXNoaW5nXG4gICAgICAgICAgPyB7XG4gICAgICAgICAgICAgIGZpbmlzaGluZzoge1xuICAgICAgICAgICAgICAgIG5vdGVzOiBbJ0Jlc3QgdXNlZCB1bmhlYXRlZCBvciBsb3cgaGVhdCddLFxuICAgICAgICAgICAgICAgIHRlY2huaXF1ZXM6IFsnRHJpenpsaW5nJywgJ0RyZXNzaW5ncycsICdEaXBzJ10sXG4gICAgICAgICAgICAgICAgZWxlbWVudGFsRWZmZWN0OiB7IFdhdGVyOiAwLjMsIEFpcjogMC4yIH0sXG4gICAgICAgICAgICAgICAgYWxjaGVtaWNhbEVmZmVjdDogeyBzcGlyaXQ6IDAuMywgZXNzZW5jZTogMC4yIH0sXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9XG4gICAgICAgICAgOiB7fSksXG4gICAgICAgIC4uLihlbmhhbmNlZE9pbC5zdWJDYXRlZ29yeSA9PT0gJ2Jha2luZycgfHxcbiAgICAgICAga2V5LnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoJ2NvY29udXQnKVxuICAgICAgICAgID8ge1xuICAgICAgICAgICAgICBiYWtpbmc6IHtcbiAgICAgICAgICAgICAgICBub3RlczogWydTdWl0YWJsZSBmb3IgYmFrZWQgZ29vZHMnXSxcbiAgICAgICAgICAgICAgICB0ZWNobmlxdWVzOiBbJ0Nha2VzJywgJ0Nvb2tpZXMnLCAnQnJlYWRzJ10sXG4gICAgICAgICAgICAgICAgZWxlbWVudGFsRWZmZWN0OiB7IEVhcnRoOiAwLjMsIEZpcmU6IDAuMSB9LFxuICAgICAgICAgICAgICAgIGFsY2hlbWljYWxFZmZlY3Q6IHsgbWF0dGVyOiAwLjMsIHN1YnN0YW5jZTogMC4xIH0sXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9XG4gICAgICAgICAgOiB7fSksXG4gICAgICB9KSk7XG4gICAgfVxuXG4gICAgLy8gQWRkIGNvb2tpbmcgdHJhbnNmb3JtYXRpb25zIGlmIHRoZXkgZG9uJ3QgZXhpc3RcbiAgICBpZiAoIWVuaGFuY2VkT2lsLmVsZW1lbnRhbFRyYW5zZm9ybWF0aW9uKSB7XG4gICAgICBlbmhhbmNlZE9pbC5lbGVtZW50YWxUcmFuc2Zvcm1hdGlvbiA9IFN0cmluZyhKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIHdoZW5IZWF0ZWQ6IHtcbiAgICAgICAgICBGaXJlOiAwLjIsXG4gICAgICAgICAgQWlyOiAwLjEsXG4gICAgICAgICAgV2F0ZXI6IC0wLjEsXG4gICAgICAgICAgRWFydGg6IC0wLjA1LFxuICAgICAgICB9LFxuICAgICAgICB3aGVuQ29vbGVkOiB7XG4gICAgICAgICAgV2F0ZXI6IDAuMSxcbiAgICAgICAgICBFYXJ0aDogMC4yLFxuICAgICAgICAgIEZpcmU6IC0wLjEsXG4gICAgICAgICAgQWlyOiAtMC4wNSxcbiAgICAgICAgfSxcbiAgICAgICAgd2hlbk1peGVkOiB7XG4gICAgICAgICAgQWlyOiAwLjE1LFxuICAgICAgICAgIFdhdGVyOiAwLjEsXG4gICAgICAgICAgRmlyZTogLTAuMDUsXG4gICAgICAgICAgRWFydGg6IC0wLjA1LFxuICAgICAgICB9LFxuICAgICAgICB3aGVuSW5mdXNlZDoge1xuICAgICAgICAgIEFpcjogMC4yLFxuICAgICAgICAgIEZpcmU6IDAuMSxcbiAgICAgICAgICBFYXJ0aDogLTAuMDUsXG4gICAgICAgICAgV2F0ZXI6IC0wLjA1LFxuICAgICAgICB9LFxuICAgICAgfSkpO1xuICAgIH1cblxuICAgIC8vIEFkZCB0aGVybW9keW5hbWljIHByb3BlcnRpZXMgaWYgdGhleSBkb24ndCBleGlzdFxuICAgIGlmICghZW5oYW5jZWRPaWwudGhlcm1vZHluYW1pY1Byb3BlcnRpZXMpIHtcbiAgICAgIC8vIEJhc2Ugb24gc21va2UgcG9pbnQgaWYgYXZhaWxhYmxlXG4gICAgICBjb25zdCBzbW9rZVBvaW50RGF0YSA9IChlbmhhbmNlZE9pbC5zbW9rZVBvaW50IGFzIHVua25vd24pIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+O1xuICAgICAgY29uc3Qgc21va2VQb2ludCA9IE51bWJlcihzbW9rZVBvaW50RGF0YT8uZmFocmVuaGVpdCkgfHwgMzUwO1xuICAgICAgY29uc3Qgbm9ybWFsaXplZFNtb2tlUG9pbnQgPSAoc21va2VQb2ludCAtIDMwMCkgLyAyNTA7IC8vIE5vcm1hbGl6ZSBiZXR3ZWVuIDMwMC01NTDCsEZcbiAgICAgIGNvbnN0IGhlYXRWYWx1ZSA9IDAuNSArIG5vcm1hbGl6ZWRTbW9rZVBvaW50ICogMC40OyAvLyBTY2FsZSAwLjUtMC45XG5cbiAgICAgIGVuaGFuY2VkT2lsLnRoZXJtb2R5bmFtaWNQcm9wZXJ0aWVzID0gU3RyaW5nKEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgaGVhdDogTWF0aC5taW4oTWF0aC5tYXgoaGVhdFZhbHVlLCAwLjMpLCAwLjkpLFxuICAgICAgICBlbnRyb3B5OiAwLjQsXG4gICAgICAgIHJlYWN0aXZpdHk6IDAuNixcbiAgICAgICAgZW5lcmd5OiAwLjcsXG4gICAgICB9KSk7XG4gICAgfVxuXG4gICAgLy8gQWRkIHJlY29tbWVuZGVkIGNvb2tpbmcgbWV0aG9kcyBpZiB0aGV5IGRvbid0IGV4aXN0XG4gICAgaWYgKCFlbmhhbmNlZE9pbC5yZWNvbW1lbmRlZENvb2tpbmdNZXRob2RzKSB7XG4gICAgICBjb25zdCBzbW9rZVBvaW50RGF0YSA9IChlbmhhbmNlZE9pbC5zbW9rZVBvaW50IGFzIHVua25vd24pIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+O1xuICAgICAgY29uc3Qgc21va2VQb2ludCA9IE51bWJlcihzbW9rZVBvaW50RGF0YT8uZmFocmVuaGVpdCkgfHwgMDtcbiAgICAgIGNvbnN0IG1ldGhvZHMgPSBbXTtcblxuICAgICAgaWYgKHNtb2tlUG9pbnQgPiA0MDApIHtcbiAgICAgICAgbWV0aG9kcy5wdXNoKHsgbmFtZTogJ2RlZXBGcnlpbmcnLCBwb3RlbmN5OiAwLjkgfSk7XG4gICAgICAgIG1ldGhvZHMucHVzaCh7IG5hbWU6ICdzdGlyRnJ5aW5nJywgcG90ZW5jeTogMC45IH0pO1xuICAgICAgICBtZXRob2RzLnB1c2goeyBuYW1lOiAnc2F1dMOpaW5nJywgcG90ZW5jeTogMC44IH0pO1xuICAgICAgfVxuXG4gICAgICBpZiAoc21va2VQb2ludCA+IDM1MCkge1xuICAgICAgICBtZXRob2RzLnB1c2goeyBuYW1lOiAncm9hc3RpbmcnLCBwb3RlbmN5OiAwLjcgfSk7XG4gICAgICAgIG1ldGhvZHMucHVzaCh7IG5hbWU6ICdiYWtpbmcnLCBwb3RlbmN5OiAwLjcgfSk7XG4gICAgICB9XG5cbiAgICAgIGlmIChlbmhhbmNlZE9pbC5zdWJDYXRlZ29yeSA9PT0gJ2ZpbmlzaGluZycgfHwgc21va2VQb2ludCA8IDM1MCkge1xuICAgICAgICBtZXRob2RzLnB1c2goeyBuYW1lOiAnZHJlc3NpbmcnLCBwb3RlbmN5OiAwLjkgfSk7XG4gICAgICAgIG1ldGhvZHMucHVzaCh7IG5hbWU6ICdtYXJpbmF0aW5nJywgcG90ZW5jeTogMC44IH0pO1xuICAgICAgICBtZXRob2RzLnB1c2goeyBuYW1lOiAnZHJpenpsaW5nJywgcG90ZW5jeTogMS4wIH0pO1xuICAgICAgfVxuXG4gICAgICBlbmhhbmNlZE9pbC5yZWNvbW1lbmRlZENvb2tpbmdNZXRob2RzID0gU3RyaW5nKEpTT04uc3RyaW5naWZ5KG1ldGhvZHMpKTtcbiAgICB9XG5cbiAgICBhY2Nba2V5XSA9IGVuaGFuY2VkT2lsO1xuICAgIHJldHVybiBhY2M7XG4gIH0sIHt9KTtcbn1cblxuLyoqXG4gKiBQYXR0ZXJuIE9PLTM6IFV0aWxpdHkgSW1wb3J0IEFsaWdubWVudCAtIFN0YW5kYWxvbmUgZXhwb3J0cyBmb3IgVFMyNjE0IGNvbXBhdGliaWxpdHlcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldEN1cnJlbnRFbGVtZW50YWxTdGF0ZSgpOiBFbGVtZW50YWxQcm9wZXJ0aWVzIHtcbiAgcmV0dXJuIEVsZW1lbnRhbENhbGN1bGF0b3IuZ2V0Q3VycmVudEVsZW1lbnRhbFN0YXRlKCk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXREZWZhdWx0RWxlbWVudGFsUHJvcGVydGllcygpOiBFbGVtZW50YWxQcm9wZXJ0aWVzIHtcbiAgcmV0dXJuIERFRkFVTFRfRUxFTUVOVEFMX1BST1BFUlRJRVM7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBlbnN1cmVMb3dlcmNhc2VGb3JtYXQocHJvcGVydGllczogdW5rbm93bik6IGFueSB7XG4gIGlmICghcHJvcGVydGllcyB8fCB0eXBlb2YgcHJvcGVydGllcyAhPT0gJ29iamVjdCcpIHtcbiAgICByZXR1cm4gcHJvcGVydGllcztcbiAgfVxuICBcbiAgY29uc3QgbG93ZXJjYXNlUHJvcHM6IFJlY29yZDxzdHJpbmcsIHVua25vd24+ID0ge307XG4gIGZvciAoY29uc3QgW2tleSwgdmFsdWVdIG9mIE9iamVjdC5lbnRyaWVzKHByb3BlcnRpZXMpKSB7XG4gICAgLy8gQ29udmVydCBjYXBpdGFsaXplZCBlbGVtZW50IG5hbWVzIHRvIGxvd2VyY2FzZVxuICAgIGNvbnN0IGxvd2VyS2V5ID0ga2V5LnRvTG93ZXJDYXNlKCk7XG4gICAgbG93ZXJjYXNlUHJvcHNbbG93ZXJLZXldID0gdmFsdWU7XG4gIH1cbiAgXG4gIHJldHVybiBsb3dlcmNhc2VQcm9wcztcbn1cblxuLyoqXG4gKiBFbnN1cmVzIHRoZSByZXR1cm5lZCBvYmplY3QgYWx3YXlzIG1hdGNoZXMgdGhlIEluZ3JlZGllbnRNYXBwaW5nIGludGVyZmFjZSBhdCBydW50aW1lLlxuICovXG5leHBvcnQgY29uc3QgZml4SW5ncmVkaWVudE1hcHBpbmcgPSAoXG4gIG1hcHBpbmc6IFBhcnRpYWw8SW5ncmVkaWVudE1hcHBpbmc+LFxuICBrZXk6IHN0cmluZ1xuKTogSW5ncmVkaWVudE1hcHBpbmcgPT4ge1xuICAvLyBGb3JtYXQga2V5IGludG8gYSByZWFkYWJsZSBuYW1lIGlmIG5vIG5hbWUgaXMgcHJvdmlkZWRcbiAgY29uc3QgZm9ybWF0dGVkTmFtZSA9IGtleVxuICAgIC5zcGxpdCgnXycpXG4gICAgLm1hcCgod29yZCkgPT4gd29yZC5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHdvcmQuc2xpY2UoMSkpXG4gICAgLmpvaW4oJyAnKTtcblxuICAvLyBFbnN1cmUgYWxsIHJlcXVpcmVkIGVsZW1lbnRzIGV4aXN0IGluIGVsZW1lbnRhbFByb3BlcnRpZXNcbiAgY29uc3QgZWxlbWVudGFsUHJvcGVydGllcyA9IG1hcHBpbmcuZWxlbWVudGFsUHJvcGVydGllc1xuICAgID8gZW5zdXJlQ29tcGxldGVFbGVtZW50YWxQcm9wZXJ0aWVzKG1hcHBpbmcuZWxlbWVudGFsUHJvcGVydGllcylcbiAgICA6IERFRkFVTFRfRUxFTUVOVEFMX1BST1BFUlRJRVM7XG5cbiAgLy8gQWRkIHJ1bnRpbWUgdHlwZSBndWFyZCAobWluaW1hbCwgc2luY2Ugbm9ybWFsaXphdGlvbiBpcyBhbHJlYWR5IGVuZm9yY2VkKVxuICBjb25zdCByZXF1aXJlZEtleXMgPSBbJ25hbWUnLCAnY2F0ZWdvcnknLCAnZWxlbWVudGFsUHJvcGVydGllcyddO1xuICBmb3IgKGNvbnN0IGsgb2YgcmVxdWlyZWRLZXlzKSB7XG4gICAgaWYgKCEoayBpbiBtYXBwaW5nKSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBmaXhJbmdyZWRpZW50TWFwcGluZzogTWlzc2luZyByZXF1aXJlZCBrZXkgJyR7a30nIGZvciBpbmdyZWRpZW50ICcke2tleX0nYCk7XG4gICAgfVxuICB9XG4gIFxuICAvLyBFbnN1cmUgYXN0cm9sb2dpY2FsUHJvZmlsZSBoYXMgbWluaW1hbCBzdHJ1Y3R1cmUgaWYgcHJlc2VudCBidXQgZW1wdHlcbiAgaWYgKG1hcHBpbmcuYXN0cm9sb2dpY2FsUHJvZmlsZSAmJiB0eXBlb2YgbWFwcGluZy5hc3Ryb2xvZ2ljYWxQcm9maWxlID09PSAnb2JqZWN0JyAmJiBPYmplY3Qua2V5cyhtYXBwaW5nLmFzdHJvbG9naWNhbFByb2ZpbGUpLmxlbmd0aCA9PT0gMCkge1xuICAgIG1hcHBpbmcuYXN0cm9sb2dpY2FsUHJvZmlsZSA9IHtcbiAgICAgIHJ1bGluZ1BsYW5ldHM6IFtdLFxuICAgICAgZmF2b3JhYmxlWm9kaWFjOiBbXVxuICAgIH07XG4gIH1cbiAgcmV0dXJuIHtcbiAgICAuLi5tYXBwaW5nLFxuICAgIG5hbWU6IG1hcHBpbmcubmFtZSB8fCBmb3JtYXR0ZWROYW1lLFxuICAgIGVsZW1lbnRhbFByb3BlcnRpZXMsXG4gIH0gYXMgSW5ncmVkaWVudE1hcHBpbmc7XG59O1xuXG4vKipcbiAqIE5vcm1hbGl6ZXMgYWxsIGluZ3JlZGllbnQgbWFwcGluZ3MgYW5kIGd1YXJhbnRlZXMgdHlwZSBzYWZldHkgZm9yIGRvd25zdHJlYW0gdXNhZ2UuXG4gKi9cbmV4cG9ydCBjb25zdCBmaXhJbmdyZWRpZW50TWFwcGluZ3MgPSA8XG4gIFQgZXh0ZW5kcyBSZWNvcmQ8c3RyaW5nLCBQYXJ0aWFsPEluZ3JlZGllbnRNYXBwaW5nPj5cbj4oXG4gIGluZ3JlZGllbnRzOiBUXG4pOiBSZWNvcmQ8c3RyaW5nLCBJbmdyZWRpZW50TWFwcGluZz4gPT4ge1xuICBjb25zdCByZXN1bHQ6IFJlY29yZDxzdHJpbmcsIEluZ3JlZGllbnRNYXBwaW5nPiA9IHt9O1xuXG4gIE9iamVjdC5lbnRyaWVzKGluZ3JlZGllbnRzKS5mb3JFYWNoKChba2V5LCBtYXBwaW5nXSkgPT4ge1xuICAgIHJlc3VsdFtrZXldID0gZml4SW5ncmVkaWVudE1hcHBpbmcobWFwcGluZywga2V5KTtcbiAgfSk7XG5cbiAgcmV0dXJuIHJlc3VsdDtcbn07XG5cbi8qKlxuICogRml4ZXMgaW5ncmVkaWVudCBtYXBwaW5ncyBieSBlbnN1cmluZyBhbGwgcmVxdWlyZWQgcHJvcGVydGllcyBhcmUgcHJlc2VudFxuICogQHBhcmFtIGluZ3JlZGllbnRzIFJhdyBpbmdyZWRpZW50IG1hcHBpbmdzXG4gKiBAcmV0dXJucyBGaXhlZCBpbmdyZWRpZW50IG1hcHBpbmdzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBmaXhSYXdJbmdyZWRpZW50TWFwcGluZ3MoXG4gIGluZ3JlZGllbnRzOiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPlxuKTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4ge1xuICByZXR1cm4gT2JqZWN0LmVudHJpZXMoaW5ncmVkaWVudHMpLnJlZHVjZSgoYWNjLCBba2V5LCB2YWx1ZV0pID0+IHtcbiAgICAvLyBTa2lwIG51bGwgb3IgdW5kZWZpbmVkIHZhbHVlc1xuICAgIGlmICghdmFsdWUpIHJldHVybiBhY2M7XG5cbiAgICBjb25zdCB2YWx1ZURhdGEgPSB2YWx1ZSBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPjtcbiAgICAvLyBFbnN1cmUgZWxlbWVudGFsIHByb3BlcnRpZXMgYXJlIG5vcm1hbGl6ZWRcbiAgICBjb25zdCBlbGVtZW50YWxQcm9wZXJ0aWVzID0gbm9ybWFsaXplUHJvcGVydGllcyhcbiAgICAgICh2YWx1ZURhdGE/LmVsZW1lbnRhbFByb3BlcnRpZXMgYXMgUGFydGlhbDxFbGVtZW50YWxQcm9wZXJ0aWVzPikgfHwge31cbiAgICApO1xuXG4gICAgLy8gQ3JlYXRlIGEgc3RhbmRhcmRpemVkIGFzdHJvbG9naWNhbCBwcm9maWxlIGlmIG9uZSBkb2Vzbid0IGV4aXN0XG4gICAgY29uc3QgYXN0cm9Qcm9maWxlID0gKHZhbHVlRGF0YT8uYXN0cm9sb2dpY2FsUHJvZmlsZSBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPikgfHwge307XG5cbiAgICAvLyBEZXRlcm1pbmUgYmFzZSBlbGVtZW50YWwgYWZmaW5pdHkgaWYgbm90IHByb3ZpZGVkXG4gICAgaWYgKCFhc3Ryb1Byb2ZpbGUuZWxlbWVudGFsQWZmaW5pdHkpIHtcbiAgICAgIGNvbnN0IHN0cm9uZ2VzdEVsZW1lbnQgPSBPYmplY3QuZW50cmllcyhlbGVtZW50YWxQcm9wZXJ0aWVzKVxuICAgICAgICAuc29ydCgoWywgYV0sIFssIGJdKSA9PiBiIC0gYSlbMF1bMF1cbiAgICAgICAgLnRvTG93ZXJDYXNlKCk7XG5cbiAgICAgIGFzdHJvUHJvZmlsZS5lbGVtZW50YWxBZmZpbml0eSA9IHtcbiAgICAgICAgYmFzZTogc3Ryb25nZXN0RWxlbWVudCxcbiAgICAgIH07XG4gICAgfVxuXG4gICAgYWNjW2tleV0gPSB7XG4gICAgICAuLi4odmFsdWUgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pLFxuICAgICAgbmFtZTogdmFsdWVEYXRhPy5uYW1lIHx8IGtleS5yZXBsYWNlKC9fL2csICcgJyksXG4gICAgICBjYXRlZ29yeTogdmFsdWVEYXRhPy5jYXRlZ29yeSB8fCAnaW5ncmVkaWVudCcsXG4gICAgICBlbGVtZW50YWxQcm9wZXJ0aWVzLFxuICAgICAgYXN0cm9sb2dpY2FsUHJvZmlsZTogYXN0cm9Qcm9maWxlLFxuICAgIH07XG5cbiAgICByZXR1cm4gYWNjO1xuICB9LCB7fSk7XG59XG5cbnR5cGUgRWxlbWVudGFsUmVsYXRpb25zaGlwID1cbiAgfCAnZ2VuZXJhdGluZydcbiAgfCAnY29udHJvbGxpbmcnXG4gIHwgJ3NhbWUnXG4gIHwgJ2NvbnRyb2xsZWQtYnknXG4gIHwgJ3dlYWtlbmVkLWJ5J1xuICB8ICduZXV0cmFsJztcblxuLyoqXG4gKiBDYWxjdWxhdGUgdGhlIGFmZmluaXR5IGJldHdlZW4gdHdvIGVsZW1lbnRzIGJhc2VkIG9uIHRoZSBGaXZlIEVsZW1lbnRzIHRoZW9yeVxuICogUmV0dXJucyBhIHZhbHVlIGJldHdlZW4gMCBhbmQgMSwgd2hlcmU6XG4gKiAtIDEuMDogU2FtZSBlbGVtZW50IChwZXJmZWN0IGFmZmluaXR5KVxuICogLSAwLjg6IEVsZW1lbnQgaXMgZ2VuZXJhdGVkIGJ5IChjaGlsZCBvZikgdGhlIG90aGVyXG4gKiAtIDAuNjogRWxlbWVudCBnZW5lcmF0ZXMgKHBhcmVudCBvZikgdGhlIG90aGVyXG4gKiAtIDAuNDogTmV1dHJhbCByZWxhdGlvbnNoaXBcbiAqIC0gMC4yOiBFbGVtZW50IGlzIGNvbnRyb2xsZWQgYnkgdGhlIG90aGVyXG4gKiAtIDAuMDogRWxlbWVudCBjb250cm9scyB0aGUgb3RoZXIgKHdlYWtlc3QgYWZmaW5pdHkpXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjYWxjdWxhdGVFbGVtZW50YWxBZmZpbml0eShcbiAgZWxlbWVudDE6IEVsZW1lbnQsXG4gIGVsZW1lbnQyOiBFbGVtZW50XG4pOiBudW1iZXIge1xuICBjb25zdCByZWxhdGlvbnNoaXAgPSBnZXRFbGVtZW50YWxSZWxhdGlvbnNoaXAoZWxlbWVudDEsIGVsZW1lbnQyKTtcblxuICBzd2l0Y2ggKHJlbGF0aW9uc2hpcCkge1xuICAgIGNhc2UgJ3NhbWUnOlxuICAgICAgcmV0dXJuIDEuMDtcbiAgICBjYXNlICdnZW5lcmF0aW5nJzpcbiAgICAgIHJldHVybiAwLjg7XG4gICAgY2FzZSAnY29udHJvbGxlZC1ieSc6XG4gICAgICByZXR1cm4gMC42O1xuICAgIGNhc2UgJ25ldXRyYWwnOlxuICAgICAgcmV0dXJuIDAuNDtcbiAgICBjYXNlICd3ZWFrZW5lZC1ieSc6XG4gICAgICByZXR1cm4gMC4yO1xuICAgIGNhc2UgJ2NvbnRyb2xsaW5nJzpcbiAgICAgIHJldHVybiAwLjA7XG4gICAgZGVmYXVsdDpcbiAgICAgIHJldHVybiAwLjQ7XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==