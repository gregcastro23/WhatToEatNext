6e97b4f6678b5ac4f15977f769458363
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
// Mock the dependencies
jest.mock('../BuildPerformanceMonitor', () => ({
    buildPerformanceMonitor: {
        subscribe: jest.fn(),
        getPerformanceSummary: jest.fn(() => ({
            averageBuildTime: 45000,
            averageCompilationTime: 30000,
            averageBundleSize: 3 * 1024 * 1024,
            averageMemoryUsage: 256 * 1024 * 1024,
            cacheEfficiency: 85,
            performanceScore: 75,
        })),
    },
}));
jest.mock('../ErrorTrackingSystem', () => ({
    errorTrackingSystem: {
        subscribe: jest.fn(),
        getErrorSummary: jest.fn(() => ({
            totalActiveErrors: 150,
            totalActiveLintViolations: 300,
            totalRecentFailures: 2,
            criticalIssues: 5,
            automationOpportunities: 10,
        })),
        getCurrentQualityMetrics: jest.fn(() => ({
            codeQualityScore: 75,
            technicalDebtScore: 45,
            maintainabilityIndex: 80,
            errorRate: 0.05,
            warningRate: 0.1,
        })),
    },
}));
jest.mock('../QualityMetricsService', () => ({
    qualityMetricsService: {
        subscribe: jest.fn(),
    },
}));
const AlertingSystem_1 = __importDefault(require("../AlertingSystem"));
describe('AlertingSystem', () => {
    let alertingSystem;
    let mockSubscriber;
    beforeEach(() => {
        // Clear all mocks
        jest.clearAllMocks();
        // Create a new instance for each test
        alertingSystem = new AlertingSystem_1.default();
        // Reset the instance to ensure clean state
        alertingSystem.reset();
        // Mock subscriber
        mockSubscriber = jest.fn();
        alertingSystem.subscribe(mockSubscriber);
    });
    afterEach(() => {
        if (alertingSystem) {
            alertingSystem.reset();
        }
    });
    describe('Alert Rule Management', () => {
        test('should add new alert rule', () => {
            const rule = {
                name: 'Test Rule',
                description: 'Test alert rule',
                type: 'performance',
                metric: 'build_time',
                condition: 'greater_than',
                threshold: 60000,
                severity: 'warning',
                enabled: true,
                cooldownMinutes: 10,
                escalationMinutes: 30,
                autoResponse: false,
                responseActions: [],
                notificationChannels: ['console'],
            };
            const ruleId = alertingSystem.addAlertRule(rule);
            expect(ruleId).toBeDefined();
            expect(ruleId).toMatch(/^rule-\d+$/);
            const rules = alertingSystem.getAlertRules();
            const addedRule = rules.find(r => r.id === ruleId);
            expect(addedRule).toBeDefined();
            expect(addedRule === null || addedRule === void 0 ? void 0 : addedRule.name).toBe('Test Rule');
        });
        test('should update existing alert rule', () => {
            const rule = {
                name: 'Test Rule',
                description: 'Test alert rule',
                type: 'performance',
                metric: 'build_time',
                condition: 'greater_than',
                threshold: 60000,
                severity: 'warning',
                enabled: true,
                cooldownMinutes: 10,
                escalationMinutes: 30,
                autoResponse: false,
                responseActions: [],
                notificationChannels: ['console'],
            };
            const ruleId = alertingSystem.addAlertRule(rule);
            const updated = alertingSystem.updateAlertRule(ruleId, {
                threshold: 90000,
                severity: 'error',
            });
            expect(updated).toBe(true);
            const rules = alertingSystem.getAlertRules();
            const updatedRule = rules.find(r => r.id === ruleId);
            expect(updatedRule === null || updatedRule === void 0 ? void 0 : updatedRule.threshold).toBe(90000);
            expect(updatedRule === null || updatedRule === void 0 ? void 0 : updatedRule.severity).toBe('error');
        });
        test('should delete alert rule', () => {
            const rule = {
                name: 'Test Rule',
                description: 'Test alert rule',
                type: 'performance',
                metric: 'build_time',
                condition: 'greater_than',
                threshold: 60000,
                severity: 'warning',
                enabled: true,
                cooldownMinutes: 10,
                escalationMinutes: 30,
                autoResponse: false,
                responseActions: [],
                notificationChannels: ['console'],
            };
            const ruleId = alertingSystem.addAlertRule(rule);
            const deleted = alertingSystem.deleteAlertRule(ruleId);
            expect(deleted).toBe(true);
            const rules = alertingSystem.getAlertRules();
            const deletedRule = rules.find(r => r.id === ruleId);
            expect(deletedRule).toBeUndefined();
        });
    });
    describe('Alert Generation', () => {
        test('should create alert when threshold is exceeded', () => {
            // Add a rule that should trigger based on mocked data
            const ruleId = alertingSystem.addAlertRule({
                name: 'High Error Count',
                description: 'Too many TypeScript errors',
                type: 'error',
                metric: 'typescript_errors',
                condition: 'greater_than',
                threshold: 100,
                severity: 'warning',
                enabled: true,
                cooldownMinutes: 5,
                escalationMinutes: 15,
                autoResponse: false,
                responseActions: [],
                notificationChannels: ['console'],
            });
            // Manually trigger rule evaluation (in real system this happens automatically)
            const rule = alertingSystem.getAlertRules().find(r => r.id === ruleId);
            if (rule) {
                alertingSystem.evaluateRule(rule);
            }
            // Check if alert was created
            const alerts = alertingSystem.getAlerts({ resolved: false });
            expect(alerts.length).toBeGreaterThan(0);
            const alert = alerts.find(a => a.title === 'High Error Count');
            expect(alert).toBeDefined();
            expect(alert === null || alert === void 0 ? void 0 : alert.currentValue).toBe(150);
            expect(alert === null || alert === void 0 ? void 0 : alert.threshold).toBe(100);
            expect(alert === null || alert === void 0 ? void 0 : alert.severity).toBe('warning');
        });
        test('should not create alert when threshold is not exceeded', () => {
            // Add a rule that should NOT trigger based on mocked data
            const ruleId = alertingSystem.addAlertRule({
                name: 'Very High Error Count',
                description: 'Extremely high TypeScript errors',
                type: 'error',
                metric: 'typescript_errors',
                condition: 'greater_than',
                threshold: 1000,
                severity: 'critical',
                enabled: true,
                cooldownMinutes: 5,
                escalationMinutes: 15,
                autoResponse: false,
                responseActions: [],
                notificationChannels: ['console'],
            });
            // Manually trigger rule evaluation
            const rule = alertingSystem.getAlertRules().find(r => r.id === ruleId);
            if (rule) {
                alertingSystem.evaluateRule(rule);
            }
            // Check that no alert was created for this rule
            const alerts = alertingSystem.getAlerts({ resolved: false });
            const alert = alerts.find(a => a.title === 'Very High Error Count');
            expect(alert).toBeUndefined();
        });
        test('should respect cooldown period', () => {
            const ruleId = alertingSystem.addAlertRule({
                name: 'Cooldown Test',
                description: 'Test cooldown functionality',
                type: 'error',
                metric: 'typescript_errors',
                condition: 'greater_than',
                threshold: 100,
                severity: 'warning',
                enabled: true,
                cooldownMinutes: 0.01,
                escalationMinutes: 120,
                autoResponse: false,
                responseActions: [],
                notificationChannels: ['console'],
            });
            const rule = alertingSystem.getAlertRules().find(r => r.id === ruleId);
            if (rule) {
                // First evaluation should create alert
                alertingSystem.evaluateRule(rule);
                // Second evaluation should be blocked by cooldown (immediate)
                alertingSystem.evaluateRule(rule);
            }
            // Should only have one alert despite two evaluations
            const alerts = alertingSystem.getAlerts({ resolved: false });
            const cooldownAlerts = alerts.filter(a => a.title === 'Cooldown Test');
            expect(cooldownAlerts.length).toBe(1);
        });
    });
    describe('Alert Management', () => {
        test('should acknowledge alert', () => {
            // Create an alert first
            const ruleId = alertingSystem.addAlertRule({
                name: 'Test Alert',
                description: 'Test alert for acknowledgment',
                type: 'error',
                metric: 'typescript_errors',
                condition: 'greater_than',
                threshold: 100,
                severity: 'warning',
                enabled: true,
                cooldownMinutes: 5,
                escalationMinutes: 15,
                autoResponse: false,
                responseActions: [],
                notificationChannels: ['console'],
            });
            const rule = alertingSystem.getAlertRules().find(r => r.id === ruleId);
            if (rule) {
                alertingSystem.evaluateRule(rule);
            }
            const alerts = alertingSystem.getAlerts({ resolved: false });
            const alert = alerts.find(a => a.title === 'Test Alert');
            expect(alert).toBeDefined();
            expect(alert === null || alert === void 0 ? void 0 : alert.acknowledged).toBe(false);
            // Acknowledge the alert
            const acknowledged = alertingSystem.acknowledgeAlert(alert.id);
            expect(acknowledged).toBe(true);
            // Check that alert is now acknowledged
            const updatedAlerts = alertingSystem.getAlerts({ resolved: false });
            const acknowledgedAlert = updatedAlerts.find(a => a.id === alert.id);
            expect(acknowledgedAlert === null || acknowledgedAlert === void 0 ? void 0 : acknowledgedAlert.acknowledged).toBe(true);
        });
        test('should resolve alert', () => {
            // Create an alert first
            const ruleId = alertingSystem.addAlertRule({
                name: 'Test Alert',
                description: 'Test alert for resolution',
                type: 'error',
                metric: 'typescript_errors',
                condition: 'greater_than',
                threshold: 100,
                severity: 'warning',
                enabled: true,
                cooldownMinutes: 5,
                escalationMinutes: 15,
                autoResponse: false,
                responseActions: [],
                notificationChannels: ['console'],
            });
            const rule = alertingSystem.getAlertRules().find(r => r.id === ruleId);
            if (rule) {
                alertingSystem.evaluateRule(rule);
            }
            const alerts = alertingSystem.getAlerts({ resolved: false });
            const alert = alerts.find(a => a.title === 'Test Alert');
            expect(alert).toBeDefined();
            expect(alert === null || alert === void 0 ? void 0 : alert.resolved).toBe(false);
            // Resolve the alert
            const resolved = alertingSystem.resolveAlert(alert.id);
            expect(resolved).toBe(true);
            // Check that alert is now resolved
            const unresolvedAlerts = alertingSystem.getAlerts({ resolved: false });
            const unresolvedAlert = unresolvedAlerts.find(a => a.id === alert.id);
            expect(unresolvedAlert).toBeUndefined();
            const resolvedAlerts = alertingSystem.getAlerts({ resolved: true });
            const resolvedAlert = resolvedAlerts.find(a => a.id === alert.id);
            expect(resolvedAlert === null || resolvedAlert === void 0 ? void 0 : resolvedAlert.resolved).toBe(true);
            expect(resolvedAlert === null || resolvedAlert === void 0 ? void 0 : resolvedAlert.resolvedAt).toBeDefined();
        });
    });
    describe('Alert Filtering', () => {
        beforeEach(() => {
            // Create multiple alerts for testing
            const rules = [
                {
                    name: 'Performance Alert',
                    type: 'performance',
                    severity: 'warning',
                    metric: 'build_time',
                    threshold: 30000,
                },
                {
                    name: 'Error Alert',
                    type: 'error',
                    severity: 'error',
                    metric: 'typescript_errors',
                    threshold: 100,
                },
                {
                    name: 'Critical Quality Alert',
                    type: 'quality',
                    severity: 'critical',
                    metric: 'code_quality_score',
                    threshold: 80, // Mock returns 75, so this should trigger with less_than condition
                },
            ];
            for (const ruleConfig of rules) {
                const ruleId = alertingSystem.addAlertRule({
                    ...ruleConfig,
                    description: `Test ${ruleConfig.name}`,
                    condition: ruleConfig.type === 'quality' ? 'less_than' : 'greater_than',
                    enabled: true,
                    cooldownMinutes: 5,
                    escalationMinutes: 15,
                    autoResponse: false,
                    responseActions: [],
                    notificationChannels: ['console'],
                });
                const rule = alertingSystem.getAlertRules().find(r => r.id === ruleId);
                if (rule) {
                    alertingSystem.evaluateRule(rule);
                }
            }
        });
        test('should filter alerts by type', () => {
            const performanceAlerts = alertingSystem.getAlerts({
                type: 'performance',
            });
            expect(performanceAlerts.length).toBe(1);
            expect(performanceAlerts[0].type).toBe('performance');
            const errorAlerts = alertingSystem.getAlerts({ type: 'error' });
            expect(errorAlerts.length).toBe(1);
            expect(errorAlerts[0].type).toBe('error');
        });
        test('should filter alerts by severity', () => {
            const criticalAlerts = alertingSystem.getAlerts({ severity: 'critical' });
            expect(criticalAlerts.length).toBe(1);
            expect(criticalAlerts[0].severity).toBe('critical');
            const warningAlerts = alertingSystem.getAlerts({ severity: 'warning' });
            expect(warningAlerts.length).toBe(1);
            expect(warningAlerts[0].severity).toBe('warning');
        });
        test('should limit number of alerts returned', () => {
            const limitedAlerts = alertingSystem.getAlerts({ limit: 2 });
            expect(limitedAlerts.length).toBe(2);
        });
    });
    describe('Alert Summary', () => {
        test('should provide accurate alert summary', () => {
            // Create some test alerts
            const ruleId = alertingSystem.addAlertRule({
                name: 'Summary Test Alert',
                description: 'Test alert for summary',
                type: 'error',
                metric: 'typescript_errors',
                condition: 'greater_than',
                threshold: 100,
                severity: 'critical',
                enabled: true,
                cooldownMinutes: 5,
                escalationMinutes: 15,
                autoResponse: false,
                responseActions: [],
                notificationChannels: ['console'],
            });
            const rule = alertingSystem.getAlertRules().find(r => r.id === ruleId);
            if (rule) {
                alertingSystem.evaluateRule(rule);
            }
            const summary = alertingSystem.getAlertSummary();
            expect(summary.totalAlerts).toBeGreaterThan(0);
            expect(summary.unresolvedAlerts).toBeGreaterThan(0);
            expect(summary.criticalAlerts).toBeGreaterThan(0);
            expect(summary.alertsByType).toBeDefined();
            expect(summary.alertsBySeverity).toBeDefined();
            expect(typeof summary.responseSuccessRate).toBe('number');
            expect(typeof summary.averageResolutionTime).toBe('number');
        });
    });
    describe('Test Alert Functionality', () => {
        test('should create test alert', () => {
            const ruleId = alertingSystem.addAlertRule({
                name: 'Test Rule for Testing',
                description: 'Rule to test alert creation',
                type: 'performance',
                metric: 'build_time',
                condition: 'greater_than',
                threshold: 60000,
                severity: 'warning',
                enabled: true,
                cooldownMinutes: 5,
                escalationMinutes: 15,
                autoResponse: false,
                responseActions: [],
                notificationChannels: ['console'],
            });
            const testResult = alertingSystem.testAlert(ruleId);
            expect(testResult).toBe(true);
            // Check that test alert was created
            const alerts = alertingSystem.getAlerts({ resolved: false });
            const testAlert = alerts.find(a => a.title === 'Test Rule for Testing');
            expect(testAlert).toBeDefined();
            expect(testAlert === null || testAlert === void 0 ? void 0 : testAlert.currentValue).toBe(60001); // threshold + 1
        });
        test('should return false for non-existent rule', () => {
            const testResult = alertingSystem.testAlert('non-existent-rule');
            expect(testResult).toBe(false);
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9zZXJ2aWNlcy9fX3Rlc3RzX18vQWxlcnRpbmdTeXN0ZW0udGVzdC50cyIsIm1hcHBpbmdzIjoiOzs7OztBQUVBLHdCQUF3QjtBQUN4QixJQUFJLENBQUMsSUFBSSxDQUFDLDRCQUE0QixFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDN0MsdUJBQXVCLEVBQUU7UUFDdkIsU0FBUyxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7UUFDcEIscUJBQXFCLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDO1lBQ3BDLGdCQUFnQixFQUFFLEtBQUs7WUFDdkIsc0JBQXNCLEVBQUUsS0FBSztZQUM3QixpQkFBaUIsRUFBRSxDQUFDLEdBQUcsSUFBSSxHQUFHLElBQUk7WUFDbEMsa0JBQWtCLEVBQUUsR0FBRyxHQUFHLElBQUksR0FBRyxJQUFJO1lBQ3JDLGVBQWUsRUFBRSxFQUFFO1lBQ25CLGdCQUFnQixFQUFFLEVBQUU7U0FDckIsQ0FBQyxDQUFDO0tBQ0o7Q0FDRixDQUFDLENBQUMsQ0FBQztBQUVKLElBQUksQ0FBQyxJQUFJLENBQUMsd0JBQXdCLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUN6QyxtQkFBbUIsRUFBRTtRQUNuQixTQUFTLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtRQUNwQixlQUFlLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDO1lBQzlCLGlCQUFpQixFQUFFLEdBQUc7WUFDdEIseUJBQXlCLEVBQUUsR0FBRztZQUM5QixtQkFBbUIsRUFBRSxDQUFDO1lBQ3RCLGNBQWMsRUFBRSxDQUFDO1lBQ2pCLHVCQUF1QixFQUFFLEVBQUU7U0FDNUIsQ0FBQyxDQUFDO1FBQ0gsd0JBQXdCLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDO1lBQ3ZDLGdCQUFnQixFQUFFLEVBQUU7WUFDcEIsa0JBQWtC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QUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsS0FBSyxLQUFLLHVCQUF1QixDQUFDLENBQUM7WUFDeEUsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQ2hDLE1BQU0sQ0FBQyxTQUFTLGFBQVQsU0FBUyx1QkFBVCxTQUFTLENBQUUsWUFBWSxDQUFDLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsZ0JBQWdCO1FBQy9ELENBQUMsQ0FBQyxDQUFDO1FBRUgsSUFBSSxDQUFDLDJDQUEyQyxFQUFFLEdBQUcsRUFBRTtZQUNyRCxNQUFNLFVBQVUsR0FBRyxjQUFjLENBQUMsU0FBUyxDQUFDLG1CQUFtQixDQUFDLENBQUM7WUFDakUsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNqQyxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUMsQ0FBQyxDQUFDO0FBQ0wsQ0FBQyxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9zZXJ2aWNlcy9fX3Rlc3RzX18vQWxlcnRpbmdTeXN0ZW0udGVzdC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgQWxlcnRpbmdTeXN0ZW0sIHsgQWxlcnQsIEFsZXJ0UnVsZSB9IGZyb20gJy4uL0FsZXJ0aW5nU3lzdGVtJztcblxuLy8gTW9jayB0aGUgZGVwZW5kZW5jaWVzXG5qZXN0Lm1vY2soJy4uL0J1aWxkUGVyZm9ybWFuY2VNb25pdG9yJywgKCkgPT4gKHtcbiAgYnVpbGRQZXJmb3JtYW5jZU1vbml0b3I6IHtcbiAgICBzdWJzY3JpYmU6IGplc3QuZm4oKSxcbiAgICBnZXRQZXJmb3JtYW5jZVN1bW1hcnk6IGplc3QuZm4oKCkgPT4gKHtcbiAgICAgIGF2ZXJhZ2VCdWlsZFRpbWU6IDQ1MDAwLFxuICAgICAgYXZlcmFnZUNvbXBpbGF0aW9uVGltZTogMzAwMDAsXG4gICAgICBhdmVyYWdlQnVuZGxlU2l6ZTogMyAqIDEwMjQgKiAxMDI0LFxuICAgICAgYXZlcmFnZU1lbW9yeVVzYWdlOiAyNTYgKiAxMDI0ICogMTAyNCxcbiAgICAgIGNhY2hlRWZmaWNpZW5jeTogODUsXG4gICAgICBwZXJmb3JtYW5jZVNjb3JlOiA3NSxcbiAgICB9KSksXG4gIH0sXG59KSk7XG5cbmplc3QubW9jaygnLi4vRXJyb3JUcmFja2luZ1N5c3RlbScsICgpID0+ICh7XG4gIGVycm9yVHJhY2tpbmdTeXN0ZW06IHtcbiAgICBzdWJzY3JpYmU6IGplc3QuZm4oKSxcbiAgICBnZXRFcnJvclN1bW1hcnk6IGplc3QuZm4oKCkgPT4gKHtcbiAgICAgIHRvdGFsQWN0aXZlRXJyb3JzOiAxNTAsXG4gICAgICB0b3RhbEFjdGl2ZUxpbnRWaW9sYXRpb25zOiAzMDAsXG4gICAgICB0b3RhbFJlY2VudEZhaWx1cmVzOiAyLFxuICAgICAgY3JpdGljYWxJc3N1ZXM6IDUsXG4gICAgICBhdXRvbWF0aW9uT3Bwb3J0dW5pdGllczogMTAsXG4gICAgfSkpLFxuICAgIGdldEN1cnJlbnRRdWFsaXR5TWV0cmljczogamVzdC5mbigoKSA9PiAoe1xuICAgICAgY29kZVF1YWxpdHlTY29yZTogNzUsXG4gICAgICB0ZWNobmljYWxEZWJ0U2NvcmU6IDQ1LFxuICAgICAgbWFpbnRhaW5hYmlsaXR5SW5kZXg6IDgwLFxuICAgICAgZXJyb3JSYXRlOiAwLjA1LFxuICAgICAgd2FybmluZ1JhdGU6IDAuMSxcbiAgICB9KSksXG4gIH0sXG59KSk7XG5cbmplc3QubW9jaygnLi4vUXVhbGl0eU1ldHJpY3NTZXJ2aWNlJywgKCkgPT4gKHtcbiAgcXVhbGl0eU1ldHJpY3NTZXJ2aWNlOiB7XG4gICAgc3Vic2NyaWJlOiBqZXN0LmZuKCksXG4gIH0sXG59KSk7XG5cbmRlc2NyaWJlKCdBbGVydGluZ1N5c3RlbScsICgpID0+IHtcbiAgbGV0IGFsZXJ0aW5nU3lzdGVtOiBBbGVydGluZ1N5c3RlbTtcbiAgbGV0IG1vY2tTdWJzY3JpYmVyOiBqZXN0Lk1vY2s7XG5cbiAgYmVmb3JlRWFjaCgoKSA9PiB7XG4gICAgLy8gQ2xlYXIgYWxsIG1vY2tzXG4gICAgamVzdC5jbGVhckFsbE1vY2tzKCk7XG5cbiAgICAvLyBDcmVhdGUgYSBuZXcgaW5zdGFuY2UgZm9yIGVhY2ggdGVzdFxuICAgIGFsZXJ0aW5nU3lzdGVtID0gbmV3IChBbGVydGluZ1N5c3RlbSBhcyBhbnkpKCk7XG5cbiAgICAvLyBSZXNldCB0aGUgaW5zdGFuY2UgdG8gZW5zdXJlIGNsZWFuIHN0YXRlXG4gICAgYWxlcnRpbmdTeXN0ZW0ucmVzZXQoKTtcblxuICAgIC8vIE1vY2sgc3Vic2NyaWJlclxuICAgIG1vY2tTdWJzY3JpYmVyID0gamVzdC5mbigpO1xuICAgIGFsZXJ0aW5nU3lzdGVtLnN1YnNjcmliZShtb2NrU3Vic2NyaWJlcik7XG4gIH0pO1xuXG4gIGFmdGVyRWFjaCgoKSA9PiB7XG4gICAgaWYgKGFsZXJ0aW5nU3lzdGVtKSB7XG4gICAgICBhbGVydGluZ1N5c3RlbS5yZXNldCgpO1xuICAgIH1cbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0FsZXJ0IFJ1bGUgTWFuYWdlbWVudCcsICgpID0+IHtcbiAgICB0ZXN0KCdzaG91bGQgYWRkIG5ldyBhbGVydCBydWxlJywgKCkgPT4ge1xuICAgICAgY29uc3QgcnVsZTogT21pdDxBbGVydFJ1bGUsICdpZCc+ID0ge1xuICAgICAgICBuYW1lOiAnVGVzdCBSdWxlJyxcbiAgICAgICAgZGVzY3JpcHRpb246ICdUZXN0IGFsZXJ0IHJ1bGUnLFxuICAgICAgICB0eXBlOiAncGVyZm9ybWFuY2UnLFxuICAgICAgICBtZXRyaWM6ICdidWlsZF90aW1lJyxcbiAgICAgICAgY29uZGl0aW9uOiAnZ3JlYXRlcl90aGFuJyxcbiAgICAgICAgdGhyZXNob2xkOiA2MDAwMCxcbiAgICAgICAgc2V2ZXJpdHk6ICd3YXJuaW5nJyxcbiAgICAgICAgZW5hYmxlZDogdHJ1ZSxcbiAgICAgICAgY29vbGRvd25NaW51dGVzOiAxMCxcbiAgICAgICAgZXNjYWxhdGlvbk1pbnV0ZXM6IDMwLFxuICAgICAgICBhdXRvUmVzcG9uc2U6IGZhbHNlLFxuICAgICAgICByZXNwb25zZUFjdGlvbnM6IFtdLFxuICAgICAgICBub3RpZmljYXRpb25DaGFubmVsczogWydjb25zb2xlJ10sXG4gICAgICB9O1xuXG4gICAgICBjb25zdCBydWxlSWQgPSBhbGVydGluZ1N5c3RlbS5hZGRBbGVydFJ1bGUocnVsZSk7XG4gICAgICBleHBlY3QocnVsZUlkKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHJ1bGVJZCkudG9NYXRjaCgvXnJ1bGUtXFxkKyQvKTtcblxuICAgICAgY29uc3QgcnVsZXMgPSBhbGVydGluZ1N5c3RlbS5nZXRBbGVydFJ1bGVzKCk7XG4gICAgICBjb25zdCBhZGRlZFJ1bGUgPSBydWxlcy5maW5kKHIgPT4gci5pZCA9PT0gcnVsZUlkKTtcbiAgICAgIGV4cGVjdChhZGRlZFJ1bGUpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QoYWRkZWRSdWxlPy5uYW1lKS50b0JlKCdUZXN0IFJ1bGUnKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCB1cGRhdGUgZXhpc3RpbmcgYWxlcnQgcnVsZScsICgpID0+IHtcbiAgICAgIGNvbnN0IHJ1bGU6IE9taXQ8QWxlcnRSdWxlLCAnaWQnPiA9IHtcbiAgICAgICAgbmFtZTogJ1Rlc3QgUnVsZScsXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnVGVzdCBhbGVydCBydWxlJyxcbiAgICAgICAgdHlwZTogJ3BlcmZvcm1hbmNlJyxcbiAgICAgICAgbWV0cmljOiAnYnVpbGRfdGltZScsXG4gICAgICAgIGNvbmRpdGlvbjogJ2dyZWF0ZXJfdGhhbicsXG4gICAgICAgIHRocmVzaG9sZDogNjAwMDAsXG4gICAgICAgIHNldmVyaXR5OiAnd2FybmluZycsXG4gICAgICAgIGVuYWJsZWQ6IHRydWUsXG4gICAgICAgIGNvb2xkb3duTWludXRlczogMTAsXG4gICAgICAgIGVzY2FsYXRpb25NaW51dGVzOiAzMCxcbiAgICAgICAgYXV0b1Jlc3BvbnNlOiBmYWxzZSxcbiAgICAgICAgcmVzcG9uc2VBY3Rpb25zOiBbXSxcbiAgICAgICAgbm90aWZpY2F0aW9uQ2hhbm5lbHM6IFsnY29uc29sZSddLFxuICAgICAgfTtcblxuICAgICAgY29uc3QgcnVsZUlkID0gYWxlcnRpbmdTeXN0ZW0uYWRkQWxlcnRSdWxlKHJ1bGUpO1xuICAgICAgY29uc3QgdXBkYXRlZCA9IGFsZXJ0aW5nU3lzdGVtLnVwZGF0ZUFsZXJ0UnVsZShydWxlSWQsIHtcbiAgICAgICAgdGhyZXNob2xkOiA5MDAwMCxcbiAgICAgICAgc2V2ZXJpdHk6ICdlcnJvcicsXG4gICAgICB9KTtcblxuICAgICAgZXhwZWN0KHVwZGF0ZWQpLnRvQmUodHJ1ZSk7XG5cbiAgICAgIGNvbnN0IHJ1bGVzID0gYWxlcnRpbmdTeXN0ZW0uZ2V0QWxlcnRSdWxlcygpO1xuICAgICAgY29uc3QgdXBkYXRlZFJ1bGUgPSBydWxlcy5maW5kKHIgPT4gci5pZCA9PT0gcnVsZUlkKTtcbiAgICAgIGV4cGVjdCh1cGRhdGVkUnVsZT8udGhyZXNob2xkKS50b0JlKDkwMDAwKTtcbiAgICAgIGV4cGVjdCh1cGRhdGVkUnVsZT8uc2V2ZXJpdHkpLnRvQmUoJ2Vycm9yJyk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgZGVsZXRlIGFsZXJ0IHJ1bGUnLCAoKSA9PiB7XG4gICAgICBjb25zdCBydWxlOiBPbWl0PEFsZXJ0UnVsZSwgJ2lkJz4gPSB7XG4gICAgICAgIG5hbWU6ICdUZXN0IFJ1bGUnLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ1Rlc3QgYWxlcnQgcnVsZScsXG4gICAgICAgIHR5cGU6ICdwZXJmb3JtYW5jZScsXG4gICAgICAgIG1ldHJpYzogJ2J1aWxkX3RpbWUnLFxuICAgICAgICBjb25kaXRpb246ICdncmVhdGVyX3RoYW4nLFxuICAgICAgICB0aHJlc2hvbGQ6IDYwMDAwLFxuICAgICAgICBzZXZlcml0eTogJ3dhcm5pbmcnLFxuICAgICAgICBlbmFibGVkOiB0cnVlLFxuICAgICAgICBjb29sZG93bk1pbnV0ZXM6IDEwLFxuICAgICAgICBlc2NhbGF0aW9uTWludXRlczogMzAsXG4gICAgICAgIGF1dG9SZXNwb25zZTogZmFsc2UsXG4gICAgICAgIHJlc3BvbnNlQWN0aW9uczogW10sXG4gICAgICAgIG5vdGlmaWNhdGlvbkNoYW5uZWxzOiBbJ2NvbnNvbGUnXSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHJ1bGVJZCA9IGFsZXJ0aW5nU3lzdGVtLmFkZEFsZXJ0UnVsZShydWxlKTtcbiAgICAgIGNvbnN0IGRlbGV0ZWQgPSBhbGVydGluZ1N5c3RlbS5kZWxldGVBbGVydFJ1bGUocnVsZUlkKTtcblxuICAgICAgZXhwZWN0KGRlbGV0ZWQpLnRvQmUodHJ1ZSk7XG5cbiAgICAgIGNvbnN0IHJ1bGVzID0gYWxlcnRpbmdTeXN0ZW0uZ2V0QWxlcnRSdWxlcygpO1xuICAgICAgY29uc3QgZGVsZXRlZFJ1bGUgPSBydWxlcy5maW5kKHIgPT4gci5pZCA9PT0gcnVsZUlkKTtcbiAgICAgIGV4cGVjdChkZWxldGVkUnVsZSkudG9CZVVuZGVmaW5lZCgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnQWxlcnQgR2VuZXJhdGlvbicsICgpID0+IHtcbiAgICB0ZXN0KCdzaG91bGQgY3JlYXRlIGFsZXJ0IHdoZW4gdGhyZXNob2xkIGlzIGV4Y2VlZGVkJywgKCkgPT4ge1xuICAgICAgLy8gQWRkIGEgcnVsZSB0aGF0IHNob3VsZCB0cmlnZ2VyIGJhc2VkIG9uIG1vY2tlZCBkYXRhXG4gICAgICBjb25zdCBydWxlSWQgPSBhbGVydGluZ1N5c3RlbS5hZGRBbGVydFJ1bGUoe1xuICAgICAgICBuYW1lOiAnSGlnaCBFcnJvciBDb3VudCcsXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnVG9vIG1hbnkgVHlwZVNjcmlwdCBlcnJvcnMnLFxuICAgICAgICB0eXBlOiAnZXJyb3InLFxuICAgICAgICBtZXRyaWM6ICd0eXBlc2NyaXB0X2Vycm9ycycsXG4gICAgICAgIGNvbmRpdGlvbjogJ2dyZWF0ZXJfdGhhbicsXG4gICAgICAgIHRocmVzaG9sZDogMTAwLCAvLyBNb2NrIHJldHVybnMgMTUwLCBzbyB0aGlzIHNob3VsZCB0cmlnZ2VyXG4gICAgICAgIHNldmVyaXR5OiAnd2FybmluZycsXG4gICAgICAgIGVuYWJsZWQ6IHRydWUsXG4gICAgICAgIGNvb2xkb3duTWludXRlczogNSxcbiAgICAgICAgZXNjYWxhdGlvbk1pbnV0ZXM6IDE1LFxuICAgICAgICBhdXRvUmVzcG9uc2U6IGZhbHNlLFxuICAgICAgICByZXNwb25zZUFjdGlvbnM6IFtdLFxuICAgICAgICBub3RpZmljYXRpb25DaGFubmVsczogWydjb25zb2xlJ10sXG4gICAgICB9KTtcblxuICAgICAgLy8gTWFudWFsbHkgdHJpZ2dlciBydWxlIGV2YWx1YXRpb24gKGluIHJlYWwgc3lzdGVtIHRoaXMgaGFwcGVucyBhdXRvbWF0aWNhbGx5KVxuICAgICAgY29uc3QgcnVsZSA9IGFsZXJ0aW5nU3lzdGVtLmdldEFsZXJ0UnVsZXMoKS5maW5kKHIgPT4gci5pZCA9PT0gcnVsZUlkKTtcbiAgICAgIGlmIChydWxlKSB7XG4gICAgICAgIChhbGVydGluZ1N5c3RlbSBhcyBhbnkpLmV2YWx1YXRlUnVsZShydWxlKTtcbiAgICAgIH1cblxuICAgICAgLy8gQ2hlY2sgaWYgYWxlcnQgd2FzIGNyZWF0ZWRcbiAgICAgIGNvbnN0IGFsZXJ0cyA9IGFsZXJ0aW5nU3lzdGVtLmdldEFsZXJ0cyh7IHJlc29sdmVkOiBmYWxzZSB9KTtcbiAgICAgIGV4cGVjdChhbGVydHMubGVuZ3RoKS50b0JlR3JlYXRlclRoYW4oMCk7XG5cbiAgICAgIGNvbnN0IGFsZXJ0ID0gYWxlcnRzLmZpbmQoYSA9PiBhLnRpdGxlID09PSAnSGlnaCBFcnJvciBDb3VudCcpO1xuICAgICAgZXhwZWN0KGFsZXJ0KS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KGFsZXJ0Py5jdXJyZW50VmFsdWUpLnRvQmUoMTUwKTtcbiAgICAgIGV4cGVjdChhbGVydD8udGhyZXNob2xkKS50b0JlKDEwMCk7XG4gICAgICBleHBlY3QoYWxlcnQ/LnNldmVyaXR5KS50b0JlKCd3YXJuaW5nJyk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgbm90IGNyZWF0ZSBhbGVydCB3aGVuIHRocmVzaG9sZCBpcyBub3QgZXhjZWVkZWQnLCAoKSA9PiB7XG4gICAgICAvLyBBZGQgYSBydWxlIHRoYXQgc2hvdWxkIE5PVCB0cmlnZ2VyIGJhc2VkIG9uIG1vY2tlZCBkYXRhXG4gICAgICBjb25zdCBydWxlSWQgPSBhbGVydGluZ1N5c3RlbS5hZGRBbGVydFJ1bGUoe1xuICAgICAgICBuYW1lOiAnVmVyeSBIaWdoIEVycm9yIENvdW50JyxcbiAgICAgICAgZGVzY3JpcHRpb246ICdFeHRyZW1lbHkgaGlnaCBUeXBlU2NyaXB0IGVycm9ycycsXG4gICAgICAgIHR5cGU6ICdlcnJvcicsXG4gICAgICAgIG1ldHJpYzogJ3R5cGVzY3JpcHRfZXJyb3JzJyxcbiAgICAgICAgY29uZGl0aW9uOiAnZ3JlYXRlcl90aGFuJyxcbiAgICAgICAgdGhyZXNob2xkOiAxMDAwLCAvLyBNb2NrIHJldHVybnMgMTUwLCBzbyB0aGlzIHNob3VsZCBOT1QgdHJpZ2dlclxuICAgICAgICBzZXZlcml0eTogJ2NyaXRpY2FsJyxcbiAgICAgICAgZW5hYmxlZDogdHJ1ZSxcbiAgICAgICAgY29vbGRvd25NaW51dGVzOiA1LFxuICAgICAgICBlc2NhbGF0aW9uTWludXRlczogMTUsXG4gICAgICAgIGF1dG9SZXNwb25zZTogZmFsc2UsXG4gICAgICAgIHJlc3BvbnNlQWN0aW9uczogW10sXG4gICAgICAgIG5vdGlmaWNhdGlvbkNoYW5uZWxzOiBbJ2NvbnNvbGUnXSxcbiAgICAgIH0pO1xuXG4gICAgICAvLyBNYW51YWxseSB0cmlnZ2VyIHJ1bGUgZXZhbHVhdGlvblxuICAgICAgY29uc3QgcnVsZSA9IGFsZXJ0aW5nU3lzdGVtLmdldEFsZXJ0UnVsZXMoKS5maW5kKHIgPT4gci5pZCA9PT0gcnVsZUlkKTtcbiAgICAgIGlmIChydWxlKSB7XG4gICAgICAgIChhbGVydGluZ1N5c3RlbSBhcyBhbnkpLmV2YWx1YXRlUnVsZShydWxlKTtcbiAgICAgIH1cblxuICAgICAgLy8gQ2hlY2sgdGhhdCBubyBhbGVydCB3YXMgY3JlYXRlZCBmb3IgdGhpcyBydWxlXG4gICAgICBjb25zdCBhbGVydHMgPSBhbGVydGluZ1N5c3RlbS5nZXRBbGVydHMoeyByZXNvbHZlZDogZmFsc2UgfSk7XG4gICAgICBjb25zdCBhbGVydCA9IGFsZXJ0cy5maW5kKGEgPT4gYS50aXRsZSA9PT0gJ1ZlcnkgSGlnaCBFcnJvciBDb3VudCcpO1xuICAgICAgZXhwZWN0KGFsZXJ0KS50b0JlVW5kZWZpbmVkKCk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgcmVzcGVjdCBjb29sZG93biBwZXJpb2QnLCAoKSA9PiB7XG4gICAgICBjb25zdCBydWxlSWQgPSBhbGVydGluZ1N5c3RlbS5hZGRBbGVydFJ1bGUoe1xuICAgICAgICBuYW1lOiAnQ29vbGRvd24gVGVzdCcsXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnVGVzdCBjb29sZG93biBmdW5jdGlvbmFsaXR5JyxcbiAgICAgICAgdHlwZTogJ2Vycm9yJyxcbiAgICAgICAgbWV0cmljOiAndHlwZXNjcmlwdF9lcnJvcnMnLFxuICAgICAgICBjb25kaXRpb246ICdncmVhdGVyX3RoYW4nLFxuICAgICAgICB0aHJlc2hvbGQ6IDEwMCxcbiAgICAgICAgc2V2ZXJpdHk6ICd3YXJuaW5nJyxcbiAgICAgICAgZW5hYmxlZDogdHJ1ZSxcbiAgICAgICAgY29vbGRvd25NaW51dGVzOiAwLjAxLCAvLyBWZXJ5IHNob3J0IGNvb2xkb3duIGZvciB0ZXN0aW5nICgwLjYgc2Vjb25kcylcbiAgICAgICAgZXNjYWxhdGlvbk1pbnV0ZXM6IDEyMCxcbiAgICAgICAgYXV0b1Jlc3BvbnNlOiBmYWxzZSxcbiAgICAgICAgcmVzcG9uc2VBY3Rpb25zOiBbXSxcbiAgICAgICAgbm90aWZpY2F0aW9uQ2hhbm5lbHM6IFsnY29uc29sZSddLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHJ1bGUgPSBhbGVydGluZ1N5c3RlbS5nZXRBbGVydFJ1bGVzKCkuZmluZChyID0+IHIuaWQgPT09IHJ1bGVJZCk7XG4gICAgICBpZiAocnVsZSkge1xuICAgICAgICAvLyBGaXJzdCBldmFsdWF0aW9uIHNob3VsZCBjcmVhdGUgYWxlcnRcbiAgICAgICAgKGFsZXJ0aW5nU3lzdGVtIGFzIGFueSkuZXZhbHVhdGVSdWxlKHJ1bGUpO1xuXG4gICAgICAgIC8vIFNlY29uZCBldmFsdWF0aW9uIHNob3VsZCBiZSBibG9ja2VkIGJ5IGNvb2xkb3duIChpbW1lZGlhdGUpXG4gICAgICAgIChhbGVydGluZ1N5c3RlbSBhcyBhbnkpLmV2YWx1YXRlUnVsZShydWxlKTtcbiAgICAgIH1cblxuICAgICAgLy8gU2hvdWxkIG9ubHkgaGF2ZSBvbmUgYWxlcnQgZGVzcGl0ZSB0d28gZXZhbHVhdGlvbnNcbiAgICAgIGNvbnN0IGFsZXJ0cyA9IGFsZXJ0aW5nU3lzdGVtLmdldEFsZXJ0cyh7IHJlc29sdmVkOiBmYWxzZSB9KTtcbiAgICAgIGNvbnN0IGNvb2xkb3duQWxlcnRzID0gYWxlcnRzLmZpbHRlcihhID0+IGEudGl0bGUgPT09ICdDb29sZG93biBUZXN0Jyk7XG4gICAgICBleHBlY3QoY29vbGRvd25BbGVydHMubGVuZ3RoKS50b0JlKDEpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnQWxlcnQgTWFuYWdlbWVudCcsICgpID0+IHtcbiAgICB0ZXN0KCdzaG91bGQgYWNrbm93bGVkZ2UgYWxlcnQnLCAoKSA9PiB7XG4gICAgICAvLyBDcmVhdGUgYW4gYWxlcnQgZmlyc3RcbiAgICAgIGNvbnN0IHJ1bGVJZCA9IGFsZXJ0aW5nU3lzdGVtLmFkZEFsZXJ0UnVsZSh7XG4gICAgICAgIG5hbWU6ICdUZXN0IEFsZXJ0JyxcbiAgICAgICAgZGVzY3JpcHRpb246ICdUZXN0IGFsZXJ0IGZvciBhY2tub3dsZWRnbWVudCcsXG4gICAgICAgIHR5cGU6ICdlcnJvcicsXG4gICAgICAgIG1ldHJpYzogJ3R5cGVzY3JpcHRfZXJyb3JzJyxcbiAgICAgICAgY29uZGl0aW9uOiAnZ3JlYXRlcl90aGFuJyxcbiAgICAgICAgdGhyZXNob2xkOiAxMDAsXG4gICAgICAgIHNldmVyaXR5OiAnd2FybmluZycsXG4gICAgICAgIGVuYWJsZWQ6IHRydWUsXG4gICAgICAgIGNvb2xkb3duTWludXRlczogNSxcbiAgICAgICAgZXNjYWxhdGlvbk1pbnV0ZXM6IDE1LFxuICAgICAgICBhdXRvUmVzcG9uc2U6IGZhbHNlLFxuICAgICAgICByZXNwb25zZUFjdGlvbnM6IFtdLFxuICAgICAgICBub3RpZmljYXRpb25DaGFubmVsczogWydjb25zb2xlJ10sXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgcnVsZSA9IGFsZXJ0aW5nU3lzdGVtLmdldEFsZXJ0UnVsZXMoKS5maW5kKHIgPT4gci5pZCA9PT0gcnVsZUlkKTtcbiAgICAgIGlmIChydWxlKSB7XG4gICAgICAgIChhbGVydGluZ1N5c3RlbSBhcyBhbnkpLmV2YWx1YXRlUnVsZShydWxlKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgYWxlcnRzID0gYWxlcnRpbmdTeXN0ZW0uZ2V0QWxlcnRzKHsgcmVzb2x2ZWQ6IGZhbHNlIH0pO1xuICAgICAgY29uc3QgYWxlcnQgPSBhbGVydHMuZmluZChhID0+IGEudGl0bGUgPT09ICdUZXN0IEFsZXJ0Jyk7XG4gICAgICBleHBlY3QoYWxlcnQpLnRvQmVEZWZpbmVkKCk7XG4gICAgICBleHBlY3QoYWxlcnQ/LmFja25vd2xlZGdlZCkudG9CZShmYWxzZSk7XG5cbiAgICAgIC8vIEFja25vd2xlZGdlIHRoZSBhbGVydFxuICAgICAgY29uc3QgYWNrbm93bGVkZ2VkID0gYWxlcnRpbmdTeXN0ZW0uYWNrbm93bGVkZ2VBbGVydChhbGVydCEuaWQpO1xuICAgICAgZXhwZWN0KGFja25vd2xlZGdlZCkudG9CZSh0cnVlKTtcblxuICAgICAgLy8gQ2hlY2sgdGhhdCBhbGVydCBpcyBub3cgYWNrbm93bGVkZ2VkXG4gICAgICBjb25zdCB1cGRhdGVkQWxlcnRzID0gYWxlcnRpbmdTeXN0ZW0uZ2V0QWxlcnRzKHsgcmVzb2x2ZWQ6IGZhbHNlIH0pO1xuICAgICAgY29uc3QgYWNrbm93bGVkZ2VkQWxlcnQgPSB1cGRhdGVkQWxlcnRzLmZpbmQoYSA9PiBhLmlkID09PSBhbGVydCEuaWQpO1xuICAgICAgZXhwZWN0KGFja25vd2xlZGdlZEFsZXJ0Py5hY2tub3dsZWRnZWQpLnRvQmUodHJ1ZSk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgcmVzb2x2ZSBhbGVydCcsICgpID0+IHtcbiAgICAgIC8vIENyZWF0ZSBhbiBhbGVydCBmaXJzdFxuICAgICAgY29uc3QgcnVsZUlkID0gYWxlcnRpbmdTeXN0ZW0uYWRkQWxlcnRSdWxlKHtcbiAgICAgICAgbmFtZTogJ1Rlc3QgQWxlcnQnLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ1Rlc3QgYWxlcnQgZm9yIHJlc29sdXRpb24nLFxuICAgICAgICB0eXBlOiAnZXJyb3InLFxuICAgICAgICBtZXRyaWM6ICd0eXBlc2NyaXB0X2Vycm9ycycsXG4gICAgICAgIGNvbmRpdGlvbjogJ2dyZWF0ZXJfdGhhbicsXG4gICAgICAgIHRocmVzaG9sZDogMTAwLFxuICAgICAgICBzZXZlcml0eTogJ3dhcm5pbmcnLFxuICAgICAgICBlbmFibGVkOiB0cnVlLFxuICAgICAgICBjb29sZG93bk1pbnV0ZXM6IDUsXG4gICAgICAgIGVzY2FsYXRpb25NaW51dGVzOiAxNSxcbiAgICAgICAgYXV0b1Jlc3BvbnNlOiBmYWxzZSxcbiAgICAgICAgcmVzcG9uc2VBY3Rpb25zOiBbXSxcbiAgICAgICAgbm90aWZpY2F0aW9uQ2hhbm5lbHM6IFsnY29uc29sZSddLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHJ1bGUgPSBhbGVydGluZ1N5c3RlbS5nZXRBbGVydFJ1bGVzKCkuZmluZChyID0+IHIuaWQgPT09IHJ1bGVJZCk7XG4gICAgICBpZiAocnVsZSkge1xuICAgICAgICAoYWxlcnRpbmdTeXN0ZW0gYXMgYW55KS5ldmFsdWF0ZVJ1bGUocnVsZSk7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGFsZXJ0cyA9IGFsZXJ0aW5nU3lzdGVtLmdldEFsZXJ0cyh7IHJlc29sdmVkOiBmYWxzZSB9KTtcbiAgICAgIGNvbnN0IGFsZXJ0ID0gYWxlcnRzLmZpbmQoYSA9PiBhLnRpdGxlID09PSAnVGVzdCBBbGVydCcpO1xuICAgICAgZXhwZWN0KGFsZXJ0KS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KGFsZXJ0Py5yZXNvbHZlZCkudG9CZShmYWxzZSk7XG5cbiAgICAgIC8vIFJlc29sdmUgdGhlIGFsZXJ0XG4gICAgICBjb25zdCByZXNvbHZlZCA9IGFsZXJ0aW5nU3lzdGVtLnJlc29sdmVBbGVydChhbGVydCEuaWQpO1xuICAgICAgZXhwZWN0KHJlc29sdmVkKS50b0JlKHRydWUpO1xuXG4gICAgICAvLyBDaGVjayB0aGF0IGFsZXJ0IGlzIG5vdyByZXNvbHZlZFxuICAgICAgY29uc3QgdW5yZXNvbHZlZEFsZXJ0cyA9IGFsZXJ0aW5nU3lzdGVtLmdldEFsZXJ0cyh7IHJlc29sdmVkOiBmYWxzZSB9KTtcbiAgICAgIGNvbnN0IHVucmVzb2x2ZWRBbGVydCA9IHVucmVzb2x2ZWRBbGVydHMuZmluZChhID0+IGEuaWQgPT09IGFsZXJ0IS5pZCk7XG4gICAgICBleHBlY3QodW5yZXNvbHZlZEFsZXJ0KS50b0JlVW5kZWZpbmVkKCk7XG5cbiAgICAgIGNvbnN0IHJlc29sdmVkQWxlcnRzID0gYWxlcnRpbmdTeXN0ZW0uZ2V0QWxlcnRzKHsgcmVzb2x2ZWQ6IHRydWUgfSk7XG4gICAgICBjb25zdCByZXNvbHZlZEFsZXJ0ID0gcmVzb2x2ZWRBbGVydHMuZmluZChhID0+IGEuaWQgPT09IGFsZXJ0IS5pZCk7XG4gICAgICBleHBlY3QocmVzb2x2ZWRBbGVydD8ucmVzb2x2ZWQpLnRvQmUodHJ1ZSk7XG4gICAgICBleHBlY3QocmVzb2x2ZWRBbGVydD8ucmVzb2x2ZWRBdCkudG9CZURlZmluZWQoKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoJ0FsZXJ0IEZpbHRlcmluZycsICgpID0+IHtcbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgIC8vIENyZWF0ZSBtdWx0aXBsZSBhbGVydHMgZm9yIHRlc3RpbmdcbiAgICAgIGNvbnN0IHJ1bGVzID0gW1xuICAgICAgICB7XG4gICAgICAgICAgbmFtZTogJ1BlcmZvcm1hbmNlIEFsZXJ0JyxcbiAgICAgICAgICB0eXBlOiAncGVyZm9ybWFuY2UnIGFzIGNvbnN0LFxuICAgICAgICAgIHNldmVyaXR5OiAnd2FybmluZycgYXMgY29uc3QsXG4gICAgICAgICAgbWV0cmljOiAnYnVpbGRfdGltZScsXG4gICAgICAgICAgdGhyZXNob2xkOiAzMDAwMCxcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIG5hbWU6ICdFcnJvciBBbGVydCcsXG4gICAgICAgICAgdHlwZTogJ2Vycm9yJyBhcyBjb25zdCxcbiAgICAgICAgICBzZXZlcml0eTogJ2Vycm9yJyBhcyBjb25zdCxcbiAgICAgICAgICBtZXRyaWM6ICd0eXBlc2NyaXB0X2Vycm9ycycsXG4gICAgICAgICAgdGhyZXNob2xkOiAxMDAsXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBuYW1lOiAnQ3JpdGljYWwgUXVhbGl0eSBBbGVydCcsXG4gICAgICAgICAgdHlwZTogJ3F1YWxpdHknIGFzIGNvbnN0LFxuICAgICAgICAgIHNldmVyaXR5OiAnY3JpdGljYWwnIGFzIGNvbnN0LFxuICAgICAgICAgIG1ldHJpYzogJ2NvZGVfcXVhbGl0eV9zY29yZScsXG4gICAgICAgICAgdGhyZXNob2xkOiA4MCwgLy8gTW9jayByZXR1cm5zIDc1LCBzbyB0aGlzIHNob3VsZCB0cmlnZ2VyIHdpdGggbGVzc190aGFuIGNvbmRpdGlvblxuICAgICAgICB9LFxuICAgICAgXTtcblxuICAgICAgZm9yIChjb25zdCBydWxlQ29uZmlnIG9mIHJ1bGVzKSB7XG4gICAgICAgIGNvbnN0IHJ1bGVJZCA9IGFsZXJ0aW5nU3lzdGVtLmFkZEFsZXJ0UnVsZSh7XG4gICAgICAgICAgLi4ucnVsZUNvbmZpZyxcbiAgICAgICAgICBkZXNjcmlwdGlvbjogYFRlc3QgJHtydWxlQ29uZmlnLm5hbWV9YCxcbiAgICAgICAgICBjb25kaXRpb246XG4gICAgICAgICAgICBydWxlQ29uZmlnLnR5cGUgPT09ICdxdWFsaXR5JyA/ICdsZXNzX3RoYW4nIDogJ2dyZWF0ZXJfdGhhbicsXG4gICAgICAgICAgZW5hYmxlZDogdHJ1ZSxcbiAgICAgICAgICBjb29sZG93bk1pbnV0ZXM6IDUsXG4gICAgICAgICAgZXNjYWxhdGlvbk1pbnV0ZXM6IDE1LFxuICAgICAgICAgIGF1dG9SZXNwb25zZTogZmFsc2UsXG4gICAgICAgICAgcmVzcG9uc2VBY3Rpb25zOiBbXSxcbiAgICAgICAgICBub3RpZmljYXRpb25DaGFubmVsczogWydjb25zb2xlJ10sXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IHJ1bGUgPSBhbGVydGluZ1N5c3RlbS5nZXRBbGVydFJ1bGVzKCkuZmluZChyID0+IHIuaWQgPT09IHJ1bGVJZCk7XG4gICAgICAgIGlmIChydWxlKSB7XG4gICAgICAgICAgKGFsZXJ0aW5nU3lzdGVtIGFzIGFueSkuZXZhbHVhdGVSdWxlKHJ1bGUpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdzaG91bGQgZmlsdGVyIGFsZXJ0cyBieSB0eXBlJywgKCkgPT4ge1xuICAgICAgY29uc3QgcGVyZm9ybWFuY2VBbGVydHMgPSBhbGVydGluZ1N5c3RlbS5nZXRBbGVydHMoe1xuICAgICAgICB0eXBlOiAncGVyZm9ybWFuY2UnLFxuICAgICAgfSk7XG4gICAgICBleHBlY3QocGVyZm9ybWFuY2VBbGVydHMubGVuZ3RoKS50b0JlKDEpO1xuICAgICAgZXhwZWN0KHBlcmZvcm1hbmNlQWxlcnRzWzBdLnR5cGUpLnRvQmUoJ3BlcmZvcm1hbmNlJyk7XG5cbiAgICAgIGNvbnN0IGVycm9yQWxlcnRzID0gYWxlcnRpbmdTeXN0ZW0uZ2V0QWxlcnRzKHsgdHlwZTogJ2Vycm9yJyB9KTtcbiAgICAgIGV4cGVjdChlcnJvckFsZXJ0cy5sZW5ndGgpLnRvQmUoMSk7XG4gICAgICBleHBlY3QoZXJyb3JBbGVydHNbMF0udHlwZSkudG9CZSgnZXJyb3InKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBmaWx0ZXIgYWxlcnRzIGJ5IHNldmVyaXR5JywgKCkgPT4ge1xuICAgICAgY29uc3QgY3JpdGljYWxBbGVydHMgPSBhbGVydGluZ1N5c3RlbS5nZXRBbGVydHMoeyBzZXZlcml0eTogJ2NyaXRpY2FsJyB9KTtcbiAgICAgIGV4cGVjdChjcml0aWNhbEFsZXJ0cy5sZW5ndGgpLnRvQmUoMSk7XG4gICAgICBleHBlY3QoY3JpdGljYWxBbGVydHNbMF0uc2V2ZXJpdHkpLnRvQmUoJ2NyaXRpY2FsJyk7XG5cbiAgICAgIGNvbnN0IHdhcm5pbmdBbGVydHMgPSBhbGVydGluZ1N5c3RlbS5nZXRBbGVydHMoeyBzZXZlcml0eTogJ3dhcm5pbmcnIH0pO1xuICAgICAgZXhwZWN0KHdhcm5pbmdBbGVydHMubGVuZ3RoKS50b0JlKDEpO1xuICAgICAgZXhwZWN0KHdhcm5pbmdBbGVydHNbMF0uc2V2ZXJpdHkpLnRvQmUoJ3dhcm5pbmcnKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCBsaW1pdCBudW1iZXIgb2YgYWxlcnRzIHJldHVybmVkJywgKCkgPT4ge1xuICAgICAgY29uc3QgbGltaXRlZEFsZXJ0cyA9IGFsZXJ0aW5nU3lzdGVtLmdldEFsZXJ0cyh7IGxpbWl0OiAyIH0pO1xuICAgICAgZXhwZWN0KGxpbWl0ZWRBbGVydHMubGVuZ3RoKS50b0JlKDIpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnQWxlcnQgU3VtbWFyeScsICgpID0+IHtcbiAgICB0ZXN0KCdzaG91bGQgcHJvdmlkZSBhY2N1cmF0ZSBhbGVydCBzdW1tYXJ5JywgKCkgPT4ge1xuICAgICAgLy8gQ3JlYXRlIHNvbWUgdGVzdCBhbGVydHNcbiAgICAgIGNvbnN0IHJ1bGVJZCA9IGFsZXJ0aW5nU3lzdGVtLmFkZEFsZXJ0UnVsZSh7XG4gICAgICAgIG5hbWU6ICdTdW1tYXJ5IFRlc3QgQWxlcnQnLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ1Rlc3QgYWxlcnQgZm9yIHN1bW1hcnknLFxuICAgICAgICB0eXBlOiAnZXJyb3InLFxuICAgICAgICBtZXRyaWM6ICd0eXBlc2NyaXB0X2Vycm9ycycsXG4gICAgICAgIGNvbmRpdGlvbjogJ2dyZWF0ZXJfdGhhbicsXG4gICAgICAgIHRocmVzaG9sZDogMTAwLFxuICAgICAgICBzZXZlcml0eTogJ2NyaXRpY2FsJyxcbiAgICAgICAgZW5hYmxlZDogdHJ1ZSxcbiAgICAgICAgY29vbGRvd25NaW51dGVzOiA1LFxuICAgICAgICBlc2NhbGF0aW9uTWludXRlczogMTUsXG4gICAgICAgIGF1dG9SZXNwb25zZTogZmFsc2UsXG4gICAgICAgIHJlc3BvbnNlQWN0aW9uczogW10sXG4gICAgICAgIG5vdGlmaWNhdGlvbkNoYW5uZWxzOiBbJ2NvbnNvbGUnXSxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBydWxlID0gYWxlcnRpbmdTeXN0ZW0uZ2V0QWxlcnRSdWxlcygpLmZpbmQociA9PiByLmlkID09PSBydWxlSWQpO1xuICAgICAgaWYgKHJ1bGUpIHtcbiAgICAgICAgKGFsZXJ0aW5nU3lzdGVtIGFzIGFueSkuZXZhbHVhdGVSdWxlKHJ1bGUpO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBzdW1tYXJ5ID0gYWxlcnRpbmdTeXN0ZW0uZ2V0QWxlcnRTdW1tYXJ5KCk7XG5cbiAgICAgIGV4cGVjdChzdW1tYXJ5LnRvdGFsQWxlcnRzKS50b0JlR3JlYXRlclRoYW4oMCk7XG4gICAgICBleHBlY3Qoc3VtbWFyeS51bnJlc29sdmVkQWxlcnRzKS50b0JlR3JlYXRlclRoYW4oMCk7XG4gICAgICBleHBlY3Qoc3VtbWFyeS5jcml0aWNhbEFsZXJ0cykudG9CZUdyZWF0ZXJUaGFuKDApO1xuICAgICAgZXhwZWN0KHN1bW1hcnkuYWxlcnRzQnlUeXBlKS50b0JlRGVmaW5lZCgpO1xuICAgICAgZXhwZWN0KHN1bW1hcnkuYWxlcnRzQnlTZXZlcml0eSkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdCh0eXBlb2Ygc3VtbWFyeS5yZXNwb25zZVN1Y2Nlc3NSYXRlKS50b0JlKCdudW1iZXInKTtcbiAgICAgIGV4cGVjdCh0eXBlb2Ygc3VtbWFyeS5hdmVyYWdlUmVzb2x1dGlvblRpbWUpLnRvQmUoJ251bWJlcicpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnVGVzdCBBbGVydCBGdW5jdGlvbmFsaXR5JywgKCkgPT4ge1xuICAgIHRlc3QoJ3Nob3VsZCBjcmVhdGUgdGVzdCBhbGVydCcsICgpID0+IHtcbiAgICAgIGNvbnN0IHJ1bGVJZCA9IGFsZXJ0aW5nU3lzdGVtLmFkZEFsZXJ0UnVsZSh7XG4gICAgICAgIG5hbWU6ICdUZXN0IFJ1bGUgZm9yIFRlc3RpbmcnLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ1J1bGUgdG8gdGVzdCBhbGVydCBjcmVhdGlvbicsXG4gICAgICAgIHR5cGU6ICdwZXJmb3JtYW5jZScsXG4gICAgICAgIG1ldHJpYzogJ2J1aWxkX3RpbWUnLFxuICAgICAgICBjb25kaXRpb246ICdncmVhdGVyX3RoYW4nLFxuICAgICAgICB0aHJlc2hvbGQ6IDYwMDAwLFxuICAgICAgICBzZXZlcml0eTogJ3dhcm5pbmcnLFxuICAgICAgICBlbmFibGVkOiB0cnVlLFxuICAgICAgICBjb29sZG93bk1pbnV0ZXM6IDUsXG4gICAgICAgIGVzY2FsYXRpb25NaW51dGVzOiAxNSxcbiAgICAgICAgYXV0b1Jlc3BvbnNlOiBmYWxzZSxcbiAgICAgICAgcmVzcG9uc2VBY3Rpb25zOiBbXSxcbiAgICAgICAgbm90aWZpY2F0aW9uQ2hhbm5lbHM6IFsnY29uc29sZSddLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHRlc3RSZXN1bHQgPSBhbGVydGluZ1N5c3RlbS50ZXN0QWxlcnQocnVsZUlkKTtcbiAgICAgIGV4cGVjdCh0ZXN0UmVzdWx0KS50b0JlKHRydWUpO1xuXG4gICAgICAvLyBDaGVjayB0aGF0IHRlc3QgYWxlcnQgd2FzIGNyZWF0ZWRcbiAgICAgIGNvbnN0IGFsZXJ0cyA9IGFsZXJ0aW5nU3lzdGVtLmdldEFsZXJ0cyh7IHJlc29sdmVkOiBmYWxzZSB9KTtcbiAgICAgIGNvbnN0IHRlc3RBbGVydCA9IGFsZXJ0cy5maW5kKGEgPT4gYS50aXRsZSA9PT0gJ1Rlc3QgUnVsZSBmb3IgVGVzdGluZycpO1xuICAgICAgZXhwZWN0KHRlc3RBbGVydCkudG9CZURlZmluZWQoKTtcbiAgICAgIGV4cGVjdCh0ZXN0QWxlcnQ/LmN1cnJlbnRWYWx1ZSkudG9CZSg2MDAwMSk7IC8vIHRocmVzaG9sZCArIDFcbiAgICB9KTtcblxuICAgIHRlc3QoJ3Nob3VsZCByZXR1cm4gZmFsc2UgZm9yIG5vbi1leGlzdGVudCBydWxlJywgKCkgPT4ge1xuICAgICAgY29uc3QgdGVzdFJlc3VsdCA9IGFsZXJ0aW5nU3lzdGVtLnRlc3RBbGVydCgnbm9uLWV4aXN0ZW50LXJ1bGUnKTtcbiAgICAgIGV4cGVjdCh0ZXN0UmVzdWx0KS50b0JlKGZhbHNlKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdLCJ2ZXJzaW9uIjozfQ==