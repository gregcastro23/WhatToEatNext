87ac2df02b8b3a5ab9dd703882f7323c
"use strict";
/**
 * Safe Unused Import Removal System
 *
 * Implements comprehensive unused import removal while preserving:
 * - Imports used in type annotations or JSX
 * - Dynamic imports and conditional imports
 * - Critical astrological calculation imports
 * - Campaign system intelligence imports
 *
 * Requirements: 3.2, 4.1
 */
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.SafeUnusedImportRemover = void 0;
const child_process_1 = require("child_process");
const path_1 = __importDefault(require("path"));
class SafeUnusedImportRemover {
    astrologicalPatterns = [
        '/calculations/',
        '/data/planets/',
        '/utils/reliableAstronomy',
        '/utils/astrologyUtils',
        '/utils/planetaryConsistencyCheck',
        'astrological',
        'planetary',
        'elemental',
        'astronomical',
        'ephemeris',
        'transit',
        'zodiac'
    ];
    campaignSystemPatterns = [
        '/services/campaign/',
        '/services/AdvancedAnalyticsIntelligenceService',
        '/services/MLIntelligenceService',
        '/services/PredictiveIntelligenceService',
        'Campaign',
        'Intelligence',
        'Analytics',
        'Progress',
        'Metrics',
        'Safety'
    ];
    /**
     * Analyze and remove unused imports safely
     */
    async processUnusedImports(dryRun = true) {
        console.log('üîç Starting Safe Unused Import Analysis...\n');
        const result = {
            totalAnalyzed: 0,
            safeToRemove: 0,
            requiresReview: 0,
            preserved: 0,
            actuallyRemoved: 0,
            errors: [],
            warnings: [],
            buildValid: false
        };
        try {
            // Step 1: Analyze unused imports
            const unusedImports = await this.analyzeUnusedImports();
            result.totalAnalyzed = unusedImports.length;
            if (unusedImports.length === 0) {
                console.log('‚úÖ No unused imports found!');
                result.buildValid = true;
                return result;
            }
            // Step 2: Categorize imports
            const categorized = this.categorizeImports(unusedImports);
            result.safeToRemove = categorized.safe.length;
            result.requiresReview = categorized.review.length;
            result.preserved = categorized.preserve.length;
            // Step 3: Display analysis results
            this.displayAnalysisResults(categorized);
            if (dryRun) {
                console.log('\nüîç DRY RUN MODE - No changes will be made');
                console.log('Use processUnusedImports(false) to execute removal');
                return result;
            }
            // Step 4: Remove safe imports
            if (categorized.safe.length > 0) {
                const removalSuccess = await this.removeSafeImports(categorized.safe);
                result.actuallyRemoved = removalSuccess ? categorized.safe.length : 0;
            }
            // Step 5: Validate changes
            result.buildValid = await this.validateChanges();
            if (result.buildValid) {
                console.log('\nüéâ Safe unused import removal completed successfully!');
                console.log(`‚úÖ Removed ${result.actuallyRemoved} unused imports`);
                console.log(`üõ°Ô∏è  Preserved ${result.preserved} critical imports`);
            }
            else {
                result.errors.push('Build validation failed after import removal');
            }
        }
        catch (error) {
            result.errors.push(`Import removal failed: ${error}`);
            console.error('‚ùå Import removal failed:', error);
        }
        return result;
    }
    /**
     * Analyze unused imports from ESLint output
     */
    async analyzeUnusedImports() {
        console.log('üîç Analyzing unused imports from ESLint...');
        try {
            const lintOutput = (0, child_process_1.execSync)('yarn lint --format=compact 2>&1', {
                encoding: 'utf8',
                maxBuffer: 20 * 1024 * 1024
            });
            const unusedImports = [];
            const lines = lintOutput.split('\n');
            for (const line of lines) {
                if (line.includes('@typescript-eslint/no-unused-vars') &&
                    (line.includes('is defined but never used') || line.includes('is imported but never used'))) {
                    const match = line.match(/^(.+):(\d+):(\d+):\s+(warning|error)\s+(.+?)\s+@typescript-eslint\/no-unused-vars/);
                    if (match) {
                        const [, filePath, lineNum, colNum, severity, message] = match;
                        const importNameMatch = message.match(/'([^']+)'/);
                        const importName = importNameMatch ? importNameMatch[1] : '';
                        unusedImports.push({
                            file: filePath,
                            line: parseInt(lineNum),
                            column: parseInt(colNum),
                            importName,
                            message,
                            isTypeImport: message.includes('type'),
                            isDefaultImport: !message.includes('{'),
                            isNamespaceImport: message.includes('* as'),
                            severity: 'review',
                            reason: ''
                        });
                    }
                }
            }
            console.log(`üìä Found ${unusedImports.length} unused imports`);
            return unusedImports;
        }
        catch (error) {
            console.error('‚ùå Failed to analyze unused imports:', error);
            return [];
        }
    }
    /**
     * Categorize imports by safety level
     */
    categorizeImports(unusedImports) {
        console.log('üìã Categorizing imports by safety level...');
        const categorized = {
            safe: [],
            review: [],
            preserve: []
        };
        for (const unusedImport of unusedImports) {
            const category = this.determineImportSafety(unusedImport);
            unusedImport.severity = category.severity;
            unusedImport.reason = category.reason;
            switch (category.severity) {
                case 'safe':
                    categorized.safe.push(unusedImport);
                    break;
                case 'review':
                    categorized.review.push(unusedImport);
                    break;
                case 'preserve':
                    categorized.preserve.push(unusedImport);
                    break;
            }
        }
        return categorized;
    }
    /**
     * Determine the safety level of removing an import
     */
    determineImportSafety(unusedImport) {
        const { file, importName, message, isTypeImport } = unusedImport;
        // Always preserve imports in critical astrological files
        if (this.astrologicalPatterns.some(pattern => file.includes(pattern))) {
            return {
                severity: 'preserve',
                reason: 'Critical astrological calculation file'
            };
        }
        // Always preserve imports in campaign system files
        if (this.campaignSystemPatterns.some(pattern => file.includes(pattern))) {
            return {
                severity: 'preserve',
                reason: 'Campaign system intelligence file'
            };
        }
        // Preserve React component imports in TSX files
        if (importName.match(/^[A-Z]/) && file.endsWith('.tsx')) {
            return {
                severity: 'preserve',
                reason: 'React component import in TSX file'
            };
        }
        // Preserve type imports (might be used in type annotations)
        if (isTypeImport) {
            return {
                severity: 'preserve',
                reason: 'Type import may be used in annotations'
            };
        }
        // Safe to remove: simple utility imports that are clearly unused
        const safePatterns = [
            /^[a-z][a-zA-Z]*$/,
            /^[A-Z_]+$/,
            /Utils?$/,
            /Helper$/,
            /Config$/,
            /Constants?$/ // Constants
        ];
        if (safePatterns.some(pattern => pattern.test(importName)) &&
            message.includes('is defined but never used') &&
            !file.includes('.d.ts')) {
            return {
                severity: 'safe',
                reason: 'Simple utility import that is clearly unused'
            };
        }
        // Default to requiring manual review
        return {
            severity: 'review',
            reason: 'Requires manual review for safety'
        };
    }
    /**
     * Display analysis results
     */
    displayAnalysisResults(categorized) {
        console.log('\nüìä Import Analysis Results:');
        console.log(`‚úÖ Safe to remove: ${categorized.safe.length}`);
        console.log(`‚ö†Ô∏è  Requires review: ${categorized.review.length}`);
        console.log(`üõ°Ô∏è  Preserved (critical): ${categorized.preserve.length}\n`);
        if (categorized.safe.length > 0) {
            console.log('‚úÖ Safe to Remove:');
            this.displayImportsByFile(categorized.safe);
        }
        if (categorized.preserve.length > 0) {
            console.log('\nüõ°Ô∏è  Preserved (Critical):');
            this.displayImportsByFile(categorized.preserve.slice(0, 10)); // Show first 10
            if (categorized.preserve.length > 10) {
                console.log(`   ... and ${categorized.preserve.length - 10} more`);
            }
        }
        if (categorized.review.length > 0) {
            console.log('\n‚ö†Ô∏è  Requires Manual Review:');
            this.displayImportsByFile(categorized.review.slice(0, 5)); // Show first 5
            if (categorized.review.length > 5) {
                console.log(`   ... and ${categorized.review.length - 5} more`);
            }
        }
    }
    /**
     * Display imports grouped by file
     */
    displayImportsByFile(imports) {
        const groupedByFile = imports.reduce((acc, imp) => {
            const relativePath = path_1.default.relative(process.cwd(), imp.file);
            if (!acc[relativePath])
                acc[relativePath] = [];
            acc[relativePath].push(imp);
            return acc;
        }, {});
        Object.entries(groupedByFile).forEach(([file, fileImports]) => {
            console.log(`   üìÑ ${file}:`);
            fileImports.forEach(imp => {
                console.log(`      - Line ${imp.line}: '${imp.importName}' (${imp.reason})`);
            });
        });
    }
    /**
     * Remove safe imports using ESLint auto-fix
     */
    async removeSafeImports(safeImports) {
        console.log(`\nüóëÔ∏è  Removing ${safeImports.length} safe unused imports...`);
        try {
            // Run ESLint auto-fix with focused unused variable removal
            (0, child_process_1.execSync)('yarn lint --fix --rule "@typescript-eslint/no-unused-vars: error"', {
                stdio: 'pipe',
                encoding: 'utf8'
            });
            console.log('‚úÖ Safe import removal completed');
            return true;
        }
        catch (error) {
            // ESLint returns non-zero exit code even for successful fixes
            if (error.stdout && !error.stdout.includes('error')) {
                console.log('‚úÖ Safe import removal completed');
                return true;
            }
            else {
                console.error('‚ùå Safe import removal failed:', error.message);
                return false;
            }
        }
    }
    /**
     * Validate changes by running TypeScript check and build
     */
    async validateChanges() {
        console.log('\nüîç Validating changes...');
        try {
            // Check TypeScript compilation
            (0, child_process_1.execSync)('yarn tsc --noEmit --skipLibCheck', {
                stdio: 'pipe',
                encoding: 'utf8'
            });
            console.log('‚úÖ TypeScript validation passed');
            return true;
        }
        catch (error) {
            console.error('‚ùå Validation failed');
            return false;
        }
    }
    /**
     * Get current import statistics
     */
    getImportStats() {
        try {
            // Count TypeScript/JavaScript files
            const totalFilesOutput = (0, child_process_1.execSync)('find src -name "*.ts" -o -name "*.tsx" -o -name "*.js" -o -name "*.jsx" | wc -l', {
                encoding: 'utf8'
            });
            const totalFiles = parseInt(totalFilesOutput.trim()) || 0;
            // Count TypeScript files specifically
            const tsFilesOutput = (0, child_process_1.execSync)('find src -name "*.ts" -o -name "*.tsx" | wc -l', {
                encoding: 'utf8'
            });
            const typeScriptFiles = parseInt(tsFilesOutput.trim()) || 0;
            // Count unused import warnings (approximate)
            const unusedImportsOutput = (0, child_process_1.execSync)('yarn lint --format=compact 2>&1 | grep -E "@typescript-eslint/no-unused-vars.*is defined but never used" | wc -l', {
                encoding: 'utf8'
            });
            const unusedImports = parseInt(unusedImportsOutput.trim()) || 0;
            return { totalFiles, unusedImports, typeScriptFiles };
        }
        catch (error) {
            return { totalFiles: 0, unusedImports: 0, typeScriptFiles: 0 };
        }
    }
}
exports.SafeUnusedImportRemover = SafeUnusedImportRemover;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9zZXJ2aWNlcy9saW50aW5nL1NhZmVVbnVzZWRJbXBvcnRSZW1vdmVyLnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7Ozs7OztHQVVHOzs7Ozs7QUFFSCxpREFBeUM7QUFFekMsZ0RBQXdCO0FBMEJ4QixNQUFhLHVCQUF1QjtJQUNqQixvQkFBb0IsR0FBRztRQUN0QyxnQkFBZ0I7UUFDaEIsZ0JBQWdCO1FBQ2hCLDBCQUEwQjtRQUMxQix1QkFBdUI7UUFDdkIsa0NBQWtDO1FBQ2xDLGNBQWM7UUFDZCxXQUFXO1FBQ1gsV0FBVztRQUNYLGNBQWM7UUFDZCxXQUFXO1FBQ1gsU0FBUztRQUNULFFBQVE7S0FDVCxDQUFDO0lBRWUsc0JBQXNCLEdBQUc7UUFDeEMscUJBQXFCO1FBQ3JCLGdEQUFnRDtRQUNoRCxpQ0FBaUM7UUFDakMseUNBQXlDO1FBQ3pDLFVBQVU7UUFDVixjQUFjO1FBQ2QsV0FBVztRQUNYLFVBQVU7UUFDVixTQUFTO1FBQ1QsUUFBUTtLQUNULENBQUM7SUFFRjs7T0FFRztJQUNJLEtBQUssQ0FBQyxvQkFBb0IsQ0FBQyxTQUFrQixJQUFJO1FBQ3RELE9BQU8sQ0FBQyxHQUFHLENBQUMsOENBQThDLENBQUMsQ0FBQztRQUU1RCxNQUFNLE1BQU0sR0FBd0I7WUFDbEMsYUFBYSxFQUFFLENBQUM7WUFDaEIsWUFBWSxFQUFFLENBQUM7WUFDZixjQUFjLEVBQUUsQ0FBQztZQUNqQixTQUFTLEVBQUUsQ0FBQztZQUNaLGVBQWUsRUFBRSxDQUFDO1lBQ2xCLE1BQU0sRUFBRSxFQUFFO1lBQ1YsUUFBUSxFQUFFLEVBQUU7WUFDWixVQUFVLEVBQUUsS0FBSztTQUNsQixDQUFDO1FBRUYsSUFBSTtZQUNGLGlDQUFpQztZQUNqQyxNQUFNLGFBQWEsR0FBRyxNQUFNLElBQUksQ0FBQyxvQkFBb0IsRUFBRSxDQUFDO1lBQ3hELE1BQU0sQ0FBQyxhQUFhLEdBQUcsYUFBYSxDQUFDLE1BQU0sQ0FBQztZQUU1QyxJ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ZXMiOlsiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9zZXJ2aWNlcy9saW50aW5nL1NhZmVVbnVzZWRJbXBvcnRSZW1vdmVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogU2FmZSBVbnVzZWQgSW1wb3J0IFJlbW92YWwgU3lzdGVtXG4gKiBcbiAqIEltcGxlbWVudHMgY29tcHJlaGVuc2l2ZSB1bnVzZWQgaW1wb3J0IHJlbW92YWwgd2hpbGUgcHJlc2VydmluZzpcbiAqIC0gSW1wb3J0cyB1c2VkIGluIHR5cGUgYW5ub3RhdGlvbnMgb3IgSlNYXG4gKiAtIER5bmFtaWMgaW1wb3J0cyBhbmQgY29uZGl0aW9uYWwgaW1wb3J0c1xuICogLSBDcml0aWNhbCBhc3Ryb2xvZ2ljYWwgY2FsY3VsYXRpb24gaW1wb3J0c1xuICogLSBDYW1wYWlnbiBzeXN0ZW0gaW50ZWxsaWdlbmNlIGltcG9ydHNcbiAqIFxuICogUmVxdWlyZW1lbnRzOiAzLjIsIDQuMVxuICovXG5cbmltcG9ydCB7IGV4ZWNTeW5jIH0gZnJvbSAnY2hpbGRfcHJvY2Vzcyc7XG5pbXBvcnQgZnMgZnJvbSAnZnMnO1xuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XG5cbmludGVyZmFjZSBVbnVzZWRJbXBvcnQge1xuICBmaWxlOiBzdHJpbmc7XG4gIGxpbmU6IG51bWJlcjtcbiAgY29sdW1uOiBudW1iZXI7XG4gIGltcG9ydE5hbWU6IHN0cmluZztcbiAgbWVzc2FnZTogc3RyaW5nO1xuICBpc1R5cGVJbXBvcnQ6IGJvb2xlYW47XG4gIGlzRGVmYXVsdEltcG9ydDogYm9vbGVhbjtcbiAgaXNOYW1lc3BhY2VJbXBvcnQ6IGJvb2xlYW47XG4gIHNldmVyaXR5OiAnc2FmZScgfCAncmV2aWV3JyB8ICdwcmVzZXJ2ZSc7XG4gIHJlYXNvbj86IHN0cmluZztcbn1cblxuaW50ZXJmYWNlIEltcG9ydFJlbW92YWxSZXN1bHQge1xuICB0b3RhbEFuYWx5emVkOiBudW1iZXI7XG4gIHNhZmVUb1JlbW92ZTogbnVtYmVyO1xuICByZXF1aXJlc1JldmlldzogbnVtYmVyO1xuICBwcmVzZXJ2ZWQ6IG51bWJlcjtcbiAgYWN0dWFsbHlSZW1vdmVkOiBudW1iZXI7XG4gIGVycm9yczogc3RyaW5nW107XG4gIHdhcm5pbmdzOiBzdHJpbmdbXTtcbiAgYnVpbGRWYWxpZDogYm9vbGVhbjtcbn1cblxuZXhwb3J0IGNsYXNzIFNhZmVVbnVzZWRJbXBvcnRSZW1vdmVyIHtcbiAgcHJpdmF0ZSByZWFkb25seSBhc3Ryb2xvZ2ljYWxQYXR0ZXJucyA9IFtcbiAgICAnL2NhbGN1bGF0aW9ucy8nLFxuICAgICcvZGF0YS9wbGFuZXRzLycsXG4gICAgJy91dGlscy9yZWxpYWJsZUFzdHJvbm9teScsXG4gICAgJy91dGlscy9hc3Ryb2xvZ3lVdGlscycsXG4gICAgJy91dGlscy9wbGFuZXRhcnlDb25zaXN0ZW5jeUNoZWNrJyxcbiAgICAnYXN0cm9sb2dpY2FsJyxcbiAgICAncGxhbmV0YXJ5JyxcbiAgICAnZWxlbWVudGFsJyxcbiAgICAnYXN0cm9ub21pY2FsJyxcbiAgICAnZXBoZW1lcmlzJyxcbiAgICAndHJhbnNpdCcsXG4gICAgJ3pvZGlhYydcbiAgXTtcblxuICBwcml2YXRlIHJlYWRvbmx5IGNhbXBhaWduU3lzdGVtUGF0dGVybnMgPSBbXG4gICAgJy9zZXJ2aWNlcy9jYW1wYWlnbi8nLFxuICAgICcvc2VydmljZXMvQWR2YW5jZWRBbmFseXRpY3NJbnRlbGxpZ2VuY2VTZXJ2aWNlJyxcbiAgICAnL3NlcnZpY2VzL01MSW50ZWxsaWdlbmNlU2VydmljZScsXG4gICAgJy9zZXJ2aWNlcy9QcmVkaWN0aXZlSW50ZWxsaWdlbmNlU2VydmljZScsXG4gICAgJ0NhbXBhaWduJyxcbiAgICAnSW50ZWxsaWdlbmNlJyxcbiAgICAnQW5hbHl0aWNzJyxcbiAgICAnUHJvZ3Jlc3MnLFxuICAgICdNZXRyaWNzJyxcbiAgICAnU2FmZXR5J1xuICBdO1xuXG4gIC8qKlxuICAgKiBBbmFseXplIGFuZCByZW1vdmUgdW51c2VkIGltcG9ydHMgc2FmZWx5XG4gICAqL1xuICBwdWJsaWMgYXN5bmMgcHJvY2Vzc1VudXNlZEltcG9ydHMoZHJ5UnVuOiBib29sZWFuID0gdHJ1ZSk6IFByb21pc2U8SW1wb3J0UmVtb3ZhbFJlc3VsdD4ge1xuICAgIGNvbnNvbGUubG9nKCfwn5SNIFN0YXJ0aW5nIFNhZmUgVW51c2VkIEltcG9ydCBBbmFseXNpcy4uLlxcbicpO1xuICAgIFxuICAgIGNvbnN0IHJlc3VsdDogSW1wb3J0UmVtb3ZhbFJlc3VsdCA9IHtcbiAgICAgIHRvdGFsQW5hbHl6ZWQ6IDAsXG4gICAgICBzYWZlVG9SZW1vdmU6IDAsXG4gICAgICByZXF1aXJlc1JldmlldzogMCxcbiAgICAgIHByZXNlcnZlZDogMCxcbiAgICAgIGFjdHVhbGx5UmVtb3ZlZDogMCxcbiAgICAgIGVycm9yczogW10sXG4gICAgICB3YXJuaW5nczogW10sXG4gICAgICBidWlsZFZhbGlkOiBmYWxzZVxuICAgIH07XG5cbiAgICB0cnkge1xuICAgICAgLy8gU3RlcCAxOiBBbmFseXplIHVudXNlZCBpbXBvcnRzXG4gICAgICBjb25zdCB1bnVzZWRJbXBvcnRzID0gYXdhaXQgdGhpcy5hbmFseXplVW51c2VkSW1wb3J0cygpO1xuICAgICAgcmVzdWx0LnRvdGFsQW5hbHl6ZWQgPSB1bnVzZWRJbXBvcnRzLmxlbmd0aDtcblxuICAgICAgaWYgKHVudXNlZEltcG9ydHMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCfinIUgTm8gdW51c2VkIGltcG9ydHMgZm91bmQhJyk7XG4gICAgICAgIHJlc3VsdC5idWlsZFZhbGlkID0gdHJ1ZTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgIH1cblxuICAgICAgLy8gU3RlcCAyOiBDYXRlZ29yaXplIGltcG9ydHNcbiAgICAgIGNvbnN0IGNhdGVnb3JpemVkID0gdGhpcy5jYXRlZ29yaXplSW1wb3J0cyh1bnVzZWRJbXBvcnRzKTtcbiAgICAgIHJlc3VsdC5zYWZlVG9SZW1vdmUgPSBjYXRlZ29yaXplZC5zYWZlLmxlbmd0aDtcbiAgICAgIHJlc3VsdC5yZXF1aXJlc1JldmlldyA9IGNhdGVnb3JpemVkLnJldmlldy5sZW5ndGg7XG4gICAgICByZXN1bHQucHJlc2VydmVkID0gY2F0ZWdvcml6ZWQucHJlc2VydmUubGVuZ3RoO1xuXG4gICAgICAvLyBTdGVwIDM6IERpc3BsYXkgYW5hbHlzaXMgcmVzdWx0c1xuICAgICAgdGhpcy5kaXNwbGF5QW5hbHlzaXNSZXN1bHRzKGNhdGVnb3JpemVkKTtcblxuICAgICAgaWYgKGRyeVJ1bikge1xuICAgICAgICBjb25zb2xlLmxvZygnXFxu8J+UjSBEUlkgUlVOIE1PREUgLSBObyBjaGFuZ2VzIHdpbGwgYmUgbWFkZScpO1xuICAgICAgICBjb25zb2xlLmxvZygnVXNlIHByb2Nlc3NVbnVzZWRJbXBvcnRzKGZhbHNlKSB0byBleGVjdXRlIHJlbW92YWwnKTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgIH1cblxuICAgICAgLy8gU3RlcCA0OiBSZW1vdmUgc2FmZSBpbXBvcnRzXG4gICAgICBpZiAoY2F0ZWdvcml6ZWQuc2FmZS5sZW5ndGggPiAwKSB7XG4gICAgICAgIGNvbnN0IHJlbW92YWxTdWNjZXNzID0gYXdhaXQgdGhpcy5yZW1vdmVTYWZlSW1wb3J0cyhjYXRlZ29yaXplZC5zYWZlKTtcbiAgICAgICAgcmVzdWx0LmFjdHVhbGx5UmVtb3ZlZCA9IHJlbW92YWxTdWNjZXNzID8gY2F0ZWdvcml6ZWQuc2FmZS5sZW5ndGggOiAwO1xuICAgICAgfVxuXG4gICAgICAvLyBTdGVwIDU6IFZhbGlkYXRlIGNoYW5nZXNcbiAgICAgIHJlc3VsdC5idWlsZFZhbGlkID0gYXdhaXQgdGhpcy52YWxpZGF0ZUNoYW5nZXMoKTtcblxuICAgICAgaWYgKHJlc3VsdC5idWlsZFZhbGlkKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdcXG7wn46JIFNhZmUgdW51c2VkIGltcG9ydCByZW1vdmFsIGNvbXBsZXRlZCBzdWNjZXNzZnVsbHkhJyk7XG4gICAgICAgIGNvbnNvbGUubG9nKGDinIUgUmVtb3ZlZCAke3Jlc3VsdC5hY3R1YWxseVJlbW92ZWR9IHVudXNlZCBpbXBvcnRzYCk7XG4gICAgICAgIGNvbnNvbGUubG9nKGDwn5uh77iPICBQcmVzZXJ2ZWQgJHtyZXN1bHQucHJlc2VydmVkfSBjcml0aWNhbCBpbXBvcnRzYCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXN1bHQuZXJyb3JzLnB1c2goJ0J1aWxkIHZhbGlkYXRpb24gZmFpbGVkIGFmdGVyIGltcG9ydCByZW1vdmFsJyk7XG4gICAgICB9XG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgcmVzdWx0LmVycm9ycy5wdXNoKGBJbXBvcnQgcmVtb3ZhbCBmYWlsZWQ6ICR7ZXJyb3J9YCk7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgSW1wb3J0IHJlbW92YWwgZmFpbGVkOicsIGVycm9yKTtcbiAgICB9XG5cbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG5cbiAgLyoqXG4gICAqIEFuYWx5emUgdW51c2VkIGltcG9ydHMgZnJvbSBFU0xpbnQgb3V0cHV0XG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGFuYWx5emVVbnVzZWRJbXBvcnRzKCk6IFByb21pc2U8VW51c2VkSW1wb3J0W10+IHtcbiAgICBjb25zb2xlLmxvZygn8J+UjSBBbmFseXppbmcgdW51c2VkIGltcG9ydHMgZnJvbSBFU0xpbnQuLi4nKTtcblxuICAgIHRyeSB7XG4gICAgICBjb25zdCBsaW50T3V0cHV0ID0gZXhlY1N5bmMoJ3lhcm4gbGludCAtLWZvcm1hdD1jb21wYWN0IDI+JjEnLCB7IFxuICAgICAgICBlbmNvZGluZzogJ3V0ZjgnLFxuICAgICAgICBtYXhCdWZmZXI6IDIwICogMTAyNCAqIDEwMjRcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCB1bnVzZWRJbXBvcnRzOiBVbnVzZWRJbXBvcnRbXSA9IFtdO1xuICAgICAgY29uc3QgbGluZXMgPSBsaW50T3V0cHV0LnNwbGl0KCdcXG4nKTtcblxuICAgICAgZm9yIChjb25zdCBsaW5lIG9mIGxpbmVzKSB7XG4gICAgICAgIGlmIChsaW5lLmluY2x1ZGVzKCdAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdW51c2VkLXZhcnMnKSAmJiBcbiAgICAgICAgICAgIChsaW5lLmluY2x1ZGVzKCdpcyBkZWZpbmVkIGJ1dCBuZXZlciB1c2VkJykgfHwgbGluZS5pbmNsdWRlcygnaXMgaW1wb3J0ZWQgYnV0IG5ldmVyIHVzZWQnKSkpIHtcbiAgICAgICAgICBcbiAgICAgICAgICBjb25zdCBtYXRjaCA9IGxpbmUubWF0Y2goL14oLispOihcXGQrKTooXFxkKyk6XFxzKyh3YXJuaW5nfGVycm9yKVxccysoLis/KVxccytAdHlwZXNjcmlwdC1lc2xpbnRcXC9uby11bnVzZWQtdmFycy8pO1xuICAgICAgICAgIGlmIChtYXRjaCkge1xuICAgICAgICAgICAgY29uc3QgWywgZmlsZVBhdGgsIGxpbmVOdW0sIGNvbE51bSwgc2V2ZXJpdHksIG1lc3NhZ2VdID0gbWF0Y2g7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IGltcG9ydE5hbWVNYXRjaCA9IG1lc3NhZ2UubWF0Y2goLycoW14nXSspJy8pO1xuICAgICAgICAgICAgY29uc3QgaW1wb3J0TmFtZSA9IGltcG9ydE5hbWVNYXRjaCA/IGltcG9ydE5hbWVNYXRjaFsxXSA6ICcnO1xuXG4gICAgICAgICAgICB1bnVzZWRJbXBvcnRzLnB1c2goe1xuICAgICAgICAgICAgICBmaWxlOiBmaWxlUGF0aCxcbiAgICAgICAgICAgICAgbGluZTogcGFyc2VJbnQobGluZU51bSksXG4gICAgICAgICAgICAgIGNvbHVtbjogcGFyc2VJbnQoY29sTnVtKSxcbiAgICAgICAgICAgICAgaW1wb3J0TmFtZSxcbiAgICAgICAgICAgICAgbWVzc2FnZSxcbiAgICAgICAgICAgICAgaXNUeXBlSW1wb3J0OiBtZXNzYWdlLmluY2x1ZGVzKCd0eXBlJyksXG4gICAgICAgICAgICAgIGlzRGVmYXVsdEltcG9ydDogIW1lc3NhZ2UuaW5jbHVkZXMoJ3snKSxcbiAgICAgICAgICAgICAgaXNOYW1lc3BhY2VJbXBvcnQ6IG1lc3NhZ2UuaW5jbHVkZXMoJyogYXMnKSxcbiAgICAgICAgICAgICAgc2V2ZXJpdHk6ICdyZXZpZXcnLFxuICAgICAgICAgICAgICByZWFzb246ICcnXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgY29uc29sZS5sb2coYPCfk4ogRm91bmQgJHt1bnVzZWRJbXBvcnRzLmxlbmd0aH0gdW51c2VkIGltcG9ydHNgKTtcbiAgICAgIHJldHVybiB1bnVzZWRJbXBvcnRzO1xuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBGYWlsZWQgdG8gYW5hbHl6ZSB1bnVzZWQgaW1wb3J0czonLCBlcnJvcik7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENhdGVnb3JpemUgaW1wb3J0cyBieSBzYWZldHkgbGV2ZWxcbiAgICovXG4gIHByaXZhdGUgY2F0ZWdvcml6ZUltcG9ydHModW51c2VkSW1wb3J0czogVW51c2VkSW1wb3J0W10pOiB7XG4gICAgc2FmZTogVW51c2VkSW1wb3J0W107XG4gICAgcmV2aWV3OiBVbnVzZWRJbXBvcnRbXTtcbiAgICBwcmVzZXJ2ZTogVW51c2VkSW1wb3J0W107XG4gIH0ge1xuICAgIGNvbnNvbGUubG9nKCfwn5OLIENhdGVnb3JpemluZyBpbXBvcnRzIGJ5IHNhZmV0eSBsZXZlbC4uLicpO1xuXG4gICAgY29uc3QgY2F0ZWdvcml6ZWQgPSB7XG4gICAgICBzYWZlOiBbXSBhcyBVbnVzZWRJbXBvcnRbXSxcbiAgICAgIHJldmlldzogW10gYXMgVW51c2VkSW1wb3J0W10sXG4gICAgICBwcmVzZXJ2ZTogW10gYXMgVW51c2VkSW1wb3J0W11cbiAgICB9O1xuXG4gICAgZm9yIChjb25zdCB1bnVzZWRJbXBvcnQgb2YgdW51c2VkSW1wb3J0cykge1xuICAgICAgY29uc3QgY2F0ZWdvcnkgPSB0aGlzLmRldGVybWluZUltcG9ydFNhZmV0eSh1bnVzZWRJbXBvcnQpO1xuICAgICAgdW51c2VkSW1wb3J0LnNldmVyaXR5ID0gY2F0ZWdvcnkuc2V2ZXJpdHk7XG4gICAgICB1bnVzZWRJbXBvcnQucmVhc29uID0gY2F0ZWdvcnkucmVhc29uO1xuXG4gICAgICBzd2l0Y2ggKGNhdGVnb3J5LnNldmVyaXR5KSB7XG4gICAgICAgIGNhc2UgJ3NhZmUnOlxuICAgICAgICAgIGNhdGVnb3JpemVkLnNhZmUucHVzaCh1bnVzZWRJbXBvcnQpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdyZXZpZXcnOlxuICAgICAgICAgIGNhdGVnb3JpemVkLnJldmlldy5wdXNoKHVudXNlZEltcG9ydCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ3ByZXNlcnZlJzpcbiAgICAgICAgICBjYXRlZ29yaXplZC5wcmVzZXJ2ZS5wdXNoKHVudXNlZEltcG9ydCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIGNhdGVnb3JpemVkO1xuICB9XG5cbiAgLyoqXG4gICAqIERldGVybWluZSB0aGUgc2FmZXR5IGxldmVsIG9mIHJlbW92aW5nIGFuIGltcG9ydFxuICAgKi9cbiAgcHJpdmF0ZSBkZXRlcm1pbmVJbXBvcnRTYWZldHkodW51c2VkSW1wb3J0OiBVbnVzZWRJbXBvcnQpOiB7XG4gICAgc2V2ZXJpdHk6ICdzYWZlJyB8ICdyZXZpZXcnIHwgJ3ByZXNlcnZlJztcbiAgICByZWFzb246IHN0cmluZztcbiAgfSB7XG4gICAgY29uc3QgeyBmaWxlLCBpbXBvcnROYW1lLCBtZXNzYWdlLCBpc1R5cGVJbXBvcnQgfSA9IHVudXNlZEltcG9ydDtcblxuICAgIC8vIEFsd2F5cyBwcmVzZXJ2ZSBpbXBvcnRzIGluIGNyaXRpY2FsIGFzdHJvbG9naWNhbCBmaWxlc1xuICAgIGlmICh0aGlzLmFzdHJvbG9naWNhbFBhdHRlcm5zLnNvbWUocGF0dGVybiA9PiBmaWxlLmluY2x1ZGVzKHBhdHRlcm4pKSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc2V2ZXJpdHk6ICdwcmVzZXJ2ZScsXG4gICAgICAgIHJlYXNvbjogJ0NyaXRpY2FsIGFzdHJvbG9naWNhbCBjYWxjdWxhdGlvbiBmaWxlJ1xuICAgICAgfTtcbiAgICB9XG5cbiAgICAvLyBBbHdheXMgcHJlc2VydmUgaW1wb3J0cyBpbiBjYW1wYWlnbiBzeXN0ZW0gZmlsZXNcbiAgICBpZiAodGhpcy5jYW1wYWlnblN5c3RlbVBhdHRlcm5zLnNvbWUocGF0dGVybiA9PiBmaWxlLmluY2x1ZGVzKHBhdHRlcm4pKSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc2V2ZXJpdHk6ICdwcmVzZXJ2ZScsXG4gICAgICAgIHJlYXNvbjogJ0NhbXBhaWduIHN5c3RlbSBpbnRlbGxpZ2VuY2UgZmlsZSdcbiAgICAgIH07XG4gICAgfVxuXG4gICAgLy8gUHJlc2VydmUgUmVhY3QgY29tcG9uZW50IGltcG9ydHMgaW4gVFNYIGZpbGVzXG4gICAgaWYgKGltcG9ydE5hbWUubWF0Y2goL15bQS1aXS8pICYmIGZpbGUuZW5kc1dpdGgoJy50c3gnKSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc2V2ZXJpdHk6ICdwcmVzZXJ2ZScsXG4gICAgICAgIHJlYXNvbjogJ1JlYWN0IGNvbXBvbmVudCBpbXBvcnQgaW4gVFNYIGZpbGUnXG4gICAgICB9O1xuICAgIH1cblxuICAgIC8vIFByZXNlcnZlIHR5cGUgaW1wb3J0cyAobWlnaHQgYmUgdXNlZCBpbiB0eXBlIGFubm90YXRpb25zKVxuICAgIGlmIChpc1R5cGVJbXBvcnQpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHNldmVyaXR5OiAncHJlc2VydmUnLFxuICAgICAgICByZWFzb246ICdUeXBlIGltcG9ydCBtYXkgYmUgdXNlZCBpbiBhbm5vdGF0aW9ucydcbiAgICAgIH07XG4gICAgfVxuXG4gICAgLy8gU2FmZSB0byByZW1vdmU6IHNpbXBsZSB1dGlsaXR5IGltcG9ydHMgdGhhdCBhcmUgY2xlYXJseSB1bnVzZWRcbiAgICBjb25zdCBzYWZlUGF0dGVybnMgPSBbXG4gICAgICAvXlthLXpdW2EtekEtWl0qJC8sICAvLyBjYW1lbENhc2UgZnVuY3Rpb24gbmFtZXNcbiAgICAgIC9eW0EtWl9dKyQvLCAgICAgICAgIC8vIENPTlNUQU5UIG5hbWVzXG4gICAgICAvVXRpbHM/JC8sICAgICAgICAgICAvLyBVdGlsaXR5IGZ1bmN0aW9uc1xuICAgICAgL0hlbHBlciQvLCAgICAgICAgICAgLy8gSGVscGVyIGZ1bmN0aW9uc1xuICAgICAgL0NvbmZpZyQvLCAgICAgICAgICAgLy8gQ29uZmlndXJhdGlvbiBvYmplY3RzXG4gICAgICAvQ29uc3RhbnRzPyQvICAgICAgICAvLyBDb25zdGFudHNcbiAgICBdO1xuXG4gICAgaWYgKHNhZmVQYXR0ZXJucy5zb21lKHBhdHRlcm4gPT4gcGF0dGVybi50ZXN0KGltcG9ydE5hbWUpKSAmJiBcbiAgICAgICAgbWVzc2FnZS5pbmNsdWRlcygnaXMgZGVmaW5lZCBidXQgbmV2ZXIgdXNlZCcpICYmXG4gICAgICAgICFmaWxlLmluY2x1ZGVzKCcuZC50cycpKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzZXZlcml0eTogJ3NhZmUnLFxuICAgICAgICByZWFzb246ICdTaW1wbGUgdXRpbGl0eSBpbXBvcnQgdGhhdCBpcyBjbGVhcmx5IHVudXNlZCdcbiAgICAgIH07XG4gICAgfVxuXG4gICAgLy8gRGVmYXVsdCB0byByZXF1aXJpbmcgbWFudWFsIHJldmlld1xuICAgIHJldHVybiB7XG4gICAgICBzZXZlcml0eTogJ3JldmlldycsXG4gICAgICByZWFzb246ICdSZXF1aXJlcyBtYW51YWwgcmV2aWV3IGZvciBzYWZldHknXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEaXNwbGF5IGFuYWx5c2lzIHJlc3VsdHNcbiAgICovXG4gIHByaXZhdGUgZGlzcGxheUFuYWx5c2lzUmVzdWx0cyhjYXRlZ29yaXplZDoge1xuICAgIHNhZmU6IFVudXNlZEltcG9ydFtdO1xuICAgIHJldmlldzogVW51c2VkSW1wb3J0W107XG4gICAgcHJlc2VydmU6IFVudXNlZEltcG9ydFtdO1xuICB9KTogdm9pZCB7XG4gICAgY29uc29sZS5sb2coJ1xcbvCfk4ogSW1wb3J0IEFuYWx5c2lzIFJlc3VsdHM6Jyk7XG4gICAgY29uc29sZS5sb2coYOKchSBTYWZlIHRvIHJlbW92ZTogJHtjYXRlZ29yaXplZC5zYWZlLmxlbmd0aH1gKTtcbiAgICBjb25zb2xlLmxvZyhg4pqg77iPICBSZXF1aXJlcyByZXZpZXc6ICR7Y2F0ZWdvcml6ZWQucmV2aWV3Lmxlbmd0aH1gKTtcbiAgICBjb25zb2xlLmxvZyhg8J+boe+4jyAgUHJlc2VydmVkIChjcml0aWNhbCk6ICR7Y2F0ZWdvcml6ZWQucHJlc2VydmUubGVuZ3RofVxcbmApO1xuXG4gICAgaWYgKGNhdGVnb3JpemVkLnNhZmUubGVuZ3RoID4gMCkge1xuICAgICAgY29uc29sZS5sb2coJ+KchSBTYWZlIHRvIFJlbW92ZTonKTtcbiAgICAgIHRoaXMuZGlzcGxheUltcG9ydHNCeUZpbGUoY2F0ZWdvcml6ZWQuc2FmZSk7XG4gICAgfVxuXG4gICAgaWYgKGNhdGVnb3JpemVkLnByZXNlcnZlLmxlbmd0aCA+IDApIHtcbiAgICAgIGNvbnNvbGUubG9nKCdcXG7wn5uh77iPICBQcmVzZXJ2ZWQgKENyaXRpY2FsKTonKTtcbiAgICAgIHRoaXMuZGlzcGxheUltcG9ydHNCeUZpbGUoY2F0ZWdvcml6ZWQucHJlc2VydmUuc2xpY2UoMCwgMTApKTsgLy8gU2hvdyBmaXJzdCAxMFxuICAgICAgaWYgKGNhdGVnb3JpemVkLnByZXNlcnZlLmxlbmd0aCA+IDEwKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGAgICAuLi4gYW5kICR7Y2F0ZWdvcml6ZWQucHJlc2VydmUubGVuZ3RoIC0gMTB9IG1vcmVgKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoY2F0ZWdvcml6ZWQucmV2aWV3Lmxlbmd0aCA+IDApIHtcbiAgICAgIGNvbnNvbGUubG9nKCdcXG7imqDvuI8gIFJlcXVpcmVzIE1hbnVhbCBSZXZpZXc6Jyk7XG4gICAgICB0aGlzLmRpc3BsYXlJbXBvcnRzQnlGaWxlKGNhdGVnb3JpemVkLnJldmlldy5zbGljZSgwLCA1KSk7IC8vIFNob3cgZmlyc3QgNVxuICAgICAgaWYgKGNhdGVnb3JpemVkLnJldmlldy5sZW5ndGggPiA1KSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGAgICAuLi4gYW5kICR7Y2F0ZWdvcml6ZWQucmV2aWV3Lmxlbmd0aCAtIDV9IG1vcmVgKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogRGlzcGxheSBpbXBvcnRzIGdyb3VwZWQgYnkgZmlsZVxuICAgKi9cbiAgcHJpdmF0ZSBkaXNwbGF5SW1wb3J0c0J5RmlsZShpbXBvcnRzOiBVbnVzZWRJbXBvcnRbXSk6IHZvaWQge1xuICAgIGNvbnN0IGdyb3VwZWRCeUZpbGUgPSBpbXBvcnRzLnJlZHVjZSgoYWNjLCBpbXApID0+IHtcbiAgICAgIGNvbnN0IHJlbGF0aXZlUGF0aCA9IHBhdGgucmVsYXRpdmUocHJvY2Vzcy5jd2QoKSwgaW1wLmZpbGUpO1xuICAgICAgaWYgKCFhY2NbcmVsYXRpdmVQYXRoXSkgYWNjW3JlbGF0aXZlUGF0aF0gPSBbXTtcbiAgICAgIGFjY1tyZWxhdGl2ZVBhdGhdLnB1c2goaW1wKTtcbiAgICAgIHJldHVybiBhY2M7XG4gICAgfSwge30gYXMgUmVjb3JkPHN0cmluZywgVW51c2VkSW1wb3J0W10+KTtcblxuICAgIE9iamVjdC5lbnRyaWVzKGdyb3VwZWRCeUZpbGUpLmZvckVhY2goKFtmaWxlLCBmaWxlSW1wb3J0c10pID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKGAgICDwn5OEICR7ZmlsZX06YCk7XG4gICAgICBmaWxlSW1wb3J0cy5mb3JFYWNoKGltcCA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKGAgICAgICAtIExpbmUgJHtpbXAubGluZX06ICcke2ltcC5pbXBvcnROYW1lfScgKCR7aW1wLnJlYXNvbn0pYCk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZW1vdmUgc2FmZSBpbXBvcnRzIHVzaW5nIEVTTGludCBhdXRvLWZpeFxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyByZW1vdmVTYWZlSW1wb3J0cyhzYWZlSW1wb3J0czogVW51c2VkSW1wb3J0W10pOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICBjb25zb2xlLmxvZyhgXFxu8J+Xke+4jyAgUmVtb3ZpbmcgJHtzYWZlSW1wb3J0cy5sZW5ndGh9IHNhZmUgdW51c2VkIGltcG9ydHMuLi5gKTtcblxuICAgIHRyeSB7XG4gICAgICAvLyBSdW4gRVNMaW50IGF1dG8tZml4IHdpdGggZm9jdXNlZCB1bnVzZWQgdmFyaWFibGUgcmVtb3ZhbFxuICAgICAgZXhlY1N5bmMoJ3lhcm4gbGludCAtLWZpeCAtLXJ1bGUgXCJAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdW51c2VkLXZhcnM6IGVycm9yXCInLCB7IFxuICAgICAgICBzdGRpbzogJ3BpcGUnLFxuICAgICAgICBlbmNvZGluZzogJ3V0ZjgnXG4gICAgICB9KTtcblxuICAgICAgY29uc29sZS5sb2coJ+KchSBTYWZlIGltcG9ydCByZW1vdmFsIGNvbXBsZXRlZCcpO1xuICAgICAgcmV0dXJuIHRydWU7XG5cbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICAvLyBFU0xpbnQgcmV0dXJucyBub24temVybyBleGl0IGNvZGUgZXZlbiBmb3Igc3VjY2Vzc2Z1bCBmaXhlc1xuICAgICAgaWYgKGVycm9yLnN0ZG91dCAmJiAhZXJyb3Iuc3Rkb3V0LmluY2x1ZGVzKCdlcnJvcicpKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCfinIUgU2FmZSBpbXBvcnQgcmVtb3ZhbCBjb21wbGV0ZWQnKTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zb2xlLmVycm9yKCfinYwgU2FmZSBpbXBvcnQgcmVtb3ZhbCBmYWlsZWQ6JywgZXJyb3IubWVzc2FnZSk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVmFsaWRhdGUgY2hhbmdlcyBieSBydW5uaW5nIFR5cGVTY3JpcHQgY2hlY2sgYW5kIGJ1aWxkXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIHZhbGlkYXRlQ2hhbmdlcygpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICBjb25zb2xlLmxvZygnXFxu8J+UjSBWYWxpZGF0aW5nIGNoYW5nZXMuLi4nKTtcbiAgICBcbiAgICB0cnkge1xuICAgICAgLy8gQ2hlY2sgVHlwZVNjcmlwdCBjb21waWxhdGlvblxuICAgICAgZXhlY1N5bmMoJ3lhcm4gdHNjIC0tbm9FbWl0IC0tc2tpcExpYkNoZWNrJywgeyBcbiAgICAgICAgc3RkaW86ICdwaXBlJyxcbiAgICAgICAgZW5jb2Rpbmc6ICd1dGY4J1xuICAgICAgfSk7XG4gICAgICBjb25zb2xlLmxvZygn4pyFIFR5cGVTY3JpcHQgdmFsaWRhdGlvbiBwYXNzZWQnKTtcblxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBWYWxpZGF0aW9uIGZhaWxlZCcpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgY3VycmVudCBpbXBvcnQgc3RhdGlzdGljc1xuICAgKi9cbiAgcHVibGljIGdldEltcG9ydFN0YXRzKCk6IHtcbiAgICB0b3RhbEZpbGVzOiBudW1iZXI7XG4gICAgdW51c2VkSW1wb3J0czogbnVtYmVyO1xuICAgIHR5cGVTY3JpcHRGaWxlczogbnVtYmVyO1xuICB9IHtcbiAgICB0cnkge1xuICAgICAgLy8gQ291bnQgVHlwZVNjcmlwdC9KYXZhU2NyaXB0IGZpbGVzXG4gICAgICBjb25zdCB0b3RhbEZpbGVzT3V0cHV0ID0gZXhlY1N5bmMoJ2ZpbmQgc3JjIC1uYW1lIFwiKi50c1wiIC1vIC1uYW1lIFwiKi50c3hcIiAtbyAtbmFtZSBcIiouanNcIiAtbyAtbmFtZSBcIiouanN4XCIgfCB3YyAtbCcsIHtcbiAgICAgICAgZW5jb2Rpbmc6ICd1dGY4J1xuICAgICAgfSk7XG4gICAgICBjb25zdCB0b3RhbEZpbGVzID0gcGFyc2VJbnQodG90YWxGaWxlc091dHB1dC50cmltKCkpIHx8IDA7XG5cbiAgICAgIC8vIENvdW50IFR5cGVTY3JpcHQgZmlsZXMgc3BlY2lmaWNhbGx5XG4gICAgICBjb25zdCB0c0ZpbGVzT3V0cHV0ID0gZXhlY1N5bmMoJ2ZpbmQgc3JjIC1uYW1lIFwiKi50c1wiIC1vIC1uYW1lIFwiKi50c3hcIiB8IHdjIC1sJywge1xuICAgICAgICBlbmNvZGluZzogJ3V0ZjgnXG4gICAgICB9KTtcbiAgICAgIGNvbnN0IHR5cGVTY3JpcHRGaWxlcyA9IHBhcnNlSW50KHRzRmlsZXNPdXRwdXQudHJpbSgpKSB8fCAwO1xuXG4gICAgICAvLyBDb3VudCB1bnVzZWQgaW1wb3J0IHdhcm5pbmdzIChhcHByb3hpbWF0ZSlcbiAgICAgIGNvbnN0IHVudXNlZEltcG9ydHNPdXRwdXQgPSBleGVjU3luYygneWFybiBsaW50IC0tZm9ybWF0PWNvbXBhY3QgMj4mMSB8IGdyZXAgLUUgXCJAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdW51c2VkLXZhcnMuKmlzIGRlZmluZWQgYnV0IG5ldmVyIHVzZWRcIiB8IHdjIC1sJywge1xuICAgICAgICBlbmNvZGluZzogJ3V0ZjgnXG4gICAgICB9KTtcbiAgICAgIGNvbnN0IHVudXNlZEltcG9ydHMgPSBwYXJzZUludCh1bnVzZWRJbXBvcnRzT3V0cHV0LnRyaW0oKSkgfHwgMDtcblxuICAgICAgcmV0dXJuIHsgdG90YWxGaWxlcywgdW51c2VkSW1wb3J0cywgdHlwZVNjcmlwdEZpbGVzIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHJldHVybiB7IHRvdGFsRmlsZXM6IDAsIHVudXNlZEltcG9ydHM6IDAsIHR5cGVTY3JpcHRGaWxlczogMCB9O1xuICAgIH1cbiAgfVxufSJdLCJ2ZXJzaW9uIjozfQ==