cb2489867806513846e33e43f3923ed7
"use strict";
/**
 * Centralized Logging Service for WhatToEatNext
 *
 * Provides structured logging with different levels and contexts.
 * Replaces console.log statements in production code while preserving
 * console.warn and console.error for debugging purposes.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.LoggingService = exports.log = exports.LogLevel = void 0;
var LogLevel;
(function (LogLevel) {
    LogLevel[LogLevel["DEBUG"] = 0] = "DEBUG";
    LogLevel[LogLevel["INFO"] = 1] = "INFO";
    LogLevel[LogLevel["WARN"] = 2] = "WARN";
    LogLevel[LogLevel["ERROR"] = 3] = "ERROR";
    LogLevel[LogLevel["SILENT"] = 4] = "SILENT";
})(LogLevel || (exports.LogLevel = LogLevel = {}));
class LoggingService {
    static instance;
    logLevel = LogLevel.INFO;
    isDevelopment;
    logBuffer = [];
    maxBufferSize = 1000;
    constructor() {
        this.isDevelopment = process.env.NODE_ENV === 'development';
        // Set log level based on environment
        if (this.isDevelopment) {
            this.logLevel = LogLevel.DEBUG;
        }
        else if (process.env.NODE_ENV === 'test') {
            this.logLevel = LogLevel.WARN;
        }
        else {
            this.logLevel = LogLevel.INFO;
        }
    }
    static getInstance() {
        if (!LoggingService.instance) {
            LoggingService.instance = new LoggingService();
        }
        return LoggingService.instance;
    }
    setLogLevel(level) {
        this.logLevel = level;
    }
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    debug(message, context, data) {
        this.log(LogLevel.DEBUG, message, context, undefined, data);
    }
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    info(message, context, data) {
        this.log(LogLevel.INFO, message, context, undefined, data);
    }
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    warn(message, context, data) {
        this.log(LogLevel.WARN, message, context, undefined, data);
    }
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    error(message, context, error, data) {
        this.log(LogLevel.ERROR, message, context, error, data);
    }
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    log(level, message, context, error, data) {
        if (level < this.logLevel) {
            return;
        }
        const logEntry = {
            timestamp: new Date(),
            level,
            message,
            context,
            error,
            data,
        };
        // Add to buffer
        this.addToBuffer(logEntry);
        // Output to console based on level and environment
        this.outputToConsole(logEntry);
    }
    addToBuffer(entry) {
        this.logBuffer.push(entry);
        // Maintain buffer size
        if (this.logBuffer.length > this.maxBufferSize) {
            this.logBuffer.shift();
        }
    }
    outputToConsole(entry) {
        const timestamp = entry.timestamp.toISOString();
        const contextStr = entry.context ? this.formatContext(entry.context) : '';
        const levelStr = LogLevel[entry.level];
        const baseMessage = `[${timestamp}] ${levelStr}: ${entry.message}${contextStr}`;
        switch (entry.level) {
            case LogLevel.DEBUG:
                if (this.isDevelopment) {
                    exports.log.info(`🐛 ${baseMessage}`, entry.data || '');
                }
                break;
            case LogLevel.INFO:
                exports.log.info(`ℹ️ ${baseMessage}`, entry.data || '');
                break;
            case LogLevel.WARN:
                console.warn(`⚠️ ${baseMessage}`, entry.data || '');
                break;
            case LogLevel.ERROR:
                console.error(`❌ ${baseMessage}`, entry.error || entry.data || '');
                break;
        }
    }
    formatContext(context) {
        const parts = [];
        if (context.component)
            parts.push(`component=${context.component}`);
        if (context.service)
            parts.push(`service=${context.service}`);
        if (context.function)
            parts.push(`function=${context.function}`);
        if (context.userId)
            parts.push(`user=${context.userId}`);
        if (context.sessionId)
            parts.push(`session=${context.sessionId}`);
        if (context.requestId)
            parts.push(`request=${context.requestId}`);
        // Add other context properties
        Object.keys(context).forEach(key => {
            if (!['component', 'service', 'function', 'userId', 'sessionId', 'requestId'].includes(key)) {
                parts.push(`${key}=${context[key]}`);
            }
        });
        return parts.length > 0 ? ` [${parts.join(', ')}]` : '';
    }
    getLogBuffer() {
        return [...this.logBuffer];
    }
    clearLogBuffer() {
        this.logBuffer = [];
    }
    exportLogs() {
        return this.logBuffer
            .map(entry => {
            const timestamp = entry.timestamp.toISOString();
            const level = LogLevel[entry.level];
            const context = entry.context ? this.formatContext(entry.context) : '';
            const errorStr = entry.error ? ` ERROR: ${entry.error.message}` : '';
            const dataStr = entry.data ? ` DATA: ${JSON.stringify(entry.data)}` : '';
            return `[${timestamp}] ${level}: ${entry.message}${context}${errorStr}${dataStr}`;
        })
            .join('\n');
    }
}
exports.LoggingService = LoggingService;
// Create singleton instance
const logger = LoggingService.getInstance();
// Export convenience functions
// eslint-disable-next-line @typescript-eslint/no-explicit-any
exports.log = {
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    debug: (message, context, data) => logger.debug(message, context, data),
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    info: (message, context, data) => logger.info(message, context, data),
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    warn: (message, context, data) => logger.warn(message, context, data),
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    error: (message, context, error, data) => logger.error(message, context, error, data),
};
exports.default = logger;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9zZXJ2aWNlcy9Mb2dnaW5nU2VydmljZS50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7OztHQU1HOzs7QUFFSCxJQUFZLFFBTVg7QUFORCxXQUFZLFFBQVE7SUFDbEIseUNBQVMsQ0FBQTtJQUNULHVDQUFRLENBQUE7SUFDUix1Q0FBUSxDQUFBO0lBQ1IseUNBQVMsQ0FBQTtJQUNULDJDQUFVLENBQUE7QUFDWixDQUFDLEVBTlcsUUFBUSx3QkFBUixRQUFRLFFBTW5CO0FBeUJELE1BQU0sY0FBYztJQUNWLE1BQU0sQ0FBQyxRQUFRLENBQWlCO0lBQ2hDLFFBQVEsR0FBYSxRQUFRLENBQUMsSUFBSSxDQUFDO0lBQ25DLGFBQWEsQ0FBVTtJQUN2QixTQUFTLEdBQWUsRUFBRSxDQUFDO0lBQzNCLGFBQWEsR0FBRyxJQUFJLENBQUM7SUFFN0I7UUFDRSxJQUFJLENBQUMsYUFBYSxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsUUFBUSxLQUFLLGFBQWEsQ0FBQztRQUU1RCxxQ0FBcUM7UUFDckMsSUFBSSxJQUFJLENBQUMsYUFBYSxFQUFFO1lBQ3RCLElBQUksQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFDLEtBQUssQ0FBQztTQUNoQzthQUFNLElBQUksT0FBTyxDQUFDLEdBQUcsQ0FBQyxRQUFRLEtBQUssTUFBTSxFQUFFO1lBQzFDLElBQUksQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQztTQUMvQjthQUFNO1lBQ0wsSUFBSSxDQUFDLFFBQVEsR0FBRyxRQUFRLENBQUMsSUFBSSxDQUFDO1NBQy9CO0lBQ0gsQ0FBQztJQUVNLE1BQU0sQ0FBQyxXQUFXO1FBQ3ZCLElBQUksQ0FBQyxjQUFjLENBQUMsUUFBUSxFQUFFO1lBQzVCLGNBQWMsQ0FBQyxRQUFRLEdBQUcsSUFBSSxjQUFjLEVBQUUsQ0FBQztTQUNoRDtRQUNELE9BQU8sY0FBYyxDQUFDLFFBQVEsQ0FBQztJQUNqQyxDQUFDO0lBRU0sV0FBVyxD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QixFQUFFLEtBQWEsRUFBRSxJQUFVLEVBQUUsRUFBRSxDQUMxRSxNQUFNLENBQUMsS0FBSyxDQUFDLE9BQU8sRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLElBQUksQ0FBQztDQUM5QyxDQUFDO0FBSUYsa0JBQWUsTUFBTSxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9HcmVnQ2FzdHJvL0Rlc2t0b3AvV2hhdFRvRWF0TmV4dC9zcmMvc2VydmljZXMvTG9nZ2luZ1NlcnZpY2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDZW50cmFsaXplZCBMb2dnaW5nIFNlcnZpY2UgZm9yIFdoYXRUb0VhdE5leHRcbiAqXG4gKiBQcm92aWRlcyBzdHJ1Y3R1cmVkIGxvZ2dpbmcgd2l0aCBkaWZmZXJlbnQgbGV2ZWxzIGFuZCBjb250ZXh0cy5cbiAqIFJlcGxhY2VzIGNvbnNvbGUubG9nIHN0YXRlbWVudHMgaW4gcHJvZHVjdGlvbiBjb2RlIHdoaWxlIHByZXNlcnZpbmdcbiAqIGNvbnNvbGUud2FybiBhbmQgY29uc29sZS5lcnJvciBmb3IgZGVidWdnaW5nIHB1cnBvc2VzLlxuICovXG5cbmV4cG9ydCBlbnVtIExvZ0xldmVsIHtcbiAgREVCVUcgPSAwLFxuICBJTkZPID0gMSxcbiAgV0FSTiA9IDIsXG4gIEVSUk9SID0gMyxcbiAgU0lMRU5UID0gNCxcbn1cblxuZXhwb3J0IGludGVyZmFjZSBMb2dDb250ZXh0IHtcbiAgY29tcG9uZW50Pzogc3RyaW5nO1xuICBzZXJ2aWNlPzogc3RyaW5nO1xuICBmdW5jdGlvbj86IHN0cmluZztcbiAgdXNlcklkPzogc3RyaW5nO1xuICBzZXNzaW9uSWQ/OiBzdHJpbmc7XG4gIHJlcXVlc3RJZD86IHN0cmluZztcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbiAgLy8gSW50ZW50aW9uYWxseSBhbnk6IExvZ2dpbmcgY29udGV4dCBuZWVkcyBmbGV4aWJpbGl0eSBmb3IgdmFyaW91cyBtZXRhZGF0YVxuICBba2V5OiBzdHJpbmddOiBhbnk7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgTG9nRW50cnkge1xuICB0aW1lc3RhbXA6IERhdGU7XG4gIGxldmVsOiBMb2dMZXZlbDtcbiAgbWVzc2FnZTogc3RyaW5nO1xuICBjb250ZXh0PzogTG9nQ29udGV4dDtcbiAgZXJyb3I/OiBFcnJvcjtcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbiAgLy8gSW50ZW50aW9uYWxseSBhbnk6IExvZyBkYXRhIGNhbiBiZSBvZiBhbnkgdHlwZSBmb3IgZGVidWdnaW5nIHB1cnBvc2VzXG4gIGRhdGE/OiBhbnk7XG59XG5cbmNsYXNzIExvZ2dpbmdTZXJ2aWNlIHtcbiAgcHJpdmF0ZSBzdGF0aWMgaW5zdGFuY2U6IExvZ2dpbmdTZXJ2aWNlO1xuICBwcml2YXRlIGxvZ0xldmVsOiBMb2dMZXZlbCA9IExvZ0xldmVsLklORk87XG4gIHByaXZhdGUgaXNEZXZlbG9wbWVudDogYm9vbGVhbjtcbiAgcHJpdmF0ZSBsb2dCdWZmZXI6IExvZ0VudHJ5W10gPSBbXTtcbiAgcHJpdmF0ZSBtYXhCdWZmZXJTaXplID0gMTAwMDtcblxuICBwcml2YXRlIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuaXNEZXZlbG9wbWVudCA9IHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnO1xuXG4gICAgLy8gU2V0IGxvZyBsZXZlbCBiYXNlZCBvbiBlbnZpcm9ubWVudFxuICAgIGlmICh0aGlzLmlzRGV2ZWxvcG1lbnQpIHtcbiAgICAgIHRoaXMubG9nTGV2ZWwgPSBMb2dMZXZlbC5ERUJVRztcbiAgICB9IGVsc2UgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAndGVzdCcpIHtcbiAgICAgIHRoaXMubG9nTGV2ZWwgPSBMb2dMZXZlbC5XQVJOO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmxvZ0xldmVsID0gTG9nTGV2ZWwuSU5GTztcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgc3RhdGljIGdldEluc3RhbmNlKCk6IExvZ2dpbmdTZXJ2aWNlIHtcbiAgICBpZiAoIUxvZ2dpbmdTZXJ2aWNlLmluc3RhbmNlKSB7XG4gICAgICBMb2dnaW5nU2VydmljZS5pbnN0YW5jZSA9IG5ldyBMb2dnaW5nU2VydmljZSgpO1xuICAgIH1cbiAgICByZXR1cm4gTG9nZ2luZ1NlcnZpY2UuaW5zdGFuY2U7XG4gIH1cblxuICBwdWJsaWMgc2V0TG9nTGV2ZWwobGV2ZWw6IExvZ0xldmVsKTogdm9pZCB7XG4gICAgdGhpcy5sb2dMZXZlbCA9IGxldmVsO1xuICB9XG5cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbiAgcHVibGljIGRlYnVnKG1lc3NhZ2U6IHN0cmluZywgY29udGV4dD86IExvZ0NvbnRleHQsIGRhdGE/OiBhbnkpOiB2b2lkIHtcbiAgICB0aGlzLmxvZyhMb2dMZXZlbC5ERUJVRywgbWVzc2FnZSwgY29udGV4dCwgdW5kZWZpbmVkLCBkYXRhKTtcbiAgfVxuXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4gIHB1YmxpYyBpbmZvKG1lc3NhZ2U6IHN0cmluZywgY29udGV4dD86IExvZ0NvbnRleHQsIGRhdGE/OiBhbnkpOiB2b2lkIHtcbiAgICB0aGlzLmxvZyhMb2dMZXZlbC5JTkZPLCBtZXNzYWdlLCBjb250ZXh0LCB1bmRlZmluZWQsIGRhdGEpO1xuICB9XG5cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbiAgcHVibGljIHdhcm4obWVzc2FnZTogc3RyaW5nLCBjb250ZXh0PzogTG9nQ29udGV4dCwgZGF0YT86IGFueSk6IHZvaWQge1xuICAgIHRoaXMubG9nKExvZ0xldmVsLldBUk4sIG1lc3NhZ2UsIGNvbnRleHQsIHVuZGVmaW5lZCwgZGF0YSk7XG4gIH1cblxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICBwdWJsaWMgZXJyb3IobWVzc2FnZTogc3RyaW5nLCBjb250ZXh0PzogTG9nQ29udGV4dCwgZXJyb3I/OiBFcnJvciwgZGF0YT86IGFueSk6IHZvaWQge1xuICAgIHRoaXMubG9nKExvZ0xldmVsLkVSUk9SLCBtZXNzYWdlLCBjb250ZXh0LCBlcnJvciwgZGF0YSk7XG4gIH1cblxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICBwcml2YXRlIGxvZyhcbiAgICBsZXZlbDogTG9nTGV2ZWwsXG4gICAgbWVzc2FnZTogc3RyaW5nLFxuICAgIGNvbnRleHQ/OiBMb2dDb250ZXh0LFxuICAgIGVycm9yPzogRXJyb3IsXG4gICAgZGF0YT86IHVua25vd24sXG4gICk6IHZvaWQge1xuICAgIGlmIChsZXZlbCA8IHRoaXMubG9nTGV2ZWwpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBsb2dFbnRyeTogTG9nRW50cnkgPSB7XG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAgICBsZXZlbCxcbiAgICAgIG1lc3NhZ2UsXG4gICAgICBjb250ZXh0LFxuICAgICAgZXJyb3IsXG4gICAgICBkYXRhLFxuICAgIH07XG5cbiAgICAvLyBBZGQgdG8gYnVmZmVyXG4gICAgdGhpcy5hZGRUb0J1ZmZlcihsb2dFbnRyeSk7XG5cbiAgICAvLyBPdXRwdXQgdG8gY29uc29sZSBiYXNlZCBvbiBsZXZlbCBhbmQgZW52aXJvbm1lbnRcbiAgICB0aGlzLm91dHB1dFRvQ29uc29sZShsb2dFbnRyeSk7XG4gIH1cblxuICBwcml2YXRlIGFkZFRvQnVmZmVyKGVudHJ5OiBMb2dFbnRyeSk6IHZvaWQge1xuICAgIHRoaXMubG9nQnVmZmVyLnB1c2goZW50cnkpO1xuXG4gICAgLy8gTWFpbnRhaW4gYnVmZmVyIHNpemVcbiAgICBpZiAodGhpcy5sb2dCdWZmZXIubGVuZ3RoID4gdGhpcy5tYXhCdWZmZXJTaXplKSB7XG4gICAgICB0aGlzLmxvZ0J1ZmZlci5zaGlmdCgpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgb3V0cHV0VG9Db25zb2xlKGVudHJ5OiBMb2dFbnRyeSk6IHZvaWQge1xuICAgIGNvbnN0IHRpbWVzdGFtcCA9IGVudHJ5LnRpbWVzdGFtcC50b0lTT1N0cmluZygpO1xuICAgIGNvbnN0IGNvbnRleHRTdHIgPSBlbnRyeS5jb250ZXh0ID8gdGhpcy5mb3JtYXRDb250ZXh0KGVudHJ5LmNvbnRleHQpIDogJyc7XG4gICAgY29uc3QgbGV2ZWxTdHIgPSBMb2dMZXZlbFtlbnRyeS5sZXZlbF07XG5cbiAgICBjb25zdCBiYXNlTWVzc2FnZSA9IGBbJHt0aW1lc3RhbXB9XSAke2xldmVsU3RyfTogJHtlbnRyeS5tZXNzYWdlfSR7Y29udGV4dFN0cn1gO1xuXG4gICAgc3dpdGNoIChlbnRyeS5sZXZlbCkge1xuICAgICAgY2FzZSBMb2dMZXZlbC5ERUJVRzpcbiAgICAgICAgaWYgKHRoaXMuaXNEZXZlbG9wbWVudCkge1xuICAgICAgICAgIGxvZy5pbmZvKGDwn5CbICR7YmFzZU1lc3NhZ2V9YCwgZW50cnkuZGF0YSB8fCAnJyk7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgTG9nTGV2ZWwuSU5GTzpcbiAgICAgICAgbG9nLmluZm8oYOKEue+4jyAke2Jhc2VNZXNzYWdlfWAsIGVudHJ5LmRhdGEgfHwgJycpO1xuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSBMb2dMZXZlbC5XQVJOOlxuICAgICAgICBjb25zb2xlLndhcm4oYOKaoO+4jyAke2Jhc2VNZXNzYWdlfWAsIGVudHJ5LmRhdGEgfHwgJycpO1xuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSBMb2dMZXZlbC5FUlJPUjpcbiAgICAgICAgY29uc29sZS5lcnJvcihg4p2MICR7YmFzZU1lc3NhZ2V9YCwgZW50cnkuZXJyb3IgfHwgZW50cnkuZGF0YSB8fCAnJyk7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZm9ybWF0Q29udGV4dChjb250ZXh0OiBMb2dDb250ZXh0KTogc3RyaW5nIHtcbiAgICBjb25zdCBwYXJ0czogc3RyaW5nW10gPSBbXTtcblxuICAgIGlmIChjb250ZXh0LmNvbXBvbmVudCkgcGFydHMucHVzaChgY29tcG9uZW50PSR7Y29udGV4dC5jb21wb25lbnR9YCk7XG4gICAgaWYgKGNvbnRleHQuc2VydmljZSkgcGFydHMucHVzaChgc2VydmljZT0ke2NvbnRleHQuc2VydmljZX1gKTtcbiAgICBpZiAoY29udGV4dC5mdW5jdGlvbikgcGFydHMucHVzaChgZnVuY3Rpb249JHtjb250ZXh0LmZ1bmN0aW9ufWApO1xuICAgIGlmIChjb250ZXh0LnVzZXJJZCkgcGFydHMucHVzaChgdXNlcj0ke2NvbnRleHQudXNlcklkfWApO1xuICAgIGlmIChjb250ZXh0LnNlc3Npb25JZCkgcGFydHMucHVzaChgc2Vzc2lvbj0ke2NvbnRleHQuc2Vzc2lvbklkfWApO1xuICAgIGlmIChjb250ZXh0LnJlcXVlc3RJZCkgcGFydHMucHVzaChgcmVxdWVzdD0ke2NvbnRleHQucmVxdWVzdElkfWApO1xuXG4gICAgLy8gQWRkIG90aGVyIGNvbnRleHQgcHJvcGVydGllc1xuICAgIE9iamVjdC5rZXlzKGNvbnRleHQpLmZvckVhY2goa2V5ID0+IHtcbiAgICAgIGlmICghWydjb21wb25lbnQnLCAnc2VydmljZScsICdmdW5jdGlvbicsICd1c2VySWQnLCAnc2Vzc2lvbklkJywgJ3JlcXVlc3RJZCddLmluY2x1ZGVzKGtleSkpIHtcbiAgICAgICAgcGFydHMucHVzaChgJHtrZXl9PSR7Y29udGV4dFtrZXldfWApO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIHBhcnRzLmxlbmd0aCA+IDAgPyBgIFske3BhcnRzLmpvaW4oJywgJyl9XWAgOiAnJztcbiAgfVxuXG4gIHB1YmxpYyBnZXRMb2dCdWZmZXIoKTogTG9nRW50cnlbXSB7XG4gICAgcmV0dXJuIFsuLi50aGlzLmxvZ0J1ZmZlcl07XG4gIH1cblxuICBwdWJsaWMgY2xlYXJMb2dCdWZmZXIoKTogdm9pZCB7XG4gICAgdGhpcy5sb2dCdWZmZXIgPSBbXTtcbiAgfVxuXG4gIHB1YmxpYyBleHBvcnRMb2dzKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMubG9nQnVmZmVyXG4gICAgICAubWFwKGVudHJ5ID0+IHtcbiAgICAgICAgY29uc3QgdGltZXN0YW1wID0gZW50cnkudGltZXN0YW1wLnRvSVNPU3RyaW5nKCk7XG4gICAgICAgIGNvbnN0IGxldmVsID0gTG9nTGV2ZWxbZW50cnkubGV2ZWxdO1xuICAgICAgICBjb25zdCBjb250ZXh0ID0gZW50cnkuY29udGV4dCA/IHRoaXMuZm9ybWF0Q29udGV4dChlbnRyeS5jb250ZXh0KSA6ICcnO1xuICAgICAgICBjb25zdCBlcnJvclN0ciA9IGVudHJ5LmVycm9yID8gYCBFUlJPUjogJHtlbnRyeS5lcnJvci5tZXNzYWdlfWAgOiAnJztcbiAgICAgICAgY29uc3QgZGF0YVN0ciA9IGVudHJ5LmRhdGEgPyBgIERBVEE6ICR7SlNPTi5zdHJpbmdpZnkoZW50cnkuZGF0YSl9YCA6ICcnO1xuXG4gICAgICAgIHJldHVybiBgWyR7dGltZXN0YW1wfV0gJHtsZXZlbH06ICR7ZW50cnkubWVzc2FnZX0ke2NvbnRleHR9JHtlcnJvclN0cn0ke2RhdGFTdHJ9YDtcbiAgICAgIH0pXG4gICAgICAuam9pbignXFxuJyk7XG4gIH1cbn1cblxuLy8gQ3JlYXRlIHNpbmdsZXRvbiBpbnN0YW5jZVxuY29uc3QgbG9nZ2VyID0gTG9nZ2luZ1NlcnZpY2UuZ2V0SW5zdGFuY2UoKTtcblxuLy8gRXhwb3J0IGNvbnZlbmllbmNlIGZ1bmN0aW9uc1xuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbmV4cG9ydCBjb25zdCBsb2cgPSB7XG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4gIGRlYnVnOiAobWVzc2FnZTogc3RyaW5nLCBjb250ZXh0PzogTG9nQ29udGV4dCwgZGF0YT86IGFueSkgPT5cbiAgICBsb2dnZXIuZGVidWcobWVzc2FnZSwgY29udGV4dCwgZGF0YSksXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4gIGluZm86IChtZXNzYWdlOiBzdHJpbmcsIGNvbnRleHQ/OiBMb2dDb250ZXh0LCBkYXRhPzogYW55KSA9PiBsb2dnZXIuaW5mbyhtZXNzYWdlLCBjb250ZXh0LCBkYXRhKSxcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbiAgd2FybjogKG1lc3NhZ2U6IHN0cmluZywgY29udGV4dD86IExvZ0NvbnRleHQsIGRhdGE/OiBhbnkpID0+IGxvZ2dlci53YXJuKG1lc3NhZ2UsIGNvbnRleHQsIGRhdGEpLFxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICBlcnJvcjogKG1lc3NhZ2U6IHN0cmluZywgY29udGV4dD86IExvZ0NvbnRleHQsIGVycm9yPzogRXJyb3IsIGRhdGE/OiBhbnkpID0+XG4gICAgbG9nZ2VyLmVycm9yKG1lc3NhZ2UsIGNvbnRleHQsIGVycm9yLCBkYXRhKSxcbn07XG5cbi8vIEV4cG9ydCBzZXJ2aWNlIGZvciBhZHZhbmNlZCB1c2FnZVxuZXhwb3J0IHsgTG9nZ2luZ1NlcnZpY2UgfTtcbmV4cG9ydCBkZWZhdWx0IGxvZ2dlcjtcbiJdLCJ2ZXJzaW9uIjozfQ==