c547fa8f824398e9b6221a5c75911a20
"use strict";
/**
 * LintingAnalysisService - Main integration service for linting error analysis
 *
 * This service orchestrates the complete linting analysis workflow, integrating
 * error analysis, classification, domain detection, and resolution strategy generation.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.LintingAnalysisService = void 0;
const LoggingService_1 = require("@/services/LoggingService");
const DomainContextDetector_1 = require("./DomainContextDetector");
const ErrorClassificationSystem_1 = require("./ErrorClassificationSystem");
const LintingErrorAnalyzer_1 = require("./LintingErrorAnalyzer");
const ResolutionStrategyGenerator_1 = require("./ResolutionStrategyGenerator");
/**
 * Main LintingAnalysisService class
 */
class LintingAnalysisService {
    errorAnalyzer;
    classificationSystem;
    domainDetector;
    strategyGenerator;
    constructor(workspaceRoot) {
        this.errorAnalyzer = new LintingErrorAnalyzer_1.LintingErrorAnalyzer(workspaceRoot);
        this.classificationSystem = new ErrorClassificationSystem_1.ErrorClassificationSystem();
        this.domainDetector = new DomainContextDetector_1.DomainContextDetector(workspaceRoot);
        this.strategyGenerator = new ResolutionStrategyGenerator_1.ResolutionStrategyGenerator();
    }
    /**
     * Perform comprehensive linting analysis
     */
    async performComprehensiveAnalysis(options = {}) {
        const startTime = Date.now();
        LoggingService_1.log.info('🚀 Starting comprehensive linting analysis...');
        try {
            // Step 1: Analyze all linting issues
            LoggingService_1.log.info('📊 Analyzing linting issues...');
            const categorizedErrors = await this.errorAnalyzer.analyzeAllIssues();
            // Step 2: Classify errors with detailed analysis
            LoggingService_1.log.info('🔍 Classifying errors...');
            const classifications = await this.classifyErrors(categorizedErrors, options.focusAreas);
            // Step 3: Analyze files for domain context (if requested)
            let fileAnalyses = [];
            if (options.includeFileAnalysis !== false) {
                LoggingService_1.log.info('🏗️ Analyzing domain contexts...');
                fileAnalyses = await this.analyzeFileContexts(categorizedErrors);
            }
            // Step 4: Generate resolution strategies (if requested)
            let resolutionStrategies = [];
            let optimizedPlan = this.createEmptyPlan();
            if (options.generateStrategies !== false) {
                LoggingService_1.log.info('🎯 Generating resolution strategies...');
                const strategyResult = await this.generateResolutionStrategies(categorizedErrors, classifications, fileAnalyses, options.projectContext || {});
                resolutionStrategies = strategyResult.strategies;
                optimizedPlan = strategyResult.optimizedPlan;
            }
            // Step 5: Generate summary and recommendations
            LoggingService_1.log.info('📋 Generating recommendations...');
            const summary = this.generateSummary(categorizedErrors, classifications, resolutionStrategies);
            const recommendations = this.generateRecommendations(categorizedErrors, classifications, resolutionStrategies, options);
            // Step 6: Calculate metrics
            const metrics = this.calculateMetrics(startTime, categorizedErrors, classifications, fileAnalyses, resolutionStrategies);
            const result = {
                summary,
                categorizedErrors,
                fileAnalyses,
                resolutionStrategies,
                optimizedPlan,
                recommendations,
                metrics,
            };
            LoggingService_1.log.info('✅ Comprehensive analysis complete ?? undefined');
            this.logAnalysisResults(result);
            return result;
        }
        catch (error) {
            console.error('❌ Analysis failed:', error);
            throw error;
        }
    }
    /**
     * Quick analysis for immediate insights
     */
    async performQuickAnalysis() {
        LoggingService_1.log.info('⚡ Performing quick linting analysis...');
        const categorizedErrors = await this.errorAnalyzer.analyzeAllIssues();
        const classifications = await this.classifyErrors(categorizedErrors);
        // Get top issues by frequency
        const issueFrequency = new Map();
        for (const issue of Object.values(categorizedErrors.byCategory).flat()) {
            const count = issueFrequency.get(issue.rule) || 0;
            issueFrequency.set(issue.rule, count + 1);
        }
        const topIssues = Array.from(issueFrequency.entries())
            .sort((a, b) => b[1] - a[1])
            .slice(0, 5)
            .map(([rule]) => Object.values(categorizedErrors.byCategory)
            .flat()
            .find(i => i.rule === rule))
            .filter((issue) => issue !== undefined)
            .filter(Boolean);
        // Get quick wins (auto-fixable, low risk)
        const quickWins = categorizedErrors.autoFixable
            .filter(issue => {
            const classification = classifications.find(c => c.ruleId === issue.rule);
            return classification && classification.riskProfile.overall === 'low';
        })
            .slice(0, 10);
        // Get critical issues
        const criticalIssues = Object.values(categorizedErrors.byCategory)
            .flat()
            .filter(issue => {
            const classification = classifications.find(c => c.ruleId === issue.rule);
            return classification && classification.severity.level === 'critical';
        });
        const summary = this.generateSummary(categorizedErrors, classifications, []);
        return { summary, topIssues, quickWins, criticalIssues };
    }
    /**
     * Classify all errors with detailed analysis
     */
    async classifyErrors(categorizedErrors, focusAreas) {
        const allIssues = Object.values(categorizedErrors.byCategory).flat();
        const classifications = [];
        for (const issue of allIssues) {
            // Skip if not in focus areas
            if (focusAreas && !focusAreas.includes(issue.category.primary)) {
                continue;
            }
            const classification = this.classificationSystem.classifyError(issue.rule, issue.message, issue.file, issue.autoFixable);
            classifications.push(classification);
        }
        return classifications;
    }
    /**
     * Analyze file contexts for domain detection
     */
    async analyzeFileContexts(categorizedErrors) {
        const uniqueFiles = Array.from(new Set(Object.values(categorizedErrors.byCategory)
            .flat()
            .map(issue => issue.file)));
        return await this.domainDetector.analyzeFiles(uniqueFiles);
    }
    /**
     * Generate resolution strategies
     */
    async generateResolutionStrategies(categorizedErrors, classifications, fileAnalyses, projectContext) {
        const contexts = [];
        const allIssues = Object.values(categorizedErrors.byCategory).flat();
        // Create default project context
        const fullProjectContext = {
            hasTests: true,
            hasCICD: false,
            teamSize: 'small',
            riskTolerance: 'moderate',
            timeConstraints: 'moderate',
            ...projectContext,
        };
        for (const issue of allIssues) {
            const classification = classifications.find(c => c.ruleId === issue.rule);
            const fileAnalysis = fileAnalyses.find(f => f.filePath === issue.file);
            if (classification && fileAnalysis) {
                contexts.push({
                    errorClassification: classification,
                    domainContext: fileAnalysis.domainContext,
                    fileAnalysis,
                    projectContext: fullProjectContext,
                });
            }
        }
        return this.strategyGenerator.generateBatchStrategies(contexts);
    }
    /**
     * Generate analysis summary
     */
    generateSummary(categorizedErrors, classifications, strategies) {
        const criticalClassifications = classifications.filter(c => c.severity.level === 'critical');
        const domainSpecificIssues = Object.values(categorizedErrors.byCategory)
            .flat()
            .filter(issue => issue.domainContext?.requiresSpecialHandling);
        const estimatedTime = strategies.reduce((sum, s) => sum + s.estimatedTime, 0);
        // Determine overall risk level
        const highRiskCount = classifications.filter(c => c.riskProfile.overall === 'high').length;
        const criticalRiskCount = classifications.filter(c => c.riskProfile.overall === 'critical').length;
        let overallRiskLevel = 'low';
        if (criticalRiskCount > 0)
            overallRiskLevel = 'critical';
        else if (highRiskCount > 10)
            overallRiskLevel = 'high';
        else if (highRiskCount > 0 || categorizedErrors.errors > 50)
            overallRiskLevel = 'medium';
        return {
            totalIssues: categorizedErrors.total,
            errorCount: categorizedErrors.errors,
            warningCount: categorizedErrors.warnings,
            autoFixableCount: categorizedErrors.autoFixable.length,
            domainSpecificCount: domainSpecificIssues.length,
            criticalIssuesCount: criticalClassifications.length,
            estimatedResolutionTime: estimatedTime,
            overallRiskLevel,
        };
    }
    /**
     * Generate actionable recommendations
     */
    generateRecommendations(categorizedErrors, classifications, strategies, options) {
        const recommendations = [];
        // Immediate actions for critical issues
        const criticalIssues = classifications.filter(c => c.severity.level === 'critical');
        if (criticalIssues.length > 0) {
            recommendations.push({
                type: 'immediate',
                priority: 'critical',
                title: 'Address Critical Linting Issues',
                description: `${criticalIssues.length} critical issues require immediate attention`,
                rationale: 'Critical issues can block builds or cause runtime failures',
                estimatedImpact: 'high',
                actionItems: [
                    'Review each critical issue individually',
                    'Fix or suppress critical issues before proceeding',
                    'Validate fixes with comprehensive testing',
                ],
            });
        }
        // Quick wins for auto-fixable issues
        if (categorizedErrors.autoFixable.length > 10) {
            recommendations.push({
                type: 'immediate',
                priority: 'high',
                title: 'Apply Automated Fixes',
                description: `${categorizedErrors.autoFixable.length} issues can be automatically fixed`,
                rationale: 'Automated fixes provide immediate improvement with minimal risk',
                estimatedImpact: 'medium',
                actionItems: [
                    'Run ESLint with --fix flag for safe auto-fixes',
                    'Validate changes with build and test suite',
                    'Review auto-fixed changes before committing',
                ],
            });
        }
        // Domain-specific handling
        const domainIssues = Object.values(categorizedErrors.byCategory)
            .flat()
            .filter(issue => issue.domainContext?.requiresSpecialHandling);
        if (domainIssues.length > 0) {
            recommendations.push({
                type: 'short-term',
                priority: 'high',
                title: 'Handle Domain-Specific Issues',
                description: `${domainIssues.length} issues require domain expertise`,
                rationale: 'Domain-specific code needs specialized knowledge for safe modification',
                estimatedImpact: 'high',
                actionItems: [
                    'Schedule review with domain experts',
                    'Create domain-specific linting rules',
                    'Document domain-specific patterns and exceptions',
                ],
            });
        }
        // TypeScript improvements
        const tsIssues = categorizedErrors.byCategory['typescript'] || [];
        if (tsIssues.length > 20) {
            recommendations.push({
                type: 'short-term',
                priority: 'medium',
                title: 'Improve TypeScript Usage',
                description: `${tsIssues.length} TypeScript-related issues found`,
                rationale: 'Better TypeScript usage improves code quality and maintainability',
                estimatedImpact: 'medium',
                actionItems: [
                    'Replace explicit any types with proper types',
                    'Fix unused variable warnings',
                    'Improve type definitions for better inference',
                ],
            });
        }
        // Long-term strategy
        if (categorizedErrors.total > 100) {
            recommendations.push({
                type: 'long-term',
                priority: 'medium',
                title: 'Implement Systematic Linting Improvement',
                description: 'Large number of issues suggests need for systematic approach',
                rationale: 'Systematic improvement prevents issue accumulation',
                estimatedImpact: 'high',
                actionItems: [
                    'Implement pre-commit hooks for linting',
                    'Set up CI/CD linting validation',
                    'Create team linting standards and guidelines',
                    'Regular linting debt reduction sprints',
                ],
            });
        }
        // Strategic recommendations based on options
        if (options.riskTolerance === 'conservative') {
            recommendations.push({
                type: 'strategic',
                priority: 'low',
                title: 'Enhance Code Quality Processes',
                description: 'Conservative approach suggests focus on quality processes',
                rationale: 'Strong processes prevent issues from being introduced',
                estimatedImpact: 'high',
                actionItems: [
                    'Implement stricter linting rules',
                    'Require code review for all changes',
                    'Set up automated quality gates',
                    'Regular code quality audits',
                ],
            });
        }
        return recommendations;
    }
    /**
     * Calculate comprehensive metrics
     */
    calculateMetrics(startTime, categorizedErrors, classifications, fileAnalyses, strategies) {
        const analysisTime = Date.now() - startTime;
        const filesAnalyzed = fileAnalyses.length;
        // Get unique rules triggered
        const rulesTriggered = Array.from(new Set(Object.values(categorizedErrors.byCategory)
            .flat()
            .map(issue => issue.rule)));
        // Calculate domain distribution
        const domainDistribution = {};
        for (const analysis of fileAnalyses) {
            const domain = analysis.domainContext.type;
            domainDistribution[domain] = (domainDistribution[domain] || 0) + 1;
        }
        // Calculate severity distribution
        const severityDistribution = {};
        for (const classification of classifications) {
            const severity = classification.severity.level;
            severityDistribution[severity] = (severityDistribution[severity] || 0) + 1;
        }
        // Calculate complexity distribution
        const complexityDistribution = {};
        for (const strategy of strategies) {
            const complexity = strategy.complexity;
            complexityDistribution[complexity] = (complexityDistribution[complexity] || 0) + 1;
        }
        // Calculate confidence scores
        const confidenceScores = strategies.map(s => s.confidence);
        const average = confidenceScores.reduce((sum, score) => sum + score, 0) / confidenceScores.length || 0;
        const sorted = [...confidenceScores].sort((a, b) => a - b);
        const median = sorted[Math.floor(sorted.length / 2)] || 0;
        const confidenceDistribution = {};
        for (const score of confidenceScores) {
            const bucket = score < 0.3 ? 'low' : score < 0.7 ? 'medium' : 'high';
            confidenceDistribution[bucket] = (confidenceDistribution[bucket] || 0) + 1;
        }
        return {
            analysisTime,
            filesAnalyzed,
            rulesTriggered,
            domainDistribution,
            severityDistribution,
            complexityDistribution,
            confidenceScores: {
                average,
                median,
                distribution: confidenceDistribution,
            },
        };
    }
    /**
     * Create empty optimization plan
     */
    createEmptyPlan() {
        return {
            totalStrategies: 0,
            totalEstimatedTime: 0,
            totalSteps: 0,
            executionOrder: [],
            parallelizableWork: 0,
            riskDistribution: {},
            recommendations: [],
        };
    }
    /**
     * Log analysis results
     */
    logAnalysisResults(result) {
        LoggingService_1.log.info('\n🎯 COMPREHENSIVE LINTING ANALYSIS RESULTS');
        LoggingService_1.log.info('==========================================');
        LoggingService_1.log.info(`📊 Total Issues: ${result.summary.totalIssues}`);
        LoggingService_1.log.info(`❌ Errors: ${result.summary.errorCount}`);
        LoggingService_1.log.info(`⚠️  Warnings: ${result.summary.warningCount}`);
        LoggingService_1.log.info(`🔧 Auto-fixable: ${result.summary.autoFixableCount}`);
        LoggingService_1.log.info(`🏗️ Domain-specific: ${result.summary.domainSpecificCount}`);
        LoggingService_1.log.info(`🚨 Critical: ${result.summary.criticalIssuesCount}`);
        LoggingService_1.log.info(`⏱️ Estimated Resolution Time: ${result.summary.estimatedResolutionTime} minutes`);
        LoggingService_1.log.info(`🎚️ Overall Risk Level: ${result.summary.overallRiskLevel.toUpperCase()}`);
        LoggingService_1.log.info('\n📋 TOP RECOMMENDATIONS:');
        result.recommendations
            .filter(r => r.priority === 'critical' || r.priority === 'high')
            .slice(0, 3)
            .forEach((rec, index) => {
            LoggingService_1.log.info(`${index + 1}. ${rec.title} (${rec.priority.toUpperCase()})`);
            LoggingService_1.log.info(`   ${rec.description}`);
        });
        LoggingService_1.log.info('\n📈 ANALYSIS METRICS:');
        LoggingService_1.log.info(`⏱️ Analysis Time: ${result.metrics.analysisTime}ms`);
        LoggingService_1.log.info(`📁 Files Analyzed: ${result.metrics.filesAnalyzed}`);
        LoggingService_1.log.info(`📏 Rules Triggered: ${result.metrics.rulesTriggered.length}`);
        LoggingService_1.log.info(`🎯 Average Confidence: ${Math.round(result.metrics.confidenceScores.average * 100)}%`);
        LoggingService_1.log.info('==========================================\n');
    }
}
exports.LintingAnalysisService = LintingAnalysisService;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L2JhY2t1cHMvZmlyc3Qtd2F2ZS0yMDI1LTA4LTExVDA1LTE5LTI2LTgxM1ovc3JjL3NlcnZpY2VzL2xpbnRpbmcvTGludGluZ0FuYWx5c2lzU2VydmljZS50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7O0dBS0c7OztBQUVILDhEQUFnRDtBQUVoRCxtRUFBNkY7QUFDN0YsMkVBQTZGO0FBQzdGLGlFQUErRjtBQUMvRiwrRUFNdUM7QUF1RHZDOztHQUVHO0FBQ0gsTUFBYSxzQkFBc0I7SUFDekIsYUFBYSxDQUF1QjtJQUNwQyxvQkFBb0IsQ0FBNEI7SUFDaEQsY0FBYyxDQUF3QjtJQUN0QyxpQkFBaUIsQ0FBOEI7SUFFdkQsWUFBWSxhQUFzQjtRQUNoQyxJQUFJLENBQUMsYUFBYSxHQUFHLElBQUksMkNBQW9CLENBQUMsYUFBYSxDQUFDLENBQUM7UUFDN0QsSUFBSSxDQUFDLG9CQUFvQixHQUFHLElBQUkscURBQXlCLEVBQUUsQ0FBQztRQUM1RCxJQUFJLENBQUMsY0FBYyxHQUFHLElBQUksNkNBQXFCLENBQUMsYUFBYSxDQUFDLENBQUM7UUFDL0QsSUFBSSxDQUFDLGlCQUFpQixHQUFHLElBQUkseURBQTJCLEVBQUUsQ0FBQztJQUM3RCxDQUFDO0lBRUQ7O09BRUc7SUFDSCxLQUFLLENBQUMsNEJBQTRCLENBQ2hDLFVBQWtDLEVBQUU7UUFFcEMsTUFBTSxTQUFTLEdBQUcsSUFBSSxDQUFDLEdBQUcsRUFBRSxDQUFDO1FBRTdCLG9CQUFHLENBQUMsSUFBSSxDQUFDLCtDQUErQyxDQUFDLENBQUM7UUFFMUQsSUFBSTtZQUNGLHFDQUFxQztZQUNyQyxvQkFBRyxDQUFDLElBQUksQ0FBQyxnQ0FBZ0MsQ0FBQyxDQUFDO1lBQzNDLE1BQU0saUJBQWlCLEdBQUcsTUFBTSxJQUFJLENBQUMsYUFBYSxDQUFDLGdCQUFnQixFQUFFLENBQUM7WUFFdEUsaURBQWlEO1lBQ2pELG9CQUFHLENBQUMsSUFBSSxDQUFDLDBCQUEwQixD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QUMsTUFBTSxHQUFHLENBQUMsV0FBVyxFQUFFLENBQUMsQ0FBQztRQUNwQyxDQUFDLENBQUMsQ0FBQztRQUVMLG9CQUFHLENBQUMsSUFBSSxDQUFDLHdCQUF3QixDQUFDLENBQUM7UUFDbkMsb0JBQUcsQ0FBQyxJQUFJLENBQUMscUJBQXFCLE1BQU0sQ0FBQyxPQUFPLENBQUMsWUFBWSxJQUFJLENBQUMsQ0FBQztRQUMvRCxvQkFBRyxDQUFDLElBQUksQ0FBQyxzQkFBc0IsTUFBTSxDQUFDLE9BQU8sQ0FBQyxhQUFhLEVBQUUsQ0FBQyxDQUFDO1FBQy9ELG9CQUFHLENBQUMsSUFBSSxDQUFDLHVCQUF1QixNQUFNLENBQUMsT0FBTyxDQUFDLGNBQWMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDO1FBQ3hFLG9CQUFHLENBQUMsSUFBSSxDQUNOLDBCQUEwQixJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxHQUFHLEdBQUcsQ0FBQyxHQUFHLENBQ3ZGLENBQUM7UUFFRixvQkFBRyxDQUFDLElBQUksQ0FBQyw4Q0FBOEMsQ0FBQyxDQUFDO0lBQzNELENBQUM7Q0FDRjtBQW5nQkQsd0RBbWdCQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvR3JlZ0Nhc3Ryby9EZXNrdG9wL1doYXRUb0VhdE5leHQvYmFja3Vwcy9maXJzdC13YXZlLTIwMjUtMDgtMTFUMDUtMTktMjYtODEzWi9zcmMvc2VydmljZXMvbGludGluZy9MaW50aW5nQW5hbHlzaXNTZXJ2aWNlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogTGludGluZ0FuYWx5c2lzU2VydmljZSAtIE1haW4gaW50ZWdyYXRpb24gc2VydmljZSBmb3IgbGludGluZyBlcnJvciBhbmFseXNpc1xuICpcbiAqIFRoaXMgc2VydmljZSBvcmNoZXN0cmF0ZXMgdGhlIGNvbXBsZXRlIGxpbnRpbmcgYW5hbHlzaXMgd29ya2Zsb3csIGludGVncmF0aW5nXG4gKiBlcnJvciBhbmFseXNpcywgY2xhc3NpZmljYXRpb24sIGRvbWFpbiBkZXRlY3Rpb24sIGFuZCByZXNvbHV0aW9uIHN0cmF0ZWd5IGdlbmVyYXRpb24uXG4gKi9cblxuaW1wb3J0IHsgbG9nIH0gZnJvbSAnQC9zZXJ2aWNlcy9Mb2dnaW5nU2VydmljZSc7XG5cbmltcG9ydCB7IERvbWFpbkNvbnRleHREZXRlY3RvciwgRmlsZUFuYWx5c2lzLCBEb21haW5Db250ZXh0IH0gZnJvbSAnLi9Eb21haW5Db250ZXh0RGV0ZWN0b3InO1xuaW1wb3J0IHsgRXJyb3JDbGFzc2lmaWNhdGlvblN5c3RlbSwgRXJyb3JDbGFzc2lmaWNhdGlvbiB9IGZyb20gJy4vRXJyb3JDbGFzc2lmaWNhdGlvblN5c3RlbSc7XG5pbXBvcnQgeyBMaW50aW5nRXJyb3JBbmFseXplciwgQ2F0ZWdvcml6ZWRFcnJvcnMsIExpbnRpbmdJc3N1ZSB9IGZyb20gJy4vTGludGluZ0Vycm9yQW5hbHl6ZXInO1xuaW1wb3J0IHtcbiAgUmVzb2x1dGlvblN0cmF0ZWd5R2VuZXJhdG9yLFxuICBSZXNvbHV0aW9uU3RyYXRlZ3ksXG4gIFN0cmF0ZWd5R2VuZXJhdGlvbkNvbnRleHQsXG4gIFByb2plY3RDb250ZXh0LFxuICBPcHRpbWl6ZWRSZXNvbHV0aW9uUGxhbixcbn0gZnJvbSAnLi9SZXNvbHV0aW9uU3RyYXRlZ3lHZW5lcmF0b3InO1xuXG5leHBvcnQgaW50ZXJmYWNlIENvbXByZWhlbnNpdmVBbmFseXNpc1Jlc3VsdCB7XG4gIHN1bW1hcnk6IEFuYWx5c2lzU3VtbWFyeTtcbiAgY2F0ZWdvcml6ZWRFcnJvcnM6IENhdGVnb3JpemVkRXJyb3JzO1xuICBmaWxlQW5hbHlzZXM6IEZpbGVBbmFseXNpc1tdO1xuICByZXNvbHV0aW9uU3RyYXRlZ2llczogUmVzb2x1dGlvblN0cmF0ZWd5W107XG4gIG9wdGltaXplZFBsYW46IE9wdGltaXplZFJlc29sdXRpb25QbGFuO1xuICByZWNvbW1lbmRhdGlvbnM6IEFuYWx5c2lzUmVjb21tZW5kYXRpb25bXTtcbiAgbWV0cmljczogQW5hbHlzaXNNZXRyaWNzO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEFuYWx5c2lzU3VtbWFyeSB7XG4gIHRvdGFsSXNzdWVzOiBudW1iZXI7XG4gIGVycm9yQ291bnQ6IG51bWJlcjtcbiAgd2FybmluZ0NvdW50OiBudW1iZXI7XG4gIGF1dG9GaXhhYmxlQ291bnQ6IG51bWJlcjtcbiAgZG9tYWluU3BlY2lmaWNDb3VudDogbnVtYmVyO1xuICBjcml0aWNhbElzc3Vlc0NvdW50OiBudW1iZXI7XG4gIGVzdGltYXRlZFJlc29sdXRpb25UaW1lOiBudW1iZXI7XG4gIG92ZXJhbGxSaXNrTGV2ZWw6ICdsb3cnIHwgJ21lZGl1bScgfCAnaGlnaCcgfCAnY3JpdGljYWwnO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEFuYWx5c2lzUmVjb21tZW5kYXRpb24ge1xuICB0eXBlOiAnaW1tZWRpYXRlJyB8ICdzaG9ydC10ZXJtJyB8ICdsb25nLXRlcm0nIHwgJ3N0cmF0ZWdpYyc7XG4gIHByaW9yaXR5OiAnY3JpdGljYWwnIHwgJ2hpZ2gnIHwgJ21lZGl1bScgfCAnbG93JztcbiAgdGl0bGU6IHN0cmluZztcbiAgZGVzY3JpcHRpb246IHN0cmluZztcbiAgcmF0aW9uYWxlOiBzdHJpbmc7XG4gIGVzdGltYXRlZEltcGFjdDogJ2hpZ2gnIHwgJ21lZGl1bScgfCAnbG93JztcbiAgYWN0aW9uSXRlbXM6IHN0cmluZ1tdO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEFuYWx5c2lzTWV0cmljcyB7XG4gIGFuYWx5c2lzVGltZTogbnVtYmVyO1xuICBmaWxlc0FuYWx5emVkOiBudW1iZXI7XG4gIHJ1bGVzVHJpZ2dlcmVkOiBzdHJpbmdbXTtcbiAgZG9tYWluRGlzdHJpYnV0aW9uOiBSZWNvcmQ8c3RyaW5nLCBudW1iZXI+O1xuICBzZXZlcml0eURpc3RyaWJ1dGlvbjogUmVjb3JkPHN0cmluZywgbnVtYmVyPjtcbiAgY29tcGxleGl0eURpc3RyaWJ1dGlvbjogUmVjb3JkPHN0cmluZywgbnVtYmVyPjtcbiAgY29uZmlkZW5jZVNjb3Jlczoge1xuICAgIGF2ZXJhZ2U6IG51bWJlcjtcbiAgICBtZWRpYW46IG51bWJlcjtcbiAgICBkaXN0cmlidXRpb246IFJlY29yZDxzdHJpbmcsIG51bWJlcj47XG4gIH07XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgTGludGluZ0FuYWx5c2lzT3B0aW9ucyB7XG4gIGluY2x1ZGVGaWxlQW5hbHlzaXM/OiBib29sZWFuO1xuICBnZW5lcmF0ZVN0cmF0ZWdpZXM/OiBib29sZWFuO1xuICBwcm9qZWN0Q29udGV4dD86IFBhcnRpYWw8UHJvamVjdENvbnRleHQ+O1xuICBmb2N1c0FyZWFzPzogKCdpbXBvcnQnIHwgJ3R5cGVzY3JpcHQnIHwgJ3JlYWN0JyB8ICdzdHlsZScgfCAnZG9tYWluJylbXTtcbiAgcmlza1RvbGVyYW5jZT86ICdjb25zZXJ2YXRpdmUnIHwgJ21vZGVyYXRlJyB8ICdhZ2dyZXNzaXZlJztcbn1cblxuLyoqXG4gKiBNYWluIExpbnRpbmdBbmFseXNpc1NlcnZpY2UgY2xhc3NcbiAqL1xuZXhwb3J0IGNsYXNzIExpbnRpbmdBbmFseXNpc1NlcnZpY2Uge1xuICBwcml2YXRlIGVycm9yQW5hbHl6ZXI6IExpbnRpbmdFcnJvckFuYWx5emVyO1xuICBwcml2YXRlIGNsYXNzaWZpY2F0aW9uU3lzdGVtOiBFcnJvckNsYXNzaWZpY2F0aW9uU3lzdGVtO1xuICBwcml2YXRlIGRvbWFpbkRldGVjdG9yOiBEb21haW5Db250ZXh0RGV0ZWN0b3I7XG4gIHByaXZhdGUgc3RyYXRlZ3lHZW5lcmF0b3I6IFJlc29sdXRpb25TdHJhdGVneUdlbmVyYXRvcjtcblxuICBjb25zdHJ1Y3Rvcih3b3Jrc3BhY2VSb290Pzogc3RyaW5nKSB7XG4gICAgdGhpcy5lcnJvckFuYWx5emVyID0gbmV3IExpbnRpbmdFcnJvckFuYWx5emVyKHdvcmtzcGFjZVJvb3QpO1xuICAgIHRoaXMuY2xhc3NpZmljYXRpb25TeXN0ZW0gPSBuZXcgRXJyb3JDbGFzc2lmaWNhdGlvblN5c3RlbSgpO1xuICAgIHRoaXMuZG9tYWluRGV0ZWN0b3IgPSBuZXcgRG9tYWluQ29udGV4dERldGVjdG9yKHdvcmtzcGFjZVJvb3QpO1xuICAgIHRoaXMuc3RyYXRlZ3lHZW5lcmF0b3IgPSBuZXcgUmVzb2x1dGlvblN0cmF0ZWd5R2VuZXJhdG9yKCk7XG4gIH1cblxuICAvKipcbiAgICogUGVyZm9ybSBjb21wcmVoZW5zaXZlIGxpbnRpbmcgYW5hbHlzaXNcbiAgICovXG4gIGFzeW5jIHBlcmZvcm1Db21wcmVoZW5zaXZlQW5hbHlzaXMoXG4gICAgb3B0aW9uczogTGludGluZ0FuYWx5c2lzT3B0aW9ucyA9IHt9LFxuICApOiBQcm9taXNlPENvbXByZWhlbnNpdmVBbmFseXNpc1Jlc3VsdD4ge1xuICAgIGNvbnN0IHN0YXJ0VGltZSA9IERhdGUubm93KCk7XG5cbiAgICBsb2cuaW5mbygn8J+agCBTdGFydGluZyBjb21wcmVoZW5zaXZlIGxpbnRpbmcgYW5hbHlzaXMuLi4nKTtcblxuICAgIHRyeSB7XG4gICAgICAvLyBTdGVwIDE6IEFuYWx5emUgYWxsIGxpbnRpbmcgaXNzdWVzXG4gICAgICBsb2cuaW5mbygn8J+TiiBBbmFseXppbmcgbGludGluZyBpc3N1ZXMuLi4nKTtcbiAgICAgIGNvbnN0IGNhdGVnb3JpemVkRXJyb3JzID0gYXdhaXQgdGhpcy5lcnJvckFuYWx5emVyLmFuYWx5emVBbGxJc3N1ZXMoKTtcblxuICAgICAgLy8gU3RlcCAyOiBDbGFzc2lmeSBlcnJvcnMgd2l0aCBkZXRhaWxlZCBhbmFseXNpc1xuICAgICAgbG9nLmluZm8oJ/CflI0gQ2xhc3NpZnlpbmcgZXJyb3JzLi4uJyk7XG4gICAgICBjb25zdCBjbGFzc2lmaWNhdGlvbnMgPSBhd2FpdCB0aGlzLmNsYXNzaWZ5RXJyb3JzKGNhdGVnb3JpemVkRXJyb3JzLCBvcHRpb25zLmZvY3VzQXJlYXMpO1xuXG4gICAgICAvLyBTdGVwIDM6IEFuYWx5emUgZmlsZXMgZm9yIGRvbWFpbiBjb250ZXh0IChpZiByZXF1ZXN0ZWQpXG4gICAgICBsZXQgZmlsZUFuYWx5c2VzOiBGaWxlQW5hbHlzaXNbXSA9IFtdO1xuICAgICAgaWYgKG9wdGlvbnMuaW5jbHVkZUZpbGVBbmFseXNpcyAhPT0gZmFsc2UpIHtcbiAgICAgICAgbG9nLmluZm8oJ/Cfj5fvuI8gQW5hbHl6aW5nIGRvbWFpbiBjb250ZXh0cy4uLicpO1xuICAgICAgICBmaWxlQW5hbHlzZXMgPSBhd2FpdCB0aGlzLmFuYWx5emVGaWxlQ29udGV4dHMoY2F0ZWdvcml6ZWRFcnJvcnMpO1xuICAgICAgfVxuXG4gICAgICAvLyBTdGVwIDQ6IEdlbmVyYXRlIHJlc29sdXRpb24gc3RyYXRlZ2llcyAoaWYgcmVxdWVzdGVkKVxuICAgICAgbGV0IHJlc29sdXRpb25TdHJhdGVnaWVzOiBSZXNvbHV0aW9uU3RyYXRlZ3lbXSA9IFtdO1xuICAgICAgbGV0IG9wdGltaXplZFBsYW46IE9wdGltaXplZFJlc29sdXRpb25QbGFuID0gdGhpcy5jcmVhdGVFbXB0eVBsYW4oKTtcblxuICAgICAgaWYgKG9wdGlvbnMuZ2VuZXJhdGVTdHJhdGVnaWVzICE9PSBmYWxzZSkge1xuICAgICAgICBsb2cuaW5mbygn8J+OryBHZW5lcmF0aW5nIHJlc29sdXRpb24gc3RyYXRlZ2llcy4uLicpO1xuICAgICAgICBjb25zdCBzdHJhdGVneVJlc3VsdCA9IGF3YWl0IHRoaXMuZ2VuZXJhdGVSZXNvbHV0aW9uU3RyYXRlZ2llcyhcbiAgICAgICAgICBjYXRlZ29yaXplZEVycm9ycyxcbiAgICAgICAgICBjbGFzc2lmaWNhdGlvbnMsXG4gICAgICAgICAgZmlsZUFuYWx5c2VzLFxuICAgICAgICAgIG9wdGlvbnMucHJvamVjdENvbnRleHQgfHwge30sXG4gICAgICAgICk7XG4gICAgICAgIHJlc29sdXRpb25TdHJhdGVnaWVzID0gc3RyYXRlZ3lSZXN1bHQuc3RyYXRlZ2llcztcbiAgICAgICAgb3B0aW1pemVkUGxhbiA9IHN0cmF0ZWd5UmVzdWx0Lm9wdGltaXplZFBsYW47XG4gICAgICB9XG5cbiAgICAgIC8vIFN0ZXAgNTogR2VuZXJhdGUgc3VtbWFyeSBhbmQgcmVjb21tZW5kYXRpb25zXG4gICAgICBsb2cuaW5mbygn8J+TiyBHZW5lcmF0aW5nIHJlY29tbWVuZGF0aW9ucy4uLicpO1xuICAgICAgY29uc3Qgc3VtbWFyeSA9IHRoaXMuZ2VuZXJhdGVTdW1tYXJ5KFxuICAgICAgICBjYXRlZ29yaXplZEVycm9ycyxcbiAgICAgICAgY2xhc3NpZmljYXRpb25zLFxuICAgICAgICByZXNvbHV0aW9uU3RyYXRlZ2llcyxcbiAgICAgICk7XG4gICAgICBjb25zdCByZWNvbW1lbmRhdGlvbnMgPSB0aGlzLmdlbmVyYXRlUmVjb21tZW5kYXRpb25zKFxuICAgICAgICBjYXRlZ29yaXplZEVycm9ycyxcbiAgICAgICAgY2xhc3NpZmljYXRpb25zLFxuICAgICAgICByZXNvbHV0aW9uU3RyYXRlZ2llcyxcbiAgICAgICAgb3B0aW9ucyxcbiAgICAgICk7XG5cbiAgICAgIC8vIFN0ZXAgNjogQ2FsY3VsYXRlIG1ldHJpY3NcbiAgICAgIGNvbnN0IG1ldHJpY3MgPSB0aGlzLmNhbGN1bGF0ZU1ldHJpY3MoXG4gICAgICAgIHN0YXJ0VGltZSxcbiAgICAgICAgY2F0ZWdvcml6ZWRFcnJvcnMsXG4gICAgICAgIGNsYXNzaWZpY2F0aW9ucyxcbiAgICAgICAgZmlsZUFuYWx5c2VzLFxuICAgICAgICByZXNvbHV0aW9uU3RyYXRlZ2llcyxcbiAgICAgICk7XG5cbiAgICAgIGNvbnN0IHJlc3VsdDogQ29tcHJlaGVuc2l2ZUFuYWx5c2lzUmVzdWx0ID0ge1xuICAgICAgICBzdW1tYXJ5LFxuICAgICAgICBjYXRlZ29yaXplZEVycm9ycyxcbiAgICAgICAgZmlsZUFuYWx5c2VzLFxuICAgICAgICByZXNvbHV0aW9uU3RyYXRlZ2llcyxcbiAgICAgICAgb3B0aW1pemVkUGxhbixcbiAgICAgICAgcmVjb21tZW5kYXRpb25zLFxuICAgICAgICBtZXRyaWNzLFxuICAgICAgfTtcblxuICAgICAgbG9nLmluZm8oJ+KchSBDb21wcmVoZW5zaXZlIGFuYWx5c2lzIGNvbXBsZXRlID8/IHVuZGVmaW5lZCcpO1xuICAgICAgdGhpcy5sb2dBbmFseXNpc1Jlc3VsdHMocmVzdWx0KTtcblxuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIEFuYWx5c2lzIGZhaWxlZDonLCBlcnJvcik7XG4gICAgICB0aHJvdyBlcnJvcjtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUXVpY2sgYW5hbHlzaXMgZm9yIGltbWVkaWF0ZSBpbnNpZ2h0c1xuICAgKi9cbiAgYXN5bmMgcGVyZm9ybVF1aWNrQW5hbHlzaXMoKTogUHJvbWlzZTx7XG4gICAgc3VtbWFyeTogQW5hbHlzaXNTdW1tYXJ5O1xuICAgIHRvcElzc3VlczogTGludGluZ0lzc3VlW107XG4gICAgcXVpY2tXaW5zOiBMaW50aW5nSXNzdWVbXTtcbiAgICBjcml0aWNhbElzc3VlczogTGludGluZ0lzc3VlW107XG4gIH0+IHtcbiAgICBsb2cuaW5mbygn4pqhIFBlcmZvcm1pbmcgcXVpY2sgbGludGluZyBhbmFseXNpcy4uLicpO1xuXG4gICAgY29uc3QgY2F0ZWdvcml6ZWRFcnJvcnMgPSBhd2FpdCB0aGlzLmVycm9yQW5hbHl6ZXIuYW5hbHl6ZUFsbElzc3VlcygpO1xuICAgIGNvbnN0IGNsYXNzaWZpY2F0aW9ucyA9IGF3YWl0IHRoaXMuY2xhc3NpZnlFcnJvcnMoY2F0ZWdvcml6ZWRFcnJvcnMpO1xuXG4gICAgLy8gR2V0IHRvcCBpc3N1ZXMgYnkgZnJlcXVlbmN5XG4gICAgY29uc3QgaXNzdWVGcmVxdWVuY3kgPSBuZXcgTWFwPHN0cmluZywgbnVtYmVyPigpO1xuICAgIGZvciAoY29uc3QgaXNzdWUgb2YgT2JqZWN0LnZhbHVlcyhjYXRlZ29yaXplZEVycm9ycy5ieUNhdGVnb3J5KS5mbGF0KCkpIHtcbiAgICAgIGNvbnN0IGNvdW50ID0gaXNzdWVGcmVxdWVuY3kuZ2V0KGlzc3VlLnJ1bGUpIHx8IDA7XG4gICAgICBpc3N1ZUZyZXF1ZW5jeS5zZXQoaXNzdWUucnVsZSwgY291bnQgKyAxKTtcbiAgICB9XG5cbiAgICBjb25zdCB0b3BJc3N1ZXMgPSBBcnJheS5mcm9tKGlzc3VlRnJlcXVlbmN5LmVudHJpZXMoKSlcbiAgICAgIC5zb3J0KChhLCBiKSA9PiBiWzFdIC0gYVsxXSlcbiAgICAgIC5zbGljZSgwLCA1KVxuICAgICAgLm1hcCgoW3J1bGVdKSA9PlxuICAgICAgICBPYmplY3QudmFsdWVzKGNhdGVnb3JpemVkRXJyb3JzLmJ5Q2F0ZWdvcnkpXG4gICAgICAgICAgLmZsYXQoKVxuICAgICAgICAgIC5maW5kKGkgPT4gaS5ydWxlID09PSBydWxlKSxcbiAgICAgIClcbiAgICAgIC5maWx0ZXIoKGlzc3VlKTogaXNzdWUgaXMgTGludGluZ0lzc3VlID0+IGlzc3VlICE9PSB1bmRlZmluZWQpXG4gICAgICAuZmlsdGVyKEJvb2xlYW4pO1xuXG4gICAgLy8gR2V0IHF1aWNrIHdpbnMgKGF1dG8tZml4YWJsZSwgbG93IHJpc2spXG4gICAgY29uc3QgcXVpY2tXaW5zID0gY2F0ZWdvcml6ZWRFcnJvcnMuYXV0b0ZpeGFibGVcbiAgICAgIC5maWx0ZXIoaXNzdWUgPT4ge1xuICAgICAgICBjb25zdCBjbGFzc2lmaWNhdGlvbiA9IGNsYXNzaWZpY2F0aW9ucy5maW5kKGMgPT4gYy5ydWxlSWQgPT09IGlzc3VlLnJ1bGUpO1xuICAgICAgICByZXR1cm4gY2xhc3NpZmljYXRpb24gJiYgY2xhc3NpZmljYXRpb24ucmlza1Byb2ZpbGUub3ZlcmFsbCA9PT0gJ2xvdyc7XG4gICAgICB9KVxuICAgICAgLnNsaWNlKDAsIDEwKTtcblxuICAgIC8vIEdldCBjcml0aWNhbCBpc3N1ZXNcbiAgICBjb25zdCBjcml0aWNhbElzc3VlcyA9IE9iamVjdC52YWx1ZXMoY2F0ZWdvcml6ZWRFcnJvcnMuYnlDYXRlZ29yeSlcbiAgICAgIC5mbGF0KClcbiAgICAgIC5maWx0ZXIoaXNzdWUgPT4ge1xuICAgICAgICBjb25zdCBjbGFzc2lmaWNhdGlvbiA9IGNsYXNzaWZpY2F0aW9ucy5maW5kKGMgPT4gYy5ydWxlSWQgPT09IGlzc3VlLnJ1bGUpO1xuICAgICAgICByZXR1cm4gY2xhc3NpZmljYXRpb24gJiYgY2xhc3NpZmljYXRpb24uc2V2ZXJpdHkubGV2ZWwgPT09ICdjcml0aWNhbCc7XG4gICAgICB9KTtcblxuICAgIGNvbnN0IHN1bW1hcnkgPSB0aGlzLmdlbmVyYXRlU3VtbWFyeShjYXRlZ29yaXplZEVycm9ycywgY2xhc3NpZmljYXRpb25zLCBbXSk7XG5cbiAgICByZXR1cm4geyBzdW1tYXJ5LCB0b3BJc3N1ZXMsIHF1aWNrV2lucywgY3JpdGljYWxJc3N1ZXMgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDbGFzc2lmeSBhbGwgZXJyb3JzIHdpdGggZGV0YWlsZWQgYW5hbHlzaXNcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgY2xhc3NpZnlFcnJvcnMoXG4gICAgY2F0ZWdvcml6ZWRFcnJvcnM6IENhdGVnb3JpemVkRXJyb3JzLFxuICAgIGZvY3VzQXJlYXM/OiBzdHJpbmdbXSxcbiAgKTogUHJvbWlzZTxFcnJvckNsYXNzaWZpY2F0aW9uW10+IHtcbiAgICBjb25zdCBhbGxJc3N1ZXMgPSBPYmplY3QudmFsdWVzKGNhdGVnb3JpemVkRXJyb3JzLmJ5Q2F0ZWdvcnkpLmZsYXQoKTtcbiAgICBjb25zdCBjbGFzc2lmaWNhdGlvbnM6IEVycm9yQ2xhc3NpZmljYXRpb25bXSA9IFtdO1xuXG4gICAgZm9yIChjb25zdCBpc3N1ZSBvZiBhbGxJc3N1ZXMpIHtcbiAgICAgIC8vIFNraXAgaWYgbm90IGluIGZvY3VzIGFyZWFzXG4gICAgICBpZiAoZm9jdXNBcmVhcyAmJiAhZm9jdXNBcmVhcy5pbmNsdWRlcyhpc3N1ZS5jYXRlZ29yeS5wcmltYXJ5KSkge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgY2xhc3NpZmljYXRpb24gPSB0aGlzLmNsYXNzaWZpY2F0aW9uU3lzdGVtLmNsYXNzaWZ5RXJyb3IoXG4gICAgICAgIGlzc3VlLnJ1bGUsXG4gICAgICAgIGlzc3VlLm1lc3NhZ2UsXG4gICAgICAgIGlzc3VlLmZpbGUsXG4gICAgICAgIGlzc3VlLmF1dG9GaXhhYmxlLFxuICAgICAgKTtcblxuICAgICAgY2xhc3NpZmljYXRpb25zLnB1c2goY2xhc3NpZmljYXRpb24pO1xuICAgIH1cblxuICAgIHJldHVybiBjbGFzc2lmaWNhdGlvbnM7XG4gIH1cblxuICAvKipcbiAgICogQW5hbHl6ZSBmaWxlIGNvbnRleHRzIGZvciBkb21haW4gZGV0ZWN0aW9uXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGFuYWx5emVGaWxlQ29udGV4dHMoY2F0ZWdvcml6ZWRFcnJvcnM6IENhdGVnb3JpemVkRXJyb3JzKTogUHJvbWlzZTxGaWxlQW5hbHlzaXNbXT4ge1xuICAgIGNvbnN0IHVuaXF1ZUZpbGVzID0gQXJyYXkuZnJvbShcbiAgICAgIG5ldyBTZXQoXG4gICAgICAgIE9iamVjdC52YWx1ZXMoY2F0ZWdvcml6ZWRFcnJvcnMuYnlDYXRlZ29yeSlcbiAgICAgICAgICAuZmxhdCgpXG4gICAgICAgICAgLm1hcChpc3N1ZSA9PiBpc3N1ZS5maWxlKSxcbiAgICAgICksXG4gICAgKTtcblxuICAgIHJldHVybiBhd2FpdCB0aGlzLmRvbWFpbkRldGVjdG9yLmFuYWx5emVGaWxlcyh1bmlxdWVGaWxlcyk7XG4gIH1cblxuICAvKipcbiAgICogR2VuZXJhdGUgcmVzb2x1dGlvbiBzdHJhdGVnaWVzXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGdlbmVyYXRlUmVzb2x1dGlvblN0cmF0ZWdpZXMoXG4gICAgY2F0ZWdvcml6ZWRFcnJvcnM6IENhdGVnb3JpemVkRXJyb3JzLFxuICAgIGNsYXNzaWZpY2F0aW9uczogRXJyb3JDbGFzc2lmaWNhdGlvbltdLFxuICAgIGZpbGVBbmFseXNlczogRmlsZUFuYWx5c2lzW10sXG4gICAgcHJvamVjdENvbnRleHQ6IFBhcnRpYWw8UHJvamVjdENvbnRleHQ+LFxuICApOiBQcm9taXNlPHsgc3RyYXRlZ2llczogUmVzb2x1dGlvblN0cmF0ZWd5W107IG9wdGltaXplZFBsYW46IE9wdGltaXplZFJlc29sdXRpb25QbGFuIH0+IHtcbiAgICBjb25zdCBjb250ZXh0czogU3RyYXRlZ3lHZW5lcmF0aW9uQ29udGV4dFtdID0gW107XG4gICAgY29uc3QgYWxsSXNzdWVzID0gT2JqZWN0LnZhbHVlcyhjYXRlZ29yaXplZEVycm9ycy5ieUNhdGVnb3J5KS5mbGF0KCk7XG5cbiAgICAvLyBDcmVhdGUgZGVmYXVsdCBwcm9qZWN0IGNvbnRleHRcbiAgICBjb25zdCBmdWxsUHJvamVjdENvbnRleHQ6IFByb2plY3RDb250ZXh0ID0ge1xuICAgICAgaGFzVGVzdHM6IHRydWUsXG4gICAgICBoYXNDSUNEOiBmYWxzZSxcbiAgICAgIHRlYW1TaXplOiAnc21hbGwnLFxuICAgICAgcmlza1RvbGVyYW5jZTogJ21vZGVyYXRlJyxcbiAgICAgIHRpbWVDb25zdHJhaW50czogJ21vZGVyYXRlJyxcbiAgICAgIC4uLnByb2plY3RDb250ZXh0LFxuICAgIH07XG5cbiAgICBmb3IgKGNvbnN0IGlzc3VlIG9mIGFsbElzc3Vlcykge1xuICAgICAgY29uc3QgY2xhc3NpZmljYXRpb24gPSBjbGFzc2lmaWNhdGlvbnMuZmluZChjID0+IGMucnVsZUlkID09PSBpc3N1ZS5ydWxlKTtcbiAgICAgIGNvbnN0IGZpbGVBbmFseXNpcyA9IGZpbGVBbmFseXNlcy5maW5kKGYgPT4gZi5maWxlUGF0aCA9PT0gaXNzdWUuZmlsZSk7XG5cbiAgICAgIGlmIChjbGFzc2lmaWNhdGlvbiAmJiBmaWxlQW5hbHlzaXMpIHtcbiAgICAgICAgY29udGV4dHMucHVzaCh7XG4gICAgICAgICAgZXJyb3JDbGFzc2lmaWNhdGlvbjogY2xhc3NpZmljYXRpb24sXG4gICAgICAgICAgZG9tYWluQ29udGV4dDogZmlsZUFuYWx5c2lzLmRvbWFpbkNvbnRleHQsXG4gICAgICAgICAgZmlsZUFuYWx5c2lzLFxuICAgICAgICAgIHByb2plY3RDb250ZXh0OiBmdWxsUHJvamVjdENvbnRleHQsXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB0aGlzLnN0cmF0ZWd5R2VuZXJhdG9yLmdlbmVyYXRlQmF0Y2hTdHJhdGVnaWVzKGNvbnRleHRzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZSBhbmFseXNpcyBzdW1tYXJ5XG4gICAqL1xuICBwcml2YXRlIGdlbmVyYXRlU3VtbWFyeShcbiAgICBjYXRlZ29yaXplZEVycm9yczogQ2F0ZWdvcml6ZWRFcnJvcnMsXG4gICAgY2xhc3NpZmljYXRpb25zOiBFcnJvckNsYXNzaWZpY2F0aW9uW10sXG4gICAgc3RyYXRlZ2llczogUmVzb2x1dGlvblN0cmF0ZWd5W10sXG4gICk6IEFuYWx5c2lzU3VtbWFyeSB7XG4gICAgY29uc3QgY3JpdGljYWxDbGFzc2lmaWNhdGlvbnMgPSBjbGFzc2lmaWNhdGlvbnMuZmlsdGVyKGMgPT4gYy5zZXZlcml0eS5sZXZlbCA9PT0gJ2NyaXRpY2FsJyk7XG4gICAgY29uc3QgZG9tYWluU3BlY2lmaWNJc3N1ZXMgPSBPYmplY3QudmFsdWVzKGNhdGVnb3JpemVkRXJyb3JzLmJ5Q2F0ZWdvcnkpXG4gICAgICAuZmxhdCgpXG4gICAgICAuZmlsdGVyKGlzc3VlID0+IGlzc3VlLmRvbWFpbkNvbnRleHQ/LnJlcXVpcmVzU3BlY2lhbEhhbmRsaW5nKTtcblxuICAgIGNvbnN0IGVzdGltYXRlZFRpbWUgPSBzdHJhdGVnaWVzLnJlZHVjZSgoc3VtLCBzKSA9PiBzdW0gKyBzLmVzdGltYXRlZFRpbWUsIDApO1xuXG4gICAgLy8gRGV0ZXJtaW5lIG92ZXJhbGwgcmlzayBsZXZlbFxuICAgIGNvbnN0IGhpZ2hSaXNrQ291bnQgPSBjbGFzc2lmaWNhdGlvbnMuZmlsdGVyKGMgPT4gYy5yaXNrUHJvZmlsZS5vdmVyYWxsID09PSAnaGlnaCcpLmxlbmd0aDtcbiAgICBjb25zdCBjcml0aWNhbFJpc2tDb3VudCA9IGNsYXNzaWZpY2F0aW9ucy5maWx0ZXIoXG4gICAgICBjID0+IGMucmlza1Byb2ZpbGUub3ZlcmFsbCA9PT0gJ2NyaXRpY2FsJyxcbiAgICApLmxlbmd0aDtcblxuICAgIGxldCBvdmVyYWxsUmlza0xldmVsOiBBbmFseXNpc1N1bW1hcnlbJ292ZXJhbGxSaXNrTGV2ZWwnXSA9ICdsb3cnO1xuICAgIGlmIChjcml0aWNhbFJpc2tDb3VudCA+IDApIG92ZXJhbGxSaXNrTGV2ZWwgPSAnY3JpdGljYWwnO1xuICAgIGVsc2UgaWYgKGhpZ2hSaXNrQ291bnQgPiAxMCkgb3ZlcmFsbFJpc2tMZXZlbCA9ICdoaWdoJztcbiAgICBlbHNlIGlmIChoaWdoUmlza0NvdW50ID4gMCB8fCBjYXRlZ29yaXplZEVycm9ycy5lcnJvcnMgPiA1MCkgb3ZlcmFsbFJpc2tMZXZlbCA9ICdtZWRpdW0nO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHRvdGFsSXNzdWVzOiBjYXRlZ29yaXplZEVycm9ycy50b3RhbCxcbiAgICAgIGVycm9yQ291bnQ6IGNhdGVnb3JpemVkRXJyb3JzLmVycm9ycyxcbiAgICAgIHdhcm5pbmdDb3VudDogY2F0ZWdvcml6ZWRFcnJvcnMud2FybmluZ3MsXG4gICAgICBhdXRvRml4YWJsZUNvdW50OiBjYXRlZ29yaXplZEVycm9ycy5hdXRvRml4YWJsZS5sZW5ndGgsXG4gICAgICBkb21haW5TcGVjaWZpY0NvdW50OiBkb21haW5TcGVjaWZpY0lzc3Vlcy5sZW5ndGgsXG4gICAgICBjcml0aWNhbElzc3Vlc0NvdW50OiBjcml0aWNhbENsYXNzaWZpY2F0aW9ucy5sZW5ndGgsXG4gICAgICBlc3RpbWF0ZWRSZXNvbHV0aW9uVGltZTogZXN0aW1hdGVkVGltZSxcbiAgICAgIG92ZXJhbGxSaXNrTGV2ZWwsXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZSBhY3Rpb25hYmxlIHJlY29tbWVuZGF0aW9uc1xuICAgKi9cbiAgcHJpdmF0ZSBnZW5lcmF0ZVJlY29tbWVuZGF0aW9ucyhcbiAgICBjYXRlZ29yaXplZEVycm9yczogQ2F0ZWdvcml6ZWRFcnJvcnMsXG4gICAgY2xhc3NpZmljYXRpb25zOiBFcnJvckNsYXNzaWZpY2F0aW9uW10sXG4gICAgc3RyYXRlZ2llczogUmVzb2x1dGlvblN0cmF0ZWd5W10sXG4gICAgb3B0aW9uczogTGludGluZ0FuYWx5c2lzT3B0aW9ucyxcbiAgKTogQW5hbHlzaXNSZWNvbW1lbmRhdGlvbltdIHtcbiAgICBjb25zdCByZWNvbW1lbmRhdGlvbnM6IEFuYWx5c2lzUmVjb21tZW5kYXRpb25bXSA9IFtdO1xuXG4gICAgLy8gSW1tZWRpYXRlIGFjdGlvbnMgZm9yIGNyaXRpY2FsIGlzc3Vlc1xuICAgIGNvbnN0IGNyaXRpY2FsSXNzdWVzID0gY2xhc3NpZmljYXRpb25zLmZpbHRlcihjID0+IGMuc2V2ZXJpdHkubGV2ZWwgPT09ICdjcml0aWNhbCcpO1xuICAgIGlmIChjcml0aWNhbElzc3Vlcy5sZW5ndGggPiAwKSB7XG4gICAgICByZWNvbW1lbmRhdGlvbnMucHVzaCh7XG4gICAgICAgIHR5cGU6ICdpbW1lZGlhdGUnLFxuICAgICAgICBwcmlvcml0eTogJ2NyaXRpY2FsJyxcbiAgICAgICAgdGl0bGU6ICdBZGRyZXNzIENyaXRpY2FsIExpbnRpbmcgSXNzdWVzJyxcbiAgICAgICAgZGVzY3JpcHRpb246IGAke2NyaXRpY2FsSXNzdWVzLmxlbmd0aH0gY3JpdGljYWwgaXNzdWVzIHJlcXVpcmUgaW1tZWRpYXRlIGF0dGVudGlvbmAsXG4gICAgICAgIHJhdGlvbmFsZTogJ0NyaXRpY2FsIGlzc3VlcyBjYW4gYmxvY2sgYnVpbGRzIG9yIGNhdXNlIHJ1bnRpbWUgZmFpbHVyZXMnLFxuICAgICAgICBlc3RpbWF0ZWRJbXBhY3Q6ICdoaWdoJyxcbiAgICAgICAgYWN0aW9uSXRlbXM6IFtcbiAgICAgICAgICAnUmV2aWV3IGVhY2ggY3JpdGljYWwgaXNzdWUgaW5kaXZpZHVhbGx5JyxcbiAgICAgICAgICAnRml4IG9yIHN1cHByZXNzIGNyaXRpY2FsIGlzc3VlcyBiZWZvcmUgcHJvY2VlZGluZycsXG4gICAgICAgICAgJ1ZhbGlkYXRlIGZpeGVzIHdpdGggY29tcHJlaGVuc2l2ZSB0ZXN0aW5nJyxcbiAgICAgICAgXSxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIFF1aWNrIHdpbnMgZm9yIGF1dG8tZml4YWJsZSBpc3N1ZXNcbiAgICBpZiAoY2F0ZWdvcml6ZWRFcnJvcnMuYXV0b0ZpeGFibGUubGVuZ3RoID4gMTApIHtcbiAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKHtcbiAgICAgICAgdHlwZTogJ2ltbWVkaWF0ZScsXG4gICAgICAgIHByaW9yaXR5OiAnaGlnaCcsXG4gICAgICAgIHRpdGxlOiAnQXBwbHkgQXV0b21hdGVkIEZpeGVzJyxcbiAgICAgICAgZGVzY3JpcHRpb246IGAke2NhdGVnb3JpemVkRXJyb3JzLmF1dG9GaXhhYmxlLmxlbmd0aH0gaXNzdWVzIGNhbiBiZSBhdXRvbWF0aWNhbGx5IGZpeGVkYCxcbiAgICAgICAgcmF0aW9uYWxlOiAnQXV0b21hdGVkIGZpeGVzIHByb3ZpZGUgaW1tZWRpYXRlIGltcHJvdmVtZW50IHdpdGggbWluaW1hbCByaXNrJyxcbiAgICAgICAgZXN0aW1hdGVkSW1wYWN0OiAnbWVkaXVtJyxcbiAgICAgICAgYWN0aW9uSXRlbXM6IFtcbiAgICAgICAgICAnUnVuIEVTTGludCB3aXRoIC0tZml4IGZsYWcgZm9yIHNhZmUgYXV0by1maXhlcycsXG4gICAgICAgICAgJ1ZhbGlkYXRlIGNoYW5nZXMgd2l0aCBidWlsZCBhbmQgdGVzdCBzdWl0ZScsXG4gICAgICAgICAgJ1JldmlldyBhdXRvLWZpeGVkIGNoYW5nZXMgYmVmb3JlIGNvbW1pdHRpbmcnLFxuICAgICAgICBdLFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gRG9tYWluLXNwZWNpZmljIGhhbmRsaW5nXG4gICAgY29uc3QgZG9tYWluSXNzdWVzID0gT2JqZWN0LnZhbHVlcyhjYXRlZ29yaXplZEVycm9ycy5ieUNhdGVnb3J5KVxuICAgICAgLmZsYXQoKVxuICAgICAgLmZpbHRlcihpc3N1ZSA9PiBpc3N1ZS5kb21haW5Db250ZXh0Py5yZXF1aXJlc1NwZWNpYWxIYW5kbGluZyk7XG4gICAgaWYgKGRvbWFpbklzc3Vlcy5sZW5ndGggPiAwKSB7XG4gICAgICByZWNvbW1lbmRhdGlvbnMucHVzaCh7XG4gICAgICAgIHR5cGU6ICdzaG9ydC10ZXJtJyxcbiAgICAgICAgcHJpb3JpdHk6ICdoaWdoJyxcbiAgICAgICAgdGl0bGU6ICdIYW5kbGUgRG9tYWluLVNwZWNpZmljIElzc3VlcycsXG4gICAgICAgIGRlc2NyaXB0aW9uOiBgJHtkb21haW5Jc3N1ZXMubGVuZ3RofSBpc3N1ZXMgcmVxdWlyZSBkb21haW4gZXhwZXJ0aXNlYCxcbiAgICAgICAgcmF0aW9uYWxlOiAnRG9tYWluLXNwZWNpZmljIGNvZGUgbmVlZHMgc3BlY2lhbGl6ZWQga25vd2xlZGdlIGZvciBzYWZlIG1vZGlmaWNhdGlvbicsXG4gICAgICAgIGVzdGltYXRlZEltcGFjdDogJ2hpZ2gnLFxuICAgICAgICBhY3Rpb25JdGVtczogW1xuICAgICAgICAgICdTY2hlZHVsZSByZXZpZXcgd2l0aCBkb21haW4gZXhwZXJ0cycsXG4gICAgICAgICAgJ0NyZWF0ZSBkb21haW4tc3BlY2lmaWMgbGludGluZyBydWxlcycsXG4gICAgICAgICAgJ0RvY3VtZW50IGRvbWFpbi1zcGVjaWZpYyBwYXR0ZXJucyBhbmQgZXhjZXB0aW9ucycsXG4gICAgICAgIF0sXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBUeXBlU2NyaXB0IGltcHJvdmVtZW50c1xuICAgIGNvbnN0IHRzSXNzdWVzID0gY2F0ZWdvcml6ZWRFcnJvcnMuYnlDYXRlZ29yeVsndHlwZXNjcmlwdCddIHx8IFtdO1xuICAgIGlmICh0c0lzc3Vlcy5sZW5ndGggPiAyMCkge1xuICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goe1xuICAgICAgICB0eXBlOiAnc2hvcnQtdGVybScsXG4gICAgICAgIHByaW9yaXR5OiAnbWVkaXVtJyxcbiAgICAgICAgdGl0bGU6ICdJbXByb3ZlIFR5cGVTY3JpcHQgVXNhZ2UnLFxuICAgICAgICBkZXNjcmlwdGlvbjogYCR7dHNJc3N1ZXMubGVuZ3RofSBUeXBlU2NyaXB0LXJlbGF0ZWQgaXNzdWVzIGZvdW5kYCxcbiAgICAgICAgcmF0aW9uYWxlOiAnQmV0dGVyIFR5cGVTY3JpcHQgdXNhZ2UgaW1wcm92ZXMgY29kZSBxdWFsaXR5IGFuZCBtYWludGFpbmFiaWxpdHknLFxuICAgICAgICBlc3RpbWF0ZWRJbXBhY3Q6ICdtZWRpdW0nLFxuICAgICAgICBhY3Rpb25JdGVtczogW1xuICAgICAgICAgICdSZXBsYWNlIGV4cGxpY2l0IGFueSB0eXBlcyB3aXRoIHByb3BlciB0eXBlcycsXG4gICAgICAgICAgJ0ZpeCB1bnVzZWQgdmFyaWFibGUgd2FybmluZ3MnLFxuICAgICAgICAgICdJbXByb3ZlIHR5cGUgZGVmaW5pdGlvbnMgZm9yIGJldHRlciBpbmZlcmVuY2UnLFxuICAgICAgICBdLFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy8gTG9uZy10ZXJtIHN0cmF0ZWd5XG4gICAgaWYgKGNhdGVnb3JpemVkRXJyb3JzLnRvdGFsID4gMTAwKSB7XG4gICAgICByZWNvbW1lbmRhdGlvbnMucHVzaCh7XG4gICAgICAgIHR5cGU6ICdsb25nLXRlcm0nLFxuICAgICAgICBwcmlvcml0eTogJ21lZGl1bScsXG4gICAgICAgIHRpdGxlOiAnSW1wbGVtZW50IFN5c3RlbWF0aWMgTGludGluZyBJbXByb3ZlbWVudCcsXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnTGFyZ2UgbnVtYmVyIG9mIGlzc3VlcyBzdWdnZXN0cyBuZWVkIGZvciBzeXN0ZW1hdGljIGFwcHJvYWNoJyxcbiAgICAgICAgcmF0aW9uYWxlOiAnU3lzdGVtYXRpYyBpbXByb3ZlbWVudCBwcmV2ZW50cyBpc3N1ZSBhY2N1bXVsYXRpb24nLFxuICAgICAgICBlc3RpbWF0ZWRJbXBhY3Q6ICdoaWdoJyxcbiAgICAgICAgYWN0aW9uSXRlbXM6IFtcbiAgICAgICAgICAnSW1wbGVtZW50IHByZS1jb21taXQgaG9va3MgZm9yIGxpbnRpbmcnLFxuICAgICAgICAgICdTZXQgdXAgQ0kvQ0QgbGludGluZyB2YWxpZGF0aW9uJyxcbiAgICAgICAgICAnQ3JlYXRlIHRlYW0gbGludGluZyBzdGFuZGFyZHMgYW5kIGd1aWRlbGluZXMnLFxuICAgICAgICAgICdSZWd1bGFyIGxpbnRpbmcgZGVidCByZWR1Y3Rpb24gc3ByaW50cycsXG4gICAgICAgIF0sXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyBTdHJhdGVnaWMgcmVjb21tZW5kYXRpb25zIGJhc2VkIG9uIG9wdGlvbnNcbiAgICBpZiAob3B0aW9ucy5yaXNrVG9sZXJhbmNlID09PSAnY29uc2VydmF0aXZlJykge1xuICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goe1xuICAgICAgICB0eXBlOiAnc3RyYXRlZ2ljJyxcbiAgICAgICAgcHJpb3JpdHk6ICdsb3cnLFxuICAgICAgICB0aXRsZTogJ0VuaGFuY2UgQ29kZSBRdWFsaXR5IFByb2Nlc3NlcycsXG4gICAgICAgIGRlc2NyaXB0aW9uOiAnQ29uc2VydmF0aXZlIGFwcHJvYWNoIHN1Z2dlc3RzIGZvY3VzIG9uIHF1YWxpdHkgcHJvY2Vzc2VzJyxcbiAgICAgICAgcmF0aW9uYWxlOiAnU3Ryb25nIHByb2Nlc3NlcyBwcmV2ZW50IGlzc3VlcyBmcm9tIGJlaW5nIGludHJvZHVjZWQnLFxuICAgICAgICBlc3RpbWF0ZWRJbXBhY3Q6ICdoaWdoJyxcbiAgICAgICAgYWN0aW9uSXRlbXM6IFtcbiAgICAgICAgICAnSW1wbGVtZW50IHN0cmljdGVyIGxpbnRpbmcgcnVsZXMnLFxuICAgICAgICAgICdSZXF1aXJlIGNvZGUgcmV2aWV3IGZvciBhbGwgY2hhbmdlcycsXG4gICAgICAgICAgJ1NldCB1cCBhdXRvbWF0ZWQgcXVhbGl0eSBnYXRlcycsXG4gICAgICAgICAgJ1JlZ3VsYXIgY29kZSBxdWFsaXR5IGF1ZGl0cycsXG4gICAgICAgIF0sXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4gcmVjb21tZW5kYXRpb25zO1xuICB9XG5cbiAgLyoqXG4gICAqIENhbGN1bGF0ZSBjb21wcmVoZW5zaXZlIG1ldHJpY3NcbiAgICovXG4gIHByaXZhdGUgY2FsY3VsYXRlTWV0cmljcyhcbiAgICBzdGFydFRpbWU6IG51bWJlcixcbiAgICBjYXRlZ29yaXplZEVycm9yczogQ2F0ZWdvcml6ZWRFcnJvcnMsXG4gICAgY2xhc3NpZmljYXRpb25zOiBFcnJvckNsYXNzaWZpY2F0aW9uW10sXG4gICAgZmlsZUFuYWx5c2VzOiBGaWxlQW5hbHlzaXNbXSxcbiAgICBzdHJhdGVnaWVzOiBSZXNvbHV0aW9uU3RyYXRlZ3lbXSxcbiAgKTogQW5hbHlzaXNNZXRyaWNzIHtcbiAgICBjb25zdCBhbmFseXNpc1RpbWUgPSBEYXRlLm5vdygpIC0gc3RhcnRUaW1lO1xuICAgIGNvbnN0IGZpbGVzQW5hbHl6ZWQgPSBmaWxlQW5hbHlzZXMubGVuZ3RoO1xuXG4gICAgLy8gR2V0IHVuaXF1ZSBydWxlcyB0cmlnZ2VyZWRcbiAgICBjb25zdCBydWxlc1RyaWdnZXJlZCA9IEFycmF5LmZyb20oXG4gICAgICBuZXcgU2V0KFxuICAgICAgICBPYmplY3QudmFsdWVzKGNhdGVnb3JpemVkRXJyb3JzLmJ5Q2F0ZWdvcnkpXG4gICAgICAgICAgLmZsYXQoKVxuICAgICAgICAgIC5tYXAoaXNzdWUgPT4gaXNzdWUucnVsZSksXG4gICAgICApLFxuICAgICk7XG5cbiAgICAvLyBDYWxjdWxhdGUgZG9tYWluIGRpc3RyaWJ1dGlvblxuICAgIGNvbnN0IGRvbWFpbkRpc3RyaWJ1dGlvbjogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9O1xuICAgIGZvciAoY29uc3QgYW5hbHlzaXMgb2YgZmlsZUFuYWx5c2VzKSB7XG4gICAgICBjb25zdCBkb21haW4gPSBhbmFseXNpcy5kb21haW5Db250ZXh0LnR5cGU7XG4gICAgICBkb21haW5EaXN0cmlidXRpb25bZG9tYWluXSA9IChkb21haW5EaXN0cmlidXRpb25bZG9tYWluXSB8fCAwKSArIDE7XG4gICAgfVxuXG4gICAgLy8gQ2FsY3VsYXRlIHNldmVyaXR5IGRpc3RyaWJ1dGlvblxuICAgIGNvbnN0IHNldmVyaXR5RGlzdHJpYnV0aW9uOiBSZWNvcmQ8c3RyaW5nLCBudW1iZXI+ID0ge307XG4gICAgZm9yIChjb25zdCBjbGFzc2lmaWNhdGlvbiBvZiBjbGFzc2lmaWNhdGlvbnMpIHtcbiAgICAgIGNvbnN0IHNldmVyaXR5ID0gY2xhc3NpZmljYXRpb24uc2V2ZXJpdHkubGV2ZWw7XG4gICAgICBzZXZlcml0eURpc3RyaWJ1dGlvbltzZXZlcml0eV0gPSAoc2V2ZXJpdHlEaXN0cmlidXRpb25bc2V2ZXJpdHldIHx8IDApICsgMTtcbiAgICB9XG5cbiAgICAvLyBDYWxjdWxhdGUgY29tcGxleGl0eSBkaXN0cmlidXRpb25cbiAgICBjb25zdCBjb21wbGV4aXR5RGlzdHJpYnV0aW9uOiBSZWNvcmQ8c3RyaW5nLCBudW1iZXI+ID0ge307XG4gICAgZm9yIChjb25zdCBzdHJhdGVneSBvZiBzdHJhdGVnaWVzKSB7XG4gICAgICBjb25zdCBjb21wbGV4aXR5ID0gc3RyYXRlZ3kuY29tcGxleGl0eTtcbiAgICAgIGNvbXBsZXhpdHlEaXN0cmlidXRpb25bY29tcGxleGl0eV0gPSAoY29tcGxleGl0eURpc3RyaWJ1dGlvbltjb21wbGV4aXR5XSB8fCAwKSArIDE7XG4gICAgfVxuXG4gICAgLy8gQ2FsY3VsYXRlIGNvbmZpZGVuY2Ugc2NvcmVzXG4gICAgY29uc3QgY29uZmlkZW5jZVNjb3JlcyA9IHN0cmF0ZWdpZXMubWFwKHMgPT4gcy5jb25maWRlbmNlKTtcbiAgICBjb25zdCBhdmVyYWdlID1cbiAgICAgIGNvbmZpZGVuY2VTY29yZXMucmVkdWNlKChzdW0sIHNjb3JlKSA9PiBzdW0gKyBzY29yZSwgMCkgLyBjb25maWRlbmNlU2NvcmVzLmxlbmd0aCB8fCAwO1xuICAgIGNvbnN0IHNvcnRlZCA9IFsuLi5jb25maWRlbmNlU2NvcmVzXS5zb3J0KChhLCBiKSA9PiBhIC0gYik7XG4gICAgY29uc3QgbWVkaWFuID0gc29ydGVkW01hdGguZmxvb3Ioc29ydGVkLmxlbmd0aCAvIDIpXSB8fCAwO1xuXG4gICAgY29uc3QgY29uZmlkZW5jZURpc3RyaWJ1dGlvbjogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHt9O1xuICAgIGZvciAoY29uc3Qgc2NvcmUgb2YgY29uZmlkZW5jZVNjb3Jlcykge1xuICAgICAgY29uc3QgYnVja2V0ID0gc2NvcmUgPCAwLjMgPyAnbG93JyA6IHNjb3JlIDwgMC43ID8gJ21lZGl1bScgOiAnaGlnaCc7XG4gICAgICBjb25maWRlbmNlRGlzdHJpYnV0aW9uW2J1Y2tldF0gPSAoY29uZmlkZW5jZURpc3RyaWJ1dGlvbltidWNrZXRdIHx8IDApICsgMTtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgYW5hbHlzaXNUaW1lLFxuICAgICAgZmlsZXNBbmFseXplZCxcbiAgICAgIHJ1bGVzVHJpZ2dlcmVkLFxuICAgICAgZG9tYWluRGlzdHJpYnV0aW9uLFxuICAgICAgc2V2ZXJpdHlEaXN0cmlidXRpb24sXG4gICAgICBjb21wbGV4aXR5RGlzdHJpYnV0aW9uLFxuICAgICAgY29uZmlkZW5jZVNjb3Jlczoge1xuICAgICAgICBhdmVyYWdlLFxuICAgICAgICBtZWRpYW4sXG4gICAgICAgIGRpc3RyaWJ1dGlvbjogY29uZmlkZW5jZURpc3RyaWJ1dGlvbixcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDcmVhdGUgZW1wdHkgb3B0aW1pemF0aW9uIHBsYW5cbiAgICovXG4gIHByaXZhdGUgY3JlYXRlRW1wdHlQbGFuKCk6IE9wdGltaXplZFJlc29sdXRpb25QbGFuIHtcbiAgICByZXR1cm4ge1xuICAgICAgdG90YWxTdHJhdGVnaWVzOiAwLFxuICAgICAgdG90YWxFc3RpbWF0ZWRUaW1lOiAwLFxuICAgICAgdG90YWxTdGVwczogMCxcbiAgICAgIGV4ZWN1dGlvbk9yZGVyOiBbXSxcbiAgICAgIHBhcmFsbGVsaXphYmxlV29yazogMCxcbiAgICAgIHJpc2tEaXN0cmlidXRpb246IHt9LFxuICAgICAgcmVjb21tZW5kYXRpb25zOiBbXSxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIExvZyBhbmFseXNpcyByZXN1bHRzXG4gICAqL1xuICBwcml2YXRlIGxvZ0FuYWx5c2lzUmVzdWx0cyhyZXN1bHQ6IENvbXByZWhlbnNpdmVBbmFseXNpc1Jlc3VsdCk6IHZvaWQge1xuICAgIGxvZy5pbmZvKCdcXG7wn46vIENPTVBSRUhFTlNJVkUgTElOVElORyBBTkFMWVNJUyBSRVNVTFRTJyk7XG4gICAgbG9nLmluZm8oJz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PScpO1xuICAgIGxvZy5pbmZvKGDwn5OKIFRvdGFsIElzc3VlczogJHtyZXN1bHQuc3VtbWFyeS50b3RhbElzc3Vlc31gKTtcbiAgICBsb2cuaW5mbyhg4p2MIEVycm9yczogJHtyZXN1bHQuc3VtbWFyeS5lcnJvckNvdW50fWApO1xuICAgIGxvZy5pbmZvKGDimqDvuI8gIFdhcm5pbmdzOiAke3Jlc3VsdC5zdW1tYXJ5Lndhcm5pbmdDb3VudH1gKTtcbiAgICBsb2cuaW5mbyhg8J+UpyBBdXRvLWZpeGFibGU6ICR7cmVzdWx0LnN1bW1hcnkuYXV0b0ZpeGFibGVDb3VudH1gKTtcbiAgICBsb2cuaW5mbyhg8J+Pl++4jyBEb21haW4tc3BlY2lmaWM6ICR7cmVzdWx0LnN1bW1hcnkuZG9tYWluU3BlY2lmaWNDb3VudH1gKTtcbiAgICBsb2cuaW5mbyhg8J+aqCBDcml0aWNhbDogJHtyZXN1bHQuc3VtbWFyeS5jcml0aWNhbElzc3Vlc0NvdW50fWApO1xuICAgIGxvZy5pbmZvKGDij7HvuI8gRXN0aW1hdGVkIFJlc29sdXRpb24gVGltZTogJHtyZXN1bHQuc3VtbWFyeS5lc3RpbWF0ZWRSZXNvbHV0aW9uVGltZX0gbWludXRlc2ApO1xuICAgIGxvZy5pbmZvKGDwn46a77iPIE92ZXJhbGwgUmlzayBMZXZlbDogJHtyZXN1bHQuc3VtbWFyeS5vdmVyYWxsUmlza0xldmVsLnRvVXBwZXJDYXNlKCl9YCk7XG5cbiAgICBsb2cuaW5mbygnXFxu8J+TiyBUT1AgUkVDT01NRU5EQVRJT05TOicpO1xuICAgIHJlc3VsdC5yZWNvbW1lbmRhdGlvbnNcbiAgICAgIC5maWx0ZXIociA9PiByLnByaW9yaXR5ID09PSAnY3JpdGljYWwnIHx8IHIucHJpb3JpdHkgPT09ICdoaWdoJylcbiAgICAgIC5zbGljZSgwLCAzKVxuICAgICAgLmZvckVhY2goKHJlYywgaW5kZXgpID0+IHtcbiAgICAgICAgbG9nLmluZm8oYCR7aW5kZXggKyAxfS4gJHtyZWMudGl0bGV9ICgke3JlYy5wcmlvcml0eS50b1VwcGVyQ2FzZSgpfSlgKTtcbiAgICAgICAgbG9nLmluZm8oYCAgICR7cmVjLmRlc2NyaXB0aW9ufWApO1xuICAgICAgfSk7XG5cbiAgICBsb2cuaW5mbygnXFxu8J+TiCBBTkFMWVNJUyBNRVRSSUNTOicpO1xuICAgIGxvZy5pbmZvKGDij7HvuI8gQW5hbHlzaXMgVGltZTogJHtyZXN1bHQubWV0cmljcy5hbmFseXNpc1RpbWV9bXNgKTtcbiAgICBsb2cuaW5mbyhg8J+TgSBGaWxlcyBBbmFseXplZDogJHtyZXN1bHQubWV0cmljcy5maWxlc0FuYWx5emVkfWApO1xuICAgIGxvZy5pbmZvKGDwn5OPIFJ1bGVzIFRyaWdnZXJlZDogJHtyZXN1bHQubWV0cmljcy5ydWxlc1RyaWdnZXJlZC5sZW5ndGh9YCk7XG4gICAgbG9nLmluZm8oXG4gICAgICBg8J+OryBBdmVyYWdlIENvbmZpZGVuY2U6ICR7TWF0aC5yb3VuZChyZXN1bHQubWV0cmljcy5jb25maWRlbmNlU2NvcmVzLmF2ZXJhZ2UgKiAxMDApfSVgLFxuICAgICk7XG5cbiAgICBsb2cuaW5mbygnPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XFxuJyk7XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==