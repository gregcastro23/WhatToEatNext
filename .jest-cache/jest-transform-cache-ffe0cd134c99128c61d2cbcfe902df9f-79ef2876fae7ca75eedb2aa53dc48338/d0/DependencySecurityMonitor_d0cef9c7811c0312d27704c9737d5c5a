3256e819b2585ba2df75f64d3adb7251
"use strict";
/**
 * Dependency and Security Monitoring System
 * Automated dependency update monitoring and security vulnerability scanning
 * Part of the Kiro Optimization Campaign System
 */
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.DEFAULT_DEPENDENCY_SECURITY_CONFIG = exports.DependencySecurityMonitor = void 0;
const child_process_1 = require("child_process");
const fs = __importStar(require("fs"));
const logger_1 = require("../../utils/logger");
class DependencySecurityMonitor {
    config;
    packageJsonPath;
    constructor(config, packageJsonPath = 'package.json') {
        this.config = config;
        this.packageJsonPath = packageJsonPath;
    }
    /**
     * Execute comprehensive dependency and security monitoring
     */
    async executeDependencySecurityMonitoring() {
        const startTime = Date.now();
        logger_1.logger.info('Starting dependency and security monitoring');
        try {
            const result = {
                dependenciesScanned: 0,
                vulnerabilitiesFound: 0,
                updatesAvailable: 0,
                updatesApplied: 0,
                securityPatchesApplied: 0,
                compatibilityTestsPassed: true,
                errors: [],
                warnings: [],
                securityReport: {
                    vulnerabilities: [],
                    summary: { critical: 0, high: 0, moderate: 0, low: 0, total: 0 },
                    recommendations: [],
                },
                updateReport: {
                    availableUpdates: [],
                    appliedUpdates: [],
                    failedUpdates: [],
                    summary: { major: 0, minor: 0, patch: 0, security: 0, total: 0 },
                },
            };
            // Step 1: Scan for security vulnerabilities
            if (this.config.securityScanEnabled) {
                try {
                    result.securityReport = await this.scanSecurityVulnerabilities();
                    result.vulnerabilitiesFound = result.securityReport.summary.total;
                }
                catch (error) {
                    result.errors.push(`Security scan failed: ${error.message || 'Unknown error'}`);
                }
            }
            // Step 2: Check for dependency updates
            try {
                result.updateReport = await this.checkDependencyUpdates();
                result.updatesAvailable = result.updateReport.summary.total;
                result.dependenciesScanned = await this.getDependencyCount();
            }
            catch (error) {
                result.errors.push(`Dependency update check failed: ${error.message || 'Unknown error'}`);
            }
            // Step 3: Apply security patches automatically if enabled
            if (this.config.autoUpdateEnabled) {
                try {
                    const securityUpdates = await this.applySecurityPatches(result.securityReport.vulnerabilities);
                    result.securityPatchesApplied = securityUpdates.length;
                    result.updateReport.appliedUpdates.push(...securityUpdates);
                }
                catch (error) {
                    result.errors.push(`Security patch application failed: ${error.message || 'Unknown error'}`);
                }
            }
            // Step 4: Apply safe dependency updates
            if (this.config.autoUpdateEnabled) {
                try {
                    const safeUpdates = await this.applySafeUpdates(result.updateReport.availableUpdates);
                    result.updatesApplied = safeUpdates.length;
                    result.updateReport.appliedUpdates.push(...safeUpdates);
                }
                catch (error) {
                    result.errors.push(`Safe update application failed: ${error.message || 'Unknown error'}`);
                }
            }
            // Step 5: Run compatibility tests if enabled
            if (this.config.compatibilityTestingEnabled && result.updatesApplied > 0) {
                try {
                    result.compatibilityTestsPassed = await this.runCompatibilityTests();
                }
                catch (error) {
                    result.errors.push(`Compatibility testing failed: ${error.message || 'Unknown error'}`);
                    result.compatibilityTestsPassed = false;
                }
            }
            const executionTime = Date.now() - startTime;
            logger_1.logger.info(`Dependency and security monitoring completed in ${executionTime}ms`, {
                dependenciesScanned: result.dependenciesScanned,
                vulnerabilitiesFound: result.vulnerabilitiesFound,
                updatesApplied: result.updatesApplied,
            });
            return result;
        }
        catch (error) {
            logger_1.logger.error('Dependency and security monitoring failed', error);
            return {
                dependenciesScanned: 0,
                vulnerabilitiesFound: 0,
                updatesAvailable: 0,
                updatesApplied: 0,
                securityPatchesApplied: 0,
                compatibilityTestsPassed: false,
                errors: [String(error.message || 'Unknown error')],
                warnings: [],
                securityReport: {
                    vulnerabilities: [],
                    summary: { critical: 0, high: 0, moderate: 0, low: 0, total: 0 },
                    recommendations: [],
                },
                updateReport: {
                    availableUpdates: [],
                    appliedUpdates: [],
                    failedUpdates: [],
                    summary: { major: 0, minor: 0, patch: 0, security: 0, total: 0 },
                },
            };
        }
    }
    /**
     * Scan for security vulnerabilities using yarn audit
     */
    async scanSecurityVulnerabilities() {
        try {
            const auditOutput = (0, child_process_1.execSync)('yarn audit --json', {
                encoding: 'utf8',
                stdio: 'pipe',
                timeout: 60000,
            });
            const auditData = JSON.parse(auditOutput);
            const vulnerabilities = [];
            const summary = { critical: 0, high: 0, moderate: 0, low: 0, total: 0 };
            // Parse npm audit output
            if (auditData.vulnerabilities) {
                for (const [packageName, vulnData] of Object.entries(auditData.vulnerabilities)) {
                    const vuln = vulnData;
                    const vulnerability = {
                        packageName,
                        currentVersion: vuln.via?.[0]?.range || 'unknown',
                        vulnerableVersions: vuln.range || 'unknown',
                        severity: vuln.severity,
                        cve: vuln.via?.[0]?.source || 'N/A',
                        description: vuln.via?.[0]?.title || 'No description available',
                        fixedVersion: vuln.fixAvailable?.version,
                        patchAvailable: !!vuln.fixAvailable,
                    };
                    vulnerabilities.push(vulnerability);
                    summary[vuln.severity]++;
                    summary.total++;
                }
            }
            const recommendations = this.generateSecurityRecommendations(vulnerabilities, summary);
            return {
                vulnerabilities,
                summary,
                recommendations,
            };
        }
        catch (error) {
            logger_1.logger.error('Security vulnerability scan failed', error);
            return {
                vulnerabilities: [],
                summary: { critical: 0, high: 0, moderate: 0, low: 0, total: 0 },
                recommendations: ['Failed to scan for vulnerabilities. Please run yarn audit manually.'],
            };
        }
    }
    /**
     * Check for available dependency updates
     */
    async checkDependencyUpdates() {
        try {
            const outdatedOutput = (0, child_process_1.execSync)('yarn outdated --json', {
                encoding: 'utf8',
                stdio: 'pipe',
                timeout: 60000,
            });
            const outdatedData = JSON.parse(outdatedOutput || '{}');
            const availableUpdates = [];
            const summary = { major: 0, minor: 0, patch: 0, security: 0, total: 0 };
            for (const [packageName, updateInfo] of Object.entries(outdatedData)) {
                const info = updateInfo;
                const updateType = this.determineUpdateType(info.current, info.latest);
                const breakingChanges = updateType === 'major';
                const update = {
                    packageName,
                    currentVersion: info.current,
                    latestVersion: info.latest,
                    updateType,
                    changelogUrl: await this.getChangelogUrl(packageName),
                    breakingChanges,
                    securityFix: false,
                    testingRequired: breakingChanges || this.requiresTesting(packageName),
                };
                availableUpdates.push(update);
                summary[updateType]++;
                summary.total++;
            }
            return {
                availableUpdates,
                appliedUpdates: [],
                failedUpdates: [],
                summary,
            };
        }
        catch (error) {
            // yarn outdated returns non-zero exit code when updates are available
            if (error.stdout) {
                try {
                    const outdatedData = JSON.parse(error.stdout || '{}');
                    // Process the data as above
                    return this.processOutdatedData(outdatedData);
                }
                catch (parseError) {
                    logger_1.logger.error('Failed to parse yarn outdated output', parseError);
                }
            }
            return {
                availableUpdates: [],
                appliedUpdates: [],
                failedUpdates: [],
                summary: { major: 0, minor: 0, patch: 0, security: 0, total: 0 },
            };
        }
    }
    /**
     * Apply security patches automatically
     */
    async applySecurityPatches(vulnerabilities) {
        const appliedUpdates = [];
        for (const vuln of vulnerabilities) {
            if (!vuln.patchAvailable)
                continue;
            const shouldAutoFix = this.shouldAutoFixVulnerability(vuln.severity);
            if (!shouldAutoFix)
                continue;
            if (this.config.excludedPackages.includes(vuln.packageName)) {
                logger_1.logger.info(`Skipping excluded package: ${vuln.packageName}`);
                continue;
            }
            try {
                // Apply the security fix
                const updateCommand = vuln.fixedVersion
                    ? `yarn add ${vuln.packageName}@${vuln.fixedVersion}`
                    : `yarn audit --fix`;
                (0, child_process_1.execSync)(updateCommand, {
                    encoding: 'utf8',
                    stdio: 'pipe',
                    timeout: 120000,
                });
                const update = {
                    packageName: vuln.packageName,
                    currentVersion: vuln.currentVersion,
                    latestVersion: vuln.fixedVersion || 'patched',
                    updateType: 'patch',
                    breakingChanges: false,
                    securityFix: true,
                    testingRequired: false,
                };
                appliedUpdates.push(update);
                logger_1.logger.info(`Applied security patch for ${vuln.packageName}`);
            }
            catch (error) {
                logger_1.logger.error(`Failed to apply security patch for ${vuln.packageName}`, error);
            }
        }
        return appliedUpdates;
    }
    /**
     * Apply safe dependency updates
     */
    async applySafeUpdates(availableUpdates) {
        const appliedUpdates = [];
        for (const update of availableUpdates) {
            if (this.config.excludedPackages.includes(update.packageName)) {
                logger_1.logger.info(`Skipping excluded package: ${update.packageName}`);
                continue;
            }
            const strategy = this.getUpdateStrategy(update);
            if (!strategy || strategy.updateType === 'none')
                continue;
            if (strategy.requiresManualApproval && update.updateType === 'major') {
                logger_1.logger.info(`Skipping major update requiring manual approval: ${update.packageName}`);
                continue;
            }
            try {
                // Apply the update
                const updateCommand = `yarn add ${update.packageName}@${update.latestVersion}`;
                (0, child_process_1.execSync)(updateCommand, {
                    encoding: 'utf8',
                    stdio: 'pipe',
                    timeout: 120000,
                });
                appliedUpdates.push(update);
                logger_1.logger.info(`Applied update for ${update.packageName}: ${update.currentVersion} → ${update.latestVersion}`);
                // Run tests if required
                if (strategy.testingRequired && this.config.compatibilityTestingEnabled) {
                    const testsPass = await this.runPackageTests(update.packageName);
                    if (!testsPass) {
                        logger_1.logger.warn(`Tests failed after updating ${update.packageName}, consider rollback`);
                    }
                }
            }
            catch (error) {
                logger_1.logger.error(`Failed to apply update for ${update.packageName}`, error);
            }
        }
        return appliedUpdates;
    }
    /**
     * Run compatibility tests
     */
    async runCompatibilityTests() {
        try {
            // Run TypeScript compilation check
            (0, child_process_1.execSync)('yarn build', {
                encoding: 'utf8',
                stdio: 'pipe',
                timeout: 300000,
            });
            // Run test suite
            (0, child_process_1.execSync)('yarn test', {
                encoding: 'utf8',
                stdio: 'pipe',
                timeout: 300000,
            });
            return true;
        }
        catch (error) {
            logger_1.logger.error('Compatibility tests failed', error);
            return false;
        }
    }
    // Private helper methods
    processOutdatedData(outdatedData) {
        const availableUpdates = [];
        const summary = { major: 0, minor: 0, patch: 0, security: 0, total: 0 };
        for (const [packageName, updateInfo] of Object.entries(outdatedData)) {
            const info = updateInfo;
            const updateType = this.determineUpdateType(info.current, info.latest);
            const update = {
                packageName,
                currentVersion: info.current,
                latestVersion: info.latest,
                updateType,
                breakingChanges: updateType === 'major',
                securityFix: false,
                testingRequired: updateType === 'major' || this.requiresTesting(packageName),
            };
            availableUpdates.push(update);
            summary[updateType]++;
            summary.total++;
        }
        return {
            availableUpdates,
            appliedUpdates: [],
            failedUpdates: [],
            summary,
        };
    }
    determineUpdateType(current, latest) {
        const currentParts = current
            .replace(/[^0-9.]/g, '')
            .split('.')
            .map(Number);
        const latestParts = latest
            .replace(/[^0-9.]/g, '')
            .split('.')
            .map(Number);
        if (latestParts[0] > currentParts[0])
            return 'major';
        if (latestParts[1] > currentParts[1])
            return 'minor';
        return 'patch';
    }
    shouldAutoFixVulnerability(severity) {
        const { securityThresholds } = this.config;
        switch (severity) {
            case 'critical':
                return securityThresholds.autoFixCritical;
            case 'high':
                return securityThresholds.autoFixHigh;
            default:
                return false;
        }
    }
    getUpdateStrategy(update) {
        for (const strategy of this.config.updateStrategies) {
            if (strategy.pattern.test(update.packageName)) {
                return strategy;
            }
        }
        return null;
    }
    requiresTesting(packageName) {
        // Packages that typically require testing after updates
        const testingRequiredPatterns = [
            /^react/,
            /^next/,
            /^typescript/,
            /^@types\//,
            /^eslint/,
            /^jest/,
            /^babel/,
        ];
        return testingRequiredPatterns.some(pattern => pattern.test(packageName));
    }
    async getChangelogUrl(packageName) {
        try {
            const packageInfo = (0, child_process_1.execSync)(`yarn info ${packageName} --json`, {
                encoding: 'utf8',
                stdio: 'pipe',
                timeout: 10000,
            });
            const info = JSON.parse(packageInfo);
            return info.repository?.url || info.homepage;
        }
        catch (error) {
            return undefined;
        }
    }
    async runPackageTests(packageName) {
        try {
            // Run a subset of tests related to the updated package
            (0, child_process_1.execSync)('yarn test --testNamePattern=".*" --bail', {
                encoding: 'utf8',
                stdio: 'pipe',
                timeout: 60000,
            });
            return true;
        }
        catch (error) {
            return false;
        }
    }
    async getDependencyCount() {
        try {
            const packageJson = JSON.parse(fs.readFileSync(this.packageJsonPath, 'utf8'));
            const deps = Object.keys(packageJson.dependencies || {});
            const devDeps = Object.keys(packageJson.devDependencies || {});
            return deps.length + devDeps.length;
        }
        catch (error) {
            return 0;
        }
    }
    generateSecurityRecommendations(vulnerabilities, summary) {
        const recommendations = [];
        if (summary.critical > 0) {
            recommendations.push(`🚨 ${summary.critical} critical vulnerabilities found - immediate action required`);
        }
        if (summary.high > 0) {
            recommendations.push(`⚠️ ${summary.high} high severity vulnerabilities found - update as soon as possible`);
        }
        if (summary.moderate > 0) {
            recommendations.push(`📋 ${summary.moderate} moderate vulnerabilities found - plan updates`);
        }
        const patchableVulns = vulnerabilities.filter(v => v.patchAvailable);
        if (patchableVulns.length > 0) {
            recommendations.push(`✅ ${patchableVulns.length} vulnerabilities have patches available`);
        }
        if (summary.total === 0) {
            recommendations.push('✅ No security vulnerabilities found');
        }
        return recommendations;
    }
}
exports.DependencySecurityMonitor = DependencySecurityMonitor;
/**
 * Default configuration for dependency and security monitoring
 */
exports.DEFAULT_DEPENDENCY_SECURITY_CONFIG = {
    maxDependenciesPerBatch: 10,
    safetyValidationEnabled: true,
    autoUpdateEnabled: false,
    securityScanEnabled: true,
    compatibilityTestingEnabled: true,
    updateStrategies: [
        {
            name: 'Security patches',
            description: 'Automatically apply security patches',
            pattern: /.*/,
            updateType: 'patch',
            requiresManualApproval: false,
            testingRequired: false,
        },
        {
            name: 'TypeScript ecosystem',
            description: 'Careful updates for TypeScript-related packages',
            pattern: /^(@types\/|typescript|ts-)/,
            updateType: 'minor',
            requiresManualApproval: true,
            testingRequired: true,
        },
        {
            name: 'React ecosystem',
            description: 'Careful updates for React-related packages',
            pattern: /^(react|@react|next)/,
            updateType: 'minor',
            requiresManualApproval: true,
            testingRequired: true,
        },
        {
            name: 'Development tools',
            description: 'Safe updates for development tools',
            pattern: /^(eslint|prettier|jest|babel)/,
            updateType: 'minor',
            requiresManualApproval: false,
            testingRequired: true,
        },
    ],
    securityThresholds: {
        critical: 0,
        high: 5,
        moderate: 10,
        low: 20,
        autoFixCritical: true,
        autoFixHigh: false,
    },
    excludedPackages: [
        // Packages to never auto-update
        'react',
        'react-dom',
        'next',
        'typescript',
    ],
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L2JhY2t1cHMvZmlyc3Qtd2F2ZS0yMDI1LTA4LTExVDA1LTE5LTI2LTgxM1ovc3JjL3NlcnZpY2VzL2NhbXBhaWduL0RlcGVuZGVuY3lTZWN1cml0eU1vbml0b3IudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7O0dBSUc7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBRUgsaURBQXlDO0FBQ3pDLHVDQUF5QjtBQUd6QiwrQ0FBNEM7QUF5RzVDLE1BQWEseUJBQXlCO0lBQzVCLE1BQU0sQ0FBMkI7SUFDakMsZUFBZSxDQUFTO0lBRWhDLFlBQVksTUFBZ0MsRUFBRSxrQkFBMEIsY0FBYztRQUNwRixJQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztRQUNyQixJQUFJLENBQUMsZUFBZSxHQUFHLGVBQWUsQ0FBQztJQUN6QyxDQUFDO0lBRUQ7O09BRUc7SUFDSCxLQUFLLENBQUMsbUNBQW1DO1FBQ3ZDLE1BQU0sU0FBUyxHQUFHLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQztRQUM3QixlQUFNLENBQUMsSUFBSSxDQUFDLDZDQUE2QyxDQUFDLENBQUM7UUFFM0QsSUFBSTtZQUNGLE1BQU0sTUFBTSxHQUE2QjtnQkFDdkMsbUJBQW1CLEVBQUUsQ0FBQztnQkFDdEIsb0JBQW9CLEVBQUUsQ0FBQztnQkFDdkIsZ0JBQWdCLEVBQUUsQ0FBQztnQkFDbkIsY0FBYyxFQUFFLENBQUM7Z0JBQ2pCLHNCQUFzQixFQUFFLENBQUM7Z0JBQ3pCLHdCQUF3QixFQUFFLElBQUk7Z0JBQzlCLE1BQU0sRUFBRSxFQUFFO2dCQUNWLFFBQVEsRUFBRSxFQUFFO2dCQUNaLGNBQWMsRUFBRTtvQkFDZCxlQUFlLEVBQUUsRUFBRTtvQkFDbkIsT0FBTyxFQUFFLEVBQUUsUUFBUSxFQUFFLENBQUMsRUFBRSxJQUFJLEVBQUUsQ0FBQyxFQUFFLFFBQVEsRUFBRSxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMsRUFBRSxLQUFLLEVBQUUsQ0FBQyxFQUFF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O1NBQ3RCO0tBQ0Y7SUFDRCxrQkFBa0IsRUFBRTtRQUNsQixRQUFRLEVBQUUsQ0FBQztRQUNYLElBQUksRUFBRSxDQUFDO1FBQ1AsUUFBUSxFQUFFLEVBQUU7UUFDWixHQUFHLEVBQUUsRUFBRTtRQUNQLGVBQWUsRUFBRSxJQUFJO1FBQ3JCLFdBQVcsRUFBRSxLQUFLO0tBQ25CO0lBQ0QsZ0JBQWdCLEVBQUU7UUFDaEIsZ0NBQWdDO1FBQ2hDLE9BQU87UUFDUCxXQUFXO1FBQ1gsTUFBTTtRQUNOLFlBQVk7S0FDYjtDQUNGLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L2JhY2t1cHMvZmlyc3Qtd2F2ZS0yMDI1LTA4LTExVDA1LTE5LTI2LTgxM1ovc3JjL3NlcnZpY2VzL2NhbXBhaWduL0RlcGVuZGVuY3lTZWN1cml0eU1vbml0b3IudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBEZXBlbmRlbmN5IGFuZCBTZWN1cml0eSBNb25pdG9yaW5nIFN5c3RlbVxuICogQXV0b21hdGVkIGRlcGVuZGVuY3kgdXBkYXRlIG1vbml0b3JpbmcgYW5kIHNlY3VyaXR5IHZ1bG5lcmFiaWxpdHkgc2Nhbm5pbmdcbiAqIFBhcnQgb2YgdGhlIEtpcm8gT3B0aW1pemF0aW9uIENhbXBhaWduIFN5c3RlbVxuICovXG5cbmltcG9ydCB7IGV4ZWNTeW5jIH0gZnJvbSAnY2hpbGRfcHJvY2Vzcyc7XG5pbXBvcnQgKiBhcyBmcyBmcm9tICdmcyc7XG5pbXBvcnQgKiBhcyBwYXRoIGZyb20gJ3BhdGgnO1xuXG5pbXBvcnQgeyBsb2dnZXIgfSBmcm9tICcuLi8uLi91dGlscy9sb2dnZXInO1xuXG5leHBvcnQgaW50ZXJmYWNlIERlcGVuZGVuY3lTZWN1cml0eUNvbmZpZyB7XG4gIG1heERlcGVuZGVuY2llc1BlckJhdGNoOiBudW1iZXI7XG4gIHNhZmV0eVZhbGlkYXRpb25FbmFibGVkOiBib29sZWFuO1xuICBhdXRvVXBkYXRlRW5hYmxlZDogYm9vbGVhbjtcbiAgc2VjdXJpdHlTY2FuRW5hYmxlZDogYm9vbGVhbjtcbiAgY29tcGF0aWJpbGl0eVRlc3RpbmdFbmFibGVkOiBib29sZWFuO1xuICB1cGRhdGVTdHJhdGVnaWVzOiBVcGRhdGVTdHJhdGVneVtdO1xuICBzZWN1cml0eVRocmVzaG9sZHM6IFNlY3VyaXR5VGhyZXNob2xkcztcbiAgZXhjbHVkZWRQYWNrYWdlczogc3RyaW5nW107XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVXBkYXRlU3RyYXRlZ3kge1xuICBuYW1lOiBzdHJpbmc7XG4gIGRlc2NyaXB0aW9uOiBzdHJpbmc7XG4gIHBhdHRlcm46IFJlZ0V4cDtcbiAgdXBkYXRlVHlwZTogJ21ham9yJyB8ICdtaW5vcicgfCAncGF0Y2gnIHwgJ25vbmUnO1xuICByZXF1aXJlc01hbnVhbEFwcHJvdmFsOiBib29sZWFuO1xuICB0ZXN0aW5nUmVxdWlyZWQ6IGJvb2xlYW47XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU2VjdXJpdHlUaHJlc2hvbGRzIHtcbiAgY3JpdGljYWw6IG51bWJlcjtcbiAgaGlnaDogbnVtYmVyO1xuICBtb2RlcmF0ZTogbnVtYmVyO1xuICBsb3c6IG51bWJlcjtcbiAgYXV0b0ZpeENyaXRpY2FsOiBib29sZWFuO1xuICBhdXRvRml4SGlnaDogYm9vbGVhbjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBEZXBlbmRlbmN5U2VjdXJpdHlSZXN1bHQge1xuICBkZXBlbmRlbmNpZXNTY2FubmVkOiBudW1iZXI7XG4gIHZ1bG5lcmFiaWxpdGllc0ZvdW5kOiBudW1iZXI7XG4gIHVwZGF0ZXNBdmFpbGFibGU6IG51bWJlcjtcbiAgdXBkYXRlc0FwcGxpZWQ6IG51bWJlcjtcbiAgc2VjdXJpdHlQYXRjaGVzQXBwbGllZDogbnVtYmVyO1xuICBjb21wYXRpYmlsaXR5VGVzdHNQYXNzZWQ6IGJvb2xlYW47XG4gIGVycm9yczogc3RyaW5nW107XG4gIHdhcm5pbmdzOiBzdHJpbmdbXTtcbiAgc2VjdXJpdHlSZXBvcnQ6IFNlY3VyaXR5UmVwb3J0O1xuICB1cGRhdGVSZXBvcnQ6IFVwZGF0ZVJlcG9ydDtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBTZWN1cml0eVJlcG9ydCB7XG4gIHZ1bG5lcmFiaWxpdGllczogU2VjdXJpdHlWdWxuZXJhYmlsaXR5W107XG4gIHN1bW1hcnk6IFNlY3VyaXR5U3VtbWFyeTtcbiAgcmVjb21tZW5kYXRpb25zOiBzdHJpbmdbXTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBTZWN1cml0eVZ1bG5lcmFiaWxpdHkge1xuICBwYWNrYWdlTmFtZTogc3RyaW5nO1xuICBjdXJyZW50VmVyc2lvbjogc3RyaW5nO1xuICB2dWxuZXJhYmxlVmVyc2lvbnM6IHN0cmluZztcbiAgc2V2ZXJpdHk6ICdjcml0aWNhbCcgfCAnaGlnaCcgfCAnbW9kZXJhdGUnIHwgJ2xvdyc7XG4gIGN2ZTogc3RyaW5nO1xuICBkZXNjcmlwdGlvbjogc3RyaW5nO1xuICBmaXhlZFZlcnNpb24/OiBzdHJpbmc7XG4gIHBhdGNoQXZhaWxhYmxlOiBib29sZWFuO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFNlY3VyaXR5U3VtbWFyeSB7XG4gIGNyaXRpY2FsOiBudW1iZXI7XG4gIGhpZ2g6IG51bWJlcjtcbiAgbW9kZXJhdGU6IG51bWJlcjtcbiAgbG93OiBudW1iZXI7XG4gIHRvdGFsOiBudW1iZXI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVXBkYXRlUmVwb3J0IHtcbiAgYXZhaWxhYmxlVXBkYXRlczogRGVwZW5kZW5jeVVwZGF0ZVtdO1xuICBhcHBsaWVkVXBkYXRlczogRGVwZW5kZW5jeVVwZGF0ZVtdO1xuICBmYWlsZWRVcGRhdGVzOiBEZXBlbmRlbmN5VXBkYXRlW107XG4gIHN1bW1hcnk6IFVwZGF0ZVN1bW1hcnk7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgRGVwZW5kZW5jeVVwZGF0ZSB7XG4gIHBhY2thZ2VOYW1lOiBzdHJpbmc7XG4gIGN1cnJlbnRWZXJzaW9uOiBzdHJpbmc7XG4gIGxhdGVzdFZlcnNpb246IHN0cmluZztcbiAgdXBkYXRlVHlwZTogJ21ham9yJyB8ICdtaW5vcicgfCAncGF0Y2gnO1xuICBjaGFuZ2Vsb2dVcmw/OiBzdHJpbmc7XG4gIGJyZWFraW5nQ2hhbmdlczogYm9vbGVhbjtcbiAgc2VjdXJpdHlGaXg6IGJvb2xlYW47XG4gIHRlc3RpbmdSZXF1aXJlZDogYm9vbGVhbjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBVcGRhdGVTdW1tYXJ5IHtcbiAgbWFqb3I6IG51bWJlcjtcbiAgbWlub3I6IG51bWJlcjtcbiAgcGF0Y2g6IG51bWJlcjtcbiAgc2VjdXJpdHk6IG51bWJlcjtcbiAgdG90YWw6IG51bWJlcjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBQYWNrYWdlSW5mbyB7XG4gIG5hbWU6IHN0cmluZztcbiAgY3VycmVudFZlcnNpb246IHN0cmluZztcbiAgbGF0ZXN0VmVyc2lvbjogc3RyaW5nO1xuICB3YW50ZWRWZXJzaW9uOiBzdHJpbmc7XG4gIHR5cGU6ICdkZXBlbmRlbmNpZXMnIHwgJ2RldkRlcGVuZGVuY2llcyc7XG4gIGhvbWVwYWdlPzogc3RyaW5nO1xuICByZXBvc2l0b3J5Pzogc3RyaW5nO1xufVxuXG5leHBvcnQgY2xhc3MgRGVwZW5kZW5jeVNlY3VyaXR5TW9uaXRvciB7XG4gIHByaXZhdGUgY29uZmlnOiBEZXBlbmRlbmN5U2VjdXJpdHlDb25maWc7XG4gIHByaXZhdGUgcGFja2FnZUpzb25QYXRoOiBzdHJpbmc7XG5cbiAgY29uc3RydWN0b3IoY29uZmlnOiBEZXBlbmRlbmN5U2VjdXJpdHlDb25maWcsIHBhY2thZ2VKc29uUGF0aDogc3RyaW5nID0gJ3BhY2thZ2UuanNvbicpIHtcbiAgICB0aGlzLmNvbmZpZyA9IGNvbmZpZztcbiAgICB0aGlzLnBhY2thZ2VKc29uUGF0aCA9IHBhY2thZ2VKc29uUGF0aDtcbiAgfVxuXG4gIC8qKlxuICAgKiBFeGVjdXRlIGNvbXByZWhlbnNpdmUgZGVwZW5kZW5jeSBhbmQgc2VjdXJpdHkgbW9uaXRvcmluZ1xuICAgKi9cbiAgYXN5bmMgZXhlY3V0ZURlcGVuZGVuY3lTZWN1cml0eU1vbml0b3JpbmcoKTogUHJvbWlzZTxEZXBlbmRlbmN5U2VjdXJpdHlSZXN1bHQ+IHtcbiAgICBjb25zdCBzdGFydFRpbWUgPSBEYXRlLm5vdygpO1xuICAgIGxvZ2dlci5pbmZvKCdTdGFydGluZyBkZXBlbmRlbmN5IGFuZCBzZWN1cml0eSBtb25pdG9yaW5nJyk7XG5cbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzdWx0OiBEZXBlbmRlbmN5U2VjdXJpdHlSZXN1bHQgPSB7XG4gICAgICAgIGRlcGVuZGVuY2llc1NjYW5uZWQ6IDAsXG4gICAgICAgIHZ1bG5lcmFiaWxpdGllc0ZvdW5kOiAwLFxuICAgICAgICB1cGRhdGVzQXZhaWxhYmxlOiAwLFxuICAgICAgICB1cGRhdGVzQXBwbGllZDogMCxcbiAgICAgICAgc2VjdXJpdHlQYXRjaGVzQXBwbGllZDogMCxcbiAgICAgICAgY29tcGF0aWJpbGl0eVRlc3RzUGFzc2VkOiB0cnVlLFxuICAgICAgICBlcnJvcnM6IFtdLFxuICAgICAgICB3YXJuaW5nczogW10sXG4gICAgICAgIHNlY3VyaXR5UmVwb3J0OiB7XG4gICAgICAgICAgdnVsbmVyYWJpbGl0aWVzOiBbXSxcbiAgICAgICAgICBzdW1tYXJ5OiB7IGNyaXRpY2FsOiAwLCBoaWdoOiAwLCBtb2RlcmF0ZTogMCwgbG93OiAwLCB0b3RhbDogMCB9LFxuICAgICAgICAgIHJlY29tbWVuZGF0aW9uczogW10sXG4gICAgICAgIH0sXG4gICAgICAgIHVwZGF0ZVJlcG9ydDoge1xuICAgICAgICAgIGF2YWlsYWJsZVVwZGF0ZXM6IFtdLFxuICAgICAgICAgIGFwcGxpZWRVcGRhdGVzOiBbXSxcbiAgICAgICAgICBmYWlsZWRVcGRhdGVzOiBbXSxcbiAgICAgICAgICBzdW1tYXJ5OiB7IG1ham9yOiAwLCBtaW5vcjogMCwgcGF0Y2g6IDAsIHNlY3VyaXR5OiAwLCB0b3RhbDogMCB9LFxuICAgICAgICB9LFxuICAgICAgfTtcblxuICAgICAgLy8gU3RlcCAxOiBTY2FuIGZvciBzZWN1cml0eSB2dWxuZXJhYmlsaXRpZXNcbiAgICAgIGlmICh0aGlzLmNvbmZpZy5zZWN1cml0eVNjYW5FbmFibGVkKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgcmVzdWx0LnNlY3VyaXR5UmVwb3J0ID0gYXdhaXQgdGhpcy5zY2FuU2VjdXJpdHlWdWxuZXJhYmlsaXRpZXMoKTtcbiAgICAgICAgICByZXN1bHQudnVsbmVyYWJpbGl0aWVzRm91bmQgPSByZXN1bHQuc2VjdXJpdHlSZXBvcnQuc3VtbWFyeS50b3RhbDtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICByZXN1bHQuZXJyb3JzLnB1c2goXG4gICAgICAgICAgICBgU2VjdXJpdHkgc2NhbiBmYWlsZWQ6ICR7KGVycm9yIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KS5tZXNzYWdlIHx8ICdVbmtub3duIGVycm9yJ31gLFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gU3RlcCAyOiBDaGVjayBmb3IgZGVwZW5kZW5jeSB1cGRhdGVzXG4gICAgICB0cnkge1xuICAgICAgICByZXN1bHQudXBkYXRlUmVwb3J0ID0gYXdhaXQgdGhpcy5jaGVja0RlcGVuZGVuY3lVcGRhdGVzKCk7XG4gICAgICAgIHJlc3VsdC51cGRhdGVzQXZhaWxhYmxlID0gcmVzdWx0LnVwZGF0ZVJlcG9ydC5zdW1tYXJ5LnRvdGFsO1xuICAgICAgICByZXN1bHQuZGVwZW5kZW5jaWVzU2Nhbm5lZCA9IGF3YWl0IHRoaXMuZ2V0RGVwZW5kZW5jeUNvdW50KCk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICByZXN1bHQuZXJyb3JzLnB1c2goXG4gICAgICAgICAgYERlcGVuZGVuY3kgdXBkYXRlIGNoZWNrIGZhaWxlZDogJHsoZXJyb3IgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pLm1lc3NhZ2UgfHwgJ1Vua25vd24gZXJyb3InfWAsXG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIC8vIFN0ZXAgMzogQXBwbHkgc2VjdXJpdHkgcGF0Y2hlcyBhdXRvbWF0aWNhbGx5IGlmIGVuYWJsZWRcbiAgICAgIGlmICh0aGlzLmNvbmZpZy5hdXRvVXBkYXRlRW5hYmxlZCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IHNlY3VyaXR5VXBkYXRlcyA9IGF3YWl0IHRoaXMuYXBwbHlTZWN1cml0eVBhdGNoZXMoXG4gICAgICAgICAgICByZXN1bHQuc2VjdXJpdHlSZXBvcnQudnVsbmVyYWJpbGl0aWVzLFxuICAgICAgICAgICk7XG4gICAgICAgICAgcmVzdWx0LnNlY3VyaXR5UGF0Y2hlc0FwcGxpZWQgPSBzZWN1cml0eVVwZGF0ZXMubGVuZ3RoO1xuICAgICAgICAgIHJlc3VsdC51cGRhdGVSZXBvcnQuYXBwbGllZFVwZGF0ZXMucHVzaCguLi5zZWN1cml0eVVwZGF0ZXMpO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIHJlc3VsdC5lcnJvcnMucHVzaChcbiAgICAgICAgICAgIGBTZWN1cml0eSBwYXRjaCBhcHBsaWNhdGlvbiBmYWlsZWQ6ICR7KGVycm9yIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KS5tZXNzYWdlIHx8ICdVbmtub3duIGVycm9yJ31gLFxuICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gU3RlcCA0OiBBcHBseSBzYWZlIGRlcGVuZGVuY3kgdXBkYXRlc1xuICAgICAgaWYgKHRoaXMuY29uZmlnLmF1dG9VcGRhdGVFbmFibGVkKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3Qgc2FmZVVwZGF0ZXMgPSBhd2FpdCB0aGlzLmFwcGx5U2FmZVVwZGF0ZXMocmVzdWx0LnVwZGF0ZVJlcG9ydC5hdmFpbGFibGVVcGRhdGVzKTtcbiAgICAgICAgICByZXN1bHQudXBkYXRlc0FwcGxpZWQgPSBzYWZlVXBkYXRlcy5sZW5ndGg7XG4gICAgICAgICAgcmVzdWx0LnVwZGF0ZVJlcG9ydC5hcHBsaWVkVXBkYXRlcy5wdXNoKC4uLnNhZmVVcGRhdGVzKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICByZXN1bHQuZXJyb3JzLnB1c2goXG4gICAgICAgICAgICBgU2FmZSB1cGRhdGUgYXBwbGljYXRpb24gZmFpbGVkOiAkeyhlcnJvciBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPikubWVzc2FnZSB8fCAnVW5rbm93biBlcnJvcid9YCxcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIFN0ZXAgNTogUnVuIGNvbXBhdGliaWxpdHkgdGVzdHMgaWYgZW5hYmxlZFxuICAgICAgaWYgKHRoaXMuY29uZmlnLmNvbXBhdGliaWxpdHlUZXN0aW5nRW5hYmxlZCAmJiByZXN1bHQudXBkYXRlc0FwcGxpZWQgPiAwKSB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgcmVzdWx0LmNvbXBhdGliaWxpdHlUZXN0c1Bhc3NlZCA9IGF3YWl0IHRoaXMucnVuQ29tcGF0aWJpbGl0eVRlc3RzKCk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgcmVzdWx0LmVycm9ycy5wdXNoKFxuICAgICAgICAgICAgYENvbXBhdGliaWxpdHkgdGVzdGluZyBmYWlsZWQ6ICR7KGVycm9yIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KS5tZXNzYWdlIHx8ICdVbmtub3duIGVycm9yJ31gLFxuICAgICAgICAgICk7XG4gICAgICAgICAgcmVzdWx0LmNvbXBhdGliaWxpdHlUZXN0c1Bhc3NlZCA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGV4ZWN1dGlvblRpbWUgPSBEYXRlLm5vdygpIC0gc3RhcnRUaW1lO1xuICAgICAgbG9nZ2VyLmluZm8oYERlcGVuZGVuY3kgYW5kIHNlY3VyaXR5IG1vbml0b3JpbmcgY29tcGxldGVkIGluICR7ZXhlY3V0aW9uVGltZX1tc2AsIHtcbiAgICAgICAgZGVwZW5kZW5jaWVzU2Nhbm5lZDogcmVzdWx0LmRlcGVuZGVuY2llc1NjYW5uZWQsXG4gICAgICAgIHZ1bG5lcmFiaWxpdGllc0ZvdW5kOiByZXN1bHQudnVsbmVyYWJpbGl0aWVzRm91bmQsXG4gICAgICAgIHVwZGF0ZXNBcHBsaWVkOiByZXN1bHQudXBkYXRlc0FwcGxpZWQsXG4gICAgICB9KTtcblxuICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdEZXBlbmRlbmN5IGFuZCBzZWN1cml0eSBtb25pdG9yaW5nIGZhaWxlZCcsIGVycm9yKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGRlcGVuZGVuY2llc1NjYW5uZWQ6IDAsXG4gICAgICAgIHZ1bG5lcmFiaWxpdGllc0ZvdW5kOiAwLFxuICAgICAgICB1cGRhdGVzQXZhaWxhYmxlOiAwLFxuICAgICAgICB1cGRhdGVzQXBwbGllZDogMCxcbiAgICAgICAgc2VjdXJpdHlQYXRjaGVzQXBwbGllZDogMCxcbiAgICAgICAgY29tcGF0aWJpbGl0eVRlc3RzUGFzc2VkOiBmYWxzZSxcbiAgICAgICAgZXJyb3JzOiBbU3RyaW5nKChlcnJvciBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPikubWVzc2FnZSB8fCAnVW5rbm93biBlcnJvcicpXSxcbiAgICAgICAgd2FybmluZ3M6IFtdLFxuICAgICAgICBzZWN1cml0eVJlcG9ydDoge1xuICAgICAgICAgIHZ1bG5lcmFiaWxpdGllczogW10sXG4gICAgICAgICAgc3VtbWFyeTogeyBjcml0aWNhbDogMCwgaGlnaDogMCwgbW9kZXJhdGU6IDAsIGxvdzogMCwgdG90YWw6IDAgfSxcbiAgICAgICAgICByZWNvbW1lbmRhdGlvbnM6IFtdLFxuICAgICAgICB9LFxuICAgICAgICB1cGRhdGVSZXBvcnQ6IHtcbiAgICAgICAgICBhdmFpbGFibGVVcGRhdGVzOiBbXSxcbiAgICAgICAgICBhcHBsaWVkVXBkYXRlczogW10sXG4gICAgICAgICAgZmFpbGVkVXBkYXRlczogW10sXG4gICAgICAgICAgc3VtbWFyeTogeyBtYWpvcjogMCwgbWlub3I6IDAsIHBhdGNoOiAwLCBzZWN1cml0eTogMCwgdG90YWw6IDAgfSxcbiAgICAgICAgfSxcbiAgICAgIH07XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFNjYW4gZm9yIHNlY3VyaXR5IHZ1bG5lcmFiaWxpdGllcyB1c2luZyB5YXJuIGF1ZGl0XG4gICAqL1xuICBhc3luYyBzY2FuU2VjdXJpdHlWdWxuZXJhYmlsaXRpZXMoKTogUHJvbWlzZTxTZWN1cml0eVJlcG9ydD4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBhdWRpdE91dHB1dCA9IGV4ZWNTeW5jKCd5YXJuIGF1ZGl0IC0tanNvbicsIHtcbiAgICAgICAgZW5jb2Rpbmc6ICd1dGY4JyxcbiAgICAgICAgc3RkaW86ICdwaXBlJyxcbiAgICAgICAgdGltZW91dDogNjAwMDAsXG4gICAgICB9KTtcblxuICAgICAgY29uc3QgYXVkaXREYXRhID0gSlNPTi5wYXJzZShhdWRpdE91dHB1dCk7XG4gICAgICBjb25zdCB2dWxuZXJhYmlsaXRpZXM6IFNlY3VyaXR5VnVsbmVyYWJpbGl0eVtdID0gW107XG4gICAgICBjb25zdCBzdW1tYXJ5OiBTZWN1cml0eVN1bW1hcnkgPSB7IGNyaXRpY2FsOiAwLCBoaWdoOiAwLCBtb2RlcmF0ZTogMCwgbG93OiAwLCB0b3RhbDogMCB9O1xuXG4gICAgICAvLyBQYXJzZSBucG0gYXVkaXQgb3V0cHV0XG4gICAgICBpZiAoYXVkaXREYXRhLnZ1bG5lcmFiaWxpdGllcykge1xuICAgICAgICBmb3IgKGNvbnN0IFtwYWNrYWdlTmFtZSwgdnVsbkRhdGFdIG9mIE9iamVjdC5lbnRyaWVzKGF1ZGl0RGF0YS52dWxuZXJhYmlsaXRpZXMpKSB7XG4gICAgICAgICAgY29uc3QgdnVsbiA9IHZ1bG5EYXRhIGFzIHVua25vd24gYXMge1xuICAgICAgICAgICAgdmlhPzogQXJyYXk8eyByYW5nZT86IHN0cmluZzsgc2V2ZXJpdHk/OiBzdHJpbmc7IHRpdGxlPzogc3RyaW5nIH0+O1xuICAgICAgICAgICAgcmFuZ2U/OiBzdHJpbmc7XG4gICAgICAgICAgICBzZXZlcml0eT86IHN0cmluZztcbiAgICAgICAgICAgIG5hbWU/OiBzdHJpbmc7XG4gICAgICAgICAgICBba2V5OiBzdHJpbmddOiB1bmtub3duO1xuICAgICAgICAgIH07XG5cbiAgICAgICAgICBjb25zdCB2dWxuZXJhYmlsaXR5OiBTZWN1cml0eVZ1bG5lcmFiaWxpdHkgPSB7XG4gICAgICAgICAgICBwYWNrYWdlTmFtZSxcbiAgICAgICAgICAgIGN1cnJlbnRWZXJzaW9uOiB2dWxuLnZpYT8uWzBdPy5yYW5nZSB8fCAndW5rbm93bicsXG4gICAgICAgICAgICB2dWxuZXJhYmxlVmVyc2lvbnM6IHZ1bG4ucmFuZ2UgfHwgJ3Vua25vd24nLFxuICAgICAgICAgICAgc2V2ZXJpdHk6IHZ1bG4uc2V2ZXJpdHksXG4gICAgICAgICAgICBjdmU6IHZ1bG4udmlhPy5bMF0/LnNvdXJjZSB8fCAnTi9BJyxcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiB2dWxuLnZpYT8uWzBdPy50aXRsZSB8fCAnTm8gZGVzY3JpcHRpb24gYXZhaWxhYmxlJyxcbiAgICAgICAgICAgIGZpeGVkVmVyc2lvbjogdnVsbi5maXhBdmFpbGFibGU/LnZlcnNpb24sXG4gICAgICAgICAgICBwYXRjaEF2YWlsYWJsZTogISF2dWxuLmZpeEF2YWlsYWJsZSxcbiAgICAgICAgICB9O1xuXG4gICAgICAgICAgdnVsbmVyYWJpbGl0aWVzLnB1c2godnVsbmVyYWJpbGl0eSk7XG4gICAgICAgICAgc3VtbWFyeVt2dWxuLnNldmVyaXR5XSsrO1xuICAgICAgICAgIHN1bW1hcnkudG90YWwrKztcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBjb25zdCByZWNvbW1lbmRhdGlvbnMgPSB0aGlzLmdlbmVyYXRlU2VjdXJpdHlSZWNvbW1lbmRhdGlvbnModnVsbmVyYWJpbGl0aWVzLCBzdW1tYXJ5KTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdnVsbmVyYWJpbGl0aWVzLFxuICAgICAgICBzdW1tYXJ5LFxuICAgICAgICByZWNvbW1lbmRhdGlvbnMsXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ1NlY3VyaXR5IHZ1bG5lcmFiaWxpdHkgc2NhbiBmYWlsZWQnLCBlcnJvcik7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB2dWxuZXJhYmlsaXRpZXM6IFtdLFxuICAgICAgICBzdW1tYXJ5OiB7IGNyaXRpY2FsOiAwLCBoaWdoOiAwLCBtb2RlcmF0ZTogMCwgbG93OiAwLCB0b3RhbDogMCB9LFxuICAgICAgICByZWNvbW1lbmRhdGlvbnM6IFsnRmFpbGVkIHRvIHNjYW4gZm9yIHZ1bG5lcmFiaWxpdGllcy4gUGxlYXNlIHJ1biB5YXJuIGF1ZGl0IG1hbnVhbGx5LiddLFxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2sgZm9yIGF2YWlsYWJsZSBkZXBlbmRlbmN5IHVwZGF0ZXNcbiAgICovXG4gIGFzeW5jIGNoZWNrRGVwZW5kZW5jeVVwZGF0ZXMoKTogUHJvbWlzZTxVcGRhdGVSZXBvcnQ+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3Qgb3V0ZGF0ZWRPdXRwdXQgPSBleGVjU3luYygneWFybiBvdXRkYXRlZCAtLWpzb24nLCB7XG4gICAgICAgIGVuY29kaW5nOiAndXRmOCcsXG4gICAgICAgIHN0ZGlvOiAncGlwZScsXG4gICAgICAgIHRpbWVvdXQ6IDYwMDAwLFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IG91dGRhdGVkRGF0YSA9IEpTT04ucGFyc2Uob3V0ZGF0ZWRPdXRwdXQgfHwgJ3t9Jyk7XG4gICAgICBjb25zdCBhdmFpbGFibGVVcGRhdGVzOiBEZXBlbmRlbmN5VXBkYXRlW10gPSBbXTtcbiAgICAgIGNvbnN0IHN1bW1hcnk6IFVwZGF0ZVN1bW1hcnkgPSB7IG1ham9yOiAwLCBtaW5vcjogMCwgcGF0Y2g6IDAsIHNlY3VyaXR5OiAwLCB0b3RhbDogMCB9O1xuXG4gICAgICBmb3IgKGNvbnN0IFtwYWNrYWdlTmFtZSwgdXBkYXRlSW5mb10gb2YgT2JqZWN0LmVudHJpZXMob3V0ZGF0ZWREYXRhKSkge1xuICAgICAgICBjb25zdCBpbmZvID0gdXBkYXRlSW5mbyBhcyB1bmtub3duIGFzIHtcbiAgICAgICAgICBjdXJyZW50Pzogc3RyaW5nO1xuICAgICAgICAgIHdhbnRlZD86IHN0cmluZztcbiAgICAgICAgICBsYXRlc3Q/OiBzdHJpbmc7XG4gICAgICAgICAgZGVwZW5kZW50Pzogc3RyaW5nO1xuICAgICAgICAgIGxvY2F0aW9uPzogc3RyaW5nO1xuICAgICAgICAgIFtrZXk6IHN0cmluZ106IHVua25vd247XG4gICAgICAgIH07XG5cbiAgICAgICAgY29uc3QgdXBkYXRlVHlwZSA9IHRoaXMuZGV0ZXJtaW5lVXBkYXRlVHlwZShpbmZvLmN1cnJlbnQsIGluZm8ubGF0ZXN0KTtcbiAgICAgICAgY29uc3QgYnJlYWtpbmdDaGFuZ2VzID0gdXBkYXRlVHlwZSA9PT0gJ21ham9yJztcblxuICAgICAgICBjb25zdCB1cGRhdGU6IERlcGVuZGVuY3lVcGRhdGUgPSB7XG4gICAgICAgICAgcGFja2FnZU5hbWUsXG4gICAgICAgICAgY3VycmVudFZlcnNpb246IGluZm8uY3VycmVudCxcbiAgICAgICAgICBsYXRlc3RWZXJzaW9uOiBpbmZvLmxhdGVzdCxcbiAgICAgICAgICB1cGRhdGVUeXBlLFxuICAgICAgICAgIGNoYW5nZWxvZ1VybDogYXdhaXQgdGhpcy5nZXRDaGFuZ2Vsb2dVcmwocGFja2FnZU5hbWUpLFxuICAgICAgICAgIGJyZWFraW5nQ2hhbmdlcyxcbiAgICAgICAgICBzZWN1cml0eUZpeDogZmFsc2UsIC8vIFdpbGwgYmUgZGV0ZXJtaW5lZCBieSBjcm9zcy1yZWZlcmVuY2luZyB3aXRoIHNlY3VyaXR5IHNjYW5cbiAgICAgICAgICB0ZXN0aW5nUmVxdWlyZWQ6IGJyZWFraW5nQ2hhbmdlcyB8fCB0aGlzLnJlcXVpcmVzVGVzdGluZyhwYWNrYWdlTmFtZSksXG4gICAgICAgIH07XG5cbiAgICAgICAgYXZhaWxhYmxlVXBkYXRlcy5wdXNoKHVwZGF0ZSk7XG4gICAgICAgIHN1bW1hcnlbdXBkYXRlVHlwZV0rKztcbiAgICAgICAgc3VtbWFyeS50b3RhbCsrO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBhdmFpbGFibGVVcGRhdGVzLFxuICAgICAgICBhcHBsaWVkVXBkYXRlczogW10sXG4gICAgICAgIGZhaWxlZFVwZGF0ZXM6IFtdLFxuICAgICAgICBzdW1tYXJ5LFxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgLy8geWFybiBvdXRkYXRlZCByZXR1cm5zIG5vbi16ZXJvIGV4aXQgY29kZSB3aGVuIHVwZGF0ZXMgYXJlIGF2YWlsYWJsZVxuICAgICAgaWYgKChlcnJvciBhcyB1bmtub3duIGFzIHsgc3Rkb3V0Pzogc3RyaW5nIH0pLnN0ZG91dCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGNvbnN0IG91dGRhdGVkRGF0YSA9IEpTT04ucGFyc2UoKGVycm9yIGFzIHVua25vd24gYXMgeyBzdGRvdXQ6IHN0cmluZyB9KS5zdGRvdXQgfHwgJ3t9Jyk7XG4gICAgICAgICAgLy8gUHJvY2VzcyB0aGUgZGF0YSBhcyBhYm92ZVxuICAgICAgICAgIHJldHVybiB0aGlzLnByb2Nlc3NPdXRkYXRlZERhdGEob3V0ZGF0ZWREYXRhKTtcbiAgICAgICAgfSBjYXRjaCAocGFyc2VFcnJvcikge1xuICAgICAgICAgIGxvZ2dlci5lcnJvcignRmFpbGVkIHRvIHBhcnNlIHlhcm4gb3V0ZGF0ZWQgb3V0cHV0JywgcGFyc2VFcnJvcik7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgYXZhaWxhYmxlVXBkYXRlczogW10sXG4gICAgICAgIGFwcGxpZWRVcGRhdGVzOiBbXSxcbiAgICAgICAgZmFpbGVkVXBkYXRlczogW10sXG4gICAgICAgIHN1bW1hcnk6IHsgbWFqb3I6IDAsIG1pbm9yOiAwLCBwYXRjaDogMCwgc2VjdXJpdHk6IDAsIHRvdGFsOiAwIH0sXG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBBcHBseSBzZWN1cml0eSBwYXRjaGVzIGF1dG9tYXRpY2FsbHlcbiAgICovXG4gIGFzeW5jIGFwcGx5U2VjdXJpdHlQYXRjaGVzKFxuICAgIHZ1bG5lcmFiaWxpdGllczogU2VjdXJpdHlWdWxuZXJhYmlsaXR5W10sXG4gICk6IFByb21pc2U8RGVwZW5kZW5jeVVwZGF0ZVtdPiB7XG4gICAgY29uc3QgYXBwbGllZFVwZGF0ZXM6IERlcGVuZGVuY3lVcGRhdGVbXSA9IFtdO1xuXG4gICAgZm9yIChjb25zdCB2dWxuIG9mIHZ1bG5lcmFiaWxpdGllcykge1xuICAgICAgaWYgKCF2dWxuLnBhdGNoQXZhaWxhYmxlKSBjb250aW51ZTtcblxuICAgICAgY29uc3Qgc2hvdWxkQXV0b0ZpeCA9IHRoaXMuc2hvdWxkQXV0b0ZpeFZ1bG5lcmFiaWxpdHkodnVsbi5zZXZlcml0eSk7XG4gICAgICBpZiAoIXNob3VsZEF1dG9GaXgpIGNvbnRpbnVlO1xuXG4gICAgICBpZiAodGhpcy5jb25maWcuZXhjbHVkZWRQYWNrYWdlcy5pbmNsdWRlcyh2dWxuLnBhY2thZ2VOYW1lKSkge1xuICAgICAgICBsb2dnZXIuaW5mbyhgU2tpcHBpbmcgZXhjbHVkZWQgcGFja2FnZTogJHt2dWxuLnBhY2thZ2VOYW1lfWApO1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cblxuICAgICAgdHJ5IHtcbiAgICAgICAgLy8gQXBwbHkgdGhlIHNlY3VyaXR5IGZpeFxuICAgICAgICBjb25zdCB1cGRhdGVDb21tYW5kID0gdnVsbi5maXhlZFZlcnNpb25cbiAgICAgICAgICA/IGB5YXJuIGFkZCAke3Z1bG4ucGFja2FnZU5hbWV9QCR7dnVsbi5maXhlZFZlcnNpb259YFxuICAgICAgICAgIDogYHlhcm4gYXVkaXQgLS1maXhgO1xuXG4gICAgICAgIGV4ZWNTeW5jKHVwZGF0ZUNvbW1hbmQsIHtcbiAgICAgICAgICBlbmNvZGluZzogJ3V0ZjgnLFxuICAgICAgICAgIHN0ZGlvOiAncGlwZScsXG4gICAgICAgICAgdGltZW91dDogMTIwMDAwLFxuICAgICAgICB9KTtcblxuICAgICAgICBjb25zdCB1cGRhdGU6IERlcGVuZGVuY3lVcGRhdGUgPSB7XG4gICAgICAgICAgcGFja2FnZU5hbWU6IHZ1bG4ucGFja2FnZU5hbWUsXG4gICAgICAgICAgY3VycmVudFZlcnNpb246IHZ1bG4uY3VycmVudFZlcnNpb24sXG4gICAgICAgICAgbGF0ZXN0VmVyc2lvbjogdnVsbi5maXhlZFZlcnNpb24gfHwgJ3BhdGNoZWQnLFxuICAgICAgICAgIHVwZGF0ZVR5cGU6ICdwYXRjaCcsXG4gICAgICAgICAgYnJlYWtpbmdDaGFuZ2VzOiBmYWxzZSxcbiAgICAgICAgICBzZWN1cml0eUZpeDogdHJ1ZSxcbiAgICAgICAgICB0ZXN0aW5nUmVxdWlyZWQ6IGZhbHNlLFxuICAgICAgICB9O1xuXG4gICAgICAgIGFwcGxpZWRVcGRhdGVzLnB1c2godXBkYXRlKTtcbiAgICAgICAgbG9nZ2VyLmluZm8oYEFwcGxpZWQgc2VjdXJpdHkgcGF0Y2ggZm9yICR7dnVsbi5wYWNrYWdlTmFtZX1gKTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGxvZ2dlci5lcnJvcihgRmFpbGVkIHRvIGFwcGx5IHNlY3VyaXR5IHBhdGNoIGZvciAke3Z1bG4ucGFja2FnZU5hbWV9YCwgZXJyb3IpO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBhcHBsaWVkVXBkYXRlcztcbiAgfVxuXG4gIC8qKlxuICAgKiBBcHBseSBzYWZlIGRlcGVuZGVuY3kgdXBkYXRlc1xuICAgKi9cbiAgYXN5bmMgYXBwbHlTYWZlVXBkYXRlcyhhdmFpbGFibGVVcGRhdGVzOiBEZXBlbmRlbmN5VXBkYXRlW10pOiBQcm9taXNlPERlcGVuZGVuY3lVcGRhdGVbXT4ge1xuICAgIGNvbnN0IGFwcGxpZWRVcGRhdGVzOiBEZXBlbmRlbmN5VXBkYXRlW10gPSBbXTtcblxuICAgIGZvciAoY29uc3QgdXBkYXRlIG9mIGF2YWlsYWJsZVVwZGF0ZXMpIHtcbiAgICAgIGlmICh0aGlzLmNvbmZpZy5leGNsdWRlZFBhY2thZ2VzLmluY2x1ZGVzKHVwZGF0ZS5wYWNrYWdlTmFtZSkpIHtcbiAgICAgICAgbG9nZ2VyLmluZm8oYFNraXBwaW5nIGV4Y2x1ZGVkIHBhY2thZ2U6ICR7dXBkYXRlLnBhY2thZ2VOYW1lfWApO1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cblxuICAgICAgY29uc3Qgc3RyYXRlZ3kgPSB0aGlzLmdldFVwZGF0ZVN0cmF0ZWd5KHVwZGF0ZSk7XG4gICAgICBpZiAoIXN0cmF0ZWd5IHx8IHN0cmF0ZWd5LnVwZGF0ZVR5cGUgPT09ICdub25lJykgY29udGludWU7XG5cbiAgICAgIGlmIChzdHJhdGVneS5yZXF1aXJlc01hbnVhbEFwcHJvdmFsICYmIHVwZGF0ZS51cGRhdGVUeXBlID09PSAnbWFqb3InKSB7XG4gICAgICAgIGxvZ2dlci5pbmZvKGBTa2lwcGluZyBtYWpvciB1cGRhdGUgcmVxdWlyaW5nIG1hbnVhbCBhcHByb3ZhbDogJHt1cGRhdGUucGFja2FnZU5hbWV9YCk7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuXG4gICAgICB0cnkge1xuICAgICAgICAvLyBBcHBseSB0aGUgdXBkYXRlXG4gICAgICAgIGNvbnN0IHVwZGF0ZUNvbW1hbmQgPSBgeWFybiBhZGQgJHt1cGRhdGUucGFja2FnZU5hbWV9QCR7dXBkYXRlLmxhdGVzdFZlcnNpb259YDtcblxuICAgICAgICBleGVjU3luYyh1cGRhdGVDb21tYW5kLCB7XG4gICAgICAgICAgZW5jb2Rpbmc6ICd1dGY4JyxcbiAgICAgICAgICBzdGRpbzogJ3BpcGUnLFxuICAgICAgICAgIHRpbWVvdXQ6IDEyMDAwMCxcbiAgICAgICAgfSk7XG5cbiAgICAgICAgYXBwbGllZFVwZGF0ZXMucHVzaCh1cGRhdGUpO1xuICAgICAgICBsb2dnZXIuaW5mbyhcbiAgICAgICAgICBgQXBwbGllZCB1cGRhdGUgZm9yICR7dXBkYXRlLnBhY2thZ2VOYW1lfTogJHt1cGRhdGUuY3VycmVudFZlcnNpb259IOKGkiAke3VwZGF0ZS5sYXRlc3RWZXJzaW9ufWAsXG4gICAgICAgICk7XG5cbiAgICAgICAgLy8gUnVuIHRlc3RzIGlmIHJlcXVpcmVkXG4gICAgICAgIGlmIChzdHJhdGVneS50ZXN0aW5nUmVxdWlyZWQgJiYgdGhpcy5jb25maWcuY29tcGF0aWJpbGl0eVRlc3RpbmdFbmFibGVkKSB7XG4gICAgICAgICAgY29uc3QgdGVzdHNQYXNzID0gYXdhaXQgdGhpcy5ydW5QYWNrYWdlVGVzdHModXBkYXRlLnBhY2thZ2VOYW1lKTtcbiAgICAgICAgICBpZiAoIXRlc3RzUGFzcykge1xuICAgICAgICAgICAgbG9nZ2VyLndhcm4oYFRlc3RzIGZhaWxlZCBhZnRlciB1cGRhdGluZyAke3VwZGF0ZS5wYWNrYWdlTmFtZX0sIGNvbnNpZGVyIHJvbGxiYWNrYCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBsb2dnZXIuZXJyb3IoYEZhaWxlZCB0byBhcHBseSB1cGRhdGUgZm9yICR7dXBkYXRlLnBhY2thZ2VOYW1lfWAsIGVycm9yKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gYXBwbGllZFVwZGF0ZXM7XG4gIH1cblxuICAvKipcbiAgICogUnVuIGNvbXBhdGliaWxpdHkgdGVzdHNcbiAgICovXG4gIGFzeW5jIHJ1bkNvbXBhdGliaWxpdHlUZXN0cygpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICB0cnkge1xuICAgICAgLy8gUnVuIFR5cGVTY3JpcHQgY29tcGlsYXRpb24gY2hlY2tcbiAgICAgIGV4ZWNTeW5jKCd5YXJuIGJ1aWxkJywge1xuICAgICAgICBlbmNvZGluZzogJ3V0ZjgnLFxuICAgICAgICBzdGRpbzogJ3BpcGUnLFxuICAgICAgICB0aW1lb3V0OiAzMDAwMDAsXG4gICAgICB9KTtcblxuICAgICAgLy8gUnVuIHRlc3Qgc3VpdGVcbiAgICAgIGV4ZWNTeW5jKCd5YXJuIHRlc3QnLCB7XG4gICAgICAgIGVuY29kaW5nOiAndXRmOCcsXG4gICAgICAgIHN0ZGlvOiAncGlwZScsXG4gICAgICAgIHRpbWVvdXQ6IDMwMDAwMCxcbiAgICAgIH0pO1xuXG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdDb21wYXRpYmlsaXR5IHRlc3RzIGZhaWxlZCcsIGVycm9yKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cblxuICAvLyBQcml2YXRlIGhlbHBlciBtZXRob2RzXG5cbiAgcHJpdmF0ZSBwcm9jZXNzT3V0ZGF0ZWREYXRhKG91dGRhdGVkRGF0YTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4pOiBVcGRhdGVSZXBvcnQge1xuICAgIGNvbnN0IGF2YWlsYWJsZVVwZGF0ZXM6IERlcGVuZGVuY3lVcGRhdGVbXSA9IFtdO1xuICAgIGNvbnN0IHN1bW1hcnk6IFVwZGF0ZVN1bW1hcnkgPSB7IG1ham9yOiAwLCBtaW5vcjogMCwgcGF0Y2g6IDAsIHNlY3VyaXR5OiAwLCB0b3RhbDogMCB9O1xuXG4gICAgZm9yIChjb25zdCBbcGFja2FnZU5hbWUsIHVwZGF0ZUluZm9dIG9mIE9iamVjdC5lbnRyaWVzKG91dGRhdGVkRGF0YSkpIHtcbiAgICAgIGNvbnN0IGluZm8gPSB1cGRhdGVJbmZvIGFzIGFueTtcblxuICAgICAgY29uc3QgdXBkYXRlVHlwZSA9IHRoaXMuZGV0ZXJtaW5lVXBkYXRlVHlwZShpbmZvLmN1cnJlbnQsIGluZm8ubGF0ZXN0KTtcblxuICAgICAgY29uc3QgdXBkYXRlOiBEZXBlbmRlbmN5VXBkYXRlID0ge1xuICAgICAgICBwYWNrYWdlTmFtZSxcbiAgICAgICAgY3VycmVudFZlcnNpb246IGluZm8uY3VycmVudCxcbiAgICAgICAgbGF0ZXN0VmVyc2lvbjogaW5mby5sYXRlc3QsXG4gICAgICAgIHVwZGF0ZVR5cGUsXG4gICAgICAgIGJyZWFraW5nQ2hhbmdlczogdXBkYXRlVHlwZSA9PT0gJ21ham9yJyxcbiAgICAgICAgc2VjdXJpdHlGaXg6IGZhbHNlLFxuICAgICAgICB0ZXN0aW5nUmVxdWlyZWQ6IHVwZGF0ZVR5cGUgPT09ICdtYWpvcicgfHwgdGhpcy5yZXF1aXJlc1Rlc3RpbmcocGFja2FnZU5hbWUpLFxuICAgICAgfTtcblxuICAgICAgYXZhaWxhYmxlVXBkYXRlcy5wdXNoKHVwZGF0ZSk7XG4gICAgICBzdW1tYXJ5W3VwZGF0ZVR5cGVdKys7XG4gICAgICBzdW1tYXJ5LnRvdGFsKys7XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIGF2YWlsYWJsZVVwZGF0ZXMsXG4gICAgICBhcHBsaWVkVXBkYXRlczogW10sXG4gICAgICBmYWlsZWRVcGRhdGVzOiBbXSxcbiAgICAgIHN1bW1hcnksXG4gICAgfTtcbiAgfVxuXG4gIHByaXZhdGUgZGV0ZXJtaW5lVXBkYXRlVHlwZShjdXJyZW50OiBzdHJpbmcsIGxhdGVzdDogc3RyaW5nKTogJ21ham9yJyB8ICdtaW5vcicgfCAncGF0Y2gnIHtcbiAgICBjb25zdCBjdXJyZW50UGFydHMgPSBjdXJyZW50XG4gICAgICAucmVwbGFjZSgvW14wLTkuXS9nLCAnJylcbiAgICAgIC5zcGxpdCgnLicpXG4gICAgICAubWFwKE51bWJlcik7XG4gICAgY29uc3QgbGF0ZXN0UGFydHMgPSBsYXRlc3RcbiAgICAgIC5yZXBsYWNlKC9bXjAtOS5dL2csICcnKVxuICAgICAgLnNwbGl0KCcuJylcbiAgICAgIC5tYXAoTnVtYmVyKTtcblxuICAgIGlmIChsYXRlc3RQYXJ0c1swXSA+IGN1cnJlbnRQYXJ0c1swXSkgcmV0dXJuICdtYWpvcic7XG4gICAgaWYgKGxhdGVzdFBhcnRzWzFdID4gY3VycmVudFBhcnRzWzFdKSByZXR1cm4gJ21pbm9yJztcbiAgICByZXR1cm4gJ3BhdGNoJztcbiAgfVxuXG4gIHByaXZhdGUgc2hvdWxkQXV0b0ZpeFZ1bG5lcmFiaWxpdHkoc2V2ZXJpdHk6IHN0cmluZyk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IHsgc2VjdXJpdHlUaHJlc2hvbGRzIH0gPSB0aGlzLmNvbmZpZztcblxuICAgIHN3aXRjaCAoc2V2ZXJpdHkpIHtcbiAgICAgIGNhc2UgJ2NyaXRpY2FsJzpcbiAgICAgICAgcmV0dXJuIHNlY3VyaXR5VGhyZXNob2xkcy5hdXRvRml4Q3JpdGljYWw7XG4gICAgICBjYXNlICdoaWdoJzpcbiAgICAgICAgcmV0dXJuIHNlY3VyaXR5VGhyZXNob2xkcy5hdXRvRml4SGlnaDtcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGdldFVwZGF0ZVN0cmF0ZWd5KHVwZGF0ZTogRGVwZW5kZW5jeVVwZGF0ZSk6IFVwZGF0ZVN0cmF0ZWd5IHwgbnVsbCB7XG4gICAgZm9yIChjb25zdCBzdHJhdGVneSBvZiB0aGlzLmNvbmZpZy51cGRhdGVTdHJhdGVnaWVzKSB7XG4gICAgICBpZiAoc3RyYXRlZ3kucGF0dGVybi50ZXN0KHVwZGF0ZS5wYWNrYWdlTmFtZSkpIHtcbiAgICAgICAgcmV0dXJuIHN0cmF0ZWd5O1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuXG4gIHByaXZhdGUgcmVxdWlyZXNUZXN0aW5nKHBhY2thZ2VOYW1lOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICAvLyBQYWNrYWdlcyB0aGF0IHR5cGljYWxseSByZXF1aXJlIHRlc3RpbmcgYWZ0ZXIgdXBkYXRlc1xuICAgIGNvbnN0IHRlc3RpbmdSZXF1aXJlZFBhdHRlcm5zID0gW1xuICAgICAgL15yZWFjdC8sXG4gICAgICAvXm5leHQvLFxuICAgICAgL150eXBlc2NyaXB0LyxcbiAgICAgIC9eQHR5cGVzXFwvLyxcbiAgICAgIC9eZXNsaW50LyxcbiAgICAgIC9eamVzdC8sXG4gICAgICAvXmJhYmVsLyxcbiAgICBdO1xuXG4gICAgcmV0dXJuIHRlc3RpbmdSZXF1aXJlZFBhdHRlcm5zLnNvbWUocGF0dGVybiA9PiBwYXR0ZXJuLnRlc3QocGFja2FnZU5hbWUpKTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgZ2V0Q2hhbmdlbG9nVXJsKHBhY2thZ2VOYW1lOiBzdHJpbmcpOiBQcm9taXNlPHN0cmluZyB8IHVuZGVmaW5lZD4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBwYWNrYWdlSW5mbyA9IGV4ZWNTeW5jKGB5YXJuIGluZm8gJHtwYWNrYWdlTmFtZX0gLS1qc29uYCwge1xuICAgICAgICBlbmNvZGluZzogJ3V0ZjgnLFxuICAgICAgICBzdGRpbzogJ3BpcGUnLFxuICAgICAgICB0aW1lb3V0OiAxMDAwMCxcbiAgICAgIH0pO1xuXG4gICAgICBjb25zdCBpbmZvID0gSlNPTi5wYXJzZShwYWNrYWdlSW5mbyk7XG4gICAgICByZXR1cm4gaW5mby5yZXBvc2l0b3J5Py51cmwgfHwgaW5mby5ob21lcGFnZTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHJ1blBhY2thZ2VUZXN0cyhwYWNrYWdlTmFtZTogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIFJ1biBhIHN1YnNldCBvZiB0ZXN0cyByZWxhdGVkIHRvIHRoZSB1cGRhdGVkIHBhY2thZ2VcbiAgICAgIGV4ZWNTeW5jKCd5YXJuIHRlc3QgLS10ZXN0TmFtZVBhdHRlcm49XCIuKlwiIC0tYmFpbCcsIHtcbiAgICAgICAgZW5jb2Rpbmc6ICd1dGY4JyxcbiAgICAgICAgc3RkaW86ICdwaXBlJyxcbiAgICAgICAgdGltZW91dDogNjAwMDAsXG4gICAgICB9KTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBnZXREZXBlbmRlbmN5Q291bnQoKTogUHJvbWlzZTxudW1iZXI+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgcGFja2FnZUpzb24gPSBKU09OLnBhcnNlKGZzLnJlYWRGaWxlU3luYyh0aGlzLnBhY2thZ2VKc29uUGF0aCwgJ3V0ZjgnKSk7XG4gICAgICBjb25zdCBkZXBzID0gT2JqZWN0LmtleXMocGFja2FnZUpzb24uZGVwZW5kZW5jaWVzIHx8IHt9KTtcbiAgICAgIGNvbnN0IGRldkRlcHMgPSBPYmplY3Qua2V5cyhwYWNrYWdlSnNvbi5kZXZEZXBlbmRlbmNpZXMgfHwge30pO1xuICAgICAgcmV0dXJuIGRlcHMubGVuZ3RoICsgZGV2RGVwcy5sZW5ndGg7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZ2VuZXJhdGVTZWN1cml0eVJlY29tbWVuZGF0aW9ucyhcbiAgICB2dWxuZXJhYmlsaXRpZXM6IFNlY3VyaXR5VnVsbmVyYWJpbGl0eVtdLFxuICAgIHN1bW1hcnk6IFNlY3VyaXR5U3VtbWFyeSxcbiAgKTogc3RyaW5nW10ge1xuICAgIGNvbnN0IHJlY29tbWVuZGF0aW9uczogc3RyaW5nW10gPSBbXTtcblxuICAgIGlmIChzdW1tYXJ5LmNyaXRpY2FsID4gMCkge1xuICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goXG4gICAgICAgIGDwn5qoICR7c3VtbWFyeS5jcml0aWNhbH0gY3JpdGljYWwgdnVsbmVyYWJpbGl0aWVzIGZvdW5kIC0gaW1tZWRpYXRlIGFjdGlvbiByZXF1aXJlZGAsXG4gICAgICApO1xuICAgIH1cblxuICAgIGlmIChzdW1tYXJ5LmhpZ2ggPiAwKSB7XG4gICAgICByZWNvbW1lbmRhdGlvbnMucHVzaChcbiAgICAgICAgYOKaoO+4jyAke3N1bW1hcnkuaGlnaH0gaGlnaCBzZXZlcml0eSB2dWxuZXJhYmlsaXRpZXMgZm91bmQgLSB1cGRhdGUgYXMgc29vbiBhcyBwb3NzaWJsZWAsXG4gICAgICApO1xuICAgIH1cblxuICAgIGlmIChzdW1tYXJ5Lm1vZGVyYXRlID4gMCkge1xuICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goYPCfk4sgJHtzdW1tYXJ5Lm1vZGVyYXRlfSBtb2RlcmF0ZSB2dWxuZXJhYmlsaXRpZXMgZm91bmQgLSBwbGFuIHVwZGF0ZXNgKTtcbiAgICB9XG5cbiAgICBjb25zdCBwYXRjaGFibGVWdWxucyA9IHZ1bG5lcmFiaWxpdGllcy5maWx0ZXIodiA9PiB2LnBhdGNoQXZhaWxhYmxlKTtcbiAgICBpZiAocGF0Y2hhYmxlVnVsbnMubGVuZ3RoID4gMCkge1xuICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goYOKchSAke3BhdGNoYWJsZVZ1bG5zLmxlbmd0aH0gdnVsbmVyYWJpbGl0aWVzIGhhdmUgcGF0Y2hlcyBhdmFpbGFibGVgKTtcbiAgICB9XG5cbiAgICBpZiAoc3VtbWFyeS50b3RhbCA9PT0gMCkge1xuICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goJ+KchSBObyBzZWN1cml0eSB2dWxuZXJhYmlsaXRpZXMgZm91bmQnKTtcbiAgICB9XG5cbiAgICByZXR1cm4gcmVjb21tZW5kYXRpb25zO1xuICB9XG59XG5cbi8qKlxuICogRGVmYXVsdCBjb25maWd1cmF0aW9uIGZvciBkZXBlbmRlbmN5IGFuZCBzZWN1cml0eSBtb25pdG9yaW5nXG4gKi9cbmV4cG9ydCBjb25zdCBERUZBVUxUX0RFUEVOREVOQ1lfU0VDVVJJVFlfQ09ORklHOiBEZXBlbmRlbmN5U2VjdXJpdHlDb25maWcgPSB7XG4gIG1heERlcGVuZGVuY2llc1BlckJhdGNoOiAxMCxcbiAgc2FmZXR5VmFsaWRhdGlvbkVuYWJsZWQ6IHRydWUsXG4gIGF1dG9VcGRhdGVFbmFibGVkOiBmYWxzZSwgLy8gRGlzYWJsZWQgYnkgZGVmYXVsdCBmb3Igc2FmZXR5XG4gIHNlY3VyaXR5U2NhbkVuYWJsZWQ6IHRydWUsXG4gIGNvbXBhdGliaWxpdHlUZXN0aW5nRW5hYmxlZDogdHJ1ZSxcbiAgdXBkYXRlU3RyYXRlZ2llczogW1xuICAgIHtcbiAgICAgIG5hbWU6ICdTZWN1cml0eSBwYXRjaGVzJyxcbiAgICAgIGRlc2NyaXB0aW9uOiAnQXV0b21hdGljYWxseSBhcHBseSBzZWN1cml0eSBwYXRjaGVzJyxcbiAgICAgIHBhdHRlcm46IC8uKi8sXG4gICAgICB1cGRhdGVUeXBlOiAncGF0Y2gnLFxuICAgICAgcmVxdWlyZXNNYW51YWxBcHByb3ZhbDogZmFsc2UsXG4gICAgICB0ZXN0aW5nUmVxdWlyZWQ6IGZhbHNlLFxuICAgIH0sXG4gICAge1xuICAgICAgbmFtZTogJ1R5cGVTY3JpcHQgZWNvc3lzdGVtJyxcbiAgICAgIGRlc2NyaXB0aW9uOiAnQ2FyZWZ1bCB1cGRhdGVzIGZvciBUeXBlU2NyaXB0LXJlbGF0ZWQgcGFja2FnZXMnLFxuICAgICAgcGF0dGVybjogL14oQHR5cGVzXFwvfHR5cGVzY3JpcHR8dHMtKS8sXG4gICAgICB1cGRhdGVUeXBlOiAnbWlub3InLFxuICAgICAgcmVxdWlyZXNNYW51YWxBcHByb3ZhbDogdHJ1ZSxcbiAgICAgIHRlc3RpbmdSZXF1aXJlZDogdHJ1ZSxcbiAgICB9LFxuICAgIHtcbiAgICAgIG5hbWU6ICdSZWFjdCBlY29zeXN0ZW0nLFxuICAgICAgZGVzY3JpcHRpb246ICdDYXJlZnVsIHVwZGF0ZXMgZm9yIFJlYWN0LXJlbGF0ZWQgcGFja2FnZXMnLFxuICAgICAgcGF0dGVybjogL14ocmVhY3R8QHJlYWN0fG5leHQpLyxcbiAgICAgIHVwZGF0ZVR5cGU6ICdtaW5vcicsXG4gICAgICByZXF1aXJlc01hbnVhbEFwcHJvdmFsOiB0cnVlLFxuICAgICAgdGVzdGluZ1JlcXVpcmVkOiB0cnVlLFxuICAgIH0sXG4gICAge1xuICAgICAgbmFtZTogJ0RldmVsb3BtZW50IHRvb2xzJyxcbiAgICAgIGRlc2NyaXB0aW9uOiAnU2FmZSB1cGRhdGVzIGZvciBkZXZlbG9wbWVudCB0b29scycsXG4gICAgICBwYXR0ZXJuOiAvXihlc2xpbnR8cHJldHRpZXJ8amVzdHxiYWJlbCkvLFxuICAgICAgdXBkYXRlVHlwZTogJ21pbm9yJyxcbiAgICAgIHJlcXVpcmVzTWFudWFsQXBwcm92YWw6IGZhbHNlLFxuICAgICAgdGVzdGluZ1JlcXVpcmVkOiB0cnVlLFxuICAgIH0sXG4gIF0sXG4gIHNlY3VyaXR5VGhyZXNob2xkczoge1xuICAgIGNyaXRpY2FsOiAwLFxuICAgIGhpZ2g6IDUsXG4gICAgbW9kZXJhdGU6IDEwLFxuICAgIGxvdzogMjAsXG4gICAgYXV0b0ZpeENyaXRpY2FsOiB0cnVlLFxuICAgIGF1dG9GaXhIaWdoOiBmYWxzZSxcbiAgfSxcbiAgZXhjbHVkZWRQYWNrYWdlczogW1xuICAgIC8vIFBhY2thZ2VzIHRvIG5ldmVyIGF1dG8tdXBkYXRlXG4gICAgJ3JlYWN0JyxcbiAgICAncmVhY3QtZG9tJyxcbiAgICAnbmV4dCcsXG4gICAgJ3R5cGVzY3JpcHQnLFxuICBdLFxufTtcbiJdLCJ2ZXJzaW9uIjozfQ==