1b49d92ae25e3d4335ca6f733f711203
"use strict";
/**
 * Safe Unused Import Removal System
 *
 * Implements comprehensive unused import removal while preserving:
 * - Imports used in type annotations or JSX
 * - Dynamic imports and conditional imports
 * - Critical astrological calculation imports
 * - Campaign system intelligence imports
 *
 * Requirements: 3.2, 4.1
 */
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.SafeUnusedImportRemover = void 0;
const child_process_1 = require("child_process");
const path_1 = __importDefault(require("path"));
const LoggingService_1 = require("@/services/LoggingService");
class SafeUnusedImportRemover {
    astrologicalPatterns = [
        '/calculations/',
        '/data/planets/',
        '/utils/reliableAstronomy',
        '/utils/astrologyUtils',
        '/utils/planetaryConsistencyCheck',
        'astrological',
        'planetary',
        'elemental',
        'astronomical',
        'ephemeris',
        'transit',
        'zodiac',
    ];
    campaignSystemPatterns = [
        '/services/campaign/',
        '/services/AdvancedAnalyticsIntelligenceService',
        '/services/MLIntelligenceService',
        '/services/PredictiveIntelligenceService',
        'Campaign',
        'Intelligence',
        'Analytics',
        'Progress',
        'Metrics',
        'Safety',
    ];
    /**
     * Analyze and remove unused imports safely
     */
    async processUnusedImports(dryRun = true) {
        LoggingService_1.log.info('üîç Starting Safe Unused Import Analysis...\n');
        const result = {
            totalAnalyzed: 0,
            safeToRemove: 0,
            requiresReview: 0,
            preserved: 0,
            actuallyRemoved: 0,
            errors: [],
            warnings: [],
            buildValid: false,
        };
        try {
            // Step 1: Analyze unused imports
            const unusedImports = await this.analyzeUnusedImports();
            result.totalAnalyzed = unusedImports.length;
            if (unusedImports.length === 0) {
                LoggingService_1.log.info('‚úÖ No unused imports found!');
                result.buildValid = true;
                return result;
            }
            // Step 2: Categorize imports
            const categorized = this.categorizeImports(unusedImports);
            result.safeToRemove = categorized.safe.length;
            result.requiresReview = categorized.review.length;
            result.preserved = categorized.preserve.length;
            // Step 3: Display analysis results
            this.displayAnalysisResults(categorized);
            if (dryRun) {
                LoggingService_1.log.info('\nüîç DRY RUN MODE - No changes will be made');
                LoggingService_1.log.info('Use processUnusedImports(false) to execute removal');
                return result;
            }
            // Step 4: Remove safe imports
            if (categorized.safe.length > 0) {
                const removalSuccess = await this.removeSafeImports(categorized.safe);
                result.actuallyRemoved = removalSuccess ? categorized.safe.length : 0;
            }
            // Step 5: Validate changes
            result.buildValid = await this.validateChanges();
            if (result.buildValid) {
                LoggingService_1.log.info('\nüéâ Safe unused import removal completed successfully!');
                LoggingService_1.log.info(`‚úÖ Removed ${result.actuallyRemoved} unused imports`);
                LoggingService_1.log.info(`üõ°Ô∏è  Preserved ${result.preserved} critical imports`);
            }
            else {
                result.errors.push('Build validation failed after import removal');
            }
        }
        catch (error) {
            result.errors.push(`Import removal failed: ${error}`);
            console.error('‚ùå Import removal failed:', error);
        }
        return result;
    }
    /**
     * Analyze unused imports from ESLint output
     */
    async analyzeUnusedImports() {
        LoggingService_1.log.info('üîç Analyzing unused imports from ESLint...');
        try {
            const lintOutput = (0, child_process_1.execSync)('yarn lint --format=compact 2>&1', {
                encoding: 'utf8',
                maxBuffer: 20 * 1024 * 1024,
            });
            const unusedImports = [];
            const lines = lintOutput.split('\n');
            for (const line of lines) {
                if (line.includes('@typescript-eslint/no-unused-vars') &&
                    (line.includes('is defined but never used') ||
                        line.includes('is imported but never used'))) {
                    const match = line.match(/^(.+):(\d+):(\d+):\s+(warning|error)\s+(.+?)\s+@typescript-eslint\/no-unused-vars/);
                    if (match) {
                        const [, filePath, lineNum, colNum, severity, message] = match;
                        const importNameMatch = message.match(/'([^']+)'/);
                        const importName = importNameMatch ? importNameMatch[1] : '';
                        unusedImports.push({
                            file: filePath,
                            line: parseInt(lineNum),
                            column: parseInt(colNum),
                            importName,
                            message,
                            isTypeImport: message.includes('type'),
                            isDefaultImport: !message.includes('{'),
                            isNamespaceImport: message.includes('* as'),
                            severity: 'review',
                            reason: '',
                        });
                    }
                }
            }
            LoggingService_1.log.info(`üìä Found ${unusedImports.length} unused imports`);
            return unusedImports;
        }
        catch (error) {
            console.error('‚ùå Failed to analyze unused imports:', error);
            return [];
        }
    }
    /**
     * Categorize imports by safety level
     */
    categorizeImports(unusedImports) {
        LoggingService_1.log.info('üìã Categorizing imports by safety level...');
        const categorized = {
            safe: [],
            review: [],
            preserve: [],
        };
        for (const unusedImport of unusedImports) {
            const category = this.determineImportSafety(unusedImport);
            unusedImport.severity = category.severity;
            unusedImport.reason = category.reason;
            switch (category.severity) {
                case 'safe':
                    categorized.safe.push(unusedImport);
                    break;
                case 'review':
                    categorized.review.push(unusedImport);
                    break;
                case 'preserve':
                    categorized.preserve.push(unusedImport);
                    break;
            }
        }
        return categorized;
    }
    /**
     * Determine the safety level of removing an import
     */
    determineImportSafety(unusedImport) {
        const { file, importName, message, isTypeImport } = unusedImport;
        // Always preserve imports in critical astrological files
        if (this.astrologicalPatterns.some(pattern => file.includes(pattern))) {
            return {
                severity: 'preserve',
                reason: 'Critical astrological calculation file',
            };
        }
        // Always preserve imports in campaign system files
        if (this.campaignSystemPatterns.some(pattern => file.includes(pattern))) {
            return {
                severity: 'preserve',
                reason: 'Campaign system intelligence file',
            };
        }
        // Preserve React component imports in TSX files
        if (importName.match(/^[A-Z]/) && file.endsWith('.tsx')) {
            return {
                severity: 'preserve',
                reason: 'React component import in TSX file',
            };
        }
        // Preserve type imports (might be used in type annotations)
        if (isTypeImport) {
            return {
                severity: 'preserve',
                reason: 'Type import may be used in annotations',
            };
        }
        // Safe to remove: simple utility imports that are clearly unused
        const safePatterns = [
            /^[a-z][a-zA-Z]*$/,
            /^[A-Z_]+$/,
            /Utils?$/,
            /Helper$/,
            /Config$/,
            /Constants?$/, // Constants
        ];
        if (safePatterns.some(pattern => pattern.test(importName)) &&
            message.includes('is defined but never used') &&
            !file.includes('.d.ts')) {
            return {
                severity: 'safe',
                reason: 'Simple utility import that is clearly unused',
            };
        }
        // Default to requiring manual review
        return {
            severity: 'review',
            reason: 'Requires manual review for safety',
        };
    }
    /**
     * Display analysis results
     */
    displayAnalysisResults(categorized) {
        LoggingService_1.log.info('\nüìä Import Analysis Results:');
        LoggingService_1.log.info(`‚úÖ Safe to remove: ${categorized.safe.length}`);
        LoggingService_1.log.info(`‚ö†Ô∏è  Requires review: ${categorized.review.length}`);
        LoggingService_1.log.info(`üõ°Ô∏è  Preserved (critical): ${categorized.preserve.length}\n`);
        if (categorized.safe.length > 0) {
            LoggingService_1.log.info('‚úÖ Safe to Remove:');
            this.displayImportsByFile(categorized.safe);
        }
        if (categorized.preserve.length > 0) {
            LoggingService_1.log.info('\nüõ°Ô∏è  Preserved (Critical):');
            this.displayImportsByFile(categorized.preserve.slice(0, 10)); // Show first 10
            if (categorized.preserve.length > 10) {
                LoggingService_1.log.info(`   ... and ${categorized.preserve.length - 10} more`);
            }
        }
        if (categorized.review.length > 0) {
            LoggingService_1.log.info('\n‚ö†Ô∏è  Requires Manual Review:');
            this.displayImportsByFile(categorized.review.slice(0, 5)); // Show first 5
            if (categorized.review.length > 5) {
                LoggingService_1.log.info(`   ... and ${categorized.review.length - 5} more`);
            }
        }
    }
    /**
     * Display imports grouped by file
     */
    displayImportsByFile(imports) {
        const groupedByFile = imports.reduce((acc, imp) => {
            const relativePath = path_1.default.relative(process.cwd(), imp.file);
            if (!acc[relativePath])
                acc[relativePath] = [];
            acc[relativePath].push(imp);
            return acc;
        }, {});
        Object.entries(groupedByFile).forEach(([file, fileImports]) => {
            LoggingService_1.log.info(`   üìÑ ${file}:`);
            fileImports.forEach(imp => {
                LoggingService_1.log.info(`      - Line ${imp.line}: '${imp.importName}' (${imp.reason})`);
            });
        });
    }
    /**
     * Remove safe imports using ESLint auto-fix
     */
    async removeSafeImports(safeImports) {
        LoggingService_1.log.info(`\nüóëÔ∏è  Removing ${safeImports.length} safe unused imports...`);
        try {
            // Run ESLint auto-fix with focused unused variable removal
            (0, child_process_1.execSync)('yarn lint --fix --rule "@typescript-eslint/no-unused-vars: error"', {
                stdio: 'pipe',
                encoding: 'utf8',
            });
            LoggingService_1.log.info('‚úÖ Safe import removal completed');
            return true;
        }
        catch (error) {
            // ESLint returns non-zero exit code even for successful fixes
            if (error.stdout && !error.stdout.includes('error')) {
                LoggingService_1.log.info('‚úÖ Safe import removal completed');
                return true;
            }
            else {
                console.error('‚ùå Safe import removal failed:', error.message);
                return false;
            }
        }
    }
    /**
     * Validate changes by running TypeScript check and build
     */
    async validateChanges() {
        LoggingService_1.log.info('\nüîç Validating changes...');
        try {
            // Check TypeScript compilation
            (0, child_process_1.execSync)('yarn tsc --noEmit --skipLibCheck', {
                stdio: 'pipe',
                encoding: 'utf8',
            });
            LoggingService_1.log.info('‚úÖ TypeScript validation passed');
            return true;
        }
        catch (error) {
            console.error('‚ùå Validation failed');
            return false;
        }
    }
    /**
     * Get current import statistics
     */
    getImportStats() {
        try {
            // Count TypeScript/JavaScript files
            const totalFilesOutput = (0, child_process_1.execSync)('find src -name "*.ts" -o -name "*.tsx" -o -name "*.js" -o -name "*.jsx" | wc -l', {
                encoding: 'utf8',
            });
            const totalFiles = parseInt(totalFilesOutput.trim()) || 0;
            // Count TypeScript files specifically
            const tsFilesOutput = (0, child_process_1.execSync)('find src -name "*.ts" -o -name "*.tsx" | wc -l', {
                encoding: 'utf8',
            });
            const typeScriptFiles = parseInt(tsFilesOutput.trim()) || 0;
            // Count unused import warnings (approximate)
            const unusedImportsOutput = (0, child_process_1.execSync)('yarn lint --format=compact 2>&1 | grep -E "@typescript-eslint/no-unused-vars.*is defined but never used" | wc -l', {
                encoding: 'utf8',
            });
            const unusedImports = parseInt(unusedImportsOutput.trim()) || 0;
            return { totalFiles, unusedImports, typeScriptFiles };
        }
        catch (error) {
            return { totalFiles: 0, unusedImports: 0, typeScriptFiles: 0 };
        }
    }
}
exports.SafeUnusedImportRemover = SafeUnusedImportRemover;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L2JhY2t1cHMvZmlyc3Qtd2F2ZS0yMDI1LTA4LTExVDA1LTE5LTI2LTgxM1ovc3JjL3NlcnZpY2VzL2xpbnRpbmcvU2FmZVVudXNlZEltcG9ydFJlbW92ZXIudHMiLCJtYXBwaW5ncyI6IjtBQUFBOzs7Ozs7Ozs7O0dBVUc7Ozs7OztBQUVILGlEQUF5QztBQUV6QyxnREFBd0I7QUFFeEIsOERBQWdEO0FBMEJoRCxNQUFhLHVCQUF1QjtJQUNqQixvQkFBb0IsR0FBRztRQUN0QyxnQkFBZ0I7UUFDaEIsZ0JBQWdCO1FBQ2hCLDBCQUEwQjtRQUMxQix1QkFBdUI7UUFDdkIsa0NBQWtDO1FBQ2xDLGNBQWM7UUFDZCxXQUFXO1FBQ1gsV0FBVztRQUNYLGNBQWM7UUFDZCxXQUFXO1FBQ1gsU0FBUztRQUNULFFBQVE7S0FDVCxDQUFDO0lBRWUsc0JBQXNCLEdBQUc7UUFDeEMscUJBQXFCO1FBQ3JCLGdEQUFnRDtRQUNoRCxpQ0FBaUM7UUFDakMseUNBQXlDO1FBQ3pDLFVBQVU7UUFDVixjQUFjO1FBQ2QsV0FBVztRQUNYLFVBQVU7UUFDVixTQUFTO1FBQ1QsUUFBUTtLQUNULENBQUM7SUFFRjs7T0FFRztJQUNJLEtBQUssQ0FBQyxvQkFBb0IsQ0FBQyxTQUFrQixJQUFJO1FBQ3RELG9CQUFHLENBQUMsSUFBSSxDQUFDLDhDQUE4QyxDQUFDLENBQUM7UUFFekQsTUFBTSxNQUFNLEdBQXdCO1lBQ2xDLGFBQWEsRUFBRSxDQUFDO1lBQ2hCLFlBQVksRUFBRSxDQUFDO1lBQ2YsY0FBYyxFQUFFLENBQUM7WUFDakIsU0FBUyxFQUFFLENBQUM7WUFDWixlQUFlLEVBQUUsQ0FBQztZQUNsQixNQUFNLEVBQUUsRUFBRTtZQUNWLFFBQVEsRUFBRSxFQUFFO1lBQ1osVUFBVSxFQUFFLEtBQUs7U0FDbEIsQ0FBQztRQUVGLElBQUk7WUFDRixpQ0FBaUM7WUFDakMsTUFBTSxhQUFhLEdBQUcsTUFBTSxJQUFJLENBQUMsb0JBQW9CLEVBQUUs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LENBQUMsRUFBRSxlQUFlLEVBQUUsQ0FBQyxFQUFFLENBQUM7U0FDaEU7SUFDSCxDQUFDO0NBQ0Y7QUEvWUQsMERBK1lDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9HcmVnQ2FzdHJvL0Rlc2t0b3AvV2hhdFRvRWF0TmV4dC9iYWNrdXBzL2ZpcnN0LXdhdmUtMjAyNS0wOC0xMVQwNS0xOS0yNi04MTNaL3NyYy9zZXJ2aWNlcy9saW50aW5nL1NhZmVVbnVzZWRJbXBvcnRSZW1vdmVyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogU2FmZSBVbnVzZWQgSW1wb3J0IFJlbW92YWwgU3lzdGVtXG4gKlxuICogSW1wbGVtZW50cyBjb21wcmVoZW5zaXZlIHVudXNlZCBpbXBvcnQgcmVtb3ZhbCB3aGlsZSBwcmVzZXJ2aW5nOlxuICogLSBJbXBvcnRzIHVzZWQgaW4gdHlwZSBhbm5vdGF0aW9ucyBvciBKU1hcbiAqIC0gRHluYW1pYyBpbXBvcnRzIGFuZCBjb25kaXRpb25hbCBpbXBvcnRzXG4gKiAtIENyaXRpY2FsIGFzdHJvbG9naWNhbCBjYWxjdWxhdGlvbiBpbXBvcnRzXG4gKiAtIENhbXBhaWduIHN5c3RlbSBpbnRlbGxpZ2VuY2UgaW1wb3J0c1xuICpcbiAqIFJlcXVpcmVtZW50czogMy4yLCA0LjFcbiAqL1xuXG5pbXBvcnQgeyBleGVjU3luYyB9IGZyb20gJ2NoaWxkX3Byb2Nlc3MnO1xuaW1wb3J0IGZzIGZyb20gJ2ZzJztcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuXG5pbXBvcnQgeyBsb2cgfSBmcm9tICdAL3NlcnZpY2VzL0xvZ2dpbmdTZXJ2aWNlJztcblxuaW50ZXJmYWNlIFVudXNlZEltcG9ydCB7XG4gIGZpbGU6IHN0cmluZztcbiAgbGluZTogbnVtYmVyO1xuICBjb2x1bW46IG51bWJlcjtcbiAgaW1wb3J0TmFtZTogc3RyaW5nO1xuICBtZXNzYWdlOiBzdHJpbmc7XG4gIGlzVHlwZUltcG9ydDogYm9vbGVhbjtcbiAgaXNEZWZhdWx0SW1wb3J0OiBib29sZWFuO1xuICBpc05hbWVzcGFjZUltcG9ydDogYm9vbGVhbjtcbiAgc2V2ZXJpdHk6ICdzYWZlJyB8ICdyZXZpZXcnIHwgJ3ByZXNlcnZlJztcbiAgcmVhc29uPzogc3RyaW5nO1xufVxuXG5pbnRlcmZhY2UgSW1wb3J0UmVtb3ZhbFJlc3VsdCB7XG4gIHRvdGFsQW5hbHl6ZWQ6IG51bWJlcjtcbiAgc2FmZVRvUmVtb3ZlOiBudW1iZXI7XG4gIHJlcXVpcmVzUmV2aWV3OiBudW1iZXI7XG4gIHByZXNlcnZlZDogbnVtYmVyO1xuICBhY3R1YWxseVJlbW92ZWQ6IG51bWJlcjtcbiAgZXJyb3JzOiBzdHJpbmdbXTtcbiAgd2FybmluZ3M6IHN0cmluZ1tdO1xuICBidWlsZFZhbGlkOiBib29sZWFuO1xufVxuXG5leHBvcnQgY2xhc3MgU2FmZVVudXNlZEltcG9ydFJlbW92ZXIge1xuICBwcml2YXRlIHJlYWRvbmx5IGFzdHJvbG9naWNhbFBhdHRlcm5zID0gW1xuICAgICcvY2FsY3VsYXRpb25zLycsXG4gICAgJy9kYXRhL3BsYW5ldHMvJyxcbiAgICAnL3V0aWxzL3JlbGlhYmxlQXN0cm9ub215JyxcbiAgICAnL3V0aWxzL2FzdHJvbG9neVV0aWxzJyxcbiAgICAnL3V0aWxzL3BsYW5ldGFyeUNvbnNpc3RlbmN5Q2hlY2snLFxuICAgICdhc3Ryb2xvZ2ljYWwnLFxuICAgICdwbGFuZXRhcnknLFxuICAgICdlbGVtZW50YWwnLFxuICAgICdhc3Ryb25vbWljYWwnLFxuICAgICdlcGhlbWVyaXMnLFxuICAgICd0cmFuc2l0JyxcbiAgICAnem9kaWFjJyxcbiAgXTtcblxuICBwcml2YXRlIHJlYWRvbmx5IGNhbXBhaWduU3lzdGVtUGF0dGVybnMgPSBbXG4gICAgJy9zZXJ2aWNlcy9jYW1wYWlnbi8nLFxuICAgICcvc2VydmljZXMvQWR2YW5jZWRBbmFseXRpY3NJbnRlbGxpZ2VuY2VTZXJ2aWNlJyxcbiAgICAnL3NlcnZpY2VzL01MSW50ZWxsaWdlbmNlU2VydmljZScsXG4gICAgJy9zZXJ2aWNlcy9QcmVkaWN0aXZlSW50ZWxsaWdlbmNlU2VydmljZScsXG4gICAgJ0NhbXBhaWduJyxcbiAgICAnSW50ZWxsaWdlbmNlJyxcbiAgICAnQW5hbHl0aWNzJyxcbiAgICAnUHJvZ3Jlc3MnLFxuICAgICdNZXRyaWNzJyxcbiAgICAnU2FmZXR5JyxcbiAgXTtcblxuICAvKipcbiAgICogQW5hbHl6ZSBhbmQgcmVtb3ZlIHVudXNlZCBpbXBvcnRzIHNhZmVseVxuICAgKi9cbiAgcHVibGljIGFzeW5jIHByb2Nlc3NVbnVzZWRJbXBvcnRzKGRyeVJ1bjogYm9vbGVhbiA9IHRydWUpOiBQcm9taXNlPEltcG9ydFJlbW92YWxSZXN1bHQ+IHtcbiAgICBsb2cuaW5mbygn8J+UjSBTdGFydGluZyBTYWZlIFVudXNlZCBJbXBvcnQgQW5hbHlzaXMuLi5cXG4nKTtcblxuICAgIGNvbnN0IHJlc3VsdDogSW1wb3J0UmVtb3ZhbFJlc3VsdCA9IHtcbiAgICAgIHRvdGFsQW5hbHl6ZWQ6IDAsXG4gICAgICBzYWZlVG9SZW1vdmU6IDAsXG4gICAgICByZXF1aXJlc1JldmlldzogMCxcbiAgICAgIHByZXNlcnZlZDogMCxcbiAgICAgIGFjdHVhbGx5UmVtb3ZlZDogMCxcbiAgICAgIGVycm9yczogW10sXG4gICAgICB3YXJuaW5nczogW10sXG4gICAgICBidWlsZFZhbGlkOiBmYWxzZSxcbiAgICB9O1xuXG4gICAgdHJ5IHtcbiAgICAgIC8vIFN0ZXAgMTogQW5hbHl6ZSB1bnVzZWQgaW1wb3J0c1xuICAgICAgY29uc3QgdW51c2VkSW1wb3J0cyA9IGF3YWl0IHRoaXMuYW5hbHl6ZVVudXNlZEltcG9ydHMoKTtcbiAgICAgIHJlc3VsdC50b3RhbEFuYWx5emVkID0gdW51c2VkSW1wb3J0cy5sZW5ndGg7XG5cbiAgICAgIGlmICh1bnVzZWRJbXBvcnRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICBsb2cuaW5mbygn4pyFIE5vIHVudXNlZCBpbXBvcnRzIGZvdW5kIScpO1xuICAgICAgICByZXN1bHQuYnVpbGRWYWxpZCA9IHRydWU7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICB9XG5cbiAgICAgIC8vIFN0ZXAgMjogQ2F0ZWdvcml6ZSBpbXBvcnRzXG4gICAgICBjb25zdCBjYXRlZ29yaXplZCA9IHRoaXMuY2F0ZWdvcml6ZUltcG9ydHModW51c2VkSW1wb3J0cyk7XG4gICAgICByZXN1bHQuc2FmZVRvUmVtb3ZlID0gY2F0ZWdvcml6ZWQuc2FmZS5sZW5ndGg7XG4gICAgICByZXN1bHQucmVxdWlyZXNSZXZpZXcgPSBjYXRlZ29yaXplZC5yZXZpZXcubGVuZ3RoO1xuICAgICAgcmVzdWx0LnByZXNlcnZlZCA9IGNhdGVnb3JpemVkLnByZXNlcnZlLmxlbmd0aDtcblxuICAgICAgLy8gU3RlcCAzOiBEaXNwbGF5IGFuYWx5c2lzIHJlc3VsdHNcbiAgICAgIHRoaXMuZGlzcGxheUFuYWx5c2lzUmVzdWx0cyhjYXRlZ29yaXplZCk7XG5cbiAgICAgIGlmIChkcnlSdW4pIHtcbiAgICAgICAgbG9nLmluZm8oJ1xcbvCflI0gRFJZIFJVTiBNT0RFIC0gTm8gY2hhbmdlcyB3aWxsIGJlIG1hZGUnKTtcbiAgICAgICAgbG9nLmluZm8oJ1VzZSBwcm9jZXNzVW51c2VkSW1wb3J0cyhmYWxzZSkgdG8gZXhlY3V0ZSByZW1vdmFsJyk7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICB9XG5cbiAgICAgIC8vIFN0ZXAgNDogUmVtb3ZlIHNhZmUgaW1wb3J0c1xuICAgICAgaWYgKGNhdGVnb3JpemVkLnNhZmUubGVuZ3RoID4gMCkge1xuICAgICAgICBjb25zdCByZW1vdmFsU3VjY2VzcyA9IGF3YWl0IHRoaXMucmVtb3ZlU2FmZUltcG9ydHMoY2F0ZWdvcml6ZWQuc2FmZSk7XG4gICAgICAgIHJlc3VsdC5hY3R1YWxseVJlbW92ZWQgPSByZW1vdmFsU3VjY2VzcyA/IGNhdGVnb3JpemVkLnNhZmUubGVuZ3RoIDogMDtcbiAgICAgIH1cblxuICAgICAgLy8gU3RlcCA1OiBWYWxpZGF0ZSBjaGFuZ2VzXG4gICAgICByZXN1bHQuYnVpbGRWYWxpZCA9IGF3YWl0IHRoaXMudmFsaWRhdGVDaGFuZ2VzKCk7XG5cbiAgICAgIGlmIChyZXN1bHQuYnVpbGRWYWxpZCkge1xuICAgICAgICBsb2cuaW5mbygnXFxu8J+OiSBTYWZlIHVudXNlZCBpbXBvcnQgcmVtb3ZhbCBjb21wbGV0ZWQgc3VjY2Vzc2Z1bGx5IScpO1xuICAgICAgICBsb2cuaW5mbyhg4pyFIFJlbW92ZWQgJHtyZXN1bHQuYWN0dWFsbHlSZW1vdmVkfSB1bnVzZWQgaW1wb3J0c2ApO1xuICAgICAgICBsb2cuaW5mbyhg8J+boe+4jyAgUHJlc2VydmVkICR7cmVzdWx0LnByZXNlcnZlZH0gY3JpdGljYWwgaW1wb3J0c2ApO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmVzdWx0LmVycm9ycy5wdXNoKCdCdWlsZCB2YWxpZGF0aW9uIGZhaWxlZCBhZnRlciBpbXBvcnQgcmVtb3ZhbCcpO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICByZXN1bHQuZXJyb3JzLnB1c2goYEltcG9ydCByZW1vdmFsIGZhaWxlZDogJHtlcnJvcn1gKTtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBJbXBvcnQgcmVtb3ZhbCBmYWlsZWQ6JywgZXJyb3IpO1xuICAgIH1cblxuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICAvKipcbiAgICogQW5hbHl6ZSB1bnVzZWQgaW1wb3J0cyBmcm9tIEVTTGludCBvdXRwdXRcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgYW5hbHl6ZVVudXNlZEltcG9ydHMoKTogUHJvbWlzZTxVbnVzZWRJbXBvcnRbXT4ge1xuICAgIGxvZy5pbmZvKCfwn5SNIEFuYWx5emluZyB1bnVzZWQgaW1wb3J0cyBmcm9tIEVTTGludC4uLicpO1xuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGxpbnRPdXRwdXQgPSBleGVjU3luYygneWFybiBsaW50IC0tZm9ybWF0PWNvbXBhY3QgMj4mMScsIHtcbiAgICAgICAgZW5jb2Rpbmc6ICd1dGY4JyxcbiAgICAgICAgbWF4QnVmZmVyOiAyMCAqIDEwMjQgKiAxMDI0LFxuICAgICAgfSk7XG5cbiAgICAgIGNvbnN0IHVudXNlZEltcG9ydHM6IFVudXNlZEltcG9ydFtdID0gW107XG4gICAgICBjb25zdCBsaW5lcyA9IGxpbnRPdXRwdXQuc3BsaXQoJ1xcbicpO1xuXG4gICAgICBmb3IgKGNvbnN0IGxpbmUgb2YgbGluZXMpIHtcbiAgICAgICAgaWYgKFxuICAgICAgICAgIGxpbmUuaW5jbHVkZXMoJ0B0eXBlc2NyaXB0LWVzbGludC9uby11bnVzZWQtdmFycycpICYmXG4gICAgICAgICAgKGxpbmUuaW5jbHVkZXMoJ2lzIGRlZmluZWQgYnV0IG5ldmVyIHVzZWQnKSB8fFxuICAgICAgICAgICAgbGluZS5pbmNsdWRlcygnaXMgaW1wb3J0ZWQgYnV0IG5ldmVyIHVzZWQnKSlcbiAgICAgICAgKSB7XG4gICAgICAgICAgY29uc3QgbWF0Y2ggPSBsaW5lLm1hdGNoKFxuICAgICAgICAgICAgL14oLispOihcXGQrKTooXFxkKyk6XFxzKyh3YXJuaW5nfGVycm9yKVxccysoLis/KVxccytAdHlwZXNjcmlwdC1lc2xpbnRcXC9uby11bnVzZWQtdmFycy8sXG4gICAgICAgICAgKTtcbiAgICAgICAgICBpZiAobWF0Y2gpIHtcbiAgICAgICAgICAgIGNvbnN0IFssIGZpbGVQYXRoLCBsaW5lTnVtLCBjb2xOdW0sIHNldmVyaXR5LCBtZXNzYWdlXSA9IG1hdGNoO1xuXG4gICAgICAgICAgICBjb25zdCBpbXBvcnROYW1lTWF0Y2ggPSBtZXNzYWdlLm1hdGNoKC8nKFteJ10rKScvKTtcbiAgICAgICAgICAgIGNvbnN0IGltcG9ydE5hbWUgPSBpbXBvcnROYW1lTWF0Y2ggPyBpbXBvcnROYW1lTWF0Y2hbMV0gOiAnJztcblxuICAgICAgICAgICAgdW51c2VkSW1wb3J0cy5wdXNoKHtcbiAgICAgICAgICAgICAgZmlsZTogZmlsZVBhdGgsXG4gICAgICAgICAgICAgIGxpbmU6IHBhcnNlSW50KGxpbmVOdW0pLFxuICAgICAgICAgICAgICBjb2x1bW46IHBhcnNlSW50KGNvbE51bSksXG4gICAgICAgICAgICAgIGltcG9ydE5hbWUsXG4gICAgICAgICAgICAgIG1lc3NhZ2UsXG4gICAgICAgICAgICAgIGlzVHlwZUltcG9ydDogbWVzc2FnZS5pbmNsdWRlcygndHlwZScpLFxuICAgICAgICAgICAgICBpc0RlZmF1bHRJbXBvcnQ6ICFtZXNzYWdlLmluY2x1ZGVzKCd7JyksXG4gICAgICAgICAgICAgIGlzTmFtZXNwYWNlSW1wb3J0OiBtZXNzYWdlLmluY2x1ZGVzKCcqIGFzJyksXG4gICAgICAgICAgICAgIHNldmVyaXR5OiAncmV2aWV3JyxcbiAgICAgICAgICAgICAgcmVhc29uOiAnJyxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBsb2cuaW5mbyhg8J+TiiBGb3VuZCAke3VudXNlZEltcG9ydHMubGVuZ3RofSB1bnVzZWQgaW1wb3J0c2ApO1xuICAgICAgcmV0dXJuIHVudXNlZEltcG9ydHM7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBGYWlsZWQgdG8gYW5hbHl6ZSB1bnVzZWQgaW1wb3J0czonLCBlcnJvcik7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENhdGVnb3JpemUgaW1wb3J0cyBieSBzYWZldHkgbGV2ZWxcbiAgICovXG4gIHByaXZhdGUgY2F0ZWdvcml6ZUltcG9ydHModW51c2VkSW1wb3J0czogVW51c2VkSW1wb3J0W10pOiB7XG4gICAgc2FmZTogVW51c2VkSW1wb3J0W107XG4gICAgcmV2aWV3OiBVbnVzZWRJbXBvcnRbXTtcbiAgICBwcmVzZXJ2ZTogVW51c2VkSW1wb3J0W107XG4gIH0ge1xuICAgIGxvZy5pbmZvKCfwn5OLIENhdGVnb3JpemluZyBpbXBvcnRzIGJ5IHNhZmV0eSBsZXZlbC4uLicpO1xuXG4gICAgY29uc3QgY2F0ZWdvcml6ZWQgPSB7XG4gICAgICBzYWZlOiBbXSBhcyBVbnVzZWRJbXBvcnRbXSxcbiAgICAgIHJldmlldzogW10gYXMgVW51c2VkSW1wb3J0W10sXG4gICAgICBwcmVzZXJ2ZTogW10gYXMgVW51c2VkSW1wb3J0W10sXG4gICAgfTtcblxuICAgIGZvciAoY29uc3QgdW51c2VkSW1wb3J0IG9mIHVudXNlZEltcG9ydHMpIHtcbiAgICAgIGNvbnN0IGNhdGVnb3J5ID0gdGhpcy5kZXRlcm1pbmVJbXBvcnRTYWZldHkodW51c2VkSW1wb3J0KTtcbiAgICAgIHVudXNlZEltcG9ydC5zZXZlcml0eSA9IGNhdGVnb3J5LnNldmVyaXR5O1xuICAgICAgdW51c2VkSW1wb3J0LnJlYXNvbiA9IGNhdGVnb3J5LnJlYXNvbjtcblxuICAgICAgc3dpdGNoIChjYXRlZ29yeS5zZXZlcml0eSkge1xuICAgICAgICBjYXNlICdzYWZlJzpcbiAgICAgICAgICBjYXRlZ29yaXplZC5zYWZlLnB1c2godW51c2VkSW1wb3J0KTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAncmV2aWV3JzpcbiAgICAgICAgICBjYXRlZ29yaXplZC5yZXZpZXcucHVzaCh1bnVzZWRJbXBvcnQpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdwcmVzZXJ2ZSc6XG4gICAgICAgICAgY2F0ZWdvcml6ZWQucHJlc2VydmUucHVzaCh1bnVzZWRJbXBvcnQpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBjYXRlZ29yaXplZDtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZXRlcm1pbmUgdGhlIHNhZmV0eSBsZXZlbCBvZiByZW1vdmluZyBhbiBpbXBvcnRcbiAgICovXG4gIHByaXZhdGUgZGV0ZXJtaW5lSW1wb3J0U2FmZXR5KHVudXNlZEltcG9ydDogVW51c2VkSW1wb3J0KToge1xuICAgIHNldmVyaXR5OiAnc2FmZScgfCAncmV2aWV3JyB8ICdwcmVzZXJ2ZSc7XG4gICAgcmVhc29uOiBzdHJpbmc7XG4gIH0ge1xuICAgIGNvbnN0IHsgZmlsZSwgaW1wb3J0TmFtZSwgbWVzc2FnZSwgaXNUeXBlSW1wb3J0IH0gPSB1bnVzZWRJbXBvcnQ7XG5cbiAgICAvLyBBbHdheXMgcHJlc2VydmUgaW1wb3J0cyBpbiBjcml0aWNhbCBhc3Ryb2xvZ2ljYWwgZmlsZXNcbiAgICBpZiAodGhpcy5hc3Ryb2xvZ2ljYWxQYXR0ZXJucy5zb21lKHBhdHRlcm4gPT4gZmlsZS5pbmNsdWRlcyhwYXR0ZXJuKSkpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHNldmVyaXR5OiAncHJlc2VydmUnLFxuICAgICAgICByZWFzb246ICdDcml0aWNhbCBhc3Ryb2xvZ2ljYWwgY2FsY3VsYXRpb24gZmlsZScsXG4gICAgICB9O1xuICAgIH1cblxuICAgIC8vIEFsd2F5cyBwcmVzZXJ2ZSBpbXBvcnRzIGluIGNhbXBhaWduIHN5c3RlbSBmaWxlc1xuICAgIGlmICh0aGlzLmNhbXBhaWduU3lzdGVtUGF0dGVybnMuc29tZShwYXR0ZXJuID0+IGZpbGUuaW5jbHVkZXMocGF0dGVybikpKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzZXZlcml0eTogJ3ByZXNlcnZlJyxcbiAgICAgICAgcmVhc29uOiAnQ2FtcGFpZ24gc3lzdGVtIGludGVsbGlnZW5jZSBmaWxlJyxcbiAgICAgIH07XG4gICAgfVxuXG4gICAgLy8gUHJlc2VydmUgUmVhY3QgY29tcG9uZW50IGltcG9ydHMgaW4gVFNYIGZpbGVzXG4gICAgaWYgKGltcG9ydE5hbWUubWF0Y2goL15bQS1aXS8pICYmIGZpbGUuZW5kc1dpdGgoJy50c3gnKSkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc2V2ZXJpdHk6ICdwcmVzZXJ2ZScsXG4gICAgICAgIHJlYXNvbjogJ1JlYWN0IGNvbXBvbmVudCBpbXBvcnQgaW4gVFNYIGZpbGUnLFxuICAgICAgfTtcbiAgICB9XG5cbiAgICAvLyBQcmVzZXJ2ZSB0eXBlIGltcG9ydHMgKG1pZ2h0IGJlIHVzZWQgaW4gdHlwZSBhbm5vdGF0aW9ucylcbiAgICBpZiAoaXNUeXBlSW1wb3J0KSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzZXZlcml0eTogJ3ByZXNlcnZlJyxcbiAgICAgICAgcmVhc29uOiAnVHlwZSBpbXBvcnQgbWF5IGJlIHVzZWQgaW4gYW5ub3RhdGlvbnMnLFxuICAgICAgfTtcbiAgICB9XG5cbiAgICAvLyBTYWZlIHRvIHJlbW92ZTogc2ltcGxlIHV0aWxpdHkgaW1wb3J0cyB0aGF0IGFyZSBjbGVhcmx5IHVudXNlZFxuICAgIGNvbnN0IHNhZmVQYXR0ZXJucyA9IFtcbiAgICAgIC9eW2Etel1bYS16QS1aXSokLywgLy8gY2FtZWxDYXNlIGZ1bmN0aW9uIG5hbWVzXG4gICAgICAvXltBLVpfXSskLywgLy8gQ09OU1RBTlQgbmFtZXNcbiAgICAgIC9VdGlscz8kLywgLy8gVXRpbGl0eSBmdW5jdGlvbnNcbiAgICAgIC9IZWxwZXIkLywgLy8gSGVscGVyIGZ1bmN0aW9uc1xuICAgICAgL0NvbmZpZyQvLCAvLyBDb25maWd1cmF0aW9uIG9iamVjdHNcbiAgICAgIC9Db25zdGFudHM/JC8sIC8vIENvbnN0YW50c1xuICAgIF07XG5cbiAgICBpZiAoXG4gICAgICBzYWZlUGF0dGVybnMuc29tZShwYXR0ZXJuID0+IHBhdHRlcm4udGVzdChpbXBvcnROYW1lKSkgJiZcbiAgICAgIG1lc3NhZ2UuaW5jbHVkZXMoJ2lzIGRlZmluZWQgYnV0IG5ldmVyIHVzZWQnKSAmJlxuICAgICAgIWZpbGUuaW5jbHVkZXMoJy5kLnRzJylcbiAgICApIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHNldmVyaXR5OiAnc2FmZScsXG4gICAgICAgIHJlYXNvbjogJ1NpbXBsZSB1dGlsaXR5IGltcG9ydCB0aGF0IGlzIGNsZWFybHkgdW51c2VkJyxcbiAgICAgIH07XG4gICAgfVxuXG4gICAgLy8gRGVmYXVsdCB0byByZXF1aXJpbmcgbWFudWFsIHJldmlld1xuICAgIHJldHVybiB7XG4gICAgICBzZXZlcml0eTogJ3JldmlldycsXG4gICAgICByZWFzb246ICdSZXF1aXJlcyBtYW51YWwgcmV2aWV3IGZvciBzYWZldHknLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogRGlzcGxheSBhbmFseXNpcyByZXN1bHRzXG4gICAqL1xuICBwcml2YXRlIGRpc3BsYXlBbmFseXNpc1Jlc3VsdHMoY2F0ZWdvcml6ZWQ6IHtcbiAgICBzYWZlOiBVbnVzZWRJbXBvcnRbXTtcbiAgICByZXZpZXc6IFVudXNlZEltcG9ydFtdO1xuICAgIHByZXNlcnZlOiBVbnVzZWRJbXBvcnRbXTtcbiAgfSk6IHZvaWQge1xuICAgIGxvZy5pbmZvKCdcXG7wn5OKIEltcG9ydCBBbmFseXNpcyBSZXN1bHRzOicpO1xuICAgIGxvZy5pbmZvKGDinIUgU2FmZSB0byByZW1vdmU6ICR7Y2F0ZWdvcml6ZWQuc2FmZS5sZW5ndGh9YCk7XG4gICAgbG9nLmluZm8oYOKaoO+4jyAgUmVxdWlyZXMgcmV2aWV3OiAke2NhdGVnb3JpemVkLnJldmlldy5sZW5ndGh9YCk7XG4gICAgbG9nLmluZm8oYPCfm6HvuI8gIFByZXNlcnZlZCAoY3JpdGljYWwpOiAke2NhdGVnb3JpemVkLnByZXNlcnZlLmxlbmd0aH1cXG5gKTtcblxuICAgIGlmIChjYXRlZ29yaXplZC5zYWZlLmxlbmd0aCA+IDApIHtcbiAgICAgIGxvZy5pbmZvKCfinIUgU2FmZSB0byBSZW1vdmU6Jyk7XG4gICAgICB0aGlzLmRpc3BsYXlJbXBvcnRzQnlGaWxlKGNhdGVnb3JpemVkLnNhZmUpO1xuICAgIH1cblxuICAgIGlmIChjYXRlZ29yaXplZC5wcmVzZXJ2ZS5sZW5ndGggPiAwKSB7XG4gICAgICBsb2cuaW5mbygnXFxu8J+boe+4jyAgUHJlc2VydmVkIChDcml0aWNhbCk6Jyk7XG4gICAgICB0aGlzLmRpc3BsYXlJbXBvcnRzQnlGaWxlKGNhdGVnb3JpemVkLnByZXNlcnZlLnNsaWNlKDAsIDEwKSk7IC8vIFNob3cgZmlyc3QgMTBcbiAgICAgIGlmIChjYXRlZ29yaXplZC5wcmVzZXJ2ZS5sZW5ndGggPiAxMCkge1xuICAgICAgICBsb2cuaW5mbyhgICAgLi4uIGFuZCAke2NhdGVnb3JpemVkLnByZXNlcnZlLmxlbmd0aCAtIDEwfSBtb3JlYCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKGNhdGVnb3JpemVkLnJldmlldy5sZW5ndGggPiAwKSB7XG4gICAgICBsb2cuaW5mbygnXFxu4pqg77iPICBSZXF1aXJlcyBNYW51YWwgUmV2aWV3OicpO1xuICAgICAgdGhpcy5kaXNwbGF5SW1wb3J0c0J5RmlsZShjYXRlZ29yaXplZC5yZXZpZXcuc2xpY2UoMCwgNSkpOyAvLyBTaG93IGZpcnN0IDVcbiAgICAgIGlmIChjYXRlZ29yaXplZC5yZXZpZXcubGVuZ3RoID4gNSkge1xuICAgICAgICBsb2cuaW5mbyhgICAgLi4uIGFuZCAke2NhdGVnb3JpemVkLnJldmlldy5sZW5ndGggLSA1fSBtb3JlYCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIERpc3BsYXkgaW1wb3J0cyBncm91cGVkIGJ5IGZpbGVcbiAgICovXG4gIHByaXZhdGUgZGlzcGxheUltcG9ydHNCeUZpbGUoaW1wb3J0czogVW51c2VkSW1wb3J0W10pOiB2b2lkIHtcbiAgICBjb25zdCBncm91cGVkQnlGaWxlID0gaW1wb3J0cy5yZWR1Y2UoXG4gICAgICAoYWNjLCBpbXApID0+IHtcbiAgICAgICAgY29uc3QgcmVsYXRpdmVQYXRoID0gcGF0aC5yZWxhdGl2ZShwcm9jZXNzLmN3ZCgpLCBpbXAuZmlsZSk7XG4gICAgICAgIGlmICghYWNjW3JlbGF0aXZlUGF0aF0pIGFjY1tyZWxhdGl2ZVBhdGhdID0gW107XG4gICAgICAgIGFjY1tyZWxhdGl2ZVBhdGhdLnB1c2goaW1wKTtcbiAgICAgICAgcmV0dXJuIGFjYztcbiAgICAgIH0sXG4gICAgICB7fSBhcyBSZWNvcmQ8c3RyaW5nLCBVbnVzZWRJbXBvcnRbXT4sXG4gICAgKTtcblxuICAgIE9iamVjdC5lbnRyaWVzKGdyb3VwZWRCeUZpbGUpLmZvckVhY2goKFtmaWxlLCBmaWxlSW1wb3J0c10pID0+IHtcbiAgICAgIGxvZy5pbmZvKGAgICDwn5OEICR7ZmlsZX06YCk7XG4gICAgICBmaWxlSW1wb3J0cy5mb3JFYWNoKGltcCA9PiB7XG4gICAgICAgIGxvZy5pbmZvKGAgICAgICAtIExpbmUgJHtpbXAubGluZX06ICcke2ltcC5pbXBvcnROYW1lfScgKCR7aW1wLnJlYXNvbn0pYCk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZW1vdmUgc2FmZSBpbXBvcnRzIHVzaW5nIEVTTGludCBhdXRvLWZpeFxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyByZW1vdmVTYWZlSW1wb3J0cyhzYWZlSW1wb3J0czogVW51c2VkSW1wb3J0W10pOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICBsb2cuaW5mbyhgXFxu8J+Xke+4jyAgUmVtb3ZpbmcgJHtzYWZlSW1wb3J0cy5sZW5ndGh9IHNhZmUgdW51c2VkIGltcG9ydHMuLi5gKTtcblxuICAgIHRyeSB7XG4gICAgICAvLyBSdW4gRVNMaW50IGF1dG8tZml4IHdpdGggZm9jdXNlZCB1bnVzZWQgdmFyaWFibGUgcmVtb3ZhbFxuICAgICAgZXhlY1N5bmMoJ3lhcm4gbGludCAtLWZpeCAtLXJ1bGUgXCJAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdW51c2VkLXZhcnM6IGVycm9yXCInLCB7XG4gICAgICAgIHN0ZGlvOiAncGlwZScsXG4gICAgICAgIGVuY29kaW5nOiAndXRmOCcsXG4gICAgICB9KTtcblxuICAgICAgbG9nLmluZm8oJ+KchSBTYWZlIGltcG9ydCByZW1vdmFsIGNvbXBsZXRlZCcpO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBjYXRjaCAoZXJyb3I6IGFueSkge1xuICAgICAgLy8gRVNMaW50IHJldHVybnMgbm9uLXplcm8gZXhpdCBjb2RlIGV2ZW4gZm9yIHN1Y2Nlc3NmdWwgZml4ZXNcbiAgICAgIGlmIChlcnJvci5zdGRvdXQgJiYgIWVycm9yLnN0ZG91dC5pbmNsdWRlcygnZXJyb3InKSkge1xuICAgICAgICBsb2cuaW5mbygn4pyFIFNhZmUgaW1wb3J0IHJlbW92YWwgY29tcGxldGVkJyk7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5lcnJvcign4p2MIFNhZmUgaW1wb3J0IHJlbW92YWwgZmFpbGVkOicsIGVycm9yLm1lc3NhZ2UpO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFZhbGlkYXRlIGNoYW5nZXMgYnkgcnVubmluZyBUeXBlU2NyaXB0IGNoZWNrIGFuZCBidWlsZFxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyB2YWxpZGF0ZUNoYW5nZXMoKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgbG9nLmluZm8oJ1xcbvCflI0gVmFsaWRhdGluZyBjaGFuZ2VzLi4uJyk7XG5cbiAgICB0cnkge1xuICAgICAgLy8gQ2hlY2sgVHlwZVNjcmlwdCBjb21waWxhdGlvblxuICAgICAgZXhlY1N5bmMoJ3lhcm4gdHNjIC0tbm9FbWl0IC0tc2tpcExpYkNoZWNrJywge1xuICAgICAgICBzdGRpbzogJ3BpcGUnLFxuICAgICAgICBlbmNvZGluZzogJ3V0ZjgnLFxuICAgICAgfSk7XG4gICAgICBsb2cuaW5mbygn4pyFIFR5cGVTY3JpcHQgdmFsaWRhdGlvbiBwYXNzZWQnKTtcblxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBWYWxpZGF0aW9uIGZhaWxlZCcpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgY3VycmVudCBpbXBvcnQgc3RhdGlzdGljc1xuICAgKi9cbiAgcHVibGljIGdldEltcG9ydFN0YXRzKCk6IHtcbiAgICB0b3RhbEZpbGVzOiBudW1iZXI7XG4gICAgdW51c2VkSW1wb3J0czogbnVtYmVyO1xuICAgIHR5cGVTY3JpcHRGaWxlczogbnVtYmVyO1xuICB9IHtcbiAgICB0cnkge1xuICAgICAgLy8gQ291bnQgVHlwZVNjcmlwdC9KYXZhU2NyaXB0IGZpbGVzXG4gICAgICBjb25zdCB0b3RhbEZpbGVzT3V0cHV0ID0gZXhlY1N5bmMoXG4gICAgICAgICdmaW5kIHNyYyAtbmFtZSBcIioudHNcIiAtbyAtbmFtZSBcIioudHN4XCIgLW8gLW5hbWUgXCIqLmpzXCIgLW8gLW5hbWUgXCIqLmpzeFwiIHwgd2MgLWwnLFxuICAgICAgICB7XG4gICAgICAgICAgZW5jb2Rpbmc6ICd1dGY4JyxcbiAgICAgICAgfSxcbiAgICAgICk7XG4gICAgICBjb25zdCB0b3RhbEZpbGVzID0gcGFyc2VJbnQodG90YWxGaWxlc091dHB1dC50cmltKCkpIHx8IDA7XG5cbiAgICAgIC8vIENvdW50IFR5cGVTY3JpcHQgZmlsZXMgc3BlY2lmaWNhbGx5XG4gICAgICBjb25zdCB0c0ZpbGVzT3V0cHV0ID0gZXhlY1N5bmMoJ2ZpbmQgc3JjIC1uYW1lIFwiKi50c1wiIC1vIC1uYW1lIFwiKi50c3hcIiB8IHdjIC1sJywge1xuICAgICAgICBlbmNvZGluZzogJ3V0ZjgnLFxuICAgICAgfSk7XG4gICAgICBjb25zdCB0eXBlU2NyaXB0RmlsZXMgPSBwYXJzZUludCh0c0ZpbGVzT3V0cHV0LnRyaW0oKSkgfHwgMDtcblxuICAgICAgLy8gQ291bnQgdW51c2VkIGltcG9ydCB3YXJuaW5ncyAoYXBwcm94aW1hdGUpXG4gICAgICBjb25zdCB1bnVzZWRJbXBvcnRzT3V0cHV0ID0gZXhlY1N5bmMoXG4gICAgICAgICd5YXJuIGxpbnQgLS1mb3JtYXQ9Y29tcGFjdCAyPiYxIHwgZ3JlcCAtRSBcIkB0eXBlc2NyaXB0LWVzbGludC9uby11bnVzZWQtdmFycy4qaXMgZGVmaW5lZCBidXQgbmV2ZXIgdXNlZFwiIHwgd2MgLWwnLFxuICAgICAgICB7XG4gICAgICAgICAgZW5jb2Rpbmc6ICd1dGY4JyxcbiAgICAgICAgfSxcbiAgICAgICk7XG4gICAgICBjb25zdCB1bnVzZWRJbXBvcnRzID0gcGFyc2VJbnQodW51c2VkSW1wb3J0c091dHB1dC50cmltKCkpIHx8IDA7XG5cbiAgICAgIHJldHVybiB7IHRvdGFsRmlsZXMsIHVudXNlZEltcG9ydHMsIHR5cGVTY3JpcHRGaWxlcyB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICByZXR1cm4geyB0b3RhbEZpbGVzOiAwLCB1bnVzZWRJbXBvcnRzOiAwLCB0eXBlU2NyaXB0RmlsZXM6IDAgfTtcbiAgICB9XG4gIH1cbn1cbiJdLCJ2ZXJzaW9uIjozfQ==