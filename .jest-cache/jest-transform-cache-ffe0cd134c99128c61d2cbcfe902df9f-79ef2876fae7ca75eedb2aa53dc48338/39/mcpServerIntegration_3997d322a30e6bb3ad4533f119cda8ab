3971cf42963b5cecf317ed1f27788e32
"use strict";
/**
 * MCP Server Integration for Reliable External APIs
 *
 * This module implements Model Context Protocol (MCP) server integration for:
 * - Astrological API connections with NASA JPL Horizons fallback
 * - Nutritional database access with USDA API integration
 * - Recipe API connections with rate limiting and caching
 * - Multi-tier fallback strategy for API reliability
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.useMCPServerIntegration = exports.getMCPServerIntegration = exports.MCPServerIntegration = void 0;
const logger_1 = require("@/utils/logger");
// Default MCP server configurations based on steering file examples
const DEFAULT_MCP_SERVERS = {
    'nasa-horizons': {
        name: 'nasa-horizons',
        command: 'uvx',
        args: ['nasa-horizons-mcp-server@latest'],
        env: {
            FASTMCP_LOG_LEVEL: 'ERROR',
            NASA_API_KEY: process.env.NASA_API_KEY || ''
        },
        disabled: false,
        autoApprove: ['get_planetary_positions', 'get_ephemeris_data'],
        timeout: 10000,
        retryAttempts: 3,
        fallbackEnabled: true
    },
    'usda-nutrition': {
        name: 'usda-nutrition',
        command: 'uvx',
        args: ['usda-nutrition-mcp-server@latest'],
        env: {
            FASTMCP_LOG_LEVEL: 'ERROR',
            USDA_API_KEY: process.env.USDA_API_KEY || ''
        },
        disabled: false,
        autoApprove: ['get_nutrition_data', 'search_ingredients'],
        timeout: 8000,
        retryAttempts: 2,
        fallbackEnabled: true
    },
    'spoonacular-recipes': {
        name: 'spoonacular-recipes',
        command: 'uvx',
        args: ['spoonacular-mcp-server@latest'],
        env: {
            FASTMCP_LOG_LEVEL: 'ERROR',
            SPOONACULAR_API_KEY: process.env.SPOONACULAR_API_KEY || ''
        },
        disabled: false,
        autoApprove: ['search_recipes', 'get_recipe_details'],
        timeout: 6000,
        retryAttempts: 2,
        fallbackEnabled: true
    }
};
// Rate limiting configurations
const RATE_LIMITS = {
    'nasa-horizons': {
        requestsPerMinute: 60,
        requestsPerHour: 1000,
        requestsPerDay: 10000,
        burstLimit: 10
    },
    'usda-nutrition': {
        requestsPerMinute: 30,
        requestsPerHour: 500,
        requestsPerDay: 5000,
        burstLimit: 5
    },
    'spoonacular-recipes': {
        requestsPerMinute: 10,
        requestsPerHour: 150,
        requestsPerDay: 150,
        burstLimit: 3
    }
};
/**
 * MCP Server Integration Manager
 */
class MCPServerIntegration {
    constructor() {
        this.servers = new Map();
        this.cache = new Map();
        this.rateLimiters = new Map();
        this.connectionStatus = new Map();
        this.initializeServers();
        this.initializeRateLimiters();
        this.startHealthChecks();
    }
    static getInstance() {
        if (!MCPServerIntegration.instance) {
            MCPServerIntegration.instance = new MCPServerIntegration();
        }
        return MCPServerIntegration.instance;
    }
    /**
     * Astrological API connections with NASA JPL Horizons fallback
     */
    async getAstrologicalData(date = new Date()) {
        const cacheKey = `astrological_${date.toISOString().split('T')[0]}`;
        // Check cache first
        const cached = this.getFromCache(cacheKey);
        if (cached) {
            return {
                success: true,
                data: cached.data,
                source: 'cache',
                responseTime: 0,
                timestamp: Date.now()
            };
        }
        // Primary: NASA Horizons MCP server
        try {
            const result = await this.callMCPServer('nasa-horizons', 'get_planetary_positions', { date });
            if (result.success) {
                this.setCache(cacheKey, result.data, 6 * 60 * 60 * 1000); // 6 hours TTL
                return { ...result, source: 'primary' };
            }
        }
        catch (error) {
            logger_1.logger.warn('NASA Horizons MCP server failed:', error);
        }
        // Secondary: Direct NASA API call
        try {
            const result = await this.callDirectNASAAPI(date);
            if (result.success) {
                this.setCache(cacheKey, result.data, 6 * 60 * 60 * 1000);
                return { ...result, source: 'secondary' };
            }
        }
        catch (error) {
            logger_1.logger.warn('Direct NASA API failed:', error);
        }
        // Fallback: Local ephemeris data
        try {
            const fallbackData = await this.getFallbackAstrologicalData(date);
            return {
                success: true,
                data: fallbackData,
                source: 'fallback',
                responseTime: 0,
                timestamp: Date.now()
            };
        }
        catch (error) {
            logger_1.logger.error('All astrological data sources failed:', error);
            return {
                success: false,
                error: 'All astrological data sources unavailable',
                source: 'fallback',
                responseTime: 0,
                timestamp: Date.now()
            };
        }
    }
    /**
     * Nutritional database access with USDA API integration
     */
    async getNutritionalData(ingredient) {
        const cacheKey = `nutrition_${ingredient.toLowerCase().replace(/\s+/g, '_')}`;
        // Check cache first
        const cached = this.getFromCache(cacheKey);
        if (cached) {
            return {
                success: true,
                data: cached.data,
                source: 'cache',
                responseTime: 0,
                timestamp: Date.now()
            };
        }
        // Check rate limits
        if (!this.checkRateLimit('usda-nutrition')) {
            logger_1.logger.warn('USDA nutrition API rate limit exceeded');
            return this.getRateLimitedResponse();
        }
        // Primary: USDA Nutrition MCP server
        try {
            const result = await this.callMCPServer('usda-nutrition', 'get_nutrition_data', { ingredient });
            if (result.success) {
                this.setCache(cacheKey, result.data, 24 * 60 * 60 * 1000); // 24 hours TTL
                return { ...result, source: 'primary' };
            }
        }
        catch (error) {
            logger_1.logger.warn('USDA Nutrition MCP server failed:', error);
        }
        // Secondary: Direct USDA API call
        try {
            const result = await this.callDirectUSDAAPI(ingredient);
            if (result.success) {
                this.setCache(cacheKey, result.data, 24 * 60 * 60 * 1000);
                return { ...result, source: 'secondary' };
            }
        }
        catch (error) {
            logger_1.logger.warn('Direct USDA API failed:', error);
        }
        // Fallback: Local nutrition database
        try {
            const fallbackData = await this.getFallbackNutritionalData(ingredient);
            return {
                success: true,
                data: fallbackData,
                source: 'fallback',
                responseTime: 0,
                timestamp: Date.now()
            };
        }
        catch (error) {
            logger_1.logger.error('All nutritional data sources failed:', error);
            return {
                success: false,
                error: 'Nutritional data unavailable',
                source: 'fallback',
                responseTime: 0,
                timestamp: Date.now()
            };
        }
    }
    /**
     * Recipe API connections with rate limiting and caching
     */
    async getRecipeData(query, options = {}) {
        const cacheKey = `recipes_${query.toLowerCase().replace(/\s+/g, '_')}_${JSON.stringify(options)}`;
        // Check cache first
        const cached = this.getFromCache(cacheKey);
        if (cached) {
            return {
                success: true,
                data: cached.data,
                source: 'cache',
                responseTime: 0,
                timestamp: Date.now()
            };
        }
        // Check rate limits (Spoonacular has strict daily limits)
        if (!this.checkRateLimit('spoonacular-recipes')) {
            logger_1.logger.warn('Spoonacular recipe API rate limit exceeded');
            return this.getRateLimitedResponse();
        }
        // Primary: Spoonacular MCP server
        try {
            const result = await this.callMCPServer('spoonacular-recipes', 'search_recipes', { query, ...options });
            if (result.success) {
                this.setCache(cacheKey, result.data, 12 * 60 * 60 * 1000); // 12 hours TTL
                return { ...result, source: 'primary' };
            }
        }
        catch (error) {
            logger_1.logger.warn('Spoonacular MCP server failed:', error);
        }
        // Secondary: Direct Spoonacular API call
        try {
            const result = await this.callDirectSpoonacularAPI(query, options);
            if (result.success) {
                this.setCache(cacheKey, result.data, 12 * 60 * 60 * 1000);
                return { ...result, source: 'secondary' };
            }
        }
        catch (error) {
            logger_1.logger.warn('Direct Spoonacular API failed:', error);
        }
        // Fallback: Local recipe database
        try {
            const fallbackData = await this.getFallbackRecipeData(query, options);
            return {
                success: true,
                data: fallbackData,
                source: 'fallback',
                responseTime: 0,
                timestamp: Date.now()
            };
        }
        catch (error) {
            logger_1.logger.error('All recipe data sources failed:', error);
            return {
                success: false,
                error: 'Recipe data unavailable',
                source: 'fallback',
                responseTime: 0,
                timestamp: Date.now()
            };
        }
    }
    /**
     * Test multi-tier fallback strategy
     */
    async testFallbackStrategy() {
        logger_1.logger.info('Testing MCP server fallback strategy...');
        const results = await Promise.allSettled([
            this.getAstrologicalData(),
            this.getNutritionalData('apple'),
            this.getRecipeData('pasta')
        ]);
        const astrological = results[0].status === 'fulfilled' ? results[0].value : this.createErrorResponse('Astrological test failed');
        const nutritional = results[1].status === 'fulfilled' ? results[1].value : this.createErrorResponse('Nutritional test failed');
        const recipes = results[2].status === 'fulfilled' ? results[2].value : this.createErrorResponse('Recipe test failed');
        const successCount = [astrological, nutritional, recipes].filter(r => r.success).length;
        const overallReliability = successCount / 3;
        logger_1.logger.info('Fallback strategy test completed', {
            astrological: astrological.success ? astrological.source : 'failed',
            nutritional: nutritional.success ? nutritional.source : 'failed',
            recipes: recipes.success ? recipes.source : 'failed',
            overallReliability
        });
        return { astrological, nutritional, recipes, overallReliability };
    }
    /**
     * Get server connection status
     */
    getServerStatus() {
        const status = {};
        for (const [name, config] of this.servers) {
            status[name] = {
                connected: this.connectionStatus.get(name) || false,
                lastCheck: Date.now(),
                responseTime: 0,
                errorCount: 0 // Would be tracked in real implementation
            };
        }
        return status;
    }
    // Private helper methods
    initializeServers() {
        Object.values(DEFAULT_MCP_SERVERS).forEach(config => {
            if (!config.disabled) {
                this.servers.set(config.name, config);
                this.connectionStatus.set(config.name, false);
            }
        });
        logger_1.logger.info('MCP servers initialized:', Array.from(this.servers.keys()));
    }
    initializeRateLimiters() {
        Object.entries(RATE_LIMITS).forEach(([serverName, config]) => {
            this.rateLimiters.set(serverName, new RateLimiter(config));
        });
        logger_1.logger.info('Rate limiters initialized for MCP servers');
    }
    startHealthChecks() {
        // Check server health every 5 minutes
        setInterval(async () => {
            for (const [name, config] of this.servers) {
                try {
                    const isHealthy = await this.checkServerHealth(name);
                    this.connectionStatus.set(name, isHealthy);
                }
                catch (error) {
                    logger_1.logger.warn(`Health check failed for MCP server ${name}:`, error);
                    this.connectionStatus.set(name, false);
                }
            }
        }, 5 * 60 * 1000);
    }
    async callMCPServer(serverName, method, params) {
        const config = this.servers.get(serverName);
        if (!config) {
            throw new Error(`MCP server ${serverName} not configured`);
        }
        const startTime = performance.now();
        try {
            // In a real implementation, this would use the actual MCP protocol
            // For now, we simulate the MCP server call
            const result = await this.simulateMCPCall(serverName, method, params);
            const responseTime = performance.now() - startTime;
            return {
                success: true,
                data: result,
                source: 'primary',
                responseTime,
                timestamp: Date.now()
            };
        }
        catch (error) {
            const responseTime = performance.now() - startTime;
            logger_1.logger.error(`MCP server ${serverName} call failed:`, error);
            return {
                success: false,
                error: error instanceof Error ? error.message : 'Unknown error',
                source: 'primary',
                responseTime,
                timestamp: Date.now()
            };
        }
    }
    async simulateMCPCall(serverName, method, params) {
        // Simulate MCP server calls for demonstration
        await new Promise(resolve => setTimeout(resolve, Math.random() * 1000 + 500)); // 500-1500ms delay
        switch (serverName) {
            case 'nasa-horizons':
                if (method === 'get_planetary_positions') {
                    return this.generateMockPlanetaryData(params.date);
                }
                break;
            case 'usda-nutrition':
                if (method === 'get_nutrition_data') {
                    return this.generateMockNutritionalData(params.ingredient);
                }
                break;
            case 'spoonacular-recipes':
                if (method === 'search_recipes') {
                    return this.generateMockRecipeData(params.query, params);
                }
                break;
        }
        throw new Error(`Unknown method ${method} for server ${serverName}`);
    }
    async checkServerHealth(serverName) {
        try {
            // In a real implementation, this would ping the MCP server
            // For now, simulate health check
            await new Promise(resolve => setTimeout(resolve, 100));
            return Math.random() > 0.1; // 90% uptime simulation
        }
        catch (error) {
            return false;
        }
    }
    checkRateLimit(serverName) {
        const rateLimiter = this.rateLimiters.get(serverName);
        return rateLimiter ? rateLimiter.checkLimit() : true;
    }
    getFromCache(key) {
        const entry = this.cache.get(key);
        if (!entry)
            return null;
        if (Date.now() - entry.timestamp > entry.ttl) {
            this.cache.delete(key);
            return null;
        }
        return entry;
    }
    setCache(key, data, ttl) {
        this.cache.set(key, {
            data,
            timestamp: Date.now(),
            ttl,
            source: 'cache'
        });
    }
    getRateLimitedResponse() {
        return {
            success: false,
            error: 'Rate limit exceeded',
            source: 'primary',
            responseTime: 0,
            timestamp: Date.now()
        };
    }
    createErrorResponse(error) {
        return {
            success: false,
            error,
            source: 'fallback',
            responseTime: 0,
            timestamp: Date.now()
        };
    }
    // Direct API call methods (fallback implementations)
    async callDirectNASAAPI(date) {
        // Simulate direct NASA API call
        await new Promise(resolve => setTimeout(resolve, 2000));
        return {
            success: true,
            data: this.generateMockPlanetaryData(date),
            source: 'secondary',
            responseTime: 2000,
            timestamp: Date.now()
        };
    }
    async callDirectUSDAAPI(ingredient) {
        // Simulate direct USDA API call
        await new Promise(resolve => setTimeout(resolve, 1500));
        return {
            success: true,
            data: this.generateMockNutritionalData(ingredient),
            source: 'secondary',
            responseTime: 1500,
            timestamp: Date.now()
        };
    }
    async callDirectSpoonacularAPI(query, options) {
        // Simulate direct Spoonacular API call
        await new Promise(resolve => setTimeout(resolve, 1000));
        return {
            success: true,
            data: this.generateMockRecipeData(query, options),
            source: 'secondary',
            responseTime: 1000,
            timestamp: Date.now()
        };
    }
    // Fallback data methods
    async getFallbackAstrologicalData(date) {
        // Return hardcoded reliable positions from March 2025
        return {
            sun: { sign: 'aries', degree: 8.5, exactLongitude: 8.5, isRetrograde: false },
            moon: { sign: 'aries', degree: 1.57, exactLongitude: 1.57, isRetrograde: false },
            mercury: { sign: 'aries', degree: 0.85, exactLongitude: 0.85, isRetrograde: true },
            venus: { sign: 'pisces', degree: 29.08, exactLongitude: 359.08, isRetrograde: true },
            mars: { sign: 'cancer', degree: 22.63, exactLongitude: 112.63, isRetrograde: false },
            jupiter: { sign: 'gemini', degree: 15.52, exactLongitude: 75.52, isRetrograde: false },
            saturn: { sign: 'pisces', degree: 24.12, exactLongitude: 354.12, isRetrograde: false }
        };
    }
    async getFallbackNutritionalData(ingredient) {
        // Return basic nutritional data from local database
        return {
            name: ingredient,
            calories: 50,
            protein: 1,
            carbs: 12,
            fat: 0.2,
            fiber: 2,
            vitamins: ['C', 'K'],
            minerals: ['potassium', 'folate']
        };
    }
    async getFallbackRecipeData(query, options) {
        // Return basic recipe suggestions from local database
        return {
            recipes: [
                {
                    id: 1,
                    title: `Simple ${query}`,
                    readyInMinutes: 30,
                    servings: 4,
                    image: 'placeholder.jpg',
                    summary: `A simple and delicious ${query} recipe.`
                }
            ],
            totalResults: 1
        };
    }
    // Mock data generators for simulation
    generateMockPlanetaryData(date) {
        return {
            date: date.toISOString(),
            planets: {
                sun: { sign: 'aries', degree: 8.5 + Math.random() * 2 },
                moon: { sign: 'aries', degree: 1.57 + Math.random() * 5 },
                mercury: { sign: 'aries', degree: 0.85 + Math.random() * 3 }
            }
        };
    }
    generateMockNutritionalData(ingredient) {
        return {
            name: ingredient,
            fdcId: Math.floor(Math.random() * 100000),
            calories: Math.floor(Math.random() * 200) + 20,
            nutrients: {
                protein: Math.floor(Math.random() * 20) + 1,
                carbs: Math.floor(Math.random() * 50) + 5,
                fat: Math.floor(Math.random() * 15) + 0.1
            }
        };
    }
    generateMockRecipeData(query, options) {
        return {
            results: Array.from({ length: options.maxResults || 5 }, (_, i) => ({
                id: i + 1,
                title: `${query} Recipe ${i + 1}`,
                readyInMinutes: Math.floor(Math.random() * 60) + 15,
                servings: Math.floor(Math.random() * 6) + 2,
                cuisine: options.cuisine || 'international'
            })),
            totalResults: options.maxResults || 5
        };
    }
}
exports.MCPServerIntegration = MCPServerIntegration;
/**
 * Simple rate limiter implementation
 */
class RateLimiter {
    constructor(config) {
        this.requests = [];
        this.config = config;
    }
    checkLimit() {
        const now = Date.now();
        // Clean old requests
        this.requests = this.requests.filter(time => now - time < 60000); // Keep last minute
        // Check minute limit
        if (this.requests.length >= this.config.requestsPerMinute) {
            return false;
        }
        // Add current request
        this.requests.push(now);
        return true;
    }
}
/**
 * Convenience function to get MCP server integration instance
 */
function getMCPServerIntegration() {
    return MCPServerIntegration.getInstance();
}
exports.getMCPServerIntegration = getMCPServerIntegration;
/**
 * Hook for components to use MCP server integration
 */
function useMCPServerIntegration() {
    const mcp = getMCPServerIntegration();
    return {
        getAstrologicalData: (date) => mcp.getAstrologicalData(date),
        getNutritionalData: (ingredient) => mcp.getNutritionalData(ingredient),
        getRecipeData: (query, options) => mcp.getRecipeData(query, options),
        testFallbackStrategy: () => mcp.testFallbackStrategy(),
        getServerStatus: () => mcp.getServerStatus()
    };
}
exports.useMCPServerIntegration = useMCPServerIntegration;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy91dGlscy9tY3BTZXJ2ZXJJbnRlZ3JhdGlvbi50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7Ozs7O0dBUUc7OztBQUVILDJDQUF3QztBQXNDeEMsb0VBQW9FO0FBQ3BFLE1BQU0sbUJBQW1CLEdBQW9DO0lBQzNELGVBQWUsRUFBRTtRQUNmLElBQUksRUFBRSxlQUFlO1FBQ3JCLE9BQU8sRUFBRSxLQUFLO1FBQ2QsSUFBSSxFQUFFLENBQUMsaUNBQWlDLENBQUM7UUFDekMsR0FBRyxFQUFFO1lBQ0gsaUJBQWlCLEVBQUUsT0FBTztZQUMxQixZQUFZLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxZQUFZLElBQUksRUFBRTtTQUM3QztRQUNELFFBQVEsRUFBRSxLQUFLO1FBQ2YsV0FBVyxFQUFFLENBQUMseUJBQXlCLEVBQUUsb0JBQW9CLENBQUM7UUFDOUQsT0FBTyxFQUFFLEtBQUs7UUFDZCxhQUFhLEVBQUUsQ0FBQztRQUNoQixlQUFlLEVBQUUsSUFBSTtLQUN0QjtJQUNELGdCQUFnQixFQUFFO1FBQ2hCLElBQUksRUFBRSxnQkFBZ0I7UUFDdEIsT0FBTyxFQUFFLEtBQUs7UUFDZCxJQUFJLEVBQUUsQ0FBQyxrQ0FBa0MsQ0FBQztRQUMxQyxHQUFHLEVBQUU7WUFDSCxpQkFBaUIsRUFBRSxPQUFPO1lBQzFCLFlBQVksRUFBRSxPQUFPLENBQUMsR0FBRyxDQUFDLFlBQVksSUFBSSxFQUFFO1NBQzdDO1FBQ0QsUUFBUSxFQUFFLEtBQUs7UUFDZixXQUFXLEVBQUUsQ0FBQyxvQkFBb0IsRUFBRSxvQkFBb0IsQ0FBQztRQUN6RCxPQUFPLEVBQUUsSUFBSTtRQUNiLGFBQWEsRUFBRSxDQUFDO1FBQ2hCLGVBQWUsRUFBRSxJQUFJO0tBQ3RCO0lBQ0QscUJBQXFCLEVBQUU7UUFDckIsSUFBSSxFQUFFLHFCQUFxQjtRQUMzQixPQUFPLEVBQUUsS0FBSztRQUNkLElBQUksRUFBRSxDQUFDLCtCQUErQixDQUFDO1FBQ3ZD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UUFBUSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUN4QixPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7Q0FDRjtBQUVEOztHQUVHO0FBQ0gsU0FBZ0IsdUJBQXVCO0lBQ3JDLE9BQU8sb0JBQW9CLENBQUMsV0FBVyxFQUFFLENBQUM7QUFDNUMsQ0FBQztBQUZELDBEQUVDO0FBRUQ7O0dBRUc7QUFDSCxTQUFnQix1QkFBdUI7SUFDckMsTUFBTSxHQUFHLEdBQUcsdUJBQXVCLEVBQUUsQ0FBQztJQUV0QyxPQUFPO1FBQ0wsbUJBQW1CLEVBQUUsQ0FBQyxJQUFXLEVBQUUsRUFBRSxDQUFDLEdBQUcsQ0FBQyxtQkFBbUIsQ0FBQyxJQUFJLENBQUM7UUFDbkUsa0JBQWtCLEVBQUUsQ0FBQyxVQUFrQixFQUFFLEVBQUUsQ0FBQyxHQUFHLENBQUMsa0JBQWtCLENBQUMsVUFBVSxDQUFDO1FBQzlFLGFBQWEsRUFBRSxDQUFDLEtBQWEsRUFBRSxPQUFhLEVBQUUsRUFBRSxDQUFDLEdBQUcsQ0FBQyxhQUFhLENBQUMsS0FBSyxFQUFFLE9BQU8sQ0FBQztRQUNsRixvQkFBb0IsRUFBRSxHQUFHLEVBQUUsQ0FBQyxHQUFHLENBQUMsb0JBQW9CLEVBQUU7UUFDdEQsZUFBZSxFQUFFLEdBQUcsRUFBRSxDQUFDLEdBQUcsQ0FBQyxlQUFlLEVBQUU7S0FDN0MsQ0FBQztBQUNKLENBQUM7QUFWRCwwREFVQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvR3JlZ0Nhc3Ryby9EZXNrdG9wL1doYXRUb0VhdE5leHQvc3JjL3V0aWxzL21jcFNlcnZlckludGVncmF0aW9uLnRzIl0sInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogTUNQIFNlcnZlciBJbnRlZ3JhdGlvbiBmb3IgUmVsaWFibGUgRXh0ZXJuYWwgQVBJc1xuICogXG4gKiBUaGlzIG1vZHVsZSBpbXBsZW1lbnRzIE1vZGVsIENvbnRleHQgUHJvdG9jb2wgKE1DUCkgc2VydmVyIGludGVncmF0aW9uIGZvcjpcbiAqIC0gQXN0cm9sb2dpY2FsIEFQSSBjb25uZWN0aW9ucyB3aXRoIE5BU0EgSlBMIEhvcml6b25zIGZhbGxiYWNrXG4gKiAtIE51dHJpdGlvbmFsIGRhdGFiYXNlIGFjY2VzcyB3aXRoIFVTREEgQVBJIGludGVncmF0aW9uXG4gKiAtIFJlY2lwZSBBUEkgY29ubmVjdGlvbnMgd2l0aCByYXRlIGxpbWl0aW5nIGFuZCBjYWNoaW5nXG4gKiAtIE11bHRpLXRpZXIgZmFsbGJhY2sgc3RyYXRlZ3kgZm9yIEFQSSByZWxpYWJpbGl0eVxuICovXG5cbmltcG9ydCB7IGxvZ2dlciB9IGZyb20gJ0AvdXRpbHMvbG9nZ2VyJztcblxuLy8gTUNQIFNlcnZlciBDb25maWd1cmF0aW9uIGZyb20gc3RlZXJpbmcgZmlsZXNcbmV4cG9ydCBpbnRlcmZhY2UgTUNQU2VydmVyQ29uZmlnIHtcbiAgbmFtZTogc3RyaW5nO1xuICBjb21tYW5kOiBzdHJpbmc7XG4gIGFyZ3M6IHN0cmluZ1tdO1xuICBlbnY/OiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+O1xuICBkaXNhYmxlZDogYm9vbGVhbjtcbiAgYXV0b0FwcHJvdmU6IHN0cmluZ1tdO1xuICB0aW1lb3V0OiBudW1iZXI7XG4gIHJldHJ5QXR0ZW1wdHM6IG51bWJlcjtcbiAgZmFsbGJhY2tFbmFibGVkOiBib29sZWFuO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIE1DUEFwaVJlc3BvbnNlPFQgPSBhbnk+IHtcbiAgc3VjY2VzczogYm9vbGVhbjtcbiAgZGF0YT86IFQ7XG4gIGVycm9yPzogc3RyaW5nO1xuICBzb3VyY2U6ICdwcmltYXJ5JyB8ICdzZWNvbmRhcnknIHwgJ2ZhbGxiYWNrJyB8ICdjYWNoZSc7XG4gIHJlc3BvbnNlVGltZTogbnVtYmVyO1xuICB0aW1lc3RhbXA6IG51bWJlcjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBNQ1BDYWNoZUVudHJ5PFQgPSBhbnk+IHtcbiAgZGF0YTogVDtcbiAgdGltZXN0YW1wOiBudW1iZXI7XG4gIHR0bDogbnVtYmVyO1xuICBzb3VyY2U6IHN0cmluZztcbn1cblxuZXhwb3J0IGludGVyZmFjZSBNQ1BSYXRlTGltaXRDb25maWcge1xuICByZXF1ZXN0c1Blck1pbnV0ZTogbnVtYmVyO1xuICByZXF1ZXN0c1BlckhvdXI6IG51bWJlcjtcbiAgcmVxdWVzdHNQZXJEYXk6IG51bWJlcjtcbiAgYnVyc3RMaW1pdDogbnVtYmVyO1xufVxuXG4vLyBEZWZhdWx0IE1DUCBzZXJ2ZXIgY29uZmlndXJhdGlvbnMgYmFzZWQgb24gc3RlZXJpbmcgZmlsZSBleGFtcGxlc1xuY29uc3QgREVGQVVMVF9NQ1BfU0VSVkVSUzogUmVjb3JkPHN0cmluZywgTUNQU2VydmVyQ29uZmlnPiA9IHtcbiAgJ25hc2EtaG9yaXpvbnMnOiB7XG4gICAgbmFtZTogJ25hc2EtaG9yaXpvbnMnLFxuICAgIGNvbW1hbmQ6ICd1dngnLFxuICAgIGFyZ3M6IFsnbmFzYS1ob3Jpem9ucy1tY3Atc2VydmVyQGxhdGVzdCddLFxuICAgIGVudjoge1xuICAgICAgRkFTVE1DUF9MT0dfTEVWRUw6ICdFUlJPUicsXG4gICAgICBOQVNBX0FQSV9LRVk6IHByb2Nlc3MuZW52Lk5BU0FfQVBJX0tFWSB8fCAnJ1xuICAgIH0sXG4gICAgZGlzYWJsZWQ6IGZhbHNlLFxuICAgIGF1dG9BcHByb3ZlOiBbJ2dldF9wbGFuZXRhcnlfcG9zaXRpb25zJywgJ2dldF9lcGhlbWVyaXNfZGF0YSddLFxuICAgIHRpbWVvdXQ6IDEwMDAwLFxuICAgIHJldHJ5QXR0ZW1wdHM6IDMsXG4gICAgZmFsbGJhY2tFbmFibGVkOiB0cnVlXG4gIH0sXG4gICd1c2RhLW51dHJpdGlvbic6IHtcbiAgICBuYW1lOiAndXNkYS1udXRyaXRpb24nLFxuICAgIGNvbW1hbmQ6ICd1dngnLFxuICAgIGFyZ3M6IFsndXNkYS1udXRyaXRpb24tbWNwLXNlcnZlckBsYXRlc3QnXSxcbiAgICBlbnY6IHtcbiAgICAgIEZBU1RNQ1BfTE9HX0xFVkVMOiAnRVJST1InLFxuICAgICAgVVNEQV9BUElfS0VZOiBwcm9jZXNzLmVudi5VU0RBX0FQSV9LRVkgfHwgJydcbiAgICB9LFxuICAgIGRpc2FibGVkOiBmYWxzZSxcbiAgICBhdXRvQXBwcm92ZTogWydnZXRfbnV0cml0aW9uX2RhdGEnLCAnc2VhcmNoX2luZ3JlZGllbnRzJ10sXG4gICAgdGltZW91dDogODAwMCxcbiAgICByZXRyeUF0dGVtcHRzOiAyLFxuICAgIGZhbGxiYWNrRW5hYmxlZDogdHJ1ZVxuICB9LFxuICAnc3Bvb25hY3VsYXItcmVjaXBlcyc6IHtcbiAgICBuYW1lOiAnc3Bvb25hY3VsYXItcmVjaXBlcycsXG4gICAgY29tbWFuZDogJ3V2eCcsXG4gICAgYXJnczogWydzcG9vbmFjdWxhci1tY3Atc2VydmVyQGxhdGVzdCddLFxuICAgIGVudjoge1xuICAgICAgRkFTVE1DUF9MT0dfTEVWRUw6ICdFUlJPUicsXG4gICAgICBTUE9PTkFDVUxBUl9BUElfS0VZOiBwcm9jZXNzLmVudi5TUE9PTkFDVUxBUl9BUElfS0VZIHx8ICcnXG4gICAgfSxcbiAgICBkaXNhYmxlZDogZmFsc2UsXG4gICAgYXV0b0FwcHJvdmU6IFsnc2VhcmNoX3JlY2lwZXMnLCAnZ2V0X3JlY2lwZV9kZXRhaWxzJ10sXG4gICAgdGltZW91dDogNjAwMCxcbiAgICByZXRyeUF0dGVtcHRzOiAyLFxuICAgIGZhbGxiYWNrRW5hYmxlZDogdHJ1ZVxuICB9XG59O1xuXG4vLyBSYXRlIGxpbWl0aW5nIGNvbmZpZ3VyYXRpb25zXG5jb25zdCBSQVRFX0xJTUlUUzogUmVjb3JkPHN0cmluZywgTUNQUmF0ZUxpbWl0Q29uZmlnPiA9IHtcbiAgJ25hc2EtaG9yaXpvbnMnOiB7XG4gICAgcmVxdWVzdHNQZXJNaW51dGU6IDYwLFxuICAgIHJlcXVlc3RzUGVySG91cjogMTAwMCxcbiAgICByZXF1ZXN0c1BlckRheTogMTAwMDAsXG4gICAgYnVyc3RMaW1pdDogMTBcbiAgfSxcbiAgJ3VzZGEtbnV0cml0aW9uJzoge1xuICAgIHJlcXVlc3RzUGVyTWludXRlOiAzMCxcbiAgICByZXF1ZXN0c1BlckhvdXI6IDUwMCxcbiAgICByZXF1ZXN0c1BlckRheTogNTAwMCxcbiAgICBidXJzdExpbWl0OiA1XG4gIH0sXG4gICdzcG9vbmFjdWxhci1yZWNpcGVzJzoge1xuICAgIHJlcXVlc3RzUGVyTWludXRlOiAxMCxcbiAgICByZXF1ZXN0c1BlckhvdXI6IDE1MCxcbiAgICByZXF1ZXN0c1BlckRheTogMTUwLCAvLyBEYWlseSBxdW90YSBsaW1pdFxuICAgIGJ1cnN0TGltaXQ6IDNcbiAgfVxufTtcblxuLyoqXG4gKiBNQ1AgU2VydmVyIEludGVncmF0aW9uIE1hbmFnZXJcbiAqL1xuZXhwb3J0IGNsYXNzIE1DUFNlcnZlckludGVncmF0aW9uIHtcbiAgcHJpdmF0ZSBzdGF0aWMgaW5zdGFuY2U6IE1DUFNlcnZlckludGVncmF0aW9uO1xuICBwcml2YXRlIHNlcnZlcnM6IE1hcDxzdHJpbmcsIE1DUFNlcnZlckNvbmZpZz4gPSBuZXcgTWFwKCk7XG4gIHByaXZhdGUgY2FjaGU6IE1hcDxzdHJpbmcsIE1DUENhY2hlRW50cnk+ID0gbmV3IE1hcCgpO1xuICBwcml2YXRlIHJhdGVMaW1pdGVyczogTWFwPHN0cmluZywgUmF0ZUxpbWl0ZXI+ID0gbmV3IE1hcCgpO1xuICBwcml2YXRlIGNvbm5lY3Rpb25TdGF0dXM6IE1hcDxzdHJpbmcsIGJvb2xlYW4+ID0gbmV3IE1hcCgpO1xuXG4gIHByaXZhdGUgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5pbml0aWFsaXplU2VydmVycygpO1xuICAgIHRoaXMuaW5pdGlhbGl6ZVJhdGVMaW1pdGVycygpO1xuICAgIHRoaXMuc3RhcnRIZWFsdGhDaGVja3MoKTtcbiAgfVxuXG4gIHB1YmxpYyBzdGF0aWMgZ2V0SW5zdGFuY2UoKTogTUNQU2VydmVySW50ZWdyYXRpb24ge1xuICAgIGlmICghTUNQU2VydmVySW50ZWdyYXRpb24uaW5zdGFuY2UpIHtcbiAgICAgIE1DUFNlcnZlckludGVncmF0aW9uLmluc3RhbmNlID0gbmV3IE1DUFNlcnZlckludGVncmF0aW9uKCk7XG4gICAgfVxuICAgIHJldHVybiBNQ1BTZXJ2ZXJJbnRlZ3JhdGlvbi5pbnN0YW5jZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBBc3Ryb2xvZ2ljYWwgQVBJIGNvbm5lY3Rpb25zIHdpdGggTkFTQSBKUEwgSG9yaXpvbnMgZmFsbGJhY2tcbiAgICovXG4gIHB1YmxpYyBhc3luYyBnZXRBc3Ryb2xvZ2ljYWxEYXRhKGRhdGU6IERhdGUgPSBuZXcgRGF0ZSgpKTogUHJvbWlzZTxNQ1BBcGlSZXNwb25zZT4ge1xuICAgIGNvbnN0IGNhY2hlS2V5ID0gYGFzdHJvbG9naWNhbF8ke2RhdGUudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdfWA7XG4gICAgXG4gICAgLy8gQ2hlY2sgY2FjaGUgZmlyc3RcbiAgICBjb25zdCBjYWNoZWQgPSB0aGlzLmdldEZyb21DYWNoZShjYWNoZUtleSk7XG4gICAgaWYgKGNhY2hlZCkge1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgZGF0YTogY2FjaGVkLmRhdGEsXG4gICAgICAgIHNvdXJjZTogJ2NhY2hlJyxcbiAgICAgICAgcmVzcG9uc2VUaW1lOiAwLFxuICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KClcbiAgICAgIH07XG4gICAgfVxuXG4gICAgLy8gUHJpbWFyeTogTkFTQSBIb3Jpem9ucyBNQ1Agc2VydmVyXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuY2FsbE1DUFNlcnZlcignbmFzYS1ob3Jpem9ucycsICdnZXRfcGxhbmV0YXJ5X3Bvc2l0aW9ucycsIHsgZGF0ZSB9KTtcbiAgICAgIGlmIChyZXN1bHQuc3VjY2Vzcykge1xuICAgICAgICB0aGlzLnNldENhY2hlKGNhY2hlS2V5LCByZXN1bHQuZGF0YSwgNiAqIDYwICogNjAgKiAxMDAwKTsgLy8gNiBob3VycyBUVExcbiAgICAgICAgcmV0dXJuIHsgLi4ucmVzdWx0LCBzb3VyY2U6ICdwcmltYXJ5JyB9O1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIud2FybignTkFTQSBIb3Jpem9ucyBNQ1Agc2VydmVyIGZhaWxlZDonLCBlcnJvcik7XG4gICAgfVxuXG4gICAgLy8gU2Vjb25kYXJ5OiBEaXJlY3QgTkFTQSBBUEkgY2FsbFxuICAgIHRyeSB7XG4gICAgICBjb25zdCByZXN1bHQgPSBhd2FpdCB0aGlzLmNhbGxEaXJlY3ROQVNBQVBJKGRhdGUpO1xuICAgICAgaWYgKHJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICAgIHRoaXMuc2V0Q2FjaGUoY2FjaGVLZXksIHJlc3VsdC5kYXRhLCA2ICogNjAgKiA2MCAqIDEwMDApO1xuICAgICAgICByZXR1cm4geyAuLi5yZXN1bHQsIHNvdXJjZTogJ3NlY29uZGFyeScgfTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLndhcm4oJ0RpcmVjdCBOQVNBIEFQSSBmYWlsZWQ6JywgZXJyb3IpO1xuICAgIH1cblxuICAgIC8vIEZhbGxiYWNrOiBMb2NhbCBlcGhlbWVyaXMgZGF0YVxuICAgIHRyeSB7XG4gICAgICBjb25zdCBmYWxsYmFja0RhdGEgPSBhd2FpdCB0aGlzLmdldEZhbGxiYWNrQXN0cm9sb2dpY2FsRGF0YShkYXRlKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGRhdGE6IGZhbGxiYWNrRGF0YSxcbiAgICAgICAgc291cmNlOiAnZmFsbGJhY2snLFxuICAgICAgICByZXNwb25zZVRpbWU6IDAsXG4gICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKVxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdBbGwgYXN0cm9sb2dpY2FsIGRhdGEgc291cmNlcyBmYWlsZWQ6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIHtcbiAgICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICAgIGVycm9yOiAnQWxsIGFzdHJvbG9naWNhbCBkYXRhIHNvdXJjZXMgdW5hdmFpbGFibGUnLFxuICAgICAgICBzb3VyY2U6ICdmYWxsYmFjaycsXG4gICAgICAgIHJlc3BvbnNlVGltZTogMCxcbiAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpXG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBOdXRyaXRpb25hbCBkYXRhYmFzZSBhY2Nlc3Mgd2l0aCBVU0RBIEFQSSBpbnRlZ3JhdGlvblxuICAgKi9cbiAgcHVibGljIGFzeW5jIGdldE51dHJpdGlvbmFsRGF0YShpbmdyZWRpZW50OiBzdHJpbmcpOiBQcm9taXNlPE1DUEFwaVJlc3BvbnNlPiB7XG4gICAgY29uc3QgY2FjaGVLZXkgPSBgbnV0cml0aW9uXyR7aW5ncmVkaWVudC50b0xvd2VyQ2FzZSgpLnJlcGxhY2UoL1xccysvZywgJ18nKX1gO1xuICAgIFxuICAgIC8vIENoZWNrIGNhY2hlIGZpcnN0XG4gICAgY29uc3QgY2FjaGVkID0gdGhpcy5nZXRGcm9tQ2FjaGUoY2FjaGVLZXkpO1xuICAgIGlmIChjYWNoZWQpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGRhdGE6IGNhY2hlZC5kYXRhLFxuICAgICAgICBzb3VyY2U6ICdjYWNoZScsXG4gICAgICAgIHJlc3BvbnNlVGltZTogMCxcbiAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpXG4gICAgICB9O1xuICAgIH1cblxuICAgIC8vIENoZWNrIHJhdGUgbGltaXRzXG4gICAgaWYgKCF0aGlzLmNoZWNrUmF0ZUxpbWl0KCd1c2RhLW51dHJpdGlvbicpKSB7XG4gICAgICBsb2dnZXIud2FybignVVNEQSBudXRyaXRpb24gQVBJIHJhdGUgbGltaXQgZXhjZWVkZWQnKTtcbiAgICAgIHJldHVybiB0aGlzLmdldFJhdGVMaW1pdGVkUmVzcG9uc2UoKTtcbiAgICB9XG5cbiAgICAvLyBQcmltYXJ5OiBVU0RBIE51dHJpdGlvbiBNQ1Agc2VydmVyXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuY2FsbE1DUFNlcnZlcigndXNkYS1udXRyaXRpb24nLCAnZ2V0X251dHJpdGlvbl9kYXRhJywgeyBpbmdyZWRpZW50IH0pO1xuICAgICAgaWYgKHJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICAgIHRoaXMuc2V0Q2FjaGUoY2FjaGVLZXksIHJlc3VsdC5kYXRhLCAyNCAqIDYwICogNjAgKiAxMDAwKTsgLy8gMjQgaG91cnMgVFRMXG4gICAgICAgIHJldHVybiB7IC4uLnJlc3VsdCwgc291cmNlOiAncHJpbWFyeScgfTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLndhcm4oJ1VTREEgTnV0cml0aW9uIE1DUCBzZXJ2ZXIgZmFpbGVkOicsIGVycm9yKTtcbiAgICB9XG5cbiAgICAvLyBTZWNvbmRhcnk6IERpcmVjdCBVU0RBIEFQSSBjYWxsXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuY2FsbERpcmVjdFVTREFBUEkoaW5ncmVkaWVudCk7XG4gICAgICBpZiAocmVzdWx0LnN1Y2Nlc3MpIHtcbiAgICAgICAgdGhpcy5zZXRDYWNoZShjYWNoZUtleSwgcmVzdWx0LmRhdGEsIDI0ICogNjAgKiA2MCAqIDEwMDApO1xuICAgICAgICByZXR1cm4geyAuLi5yZXN1bHQsIHNvdXJjZTogJ3NlY29uZGFyeScgfTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLndhcm4oJ0RpcmVjdCBVU0RBIEFQSSBmYWlsZWQ6JywgZXJyb3IpO1xuICAgIH1cblxuICAgIC8vIEZhbGxiYWNrOiBMb2NhbCBudXRyaXRpb24gZGF0YWJhc2VcbiAgICB0cnkge1xuICAgICAgY29uc3QgZmFsbGJhY2tEYXRhID0gYXdhaXQgdGhpcy5nZXRGYWxsYmFja051dHJpdGlvbmFsRGF0YShpbmdyZWRpZW50KTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGRhdGE6IGZhbGxiYWNrRGF0YSxcbiAgICAgICAgc291cmNlOiAnZmFsbGJhY2snLFxuICAgICAgICByZXNwb25zZVRpbWU6IDAsXG4gICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKVxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKCdBbGwgbnV0cml0aW9uYWwgZGF0YSBzb3VyY2VzIGZhaWxlZDonLCBlcnJvcik7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgICAgZXJyb3I6ICdOdXRyaXRpb25hbCBkYXRhIHVuYXZhaWxhYmxlJyxcbiAgICAgICAgc291cmNlOiAnZmFsbGJhY2snLFxuICAgICAgICByZXNwb25zZVRpbWU6IDAsXG4gICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKVxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogUmVjaXBlIEFQSSBjb25uZWN0aW9ucyB3aXRoIHJhdGUgbGltaXRpbmcgYW5kIGNhY2hpbmdcbiAgICovXG4gIHB1YmxpYyBhc3luYyBnZXRSZWNpcGVEYXRhKHF1ZXJ5OiBzdHJpbmcsIG9wdGlvbnM6IHtcbiAgICBjdWlzaW5lPzogc3RyaW5nO1xuICAgIGRpZXQ/OiBzdHJpbmc7XG4gICAgbWF4UmVzdWx0cz86IG51bWJlcjtcbiAgfSA9IHt9KTogUHJvbWlzZTxNQ1BBcGlSZXNwb25zZT4ge1xuICAgIGNvbnN0IGNhY2hlS2V5ID0gYHJlY2lwZXNfJHtxdWVyeS50b0xvd2VyQ2FzZSgpLnJlcGxhY2UoL1xccysvZywgJ18nKX1fJHtKU09OLnN0cmluZ2lmeShvcHRpb25zKX1gO1xuICAgIFxuICAgIC8vIENoZWNrIGNhY2hlIGZpcnN0XG4gICAgY29uc3QgY2FjaGVkID0gdGhpcy5nZXRGcm9tQ2FjaGUoY2FjaGVLZXkpO1xuICAgIGlmIChjYWNoZWQpIHtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICAgIGRhdGE6IGNhY2hlZC5kYXRhLFxuICAgICAgICBzb3VyY2U6ICdjYWNoZScsXG4gICAgICAgIHJlc3BvbnNlVGltZTogMCxcbiAgICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpXG4gICAgICB9O1xuICAgIH1cblxuICAgIC8vIENoZWNrIHJhdGUgbGltaXRzIChTcG9vbmFjdWxhciBoYXMgc3RyaWN0IGRhaWx5IGxpbWl0cylcbiAgICBpZiAoIXRoaXMuY2hlY2tSYXRlTGltaXQoJ3Nwb29uYWN1bGFyLXJlY2lwZXMnKSkge1xuICAgICAgbG9nZ2VyLndhcm4oJ1Nwb29uYWN1bGFyIHJlY2lwZSBBUEkgcmF0ZSBsaW1pdCBleGNlZWRlZCcpO1xuICAgICAgcmV0dXJuIHRoaXMuZ2V0UmF0ZUxpbWl0ZWRSZXNwb25zZSgpO1xuICAgIH1cblxuICAgIC8vIFByaW1hcnk6IFNwb29uYWN1bGFyIE1DUCBzZXJ2ZXJcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5jYWxsTUNQU2VydmVyKCdzcG9vbmFjdWxhci1yZWNpcGVzJywgJ3NlYXJjaF9yZWNpcGVzJywgeyBxdWVyeSwgLi4ub3B0aW9ucyB9KTtcbiAgICAgIGlmIChyZXN1bHQuc3VjY2Vzcykge1xuICAgICAgICB0aGlzLnNldENhY2hlKGNhY2hlS2V5LCByZXN1bHQuZGF0YSwgMTIgKiA2MCAqIDYwICogMTAwMCk7IC8vIDEyIGhvdXJzIFRUTFxuICAgICAgICByZXR1cm4geyAuLi5yZXN1bHQsIHNvdXJjZTogJ3ByaW1hcnknIH07XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci53YXJuKCdTcG9vbmFjdWxhciBNQ1Agc2VydmVyIGZhaWxlZDonLCBlcnJvcik7XG4gICAgfVxuXG4gICAgLy8gU2Vjb25kYXJ5OiBEaXJlY3QgU3Bvb25hY3VsYXIgQVBJIGNhbGxcbiAgICB0cnkge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdGhpcy5jYWxsRGlyZWN0U3Bvb25hY3VsYXJBUEkocXVlcnksIG9wdGlvbnMpO1xuICAgICAgaWYgKHJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICAgIHRoaXMuc2V0Q2FjaGUoY2FjaGVLZXksIHJlc3VsdC5kYXRhLCAxMiAqIDYwICogNjAgKiAxMDAwKTtcbiAgICAgICAgcmV0dXJuIHsgLi4ucmVzdWx0LCBzb3VyY2U6ICdzZWNvbmRhcnknIH07XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci53YXJuKCdEaXJlY3QgU3Bvb25hY3VsYXIgQVBJIGZhaWxlZDonLCBlcnJvcik7XG4gICAgfVxuXG4gICAgLy8gRmFsbGJhY2s6IExvY2FsIHJlY2lwZSBkYXRhYmFzZVxuICAgIHRyeSB7XG4gICAgICBjb25zdCBmYWxsYmFja0RhdGEgPSBhd2FpdCB0aGlzLmdldEZhbGxiYWNrUmVjaXBlRGF0YShxdWVyeSwgb3B0aW9ucyk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkYXRhOiBmYWxsYmFja0RhdGEsXG4gICAgICAgIHNvdXJjZTogJ2ZhbGxiYWNrJyxcbiAgICAgICAgcmVzcG9uc2VUaW1lOiAwLFxuICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KClcbiAgICAgIH07XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcignQWxsIHJlY2lwZSBkYXRhIHNvdXJjZXMgZmFpbGVkOicsIGVycm9yKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcjogJ1JlY2lwZSBkYXRhIHVuYXZhaWxhYmxlJyxcbiAgICAgICAgc291cmNlOiAnZmFsbGJhY2snLFxuICAgICAgICByZXNwb25zZVRpbWU6IDAsXG4gICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKVxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVGVzdCBtdWx0aS10aWVyIGZhbGxiYWNrIHN0cmF0ZWd5XG4gICAqL1xuICBwdWJsaWMgYXN5bmMgdGVzdEZhbGxiYWNrU3RyYXRlZ3koKTogUHJvbWlzZTx7XG4gICAgYXN0cm9sb2dpY2FsOiBNQ1BBcGlSZXNwb25zZTtcbiAgICBudXRyaXRpb25hbDogTUNQQXBpUmVzcG9uc2U7XG4gICAgcmVjaXBlczogTUNQQXBpUmVzcG9uc2U7XG4gICAgb3ZlcmFsbFJlbGlhYmlsaXR5OiBudW1iZXI7XG4gIH0+IHtcbiAgICBsb2dnZXIuaW5mbygnVGVzdGluZyBNQ1Agc2VydmVyIGZhbGxiYWNrIHN0cmF0ZWd5Li4uJyk7XG5cbiAgICBjb25zdCByZXN1bHRzID0gYXdhaXQgUHJvbWlzZS5hbGxTZXR0bGVkKFtcbiAgICAgIHRoaXMuZ2V0QXN0cm9sb2dpY2FsRGF0YSgpLFxuICAgICAgdGhpcy5nZXROdXRyaXRpb25hbERhdGEoJ2FwcGxlJyksXG4gICAgICB0aGlzLmdldFJlY2lwZURhdGEoJ3Bhc3RhJylcbiAgICBdKTtcblxuICAgIGNvbnN0IGFzdHJvbG9naWNhbCA9IHJlc3VsdHNbMF0uc3RhdHVzID09PSAnZnVsZmlsbGVkJyA/IHJlc3VsdHNbMF0udmFsdWUgOiB0aGlzLmNyZWF0ZUVycm9yUmVzcG9uc2UoJ0FzdHJvbG9naWNhbCB0ZXN0IGZhaWxlZCcpO1xuICAgIGNvbnN0IG51dHJpdGlvbmFsID0gcmVzdWx0c1sxXS5zdGF0dXMgPT09ICdmdWxmaWxsZWQnID8gcmVzdWx0c1sxXS52YWx1ZSA6IHRoaXMuY3JlYXRlRXJyb3JSZXNwb25zZSgnTnV0cml0aW9uYWwgdGVzdCBmYWlsZWQnKTtcbiAgICBjb25zdCByZWNpcGVzID0gcmVzdWx0c1syXS5zdGF0dXMgPT09ICdmdWxmaWxsZWQnID8gcmVzdWx0c1syXS52YWx1ZSA6IHRoaXMuY3JlYXRlRXJyb3JSZXNwb25zZSgnUmVjaXBlIHRlc3QgZmFpbGVkJyk7XG5cbiAgICBjb25zdCBzdWNjZXNzQ291bnQgPSBbYXN0cm9sb2dpY2FsLCBudXRyaXRpb25hbCwgcmVjaXBlc10uZmlsdGVyKHIgPT4gci5zdWNjZXNzKS5sZW5ndGg7XG4gICAgY29uc3Qgb3ZlcmFsbFJlbGlhYmlsaXR5ID0gc3VjY2Vzc0NvdW50IC8gMztcblxuICAgIGxvZ2dlci5pbmZvKCdGYWxsYmFjayBzdHJhdGVneSB0ZXN0IGNvbXBsZXRlZCcsIHtcbiAgICAgIGFzdHJvbG9naWNhbDogYXN0cm9sb2dpY2FsLnN1Y2Nlc3MgPyBhc3Ryb2xvZ2ljYWwuc291cmNlIDogJ2ZhaWxlZCcsXG4gICAgICBudXRyaXRpb25hbDogbnV0cml0aW9uYWwuc3VjY2VzcyA/IG51dHJpdGlvbmFsLnNvdXJjZSA6ICdmYWlsZWQnLFxuICAgICAgcmVjaXBlczogcmVjaXBlcy5zdWNjZXNzID8gcmVjaXBlcy5zb3VyY2UgOiAnZmFpbGVkJyxcbiAgICAgIG92ZXJhbGxSZWxpYWJpbGl0eVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIHsgYXN0cm9sb2dpY2FsLCBudXRyaXRpb25hbCwgcmVjaXBlcywgb3ZlcmFsbFJlbGlhYmlsaXR5IH07XG4gIH1cblxuICAvKipcbiAgICogR2V0IHNlcnZlciBjb25uZWN0aW9uIHN0YXR1c1xuICAgKi9cbiAgcHVibGljIGdldFNlcnZlclN0YXR1cygpOiBSZWNvcmQ8c3RyaW5nLCB7XG4gICAgY29ubmVjdGVkOiBib29sZWFuO1xuICAgIGxhc3RDaGVjazogbnVtYmVyO1xuICAgIHJlc3BvbnNlVGltZTogbnVtYmVyO1xuICAgIGVycm9yQ291bnQ6IG51bWJlcjtcbiAgfT4ge1xuICAgIGNvbnN0IHN0YXR1czogUmVjb3JkPHN0cmluZywgYW55PiA9IHt9O1xuICAgIFxuICAgIGZvciAoY29uc3QgW25hbWUsIGNvbmZpZ10gb2YgdGhpcy5zZXJ2ZXJzKSB7XG4gICAgICBzdGF0dXNbbmFtZV0gPSB7XG4gICAgICAgIGNvbm5lY3RlZDogdGhpcy5jb25uZWN0aW9uU3RhdHVzLmdldChuYW1lKSB8fCBmYWxzZSxcbiAgICAgICAgbGFzdENoZWNrOiBEYXRlLm5vdygpLFxuICAgICAgICByZXNwb25zZVRpbWU6IDAsIC8vIFdvdWxkIGJlIHRyYWNrZWQgaW4gcmVhbCBpbXBsZW1lbnRhdGlvblxuICAgICAgICBlcnJvckNvdW50OiAwIC8vIFdvdWxkIGJlIHRyYWNrZWQgaW4gcmVhbCBpbXBsZW1lbnRhdGlvblxuICAgICAgfTtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHN0YXR1cztcbiAgfVxuXG4gIC8vIFByaXZhdGUgaGVscGVyIG1ldGhvZHNcblxuICBwcml2YXRlIGluaXRpYWxpemVTZXJ2ZXJzKCk6IHZvaWQge1xuICAgIE9iamVjdC52YWx1ZXMoREVGQVVMVF9NQ1BfU0VSVkVSUykuZm9yRWFjaChjb25maWcgPT4ge1xuICAgICAgaWYgKCFjb25maWcuZGlzYWJsZWQpIHtcbiAgICAgICAgdGhpcy5zZXJ2ZXJzLnNldChjb25maWcubmFtZSwgY29uZmlnKTtcbiAgICAgICAgdGhpcy5jb25uZWN0aW9uU3RhdHVzLnNldChjb25maWcubmFtZSwgZmFsc2UpO1xuICAgICAgfVxuICAgIH0pO1xuICAgIFxuICAgIGxvZ2dlci5pbmZvKCdNQ1Agc2VydmVycyBpbml0aWFsaXplZDonLCBBcnJheS5mcm9tKHRoaXMuc2VydmVycy5rZXlzKCkpKTtcbiAgfVxuXG4gIHByaXZhdGUgaW5pdGlhbGl6ZVJhdGVMaW1pdGVycygpOiB2b2lkIHtcbiAgICBPYmplY3QuZW50cmllcyhSQVRFX0xJTUlUUykuZm9yRWFjaCgoW3NlcnZlck5hbWUsIGNvbmZpZ10pID0+IHtcbiAgICAgIHRoaXMucmF0ZUxpbWl0ZXJzLnNldChzZXJ2ZXJOYW1lLCBuZXcgUmF0ZUxpbWl0ZXIoY29uZmlnKSk7XG4gICAgfSk7XG4gICAgXG4gICAgbG9nZ2VyLmluZm8oJ1JhdGUgbGltaXRlcnMgaW5pdGlhbGl6ZWQgZm9yIE1DUCBzZXJ2ZXJzJyk7XG4gIH1cblxuICBwcml2YXRlIHN0YXJ0SGVhbHRoQ2hlY2tzKCk6IHZvaWQge1xuICAgIC8vIENoZWNrIHNlcnZlciBoZWFsdGggZXZlcnkgNSBtaW51dGVzXG4gICAgc2V0SW50ZXJ2YWwoYXN5bmMgKCkgPT4ge1xuICAgICAgZm9yIChjb25zdCBbbmFtZSwgY29uZmlnXSBvZiB0aGlzLnNlcnZlcnMpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zdCBpc0hlYWx0aHkgPSBhd2FpdCB0aGlzLmNoZWNrU2VydmVySGVhbHRoKG5hbWUpO1xuICAgICAgICAgIHRoaXMuY29ubmVjdGlvblN0YXR1cy5zZXQobmFtZSwgaXNIZWFsdGh5KTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICBsb2dnZXIud2FybihgSGVhbHRoIGNoZWNrIGZhaWxlZCBmb3IgTUNQIHNlcnZlciAke25hbWV9OmAsIGVycm9yKTtcbiAgICAgICAgICB0aGlzLmNvbm5lY3Rpb25TdGF0dXMuc2V0KG5hbWUsIGZhbHNlKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sIDUgKiA2MCAqIDEwMDApO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBjYWxsTUNQU2VydmVyKHNlcnZlck5hbWU6IHN0cmluZywgbWV0aG9kOiBzdHJpbmcsIHBhcmFtczogYW55KTogUHJvbWlzZTxNQ1BBcGlSZXNwb25zZT4ge1xuICAgIGNvbnN0IGNvbmZpZyA9IHRoaXMuc2VydmVycy5nZXQoc2VydmVyTmFtZSk7XG4gICAgaWYgKCFjb25maWcpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgTUNQIHNlcnZlciAke3NlcnZlck5hbWV9IG5vdCBjb25maWd1cmVkYCk7XG4gICAgfVxuXG4gICAgY29uc3Qgc3RhcnRUaW1lID0gcGVyZm9ybWFuY2Uubm93KCk7XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIC8vIEluIGEgcmVhbCBpbXBsZW1lbnRhdGlvbiwgdGhpcyB3b3VsZCB1c2UgdGhlIGFjdHVhbCBNQ1AgcHJvdG9jb2xcbiAgICAgIC8vIEZvciBub3csIHdlIHNpbXVsYXRlIHRoZSBNQ1Agc2VydmVyIGNhbGxcbiAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHRoaXMuc2ltdWxhdGVNQ1BDYWxsKHNlcnZlck5hbWUsIG1ldGhvZCwgcGFyYW1zKTtcbiAgICAgIGNvbnN0IHJlc3BvbnNlVGltZSA9IHBlcmZvcm1hbmNlLm5vdygpIC0gc3RhcnRUaW1lO1xuICAgICAgXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgICBkYXRhOiByZXN1bHQsXG4gICAgICAgIHNvdXJjZTogJ3ByaW1hcnknLFxuICAgICAgICByZXNwb25zZVRpbWUsXG4gICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKVxuICAgICAgfTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc3QgcmVzcG9uc2VUaW1lID0gcGVyZm9ybWFuY2Uubm93KCkgLSBzdGFydFRpbWU7XG4gICAgICBsb2dnZXIuZXJyb3IoYE1DUCBzZXJ2ZXIgJHtzZXJ2ZXJOYW1lfSBjYWxsIGZhaWxlZDpgLCBlcnJvcik7XG4gICAgICBcbiAgICAgIHJldHVybiB7XG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicsXG4gICAgICAgIHNvdXJjZTogJ3ByaW1hcnknLFxuICAgICAgICByZXNwb25zZVRpbWUsXG4gICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKVxuICAgICAgfTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHNpbXVsYXRlTUNQQ2FsbChzZXJ2ZXJOYW1lOiBzdHJpbmcsIG1ldGhvZDogc3RyaW5nLCBwYXJhbXM6IGFueSk6IFByb21pc2U8YW55PiB7XG4gICAgLy8gU2ltdWxhdGUgTUNQIHNlcnZlciBjYWxscyBmb3IgZGVtb25zdHJhdGlvblxuICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCBNYXRoLnJhbmRvbSgpICogMTAwMCArIDUwMCkpOyAvLyA1MDAtMTUwMG1zIGRlbGF5XG4gICAgXG4gICAgc3dpdGNoIChzZXJ2ZXJOYW1lKSB7XG4gICAgICBjYXNlICduYXNhLWhvcml6b25zJzpcbiAgICAgICAgaWYgKG1ldGhvZCA9PT0gJ2dldF9wbGFuZXRhcnlfcG9zaXRpb25zJykge1xuICAgICAgICAgIHJldHVybiB0aGlzLmdlbmVyYXRlTW9ja1BsYW5ldGFyeURhdGEocGFyYW1zLmRhdGUpO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAndXNkYS1udXRyaXRpb24nOlxuICAgICAgICBpZiAobWV0aG9kID09PSAnZ2V0X251dHJpdGlvbl9kYXRhJykge1xuICAgICAgICAgIHJldHVybiB0aGlzLmdlbmVyYXRlTW9ja051dHJpdGlvbmFsRGF0YShwYXJhbXMuaW5ncmVkaWVudCk7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdzcG9vbmFjdWxhci1yZWNpcGVzJzpcbiAgICAgICAgaWYgKG1ldGhvZCA9PT0gJ3NlYXJjaF9yZWNpcGVzJykge1xuICAgICAgICAgIHJldHVybiB0aGlzLmdlbmVyYXRlTW9ja1JlY2lwZURhdGEocGFyYW1zLnF1ZXJ5LCBwYXJhbXMpO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgICBcbiAgICB0aHJvdyBuZXcgRXJyb3IoYFVua25vd24gbWV0aG9kICR7bWV0aG9kfSBmb3Igc2VydmVyICR7c2VydmVyTmFtZX1gKTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgY2hlY2tTZXJ2ZXJIZWFsdGgoc2VydmVyTmFtZTogc3RyaW5nKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIEluIGEgcmVhbCBpbXBsZW1lbnRhdGlvbiwgdGhpcyB3b3VsZCBwaW5nIHRoZSBNQ1Agc2VydmVyXG4gICAgICAvLyBGb3Igbm93LCBzaW11bGF0ZSBoZWFsdGggY2hlY2tcbiAgICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCAxMDApKTtcbiAgICAgIHJldHVybiBNYXRoLnJhbmRvbSgpID4gMC4xOyAvLyA5MCUgdXB0aW1lIHNpbXVsYXRpb25cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgY2hlY2tSYXRlTGltaXQoc2VydmVyTmFtZTogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgY29uc3QgcmF0ZUxpbWl0ZXIgPSB0aGlzLnJhdGVMaW1pdGVycy5nZXQoc2VydmVyTmFtZSk7XG4gICAgcmV0dXJuIHJhdGVMaW1pdGVyID8gcmF0ZUxpbWl0ZXIuY2hlY2tMaW1pdCgpIDogdHJ1ZTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0RnJvbUNhY2hlPFQ+KGtleTogc3RyaW5nKTogTUNQQ2FjaGVFbnRyeTxUPiB8IG51bGwge1xuICAgIGNvbnN0IGVudHJ5ID0gdGhpcy5jYWNoZS5nZXQoa2V5KTtcbiAgICBpZiAoIWVudHJ5KSByZXR1cm4gbnVsbDtcbiAgICBcbiAgICBpZiAoRGF0ZS5ub3coKSAtIGVudHJ5LnRpbWVzdGFtcCA+IGVudHJ5LnR0bCkge1xuICAgICAgdGhpcy5jYWNoZS5kZWxldGUoa2V5KTtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBcbiAgICByZXR1cm4gZW50cnkgYXMgTUNQQ2FjaGVFbnRyeTxUPjtcbiAgfVxuXG4gIHByaXZhdGUgc2V0Q2FjaGU8VD4oa2V5OiBzdHJpbmcsIGRhdGE6IFQsIHR0bDogbnVtYmVyKTogdm9pZCB7XG4gICAgdGhpcy5jYWNoZS5zZXQoa2V5LCB7XG4gICAgICBkYXRhLFxuICAgICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLFxuICAgICAgdHRsLFxuICAgICAgc291cmNlOiAnY2FjaGUnXG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGdldFJhdGVMaW1pdGVkUmVzcG9uc2UoKTogTUNQQXBpUmVzcG9uc2Uge1xuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiBmYWxzZSxcbiAgICAgIGVycm9yOiAnUmF0ZSBsaW1pdCBleGNlZWRlZCcsXG4gICAgICBzb3VyY2U6ICdwcmltYXJ5JyxcbiAgICAgIHJlc3BvbnNlVGltZTogMCxcbiAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKVxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZUVycm9yUmVzcG9uc2UoZXJyb3I6IHN0cmluZyk6IE1DUEFwaVJlc3BvbnNlIHtcbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogZmFsc2UsXG4gICAgICBlcnJvcixcbiAgICAgIHNvdXJjZTogJ2ZhbGxiYWNrJyxcbiAgICAgIHJlc3BvbnNlVGltZTogMCxcbiAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKVxuICAgIH07XG4gIH1cblxuICAvLyBEaXJlY3QgQVBJIGNhbGwgbWV0aG9kcyAoZmFsbGJhY2sgaW1wbGVtZW50YXRpb25zKVxuICBwcml2YXRlIGFzeW5jIGNhbGxEaXJlY3ROQVNBQVBJKGRhdGU6IERhdGUpOiBQcm9taXNlPE1DUEFwaVJlc3BvbnNlPiB7XG4gICAgLy8gU2ltdWxhdGUgZGlyZWN0IE5BU0EgQVBJIGNhbGxcbiAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgMjAwMCkpO1xuICAgIHJldHVybiB7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgZGF0YTogdGhpcy5nZW5lcmF0ZU1vY2tQbGFuZXRhcnlEYXRhKGRhdGUpLFxuICAgICAgc291cmNlOiAnc2Vjb25kYXJ5JyxcbiAgICAgIHJlc3BvbnNlVGltZTogMjAwMCxcbiAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKVxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGNhbGxEaXJlY3RVU0RBQVBJKGluZ3JlZGllbnQ6IHN0cmluZyk6IFByb21pc2U8TUNQQXBpUmVzcG9uc2U+IHtcbiAgICAvLyBTaW11bGF0ZSBkaXJlY3QgVVNEQSBBUEkgY2FsbFxuICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCAxNTAwKSk7XG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBkYXRhOiB0aGlzLmdlbmVyYXRlTW9ja051dHJpdGlvbmFsRGF0YShpbmdyZWRpZW50KSxcbiAgICAgIHNvdXJjZTogJ3NlY29uZGFyeScsXG4gICAgICByZXNwb25zZVRpbWU6IDE1MDAsXG4gICAgICB0aW1lc3RhbXA6IERhdGUubm93KClcbiAgICB9O1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBjYWxsRGlyZWN0U3Bvb25hY3VsYXJBUEkocXVlcnk6IHN0cmluZywgb3B0aW9uczogYW55KTogUHJvbWlzZTxNQ1BBcGlSZXNwb25zZT4ge1xuICAgIC8vIFNpbXVsYXRlIGRpcmVjdCBTcG9vbmFjdWxhciBBUEkgY2FsbFxuICAgIGF3YWl0IG5ldyBQcm9taXNlKHJlc29sdmUgPT4gc2V0VGltZW91dChyZXNvbHZlLCAxMDAwKSk7XG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBkYXRhOiB0aGlzLmdlbmVyYXRlTW9ja1JlY2lwZURhdGEocXVlcnksIG9wdGlvbnMpLFxuICAgICAgc291cmNlOiAnc2Vjb25kYXJ5JyxcbiAgICAgIHJlc3BvbnNlVGltZTogMTAwMCxcbiAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKVxuICAgIH07XG4gIH1cblxuICAvLyBGYWxsYmFjayBkYXRhIG1ldGhvZHNcbiAgcHJpdmF0ZSBhc3luYyBnZXRGYWxsYmFja0FzdHJvbG9naWNhbERhdGEoZGF0ZTogRGF0ZSk6IFByb21pc2U8YW55PiB7XG4gICAgLy8gUmV0dXJuIGhhcmRjb2RlZCByZWxpYWJsZSBwb3NpdGlvbnMgZnJvbSBNYXJjaCAyMDI1XG4gICAgcmV0dXJuIHtcbiAgICAgIHN1bjogeyBzaWduOiAnYXJpZXMnLCBkZWdyZWU6IDguNSwgZXhhY3RMb25naXR1ZGU6IDguNSwgaXNSZXRyb2dyYWRlOiBmYWxzZSB9LFxuICAgICAgbW9vbjogeyBzaWduOiAnYXJpZXMnLCBkZWdyZWU6IDEuNTcsIGV4YWN0TG9uZ2l0dWRlOiAxLjU3LCBpc1JldHJvZ3JhZGU6IGZhbHNlIH0sXG4gICAgICBtZXJjdXJ5OiB7IHNpZ246ICdhcmllcycsIGRlZ3JlZTogMC44NSwgZXhhY3RMb25naXR1ZGU6IDAuODUsIGlzUmV0cm9ncmFkZTogdHJ1ZSB9LFxuICAgICAgdmVudXM6IHsgc2lnbjogJ3Bpc2NlcycsIGRlZ3JlZTogMjkuMDgsIGV4YWN0TG9uZ2l0dWRlOiAzNTkuMDgsIGlzUmV0cm9ncmFkZTogdHJ1ZSB9LFxuICAgICAgbWFyczogeyBzaWduOiAnY2FuY2VyJywgZGVncmVlOiAyMi42MywgZXhhY3RMb25naXR1ZGU6IDExMi42MywgaXNSZXRyb2dyYWRlOiBmYWxzZSB9LFxuICAgICAganVwaXRlcjogeyBzaWduOiAnZ2VtaW5pJywgZGVncmVlOiAxNS41MiwgZXhhY3RMb25naXR1ZGU6IDc1LjUyLCBpc1JldHJvZ3JhZGU6IGZhbHNlIH0sXG4gICAgICBzYXR1cm46IHsgc2lnbjogJ3Bpc2NlcycsIGRlZ3JlZTogMjQuMTIsIGV4YWN0TG9uZ2l0dWRlOiAzNTQuMTIsIGlzUmV0cm9ncmFkZTogZmFsc2UgfVxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGdldEZhbGxiYWNrTnV0cml0aW9uYWxEYXRhKGluZ3JlZGllbnQ6IHN0cmluZyk6IFByb21pc2U8YW55PiB7XG4gICAgLy8gUmV0dXJuIGJhc2ljIG51dHJpdGlvbmFsIGRhdGEgZnJvbSBsb2NhbCBkYXRhYmFzZVxuICAgIHJldHVybiB7XG4gICAgICBuYW1lOiBpbmdyZWRpZW50LFxuICAgICAgY2Fsb3JpZXM6IDUwLFxuICAgICAgcHJvdGVpbjogMSxcbiAgICAgIGNhcmJzOiAxMixcbiAgICAgIGZhdDogMC4yLFxuICAgICAgZmliZXI6IDIsXG4gICAgICB2aXRhbWluczogWydDJywgJ0snXSxcbiAgICAgIG1pbmVyYWxzOiBbJ3BvdGFzc2l1bScsICdmb2xhdGUnXVxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGdldEZhbGxiYWNrUmVjaXBlRGF0YShxdWVyeTogc3RyaW5nLCBvcHRpb25zOiBhbnkpOiBQcm9taXNlPGFueT4ge1xuICAgIC8vIFJldHVybiBiYXNpYyByZWNpcGUgc3VnZ2VzdGlvbnMgZnJvbSBsb2NhbCBkYXRhYmFzZVxuICAgIHJldHVybiB7XG4gICAgICByZWNpcGVzOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBpZDogMSxcbiAgICAgICAgICB0aXRsZTogYFNpbXBsZSAke3F1ZXJ5fWAsXG4gICAgICAgICAgcmVhZHlJbk1pbnV0ZXM6IDMwLFxuICAgICAgICAgIHNlcnZpbmdzOiA0LFxuICAgICAgICAgIGltYWdlOiAncGxhY2Vob2xkZXIuanBnJyxcbiAgICAgICAgICBzdW1tYXJ5OiBgQSBzaW1wbGUgYW5kIGRlbGljaW91cyAke3F1ZXJ5fSByZWNpcGUuYFxuICAgICAgICB9XG4gICAgICBdLFxuICAgICAgdG90YWxSZXN1bHRzOiAxXG4gICAgfTtcbiAgfVxuXG4gIC8vIE1vY2sgZGF0YSBnZW5lcmF0b3JzIGZvciBzaW11bGF0aW9uXG4gIHByaXZhdGUgZ2VuZXJhdGVNb2NrUGxhbmV0YXJ5RGF0YShkYXRlOiBEYXRlKTogYW55IHtcbiAgICByZXR1cm4ge1xuICAgICAgZGF0ZTogZGF0ZS50b0lTT1N0cmluZygpLFxuICAgICAgcGxhbmV0czoge1xuICAgICAgICBzdW46IHsgc2lnbjogJ2FyaWVzJywgZGVncmVlOiA4LjUgKyBNYXRoLnJhbmRvbSgpICogMiB9LFxuICAgICAgICBtb29uOiB7IHNpZ246ICdhcmllcycsIGRlZ3JlZTogMS41NyArIE1hdGgucmFuZG9tKCkgKiA1IH0sXG4gICAgICAgIG1lcmN1cnk6IHsgc2lnbjogJ2FyaWVzJywgZGVncmVlOiAwLjg1ICsgTWF0aC5yYW5kb20oKSAqIDMgfVxuICAgICAgfVxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIGdlbmVyYXRlTW9ja051dHJpdGlvbmFsRGF0YShpbmdyZWRpZW50OiBzdHJpbmcpOiBhbnkge1xuICAgIHJldHVybiB7XG4gICAgICBuYW1lOiBpbmdyZWRpZW50LFxuICAgICAgZmRjSWQ6IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDEwMDAwMCksXG4gICAgICBjYWxvcmllczogTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMjAwKSArIDIwLFxuICAgICAgbnV0cmllbnRzOiB7XG4gICAgICAgIHByb3RlaW46IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDIwKSArIDEsXG4gICAgICAgIGNhcmJzOiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiA1MCkgKyA1LFxuICAgICAgICBmYXQ6IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDE1KSArIDAuMVxuICAgICAgfVxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIGdlbmVyYXRlTW9ja1JlY2lwZURhdGEocXVlcnk6IHN0cmluZywgb3B0aW9uczogYW55KTogYW55IHtcbiAgICByZXR1cm4ge1xuICAgICAgcmVzdWx0czogQXJyYXkuZnJvbSh7IGxlbmd0aDogb3B0aW9ucy5tYXhSZXN1bHRzIHx8IDUgfSwgKF8sIGkpID0+ICh7XG4gICAgICAgIGlkOiBpICsgMSxcbiAgICAgICAgdGl0bGU6IGAke3F1ZXJ5fSBSZWNpcGUgJHtpICsgMX1gLFxuICAgICAgICByZWFkeUluTWludXRlczogTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogNjApICsgMTUsXG4gICAgICAgIHNlcnZpbmdzOiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiA2KSArIDIsXG4gICAgICAgIGN1aXNpbmU6IG9wdGlvbnMuY3Vpc2luZSB8fCAnaW50ZXJuYXRpb25hbCdcbiAgICAgIH0pKSxcbiAgICAgIHRvdGFsUmVzdWx0czogb3B0aW9ucy5tYXhSZXN1bHRzIHx8IDVcbiAgICB9O1xuICB9XG59XG5cbi8qKlxuICogU2ltcGxlIHJhdGUgbGltaXRlciBpbXBsZW1lbnRhdGlvblxuICovXG5jbGFzcyBSYXRlTGltaXRlciB7XG4gIHByaXZhdGUgcmVxdWVzdHM6IG51bWJlcltdID0gW107XG4gIHByaXZhdGUgY29uZmlnOiBNQ1BSYXRlTGltaXRDb25maWc7XG5cbiAgY29uc3RydWN0b3IoY29uZmlnOiBNQ1BSYXRlTGltaXRDb25maWcpIHtcbiAgICB0aGlzLmNvbmZpZyA9IGNvbmZpZztcbiAgfVxuXG4gIGNoZWNrTGltaXQoKTogYm9vbGVhbiB7XG4gICAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTtcbiAgICBcbiAgICAvLyBDbGVhbiBvbGQgcmVxdWVzdHNcbiAgICB0aGlzLnJlcXVlc3RzID0gdGhpcy5yZXF1ZXN0cy5maWx0ZXIodGltZSA9PiBub3cgLSB0aW1lIDwgNjAwMDApOyAvLyBLZWVwIGxhc3QgbWludXRlXG4gICAgXG4gICAgLy8gQ2hlY2sgbWludXRlIGxpbWl0XG4gICAgaWYgKHRoaXMucmVxdWVzdHMubGVuZ3RoID49IHRoaXMuY29uZmlnLnJlcXVlc3RzUGVyTWludXRlKSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIFxuICAgIC8vIEFkZCBjdXJyZW50IHJlcXVlc3RcbiAgICB0aGlzLnJlcXVlc3RzLnB1c2gobm93KTtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxufVxuXG4vKipcbiAqIENvbnZlbmllbmNlIGZ1bmN0aW9uIHRvIGdldCBNQ1Agc2VydmVyIGludGVncmF0aW9uIGluc3RhbmNlXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRNQ1BTZXJ2ZXJJbnRlZ3JhdGlvbigpOiBNQ1BTZXJ2ZXJJbnRlZ3JhdGlvbiB7XG4gIHJldHVybiBNQ1BTZXJ2ZXJJbnRlZ3JhdGlvbi5nZXRJbnN0YW5jZSgpO1xufVxuXG4vKipcbiAqIEhvb2sgZm9yIGNvbXBvbmVudHMgdG8gdXNlIE1DUCBzZXJ2ZXIgaW50ZWdyYXRpb25cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHVzZU1DUFNlcnZlckludGVncmF0aW9uKCkge1xuICBjb25zdCBtY3AgPSBnZXRNQ1BTZXJ2ZXJJbnRlZ3JhdGlvbigpO1xuICBcbiAgcmV0dXJuIHtcbiAgICBnZXRBc3Ryb2xvZ2ljYWxEYXRhOiAoZGF0ZT86IERhdGUpID0+IG1jcC5nZXRBc3Ryb2xvZ2ljYWxEYXRhKGRhdGUpLFxuICAgIGdldE51dHJpdGlvbmFsRGF0YTogKGluZ3JlZGllbnQ6IHN0cmluZykgPT4gbWNwLmdldE51dHJpdGlvbmFsRGF0YShpbmdyZWRpZW50KSxcbiAgICBnZXRSZWNpcGVEYXRhOiAocXVlcnk6IHN0cmluZywgb3B0aW9ucz86IGFueSkgPT4gbWNwLmdldFJlY2lwZURhdGEocXVlcnksIG9wdGlvbnMpLFxuICAgIHRlc3RGYWxsYmFja1N0cmF0ZWd5OiAoKSA9PiBtY3AudGVzdEZhbGxiYWNrU3RyYXRlZ3koKSxcbiAgICBnZXRTZXJ2ZXJTdGF0dXM6ICgpID0+IG1jcC5nZXRTZXJ2ZXJTdGF0dXMoKVxuICB9O1xufSJdLCJ2ZXJzaW9uIjozfQ==