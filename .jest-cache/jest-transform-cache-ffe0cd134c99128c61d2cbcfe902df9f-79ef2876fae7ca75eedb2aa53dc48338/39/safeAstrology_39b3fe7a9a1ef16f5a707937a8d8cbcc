8b84f397b8f2e6391ae7b089d15731f1
"use strict";
/**
 * Safe Astrological Utilities
 *
 * This module provides reliable astronomy calculations using hardcoded
 * accurate planetary positions for March 2025, avoiding the need for
 * complex API calls and calculations that might fail.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.getCurrentAstrologicalState = exports.calculateAspectStrength = exports.identifyAspect = exports.calculatePlanetaryAspects = exports.getZodiacPositionInDegrees = exports.calculateSunSign = exports.getMoonIllumination = exports.getLunarPhaseName = exports.calculateLunarPhase = exports.getReliablePlanetaryPositions = void 0;
const logger_1 = require("@/utils/logger");
// Create a component-specific logger
const logger = (0, logger_1.createLogger)('SafeAstrology');
// Ensure ZodiacSign type is properly capitalized
const ZODIAC_SIGNS = [
    'aries', 'taurus', 'gemini', 'cancer',
    'leo', 'virgo', 'libra', 'scorpio',
    'sagittarius', 'capricorn', 'aquarius', 'pisces'
];
let astrologyCache = null;
const CACHE_DURATION = 15 * 60 * 1000; // 15 minutes
/**
 * Get the current reliable planetary positions
 * Uses hardcoded accurate values for March 2025
 * @returns Record of planetary positions with sign, degree, and other data
 */
function getReliablePlanetaryPositions() {
    const positions = {
        Sun: { sign: 'aries', degree: 8.63, exactLongitude: 8.63, isRetrograde: false },
        Moon: { sign: 'aries', degree: 3.48, exactLongitude: 3.48, isRetrograde: false },
        Mercury: { sign: 'aries', degree: 0.75, exactLongitude: 0.75, isRetrograde: true },
        Venus: { sign: 'pisces', degree: 29.0, exactLongitude: 359.0, isRetrograde: true },
        Mars: { sign: 'cancer', degree: 22.67, exactLongitude: 112.67, isRetrograde: false },
        Jupiter: { sign: 'gemini', degree: 15.53, exactLongitude: 75.53, isRetrograde: false },
        Saturn: { sign: 'pisces', degree: 24.13, exactLongitude: 354.13, isRetrograde: false },
        Uranus: { sign: 'taurus', degree: 24.62, exactLongitude: 54.62, isRetrograde: false },
        Neptune: { sign: 'pisces', degree: 29.93, exactLongitude: 359.93, isRetrograde: false },
        Pluto: { sign: 'aquarius', degree: 3.5, exactLongitude: 333.5, isRetrograde: false },
        northNode: { sign: 'pisces', degree: 26.88, exactLongitude: 356.88, isRetrograde: true },
        southNode: { sign: 'virgo', degree: 26.88, exactLongitude: 176.88, isRetrograde: true },
        Ascendant: { sign: 'scorpio', degree: 13.88, exactLongitude: 223.88, isRetrograde: false }
    };
    return positions;
}
exports.getReliablePlanetaryPositions = getReliablePlanetaryPositions;
/**
 * Get the current moon phase as a number from 0-29.5
 * @returns Lunar age in days (0-29.5)
 */
function calculateLunarPhase() {
    // Calculate approximate lunar age (0-29.5)
    // Based on the fact that March 28, 2025 has a new moon at 1Â° aries
    const daysSinceMarch28 = getDaysSinceDate(new Date('2025-03-28'));
    const lunarAge = (daysSinceMarch28 % 29.5 + 29.5) % 29.5;
    return lunarAge;
}
exports.calculateLunarPhase = calculateLunarPhase;
/**
 * Get the name of the lunar phase
 * @param phase Lunar age in days (0-29.5)
 * @returns Name of lunar phase
 */
function getLunarPhaseName(phase) {
    if (phase < 1)
        return 'new moon';
    if (phase < 7.4)
        return 'waxing crescent';
    if (phase < 8.4)
        return 'first quarter';
    if (phase < 14.8)
        return 'waxing gibbous';
    if (phase < 15.8)
        return 'full moon';
    if (phase < 22.1)
        return 'waning gibbous';
    if (phase < 23.1)
        return 'last quarter';
    return 'waning crescent';
}
exports.getLunarPhaseName = getLunarPhaseName;
/**
 * Get the moon illumination percentage
 * @returns Illumination as a decimal (0-1)
 */
function getMoonIllumination() {
    const phase = calculateLunarPhase();
    // Calculate illumination based on lunar age
    if (phase <= 14.8) {
        // Waxing from new to full (0% to 100%)
        return phase / 14.8;
    }
    else {
        // Waning from full to new (100% to 0%)
        return (29.5 - phase) / 14.8;
    }
}
exports.getMoonIllumination = getMoonIllumination;
/**
 * Calculate sun sign for a given date
 * @param date Date to calculate sun sign for (defaults to current date)
 * @returns Zodiac sign as a string
 */
function calculateSunSign(date = new Date()) {
    // For simplicity, hardcode the sun sign based on the month
    const month = date.getMonth();
    const day = date.getDate();
    // Simple zodiac date ranges
    if ((month === 2 && day >= 21) || (month === 3 && day <= 19))
        return 'aries';
    if ((month === 3 && day >= 20) || (month === 4 && day <= 20))
        return 'taurus';
    if ((month === 4 && day >= 21) || (month === 5 && day <= 20))
        return 'gemini';
    if ((month === 5 && day >= 21) || (month === 6 && day <= 22))
        return 'cancer';
    if ((month === 6 && day >= 23) || (month === 7 && day <= 22))
        return 'leo';
    if ((month === 7 && day >= 23) || (month === 8 && day <= 22))
        return 'virgo';
    if ((month === 8 && day >= 23) || (month === 9 && day <= 22))
        return 'libra';
    if ((month === 9 && day >= 23) || (month === 10 && day <= 21))
        return 'scorpio';
    if ((month === 10 && day >= 22) || (month === 11 && day <= 21))
        return 'sagittarius';
    if ((month === 11 && day >= 22) || (month === 0 && day <= 19))
        return 'capricorn';
    if ((month === 0 && day >= 20) || (month === 1 && day <= 18))
        return 'aquarius';
    return 'pisces';
}
exports.calculateSunSign = calculateSunSign;
/**
 * Get zodiac sign position in degrees (0-359)
 * @param sign Zodiac sign
 * @param degree Degree within the sign (0-29.99)
 * @returns Absolute position in degrees (0-359)
 */
function getZodiacPositionInDegrees(sign, degree) {
    const signIndex = ZODIAC_SIGNS.indexOf(sign);
    if (signIndex === -1) {
        logger.warn(`Unknown sign: ${sign}, falling back to Aries`);
        return degree; // Aries starts at 0 degrees
    }
    return (signIndex * 30) + degree;
}
exports.getZodiacPositionInDegrees = getZodiacPositionInDegrees;
/**
 * Calculate planetary aspects from positions
 * @param positions Record of planetary positions
 * @returns Array of planetary aspects
 */
function calculatePlanetaryAspects(positions) {
    const aspects = [];
    const planets = Object.keys(positions);
    // Calculate aspects between all planet pairs
    for (let i = 0; i < planets.length; i++) {
        for (let j = i + 1; j < planets.length; j++) {
            const planet1 = planets[i];
            const planet2 = planets[j];
            if (!positions[planet1] || !positions[planet2])
                continue;
            // Convert lowercase sign strings to proper ZodiacSign type values
            const pos1Sign = positions[planet1].sign;
            const pos2Sign = positions[planet2].sign;
            // Calculate the angular difference between planets
            const pos1 = getZodiacPositionInDegrees(pos1Sign, positions[planet1].degree || 0);
            const pos2 = getZodiacPositionInDegrees(pos2Sign, positions[planet2].degree || 0);
            let diff = Math.abs(pos1 - pos2);
            if (diff > 180)
                diff = 360 - diff;
            // Check for aspects with orbs
            const aspect = identifyAspect(diff);
            if (aspect) {
                // Create aspect with proper typing - 'planets' array instead of 'type'
                aspects.push({
                    planet1,
                    planet2,
                    orb: aspect.orb,
                    influence: calculateAspectStrength(aspect.type, aspect.orb),
                    planets: [planet1, planet2],
                    additionalInfo: { aspectType: aspect.type }
                });
            }
        }
    }
    logger.debug(`Found ${aspects.length} aspects`);
    return aspects;
}
exports.calculatePlanetaryAspects = calculatePlanetaryAspects;
/**
 * Identify aspect type from angle
 * @param angleDiff Angular difference between planets
 * @returns Aspect type and orb if aspect exists, null otherwise
 */
function identifyAspect(angleDiff) {
    const aspects = [
        { type: 'conjunction', angle: 0, maxOrb: 10 },
        { type: 'opposition', angle: 180, maxOrb: 10 },
        { type: 'trine', angle: 120, maxOrb: 8 },
        { type: 'square', angle: 90, maxOrb: 8 },
        { type: 'sextile', angle: 60, maxOrb: 6 },
        { type: 'quincunx', angle: 150, maxOrb: 5 },
        { type: 'semisextile', angle: 30, maxOrb: 3 },
        { type: 'semisquare', angle: 45, maxOrb: 3 },
        { type: 'sesquisquare', angle: 135, maxOrb: 3 }
    ];
    for (const aspect of aspects) {
        const orb = Math.abs(angleDiff - aspect.angle);
        if (orb <= aspect.maxOrb) {
            return { type: aspect.type, orb };
        }
    }
    return null;
}
exports.identifyAspect = identifyAspect;
/**
 * Calculate aspect strength based on type and orb
 * @param type Aspect type
 * @param orb Orb (angle deviation from exact aspect)
 * @returns Strength value (0-10)
 */
function calculateAspectStrength(type, orb) {
    const baseStrengths = {
        'conjunction': 10,
        'opposition': 10,
        'trine': 8,
        'square': 8,
        'sextile': 6,
        'quincunx': 4,
        'semisextile': 2,
        'semisquare': 2,
        'sesquisquare': 2,
        'quintile': 1,
        'biquintile': 1
    };
    // Diminish strength based on orb
    const baseStrength = baseStrengths[type] || 0;
    const maxOrb = type === 'conjunction' || type === 'opposition' ? 10 :
        type === 'trine' || type === 'square' ? 8 :
            type === 'sextile' ? 6 : 5;
    return baseStrength * (1 - orb / maxOrb);
}
exports.calculateAspectStrength = calculateAspectStrength;
/**
 * Get the current astrological state
 * @returns Current astrological state with planetary positions, aspects, etc.
 */
function getCurrentAstrologicalState() {
    // Use cache if available and recent
    if (astrologyCache && (Date.now() - astrologyCache.timestamp < CACHE_DURATION)) {
        logger.debug("Using cached astrological state");
        return astrologyCache.data;
    }
    logger.debug("Calculating fresh astrological state");
    const now = new Date();
    const positions = getReliablePlanetaryPositions();
    const lunarPhase = calculateLunarPhase();
    const phaseName = getLunarPhaseName(lunarPhase);
    // Determine dominant element based on positions
    const elements = countElements(positions);
    const dominantElement = getDominantElement(elements);
    // Calculate aspects
    const aspects = calculatePlanetaryAspects(positions);
    // Determine if it's daytime (between 6 AM and 6 PM)
    const hours = now.getHours();
    const isDaytime = hours >= 6 && hours < 18;
    // Calculate active planets (sun, moon + any in major aspect)
    const activePlanets = ["Sun", "Moon"];
    aspects.forEach(aspect => {
        // Check influence rather than strength
        if (aspect.influence && aspect.influence > 5) {
            const planet1 = aspect.planet1.charAt(0).toUpperCase() + aspect.planet1.slice(1);
            const planet2 = aspect.planet2.charAt(0).toUpperCase() + aspect.planet2.slice(1);
            if (!activePlanets.includes(planet1))
                activePlanets.push(planet1);
            if (!activePlanets.includes(planet2))
                activePlanets.push(planet2);
        }
    });
    // Convert string element to proper casing for Element type
    const dominantElementCapitalized = dominantElement.charAt(0).toUpperCase() + dominantElement.slice(1);
    const state = {
        sunSign: toZodiacSign(String(positions.sun.sign)),
        moonSign: toZodiacSign(String(positions.moon.sign)),
        lunarPhase: phaseName,
        activePlanets,
        dominantElement: dominantElementCapitalized,
        dominantPlanets: activePlanets
    };
    // Update cache
    astrologyCache = {
        data: state,
        timestamp: Date.now()
    };
    return state;
}
exports.getCurrentAstrologicalState = getCurrentAstrologicalState;
/**
 * Count elements from planetary positions
 * @param positions Record of planetary positions
 * @returns Count of each element
 */
function countElements(positions) {
    const elements = {
        fire: 0,
        earth: 0,
        air: 0,
        water: 0
    };
    // Element mapping for signs
    const signElements = {
        aries: 'Fire',
        leo: 'Fire',
        sagittarius: 'Fire',
        taurus: 'Earth',
        virgo: 'Earth',
        capricorn: 'Earth',
        gemini: 'Air',
        libra: 'Air',
        aquarius: 'Air',
        cancer: 'Water',
        scorpio: 'Water',
        pisces: 'Water'
    };
    // Extra weight for certain planets
    const planetWeight = {
        sun: 3,
        moon: 2,
        ascendant: 2,
        mercury: 1.5,
        venus: 1.5,
        mars: 1.5,
        jupiter: 1.5,
        saturn: 1.5,
        uranus: 1,
        neptune: 1,
        pluto: 1,
        northNode: 0.5,
        southNode: 0.5
    };
    // Count elements
    Object.entries(positions).forEach(([planet, position]) => {
        const element = signElements[position.sign || 'aries'];
        const weight = planetWeight[planet] || 1;
        elements[element] += weight;
    });
    return elements;
}
/**
 * Get the dominant element from element counts
 * @param elements Record of element counts
 * @returns Dominant element
 */
function getDominantElement(elements) {
    let maxElement = 'balanced';
    let maxCount = 0;
    Object.entries(elements).forEach(([element, count]) => {
        if (count > maxCount) {
            maxCount = count;
            maxElement = element;
        }
    });
    return maxElement;
}
/**
 * Calculate days since a specific date
 * @param date Reference date
 * @returns Number of days since the reference date
 */
function getDaysSinceDate(date) {
    const now = new Date();
    const timeDiff = now.getTime() - date.getTime();
    return timeDiff / (1000 * 60 * 60 * 24);
}
// Helper function to convert any string to a valid ZodiacSign
function toZodiacSign(sign) {
    // Convert first letter to uppercase and rest to lowercase
    const formattedSign = sign.charAt(0).toUpperCase() + sign.slice(1).toLowerCase();
    // Check if it's a valid ZodiacSign
    if (ZODIAC_SIGNS.includes(formattedSign)) {
        return formattedSign;
    }
    // Default to Aries if invalid
    return 'aries';
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy91dGlscy9zYWZlQXN0cm9sb2d5LnRzIiwibWFwcGluZ3MiOiI7QUFBQTs7Ozs7O0dBTUc7OztBQUlILDJDQUE4QztBQUU5QyxxQ0FBcUM7QUFDckMsTUFBTSxNQUFNLEdBQUcsSUFBQSxxQkFBWSxFQUFDLGVBQWUsQ0FBQyxDQUFDO0FBUTdDLGlEQUFpRDtBQUNqRCxNQUFNLFlBQVksR0FBaUI7SUFDakMsT0FBTyxFQUFFLFFBQVEsRUFBRSxRQUFRLEVBQUUsUUFBUTtJQUNyQyxLQUFLLEVBQUUsT0FBTyxFQUFFLE9BQU8sRUFBRSxTQUFTO0lBQ2xDLGFBQWEsRUFBRSxXQUFXLEVBQUUsVUFBVSxFQUFFLFFBQVE7Q0FDakQsQ0FBQztBQUVGLElBQUksY0FBYyxHQUF5QyxJQUFJLENBQUM7QUFDaEUsTUFBTSxjQUFjLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxJQUFJLENBQUMsQ0FBQyxhQUFhO0FBRXBEOzs7O0dBSUc7QUFDSCxTQUFnQiw2QkFBNkI7SUFDM0MsTUFBTSxTQUFTLEdBQXNDO1FBQ25ELEdBQUcsRUFBRSxFQUFFLElBQUksRUFBRSxPQUFPLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxjQUFjLEVBQUUsSUFBSSxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQUU7UUFDL0UsSUFBSSxFQUFFLEVBQUUsSUFBSSxFQUFFLE9BQU8sRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFLGNBQWMsRUFBRSxJQUFJLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBRTtRQUNoRixPQUFPLEVBQUUsRUFBRSxJQUFJLEVBQUUsT0FBTyxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsY0FBYyxFQUFFLElBQUksRUFBRSxZQUFZLEVBQUUsSUFBSSxFQUFFO1FBQ2xGLEtBQUssRUFBRSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSxjQUFjLEVBQUUsS0FBSyxFQUFFLFlBQVksRUFBRSxJQUFJLEVBQUU7UUFDbEYsSUFBSSxFQUFFLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLGNBQWMsRUFBRSxNQUFNLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBRTtRQUNwRixPQUFPLEVBQUUsRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsY0FBYyxFQUFFLEtBQUssRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFFO1FBQ3RGLE1BQU0sRUFBRSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxjQUFjLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQUU7UUFDdEYsTUFBTSxFQUFFLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLGNBQWMsRUFBRSxLQUFLLEVBQUUsWUFBWSxFQUFFLEtBQUssRUFBRTtRQUNyRixPQUFPLEVBQUUsRUFBRSxJQUFJLEVBQUUsUUFBUSxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsY0FBYyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFFO1FBQ3ZGLEtBQUssRUFBRSxFQUFFLElBQUksRUFBRSxVQUFVLEVBQUUsTUFBTSxFQUFFLEdBQUcsRUFBRSxjQUFjLEVBQUUsS0FBSyxFQUFFLFlBQVksRUFBRSxLQUFLLEVBQUU7UUFDcEYsU0FBUyxFQUFFLEVBQUUsSUFBSSxFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLGNBQWMsRUFBRSxNQUFNLEVBQUUsWUFBWSxFQUFFLElBQUksRUFBRTtRQUN4RixTQUFTLEVBQUUsRUFBRSxJQUFJLEVBQUUsT0FBTyxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsY0FBYyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsSUFBSSxFQUFFO1FBQ3ZGLFNBQVMsRUFBRSxFQUFFLElBQUksRUFBRSxTQUFTLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRSxjQUFjLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFB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QyxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxPQUFPLEVBQUUsS0FBSyxDQUFDLEVBQUUsRUFBRTtRQUNwRCxJQUFJLEtBQUssR0FBRyxRQUFRLEVBQUU7WUFDcEIsUUFBUSxHQUFHLEtBQUssQ0FBQztZQUNqQixVQUFVLEdBQUcsT0FBTyxDQUFDO1NBQ3RCO0lBQ0gsQ0FBQyxDQUFDLENBQUM7SUFFSCxPQUFPLFVBQVUsQ0FBQztBQUNwQixDQUFDO0FBRUQ7Ozs7R0FJRztBQUNILFNBQVMsZ0JBQWdCLENBQUMsSUFBVTtJQUNsQyxNQUFNLEdBQUcsR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDO0lBQ3ZCLE1BQU0sUUFBUSxHQUFHLEdBQUcsQ0FBQyxPQUFPLEVBQUUsR0FBRyxJQUFJLENBQUMsT0FBTyxFQUFFLENBQUM7SUFDaEQsT0FBTyxRQUFRLEdBQUcsQ0FBQyxJQUFJLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztBQUMxQyxDQUFDO0FBRUQsOERBQThEO0FBQzlELFNBQVMsWUFBWSxDQUFDLElBQVk7SUFDaEMsMERBQTBEO0lBQzFELE1BQU0sYUFBYSxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLENBQUMsV0FBVyxFQUFFLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztJQUVqRixtQ0FBbUM7SUFDbkMsSUFBSSxZQUFZLENBQUMsUUFBUSxDQUFDLGFBQTJCLENBQUMsRUFBRTtRQUN0RCxPQUFPLGFBQTJCLENBQUM7S0FDcEM7SUFFRCw4QkFBOEI7SUFDOUIsT0FBTyxPQUFPLENBQUM7QUFDakIsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvR3JlZ0Nhc3Ryby9EZXNrdG9wL1doYXRUb0VhdE5leHQvc3JjL3V0aWxzL3NhZmVBc3Ryb2xvZ3kudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBTYWZlIEFzdHJvbG9naWNhbCBVdGlsaXRpZXNcbiAqIFxuICogVGhpcyBtb2R1bGUgcHJvdmlkZXMgcmVsaWFibGUgYXN0cm9ub215IGNhbGN1bGF0aW9ucyB1c2luZyBoYXJkY29kZWRcbiAqIGFjY3VyYXRlIHBsYW5ldGFyeSBwb3NpdGlvbnMgZm9yIE1hcmNoIDIwMjUsIGF2b2lkaW5nIHRoZSBuZWVkIGZvclxuICogY29tcGxleCBBUEkgY2FsbHMgYW5kIGNhbGN1bGF0aW9ucyB0aGF0IG1pZ2h0IGZhaWwuXG4gKi9cblxuaW1wb3J0IHsgQXN0cm9sb2dpY2FsU3RhdGUsIHR5cGUgTHVuYXJQaGFzZSB9IGZyb20gJ0AvdHlwZXMvYWxjaGVteSc7XG5pbXBvcnQgeyBab2RpYWNTaWduLCBQbGFuZXRhcnlBc3BlY3QsIENlbGVzdGlhbFBvc2l0aW9uLCBBc3BlY3RUeXBlIH0gZnJvbSAnQC90eXBlcy9jZWxlc3RpYWwnO1xuaW1wb3J0IHsgY3JlYXRlTG9nZ2VyIH0gZnJvbSAnQC91dGlscy9sb2dnZXInO1xuXG4vLyBDcmVhdGUgYSBjb21wb25lbnQtc3BlY2lmaWMgbG9nZ2VyXG5jb25zdCBsb2dnZXIgPSBjcmVhdGVMb2dnZXIoJ1NhZmVBc3Ryb2xvZ3knKTtcblxuLy8gQ2FjaGUgc3lzdGVtIHRvIGF2b2lkIHJlZHVuZGFudCBjYWxjdWxhdGlvbnNcbmludGVyZmFjZSBTdGF0ZUNhY2hlPFQ+IHtcbiAgZGF0YTogVDtcbiAgdGltZXN0YW1wOiBudW1iZXI7XG59XG5cbi8vIEVuc3VyZSBab2RpYWNTaWduIHR5cGUgaXMgcHJvcGVybHkgY2FwaXRhbGl6ZWRcbmNvbnN0IFpPRElBQ19TSUdOUzogWm9kaWFjU2lnbltdID0gW1xuICAnYXJpZXMnLCAndGF1cnVzJywgJ2dlbWluaScsICdjYW5jZXInLFxuICAnbGVvJywgJ3ZpcmdvJywgJ2xpYnJhJywgJ3Njb3JwaW8nLFxuICAnc2FnaXR0YXJpdXMnLCAnY2Fwcmljb3JuJywgJ2FxdWFyaXVzJywgJ3Bpc2Nlcydcbl07XG5cbmxldCBhc3Ryb2xvZ3lDYWNoZTogU3RhdGVDYWNoZTxBc3Ryb2xvZ2ljYWxTdGF0ZT4gfCBudWxsID0gbnVsbDtcbmNvbnN0IENBQ0hFX0RVUkFUSU9OID0gMTUgKiA2MCAqIDEwMDA7IC8vIDE1IG1pbnV0ZXNcblxuLyoqXG4gKiBHZXQgdGhlIGN1cnJlbnQgcmVsaWFibGUgcGxhbmV0YXJ5IHBvc2l0aW9uc1xuICogVXNlcyBoYXJkY29kZWQgYWNjdXJhdGUgdmFsdWVzIGZvciBNYXJjaCAyMDI1XG4gKiBAcmV0dXJucyBSZWNvcmQgb2YgcGxhbmV0YXJ5IHBvc2l0aW9ucyB3aXRoIHNpZ24sIGRlZ3JlZSwgYW5kIG90aGVyIGRhdGFcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldFJlbGlhYmxlUGxhbmV0YXJ5UG9zaXRpb25zKCk6IFJlY29yZDxzdHJpbmcsIENlbGVzdGlhbFBvc2l0aW9uPiB7XG4gIGNvbnN0IHBvc2l0aW9uczogUmVjb3JkPHN0cmluZywgQ2VsZXN0aWFsUG9zaXRpb24+ID0ge1xuICAgIFN1bjogeyBzaWduOiAnYXJpZXMnLCBkZWdyZWU6IDguNjMsIGV4YWN0TG9uZ2l0dWRlOiA4LjYzLCBpc1JldHJvZ3JhZGU6IGZhbHNlIH0sXG4gICAgTW9vbjogeyBzaWduOiAnYXJpZXMnLCBkZWdyZWU6IDMuNDgsIGV4YWN0TG9uZ2l0dWRlOiAzLjQ4LCBpc1JldHJvZ3JhZGU6IGZhbHNlIH0sXG4gICAgTWVyY3VyeTogeyBzaWduOiAnYXJpZXMnLCBkZWdyZWU6IDAuNzUsIGV4YWN0TG9uZ2l0dWRlOiAwLjc1LCBpc1JldHJvZ3JhZGU6IHRydWUgfSxcbiAgICBWZW51czogeyBzaWduOiAncGlzY2VzJywgZGVncmVlOiAyOS4wLCBleGFjdExvbmdpdHVkZTogMzU5LjAsIGlzUmV0cm9ncmFkZTogdHJ1ZSB9LFxuICAgIE1hcnM6IHsgc2lnbjogJ2NhbmNlcicsIGRlZ3JlZTogMjIuNjcsIGV4YWN0TG9uZ2l0dWRlOiAxMTIuNjcsIGlzUmV0cm9ncmFkZTogZmFsc2UgfSxcbiAgICBKdXBpdGVyOiB7IHNpZ246ICdnZW1pbmknLCBkZWdyZWU6IDE1LjUzLCBleGFjdExvbmdpdHVkZTogNzUuNTMsIGlzUmV0cm9ncmFkZTogZmFsc2UgfSxcbiAgICBTYXR1cm46IHsgc2lnbjogJ3Bpc2NlcycsIGRlZ3JlZTogMjQuMTMsIGV4YWN0TG9uZ2l0dWRlOiAzNTQuMTMsIGlzUmV0cm9ncmFkZTogZmFsc2UgfSxcbiAgICBVcmFudXM6IHsgc2lnbjogJ3RhdXJ1cycsIGRlZ3JlZTogMjQuNjIsIGV4YWN0TG9uZ2l0dWRlOiA1NC42MiwgaXNSZXRyb2dyYWRlOiBmYWxzZSB9LFxuICAgIE5lcHR1bmU6IHsgc2lnbjogJ3Bpc2NlcycsIGRlZ3JlZTogMjkuOTMsIGV4YWN0TG9uZ2l0dWRlOiAzNTkuOTMsIGlzUmV0cm9ncmFkZTogZmFsc2UgfSxcbiAgICBQbHV0bzogeyBzaWduOiAnYXF1YXJpdXMnLCBkZWdyZWU6IDMuNSwgZXhhY3RMb25naXR1ZGU6IDMzMy41LCBpc1JldHJvZ3JhZGU6IGZhbHNlIH0sXG4gICAgbm9ydGhOb2RlOiB7IHNpZ246ICdwaXNjZXMnLCBkZWdyZWU6IDI2Ljg4LCBleGFjdExvbmdpdHVkZTogMzU2Ljg4LCBpc1JldHJvZ3JhZGU6IHRydWUgfSxcbiAgICBzb3V0aE5vZGU6IHsgc2lnbjogJ3ZpcmdvJywgZGVncmVlOiAyNi44OCwgZXhhY3RMb25naXR1ZGU6IDE3Ni44OCwgaXNSZXRyb2dyYWRlOiB0cnVlIH0sXG4gICAgQXNjZW5kYW50OiB7IHNpZ246ICdzY29ycGlvJywgZGVncmVlOiAxMy44OCwgZXhhY3RMb25naXR1ZGU6IDIyMy44OCwgaXNSZXRyb2dyYWRlOiBmYWxzZSB9XG4gIH07XG4gIFxuICByZXR1cm4gcG9zaXRpb25zO1xufVxuXG4vKipcbiAqIEdldCB0aGUgY3VycmVudCBtb29uIHBoYXNlIGFzIGEgbnVtYmVyIGZyb20gMC0yOS41XG4gKiBAcmV0dXJucyBMdW5hciBhZ2UgaW4gZGF5cyAoMC0yOS41KVxuICovXG5leHBvcnQgZnVuY3Rpb24gY2FsY3VsYXRlTHVuYXJQaGFzZSgpOiBudW1iZXIge1xuICAvLyBDYWxjdWxhdGUgYXBwcm94aW1hdGUgbHVuYXIgYWdlICgwLTI5LjUpXG4gIC8vIEJhc2VkIG9uIHRoZSBmYWN0IHRoYXQgTWFyY2ggMjgsIDIwMjUgaGFzIGEgbmV3IG1vb24gYXQgMcKwIGFyaWVzXG4gIGNvbnN0IGRheXNTaW5jZU1hcmNoMjggPSBnZXREYXlzU2luY2VEYXRlKG5ldyBEYXRlKCcyMDI1LTAzLTI4JykpO1xuICBjb25zdCBsdW5hckFnZSA9IChkYXlzU2luY2VNYXJjaDI4ICUgMjkuNSArIDI5LjUpICUgMjkuNTtcbiAgcmV0dXJuIGx1bmFyQWdlO1xufVxuXG4vKipcbiAqIEdldCB0aGUgbmFtZSBvZiB0aGUgbHVuYXIgcGhhc2VcbiAqIEBwYXJhbSBwaGFzZSBMdW5hciBhZ2UgaW4gZGF5cyAoMC0yOS41KVxuICogQHJldHVybnMgTmFtZSBvZiBsdW5hciBwaGFzZVxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0THVuYXJQaGFzZU5hbWUocGhhc2U6IG51bWJlcik6IHN0cmluZyB7XG4gIGlmIChwaGFzZSA8IDEpIHJldHVybiAnbmV3IG1vb24nO1xuICBpZiAocGhhc2UgPCA3LjQpIHJldHVybiAnd2F4aW5nIGNyZXNjZW50JztcbiAgaWYgKHBoYXNlIDwgOC40KSByZXR1cm4gJ2ZpcnN0IHF1YXJ0ZXInO1xuICBpZiAocGhhc2UgPCAxNC44KSByZXR1cm4gJ3dheGluZyBnaWJib3VzJztcbiAgaWYgKHBoYXNlIDwgMTUuOCkgcmV0dXJuICdmdWxsIG1vb24nO1xuICBpZiAocGhhc2UgPCAyMi4xKSByZXR1cm4gJ3dhbmluZyBnaWJib3VzJztcbiAgaWYgKHBoYXNlIDwgMjMuMSkgcmV0dXJuICdsYXN0IHF1YXJ0ZXInO1xuICByZXR1cm4gJ3dhbmluZyBjcmVzY2VudCc7XG59XG5cbi8qKlxuICogR2V0IHRoZSBtb29uIGlsbHVtaW5hdGlvbiBwZXJjZW50YWdlXG4gKiBAcmV0dXJucyBJbGx1bWluYXRpb24gYXMgYSBkZWNpbWFsICgwLTEpXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRNb29uSWxsdW1pbmF0aW9uKCk6IG51bWJlciB7XG4gIGNvbnN0IHBoYXNlID0gY2FsY3VsYXRlTHVuYXJQaGFzZSgpO1xuICBcbiAgLy8gQ2FsY3VsYXRlIGlsbHVtaW5hdGlvbiBiYXNlZCBvbiBsdW5hciBhZ2VcbiAgaWYgKHBoYXNlIDw9IDE0LjgpIHtcbiAgICAvLyBXYXhpbmcgZnJvbSBuZXcgdG8gZnVsbCAoMCUgdG8gMTAwJSlcbiAgICByZXR1cm4gcGhhc2UgLyAxNC44O1xuICB9IGVsc2Uge1xuICAgIC8vIFdhbmluZyBmcm9tIGZ1bGwgdG8gbmV3ICgxMDAlIHRvIDAlKVxuICAgIHJldHVybiAoMjkuNSAtIHBoYXNlKSAvIDE0Ljg7XG4gIH1cbn1cblxuLyoqXG4gKiBDYWxjdWxhdGUgc3VuIHNpZ24gZm9yIGEgZ2l2ZW4gZGF0ZVxuICogQHBhcmFtIGRhdGUgRGF0ZSB0byBjYWxjdWxhdGUgc3VuIHNpZ24gZm9yIChkZWZhdWx0cyB0byBjdXJyZW50IGRhdGUpXG4gKiBAcmV0dXJucyBab2RpYWMgc2lnbiBhcyBhIHN0cmluZ1xuICovXG5leHBvcnQgZnVuY3Rpb24gY2FsY3VsYXRlU3VuU2lnbihkYXRlOiBEYXRlID0gbmV3IERhdGUoKSk6IFpvZGlhY1NpZ24ge1xuICAvLyBGb3Igc2ltcGxpY2l0eSwgaGFyZGNvZGUgdGhlIHN1biBzaWduIGJhc2VkIG9uIHRoZSBtb250aFxuICBjb25zdCBtb250aCA9IGRhdGUuZ2V0TW9udGgoKTtcbiAgY29uc3QgZGF5ID0gZGF0ZS5nZXREYXRlKCk7XG4gIFxuICAvLyBTaW1wbGUgem9kaWFjIGRhdGUgcmFuZ2VzXG4gIGlmICgobW9udGggPT09IDIgJiYgZGF5ID49IDIxKSB8fCAobW9udGggPT09IDMgJiYgZGF5IDw9IDE5KSkgcmV0dXJuICdhcmllcyc7XG4gIGlmICgobW9udGggPT09IDMgJiYgZGF5ID49IDIwKSB8fCAobW9udGggPT09IDQgJiYgZGF5IDw9IDIwKSkgcmV0dXJuICd0YXVydXMnO1xuICBpZiAoKG1vbnRoID09PSA0ICYmIGRheSA+PSAyMSkgfHwgKG1vbnRoID09PSA1ICYmIGRheSA8PSAyMCkpIHJldHVybiAnZ2VtaW5pJztcbiAgaWYgKChtb250aCA9PT0gNSAmJiBkYXkgPj0gMjEpIHx8IChtb250aCA9PT0gNiAmJiBkYXkgPD0gMjIpKSByZXR1cm4gJ2NhbmNlcic7XG4gIGlmICgobW9udGggPT09IDYgJiYgZGF5ID49IDIzKSB8fCAobW9udGggPT09IDcgJiYgZGF5IDw9IDIyKSkgcmV0dXJuICdsZW8nO1xuICBpZiAoKG1vbnRoID09PSA3ICYmIGRheSA+PSAyMykgfHwgKG1vbnRoID09PSA4ICYmIGRheSA8PSAyMikpIHJldHVybiAndmlyZ28nO1xuICBpZiAoKG1vbnRoID09PSA4ICYmIGRheSA+PSAyMykgfHwgKG1vbnRoID09PSA5ICYmIGRheSA8PSAyMikpIHJldHVybiAnbGlicmEnO1xuICBpZiAoKG1vbnRoID09PSA5ICYmIGRheSA+PSAyMykgfHwgKG1vbnRoID09PSAxMCAmJiBkYXkgPD0gMjEpKSByZXR1cm4gJ3Njb3JwaW8nO1xuICBpZiAoKG1vbnRoID09PSAxMCAmJiBkYXkgPj0gMjIpIHx8IChtb250aCA9PT0gMTEgJiYgZGF5IDw9IDIxKSkgcmV0dXJuICdzYWdpdHRhcml1cyc7XG4gIGlmICgobW9udGggPT09IDExICYmIGRheSA+PSAyMikgfHwgKG1vbnRoID09PSAwICYmIGRheSA8PSAxOSkpIHJldHVybiAnY2Fwcmljb3JuJztcbiAgaWYgKChtb250aCA9PT0gMCAmJiBkYXkgPj0gMjApIHx8IChtb250aCA9PT0gMSAmJiBkYXkgPD0gMTgpKSByZXR1cm4gJ2FxdWFyaXVzJztcbiAgcmV0dXJuICdwaXNjZXMnO1xufVxuXG4vKipcbiAqIEdldCB6b2RpYWMgc2lnbiBwb3NpdGlvbiBpbiBkZWdyZWVzICgwLTM1OSlcbiAqIEBwYXJhbSBzaWduIFpvZGlhYyBzaWduXG4gKiBAcGFyYW0gZGVncmVlIERlZ3JlZSB3aXRoaW4gdGhlIHNpZ24gKDAtMjkuOTkpXG4gKiBAcmV0dXJucyBBYnNvbHV0ZSBwb3NpdGlvbiBpbiBkZWdyZWVzICgwLTM1OSlcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldFpvZGlhY1Bvc2l0aW9uSW5EZWdyZWVzKHNpZ246IFpvZGlhY1NpZ24sIGRlZ3JlZTogbnVtYmVyKTogbnVtYmVyIHtcbiAgY29uc3Qgc2lnbkluZGV4ID0gWk9ESUFDX1NJR05TLmluZGV4T2Yoc2lnbik7XG4gIGlmIChzaWduSW5kZXggPT09IC0xKSB7XG4gICAgbG9nZ2VyLndhcm4oYFVua25vd24gc2lnbjogJHtzaWdufSwgZmFsbGluZyBiYWNrIHRvIEFyaWVzYCk7XG4gICAgcmV0dXJuIGRlZ3JlZTsgLy8gQXJpZXMgc3RhcnRzIGF0IDAgZGVncmVlc1xuICB9XG4gIHJldHVybiAoc2lnbkluZGV4ICogMzApICsgZGVncmVlO1xufVxuXG4vKipcbiAqIENhbGN1bGF0ZSBwbGFuZXRhcnkgYXNwZWN0cyBmcm9tIHBvc2l0aW9uc1xuICogQHBhcmFtIHBvc2l0aW9ucyBSZWNvcmQgb2YgcGxhbmV0YXJ5IHBvc2l0aW9uc1xuICogQHJldHVybnMgQXJyYXkgb2YgcGxhbmV0YXJ5IGFzcGVjdHNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNhbGN1bGF0ZVBsYW5ldGFyeUFzcGVjdHMocG9zaXRpb25zOiBSZWNvcmQ8c3RyaW5nLCBDZWxlc3RpYWxQb3NpdGlvbj4pOiBQbGFuZXRhcnlBc3BlY3RbXSB7XG4gIGNvbnN0IGFzcGVjdHM6IFBsYW5ldGFyeUFzcGVjdFtdID0gW107XG4gIGNvbnN0IHBsYW5ldHMgPSBPYmplY3Qua2V5cyhwb3NpdGlvbnMpO1xuICBcbiAgLy8gQ2FsY3VsYXRlIGFzcGVjdHMgYmV0d2VlbiBhbGwgcGxhbmV0IHBhaXJzXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgcGxhbmV0cy5sZW5ndGg7IGkrKykge1xuICAgIGZvciAobGV0IGogPSBpICsgMTsgaiA8IHBsYW5ldHMubGVuZ3RoOyBqKyspIHtcbiAgICAgIGNvbnN0IHBsYW5ldDEgPSBwbGFuZXRzW2ldO1xuICAgICAgY29uc3QgcGxhbmV0MiA9IHBsYW5ldHNbal07XG4gICAgICBcbiAgICAgIGlmICghcG9zaXRpb25zW3BsYW5ldDFdIHx8ICFwb3NpdGlvbnNbcGxhbmV0Ml0pIGNvbnRpbnVlO1xuICAgICAgXG4gICAgICAvLyBDb252ZXJ0IGxvd2VyY2FzZSBzaWduIHN0cmluZ3MgdG8gcHJvcGVyIFpvZGlhY1NpZ24gdHlwZSB2YWx1ZXNcbiAgICAgIGNvbnN0IHBvczFTaWduID0gcG9zaXRpb25zW3BsYW5ldDFdLnNpZ247XG4gICAgICBjb25zdCBwb3MyU2lnbiA9IHBvc2l0aW9uc1twbGFuZXQyXS5zaWduO1xuICAgICAgXG4gICAgICAvLyBDYWxjdWxhdGUgdGhlIGFuZ3VsYXIgZGlmZmVyZW5jZSBiZXR3ZWVuIHBsYW5ldHNcbiAgICAgIGNvbnN0IHBvczEgPSBnZXRab2RpYWNQb3NpdGlvbkluRGVncmVlcyhwb3MxU2lnbiBhcyBab2RpYWNTaWduLCBwb3NpdGlvbnNbcGxhbmV0MV0uZGVncmVlIHx8IDApO1xuICAgICAgY29uc3QgcG9zMiA9IGdldFpvZGlhY1Bvc2l0aW9uSW5EZWdyZWVzKHBvczJTaWduIGFzIFpvZGlhY1NpZ24sIHBvc2l0aW9uc1twbGFuZXQyXS5kZWdyZWUgfHwgMCk7XG4gICAgICBcbiAgICAgIGxldCBkaWZmID0gTWF0aC5hYnMocG9zMSAtIHBvczIpO1xuICAgICAgaWYgKGRpZmYgPiAxODApIGRpZmYgPSAzNjAgLSBkaWZmO1xuICAgICAgXG4gICAgICAvLyBDaGVjayBmb3IgYXNwZWN0cyB3aXRoIG9yYnNcbiAgICAgIGNvbnN0IGFzcGVjdCA9IGlkZW50aWZ5QXNwZWN0KGRpZmYpO1xuICAgICAgaWYgKGFzcGVjdCkge1xuICAgICAgICAvLyBDcmVhdGUgYXNwZWN0IHdpdGggcHJvcGVyIHR5cGluZyAtICdwbGFuZXRzJyBhcnJheSBpbnN0ZWFkIG9mICd0eXBlJ1xuICAgICAgICBhc3BlY3RzLnB1c2goe1xuICAgICAgICAgIHBsYW5ldDEsXG4gICAgICAgICAgcGxhbmV0MixcbiAgICAgICAgICBvcmI6IGFzcGVjdC5vcmIsXG4gICAgICAgICAgaW5mbHVlbmNlOiBjYWxjdWxhdGVBc3BlY3RTdHJlbmd0aChhc3BlY3QudHlwZSwgYXNwZWN0Lm9yYiksXG4gICAgICAgICAgcGxhbmV0czogW3BsYW5ldDEsIHBsYW5ldDJdLFxuICAgICAgICAgIGFkZGl0aW9uYWxJbmZvOiB7IGFzcGVjdFR5cGU6IGFzcGVjdC50eXBlIH1cbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIFxuICBsb2dnZXIuZGVidWcoYEZvdW5kICR7YXNwZWN0cy5sZW5ndGh9IGFzcGVjdHNgKTtcbiAgcmV0dXJuIGFzcGVjdHM7XG59XG5cbi8qKlxuICogSWRlbnRpZnkgYXNwZWN0IHR5cGUgZnJvbSBhbmdsZVxuICogQHBhcmFtIGFuZ2xlRGlmZiBBbmd1bGFyIGRpZmZlcmVuY2UgYmV0d2VlbiBwbGFuZXRzXG4gKiBAcmV0dXJucyBBc3BlY3QgdHlwZSBhbmQgb3JiIGlmIGFzcGVjdCBleGlzdHMsIG51bGwgb3RoZXJ3aXNlXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpZGVudGlmeUFzcGVjdChhbmdsZURpZmY6IG51bWJlcik6IHsgdHlwZTogQXNwZWN0VHlwZSwgb3JiOiBudW1iZXIgfSB8IG51bGwge1xuICBjb25zdCBhc3BlY3RzID0gW1xuICAgIHsgdHlwZTogJ2Nvbmp1bmN0aW9uJyBhcyBBc3BlY3RUeXBlLCBhbmdsZTogMCwgbWF4T3JiOiAxMCB9LFxuICAgIHsgdHlwZTogJ29wcG9zaXRpb24nIGFzIEFzcGVjdFR5cGUsIGFuZ2xlOiAxODAsIG1heE9yYjogMTAgfSxcbiAgICB7IHR5cGU6ICd0cmluZScgYXMgQXNwZWN0VHlwZSwgYW5nbGU6IDEyMCwgbWF4T3JiOiA4IH0sXG4gICAgeyB0eXBlOiAnc3F1YXJlJyBhcyBBc3BlY3RUeXBlLCBhbmdsZTogOTAsIG1heE9yYjogOCB9LFxuICAgIHsgdHlwZTogJ3NleHRpbGUnIGFzIEFzcGVjdFR5cGUsIGFuZ2xlOiA2MCwgbWF4T3JiOiA2IH0sXG4gICAgeyB0eXBlOiAncXVpbmN1bngnIGFzIEFzcGVjdFR5cGUsIGFuZ2xlOiAxNTAsIG1heE9yYjogNSB9LFxuICAgIHsgdHlwZTogJ3NlbWlzZXh0aWxlJyBhcyBBc3BlY3RUeXBlLCBhbmdsZTogMzAsIG1heE9yYjogMyB9LFxuICAgIHsgdHlwZTogJ3NlbWlzcXVhcmUnIGFzIEFzcGVjdFR5cGUsIGFuZ2xlOiA0NSwgbWF4T3JiOiAzIH0sXG4gICAgeyB0eXBlOiAnc2VzcXVpc3F1YXJlJyBhcyBBc3BlY3RUeXBlLCBhbmdsZTogMTM1LCBtYXhPcmI6IDMgfVxuICBdO1xuICBcbiAgZm9yIChjb25zdCBhc3BlY3Qgb2YgYXNwZWN0cykge1xuICAgIGNvbnN0IG9yYiA9IE1hdGguYWJzKGFuZ2xlRGlmZiAtIGFzcGVjdC5hbmdsZSk7XG4gICAgaWYgKG9yYiA8PSBhc3BlY3QubWF4T3JiKSB7XG4gICAgICByZXR1cm4geyB0eXBlOiBhc3BlY3QudHlwZSwgb3JiIH07XG4gICAgfVxuICB9XG4gIFxuICByZXR1cm4gbnVsbDtcbn1cblxuLyoqXG4gKiBDYWxjdWxhdGUgYXNwZWN0IHN0cmVuZ3RoIGJhc2VkIG9uIHR5cGUgYW5kIG9yYlxuICogQHBhcmFtIHR5cGUgQXNwZWN0IHR5cGVcbiAqIEBwYXJhbSBvcmIgT3JiIChhbmdsZSBkZXZpYXRpb24gZnJvbSBleGFjdCBhc3BlY3QpXG4gKiBAcmV0dXJucyBTdHJlbmd0aCB2YWx1ZSAoMC0xMClcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNhbGN1bGF0ZUFzcGVjdFN0cmVuZ3RoKHR5cGU6IEFzcGVjdFR5cGUsIG9yYjogbnVtYmVyKTogbnVtYmVyIHtcbiAgY29uc3QgYmFzZVN0cmVuZ3RocyA9IHtcbiAgICAnY29uanVuY3Rpb24nOiAxMCxcbiAgICAnb3Bwb3NpdGlvbic6IDEwLFxuICAgICd0cmluZSc6IDgsXG4gICAgJ3NxdWFyZSc6IDgsXG4gICAgJ3NleHRpbGUnOiA2LFxuICAgICdxdWluY3VueCc6IDQsXG4gICAgJ3NlbWlzZXh0aWxlJzogMixcbiAgICAnc2VtaXNxdWFyZSc6IDIsXG4gICAgJ3Nlc3F1aXNxdWFyZSc6IDIsXG4gICAgJ3F1aW50aWxlJzogMSxcbiAgICAnYmlxdWludGlsZSc6IDFcbiAgfSBhcyBSZWNvcmQ8QXNwZWN0VHlwZSwgbnVtYmVyPjtcbiAgXG4gIC8vIERpbWluaXNoIHN0cmVuZ3RoIGJhc2VkIG9uIG9yYlxuICBjb25zdCBiYXNlU3RyZW5ndGggPSBiYXNlU3RyZW5ndGhzW3R5cGVdIHx8IDA7XG4gIGNvbnN0IG1heE9yYiA9IHR5cGUgPT09ICdjb25qdW5jdGlvbicgfHwgdHlwZSA9PT0gJ29wcG9zaXRpb24nID8gMTAgOiBcbiAgICAgICAgICAgICAgICAgdHlwZSA9PT0gJ3RyaW5lJyB8fCB0eXBlID09PSAnc3F1YXJlJyA/IDggOiBcbiAgICAgICAgICAgICAgICAgdHlwZSA9PT0gJ3NleHRpbGUnID8gNiA6IDU7XG4gIFxuICByZXR1cm4gYmFzZVN0cmVuZ3RoICogKDEgLSBvcmIgLyBtYXhPcmIpO1xufVxuXG4vKipcbiAqIEdldCB0aGUgY3VycmVudCBhc3Ryb2xvZ2ljYWwgc3RhdGVcbiAqIEByZXR1cm5zIEN1cnJlbnQgYXN0cm9sb2dpY2FsIHN0YXRlIHdpdGggcGxhbmV0YXJ5IHBvc2l0aW9ucywgYXNwZWN0cywgZXRjLlxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0Q3VycmVudEFzdHJvbG9naWNhbFN0YXRlKCk6IEFzdHJvbG9naWNhbFN0YXRlIHtcbiAgLy8gVXNlIGNhY2hlIGlmIGF2YWlsYWJsZSBhbmQgcmVjZW50XG4gIGlmIChhc3Ryb2xvZ3lDYWNoZSAmJiAoRGF0ZS5ub3coKSAtIGFzdHJvbG9neUNhY2hlLnRpbWVzdGFtcCA8IENBQ0hFX0RVUkFUSU9OKSkge1xuICAgIGxvZ2dlci5kZWJ1ZyhcIlVzaW5nIGNhY2hlZCBhc3Ryb2xvZ2ljYWwgc3RhdGVcIik7XG4gICAgcmV0dXJuIGFzdHJvbG9neUNhY2hlLmRhdGE7XG4gIH1cbiAgXG4gIGxvZ2dlci5kZWJ1ZyhcIkNhbGN1bGF0aW5nIGZyZXNoIGFzdHJvbG9naWNhbCBzdGF0ZVwiKTtcbiAgXG4gIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG4gIGNvbnN0IHBvc2l0aW9ucyA9IGdldFJlbGlhYmxlUGxhbmV0YXJ5UG9zaXRpb25zKCk7XG4gIGNvbnN0IGx1bmFyUGhhc2UgPSBjYWxjdWxhdGVMdW5hclBoYXNlKCk7XG4gIGNvbnN0IHBoYXNlTmFtZSA9IGdldEx1bmFyUGhhc2VOYW1lKGx1bmFyUGhhc2UpO1xuICBcbiAgLy8gRGV0ZXJtaW5lIGRvbWluYW50IGVsZW1lbnQgYmFzZWQgb24gcG9zaXRpb25zXG4gIGNvbnN0IGVsZW1lbnRzID0gY291bnRFbGVtZW50cyhwb3NpdGlvbnMpO1xuICBjb25zdCBkb21pbmFudEVsZW1lbnQgPSBnZXREb21pbmFudEVsZW1lbnQoZWxlbWVudHMpO1xuICBcbiAgLy8gQ2FsY3VsYXRlIGFzcGVjdHNcbiAgY29uc3QgYXNwZWN0cyA9IGNhbGN1bGF0ZVBsYW5ldGFyeUFzcGVjdHMocG9zaXRpb25zKTtcbiAgXG4gIC8vIERldGVybWluZSBpZiBpdCdzIGRheXRpbWUgKGJldHdlZW4gNiBBTSBhbmQgNiBQTSlcbiAgY29uc3QgaG91cnMgPSBub3cuZ2V0SG91cnMoKTtcbiAgY29uc3QgaXNEYXl0aW1lID0gaG91cnMgPj0gNiAmJiBob3VycyA8IDE4O1xuICBcbiAgLy8gQ2FsY3VsYXRlIGFjdGl2ZSBwbGFuZXRzIChzdW4sIG1vb24gKyBhbnkgaW4gbWFqb3IgYXNwZWN0KVxuICBjb25zdCBhY3RpdmVQbGFuZXRzID0gW1wiU3VuXCIsIFwiTW9vblwiXTtcbiAgYXNwZWN0cy5mb3JFYWNoKGFzcGVjdCA9PiB7XG4gICAgLy8gQ2hlY2sgaW5mbHVlbmNlIHJhdGhlciB0aGFuIHN0cmVuZ3RoXG4gICAgaWYgKGFzcGVjdC5pbmZsdWVuY2UgJiYgYXNwZWN0LmluZmx1ZW5jZSA+IDUpIHtcbiAgICAgIGNvbnN0IHBsYW5ldDEgPSBhc3BlY3QucGxhbmV0MS5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIGFzcGVjdC5wbGFuZXQxLnNsaWNlKDEpO1xuICAgICAgY29uc3QgcGxhbmV0MiA9IGFzcGVjdC5wbGFuZXQyLmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgYXNwZWN0LnBsYW5ldDIuc2xpY2UoMSk7XG4gICAgICBcbiAgICAgIGlmICghYWN0aXZlUGxhbmV0cy5pbmNsdWRlcyhwbGFuZXQxKSkgYWN0aXZlUGxhbmV0cy5wdXNoKHBsYW5ldDEpO1xuICAgICAgaWYgKCFhY3RpdmVQbGFuZXRzLmluY2x1ZGVzKHBsYW5ldDIpKSBhY3RpdmVQbGFuZXRzLnB1c2gocGxhbmV0Mik7XG4gICAgfVxuICB9KTtcbiAgXG4gIC8vIENvbnZlcnQgc3RyaW5nIGVsZW1lbnQgdG8gcHJvcGVyIGNhc2luZyBmb3IgRWxlbWVudCB0eXBlXG4gIGNvbnN0IGRvbWluYW50RWxlbWVudENhcGl0YWxpemVkID0gZG9taW5hbnRFbGVtZW50LmNoYXJBdCgwKS50b1VwcGVyQ2FzZSgpICsgZG9taW5hbnRFbGVtZW50LnNsaWNlKDEpIGFzICdGaXJlJyB8ICdXYXRlcicgfCAnRWFydGgnIHwgJ0Fpcic7XG4gIFxuICBjb25zdCBzdGF0ZTogQXN0cm9sb2dpY2FsU3RhdGUgPSB7XG4gICAgc3VuU2lnbjogdG9ab2RpYWNTaWduKFN0cmluZyhwb3NpdGlvbnMuc3VuLnNpZ24pKSxcbiAgICBtb29uU2lnbjogdG9ab2RpYWNTaWduKFN0cmluZyhwb3NpdGlvbnMubW9vbi5zaWduKSksXG4gICAgbHVuYXJQaGFzZTogcGhhc2VOYW1lIGFzIEx1bmFyUGhhc2UsXG4gICAgYWN0aXZlUGxhbmV0cyxcbiAgICBkb21pbmFudEVsZW1lbnQ6IGRvbWluYW50RWxlbWVudENhcGl0YWxpemVkLFxuICAgIGRvbWluYW50UGxhbmV0czogYWN0aXZlUGxhbmV0cyBcbiAgfTtcbiAgXG4gIC8vIFVwZGF0ZSBjYWNoZVxuICBhc3Ryb2xvZ3lDYWNoZSA9IHtcbiAgICBkYXRhOiBzdGF0ZSxcbiAgICB0aW1lc3RhbXA6IERhdGUubm93KClcbiAgfTtcbiAgXG4gIHJldHVybiBzdGF0ZTtcbn1cblxuLyoqXG4gKiBDb3VudCBlbGVtZW50cyBmcm9tIHBsYW5ldGFyeSBwb3NpdGlvbnNcbiAqIEBwYXJhbSBwb3NpdGlvbnMgUmVjb3JkIG9mIHBsYW5ldGFyeSBwb3NpdGlvbnNcbiAqIEByZXR1cm5zIENvdW50IG9mIGVhY2ggZWxlbWVudFxuICovXG5mdW5jdGlvbiBjb3VudEVsZW1lbnRzKHBvc2l0aW9uczogUmVjb3JkPHN0cmluZywgQ2VsZXN0aWFsUG9zaXRpb24+KTogUmVjb3JkPHN0cmluZywgbnVtYmVyPiB7XG4gIGNvbnN0IGVsZW1lbnRzOiBSZWNvcmQ8c3RyaW5nLCBudW1iZXI+ID0ge1xuICAgIGZpcmU6IDAsXG4gICAgZWFydGg6IDAsXG4gICAgYWlyOiAwLFxuICAgIHdhdGVyOiAwXG4gIH07XG4gIFxuICAvLyBFbGVtZW50IG1hcHBpbmcgZm9yIHNpZ25zXG4gIGNvbnN0IHNpZ25FbGVtZW50czogUmVjb3JkPFpvZGlhY1NpZ24sIGtleW9mIHR5cGVvZiBlbGVtZW50cz4gPSB7XG4gICAgYXJpZXM6ICdGaXJlJyxcbiAgICBsZW86ICdGaXJlJyxcbiAgICBzYWdpdHRhcml1czogJ0ZpcmUnLFxuICAgIHRhdXJ1czogJ0VhcnRoJyxcbiAgICB2aXJnbzogJ0VhcnRoJyxcbiAgICBjYXByaWNvcm46ICdFYXJ0aCcsXG4gICAgZ2VtaW5pOiAnQWlyJyxcbiAgICBsaWJyYTogJ0FpcicsXG4gICAgYXF1YXJpdXM6ICdBaXInLFxuICAgIGNhbmNlcjogJ1dhdGVyJyxcbiAgICBzY29ycGlvOiAnV2F0ZXInLFxuICAgIHBpc2NlczogJ1dhdGVyJ1xuICB9O1xuICBcbiAgLy8gRXh0cmEgd2VpZ2h0IGZvciBjZXJ0YWluIHBsYW5ldHNcbiAgY29uc3QgcGxhbmV0V2VpZ2h0OiBSZWNvcmQ8c3RyaW5nLCBudW1iZXI+ID0ge1xuICAgIHN1bjogMyxcbiAgICBtb29uOiAyLFxuICAgIGFzY2VuZGFudDogMixcbiAgICBtZXJjdXJ5OiAxLjUsXG4gICAgdmVudXM6IDEuNSxcbiAgICBtYXJzOiAxLjUsXG4gICAganVwaXRlcjogMS41LFxuICAgIHNhdHVybjogMS41LFxuICAgIHVyYW51czogMSxcbiAgICBuZXB0dW5lOiAxLFxuICAgIHBsdXRvOiAxLFxuICAgIG5vcnRoTm9kZTogMC41LFxuICAgIHNvdXRoTm9kZTogMC41XG4gIH07XG4gIFxuICAvLyBDb3VudCBlbGVtZW50c1xuICBPYmplY3QuZW50cmllcyhwb3NpdGlvbnMpLmZvckVhY2goKFtwbGFuZXQsIHBvc2l0aW9uXSkgPT4ge1xuICAgIGNvbnN0IGVsZW1lbnQgPSBzaWduRWxlbWVudHNbcG9zaXRpb24uc2lnbiB8fCAnYXJpZXMnXTtcbiAgICBjb25zdCB3ZWlnaHQgPSBwbGFuZXRXZWlnaHRbcGxhbmV0XSB8fCAxO1xuICAgIGVsZW1lbnRzW2VsZW1lbnRdICs9IHdlaWdodDtcbiAgfSk7XG4gIFxuICByZXR1cm4gZWxlbWVudHM7XG59XG5cbi8qKlxuICogR2V0IHRoZSBkb21pbmFudCBlbGVtZW50IGZyb20gZWxlbWVudCBjb3VudHNcbiAqIEBwYXJhbSBlbGVtZW50cyBSZWNvcmQgb2YgZWxlbWVudCBjb3VudHNcbiAqIEByZXR1cm5zIERvbWluYW50IGVsZW1lbnRcbiAqL1xuZnVuY3Rpb24gZ2V0RG9taW5hbnRFbGVtZW50KGVsZW1lbnRzOiBSZWNvcmQ8c3RyaW5nLCBudW1iZXI+KTogc3RyaW5nIHtcbiAgbGV0IG1heEVsZW1lbnQgPSAnYmFsYW5jZWQnO1xuICBsZXQgbWF4Q291bnQgPSAwO1xuICBcbiAgT2JqZWN0LmVudHJpZXMoZWxlbWVudHMpLmZvckVhY2goKFtlbGVtZW50LCBjb3VudF0pID0+IHtcbiAgICBpZiAoY291bnQgPiBtYXhDb3VudCkge1xuICAgICAgbWF4Q291bnQgPSBjb3VudDtcbiAgICAgIG1heEVsZW1lbnQgPSBlbGVtZW50O1xuICAgIH1cbiAgfSk7XG4gIFxuICByZXR1cm4gbWF4RWxlbWVudDtcbn1cblxuLyoqXG4gKiBDYWxjdWxhdGUgZGF5cyBzaW5jZSBhIHNwZWNpZmljIGRhdGVcbiAqIEBwYXJhbSBkYXRlIFJlZmVyZW5jZSBkYXRlXG4gKiBAcmV0dXJucyBOdW1iZXIgb2YgZGF5cyBzaW5jZSB0aGUgcmVmZXJlbmNlIGRhdGVcbiAqL1xuZnVuY3Rpb24gZ2V0RGF5c1NpbmNlRGF0ZShkYXRlOiBEYXRlKTogbnVtYmVyIHtcbiAgY29uc3Qgbm93ID0gbmV3IERhdGUoKTtcbiAgY29uc3QgdGltZURpZmYgPSBub3cuZ2V0VGltZSgpIC0gZGF0ZS5nZXRUaW1lKCk7XG4gIHJldHVybiB0aW1lRGlmZiAvICgxMDAwICogNjAgKiA2MCAqIDI0KTtcbn1cblxuLy8gSGVscGVyIGZ1bmN0aW9uIHRvIGNvbnZlcnQgYW55IHN0cmluZyB0byBhIHZhbGlkIFpvZGlhY1NpZ25cbmZ1bmN0aW9uIHRvWm9kaWFjU2lnbihzaWduOiBzdHJpbmcpOiBab2RpYWNTaWduIHtcbiAgLy8gQ29udmVydCBmaXJzdCBsZXR0ZXIgdG8gdXBwZXJjYXNlIGFuZCByZXN0IHRvIGxvd2VyY2FzZVxuICBjb25zdCBmb3JtYXR0ZWRTaWduID0gc2lnbi5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHNpZ24uc2xpY2UoMSkudG9Mb3dlckNhc2UoKTtcbiAgXG4gIC8vIENoZWNrIGlmIGl0J3MgYSB2YWxpZCBab2RpYWNTaWduXG4gIGlmIChaT0RJQUNfU0lHTlMuaW5jbHVkZXMoZm9ybWF0dGVkU2lnbiBhcyBab2RpYWNTaWduKSkge1xuICAgIHJldHVybiBmb3JtYXR0ZWRTaWduIGFzIFpvZGlhY1NpZ247XG4gIH1cbiAgXG4gIC8vIERlZmF1bHQgdG8gQXJpZXMgaWYgaW52YWxpZFxuICByZXR1cm4gJ2FyaWVzJztcbn0gIl0sInZlcnNpb24iOjN9