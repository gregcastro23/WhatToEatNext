f1bb79631e2004bb7e815bdd6c62923e
"use strict";
/**
 * State Preservation Utility
 * Handles saving and restoring component state across navigation
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.createStatePreservationHook = exports.useStateCleanup = exports.clearExpiredState = exports.clearAllState = exports.getScrollPosition = exports.saveScrollPosition = exports.getComponentState = exports.saveComponentState = exports.getNavigationState = exports.saveNavigationState = void 0;
const STATE_KEYS = {
    MAIN_PAGE_STATE: 'mainPageState',
    NAVIGATION_STATE: 'navigationState',
    COMPONENT_STATES: 'componentStates',
    SCROLL_POSITIONS: 'scrollPositions'
};
// State expiration time (1 hour)
const STATE_EXPIRATION_TIME = 60 * 60 * 1000;
/**
 * Check if stored state is still valid (not expired)
 */
function isStateValid(timestamp) {
    return Date.now() - timestamp < STATE_EXPIRATION_TIME;
}
/**
 * Safely get item from storage with error handling
 */
function safeGetItem(key) {
    try {
        return sessionStorage.getItem(key);
    }
    catch (error) {
        console.warn(`Failed to get item from sessionStorage: ${key}`, error);
        return null;
    }
}
/**
 * Safely set item in storage with error handling
 */
function safeSetItem(key, value) {
    try {
        sessionStorage.setItem(key, value);
        return true;
    }
    catch (error) {
        console.warn(`Failed to set item in sessionStorage: ${key}`, error);
        return false;
    }
}
/**
 * Save navigation state
 */
function saveNavigationState(state) {
    const currentState = getNavigationState();
    const updatedState = {
        ...currentState,
        ...state,
    };
    const stateWithTimestamp = {
        timestamp: Date.now(),
        data: updatedState
    };
    safeSetItem(STATE_KEYS.NAVIGATION_STATE, JSON.stringify(stateWithTimestamp));
}
exports.saveNavigationState = saveNavigationState;
/**
 * Get navigation state
 */
function getNavigationState() {
    const defaultState = {
        activeSection: null,
        navigationHistory: [],
        selectedIngredients: [],
        selectedCuisine: null,
        selectedCookingMethods: [],
        currentRecipe: null,
        selectedIngredientCategory: null,
        selectedIngredient: null,
        selectedCookingMethod: null,
        scrollPosition: 0
    };
    const stored = safeGetItem(STATE_KEYS.NAVIGATION_STATE);
    if (!stored)
        return defaultState;
    try {
        const parsed = JSON.parse(stored);
        if (!isStateValid(parsed.timestamp)) {
            return defaultState;
        }
        return { ...defaultState, ...parsed.data };
    }
    catch (error) {
        console.warn('Failed to parse navigation state:', error);
        return defaultState;
    }
}
exports.getNavigationState = getNavigationState;
/**
 * Save component-specific state
 */
function saveComponentState(componentId, state) {
    const allStates = getComponentStates();
    allStates[componentId] = {
        timestamp: Date.now(),
        data: state
    };
    safeSetItem(STATE_KEYS.COMPONENT_STATES, JSON.stringify(allStates));
}
exports.saveComponentState = saveComponentState;
/**
 * Get component-specific state
 */
function getComponentState(componentId) {
    const allStates = getComponentStates();
    const componentState = allStates[componentId];
    if (!componentState || !isStateValid(componentState.timestamp)) {
        return null;
    }
    return componentState.data;
}
exports.getComponentState = getComponentState;
/**
 * Get all component states
 */
function getComponentStates() {
    const stored = safeGetItem(STATE_KEYS.COMPONENT_STATES);
    if (!stored)
        return {};
    try {
        return JSON.parse(stored);
    }
    catch (error) {
        console.warn('Failed to parse component states:', error);
        return {};
    }
}
/**
 * Save scroll position for a specific section
 */
function saveScrollPosition(sectionId, position) {
    const positions = getScrollPositions();
    positions[sectionId] = {
        timestamp: Date.now(),
        data: position
    };
    safeSetItem(STATE_KEYS.SCROLL_POSITIONS, JSON.stringify(positions));
}
exports.saveScrollPosition = saveScrollPosition;
/**
 * Get scroll position for a specific section
 */
function getScrollPosition(sectionId) {
    const positions = getScrollPositions();
    const position = positions[sectionId];
    if (!position || !isStateValid(position.timestamp)) {
        return 0;
    }
    return position.data;
}
exports.getScrollPosition = getScrollPosition;
/**
 * Get all scroll positions
 */
function getScrollPositions() {
    const stored = safeGetItem(STATE_KEYS.SCROLL_POSITIONS);
    if (!stored)
        return {};
    try {
        return JSON.parse(stored);
    }
    catch (error) {
        console.warn('Failed to parse scroll positions:', error);
        return {};
    }
}
/**
 * Clear all stored state (useful for cleanup)
 */
function clearAllState() {
    Object.values(STATE_KEYS).forEach(key => {
        try {
            sessionStorage.removeItem(key);
        }
        catch (error) {
            console.warn(`Failed to remove item from sessionStorage: ${key}`, error);
        }
    });
}
exports.clearAllState = clearAllState;
/**
 * Clear expired state entries
 */
function clearExpiredState() {
    // Clear expired navigation state
    const navState = safeGetItem(STATE_KEYS.NAVIGATION_STATE);
    if (navState) {
        try {
            const parsed = JSON.parse(navState);
            if (!isStateValid(parsed.timestamp)) {
                sessionStorage.removeItem(STATE_KEYS.NAVIGATION_STATE);
            }
        }
        catch (error) {
            sessionStorage.removeItem(STATE_KEYS.NAVIGATION_STATE);
        }
    }
    // Clear expired component states
    const componentStates = getComponentStates();
    const validStates = {};
    let hasChanges = false;
    Object.entries(componentStates).forEach(([key, state]) => {
        if (isStateValid(state.timestamp)) {
            validStates[key] = state;
        }
        else {
            hasChanges = true;
        }
    });
    if (hasChanges) {
        safeSetItem(STATE_KEYS.COMPONENT_STATES, JSON.stringify(validStates));
    }
    // Clear expired scroll positions
    const scrollPositions = getScrollPositions();
    const validPositions = {};
    hasChanges = false;
    Object.entries(scrollPositions).forEach(([key, position]) => {
        if (isStateValid(position.timestamp)) {
            validPositions[key] = position;
        }
        else {
            hasChanges = true;
        }
    });
    if (hasChanges) {
        safeSetItem(STATE_KEYS.SCROLL_POSITIONS, JSON.stringify(validPositions));
    }
}
exports.clearExpiredState = clearExpiredState;
/**
 * Hook for automatic state cleanup on page load
 */
function useStateCleanup() {
    if (typeof window !== 'undefined') {
        // Clear expired state on page load
        clearExpiredState();
        // Set up periodic cleanup (every 10 minutes)
        const interval = setInterval(clearExpiredState, 10 * 60 * 1000);
        // Cleanup on page unload
        const cleanup = () => {
            clearInterval(interval);
            clearExpiredState();
        };
        window.addEventListener('beforeunload', cleanup);
        // Return cleanup function
        return cleanup;
    }
}
exports.useStateCleanup = useStateCleanup;
/**
 * Create a state preservation hook for components
 */
function createStatePreservationHook(componentId) {
    return {
        saveState: (state) => saveComponentState(componentId, state),
        getState: () => getComponentState(componentId),
        clearState: () => {
            const allStates = getComponentStates();
            delete allStates[componentId];
            safeSetItem(STATE_KEYS.COMPONENT_STATES, JSON.stringify(allStates));
        }
    };
}
exports.createStatePreservationHook = createStatePreservationHook;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy91dGlscy9zdGF0ZVByZXNlcnZhdGlvbi50cyIsIm1hcHBpbmdzIjoiO0FBQUE7OztHQUdHOzs7QUFvQkgsTUFBTSxVQUFVLEdBQUc7SUFDakIsZUFBZSxFQUFFLGVBQWU7SUFDaEMsZ0JBQWdCLEVBQUUsaUJBQWlCO0lBQ25DLGdCQUFnQixFQUFFLGlCQUFpQjtJQUNuQyxnQkFBZ0IsRUFBRSxpQkFBaUI7Q0FDM0IsQ0FBQztBQUVYLGlDQUFpQztBQUNqQyxNQUFNLHFCQUFxQixHQUFHLEVBQUUsR0FBRyxFQUFFLEdBQUcsSUFBSSxDQUFDO0FBRTdDOztHQUVHO0FBQ0gsU0FBUyxZQUFZLENBQUMsU0FBaUI7SUFDckMsT0FBTyxJQUFJLENBQUMsR0FBRyxFQUFFLEdBQUcsU0FBUyxHQUFHLHFCQUFxQixDQUFDO0FBQ3hELENBQUM7QUFFRDs7R0FFRztBQUNILFNBQVMsV0FBVyxDQUFDLEdBQVc7SUFDOUIsSUFBSTtRQUNGLE9BQU8sY0FBYyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQztLQUNwQztJQUFDLE9BQU8sS0FBSyxFQUFFO1FBQ2QsT0FBTyxDQUFDLElBQUksQ0FBQywyQ0FBMkMsR0FBRyxFQUFFLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDdEUsT0FBTyxJQUFJLENBQUM7S0FDYjtBQUNILENBQUM7QUFFRDs7R0FFRztBQUNILFNBQVMsV0FBVyxDQUFDLEdBQVcsRUFBRSxLQUFhO0lBQzdDLElBQUk7UUFDRixjQUFjLENBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUNuQyxPQUFPLElBQUksQ0FBQztLQUNiO0lBQUMsT0FBTyxLQUFLLEVBQUU7UUFDZCxPQUFPLENBQUMsSUFBSSxDQUFDLHlDQUF5QyxHQUFHLEVBQUUsRUFBRSxLQUFLLENBQUMsQ0FBQztRQUNwRSxPQUFPLEtBQUssQ0FBQztLQUNkO0FBQ0gsQ0FBQztBQUVEOztHQUVHO0FBQ0gsU0FBZ0IsbUJBQW1CLENBQUMsS0FBK0I7SUFDakUsTUFBTSxZQUFZLEdBQUcsa0JBQWtCLEVBQUUsQ0FBQztJQUMxQyxNQUFNLFlBQVksR0FBb0I7UUFDcEMsR0FBRyxZQUFZO1FBQ2YsR0FBRyxLQUFLO0tBQ1QsQ0FBQztJQUVGLE1BQU0sa0JBQWtCLEdBQW1CO1FBQ3pDLFNBQVMsRUFBRSxJQUFJLENBQUMsR0FBRyxFQUFFO1FBQ3JCLElBQUksRUFBRSxZQUFZO0tBQ25CLENBQUM7SUFFRixXQUFXLENBQUMsVUFBVSxDQUFDLGdCQUFnQixFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsa0JBQWtCLENBQUMsQ0FBQyxDQUFDO0FBQy9FLENBQUM7QUFiRCxrREFhQztBQUVEOztHQUVHO0FBQ0gsU0FBZ0Isa0JBQWtCO0lBQ2hDLE1BQU0sWUFBWSxHQUFvQjtRQUNwQyxhQUFhLEVBQUUsSUFBSTtRQUNuQixpQkFBaUIsRUFBRSxFQUFFO1FBQ3JCLG1CQUFtQixFQUFFLEVBQUU7UUFDdkIsZUFBZSxFQUFFLElBQUk7UUFDckIsc0JBQXNCLEVBQUUsRUFBRTtRQUMxQixhQUFhLEVBQUUsSUFBSTtRQUNuQiwwQkFBMEIsRUFBRSxJQUFJO1FBQ2hDLGtCQUFrQixFQUFFLElBQUk7UUFDeEIscUJBQXFCLEVBQUUsSUFBSTtRQUMzQixjQUFjLEVBQUUsQ0FBQztLQUNsQixDQUFDO0lBRUYsTUFBTSxNQUFNLEdBQUcsV0FBVyxDQUFDLFVBQVUsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO0lBQ3hELElBQUksQ0FBQyxNQUFNO1FBQUUsT0FBTyxZQUFZLENBQUM7SUFFakMsSUFBSTtRQUNGLE1BQU0sTUFBTSxHQUFtQixJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ2xELElBQUksQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxFQUFFO1lBQ25DLE9BQU8sWUFBWSxDQUFDO1NBQ3JCO1FBQ0QsT0FBTyxFQUFFLEdBQUcsWUFBWSxFQUFFLEdBQUcsTUFBTSxDQUFDLElBQUksRUFBRSxDQUFDO0tBQzVDO0lBQUMsT0FBTyxLQUFLLEVBQUU7UUFDZCxPQUFPLENBQUMsSUFBSSxDQUFDLG1DQUFtQyxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQ3pELE9BQU8sWUFBWSxDQUFDO0tBQ3JCO0FBQ0gsQ0FBQztBQTNCRCxnREEyQkM7QUFFRDs7R0FFRztBQUNILFNBQWdCLGtCQUFrQixDQUFDLFdBQW1CLEVBQUUsS0FBVTtJQUNoRSxNQUFNLFNBQVMsR0FBRyxrQkFBa0IsRUFBRSxDQUFDO0lBQ3ZDLFNBQVMsQ0FBQyxXQUFXLENBQUMsR0FBRztRQUN2QixTQUFTLEVBQUUsSUFBSSxDQUFDLEdBQUcsRUFBRTtRQUNyQixJQUFJLEVBQUUsS0FBSztLQUNaLENBQUM7SUFFRixXQUFXLENBQUMsVUFBVSxDQUFDLGdCQUFnQixFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQztBQUN0RSxDQUFDO0FBUkQsZ0RBUUM7QUFFRDs7R0FFRztBQUNILFNBQWdCLGlCQUFpQixDQUFDLFdBQW1CO0lBQ25ELE1BQU0sU0FBUyxHQUFHLGtCQUFrQixFQUFFLENBQUM7SUFDdkMsTUFBTSxjQUFjLEdBQUcsU0FBUyxDQUFDLFdBQVcsQ0FBQyxDQUFDO0lBRTlDLElBQUksQ0FBQyxjQUFjLElBQUksQ0FBQyxZQUFZLENBQUMsY0FBYyxDQUFDLFNBQVMsQ0FBQyxFQUFFO1FBQzlELE9BQU8sSUFBSSxDQUFDO0tBQ2I7SUFFRCxPQUFPLGNBQWMsQ0FBQyxJQUFJLENBQUM7QUFDN0IsQ0FBQztBQVRELDhDQVNDO0FBRUQ7O0dBRUc7QUFDSCxTQUFTLGtCQUFrQjtJQUN6QixNQUFNLE1BQU0sR0FBRyxXQUFXLENBQUMsVUFBVSxDQUFDLGdCQUFnQixDQUFDLENBQUM7SUFDeEQsSUFBSSxDQUFDLE1BQU07UUFBRSxPQUFPLEVBQUUsQ0FBQztJQUV2QixJQUFJO1FBQ0YsT0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLE1BQU0sQ0FBQyxDQUFDO0tBQzNCO0lBQUMsT0FBTyxLQUFLLEVBQUU7UUFDZCxPQUFPLENBQUMsSUFBSSxDQUFDLG1DQUFtQyxFQUFFLEtBQUssQ0FBQyxDQUFDO1FBQ3pELE9BQU8sRUFBRSxDQUFDO0tBQ1g7QUFDSCxDQUFDO0FBRUQ7O0dBRUc7QUFDSCxTQUFnQixrQkFBa0IsQ0FBQyxTQUFpQixFQUFFLFFBQWdCO0lBQ3BFLE1BQU0sU0FBUyxHQUFHLGtCQUFrQixFQUFFLENBQUM7SUFDdkMsU0FBUyxDQUFDLFNBQVMsQ0FBQyxHQUFHO1FBQ3JCLFNBQVMsRUFBRSxJQUFJLENBQUMsR0FBRyxFQUFFO1FBQ3JCLElBQUksRUFBRSxRQUFRO0tBQ2YsQ0FBQztJQUVGLFdBQVcsQ0FBQyxVQUFVLENBQUMsZ0JBQWdCLEVBQUUsSUFBSSxDQUFDLFNBQVMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDO0FBQ3RFLENBQUM7QUFSRCxnREFRQztBQUVEOztHQUVHO0FBQ0gsU0FBZ0IsaUJBQWlCLENBQUMsU0FBaUI7SUFDakQsTUFBTSxTQUFTLEdBQUcsa0JBQWtCLEVBQUUsQ0FBQztJQUN2QyxNQUFNLFFBQVEsR0FBRyxTQUFTLENBQUMsU0FBUyxDQUFDLENBQUM7SUFFdEMsSUFBSSxDQUFDLFFBQVEsSUFBSSxDQUFDLFlBQVksQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLEVBQUU7UUFDbEQsT0FBTyxDQUFDLENBQUM7S0FDVjtJQUVELE9BQU8sUUFBUSxDQUFDLElBQUksQ0FBQztBQUN2QixDQUFDO0FBVEQsOENBU0M7QUFFRDs7R0FFRztBQUNILFNBQVMsa0JBQWtCO0lBQ3pCLE1BQU0sTUFBTSxHQUFHLFdBQVcsQ0FBQyxVQUFVLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztJQUN4RCxJQUFJLENBQUMsTUFBTTtRQUFFLE9BQU8sRUFBRSxDQUFDO0lBRXZCLElBQUk7UUFDRixPQUFPLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLENBQUM7S0FDM0I7SUFBQyxPQUFPLEtBQUssRUFBRTtRQUNkLE9BQU8sQ0FBQyxJQUFJLENBQUMsbUNBQW1DLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDekQsT0FBTyxFQUFFLENBQUM7S0FDWDtBQUNILENBQUM7QUFFRDs7R0FFRztBQUNILFNBQWdCLGFBQWE7SUFDM0IsTUFBTSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLEVBQUU7UUFDdEMsSUFBSTtZQUNGLGNBQWMsQ0FBQyxVQUFVLENBQUMsR0FBRyxDQUFDLENBQUM7U0FDaEM7UUFBQyxPQUFPLEtBQUssRUFBRTtZQUNkLE9BQU8sQ0FBQyxJQUFJLENBQUMsOENBQThDLEdBQUcsRUFBRSxFQUFFLEtBQUssQ0FBQyxDQUFDO1NBQzFFO0lBQ0gsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDO0FBUkQsc0NBUUM7QUFFRDs7R0FFRztBQUNILFNBQWdCLGlCQUFpQjtJQUMvQixpQ0FBaUM7SUFDakMsTUFBTSxRQUFRLEdBQUcsV0FBVyxDQUFDLFVBQVUsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO0lBQzFELElBQUksUUFBUSxFQUFFO1FBQ1osSUFBSTtZQUNGLE1BQU0sTUFBTSxHQUFtQixJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBQ3BELElBQUksQ0FBQyxZQUFZLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxFQUFFO2dCQUNuQyxjQUFjLENBQUMsVUFBVSxDQUFDLFVBQVUsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO2FBQ3hEO1NBQ0Y7UUFBQyxPQUFPLEtBQUssRUFBRTtZQUNkLGNBQWMsQ0FBQyxVQUFVLENBQUMsVUFBVSxDQUFDLGdCQUFnQixDQUFDLENBQUM7U0FDeEQ7S0FDRjtJQUVELGlDQUFpQztJQUNqQyxNQUFNLGVBQWUsR0FBRyxrQkFBa0IsRUFBRSxDQUFDO0lBQzdDLE1BQU0sV0FBVyxHQUFtQyxFQUFFLENBQUM7SUFDdkQsSUFBSSxVQUFVLEdBQUcsS0FBSyxDQUFDO0lBRXZCLE1BQU0sQ0FBQyxPQUFPLENBQUMsZUFBZSxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxHQUFHLEVBQUUsS0FBSyxDQUFDLEVBQUUsRUFBRTtRQUN2RCxJQUFJLFlBQVksQ0FBQyxLQUFLLENBQUMsU0FBUyxDQUFDLEVBQUU7WUFDakMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxHQUFHLEtBQUssQ0FBQztTQUMxQjthQUFNO1lBQ0wsVUFBVSxHQUFHLElBQUksQ0FBQztTQUNuQjtJQUNILENBQUMsQ0FBQyxDQUFDO0lBRUgsSUFBSSxVQUFVLEVBQUU7UUFDZCxXQUFXLENBQUMsVUFBVSxDQUFDLGdCQUFnQixFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQztLQUN2RTtJQUVELGlDQUFpQztJQUNqQyxNQUFNLGVBQWUsR0FBRyxrQkFBa0IsRUFBRSxDQUFDO0lBQzdDLE1BQU0sY0FBYyxHQUFtQyxFQUFFLENBQUM7SUFDMUQsVUFBVSxHQUFHLEtBQUssQ0FBQztJQUVuQixNQUFNLENBQUMsT0FBTyxDQUFDLGVBQWUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsR0FBRyxFQUFFLFFBQVEsQ0FBQyxFQUFFLEVBQUU7UUFDMUQsSUFBSSxZQUFZLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxFQUFFO1lBQ3BDLGNBQWMsQ0FBQyxHQUFHLENBQUMsR0FBRyxRQUFRLENBQUM7U0FDaEM7YUFBTTtZQUNMLFVBQVUsR0FBRyxJQUFJLENBQUM7U0FDbkI7SUFDSCxDQUFDLENBQUMsQ0FBQztJQUVILElBQUksVUFBVSxFQUFFO1FBQ2QsV0FBVyxDQUFDLFVBQVUsQ0FBQyxnQkFBZ0IsRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLGNBQWMsQ0FBQyxDQUFDLENBQUM7S0FDMUU7QUFDSCxDQUFDO0FBL0NELDhDQStDQztBQUVEOztHQUVHO0FBQ0gsU0FBZ0IsZUFBZTtJQUM3QixJQUFJLE9BQU8sTUFBTSxLQUFLLFdBQVcsRUFBRTtRQUNqQyxtQ0FBbUM7UUFDbkMsaUJBQWlCLEVBQUUsQ0FBQztRQUVwQiw2Q0FBNkM7UUFDN0MsTUFBTSxRQUFRLEdBQUcsV0FBVyxDQUFDLGlCQUFpQixFQUFFLEVBQUUsR0FBRyxFQUFFLEdBQUcsSUFBSSxDQUFDLENBQUM7UUFFaEUseUJBQXlCO1FBQ3pCLE1BQU0sT0FBTyxHQUFHLEdBQUcsRUFBRTtZQUNuQixhQUFhLENBQUMsUUFBUSxDQUFDLENBQUM7WUFDeEIsaUJBQWlCLEVBQUUsQ0FBQztRQUN0QixDQUFDLENBQUM7UUFFRixNQUFNLENBQUMsZ0JBQWdCLENBQUMsY0FBYyxFQUFFLE9BQU8sQ0FBQyxDQUFDO1FBRWpELDBCQUEwQjtRQUMxQixPQUFPLE9BQU8sQ0FBQztLQUNoQjtBQUNILENBQUM7QUFuQkQsMENBbUJDO0FBRUQ7O0dBRUc7QUFDSCxTQUFnQiwyQkFBMkIsQ0FBQyxXQUFtQjtJQUM3RCxPQUFPO1FBQ0wsU0FBUyxFQUFFLENBQUMsS0FBVSxFQUFFLEVBQUUsQ0FBQyxrQkFBa0IsQ0FBQyxXQUFXLEVBQUUsS0FBSyxDQUFDO1FBQ2pFLFFBQVEsRUFBRSxHQUFHLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxXQUFXLENBQUM7UUFDOUMsVUFBVSxFQUFFLEdBQUcsRUFBRTtZQUNmLE1BQU0sU0FBUyxHQUFHLGtCQUFrQixFQUFFLENBQUM7WUFDdkMsT0FBTyxTQUFTLENBQUMsV0FBVyxDQUFDLENBQUM7WUFDOUIsV0FBVyxDQUFDLFVBQVUsQ0FBQyxnQkFBZ0IsRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUM7UUFDdEUsQ0FBQztLQUNGLENBQUM7QUFDSixDQUFDO0FBVkQsa0VBVUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy91dGlscy9zdGF0ZVByZXNlcnZhdGlvbi50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFN0YXRlIFByZXNlcnZhdGlvbiBVdGlsaXR5XG4gKiBIYW5kbGVzIHNhdmluZyBhbmQgcmVzdG9yaW5nIGNvbXBvbmVudCBzdGF0ZSBhY3Jvc3MgbmF2aWdhdGlvblxuICovXG5cbmV4cG9ydCBpbnRlcmZhY2UgQ29tcG9uZW50U3RhdGUge1xuICB0aW1lc3RhbXA6IG51bWJlcjtcbiAgZGF0YTogYW55O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIE5hdmlnYXRpb25TdGF0ZSB7XG4gIGFjdGl2ZVNlY3Rpb246IHN0cmluZyB8IG51bGw7XG4gIG5hdmlnYXRpb25IaXN0b3J5OiBzdHJpbmdbXTtcbiAgc2VsZWN0ZWRJbmdyZWRpZW50czogc3RyaW5nW107XG4gIHNlbGVjdGVkQ3Vpc2luZTogc3RyaW5nIHwgbnVsbDtcbiAgc2VsZWN0ZWRDb29raW5nTWV0aG9kczogc3RyaW5nW107XG4gIGN1cnJlbnRSZWNpcGU6IGFueSB8IG51bGw7XG4gIHNlbGVjdGVkSW5ncmVkaWVudENhdGVnb3J5OiBzdHJpbmcgfCBudWxsO1xuICBzZWxlY3RlZEluZ3JlZGllbnQ6IHN0cmluZyB8IG51bGw7XG4gIHNlbGVjdGVkQ29va2luZ01ldGhvZDogYW55IHwgbnVsbDtcbiAgc2Nyb2xsUG9zaXRpb246IG51bWJlcjtcbn1cblxuY29uc3QgU1RBVEVfS0VZUyA9IHtcbiAgTUFJTl9QQUdFX1NUQVRFOiAnbWFpblBhZ2VTdGF0ZScsXG4gIE5BVklHQVRJT05fU1RBVEU6ICduYXZpZ2F0aW9uU3RhdGUnLFxuICBDT01QT05FTlRfU1RBVEVTOiAnY29tcG9uZW50U3RhdGVzJyxcbiAgU0NST0xMX1BPU0lUSU9OUzogJ3Njcm9sbFBvc2l0aW9ucydcbn0gYXMgY29uc3Q7XG5cbi8vIFN0YXRlIGV4cGlyYXRpb24gdGltZSAoMSBob3VyKVxuY29uc3QgU1RBVEVfRVhQSVJBVElPTl9USU1FID0gNjAgKiA2MCAqIDEwMDA7XG5cbi8qKlxuICogQ2hlY2sgaWYgc3RvcmVkIHN0YXRlIGlzIHN0aWxsIHZhbGlkIChub3QgZXhwaXJlZClcbiAqL1xuZnVuY3Rpb24gaXNTdGF0ZVZhbGlkKHRpbWVzdGFtcDogbnVtYmVyKTogYm9vbGVhbiB7XG4gIHJldHVybiBEYXRlLm5vdygpIC0gdGltZXN0YW1wIDwgU1RBVEVfRVhQSVJBVElPTl9USU1FO1xufVxuXG4vKipcbiAqIFNhZmVseSBnZXQgaXRlbSBmcm9tIHN0b3JhZ2Ugd2l0aCBlcnJvciBoYW5kbGluZ1xuICovXG5mdW5jdGlvbiBzYWZlR2V0SXRlbShrZXk6IHN0cmluZyk6IHN0cmluZyB8IG51bGwge1xuICB0cnkge1xuICAgIHJldHVybiBzZXNzaW9uU3RvcmFnZS5nZXRJdGVtKGtleSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS53YXJuKGBGYWlsZWQgdG8gZ2V0IGl0ZW0gZnJvbSBzZXNzaW9uU3RvcmFnZTogJHtrZXl9YCwgZXJyb3IpO1xuICAgIHJldHVybiBudWxsO1xuICB9XG59XG5cbi8qKlxuICogU2FmZWx5IHNldCBpdGVtIGluIHN0b3JhZ2Ugd2l0aCBlcnJvciBoYW5kbGluZ1xuICovXG5mdW5jdGlvbiBzYWZlU2V0SXRlbShrZXk6IHN0cmluZywgdmFsdWU6IHN0cmluZyk6IGJvb2xlYW4ge1xuICB0cnkge1xuICAgIHNlc3Npb25TdG9yYWdlLnNldEl0ZW0oa2V5LCB2YWx1ZSk7XG4gICAgcmV0dXJuIHRydWU7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS53YXJuKGBGYWlsZWQgdG8gc2V0IGl0ZW0gaW4gc2Vzc2lvblN0b3JhZ2U6ICR7a2V5fWAsIGVycm9yKTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbn1cblxuLyoqXG4gKiBTYXZlIG5hdmlnYXRpb24gc3RhdGVcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNhdmVOYXZpZ2F0aW9uU3RhdGUoc3RhdGU6IFBhcnRpYWw8TmF2aWdhdGlvblN0YXRlPik6IHZvaWQge1xuICBjb25zdCBjdXJyZW50U3RhdGUgPSBnZXROYXZpZ2F0aW9uU3RhdGUoKTtcbiAgY29uc3QgdXBkYXRlZFN0YXRlOiBOYXZpZ2F0aW9uU3RhdGUgPSB7XG4gICAgLi4uY3VycmVudFN0YXRlLFxuICAgIC4uLnN0YXRlLFxuICB9O1xuXG4gIGNvbnN0IHN0YXRlV2l0aFRpbWVzdGFtcDogQ29tcG9uZW50U3RhdGUgPSB7XG4gICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLFxuICAgIGRhdGE6IHVwZGF0ZWRTdGF0ZVxuICB9O1xuXG4gIHNhZmVTZXRJdGVtKFNUQVRFX0tFWVMuTkFWSUdBVElPTl9TVEFURSwgSlNPTi5zdHJpbmdpZnkoc3RhdGVXaXRoVGltZXN0YW1wKSk7XG59XG5cbi8qKlxuICogR2V0IG5hdmlnYXRpb24gc3RhdGVcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldE5hdmlnYXRpb25TdGF0ZSgpOiBOYXZpZ2F0aW9uU3RhdGUge1xuICBjb25zdCBkZWZhdWx0U3RhdGU6IE5hdmlnYXRpb25TdGF0ZSA9IHtcbiAgICBhY3RpdmVTZWN0aW9uOiBudWxsLFxuICAgIG5hdmlnYXRpb25IaXN0b3J5OiBbXSxcbiAgICBzZWxlY3RlZEluZ3JlZGllbnRzOiBbXSxcbiAgICBzZWxlY3RlZEN1aXNpbmU6IG51bGwsXG4gICAgc2VsZWN0ZWRDb29raW5nTWV0aG9kczogW10sXG4gICAgY3VycmVudFJlY2lwZTogbnVsbCxcbiAgICBzZWxlY3RlZEluZ3JlZGllbnRDYXRlZ29yeTogbnVsbCxcbiAgICBzZWxlY3RlZEluZ3JlZGllbnQ6IG51bGwsXG4gICAgc2VsZWN0ZWRDb29raW5nTWV0aG9kOiBudWxsLFxuICAgIHNjcm9sbFBvc2l0aW9uOiAwXG4gIH07XG5cbiAgY29uc3Qgc3RvcmVkID0gc2FmZUdldEl0ZW0oU1RBVEVfS0VZUy5OQVZJR0FUSU9OX1NUQVRFKTtcbiAgaWYgKCFzdG9yZWQpIHJldHVybiBkZWZhdWx0U3RhdGU7XG5cbiAgdHJ5IHtcbiAgICBjb25zdCBwYXJzZWQ6IENvbXBvbmVudFN0YXRlID0gSlNPTi5wYXJzZShzdG9yZWQpO1xuICAgIGlmICghaXNTdGF0ZVZhbGlkKHBhcnNlZC50aW1lc3RhbXApKSB7XG4gICAgICByZXR1cm4gZGVmYXVsdFN0YXRlO1xuICAgIH1cbiAgICByZXR1cm4geyAuLi5kZWZhdWx0U3RhdGUsIC4uLnBhcnNlZC5kYXRhIH07XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS53YXJuKCdGYWlsZWQgdG8gcGFyc2UgbmF2aWdhdGlvbiBzdGF0ZTonLCBlcnJvcik7XG4gICAgcmV0dXJuIGRlZmF1bHRTdGF0ZTtcbiAgfVxufVxuXG4vKipcbiAqIFNhdmUgY29tcG9uZW50LXNwZWNpZmljIHN0YXRlXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzYXZlQ29tcG9uZW50U3RhdGUoY29tcG9uZW50SWQ6IHN0cmluZywgc3RhdGU6IGFueSk6IHZvaWQge1xuICBjb25zdCBhbGxTdGF0ZXMgPSBnZXRDb21wb25lbnRTdGF0ZXMoKTtcbiAgYWxsU3RhdGVzW2NvbXBvbmVudElkXSA9IHtcbiAgICB0aW1lc3RhbXA6IERhdGUubm93KCksXG4gICAgZGF0YTogc3RhdGVcbiAgfTtcblxuICBzYWZlU2V0SXRlbShTVEFURV9LRVlTLkNPTVBPTkVOVF9TVEFURVMsIEpTT04uc3RyaW5naWZ5KGFsbFN0YXRlcykpO1xufVxuXG4vKipcbiAqIEdldCBjb21wb25lbnQtc3BlY2lmaWMgc3RhdGVcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldENvbXBvbmVudFN0YXRlKGNvbXBvbmVudElkOiBzdHJpbmcpOiBhbnkge1xuICBjb25zdCBhbGxTdGF0ZXMgPSBnZXRDb21wb25lbnRTdGF0ZXMoKTtcbiAgY29uc3QgY29tcG9uZW50U3RhdGUgPSBhbGxTdGF0ZXNbY29tcG9uZW50SWRdO1xuXG4gIGlmICghY29tcG9uZW50U3RhdGUgfHwgIWlzU3RhdGVWYWxpZChjb21wb25lbnRTdGF0ZS50aW1lc3RhbXApKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICByZXR1cm4gY29tcG9uZW50U3RhdGUuZGF0YTtcbn1cblxuLyoqXG4gKiBHZXQgYWxsIGNvbXBvbmVudCBzdGF0ZXNcbiAqL1xuZnVuY3Rpb24gZ2V0Q29tcG9uZW50U3RhdGVzKCk6IFJlY29yZDxzdHJpbmcsIENvbXBvbmVudFN0YXRlPiB7XG4gIGNvbnN0IHN0b3JlZCA9IHNhZmVHZXRJdGVtKFNUQVRFX0tFWVMuQ09NUE9ORU5UX1NUQVRFUyk7XG4gIGlmICghc3RvcmVkKSByZXR1cm4ge307XG5cbiAgdHJ5IHtcbiAgICByZXR1cm4gSlNPTi5wYXJzZShzdG9yZWQpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUud2FybignRmFpbGVkIHRvIHBhcnNlIGNvbXBvbmVudCBzdGF0ZXM6JywgZXJyb3IpO1xuICAgIHJldHVybiB7fTtcbiAgfVxufVxuXG4vKipcbiAqIFNhdmUgc2Nyb2xsIHBvc2l0aW9uIGZvciBhIHNwZWNpZmljIHNlY3Rpb25cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNhdmVTY3JvbGxQb3NpdGlvbihzZWN0aW9uSWQ6IHN0cmluZywgcG9zaXRpb246IG51bWJlcik6IHZvaWQge1xuICBjb25zdCBwb3NpdGlvbnMgPSBnZXRTY3JvbGxQb3NpdGlvbnMoKTtcbiAgcG9zaXRpb25zW3NlY3Rpb25JZF0gPSB7XG4gICAgdGltZXN0YW1wOiBEYXRlLm5vdygpLFxuICAgIGRhdGE6IHBvc2l0aW9uXG4gIH07XG5cbiAgc2FmZVNldEl0ZW0oU1RBVEVfS0VZUy5TQ1JPTExfUE9TSVRJT05TLCBKU09OLnN0cmluZ2lmeShwb3NpdGlvbnMpKTtcbn1cblxuLyoqXG4gKiBHZXQgc2Nyb2xsIHBvc2l0aW9uIGZvciBhIHNwZWNpZmljIHNlY3Rpb25cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdldFNjcm9sbFBvc2l0aW9uKHNlY3Rpb25JZDogc3RyaW5nKTogbnVtYmVyIHtcbiAgY29uc3QgcG9zaXRpb25zID0gZ2V0U2Nyb2xsUG9zaXRpb25zKCk7XG4gIGNvbnN0IHBvc2l0aW9uID0gcG9zaXRpb25zW3NlY3Rpb25JZF07XG5cbiAgaWYgKCFwb3NpdGlvbiB8fCAhaXNTdGF0ZVZhbGlkKHBvc2l0aW9uLnRpbWVzdGFtcCkpIHtcbiAgICByZXR1cm4gMDtcbiAgfVxuXG4gIHJldHVybiBwb3NpdGlvbi5kYXRhO1xufVxuXG4vKipcbiAqIEdldCBhbGwgc2Nyb2xsIHBvc2l0aW9uc1xuICovXG5mdW5jdGlvbiBnZXRTY3JvbGxQb3NpdGlvbnMoKTogUmVjb3JkPHN0cmluZywgQ29tcG9uZW50U3RhdGU+IHtcbiAgY29uc3Qgc3RvcmVkID0gc2FmZUdldEl0ZW0oU1RBVEVfS0VZUy5TQ1JPTExfUE9TSVRJT05TKTtcbiAgaWYgKCFzdG9yZWQpIHJldHVybiB7fTtcblxuICB0cnkge1xuICAgIHJldHVybiBKU09OLnBhcnNlKHN0b3JlZCk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS53YXJuKCdGYWlsZWQgdG8gcGFyc2Ugc2Nyb2xsIHBvc2l0aW9uczonLCBlcnJvcik7XG4gICAgcmV0dXJuIHt9O1xuICB9XG59XG5cbi8qKlxuICogQ2xlYXIgYWxsIHN0b3JlZCBzdGF0ZSAodXNlZnVsIGZvciBjbGVhbnVwKVxuICovXG5leHBvcnQgZnVuY3Rpb24gY2xlYXJBbGxTdGF0ZSgpOiB2b2lkIHtcbiAgT2JqZWN0LnZhbHVlcyhTVEFURV9LRVlTKS5mb3JFYWNoKGtleSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIHNlc3Npb25TdG9yYWdlLnJlbW92ZUl0ZW0oa2V5KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS53YXJuKGBGYWlsZWQgdG8gcmVtb3ZlIGl0ZW0gZnJvbSBzZXNzaW9uU3RvcmFnZTogJHtrZXl9YCwgZXJyb3IpO1xuICAgIH1cbiAgfSk7XG59XG5cbi8qKlxuICogQ2xlYXIgZXhwaXJlZCBzdGF0ZSBlbnRyaWVzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjbGVhckV4cGlyZWRTdGF0ZSgpOiB2b2lkIHtcbiAgLy8gQ2xlYXIgZXhwaXJlZCBuYXZpZ2F0aW9uIHN0YXRlXG4gIGNvbnN0IG5hdlN0YXRlID0gc2FmZUdldEl0ZW0oU1RBVEVfS0VZUy5OQVZJR0FUSU9OX1NUQVRFKTtcbiAgaWYgKG5hdlN0YXRlKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHBhcnNlZDogQ29tcG9uZW50U3RhdGUgPSBKU09OLnBhcnNlKG5hdlN0YXRlKTtcbiAgICAgIGlmICghaXNTdGF0ZVZhbGlkKHBhcnNlZC50aW1lc3RhbXApKSB7XG4gICAgICAgIHNlc3Npb25TdG9yYWdlLnJlbW92ZUl0ZW0oU1RBVEVfS0VZUy5OQVZJR0FUSU9OX1NUQVRFKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgc2Vzc2lvblN0b3JhZ2UucmVtb3ZlSXRlbShTVEFURV9LRVlTLk5BVklHQVRJT05fU1RBVEUpO1xuICAgIH1cbiAgfVxuXG4gIC8vIENsZWFyIGV4cGlyZWQgY29tcG9uZW50IHN0YXRlc1xuICBjb25zdCBjb21wb25lbnRTdGF0ZXMgPSBnZXRDb21wb25lbnRTdGF0ZXMoKTtcbiAgY29uc3QgdmFsaWRTdGF0ZXM6IFJlY29yZDxzdHJpbmcsIENvbXBvbmVudFN0YXRlPiA9IHt9O1xuICBsZXQgaGFzQ2hhbmdlcyA9IGZhbHNlO1xuXG4gIE9iamVjdC5lbnRyaWVzKGNvbXBvbmVudFN0YXRlcykuZm9yRWFjaCgoW2tleSwgc3RhdGVdKSA9PiB7XG4gICAgaWYgKGlzU3RhdGVWYWxpZChzdGF0ZS50aW1lc3RhbXApKSB7XG4gICAgICB2YWxpZFN0YXRlc1trZXldID0gc3RhdGU7XG4gICAgfSBlbHNlIHtcbiAgICAgIGhhc0NoYW5nZXMgPSB0cnVlO1xuICAgIH1cbiAgfSk7XG5cbiAgaWYgKGhhc0NoYW5nZXMpIHtcbiAgICBzYWZlU2V0SXRlbShTVEFURV9LRVlTLkNPTVBPTkVOVF9TVEFURVMsIEpTT04uc3RyaW5naWZ5KHZhbGlkU3RhdGVzKSk7XG4gIH1cblxuICAvLyBDbGVhciBleHBpcmVkIHNjcm9sbCBwb3NpdGlvbnNcbiAgY29uc3Qgc2Nyb2xsUG9zaXRpb25zID0gZ2V0U2Nyb2xsUG9zaXRpb25zKCk7XG4gIGNvbnN0IHZhbGlkUG9zaXRpb25zOiBSZWNvcmQ8c3RyaW5nLCBDb21wb25lbnRTdGF0ZT4gPSB7fTtcbiAgaGFzQ2hhbmdlcyA9IGZhbHNlO1xuXG4gIE9iamVjdC5lbnRyaWVzKHNjcm9sbFBvc2l0aW9ucykuZm9yRWFjaCgoW2tleSwgcG9zaXRpb25dKSA9PiB7XG4gICAgaWYgKGlzU3RhdGVWYWxpZChwb3NpdGlvbi50aW1lc3RhbXApKSB7XG4gICAgICB2YWxpZFBvc2l0aW9uc1trZXldID0gcG9zaXRpb247XG4gICAgfSBlbHNlIHtcbiAgICAgIGhhc0NoYW5nZXMgPSB0cnVlO1xuICAgIH1cbiAgfSk7XG5cbiAgaWYgKGhhc0NoYW5nZXMpIHtcbiAgICBzYWZlU2V0SXRlbShTVEFURV9LRVlTLlNDUk9MTF9QT1NJVElPTlMsIEpTT04uc3RyaW5naWZ5KHZhbGlkUG9zaXRpb25zKSk7XG4gIH1cbn1cblxuLyoqXG4gKiBIb29rIGZvciBhdXRvbWF0aWMgc3RhdGUgY2xlYW51cCBvbiBwYWdlIGxvYWRcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHVzZVN0YXRlQ2xlYW51cCgpOiB2b2lkIHtcbiAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgLy8gQ2xlYXIgZXhwaXJlZCBzdGF0ZSBvbiBwYWdlIGxvYWRcbiAgICBjbGVhckV4cGlyZWRTdGF0ZSgpO1xuICAgIFxuICAgIC8vIFNldCB1cCBwZXJpb2RpYyBjbGVhbnVwIChldmVyeSAxMCBtaW51dGVzKVxuICAgIGNvbnN0IGludGVydmFsID0gc2V0SW50ZXJ2YWwoY2xlYXJFeHBpcmVkU3RhdGUsIDEwICogNjAgKiAxMDAwKTtcbiAgICBcbiAgICAvLyBDbGVhbnVwIG9uIHBhZ2UgdW5sb2FkXG4gICAgY29uc3QgY2xlYW51cCA9ICgpID0+IHtcbiAgICAgIGNsZWFySW50ZXJ2YWwoaW50ZXJ2YWwpO1xuICAgICAgY2xlYXJFeHBpcmVkU3RhdGUoKTtcbiAgICB9O1xuICAgIFxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdiZWZvcmV1bmxvYWQnLCBjbGVhbnVwKTtcbiAgICBcbiAgICAvLyBSZXR1cm4gY2xlYW51cCBmdW5jdGlvblxuICAgIHJldHVybiBjbGVhbnVwO1xuICB9XG59XG5cbi8qKlxuICogQ3JlYXRlIGEgc3RhdGUgcHJlc2VydmF0aW9uIGhvb2sgZm9yIGNvbXBvbmVudHNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVN0YXRlUHJlc2VydmF0aW9uSG9vayhjb21wb25lbnRJZDogc3RyaW5nKSB7XG4gIHJldHVybiB7XG4gICAgc2F2ZVN0YXRlOiAoc3RhdGU6IGFueSkgPT4gc2F2ZUNvbXBvbmVudFN0YXRlKGNvbXBvbmVudElkLCBzdGF0ZSksXG4gICAgZ2V0U3RhdGU6ICgpID0+IGdldENvbXBvbmVudFN0YXRlKGNvbXBvbmVudElkKSxcbiAgICBjbGVhclN0YXRlOiAoKSA9PiB7XG4gICAgICBjb25zdCBhbGxTdGF0ZXMgPSBnZXRDb21wb25lbnRTdGF0ZXMoKTtcbiAgICAgIGRlbGV0ZSBhbGxTdGF0ZXNbY29tcG9uZW50SWRdO1xuICAgICAgc2FmZVNldEl0ZW0oU1RBVEVfS0VZUy5DT01QT05FTlRfU1RBVEVTLCBKU09OLnN0cmluZ2lmeShhbGxTdGF0ZXMpKTtcbiAgICB9XG4gIH07XG59Il0sInZlcnNpb24iOjN9