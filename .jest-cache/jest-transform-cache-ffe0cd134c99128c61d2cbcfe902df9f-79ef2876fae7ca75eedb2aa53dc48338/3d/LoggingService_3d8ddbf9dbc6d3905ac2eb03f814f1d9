7e586a96923133203288a966f83d3eae
"use strict";
/**
 * Centralized Logging Service for WhatToEatNext
 *
 * Provides structured logging with different levels and contexts.
 * Replaces console.log statements in production code while preserving
 * console.warn and console.error for debugging purposes.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.LoggingService = exports.log = exports.LogLevel = void 0;
var LogLevel;
(function (LogLevel) {
    LogLevel[LogLevel["DEBUG"] = 0] = "DEBUG";
    LogLevel[LogLevel["INFO"] = 1] = "INFO";
    LogLevel[LogLevel["WARN"] = 2] = "WARN";
    LogLevel[LogLevel["ERROR"] = 3] = "ERROR";
    LogLevel[LogLevel["SILENT"] = 4] = "SILENT";
})(LogLevel || (exports.LogLevel = LogLevel = {}));
class LoggingService {
    static instance;
    logLevel = LogLevel.INFO;
    isDevelopment;
    logBuffer = [];
    maxBufferSize = 1000;
    constructor() {
        this.isDevelopment = process.env.NODE_ENV === 'development';
        // Set log level based on environment
        if (this.isDevelopment) {
            this.logLevel = LogLevel.DEBUG;
        }
        else if (process.env.NODE_ENV === 'test') {
            this.logLevel = LogLevel.WARN;
        }
        else {
            this.logLevel = LogLevel.INFO;
        }
    }
    static getInstance() {
        if (!LoggingService.instance) {
            LoggingService.instance = new LoggingService();
        }
        return LoggingService.instance;
    }
    setLogLevel(level) {
        this.logLevel = level;
    }
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    debug(message, context, data) {
        this.log(LogLevel.DEBUG, message, context, undefined, data);
    }
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    info(message, context, data) {
        this.log(LogLevel.INFO, message, context, undefined, data);
    }
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    warn(message, context, data) {
        this.log(LogLevel.WARN, message, context, undefined, data);
    }
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    error(message, context, error, data) {
        this.log(LogLevel.ERROR, message, context, error, data);
    }
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    log(level, message, context, error, data) {
        if (level < this.logLevel) {
            return;
        }
        const logEntry = {
            timestamp: new Date(),
            level,
            message,
            context,
            error,
            data,
        };
        // Add to buffer
        this.addToBuffer(logEntry);
        // Output to console based on level and environment
        this.outputToConsole(logEntry);
    }
    addToBuffer(entry) {
        this.logBuffer.push(entry);
        // Maintain buffer size
        if (this.logBuffer.length > this.maxBufferSize) {
            this.logBuffer.shift();
        }
    }
    outputToConsole(entry) {
        const timestamp = entry.timestamp.toISOString();
        const contextStr = entry.context ? this.formatContext(entry.context) : '';
        const levelStr = LogLevel[entry.level];
        const baseMessage = `[${timestamp}] ${levelStr}: ${entry.message}${contextStr}`;
        switch (entry.level) {
            case LogLevel.DEBUG:
                if (this.isDevelopment) {
                    exports.log.info(`🐛 ${baseMessage}`, entry.data || '');
                }
                break;
            case LogLevel.INFO:
                exports.log.info(`ℹ️ ${baseMessage}`, entry.data || '');
                break;
            case LogLevel.WARN:
                console.warn(`⚠️ ${baseMessage}`, entry.data || '');
                break;
            case LogLevel.ERROR:
                console.error(`❌ ${baseMessage}`, entry.error || entry.data || '');
                break;
        }
    }
    formatContext(context) {
        const parts = [];
        if (context.component)
            parts.push(`component=${context.component}`);
        if (context.service)
            parts.push(`service=${context.service}`);
        if (context.function)
            parts.push(`function=${context.function}`);
        if (context.userId)
            parts.push(`user=${context.userId}`);
        if (context.sessionId)
            parts.push(`session=${context.sessionId}`);
        if (context.requestId)
            parts.push(`request=${context.requestId}`);
        // Add other context properties
        Object.keys(context).forEach(key => {
            if (!['component', 'service', 'function', 'userId', 'sessionId', 'requestId'].includes(key)) {
                parts.push(`${key}=${context[key]}`);
            }
        });
        return parts.length > 0 ? ` [${parts.join(', ')}]` : '';
    }
    getLogBuffer() {
        return [...this.logBuffer];
    }
    clearLogBuffer() {
        this.logBuffer = [];
    }
    exportLogs() {
        return this.logBuffer
            .map(entry => {
            const timestamp = entry.timestamp.toISOString();
            const level = LogLevel[entry.level];
            const context = entry.context ? this.formatContext(entry.context) : '';
            const errorStr = entry.error ? ` ERROR: ${entry.error.message}` : '';
            const dataStr = entry.data ? ` DATA: ${JSON.stringify(entry.data)}` : '';
            return `[${timestamp}] ${level}: ${entry.message}${context}${errorStr}${dataStr}`;
        })
            .join('\n');
    }
}
exports.LoggingService = LoggingService;
// Create singleton instance
const logger = LoggingService.getInstance();
// Export convenience functions
// eslint-disable-next-line @typescript-eslint/no-explicit-any
exports.log = {
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    debug: (message, context, data) => logger.debug(message, context, data),
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    info: (message, context, data) => logger.info(message, context, data),
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    warn: (message, context, data) => logger.warn(message, context, data),
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    error: (message, context, error, data) => logger.error(message, context, error, data),
};
exports.default = logger;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9zZXJ2aWNlcy9Mb2dnaW5nU2VydmljZS50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7OztHQU1HOzs7QUFFSCxJQUFZLFFBTVg7QUFORCxXQUFZLFFBQVE7SUFDbEIseUNBQVMsQ0FBQTtJQUNULHVDQUFRLENBQUE7SUFDUix1Q0FBUSxDQUFBO0lBQ1IseUNBQVMsQ0FBQTtJQUNULDJDQUFVLENBQUE7QUFDWixDQUFDLEVBTlcsUUFBUSx3QkFBUixRQUFRLFFBTW5CO0FBeUJELE1BQU0sY0FBYztJQUNWLE1BQU0sQ0FBQyxRQUFRLENBQWlCO0lBQ2hDLFFBQVEsR0FBYSxRQUFRLENBQUMsSUFBSSxDQUFDO0lBQ25DLGFBQWEsQ0FBVTtJQUN2QixTQUFTLEdBQWUsRUFBRSxDQUFDO0lBQzNCLGFBQWEsR0FBRyxJQUFJLENBQUM7SUFFN0I7UUFDRSxJQUFJLENBQUMsYUFBYSxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsUUFBUSxLQUFLLGFBQWEsQ0FBQztRQUU1RCxxQ0FBcUM7UUFDckMsSUFBSSxJQUFJLENBQUMsYUFBYSxFQUFFO1lBQ3RCLElBQUksQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFDLEtBQUssQ0FBQztTQUNoQzthQUFNLElBQUksT0FBTyxDQUFDLEdBQUcsQ0FBQyxRQUFRLEtBQUssTUFBTSxFQUFFO1lBQzFDLElBQUksQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQztTQUMvQjthQUFNO1lBQ0wsSUFBSSxDQUFDLFFBQVEsR0FBRyxRQUFRLENBQUMsSUFBSSxDQUFDO1NBQy9CO0lBQ0gsQ0FBQztJQUVNLE1BQU0sQ0FBQyxXQUFXO1FBQ3ZCLElBQUksQ0FBQyxjQUFjLENBQUMsUUFBUSxFQUFFO1lBQzVCLGNBQWMsQ0FBQyxRQUFRLEdBQUcsSUFBSSxjQUFjLEVBQUUsQ0FBQztTQUNoRDtRQUNELE9BQU8sY0FBYyxDQUFDLFFBQVEsQ0FBQztJQUNqQyxDQUFDO0lBRU0sV0FBVyxD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QixFQUFFLEtBQWEsRUFBRSxJQUFVLEVBQUUsRUFBRSxDQUMxRSxNQUFNLENBQUMsS0FBSyxDQUFDLE9BQU8sRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLElBQUksQ0FBQztDQUM5QyxDQUFDO0FBSUYsa0JBQWUsTUFBTSxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9HcmVnQ2FzdHJvL0Rlc2t0b3AvV2hhdFRvRWF0TmV4dC9zcmMvc2VydmljZXMvTG9nZ2luZ1NlcnZpY2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDZW50cmFsaXplZCBMb2dnaW5nIFNlcnZpY2UgZm9yIFdoYXRUb0VhdE5leHRcbiAqXG4gKiBQcm92aWRlcyBzdHJ1Y3R1cmVkIGxvZ2dpbmcgd2l0aCBkaWZmZXJlbnQgbGV2ZWxzIGFuZCBjb250ZXh0cy5cbiAqIFJlcGxhY2VzIGNvbnNvbGUubG9nIHN0YXRlbWVudHMgaW4gcHJvZHVjdGlvbiBjb2RlIHdoaWxlIHByZXNlcnZpbmdcbiAqIGNvbnNvbGUud2FybiBhbmQgY29uc29sZS5lcnJvciBmb3IgZGVidWdnaW5nIHB1cnBvc2VzLlxuICovXG5cbmV4cG9ydCBlbnVtIExvZ0xldmVsIHtcbiAgREVCVUcgPSAwLFxuICBJTkZPID0gMSxcbiAgV0FSTiA9IDIsXG4gIEVSUk9SID0gMyxcbiAgU0lMRU5UID0gNCxcbn1cblxuZXhwb3J0IGludGVyZmFjZSBMb2dDb250ZXh0IHtcbiAgY29tcG9uZW50Pzogc3RyaW5nO1xuICBzZXJ2aWNlPzogc3RyaW5nO1xuICBmdW5jdGlvbj86IHN0cmluZztcbiAgdXNlcklkPzogc3RyaW5nO1xuICBzZXNzaW9uSWQ/OiBzdHJpbmc7XG4gIHJlcXVlc3RJZD86IHN0cmluZztcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbiAgLy8gSW50ZW50aW9uYWxseSBhbnk6IExvZ2dpbmcgY29udGV4dCBuZWVkcyBmbGV4aWJpbGl0eSBmb3IgdmFyaW91cyBtZXRhZGF0YVxuICBba2V5OiBzdHJpbmddOiBhbnk7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgTG9nRW50cnkge1xuICB0aW1lc3RhbXA6IERhdGU7XG4gIGxldmVsOiBMb2dMZXZlbDtcbiAgbWVzc2FnZTogc3RyaW5nO1xuICBjb250ZXh0PzogTG9nQ29udGV4dDtcbiAgZXJyb3I/OiBFcnJvcjtcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbiAgLy8gSW50ZW50aW9uYWxseSBhbnk6IExvZyBkYXRhIGNhbiBiZSBvZiBhbnkgdHlwZSBmb3IgZGVidWdnaW5nIHB1cnBvc2VzXG4gIGRhdGE/OiBhbnk7XG59XG5cbmNsYXNzIExvZ2dpbmdTZXJ2aWNlIHtcbiAgcHJpdmF0ZSBzdGF0aWMgaW5zdGFuY2U6IExvZ2dpbmdTZXJ2aWNlO1xuICBwcml2YXRlIGxvZ0xldmVsOiBMb2dMZXZlbCA9IExvZ0xldmVsLklORk87XG4gIHByaXZhdGUgaXNEZXZlbG9wbWVudDogYm9vbGVhbjtcbiAgcHJpdmF0ZSBsb2dCdWZmZXI6IExvZ0VudHJ5W10gPSBbXTtcbiAgcHJpdmF0ZSBtYXhCdWZmZXJTaXplID0gMTAwMDtcblxuICBwcml2YXRlIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuaXNEZXZlbG9wbWVudCA9IHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnO1xuXG4gICAgLy8gU2V0IGxvZyBsZXZlbCBiYXNlZCBvbiBlbnZpcm9ubWVudFxuICAgIGlmICh0aGlzLmlzRGV2ZWxvcG1lbnQpIHtcbiAgICAgIHRoaXMubG9nTGV2ZWwgPSBMb2dMZXZlbC5ERUJVRztcbiAgICB9IGVsc2UgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAndGVzdCcpIHtcbiAgICAgIHRoaXMubG9nTGV2ZWwgPSBMb2dMZXZlbC5XQVJOO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmxvZ0xldmVsID0gTG9nTGV2ZWwuSU5GTztcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgc3RhdGljIGdldEluc3RhbmNlKCk6IExvZ2dpbmdTZXJ2aWNlIHtcbiAgICBpZiAoIUxvZ2dpbmdTZXJ2aWNlLmluc3RhbmNlKSB7XG4gICAgICBMb2dnaW5nU2VydmljZS5pbnN0YW5jZSA9IG5ldyBMb2dnaW5nU2VydmljZSgpO1xuICAgIH1cbiAgICByZXR1cm4gTG9nZ2luZ1NlcnZpY2UuaW5zdGFuY2U7XG4gIH1cblxuICBwdWJsaWMgc2V0TG9nTGV2ZWwobGV2ZWw6IExvZ0xldmVsKTogdm9pZCB7XG4gICAgdGhpcy5sb2dMZXZlbCA9IGxldmVsO1xuICB9XG5cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbiAgcHVibGljIGRlYnVnKG1lc3NhZ2U6IHN0cmluZywgY29udGV4dD86IExvZ0NvbnRleHQsIGRhdGE/OiBhbnkpOiB2b2lkIHtcbiAgICB0aGlzLmxvZyhMb2dMZXZlbC5ERUJVRywgbWVzc2FnZSwgY29udGV4dCwgdW5kZWZpbmVkLCBkYXRhKTtcbiAgfVxuXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4gIHB1YmxpYyBpbmZvKG1lc3NhZ2U6IHN0cmluZywgY29udGV4dD86IExvZ0NvbnRleHQsIGRhdGE/OiBhbnkpOiB2b2lkIHtcbiAgICB0aGlzLmxvZyhMb2dMZXZlbC5JTkZPLCBtZXNzYWdlLCBjb250ZXh0LCB1bmRlZmluZWQsIGRhdGEpO1xuICB9XG5cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbiAgcHVibGljIHdhcm4obWVzc2FnZTogc3RyaW5nLCBjb250ZXh0PzogTG9nQ29udGV4dCwgZGF0YT86IGFueSk6IHZvaWQge1xuICAgIHRoaXMubG9nKExvZ0xldmVsLldBUk4sIG1lc3NhZ2UsIGNvbnRleHQsIHVuZGVmaW5lZCwgZGF0YSk7XG4gIH1cblxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICBwdWJsaWMgZXJyb3IobWVzc2FnZTogc3RyaW5nLCBjb250ZXh0PzogTG9nQ29udGV4dCwgZXJyb3I/OiBFcnJvciwgZGF0YT86IGFueSk6IHZvaWQge1xuICAgIHRoaXMubG9nKExvZ0xldmVsLkVSUk9SLCBtZXNzYWdlLCBjb250ZXh0LCBlcnJvciwgZGF0YSk7XG4gIH1cblxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICBwcml2YXRlIGxvZyhcbiAgICBsZXZlbDogTG9nTGV2ZWwsXG4gICAgbWVzc2FnZTogc3RyaW5nLFxuICAgIGNvbnRleHQ/OiBMb2dDb250ZXh0LFxuICAgIGVycm9yPzogRXJyb3IsXG4gICAgZGF0YT86IGFueSxcbiAgKTogdm9pZCB7XG4gICAgaWYgKGxldmVsIDwgdGhpcy5sb2dMZXZlbCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IGxvZ0VudHJ5OiBMb2dFbnRyeSA9IHtcbiAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKSxcbiAgICAgIGxldmVsLFxuICAgICAgbWVzc2FnZSxcbiAgICAgIGNvbnRleHQsXG4gICAgICBlcnJvcixcbiAgICAgIGRhdGEsXG4gICAgfTtcblxuICAgIC8vIEFkZCB0byBidWZmZXJcbiAgICB0aGlzLmFkZFRvQnVmZmVyKGxvZ0VudHJ5KTtcblxuICAgIC8vIE91dHB1dCB0byBjb25zb2xlIGJhc2VkIG9uIGxldmVsIGFuZCBlbnZpcm9ubWVudFxuICAgIHRoaXMub3V0cHV0VG9Db25zb2xlKGxvZ0VudHJ5KTtcbiAgfVxuXG4gIHByaXZhdGUgYWRkVG9CdWZmZXIoZW50cnk6IExvZ0VudHJ5KTogdm9pZCB7XG4gICAgdGhpcy5sb2dCdWZmZXIucHVzaChlbnRyeSk7XG5cbiAgICAvLyBNYWludGFpbiBidWZmZXIgc2l6ZVxuICAgIGlmICh0aGlzLmxvZ0J1ZmZlci5sZW5ndGggPiB0aGlzLm1heEJ1ZmZlclNpemUpIHtcbiAgICAgIHRoaXMubG9nQnVmZmVyLnNoaWZ0KCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBvdXRwdXRUb0NvbnNvbGUoZW50cnk6IExvZ0VudHJ5KTogdm9pZCB7XG4gICAgY29uc3QgdGltZXN0YW1wID0gZW50cnkudGltZXN0YW1wLnRvSVNPU3RyaW5nKCk7XG4gICAgY29uc3QgY29udGV4dFN0ciA9IGVudHJ5LmNvbnRleHQgPyB0aGlzLmZvcm1hdENvbnRleHQoZW50cnkuY29udGV4dCkgOiAnJztcbiAgICBjb25zdCBsZXZlbFN0ciA9IExvZ0xldmVsW2VudHJ5LmxldmVsXTtcblxuICAgIGNvbnN0IGJhc2VNZXNzYWdlID0gYFske3RpbWVzdGFtcH1dICR7bGV2ZWxTdHJ9OiAke2VudHJ5Lm1lc3NhZ2V9JHtjb250ZXh0U3RyfWA7XG5cbiAgICBzd2l0Y2ggKGVudHJ5LmxldmVsKSB7XG4gICAgICBjYXNlIExvZ0xldmVsLkRFQlVHOlxuICAgICAgICBpZiAodGhpcy5pc0RldmVsb3BtZW50KSB7XG4gICAgICAgICAgbG9nLmluZm8oYPCfkJsgJHtiYXNlTWVzc2FnZX1gLCBlbnRyeS5kYXRhIHx8ICcnKTtcbiAgICAgICAgfVxuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSBMb2dMZXZlbC5JTkZPOlxuICAgICAgICBsb2cuaW5mbyhg4oS577iPICR7YmFzZU1lc3NhZ2V9YCwgZW50cnkuZGF0YSB8fCAnJyk7XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlIExvZ0xldmVsLldBUk46XG4gICAgICAgIGNvbnNvbGUud2Fybihg4pqg77iPICR7YmFzZU1lc3NhZ2V9YCwgZW50cnkuZGF0YSB8fCAnJyk7XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlIExvZ0xldmVsLkVSUk9SOlxuICAgICAgICBjb25zb2xlLmVycm9yKGDinYwgJHtiYXNlTWVzc2FnZX1gLCBlbnRyeS5lcnJvciB8fCBlbnRyeS5kYXRhIHx8ICcnKTtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBmb3JtYXRDb250ZXh0KGNvbnRleHQ6IExvZ0NvbnRleHQpOiBzdHJpbmcge1xuICAgIGNvbnN0IHBhcnRzOiBzdHJpbmdbXSA9IFtdO1xuXG4gICAgaWYgKGNvbnRleHQuY29tcG9uZW50KSBwYXJ0cy5wdXNoKGBjb21wb25lbnQ9JHtjb250ZXh0LmNvbXBvbmVudH1gKTtcbiAgICBpZiAoY29udGV4dC5zZXJ2aWNlKSBwYXJ0cy5wdXNoKGBzZXJ2aWNlPSR7Y29udGV4dC5zZXJ2aWNlfWApO1xuICAgIGlmIChjb250ZXh0LmZ1bmN0aW9uKSBwYXJ0cy5wdXNoKGBmdW5jdGlvbj0ke2NvbnRleHQuZnVuY3Rpb259YCk7XG4gICAgaWYgKGNvbnRleHQudXNlcklkKSBwYXJ0cy5wdXNoKGB1c2VyPSR7Y29udGV4dC51c2VySWR9YCk7XG4gICAgaWYgKGNvbnRleHQuc2Vzc2lvbklkKSBwYXJ0cy5wdXNoKGBzZXNzaW9uPSR7Y29udGV4dC5zZXNzaW9uSWR9YCk7XG4gICAgaWYgKGNvbnRleHQucmVxdWVzdElkKSBwYXJ0cy5wdXNoKGByZXF1ZXN0PSR7Y29udGV4dC5yZXF1ZXN0SWR9YCk7XG5cbiAgICAvLyBBZGQgb3RoZXIgY29udGV4dCBwcm9wZXJ0aWVzXG4gICAgT2JqZWN0LmtleXMoY29udGV4dCkuZm9yRWFjaChrZXkgPT4ge1xuICAgICAgaWYgKCFbJ2NvbXBvbmVudCcsICdzZXJ2aWNlJywgJ2Z1bmN0aW9uJywgJ3VzZXJJZCcsICdzZXNzaW9uSWQnLCAncmVxdWVzdElkJ10uaW5jbHVkZXMoa2V5KSkge1xuICAgICAgICBwYXJ0cy5wdXNoKGAke2tleX09JHtjb250ZXh0W2tleV19YCk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICByZXR1cm4gcGFydHMubGVuZ3RoID4gMCA/IGAgWyR7cGFydHMuam9pbignLCAnKX1dYCA6ICcnO1xuICB9XG5cbiAgcHVibGljIGdldExvZ0J1ZmZlcigpOiBMb2dFbnRyeVtdIHtcbiAgICByZXR1cm4gWy4uLnRoaXMubG9nQnVmZmVyXTtcbiAgfVxuXG4gIHB1YmxpYyBjbGVhckxvZ0J1ZmZlcigpOiB2b2lkIHtcbiAgICB0aGlzLmxvZ0J1ZmZlciA9IFtdO1xuICB9XG5cbiAgcHVibGljIGV4cG9ydExvZ3MoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5sb2dCdWZmZXJcbiAgICAgIC5tYXAoZW50cnkgPT4ge1xuICAgICAgICBjb25zdCB0aW1lc3RhbXAgPSBlbnRyeS50aW1lc3RhbXAudG9JU09TdHJpbmcoKTtcbiAgICAgICAgY29uc3QgbGV2ZWwgPSBMb2dMZXZlbFtlbnRyeS5sZXZlbF07XG4gICAgICAgIGNvbnN0IGNvbnRleHQgPSBlbnRyeS5jb250ZXh0ID8gdGhpcy5mb3JtYXRDb250ZXh0KGVudHJ5LmNvbnRleHQpIDogJyc7XG4gICAgICAgIGNvbnN0IGVycm9yU3RyID0gZW50cnkuZXJyb3IgPyBgIEVSUk9SOiAke2VudHJ5LmVycm9yLm1lc3NhZ2V9YCA6ICcnO1xuICAgICAgICBjb25zdCBkYXRhU3RyID0gZW50cnkuZGF0YSA/IGAgREFUQTogJHtKU09OLnN0cmluZ2lmeShlbnRyeS5kYXRhKX1gIDogJyc7XG5cbiAgICAgICAgcmV0dXJuIGBbJHt0aW1lc3RhbXB9XSAke2xldmVsfTogJHtlbnRyeS5tZXNzYWdlfSR7Y29udGV4dH0ke2Vycm9yU3RyfSR7ZGF0YVN0cn1gO1xuICAgICAgfSlcbiAgICAgIC5qb2luKCdcXG4nKTtcbiAgfVxufVxuXG4vLyBDcmVhdGUgc2luZ2xldG9uIGluc3RhbmNlXG5jb25zdCBsb2dnZXIgPSBMb2dnaW5nU2VydmljZS5nZXRJbnN0YW5jZSgpO1xuXG4vLyBFeHBvcnQgY29udmVuaWVuY2UgZnVuY3Rpb25zXG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuZXhwb3J0IGNvbnN0IGxvZyA9IHtcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbiAgZGVidWc6IChtZXNzYWdlOiBzdHJpbmcsIGNvbnRleHQ/OiBMb2dDb250ZXh0LCBkYXRhPzogYW55KSA9PlxuICAgIGxvZ2dlci5kZWJ1ZyhtZXNzYWdlLCBjb250ZXh0LCBkYXRhKSxcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbiAgaW5mbzogKG1lc3NhZ2U6IHN0cmluZywgY29udGV4dD86IExvZ0NvbnRleHQsIGRhdGE/OiBhbnkpID0+IGxvZ2dlci5pbmZvKG1lc3NhZ2UsIGNvbnRleHQsIGRhdGEpLFxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICB3YXJuOiAobWVzc2FnZTogc3RyaW5nLCBjb250ZXh0PzogTG9nQ29udGV4dCwgZGF0YT86IGFueSkgPT4gbG9nZ2VyLndhcm4obWVzc2FnZSwgY29udGV4dCwgZGF0YSksXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4gIGVycm9yOiAobWVzc2FnZTogc3RyaW5nLCBjb250ZXh0PzogTG9nQ29udGV4dCwgZXJyb3I/OiBFcnJvciwgZGF0YT86IGFueSkgPT5cbiAgICBsb2dnZXIuZXJyb3IobWVzc2FnZSwgY29udGV4dCwgZXJyb3IsIGRhdGEpLFxufTtcblxuLy8gRXhwb3J0IHNlcnZpY2UgZm9yIGFkdmFuY2VkIHVzYWdlXG5leHBvcnQgeyBMb2dnaW5nU2VydmljZSB9O1xuZXhwb3J0IGRlZmF1bHQgbG9nZ2VyO1xuIl0sInZlcnNpb24iOjN9