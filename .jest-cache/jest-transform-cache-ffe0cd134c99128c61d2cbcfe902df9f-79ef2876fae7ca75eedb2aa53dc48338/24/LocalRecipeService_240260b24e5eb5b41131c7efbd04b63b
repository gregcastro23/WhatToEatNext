de842dfba8959d2c775f2bb8d7b76a73
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.LocalRecipeService = void 0;
const cuisines_1 = require("@/data/cuisines");
const logger_1 = require("@/utils/logger");
/**
 * LocalRecipeService extracts recipes from cuisine files
 * This helps reduce API calls by using local data first
 */
class LocalRecipeService {
    /**
     * Get all available recipes
     * @returns Array of all recipes
     */
    static async getAllRecipes() {
        // Return cached recipes if available
        if (this._allRecipes) {
            return this._allRecipes;
        }
        try {
            const recipes = [];
            // Get recipes from all available cuisines
            for (const cuisine of Object.values(cuisines_1.cuisinesMap)) {
                if (cuisine) {
                    const cuisineRecipes = await this.getRecipesFromCuisine(cuisine);
                    recipes.push(...cuisineRecipes);
                }
            }
            logger_1.logger.debug(`Loaded ${recipes.length} total recipes`);
            // Cache the recipes for future use
            this._allRecipes = recipes;
            return recipes;
        }
        catch (error) {
            logger_1.logger.error("Error getting all recipes:", error);
            return [];
        }
    }
    /**
     * Get recipes for a specific cuisine
     * @param cuisineName The name of the cuisine
     * @returns Array of recipes for that cuisine
     */
    static async getRecipesByCuisine(cuisineName) {
        var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v, _w, _x, _y, _z, _0, _1, _2, _3;
        if (!cuisineName) {
            logger_1.logger.warn('No cuisine name provided to getRecipesByCuisine');
            return [];
        }
        try {
            logger_1.logger.debug(`Getting recipes for cuisine: ${cuisineName}`);
            // Normalize cuisine name for comparison
            const normalizedName = cuisineName.toLowerCase().trim();
            // Handle special cases for African and American cuisines
            if (normalizedName === 'african' || normalizedName === 'american') {
                logger_1.logger.debug(`Special handling for: ${normalizedName}`);
                // Try different ways to access the cuisine data
                let directCuisine = null;
                try {
                    // Try importing the cuisine directly from its file using dynamic imports
                    if (normalizedName === 'african') {
                        const africanModule = await Promise.resolve().then(() => __importStar(require('../data/cuisines/african')));
                        directCuisine = africanModule.african;
                    }
                    else {
                        const americanModule = await Promise.resolve().then(() => __importStar(require('../data/cuisines/american')));
                        directCuisine = americanModule.american;
                    }
                    logger_1.logger.debug(`Direct import successful for ${normalizedName}`);
                }
                catch (error) {
                    logger_1.logger.error(`Error importing ${normalizedName} cuisine directly:`, error);
                    // If direct import fails, try the cuisinesMap object (various cases)
                    directCuisine = (cuisines_1.cuisinesMap[normalizedName] ||
                        cuisines_1.cuisinesMap[normalizedName.charAt(0).toUpperCase() + normalizedName.slice(1)] ||
                        cuisines_1.cuisinesMap[normalizedName.toUpperCase()]);
                }
                if (directCuisine) {
                    logger_1.logger.debug(`Found ${normalizedName} cuisine data`);
                    // Additional debug information to help diagnose issues
                    logger_1.logger.debug(`Cuisine structure: ${JSON.stringify({
                        id: directCuisine.id,
                        name: directCuisine.name,
                        hasDishes: !!directCuisine.dishes,
                        dishTypes: directCuisine.dishes ? Object.keys(directCuisine.dishes).join(', ') : 'none',
                        breakfast: (((_c = (_b = (_a = directCuisine.dishes) === null || _a === void 0 ? void 0 : _a.breakfast) === null || _b === void 0 ? void 0 : _b.all) === null || _c === void 0 ? void 0 : _c.length) || ((_g = (_f = (_e = (_d = directCuisine.dishes) === null || _d === void 0 ? void 0 : _d.dishes) === null || _e === void 0 ? void 0 : _e.breakfast) === null || _f === void 0 ? void 0 : _f.all) === null || _g === void 0 ? void 0 : _g.length)) || 0,
                        lunch: (((_k = (_j = (_h = directCuisine.dishes) === null || _h === void 0 ? void 0 : _h.lunch) === null || _j === void 0 ? void 0 : _j.all) === null || _k === void 0 ? void 0 : _k.length) || ((_p = (_o = (_m = (_l = directCuisine.dishes) === null || _l === void 0 ? void 0 : _l.dishes) === null || _m === void 0 ? void 0 : _m.lunch) === null || _o === void 0 ? void 0 : _o.all) === null || _p === void 0 ? void 0 : _p.length)) || 0,
                        dinner: (((_s = (_r = (_q = directCuisine.dishes) === null || _q === void 0 ? void 0 : _q.dinner) === null || _r === void 0 ? void 0 : _r.all) === null || _s === void 0 ? void 0 : _s.length) || ((_w = (_v = (_u = (_t = directCuisine.dishes) === null || _t === void 0 ? void 0 : _t.dishes) === null || _u === void 0 ? void 0 : _u.dinner) === null || _v === void 0 ? void 0 : _v.all) === null || _w === void 0 ? void 0 : _w.length)) || 0,
                        dessert: (((_z = (_y = (_x = directCuisine.dishes) === null || _x === void 0 ? void 0 : _x.dessert) === null || _y === void 0 ? void 0 : _y.all) === null || _z === void 0 ? void 0 : _z.length) || ((_3 = (_2 = (_1 = (_0 = directCuisine.dishes) === null || _0 === void 0 ? void 0 : _0.dishes) === null || _1 === void 0 ? void 0 : _1.dessert) === null || _2 === void 0 ? void 0 : _2.all) === null || _3 === void 0 ? void 0 : _3.length)) || 0
                    })}`);
                    return await this.getRecipesFromCuisine(directCuisine);
                }
                else {
                    console.warn(`Could not find ${normalizedName} in cuisinesMap keys:`, Object.keys(cuisines_1.cuisinesMap));
                }
            }
            // Find the cuisine object in the regular way
            const cuisine = Object.values(cuisines_1.cuisinesMap).find(c => { var _a; return ((_a = c === null || c === void 0 ? void 0 : c.name) === null || _a === void 0 ? void 0 : _a.toLowerCase()) === normalizedName; });
            if (!cuisine) {
                // Try finding the cuisine by ID or variations of the name
                const byIdMatch = Object.entries(cuisines_1.cuisinesMap).find(([id, c]) => {
                    var _a, _b, _c;
                    return id.toLowerCase() === normalizedName ||
                        ((_a = c === null || c === void 0 ? void 0 : c.name) === null || _a === void 0 ? void 0 : _a.toLowerCase()) === normalizedName ||
                        ((_b = c === null || c === void 0 ? void 0 : c.name) === null || _b === void 0 ? void 0 : _b.toLowerCase().includes(normalizedName)) ||
                        normalizedName.includes((_c = c === null || c === void 0 ? void 0 : c.name) === null || _c === void 0 ? void 0 : _c.toLowerCase());
                });
                if (byIdMatch && byIdMatch[1]) {
                    return await this.getRecipesFromCuisine(byIdMatch[1]);
                }
                logger_1.logger.info(`Cuisine not found: ${cuisineName}`);
                return [];
            }
            return await this.getRecipesFromCuisine(cuisine);
        }
        catch (error) {
            logger_1.logger.error(`Error getting recipes for cuisine ${cuisineName}:`, error);
            return [];
        }
    }
    /**
     * Extract all recipes from a cuisine object
     * @param cuisine The cuisine object
     * @returns Array of recipes
     */
    static async getRecipesFromCuisine(cuisine) {
        var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v, _w, _x, _y, _z, _0, _1, _2, _3, _4, _5, _6;
        if (!cuisine)
            return [];
        const recipes = [];
        const mealTypes = ['breakfast', 'lunch', 'dinner', 'dessert', 'snacks'];
        try {
            logger_1.logger.debug(`Extracting recipes from cuisine: ${cuisine.name}`);
            // Special handling for American and African cuisines
            const isSpecialCase = cuisine.name.toLowerCase() === 'american' || cuisine.name.toLowerCase() === 'african';
            // Log specific debug info for African cuisine
            if (cuisine.name.toLowerCase() === 'african') {
                logger_1.logger.debug('AFRICAN CUISINE DETAILED DEBUG INFO:');
                logger_1.logger.debug('Full cuisine structure:', JSON.stringify({
                    id: cuisine.id,
                    name: cuisine.name,
                    dishesKeys: Object.keys(cuisine.dishes || {}),
                    breakfastAllLength: (((_c = (_b = (_a = cuisine.dishes) === null || _a === void 0 ? void 0 : _a.breakfast) === null || _b === void 0 ? void 0 : _b.all) === null || _c === void 0 ? void 0 : _c.length) || ((_g = (_f = (_e = (_d = cuisine.dishes) === null || _d === void 0 ? void 0 : _d.dishes) === null || _e === void 0 ? void 0 : _e.breakfast) === null || _f === void 0 ? void 0 : _f.all) === null || _g === void 0 ? void 0 : _g.length)) || 0,
                    lunchAllLength: (((_k = (_j = (_h = cuisine.dishes) === null || _h === void 0 ? void 0 : _h.lunch) === null || _j === void 0 ? void 0 : _j.all) === null || _k === void 0 ? void 0 : _k.length) || ((_p = (_o = (_m = (_l = cuisine.dishes) === null || _l === void 0 ? void 0 : _l.dishes) === null || _m === void 0 ? void 0 : _m.lunch) === null || _o === void 0 ? void 0 : _o.all) === null || _p === void 0 ? void 0 : _p.length)) || 0,
                    dinnerAllLength: (((_s = (_r = (_q = cuisine.dishes) === null || _q === void 0 ? void 0 : _q.dinner) === null || _r === void 0 ? void 0 : _r.all) === null || _s === void 0 ? void 0 : _s.length) || ((_w = (_v = (_u = (_t = cuisine.dishes) === null || _t === void 0 ? void 0 : _t.dishes) === null || _u === void 0 ? void 0 : _u.dinner) === null || _v === void 0 ? void 0 : _v.all) === null || _w === void 0 ? void 0 : _w.length)) || 0,
                    dessertAllLength: (((_z = (_y = (_x = cuisine.dishes) === null || _x === void 0 ? void 0 : _x.dessert) === null || _y === void 0 ? void 0 : _y.all) === null || _z === void 0 ? void 0 : _z.length) || ((_3 = (_2 = (_1 = (_0 = cuisine.dishes) === null || _0 === void 0 ? void 0 : _0.dishes) === null || _1 === void 0 ? void 0 : _1.dessert) === null || _2 === void 0 ? void 0 : _2.all) === null || _3 === void 0 ? void 0 : _3.length)) || 0,
                }));
                // Check if "all" arrays actually contain recipes with safe type casting
                const dishesData = cuisine.dishes;
                const breakfastAll = ((_4 = dishesData === null || dishesData === void 0 ? void 0 : dishesData.breakfast) === null || _4 === void 0 ? void 0 : _4.all) || ((_6 = (_5 = dishesData === null || dishesData === void 0 ? void 0 : dishesData.dishes) === null || _5 === void 0 ? void 0 : _5.breakfast) === null || _6 === void 0 ? void 0 : _6.all);
                if ((breakfastAll === null || breakfastAll === void 0 ? void 0 : breakfastAll.length) > 0) {
                    logger_1.logger.debug('Sample breakfast recipe:', JSON.stringify(breakfastAll[0]));
                }
            }
            // Check if dishes structure exists
            if (!cuisine.dishes) {
                logger_1.logger.debug(`No dishes found for cuisine: ${cuisine.name}`);
                if (isSpecialCase) {
                    console.warn(`Special case (${cuisine.name}) has no dishes property:`, cuisine);
                }
                return [];
            }
            logger_1.logger.debug(`Dishes structure:`, Object.keys(cuisine.dishes || {}));
            // Quick check for all season recipes in each meal type
            mealTypes.forEach(mealType => {
                if (cuisine.dishes && cuisine.dishes[mealType] &&
                    typeof cuisine.dishes[mealType] === 'object' &&
                    cuisine.dishes[mealType].all &&
                    Array.isArray(cuisine.dishes[mealType].all)) {
                    logger_1.logger.debug(`Found ${cuisine.dishes[mealType].all.length} ${mealType} recipes in 'all' season for ${cuisine.name}`);
                }
                else if (isSpecialCase) {
                    // Debug problematic cuisine
                    console.warn(`No '${mealType}.all' array found for ${cuisine.name}`);
                    if (cuisine.dishes && cuisine.dishes[mealType]) {
                        logger_1.logger.debug(`Structure of ${mealType}:`, Object.keys(cuisine.dishes[mealType]));
                    }
                }
            });
            // Loop through each meal type
            mealTypes.forEach(mealType => {
                if (!cuisine.dishes || !cuisine.dishes[mealType]) {
                    logger_1.logger.debug(`No dishes for meal type: ${mealType}`);
                    return;
                }
                const seasonalDishes = cuisine.dishes[mealType];
                logger_1.logger.debug(`Meal type ${mealType} structure:`, JSON.stringify(Object.keys(seasonalDishes || {})));
                // Process seasonal recipes (spring, summer, autumn, winter)
                const seasons = ['spring', 'summer', 'autumn', 'winter'];
                seasons.forEach(season => {
                    // Use both season and its alternative name (autumn/fall)
                    const seasonalKey = season === 'autumn' ? 'fall' : (season === 'fall' ? 'autumn' : season);
                    // Get recipes for the season
                    let seasonRecipes = [];
                    if (seasonalDishes[season] && Array.isArray(seasonalDishes[season])) {
                        seasonRecipes = seasonalDishes[season] || [];
                    }
                    else if (seasonalDishes[seasonalKey] && Array.isArray(seasonalDishes[seasonalKey])) {
                        seasonRecipes = seasonalDishes[seasonalKey] || [];
                    }
                    if (seasonRecipes.length > 0) {
                        logger_1.logger.debug(`Found ${seasonRecipes.length} dishes for ${season} in ${mealType}`);
                        // Add only unique recipes based on name to avoid duplicates from 'all' merging
                        seasonRecipes.forEach(dish => {
                            if (dish && dish.name && !recipes.some(r => r.name === dish.name)) {
                                recipes.push(this.standardizeRecipe(dish, cuisine.name, [season], [mealType]));
                            }
                        });
                    }
                    else if (isSpecialCase) {
                        console.warn(`No recipes found for ${season} in ${mealType} for ${cuisine.name}`);
                    }
                });
            });
            logger_1.logger.debug(`Extracted ${recipes.length} total recipes from ${cuisine.name} cuisine`);
            // If no recipes were found, log cuisine structure to help debug
            if (recipes.length === 0) {
                console.warn(`No recipes extracted for ${cuisine.name}. Cuisine structure:`, JSON.stringify({
                    id: cuisine.id,
                    name: cuisine.name,
                    dishesKeys: Object.keys(cuisine.dishes || {}),
                    hasDishes: !!cuisine.dishes,
                    dishesStructure: Object.entries(cuisine.dishes || {}).map(([key, value]) => ({
                        mealType: key,
                        hasValue: !!value,
                        seasonKeys: value ? Object.keys(value) : [],
                        hasAll: !!(value && value.all),
                        allIsArray: !!(value && value.all && Array.isArray(value.all)),
                        allLength: value && value.all && Array.isArray(value.all) ? value.all.length : 0
                    }))
                }, null, 2));
                // Check if the dishes property might be nested incorrectly
                if (cuisine.dishes && typeof cuisine.dishes.dishes === 'object') {
                    logger_1.logger.debug('Found nested dishes property, trying to extract from there instead');
                    return this.getRecipesFromCuisine({ ...cuisine, dishes: cuisine.dishes.dishes });
                }
            }
            return recipes;
        }
        catch (error) {
            logger_1.logger.error(`Error extracting recipes from cuisine ${cuisine.name}:`, error);
            logger_1.logger.error(`Error extracting recipes from cuisine ${cuisine.name}:`, error);
            return [];
        }
    }
    /**
     * Standardize a recipe to match our Recipe type
     * @param dish The dish object from cuisine data
     * @param cuisineName The cuisine name
     * @param seasons The seasons for this dish
     * @param mealTypes The meal types for this dish
     * @returns Standardized recipe
     */
    static standardizeRecipe(dish, cuisineName, seasons = ['all'], mealTypes = ['any']) {
        var _a, _b, _c, _d, _e, _f;
        try {
            if (!dish) {
                throw new Error('Dish object is null or undefined');
            }
            // Generate a deterministic ID if none exists
            const id = dish.id || `${cuisineName.toLowerCase()}-${dish.name.toLowerCase().replace(/\s+/g, '-')}`;
            // Map cuisine ingredients to our RecipeIngredient type
            const ingredients = (Array.isArray(dish.ingredients) ? dish.ingredients : []).map(ing => {
                if (!ing)
                    return {
                        name: 'unknown ingredient',
                        amount: 1,
                        unit: 'unit'
                    };
                return {
                    name: ing.name || '',
                    amount: ing.amount ? (typeof ing.amount === 'string' ? parseFloat(ing.amount) || 1 : ing.amount) : 1,
                    unit: ing.unit || '',
                    preparation: ing.preparation || '',
                    category: ing.category || '',
                    optional: ing.optional || false,
                    notes: ing.notes || '',
                    substitutes: Array.isArray(ing.swaps) ? ing.swaps :
                        Array.isArray(ing.substitutes) ? ing.substitutes :
                            typeof ing.swaps === 'string' ? [ing.swaps] :
                                typeof ing.substitutes === 'string' ? [ing.substitutes] : []
                };
            });
            // Ensure elementalProperties exist - checking all possible property names
            let elementalProperties;
            if (dish.elementalProperties) {
                elementalProperties = dish.elementalProperties;
            }
            else if (dish.elementalState && typeof dish.elementalState === 'object') {
                // Convert Record<string, number> to ElementalProperties
                const state = dish.elementalState;
                elementalProperties = {
                    Fire: state.Fire || state.fire || 0.25,
                    Water: state.Water || state.water || 0.25,
                    Earth: state.Earth || state.earth || 0.25,
                    Air: state.Air || state.air || 0.25
                };
            }
            else {
                elementalProperties = {
                    Fire: 0.25,
                    Water: 0.25,
                    Earth: 0.25,
                    Air: 0.25
                };
            }
            // Make sure all elemental properties are numbers
            elementalProperties = {
                Fire: typeof elementalProperties.Fire === 'number' ? elementalProperties.Fire : 0.25,
                Water: typeof elementalProperties.Water === 'number' ? elementalProperties.Water : 0.25,
                Earth: typeof elementalProperties.Earth === 'number' ? elementalProperties.Earth : 0.25,
                Air: typeof elementalProperties.Air === 'number' ? elementalProperties.Air : 0.25
            };
            // Standardize timing information
            const prepTime = dish.prepTime || '';
            const cookTime = dish.cookTime || '';
            // Parse timeToMake from prepTime and cookTime if available
            let timeToMake = dish.timeToMake || '';
            if (!timeToMake && prepTime && cookTime) {
                const prepMinutes = parseInt(prepTime.toString().split(' ')[0]) || 0;
                const cookMinutes = parseInt(cookTime.toString().split(' ')[0]) || 0;
                timeToMake = `${prepMinutes + cookMinutes} minutes`;
            }
            if (!timeToMake) {
                timeToMake = '30 minutes'; // Default
            }
            // Get instructions from preparationSteps or instructions field
            let instructions = [];
            if (Array.isArray(dish.preparationSteps) && dish.preparationSteps.length > 0) {
                instructions = dish.preparationSteps;
            }
            else if (Array.isArray(dish.instructions) && dish.instructions.length > 0) {
                instructions = dish.instructions;
            }
            else if (typeof dish.preparationSteps === 'string') {
                instructions = [dish.preparationSteps];
            }
            else if (typeof dish.instructions === 'string') {
                instructions = [dish.instructions];
            }
            else {
                instructions = ['Place all ingredients in a pot and cook until done.'];
            }
            // Process nutrition information
            const nutrition = dish.nutrition ? {
                calories: dish.nutrition.calories,
                protein: dish.nutrition.protein,
                carbs: dish.nutrition.carbs,
                fat: dish.nutrition.fat,
                vitamins: dish.nutrition.vitamins || [],
                minerals: dish.nutrition.minerals || []
            } : undefined;
            // Process substitutions
            let substitutions = [];
            if (dish.substitutions && typeof dish.substitutions === 'object') {
                // Convert from {ingredient: [alternatives]} format
                substitutions = Object.entries(dish.substitutions).map(([original, alternatives]) => ({
                    original,
                    alternatives: Array.isArray(alternatives) ? alternatives : [alternatives]
                }));
            }
            // Get number of servings
            const servingSize = dish.servingSize || dish.numberOfServings || dish.servings || 4;
            // Create standardized recipe
            return {
                id,
                name: dish.name,
                description: dish.description || '',
                cuisine: cuisineName,
                ingredients: ingredients,
                instructions: instructions,
                timeToMake: timeToMake,
                numberOfServings: typeof servingSize === 'number' ? servingSize : parseInt(servingSize) || 4,
                elementalProperties: elementalProperties,
                season: Array.isArray(dish.season) ? dish.season : seasons,
                mealType: Array.isArray(dish.mealType) ? dish.mealType : mealTypes,
                isVegetarian: dish.isVegetarian || ((_a = dish.dietaryInfo) === null || _a === void 0 ? void 0 : _a.includes('vegetarian')) || false,
                isVegan: dish.isVegan || ((_b = dish.dietaryInfo) === null || _b === void 0 ? void 0 : _b.includes('vegan')) || false,
                isGlutenFree: dish.isGlutenFree || ((_c = dish.dietaryInfo) === null || _c === void 0 ? void 0 : _c.includes('gluten-free')) || false,
                isDairyFree: dish.isDairyFree || ((_d = dish.dietaryInfo) === null || _d === void 0 ? void 0 : _d.includes('dairy-free')) || false,
                nutrition: nutrition,
                astrologicalInfluences: Array.isArray(dish.astrologicalInfluences) ? dish.astrologicalInfluences : [],
                zodiacInfluences: Array.isArray(dish.zodiacInfluences) ? dish.zodiacInfluences : [],
                lunarPhaseInfluences: Array.isArray(dish.lunarPhaseInfluences) ? dish.lunarPhaseInfluences : [],
                planetaryInfluences: {
                    favorable: ((_e = dish.planetaryInfluences) === null || _e === void 0 ? void 0 : _e.favorable) || [],
                    unfavorable: ((_f = dish.planetaryInfluences) === null || _f === void 0 ? void 0 : _f.unfavorable) || []
                },
                cookingMethods: Array.isArray(dish.cookingMethods) ? dish.cookingMethods : [],
                // New fields
                substitutions: substitutions,
                tools: Array.isArray(dish.tools) ? dish.tools : [],
                servingSize: typeof servingSize === 'number' ? servingSize : parseInt(servingSize) || 4,
                spiceLevel: (dish.spiceLevel === 'hot' || dish.spiceLevel === 'mild' || dish.spiceLevel === 'medium' || dish.spiceLevel === 'very hot') ? dish.spiceLevel : 'mild',
                preparationNotes: dish.preparationNotes || dish.culturalNotes || '',
                technicalTips: Array.isArray(dish.technicalTips) ? dish.technicalTips : []
            };
        }
        catch (error) {
            logger_1.logger.error('Error standardizing recipe:', error);
            return {
                id: `error-${Math.random().toString(36).substring(2, 11)}`,
                name: (dish === null || dish === void 0 ? void 0 : dish.name) || 'Unknown Recipe',
                description: 'Error loading recipe details',
                cuisine: cuisineName,
                ingredients: [],
                instructions: ['Recipe details unavailable'],
                timeToMake: '0 minutes',
                numberOfServings: 0,
                elementalProperties: {
                    Fire: 0.25,
                    Water: 0.25,
                    Earth: 0.25,
                    Air: 0.25
                }
            };
        }
    }
    /**
     * Search recipes by query string
     * @param query Search query
     * @returns Array of recipes matching the query
     */
    static async searchRecipes(query) {
        if (!query)
            return [];
        try {
            const normalizedQuery = query.toLowerCase().trim();
            const recipes = await this.getAllRecipes();
            return recipes.filter(recipe => {
                // Search in recipe name
                if (recipe.name && recipe.name.toLowerCase().includes(normalizedQuery)) {
                    return true;
                }
                // Search in recipe description
                if (recipe.description && recipe.description.toLowerCase().includes(normalizedQuery)) {
                    return true;
                }
                // Search in ingredients
                if (recipe.ingredients && Array.isArray(recipe.ingredients)) {
                    for (const ingredient of recipe.ingredients) {
                        const ingredientName = typeof ingredient === 'string'
                            ? ingredient
                            : ingredient.name;
                        if (ingredientName && ingredientName.toLowerCase().includes(normalizedQuery)) {
                            return true;
                        }
                    }
                }
                return false;
            });
        }
        catch (error) {
            logger_1.logger.error(`Error searching recipes for query "${query}":`, error);
            return [];
        }
    }
    /**
     * Get recipes by meal type
     * @param mealType The meal type to filter by
     * @returns Array of recipes for the specified meal type
     */
    static async getRecipesByMealType(mealType) {
        if (!mealType)
            return [];
        try {
            const normalizedMealType = mealType.toLowerCase().trim();
            const recipes = await this.getAllRecipes();
            return recipes.filter(recipe => recipe.mealType &&
                (Array.isArray(recipe.mealType)
                    ? recipe.mealType.some(m => m.toLowerCase() === normalizedMealType)
                    : recipe.mealType.toLowerCase() === normalizedMealType));
        }
        catch (error) {
            logger_1.logger.error(`Error getting recipes for meal type "${mealType}":`, error);
            return [];
        }
    }
    /**
     * Get recipes by season
     * @param season The season to filter by
     * @returns Array of recipes for the specified season
     */
    static async getRecipesBySeason(season) {
        if (!season)
            return [];
        try {
            const normalizedSeason = season.toLowerCase().trim();
            const recipes = await this.getAllRecipes();
            return recipes.filter(recipe => recipe.season &&
                (Array.isArray(recipe.season)
                    ? recipe.season.some(s => s.toLowerCase() === normalizedSeason)
                    : recipe.season.toLowerCase() === normalizedSeason));
        }
        catch (error) {
            logger_1.logger.error(`Error getting recipes for season "${season}":`, error);
            return [];
        }
    }
    /**
     * Clear the recipe cache to force a reload
     */
    static clearCache() {
        this._allRecipes = null;
    }
}
exports.LocalRecipeService = LocalRecipeService;
// Main cache of all extracted recipes
LocalRecipeService._allRecipes = null;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9zZXJ2aWNlcy9Mb2NhbFJlY2lwZVNlcnZpY2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSw4Q0FBOEM7QUFJOUMsMkNBQXdDO0FBdUZ4Qzs7O0dBR0c7QUFDSCxNQUFhLGtCQUFrQjtJQUk3Qjs7O09BR0c7SUFDSCxNQUFNLENBQUMsS0FBSyxDQUFDLGFBQWE7UUFDeEIscUNBQXFDO1FBQ3JDLElBQUksSUFBSSxDQUFDLFdBQVcsRUFBRTtZQUNwQixPQUFPLElBQUksQ0FBQyxXQUFXLENBQUM7U0FDekI7UUFFRCxJQUFJO1lBQ0YsTUFBTSxPQUFPLEdBQWEsRUFBRSxDQUFDO1lBRTdCLDBDQUEwQztZQUMxQyxLQUFLLE1BQU0sT0FBTyxJQUFJLE1BQU0sQ0FBQyxNQUFNLENBQUMsc0JBQVcsQ0FBQyxFQUFFO2dCQUNoRCxJQUFJLE9BQU8sRUFBRTtvQkFDWCxNQUFNLGNBQWMsR0FBRyxNQUFNLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxPQUFrQyxDQUFDLENBQUM7b0JBQzVGLE9BQU8sQ0FBQyxJQUFJLENBQUMsR0FBRyxjQUFjLENBQUMsQ0FBQztpQkFDakM7YUFDRjtZQUVELGVBQU0sQ0FBQyxLQUFLLENBQUMsVUFBVSxPQUFPLENBQUMsTUFBTSxnQkFBZ0IsQ0FBQyxDQUFDO1lBRXZELG1DQUFtQztZQUNuQyxJQUFJLENBQUMsV0FBVyxHQUFHLE9BQU8sQ0FBQztZQUUzQixPQUFPLE9BQU8sQ0FBQztTQUNoQjtRQUFDLE9BQU8sS0FBSyxFQUFFO1lBQ2QsZUFBTSxDQUFDLEtBQUssQ0FBQyw0QkFBNEIsRUFBRSxLQUFLLENBQUMsQ0FBQztZQUNsRCxPQUFPLEVBQUUsQ0FBQztTQUNYO0lBQ0gsQ0FBQztJQUVEOzs7O09BSUc7SUFDSCxNQUFNLENBQUMsS0FBSyxDQUFDLG1CQUFtQixDQUFDLFdBQW1COztRQUNsRCxJQUFJLENBQUMsV0FBVyxFQUFFO1lBQ2hCLGVB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QUMsQ0FBQyxDQUFDLFdBQVcsRUFBRSxLQUFLLGdCQUFnQixDQUFDO29CQUMvRCxDQUFDLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxXQUFXLEVBQUUsS0FBSyxnQkFBZ0IsQ0FBQyxDQUN0RCxDQUFDO1NBQ0g7UUFBQyxPQUFPLEtBQUssRUFBRTtZQUNkLGVBQU0sQ0FBQyxLQUFLLENBQUMscUNBQXFDLE1BQU0sSUFBSSxFQUFFLEtBQUssQ0FBQyxDQUFDO1lBQ3JFLE9BQU8sRUFBRSxDQUFDO1NBQ1g7SUFDSCxDQUFDO0lBRUQ7O09BRUc7SUFDSCxNQUFNLENBQUMsVUFBVTtRQUNmLElBQUksQ0FBQyxXQUFXLEdBQUcsSUFBSSxDQUFDO0lBQzFCLENBQUM7O0FBdmlCSCxnREF3aUJDO0FBdmlCQyxzQ0FBc0M7QUFDdkIsOEJBQVcsR0FBb0IsSUFBSSxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9HcmVnQ2FzdHJvL0Rlc2t0b3AvV2hhdFRvRWF0TmV4dC9zcmMvc2VydmljZXMvTG9jYWxSZWNpcGVTZXJ2aWNlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGN1aXNpbmVzTWFwIH0gZnJvbSAnQC9kYXRhL2N1aXNpbmVzJztcbmltcG9ydCB0eXBlIHsgUmVjaXBlIH0gZnJvbSAnQC90eXBlcy9yZWNpcGUnO1xuaW1wb3J0IHR5cGUgeyBDdWlzaW5lLCBTZWFzb25hbERpc2hlcyB9IGZyb20gJ0AvdHlwZXMvY3Vpc2luZSc7XG5pbXBvcnQgdHlwZSB7IFpvZGlhY1NpZ24sIEx1bmFyUGhhc2UsIEVsZW1lbnRhbFByb3BlcnRpZXMgfSBmcm9tICdAL3R5cGVzL2FsY2hlbXknO1xuaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSAnQC91dGlscy9sb2dnZXInO1xuXG4vLyBEZWZpbmUgYSBtb3JlIHNwZWNpZmljIHR5cGUgZm9yIGRpc2ggb2JqZWN0c1xuaW50ZXJmYWNlIFJhd0Rpc2gge1xuICBpZD86IHN0cmluZztcbiAgbmFtZTogc3RyaW5nO1xuICBkZXNjcmlwdGlvbj86IHN0cmluZztcbiAgaW5ncmVkaWVudHM/OiBBcnJheTx7XG4gICAgbmFtZT86IHN0cmluZztcbiAgICBhbW91bnQ/OiBudW1iZXIgfCBzdHJpbmc7XG4gICAgdW5pdD86IHN0cmluZztcbiAgICBwcmVwYXJhdGlvbj86IHN0cmluZztcbiAgICBjYXRlZ29yeT86IHN0cmluZztcbiAgICBvcHRpb25hbD86IGJvb2xlYW47XG4gICAgbm90ZXM/OiBzdHJpbmc7XG4gICAgc3dhcHM/OiBzdHJpbmdbXSB8IHN0cmluZztcbiAgICBzdWJzdGl0dXRlcz86IHN0cmluZ1tdIHwgc3RyaW5nO1xuICB9PjtcbiAgcHJlcGFyYXRpb25TdGVwcz86IHN0cmluZ1tdIHwgc3RyaW5nO1xuICBpbnN0cnVjdGlvbnM/OiBzdHJpbmdbXSB8IHN0cmluZztcbiAgcHJlcFRpbWU/OiBzdHJpbmcgfCBudW1iZXI7XG4gIGNvb2tUaW1lPzogc3RyaW5nIHwgbnVtYmVyO1xuICB0aW1lVG9NYWtlPzogc3RyaW5nO1xuICBlbGVtZW50YWxQcm9wZXJ0aWVzPzogUmVjb3JkPHN0cmluZywgbnVtYmVyPjtcbiAgZWxlbWVudGFsU3RhdGU/OiBSZWNvcmQ8c3RyaW5nLCBudW1iZXI+O1xuICBzZWFzb24/OiBzdHJpbmdbXTtcbiAgbWVhbFR5cGU/OiBzdHJpbmdbXTtcbiAgaXNWZWdldGFyaWFuPzogYm9vbGVhbjtcbiAgaXNWZWdhbj86IGJvb2xlYW47XG4gIGlzR2x1dGVuRnJlZT86IGJvb2xlYW47XG4gIGlzRGFpcnlGcmVlPzogYm9vbGVhbjtcbiAgZGlldGFyeUluZm8/OiBzdHJpbmdbXTtcbiAgbnV0cml0aW9uPzoge1xuICAgIGNhbG9yaWVzPzogbnVtYmVyO1xuICAgIHByb3RlaW4/OiBudW1iZXI7XG4gICAgY2FyYnM/OiBudW1iZXI7XG4gICAgZmF0PzogbnVtYmVyO1xuICAgIHZpdGFtaW5zPzogc3RyaW5nW107XG4gICAgbWluZXJhbHM/OiBzdHJpbmdbXTtcbiAgfTtcbiAgc2VydmluZ1NpemU/OiBudW1iZXIgfCBzdHJpbmc7XG4gIHNlcnZpbmdzPzogbnVtYmVyIHwgc3RyaW5nO1xuICBudW1iZXJPZlNlcnZpbmdzPzogbnVtYmVyIHwgc3RyaW5nO1xuICBhc3Ryb2xvZ2ljYWxJbmZsdWVuY2VzPzogc3RyaW5nW107XG4gIHpvZGlhY0luZmx1ZW5jZXM/OiBzdHJpbmdbXTtcbiAgbHVuYXJQaGFzZUluZmx1ZW5jZXM/OiBzdHJpbmdbXTtcbiAgcGxhbmV0YXJ5SW5mbHVlbmNlcz86IHtcbiAgICBmYXZvcmFibGU/OiBzdHJpbmdbXTtcbiAgICB1bmZhdm9yYWJsZT86IHN0cmluZ1tdO1xuICB9O1xuICBjb29raW5nTWV0aG9kcz86IHN0cmluZ1tdO1xuICBzdWJzdGl0dXRpb25zPzogUmVjb3JkPHN0cmluZywgc3RyaW5nW10gfCBzdHJpbmc+O1xuICB0b29scz86IHN0cmluZ1tdO1xuICBzcGljZUxldmVsPzogc3RyaW5nO1xuICBwcmVwYXJhdGlvbk5vdGVzPzogc3RyaW5nO1xuICBjdWx0dXJhbE5vdGVzPzogc3RyaW5nO1xuICB0ZWNobmljYWxUaXBzPzogc3RyaW5nW10gfCBzdHJpbmc7XG59XG5cbi8vIERlZmluZSBhIHR5cGUgZm9yIHRoZSBzZWFzb25hbCBkaXNoZXMgc3RydWN0dXJlXG5pbnRlcmZhY2UgU2Vhc29uYWxEaXNoQ29sbGVjdGlvbiB7XG4gIGFsbD86IFJhd0Rpc2hbXTtcbiAgc3ByaW5nPzogUmF3RGlzaFtdO1xuICBzdW1tZXI/OiBSYXdEaXNoW107XG4gIGZhbGw/OiBSYXdEaXNoW107XG4gIGF1dHVtbj86IFJhd0Rpc2hbXTtcbiAgd2ludGVyPzogUmF3RGlzaFtdO1xuICBba2V5OiBzdHJpbmddOiBSYXdEaXNoW10gfCB1bmRlZmluZWQ7XG59XG5cbi8vIEFkZCBtaXNzaW5nIGFycmF5IGluZGV4ZXIgdG8gTWVhbENvbGxlY3Rpb25cbmludGVyZmFjZSBNZWFsQ29sbGVjdGlvbiB7XG4gIGJyZWFrZmFzdD86IFNlYXNvbmFsRGlzaENvbGxlY3Rpb247XG4gIGx1bmNoPzogU2Vhc29uYWxEaXNoQ29sbGVjdGlvbjtcbiAgZGlubmVyPzogU2Vhc29uYWxEaXNoQ29sbGVjdGlvbjtcbiAgZGVzc2VydD86IFNlYXNvbmFsRGlzaENvbGxlY3Rpb247XG4gIHNuYWNrcz86IFNlYXNvbmFsRGlzaENvbGxlY3Rpb247XG4gIFtrZXk6IHN0cmluZ106IFNlYXNvbmFsRGlzaENvbGxlY3Rpb24gfCB1bmRlZmluZWQ7XG59XG5cbi8vIEFkZCBkaXNoZXMgcHJvcGVydHkgdG8gQ3Vpc2luZVxuaW50ZXJmYWNlIEV4dGVuZGVkQ3Vpc2luZSBleHRlbmRzIE9taXQ8Q3Vpc2luZSwgJ2Rpc2hlcyc+IHtcbiAgZGlzaGVzPzogTWVhbENvbGxlY3Rpb24gfCB7XG4gICAgZGlzaGVzPzogTWVhbENvbGxlY3Rpb247XG4gIH07XG59XG5cbi8qKlxuICogTG9jYWxSZWNpcGVTZXJ2aWNlIGV4dHJhY3RzIHJlY2lwZXMgZnJvbSBjdWlzaW5lIGZpbGVzXG4gKiBUaGlzIGhlbHBzIHJlZHVjZSBBUEkgY2FsbHMgYnkgdXNpbmcgbG9jYWwgZGF0YSBmaXJzdFxuICovXG5leHBvcnQgY2xhc3MgTG9jYWxSZWNpcGVTZXJ2aWNlIHtcbiAgLy8gTWFpbiBjYWNoZSBvZiBhbGwgZXh0cmFjdGVkIHJlY2lwZXNcbiAgcHJpdmF0ZSBzdGF0aWMgX2FsbFJlY2lwZXM6IFJlY2lwZVtdIHwgbnVsbCA9IG51bGw7XG4gIFxuICAvKipcbiAgICogR2V0IGFsbCBhdmFpbGFibGUgcmVjaXBlc1xuICAgKiBAcmV0dXJucyBBcnJheSBvZiBhbGwgcmVjaXBlc1xuICAgKi9cbiAgc3RhdGljIGFzeW5jIGdldEFsbFJlY2lwZXMoKTogUHJvbWlzZTxSZWNpcGVbXT4ge1xuICAgIC8vIFJldHVybiBjYWNoZWQgcmVjaXBlcyBpZiBhdmFpbGFibGVcbiAgICBpZiAodGhpcy5fYWxsUmVjaXBlcykge1xuICAgICAgcmV0dXJuIHRoaXMuX2FsbFJlY2lwZXM7XG4gICAgfVxuICAgIFxuICAgIHRyeSB7XG4gICAgICBjb25zdCByZWNpcGVzOiBSZWNpcGVbXSA9IFtdO1xuICAgICAgXG4gICAgICAvLyBHZXQgcmVjaXBlcyBmcm9tIGFsbCBhdmFpbGFibGUgY3Vpc2luZXNcbiAgICAgIGZvciAoY29uc3QgY3Vpc2luZSBvZiBPYmplY3QudmFsdWVzKGN1aXNpbmVzTWFwKSkge1xuICAgICAgICBpZiAoY3Vpc2luZSkge1xuICAgICAgICAgIGNvbnN0IGN1aXNpbmVSZWNpcGVzID0gYXdhaXQgdGhpcy5nZXRSZWNpcGVzRnJvbUN1aXNpbmUoY3Vpc2luZSBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPik7XG4gICAgICAgICAgcmVjaXBlcy5wdXNoKC4uLmN1aXNpbmVSZWNpcGVzKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgXG4gICAgICBsb2dnZXIuZGVidWcoYExvYWRlZCAke3JlY2lwZXMubGVuZ3RofSB0b3RhbCByZWNpcGVzYCk7XG4gICAgICBcbiAgICAgIC8vIENhY2hlIHRoZSByZWNpcGVzIGZvciBmdXR1cmUgdXNlXG4gICAgICB0aGlzLl9hbGxSZWNpcGVzID0gcmVjaXBlcztcbiAgICAgIFxuICAgICAgcmV0dXJuIHJlY2lwZXM7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcihcIkVycm9yIGdldHRpbmcgYWxsIHJlY2lwZXM6XCIsIGVycm9yKTtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gIH1cbiAgXG4gIC8qKlxuICAgKiBHZXQgcmVjaXBlcyBmb3IgYSBzcGVjaWZpYyBjdWlzaW5lXG4gICAqIEBwYXJhbSBjdWlzaW5lTmFtZSBUaGUgbmFtZSBvZiB0aGUgY3Vpc2luZVxuICAgKiBAcmV0dXJucyBBcnJheSBvZiByZWNpcGVzIGZvciB0aGF0IGN1aXNpbmVcbiAgICovXG4gIHN0YXRpYyBhc3luYyBnZXRSZWNpcGVzQnlDdWlzaW5lKGN1aXNpbmVOYW1lOiBzdHJpbmcpOiBQcm9taXNlPFJlY2lwZVtdPiB7XG4gICAgaWYgKCFjdWlzaW5lTmFtZSkge1xuICAgICAgbG9nZ2VyLndhcm4oJ05vIGN1aXNpbmUgbmFtZSBwcm92aWRlZCB0byBnZXRSZWNpcGVzQnlDdWlzaW5lJyk7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuICAgIFxuICAgIHRyeSB7XG4gICAgICBsb2dnZXIuZGVidWcoYEdldHRpbmcgcmVjaXBlcyBmb3IgY3Vpc2luZTogJHtjdWlzaW5lTmFtZX1gKTtcbiAgICAgIFxuICAgICAgLy8gTm9ybWFsaXplIGN1aXNpbmUgbmFtZSBmb3IgY29tcGFyaXNvblxuICAgICAgY29uc3Qgbm9ybWFsaXplZE5hbWUgPSBjdWlzaW5lTmFtZS50b0xvd2VyQ2FzZSgpLnRyaW0oKTtcbiAgICAgIFxuICAgICAgLy8gSGFuZGxlIHNwZWNpYWwgY2FzZXMgZm9yIEFmcmljYW4gYW5kIEFtZXJpY2FuIGN1aXNpbmVzXG4gICAgICBpZiAobm9ybWFsaXplZE5hbWUgPT09ICdhZnJpY2FuJyB8fCBub3JtYWxpemVkTmFtZSA9PT0gJ2FtZXJpY2FuJykge1xuICAgICAgICBsb2dnZXIuZGVidWcoYFNwZWNpYWwgaGFuZGxpbmcgZm9yOiAke25vcm1hbGl6ZWROYW1lfWApO1xuICAgICAgICBcbiAgICAgICAgLy8gVHJ5IGRpZmZlcmVudCB3YXlzIHRvIGFjY2VzcyB0aGUgY3Vpc2luZSBkYXRhXG4gICAgICAgIGxldCBkaXJlY3RDdWlzaW5lOiBFeHRlbmRlZEN1aXNpbmUgfCBudWxsID0gbnVsbDtcbiAgICAgICAgXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgLy8gVHJ5IGltcG9ydGluZyB0aGUgY3Vpc2luZSBkaXJlY3RseSBmcm9tIGl0cyBmaWxlIHVzaW5nIGR5bmFtaWMgaW1wb3J0c1xuICAgICAgICAgIGlmIChub3JtYWxpemVkTmFtZSA9PT0gJ2FmcmljYW4nKSB7XG4gICAgICAgICAgICBjb25zdCBhZnJpY2FuTW9kdWxlID0gYXdhaXQgaW1wb3J0KCcuLi9kYXRhL2N1aXNpbmVzL2FmcmljYW4nKTtcbiAgICAgICAgICAgIGRpcmVjdEN1aXNpbmUgPSBhZnJpY2FuTW9kdWxlLmFmcmljYW4gYXMgRXh0ZW5kZWRDdWlzaW5lO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBhbWVyaWNhbk1vZHVsZSA9IGF3YWl0IGltcG9ydCgnLi4vZGF0YS9jdWlzaW5lcy9hbWVyaWNhbicpO1xuICAgICAgICAgICAgZGlyZWN0Q3Vpc2luZSA9IGFtZXJpY2FuTW9kdWxlLmFtZXJpY2FuIGFzIEV4dGVuZGVkQ3Vpc2luZTtcbiAgICAgICAgICB9XG4gICAgICAgICAgXG4gICAgICAgICAgbG9nZ2VyLmRlYnVnKGBEaXJlY3QgaW1wb3J0IHN1Y2Nlc3NmdWwgZm9yICR7bm9ybWFsaXplZE5hbWV9YCk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgbG9nZ2VyLmVycm9yKGBFcnJvciBpbXBvcnRpbmcgJHtub3JtYWxpemVkTmFtZX0gY3Vpc2luZSBkaXJlY3RseTpgLCBlcnJvcik7XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gSWYgZGlyZWN0IGltcG9ydCBmYWlscywgdHJ5IHRoZSBjdWlzaW5lc01hcCBvYmplY3QgKHZhcmlvdXMgY2FzZXMpXG4gICAgICAgICAgZGlyZWN0Q3Vpc2luZSA9IChjdWlzaW5lc01hcFtub3JtYWxpemVkTmFtZV0gfHwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgY3Vpc2luZXNNYXBbbm9ybWFsaXplZE5hbWUuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBub3JtYWxpemVkTmFtZS5zbGljZSgxKV0gfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICBjdWlzaW5lc01hcFtub3JtYWxpemVkTmFtZS50b1VwcGVyQ2FzZSgpXSkgYXMgRXh0ZW5kZWRDdWlzaW5lO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBpZiAoZGlyZWN0Q3Vpc2luZSkge1xuICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhgRm91bmQgJHtub3JtYWxpemVkTmFtZX0gY3Vpc2luZSBkYXRhYCk7XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gQWRkaXRpb25hbCBkZWJ1ZyBpbmZvcm1hdGlvbiB0byBoZWxwIGRpYWdub3NlIGlzc3Vlc1xuICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhgQ3Vpc2luZSBzdHJ1Y3R1cmU6ICR7SlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgICAgaWQ6IGRpcmVjdEN1aXNpbmUuaWQsXG4gICAgICAgICAgICBuYW1lOiBkaXJlY3RDdWlzaW5lLm5hbWUsXG4gICAgICAgICAgICBoYXNEaXNoZXM6ICEhZGlyZWN0Q3Vpc2luZS5kaXNoZXMsXG4gICAgICAgICAgICBkaXNoVHlwZXM6IGRpcmVjdEN1aXNpbmUuZGlzaGVzID8gT2JqZWN0LmtleXMoZGlyZWN0Q3Vpc2luZS5kaXNoZXMpLmpvaW4oJywgJykgOiAnbm9uZScsXG4gICAgICAgICAgICBicmVha2Zhc3Q6ICgoZGlyZWN0Q3Vpc2luZS5kaXNoZXMgYXMgdW5rbm93bltdKT8uYnJlYWtmYXN0Py5hbGw/Lmxlbmd0aCB8fCAoZGlyZWN0Q3Vpc2luZS5kaXNoZXMgYXMgdW5rbm93bltdKT8uZGlzaGVzPy5icmVha2Zhc3Q/LmFsbD8ubGVuZ3RoKSB8fCAwLFxuICAgICAgICAgICAgbHVuY2g6ICgoZGlyZWN0Q3Vpc2luZS5kaXNoZXMgYXMgdW5rbm93bltdKT8ubHVuY2g/LmFsbD8ubGVuZ3RoIHx8IChkaXJlY3RDdWlzaW5lLmRpc2hlcyBhcyB1bmtub3duW10pPy5kaXNoZXM/Lmx1bmNoPy5hbGw/Lmxlbmd0aCkgfHwgMCxcbiAgICAgICAgICAgIGRpbm5lcjogKChkaXJlY3RDdWlzaW5lLmRpc2hlcyBhcyB1bmtub3duW10pPy5kaW5uZXI/LmFsbD8ubGVuZ3RoIHx8IChkaXJlY3RDdWlzaW5lLmRpc2hlcyBhcyB1bmtub3duW10pPy5kaXNoZXM/LmRpbm5lcj8uYWxsPy5sZW5ndGgpIHx8IDAsXG4gICAgICAgICAgICBkZXNzZXJ0OiAoKGRpcmVjdEN1aXNpbmUuZGlzaGVzIGFzIHVua25vd25bXSk/LmRlc3NlcnQ/LmFsbD8ubGVuZ3RoIHx8IChkaXJlY3RDdWlzaW5lLmRpc2hlcyBhcyB1bmtub3duW10pPy5kaXNoZXM/LmRlc3NlcnQ/LmFsbD8ubGVuZ3RoKSB8fCAwXG4gICAgICAgICAgfSl9YCk7XG4gICAgICAgICAgXG4gICAgICAgICAgcmV0dXJuIGF3YWl0IHRoaXMuZ2V0UmVjaXBlc0Zyb21DdWlzaW5lKGRpcmVjdEN1aXNpbmUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnNvbGUud2FybihgQ291bGQgbm90IGZpbmQgJHtub3JtYWxpemVkTmFtZX0gaW4gY3Vpc2luZXNNYXAga2V5czpgLCBPYmplY3Qua2V5cyhjdWlzaW5lc01hcCkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIEZpbmQgdGhlIGN1aXNpbmUgb2JqZWN0IGluIHRoZSByZWd1bGFyIHdheVxuICAgICAgY29uc3QgY3Vpc2luZSA9IE9iamVjdC52YWx1ZXMoY3Vpc2luZXNNYXApLmZpbmQoXG4gICAgICAgIGMgPT4gYz8ubmFtZT8udG9Mb3dlckNhc2UoKSA9PT0gbm9ybWFsaXplZE5hbWVcbiAgICAgICk7XG4gICAgICBcbiAgICAgIGlmICghY3Vpc2luZSkge1xuICAgICAgICAvLyBUcnkgZmluZGluZyB0aGUgY3Vpc2luZSBieSBJRCBvciB2YXJpYXRpb25zIG9mIHRoZSBuYW1lXG4gICAgICAgIGNvbnN0IGJ5SWRNYXRjaCA9IE9iamVjdC5lbnRyaWVzKGN1aXNpbmVzTWFwKS5maW5kKFxuICAgICAgICAgIChbaWQsIGNdKSA9PiBpZC50b0xvd2VyQ2FzZSgpID09PSBub3JtYWxpemVkTmFtZSB8fFxuICAgICAgICAgICAgICAgICAgICBjPy5uYW1lPy50b0xvd2VyQ2FzZSgpID09PSBub3JtYWxpemVkTmFtZSB8fFxuICAgICAgICAgICAgICAgICAgICBjPy5uYW1lPy50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKG5vcm1hbGl6ZWROYW1lKSB8fFxuICAgICAgICAgICAgICAgICAgICBub3JtYWxpemVkTmFtZS5pbmNsdWRlcyhjPy5uYW1lPy50b0xvd2VyQ2FzZSgpKVxuICAgICAgICApO1xuICAgICAgICBcbiAgICAgICAgaWYgKGJ5SWRNYXRjaCAmJiBieUlkTWF0Y2hbMV0pIHtcbiAgICAgICAgICByZXR1cm4gYXdhaXQgdGhpcy5nZXRSZWNpcGVzRnJvbUN1aXNpbmUoYnlJZE1hdGNoWzFdIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgbG9nZ2VyLmluZm8oYEN1aXNpbmUgbm90IGZvdW5kOiAke2N1aXNpbmVOYW1lfWApO1xuICAgICAgICByZXR1cm4gW107XG4gICAgICB9XG4gICAgICBcbiAgICAgIHJldHVybiBhd2FpdCB0aGlzLmdldFJlY2lwZXNGcm9tQ3Vpc2luZShjdWlzaW5lIGFzIEV4dGVuZGVkQ3Vpc2luZSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcihgRXJyb3IgZ2V0dGluZyByZWNpcGVzIGZvciBjdWlzaW5lICR7Y3Vpc2luZU5hbWV9OmAsIGVycm9yKTtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gIH1cbiAgXG4gIC8qKlxuICAgKiBFeHRyYWN0IGFsbCByZWNpcGVzIGZyb20gYSBjdWlzaW5lIG9iamVjdFxuICAgKiBAcGFyYW0gY3Vpc2luZSBUaGUgY3Vpc2luZSBvYmplY3RcbiAgICogQHJldHVybnMgQXJyYXkgb2YgcmVjaXBlc1xuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgYXN5bmMgZ2V0UmVjaXBlc0Zyb21DdWlzaW5lKGN1aXNpbmU6IEV4dGVuZGVkQ3Vpc2luZSk6IFByb21pc2U8UmVjaXBlW10+IHtcbiAgICBpZiAoIWN1aXNpbmUpIHJldHVybiBbXTtcbiAgICBcbiAgICBjb25zdCByZWNpcGVzOiBSZWNpcGVbXSA9IFtdO1xuICAgIGNvbnN0IG1lYWxUeXBlcyA9IFsnYnJlYWtmYXN0JywgJ2x1bmNoJywgJ2Rpbm5lcicsICdkZXNzZXJ0JywgJ3NuYWNrcyddO1xuICAgIFxuICAgIHRyeSB7XG4gICAgICBsb2dnZXIuZGVidWcoYEV4dHJhY3RpbmcgcmVjaXBlcyBmcm9tIGN1aXNpbmU6ICR7Y3Vpc2luZS5uYW1lfWApO1xuICAgICAgXG4gICAgICAvLyBTcGVjaWFsIGhhbmRsaW5nIGZvciBBbWVyaWNhbiBhbmQgQWZyaWNhbiBjdWlzaW5lc1xuICAgICAgY29uc3QgaXNTcGVjaWFsQ2FzZSA9IGN1aXNpbmUubmFtZS50b0xvd2VyQ2FzZSgpID09PSAnYW1lcmljYW4nIHx8IGN1aXNpbmUubmFtZS50b0xvd2VyQ2FzZSgpID09PSAnYWZyaWNhbic7XG4gICAgICBcbiAgICAgIC8vIExvZyBzcGVjaWZpYyBkZWJ1ZyBpbmZvIGZvciBBZnJpY2FuIGN1aXNpbmVcbiAgICAgIGlmIChjdWlzaW5lLm5hbWUudG9Mb3dlckNhc2UoKSA9PT0gJ2FmcmljYW4nKSB7XG4gICAgICAgIGxvZ2dlci5kZWJ1ZygnQUZSSUNBTiBDVUlTSU5FIERFVEFJTEVEIERFQlVHIElORk86Jyk7XG4gICAgICAgIGxvZ2dlci5kZWJ1ZygnRnVsbCBjdWlzaW5lIHN0cnVjdHVyZTonLCBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgICAgaWQ6IGN1aXNpbmUuaWQsXG4gICAgICAgICAgbmFtZTogY3Vpc2luZS5uYW1lLFxuICAgICAgICAgIGRpc2hlc0tleXM6IE9iamVjdC5rZXlzKGN1aXNpbmUuZGlzaGVzIHx8IHt9KSxcbiAgICAgICAgICBicmVha2Zhc3RBbGxMZW5ndGg6ICgoY3Vpc2luZS5kaXNoZXMgYXMgdW5rbm93bltdKT8uYnJlYWtmYXN0Py5hbGw/Lmxlbmd0aCB8fCAoY3Vpc2luZS5kaXNoZXMgYXMgdW5rbm93bltdKT8uZGlzaGVzPy5icmVha2Zhc3Q/LmFsbD8ubGVuZ3RoKSB8fCAwLFxuICAgICAgICAgIGx1bmNoQWxsTGVuZ3RoOiAoKGN1aXNpbmUuZGlzaGVzIGFzIHVua25vd25bXSk/Lmx1bmNoPy5hbGw/Lmxlbmd0aCB8fCAoY3Vpc2luZS5kaXNoZXMgYXMgdW5rbm93bltdKT8uZGlzaGVzPy5sdW5jaD8uYWxsPy5sZW5ndGgpIHx8IDAsXG4gICAgICAgICAgZGlubmVyQWxsTGVuZ3RoOiAoKGN1aXNpbmUuZGlzaGVzIGFzIHVua25vd25bXSk/LmRpbm5lcj8uYWxsPy5sZW5ndGggfHwgKGN1aXNpbmUuZGlzaGVzIGFzIHVua25vd25bXSk/LmRpc2hlcz8uZGlubmVyPy5hbGw/Lmxlbmd0aCkgfHwgMCxcbiAgICAgICAgICBkZXNzZXJ0QWxsTGVuZ3RoOiAoKGN1aXNpbmUuZGlzaGVzIGFzIHVua25vd25bXSk/LmRlc3NlcnQ/LmFsbD8ubGVuZ3RoIHx8IChjdWlzaW5lLmRpc2hlcyBhcyB1bmtub3duW10pPy5kaXNoZXM/LmRlc3NlcnQ/LmFsbD8ubGVuZ3RoKSB8fCAwLFxuICAgICAgICB9KSk7XG4gICAgICAgIFxuICAgICAgICAvLyBDaGVjayBpZiBcImFsbFwiIGFycmF5cyBhY3R1YWxseSBjb250YWluIHJlY2lwZXMgd2l0aCBzYWZlIHR5cGUgY2FzdGluZ1xuICAgICAgICBjb25zdCBkaXNoZXNEYXRhID0gY3Vpc2luZS5kaXNoZXMgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj47XG4gICAgICAgIGNvbnN0IGJyZWFrZmFzdEFsbCA9IGRpc2hlc0RhdGE/LmJyZWFrZmFzdD8uYWxsIHx8IGRpc2hlc0RhdGE/LmRpc2hlcz8uYnJlYWtmYXN0Py5hbGw7XG4gICAgICAgIGlmIChicmVha2Zhc3RBbGw/Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICBsb2dnZXIuZGVidWcoJ1NhbXBsZSBicmVha2Zhc3QgcmVjaXBlOicsIEpTT04uc3RyaW5naWZ5KGJyZWFrZmFzdEFsbFswXSkpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIENoZWNrIGlmIGRpc2hlcyBzdHJ1Y3R1cmUgZXhpc3RzXG4gICAgICBpZiAoIWN1aXNpbmUuZGlzaGVzKSB7XG4gICAgICAgIGxvZ2dlci5kZWJ1ZyhgTm8gZGlzaGVzIGZvdW5kIGZvciBjdWlzaW5lOiAke2N1aXNpbmUubmFtZX1gKTtcbiAgICAgICAgXG4gICAgICAgIGlmIChpc1NwZWNpYWxDYXNlKSB7XG4gICAgICAgICAgY29uc29sZS53YXJuKGBTcGVjaWFsIGNhc2UgKCR7Y3Vpc2luZS5uYW1lfSkgaGFzIG5vIGRpc2hlcyBwcm9wZXJ0eTpgLCBjdWlzaW5lKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgICAgfVxuICAgICAgXG4gICAgICBsb2dnZXIuZGVidWcoYERpc2hlcyBzdHJ1Y3R1cmU6YCwgT2JqZWN0LmtleXMoY3Vpc2luZS5kaXNoZXMgfHwge30pKTtcbiAgICAgIFxuICAgICAgLy8gUXVpY2sgY2hlY2sgZm9yIGFsbCBzZWFzb24gcmVjaXBlcyBpbiBlYWNoIG1lYWwgdHlwZVxuICAgICAgbWVhbFR5cGVzLmZvckVhY2gobWVhbFR5cGUgPT4ge1xuICAgICAgICBpZiAoY3Vpc2luZS5kaXNoZXMgJiYgY3Vpc2luZS5kaXNoZXNbbWVhbFR5cGVdICYmIFxuICAgICAgICAgICAgdHlwZW9mIGN1aXNpbmUuZGlzaGVzW21lYWxUeXBlXSA9PT0gJ29iamVjdCcgJiYgXG4gICAgICAgICAgICBjdWlzaW5lLmRpc2hlc1ttZWFsVHlwZV0uYWxsICYmIFxuICAgICAgICAgICAgQXJyYXkuaXNBcnJheShjdWlzaW5lLmRpc2hlc1ttZWFsVHlwZV0uYWxsKSkge1xuICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhgRm91bmQgJHtjdWlzaW5lLmRpc2hlc1ttZWFsVHlwZV0uYWxsLmxlbmd0aH0gJHttZWFsVHlwZX0gcmVjaXBlcyBpbiAnYWxsJyBzZWFzb24gZm9yICR7Y3Vpc2luZS5uYW1lfWApO1xuICAgICAgICB9IGVsc2UgaWYgKGlzU3BlY2lhbENhc2UpIHtcbiAgICAgICAgICAvLyBEZWJ1ZyBwcm9ibGVtYXRpYyBjdWlzaW5lXG4gICAgICAgICAgY29uc29sZS53YXJuKGBObyAnJHttZWFsVHlwZX0uYWxsJyBhcnJheSBmb3VuZCBmb3IgJHtjdWlzaW5lLm5hbWV9YCk7XG4gICAgICAgICAgaWYgKGN1aXNpbmUuZGlzaGVzICYmIGN1aXNpbmUuZGlzaGVzW21lYWxUeXBlXSkge1xuICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGBTdHJ1Y3R1cmUgb2YgJHttZWFsVHlwZX06YCwgT2JqZWN0LmtleXMoY3Vpc2luZS5kaXNoZXNbbWVhbFR5cGVdKSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgLy8gTG9vcCB0aHJvdWdoIGVhY2ggbWVhbCB0eXBlXG4gICAgICBtZWFsVHlwZXMuZm9yRWFjaChtZWFsVHlwZSA9PiB7XG4gICAgICAgIGlmICghY3Vpc2luZS5kaXNoZXMgfHwgIWN1aXNpbmUuZGlzaGVzW21lYWxUeXBlXSkge1xuICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhgTm8gZGlzaGVzIGZvciBtZWFsIHR5cGU6ICR7bWVhbFR5cGV9YCk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBjb25zdCBzZWFzb25hbERpc2hlcyA9IGN1aXNpbmUuZGlzaGVzW21lYWxUeXBlXSBhcyBTZWFzb25hbERpc2hDb2xsZWN0aW9uO1xuICAgICAgICBsb2dnZXIuZGVidWcoYE1lYWwgdHlwZSAke21lYWxUeXBlfSBzdHJ1Y3R1cmU6YCwgSlNPTi5zdHJpbmdpZnkoT2JqZWN0LmtleXMoc2Vhc29uYWxEaXNoZXMgfHwge30pKSk7XG4gICAgICAgIFxuICAgICAgICAvLyBQcm9jZXNzIHNlYXNvbmFsIHJlY2lwZXMgKHNwcmluZywgc3VtbWVyLCBhdXR1bW4sIHdpbnRlcilcbiAgICAgICAgY29uc3Qgc2Vhc29ucyA9IFsnc3ByaW5nJywgJ3N1bW1lcicsICdhdXR1bW4nLCAnd2ludGVyJ107XG4gICAgICAgIHNlYXNvbnMuZm9yRWFjaChzZWFzb24gPT4ge1xuICAgICAgICAgIC8vIFVzZSBib3RoIHNlYXNvbiBhbmQgaXRzIGFsdGVybmF0aXZlIG5hbWUgKGF1dHVtbi9mYWxsKVxuICAgICAgICAgIGNvbnN0IHNlYXNvbmFsS2V5ID0gc2Vhc29uID09PSAnYXV0dW1uJyA/ICdmYWxsJyA6IChzZWFzb24gPT09ICdmYWxsJyA/ICdhdXR1bW4nIDogc2Vhc29uKTtcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBHZXQgcmVjaXBlcyBmb3IgdGhlIHNlYXNvblxuICAgICAgICAgIGxldCBzZWFzb25SZWNpcGVzOiBSYXdEaXNoW10gPSBbXTtcbiAgICAgICAgICBpZiAoc2Vhc29uYWxEaXNoZXNbc2Vhc29uXSAmJiBBcnJheS5pc0FycmF5KHNlYXNvbmFsRGlzaGVzW3NlYXNvbl0pKSB7XG4gICAgICAgICAgICBzZWFzb25SZWNpcGVzID0gc2Vhc29uYWxEaXNoZXNbc2Vhc29uXSB8fCBbXTtcbiAgICAgICAgICB9IGVsc2UgaWYgKHNlYXNvbmFsRGlzaGVzW3NlYXNvbmFsS2V5XSAmJiBBcnJheS5pc0FycmF5KHNlYXNvbmFsRGlzaGVzW3NlYXNvbmFsS2V5XSkpIHtcbiAgICAgICAgICAgIHNlYXNvblJlY2lwZXMgPSBzZWFzb25hbERpc2hlc1tzZWFzb25hbEtleV0gfHwgW107XG4gICAgICAgICAgfVxuICAgICAgICAgIFxuICAgICAgICAgIGlmIChzZWFzb25SZWNpcGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhgRm91bmQgJHtzZWFzb25SZWNpcGVzLmxlbmd0aH0gZGlzaGVzIGZvciAke3NlYXNvbn0gaW4gJHttZWFsVHlwZX1gKTtcbiAgICAgICAgICAgIC8vIEFkZCBvbmx5IHVuaXF1ZSByZWNpcGVzIGJhc2VkIG9uIG5hbWUgdG8gYXZvaWQgZHVwbGljYXRlcyBmcm9tICdhbGwnIG1lcmdpbmdcbiAgICAgICAgICAgIHNlYXNvblJlY2lwZXMuZm9yRWFjaChkaXNoID0+IHtcbiAgICAgICAgICAgICAgaWYgKGRpc2ggJiYgZGlzaC5uYW1lICYmICFyZWNpcGVzLnNvbWUociA9PiByLm5hbWUgPT09IGRpc2gubmFtZSkpIHtcbiAgICAgICAgICAgICAgICByZWNpcGVzLnB1c2godGhpcy5zdGFuZGFyZGl6ZVJlY2lwZShkaXNoLCBjdWlzaW5lLm5hbWUsIFtzZWFzb25dLCBbbWVhbFR5cGVdKSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0gZWxzZSBpZiAoaXNTcGVjaWFsQ2FzZSkge1xuICAgICAgICAgICAgY29uc29sZS53YXJuKGBObyByZWNpcGVzIGZvdW5kIGZvciAke3NlYXNvbn0gaW4gJHttZWFsVHlwZX0gZm9yICR7Y3Vpc2luZS5uYW1lfWApO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgbG9nZ2VyLmRlYnVnKGBFeHRyYWN0ZWQgJHtyZWNpcGVzLmxlbmd0aH0gdG90YWwgcmVjaXBlcyBmcm9tICR7Y3Vpc2luZS5uYW1lfSBjdWlzaW5lYCk7XG4gICAgICBcbiAgICAgIC8vIElmIG5vIHJlY2lwZXMgd2VyZSBmb3VuZCwgbG9nIGN1aXNpbmUgc3RydWN0dXJlIHRvIGhlbHAgZGVidWdcbiAgICAgIGlmIChyZWNpcGVzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICBjb25zb2xlLndhcm4oYE5vIHJlY2lwZXMgZXh0cmFjdGVkIGZvciAke2N1aXNpbmUubmFtZX0uIEN1aXNpbmUgc3RydWN0dXJlOmAsIFxuICAgICAgICAgIEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICAgIGlkOiBjdWlzaW5lLmlkLFxuICAgICAgICAgICAgbmFtZTogY3Vpc2luZS5uYW1lLFxuICAgICAgICAgICAgZGlzaGVzS2V5czogT2JqZWN0LmtleXMoY3Vpc2luZS5kaXNoZXMgfHwge30pLFxuICAgICAgICAgICAgaGFzRGlzaGVzOiAhIWN1aXNpbmUuZGlzaGVzLFxuICAgICAgICAgICAgZGlzaGVzU3RydWN0dXJlOiBPYmplY3QuZW50cmllcyhjdWlzaW5lLmRpc2hlcyB8fCB7fSkubWFwKChba2V5LCB2YWx1ZV0pID0+ICh7XG4gICAgICAgICAgICAgIG1lYWxUeXBlOiBrZXksXG4gICAgICAgICAgICAgIGhhc1ZhbHVlOiAhIXZhbHVlLFxuICAgICAgICAgICAgICBzZWFzb25LZXlzOiB2YWx1ZSA/IE9iamVjdC5rZXlzKHZhbHVlKSA6IFtdLFxuICAgICAgICAgICAgICBoYXNBbGw6ICEhKHZhbHVlICYmIHZhbHVlLmFsbCksXG4gICAgICAgICAgICAgIGFsbElzQXJyYXk6ICEhKHZhbHVlICYmIHZhbHVlLmFsbCAmJiBBcnJheS5pc0FycmF5KHZhbHVlLmFsbCkpLFxuICAgICAgICAgICAgICBhbGxMZW5ndGg6IHZhbHVlICYmIHZhbHVlLmFsbCAmJiBBcnJheS5pc0FycmF5KHZhbHVlLmFsbCkgPyB2YWx1ZS5hbGwubGVuZ3RoIDogMFxuICAgICAgICAgICAgfSkpXG4gICAgICAgICAgfSwgbnVsbCwgMilcbiAgICAgICAgKTtcbiAgICAgICAgXG4gICAgICAgIC8vIENoZWNrIGlmIHRoZSBkaXNoZXMgcHJvcGVydHkgbWlnaHQgYmUgbmVzdGVkIGluY29ycmVjdGx5XG4gICAgICAgIGlmIChjdWlzaW5lLmRpc2hlcyAmJiB0eXBlb2YgY3Vpc2luZS5kaXNoZXMuZGlzaGVzID09PSAnb2JqZWN0Jykge1xuICAgICAgICAgIGxvZ2dlci5kZWJ1ZygnRm91bmQgbmVzdGVkIGRpc2hlcyBwcm9wZXJ0eSwgdHJ5aW5nIHRvIGV4dHJhY3QgZnJvbSB0aGVyZSBpbnN0ZWFkJyk7XG4gICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0UmVjaXBlc0Zyb21DdWlzaW5lKHsuLi5jdWlzaW5lLCBkaXNoZXM6IGN1aXNpbmUuZGlzaGVzLmRpc2hlcyBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPn0pO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBcbiAgICAgIHJldHVybiByZWNpcGVzO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoYEVycm9yIGV4dHJhY3RpbmcgcmVjaXBlcyBmcm9tIGN1aXNpbmUgJHtjdWlzaW5lLm5hbWV9OmAsIGVycm9yKTtcbiAgICAgIGxvZ2dlci5lcnJvcihgRXJyb3IgZXh0cmFjdGluZyByZWNpcGVzIGZyb20gY3Vpc2luZSAke2N1aXNpbmUubmFtZX06YCwgZXJyb3IpO1xuICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbiAgfVxuICBcbiAgLyoqXG4gICAqIFN0YW5kYXJkaXplIGEgcmVjaXBlIHRvIG1hdGNoIG91ciBSZWNpcGUgdHlwZVxuICAgKiBAcGFyYW0gZGlzaCBUaGUgZGlzaCBvYmplY3QgZnJvbSBjdWlzaW5lIGRhdGFcbiAgICogQHBhcmFtIGN1aXNpbmVOYW1lIFRoZSBjdWlzaW5lIG5hbWVcbiAgICogQHBhcmFtIHNlYXNvbnMgVGhlIHNlYXNvbnMgZm9yIHRoaXMgZGlzaFxuICAgKiBAcGFyYW0gbWVhbFR5cGVzIFRoZSBtZWFsIHR5cGVzIGZvciB0aGlzIGRpc2hcbiAgICogQHJldHVybnMgU3RhbmRhcmRpemVkIHJlY2lwZVxuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgc3RhbmRhcmRpemVSZWNpcGUoXG4gICAgZGlzaDogUmF3RGlzaCwgXG4gICAgY3Vpc2luZU5hbWU6IHN0cmluZywgXG4gICAgc2Vhc29uczogc3RyaW5nW10gPSBbJ2FsbCddLFxuICAgIG1lYWxUeXBlczogc3RyaW5nW10gPSBbJ2FueSddXG4gICk6IFJlY2lwZSB7XG4gICAgdHJ5IHtcbiAgICAgIGlmICghZGlzaCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0Rpc2ggb2JqZWN0IGlzIG51bGwgb3IgdW5kZWZpbmVkJyk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIEdlbmVyYXRlIGEgZGV0ZXJtaW5pc3RpYyBJRCBpZiBub25lIGV4aXN0c1xuICAgICAgY29uc3QgaWQgPSBkaXNoLmlkIHx8IGAke2N1aXNpbmVOYW1lLnRvTG93ZXJDYXNlKCl9LSR7ZGlzaC5uYW1lLnRvTG93ZXJDYXNlKCkucmVwbGFjZSgvXFxzKy9nLCAnLScpfWA7XG4gICAgICBcbiAgICAgIC8vIE1hcCBjdWlzaW5lIGluZ3JlZGllbnRzIHRvIG91ciBSZWNpcGVJbmdyZWRpZW50IHR5cGVcbiAgICAgIGNvbnN0IGluZ3JlZGllbnRzID0gKEFycmF5LmlzQXJyYXkoZGlzaC5pbmdyZWRpZW50cykgPyBkaXNoLmluZ3JlZGllbnRzIDogW10pLm1hcChpbmcgPT4ge1xuICAgICAgICBpZiAoIWluZykgcmV0dXJuIHtcbiAgICAgICAgICBuYW1lOiAndW5rbm93biBpbmdyZWRpZW50JyxcbiAgICAgICAgICBhbW91bnQ6IDEsXG4gICAgICAgICAgdW5pdDogJ3VuaXQnXG4gICAgICAgIH07XG4gICAgICAgIFxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgIG5hbWU6IGluZy5uYW1lIHx8ICcnLFxuICAgICAgICAgIGFtb3VudDogaW5nLmFtb3VudCA/ICh0eXBlb2YgaW5nLmFtb3VudCA9PT0gJ3N0cmluZycgPyBwYXJzZUZsb2F0KGluZy5hbW91bnQpIHx8IDEgOiBpbmcuYW1vdW50KSA6IDEsXG4gICAgICAgICAgdW5pdDogaW5nLnVuaXQgfHwgJycsXG4gICAgICAgICAgcHJlcGFyYXRpb246IGluZy5wcmVwYXJhdGlvbiB8fCAnJyxcbiAgICAgICAgICBjYXRlZ29yeTogaW5nLmNhdGVnb3J5IHx8ICcnLFxuICAgICAgICAgIG9wdGlvbmFsOiBpbmcub3B0aW9uYWwgfHwgZmFsc2UsXG4gICAgICAgICAgbm90ZXM6IGluZy5ub3RlcyB8fCAnJyxcbiAgICAgICAgICBzdWJzdGl0dXRlczogQXJyYXkuaXNBcnJheShpbmcuc3dhcHMpID8gaW5nLnN3YXBzIDogXG4gICAgICAgICAgICAgICAgICAgICAgQXJyYXkuaXNBcnJheShpbmcuc3Vic3RpdHV0ZXMpID8gaW5nLnN1YnN0aXR1dGVzIDpcbiAgICAgICAgICAgICAgICAgICAgICB0eXBlb2YgaW5nLnN3YXBzID09PSAnc3RyaW5nJyA/IFtpbmcuc3dhcHNdIDpcbiAgICAgICAgICAgICAgICAgICAgICB0eXBlb2YgaW5nLnN1YnN0aXR1dGVzID09PSAnc3RyaW5nJyA/IFtpbmcuc3Vic3RpdHV0ZXNdIDogW11cbiAgICAgICAgfTtcbiAgICAgIH0pO1xuICAgICAgXG4gICAgICAvLyBFbnN1cmUgZWxlbWVudGFsUHJvcGVydGllcyBleGlzdCAtIGNoZWNraW5nIGFsbCBwb3NzaWJsZSBwcm9wZXJ0eSBuYW1lc1xuICAgICAgbGV0IGVsZW1lbnRhbFByb3BlcnRpZXM6IEVsZW1lbnRhbFByb3BlcnRpZXM7XG4gICAgICBpZiAoZGlzaC5lbGVtZW50YWxQcm9wZXJ0aWVzKSB7XG4gICAgICAgIGVsZW1lbnRhbFByb3BlcnRpZXMgPSBkaXNoLmVsZW1lbnRhbFByb3BlcnRpZXMgYXMgRWxlbWVudGFsUHJvcGVydGllcztcbiAgICAgIH0gZWxzZSBpZiAoZGlzaC5lbGVtZW50YWxTdGF0ZSAmJiB0eXBlb2YgZGlzaC5lbGVtZW50YWxTdGF0ZSA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgLy8gQ29udmVydCBSZWNvcmQ8c3RyaW5nLCBudW1iZXI+IHRvIEVsZW1lbnRhbFByb3BlcnRpZXNcbiAgICAgICAgY29uc3Qgc3RhdGUgPSBkaXNoLmVsZW1lbnRhbFN0YXRlIGFzIFJlY29yZDxzdHJpbmcsIG51bWJlcj47XG4gICAgICAgIGVsZW1lbnRhbFByb3BlcnRpZXMgPSB7XG4gICAgICAgICAgRmlyZTogc3RhdGUuRmlyZSB8fCBzdGF0ZS5maXJlIHx8IDAuMjUsXG4gICAgICAgICAgV2F0ZXI6IHN0YXRlLldhdGVyIHx8IHN0YXRlLndhdGVyIHx8IDAuMjUsXG4gICAgICAgICAgRWFydGg6IHN0YXRlLkVhcnRoIHx8IHN0YXRlLmVhcnRoIHx8IDAuMjUsXG4gICAgICAgICAgQWlyOiBzdGF0ZS5BaXIgfHwgc3RhdGUuYWlyIHx8IDAuMjVcbiAgICAgICAgfTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGVsZW1lbnRhbFByb3BlcnRpZXMgPSB7XG4gICAgICAgICAgRmlyZTogMC4yNSxcbiAgICAgICAgICBXYXRlcjogMC4yNSxcbiAgICAgICAgICBFYXJ0aDogMC4yNSxcbiAgICAgICAgICBBaXI6IDAuMjVcbiAgICAgICAgfTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gTWFrZSBzdXJlIGFsbCBlbGVtZW50YWwgcHJvcGVydGllcyBhcmUgbnVtYmVyc1xuICAgICAgZWxlbWVudGFsUHJvcGVydGllcyA9IHtcbiAgICAgICAgRmlyZTogdHlwZW9mIGVsZW1lbnRhbFByb3BlcnRpZXMuRmlyZSA9PT0gJ251bWJlcicgPyBlbGVtZW50YWxQcm9wZXJ0aWVzLkZpcmUgOiAwLjI1LFxuICAgICAgICBXYXRlcjogdHlwZW9mIGVsZW1lbnRhbFByb3BlcnRpZXMuV2F0ZXIgPT09ICdudW1iZXInID8gZWxlbWVudGFsUHJvcGVydGllcy5XYXRlciA6IDAuMjUsXG4gICAgICAgIEVhcnRoOiB0eXBlb2YgZWxlbWVudGFsUHJvcGVydGllcy5FYXJ0aCA9PT0gJ251bWJlcicgPyBlbGVtZW50YWxQcm9wZXJ0aWVzLkVhcnRoIDogMC4yNSxcbiAgICAgICAgQWlyOiB0eXBlb2YgZWxlbWVudGFsUHJvcGVydGllcy5BaXIgPT09ICdudW1iZXInID8gZWxlbWVudGFsUHJvcGVydGllcy5BaXIgOiAwLjI1XG4gICAgICB9O1xuICAgICAgXG4gICAgICAvLyBTdGFuZGFyZGl6ZSB0aW1pbmcgaW5mb3JtYXRpb25cbiAgICAgIGNvbnN0IHByZXBUaW1lID0gZGlzaC5wcmVwVGltZSB8fCAnJztcbiAgICAgIGNvbnN0IGNvb2tUaW1lID0gZGlzaC5jb29rVGltZSB8fCAnJztcbiAgICAgIFxuICAgICAgLy8gUGFyc2UgdGltZVRvTWFrZSBmcm9tIHByZXBUaW1lIGFuZCBjb29rVGltZSBpZiBhdmFpbGFibGVcbiAgICAgIGxldCB0aW1lVG9NYWtlID0gZGlzaC50aW1lVG9NYWtlIHx8ICcnO1xuICAgICAgaWYgKCF0aW1lVG9NYWtlICYmIHByZXBUaW1lICYmIGNvb2tUaW1lKSB7XG4gICAgICAgIGNvbnN0IHByZXBNaW51dGVzID0gcGFyc2VJbnQocHJlcFRpbWUudG9TdHJpbmcoKS5zcGxpdCgnICcpWzBdKSB8fCAwO1xuICAgICAgICBjb25zdCBjb29rTWludXRlcyA9IHBhcnNlSW50KGNvb2tUaW1lLnRvU3RyaW5nKCkuc3BsaXQoJyAnKVswXSkgfHwgMDtcbiAgICAgICAgdGltZVRvTWFrZSA9IGAke3ByZXBNaW51dGVzICsgY29va01pbnV0ZXN9IG1pbnV0ZXNgO1xuICAgICAgfVxuICAgICAgaWYgKCF0aW1lVG9NYWtlKSB7XG4gICAgICAgIHRpbWVUb01ha2UgPSAnMzAgbWludXRlcyc7IC8vIERlZmF1bHRcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gR2V0IGluc3RydWN0aW9ucyBmcm9tIHByZXBhcmF0aW9uU3RlcHMgb3IgaW5zdHJ1Y3Rpb25zIGZpZWxkXG4gICAgICBsZXQgaW5zdHJ1Y3Rpb25zID0gW107XG4gICAgICBpZiAoQXJyYXkuaXNBcnJheShkaXNoLnByZXBhcmF0aW9uU3RlcHMpICYmIGRpc2gucHJlcGFyYXRpb25TdGVwcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGluc3RydWN0aW9ucyA9IGRpc2gucHJlcGFyYXRpb25TdGVwcztcbiAgICAgIH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShkaXNoLmluc3RydWN0aW9ucykgJiYgZGlzaC5pbnN0cnVjdGlvbnMubGVuZ3RoID4gMCkge1xuICAgICAgICBpbnN0cnVjdGlvbnMgPSBkaXNoLmluc3RydWN0aW9ucztcbiAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGRpc2gucHJlcGFyYXRpb25TdGVwcyA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgaW5zdHJ1Y3Rpb25zID0gW2Rpc2gucHJlcGFyYXRpb25TdGVwc107XG4gICAgICB9IGVsc2UgaWYgKHR5cGVvZiBkaXNoLmluc3RydWN0aW9ucyA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgaW5zdHJ1Y3Rpb25zID0gW2Rpc2guaW5zdHJ1Y3Rpb25zXTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGluc3RydWN0aW9ucyA9IFsnUGxhY2UgYWxsIGluZ3JlZGllbnRzIGluIGEgcG90IGFuZCBjb29rIHVudGlsIGRvbmUuJ107XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIFByb2Nlc3MgbnV0cml0aW9uIGluZm9ybWF0aW9uXG4gICAgICBjb25zdCBudXRyaXRpb24gPSBkaXNoLm51dHJpdGlvbiA/IHtcbiAgICAgICAgY2Fsb3JpZXM6IGRpc2gubnV0cml0aW9uLmNhbG9yaWVzLFxuICAgICAgICBwcm90ZWluOiBkaXNoLm51dHJpdGlvbi5wcm90ZWluLFxuICAgICAgICBjYXJiczogZGlzaC5udXRyaXRpb24uY2FyYnMsXG4gICAgICAgIGZhdDogZGlzaC5udXRyaXRpb24uZmF0LFxuICAgICAgICB2aXRhbWluczogZGlzaC5udXRyaXRpb24udml0YW1pbnMgfHwgW10sXG4gICAgICAgIG1pbmVyYWxzOiBkaXNoLm51dHJpdGlvbi5taW5lcmFscyB8fCBbXVxuICAgICAgfSA6IHVuZGVmaW5lZDtcbiAgICAgIFxuICAgICAgLy8gUHJvY2VzcyBzdWJzdGl0dXRpb25zXG4gICAgICBsZXQgc3Vic3RpdHV0aW9ucyA9IFtdO1xuICAgICAgaWYgKGRpc2guc3Vic3RpdHV0aW9ucyAmJiB0eXBlb2YgZGlzaC5zdWJzdGl0dXRpb25zID09PSAnb2JqZWN0Jykge1xuICAgICAgICAvLyBDb252ZXJ0IGZyb20ge2luZ3JlZGllbnQ6IFthbHRlcm5hdGl2ZXNdfSBmb3JtYXRcbiAgICAgICAgc3Vic3RpdHV0aW9ucyA9IE9iamVjdC5lbnRyaWVzKGRpc2guc3Vic3RpdHV0aW9ucykubWFwKChbb3JpZ2luYWwsIGFsdGVybmF0aXZlc10pID0+ICh7XG4gICAgICAgICAgb3JpZ2luYWwsXG4gICAgICAgICAgYWx0ZXJuYXRpdmVzOiBBcnJheS5pc0FycmF5KGFsdGVybmF0aXZlcykgPyBhbHRlcm5hdGl2ZXMgOiBbYWx0ZXJuYXRpdmVzIGFzIHN0cmluZ11cbiAgICAgICAgfSkpO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBHZXQgbnVtYmVyIG9mIHNlcnZpbmdzXG4gICAgICBjb25zdCBzZXJ2aW5nU2l6ZSA9IGRpc2guc2VydmluZ1NpemUgfHwgZGlzaC5udW1iZXJPZlNlcnZpbmdzIHx8IGRpc2guc2VydmluZ3MgfHwgNDtcbiAgICAgIFxuICAgICAgLy8gQ3JlYXRlIHN0YW5kYXJkaXplZCByZWNpcGVcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlkLFxuICAgICAgICBuYW1lOiBkaXNoLm5hbWUsXG4gICAgICAgIGRlc2NyaXB0aW9uOiBkaXNoLmRlc2NyaXB0aW9uIHx8ICcnLFxuICAgICAgICBjdWlzaW5lOiBjdWlzaW5lTmFtZSxcbiAgICAgICAgaW5ncmVkaWVudHM6IGluZ3JlZGllbnRzLFxuICAgICAgICBpbnN0cnVjdGlvbnM6IGluc3RydWN0aW9ucyxcbiAgICAgICAgdGltZVRvTWFrZTogdGltZVRvTWFrZSxcbiAgICAgICAgbnVtYmVyT2ZTZXJ2aW5nczogdHlwZW9mIHNlcnZpbmdTaXplID09PSAnbnVtYmVyJyA/IHNlcnZpbmdTaXplIDogcGFyc2VJbnQoc2VydmluZ1NpemUpIHx8IDQsXG4gICAgICAgIGVsZW1lbnRhbFByb3BlcnRpZXM6IGVsZW1lbnRhbFByb3BlcnRpZXMsXG4gICAgICAgIHNlYXNvbjogQXJyYXkuaXNBcnJheShkaXNoLnNlYXNvbikgPyBkaXNoLnNlYXNvbiA6IHNlYXNvbnMsXG4gICAgICAgIG1lYWxUeXBlOiBBcnJheS5pc0FycmF5KGRpc2gubWVhbFR5cGUpID8gZGlzaC5tZWFsVHlwZSA6IG1lYWxUeXBlcyxcbiAgICAgICAgaXNWZWdldGFyaWFuOiBkaXNoLmlzVmVnZXRhcmlhbiB8fCBkaXNoLmRpZXRhcnlJbmZvPy5pbmNsdWRlcygndmVnZXRhcmlhbicpIHx8IGZhbHNlLFxuICAgICAgICBpc1ZlZ2FuOiBkaXNoLmlzVmVnYW4gfHwgZGlzaC5kaWV0YXJ5SW5mbz8uaW5jbHVkZXMoJ3ZlZ2FuJykgfHwgZmFsc2UsXG4gICAgICAgIGlzR2x1dGVuRnJlZTogZGlzaC5pc0dsdXRlbkZyZWUgfHwgZGlzaC5kaWV0YXJ5SW5mbz8uaW5jbHVkZXMoJ2dsdXRlbi1mcmVlJykgfHwgZmFsc2UsXG4gICAgICAgIGlzRGFpcnlGcmVlOiBkaXNoLmlzRGFpcnlGcmVlIHx8IGRpc2guZGlldGFyeUluZm8/LmluY2x1ZGVzKCdkYWlyeS1mcmVlJykgfHwgZmFsc2UsXG4gICAgICAgIG51dHJpdGlvbjogbnV0cml0aW9uLFxuICAgICAgICBhc3Ryb2xvZ2ljYWxJbmZsdWVuY2VzOiBBcnJheS5pc0FycmF5KGRpc2guYXN0cm9sb2dpY2FsSW5mbHVlbmNlcykgPyBkaXNoLmFzdHJvbG9naWNhbEluZmx1ZW5jZXMgOiBbXSxcbiAgICAgICAgem9kaWFjSW5mbHVlbmNlczogQXJyYXkuaXNBcnJheShkaXNoLnpvZGlhY0luZmx1ZW5jZXMpID8gZGlzaC56b2RpYWNJbmZsdWVuY2VzIGFzIFpvZGlhY1NpZ25bXSA6IFtdLFxuICAgICAgICBsdW5hclBoYXNlSW5mbHVlbmNlczogQXJyYXkuaXNBcnJheShkaXNoLmx1bmFyUGhhc2VJbmZsdWVuY2VzKSA/IGRpc2gubHVuYXJQaGFzZUluZmx1ZW5jZXMgYXMgTHVuYXJQaGFzZVtdIDogW10sXG4gICAgICAgIHBsYW5ldGFyeUluZmx1ZW5jZXM6IHtcbiAgICAgICAgICBmYXZvcmFibGU6IGRpc2gucGxhbmV0YXJ5SW5mbHVlbmNlcz8uZmF2b3JhYmxlIHx8IFtdLFxuICAgICAgICAgIHVuZmF2b3JhYmxlOiBkaXNoLnBsYW5ldGFyeUluZmx1ZW5jZXM/LnVuZmF2b3JhYmxlIHx8IFtdXG4gICAgICAgIH0sXG4gICAgICAgIGNvb2tpbmdNZXRob2RzOiBBcnJheS5pc0FycmF5KGRpc2guY29va2luZ01ldGhvZHMpID8gZGlzaC5jb29raW5nTWV0aG9kcyA6IFtdLFxuICAgICAgICAvLyBOZXcgZmllbGRzXG4gICAgICAgIHN1YnN0aXR1dGlvbnM6IHN1YnN0aXR1dGlvbnMsXG4gICAgICAgIHRvb2xzOiBBcnJheS5pc0FycmF5KGRpc2gudG9vbHMpID8gZGlzaC50b29scyA6IFtdLFxuICAgICAgICBzZXJ2aW5nU2l6ZTogdHlwZW9mIHNlcnZpbmdTaXplID09PSAnbnVtYmVyJyA/IHNlcnZpbmdTaXplIDogcGFyc2VJbnQoc2VydmluZ1NpemUpIHx8IDQsIFxuICAgICAgICBzcGljZUxldmVsOiAoZGlzaC5zcGljZUxldmVsID09PSAnaG90JyB8fCBkaXNoLnNwaWNlTGV2ZWwgPT09ICdtaWxkJyB8fCBkaXNoLnNwaWNlTGV2ZWwgPT09ICdtZWRpdW0nIHx8IGRpc2guc3BpY2VMZXZlbCA9PT0gJ3ZlcnkgaG90JykgPyBkaXNoLnNwaWNlTGV2ZWwgOiAnbWlsZCcsXG4gICAgICAgIHByZXBhcmF0aW9uTm90ZXM6IGRpc2gucHJlcGFyYXRpb25Ob3RlcyB8fCBkaXNoLmN1bHR1cmFsTm90ZXMgfHwgJycsXG4gICAgICAgIHRlY2huaWNhbFRpcHM6IEFycmF5LmlzQXJyYXkoZGlzaC50ZWNobmljYWxUaXBzKSA/IGRpc2gudGVjaG5pY2FsVGlwcyA6IFtdXG4gICAgICB9O1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoJ0Vycm9yIHN0YW5kYXJkaXppbmcgcmVjaXBlOicsIGVycm9yKTtcbiAgICAgIHJldHVybiB7XG4gICAgICAgIGlkOiBgZXJyb3ItJHtNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHJpbmcoMiwgMTEpfWAsXG4gICAgICAgIG5hbWU6IGRpc2g/Lm5hbWUgfHwgJ1Vua25vd24gUmVjaXBlJyxcbiAgICAgICAgZGVzY3JpcHRpb246ICdFcnJvciBsb2FkaW5nIHJlY2lwZSBkZXRhaWxzJyxcbiAgICAgICAgY3Vpc2luZTogY3Vpc2luZU5hbWUsXG4gICAgICAgIGluZ3JlZGllbnRzOiBbXSxcbiAgICAgICAgaW5zdHJ1Y3Rpb25zOiBbJ1JlY2lwZSBkZXRhaWxzIHVuYXZhaWxhYmxlJ10sXG4gICAgICAgIHRpbWVUb01ha2U6ICcwIG1pbnV0ZXMnLFxuICAgICAgICBudW1iZXJPZlNlcnZpbmdzOiAwLFxuICAgICAgICBlbGVtZW50YWxQcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgRmlyZTogMC4yNSxcbiAgICAgICAgICBXYXRlcjogMC4yNSxcbiAgICAgICAgICBFYXJ0aDogMC4yNSxcbiAgICAgICAgICBBaXI6IDAuMjVcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9XG4gIH1cbiAgXG4gIC8qKlxuICAgKiBTZWFyY2ggcmVjaXBlcyBieSBxdWVyeSBzdHJpbmdcbiAgICogQHBhcmFtIHF1ZXJ5IFNlYXJjaCBxdWVyeVxuICAgKiBAcmV0dXJucyBBcnJheSBvZiByZWNpcGVzIG1hdGNoaW5nIHRoZSBxdWVyeVxuICAgKi9cbiAgc3RhdGljIGFzeW5jIHNlYXJjaFJlY2lwZXMocXVlcnk6IHN0cmluZyk6IFByb21pc2U8UmVjaXBlW10+IHtcbiAgICBpZiAoIXF1ZXJ5KSByZXR1cm4gW107XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IG5vcm1hbGl6ZWRRdWVyeSA9IHF1ZXJ5LnRvTG93ZXJDYXNlKCkudHJpbSgpO1xuICAgICAgY29uc3QgcmVjaXBlcyA9IGF3YWl0IHRoaXMuZ2V0QWxsUmVjaXBlcygpO1xuICAgICAgXG4gICAgICByZXR1cm4gcmVjaXBlcy5maWx0ZXIocmVjaXBlID0+IHtcbiAgICAgICAgLy8gU2VhcmNoIGluIHJlY2lwZSBuYW1lXG4gICAgICAgIGlmIChyZWNpcGUubmFtZSAmJiByZWNpcGUubmFtZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKG5vcm1hbGl6ZWRRdWVyeSkpIHtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLy8gU2VhcmNoIGluIHJlY2lwZSBkZXNjcmlwdGlvblxuICAgICAgICBpZiAocmVjaXBlLmRlc2NyaXB0aW9uICYmIHJlY2lwZS5kZXNjcmlwdGlvbi50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKG5vcm1hbGl6ZWRRdWVyeSkpIHtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgLy8gU2VhcmNoIGluIGluZ3JlZGllbnRzXG4gICAgICAgIGlmIChyZWNpcGUuaW5ncmVkaWVudHMgJiYgQXJyYXkuaXNBcnJheShyZWNpcGUuaW5ncmVkaWVudHMpKSB7XG4gICAgICAgICAgZm9yIChjb25zdCBpbmdyZWRpZW50IG9mIHJlY2lwZS5pbmdyZWRpZW50cykge1xuICAgICAgICAgICAgY29uc3QgaW5ncmVkaWVudE5hbWUgPSB0eXBlb2YgaW5ncmVkaWVudCA9PT0gJ3N0cmluZycgXG4gICAgICAgICAgICAgID8gaW5ncmVkaWVudCBcbiAgICAgICAgICAgICAgOiBpbmdyZWRpZW50Lm5hbWU7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmIChpbmdyZWRpZW50TmFtZSAmJiBpbmdyZWRpZW50TmFtZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKG5vcm1hbGl6ZWRRdWVyeSkpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgbG9nZ2VyLmVycm9yKGBFcnJvciBzZWFyY2hpbmcgcmVjaXBlcyBmb3IgcXVlcnkgXCIke3F1ZXJ5fVwiOmAsIGVycm9yKTtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gIH1cbiAgXG4gIC8qKlxuICAgKiBHZXQgcmVjaXBlcyBieSBtZWFsIHR5cGVcbiAgICogQHBhcmFtIG1lYWxUeXBlIFRoZSBtZWFsIHR5cGUgdG8gZmlsdGVyIGJ5XG4gICAqIEByZXR1cm5zIEFycmF5IG9mIHJlY2lwZXMgZm9yIHRoZSBzcGVjaWZpZWQgbWVhbCB0eXBlXG4gICAqL1xuICBzdGF0aWMgYXN5bmMgZ2V0UmVjaXBlc0J5TWVhbFR5cGUobWVhbFR5cGU6IHN0cmluZyk6IFByb21pc2U8UmVjaXBlW10+IHtcbiAgICBpZiAoIW1lYWxUeXBlKSByZXR1cm4gW107XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IG5vcm1hbGl6ZWRNZWFsVHlwZSA9IG1lYWxUeXBlLnRvTG93ZXJDYXNlKCkudHJpbSgpO1xuICAgICAgY29uc3QgcmVjaXBlcyA9IGF3YWl0IHRoaXMuZ2V0QWxsUmVjaXBlcygpO1xuICAgICAgXG4gICAgICByZXR1cm4gcmVjaXBlcy5maWx0ZXIocmVjaXBlID0+IFxuICAgICAgICByZWNpcGUubWVhbFR5cGUgJiYgXG4gICAgICAgIChBcnJheS5pc0FycmF5KHJlY2lwZS5tZWFsVHlwZSkgXG4gICAgICAgICAgPyByZWNpcGUubWVhbFR5cGUuc29tZShtID0+IG0udG9Mb3dlckNhc2UoKSA9PT0gbm9ybWFsaXplZE1lYWxUeXBlKVxuICAgICAgICAgIDogcmVjaXBlLm1lYWxUeXBlLnRvTG93ZXJDYXNlKCkgPT09IG5vcm1hbGl6ZWRNZWFsVHlwZSlcbiAgICAgICk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcihgRXJyb3IgZ2V0dGluZyByZWNpcGVzIGZvciBtZWFsIHR5cGUgXCIke21lYWxUeXBlfVwiOmAsIGVycm9yKTtcbiAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gIH1cbiAgXG4gIC8qKlxuICAgKiBHZXQgcmVjaXBlcyBieSBzZWFzb25cbiAgICogQHBhcmFtIHNlYXNvbiBUaGUgc2Vhc29uIHRvIGZpbHRlciBieVxuICAgKiBAcmV0dXJucyBBcnJheSBvZiByZWNpcGVzIGZvciB0aGUgc3BlY2lmaWVkIHNlYXNvblxuICAgKi9cbiAgc3RhdGljIGFzeW5jIGdldFJlY2lwZXNCeVNlYXNvbihzZWFzb246IHN0cmluZyk6IFByb21pc2U8UmVjaXBlW10+IHtcbiAgICBpZiAoIXNlYXNvbikgcmV0dXJuIFtdO1xuICAgIFxuICAgIHRyeSB7XG4gICAgICBjb25zdCBub3JtYWxpemVkU2Vhc29uID0gc2Vhc29uLnRvTG93ZXJDYXNlKCkudHJpbSgpO1xuICAgICAgY29uc3QgcmVjaXBlcyA9IGF3YWl0IHRoaXMuZ2V0QWxsUmVjaXBlcygpO1xuICAgICAgXG4gICAgICByZXR1cm4gcmVjaXBlcy5maWx0ZXIocmVjaXBlID0+IFxuICAgICAgICByZWNpcGUuc2Vhc29uICYmIFxuICAgICAgICAoQXJyYXkuaXNBcnJheShyZWNpcGUuc2Vhc29uKSBcbiAgICAgICAgICA/IHJlY2lwZS5zZWFzb24uc29tZShzID0+IHMudG9Mb3dlckNhc2UoKSA9PT0gbm9ybWFsaXplZFNlYXNvbilcbiAgICAgICAgICA6IHJlY2lwZS5zZWFzb24udG9Mb3dlckNhc2UoKSA9PT0gbm9ybWFsaXplZFNlYXNvbilcbiAgICAgICk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGxvZ2dlci5lcnJvcihgRXJyb3IgZ2V0dGluZyByZWNpcGVzIGZvciBzZWFzb24gXCIke3NlYXNvbn1cIjpgLCBlcnJvcik7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuICB9XG4gIFxuICAvKipcbiAgICogQ2xlYXIgdGhlIHJlY2lwZSBjYWNoZSB0byBmb3JjZSBhIHJlbG9hZFxuICAgKi9cbiAgc3RhdGljIGNsZWFyQ2FjaGUoKTogdm9pZCB7XG4gICAgdGhpcy5fYWxsUmVjaXBlcyA9IG51bGw7XG4gIH1cbn0gIl0sInZlcnNpb24iOjN9