2bdf3dc42acd71f7ee6d8dd9189ec51a
"use strict";
/**
 * Comprehensive Astrological Validation System
 *
 * Provides a unified interface for validating all astrological calculations,
 * planetary positions, elemental properties, and transit dates.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.VALIDATION_CONSTANTS = exports.quickValidate = exports.validateAstrologicalCalculation = exports.validateMathematicalConstants = exports.validateAstrologicalElementalProperties = exports.validatePlanetaryPositions = void 0;
const logger_1 = require("@/utils/logger");
const elementalValidation_1 = require("./elementalValidation");
const transitValidation_1 = require("./transitValidation");
/**
 * Validate a complete planetary positions object
 */
function validatePlanetaryPositions(positions, options = {}) {
    const { strictMode = false, autoCorrect = false, logWarnings = true } = options;
    const errors = [];
    const warnings = [];
    const correctedData = {};
    try {
        if (!positions || typeof positions !== 'object') {
            errors.push('Planetary positions must be an object');
            return { isValid: false, errors, warnings };
        }
        const requiredPlanets = ['sun', 'moon', 'mercury', 'venus', 'mars', 'jupiter', 'saturn'];
        const optionalPlanets = ['uranus', 'neptune', 'pluto', 'northNode', 'southNode'];
        const allPlanets = [...requiredPlanets, ...optionalPlanets];
        // Check for required planets
        for (const planet of requiredPlanets) {
            if (!(planet in positions)) {
                errors.push(`Missing required planet: ${planet}`);
                continue;
            }
            const position = positions[planet];
            const validation = validateSinglePlanetaryPosition(planet, position, strictMode);
            if (!validation.isValid) {
                errors.push(...validation.errors);
                warnings.push(...validation.warnings);
            }
            else if (validation.correctedData && autoCorrect) {
                correctedData[planet] = validation.correctedData;
            }
        }
        // Check optional planets
        for (const planet of optionalPlanets) {
            if (planet in positions) {
                const position = positions[planet];
                const validation = validateSinglePlanetaryPosition(planet, position, strictMode);
                if (!validation.isValid) {
                    if (strictMode) {
                        errors.push(...validation.errors);
                    }
                    else {
                        warnings.push(...validation.errors);
                    }
                    warnings.push(...validation.warnings);
                }
                else if (validation.correctedData && autoCorrect) {
                    correctedData[planet] = validation.correctedData;
                }
            }
        }
        // Check for unknown planets
        const unknownPlanets = Object.keys(positions).filter(planet => !allPlanets.includes(planet));
        if (unknownPlanets.length > 0) {
            const message = `Unknown planets found: ${unknownPlanets.join(', ')}`;
            if (strictMode) {
                errors.push(message);
            }
            else {
                warnings.push(message);
            }
        }
        // Log warnings if requested
        if (logWarnings && warnings.length > 0) {
            logger_1.logger.warn('Planetary position validation warnings:', warnings);
        }
        return {
            isValid: errors.length === 0,
            errors,
            warnings,
            correctedData: Object.keys(correctedData).length > 0 ? correctedData : undefined
        };
    }
    catch (error) {
        const errorMessage = `Validation error: ${error instanceof Error ? error.message : 'Unknown error'}`;
        errors.push(errorMessage);
        return { isValid: false, errors, warnings };
    }
}
exports.validatePlanetaryPositions = validatePlanetaryPositions;
/**
 * Validate a single planetary position
 */
function validateSinglePlanetaryPosition(planet, position, strictMode = false) {
    const errors = [];
    const warnings = [];
    let correctedData;
    try {
        if (!position || typeof position !== 'object') {
            errors.push(`${planet} position must be an object`);
            return { isValid: false, errors, warnings };
        }
        const pos = position;
        const requiredProps = ['sign', 'degree', 'exactLongitude', 'isRetrograde'];
        // Check required properties
        for (const prop of requiredProps) {
            if (!(prop in pos)) {
                errors.push(`${planet} missing required property: ${prop}`);
            }
        }
        if (errors.length > 0) {
            return { isValid: false, errors, warnings };
        }
        // Validate sign
        const sign = pos.sign;
        if (typeof sign !== 'string' || !transitValidation_1.TRANSIT_CONSTANTS.VALID_SIGNS.includes(sign.toLowerCase())) {
            errors.push(`${planet} has invalid sign: ${sign}`);
        }
        // Validate degree
        const degree = pos.degree;
        if (typeof degree !== 'number' || degree < 0 || degree >= transitValidation_1.TRANSIT_CONSTANTS.DEGREES_PER_SIGN) {
            const message = `${planet} degree ${degree} must be between 0 and ${transitValidation_1.TRANSIT_CONSTANTS.DEGREES_PER_SIGN}`;
            if (strictMode) {
                errors.push(message);
            }
            else {
                warnings.push(message);
                // Auto-correct if possible
                if (typeof degree === 'number') {
                    correctedData = {
                        sign: String(sign),
                        degree: Math.max(0, Math.min(transitValidation_1.TRANSIT_CONSTANTS.DEGREES_PER_SIGN - 0.01, degree)),
                        exactLongitude: Number(pos.exactLongitude),
                        isRetrograde: Boolean(pos.isRetrograde)
                    };
                }
            }
        }
        // Validate longitude
        const longitude = pos.exactLongitude;
        if (typeof longitude !== 'number' || longitude < 0 || longitude >= transitValidation_1.TRANSIT_CONSTANTS.MAX_LONGITUDE) {
            const message = `${planet} longitude ${longitude} must be between 0 and ${transitValidation_1.TRANSIT_CONSTANTS.MAX_LONGITUDE}`;
            if (strictMode) {
                errors.push(message);
            }
            else {
                warnings.push(message);
                // Auto-correct if possible
                if (typeof longitude === 'number') {
                    const correctedLongitude = ((longitude % transitValidation_1.TRANSIT_CONSTANTS.MAX_LONGITUDE) + transitValidation_1.TRANSIT_CONSTANTS.MAX_LONGITUDE) % transitValidation_1.TRANSIT_CONSTANTS.MAX_LONGITUDE;
                    if (!correctedData) {
                        correctedData = {
                            sign: String(sign),
                            degree: Number(degree),
                            exactLongitude: correctedLongitude,
                            isRetrograde: Boolean(pos.isRetrograde)
                        };
                    }
                    else {
                        correctedData.exactLongitude = correctedLongitude;
                    }
                }
            }
        }
        // Validate retrograde status
        const isRetrograde = pos.isRetrograde;
        if (typeof isRetrograde !== 'boolean') {
            warnings.push(`${planet} isRetrograde should be boolean, got ${typeof isRetrograde}`);
            if (!correctedData) {
                correctedData = {
                    sign: String(sign),
                    degree: Number(degree),
                    exactLongitude: Number(longitude),
                    isRetrograde: Boolean(isRetrograde)
                };
            }
            else {
                correctedData.isRetrograde = Boolean(isRetrograde);
            }
        }
        // Validate retrograde logic
        if (transitValidation_1.TRANSIT_CONSTANTS.ALWAYS_DIRECT.includes(planet.toLowerCase()) && isRetrograde) {
            warnings.push(`${planet} cannot be retrograde`);
            if (correctedData) {
                correctedData.isRetrograde = false;
            }
        }
        if (transitValidation_1.TRANSIT_CONSTANTS.ALWAYS_RETROGRADE.includes(planet.toLowerCase()) && !isRetrograde) {
            warnings.push(`${planet} should always be retrograde`);
            if (correctedData) {
                correctedData.isRetrograde = true;
            }
        }
        return {
            isValid: errors.length === 0,
            errors,
            warnings,
            correctedData
        };
    }
    catch (error) {
        errors.push(`Error validating ${planet}: ${error instanceof Error ? error.message : 'Unknown error'}`);
        return { isValid: false, errors, warnings };
    }
}
/**
 * Validate elemental properties with astrological context
 */
function validateAstrologicalElementalProperties(properties, context) {
    const errors = [];
    const warnings = [];
    let correctedData;
    try {
        if (!(0, elementalValidation_1.validateElementalProperties)(properties)) {
            errors.push(`Invalid elemental properties${context ? ` in ${context}` : ''}`);
            // Try to normalize the properties
            if (properties && typeof properties === 'object') {
                correctedData = (0, elementalValidation_1.normalizeElementalProperties)(properties);
                warnings.push('Elemental properties were normalized to valid values');
            }
            return { isValid: false, errors, warnings, correctedData };
        }
        const props = properties;
        // Check for elemental balance
        const total = Object.values(props).reduce((sum, val) => sum + val, 0);
        if (total > 1.2) {
            warnings.push(`Elemental properties total ${total.toFixed(2)} exceeds recommended maximum of 1.2`);
        }
        // Check for self-reinforcement patterns
        const dominant = Object.entries(props).reduce((max, current) => current[1] > max[1] ? current : max);
        if (dominant[1] < elementalValidation_1.ELEMENTAL_CONSTANTS.SELF_REINFORCEMENT_THRESHOLD) {
            warnings.push(`No dominant element found (highest: ${dominant[0]} at ${dominant[1].toFixed(2)}). Consider strengthening elemental focus.`);
        }
        return {
            isValid: true,
            errors,
            warnings
        };
    }
    catch (error) {
        errors.push(`Elemental validation error: ${error instanceof Error ? error.message : 'Unknown error'}`);
        return { isValid: false, errors, warnings };
    }
}
exports.validateAstrologicalElementalProperties = validateAstrologicalElementalProperties;
/**
 * Validate mathematical constants used in calculations
 */
function validateMathematicalConstants(constants) {
    const errors = [];
    const warnings = [];
    try {
        const expectedConstants = {
            DEGREES_PER_SIGN: 30,
            SIGNS_PER_CIRCLE: 12,
            MAX_LONGITUDE: 360,
            MIN_ELEMENT_VALUE: 0.05,
            MAX_ELEMENT_VALUE: 1.0,
            SELF_REINFORCEMENT_THRESHOLD: 0.3,
            HARMONY_THRESHOLD: 0.7
        };
        Object.entries(expectedConstants).forEach(([name, expectedValue]) => {
            if (name in constants) {
                const actualValue = constants[name];
                if (Math.abs(actualValue - expectedValue) > 0.001) {
                    warnings.push(`Constant ${name} has unexpected value: ${actualValue} (expected: ${expectedValue})`);
                }
            }
        });
        // Check for NaN or infinite values
        Object.entries(constants).forEach(([name, value]) => {
            if (!Number.isFinite(value)) {
                errors.push(`Constant ${name} has invalid value: ${value}`);
            }
        });
        return {
            isValid: errors.length === 0,
            errors,
            warnings
        };
    }
    catch (error) {
        errors.push(`Constants validation error: ${error instanceof Error ? error.message : 'Unknown error'}`);
        return { isValid: false, errors, warnings };
    }
}
exports.validateMathematicalConstants = validateMathematicalConstants;
/**
 * Comprehensive astrological calculation validation
 */
async function validateAstrologicalCalculation(input, options = {}) {
    const { validateTransits = false } = options;
    const errors = [];
    const warnings = [];
    const correctedData = {};
    try {
        // Validate planetary positions
        if (input.planetaryPositions) {
            const positionValidation = validatePlanetaryPositions(input.planetaryPositions, options);
            errors.push(...positionValidation.errors);
            warnings.push(...positionValidation.warnings);
            if (positionValidation.correctedData) {
                correctedData.planetaryPositions = positionValidation.correctedData;
            }
            // Validate against transit dates if requested
            if (validateTransits && positionValidation.isValid && input.date) {
                for (const [planet, position] of Object.entries(input.planetaryPositions)) {
                    try {
                        const isValid = await (0, transitValidation_1.validatePlanetaryPosition)(planet, position, input.date);
                        if (!isValid) {
                            warnings.push(`Transit validation failed for ${planet}`);
                        }
                    }
                    catch (error) {
                        warnings.push(`Could not validate transit for ${planet}: ${error instanceof Error ? error.message : 'Unknown error'}`);
                    }
                }
            }
        }
        // Validate elemental properties
        if (input.elementalProperties) {
            const elementalValidation = validateAstrologicalElementalProperties(input.elementalProperties, 'calculation input');
            errors.push(...elementalValidation.errors);
            warnings.push(...elementalValidation.warnings);
            if (elementalValidation.correctedData) {
                correctedData.elementalProperties = elementalValidation.correctedData;
            }
        }
        // Validate constants
        if (input.constants) {
            const constantsValidation = validateMathematicalConstants(input.constants);
            errors.push(...constantsValidation.errors);
            warnings.push(...constantsValidation.warnings);
        }
        return {
            isValid: errors.length === 0,
            errors,
            warnings,
            correctedData: Object.keys(correctedData).length > 0 ? correctedData : undefined
        };
    }
    catch (error) {
        errors.push(`Comprehensive validation error: ${error instanceof Error ? error.message : 'Unknown error'}`);
        return { isValid: false, errors, warnings };
    }
}
exports.validateAstrologicalCalculation = validateAstrologicalCalculation;
/**
 * Quick validation for development use
 */
function quickValidate(data, type) {
    try {
        switch (type) {
            case 'planetary':
                return validatePlanetaryPositions(data).isValid;
            case 'elemental':
                return (0, elementalValidation_1.validateElementalProperties)(data);
            case 'constants':
                return validateMathematicalConstants(data).isValid;
            default:
                return false;
        }
    }
    catch {
        return false;
    }
}
exports.quickValidate = quickValidate;
/**
 * Export all validation constants
 */
exports.VALIDATION_CONSTANTS = {
    ...elementalValidation_1.ELEMENTAL_CONSTANTS,
    ...transitValidation_1.TRANSIT_CONSTANTS,
    VALIDATION_TIMEOUT: 5000,
    MAX_VALIDATION_ERRORS: 50,
    AUTO_CORRECT_THRESHOLD: 0.1
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy91dGlscy9hc3Ryb2xvZ3kvYXN0cm9sb2dpY2FsVmFsaWRhdGlvbi50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7O0dBS0c7OztBQUdILDJDQUF3QztBQUN4QywrREFJK0I7QUFDL0IsMkRBSTZCO0FBZ0M3Qjs7R0FFRztBQUNILFNBQWdCLDBCQUEwQixDQUN4QyxTQUFrQyxFQUNsQyxVQUE2QixFQUFFO0lBRS9CLE1BQU0sRUFBRSxVQUFVLEdBQUcsS0FBSyxFQUFFLFdBQVcsR0FBRyxLQUFLLEVBQUUsV0FBVyxHQUFHLElBQUksRUFBRSxHQUFHLE9BQU8sQ0FBQztJQUNoRixNQUFNLE1BQU0sR0FBYSxFQUFFLENBQUM7SUFDNUIsTUFBTSxRQUFRLEdBQWEsRUFBRSxDQUFDO0lBQzlCLE1BQU0sYUFBYSxHQUFzQyxFQUFFLENBQUM7SUFFNUQsSUFBSTtRQUNGLElBQUksQ0FBQyxTQUFTLElBQUksT0FBTyxTQUFTLEtBQUssUUFBUSxFQUFFO1lBQy9DLE1BQU0sQ0FBQyxJQUFJLENBQUMsdUNBQXVDLENBQUMsQ0FBQztZQUNyRCxPQUFPLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLEVBQUUsUUFBUSxFQUFFLENBQUM7U0FDN0M7UUFFRCxNQUFNLGVBQWUsR0FBRyxDQUFDLEtBQUssRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLE9BQU8sRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLFFBQVEsQ0FBQyxDQUFDO1FBQ3pGLE1BQU0sZUFBZSxHQUFHLENBQUMsUUFBUSxFQUFFLFNBQVMsRUFBRSxPQUFPLEVBQUUsV0FBVyxFQUFFLFdBQVcsQ0FBQyxDQUFDO1FBQ2pGLE1BQU0sVUFBVSxHQUFHLENBQUMsR0FBRyxlQUFlLEVBQUUsR0FBRyxlQUFlLENBQUMsQ0FBQztRQUU1RCw2QkFBNkI7UUFDN0IsS0FBSyxNQUFNLE1BQU0sSUFBSSxlQUFlLEVBQUU7WUFDcEMsSUFBSSxDQUFDLENBQUMsTUFBTSxJQUFJ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ZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9HcmVnQ2FzdHJvL0Rlc2t0b3AvV2hhdFRvRWF0TmV4dC9zcmMvdXRpbHMvYXN0cm9sb2d5L2FzdHJvbG9naWNhbFZhbGlkYXRpb24udHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb21wcmVoZW5zaXZlIEFzdHJvbG9naWNhbCBWYWxpZGF0aW9uIFN5c3RlbVxuICogXG4gKiBQcm92aWRlcyBhIHVuaWZpZWQgaW50ZXJmYWNlIGZvciB2YWxpZGF0aW5nIGFsbCBhc3Ryb2xvZ2ljYWwgY2FsY3VsYXRpb25zLFxuICogcGxhbmV0YXJ5IHBvc2l0aW9ucywgZWxlbWVudGFsIHByb3BlcnRpZXMsIGFuZCB0cmFuc2l0IGRhdGVzLlxuICovXG5cbmltcG9ydCB7IEVsZW1lbnRhbFByb3BlcnRpZXMgfSBmcm9tICdAL3R5cGVzL2FsY2hlbXknO1xuaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSAnQC91dGlscy9sb2dnZXInO1xuaW1wb3J0IHsgXG4gIHZhbGlkYXRlRWxlbWVudGFsUHJvcGVydGllcywgXG4gIG5vcm1hbGl6ZUVsZW1lbnRhbFByb3BlcnRpZXMsXG4gIEVMRU1FTlRBTF9DT05TVEFOVFMgXG59IGZyb20gJy4vZWxlbWVudGFsVmFsaWRhdGlvbic7XG5pbXBvcnQgeyBcbiAgdmFsaWRhdGVUcmFuc2l0RGF0ZSwgXG4gIHZhbGlkYXRlUGxhbmV0YXJ5UG9zaXRpb24sXG4gIFRSQU5TSVRfQ09OU1RBTlRTIFxufSBmcm9tICcuL3RyYW5zaXRWYWxpZGF0aW9uJztcblxuLyoqXG4gKiBQbGFuZXRhcnkgcG9zaXRpb24gc3RydWN0dXJlXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgUGxhbmV0YXJ5UG9zaXRpb24ge1xuICBzaWduOiBzdHJpbmc7XG4gIGRlZ3JlZTogbnVtYmVyO1xuICBleGFjdExvbmdpdHVkZTogbnVtYmVyO1xuICBpc1JldHJvZ3JhZGU6IGJvb2xlYW47XG59XG5cbi8qKlxuICogVmFsaWRhdGlvbiByZXN1bHQgc3RydWN0dXJlXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgVmFsaWRhdGlvblJlc3VsdCB7XG4gIGlzVmFsaWQ6IGJvb2xlYW47XG4gIGVycm9yczogc3RyaW5nW107XG4gIHdhcm5pbmdzOiBzdHJpbmdbXTtcbiAgY29ycmVjdGVkRGF0YT86IHVua25vd247XG59XG5cbi8qKlxuICogQ29tcHJlaGVuc2l2ZSB2YWxpZGF0aW9uIG9wdGlvbnNcbiAqL1xuZXhwb3J0IGludGVyZmFjZSBWYWxpZGF0aW9uT3B0aW9ucyB7XG4gIHN0cmljdE1vZGU/OiBib29sZWFuO1xuICBhdXRvQ29ycmVjdD86IGJvb2xlYW47XG4gIGxvZ1dhcm5pbmdzPzogYm9vbGVhbjtcbiAgdmFsaWRhdGVUcmFuc2l0cz86IGJvb2xlYW47XG59XG5cbi8qKlxuICogVmFsaWRhdGUgYSBjb21wbGV0ZSBwbGFuZXRhcnkgcG9zaXRpb25zIG9iamVjdFxuICovXG5leHBvcnQgZnVuY3Rpb24gdmFsaWRhdGVQbGFuZXRhcnlQb3NpdGlvbnMoXG4gIHBvc2l0aW9uczogUmVjb3JkPHN0cmluZywgdW5rbm93bj4sXG4gIG9wdGlvbnM6IFZhbGlkYXRpb25PcHRpb25zID0ge31cbik6IFZhbGlkYXRpb25SZXN1bHQge1xuICBjb25zdCB7IHN0cmljdE1vZGUgPSBmYWxzZSwgYXV0b0NvcnJlY3QgPSBmYWxzZSwgbG9nV2FybmluZ3MgPSB0cnVlIH0gPSBvcHRpb25zO1xuICBjb25zdCBlcnJvcnM6IHN0cmluZ1tdID0gW107XG4gIGNvbnN0IHdhcm5pbmdzOiBzdHJpbmdbXSA9IFtdO1xuICBjb25zdCBjb3JyZWN0ZWREYXRhOiBSZWNvcmQ8c3RyaW5nLCBQbGFuZXRhcnlQb3NpdGlvbj4gPSB7fTtcblxuICB0cnkge1xuICAgIGlmICghcG9zaXRpb25zIHx8IHR5cGVvZiBwb3NpdGlvbnMgIT09ICdvYmplY3QnKSB7XG4gICAgICBlcnJvcnMucHVzaCgnUGxhbmV0YXJ5IHBvc2l0aW9ucyBtdXN0IGJlIGFuIG9iamVjdCcpO1xuICAgICAgcmV0dXJuIHsgaXNWYWxpZDogZmFsc2UsIGVycm9ycywgd2FybmluZ3MgfTtcbiAgICB9XG5cbiAgICBjb25zdCByZXF1aXJlZFBsYW5ldHMgPSBbJ3N1bicsICdtb29uJywgJ21lcmN1cnknLCAndmVudXMnLCAnbWFycycsICdqdXBpdGVyJywgJ3NhdHVybiddO1xuICAgIGNvbnN0IG9wdGlvbmFsUGxhbmV0cyA9IFsndXJhbnVzJywgJ25lcHR1bmUnLCAncGx1dG8nLCAnbm9ydGhOb2RlJywgJ3NvdXRoTm9kZSddO1xuICAgIGNvbnN0IGFsbFBsYW5ldHMgPSBbLi4ucmVxdWlyZWRQbGFuZXRzLCAuLi5vcHRpb25hbFBsYW5ldHNdO1xuXG4gICAgLy8gQ2hlY2sgZm9yIHJlcXVpcmVkIHBsYW5ldHNcbiAgICBmb3IgKGNvbnN0IHBsYW5ldCBvZiByZXF1aXJlZFBsYW5ldHMpIHtcbiAgICAgIGlmICghKHBsYW5ldCBpbiBwb3NpdGlvbnMpKSB7XG4gICAgICAgIGVycm9ycy5wdXNoKGBNaXNzaW5nIHJlcXVpcmVkIHBsYW5ldDogJHtwbGFuZXR9YCk7XG4gICAgICAgIGNvbnRpbnVlO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBwb3NpdGlvbiA9IHBvc2l0aW9uc1twbGFuZXRdO1xuICAgICAgY29uc3QgdmFsaWRhdGlvbiA9IHZhbGlkYXRlU2luZ2xlUGxhbmV0YXJ5UG9zaXRpb24ocGxhbmV0LCBwb3NpdGlvbiwgc3RyaWN0TW9kZSk7XG4gICAgICBcbiAgICAgIGlmICghdmFsaWRhdGlvbi5pc1ZhbGlkKSB7XG4gICAgICAgIGVycm9ycy5wdXNoKC4uLnZhbGlkYXRpb24uZXJyb3JzKTtcbiAgICAgICAgd2FybmluZ3MucHVzaCguLi52YWxpZGF0aW9uLndhcm5pbmdzKTtcbiAgICAgIH0gZWxzZSBpZiAodmFsaWRhdGlvbi5jb3JyZWN0ZWREYXRhICYmIGF1dG9Db3JyZWN0KSB7XG4gICAgICAgIGNvcnJlY3RlZERhdGFbcGxhbmV0XSA9IHZhbGlkYXRpb24uY29ycmVjdGVkRGF0YSBhcyBQbGFuZXRhcnlQb3NpdGlvbjtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBDaGVjayBvcHRpb25hbCBwbGFuZXRzXG4gICAgZm9yIChjb25zdCBwbGFuZXQgb2Ygb3B0aW9uYWxQbGFuZXRzKSB7XG4gICAgICBpZiAocGxhbmV0IGluIHBvc2l0aW9ucykge1xuICAgICAgICBjb25zdCBwb3NpdGlvbiA9IHBvc2l0aW9uc1twbGFuZXRdO1xuICAgICAgICBjb25zdCB2YWxpZGF0aW9uID0gdmFsaWRhdGVTaW5nbGVQbGFuZXRhcnlQb3NpdGlvbihwbGFuZXQsIHBvc2l0aW9uLCBzdHJpY3RNb2RlKTtcbiAgICAgICAgXG4gICAgICAgIGlmICghdmFsaWRhdGlvbi5pc1ZhbGlkKSB7XG4gICAgICAgICAgaWYgKHN0cmljdE1vZGUpIHtcbiAgICAgICAgICAgIGVycm9ycy5wdXNoKC4uLnZhbGlkYXRpb24uZXJyb3JzKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgd2FybmluZ3MucHVzaCguLi52YWxpZGF0aW9uLmVycm9ycyk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHdhcm5pbmdzLnB1c2goLi4udmFsaWRhdGlvbi53YXJuaW5ncyk7XG4gICAgICAgIH0gZWxzZSBpZiAodmFsaWRhdGlvbi5jb3JyZWN0ZWREYXRhICYmIGF1dG9Db3JyZWN0KSB7XG4gICAgICAgICAgY29ycmVjdGVkRGF0YVtwbGFuZXRdID0gdmFsaWRhdGlvbi5jb3JyZWN0ZWREYXRhIGFzIFBsYW5ldGFyeVBvc2l0aW9uO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgZm9yIHVua25vd24gcGxhbmV0c1xuICAgIGNvbnN0IHVua25vd25QbGFuZXRzID0gT2JqZWN0LmtleXMocG9zaXRpb25zKS5maWx0ZXIocGxhbmV0ID0+ICFhbGxQbGFuZXRzLmluY2x1ZGVzKHBsYW5ldCkpO1xuICAgIGlmICh1bmtub3duUGxhbmV0cy5sZW5ndGggPiAwKSB7XG4gICAgICBjb25zdCBtZXNzYWdlID0gYFVua25vd24gcGxhbmV0cyBmb3VuZDogJHt1bmtub3duUGxhbmV0cy5qb2luKCcsICcpfWA7XG4gICAgICBpZiAoc3RyaWN0TW9kZSkge1xuICAgICAgICBlcnJvcnMucHVzaChtZXNzYWdlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHdhcm5pbmdzLnB1c2gobWVzc2FnZSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gTG9nIHdhcm5pbmdzIGlmIHJlcXVlc3RlZFxuICAgIGlmIChsb2dXYXJuaW5ncyAmJiB3YXJuaW5ncy5sZW5ndGggPiAwKSB7XG4gICAgICBsb2dnZXIud2FybignUGxhbmV0YXJ5IHBvc2l0aW9uIHZhbGlkYXRpb24gd2FybmluZ3M6Jywgd2FybmluZ3MpO1xuICAgIH1cblxuICAgIHJldHVybiB7XG4gICAgICBpc1ZhbGlkOiBlcnJvcnMubGVuZ3RoID09PSAwLFxuICAgICAgZXJyb3JzLFxuICAgICAgd2FybmluZ3MsXG4gICAgICBjb3JyZWN0ZWREYXRhOiBPYmplY3Qua2V5cyhjb3JyZWN0ZWREYXRhKS5sZW5ndGggPiAwID8gY29ycmVjdGVkRGF0YSA6IHVuZGVmaW5lZFxuICAgIH07XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc3QgZXJyb3JNZXNzYWdlID0gYFZhbGlkYXRpb24gZXJyb3I6ICR7ZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcid9YDtcbiAgICBlcnJvcnMucHVzaChlcnJvck1lc3NhZ2UpO1xuICAgIHJldHVybiB7IGlzVmFsaWQ6IGZhbHNlLCBlcnJvcnMsIHdhcm5pbmdzIH07XG4gIH1cbn1cblxuLyoqXG4gKiBWYWxpZGF0ZSBhIHNpbmdsZSBwbGFuZXRhcnkgcG9zaXRpb25cbiAqL1xuZnVuY3Rpb24gdmFsaWRhdGVTaW5nbGVQbGFuZXRhcnlQb3NpdGlvbihcbiAgcGxhbmV0OiBzdHJpbmcsXG4gIHBvc2l0aW9uOiB1bmtub3duLFxuICBzdHJpY3RNb2RlOiBib29sZWFuID0gZmFsc2Vcbik6IFZhbGlkYXRpb25SZXN1bHQge1xuICBjb25zdCBlcnJvcnM6IHN0cmluZ1tdID0gW107XG4gIGNvbnN0IHdhcm5pbmdzOiBzdHJpbmdbXSA9IFtdO1xuICBsZXQgY29ycmVjdGVkRGF0YTogUGxhbmV0YXJ5UG9zaXRpb24gfCB1bmRlZmluZWQ7XG5cbiAgdHJ5IHtcbiAgICBpZiAoIXBvc2l0aW9uIHx8IHR5cGVvZiBwb3NpdGlvbiAhPT0gJ29iamVjdCcpIHtcbiAgICAgIGVycm9ycy5wdXNoKGAke3BsYW5ldH0gcG9zaXRpb24gbXVzdCBiZSBhbiBvYmplY3RgKTtcbiAgICAgIHJldHVybiB7IGlzVmFsaWQ6IGZhbHNlLCBlcnJvcnMsIHdhcm5pbmdzIH07XG4gICAgfVxuXG4gICAgY29uc3QgcG9zID0gcG9zaXRpb24gYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj47XG4gICAgY29uc3QgcmVxdWlyZWRQcm9wcyA9IFsnc2lnbicsICdkZWdyZWUnLCAnZXhhY3RMb25naXR1ZGUnLCAnaXNSZXRyb2dyYWRlJ107XG4gICAgXG4gICAgLy8gQ2hlY2sgcmVxdWlyZWQgcHJvcGVydGllc1xuICAgIGZvciAoY29uc3QgcHJvcCBvZiByZXF1aXJlZFByb3BzKSB7XG4gICAgICBpZiAoIShwcm9wIGluIHBvcykpIHtcbiAgICAgICAgZXJyb3JzLnB1c2goYCR7cGxhbmV0fSBtaXNzaW5nIHJlcXVpcmVkIHByb3BlcnR5OiAke3Byb3B9YCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKGVycm9ycy5sZW5ndGggPiAwKSB7XG4gICAgICByZXR1cm4geyBpc1ZhbGlkOiBmYWxzZSwgZXJyb3JzLCB3YXJuaW5ncyB9O1xuICAgIH1cblxuICAgIC8vIFZhbGlkYXRlIHNpZ25cbiAgICBjb25zdCBzaWduID0gcG9zLnNpZ247XG4gICAgaWYgKHR5cGVvZiBzaWduICE9PSAnc3RyaW5nJyB8fCAhVFJBTlNJVF9DT05TVEFOVFMuVkFMSURfU0lHTlMuaW5jbHVkZXMoc2lnbi50b0xvd2VyQ2FzZSgpKSkge1xuICAgICAgZXJyb3JzLnB1c2goYCR7cGxhbmV0fSBoYXMgaW52YWxpZCBzaWduOiAke3NpZ259YCk7XG4gICAgfVxuXG4gICAgLy8gVmFsaWRhdGUgZGVncmVlXG4gICAgY29uc3QgZGVncmVlID0gcG9zLmRlZ3JlZTtcbiAgICBpZiAodHlwZW9mIGRlZ3JlZSAhPT0gJ251bWJlcicgfHwgZGVncmVlIDwgMCB8fCBkZWdyZWUgPj0gVFJBTlNJVF9DT05TVEFOVFMuREVHUkVFU19QRVJfU0lHTikge1xuICAgICAgY29uc3QgbWVzc2FnZSA9IGAke3BsYW5ldH0gZGVncmVlICR7ZGVncmVlfSBtdXN0IGJlIGJldHdlZW4gMCBhbmQgJHtUUkFOU0lUX0NPTlNUQU5UUy5ERUdSRUVTX1BFUl9TSUdOfWA7XG4gICAgICBpZiAoc3RyaWN0TW9kZSkge1xuICAgICAgICBlcnJvcnMucHVzaChtZXNzYWdlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHdhcm5pbmdzLnB1c2gobWVzc2FnZSk7XG4gICAgICAgIC8vIEF1dG8tY29ycmVjdCBpZiBwb3NzaWJsZVxuICAgICAgICBpZiAodHlwZW9mIGRlZ3JlZSA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgICBjb3JyZWN0ZWREYXRhID0ge1xuICAgICAgICAgICAgc2lnbjogU3RyaW5nKHNpZ24pLFxuICAgICAgICAgICAgZGVncmVlOiBNYXRoLm1heCgwLCBNYXRoLm1pbihUUkFOU0lUX0NPTlNUQU5UUy5ERUdSRUVTX1BFUl9TSUdOIC0gMC4wMSwgZGVncmVlKSksXG4gICAgICAgICAgICBleGFjdExvbmdpdHVkZTogTnVtYmVyKHBvcy5leGFjdExvbmdpdHVkZSksXG4gICAgICAgICAgICBpc1JldHJvZ3JhZGU6IEJvb2xlYW4ocG9zLmlzUmV0cm9ncmFkZSlcbiAgICAgICAgICB9O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gVmFsaWRhdGUgbG9uZ2l0dWRlXG4gICAgY29uc3QgbG9uZ2l0dWRlID0gcG9zLmV4YWN0TG9uZ2l0dWRlO1xuICAgIGlmICh0eXBlb2YgbG9uZ2l0dWRlICE9PSAnbnVtYmVyJyB8fCBsb25naXR1ZGUgPCAwIHx8IGxvbmdpdHVkZSA+PSBUUkFOU0lUX0NPTlNUQU5UUy5NQVhfTE9OR0lUVURFKSB7XG4gICAgICBjb25zdCBtZXNzYWdlID0gYCR7cGxhbmV0fSBsb25naXR1ZGUgJHtsb25naXR1ZGV9IG11c3QgYmUgYmV0d2VlbiAwIGFuZCAke1RSQU5TSVRfQ09OU1RBTlRTLk1BWF9MT05HSVRVREV9YDtcbiAgICAgIGlmIChzdHJpY3RNb2RlKSB7XG4gICAgICAgIGVycm9ycy5wdXNoKG1lc3NhZ2UpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgd2FybmluZ3MucHVzaChtZXNzYWdlKTtcbiAgICAgICAgLy8gQXV0by1jb3JyZWN0IGlmIHBvc3NpYmxlXG4gICAgICAgIGlmICh0eXBlb2YgbG9uZ2l0dWRlID09PSAnbnVtYmVyJykge1xuICAgICAgICAgIGNvbnN0IGNvcnJlY3RlZExvbmdpdHVkZSA9ICgobG9uZ2l0dWRlICUgVFJBTlNJVF9DT05TVEFOVFMuTUFYX0xPTkdJVFVERSkgKyBUUkFOU0lUX0NPTlNUQU5UUy5NQVhfTE9OR0lUVURFKSAlIFRSQU5TSVRfQ09OU1RBTlRTLk1BWF9MT05HSVRVREU7XG4gICAgICAgICAgaWYgKCFjb3JyZWN0ZWREYXRhKSB7XG4gICAgICAgICAgICBjb3JyZWN0ZWREYXRhID0ge1xuICAgICAgICAgICAgICBzaWduOiBTdHJpbmcoc2lnbiksXG4gICAgICAgICAgICAgIGRlZ3JlZTogTnVtYmVyKGRlZ3JlZSksXG4gICAgICAgICAgICAgIGV4YWN0TG9uZ2l0dWRlOiBjb3JyZWN0ZWRMb25naXR1ZGUsXG4gICAgICAgICAgICAgIGlzUmV0cm9ncmFkZTogQm9vbGVhbihwb3MuaXNSZXRyb2dyYWRlKVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29ycmVjdGVkRGF0YS5leGFjdExvbmdpdHVkZSA9IGNvcnJlY3RlZExvbmdpdHVkZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBWYWxpZGF0ZSByZXRyb2dyYWRlIHN0YXR1c1xuICAgIGNvbnN0IGlzUmV0cm9ncmFkZSA9IHBvcy5pc1JldHJvZ3JhZGU7XG4gICAgaWYgKHR5cGVvZiBpc1JldHJvZ3JhZGUgIT09ICdib29sZWFuJykge1xuICAgICAgd2FybmluZ3MucHVzaChgJHtwbGFuZXR9IGlzUmV0cm9ncmFkZSBzaG91bGQgYmUgYm9vbGVhbiwgZ290ICR7dHlwZW9mIGlzUmV0cm9ncmFkZX1gKTtcbiAgICAgIGlmICghY29ycmVjdGVkRGF0YSkge1xuICAgICAgICBjb3JyZWN0ZWREYXRhID0ge1xuICAgICAgICAgIHNpZ246IFN0cmluZyhzaWduKSxcbiAgICAgICAgICBkZWdyZWU6IE51bWJlcihkZWdyZWUpLFxuICAgICAgICAgIGV4YWN0TG9uZ2l0dWRlOiBOdW1iZXIobG9uZ2l0dWRlKSxcbiAgICAgICAgICBpc1JldHJvZ3JhZGU6IEJvb2xlYW4oaXNSZXRyb2dyYWRlKVxuICAgICAgICB9O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29ycmVjdGVkRGF0YS5pc1JldHJvZ3JhZGUgPSBCb29sZWFuKGlzUmV0cm9ncmFkZSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgLy8gVmFsaWRhdGUgcmV0cm9ncmFkZSBsb2dpY1xuICAgIGlmIChUUkFOU0lUX0NPTlNUQU5UUy5BTFdBWVNfRElSRUNULmluY2x1ZGVzKHBsYW5ldC50b0xvd2VyQ2FzZSgpKSAmJiBpc1JldHJvZ3JhZGUpIHtcbiAgICAgIHdhcm5pbmdzLnB1c2goYCR7cGxhbmV0fSBjYW5ub3QgYmUgcmV0cm9ncmFkZWApO1xuICAgICAgaWYgKGNvcnJlY3RlZERhdGEpIHtcbiAgICAgICAgY29ycmVjdGVkRGF0YS5pc1JldHJvZ3JhZGUgPSBmYWxzZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoVFJBTlNJVF9DT05TVEFOVFMuQUxXQVlTX1JFVFJPR1JBREUuaW5jbHVkZXMocGxhbmV0LnRvTG93ZXJDYXNlKCkpICYmICFpc1JldHJvZ3JhZGUpIHtcbiAgICAgIHdhcm5pbmdzLnB1c2goYCR7cGxhbmV0fSBzaG91bGQgYWx3YXlzIGJlIHJldHJvZ3JhZGVgKTtcbiAgICAgIGlmIChjb3JyZWN0ZWREYXRhKSB7XG4gICAgICAgIGNvcnJlY3RlZERhdGEuaXNSZXRyb2dyYWRlID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgaXNWYWxpZDogZXJyb3JzLmxlbmd0aCA9PT0gMCxcbiAgICAgIGVycm9ycyxcbiAgICAgIHdhcm5pbmdzLFxuICAgICAgY29ycmVjdGVkRGF0YVxuICAgIH07XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgZXJyb3JzLnB1c2goYEVycm9yIHZhbGlkYXRpbmcgJHtwbGFuZXR9OiAke2Vycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InfWApO1xuICAgIHJldHVybiB7IGlzVmFsaWQ6IGZhbHNlLCBlcnJvcnMsIHdhcm5pbmdzIH07XG4gIH1cbn1cblxuLyoqXG4gKiBWYWxpZGF0ZSBlbGVtZW50YWwgcHJvcGVydGllcyB3aXRoIGFzdHJvbG9naWNhbCBjb250ZXh0XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB2YWxpZGF0ZUFzdHJvbG9naWNhbEVsZW1lbnRhbFByb3BlcnRpZXMoXG4gIHByb3BlcnRpZXM6IHVua25vd24sXG4gIGNvbnRleHQ/OiBzdHJpbmdcbik6IFZhbGlkYXRpb25SZXN1bHQge1xuICBjb25zdCBlcnJvcnM6IHN0cmluZ1tdID0gW107XG4gIGNvbnN0IHdhcm5pbmdzOiBzdHJpbmdbXSA9IFtdO1xuICBsZXQgY29ycmVjdGVkRGF0YTogRWxlbWVudGFsUHJvcGVydGllcyB8IHVuZGVmaW5lZDtcblxuICB0cnkge1xuICAgIGlmICghdmFsaWRhdGVFbGVtZW50YWxQcm9wZXJ0aWVzKHByb3BlcnRpZXMpKSB7XG4gICAgICBlcnJvcnMucHVzaChgSW52YWxpZCBlbGVtZW50YWwgcHJvcGVydGllcyR7Y29udGV4dCA/IGAgaW4gJHtjb250ZXh0fWAgOiAnJ31gKTtcbiAgICAgIFxuICAgICAgLy8gVHJ5IHRvIG5vcm1hbGl6ZSB0aGUgcHJvcGVydGllc1xuICAgICAgaWYgKHByb3BlcnRpZXMgJiYgdHlwZW9mIHByb3BlcnRpZXMgPT09ICdvYmplY3QnKSB7XG4gICAgICAgIGNvcnJlY3RlZERhdGEgPSBub3JtYWxpemVFbGVtZW50YWxQcm9wZXJ0aWVzKHByb3BlcnRpZXMgYXMgUGFydGlhbDxFbGVtZW50YWxQcm9wZXJ0aWVzPik7XG4gICAgICAgIHdhcm5pbmdzLnB1c2goJ0VsZW1lbnRhbCBwcm9wZXJ0aWVzIHdlcmUgbm9ybWFsaXplZCB0byB2YWxpZCB2YWx1ZXMnKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgcmV0dXJuIHsgaXNWYWxpZDogZmFsc2UsIGVycm9ycywgd2FybmluZ3MsIGNvcnJlY3RlZERhdGEgfTtcbiAgICB9XG5cbiAgICBjb25zdCBwcm9wcyA9IHByb3BlcnRpZXMgYXMgRWxlbWVudGFsUHJvcGVydGllcztcbiAgICBcbiAgICAvLyBDaGVjayBmb3IgZWxlbWVudGFsIGJhbGFuY2VcbiAgICBjb25zdCB0b3RhbCA9IE9iamVjdC52YWx1ZXMocHJvcHMpLnJlZHVjZSgoc3VtLCB2YWwpID0+IHN1bSArIHZhbCwgMCk7XG4gICAgaWYgKHRvdGFsID4gMS4yKSB7XG4gICAgICB3YXJuaW5ncy5wdXNoKGBFbGVtZW50YWwgcHJvcGVydGllcyB0b3RhbCAke3RvdGFsLnRvRml4ZWQoMil9IGV4Y2VlZHMgcmVjb21tZW5kZWQgbWF4aW11bSBvZiAxLjJgKTtcbiAgICB9XG5cbiAgICAvLyBDaGVjayBmb3Igc2VsZi1yZWluZm9yY2VtZW50IHBhdHRlcm5zXG4gICAgY29uc3QgZG9taW5hbnQgPSBPYmplY3QuZW50cmllcyhwcm9wcykucmVkdWNlKChtYXgsIGN1cnJlbnQpID0+IFxuICAgICAgY3VycmVudFsxXSA+IG1heFsxXSA/IGN1cnJlbnQgOiBtYXhcbiAgICApO1xuXG4gICAgaWYgKGRvbWluYW50WzFdIDwgRUxFTUVOVEFMX0NPTlNUQU5UUy5TRUxGX1JFSU5GT1JDRU1FTlRfVEhSRVNIT0xEKSB7XG4gICAgICB3YXJuaW5ncy5wdXNoKGBObyBkb21pbmFudCBlbGVtZW50IGZvdW5kIChoaWdoZXN0OiAke2RvbWluYW50WzBdfSBhdCAke2RvbWluYW50WzFdLnRvRml4ZWQoMil9KS4gQ29uc2lkZXIgc3RyZW5ndGhlbmluZyBlbGVtZW50YWwgZm9jdXMuYCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIGlzVmFsaWQ6IHRydWUsXG4gICAgICBlcnJvcnMsXG4gICAgICB3YXJuaW5nc1xuICAgIH07XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgZXJyb3JzLnB1c2goYEVsZW1lbnRhbCB2YWxpZGF0aW9uIGVycm9yOiAke2Vycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InfWApO1xuICAgIHJldHVybiB7IGlzVmFsaWQ6IGZhbHNlLCBlcnJvcnMsIHdhcm5pbmdzIH07XG4gIH1cbn1cblxuLyoqXG4gKiBWYWxpZGF0ZSBtYXRoZW1hdGljYWwgY29uc3RhbnRzIHVzZWQgaW4gY2FsY3VsYXRpb25zXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB2YWxpZGF0ZU1hdGhlbWF0aWNhbENvbnN0YW50cyhjb25zdGFudHM6IFJlY29yZDxzdHJpbmcsIG51bWJlcj4pOiBWYWxpZGF0aW9uUmVzdWx0IHtcbiAgY29uc3QgZXJyb3JzOiBzdHJpbmdbXSA9IFtdO1xuICBjb25zdCB3YXJuaW5nczogc3RyaW5nW10gPSBbXTtcblxuICB0cnkge1xuICAgIGNvbnN0IGV4cGVjdGVkQ29uc3RhbnRzID0ge1xuICAgICAgREVHUkVFU19QRVJfU0lHTjogMzAsXG4gICAgICBTSUdOU19QRVJfQ0lSQ0xFOiAxMixcbiAgICAgIE1BWF9MT05HSVRVREU6IDM2MCxcbiAgICAgIE1JTl9FTEVNRU5UX1ZBTFVFOiAwLjA1LFxuICAgICAgTUFYX0VMRU1FTlRfVkFMVUU6IDEuMCxcbiAgICAgIFNFTEZfUkVJTkZPUkNFTUVOVF9USFJFU0hPTEQ6IDAuMyxcbiAgICAgIEhBUk1PTllfVEhSRVNIT0xEOiAwLjdcbiAgICB9O1xuXG4gICAgT2JqZWN0LmVudHJpZXMoZXhwZWN0ZWRDb25zdGFudHMpLmZvckVhY2goKFtuYW1lLCBleHBlY3RlZFZhbHVlXSkgPT4ge1xuICAgICAgaWYgKG5hbWUgaW4gY29uc3RhbnRzKSB7XG4gICAgICAgIGNvbnN0IGFjdHVhbFZhbHVlID0gY29uc3RhbnRzW25hbWVdO1xuICAgICAgICBpZiAoTWF0aC5hYnMoYWN0dWFsVmFsdWUgLSBleHBlY3RlZFZhbHVlKSA+IDAuMDAxKSB7XG4gICAgICAgICAgd2FybmluZ3MucHVzaChgQ29uc3RhbnQgJHtuYW1lfSBoYXMgdW5leHBlY3RlZCB2YWx1ZTogJHthY3R1YWxWYWx1ZX0gKGV4cGVjdGVkOiAke2V4cGVjdGVkVmFsdWV9KWApO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBDaGVjayBmb3IgTmFOIG9yIGluZmluaXRlIHZhbHVlc1xuICAgIE9iamVjdC5lbnRyaWVzKGNvbnN0YW50cykuZm9yRWFjaCgoW25hbWUsIHZhbHVlXSkgPT4ge1xuICAgICAgaWYgKCFOdW1iZXIuaXNGaW5pdGUodmFsdWUpKSB7XG4gICAgICAgIGVycm9ycy5wdXNoKGBDb25zdGFudCAke25hbWV9IGhhcyBpbnZhbGlkIHZhbHVlOiAke3ZhbHVlfWApO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIGlzVmFsaWQ6IGVycm9ycy5sZW5ndGggPT09IDAsXG4gICAgICBlcnJvcnMsXG4gICAgICB3YXJuaW5nc1xuICAgIH07XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgZXJyb3JzLnB1c2goYENvbnN0YW50cyB2YWxpZGF0aW9uIGVycm9yOiAke2Vycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InfWApO1xuICAgIHJldHVybiB7IGlzVmFsaWQ6IGZhbHNlLCBlcnJvcnMsIHdhcm5pbmdzIH07XG4gIH1cbn1cblxuLyoqXG4gKiBDb21wcmVoZW5zaXZlIGFzdHJvbG9naWNhbCBjYWxjdWxhdGlvbiB2YWxpZGF0aW9uXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB2YWxpZGF0ZUFzdHJvbG9naWNhbENhbGN1bGF0aW9uKFxuICBpbnB1dDoge1xuICAgIHBsYW5ldGFyeVBvc2l0aW9ucz86IFJlY29yZDxzdHJpbmcsIHVua25vd24+O1xuICAgIGVsZW1lbnRhbFByb3BlcnRpZXM/OiB1bmtub3duO1xuICAgIGNvbnN0YW50cz86IFJlY29yZDxzdHJpbmcsIG51bWJlcj47XG4gICAgZGF0ZT86IERhdGU7XG4gIH0sXG4gIG9wdGlvbnM6IFZhbGlkYXRpb25PcHRpb25zID0ge31cbik6IFByb21pc2U8VmFsaWRhdGlvblJlc3VsdD4ge1xuICBjb25zdCB7IHZhbGlkYXRlVHJhbnNpdHMgPSBmYWxzZSB9ID0gb3B0aW9ucztcbiAgY29uc3QgZXJyb3JzOiBzdHJpbmdbXSA9IFtdO1xuICBjb25zdCB3YXJuaW5nczogc3RyaW5nW10gPSBbXTtcbiAgY29uc3QgY29ycmVjdGVkRGF0YTogUmVjb3JkPHN0cmluZywgdW5rbm93bj4gPSB7fTtcblxuICB0cnkge1xuICAgIC8vIFZhbGlkYXRlIHBsYW5ldGFyeSBwb3NpdGlvbnNcbiAgICBpZiAoaW5wdXQucGxhbmV0YXJ5UG9zaXRpb25zKSB7XG4gICAgICBjb25zdCBwb3NpdGlvblZhbGlkYXRpb24gPSB2YWxpZGF0ZVBsYW5ldGFyeVBvc2l0aW9ucyhpbnB1dC5wbGFuZXRhcnlQb3NpdGlvbnMsIG9wdGlvbnMpO1xuICAgICAgZXJyb3JzLnB1c2goLi4ucG9zaXRpb25WYWxpZGF0aW9uLmVycm9ycyk7XG4gICAgICB3YXJuaW5ncy5wdXNoKC4uLnBvc2l0aW9uVmFsaWRhdGlvbi53YXJuaW5ncyk7XG4gICAgICBcbiAgICAgIGlmIChwb3NpdGlvblZhbGlkYXRpb24uY29ycmVjdGVkRGF0YSkge1xuICAgICAgICBjb3JyZWN0ZWREYXRhLnBsYW5ldGFyeVBvc2l0aW9ucyA9IHBvc2l0aW9uVmFsaWRhdGlvbi5jb3JyZWN0ZWREYXRhO1xuICAgICAgfVxuXG4gICAgICAvLyBWYWxpZGF0ZSBhZ2FpbnN0IHRyYW5zaXQgZGF0ZXMgaWYgcmVxdWVzdGVkXG4gICAgICBpZiAodmFsaWRhdGVUcmFuc2l0cyAmJiBwb3NpdGlvblZhbGlkYXRpb24uaXNWYWxpZCAmJiBpbnB1dC5kYXRlKSB7XG4gICAgICAgIGZvciAoY29uc3QgW3BsYW5ldCwgcG9zaXRpb25dIG9mIE9iamVjdC5lbnRyaWVzKGlucHV0LnBsYW5ldGFyeVBvc2l0aW9ucykpIHtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgaXNWYWxpZCA9IGF3YWl0IHZhbGlkYXRlUGxhbmV0YXJ5UG9zaXRpb24ocGxhbmV0LCBwb3NpdGlvbiBhcyBhbnksIGlucHV0LmRhdGUpO1xuICAgICAgICAgICAgaWYgKCFpc1ZhbGlkKSB7XG4gICAgICAgICAgICAgIHdhcm5pbmdzLnB1c2goYFRyYW5zaXQgdmFsaWRhdGlvbiBmYWlsZWQgZm9yICR7cGxhbmV0fWApO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICB3YXJuaW5ncy5wdXNoKGBDb3VsZCBub3QgdmFsaWRhdGUgdHJhbnNpdCBmb3IgJHtwbGFuZXR9OiAke2Vycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InfWApO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIFZhbGlkYXRlIGVsZW1lbnRhbCBwcm9wZXJ0aWVzXG4gICAgaWYgKGlucHV0LmVsZW1lbnRhbFByb3BlcnRpZXMpIHtcbiAgICAgIGNvbnN0IGVsZW1lbnRhbFZhbGlkYXRpb24gPSB2YWxpZGF0ZUFzdHJvbG9naWNhbEVsZW1lbnRhbFByb3BlcnRpZXMoXG4gICAgICAgIGlucHV0LmVsZW1lbnRhbFByb3BlcnRpZXMsXG4gICAgICAgICdjYWxjdWxhdGlvbiBpbnB1dCdcbiAgICAgICk7XG4gICAgICBlcnJvcnMucHVzaCguLi5lbGVtZW50YWxWYWxpZGF0aW9uLmVycm9ycyk7XG4gICAgICB3YXJuaW5ncy5wdXNoKC4uLmVsZW1lbnRhbFZhbGlkYXRpb24ud2FybmluZ3MpO1xuICAgICAgXG4gICAgICBpZiAoZWxlbWVudGFsVmFsaWRhdGlvbi5jb3JyZWN0ZWREYXRhKSB7XG4gICAgICAgIGNvcnJlY3RlZERhdGEuZWxlbWVudGFsUHJvcGVydGllcyA9IGVsZW1lbnRhbFZhbGlkYXRpb24uY29ycmVjdGVkRGF0YTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICAvLyBWYWxpZGF0ZSBjb25zdGFudHNcbiAgICBpZiAoaW5wdXQuY29uc3RhbnRzKSB7XG4gICAgICBjb25zdCBjb25zdGFudHNWYWxpZGF0aW9uID0gdmFsaWRhdGVNYXRoZW1hdGljYWxDb25zdGFudHMoaW5wdXQuY29uc3RhbnRzKTtcbiAgICAgIGVycm9ycy5wdXNoKC4uLmNvbnN0YW50c1ZhbGlkYXRpb24uZXJyb3JzKTtcbiAgICAgIHdhcm5pbmdzLnB1c2goLi4uY29uc3RhbnRzVmFsaWRhdGlvbi53YXJuaW5ncyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIGlzVmFsaWQ6IGVycm9ycy5sZW5ndGggPT09IDAsXG4gICAgICBlcnJvcnMsXG4gICAgICB3YXJuaW5ncyxcbiAgICAgIGNvcnJlY3RlZERhdGE6IE9iamVjdC5rZXlzKGNvcnJlY3RlZERhdGEpLmxlbmd0aCA+IDAgPyBjb3JyZWN0ZWREYXRhIDogdW5kZWZpbmVkXG4gICAgfTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBlcnJvcnMucHVzaChgQ29tcHJlaGVuc2l2ZSB2YWxpZGF0aW9uIGVycm9yOiAke2Vycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InfWApO1xuICAgIHJldHVybiB7IGlzVmFsaWQ6IGZhbHNlLCBlcnJvcnMsIHdhcm5pbmdzIH07XG4gIH1cbn1cblxuLyoqXG4gKiBRdWljayB2YWxpZGF0aW9uIGZvciBkZXZlbG9wbWVudCB1c2VcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHF1aWNrVmFsaWRhdGUoZGF0YTogdW5rbm93biwgdHlwZTogJ3BsYW5ldGFyeScgfCAnZWxlbWVudGFsJyB8ICdjb25zdGFudHMnKTogYm9vbGVhbiB7XG4gIHRyeSB7XG4gICAgc3dpdGNoICh0eXBlKSB7XG4gICAgICBjYXNlICdwbGFuZXRhcnknOlxuICAgICAgICByZXR1cm4gdmFsaWRhdGVQbGFuZXRhcnlQb3NpdGlvbnMoZGF0YSBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPikuaXNWYWxpZDtcbiAgICAgIGNhc2UgJ2VsZW1lbnRhbCc6XG4gICAgICAgIHJldHVybiB2YWxpZGF0ZUVsZW1lbnRhbFByb3BlcnRpZXMoZGF0YSk7XG4gICAgICBjYXNlICdjb25zdGFudHMnOlxuICAgICAgICByZXR1cm4gdmFsaWRhdGVNYXRoZW1hdGljYWxDb25zdGFudHMoZGF0YSBhcyBSZWNvcmQ8c3RyaW5nLCBudW1iZXI+KS5pc1ZhbGlkO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfSBjYXRjaCB7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG59XG5cbi8qKlxuICogRXhwb3J0IGFsbCB2YWxpZGF0aW9uIGNvbnN0YW50c1xuICovXG5leHBvcnQgY29uc3QgVkFMSURBVElPTl9DT05TVEFOVFMgPSB7XG4gIC4uLkVMRU1FTlRBTF9DT05TVEFOVFMsXG4gIC4uLlRSQU5TSVRfQ09OU1RBTlRTLFxuICBWQUxJREFUSU9OX1RJTUVPVVQ6IDUwMDAsXG4gIE1BWF9WQUxJREFUSU9OX0VSUk9SUzogNTAsXG4gIEFVVE9fQ09SUkVDVF9USFJFU0hPTEQ6IDAuMVxufSBhcyBjb25zdDsiXSwidmVyc2lvbiI6M30=