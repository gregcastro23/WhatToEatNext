88921d0da4a4d4170c53f4d2fa4b1fd7
"use strict";
/**
 * Centralized Logging Service for WhatToEatNext
 *
 * Provides structured logging with different levels and contexts.
 * Replaces _logger.info statements in production code while preserving
 * _logger.warn and _logger.error for debugging purposes.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.LoggingService = exports.log = exports.LogLevel = void 0;
var LogLevel;
(function (LogLevel) {
    LogLevel[LogLevel["DEBUG"] = 0] = "DEBUG";
    LogLevel[LogLevel["INFO"] = 1] = "INFO";
    LogLevel[LogLevel["WARN"] = 2] = "WARN";
    LogLevel[LogLevel["ERROR"] = 3] = "ERROR";
    LogLevel[LogLevel["SILENT"] = 4] = "SILENT";
})(LogLevel || (exports.LogLevel = LogLevel = {}));
class LoggingService {
    static instance;
    logLevel = LogLevel.INFO;
    isDevelopment;
    logBuffer = [];
    maxBufferSize = 1000;
    constructor() {
        this.isDevelopment = process.env.NODE_ENV === 'development';
        // Set log level based on environment
        if (this.isDevelopment) {
            this.logLevel = LogLevel.DEBUG;
        }
        else if (process.env.NODE_ENV === 'test') {
            this.logLevel = LogLevel.WARN;
        }
        else {
            this.logLevel = LogLevel.INFO;
        }
    }
    static getInstance() {
        if (!LoggingService.instance) {
            LoggingService.instance = new LoggingService();
        }
        return LoggingService.instance;
    }
    setLogLevel(level) {
        this.logLevel = level;
    }
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    debug(message, context, data) {
        this.log(LogLevel.DEBUG, message, context, undefined, data);
    }
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    info(message, context, data) {
        this.log(LogLevel.INFO, message, context, undefined, data);
    }
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    warn(message, context, data) {
        this.log(LogLevel.WARN, message, context, undefined, data);
    }
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    error(message, context, error, data) {
        this.log(LogLevel.ERROR, message, context, error, data);
    }
    log(level, message, context, error, data) {
        if (level < this.logLevel) {
            return;
        }
        const logEntry = {
            timestamp: new Date(),
            level,
            message,
            context,
            error,
            data
        };
        // Add to buffer
        this.addToBuffer(logEntry);
        // Output to console based on level and environment
        this.outputToConsole(logEntry);
    }
    addToBuffer(entry) {
        this.logBuffer.push(entry);
        // Maintain buffer size
        if (this.logBuffer.length > this.maxBufferSize) {
            this.logBuffer.shift();
        }
    }
    outputToConsole(entry) {
        const timestamp = entry.timestamp.toISOString();
        const contextStr = entry.context ? this.formatContext(entry.context) : '';
        const levelStr = LogLevel[entry.level];
        const baseMessage = `[${timestamp}] ${levelStr}: ${entry.message}${contextStr}`;
        switch (entry.level) {
            case LogLevel.DEBUG:
                if (this.isDevelopment) {
                    exports.log.info(`🐛 ${baseMessage}`, entry.data || '');
                }
                break;
            case LogLevel.INFO:
                exports.log.info(`ℹ️ ${baseMessage}`, entry.data || '');
                break;
            case LogLevel.WARN:
                _logger.warn(`⚠️ ${baseMessage}`, entry.data || '');
                break;
            case LogLevel.ERROR:
                _logger.error(`❌ ${baseMessage}`, entry.error || entry.data || '');
                break;
        }
    }
    formatContext(context) {
        const parts = [];
        if (context.component)
            parts.push(`component=${context.component}`);
        if (context.service)
            parts.push(`service=${context.service}`);
        if (context.function)
            parts.push(`function=${context.function}`);
        if (context.userId)
            parts.push(`user=${context.userId}`);
        if (context.sessionId)
            parts.push(`session=${context.sessionId}`);
        if (context.requestId)
            parts.push(`request=${context.requestId}`);
        // Add other context properties
        Object.keys(context).forEach(key => {
            if (!['component', 'service', 'function', 'userId', 'sessionId', 'requestId'].includes(key)) {
                parts.push(`${key}=${context[key]}`);
            }
        });
        return parts.length > 0 ? ` [${parts.join(', ')}]` : '';
    }
    getLogBuffer() {
        return [...this.logBuffer];
    }
    clearLogBuffer() {
        this.logBuffer = [];
    }
    exportLogs() {
        return this.logBuffer
            .map(entry => {
            const timestamp = entry.timestamp.toISOString();
            const level = LogLevel[entry.level];
            const context = entry.context ? this.formatContext(entry.context) : '';
            const errorStr = entry.error ? ` ERROR: ${entry.error.message}` : '';
            const dataStr = entry.data ? ` DATA: ${JSON.stringify(entry.data)}` : '';
            return `[${timestamp}] ${level}: ${entry.message}${context}${errorStr}${dataStr}`;
        })
            .join('\n');
    }
}
exports.LoggingService = LoggingService;
// Create singleton instance
const logger = LoggingService.getInstance();
// Export convenience functions
exports.log = {
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    debug: (message, context, data) => logger.debug(message, context, data),
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    info: (message, context, data) => logger.info(message, context, data),
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    warn: (message, context, data) => logger.warn(message, context, data),
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    error: (message, context, error, data) => logger.error(message, context, error, data)
};
exports.default = logger;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9zZXJ2aWNlcy9Mb2dnaW5nU2VydmljZS50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7OztHQU1HOzs7QUFFSCxJQUFZLFFBTVg7QUFORCxXQUFZLFFBQVE7SUFDbEIseUNBQVMsQ0FBQTtJQUNULHVDQUFRLENBQUE7SUFDUix1Q0FBUSxDQUFBO0lBQ1IseUNBQVMsQ0FBQTtJQUNULDJDQUFVLENBQUE7QUFDWixDQUFDLEVBTlcsUUFBUSx3QkFBUixRQUFRLFFBTW5CO0FBMkJELE1BQU0sY0FBYztJQUNWLE1BQU0sQ0FBQyxRQUFRLENBQWlCO0lBQ2hDLFFBQVEsR0FBYSxRQUFRLENBQUMsSUFBSSxDQUFDO0lBQ25DLGFBQWEsQ0FBVTtJQUN2QixTQUFTLEdBQWUsRUFBRSxDQUFDO0lBQzNCLGFBQWEsR0FBRyxJQUFJLENBQUM7SUFFN0I7UUFDRSxJQUFJLENBQUMsYUFBYSxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsUUFBUSxLQUFLLGFBQWEsQ0FBQztRQUU1RCxxQ0FBcUM7UUFDckMsSUFBSSxJQUFJLENBQUMsYUFBYSxFQUFFO1lBQ3RCLElBQUksQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFDLEtBQUssQ0FBQztTQUNoQzthQUFNLElBQUksT0FBTyxDQUFDLEdBQUcsQ0FBQyxRQUFRLEtBQUssTUFBTSxFQUFFO1lBQzFDLElBQUksQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFDLElBQUksQ0FBQztTQUMvQjthQUFNO1lBQ0wsSUFBSSxDQUFDLFFBQVEsR0FBRyxRQUFRLENBQUMsSUFBSSxDQUFDO1NBQy9CO0lBQ0gsQ0FBQztJQUVNLE1BQU0sQ0FBQyxXQUFXO1FBQ3ZCLElBQUksQ0FBQyxjQUFjLENBQUMsUUFBUSxFQUFFO1lBQzVCLGNBQWMsQ0FBQyxRQUFRLEdBQUcsSUFBSSxjQUFjLEVBQUUsQ0FBQztTQUNoRDtRQUNELE9BQU8sY0FBYyxDQUFDLFFBQVEsQ0FBQztJQUNqQyxDQUFDO0lBRU0sV0FBVyxDQUFDLEtBQWU7UUFDaEMsSUFBSSxDQUFDLFFBQVEsR0FBRyxLQUFLLENBQUM7SUFDeEIsQ0FBQztJQUVELDhEQUE4RDtJQUN2RCxLQUFLLENBQUMsT0FBZSxFQUFFLE9BQW9CLEVBQUUsSUFBVTtRQUM1RCxJQUFJLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxLQUFLLEVBQUUsT0FBTyxFQUFFLE9BQU8sRUFBRSxTQUFTLEVBQUUsSUFBSSxDQUFDLENBQUE7SUFDN0QsQ0FBQztJQUVELDhEQUE4RDtJQUN2RCxJQUFJLENBQUMsT0FBZSxFQUFFLE9BQW9CLEVBQUUsSUFBVTtRQUMzRCxJQUFJLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxJQUFJLEVBQUUsT0FBTyxFQUFFLE9BQU8sRUFBRSxTQUFTLEVBQUUsSUFBSSxDQUFDLENBQUE7SUFDNUQsQ0FBQztJQUVELDhEQUE4RDtJQUN2RCxJQUFJLENBQUMsT0FBZSxFQUFFLE9BQW9CLEVBQUUsSUFBVTtRQUMzRCxJQUFJLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxJQUFJLEVBQUUsT0FBTyxFQUFFLE9BQU8sRUFBRSxTQUFTLEVBQUUsSUFBSSxDQUFDLENBQUE7SUFDNUQsQ0FBQztJQUVELDhEQUE4RDtJQUN2RCxLQUFLLENBQUMsT0FBZSxFQUFFLE9BQW9CLEVBQUUsS0FBYSxFQUFFLElBQVU7UUFDM0UsSUFBSSxDQUFDLEdBQUcsQ0FBQyxRQUFRLENBQUMsS0FBSyxFQUFFLE9BQU8sRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLElBQUksQ0FBQyxDQUFBO0lBQ3pELENBQUM7SUFHTyxHQUFHLENBQ1QsS0FBZSxFQUNmLE9BQWUsRUFDZixPQUFvQixFQUNwQixLQUFhLEVBQ2IsSUFBYztRQUVkLElBQUksS0FBSyxHQUFHLElBQUksQ0FBQyxRQUFRLEVBQUU7WUFDekIsT0FBTTtTQUNQO1FBRUQsTUFBTSxRQUFRLEdBQWE7WUFDekIsU0FBUyxFQUFFLElBQUksSUFBSSxFQUFFO1lBQ3JCLEtBQUs7WUFDTCxPQUFPO1lBQ1AsT0FBTztZQUNQLEtBQUs7WUFDTCxJQUFJO1NBQ0wsQ0FBQTtRQUVELGdCQUFnQjtRQUNoQixJQUFJLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQyxDQUFBO1FBRTFCLG1EQUFtRDtRQUNuRCxJQUFJLENBQUMsZUFBZSxDQUFDLFFBQVEsQ0FBQyxDQUFBO0lBQ2hDLENBQUM7SUFFTyxXQUFXLENBQUMsS0FBZTtRQUNqQyxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQTtRQUUxQix1QkFBdUI7UUFDdkIsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsYUFBYSxFQUFFO1lBQzlDLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxFQUFFLENBQUE7U0FDdkI7SUFDSCxDQUFDO0lBRU8sZUFBZSxDQUFDLEtBQWU7UUFDckMsTUFBTSxTQUFTLEdBQUcsS0FBSyxDQUFDLFNBQVMsQ0FBQyxXQUFXLEVBQUUsQ0FBQztRQUNoRCxNQUFNLFVBQVUsR0FBRyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDO1FBQzFFLE1BQU0sUUFBUSxHQUFHLFFBQVEsQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDdkMsTUFBTSxXQUFXLEdBQUcsSUFBSSxTQUFTLEtBQUssUUFBUSxLQUFLLEtBQUssQ0FBQyxPQUFPLEdBQUcsVUFBVSxFQUFFLENBQUM7UUFFaEYsUUFBUSxLQUFLLENBQUMsS0FBSyxFQUFFO1lBQ25CLEtBQUssUUFBUSxDQUFDLEtBQUs7Z0JBQ2pCLElBQUksSUFBSSxDQUFDLGFBQWEsRUFBRTtvQkFDdEIsV0FBRyxDQUFDLElBQUksQ0FBQyxNQUFNLFdBQVcsRUFBRSxFQUFFLEtBQUssQ0FBQyxJQUFJLElBQUksRUFBRSxDQUFDLENBQUM7aUJBQ2pEO2dCQUNELE1BQU07WUFFUixLQUFLLFFBQVEsQ0FBQyxJQUFJO2dCQUNoQixXQUFHLENBQUMsSUFBSSxDQUFDLE1BQU0sV0FBVyxFQUFFLEVBQUUsS0FBSyxDQUFDLElBQUksSUFBSSxFQUFFLENBQUMsQ0FBQztnQkFDaEQsTUFBTTtZQUVSLEtBQUssUUFBUSxDQUFDLElBQUk7Z0JBQ2hCLE9BQU8sQ0FBQyxJQUFJLENBQUMsTUFBTSxXQUFXLEVBQUUsRUFBRSxLQUFLLENBQUMsSUFBSSxJQUFJLEVBQUUsQ0FBQyxDQUFDO2dCQUNwRCxNQUFNO1lBRVIsS0FBSyxRQUFRLENBQUMsS0FBSztnQkFDakIsT0FBTyxDQUFDLEtBQUssQ0FBQyxLQUFLLFdBQVcsRUFBRSxFQUFFLEtBQUssQ0FBQyxLQUFLLElBQUksS0FBSyxDQUFDLElBQUksSUFBSSxFQUFFLENBQUMsQ0FBQztnQkFDbkUsTUFBTTtTQUNUO0lBQ0gsQ0FBQztJQUVPLGFBQWEsQ0FBQyxPQUFtQjtRQUN2QyxNQUFNLEtBQUssR0FBYSxFQUFFLENBQUM7UUFFM0IsSUFBSSxPQUFPLENBQUMsU0FBUztZQUFFLEtBQUssQ0FBQyxJQUFJLENBQUMsYUFBYSxPQUFPLENBQUMsU0FBUyxFQUFFLENBQUMsQ0FBQTtRQUNuRSxJQUFJLE9BQU8sQ0FBQyxPQUFPO1lBQUUsS0FBSyxDQUFDLElBQUksQ0FBQyxXQUFXLE9BQU8sQ0FBQyxPQUFPLEVBQUUsQ0FBQyxDQUFBO1FBQzdELElBQUksT0FBTyxDQUFDLFFBQVE7WUFBRSxLQUFLLENBQUMsSUFBSSxDQUFDLFlBQVksT0FBTyxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUE7UUFDaEUsSUFBSSxPQUFPLENBQUMsTUFBTTtZQUFFLEtBQUssQ0FBQyxJQUFJLENBQUMsUUFBUSxPQUFPLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQTtRQUN4RCxJQUFJLE9BQU8sQ0FBQyxTQUFTO1lBQUUsS0FBSyxDQUFDLElBQUksQ0FBQyxXQUFXLE9BQU8sQ0FBQyxTQUFTLEVBQUUsQ0FBQyxDQUFBO1FBQ2pFLElBQUksT0FBTyxDQUFDLFNBQVM7WUFBRSxLQUFLLENBQUMsSUFBSSxDQUFDLFdBQVcsT0FBTyxDQUFDLFNBQVMsRUFBRSxDQUFDLENBQUE7UUFFakUsK0JBQStCO1FBQy9CLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxFQUFFO1lBQ2pDLElBQUksQ0FBQyxDQUFDLFdBQVcsRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBRSxXQUFXLEVBQUUsV0FBVyxDQUFDLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxFQUFFO2dCQUMzRixLQUFLLENBQUMsSUFBSSxDQUFDLEdBQUcsR0FBRyxJQUFJLE9BQU8sQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLENBQUE7YUFDckM7UUFDSCxDQUFDLENBQUMsQ0FBQTtRQUVGLE9BQU8sS0FBSyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7SUFDMUQsQ0FBQztJQUVNLFlBQVk7UUFDakIsT0FBTyxDQUFDLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBQzdCLENBQUM7SUFFTSxjQUFjO1FBQ25CLElBQUksQ0FBQyxTQUFTLEdBQUcsRUFBRSxDQUFDO0lBQ3RCLENBQUM7SUFFTSxVQUFVO1FBQ2YsT0FBTyxJQUFJLENBQUMsU0FBUzthQUNsQixHQUFHLENBQUMsS0FBSyxDQUFDLEVBQUU7WUFDWCxNQUFNLFNBQVMsR0FBRyxLQUFLLENBQUMsU0FBUyxDQUFDLFdBQVcsRUFBRSxDQUFDO1lBQ2hELE1BQU0sS0FBSyxHQUFHLFFBQVEsQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDcEMsTUFBTSxPQUFPLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztZQUN2RSxNQUFNLFFBQVEsR0FBRyxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxXQUFXLEtBQUssQ0FBQyxLQUFLLENBQUMsT0FBTyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQztZQUNyRSxNQUFNLE9BQU8sR0FBRyxLQUFLLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxVQUFVLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQTtZQUV4RSxPQUFPLElBQUksU0FBUyxLQUFLLEtBQUssS0FBSyxLQUFLLENBQUMsT0FBTyxHQUFHLE9BQU8sR0FBRyxRQUFRLEdBQUcsT0FBTyxFQUFFLENBQUM7UUFDcEYsQ0FBQyxDQUFDO2FBQ0QsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFBO0lBQ2YsQ0FBQztDQUNGO0FBcUJRLHdDQUFjO0FBbkJ2Qiw0QkFBNEI7QUFDNUIsTUFBTSxNQUFNLEdBQUcsY0FBYyxDQUFDLFdBQVcsRUFBRSxDQUFBO0FBRTNDLCtCQUErQjtBQUVsQixRQUFBLEdBQUcsR0FBRztJQUNqQiw4REFBOEQ7SUFDOUQsS0FBSyxFQUFFLENBQUMsT0FBZSxFQUFFLE9BQW9CLEVBQUUsSUFBVSxFQUFFLEVBQUUsQ0FDM0QsTUFBTSxDQUFDLEtBQUssQ0FBQyxPQUFPLEVBQUUsT0FBTyxFQUFFLElBQUksQ0FBQztJQUN0Qyw4REFBOEQ7SUFDOUQsSUFBSSxFQUFFLENBQUMsT0FBZSxFQUFFLE9BQW9CLEVBQUUsSUFBVSxFQUFFLEVBQUUsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sRUFBRSxPQUFPLEVBQUUsSUFBSSxDQUFDO0lBQ2hHLDhEQUE4RDtJQUM5RCxJQUFJLEVBQUUsQ0FBQyxPQUFlLEVBQUUsT0FBb0IsRUFBRSxJQUFVLEVBQUUsRUFBRSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLE9BQU8sRUFBRSxJQUFJLENBQUM7SUFDaEcsOERBQThEO0lBQzlELEtBQUssRUFBRSxDQUFDLE9BQWUsRUFBRSxPQUFvQixFQUFFLEtBQWEsRUFBRSxJQUFVLEVBQUUsRUFBRSxDQUMxRSxNQUFNLENBQUMsS0FBSyxDQUFDLE9BQU8sRUFBRSxPQUFPLEVBQUUsS0FBSyxFQUFFLElBQUksQ0FBQztDQUM5QyxDQUFBO0FBSUQsa0JBQWUsTUFBTSxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9HcmVnQ2FzdHJvL0Rlc2t0b3AvV2hhdFRvRWF0TmV4dC9zcmMvc2VydmljZXMvTG9nZ2luZ1NlcnZpY2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDZW50cmFsaXplZCBMb2dnaW5nIFNlcnZpY2UgZm9yIFdoYXRUb0VhdE5leHRcbiAqXG4gKiBQcm92aWRlcyBzdHJ1Y3R1cmVkIGxvZ2dpbmcgd2l0aCBkaWZmZXJlbnQgbGV2ZWxzIGFuZCBjb250ZXh0cy5cbiAqIFJlcGxhY2VzIF9sb2dnZXIuaW5mbyBzdGF0ZW1lbnRzIGluIHByb2R1Y3Rpb24gY29kZSB3aGlsZSBwcmVzZXJ2aW5nXG4gKiBfbG9nZ2VyLndhcm4gYW5kIF9sb2dnZXIuZXJyb3IgZm9yIGRlYnVnZ2luZyBwdXJwb3Nlcy5cbiAqL1xuXG5leHBvcnQgZW51bSBMb2dMZXZlbCB7XG4gIERFQlVHID0gMCxcbiAgSU5GTyA9IDEsXG4gIFdBUk4gPSAyLFxuICBFUlJPUiA9IDMsXG4gIFNJTEVOVCA9IDRcbn1cblxuZXhwb3J0IGludGVyZmFjZSBMb2dDb250ZXh0IHtcbiAgY29tcG9uZW50Pzogc3RyaW5nLFxuICBzZXJ2aWNlPzogc3RyaW5nLFxuICBmdW5jdGlvbj86IHN0cmluZyxcbiAgdXNlcklkPzogc3RyaW5nLFxuICBzZXNzaW9uSWQ/OiBzdHJpbmcsXG4gIHJlcXVlc3RJZD86IHN0cmluZyxcblxuICAvLyBJbnRlbnRpb25hbGx5IGFueTogTG9nZ2luZyBjb250ZXh0IG5lZWRzIGZsZXhpYmlsaXR5IGZvciB2YXJpb3VzIG1ldGFkYXRhXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55IC0tIEhpZ2gtcmlzayBkb21haW4gcmVxdWlyaW5nIGZsZXhpYmlsaXR5XG4gIFtrZXk6IHN0cmluZ106IGFueVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIExvZ0VudHJ5IHtcbiAgdGltZXN0YW1wOiBEYXRlLFxuICBsZXZlbDogTG9nTGV2ZWwsXG4gIG1lc3NhZ2U6IHN0cmluZyxcbiAgY29udGV4dD86IExvZ0NvbnRleHQsXG4gIGVycm9yPzogRXJyb3IsXG5cbiAgLy8gSW50ZW50aW9uYWxseSwgYW55OiBMb2cgZGF0YSBjYW4gYmUgb2YgYW55IHR5cGUgZm9yIGRlYnVnZ2luZyBwdXJwb3Nlc1xuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueSAtLSBIaWdoLXJpc2sgZG9tYWluIHJlcXVpcmluZyBmbGV4aWJpbGl0eVxuICBkYXRhPzogYW55XG59XG5cbmNsYXNzIExvZ2dpbmdTZXJ2aWNlIHtcbiAgcHJpdmF0ZSBzdGF0aWMgaW5zdGFuY2U6IExvZ2dpbmdTZXJ2aWNlO1xuICBwcml2YXRlIGxvZ0xldmVsOiBMb2dMZXZlbCA9IExvZ0xldmVsLklORk87XG4gIHByaXZhdGUgaXNEZXZlbG9wbWVudDogYm9vbGVhbjtcbiAgcHJpdmF0ZSBsb2dCdWZmZXI6IExvZ0VudHJ5W10gPSBbXTtcbiAgcHJpdmF0ZSBtYXhCdWZmZXJTaXplID0gMTAwMDtcblxuICBwcml2YXRlIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuaXNEZXZlbG9wbWVudCA9IHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnO1xuXG4gICAgLy8gU2V0IGxvZyBsZXZlbCBiYXNlZCBvbiBlbnZpcm9ubWVudFxuICAgIGlmICh0aGlzLmlzRGV2ZWxvcG1lbnQpIHtcbiAgICAgIHRoaXMubG9nTGV2ZWwgPSBMb2dMZXZlbC5ERUJVRztcbiAgICB9IGVsc2UgaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAndGVzdCcpIHtcbiAgICAgIHRoaXMubG9nTGV2ZWwgPSBMb2dMZXZlbC5XQVJOO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmxvZ0xldmVsID0gTG9nTGV2ZWwuSU5GTztcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgc3RhdGljIGdldEluc3RhbmNlKCk6IExvZ2dpbmdTZXJ2aWNlIHtcbiAgICBpZiAoIUxvZ2dpbmdTZXJ2aWNlLmluc3RhbmNlKSB7XG4gICAgICBMb2dnaW5nU2VydmljZS5pbnN0YW5jZSA9IG5ldyBMb2dnaW5nU2VydmljZSgpO1xuICAgIH1cbiAgICByZXR1cm4gTG9nZ2luZ1NlcnZpY2UuaW5zdGFuY2U7XG4gIH1cblxuICBwdWJsaWMgc2V0TG9nTGV2ZWwobGV2ZWw6IExvZ0xldmVsKTogdm9pZCB7XG4gICAgdGhpcy5sb2dMZXZlbCA9IGxldmVsO1xuICB9XG5cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbiAgcHVibGljIGRlYnVnKG1lc3NhZ2U6IHN0cmluZywgY29udGV4dD86IExvZ0NvbnRleHQsIGRhdGE/OiBhbnkpOiB2b2lkIHtcbiAgICB0aGlzLmxvZyhMb2dMZXZlbC5ERUJVRywgbWVzc2FnZSwgY29udGV4dCwgdW5kZWZpbmVkLCBkYXRhKVxuICB9XG5cbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbiAgcHVibGljIGluZm8obWVzc2FnZTogc3RyaW5nLCBjb250ZXh0PzogTG9nQ29udGV4dCwgZGF0YT86IGFueSk6IHZvaWQge1xuICAgIHRoaXMubG9nKExvZ0xldmVsLklORk8sIG1lc3NhZ2UsIGNvbnRleHQsIHVuZGVmaW5lZCwgZGF0YSlcbiAgfVxuXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4gIHB1YmxpYyB3YXJuKG1lc3NhZ2U6IHN0cmluZywgY29udGV4dD86IExvZ0NvbnRleHQsIGRhdGE/OiBhbnkpOiB2b2lkIHtcbiAgICB0aGlzLmxvZyhMb2dMZXZlbC5XQVJOLCBtZXNzYWdlLCBjb250ZXh0LCB1bmRlZmluZWQsIGRhdGEpXG4gIH1cblxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICBwdWJsaWMgZXJyb3IobWVzc2FnZTogc3RyaW5nLCBjb250ZXh0PzogTG9nQ29udGV4dCwgZXJyb3I/OiBFcnJvciwgZGF0YT86IGFueSk6IHZvaWQge1xuICAgIHRoaXMubG9nKExvZ0xldmVsLkVSUk9SLCBtZXNzYWdlLCBjb250ZXh0LCBlcnJvciwgZGF0YSlcbiAgfVxuXG5cbiAgcHJpdmF0ZSBsb2coXG4gICAgbGV2ZWw6IExvZ0xldmVsLFxuICAgIG1lc3NhZ2U6IHN0cmluZyxcbiAgICBjb250ZXh0PzogTG9nQ29udGV4dCxcbiAgICBlcnJvcj86IEVycm9yLFxuICAgIGRhdGE/OiB1bmtub3duLFxuICApOiB2b2lkIHtcbiAgICBpZiAobGV2ZWwgPCB0aGlzLmxvZ0xldmVsKSB7XG4gICAgICByZXR1cm5cbiAgICB9XG5cbiAgICBjb25zdCBsb2dFbnRyeTogTG9nRW50cnkgPSB7XG4gICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAgICBsZXZlbCxcbiAgICAgIG1lc3NhZ2UsXG4gICAgICBjb250ZXh0LFxuICAgICAgZXJyb3IsXG4gICAgICBkYXRhXG4gICAgfVxuXG4gICAgLy8gQWRkIHRvIGJ1ZmZlclxuICAgIHRoaXMuYWRkVG9CdWZmZXIobG9nRW50cnkpXG5cbiAgICAvLyBPdXRwdXQgdG8gY29uc29sZSBiYXNlZCBvbiBsZXZlbCBhbmQgZW52aXJvbm1lbnRcbiAgICB0aGlzLm91dHB1dFRvQ29uc29sZShsb2dFbnRyeSlcbiAgfVxuXG4gIHByaXZhdGUgYWRkVG9CdWZmZXIoZW50cnk6IExvZ0VudHJ5KTogdm9pZCB7XG4gICAgdGhpcy5sb2dCdWZmZXIucHVzaChlbnRyeSlcblxuICAgIC8vIE1haW50YWluIGJ1ZmZlciBzaXplXG4gICAgaWYgKHRoaXMubG9nQnVmZmVyLmxlbmd0aCA+IHRoaXMubWF4QnVmZmVyU2l6ZSkge1xuICAgICAgdGhpcy5sb2dCdWZmZXIuc2hpZnQoKVxuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgb3V0cHV0VG9Db25zb2xlKGVudHJ5OiBMb2dFbnRyeSk6IHZvaWQge1xuICAgIGNvbnN0IHRpbWVzdGFtcCA9IGVudHJ5LnRpbWVzdGFtcC50b0lTT1N0cmluZygpO1xuICAgIGNvbnN0IGNvbnRleHRTdHIgPSBlbnRyeS5jb250ZXh0ID8gdGhpcy5mb3JtYXRDb250ZXh0KGVudHJ5LmNvbnRleHQpIDogJyc7XG4gICAgY29uc3QgbGV2ZWxTdHIgPSBMb2dMZXZlbFtlbnRyeS5sZXZlbF07XG4gICAgY29uc3QgYmFzZU1lc3NhZ2UgPSBgWyR7dGltZXN0YW1wfV0gJHtsZXZlbFN0cn06ICR7ZW50cnkubWVzc2FnZX0ke2NvbnRleHRTdHJ9YDtcblxuICAgIHN3aXRjaCAoZW50cnkubGV2ZWwpIHtcbiAgICAgIGNhc2UgTG9nTGV2ZWwuREVCVUc6XG4gICAgICAgIGlmICh0aGlzLmlzRGV2ZWxvcG1lbnQpIHtcbiAgICAgICAgICBsb2cuaW5mbyhg8J+QmyAke2Jhc2VNZXNzYWdlfWAsIGVudHJ5LmRhdGEgfHwgJycpO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlIExvZ0xldmVsLklORk86XG4gICAgICAgIGxvZy5pbmZvKGDihLnvuI8gJHtiYXNlTWVzc2FnZX1gLCBlbnRyeS5kYXRhIHx8ICcnKTtcbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgTG9nTGV2ZWwuV0FSTjpcbiAgICAgICAgX2xvZ2dlci53YXJuKGDimqDvuI8gJHtiYXNlTWVzc2FnZX1gLCBlbnRyeS5kYXRhIHx8ICcnKTtcbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgTG9nTGV2ZWwuRVJST1I6XG4gICAgICAgIF9sb2dnZXIuZXJyb3IoYOKdjCAke2Jhc2VNZXNzYWdlfWAsIGVudHJ5LmVycm9yIHx8IGVudHJ5LmRhdGEgfHwgJycpO1xuICAgICAgICBicmVhaztcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGZvcm1hdENvbnRleHQoY29udGV4dDogTG9nQ29udGV4dCk6IHN0cmluZyB7XG4gICAgY29uc3QgcGFydHM6IHN0cmluZ1tdID0gW107XG5cbiAgICBpZiAoY29udGV4dC5jb21wb25lbnQpIHBhcnRzLnB1c2goYGNvbXBvbmVudD0ke2NvbnRleHQuY29tcG9uZW50fWApXG4gICAgaWYgKGNvbnRleHQuc2VydmljZSkgcGFydHMucHVzaChgc2VydmljZT0ke2NvbnRleHQuc2VydmljZX1gKVxuICAgIGlmIChjb250ZXh0LmZ1bmN0aW9uKSBwYXJ0cy5wdXNoKGBmdW5jdGlvbj0ke2NvbnRleHQuZnVuY3Rpb259YClcbiAgICBpZiAoY29udGV4dC51c2VySWQpIHBhcnRzLnB1c2goYHVzZXI9JHtjb250ZXh0LnVzZXJJZH1gKVxuICAgIGlmIChjb250ZXh0LnNlc3Npb25JZCkgcGFydHMucHVzaChgc2Vzc2lvbj0ke2NvbnRleHQuc2Vzc2lvbklkfWApXG4gICAgaWYgKGNvbnRleHQucmVxdWVzdElkKSBwYXJ0cy5wdXNoKGByZXF1ZXN0PSR7Y29udGV4dC5yZXF1ZXN0SWR9YClcblxuICAgIC8vIEFkZCBvdGhlciBjb250ZXh0IHByb3BlcnRpZXNcbiAgICBPYmplY3Qua2V5cyhjb250ZXh0KS5mb3JFYWNoKGtleSA9PiB7XG4gICAgICBpZiAoIVsnY29tcG9uZW50JywgJ3NlcnZpY2UnLCAnZnVuY3Rpb24nLCAndXNlcklkJywgJ3Nlc3Npb25JZCcsICdyZXF1ZXN0SWQnXS5pbmNsdWRlcyhrZXkpKSB7XG4gICAgICAgIHBhcnRzLnB1c2goYCR7a2V5fT0ke2NvbnRleHRba2V5XX1gKVxuICAgICAgfVxuICAgIH0pXG5cbiAgICByZXR1cm4gcGFydHMubGVuZ3RoID4gMCA/IGAgWyR7cGFydHMuam9pbignLCAnKX1dYCA6ICcnO1xuICB9XG5cbiAgcHVibGljIGdldExvZ0J1ZmZlcigpOiBMb2dFbnRyeVtdIHtcbiAgICByZXR1cm4gWy4uLnRoaXMubG9nQnVmZmVyXTtcbiAgfVxuXG4gIHB1YmxpYyBjbGVhckxvZ0J1ZmZlcigpOiB2b2lkIHtcbiAgICB0aGlzLmxvZ0J1ZmZlciA9IFtdO1xuICB9XG5cbiAgcHVibGljIGV4cG9ydExvZ3MoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5sb2dCdWZmZXJcbiAgICAgIC5tYXAoZW50cnkgPT4ge1xuICAgICAgICBjb25zdCB0aW1lc3RhbXAgPSBlbnRyeS50aW1lc3RhbXAudG9JU09TdHJpbmcoKTtcbiAgICAgICAgY29uc3QgbGV2ZWwgPSBMb2dMZXZlbFtlbnRyeS5sZXZlbF07XG4gICAgICAgIGNvbnN0IGNvbnRleHQgPSBlbnRyeS5jb250ZXh0ID8gdGhpcy5mb3JtYXRDb250ZXh0KGVudHJ5LmNvbnRleHQpIDogJyc7XG4gICAgICAgIGNvbnN0IGVycm9yU3RyID0gZW50cnkuZXJyb3IgPyBgIEVSUk9SOiAke2VudHJ5LmVycm9yLm1lc3NhZ2V9YCA6ICcnO1xuICAgICAgICBjb25zdCBkYXRhU3RyID0gZW50cnkuZGF0YSA/IGAgREFUQTogJHtKU09OLnN0cmluZ2lmeShlbnRyeS5kYXRhKX1gIDogJydcblxuICAgICAgICByZXR1cm4gYFske3RpbWVzdGFtcH1dICR7bGV2ZWx9OiAke2VudHJ5Lm1lc3NhZ2V9JHtjb250ZXh0fSR7ZXJyb3JTdHJ9JHtkYXRhU3RyfWA7XG4gICAgICB9KVxuICAgICAgLmpvaW4oJ1xcbicpXG4gIH1cbn1cblxuLy8gQ3JlYXRlIHNpbmdsZXRvbiBpbnN0YW5jZVxuY29uc3QgbG9nZ2VyID0gTG9nZ2luZ1NlcnZpY2UuZ2V0SW5zdGFuY2UoKVxuXG4vLyBFeHBvcnQgY29udmVuaWVuY2UgZnVuY3Rpb25zXG5cbmV4cG9ydCBjb25zdCBsb2cgPSB7XG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4gIGRlYnVnOiAobWVzc2FnZTogc3RyaW5nLCBjb250ZXh0PzogTG9nQ29udGV4dCwgZGF0YT86IGFueSkgPT5cbiAgICBsb2dnZXIuZGVidWcobWVzc2FnZSwgY29udGV4dCwgZGF0YSksXG4gIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG4gIGluZm86IChtZXNzYWdlOiBzdHJpbmcsIGNvbnRleHQ/OiBMb2dDb250ZXh0LCBkYXRhPzogYW55KSA9PiBsb2dnZXIuaW5mbyhtZXNzYWdlLCBjb250ZXh0LCBkYXRhKSxcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcbiAgd2FybjogKG1lc3NhZ2U6IHN0cmluZywgY29udGV4dD86IExvZ0NvbnRleHQsIGRhdGE/OiBhbnkpID0+IGxvZ2dlci53YXJuKG1lc3NhZ2UsIGNvbnRleHQsIGRhdGEpLFxuICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuICBlcnJvcjogKG1lc3NhZ2U6IHN0cmluZywgY29udGV4dD86IExvZ0NvbnRleHQsIGVycm9yPzogRXJyb3IsIGRhdGE/OiBhbnkpID0+XG4gICAgbG9nZ2VyLmVycm9yKG1lc3NhZ2UsIGNvbnRleHQsIGVycm9yLCBkYXRhKVxufVxuXG4vLyBFeHBvcnQgc2VydmljZSBmb3IgYWR2YW5jZWQgdXNhZ2VcbmV4cG9ydCB7IExvZ2dpbmdTZXJ2aWNlIH07XG5leHBvcnQgZGVmYXVsdCBsb2dnZXI7XG4iXSwidmVyc2lvbiI6M30=