98dd325f5472357185c7501c43163b5d
"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.recommendIngredients = exports.getChakraBasedRecommendations = exports.calculateElementalInfluences = exports.getIngredientRecommendations = exports.getRecommendedIngredients = void 0;
// Import actual ingredient data
const vegetables_1 = require("@/data/ingredients/vegetables");
const fruits_1 = require("@/data/ingredients/fruits");
const herbs_1 = require("@/data/ingredients/herbs");
const spices_1 = require("@/data/ingredients/spices");
const proteins_1 = require("@/data/ingredients/proteins");
const grains_1 = require("@/data/ingredients/grains");
const seasonings_1 = require("@/data/ingredients/seasonings");
const oils_1 = require("@/data/ingredients/oils");
// Import planet data
const venus_1 = __importDefault(require("@/data/planets/venus"));
const mars_1 = __importDefault(require("@/data/planets/mars"));
const mercury_1 = __importDefault(require("@/data/planets/mercury"));
const chakraSymbols_1 = require("@/constants/chakraSymbols");
const ingredientCategories_1 = require("@/data/ingredientCategories");
// Import the getAllIngredients function if it exists, otherwise we'll create our own
const foodRecommender_1 = require("@/utils/foodRecommender");
// Combine all real ingredients data
const allIngredients = [
    ...Object.values(vegetables_1.vegetables || {}),
    ...Object.values(fruits_1.fruits || {}),
    ...Object.values(herbs_1.herbs || {}),
    ...Object.values(spices_1.spices || {}),
    ...Object.values(proteins_1.proteins || {}),
    ...Object.values(grains_1.grains || {}),
    ...Object.values(seasonings_1.seasonings || {}),
    ...Object.values(oils_1.oils || {})
].filter(Boolean);
// Fallback implementation of getAllIngredients that uses ingredientCategories
function getAllIngredients() {
    // If the imported function exists, use it
    if (typeof foodRecommender_1.getAllIngredients === 'function') {
        // Apply Pattern K: Safe unknown-first casting for type compatibility
        return (0, foodRecommender_1.getAllIngredients)();
    }
    // Otherwise, use our fallback implementation
    const allIngredients = [];
    // Process each category in ingredientCategories
    Object.entries(ingredientCategories_1.ingredientCategories).forEach(([category, ingredientsMap]) => {
        Object.entries(ingredientsMap).forEach(([name, data]) => {
            const ingredientData = data;
            allIngredients.push({
                name,
                type: category.endsWith('s') ? category.slice(0, -1) : category,
                category,
                elementalProperties: ingredientData.elementalProperties,
                astrologicalProfile: ingredientData.astrologicalProfile,
                ...ingredientData
            });
        });
    });
    return allIngredients;
}
/**
 * Returns a list of ingredients that match the current astrological state
 */
function getRecommendedIngredients(astroState) {
    var _a, _b, _c, _d, _e, _f;
    // Get the active planets from the astrological state
    const activePlanets = astroState.activePlanets || [];
    // If we don't have any active planets, use all planets by default
    const planetsToUse = activePlanets.length > 0
        ? activePlanets
        : ['Sun', 'Moon', 'Mercury', 'Venus', 'Mars', 'Jupiter', 'Saturn', 'Uranus', 'Neptune', 'Pluto'];
    // Filter ingredients based on matching planetary rulers
    // Apply Pattern K: Safe unknown-first casting for mixed ingredient array
    let filteredIngredients = allIngredients.filter(ingredient => {
        var _a, _b;
        // Check if any of the ingredient's ruling planets are active
        const baseIngredient = ingredient;
        return (_b = (_a = baseIngredient === null || baseIngredient === void 0 ? void 0 : baseIngredient.astrologicalProfile) === null || _a === void 0 ? void 0 : _a.rulingPlanets) === null || _b === void 0 ? void 0 : _b.some(planet => planetsToUse.includes(planet));
    });
    // If no matching ingredients, return a sample of all ingredients
    if (filteredIngredients.length === 0) {
        filteredIngredients = allIngredients.slice(0, 20);
    }
    // Special handling for Venus influence when present
    if (planetsToUse.includes('Venus')) {
        // Apply Pattern K: Safe array type casting for function parameter compatibility
        // Prioritize Venus-ruled ingredients with improved scoring based on detailed Venus data
        enhanceVenusIngredientBatch(filteredIngredients, astroState);
    }
    // Special handling for Mars influence when present
    if (planetsToUse.includes('Mars')) {
        // Apply Pattern K: Safe array type casting for function parameter compatibility
        // Prioritize Mars-ruled ingredients with improved scoring based on detailed Mars data
        enhanceMarsIngredientScoring(filteredIngredients, astroState);
    }
    // Special handling for Mercury influence when present
    if (planetsToUse.includes('Mercury')) {
        // Apply Pattern K: Safe array type casting for function parameter compatibility
        // Prioritize Mercury-ruled ingredients with improved scoring based on detailed Mercury data
        enhanceMercuryIngredientScoring(filteredIngredients, astroState);
    }
    // If we have a dominant element from the astro state, prioritize ingredients of that element
    if (astroState.dominantElement) {
        filteredIngredients.sort((a, b) => {
            var _a, _b;
            const ingredientA = a;
            const ingredientB = b;
            const aValue = ((_a = ingredientA === null || ingredientA === void 0 ? void 0 : ingredientA.elementalProperties) === null || _a === void 0 ? void 0 : _a[astroState.dominantElement]) || 0;
            const bValue = ((_b = ingredientB === null || ingredientB === void 0 ? void 0 : ingredientB.elementalProperties) === null || _b === void 0 ? void 0 : _b[astroState.dominantElement]) || 0;
            return bValue - aValue;
        });
    }
    // If we have a current zodiac sign, prioritize ingredients with that affinity
    if (astroState.zodiacSign) {
        const zodiacSign = astroState.zodiacSign.toLowerCase();
        // Apply Venus's zodiac transit data if Venus is active and in this sign
        const venusBoost = planetsToUse.includes('Venus') &&
            ((_b = (_a = venus_1.default.PlanetSpecific) === null || _a === void 0 ? void 0 : _a.ZodiacTransit) === null || _b === void 0 ? void 0 : _b[astroState.zodiacSign]) ? 2 : 0;
        // Apply Mars's zodiac transit data if Mars is active and in this sign
        const marsBoost = planetsToUse.includes('Mars') &&
            ((_d = (_c = mars_1.default.PlanetSpecific) === null || _c === void 0 ? void 0 : _c.ZodiacTransit) === null || _d === void 0 ? void 0 : _d[astroState.zodiacSign]) ? 2 : 0;
        // Apply Mercury's zodiac transit data if Mercury is active and in this sign
        const mercuryBoost = planetsToUse.includes('Mercury') &&
            ((_f = (_e = mercury_1.default.PlanetSpecific) === null || _e === void 0 ? void 0 : _e.ZodiacTransit) === null || _f === void 0 ? void 0 : _f[astroState.zodiacSign]) ? 2 : 0;
        filteredIngredients.sort((a, b) => {
            var _a, _b, _c, _d;
            const ingredientA = a;
            const ingredientB = b;
            let aHasAffinity = ((_b = (_a = ingredientA === null || ingredientA === void 0 ? void 0 : ingredientA.astrologicalProfile) === null || _a === void 0 ? void 0 : _a.signAffinities) === null || _b === void 0 ? void 0 : _b.includes(zodiacSign)) ? 1 : 0;
            let bHasAffinity = ((_d = (_c = ingredientB === null || ingredientB === void 0 ? void 0 : ingredientB.astrologicalProfile) === null || _c === void 0 ? void 0 : _c.signAffinities) === null || _d === void 0 ? void 0 : _d.includes(zodiacSign)) ? 1 : 0;
            // Boost ingredients with Venus associations when Venus is active
            if (planetsToUse.includes('Venus')) {
                if (isVenusAssociatedIngredient((ingredientA === null || ingredientA === void 0 ? void 0 : ingredientA.name) || ''))
                    aHasAffinity += venusBoost;
                if (isVenusAssociatedIngredient((ingredientB === null || ingredientB === void 0 ? void 0 : ingredientB.name) || ''))
                    bHasAffinity += venusBoost;
            }
            // Boost ingredients with Mars associations when Mars is active
            if (planetsToUse.includes('Mars')) {
                if (isMarsAssociatedIngredient((ingredientA === null || ingredientA === void 0 ? void 0 : ingredientA.name) || ''))
                    aHasAffinity += marsBoost;
                if (isMarsAssociatedIngredient((ingredientB === null || ingredientB === void 0 ? void 0 : ingredientB.name) || ''))
                    bHasAffinity += marsBoost;
            }
            // Boost ingredients with Mercury associations when Mercury is active
            if (planetsToUse.includes('Mercury')) {
                if (isMercuryAssociatedIngredient((ingredientA === null || ingredientA === void 0 ? void 0 : ingredientA.name) || ''))
                    aHasAffinity += mercuryBoost;
                if (isMercuryAssociatedIngredient((ingredientB === null || ingredientB === void 0 ? void 0 : ingredientB.name) || ''))
                    bHasAffinity += mercuryBoost;
            }
            return bHasAffinity - aHasAffinity;
        });
    }
    return filteredIngredients;
}
exports.getRecommendedIngredients = getRecommendedIngredients;
/**
 * Returns recommendations grouped by category based on elemental properties and options
 */
function getIngredientRecommendations(elementalProps, options) {
    var _a;
    // Get all ingredients
    const allIngredients = getAllIngredients();
    // Calculate ruling planet based on sun's position
    const sunSign = (_a = elementalProps.zodiacSign) === null || _a === void 0 ? void 0 : _a.toLowerCase();
    // Map of signs to their ruling planets
    const signRulers = {
        'aries': 'Mars',
        'taurus': 'Venus',
        'gemini': 'Mercury',
        'cancer': 'Moon',
        'leo': 'Sun',
        'virgo': 'Mercury',
        'libra': 'Venus',
        'scorpio': 'Mars',
        'sagittarius': 'Jupiter',
        'capricorn': 'Saturn',
        'aquarius': 'Saturn',
        'pisces': 'Jupiter' // Traditional ruler
    };
    const rulingPlanet = signRulers[sunSign] || 'Sun';
    // Get decan information for each planet position
    const planetDecans = {};
    Object.entries(elementalProps.planetaryAlignment || {}).forEach(([planet, position]) => {
        var _a, _b;
        if (!position || !position.sign)
            return;
        const sign = position.sign.toLowerCase();
        const degree = position.degree || 0;
        // Determine which decan the planet is in
        let decanNum = 1;
        if (degree >= 10 && degree < 20)
            decanNum = 2;
        else if (degree >= 20)
            decanNum = 3;
        // Reference data for decan rulers and tarot cards based on sign and decan
        const decanRulerMap = {
            'aries': { 1: 'Mars', 2: 'Sun', 3: 'Venus' },
            'taurus': { 1: 'Mercury', 2: 'Moon', 3: 'Saturn' },
            'gemini': { 1: 'Jupiter', 2: 'Mars', 3: 'Sun' },
            'cancer': { 1: 'Venus', 2: 'Mercury', 3: 'Moon' },
            'leo': { 1: 'Saturn', 2: 'Jupiter', 3: 'Mars' },
            'virgo': { 1: 'Sun', 2: 'Venus', 3: 'Mercury' },
            'libra': { 1: 'Moon', 2: 'Saturn', 3: 'Jupiter' },
            'scorpio': { 1: 'Mars', 2: 'Sun', 3: 'Venus' },
            'sagittarius': { 1: 'Mercury', 2: 'Moon', 3: 'Saturn' },
            'capricorn': { 1: 'Jupiter', 2: 'Mars', 3: 'Sun' },
            'aquarius': { 1: 'Venus', 2: 'Mercury', 3: 'Moon' },
            'pisces': { 1: 'Saturn', 2: 'Jupiter', 3: 'Mars' }
        };
        const tarotCardMap = {
            'aries': { 1: '2 of Wands', 2: '3 of Wands', 3: '4 of Wands' },
            'taurus': { 1: '5 of Pentacles', 2: '6 of Pentacles', 3: '7 of Pentacles' },
            'gemini': { 1: '8 of Swords', 2: '9 of Swords', 3: '10 of Swords' },
            'cancer': { 1: '2 of Cups', 2: '3 of Cups', 3: '4 of Cups' },
            'leo': { 1: '5 of Wands', 2: '6 of Wands', 3: '7 of Wands' },
            'virgo': { 1: '8 of Pentacles', 2: '9 of Pentacles', 3: '10 of Pentacles' },
            'libra': { 1: '2 of Swords', 2: '3 of Swords', 3: '4 of Swords' },
            'scorpio': { 1: '5 of Cups', 2: '6 of Cups', 3: '7 of Cups' },
            'sagittarius': { 1: '8 of Wands', 2: '9 of Wands', 3: '10 of Wands' },
            'capricorn': { 1: '2 of Pentacles', 2: '3 of Pentacles', 3: '4 of Pentacles' },
            'aquarius': { 1: '5 of Swords', 2: '6 of Swords', 3: '7 of Swords' },
            'pisces': { 1: '8 of Cups', 2: '9 of Cups', 3: '10 of Cups' }
        };
        const decanRuler = ((_a = decanRulerMap[sign]) === null || _a === void 0 ? void 0 : _a[decanNum]) || '';
        const tarotCard = ((_b = tarotCardMap[sign]) === null || _b === void 0 ? void 0 : _b[decanNum]) || '';
        planetDecans[planet] = { decanNum, decanRuler, tarotCard };
    });
    // Filter and score ingredients
    const scoredIngredients = allIngredients
        .filter(ingredient => {
        var _a;
        // Apply basic filters
        if ((_a = options.excludeIngredients) === null || _a === void 0 ? void 0 : _a.includes(ingredient === null || ingredient === void 0 ? void 0 : ingredient.name))
            return false;
        if (options.includeOnly && !options.includeOnly.includes(ingredient === null || ingredient === void 0 ? void 0 : ingredient.name))
            return false;
        if (options.category && ingredient.category !== options.category)
            return false;
        // Filter by dietary preference if specified
        if (options.dietaryPreferences && options.dietaryPreferences.length > 0) {
            const dietaryMatches = options.dietaryPreferences.some(pref => { var _a; return (_a = ingredient.dietary) === null || _a === void 0 ? void 0 : _a.includes(pref); });
            if (!dietaryMatches)
                return false;
        }
        // Filter by modality preference if specified
        if (options.modalityPreference) {
            const ingredientModality = ingredient.modality ||
                determineIngredientModality(ingredient.qualities, ingredient === null || ingredient === void 0 ? void 0 : ingredient.elementalProperties);
            if (ingredientModality !== options.modalityPreference)
                return false;
        }
        return true;
    })
        .map(ingredient => {
        // Calculate elemental score (30% of total)
        const elementalScore = calculateElementalScore(ingredient === null || ingredient === void 0 ? void 0 : ingredient.elementalProperties, elementalProps);
        // Calculate modality score (15% of total)
        const modalityScore = calculateModalityScore(ingredient.qualities || [], options.modalityPreference);
        // Calculate seasonal score (15% of total)
        const seasonalScore = calculateSeasonalScore(ingredient, elementalProps.timestamp);
        // Calculate planetary score (40% of total) - increased weight for planetary alignment
        const planetaryScore = calculateEnhancedPlanetaryScore(ingredient, elementalProps.planetaryAlignment, planetDecans, rulingPlanet);
        // Calculate total score with weighted components
        const totalScore = (elementalScore * 0.30 +
            modalityScore * 0.15 +
            seasonalScore * 0.15 +
            planetaryScore * 0.40);
        // Assign modality if not already present
        const modality = ingredient.modality ||
            determineIngredientModality(ingredient.qualities, ingredient === null || ingredient === void 0 ? void 0 : ingredient.elementalProperties);
        return {
            ...ingredient,
            score: totalScore,
            elementalScore,
            modalityScore,
            seasonalScore,
            planetaryScore,
            modality
        };
    })
        .sort((a, b) => b.score - a.score);
    // Group ingredients by category
    const groupedRecommendations = {};
    // Apply limit per category before grouping to ensure diversity
    const limit = options.limit || 24;
    const categoryCounts = {};
    const categoryMaxItems = Math.ceil(limit / 8); // Max items per category
    scoredIngredients.forEach(ingredient => {
        const category = ingredient.category || 'other';
        if (!groupedRecommendations[category]) {
            groupedRecommendations[category] = [];
            categoryCounts[category] = 0;
        }
        if (categoryCounts[category] < categoryMaxItems) {
            // Apply Pattern L: Interface property mapping for IngredientRecommendation compatibility
            const ingredientData = ingredient;
            const ingredientRecommendation = {
                name: ingredient.name || '',
                type: (ingredientData === null || ingredientData === void 0 ? void 0 : ingredientData.type) || (ingredientData === null || ingredientData === void 0 ? void 0 : ingredientData.category) || 'ingredient',
                category: ingredient.category,
                elementalProperties: ingredient.elementalProperties,
                qualities: ingredient.qualities,
                matchScore: ingredient.score || 0,
                modality: ingredient.modality,
                recommendations: (ingredientData === null || ingredientData === void 0 ? void 0 : ingredientData.recommendations) || [],
                description: (ingredientData === null || ingredientData === void 0 ? void 0 : ingredientData.description) || `Recommended ${ingredient.name}`,
                totalScore: (ingredientData === null || ingredientData === void 0 ? void 0 : ingredientData.totalScore) || ingredient.score || 0,
                elementalScore: ingredient.elementalScore,
                astrologicalScore: (ingredientData === null || ingredientData === void 0 ? void 0 : ingredientData.astrologicalScore) || 0,
                seasonalScore: ingredient.seasonalScore,
                dietary: (ingredientData === null || ingredientData === void 0 ? void 0 : ingredientData.dietary) || []
            };
            groupedRecommendations[category].push(ingredientRecommendation);
            categoryCounts[category]++;
        }
    });
    return groupedRecommendations;
}
exports.getIngredientRecommendations = getIngredientRecommendations;
// Helper function to calculate modality score
function calculateModalityScore(qualities, preferredModality) {
    var _a;
    // Get the ingredient's modality based on qualities
    const ingredientModality = determineIngredientModality(qualities);
    // If no preferred modality, return neutral score
    if (!preferredModality)
        return 0.5;
    // Return 1.0 for exact match, 0.5 for partial match, 0.0 for mismatch
    if (ingredientModality === preferredModality)
        return 1.0;
    // Consider partial matches based on modality compatibility
    const compatibleModalities = {
        Cardinal: ['Mutable'],
        Fixed: ['Mutable'],
        Mutable: ['Cardinal', 'Fixed']
    };
    if ((_a = compatibleModalities[preferredModality]) === null || _a === void 0 ? void 0 : _a.includes(ingredientModality)) {
        return 0.7;
    }
    return 0.3;
}
/**
 * Calculate elemental score between ingredient and system elemental properties
 * Enhanced to give more weight to dominant elements and better similarity calculation
 */
function calculateElementalScore(ingredientProps, systemProps) {
    // Return neutral score if either properties are missing
    if (!ingredientProps || !systemProps)
        return 0.5;
    // Find dominant system element for extra weighting
    const dominantElement = Object.entries(systemProps)
        .sort((a, b) => b[1] - a[1])[0][0];
    // Calculate similarity based on overlap of elemental properties
    let similarityScore = 0;
    let totalWeight = 0;
    // Process each element
    for (const element of ['Fire', 'Water', 'Earth', 'Air']) {
        const ingredientValue = ingredientProps[element] || 0;
        const systemValue = systemProps[element] || 0;
        // Calculate similarity (1 - absolute difference)
        // This gives higher scores when values are closer together
        const similarity = 1 - Math.abs(ingredientValue - systemValue);
        // Enhanced weighting: dominant element gets extra emphasis
        // Base weight includes the system's value for this element
        const baseWeight = systemValue + 0.25; // Add 0.25 to ensure all elements have some weight
        // Apply 1.5x multiplier to the dominant element's weight
        const finalWeight = element === dominantElement ? baseWeight * 1.5 : baseWeight;
        similarityScore += similarity * finalWeight;
        totalWeight += finalWeight;
    }
    // Normalize to 0-1 range with explicit bounds
    return totalWeight > 0 ? Math.min(1, Math.max(0, similarityScore / totalWeight)) : 0.5;
}
/**
 * Calculate seasonal score for an ingredient based on current date
 * @param ingredient Ingredient to score
 * @param date Current date
 * @returns Seasonal score (0-1)
 */
function calculateSeasonalScore(ingredient, date) {
    // Default score if no seasonality data
    if (!(ingredient === null || ingredient === void 0 ? void 0 : ingredient.seasonality))
        return 0.5;
    // Get current month and convert to season
    const month = date.getMonth(); // 0-11
    let currentSeason;
    // Northern hemisphere seasons
    if (month >= 2 && month <= 4) {
        currentSeason = 'spring';
    }
    else if (month >= 5 && month <= 7) {
        currentSeason = 'summer';
    }
    else if (month >= 8 && month <= 10) {
        currentSeason = 'fall';
    }
    else {
        currentSeason = 'winter';
    }
    // Get seasonality score for current season
    const seasonScore = (ingredient === null || ingredient === void 0 ? void 0 : ingredient.seasonality[currentSeason]) || 0.5;
    return seasonScore;
}
/**
 * Enhanced planetary score calculation that considers decans and tarot associations,
 * with special weight for the ruling planet determined by sun position
 */
function calculateEnhancedPlanetaryScore(ingredient, planetaryAlignment, planetDecans, rulingPlanet) {
    var _a;
    if (!(ingredient === null || ingredient === void 0 ? void 0 : ingredient.astrologicalProfile))
        return 0.5; // Neutral score for ingredients without profile
    let score = 0;
    let totalFactors = 0;
    // Check ruling planet correspondence - this gets extra weight
    if ((_a = ingredient === null || ingredient === void 0 ? void 0 : ingredient.astrologicalProfile.rulingPlanets) === null || _a === void 0 ? void 0 : _a.includes(rulingPlanet)) {
        score += 1.5; // Significant boost for ruling planet correspondence
        totalFactors += 1.5;
    }
    // Check planetary positions against ingredient affinities
    Object.entries(planetaryAlignment).forEach(([planet, position]) => {
        var _a, _b, _c, _d;
        if (!position.sign)
            return;
        const planetName = planet.charAt(0).toUpperCase() + planet.slice(1);
        // Regular planetary ruler scoring
        if ((_a = ingredient === null || ingredient === void 0 ? void 0 : ingredient.astrologicalProfile.rulingPlanets) === null || _a === void 0 ? void 0 : _a.includes(planetName)) {
            score += 1;
            totalFactors += 1;
        }
        // Check sign affinities 
        if ((_b = ingredient === null || ingredient === void 0 ? void 0 : ingredient.astrologicalProfile.signAffinities) === null || _b === void 0 ? void 0 : _b.includes(position.sign.toLowerCase())) {
            score += 1;
            totalFactors += 1;
        }
        // Special handling for decan rulers
        const decanInfo = planetDecans[planet];
        if (decanInfo && ((_c = ingredient === null || ingredient === void 0 ? void 0 : ingredient.astrologicalProfile.rulingPlanets) === null || _c === void 0 ? void 0 : _c.includes(decanInfo.decanRuler))) {
            score += 0.8; // Good bonus for decan ruler match
            totalFactors += 0.8;
        }
        // Tarot card associations - add subtle influence
        if ((decanInfo === null || decanInfo === void 0 ? void 0 : decanInfo.tarotCard) && ((_d = ingredient === null || ingredient === void 0 ? void 0 : ingredient.astrologicalProfile.tarotAssociations) === null || _d === void 0 ? void 0 : _d.includes(decanInfo.tarotCard))) {
            score += 0.7;
            totalFactors += 0.7;
        }
    });
    // If there are no factors to consider, return neutral score
    if (totalFactors === 0)
        return 0.5;
    // Return normalized score (0-1 range)
    return Math.min(1, score / (totalFactors + 0.5));
}
/**
 * Calculate planetary influences based on planetary alignment
 * @param planetaryAlignment Current planetary positions
 * @returns Elemental influence values
 */
function calculateElementalInfluences(planetaryAlignment) {
    // Define elemental affinities for each zodiac sign
    const zodiacElements = {
        'aries': 'Fire',
        'taurus': 'Earth',
        'gemini': 'Air',
        'cancer': 'Water',
        'leo': 'Fire',
        'virgo': 'Earth',
        'libra': 'Air',
        'scorpio': 'Water',
        'sagittarius': 'Fire',
        'capricorn': 'Earth',
        'aquarius': 'Air',
        'pisces': 'Water'
    };
    // Define planet weights
    const planetWeights = {
        'sun': 5,
        'moon': 4,
        'mercury': 3,
        'venus': 3,
        'mars': 3,
        'jupiter': 2,
        'saturn': 2,
        'uranus': 1,
        'neptune': 1,
        'pluto': 1
    };
    // Initialize elemental influences
    const elementalInfluences = {
        Fire: 0,
        Earth: 0,
        Air: 0,
        Water: 0
    };
    // Process each planetary position
    Object.entries(planetaryAlignment).forEach(([planet, position]) => {
        const planetLower = planet.toLowerCase();
        const weight = planetWeights[planetLower] || 1;
        const sign = position.sign.toLowerCase();
        const element = zodiacElements[position.sign] || zodiacElements[sign];
        if (element) {
            elementalInfluences[element] += weight;
        }
    });
    // Normalize values to sum to 1
    const total = Object.values(elementalInfluences).reduce((sum, val) => sum + val, 0);
    if (total > 0) {
        Object.keys(elementalInfluences).forEach(element => {
            elementalInfluences[element] =
                elementalInfluences[element] / total;
        });
    }
    return elementalInfluences;
}
exports.calculateElementalInfluences = calculateElementalInfluences;
/**
 * Get ingredient recommendations based on chakra energies
 * @param chakraEnergies Current chakra energy levels
 * @param limit Maximum number of recommendations per chakra
 * @returns Grouped ingredient recommendations based on chakra influences
 */
function getChakraBasedRecommendations(chakraEnergies, limit = 3) {
    // Find the dominant chakras (highest energy levels)
    const chakraEntries = Object.entries(chakraEnergies);
    // Sort chakras by energy level (highest first)
    const sortedChakras = chakraEntries.sort(([, energyA], [, energyB]) => energyB - energyA);
    // Take only chakras with significant energy (> 0)
    const significantChakras = sortedChakras.filter(([, energy]) => energy > 0);
    // Prepare the result object
    const result = {};
    // For each significant chakra, add corresponding recommended ingredients
    significantChakras.forEach(([chakra, energy]) => {
        // Get nutritional correlations for this chakra
        const nutritionalCorrelations = chakraSymbols_1.CHAKRA_NUTRITIONAL_CORRELATIONS[chakra] || [];
        const herbRecommendations = chakraSymbols_1.CHAKRA_HERBS[chakra] || [];
        // Find ingredients that match these correlations
        const matchingIngredients = allIngredients.filter(ingredient => {
            // Check if ingredient name or type matches any nutritional correlation
            const matchesNutritional = nutritionalCorrelations.some(correlation => (ingredient === null || ingredient === void 0 ? void 0 : ingredient.name.toLowerCase().includes(correlation.toLowerCase())) ||
                ((ingredient === null || ingredient === void 0 ? void 0 : ingredient.type) ? ingredient.type.toLowerCase().includes(correlation.toLowerCase()) : false));
            // Check if ingredient name matches any herb recommendation
            const matchesHerb = herbRecommendations.some(herb => ingredient === null || ingredient === void 0 ? void 0 : ingredient.name.toLowerCase().includes(herb.toLowerCase()));
            return matchesNutritional || matchesHerb;
        });
        // Add matching ingredients to the result, with a score based on chakra energy
        matchingIngredients.forEach(ingredient => {
            var _a, _b;
            const recommendationKey = (ingredient === null || ingredient === void 0 ? void 0 : ingredient.type) ? `${ingredient.type.toLowerCase()}s` : 'others';
            if (!result[recommendationKey]) {
                result[recommendationKey] = [];
            }
            // Create recommendation with chakra-based score
            const recommendation = {
                ...ingredient,
                matchScore: energy / 10,
                recommendations: [
                    `Supports ${chakra} chakra energy`,
                    ...(nutritionalCorrelations.filter(corr => {
                        var _a;
                        return ((_a = ingredient === null || ingredient === void 0 ? void 0 : ingredient.name) === null || _a === void 0 ? void 0 : _a.toLowerCase().includes(corr.toLowerCase())) ||
                            ((ingredient === null || ingredient === void 0 ? void 0 : ingredient.type) ? ingredient.type.toLowerCase().includes(corr.toLowerCase()) : false);
                    }) || [])
                ]
            };
            // Only add if not already present
            if (!((_a = result[recommendationKey]) === null || _a === void 0 ? void 0 : _a.some(rec => rec.name === (ingredient === null || ingredient === void 0 ? void 0 : ingredient.name)))) {
                (_b = result[recommendationKey]) === null || _b === void 0 ? void 0 : _b.push(recommendation);
            }
        });
    });
    // Apply limit to each category
    Object.keys(result).forEach(key => {
        var _a, _b;
        if (((_a = result[key]) === null || _a === void 0 ? void 0 : _a.length) > limit) {
            result[key] = (_b = result[key]) === null || _b === void 0 ? void 0 : _b.slice(0, limit);
        }
    });
    return result;
}
exports.getChakraBasedRecommendations = getChakraBasedRecommendations;
// Helper function to check if an ingredient is Venus-associated
function isVenusAssociatedIngredient(ingredientName) {
    var _a, _b, _c, _d;
    // Check if the ingredient appears in Venus's food associations
    if (venus_1.default.FoodAssociations) {
        for (const food of venus_1.default.FoodAssociations) {
            if (ingredientName.toLowerCase().includes(food.toLowerCase()) ||
                food.toLowerCase().includes(ingredientName.toLowerCase())) {
                return true;
            }
        }
    }
    // Check if the ingredient appears in Venus's herbal associations
    if ((_a = venus_1.default.HerbalAssociations) === null || _a === void 0 ? void 0 : _a.Herbs) {
        for (const herb of venus_1.default.HerbalAssociations.Herbs) {
            if (ingredientName.toLowerCase().includes(herb.toLowerCase()) ||
                herb.toLowerCase().includes(ingredientName.toLowerCase())) {
                return true;
            }
        }
    }
    // Check if the ingredient appears in Venus's herb associations
    // Note: HerbalAssociations only has Herbs, Flowers, Woods, Scents - Spices not available
    if ((_b = venus_1.default.HerbalAssociations) === null || _b === void 0 ? void 0 : _b.Herbs) {
        for (const herb of venus_1.default.HerbalAssociations.Herbs) {
            if (ingredientName.toLowerCase().includes(herb.toLowerCase()) ||
                herb.toLowerCase().includes(ingredientName.toLowerCase())) {
                return true;
            }
        }
    }
    // Check if the ingredient appears in Venus's flower associations
    if ((_c = venus_1.default.HerbalAssociations) === null || _c === void 0 ? void 0 : _c.Flowers) {
        for (const flower of venus_1.default.HerbalAssociations.Flowers) {
            if (ingredientName.toLowerCase().includes(flower.toLowerCase()) ||
                flower.toLowerCase().includes(ingredientName.toLowerCase())) {
                return true;
            }
        }
    }
    // Check against zodiac-specific Venus ingredients
    if (((_d = venus_1.default.PlanetSpecific) === null || _d === void 0 ? void 0 : _d.ZodiacTransit) && typeof venus_1.default.PlanetSpecific.ZodiacTransit === 'object') {
        for (const zodiac in venus_1.default.PlanetSpecific.ZodiacTransit) {
            const transitData = venus_1.default.PlanetSpecific.ZodiacTransit[zodiac];
            if (transitData.Ingredients) {
                for (const ingredient of transitData.Ingredients) {
                    if (ingredientName.toLowerCase().includes(ingredient.toLowerCase()) ||
                        ingredient.toLowerCase().includes(ingredientName.toLowerCase())) {
                        return true;
                    }
                }
            }
        }
    }
    return false;
}
/**
 * Determines if an ingredient is associated with Mars based on Mars data
 */
function isMarsAssociatedIngredient(ingredientName) {
    var _a, _b;
    // Normalize the ingredient name for comparison
    const normalizedName = ingredientName.toLowerCase();
    // Check if it's in Mars food associations
    if (mars_1.default.FoodAssociations) {
        for (const food of mars_1.default.FoodAssociations) {
            if (normalizedName.includes(food.toLowerCase()) || food.toLowerCase().includes(normalizedName)) {
                return true;
            }
        }
    }
    // Check if it's in Mars herbal associations
    if ((_a = mars_1.default.HerbalAssociations) === null || _a === void 0 ? void 0 : _a.Herbs) {
        for (const herb of mars_1.default.HerbalAssociations.Herbs) {
            if (normalizedName.includes(herb.toLowerCase()) || herb.toLowerCase().includes(normalizedName)) {
                return true;
            }
        }
    }
    // Check all zodiac transits for ingredients
    if (((_b = mars_1.default.PlanetSpecific) === null || _b === void 0 ? void 0 : _b.ZodiacTransit) && typeof mars_1.default.PlanetSpecific.ZodiacTransit === 'object') {
        for (const sign in mars_1.default.PlanetSpecific.ZodiacTransit) {
            const transit = mars_1.default.PlanetSpecific.ZodiacTransit[sign];
            if (transit.Ingredients) {
                for (const ingredient of transit.Ingredients) {
                    if (normalizedName.includes(ingredient.toLowerCase()) || ingredient.toLowerCase().includes(normalizedName)) {
                        return true;
                    }
                }
            }
        }
    }
    return false;
}
/**
 * Calculate Venus influence score for an ingredient
 * @param ingredient The ingredient to calculate Venus influence for
 * @param zodiacSign Current zodiac sign Venus is in
 * @param isVenusRetrograde Whether Venus is retrograde
 * @returns Score representing Venus influence (higher is stronger)
 */
function calculateVenusInfluence(ingredient, zodiacSign, isVenusRetrograde = false) {
    var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s;
    let score = 0;
    // Base score for Venus association
    if (isVenusAssociatedIngredient(ingredient === null || ingredient === void 0 ? void 0 : ingredient.name)) {
        score += 2.0;
    }
    // Check elemental properties alignment with Venus
    if (ingredient.elementalProperties) {
        // Venus favors Water and Earth elements
        score += (ingredient.elementalProperties.Water || 0) * 1.5;
        score += (ingredient.elementalProperties.Earth || 0) * 1.8;
        // Lesser affinities with Air and Fire
        score += (ingredient.elementalProperties.Air || 0) * 0.8;
        score += (ingredient.elementalProperties.Fire || 0) * 0.5;
    }
    // Check flavor profile alignment with Venus preferences
    const flavorProfile = ingredient === null || ingredient === void 0 ? void 0 : ingredient.flavorProfile;
    if (flavorProfile) {
        // Venus favors sweet, rich, creamy flavors
        if (flavorProfile.sweet) {
            score += flavorProfile.sweet * 2.0;
        }
        if (flavorProfile.umami) {
            score += flavorProfile.umami * 1.5;
        }
        if (flavorProfile.creamy || flavorProfile.rich) {
            score += ((flavorProfile.creamy || 0) + (flavorProfile.rich || 0)) * 1.7;
        }
        // Venus appreciates aromatic, fragrant qualities
        if (flavorProfile.aromatic || flavorProfile.fragrant) {
            score += ((flavorProfile.aromatic || 0) + (flavorProfile.fragrant || 0)) * 1.6;
        }
        // Venus is less interested in bitter or excessively spicy flavors
        if (flavorProfile.bitter) {
            score -= flavorProfile.bitter * 0.5;
        }
        if (flavorProfile.spicy && flavorProfile.spicy > 0.7) {
            score -= (flavorProfile.spicy - 0.7) * 0.8;
        }
    }
    // Check texture alignment with Venus preferences
    const texture = ingredient === null || ingredient === void 0 ? void 0 : ingredient.texture;
    if (texture) {
        // Venus favors smooth, creamy, luscious textures
        const venusTextures = ['smooth', 'creamy', 'velvety', 'soft', 'tender', 'juicy', 'buttery'];
        const textureMatch = venusTextures.filter(venusTexture => Array.isArray(texture) ? texture.includes(venusTexture) : texture.includes && texture.includes(venusTexture)).length;
        score += textureMatch * 0.5;
    }
    // Check culinary technique alignment
    const culinaryUses = ingredient === null || ingredient === void 0 ? void 0 : ingredient.culinaryUses;
    if (((_a = venus_1.default.PlanetSpecific) === null || _a === void 0 ? void 0 : _a.CulinaryTechniques) && culinaryUses) {
        // Check for aesthetic presentation techniques
        if (culinaryUses.includes('garnish') ||
            culinaryUses.includes('plating')) {
            score += 1.8;
        }
        // Check for balance and harmony in flavor pairings
        const harmonyPairings = ingredient === null || ingredient === void 0 ? void 0 : ingredient.harmonyPairings;
        if (harmonyPairings && harmonyPairings.length > 3) {
            score += 1.5;
        }
        // Sweet and indulgent preparation techniques
        if (culinaryUses.includes('dessert') ||
            culinaryUses.includes('baking') ||
            culinaryUses.includes('confection')) {
            score += 1.2;
        }
        // Check for fragrance and aroma enhancement
        const aromaticProperties = ingredient === null || ingredient === void 0 ? void 0 : ingredient.aromaticProperties;
        if (aromaticProperties ||
            ((flavorProfile === null || flavorProfile === void 0 ? void 0 : flavorProfile.aromatic) && flavorProfile.aromatic > 0.7)) {
            score += 1.6;
        }
        // Check for textural contrast techniques
        if (culinaryUses.includes('crispy') ||
            culinaryUses.includes('crunchy') ||
            (texture && ((Array.isArray(texture) && texture.includes('contrast')) || (texture.includes && texture.includes('contrast'))))) {
            score += 1.3;
        }
    }
    // Zodiac sign-specific preferences
    if (zodiacSign && ((_b = venus_1.default.PlanetSpecific) === null || _b === void 0 ? void 0 : _b.ZodiacTransit)) {
        const transitData = venus_1.default.PlanetSpecific.ZodiacTransit[zodiacSign];
        // Check food focus alignment
        // Extract transit data with safe property access
        const transitDataAny = transitData;
        const foodFocusProperty = transitDataAny === null || transitDataAny === void 0 ? void 0 : transitDataAny.FoodFocus;
        if (foodFocusProperty) {
            const foodFocus = foodFocusProperty.toLowerCase();
            const ingredientName = ingredient === null || ingredient === void 0 ? void 0 : ingredient.name.toLowerCase();
            // Direct keywords match
            const keywords = foodFocus.split(/[\s,;]+/).filter(k => k.length > 3);
            for (const keyword of keywords) {
                const description = ingredient === null || ingredient === void 0 ? void 0 : ingredient.description;
                const culinaryUses = ingredient === null || ingredient === void 0 ? void 0 : ingredient.culinaryUses;
                if (ingredientName.includes(keyword) ||
                    (description && description.toLowerCase().includes(keyword)) ||
                    (culinaryUses && culinaryUses.some((use) => use.toLowerCase().includes(keyword)))) {
                    score += 2.0;
                    break;
                }
            }
        }
        // Check Elements alignment
        // Extract transit data with safe property access for elements
        const transitElements = transitDataAny === null || transitDataAny === void 0 ? void 0 : transitDataAny.Elements;
        if (transitElements && ingredient.elementalProperties) {
            for (const element in transitElements) {
                if (ingredient.elementalProperties[element]) {
                    score += transitElements[element] * ingredient.elementalProperties[element] * 0.7;
                }
            }
        }
        // Check ingredient alignment with transit preferences
        if (transitData.Ingredients) {
            const transitIngredients = transitData.Ingredients.map(i => i.toLowerCase());
            // Direct ingredient match
            if (transitIngredients.some(i => (ingredient === null || ingredient === void 0 ? void 0 : ingredient.name.toLowerCase().includes(i)) || i.includes(ingredient === null || ingredient === void 0 ? void 0 : ingredient.name.toLowerCase()))) {
                score += 3.0;
            }
            // Category match
            if (ingredient.category && transitIngredients.includes(ingredient.category.toLowerCase())) {
                score += 2.0;
            }
            // Related ingredient match
            const relatedIngredients = ingredient === null || ingredient === void 0 ? void 0 : ingredient.relatedIngredients;
            if (relatedIngredients) {
                const relatedMatches = relatedIngredients.filter((related) => transitIngredients.some(i => related.toLowerCase().includes(i) || i.includes(related.toLowerCase()))).length;
                score += relatedMatches * 0.7;
            }
            // Complementary ingredients match
            const complementaryIngredients = ingredient === null || ingredient === void 0 ? void 0 : ingredient.complementaryIngredients;
            if (complementaryIngredients) {
                const complementaryMatches = complementaryIngredients.filter((complement) => transitIngredients.some(i => complement.toLowerCase().includes(i) || i.includes(complement.toLowerCase()))).length;
                score += complementaryMatches * 0.5;
            }
        }
    }
    // Venus temperament based on sign type
    if (zodiacSign) {
        const earthSigns = ['taurus', 'virgo', 'capricorn'];
        const airSigns = ['gemini', 'libra', 'aquarius'];
        const waterSigns = ['cancer', 'scorpio', 'pisces'];
        const fireSigns = ['aries', 'leo', 'sagittarius'];
        const lowerSign = zodiacSign.toLowerCase();
        // Earth Venus
        if (earthSigns.includes(lowerSign) && ((_d = (_c = venus_1.default.PlanetSpecific) === null || _c === void 0 ? void 0 : _c.CulinaryTemperament) === null || _d === void 0 ? void 0 : _d.EarthVenus)) {
            const earthVenus = venus_1.default.PlanetSpecific.CulinaryTemperament.EarthVenus;
            // Check for sensual, rich ingredients
            if ((flavorProfile === null || flavorProfile === void 0 ? void 0 : flavorProfile.rich) > 0.5 ||
                (flavorProfile === null || flavorProfile === void 0 ? void 0 : flavorProfile.umami) > 0.5 ||
                (culinaryUses === null || culinaryUses === void 0 ? void 0 : culinaryUses.includes('comfort food'))) {
                score += 2.0;
            }
            // Food focus alignment
            // Extract earth venus data with safe property access
            const earthVenusAny = earthVenus;
            const earthVenusFoodFocus = earthVenusAny === null || earthVenusAny === void 0 ? void 0 : earthVenusAny.FoodFocus;
            if (earthVenusFoodFocus) {
                const focusKeywords = earthVenusFoodFocus.toLowerCase().split(/[\s,;]+/).filter(k => k.length > 3);
                const description = ingredient === null || ingredient === void 0 ? void 0 : ingredient.description;
                if (focusKeywords.some(keyword => (ingredient === null || ingredient === void 0 ? void 0 : ingredient.name.toLowerCase().includes(keyword)) ||
                    (description && description.toLowerCase().includes(keyword)))) {
                    score += 1.5;
                }
            }
            // Elements alignment
            // Extract earth venus elements with safe property access
            const earthVenusElements = earthVenusAny === null || earthVenusAny === void 0 ? void 0 : earthVenusAny.Elements;
            if (earthVenusElements && ingredient.elementalProperties) {
                for (const element in earthVenusElements) {
                    if (ingredient.elementalProperties[element]) {
                        score += earthVenusElements[element] * ingredient.elementalProperties[element] * 1.0;
                    }
                }
            }
        }
        // Air Venus
        if (airSigns.includes(lowerSign) && ((_f = (_e = venus_1.default.PlanetSpecific) === null || _e === void 0 ? void 0 : _e.CulinaryTemperament) === null || _f === void 0 ? void 0 : _f.AirVenus)) {
            const airVenus = venus_1.default.PlanetSpecific.CulinaryTemperament.AirVenus;
            // Check for light, delicate ingredients
            if ((texture && ((Array.isArray(texture) && texture.includes('light')) || (texture.includes && texture.includes('light')))) ||
                (texture && ((Array.isArray(texture) && texture.includes('crisp')) || (texture.includes && texture.includes('crisp')))) ||
                (flavorProfile === null || flavorProfile === void 0 ? void 0 : flavorProfile.light) > 0.5) {
                score += 2.0;
            }
            // Food focus alignment
            // Extract air venus data with safe property access
            const airVenusAny = airVenus;
            const airVenusFoodFocus = airVenusAny === null || airVenusAny === void 0 ? void 0 : airVenusAny.FoodFocus;
            if (airVenusFoodFocus) {
                const focusKeywords = airVenusFoodFocus.toLowerCase().split(/[\s,;]+/).filter(k => k.length > 3);
                const description = ingredient === null || ingredient === void 0 ? void 0 : ingredient.description;
                if (focusKeywords.some(keyword => (ingredient === null || ingredient === void 0 ? void 0 : ingredient.name.toLowerCase().includes(keyword)) ||
                    (description && description.toLowerCase().includes(keyword)))) {
                    score += 1.5;
                }
            }
            // Elements alignment
            // Extract air venus elements with safe property access
            const airVenusElements = airVenusAny === null || airVenusAny === void 0 ? void 0 : airVenusAny.Elements;
            if (airVenusElements && ingredient.elementalProperties) {
                for (const element in airVenusElements) {
                    if (ingredient.elementalProperties[element]) {
                        score += airVenusElements[element] * ingredient.elementalProperties[element] * 1.0;
                    }
                }
            }
        }
        // Water Venus
        if (waterSigns.includes(lowerSign) && ((_h = (_g = venus_1.default.PlanetSpecific) === null || _g === void 0 ? void 0 : _g.CulinaryTemperament) === null || _h === void 0 ? void 0 : _h.WaterVenus)) {
            const waterVenus = venus_1.default.PlanetSpecific.CulinaryTemperament.WaterVenus;
            // Check for moist, juicy ingredients
            if ((texture && ((Array.isArray(texture) && texture.includes('juicy')) || (texture.includes && texture.includes('juicy')))) ||
                (texture && ((Array.isArray(texture) && texture.includes('tender')) || (texture.includes && texture.includes('tender')))) ||
                (flavorProfile === null || flavorProfile === void 0 ? void 0 : flavorProfile.juicy) > 0.5) {
                score += 2.0;
            }
            // Food focus alignment
            // Extract water venus data with safe property access
            const waterVenusAny = waterVenus;
            const waterVenusFoodFocus = waterVenusAny === null || waterVenusAny === void 0 ? void 0 : waterVenusAny.FoodFocus;
            if (waterVenusFoodFocus) {
                const focusKeywords = waterVenusFoodFocus.toLowerCase().split(/[\s,;]+/).filter(k => k.length > 3);
                // Extract ingredient data with safe property access
                const ingredientData = ingredient;
                const ingredientName = ((_j = ingredientData === null || ingredientData === void 0 ? void 0 : ingredientData.name) === null || _j === void 0 ? void 0 : _j.toLowerCase()) || '';
                const ingredientDescription = ((_k = ingredientData === null || ingredientData === void 0 ? void 0 : ingredientData.description) === null || _k === void 0 ? void 0 : _k.toLowerCase()) || '';
                if (focusKeywords.some(keyword => ingredientName.includes(keyword) ||
                    ingredientDescription.includes(keyword))) {
                    score += 1.5;
                }
            }
            // Elements alignment
            // Extract water venus elements with safe property access
            const waterVenusElements = waterVenusAny === null || waterVenusAny === void 0 ? void 0 : waterVenusAny.Elements;
            if (waterVenusElements && ingredient.elementalProperties) {
                for (const element in waterVenusElements) {
                    if (ingredient.elementalProperties[element]) {
                        score += waterVenusElements[element] * ingredient.elementalProperties[element] * 1.0;
                    }
                }
            }
        }
        // Fire Venus
        if (fireSigns.includes(lowerSign) && ((_m = (_l = venus_1.default.PlanetSpecific) === null || _l === void 0 ? void 0 : _l.CulinaryTemperament) === null || _m === void 0 ? void 0 : _m.FireVenus)) {
            const fireVenus = venus_1.default.PlanetSpecific.CulinaryTemperament.FireVenus;
            // Check for vibrant, spicy ingredients
            if ((flavorProfile === null || flavorProfile === void 0 ? void 0 : flavorProfile.spicy) > 0.3 ||
                (flavorProfile === null || flavorProfile === void 0 ? void 0 : flavorProfile.vibrant) > 0.5 ||
                (culinaryUses === null || culinaryUses === void 0 ? void 0 : culinaryUses.includes('stimulating'))) {
                score += 2.0;
            }
            // Food focus alignment
            // Extract fire venus data with safe property access
            const fireVenusAny = fireVenus;
            const fireVenusFoodFocus = fireVenusAny === null || fireVenusAny === void 0 ? void 0 : fireVenusAny.FoodFocus;
            if (fireVenusFoodFocus) {
                const focusKeywords = fireVenusFoodFocus.toLowerCase().split(/[\s,;]+/).filter(k => k.length > 3);
                // Extract ingredient data with safe property access
                const ingredientData = ingredient;
                const ingredientName = ((_o = ingredientData === null || ingredientData === void 0 ? void 0 : ingredientData.name) === null || _o === void 0 ? void 0 : _o.toLowerCase()) || '';
                const ingredientDescription = ((_p = ingredientData === null || ingredientData === void 0 ? void 0 : ingredientData.description) === null || _p === void 0 ? void 0 : _p.toLowerCase()) || '';
                if (focusKeywords.some(keyword => ingredientName.includes(keyword) ||
                    ingredientDescription.includes(keyword))) {
                    score += 1.5;
                }
            }
            // Elements alignment
            // Extract fire venus elements with safe property access
            const fireVenusElements = fireVenusAny === null || fireVenusAny === void 0 ? void 0 : fireVenusAny.Elements;
            if (fireVenusElements && ingredient.elementalProperties) {
                for (const element in fireVenusElements) {
                    if (ingredient.elementalProperties[element]) {
                        score += fireVenusElements[element] * ingredient.elementalProperties[element] * 1.0;
                    }
                }
            }
        }
    }
    // Retrograde modifiers
    if (isVenusRetrograde && ((_q = venus_1.default.PlanetSpecific) === null || _q === void 0 ? void 0 : _q.Retrograde)) {
        // Increase score for preserved or dried herbs during retrograde
        const preservationMethods = ingredient === null || ingredient === void 0 ? void 0 : ingredient.preservation_methods;
        const categories = ingredient === null || ingredient === void 0 ? void 0 : ingredient.categories;
        if ((preservationMethods && preservationMethods.includes('dried')) ||
            ingredient.category === 'herb' ||
            (categories && categories.includes('preserved'))) {
            score *= 1.5;
        }
        else {
            score *= 0.8; // Slightly reduce other ingredients
        }
        // Nostalgia foods get a boost during retrograde
        // Extract ingredient data with safe property access for cultural significance
        const ingredientData = ingredient;
        const culturalSignificance = ingredientData === null || ingredientData === void 0 ? void 0 : ingredientData.cultural_significance;
        const culturalSignificanceArray = Array.isArray(culturalSignificance) ? culturalSignificance :
            (typeof culturalSignificance === 'string' ? [culturalSignificance] : []);
        if (culturalSignificanceArray.includes('traditional') ||
            culturalSignificanceArray.includes('nostalgic')) {
            score += 1.8;
        }
        // Check retrograde food focus
        // Extract retrograde data with safe property access
        const retrogradeData = venus_1.default.PlanetSpecific.Retrograde;
        const retroFoodFocus = retrogradeData === null || retrogradeData === void 0 ? void 0 : retrogradeData.FoodFocus;
        if (retroFoodFocus) {
            const retroFocus = retroFoodFocus.toLowerCase();
            // Extract ingredient data with safe property access
            const ingredientData = ingredient;
            const ingredientName = ((_r = ingredientData === null || ingredientData === void 0 ? void 0 : ingredientData.name) === null || _r === void 0 ? void 0 : _r.toLowerCase()) || '';
            const ingredientDesc = ((_s = ingredientData === null || ingredientData === void 0 ? void 0 : ingredientData.description) === null || _s === void 0 ? void 0 : _s.toLowerCase()) || '';
            // Check for keyword matches
            const retroKeywords = retroFocus.split(/[\s,;]+/).filter(k => k.length > 3);
            for (const keyword of retroKeywords) {
                if (ingredientName.includes(keyword) || ingredientDesc.includes(keyword)) {
                    score += 1.7;
                    break;
                }
            }
        }
        // Check retrograde elements
        // Extract retrograde elements with safe property access
        const retrogradeElements = retrogradeData === null || retrogradeData === void 0 ? void 0 : retrogradeData.Elements;
        if (retrogradeElements && ingredient.elementalProperties) {
            for (const element in retrogradeElements) {
                if (ingredient.elementalProperties[element]) {
                    score += retrogradeElements[element] *
                        ingredient.elementalProperties[element] * 0.9;
                }
            }
        }
    }
    // Lunar phase connections with Venus
    // Extract planetary data with safe property access
    const venusDataAny = venus_1.default;
    const lunarConnection = venusDataAny === null || venusDataAny === void 0 ? void 0 : venusDataAny.LunarConnection;
    if (lunarConnection) {
        // This would be checked against the current lunar phase in a full implementation
    }
    return score;
}
// Enhance ingredient scoring with Venus influence
function _enhanceVenusIngredientScoring(ingredient, astroState, score) {
    var _a;
    // Only apply Venus scoring if Venus is active
    if (!((_a = astroState.activePlanets) === null || _a === void 0 ? void 0 : _a.includes('Venus'))) {
        return score;
    }
    // Get current zodiac sign
    const zodiacSign = astroState.zodiacSign;
    // Check if Venus is retrograde
    // Extract astrological state with safe property access
    const astroStateData = astroState;
    const retrogradeArray = Array.isArray(astroStateData === null || astroStateData === void 0 ? void 0 : astroStateData.retrograde) ? astroStateData.retrograde : [];
    const isVenusRetrograde = retrogradeArray.includes('Venus') || false;
    // Calculate Venus influence score
    const venusInfluence = calculateVenusInfluence(ingredient, zodiacSign, isVenusRetrograde);
    // Apply Venus influence to the base score (weight it appropriately)
    return score + (venusInfluence * 0.3);
}
// Enhanced function to boost Venus-ruled ingredients based on detailed Venus data
function enhanceVenusIngredientBatch(ingredients, astroState) {
    var _a;
    // Check if Venus is active
    const isVenusActive = (_a = astroState.activePlanets) === null || _a === void 0 ? void 0 : _a.includes('Venus');
    if (!isVenusActive) {
        return; // Skip Venus scoring if Venus is not active
    }
    // Get current zodiac sign
    const zodiacSign = astroState.zodiacSign;
    // Check if Venus is retrograde
    // Extract astrological state with safe property access for batch processing
    const astroStateData = astroState;
    const retrogradeArray = Array.isArray(astroStateData === null || astroStateData === void 0 ? void 0 : astroStateData.retrograde) ? astroStateData.retrograde : [];
    const isVenusRetrograde = retrogradeArray.includes('Venus') || false;
    // Add a "venusScore" property to each ingredient for sorting
    ingredients.forEach(ingredient => {
        // Use our comprehensive Venus influence calculation
        const venusScore = calculateVenusInfluence(ingredient, zodiacSign, isVenusRetrograde);
        // Store the Venus score with the ingredient
        ingredient.venusScore = venusScore;
    });
    // Sort ingredients by Venus score
    ingredients.sort((a, b) => {
        const aScore = a.venusScore || 0;
        const bScore = b.venusScore || 0;
        return bScore - aScore;
    });
}
/**
 * Calculates a Mars influence score for an ingredient
 */
function calculateMarsInfluence(ingredient, zodiacSign, isMarsRetrograde = false) {
    var _a, _b, _c, _d;
    let score = 0;
    // Get the name in lowercase for comparison
    const name = ingredient === null || ingredient === void 0 ? void 0 : ingredient.name.toLowerCase();
    // Match with Mars food associations
    if (mars_1.default.FoodAssociations) {
        for (const food of mars_1.default.FoodAssociations) {
            if (name.includes(food.toLowerCase()) || food.toLowerCase().includes(name)) {
                score += 1.5;
                break;
            }
        }
    }
    // Match with Mars herb associations (stronger affinity)
    if ((_a = mars_1.default.HerbalAssociations) === null || _a === void 0 ? void 0 : _a.Herbs) {
        for (const herb of mars_1.default.HerbalAssociations.Herbs) {
            if (name.includes(herb.toLowerCase()) || herb.toLowerCase().includes(name)) {
                score += 2.0;
                break;
            }
        }
    }
    // Flavor profile alignment
    // Extract ingredient data with safe property access for flavor profile
    const ingredientData = ingredient;
    const ingredientFlavorProfile = ingredientData === null || ingredientData === void 0 ? void 0 : ingredientData.flavorProfile;
    if (mars_1.default.FlavorProfiles && ingredientFlavorProfile) {
        for (const flavor in mars_1.default.FlavorProfiles) {
            if (ingredientFlavorProfile[flavor]) {
                // Higher score when both have high values for same flavor
                score += mars_1.default.FlavorProfiles[flavor] * ingredientFlavorProfile[flavor];
            }
        }
    }
    // Elemental alignment
    if (ingredient === null || ingredient === void 0 ? void 0 : ingredient.elementalProperties) {
        // Mars is primarily Fire, secondarily Water
        const fireScore = (ingredient === null || ingredient === void 0 ? void 0 : ingredient.elementalProperties.Fire) || 0;
        const waterScore = (ingredient === null || ingredient === void 0 ? void 0 : ingredient.elementalProperties.Water) || 0;
        score += fireScore * 1.5; // Primary element gets higher weight
        score += waterScore * 0.8; // Secondary element
    }
    // Zodiac sign specific boost
    if (zodiacSign && ((_b = mars_1.default.PlanetSpecific) === null || _b === void 0 ? void 0 : _b.ZodiacTransit)) {
        const transit = mars_1.default.PlanetSpecific.ZodiacTransit[zodiacSign];
        // Check if ingredient is in the transit's ingredient list
        if (transit && transit.Ingredients) {
            for (const transitIngredient of transit.Ingredients) {
                if (name.includes(transitIngredient.toLowerCase()) ||
                    transitIngredient.toLowerCase().includes(name)) {
                    score += 2.5; // Strong boost for exact ingredient match in current zodiac
                    break;
                }
            }
        }
        // Check element alignment with transit
        if (transit && transit.Elements && (ingredient === null || ingredient === void 0 ? void 0 : ingredient.elementalProperties)) {
            for (const element in transit.Elements) {
                const elemValue = element;
                if (ingredient === null || ingredient === void 0 ? void 0 : ingredient.elementalProperties[elemValue]) {
                    score += transit.Elements[element] * (ingredient === null || ingredient === void 0 ? void 0 : ingredient.elementalProperties[elemValue]) * 1.2;
                }
            }
        }
    }
    // Mars retrograde effects
    if (isMarsRetrograde && ((_c = mars_1.default.PlanetSpecific) === null || _c === void 0 ? void 0 : _c.Retrograde)) {
        // During retrograde, Mars emphasizes dried herbs and spices
        // Extract ingredient data with safe property access for type
        const ingredientData = ingredient;
        const ingredientType = (ingredientData === null || ingredientData === void 0 ? void 0 : ingredientData.type) || (ingredientData === null || ingredientData === void 0 ? void 0 : ingredientData.category) || '';
        if (ingredientType === 'spice' || ingredientType === 'herb' || ingredientType === 'seasoning') {
            score += 1.5;
        }
        // Focus shifts to traditional uses
        // Extract ingredient data with safe property access for traditional property
        const ingredientTraditional = ingredientData === null || ingredientData === void 0 ? void 0 : ingredientData.traditional;
        if (ingredientTraditional) {
            score += 1.2;
        }
    }
    // Adjust for Mars temperament based on dominant element
    if (ingredient === null || ingredient === void 0 ? void 0 : ingredient.elementalProperties) {
        const fireDominant = ((ingredient === null || ingredient === void 0 ? void 0 : ingredient.elementalProperties.Fire) || 0) > 0.6;
        const waterDominant = ((ingredient === null || ingredient === void 0 ? void 0 : ingredient.elementalProperties.Water) || 0) > 0.6;
        // Extract Mars temperament data with safe property access
        const marsTemperament = (_d = mars_1.default.PlanetSpecific) === null || _d === void 0 ? void 0 : _d.CulinaryTemperament;
        const fireMars = marsTemperament === null || marsTemperament === void 0 ? void 0 : marsTemperament.FireMars;
        const waterMars = marsTemperament === null || marsTemperament === void 0 ? void 0 : marsTemperament.WaterMars;
        if (fireDominant && fireMars) {
            score += 1.5;
        }
        else if (waterDominant && waterMars) {
            score += 1.3;
        }
    }
    return score;
}
/**
 * Apply Mars-specific scoring to a collection of ingredients
 */
function enhanceMarsIngredientScoring(ingredients, astroState) {
    // Get Mars status info from astro state
    // Extract astrological state with safe property access for Mars retrograde
    const astroStateData = astroState;
    const retrogradeArray = Array.isArray(astroStateData === null || astroStateData === void 0 ? void 0 : astroStateData.retrograde) ? astroStateData.retrograde : [];
    const isMarsRetrograde = retrogradeArray.includes('Mars') || false;
    const zodiacSign = astroState.zodiacSign;
    // Compute Mars influence for each ingredient
    for (let i = 0; i < ingredients.length; i++) {
        const ingredient = ingredients[i];
        // Only process if it has necessary data
        // Extract ingredient data with safe property access
        const ingredientData = ingredient;
        const ingredientName = ingredientData === null || ingredientData === void 0 ? void 0 : ingredientData.name;
        const ingredientMatchScore = ingredientData === null || ingredientData === void 0 ? void 0 : ingredientData.matchScore;
        if (!ingredientName || !ingredientMatchScore)
            continue;
        // Calculate Mars influence
        const marsInfluence = calculateMarsInfluence(ingredient, zodiacSign, isMarsRetrograde);
        // Apply Mars boost to match score
        if (marsInfluence > 0) {
            // Include the original score, add the Mars influence
            ingredientData.matchScore = (ingredientData.matchScore || 0) + (marsInfluence * 1.8);
            // Add a flag or data point to indicate Mars influence was applied
            if (!ingredientData.influences) {
                ingredientData.influences = {};
            }
            ingredientData.influences.mars = marsInfluence;
        }
    }
    // Re-sort the ingredients based on the updated scores
    ingredients.sort((a, b) => {
        const aData = a;
        const bData = b;
        return (bData.matchScore || 0) - (aData.matchScore || 0);
    });
}
// Add the new function for Mercury associated ingredients
function isMercuryAssociatedIngredient(ingredientName) {
    var _a, _b, _c, _d;
    if (!ingredientName)
        return false;
    const lowerIngredient = ingredientName.toLowerCase();
    // Check direct Mercury food associations
    if (mercury_1.default.FoodAssociations && mercury_1.default.FoodAssociations.some(food => food.toLowerCase() === lowerIngredient ||
        lowerIngredient.includes(food.toLowerCase()) ||
        food.toLowerCase().includes(lowerIngredient))) {
        return true;
    }
    // Check Mercury herb associations
    if (((_a = mercury_1.default.HerbalAssociations) === null || _a === void 0 ? void 0 : _a.Herbs) && mercury_1.default.HerbalAssociations.Herbs.some(herb => herb.toLowerCase() === lowerIngredient ||
        lowerIngredient.includes(herb.toLowerCase()) ||
        herb.toLowerCase().includes(lowerIngredient))) {
        return true;
    }
    // Check for Mercury elemental connection through flavor profile
    // Mercury emphasizes complexity, variety, multiple ingredients, and contrasting flavors
    const mercuryFlavorSignals = [
        'mixed', 'blend', 'infused', 'complex', 'layered', 'aromatic',
        'herb', 'mint', 'anise', 'fennel', 'dill', 'light', 'citrus',
        'varied', 'fusion', 'multi', 'fresh', 'stimulant', 'tea',
        'seeds', 'nuts', 'grain'
    ];
    if (mercuryFlavorSignals.some(signal => lowerIngredient.includes(signal))) {
        return true;
    }
    // Mercury is associated with Air and Earth elements
    // Lighter ingredients (Air) and grounding ingredients (Earth)
    if (lowerIngredient.includes('air') || lowerIngredient.includes('light') ||
        lowerIngredient.includes('puff') || lowerIngredient.includes('crisp') ||
        lowerIngredient.includes('earth') || lowerIngredient.includes('root') ||
        lowerIngredient.includes('tuber')) {
        return true;
    }
    // Check Mercury ZodiacTransit ingredient associations in current sign
    // This is a more dynamic way to check for transient associations
    const currentZodiacSign = 'aries'; // Use fallback or implement getCurrentZodiacSign function
    if (currentZodiacSign && ((_d = (_c = (_b = mercury_1.default.PlanetSpecific) === null || _b === void 0 ? void 0 : _b.ZodiacTransit) === null || _c === void 0 ? void 0 : _c[currentZodiacSign]) === null || _d === void 0 ? void 0 : _d.Ingredients)) {
        const transitIngredients = mercury_1.default.PlanetSpecific.ZodiacTransit[currentZodiacSign].Ingredients;
        if (transitIngredients.some(ingredient => ingredient.toLowerCase() === lowerIngredient ||
            lowerIngredient.includes(ingredient.toLowerCase()) ||
            ingredient.toLowerCase().includes(lowerIngredient))) {
            return true;
        }
    }
    return false;
}
// Add the function to calculate Mercury influence on ingredients
function calculateMercuryInfluence(ingredient, zodiacSign, isMercuryRetrograde = false) {
    var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s;
    let score = 0;
    // Base score for Mercury-ruled ingredients
    if ((_b = (_a = ingredient === null || ingredient === void 0 ? void 0 : ingredient.astrologicalProfile) === null || _a === void 0 ? void 0 : _a.rulingPlanets) === null || _b === void 0 ? void 0 : _b.includes('Mercury')) {
        score += 3.0; // Strong baseline for Mercury-ruled ingredients
    }
    // Mercury food associations
    if (mercury_1.default.FoodAssociations) {
        for (const food of mercury_1.default.FoodAssociations) {
            if ((ingredient === null || ingredient === void 0 ? void 0 : ingredient.name.toLowerCase().includes(food.toLowerCase())) ||
                food.toLowerCase().includes(ingredient === null || ingredient === void 0 ? void 0 : ingredient.name.toLowerCase())) {
                score += 2.0;
                break;
            }
        }
    }
    // Mercury herb associations
    // Extract ingredient data with safe property access for type
    const ingredientData = ingredient;
    const ingredientType = (ingredientData === null || ingredientData === void 0 ? void 0 : ingredientData.type) || (ingredientData === null || ingredientData === void 0 ? void 0 : ingredientData.category) || '';
    if (((_c = mercury_1.default.HerbalAssociations) === null || _c === void 0 ? void 0 : _c.Herbs) &&
        (ingredientType === 'herb' || ingredientType === 'spice')) {
        for (const herb of mercury_1.default.HerbalAssociations.Herbs) {
            if ((ingredient === null || ingredient === void 0 ? void 0 : ingredient.name.toLowerCase().includes(herb.toLowerCase())) ||
                herb.toLowerCase().includes(ingredient === null || ingredient === void 0 ? void 0 : ingredient.name.toLowerCase())) {
                score += 2.5; // Higher score for direct Mercury herb associations
                break;
            }
        }
    }
    // Elemental affinities based on Mercury's elements
    if (ingredient === null || ingredient === void 0 ? void 0 : ingredient.elementalProperties) {
        // Mercury's primary elements are Air and Earth
        score += ((ingredient === null || ingredient === void 0 ? void 0 : ingredient.elementalProperties.Air) || 0) * 2.0;
        score += ((ingredient === null || ingredient === void 0 ? void 0 : ingredient.elementalProperties.Earth) || 0) * 1.8;
    }
    // Add scores based on zodiac sign if provided
    if (zodiacSign) {
        const lowerSign = zodiacSign.toLowerCase();
        // Boost if ingredient has affinity with the current sign
        if ((_e = (_d = ingredient === null || ingredient === void 0 ? void 0 : ingredient.astrologicalProfile) === null || _d === void 0 ? void 0 : _d.signAffinities) === null || _e === void 0 ? void 0 : _e.includes(lowerSign)) {
            score += 1.5;
        }
        // Check Mercury's zodiac transit data for this sign
        const mercuryTransit = (_g = (_f = mercury_1.default.PlanetSpecific) === null || _f === void 0 ? void 0 : _f.ZodiacTransit) === null || _g === void 0 ? void 0 : _g[zodiacSign];
        if (mercuryTransit) {
            // Boost for ingredients matching transit ingredients
            if (mercuryTransit.Ingredients && mercuryTransit.Ingredients.some(transitIngredient => (ingredient === null || ingredient === void 0 ? void 0 : ingredient.name.toLowerCase().includes(transitIngredient.toLowerCase())) ||
                transitIngredient.toLowerCase().includes(ingredient === null || ingredient === void 0 ? void 0 : ingredient.name.toLowerCase()))) {
                score += 2.5;
            }
            // Element alignment with Mercury in this sign
            if (mercuryTransit.Elements && (ingredient === null || ingredient === void 0 ? void 0 : ingredient.elementalProperties)) {
                for (const element in mercuryTransit.Elements) {
                    const elemKey = element;
                    if (ingredient === null || ingredient === void 0 ? void 0 : ingredient.elementalProperties[elemKey]) {
                        score += mercuryTransit.Elements[element] * (ingredient === null || ingredient === void 0 ? void 0 : ingredient.elementalProperties[elemKey]) * 1.2;
                    }
                }
            }
        }
        // Special scoring for Mercury in its domicile signs
        if (lowerSign === 'gemini' || lowerSign === 'virgo') {
            if ((_j = (_h = ingredient === null || ingredient === void 0 ? void 0 : ingredient.astrologicalProfile) === null || _h === void 0 ? void 0 : _h.rulingPlanets) === null || _j === void 0 ? void 0 : _j.includes('Mercury')) {
                score += 2.0; // Extra boost for Mercury ruling when Mercury is in domicile
            }
            // Special handling for Gemini (Air) and Virgo (Earth)
            if (lowerSign === 'gemini' && ((_k = ingredient === null || ingredient === void 0 ? void 0 : ingredient.elementalProperties) === null || _k === void 0 ? void 0 : _k.Air)) {
                score += (ingredient === null || ingredient === void 0 ? void 0 : ingredient.elementalProperties.Air) * 1.8;
            }
            else if (lowerSign === 'virgo' && ((_l = ingredient === null || ingredient === void 0 ? void 0 : ingredient.elementalProperties) === null || _l === void 0 ? void 0 : _l.Earth)) {
                score += (ingredient === null || ingredient === void 0 ? void 0 : ingredient.elementalProperties.Earth) * 1.8;
            }
        }
        // Special handling for Mercury in its detriment signs
        if (lowerSign === 'sagittarius' || lowerSign === 'pisces') {
            score *= 0.8; // Reduce score slightly when Mercury is in detriment
        }
    }
    // Adjust score based on Mercury retrograde status
    if (isMercuryRetrograde) {
        // During retrograde, Mercury emphasizes familiar, traditional ingredients
        if (((_m = ingredient.qualities) === null || _m === void 0 ? void 0 : _m.includes('traditional')) ||
            ((_o = ingredient.qualities) === null || _o === void 0 ? void 0 : _o.includes('nostalgic')) ||
            ((_p = ingredient.qualities) === null || _p === void 0 ? void 0 : _p.includes('classic'))) {
            score *= 1.25; // Boost for traditional ingredients during retrograde
        }
        // During retrograde, Mercury de-emphasizes complex or exotic ingredients
        if (((_q = ingredient.qualities) === null || _q === void 0 ? void 0 : _q.includes('exotic')) ||
            ((_r = ingredient.qualities) === null || _r === void 0 ? void 0 : _r.includes('complex')) ||
            ((_s = ingredient.qualities) === null || _s === void 0 ? void 0 : _s.includes('novel'))) {
            score *= 0.8; // Reduce score for complex/exotic ingredients during retrograde
        }
        // Apply Mercury's retrograde elemental shift if available
        if (mercury_1.default.RetrogradeEffect && (ingredient === null || ingredient === void 0 ? void 0 : ingredient.elementalProperties)) {
            // Shift toward Matter and away from Spirit during retrograde
            if (ingredient === null || ingredient === void 0 ? void 0 : ingredient.elementalProperties.Earth) {
                score += (ingredient === null || ingredient === void 0 ? void 0 : ingredient.elementalProperties.Earth) * Math.abs(mercury_1.default.RetrogradeEffect.Matter);
            }
            if (ingredient === null || ingredient === void 0 ? void 0 : ingredient.elementalProperties.Air) {
                score -= (ingredient === null || ingredient === void 0 ? void 0 : ingredient.elementalProperties.Air) * Math.abs(mercury_1.default.RetrogradeEffect.Spirit);
            }
        }
    }
    // Adjust for Mercury's specific influence on certain ingredient qualities
    // Mercury emphasizes ingredients that involve mental stimulation and clarity
    if (ingredient.qualities) {
        const mercuryQualityBoosts = {
            'aromatic': 1.3,
            'complex': 1.4,
            'stimulating': 1.5,
            'adaptable': 1.3,
            'versatile': 1.4,
            'detailed': 1.2,
            'precise': 1.2
        };
        for (const quality of ingredient.qualities) {
            const lowerQuality = quality.toLowerCase();
            for (const [mercuryQuality, boost] of Object.entries(mercuryQualityBoosts)) {
                if (lowerQuality.includes(mercuryQuality)) {
                    score += boost;
                    break;
                }
            }
        }
    }
    return score;
}
// Add the function to enhance Mercury ingredient scoring
function enhanceMercuryIngredientScoring(ingredients, astroState) {
    // Check if Mercury is retrograde
    // Extract astrological state with safe property access for Mercury retrograde
    const astroStateData = astroState;
    const retrogradeArray = Array.isArray(astroStateData === null || astroStateData === void 0 ? void 0 : astroStateData.retrograde) ? astroStateData.retrograde : [];
    const isMercuryRetrograde = retrogradeArray.includes('Mercury') || false;
    // Get the current zodiac sign
    const zodiacSign = astroState.zodiacSign;
    // For each ingredient, calculate and apply Mercury influence score
    ingredients.forEach(ingredient => {
        const mercuryScore = calculateMercuryInfluence(ingredient, zodiacSign, isMercuryRetrograde);
        // Extract ingredient data with safe property access for score manipulation
        const ingredientData = ingredient;
        // Apply Mercury score as a multiplier to the ingredient's existing score
        if (ingredientData.matchScore !== undefined) {
            ingredientData.matchScore *= (1 + mercuryScore * 0.3);
        }
        else if ('score' in ingredientData) {
            ingredientData.score *= (1 + mercuryScore * 0.3);
        }
        // If the ingredient has a Mercury score field, update it
        if ('mercuryAffinity' in ingredient) {
            ingredient.mercuryAffinity = mercuryScore;
        }
        // If the ingredient has a detailed score breakdown, add Mercury score
        if ('scoreDetails' in ingredient) {
            ingredient.scoreDetails = {
                ...ingredient.scoreDetails,
                mercuryAffinity: mercuryScore
            };
        }
    });
}
/**
 * Determines the modality of an ingredient based on its qualities and elemental properties
 * Using the hierarchical affinities:
 * - Mutability: Air > Water > Fire > Earth
 * - Fixed: Earth > Water > Fire > Air
 * - Cardinal: Equal for all elements
 *
 * @param qualities Array of quality descriptors
 * @param elementalProperties Optional elemental properties for more accurate determination
 * @returns The modality (Cardinal, Fixed, or Mutable)
 */
function determineIngredientModality(qualities = [], elementalProperties) {
    // Ensure qualities is an array
    const qualitiesArray = Array.isArray(qualities) ? qualities : [];
    // Create normalized arrays of qualities for easier matching
    const normalizedQualities = qualitiesArray.map(q => q.toLowerCase());
    // Look for explicit quality indicators in the ingredients
    const cardinalKeywords = ['initiating', 'spicy', 'pungent', 'stimulating', 'invigorating', 'activating'];
    const fixedKeywords = ['grounding', 'stabilizing', 'nourishing', 'sustaining', 'foundational'];
    const mutableKeywords = ['adaptable', 'flexible', 'versatile', 'balancing', 'harmonizing'];
    const hasCardinalQuality = normalizedQualities.some(q => cardinalKeywords.includes(q));
    const hasFixedQuality = normalizedQualities.some(q => fixedKeywords.includes(q));
    const hasMutableQuality = normalizedQualities.some(q => mutableKeywords.includes(q));
    // If there's a clear quality indicator, use that
    if (hasCardinalQuality && !hasFixedQuality && !hasMutableQuality) {
        return 'Cardinal';
    }
    if (hasFixedQuality && !hasCardinalQuality && !hasMutableQuality) {
        return 'Fixed';
    }
    if (hasMutableQuality && !hasCardinalQuality && !hasFixedQuality) {
        return 'Mutable';
    }
    // If elemental properties are provided, use them to determine modality
    if (elementalProperties) {
        const { Fire, Water, Earth, Air } = elementalProperties;
        // Determine dominant element
        const dominantElement = getDominantElement(elementalProperties);
        // Use hierarchical element-modality affinities
        switch (dominantElement) {
            case 'Air':
                // Air has strongest affinity with Mutable, then Cardinal, then Fixed
                if (Air > 0.4) {
                    return 'Mutable';
                }
                break;
            case 'Earth':
                // Earth has strongest affinity with Fixed, then Cardinal, then Mutable
                if (Earth > 0.4) {
                    return 'Fixed';
                }
                break;
            case 'Fire':
                // Fire has balanced affinities but leans Cardinal
                if (Fire > 0.4) {
                    return 'Cardinal';
                }
                break;
            case 'Water':
                // Water is balanced between Fixed and Mutable
                if (Water > 0.4) {
                    // Slightly favor Mutable for Water, as per our hierarchy
                    return Water > 0.6 ? 'Mutable' : 'Fixed';
                }
                break;
        }
        // Calculate modality scores based on hierarchical affinities
        const mutableScore = (Air * 0.9) + (Water * 0.8) + (Fire * 0.7) + (Earth * 0.5);
        const fixedScore = (Earth * 0.9) + (Water * 0.8) + (Fire * 0.6) + (Air * 0.5);
        const cardinalScore = (Fire * 0.8) + (Earth * 0.8) + (Water * 0.8) + (Air * 0.8);
        // Return the modality with the highest score
        if (mutableScore > fixedScore && mutableScore > cardinalScore) {
            return 'Mutable';
        }
        else if (fixedScore > mutableScore && fixedScore > cardinalScore) {
            return 'Fixed';
        }
        else {
            return 'Cardinal';
        }
    }
    // Default to Mutable if no clear indicators are found
    return 'Mutable';
}
/**
 * Helper function to get the dominant element from elemental properties
 */
function getDominantElement(elementalProperties) {
    const elements = ['Fire', 'Water', 'Earth', 'Air'];
    let dominantElement = 'Earth'; // Default
    let highestValue = 0;
    // Find the element with the highest value
    elements.forEach(element => {
        const value = elementalProperties[element] || 0;
        if (value > highestValue) {
            highestValue = value;
            dominantElement = element;
        }
    });
    return dominantElement;
}
/**
 * Maps planets to their elemental influences (diurnal and nocturnal elements)
 */
const planetaryElements = {
    'Sun': { diurnal: 'Fire', nocturnal: 'Fire', dignityEffect: { 'leo': 1, 'aries': 2, 'aquarius': -1, 'libra': -2 } },
    'Moon': { diurnal: 'Water', nocturnal: 'Water', dignityEffect: { 'cancer': 1, 'taurus': 2, 'capricorn': -1, 'scorpio': -2 } },
    'Mercury': { diurnal: 'Air', nocturnal: 'Earth', dignityEffect: { 'gemini': 1, 'virgo': 3, 'sagittarius': 1, 'pisces': -3 } },
    'Venus': { diurnal: 'Water', nocturnal: 'Earth', dignityEffect: { 'libra': 1, 'taurus': 1, 'pisces': 2, 'aries': -1, 'scorpio': -1, 'virgo': -2 } },
    'Mars': { diurnal: 'Fire', nocturnal: 'Water', dignityEffect: { 'aries': 1, 'scorpio': 1, 'capricorn': 2, 'taurus': -1, 'libra': -1, 'cancer': -2 } },
    'Jupiter': { diurnal: 'Air', nocturnal: 'Fire', dignityEffect: { 'pisces': 1, 'sagittarius': 1, 'cancer': 2, 'gemini': -1, 'virgo': -1, 'capricorn': -2 } },
    'Saturn': { diurnal: 'Air', nocturnal: 'Earth', dignityEffect: { 'aquarius': 1, 'capricorn': 1, 'libra': 2, 'cancer': -1, 'leo': -1, 'aries': -2 } },
    'Uranus': { diurnal: 'Water', nocturnal: 'Air', dignityEffect: { 'aquarius': 1, 'scorpio': 2, 'taurus': -3 } },
    'Neptune': { diurnal: 'Water', nocturnal: 'Water', dignityEffect: { 'pisces': 1, 'cancer': 2, 'virgo': -1, 'capricorn': -2 } },
    'Pluto': { diurnal: 'Earth', nocturnal: 'Water', dignityEffect: { 'scorpio': 1, 'leo': 2, 'taurus': -1, 'aquarius': -2 } }
};
// Define sign info with decan effects and degree effects
const signInfo = {
    'aries': {
        element: 'Fire',
        decanEffects: { '1st Decan': ['Mars'], '2nd Decan': ['Sun'], '3rd Decan': ['Venus'] },
        degreeEffects: { 'Mercury': [15, 21], 'Venus': [7, 14], 'Mars': [22, 26], 'Jupiter': [1, 6], 'Saturn': [27, 30] }
    },
    'taurus': {
        element: 'Earth',
        decanEffects: { '1st Decan': ['Mercury'], '2nd Decan': ['Moon'], '3rd Decan': ['Saturn'] },
        degreeEffects: { 'Mercury': [9, 15], 'Venus': [1, 8], 'Mars': [27, 30], 'Jupiter': [16, 22], 'Saturn': [23, 26] }
    },
    'gemini': {
        element: 'Air',
        decanEffects: { '1st Decan': ['Jupiter'], '2nd Decan': ['Mars'], '3rd Decan': ['Uranus', 'Sun'] },
        degreeEffects: { 'Mercury': [1, 7], 'Venus': [15, 20], 'Mars': [26, 30], 'Jupiter': [8, 14], 'Saturn': [22, 25] }
    },
    'cancer': {
        element: 'Water',
        decanEffects: { '1st Decan': ['Venus'], '2nd Decan': ['Mercury', 'Pluto'], '3rd Decan': ['Neptune', 'Moon'] },
        degreeEffects: { 'Mercury': [14, 20], 'Venus': [21, 27], 'Mars': [1, 6], 'Jupiter': [7, 13], 'Saturn': [28, 30] }
    },
    'leo': {
        element: 'Fire',
        decanEffects: { '1st Decan': ['Saturn'], '2nd Decan': ['Jupiter'], '3rd Decan': ['Mars'] },
        degreeEffects: { 'Mercury': [7, 13], 'Venus': [14, 19], 'Mars': [26, 30], 'Jupiter': [20, 25], 'Saturn': [1, 6] }
    },
    'virgo': {
        element: 'Earth',
        decanEffects: { '1st Decan': ['Mars', 'Sun'], '2nd Decan': ['Venus'], '3rd Decan': ['Mercury'] },
        degreeEffects: { 'Mercury': [1, 7], 'Venus': [8, 13], 'Mars': [25, 30], 'Jupiter': [14, 18], 'Saturn': [19, 24] }
    },
    'libra': {
        element: 'Air',
        decanEffects: { '1st Decan': ['Moon'], '2nd Decan': ['Saturn', 'Uranus'], '3rd Decan': ['Jupiter'] },
        degreeEffects: { 'Mercury': [20, 24], 'Venus': [7, 11], 'Mars': [], 'Jupiter': [12, 19], 'Saturn': [1, 6] }
    },
    'scorpio': {
        element: 'Water',
        decanEffects: { '1st Decan': ['Pluto'], '2nd Decan': ['Neptune', 'Sun'], '3rd Decan': ['Venus'] },
        degreeEffects: { 'Mercury': [22, 27], 'Venus': [15, 21], 'Mars': [1, 6], 'Jupiter': [7, 14], 'Saturn': [28, 30] }
    },
    'sagittarius': {
        element: 'Fire',
        decanEffects: { '1st Decan': ['Mercury'], '2nd Decan': ['Moon'], '3rd Decan': ['Saturn'] },
        degreeEffects: { 'Mercury': [15, 20], 'Venus': [9, 14], 'Mars': [], 'Jupiter': [1, 8], 'Saturn': [21, 25] }
    },
    'capricorn': {
        element: 'Earth',
        decanEffects: { '1st Decan': ['Jupiter'], '2nd Decan': [], '3rd Decan': ['Sun'] },
        degreeEffects: { 'Mercury': [7, 12], 'Venus': [1, 6], 'Mars': [], 'Jupiter': [13, 19], 'Saturn': [26, 30] }
    },
    'aquarius': {
        element: 'Air',
        decanEffects: { '1st Decan': ['Uranus'], '2nd Decan': ['Mercury'], '3rd Decan': ['Moon'] },
        degreeEffects: { 'Mercury': [], 'Venus': [13, 20], 'Mars': [26, 30], 'Jupiter': [21, 25], 'Saturn': [1, 6] }
    },
    'pisces': {
        element: 'Water',
        decanEffects: { '1st Decan': ['Saturn', 'Neptune', 'Venus'], '2nd Decan': ['Jupiter'], '3rd Decan': ['Pisces', 'Mars'] },
        degreeEffects: { 'Mercury': [15, 20], 'Venus': [1, 8], 'Mars': [21, 26], 'Jupiter': [9, 14], 'Saturn': [27, 30] }
    }
};
/**
 * Calculate the planetary day influence on food ingredients
 * Now enhanced with dignity effects, decan effects, and degree effects
 */
function calculatePlanetaryDayInfluence(ingredient, planetaryDay, planetaryPositions) {
    var _a, _b;
    // Get the elements associated with the current planetary day
    const dayElements = planetaryElements[planetaryDay];
    if (!dayElements)
        return 0.5; // Unknown planet
    // For planetary day, BOTH diurnal and nocturnal elements influence all day
    const diurnalElement = dayElements.diurnal;
    const nocturnalElement = dayElements.nocturnal;
    // Calculate match based on food's element compared to planetary elements
    let diurnalMatch = 0;
    let nocturnalMatch = 0;
    // Check if ingredient has elemental properties
    if (ingredient === null || ingredient === void 0 ? void 0 : ingredient.elementalProperties) {
        diurnalMatch = (ingredient === null || ingredient === void 0 ? void 0 : ingredient.elementalProperties[diurnalElement]) || 0;
        nocturnalMatch = (ingredient === null || ingredient === void 0 ? void 0 : ingredient.elementalProperties[nocturnalElement]) || 0;
    }
    else {
        // Simple matching if no detailed elemental profile is available
        // Extract ingredient data with safe property access for element
        const ingredientData = ingredient;
        const ingredientElement = (ingredientData === null || ingredientData === void 0 ? void 0 : ingredientData.element) || (ingredientData === null || ingredientData === void 0 ? void 0 : ingredientData.category) || '';
        diurnalMatch = ingredientElement === diurnalElement ? 1.0 : 0.3;
        nocturnalMatch = ingredientElement === nocturnalElement ? 1.0 : 0.3;
    }
    // Calculate a weighted score - both elements are equally important for planetary day
    let elementalScore = (diurnalMatch + nocturnalMatch) / 2;
    // Apply dignity effects if we have planet positions
    if (planetaryPositions && planetaryPositions[planetaryDay]) {
        const planetSign = planetaryPositions[planetaryDay].sign;
        const planetDegree = planetaryPositions[planetaryDay].degree;
        // Dignity effect bonus/penalty
        if (dayElements.dignityEffect && dayElements.dignityEffect[planetSign]) {
            const dignityModifier = dayElements.dignityEffect[planetSign] * 0.1; // Scale to 0.1-0.3 effect
            elementalScore = Math.min(1.0, Math.max(0.0, elementalScore + dignityModifier));
        }
        // Calculate decan (1-10: 1st decan, 11-20: 2nd decan, 21-30: 3rd decan)
        let decan = '1st Decan';
        if (planetDegree > 10 && planetDegree <= 20)
            decan = '2nd Decan';
        else if (planetDegree > 20)
            decan = '3rd Decan';
        // Apply decan effects if the planet is in its own decan
        if (signInfo[planetSign] &&
            signInfo[planetSign].decanEffects[decan] &&
            signInfo[planetSign].decanEffects[decan].includes(planetaryDay)) {
            elementalScore = Math.min(1.0, elementalScore + 0.15);
        }
        // Apply degree effects
        if (signInfo[planetSign] &&
            signInfo[planetSign].degreeEffects[planetaryDay] &&
            signInfo[planetSign].degreeEffects[planetaryDay].length === 2) {
            const [minDegree, maxDegree] = signInfo[planetSign].degreeEffects[planetaryDay];
            if (planetDegree >= minDegree && planetDegree <= maxDegree) {
                elementalScore = Math.min(1.0, elementalScore + 0.2);
            }
        }
    }
    // If the food has a direct planetary affinity, give bonus points
    if ((_b = (_a = ingredient === null || ingredient === void 0 ? void 0 : ingredient.astrologicalProfile) === null || _a === void 0 ? void 0 : _a.rulingPlanets) === null || _b === void 0 ? void 0 : _b.includes(planetaryDay)) {
        elementalScore = Math.min(1.0, elementalScore + 0.3);
    }
    return elementalScore;
}
/**
 * Calculate the planetary hour influence on food
 * Now enhanced with dignity effects and aspect considerations
 */
function calculatePlanetaryHourInfluence(ingredient, planetaryHour, isDaytime, planetaryPositions, aspects) {
    var _a, _b, _c, _d;
    // Get the elements associated with the current planetary hour
    const hourElements = planetaryElements[planetaryHour];
    if (!hourElements)
        return 0.5; // Unknown planet
    // For planetary hour, use diurnal element during day, nocturnal at night
    const relevantElement = isDaytime ? hourElements.diurnal : hourElements.nocturnal;
    // Calculate match based on food's element compared to the hour's relevant element
    let elementalMatch = 0;
    // Check if ingredient has elemental properties
    if (ingredient === null || ingredient === void 0 ? void 0 : ingredient.elementalProperties) {
        elementalMatch = (ingredient === null || ingredient === void 0 ? void 0 : ingredient.elementalProperties[relevantElement]) || 0;
    }
    else {
        // Simple matching if no detailed elemental profile is available
        // Extract ingredient data with safe property access for element
        const ingredientData = ingredient;
        const ingredientElement = (ingredientData === null || ingredientData === void 0 ? void 0 : ingredientData.element) || (ingredientData === null || ingredientData === void 0 ? void 0 : ingredientData.category) || '';
        elementalMatch = ingredientElement === relevantElement ? 1.0 : 0.3;
    }
    // Apply dignity effects if we have planet positions
    if (planetaryPositions && planetaryPositions[planetaryHour]) {
        const planetSign = planetaryPositions[planetaryHour].sign;
        // Dignity effect bonus/penalty
        if (hourElements.dignityEffect && hourElements.dignityEffect[planetSign]) {
            const dignityModifier = hourElements.dignityEffect[planetSign] * 0.1; // Scale to 0.1-0.3 effect
            elementalMatch = Math.min(1.0, Math.max(0.0, elementalMatch + dignityModifier));
        }
    }
    // Apply aspect effects if available
    if (aspects && aspects.length > 0) {
        // Find aspects involving the planetary hour ruler
        const hourAspects = aspects.filter(a => a.planet1 === planetaryHour || a.planet2 === planetaryHour);
        for (const aspect of hourAspects) {
            const otherPlanet = aspect.planet1 === planetaryHour ? aspect.planet2 : aspect.planet1;
            let aspectModifier = 0;
            // Apply different modifier based on aspect type
            switch (aspect.aspectType) {
                case 'Conjunction':
                    // Strong beneficial aspect
                    aspectModifier = 0.15;
                    break;
                case 'Trine':
                    // Beneficial aspect
                    aspectModifier = 0.1;
                    break;
                case 'Square':
                    // Challenging aspect
                    aspectModifier = -0.1;
                    break;
                case 'Opposition':
                    // Strong challenging aspect
                    aspectModifier = -0.15;
                    break;
                default:
                    aspectModifier = 0;
            }
            // Apply the aspect modifier if the ingredient is ruled by the other planet in the aspect
            if ((_b = (_a = ingredient === null || ingredient === void 0 ? void 0 : ingredient.astrologicalProfile) === null || _a === void 0 ? void 0 : _a.rulingPlanets) === null || _b === void 0 ? void 0 : _b.includes(otherPlanet)) {
                elementalMatch = Math.min(1.0, Math.max(0.0, elementalMatch + aspectModifier));
            }
        }
    }
    // If the food has a direct planetary affinity, give bonus points
    if ((_d = (_c = ingredient === null || ingredient === void 0 ? void 0 : ingredient.astrologicalProfile) === null || _c === void 0 ? void 0 : _c.rulingPlanets) === null || _d === void 0 ? void 0 : _d.includes(planetaryHour)) {
        elementalMatch = Math.min(1.0, elementalMatch + 0.3);
    }
    return elementalMatch;
}
/**
 * Helper function to determine if it's currently daytime (6am-6pm)
 */
function isDaytime(date = new Date()) {
    const hour = date.getHours();
    return hour >= 6 && hour < 18;
}
/**
 * Recommend ingredients with enhanced planetary, dignity and aspect effects
 */
function recommendIngredients(astroState, options = {}) {
    // Get all available ingredients
    const allIngredients = getAllIngredients();
    // Filter by category if specified
    let filteredIngredients = allIngredients;
    if (options.category) {
        filteredIngredients = allIngredients.filter(ing => {
            var _a;
            // Extract ingredient data with safe property access for type/category
            const ingredientData = ing;
            const ingredientType = (ingredientData === null || ingredientData === void 0 ? void 0 : ingredientData.type) || (ingredientData === null || ingredientData === void 0 ? void 0 : ingredientData.category) || '';
            return ingredientType.toLowerCase() === ((_a = options.category) === null || _a === void 0 ? void 0 : _a.toLowerCase());
        });
    }
    // Filter out excluded ingredients
    if (options.excludeIngredients && options.excludeIngredients.length > 0) {
        filteredIngredients = filteredIngredients.filter(ing => { var _a; return !((_a = options.excludeIngredients) === null || _a === void 0 ? void 0 : _a.includes(ing === null || ing === void 0 ? void 0 : ing.name)); });
    }
    // Filter to only include specific ingredients
    if (options.includeOnly && options.includeOnly.length > 0) {
        filteredIngredients = filteredIngredients.filter(ing => { var _a; return (_a = options.includeOnly) === null || _a === void 0 ? void 0 : _a.includes(ing === null || ing === void 0 ? void 0 : ing.name); });
    }
    // Extract key astrological information
    // Extract astrological state with safe property access
    const astroStateData = astroState;
    const timestamp = (astroStateData === null || astroStateData === void 0 ? void 0 : astroStateData.timestamp) || new Date();
    const Fire = (astroStateData === null || astroStateData === void 0 ? void 0 : astroStateData.Fire) || 0.5;
    const Water = (astroStateData === null || astroStateData === void 0 ? void 0 : astroStateData.Water) || 0.5;
    const Air = (astroStateData === null || astroStateData === void 0 ? void 0 : astroStateData.Air) || 0.5;
    const Earth = (astroStateData === null || astroStateData === void 0 ? void 0 : astroStateData.Earth) || 0.5;
    const zodiacSign = (astroStateData === null || astroStateData === void 0 ? void 0 : astroStateData.zodiacSign) || '';
    const planetaryAlignment = (astroStateData === null || astroStateData === void 0 ? void 0 : astroStateData.planetaryAlignment) || {};
    const aspects = (astroStateData === null || astroStateData === void 0 ? void 0 : astroStateData.aspects) || [];
    const lunarPhase = (astroStateData === null || astroStateData === void 0 ? void 0 : astroStateData.lunarPhase) || '';
    // Get planetary day and hour for current time
    const date = timestamp instanceof Date ? timestamp : new Date(timestamp);
    const planetaryCalculator = {
        calculatePlanetaryDay: (date) => {
            const days = ['Sun', 'Moon', 'Mars', 'Mercury', 'Jupiter', 'Venus', 'Saturn'];
            return days[date.getDay()];
        },
        calculatePlanetaryHour: (date) => {
            // This is a simplified calculation
            const hours = [
                'Sun', 'Venus', 'Mercury', 'Moon', 'Saturn', 'Jupiter', 'Mars',
                'Sun', 'Venus', 'Mercury', 'Moon', 'Saturn', 'Jupiter', 'Mars',
                'Sun', 'Venus', 'Mercury', 'Moon', 'Saturn', 'Jupiter', 'Mars',
                'Sun', 'Venus', 'Mercury', 'Moon'
            ];
            return hours[date.getHours()];
        },
        isDaytime: isDaytime
    };
    const planetaryDay = planetaryCalculator.calculatePlanetaryDay(date);
    const planetaryHour = planetaryCalculator.calculatePlanetaryHour(date);
    const isDaytimeNow = planetaryCalculator.isDaytime(date);
    // Create elemental properties object for the current system state
    const systemElementalProps = { Fire, Water, Air, Earth };
    const recommendations = [];
    // Calculate scores for each ingredient
    for (const ingredient of filteredIngredients) {
        // Calculate elemental match (45% weight)
        const elementalScore = calculateElementalScore(ingredient === null || ingredient === void 0 ? void 0 : ingredient.elementalProperties, systemElementalProps);
        // Calculate planetary day influence with enhanced dignity effects (35% weight)
        const planetaryDayScore = calculatePlanetaryDayInfluence(ingredient, planetaryDay, planetaryAlignment);
        // Calculate planetary hour influence with enhanced dignity and aspect effects (20% weight)
        const planetaryHourScore = calculatePlanetaryHourInfluence(ingredient, planetaryHour, isDaytimeNow, planetaryAlignment, aspects);
        // Apply standardized weighting
        const totalScore = (elementalScore * 0.45 +
            planetaryDayScore * 0.35 +
            planetaryHourScore * 0.20);
        // Generate ingredient-specific recommendations based on planetary influences
        const ingredientRecommendations = generateRecommendationsForIngredient(ingredient, planetaryDay, planetaryHour, isDaytimeNow, planetaryAlignment, aspects);
        // Add to recommendations list
        // Apply Pattern L: Interface property mapping for IngredientRecommendation compatibility
        const ingredientData = ingredient;
        const ingredientRecommendation = {
            name: (ingredientData === null || ingredientData === void 0 ? void 0 : ingredientData.name) || '',
            type: (ingredientData === null || ingredientData === void 0 ? void 0 : ingredientData.type) || '',
            category: ingredientData === null || ingredientData === void 0 ? void 0 : ingredientData.category,
            elementalProperties: ingredientData === null || ingredientData === void 0 ? void 0 : ingredientData.elementalProperties,
            qualities: ingredientData === null || ingredientData === void 0 ? void 0 : ingredientData.qualities,
            matchScore: totalScore,
            modality: ingredientData === null || ingredientData === void 0 ? void 0 : ingredientData.modality,
            recommendations: ingredientRecommendations,
            description: ingredientData === null || ingredientData === void 0 ? void 0 : ingredientData.description,
            totalScore,
            elementalScore: elementalScore * 0.45,
            astrologicalScore: (planetaryDayScore * 0.35) + (planetaryHourScore * 0.20),
            seasonalScore: ingredientData === null || ingredientData === void 0 ? void 0 : ingredientData.seasonalScore,
            dietary: ingredientData === null || ingredientData === void 0 ? void 0 : ingredientData.dietary
        };
        recommendations.push(ingredientRecommendation);
    }
    // Sort by match score (highest first)
    recommendations.sort((a, b) => b.matchScore - a.matchScore);
    // Apply limit if specified
    const limit = options.limit || 10;
    return recommendations.slice(0, limit);
}
exports.recommendIngredients = recommendIngredients;
/**
 * Generate enhanced recommendations for an ingredient based on planetary influences
 */
function generateRecommendationsForIngredient(ingredient, planetaryDay, planetaryHour, isDaytime, planetaryPositions, aspects) {
    var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q;
    const recs = [];
    // Basic recommendation based on planetary day
    if (planetaryElements[planetaryDay]) {
        const dayElements = planetaryElements[planetaryDay];
        recs.push(`${ingredient === null || ingredient === void 0 ? void 0 : ingredient.name} works well on ${planetaryDay}'s day with its ${dayElements.diurnal} and ${dayElements.nocturnal} influences.`);
    }
    // Time-specific recommendation based on planetary hour
    if (planetaryElements[planetaryHour]) {
        const hourElement = isDaytime
            ? planetaryElements[planetaryHour].diurnal
            : planetaryElements[planetaryHour].nocturnal;
        recs.push(`During the current hour of ${planetaryHour}, ${ingredient === null || ingredient === void 0 ? void 0 : ingredient.name}'s ${hourElement} properties are enhanced.`);
    }
    // Add dignity effect recommendations if planet is in dignified or debilitated sign
    if (planetaryPositions) {
        // Check day planet dignity
        if (((_a = planetaryElements[planetaryDay]) === null || _a === void 0 ? void 0 : _a.dignityEffect) &&
            planetaryPositions[planetaryDay]) {
            const daySign = planetaryPositions[planetaryDay].sign;
            const dayDignity = (_b = planetaryElements[planetaryDay].dignityEffect) === null || _b === void 0 ? void 0 : _b[daySign];
            if (dayDignity && dayDignity > 0 && ((_d = (_c = ingredient === null || ingredient === void 0 ? void 0 : ingredient.astrologicalProfile) === null || _c === void 0 ? void 0 : _c.rulingPlanets) === null || _d === void 0 ? void 0 : _d.includes(planetaryDay))) {
                recs.push(`${planetaryDay} is ${dayDignity > 1 ? 'exalted' : 'dignified'} in ${daySign}, strengthening ${ingredient === null || ingredient === void 0 ? void 0 : ingredient.name}'s properties.`);
            }
            else if (dayDignity && dayDignity < 0 && ((_f = (_e = ingredient === null || ingredient === void 0 ? void 0 : ingredient.astrologicalProfile) === null || _e === void 0 ? void 0 : _e.rulingPlanets) === null || _f === void 0 ? void 0 : _f.includes(planetaryDay))) {
                recs.push(`${planetaryDay} is ${dayDignity < -1 ? 'in fall' : 'in detriment'} in ${daySign}, requiring careful preparation of ${ingredient === null || ingredient === void 0 ? void 0 : ingredient.name}.`);
            }
        }
        // Check hour planet dignity
        if (((_g = planetaryElements[planetaryHour]) === null || _g === void 0 ? void 0 : _g.dignityEffect) &&
            planetaryPositions[planetaryHour]) {
            const hourSign = planetaryPositions[planetaryHour].sign;
            const hourDignity = (_h = planetaryElements[planetaryHour].dignityEffect) === null || _h === void 0 ? void 0 : _h[hourSign];
            if (hourDignity && hourDignity > 0 && ((_k = (_j = ingredient === null || ingredient === void 0 ? void 0 : ingredient.astrologicalProfile) === null || _j === void 0 ? void 0 : _j.rulingPlanets) === null || _k === void 0 ? void 0 : _k.includes(planetaryHour))) {
                recs.push(`During this hour, ${planetaryHour}'s dignity in ${hourSign} enhances ${ingredient === null || ingredient === void 0 ? void 0 : ingredient.name}'s flavor profile.`);
            }
        }
    }
    // Add aspect-based recommendations
    if (aspects && aspects.length > 0) {
        const relevantAspects = aspects.filter(aspect => (aspect.planet1 === planetaryDay || aspect.planet2 === planetaryDay) ||
            (aspect.planet1 === planetaryHour || aspect.planet2 === planetaryHour));
        for (const aspect of relevantAspects) {
            if (aspect.aspectType === 'Conjunction') {
                const planets = [aspect.planet1, aspect.planet2];
                if (planets.includes(planetaryDay) || planets.includes(planetaryHour)) {
                    const otherPlanet = planets.find(p => p !== planetaryDay && p !== planetaryHour);
                    if (otherPlanet && ((_m = (_l = ingredient === null || ingredient === void 0 ? void 0 : ingredient.astrologicalProfile) === null || _l === void 0 ? void 0 : _l.rulingPlanets) === null || _m === void 0 ? void 0 : _m.includes(otherPlanet))) {
                        recs.push(`The conjunction between ${aspect.planet1} and ${aspect.planet2} strongly enhances ${ingredient === null || ingredient === void 0 ? void 0 : ingredient.name}'s qualities.`);
                    }
                }
            }
            else if (aspect.aspectType === 'Trine') {
                const planets = [aspect.planet1, aspect.planet2];
                if (planets.includes(planetaryDay) || planets.includes(planetaryHour)) {
                    const otherPlanet = planets.find(p => p !== planetaryDay && p !== planetaryHour);
                    if (otherPlanet && ((_p = (_o = ingredient === null || ingredient === void 0 ? void 0 : ingredient.astrologicalProfile) === null || _o === void 0 ? void 0 : _o.rulingPlanets) === null || _p === void 0 ? void 0 : _p.includes(otherPlanet))) {
                        recs.push(`The harmonious trine between ${aspect.planet1} and ${aspect.planet2} creates a flowing energy for ${ingredient === null || ingredient === void 0 ? void 0 : ingredient.name}.`);
                    }
                }
            }
        }
    }
    // Direct planetary affinity recommendation
    if ((_q = ingredient === null || ingredient === void 0 ? void 0 : ingredient.astrologicalProfile) === null || _q === void 0 ? void 0 : _q.rulingPlanets) {
        const rulingPlanets = ingredient === null || ingredient === void 0 ? void 0 : ingredient.astrologicalProfile.rulingPlanets;
        if (rulingPlanets.includes(planetaryDay)) {
            recs.push(`${ingredient === null || ingredient === void 0 ? void 0 : ingredient.name} is especially potent today as it's ruled by ${planetaryDay}.`);
        }
        if (rulingPlanets.includes(planetaryHour)) {
            recs.push(`This is an optimal hour to work with ${ingredient === null || ingredient === void 0 ? void 0 : ingredient.name} due to ${planetaryHour}'s influence.`);
        }
    }
    return recs;
}
// ... existing code ...
// ... existing code ...
// ... existing code ...
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy91dGlscy9pbmdyZWRpZW50UmVjb21tZW5kZXIudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBbURBLGdDQUFnQztBQUNoQyw4REFBMkQ7QUFDM0Qsc0RBQW1EO0FBQ25ELG9EQUFpRDtBQUNqRCxzREFBbUQ7QUFDbkQsMERBQXVEO0FBQ3ZELHNEQUFtRDtBQUNuRCw4REFBMkQ7QUFDM0Qsa0RBQStDO0FBRS9DLHFCQUFxQjtBQUNyQixpRUFBNkM7QUFDN0MsK0RBQTJDO0FBQzNDLHFFQUFpRDtBQUlqRCw2REFBMEY7QUFFMUYsc0VBQW1FO0FBR25FLHFGQUFxRjtBQUNyRiw2REFBa0Y7QUF1RWxGLG9DQUFvQztBQUNwQyxNQUFNLGNBQWMsR0FBRztJQUNyQixHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsdUJBQVUsSUFBSSxFQUFFLENBQUM7SUFDbEMsR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLGVBQU0sSUFBSSxFQUFFLENBQUM7SUFDOUIsR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLGFBQUssSUFBSSxFQUFFLENBQUM7SUFDN0IsR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLGVBQU0sSUFBSSxFQUFFLENBQUM7SUFDOUIsR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLG1CQUFRLElBQUksRUFBRSxDQUFDO0lBQ2hDLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxlQUFNLElBQUksRUFBRSxDQUFDO0lBQzlCLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyx1QkFBVSxJQUFJLEVBQUUsQ0FBQztJQUNsQyxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsV0FBSSxJQUFJLEVBQUUsQ0FBQztDQUM3QixDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsQ0FBQztBQUVsQiw4RUFBOEU7QUFDOUUsU0FBUyxpQkFBaUI7SUFDeEIsMENBQTBDO0lBQzFDLElBQUksT0FBTyxtQ0FBa0IsS0FBSyxVQUFVLEVBQUU7UUFDNUMscUVBQXFF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TyxFQUFFO1lBQzVDLFFBQVEsRUFBRSxFQUFFLENBQUMsRUFBRSxTQUFTLEVBQUUsQ0FBQyxFQUFFLE1BQU0sRUFBRSxDQUFDLEVBQUUsUUFBUSxFQUFFO1lBQ2xELFFBQVEsRUFBRSxFQUFFLENBQUMsRUFBRSxTQUFTLEVBQUUsQ0FBQyxFQUFFLE1BQU0sRUFBRSxDQUFDLEVBQUUsS0FBSyxFQUFFO1lBQy9DLFFBQVEsRUFBRSxFQUFFLENBQUMsRUFBRSxPQUFPLEVBQUUsQ0FBQyxFQUFFLFNBQVMsRUFBRSxDQUFDLEVBQUUsTUFBTSxFQUFFO1lBQ2pELEtBQUssRUFBRSxFQUFFLENBQUMsRUFBRSxRQUFRLEVBQUUsQ0FBQyxFQUFFLFNBQVMsRUFBRSxDQUFDLEVBQUUsTUFBTSxFQUFFO1lBQy9DLE9BQU8sRUFBRSxFQUFFLENBQUMsRUFBRSxLQUFLLEVBQUUsQ0FBQyxFQUFFLE9BQU8sRUFBRSxDQUFDLEVBQUUsU0FBUyxFQUFFO1lBQy9DLE9BQU8sRUFBRSxFQUFFLENBQUMsRUFBRSxNQUFNLEVBQUUsQ0FBQyxFQUFFLFFBQVEsRUFBRSxDQUFDLEVBQUUsU0FBUyxFQUFFO1lBQ2pELFNBQVMsRUFBRSxFQUFFLENBQUMsRUFBRSxNQUFNLEVBQUUsQ0FBQyxFQUFFLEtBQUssRUFBRSxDQUFDLEVBQUUsT0FBTyxFQUFFO1lBQzlDLGFBQWEsRUFBRSxFQUFFLENBQUMsRUFBRSxTQUFTLEVBQUUsQ0FBQyxFQUFFLE1BQU0sRUFBRSxDQUFDLEVBQUUsUUFBUSxFQUFFO1lBQ3ZELFdBQVcsRUFBRSxFQUFFLENBQUMsRUFBRSxTQUFTLEVBQUUsQ0FBQyxFQUFFLE1BQU0sRUFBRSxDQUFDLEVBQUUsS0FBSyxFQUFFO1lBQ2xELFVBQVUsRUFBRSxFQUFFLENBQUMsRUFBRSxPQUFPLEVBQUUsQ0FBQyxFQUFFLFNBQVMsRUFBRSxDQUFDLEVBQUUsTUFBTSxFQUFFO1lBQ25ELFFBQVEsRUFBRSxFQUFFLENBQUMsRUFBRSxRQUFRLEVBQUUsQ0FBQyxFQUFFLFNBQVMsRUFBRSxDQUFDLEVBQUUsTUFBTSxFQUFFO1NBQ25ELENBQUM7UUFFRixNQUFNLFlBQVksR0FBMkM7WUFDM0QsT0FBTyxFQUFFLEVBQUUsQ0FBQyxFQUFFLFlBQVksRUFBRSxDQUFDLEVBQUUsWUFBWSxFQUFFLENBQUMsRUFBRSxZQUFZLEVBQUU7WUFDOUQsUUFBUSxFQUFFLEVBQUUsQ0FBQyxFQUFFLGdCQUFnQixFQUFFLENBQUMsRUFBRSxnQkFBZ0IsRUFBRSxDQUFDLEVBQUUsZ0JBQWdCLEVBQUU7WUFDM0UsUUFBUSxFQUFFLEVBQUUsQ0FBQyxFQUFFLGFBQWEsRUFBRSxDQUFDLEVBQUUsYUFBYSxFQUFFLENBQUMsRUFBRSxjQUFjLEVBQUU7WUFDbkUsUUFBUSxFQUFFLEVBQUUsQ0FBQyxFQUFFLFdBQVcsRUFBRSxDQUFDLEVBQUUsV0FBVyxFQUFFLENBQUMsRUFBRSxXQUFXLEVBQUU7WUFDNUQsS0FBSyxFQUFFLEVBQUUsQ0FBQyxFQUFFLFlBQVksRUFBRSxDQUFDLEVBQUUsWUFBWSxFQUFFLENBQUMsRUFBRSxZQUFZLEVBQUU7WUFDNUQsT0FBTyxFQUFFLEVBQUUsQ0FBQyxFQUFFLGdCQUFnQixFQUFFLENBQUMsRUFBRSxnQkFBZ0IsRUFBRSxDQUFDLEVBQUUsaUJBQWlCLEVBQUU7WUFDM0UsT0FBTyxFQUFFLEVBQUUsQ0FBQyxFQUFFLGFBQWEsRUFBRSxDQUFDLEVBQUUsYUFBYSxFQUFFLENBQUMsRUFBRSxhQUFhLEVBQUU7WUFDakUsU0FBUyxFQUFFLEVBQUUsQ0FBQyxFQUFFLFdBQVcsRUFBRSxDQUFDLEVBQUUsV0FBVyxFQUFFLENBQUMsRUFBRSxXQUFXLEVBQUU7WUFDN0QsYUFBYSxFQUFFLEVBQUUsQ0FBQyxFQUFFLFlBQVksRUFBRSxDQUFDLEVBQUUsWUFBWSxFQUFFLENBQUMsRUFBRSxhQUFhLEVBQUU7WUFDckUsV0FBVyxFQUFFLEVBQUUsQ0FBQyxFQUFFLGdCQUFnQixFQUFFLENBQUMsRUFBRSxnQkFBZ0IsRUFBRSxDQUFDLEVBQUUsZ0JBQWdCLEVBQUU7WUFDOUUsVUFBVSxFQUFFLEVBQUUsQ0FBQyxFQUFFLGFBQWEsRUFBRSxD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QVMsRUFBRSxPQUFPLEVBQUUsYUFBYSxFQUFFLEVBQUMsUUFBUSxFQUFFLENBQUMsRUFBRSxPQUFPLEVBQUUsQ0FBQyxFQUFFLGFBQWEsRUFBRSxDQUFDLEVBQUUsUUFBUSxFQUFFLENBQUMsQ0FBQyxFQUFDLEVBQUU7SUFDM0gsT0FBTyxFQUFFLEVBQUUsT0FBTyxFQUFFLE9BQU8sRUFBRSxTQUFTLEVBQUUsT0FBTyxFQUFFLGFBQWEsRUFBRSxFQUFDLE9BQU8sRUFBRSxDQUFDLEVBQUUsUUFBUSxFQUFFLENBQUMsRUFBRSxRQUFRLEVBQUUsQ0FBQyxFQUFFLE9BQU8sRUFBRSxDQUFDLENBQUMsRUFBRSxTQUFTLEVBQUUsQ0FBQyxDQUFDLEVBQUUsT0FBTyxFQUFFLENBQUMsQ0FBQyxFQUFDLEVBQUU7SUFDakosTUFBTSxFQUFFLEVBQUUsT0FBTyxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsT0FBTyxFQUFFLGFBQWEsRUFBRSxFQUFDLE9BQU8sRUFBRSxDQUFDLEVBQUUsU0FBUyxFQUFFLENBQUMsRUFBRSxXQUFXLEVBQUUsQ0FBQyxFQUFFLFFBQVEsRUFBRSxDQUFDLENBQUMsRUFBRSxPQUFPLEVBQUUsQ0FBQyxDQUFDLEVBQUUsUUFBUSxFQUFFLENBQUMsQ0FBQyxFQUFDLEVBQUU7SUFDbkosU0FBUyxFQUFFLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxTQUFTLEVBQUUsTUFBTSxFQUFFLGFBQWEsRUFBRSxFQUFDLFFBQVEsRUFBRSxDQUFDLEVBQUUsYUFBYSxFQUFFLENBQUMsRUFBRSxRQUFRLEVBQUUsQ0FBQyxFQUFFLFFBQVEsRUFBRSxDQUFDLENBQUMsRUFBRSxPQUFPLEVBQUUsQ0FBQyxDQUFDLEVBQUUsV0FBVyxFQUFFLENBQUMsQ0FBQyxFQUFDLEVBQUU7SUFDekosUUFBUSxFQUFFLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxTQUFTLEVBQUUsT0FBTyxFQUFFLGFBQWEsRUFBRSxFQUFDLFVBQVUsRUFBRSxDQUFDLEVBQUUsV0FBVyxFQUFFLENBQUMsRUFBRSxPQUFPLEVBQUUsQ0FB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QUFFLFdBQVcsRUFBRSxDQUFDLE9BQU8sQ0FBQyxFQUFFLFdBQVcsRUFBRSxDQUFDLFNBQVMsRUFBRSxPQUFPLENBQUMsRUFBRSxXQUFXLEVBQUUsQ0FBQyxTQUFTLEVBQUUsTUFBTSxDQUFDLEVBQUU7UUFDN0csYUFBYSxFQUFFLEVBQUUsU0FBUyxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLE9BQU8sRUFBRSxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxNQUFNLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsU0FBUyxFQUFFLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxFQUFFLFFBQVEsRUFBRSxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRTtLQUNsSDtJQUNELEtBQUssRUFBRTtRQUNMLE9BQU8sRUFBRSxNQUFNO1FBQ2YsWUFBWSxFQUFFLEVBQUUsV0FBVyxFQUFFLENBQUMsUUFBUSxDQUFDLEVBQUUsV0FBVyxFQUFFLENBQUMsU0FBUyxDQUFDLEVBQUUsV0FBVyxFQUFFLENBQUMsTUFBTSxDQUFDLEVBQUU7UUFDMUYsYUFBYSxFQUFFLEVBQUUsU0FBUyxFQUFFLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxFQUFFLE9BQU8sRUFBRSxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsU0FBUyxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLFFBQVEsRUFBRSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsRUFBRTtLQUNsSDtJQUNELE9BQU8sRUFBRTtRQUNQLE9BQU8sRUFBRSxPQUFPO1FBQ2hCLFlBQVksRUFBRSxFQUFFLFdBQVcsRUFBRSxDQUFDLE1BQU0sRUFBRSxLQUFLLENBQUMsRUFBRSxXQUFXLEVBQUUsQ0FBQyxPQUFPLENBQUMsRUFBRSxXQUFXLEVBQUUsQ0FBQyxTQUFTLENBQUMsRUFBRTtRQUNoRyxhQUFhLEVBQUUsRUFBRSxTQUFTLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsT0FBTyxFQUFFLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxFQUFFLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxTQUFTLEVBQUUsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsUUFBUSxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFO0tBQ2xIO0lBQ0QsT0FBTyxFQUFFO1FBQ1AsT0FBTyxFQUFFLEtBQUs7UUFDZCxZQUFZLEVBQUUsRUFBRSxXQUFXLEVBQUUsQ0FBQyxNQUFNLENBQUMsRUFBRSxXQUFXLEVBQUUsQ0FBQyxRQUFRLEVBQUUsUUFBUSxDQUFDLEVBQUUsV0FBVyxFQUFFLENBQUMsU0FBUyxDQUFDLEVBQUU7UUFDcEcsYUFBYSxFQUFFLEVBQUUsU0FBUyxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLE9BQU8sRUFBRSxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUMsRUFBRSxNQUFNLEVBQUUsRUFBRSxFQUFFLFNBQVMsRUFBRSxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxRQUFRLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUU7S0FDNUc7SUFDRCxTQUFTLEVBQUU7UUFDVCxPQUFPLEVBQUUsT0FBTztRQUNoQixZQUFZLEVBQUUsRUFBRSxXQUFXLEVBQUUsQ0FBQyxPQUFPLENBQUMsRUFBRSxXQUFXLEVBQUUsQ0FBQyxTQUFTLEVBQUUsS0FBSyxDQUFDLEVBQUUsV0FBVyxFQUFFLENBQUMsT0FBTyxDQUFDLEVBQUU7UUFDakcsYUFBYSxFQUFFLEVBQUUsU0FBUyxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsQ0FBQyxFQUFFLE9BQU8sRUFBRSxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsRUFBRSxNQUFNLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLEVBQUUsU0FBUyxFQUFFLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxFQUFFLFFBQVEs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QUFVLHVCQUFWLFVBQVUsQ0FBYSxtQkFBbUIsMENBQUUsYUFBYSwwQ0FBRSxRQUFRLENBQUMsV0FBVyxDQUFDLENBQUEsRUFBRTt3QkFDcEcsSUFBSSxDQUFDLElBQUksQ0FBQyxnQ0FBZ0MsTUFBTSxDQUFDLE9BQU8sUUFBUSxNQUFNLENBQUMsT0FBTyxpQ0FBa0MsVUFBc0MsYUFBdEMsVUFBVSx1QkFBVixVQUFVLENBQThCLElBQUksR0FBRyxDQUFDLENBQUM7cUJBQ2xLO2lCQUNGO2FBQ0Y7U0FDRjtLQUNGO0lBRUQsMkNBQTJDO0lBQzNDLElBQUksTUFBQyxVQUFzQyxhQUF0QyxVQUFVLHVCQUFWLFVBQVUsQ0FBOEIsbUJBQW1CLDBDQUFFLGFBQWEsRUFBRTtRQUMvRSxNQUFNLGFBQWEsR0FBSSxVQUFzQyxhQUF0QyxVQUFVLHVCQUFWLFVBQVUsQ0FBOEIsbUJBQW1CLENBQUMsYUFBYSxDQUFDO1FBQ2pHLElBQUksYUFBYSxDQUFDLFFBQVEsQ0FBQyxZQUFZLENBQUMsRUFBRTtZQUN4QyxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUksVUFBc0MsYUFBdEMsVUFBVSx1QkFBVixVQUFVLENBQThCLElBQUksZ0RBQWdELFlBQVksR0FBRyxDQUFDLENBQUM7U0FDNUg7UUFDRCxJQUFJLGFBQWEsQ0FBQyxRQUFRLENBQUMsYUFBYSxDQUFDLEVBQUU7WUFDekMsSUFBSSxDQUFDLElBQUksQ0FBQyx3Q0FBeUMsVUFBc0MsYUFBdEMsVUFBVSx1QkFBVixVQUFVLENBQThCLElBQUksV0FBVyxhQUFhLGVBQWUsQ0FBQyxDQUFDO1NBQ3pJO0tBQ0Y7SUFFRCxPQUFPLElBQUksQ0FBQztBQUNkLENBQUM7QUFPRCx3QkFBd0I7QUFFeEIsd0JBQXdCO0FBQ3hCLHdCQUF3QiIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvR3JlZ0Nhc3Ryby9EZXNrdG9wL1doYXRUb0VhdE5leHQvc3JjL3V0aWxzL2luZ3JlZGllbnRSZWNvbW1lbmRlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBCYXNlIGluZ3JlZGllbnQgaW50ZXJmYWNlIGZvciBzYWZlIHR5cGUgYWNjZXNzXG5pbnRlcmZhY2UgQmFzZUluZ3JlZGllbnQge1xuICBuYW1lPzogc3RyaW5nO1xuICB0eXBlPzogc3RyaW5nO1xuICBjYXRlZ29yeT86IHN0cmluZztcbiAgZWxlbWVudGFsUHJvcGVydGllcz86IEVsZW1lbnRhbFByb3BlcnRpZXM7XG4gIGFzdHJvbG9naWNhbFByb2ZpbGU/OiB7XG4gICAgcnVsaW5nUGxhbmV0cz86IHN0cmluZ1tdO1xuICAgIHNpZ25BZmZpbml0aWVzPzogc3RyaW5nW107XG4gIH07XG4gIFtrZXk6IHN0cmluZ106IHVua25vd247IC8vIEZvciBkeW5hbWljIHByb3BlcnRpZXNcbn1cblxuLy8gRW5oYW5jZWQgSW5ncmVkaWVudCBpbnRlcmZhY2UgZm9yIFBoYXNlIDExXG5pbnRlcmZhY2UgRW5oYW5jZWRJbmdyZWRpZW50IHtcbiAgbmFtZTogc3RyaW5nO1xuICB0eXBlOiBzdHJpbmc7XG4gIGVsZW1lbnRhbFByb3BlcnRpZXM/OiBFbGVtZW50YWxQcm9wZXJ0aWVzO1xuICBhc3Ryb2xvZ2ljYWxJbmZsdWVuY2VzPzogQXN0cm9sb2dpY2FsSW5mbHVlbmNlcztcbiAgZWxlbWVudGFsU3RhdGU/OiBFbGVtZW50YWxTdGF0ZTtcbiAgc2Vhc29uPzogU2Vhc29uO1xuICByZWdpb25hbEN1aXNpbmU/OiBzdHJpbmc7XG4gIGFzdHJvbG9naWNhbFByb2ZpbGU/OiB7XG4gICAgcnVsaW5nUGxhbmV0cz86IHN0cmluZ1tdO1xuICAgIHNpZ25BZmZpbml0aWVzPzogc3RyaW5nW107XG4gIH07XG4gIC8vIEFkZCBjb21tb25seSBtaXNzaW5nIHByb3BlcnRpZXNcbiAgZmxhdm9yUHJvZmlsZT86IFJlY29yZDxzdHJpbmcsIG51bWJlcj47XG4gIGN1aXNpbmU/OiBzdHJpbmc7XG4gIGRlc2NyaXB0aW9uPzogc3RyaW5nO1xuICBjYXRlZ29yeT86IHN0cmluZztcbiAgcXVhbGl0aWVzPzogc3RyaW5nW107XG4gIG1lYWxUeXBlPzogc3RyaW5nO1xuICBtYXRjaFNjb3JlPzogbnVtYmVyO1xuICB0aW1pbmc/OiB1bmtub3duO1xuICBkdXJhdGlvbj86IHVua25vd247XG59XG5pbXBvcnQgeyBBc3Ryb2xvZ2ljYWxTdGF0ZSB9IGZyb20gJ0AvdHlwZXMnO1xuaW1wb3J0IHsgRWxlbWVudGFsUHJvcGVydGllcywgQ2hha3JhRW5lcmdpZXMsIFNlYXNvbiwgWm9kaWFjU2lnbiB9IGZyb20gJ0AvdHlwZXMvYWxjaGVteSc7XG5pbXBvcnQgeyBFbGVtZW50YWxTdGF0ZSB9IGZyb20gJ0AvdHlwZXMvZWxlbWVudGFsJztcbmltcG9ydCB0eXBlIHsgTW9kYWxpdHksIEluZ3JlZGllbnQgfSBmcm9tICdAL2RhdGEvaW5ncmVkaWVudHMvdHlwZXMnO1xuXG4vLyBBc3Ryb2xvZ2ljYWxJbmZsdWVuY2VzIGludGVyZmFjZVxuZXhwb3J0IGludGVyZmFjZSBBc3Ryb2xvZ2ljYWxJbmZsdWVuY2VzIHtcbiAgcnVsaW5nUGxhbmV0cz86IHN0cmluZ1tdO1xuICBmYXZvcmFibGVab2RpYWM/OiBzdHJpbmdbXTtcbiAgZWxlbWVudGFsQWZmaW5pdHk/OiBzdHJpbmc7XG4gIGx1bmFyUGhhc2VNb2RpZmllcnM/OiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPjtcbiAgYXNwZWN0RW5oYW5jZXJzPzogc3RyaW5nW107XG59XG5cbi8vIEltcG9ydCBhY3R1YWwgaW5ncmVkaWVudCBkYXRhXG5pbXBvcnQgeyB2ZWdldGFibGVzIH0gZnJvbSAnQC9kYXRhL2luZ3JlZGllbnRzL3ZlZ2V0YWJsZXMnO1xuaW1wb3J0IHsgZnJ1aXRzIH0gZnJvbSAnQC9kYXRhL2luZ3JlZGllbnRzL2ZydWl0cyc7XG5pbXBvcnQgeyBoZXJicyB9IGZyb20gJ0AvZGF0YS9pbmdyZWRpZW50cy9oZXJicyc7XG5pbXBvcnQgeyBzcGljZXMgfSBmcm9tICdAL2RhdGEvaW5ncmVkaWVudHMvc3BpY2VzJztcbmltcG9ydCB7IHByb3RlaW5zIH0gZnJvbSAnQC9kYXRhL2luZ3JlZGllbnRzL3Byb3RlaW5zJztcbmltcG9ydCB7IGdyYWlucyB9IGZyb20gJ0AvZGF0YS9pbmdyZWRpZW50cy9ncmFpbnMnO1xuaW1wb3J0IHsgc2Vhc29uaW5ncyB9IGZyb20gJ0AvZGF0YS9pbmdyZWRpZW50cy9zZWFzb25pbmdzJztcbmltcG9ydCB7IG9pbHMgfSBmcm9tICdAL2RhdGEvaW5ncmVkaWVudHMvb2lscyc7XG5cbi8vIEltcG9ydCBwbGFuZXQgZGF0YVxuaW1wb3J0IHZlbnVzRGF0YSBmcm9tICdAL2RhdGEvcGxhbmV0cy92ZW51cyc7XG5pbXBvcnQgbWFyc0RhdGEgZnJvbSAnQC9kYXRhL3BsYW5ldHMvbWFycyc7XG5pbXBvcnQgbWVyY3VyeURhdGEgZnJvbSAnQC9kYXRhL3BsYW5ldHMvbWVyY3VyeSc7XG5pbXBvcnQganVwaXRlckRhdGEgZnJvbSAnQC9kYXRhL3BsYW5ldHMvanVwaXRlcic7XG5pbXBvcnQgc2F0dXJuRGF0YSBmcm9tICdAL2RhdGEvcGxhbmV0cy9zYXR1cm4nO1xuXG5pbXBvcnQgeyBDSEFLUkFfTlVUUklUSU9OQUxfQ09SUkVMQVRJT05TLCBDSEFLUkFfSEVSQlMgfSBmcm9tICdAL2NvbnN0YW50cy9jaGFrcmFTeW1ib2xzJztcbmltcG9ydCB7IExVTkFSX1BIQVNFUyB9IGZyb20gJ0AvY29uc3RhbnRzL2x1bmFyJztcbmltcG9ydCB7IGluZ3JlZGllbnRDYXRlZ29yaWVzIH0gZnJvbSAnQC9kYXRhL2luZ3JlZGllbnRDYXRlZ29yaWVzJztcbmltcG9ydCB7IGNhbGN1bGF0ZUx1bmFyUGhhc2UsIGNhbGN1bGF0ZVBsYW5ldGFyeVBvc2l0aW9ucyB9IGZyb20gJ0AvdXRpbHMvYXN0cm9sb2d5VXRpbHMnO1xuXG4vLyBJbXBvcnQgdGhlIGdldEFsbEluZ3JlZGllbnRzIGZ1bmN0aW9uIGlmIGl0IGV4aXN0cywgb3RoZXJ3aXNlIHdlJ2xsIGNyZWF0ZSBvdXIgb3duXG5pbXBvcnQgeyBnZXRBbGxJbmdyZWRpZW50cyBhcyBnZXRJbmdyZWRpZW50c1V0aWwgfSBmcm9tICdAL3V0aWxzL2Zvb2RSZWNvbW1lbmRlcic7XG5cbi8vIEV4cG9ydCB0aGUgbmVjZXNzYXJ5IHR5cGVzIG5lZWRlZCBieSBJbmdyZWRpZW50UmVjb21tZW5kYXRpb25zLnRzXG5leHBvcnQgaW50ZXJmYWNlIEluZ3JlZGllbnRSZWNvbW1lbmRhdGlvbiB7XG4gIG5hbWU6IHN0cmluZztcbiAgdHlwZTogc3RyaW5nO1xuICBjYXRlZ29yeT86IHN0cmluZztcbiAgZWxlbWVudGFsUHJvcGVydGllcz86IEVsZW1lbnRhbFByb3BlcnRpZXM7XG4gIHF1YWxpdGllcz86IHN0cmluZ1tdO1xuICBtYXRjaFNjb3JlOiBudW1iZXI7XG4gIG1vZGFsaXR5PzogTW9kYWxpdHk7XG4gIHJlY29tbWVuZGF0aW9ucz86IHN0cmluZ1tdO1xuICBkZXNjcmlwdGlvbj86IHN0cmluZztcbiAgdG90YWxTY29yZT86IG51bWJlcjtcbiAgZWxlbWVudGFsU2NvcmU/OiBudW1iZXI7XG4gIGFzdHJvbG9naWNhbFNjb3JlPzogbnVtYmVyO1xuICBzZWFzb25hbFNjb3JlPzogbnVtYmVyO1xuICBkaWV0YXJ5Pzogc3RyaW5nW107XG4gIC8vIEFkZCBjb21tb25seSBtaXNzaW5nIHByb3BlcnRpZXNcbiAgZmxhdm9yUHJvZmlsZT86IFJlY29yZDxzdHJpbmcsIG51bWJlcj47XG4gIGN1aXNpbmU/OiBzdHJpbmc7XG4gIHJlZ2lvbmFsQ3Vpc2luZT86IHN0cmluZztcbiAgYXN0cm9sb2dpY2FsUHJvZmlsZT86IGFueTtcbiAgYXN0cm9sb2dpY2FsSW5mbHVlbmNlcz86IGFueTtcbiAgc2Vhc29uPzogYW55O1xuICBtZWFsVHlwZT86IHN0cmluZztcbiAgdGltaW5nPzogYW55O1xuICBkdXJhdGlvbj86IGFueTtcbiAgaXNSZXRyb2dyYWRlPzogYm9vbGVhbjtcbiAgc2Vuc29yeVByb2ZpbGU/OiB7XG4gICAgdGFzdGU6IFJlY29yZDxzdHJpbmcsIG51bWJlcj47XG4gICAgYXJvbWE6IFJlY29yZDxzdHJpbmcsIG51bWJlcj47XG4gICAgdGV4dHVyZTogUmVjb3JkPHN0cmluZywgbnVtYmVyPjtcbiAgfTtcbiAgcmVjb21tZW5kZWRDb29raW5nTWV0aG9kcz86IEFycmF5PHtcbiAgICBuYW1lOiBzdHJpbmc7XG4gICAgZGVzY3JpcHRpb246IHN0cmluZztcbiAgICBjb29raW5nVGltZToge1xuICAgICAgbWluOiBudW1iZXI7XG4gICAgICBtYXg6IG51bWJlcjtcbiAgICAgIHVuaXQ6IHN0cmluZztcbiAgICB9O1xuICAgIGVsZW1lbnRhbEVmZmVjdDogUmVjb3JkPHN0cmluZywgbnVtYmVyPjtcbiAgfT47XG4gIHBhaXJpbmdSZWNvbW1lbmRhdGlvbnM/OiB7XG4gICAgY29tcGxlbWVudGFyeTogc3RyaW5nW107XG4gICAgY29udHJhc3Rpbmc6IHN0cmluZ1tdO1xuICB9O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEdyb3VwZWRJbmdyZWRpZW50UmVjb21tZW5kYXRpb25zIHtcbiAgdmVnZXRhYmxlcz86IEluZ3JlZGllbnRSZWNvbW1lbmRhdGlvbltdO1xuICBmcnVpdHM/OiBJbmdyZWRpZW50UmVjb21tZW5kYXRpb25bXTtcbiAgcHJvdGVpbnM/OiBJbmdyZWRpZW50UmVjb21tZW5kYXRpb25bXTtcbiAgZ3JhaW5zPzogSW5ncmVkaWVudFJlY29tbWVuZGF0aW9uW107XG4gIHNwaWNlcz86IEluZ3JlZGllbnRSZWNvbW1lbmRhdGlvbltdO1xuICBoZXJicz86IEluZ3JlZGllbnRSZWNvbW1lbmRhdGlvbltdO1xuICBba2V5OiBzdHJpbmddOiBJbmdyZWRpZW50UmVjb21tZW5kYXRpb25bXSB8IHVuZGVmaW5lZDtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBSZWNvbW1lbmRhdGlvbk9wdGlvbnMge1xuICBjdXJyZW50U2Vhc29uPzogc3RyaW5nO1xuICBkaWV0YXJ5UHJlZmVyZW5jZXM/OiBzdHJpbmdbXTtcbiAgbW9kYWxpdHlQcmVmZXJlbmNlPzogTW9kYWxpdHk7XG4gIGN1cnJlbnRab2RpYWM/OiBzdHJpbmc7XG4gIGxpbWl0PzogbnVtYmVyO1xuICBleGNsdWRlSW5ncmVkaWVudHM/OiBzdHJpbmdbXTtcbiAgaW5jbHVkZU9ubHk/OiBzdHJpbmdbXTtcbiAgY2F0ZWdvcnk/OiBzdHJpbmc7XG59XG5cbi8vIENvbWJpbmUgYWxsIHJlYWwgaW5ncmVkaWVudHMgZGF0YVxuY29uc3QgYWxsSW5ncmVkaWVudHMgPSBbXG4gIC4uLk9iamVjdC52YWx1ZXModmVnZXRhYmxlcyB8fCB7fSksXG4gIC4uLk9iamVjdC52YWx1ZXMoZnJ1aXRzIHx8IHt9KSxcbiAgLi4uT2JqZWN0LnZhbHVlcyhoZXJicyB8fCB7fSksXG4gIC4uLk9iamVjdC52YWx1ZXMoc3BpY2VzIHx8IHt9KSxcbiAgLi4uT2JqZWN0LnZhbHVlcyhwcm90ZWlucyB8fCB7fSksXG4gIC4uLk9iamVjdC52YWx1ZXMoZ3JhaW5zIHx8IHt9KSxcbiAgLi4uT2JqZWN0LnZhbHVlcyhzZWFzb25pbmdzIHx8IHt9KSxcbiAgLi4uT2JqZWN0LnZhbHVlcyhvaWxzIHx8IHt9KVxuXS5maWx0ZXIoQm9vbGVhbik7XG5cbi8vIEZhbGxiYWNrIGltcGxlbWVudGF0aW9uIG9mIGdldEFsbEluZ3JlZGllbnRzIHRoYXQgdXNlcyBpbmdyZWRpZW50Q2F0ZWdvcmllc1xuZnVuY3Rpb24gZ2V0QWxsSW5ncmVkaWVudHMoKTogSW5ncmVkaWVudFtdIHtcbiAgLy8gSWYgdGhlIGltcG9ydGVkIGZ1bmN0aW9uIGV4aXN0cywgdXNlIGl0XG4gIGlmICh0eXBlb2YgZ2V0SW5ncmVkaWVudHNVdGlsID09PSAnZnVuY3Rpb24nKSB7XG4gICAgLy8gQXBwbHkgUGF0dGVybiBLOiBTYWZlIHVua25vd24tZmlyc3QgY2FzdGluZyBmb3IgdHlwZSBjb21wYXRpYmlsaXR5XG4gICAgcmV0dXJuIGdldEluZ3JlZGllbnRzVXRpbCgpIGFzIHVua25vd24gYXMgSW5ncmVkaWVudFtdO1xuICB9XG4gIFxuICAvLyBPdGhlcndpc2UsIHVzZSBvdXIgZmFsbGJhY2sgaW1wbGVtZW50YXRpb25cbiAgY29uc3QgYWxsSW5ncmVkaWVudHM6IEluZ3JlZGllbnRbXSA9IFtdO1xuICBcbiAgLy8gUHJvY2VzcyBlYWNoIGNhdGVnb3J5IGluIGluZ3JlZGllbnRDYXRlZ29yaWVzXG4gIE9iamVjdC5lbnRyaWVzKGluZ3JlZGllbnRDYXRlZ29yaWVzKS5mb3JFYWNoKChbY2F0ZWdvcnksIGluZ3JlZGllbnRzTWFwXSkgPT4ge1xuICAgIE9iamVjdC5lbnRyaWVzKGluZ3JlZGllbnRzTWFwKS5mb3JFYWNoKChbbmFtZSwgZGF0YV0pID0+IHtcbiAgICAgIGNvbnN0IGluZ3JlZGllbnREYXRhID0gZGF0YSBhcyB1bmtub3duIGFzIEJhc2VJbmdyZWRpZW50O1xuICAgICAgYWxsSW5ncmVkaWVudHMucHVzaCh7XG4gICAgICAgIG5hbWUsXG4gICAgICAgIHR5cGU6IGNhdGVnb3J5LmVuZHNXaXRoKCdzJykgPyBjYXRlZ29yeS5zbGljZSgwLCAtMSkgOiBjYXRlZ29yeSxcbiAgICAgICAgY2F0ZWdvcnksXG4gICAgICAgIGVsZW1lbnRhbFByb3BlcnRpZXM6IGluZ3JlZGllbnREYXRhLmVsZW1lbnRhbFByb3BlcnRpZXMsXG4gICAgICAgIGFzdHJvbG9naWNhbFByb2ZpbGU6IGluZ3JlZGllbnREYXRhLmFzdHJvbG9naWNhbFByb2ZpbGUsXG4gICAgICAgIC4uLmluZ3JlZGllbnREYXRhXG4gICAgICB9IGFzIHVua25vd24gYXMgSW5ncmVkaWVudCk7XG4gICAgfSk7XG4gIH0pO1xuICBcbiAgcmV0dXJuIGFsbEluZ3JlZGllbnRzO1xufVxuXG4vKipcbiAqIFJldHVybnMgYSBsaXN0IG9mIGluZ3JlZGllbnRzIHRoYXQgbWF0Y2ggdGhlIGN1cnJlbnQgYXN0cm9sb2dpY2FsIHN0YXRlXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRSZWNvbW1lbmRlZEluZ3JlZGllbnRzKGFzdHJvU3RhdGU6IEFzdHJvbG9naWNhbFN0YXRlKTogRW5oYW5jZWRJbmdyZWRpZW50W10ge1xuICAvLyBHZXQgdGhlIGFjdGl2ZSBwbGFuZXRzIGZyb20gdGhlIGFzdHJvbG9naWNhbCBzdGF0ZVxuICBjb25zdCBhY3RpdmVQbGFuZXRzID0gYXN0cm9TdGF0ZS5hY3RpdmVQbGFuZXRzIHx8IFtdO1xuICBcbiAgLy8gSWYgd2UgZG9uJ3QgaGF2ZSBhbnkgYWN0aXZlIHBsYW5ldHMsIHVzZSBhbGwgcGxhbmV0cyBieSBkZWZhdWx0XG4gIGNvbnN0IHBsYW5ldHNUb1VzZSA9IGFjdGl2ZVBsYW5ldHMubGVuZ3RoID4gMCBcbiAgICA/IGFjdGl2ZVBsYW5ldHMgXG4gICAgOiBbJ1N1bicsICdNb29uJywgJ01lcmN1cnknLCAnVmVudXMnLCAnTWFycycsICdKdXBpdGVyJywgJ1NhdHVybicsICdVcmFudXMnLCAnTmVwdHVuZScsICdQbHV0byddO1xuICBcbiAgLy8gRmlsdGVyIGluZ3JlZGllbnRzIGJhc2VkIG9uIG1hdGNoaW5nIHBsYW5ldGFyeSBydWxlcnNcbiAgLy8gQXBwbHkgUGF0dGVybiBLOiBTYWZlIHVua25vd24tZmlyc3QgY2FzdGluZyBmb3IgbWl4ZWQgaW5ncmVkaWVudCBhcnJheVxuICBsZXQgZmlsdGVyZWRJbmdyZWRpZW50cyA9IChhbGxJbmdyZWRpZW50cyBhcyB1bmtub3duIGFzIEVuaGFuY2VkSW5ncmVkaWVudFtdKS5maWx0ZXIoaW5ncmVkaWVudCA9PiB7XG4gICAgLy8gQ2hlY2sgaWYgYW55IG9mIHRoZSBpbmdyZWRpZW50J3MgcnVsaW5nIHBsYW5ldHMgYXJlIGFjdGl2ZVxuICAgIGNvbnN0IGJhc2VJbmdyZWRpZW50ID0gaW5ncmVkaWVudCBhcyB1bmtub3duIGFzIEJhc2VJbmdyZWRpZW50O1xuICAgIHJldHVybiBiYXNlSW5ncmVkaWVudD8uYXN0cm9sb2dpY2FsUHJvZmlsZT8ucnVsaW5nUGxhbmV0cz8uc29tZShcbiAgICAgIHBsYW5ldCA9PiBwbGFuZXRzVG9Vc2UuaW5jbHVkZXMocGxhbmV0KVxuICAgICk7XG4gIH0pO1xuICBcbiAgLy8gSWYgbm8gbWF0Y2hpbmcgaW5ncmVkaWVudHMsIHJldHVybiBhIHNhbXBsZSBvZiBhbGwgaW5ncmVkaWVudHNcbiAgaWYgKGZpbHRlcmVkSW5ncmVkaWVudHMubGVuZ3RoID09PSAwKSB7XG4gICAgZmlsdGVyZWRJbmdyZWRpZW50cyA9IChhbGxJbmdyZWRpZW50cyBhcyB1bmtub3duIGFzIEVuaGFuY2VkSW5ncmVkaWVudFtdKS5zbGljZSgwLCAyMCk7XG4gIH1cbiAgXG4gIC8vIFNwZWNpYWwgaGFuZGxpbmcgZm9yIFZlbnVzIGluZmx1ZW5jZSB3aGVuIHByZXNlbnRcbiAgaWYgKHBsYW5ldHNUb1VzZS5pbmNsdWRlcygnVmVudXMnKSkge1xuICAgIC8vIEFwcGx5IFBhdHRlcm4gSzogU2FmZSBhcnJheSB0eXBlIGNhc3RpbmcgZm9yIGZ1bmN0aW9uIHBhcmFtZXRlciBjb21wYXRpYmlsaXR5XG4gICAgLy8gUHJpb3JpdGl6ZSBWZW51cy1ydWxlZCBpbmdyZWRpZW50cyB3aXRoIGltcHJvdmVkIHNjb3JpbmcgYmFzZWQgb24gZGV0YWlsZWQgVmVudXMgZGF0YVxuICAgIGVuaGFuY2VWZW51c0luZ3JlZGllbnRCYXRjaChmaWx0ZXJlZEluZ3JlZGllbnRzIGFzIHVua25vd24gYXMgSW5ncmVkaWVudFtdLCBhc3Ryb1N0YXRlKTtcbiAgfVxuICBcbiAgLy8gU3BlY2lhbCBoYW5kbGluZyBmb3IgTWFycyBpbmZsdWVuY2Ugd2hlbiBwcmVzZW50XG4gIGlmIChwbGFuZXRzVG9Vc2UuaW5jbHVkZXMoJ01hcnMnKSkge1xuICAgIC8vIEFwcGx5IFBhdHRlcm4gSzogU2FmZSBhcnJheSB0eXBlIGNhc3RpbmcgZm9yIGZ1bmN0aW9uIHBhcmFtZXRlciBjb21wYXRpYmlsaXR5XG4gICAgLy8gUHJpb3JpdGl6ZSBNYXJzLXJ1bGVkIGluZ3JlZGllbnRzIHdpdGggaW1wcm92ZWQgc2NvcmluZyBiYXNlZCBvbiBkZXRhaWxlZCBNYXJzIGRhdGFcbiAgICBlbmhhbmNlTWFyc0luZ3JlZGllbnRTY29yaW5nKGZpbHRlcmVkSW5ncmVkaWVudHMgYXMgdW5rbm93biBhcyBJbmdyZWRpZW50W10sIGFzdHJvU3RhdGUpO1xuICB9XG4gIFxuICAvLyBTcGVjaWFsIGhhbmRsaW5nIGZvciBNZXJjdXJ5IGluZmx1ZW5jZSB3aGVuIHByZXNlbnRcbiAgaWYgKHBsYW5ldHNUb1VzZS5pbmNsdWRlcygnTWVyY3VyeScpKSB7XG4gICAgLy8gQXBwbHkgUGF0dGVybiBLOiBTYWZlIGFycmF5IHR5cGUgY2FzdGluZyBmb3IgZnVuY3Rpb24gcGFyYW1ldGVyIGNvbXBhdGliaWxpdHlcbiAgICAvLyBQcmlvcml0aXplIE1lcmN1cnktcnVsZWQgaW5ncmVkaWVudHMgd2l0aCBpbXByb3ZlZCBzY29yaW5nIGJhc2VkIG9uIGRldGFpbGVkIE1lcmN1cnkgZGF0YVxuICAgIGVuaGFuY2VNZXJjdXJ5SW5ncmVkaWVudFNjb3JpbmcoZmlsdGVyZWRJbmdyZWRpZW50cyBhcyB1bmtub3duIGFzIEluZ3JlZGllbnRbXSwgYXN0cm9TdGF0ZSk7XG4gIH1cbiAgXG4gIC8vIElmIHdlIGhhdmUgYSBkb21pbmFudCBlbGVtZW50IGZyb20gdGhlIGFzdHJvIHN0YXRlLCBwcmlvcml0aXplIGluZ3JlZGllbnRzIG9mIHRoYXQgZWxlbWVudFxuICBpZiAoYXN0cm9TdGF0ZS5kb21pbmFudEVsZW1lbnQpIHtcbiAgICBmaWx0ZXJlZEluZ3JlZGllbnRzLnNvcnQoKGEsIGIpID0+IHtcbiAgICAgIGNvbnN0IGluZ3JlZGllbnRBID0gYSBhcyB1bmtub3duIGFzIEJhc2VJbmdyZWRpZW50O1xuICAgICAgY29uc3QgaW5ncmVkaWVudEIgPSBiIGFzIHVua25vd24gYXMgQmFzZUluZ3JlZGllbnQ7XG4gICAgICBjb25zdCBhVmFsdWUgPSBpbmdyZWRpZW50QT8uZWxlbWVudGFsUHJvcGVydGllcz8uW2FzdHJvU3RhdGUuZG9taW5hbnRFbGVtZW50IGFzIGtleW9mIEVsZW1lbnRhbFByb3BlcnRpZXNdIHx8IDA7XG4gICAgICBjb25zdCBiVmFsdWUgPSBpbmdyZWRpZW50Qj8uZWxlbWVudGFsUHJvcGVydGllcz8uW2FzdHJvU3RhdGUuZG9taW5hbnRFbGVtZW50IGFzIGtleW9mIEVsZW1lbnRhbFByb3BlcnRpZXNdIHx8IDA7XG4gICAgICByZXR1cm4gYlZhbHVlIC0gYVZhbHVlO1xuICAgIH0pO1xuICB9XG4gIFxuICAvLyBJZiB3ZSBoYXZlIGEgY3VycmVudCB6b2RpYWMgc2lnbiwgcHJpb3JpdGl6ZSBpbmdyZWRpZW50cyB3aXRoIHRoYXQgYWZmaW5pdHlcbiAgaWYgKGFzdHJvU3RhdGUuem9kaWFjU2lnbikge1xuICAgIGNvbnN0IHpvZGlhY1NpZ24gPSBhc3Ryb1N0YXRlLnpvZGlhY1NpZ24udG9Mb3dlckNhc2UoKTtcbiAgICBcbiAgICAvLyBBcHBseSBWZW51cydzIHpvZGlhYyB0cmFuc2l0IGRhdGEgaWYgVmVudXMgaXMgYWN0aXZlIGFuZCBpbiB0aGlzIHNpZ25cbiAgICBjb25zdCB2ZW51c0Jvb3N0ID0gcGxhbmV0c1RvVXNlLmluY2x1ZGVzKCdWZW51cycpICYmIFxuICAgICAgICB2ZW51c0RhdGEuUGxhbmV0U3BlY2lmaWM/LlpvZGlhY1RyYW5zaXQ/Llthc3Ryb1N0YXRlLnpvZGlhY1NpZ25dID8gMiA6IDA7XG4gICAgXG4gICAgLy8gQXBwbHkgTWFycydzIHpvZGlhYyB0cmFuc2l0IGRhdGEgaWYgTWFycyBpcyBhY3RpdmUgYW5kIGluIHRoaXMgc2lnblxuICAgIGNvbnN0IG1hcnNCb29zdCA9IHBsYW5ldHNUb1VzZS5pbmNsdWRlcygnTWFycycpICYmIFxuICAgICAgICBtYXJzRGF0YS5QbGFuZXRTcGVjaWZpYz8uWm9kaWFjVHJhbnNpdD8uW2FzdHJvU3RhdGUuem9kaWFjU2lnbl0gPyAyIDogMDtcbiAgICBcbiAgICAvLyBBcHBseSBNZXJjdXJ5J3Mgem9kaWFjIHRyYW5zaXQgZGF0YSBpZiBNZXJjdXJ5IGlzIGFjdGl2ZSBhbmQgaW4gdGhpcyBzaWduXG4gICAgY29uc3QgbWVyY3VyeUJvb3N0ID0gcGxhbmV0c1RvVXNlLmluY2x1ZGVzKCdNZXJjdXJ5JykgJiYgXG4gICAgICAgIG1lcmN1cnlEYXRhLlBsYW5ldFNwZWNpZmljPy5ab2RpYWNUcmFuc2l0Py5bYXN0cm9TdGF0ZS56b2RpYWNTaWduXSA/IDIgOiAwO1xuICAgIFxuICAgIGZpbHRlcmVkSW5ncmVkaWVudHMuc29ydCgoYSwgYikgPT4ge1xuICAgICAgY29uc3QgaW5ncmVkaWVudEEgPSBhIGFzIHVua25vd24gYXMgQmFzZUluZ3JlZGllbnQ7XG4gICAgICBjb25zdCBpbmdyZWRpZW50QiA9IGIgYXMgdW5rbm93biBhcyBCYXNlSW5ncmVkaWVudDtcbiAgICAgIFxuICAgICAgbGV0IGFIYXNBZmZpbml0eSA9IGluZ3JlZGllbnRBPy5hc3Ryb2xvZ2ljYWxQcm9maWxlPy5zaWduQWZmaW5pdGllcz8uaW5jbHVkZXMoem9kaWFjU2lnbikgPyAxIDogMDtcbiAgICAgIGxldCBiSGFzQWZmaW5pdHkgPSBpbmdyZWRpZW50Qj8uYXN0cm9sb2dpY2FsUHJvZmlsZT8uc2lnbkFmZmluaXRpZXM/LmluY2x1ZGVzKHpvZGlhY1NpZ24pID8gMSA6IDA7XG4gICAgICBcbiAgICAgIC8vIEJvb3N0IGluZ3JlZGllbnRzIHdpdGggVmVudXMgYXNzb2NpYXRpb25zIHdoZW4gVmVudXMgaXMgYWN0aXZlXG4gICAgICBpZiAocGxhbmV0c1RvVXNlLmluY2x1ZGVzKCdWZW51cycpKSB7XG4gICAgICAgIGlmIChpc1ZlbnVzQXNzb2NpYXRlZEluZ3JlZGllbnQoaW5ncmVkaWVudEE/Lm5hbWUgfHwgJycpKSBhSGFzQWZmaW5pdHkgKz0gdmVudXNCb29zdDtcbiAgICAgICAgaWYgKGlzVmVudXNBc3NvY2lhdGVkSW5ncmVkaWVudChpbmdyZWRpZW50Qj8ubmFtZSB8fCAnJykpIGJIYXNBZmZpbml0eSArPSB2ZW51c0Jvb3N0O1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBCb29zdCBpbmdyZWRpZW50cyB3aXRoIE1hcnMgYXNzb2NpYXRpb25zIHdoZW4gTWFycyBpcyBhY3RpdmVcbiAgICAgIGlmIChwbGFuZXRzVG9Vc2UuaW5jbHVkZXMoJ01hcnMnKSkge1xuICAgICAgICBpZiAoaXNNYXJzQXNzb2NpYXRlZEluZ3JlZGllbnQoaW5ncmVkaWVudEE/Lm5hbWUgfHwgJycpKSBhSGFzQWZmaW5pdHkgKz0gbWFyc0Jvb3N0O1xuICAgICAgICBpZiAoaXNNYXJzQXNzb2NpYXRlZEluZ3JlZGllbnQoaW5ncmVkaWVudEI/Lm5hbWUgfHwgJycpKSBiSGFzQWZmaW5pdHkgKz0gbWFyc0Jvb3N0O1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBCb29zdCBpbmdyZWRpZW50cyB3aXRoIE1lcmN1cnkgYXNzb2NpYXRpb25zIHdoZW4gTWVyY3VyeSBpcyBhY3RpdmVcbiAgICAgIGlmIChwbGFuZXRzVG9Vc2UuaW5jbHVkZXMoJ01lcmN1cnknKSkge1xuICAgICAgICBpZiAoaXNNZXJjdXJ5QXNzb2NpYXRlZEluZ3JlZGllbnQoaW5ncmVkaWVudEE/Lm5hbWUgfHwgJycpKSBhSGFzQWZmaW5pdHkgKz0gbWVyY3VyeUJvb3N0O1xuICAgICAgICBpZiAoaXNNZXJjdXJ5QXNzb2NpYXRlZEluZ3JlZGllbnQoaW5ncmVkaWVudEI/Lm5hbWUgfHwgJycpKSBiSGFzQWZmaW5pdHkgKz0gbWVyY3VyeUJvb3N0O1xuICAgICAgfVxuICAgICAgXG4gICAgICByZXR1cm4gYkhhc0FmZmluaXR5IC0gYUhhc0FmZmluaXR5O1xuICAgIH0pO1xuICB9XG4gIFxuICByZXR1cm4gZmlsdGVyZWRJbmdyZWRpZW50cyBhcyBFbmhhbmNlZEluZ3JlZGllbnRbXTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIHJlY29tbWVuZGF0aW9ucyBncm91cGVkIGJ5IGNhdGVnb3J5IGJhc2VkIG9uIGVsZW1lbnRhbCBwcm9wZXJ0aWVzIGFuZCBvcHRpb25zXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRJbmdyZWRpZW50UmVjb21tZW5kYXRpb25zKFxuICBlbGVtZW50YWxQcm9wczogRWxlbWVudGFsUHJvcGVydGllcyAmIHsgXG4gICAgdGltZXN0YW1wOiBEYXRlO1xuICAgIGN1cnJlbnRTdGFiaWxpdHk6IG51bWJlcjtcbiAgICBwbGFuZXRhcnlBbGlnbm1lbnQ6IFJlY29yZDxzdHJpbmcsIHsgc2lnbjogc3RyaW5nOyBkZWdyZWU6IG51bWJlciB9PjtcbiAgICB6b2RpYWNTaWduOiBzdHJpbmc7XG4gICAgYWN0aXZlUGxhbmV0czogc3RyaW5nW107XG4gICAgbHVuYXJQaGFzZTogc3RyaW5nO1xuICAgIGFzcGVjdHM6IEFycmF5PHsgYXNwZWN0VHlwZTogc3RyaW5nOyBwbGFuZXQxOiBzdHJpbmc7IHBsYW5ldDI6IHN0cmluZzsgfT47XG4gIH0sIFxuICBvcHRpb25zOiBSZWNvbW1lbmRhdGlvbk9wdGlvbnNcbik6IEdyb3VwZWRJbmdyZWRpZW50UmVjb21tZW5kYXRpb25zIHtcbiAgLy8gR2V0IGFsbCBpbmdyZWRpZW50c1xuICBjb25zdCBhbGxJbmdyZWRpZW50cyA9IGdldEFsbEluZ3JlZGllbnRzKCk7XG4gIFxuICAvLyBDYWxjdWxhdGUgcnVsaW5nIHBsYW5ldCBiYXNlZCBvbiBzdW4ncyBwb3NpdGlvblxuICBjb25zdCBzdW5TaWduID0gZWxlbWVudGFsUHJvcHMuem9kaWFjU2lnbj8udG9Mb3dlckNhc2UoKSBhcyBab2RpYWNTaWduO1xuICBcbiAgLy8gTWFwIG9mIHNpZ25zIHRvIHRoZWlyIHJ1bGluZyBwbGFuZXRzXG4gIGNvbnN0IHNpZ25SdWxlcnM6IFJlY29yZDxzdHJpbmcsIHN0cmluZz4gPSB7XG4gICAgJ2FyaWVzJzogJ01hcnMnLFxuICAgICd0YXVydXMnOiAnVmVudXMnLFxuICAgICdnZW1pbmknOiAnTWVyY3VyeScsXG4gICAgJ2NhbmNlcic6ICdNb29uJyxcbiAgICAnbGVvJzogJ1N1bicsXG4gICAgJ3ZpcmdvJzogJ01lcmN1cnknLFxuICAgICdsaWJyYSc6ICdWZW51cycsXG4gICAgJ3Njb3JwaW8nOiAnTWFycycsXG4gICAgJ3NhZ2l0dGFyaXVzJzogJ0p1cGl0ZXInLFxuICAgICdjYXByaWNvcm4nOiAnU2F0dXJuJyxcbiAgICAnYXF1YXJpdXMnOiAnU2F0dXJuJywgLy8gVHJhZGl0aW9uYWwgcnVsZXJcbiAgICAncGlzY2VzJzogJ0p1cGl0ZXInICAvLyBUcmFkaXRpb25hbCBydWxlclxuICB9O1xuICBcbiAgY29uc3QgcnVsaW5nUGxhbmV0ID0gc2lnblJ1bGVyc1tzdW5TaWduXSB8fCAnU3VuJztcbiAgXG4gIC8vIEdldCBkZWNhbiBpbmZvcm1hdGlvbiBmb3IgZWFjaCBwbGFuZXQgcG9zaXRpb25cbiAgY29uc3QgcGxhbmV0RGVjYW5zOiBSZWNvcmQ8c3RyaW5nLCB7IGRlY2FuTnVtOiBudW1iZXIsIGRlY2FuUnVsZXI6IHN0cmluZywgdGFyb3RDYXJkOiBzdHJpbmcgfT4gPSB7fTtcbiAgXG4gIE9iamVjdC5lbnRyaWVzKGVsZW1lbnRhbFByb3BzLnBsYW5ldGFyeUFsaWdubWVudCB8fCB7fSkuZm9yRWFjaCgoW3BsYW5ldCwgcG9zaXRpb25dKSA9PiB7XG4gICAgaWYgKCFwb3NpdGlvbiB8fCAhcG9zaXRpb24uc2lnbikgcmV0dXJuO1xuICAgIFxuICAgIGNvbnN0IHNpZ24gPSBwb3NpdGlvbi5zaWduLnRvTG93ZXJDYXNlKCk7XG4gICAgY29uc3QgZGVncmVlID0gcG9zaXRpb24uZGVncmVlIHx8IDA7XG4gICAgXG4gICAgLy8gRGV0ZXJtaW5lIHdoaWNoIGRlY2FuIHRoZSBwbGFuZXQgaXMgaW5cbiAgICBsZXQgZGVjYW5OdW0gPSAxO1xuICAgIGlmIChkZWdyZWUgPj0gMTAgJiYgZGVncmVlIDwgMjApIGRlY2FuTnVtID0gMjtcbiAgICBlbHNlIGlmIChkZWdyZWUgPj0gMjApIGRlY2FuTnVtID0gMztcbiAgICBcbiAgICAvLyBSZWZlcmVuY2UgZGF0YSBmb3IgZGVjYW4gcnVsZXJzIGFuZCB0YXJvdCBjYXJkcyBiYXNlZCBvbiBzaWduIGFuZCBkZWNhblxuICAgIGNvbnN0IGRlY2FuUnVsZXJNYXA6IFJlY29yZDxzdHJpbmcsIFJlY29yZDxudW1iZXIsIHN0cmluZz4+ID0ge1xuICAgICAgJ2FyaWVzJzogeyAxOiAnTWFycycsIDI6ICdTdW4nLCAzOiAnVmVudXMnIH0sXG4gICAgICAndGF1cnVzJzogeyAxOiAnTWVyY3VyeScsIDI6ICdNb29uJywgMzogJ1NhdHVybicgfSxcbiAgICAgICdnZW1pbmknOiB7IDE6ICdKdXBpdGVyJywgMjogJ01hcnMnLCAzOiAnU3VuJyB9LFxuICAgICAgJ2NhbmNlcic6IHsgMTogJ1ZlbnVzJywgMjogJ01lcmN1cnknLCAzOiAnTW9vbicgfSxcbiAgICAgICdsZW8nOiB7IDE6ICdTYXR1cm4nLCAyOiAnSnVwaXRlcicsIDM6ICdNYXJzJyB9LFxuICAgICAgJ3ZpcmdvJzogeyAxOiAnU3VuJywgMjogJ1ZlbnVzJywgMzogJ01lcmN1cnknIH0sXG4gICAgICAnbGlicmEnOiB7IDE6ICdNb29uJywgMjogJ1NhdHVybicsIDM6ICdKdXBpdGVyJyB9LFxuICAgICAgJ3Njb3JwaW8nOiB7IDE6ICdNYXJzJywgMjogJ1N1bicsIDM6ICdWZW51cycgfSxcbiAgICAgICdzYWdpdHRhcml1cyc6IHsgMTogJ01lcmN1cnknLCAyOiAnTW9vbicsIDM6ICdTYXR1cm4nIH0sXG4gICAgICAnY2Fwcmljb3JuJzogeyAxOiAnSnVwaXRlcicsIDI6ICdNYXJzJywgMzogJ1N1bicgfSxcbiAgICAgICdhcXVhcml1cyc6IHsgMTogJ1ZlbnVzJywgMjogJ01lcmN1cnknLCAzOiAnTW9vbicgfSxcbiAgICAgICdwaXNjZXMnOiB7IDE6ICdTYXR1cm4nLCAyOiAnSnVwaXRlcicsIDM6ICdNYXJzJyB9XG4gICAgfTtcbiAgICBcbiAgICBjb25zdCB0YXJvdENhcmRNYXA6IFJlY29yZDxzdHJpbmcsIFJlY29yZDxudW1iZXIsIHN0cmluZz4+ID0ge1xuICAgICAgJ2FyaWVzJzogeyAxOiAnMiBvZiBXYW5kcycsIDI6ICczIG9mIFdhbmRzJywgMzogJzQgb2YgV2FuZHMnIH0sXG4gICAgICAndGF1cnVzJzogeyAxOiAnNSBvZiBQZW50YWNsZXMnLCAyOiAnNiBvZiBQZW50YWNsZXMnLCAzOiAnNyBvZiBQZW50YWNsZXMnIH0sXG4gICAgICAnZ2VtaW5pJzogeyAxOiAnOCBvZiBTd29yZHMnLCAyOiAnOSBvZiBTd29yZHMnLCAzOiAnMTAgb2YgU3dvcmRzJyB9LFxuICAgICAgJ2NhbmNlcic6IHsgMTogJzIgb2YgQ3VwcycsIDI6ICczIG9mIEN1cHMnLCAzOiAnNCBvZiBDdXBzJyB9LFxuICAgICAgJ2xlbyc6IHsgMTogJzUgb2YgV2FuZHMnLCAyOiAnNiBvZiBXYW5kcycsIDM6ICc3IG9mIFdhbmRzJyB9LFxuICAgICAgJ3ZpcmdvJzogeyAxOiAnOCBvZiBQZW50YWNsZXMnLCAyOiAnOSBvZiBQZW50YWNsZXMnLCAzOiAnMTAgb2YgUGVudGFjbGVzJyB9LFxuICAgICAgJ2xpYnJhJzogeyAxOiAnMiBvZiBTd29yZHMnLCAyOiAnMyBvZiBTd29yZHMnLCAzOiAnNCBvZiBTd29yZHMnIH0sXG4gICAgICAnc2NvcnBpbyc6IHsgMTogJzUgb2YgQ3VwcycsIDI6ICc2IG9mIEN1cHMnLCAzOiAnNyBvZiBDdXBzJyB9LFxuICAgICAgJ3NhZ2l0dGFyaXVzJzogeyAxOiAnOCBvZiBXYW5kcycsIDI6ICc5IG9mIFdhbmRzJywgMzogJzEwIG9mIFdhbmRzJyB9LFxuICAgICAgJ2NhcHJpY29ybic6IHsgMTogJzIgb2YgUGVudGFjbGVzJywgMjogJzMgb2YgUGVudGFjbGVzJywgMzogJzQgb2YgUGVudGFjbGVzJyB9LFxuICAgICAgJ2FxdWFyaXVzJzogeyAxOiAnNSBvZiBTd29yZHMnLCAyOiAnNiBvZiBTd29yZHMnLCAzOiAnNyBvZiBTd29yZHMnIH0sXG4gICAgICAncGlzY2VzJzogeyAxOiAnOCBvZiBDdXBzJywgMjogJzkgb2YgQ3VwcycsIDM6ICcxMCBvZiBDdXBzJyB9XG4gICAgfTtcbiAgICBcbiAgICBjb25zdCBkZWNhblJ1bGVyID0gZGVjYW5SdWxlck1hcFtzaWduXT8uW2RlY2FuTnVtXSB8fCAnJztcbiAgICBjb25zdCB0YXJvdENhcmQgPSB0YXJvdENhcmRNYXBbc2lnbl0/LltkZWNhbk51bV0gfHwgJyc7XG4gICAgXG4gICAgcGxhbmV0RGVjYW5zW3BsYW5ldF0gPSB7IGRlY2FuTnVtLCBkZWNhblJ1bGVyLCB0YXJvdENhcmQgfTtcbiAgfSk7XG4gIFxuICAvLyBGaWx0ZXIgYW5kIHNjb3JlIGluZ3JlZGllbnRzXG4gIGNvbnN0IHNjb3JlZEluZ3JlZGllbnRzID0gYWxsSW5ncmVkaWVudHNcbiAgICAuZmlsdGVyKGluZ3JlZGllbnQgPT4ge1xuICAgICAgLy8gQXBwbHkgYmFzaWMgZmlsdGVyc1xuICAgICAgaWYgKG9wdGlvbnMuZXhjbHVkZUluZ3JlZGllbnRzPy5pbmNsdWRlcygoaW5ncmVkaWVudCBhcyBzdHJpbmcpPy5uYW1lKSkgcmV0dXJuIGZhbHNlO1xuICAgICAgaWYgKG9wdGlvbnMuaW5jbHVkZU9ubHkgJiYgIW9wdGlvbnMuaW5jbHVkZU9ubHkuaW5jbHVkZXMoKGluZ3JlZGllbnQgYXMgc3RyaW5nKT8ubmFtZSkpIHJldHVybiBmYWxzZTtcbiAgICAgIGlmIChvcHRpb25zLmNhdGVnb3J5ICYmIGluZ3JlZGllbnQuY2F0ZWdvcnkgIT09IG9wdGlvbnMuY2F0ZWdvcnkpIHJldHVybiBmYWxzZTtcbiAgICAgIFxuICAgICAgLy8gRmlsdGVyIGJ5IGRpZXRhcnkgcHJlZmVyZW5jZSBpZiBzcGVjaWZpZWRcbiAgICAgIGlmIChvcHRpb25zLmRpZXRhcnlQcmVmZXJlbmNlcyAmJiBvcHRpb25zLmRpZXRhcnlQcmVmZXJlbmNlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGNvbnN0IGRpZXRhcnlNYXRjaGVzID0gb3B0aW9ucy5kaWV0YXJ5UHJlZmVyZW5jZXMuc29tZShwcmVmID0+IFxuICAgICAgICAgIGluZ3JlZGllbnQuZGlldGFyeT8uaW5jbHVkZXMocHJlZilcbiAgICAgICAgKTtcbiAgICAgICAgaWYgKCFkaWV0YXJ5TWF0Y2hlcykgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBGaWx0ZXIgYnkgbW9kYWxpdHkgcHJlZmVyZW5jZSBpZiBzcGVjaWZpZWRcbiAgICAgIGlmIChvcHRpb25zLm1vZGFsaXR5UHJlZmVyZW5jZSkge1xuICAgICAgICBjb25zdCBpbmdyZWRpZW50TW9kYWxpdHkgPSBpbmdyZWRpZW50Lm1vZGFsaXR5IHx8IFxuICAgICAgICAgIGRldGVybWluZUluZ3JlZGllbnRNb2RhbGl0eShpbmdyZWRpZW50LnF1YWxpdGllcywgKGluZ3JlZGllbnQgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pPy5lbGVtZW50YWxQcm9wZXJ0aWVzKTtcbiAgICAgICAgXG4gICAgICAgIGlmIChpbmdyZWRpZW50TW9kYWxpdHkgIT09IG9wdGlvbnMubW9kYWxpdHlQcmVmZXJlbmNlKSByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICBcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0pXG4gICAgLm1hcChpbmdyZWRpZW50ID0+IHtcbiAgICAgIC8vIENhbGN1bGF0ZSBlbGVtZW50YWwgc2NvcmUgKDMwJSBvZiB0b3RhbClcbiAgICAgIGNvbnN0IGVsZW1lbnRhbFNjb3JlID0gY2FsY3VsYXRlRWxlbWVudGFsU2NvcmUoXG4gICAgICAgIChpbmdyZWRpZW50IGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KT8uZWxlbWVudGFsUHJvcGVydGllcyxcbiAgICAgICAgZWxlbWVudGFsUHJvcHNcbiAgICAgICk7XG4gICAgICBcbiAgICAgIC8vIENhbGN1bGF0ZSBtb2RhbGl0eSBzY29yZSAoMTUlIG9mIHRvdGFsKVxuICAgICAgY29uc3QgbW9kYWxpdHlTY29yZSA9IGNhbGN1bGF0ZU1vZGFsaXR5U2NvcmUoXG4gICAgICAgIGluZ3JlZGllbnQucXVhbGl0aWVzIHx8IFtdLFxuICAgICAgICBvcHRpb25zLm1vZGFsaXR5UHJlZmVyZW5jZVxuICAgICAgKTtcbiAgICAgIFxuICAgICAgLy8gQ2FsY3VsYXRlIHNlYXNvbmFsIHNjb3JlICgxNSUgb2YgdG90YWwpXG4gICAgICBjb25zdCBzZWFzb25hbFNjb3JlID0gY2FsY3VsYXRlU2Vhc29uYWxTY29yZShcbiAgICAgICAgaW5ncmVkaWVudCxcbiAgICAgICAgZWxlbWVudGFsUHJvcHMudGltZXN0YW1wXG4gICAgICApO1xuICAgICAgXG4gICAgICAvLyBDYWxjdWxhdGUgcGxhbmV0YXJ5IHNjb3JlICg0MCUgb2YgdG90YWwpIC0gaW5jcmVhc2VkIHdlaWdodCBmb3IgcGxhbmV0YXJ5IGFsaWdubWVudFxuICAgICAgY29uc3QgcGxhbmV0YXJ5U2NvcmUgPSBjYWxjdWxhdGVFbmhhbmNlZFBsYW5ldGFyeVNjb3JlKFxuICAgICAgICBpbmdyZWRpZW50LCBcbiAgICAgICAgZWxlbWVudGFsUHJvcHMucGxhbmV0YXJ5QWxpZ25tZW50LFxuICAgICAgICBwbGFuZXREZWNhbnMsXG4gICAgICAgIHJ1bGluZ1BsYW5ldFxuICAgICAgKTtcbiAgICAgIFxuICAgICAgLy8gQ2FsY3VsYXRlIHRvdGFsIHNjb3JlIHdpdGggd2VpZ2h0ZWQgY29tcG9uZW50c1xuICAgICAgY29uc3QgdG90YWxTY29yZSA9IChcbiAgICAgICAgZWxlbWVudGFsU2NvcmUgKiAwLjMwICsgXG4gICAgICAgIG1vZGFsaXR5U2NvcmUgKiAwLjE1ICsgXG4gICAgICAgIHNlYXNvbmFsU2NvcmUgKiAwLjE1ICsgXG4gICAgICAgIHBsYW5ldGFyeVNjb3JlICogMC40MFxuICAgICAgKTtcbiAgICAgIFxuICAgICAgLy8gQXNzaWduIG1vZGFsaXR5IGlmIG5vdCBhbHJlYWR5IHByZXNlbnRcbiAgICAgIGNvbnN0IG1vZGFsaXR5ID0gaW5ncmVkaWVudC5tb2RhbGl0eSB8fCBcbiAgICAgICAgZGV0ZXJtaW5lSW5ncmVkaWVudE1vZGFsaXR5KGluZ3JlZGllbnQucXVhbGl0aWVzLCAoaW5ncmVkaWVudCBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPik/LmVsZW1lbnRhbFByb3BlcnRpZXMpO1xuICAgICAgXG4gICAgICByZXR1cm4ge1xuICAgICAgICAuLi5pbmdyZWRpZW50LFxuICAgICAgICBzY29yZTogdG90YWxTY29yZSxcbiAgICAgICAgZWxlbWVudGFsU2NvcmUsXG4gICAgICAgIG1vZGFsaXR5U2NvcmUsXG4gICAgICAgIHNlYXNvbmFsU2NvcmUsXG4gICAgICAgIHBsYW5ldGFyeVNjb3JlLFxuICAgICAgICBtb2RhbGl0eVxuICAgICAgfTtcbiAgICB9KVxuICAgIC5zb3J0KChhLCBiKSA9PiBiLnNjb3JlIC0gYS5zY29yZSk7XG4gIFxuICAvLyBHcm91cCBpbmdyZWRpZW50cyBieSBjYXRlZ29yeVxuICBjb25zdCBncm91cGVkUmVjb21tZW5kYXRpb25zOiBHcm91cGVkSW5ncmVkaWVudFJlY29tbWVuZGF0aW9ucyA9IHt9O1xuICBcbiAgLy8gQXBwbHkgbGltaXQgcGVyIGNhdGVnb3J5IGJlZm9yZSBncm91cGluZyB0byBlbnN1cmUgZGl2ZXJzaXR5XG4gIGNvbnN0IGxpbWl0ID0gb3B0aW9ucy5saW1pdCB8fCAyNDtcbiAgY29uc3QgY2F0ZWdvcnlDb3VudHM6IFJlY29yZDxzdHJpbmcsIG51bWJlcj4gPSB7fTtcbiAgY29uc3QgY2F0ZWdvcnlNYXhJdGVtcyA9IE1hdGguY2VpbChsaW1pdCAvIDgpOyAvLyBNYXggaXRlbXMgcGVyIGNhdGVnb3J5XG4gIFxuICBzY29yZWRJbmdyZWRpZW50cy5mb3JFYWNoKGluZ3JlZGllbnQgPT4ge1xuICAgIGNvbnN0IGNhdGVnb3J5ID0gaW5ncmVkaWVudC5jYXRlZ29yeSB8fCAnb3RoZXInO1xuICAgIFxuICAgIGlmICghZ3JvdXBlZFJlY29tbWVuZGF0aW9uc1tjYXRlZ29yeV0pIHtcbiAgICAgIGdyb3VwZWRSZWNvbW1lbmRhdGlvbnNbY2F0ZWdvcnldID0gW107XG4gICAgICBjYXRlZ29yeUNvdW50c1tjYXRlZ29yeV0gPSAwO1xuICAgIH1cbiAgICBcbiAgICBpZiAoY2F0ZWdvcnlDb3VudHNbY2F0ZWdvcnldIDwgY2F0ZWdvcnlNYXhJdGVtcykge1xuICAgICAgLy8gQXBwbHkgUGF0dGVybiBMOiBJbnRlcmZhY2UgcHJvcGVydHkgbWFwcGluZyBmb3IgSW5ncmVkaWVudFJlY29tbWVuZGF0aW9uIGNvbXBhdGliaWxpdHlcbiAgICAgIGNvbnN0IGluZ3JlZGllbnREYXRhID0gaW5ncmVkaWVudCBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPjtcbiAgICAgIGNvbnN0IGluZ3JlZGllbnRSZWNvbW1lbmRhdGlvbjogSW5ncmVkaWVudFJlY29tbWVuZGF0aW9uID0ge1xuICAgICAgICBuYW1lOiBpbmdyZWRpZW50Lm5hbWUgfHwgJycsXG4gICAgICAgIHR5cGU6IGluZ3JlZGllbnREYXRhPy50eXBlIHx8IGluZ3JlZGllbnREYXRhPy5jYXRlZ29yeSB8fCAnaW5ncmVkaWVudCcsXG4gICAgICAgIGNhdGVnb3J5OiBpbmdyZWRpZW50LmNhdGVnb3J5LFxuICAgICAgICBlbGVtZW50YWxQcm9wZXJ0aWVzOiBpbmdyZWRpZW50LmVsZW1lbnRhbFByb3BlcnRpZXMsXG4gICAgICAgIHF1YWxpdGllczogaW5ncmVkaWVudC5xdWFsaXRpZXMsXG4gICAgICAgIG1hdGNoU2NvcmU6IGluZ3JlZGllbnQuc2NvcmUgfHwgMCxcbiAgICAgICAgbW9kYWxpdHk6IGluZ3JlZGllbnQubW9kYWxpdHksXG4gICAgICAgIHJlY29tbWVuZGF0aW9uczogaW5ncmVkaWVudERhdGE/LnJlY29tbWVuZGF0aW9ucyB8fCBbXSxcbiAgICAgICAgZGVzY3JpcHRpb246IGluZ3JlZGllbnREYXRhPy5kZXNjcmlwdGlvbiB8fCBgUmVjb21tZW5kZWQgJHtpbmdyZWRpZW50Lm5hbWV9YCxcbiAgICAgICAgdG90YWxTY29yZTogaW5ncmVkaWVudERhdGE/LnRvdGFsU2NvcmUgfHwgaW5ncmVkaWVudC5zY29yZSB8fCAwLFxuICAgICAgICBlbGVtZW50YWxTY29yZTogaW5ncmVkaWVudC5lbGVtZW50YWxTY29yZSxcbiAgICAgICAgYXN0cm9sb2dpY2FsU2NvcmU6IGluZ3JlZGllbnREYXRhPy5hc3Ryb2xvZ2ljYWxTY29yZSB8fCAwLFxuICAgICAgICBzZWFzb25hbFNjb3JlOiBpbmdyZWRpZW50LnNlYXNvbmFsU2NvcmUsXG4gICAgICAgIGRpZXRhcnk6IGluZ3JlZGllbnREYXRhPy5kaWV0YXJ5IHx8IFtdXG4gICAgICB9O1xuICAgICAgZ3JvdXBlZFJlY29tbWVuZGF0aW9uc1tjYXRlZ29yeV0ucHVzaChpbmdyZWRpZW50UmVjb21tZW5kYXRpb24pO1xuICAgICAgY2F0ZWdvcnlDb3VudHNbY2F0ZWdvcnldKys7XG4gICAgfVxuICB9KTtcbiAgXG4gIHJldHVybiBncm91cGVkUmVjb21tZW5kYXRpb25zO1xufVxuXG4vLyBIZWxwZXIgZnVuY3Rpb24gdG8gY2FsY3VsYXRlIG1vZGFsaXR5IHNjb3JlXG5mdW5jdGlvbiBjYWxjdWxhdGVNb2RhbGl0eVNjb3JlKFxuICBxdWFsaXRpZXM6IHN0cmluZ1tdLFxuICBwcmVmZXJyZWRNb2RhbGl0eT86IE1vZGFsaXR5XG4pOiBudW1iZXIge1xuICAvLyBHZXQgdGhlIGluZ3JlZGllbnQncyBtb2RhbGl0eSBiYXNlZCBvbiBxdWFsaXRpZXNcbiAgY29uc3QgaW5ncmVkaWVudE1vZGFsaXR5ID0gZGV0ZXJtaW5lSW5ncmVkaWVudE1vZGFsaXR5KHF1YWxpdGllcyk7XG4gIFxuICAvLyBJZiBubyBwcmVmZXJyZWQgbW9kYWxpdHksIHJldHVybiBuZXV0cmFsIHNjb3JlXG4gIGlmICghcHJlZmVycmVkTW9kYWxpdHkpIHJldHVybiAwLjU7XG4gIFxuICAvLyBSZXR1cm4gMS4wIGZvciBleGFjdCBtYXRjaCwgMC41IGZvciBwYXJ0aWFsIG1hdGNoLCAwLjAgZm9yIG1pc21hdGNoXG4gIGlmIChpbmdyZWRpZW50TW9kYWxpdHkgPT09IHByZWZlcnJlZE1vZGFsaXR5KSByZXR1cm4gMS4wO1xuICBcbiAgLy8gQ29uc2lkZXIgcGFydGlhbCBtYXRjaGVzIGJhc2VkIG9uIG1vZGFsaXR5IGNvbXBhdGliaWxpdHlcbiAgY29uc3QgY29tcGF0aWJsZU1vZGFsaXRpZXMgPSB7XG4gICAgQ2FyZGluYWw6IFsnTXV0YWJsZSddLFxuICAgIEZpeGVkOiBbJ011dGFibGUnXSxcbiAgICBNdXRhYmxlOiBbJ0NhcmRpbmFsJywgJ0ZpeGVkJ11cbiAgfTtcbiAgXG4gIGlmIChjb21wYXRpYmxlTW9kYWxpdGllc1twcmVmZXJyZWRNb2RhbGl0eV0/LmluY2x1ZGVzKGluZ3JlZGllbnRNb2RhbGl0eSkpIHtcbiAgICByZXR1cm4gMC43O1xuICB9XG4gIFxuICByZXR1cm4gMC4zO1xufVxuXG4vKipcbiAqIENhbGN1bGF0ZSBlbGVtZW50YWwgc2NvcmUgYmV0d2VlbiBpbmdyZWRpZW50IGFuZCBzeXN0ZW0gZWxlbWVudGFsIHByb3BlcnRpZXNcbiAqIEVuaGFuY2VkIHRvIGdpdmUgbW9yZSB3ZWlnaHQgdG8gZG9taW5hbnQgZWxlbWVudHMgYW5kIGJldHRlciBzaW1pbGFyaXR5IGNhbGN1bGF0aW9uXG4gKi9cbmZ1bmN0aW9uIGNhbGN1bGF0ZUVsZW1lbnRhbFNjb3JlKFxuICBpbmdyZWRpZW50UHJvcHM/OiBFbGVtZW50YWxQcm9wZXJ0aWVzLFxuICBzeXN0ZW1Qcm9wcz86IEVsZW1lbnRhbFByb3BlcnRpZXNcbik6IG51bWJlciB7XG4gIC8vIFJldHVybiBuZXV0cmFsIHNjb3JlIGlmIGVpdGhlciBwcm9wZXJ0aWVzIGFyZSBtaXNzaW5nXG4gIGlmICghaW5ncmVkaWVudFByb3BzIHx8ICFzeXN0ZW1Qcm9wcykgcmV0dXJuIDAuNTtcbiAgXG4gIC8vIEZpbmQgZG9taW5hbnQgc3lzdGVtIGVsZW1lbnQgZm9yIGV4dHJhIHdlaWdodGluZ1xuICBjb25zdCBkb21pbmFudEVsZW1lbnQgPSBPYmplY3QuZW50cmllcyhzeXN0ZW1Qcm9wcylcbiAgICAuc29ydCgoYSwgYikgPT4gYlsxXSAtIGFbMV0pWzBdWzBdIGFzIGtleW9mIEVsZW1lbnRhbFByb3BlcnRpZXM7XG4gIFxuICAvLyBDYWxjdWxhdGUgc2ltaWxhcml0eSBiYXNlZCBvbiBvdmVybGFwIG9mIGVsZW1lbnRhbCBwcm9wZXJ0aWVzXG4gIGxldCBzaW1pbGFyaXR5U2NvcmUgPSAwO1xuICBsZXQgdG90YWxXZWlnaHQgPSAwO1xuICBcbiAgLy8gUHJvY2VzcyBlYWNoIGVsZW1lbnRcbiAgZm9yIChjb25zdCBlbGVtZW50IG9mIFsnRmlyZScsICdXYXRlcicsICdFYXJ0aCcsICdBaXInXSBhcyBjb25zdCkge1xuICAgIGNvbnN0IGluZ3JlZGllbnRWYWx1ZSA9IGluZ3JlZGllbnRQcm9wc1tlbGVtZW50XSB8fCAwO1xuICAgIGNvbnN0IHN5c3RlbVZhbHVlID0gc3lzdGVtUHJvcHNbZWxlbWVudF0gfHwgMDtcbiAgICBcbiAgICAvLyBDYWxjdWxhdGUgc2ltaWxhcml0eSAoMSAtIGFic29sdXRlIGRpZmZlcmVuY2UpXG4gICAgLy8gVGhpcyBnaXZlcyBoaWdoZXIgc2NvcmVzIHdoZW4gdmFsdWVzIGFyZSBjbG9zZXIgdG9nZXRoZXJcbiAgICBjb25zdCBzaW1pbGFyaXR5ID0gMSAtIE1hdGguYWJzKGluZ3JlZGllbnRWYWx1ZSAtIHN5c3RlbVZhbHVlKTtcbiAgICBcbiAgICAvLyBFbmhhbmNlZCB3ZWlnaHRpbmc6IGRvbWluYW50IGVsZW1lbnQgZ2V0cyBleHRyYSBlbXBoYXNpc1xuICAgIC8vIEJhc2Ugd2VpZ2h0IGluY2x1ZGVzIHRoZSBzeXN0ZW0ncyB2YWx1ZSBmb3IgdGhpcyBlbGVtZW50XG4gICAgY29uc3QgYmFzZVdlaWdodCA9IHN5c3RlbVZhbHVlICsgMC4yNTsgLy8gQWRkIDAuMjUgdG8gZW5zdXJlIGFsbCBlbGVtZW50cyBoYXZlIHNvbWUgd2VpZ2h0XG4gICAgXG4gICAgLy8gQXBwbHkgMS41eCBtdWx0aXBsaWVyIHRvIHRoZSBkb21pbmFudCBlbGVtZW50J3Mgd2VpZ2h0XG4gICAgY29uc3QgZmluYWxXZWlnaHQgPSBlbGVtZW50ID09PSBkb21pbmFudEVsZW1lbnQgPyBiYXNlV2VpZ2h0ICogMS41IDogYmFzZVdlaWdodDtcbiAgICBcbiAgICBzaW1pbGFyaXR5U2NvcmUgKz0gc2ltaWxhcml0eSAqIGZpbmFsV2VpZ2h0O1xuICAgIHRvdGFsV2VpZ2h0ICs9IGZpbmFsV2VpZ2h0O1xuICB9XG4gIFxuICAvLyBOb3JtYWxpemUgdG8gMC0xIHJhbmdlIHdpdGggZXhwbGljaXQgYm91bmRzXG4gIHJldHVybiB0b3RhbFdlaWdodCA+IDAgPyBNYXRoLm1pbigxLCBNYXRoLm1heCgwLCBzaW1pbGFyaXR5U2NvcmUgLyB0b3RhbFdlaWdodCkpIDogMC41O1xufVxuXG4vKipcbiAqIENhbGN1bGF0ZSBzZWFzb25hbCBzY29yZSBmb3IgYW4gaW5ncmVkaWVudCBiYXNlZCBvbiBjdXJyZW50IGRhdGVcbiAqIEBwYXJhbSBpbmdyZWRpZW50IEluZ3JlZGllbnQgdG8gc2NvcmVcbiAqIEBwYXJhbSBkYXRlIEN1cnJlbnQgZGF0ZVxuICogQHJldHVybnMgU2Vhc29uYWwgc2NvcmUgKDAtMSlcbiAqL1xuZnVuY3Rpb24gY2FsY3VsYXRlU2Vhc29uYWxTY29yZShpbmdyZWRpZW50OiBJbmdyZWRpZW50LCBkYXRlOiBEYXRlKTogbnVtYmVyIHtcbiAgLy8gRGVmYXVsdCBzY29yZSBpZiBubyBzZWFzb25hbGl0eSBkYXRhXG4gIGlmICghKGluZ3JlZGllbnQgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pPy5zZWFzb25hbGl0eSkgcmV0dXJuIDAuNTtcbiAgXG4gIC8vIEdldCBjdXJyZW50IG1vbnRoIGFuZCBjb252ZXJ0IHRvIHNlYXNvblxuICBjb25zdCBtb250aCA9IGRhdGUuZ2V0TW9udGgoKTsgLy8gMC0xMVxuICBsZXQgY3VycmVudFNlYXNvbjogc3RyaW5nO1xuICBcbiAgLy8gTm9ydGhlcm4gaGVtaXNwaGVyZSBzZWFzb25zXG4gIGlmIChtb250aCA+PSAyICYmIG1vbnRoIDw9IDQpIHtcbiAgICBjdXJyZW50U2Vhc29uID0gJ3NwcmluZyc7XG4gIH0gZWxzZSBpZiAobW9udGggPj0gNSAmJiBtb250aCA8PSA3KSB7XG4gICAgY3VycmVudFNlYXNvbiA9ICdzdW1tZXInO1xuICB9IGVsc2UgaWYgKG1vbnRoID49IDggJiYgbW9udGggPD0gMTApIHtcbiAgICBjdXJyZW50U2Vhc29uID0gJ2ZhbGwnO1xuICB9IGVsc2Uge1xuICAgIGN1cnJlbnRTZWFzb24gPSAnd2ludGVyJztcbiAgfVxuICBcbiAgLy8gR2V0IHNlYXNvbmFsaXR5IHNjb3JlIGZvciBjdXJyZW50IHNlYXNvblxuICBjb25zdCBzZWFzb25TY29yZSA9IChpbmdyZWRpZW50IGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KT8uc2Vhc29uYWxpdHlbY3VycmVudFNlYXNvbl0gfHwgMC41O1xuICBcbiAgcmV0dXJuIHNlYXNvblNjb3JlO1xufVxuXG4vKipcbiAqIEVuaGFuY2VkIHBsYW5ldGFyeSBzY29yZSBjYWxjdWxhdGlvbiB0aGF0IGNvbnNpZGVycyBkZWNhbnMgYW5kIHRhcm90IGFzc29jaWF0aW9ucyxcbiAqIHdpdGggc3BlY2lhbCB3ZWlnaHQgZm9yIHRoZSBydWxpbmcgcGxhbmV0IGRldGVybWluZWQgYnkgc3VuIHBvc2l0aW9uXG4gKi9cbmZ1bmN0aW9uIGNhbGN1bGF0ZUVuaGFuY2VkUGxhbmV0YXJ5U2NvcmUoXG4gIGluZ3JlZGllbnQ6IEluZ3JlZGllbnQsXG4gIHBsYW5ldGFyeUFsaWdubWVudDogUmVjb3JkPHN0cmluZywgeyBzaWduOiBzdHJpbmc7IGRlZ3JlZTogbnVtYmVyIH0+LFxuICBwbGFuZXREZWNhbnM6IFJlY29yZDxzdHJpbmcsIHsgZGVjYW5OdW06IG51bWJlciwgZGVjYW5SdWxlcjogc3RyaW5nLCB0YXJvdENhcmQ6IHN0cmluZyB9PixcbiAgcnVsaW5nUGxhbmV0OiBzdHJpbmdcbik6IG51bWJlciB7XG4gIGlmICghKGluZ3JlZGllbnQgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pPy5hc3Ryb2xvZ2ljYWxQcm9maWxlKSByZXR1cm4gMC41OyAvLyBOZXV0cmFsIHNjb3JlIGZvciBpbmdyZWRpZW50cyB3aXRob3V0IHByb2ZpbGVcbiAgXG4gIGxldCBzY29yZSA9IDA7XG4gIGxldCB0b3RhbEZhY3RvcnMgPSAwO1xuICBcbiAgLy8gQ2hlY2sgcnVsaW5nIHBsYW5ldCBjb3JyZXNwb25kZW5jZSAtIHRoaXMgZ2V0cyBleHRyYSB3ZWlnaHRcbiAgaWYgKChpbmdyZWRpZW50IGFzIHN0cmluZyk/LmFzdHJvbG9naWNhbFByb2ZpbGUucnVsaW5nUGxhbmV0cz8uaW5jbHVkZXMocnVsaW5nUGxhbmV0KSkge1xuICAgIHNjb3JlICs9IDEuNTsgLy8gU2lnbmlmaWNhbnQgYm9vc3QgZm9yIHJ1bGluZyBwbGFuZXQgY29ycmVzcG9uZGVuY2VcbiAgICB0b3RhbEZhY3RvcnMgKz0gMS41O1xuICB9XG4gIFxuICAvLyBDaGVjayBwbGFuZXRhcnkgcG9zaXRpb25zIGFnYWluc3QgaW5ncmVkaWVudCBhZmZpbml0aWVzXG4gIE9iamVjdC5lbnRyaWVzKHBsYW5ldGFyeUFsaWdubWVudCkuZm9yRWFjaCgoW3BsYW5ldCwgcG9zaXRpb25dKSA9PiB7XG4gICAgaWYgKCFwb3NpdGlvbi5zaWduKSByZXR1cm47XG4gICAgXG4gICAgY29uc3QgcGxhbmV0TmFtZSA9IHBsYW5ldC5jaGFyQXQoMCkudG9VcHBlckNhc2UoKSArIHBsYW5ldC5zbGljZSgxKTtcbiAgICBcbiAgICAvLyBSZWd1bGFyIHBsYW5ldGFyeSBydWxlciBzY29yaW5nXG4gICAgaWYgKChpbmdyZWRpZW50IGFzIHN0cmluZyk/LmFzdHJvbG9naWNhbFByb2ZpbGUucnVsaW5nUGxhbmV0cz8uaW5jbHVkZXMocGxhbmV0TmFtZSkpIHtcbiAgICAgIHNjb3JlICs9IDE7XG4gICAgICB0b3RhbEZhY3RvcnMgKz0gMTtcbiAgICB9XG4gICAgXG4gICAgLy8gQ2hlY2sgc2lnbiBhZmZpbml0aWVzIFxuICAgIGlmICgoaW5ncmVkaWVudCBhcyBzdHJpbmcpPy5hc3Ryb2xvZ2ljYWxQcm9maWxlLnNpZ25BZmZpbml0aWVzPy5pbmNsdWRlcyhwb3NpdGlvbi5zaWduLnRvTG93ZXJDYXNlKCkpKSB7XG4gICAgICBzY29yZSArPSAxO1xuICAgICAgdG90YWxGYWN0b3JzICs9IDE7XG4gICAgfVxuICAgIFxuICAgIC8vIFNwZWNpYWwgaGFuZGxpbmcgZm9yIGRlY2FuIHJ1bGVyc1xuICAgIGNvbnN0IGRlY2FuSW5mbyA9IHBsYW5ldERlY2Fuc1twbGFuZXRdO1xuICAgIGlmIChkZWNhbkluZm8gJiYgKGluZ3JlZGllbnQgYXMgc3RyaW5nKT8uYXN0cm9sb2dpY2FsUHJvZmlsZS5ydWxpbmdQbGFuZXRzPy5pbmNsdWRlcyhkZWNhbkluZm8uZGVjYW5SdWxlcikpIHtcbiAgICAgIHNjb3JlICs9IDAuODsgLy8gR29vZCBib251cyBmb3IgZGVjYW4gcnVsZXIgbWF0Y2hcbiAgICAgIHRvdGFsRmFjdG9ycyArPSAwLjg7XG4gICAgfVxuICAgIFxuICAgIC8vIFRhcm90IGNhcmQgYXNzb2NpYXRpb25zIC0gYWRkIHN1YnRsZSBpbmZsdWVuY2VcbiAgICBpZiAoZGVjYW5JbmZvPy50YXJvdENhcmQgJiYgKGluZ3JlZGllbnQgYXMgc3RyaW5nKT8uYXN0cm9sb2dpY2FsUHJvZmlsZS50YXJvdEFzc29jaWF0aW9ucz8uaW5jbHVkZXMoZGVjYW5JbmZvLnRhcm90Q2FyZCkpIHtcbiAgICAgIHNjb3JlICs9IDAuNztcbiAgICAgIHRvdGFsRmFjdG9ycyArPSAwLjc7XG4gICAgfVxuICB9KTtcbiAgXG4gIC8vIElmIHRoZXJlIGFyZSBubyBmYWN0b3JzIHRvIGNvbnNpZGVyLCByZXR1cm4gbmV1dHJhbCBzY29yZVxuICBpZiAodG90YWxGYWN0b3JzID09PSAwKSByZXR1cm4gMC41O1xuICBcbiAgLy8gUmV0dXJuIG5vcm1hbGl6ZWQgc2NvcmUgKDAtMSByYW5nZSlcbiAgcmV0dXJuIE1hdGgubWluKDEsIHNjb3JlIC8gKHRvdGFsRmFjdG9ycyArIDAuNSkpO1xufVxuXG4vKipcbiAqIENhbGN1bGF0ZSBwbGFuZXRhcnkgaW5mbHVlbmNlcyBiYXNlZCBvbiBwbGFuZXRhcnkgYWxpZ25tZW50XG4gKiBAcGFyYW0gcGxhbmV0YXJ5QWxpZ25tZW50IEN1cnJlbnQgcGxhbmV0YXJ5IHBvc2l0aW9uc1xuICogQHJldHVybnMgRWxlbWVudGFsIGluZmx1ZW5jZSB2YWx1ZXNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNhbGN1bGF0ZUVsZW1lbnRhbEluZmx1ZW5jZXMoXG4gIHBsYW5ldGFyeUFsaWdubWVudDogUmVjb3JkPHN0cmluZywgeyBzaWduOiBzdHJpbmc7IGRlZ3JlZTogbnVtYmVyIH0+XG4pOiBFbGVtZW50YWxQcm9wZXJ0aWVzIHtcbiAgLy8gRGVmaW5lIGVsZW1lbnRhbCBhZmZpbml0aWVzIGZvciBlYWNoIHpvZGlhYyBzaWduXG4gIGNvbnN0IHpvZGlhY0VsZW1lbnRzOiBSZWNvcmQ8c3RyaW5nLCBrZXlvZiBFbGVtZW50YWxQcm9wZXJ0aWVzPiA9IHtcbiAgICAnYXJpZXMnOiAnRmlyZScsXG4gICAgJ3RhdXJ1cyc6ICdFYXJ0aCcsXG4gICAgJ2dlbWluaSc6ICdBaXInLFxuICAgICdjYW5jZXInOiAnV2F0ZXInLFxuICAgICdsZW8nOiAnRmlyZScsXG4gICAgJ3ZpcmdvJzogJ0VhcnRoJyxcbiAgICAnbGlicmEnOiAnQWlyJyxcbiAgICAnc2NvcnBpbyc6ICdXYXRlcicsXG4gICAgJ3NhZ2l0dGFyaXVzJzogJ0ZpcmUnLFxuICAgICdjYXByaWNvcm4nOiAnRWFydGgnLFxuICAgICdhcXVhcml1cyc6ICdBaXInLFxuICAgICdwaXNjZXMnOiAnV2F0ZXInXG4gIH07XG5cbiAgLy8gRGVmaW5lIHBsYW5ldCB3ZWlnaHRzXG4gIGNvbnN0IHBsYW5ldFdlaWdodHM6IFJlY29yZDxzdHJpbmcsIG51bWJlcj4gPSB7XG4gICAgJ3N1bic6IDUsXG4gICAgJ21vb24nOiA0LFxuICAgICdtZXJjdXJ5JzogMyxcbiAgICAndmVudXMnOiAzLFxuICAgICdtYXJzJzogMyxcbiAgICAnanVwaXRlcic6IDIsXG4gICAgJ3NhdHVybic6IDIsXG4gICAgJ3VyYW51cyc6IDEsXG4gICAgJ25lcHR1bmUnOiAxLFxuICAgICdwbHV0byc6IDFcbiAgfTtcblxuICAvLyBJbml0aWFsaXplIGVsZW1lbnRhbCBpbmZsdWVuY2VzXG4gIGNvbnN0IGVsZW1lbnRhbEluZmx1ZW5jZXM6IEVsZW1lbnRhbFByb3BlcnRpZXMgPSB7XG4gICAgRmlyZTogMCxcbiAgICBFYXJ0aDogMCxcbiAgICBBaXI6IDAsXG4gICAgV2F0ZXI6IDBcbiAgfTtcblxuICAvLyBQcm9jZXNzIGVhY2ggcGxhbmV0YXJ5IHBvc2l0aW9uXG4gIE9iamVjdC5lbnRyaWVzKHBsYW5ldGFyeUFsaWdubWVudCkuZm9yRWFjaCgoW3BsYW5ldCwgcG9zaXRpb25dKSA9PiB7XG4gICAgY29uc3QgcGxhbmV0TG93ZXIgPSBwbGFuZXQudG9Mb3dlckNhc2UoKTtcbiAgICBjb25zdCB3ZWlnaHQgPSBwbGFuZXRXZWlnaHRzW3BsYW5ldExvd2VyXSB8fCAxO1xuICAgIGNvbnN0IHNpZ24gPSBwb3NpdGlvbi5zaWduLnRvTG93ZXJDYXNlKCk7XG4gICAgY29uc3QgZWxlbWVudCA9IHpvZGlhY0VsZW1lbnRzW3Bvc2l0aW9uLnNpZ25dIHx8IHpvZGlhY0VsZW1lbnRzW3NpZ25dO1xuXG4gICAgaWYgKGVsZW1lbnQpIHtcbiAgICAgIGVsZW1lbnRhbEluZmx1ZW5jZXNbZWxlbWVudF0gKz0gd2VpZ2h0O1xuICAgIH1cbiAgfSk7XG5cbiAgLy8gTm9ybWFsaXplIHZhbHVlcyB0byBzdW0gdG8gMVxuICBjb25zdCB0b3RhbCA9IE9iamVjdC52YWx1ZXMoZWxlbWVudGFsSW5mbHVlbmNlcykucmVkdWNlKChzdW0sIHZhbCkgPT4gc3VtICsgdmFsLCAwKTtcbiAgaWYgKHRvdGFsID4gMCkge1xuICAgIE9iamVjdC5rZXlzKGVsZW1lbnRhbEluZmx1ZW5jZXMpLmZvckVhY2goZWxlbWVudCA9PiB7XG4gICAgICBlbGVtZW50YWxJbmZsdWVuY2VzW2VsZW1lbnQgYXMga2V5b2YgRWxlbWVudGFsUHJvcGVydGllc10gPSBcbiAgICAgICAgZWxlbWVudGFsSW5mbHVlbmNlc1tlbGVtZW50IGFzIGtleW9mIEVsZW1lbnRhbFByb3BlcnRpZXNdIC8gdG90YWw7XG4gICAgfSk7XG4gIH1cblxuICByZXR1cm4gZWxlbWVudGFsSW5mbHVlbmNlcztcbn1cblxuLyoqXG4gKiBHZXQgaW5ncmVkaWVudCByZWNvbW1lbmRhdGlvbnMgYmFzZWQgb24gY2hha3JhIGVuZXJnaWVzXG4gKiBAcGFyYW0gY2hha3JhRW5lcmdpZXMgQ3VycmVudCBjaGFrcmEgZW5lcmd5IGxldmVsc1xuICogQHBhcmFtIGxpbWl0IE1heGltdW0gbnVtYmVyIG9mIHJlY29tbWVuZGF0aW9ucyBwZXIgY2hha3JhXG4gKiBAcmV0dXJucyBHcm91cGVkIGluZ3JlZGllbnQgcmVjb21tZW5kYXRpb25zIGJhc2VkIG9uIGNoYWtyYSBpbmZsdWVuY2VzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRDaGFrcmFCYXNlZFJlY29tbWVuZGF0aW9ucyhcbiAgY2hha3JhRW5lcmdpZXM6IENoYWtyYUVuZXJnaWVzLFxuICBsaW1pdCA9IDNcbik6IEdyb3VwZWRJbmdyZWRpZW50UmVjb21tZW5kYXRpb25zIHtcbiAgLy8gRmluZCB0aGUgZG9taW5hbnQgY2hha3JhcyAoaGlnaGVzdCBlbmVyZ3kgbGV2ZWxzKVxuICBjb25zdCBjaGFrcmFFbnRyaWVzID0gT2JqZWN0LmVudHJpZXMoY2hha3JhRW5lcmdpZXMpO1xuICBcbiAgLy8gU29ydCBjaGFrcmFzIGJ5IGVuZXJneSBsZXZlbCAoaGlnaGVzdCBmaXJzdClcbiAgY29uc3Qgc29ydGVkQ2hha3JhcyA9IGNoYWtyYUVudHJpZXMuc29ydCgoWywgZW5lcmd5QV0sIFssIGVuZXJneUJdKSA9PiBlbmVyZ3lCIC0gZW5lcmd5QSk7XG4gIFxuICAvLyBUYWtlIG9ubHkgY2hha3JhcyB3aXRoIHNpZ25pZmljYW50IGVuZXJneSAoPiAwKVxuICBjb25zdCBzaWduaWZpY2FudENoYWtyYXMgPSBzb3J0ZWRDaGFrcmFzLmZpbHRlcigoWywgZW5lcmd5XSkgPT4gZW5lcmd5ID4gMCk7XG4gIFxuICAvLyBQcmVwYXJlIHRoZSByZXN1bHQgb2JqZWN0XG4gIGNvbnN0IHJlc3VsdDogR3JvdXBlZEluZ3JlZGllbnRSZWNvbW1lbmRhdGlvbnMgPSB7fTtcbiAgXG4gIC8vIEZvciBlYWNoIHNpZ25pZmljYW50IGNoYWtyYSwgYWRkIGNvcnJlc3BvbmRpbmcgcmVjb21tZW5kZWQgaW5ncmVkaWVudHNcbiAgc2lnbmlmaWNhbnRDaGFrcmFzLmZvckVhY2goKFtjaGFrcmEsIGVuZXJneV0pID0+IHtcbiAgICAvLyBHZXQgbnV0cml0aW9uYWwgY29ycmVsYXRpb25zIGZvciB0aGlzIGNoYWtyYVxuICAgIGNvbnN0IG51dHJpdGlvbmFsQ29ycmVsYXRpb25zID0gQ0hBS1JBX05VVFJJVElPTkFMX0NPUlJFTEFUSU9OU1tjaGFrcmFdIHx8IFtdO1xuICAgIGNvbnN0IGhlcmJSZWNvbW1lbmRhdGlvbnMgPSBDSEFLUkFfSEVSQlNbY2hha3JhXSB8fCBbXTtcbiAgICBcbiAgICAvLyBGaW5kIGluZ3JlZGllbnRzIHRoYXQgbWF0Y2ggdGhlc2UgY29ycmVsYXRpb25zXG4gICAgY29uc3QgbWF0Y2hpbmdJbmdyZWRpZW50cyA9IGFsbEluZ3JlZGllbnRzLmZpbHRlcihpbmdyZWRpZW50ID0+IHtcbiAgICAgIC8vIENoZWNrIGlmIGluZ3JlZGllbnQgbmFtZSBvciB0eXBlIG1hdGNoZXMgYW55IG51dHJpdGlvbmFsIGNvcnJlbGF0aW9uXG4gICAgICBjb25zdCBtYXRjaGVzTnV0cml0aW9uYWwgPSBudXRyaXRpb25hbENvcnJlbGF0aW9ucy5zb21lKGNvcnJlbGF0aW9uID0+IFxuICAgICAgICAoaW5ncmVkaWVudCBhcyBzdHJpbmcpPy5uYW1lLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoY29ycmVsYXRpb24udG9Mb3dlckNhc2UoKSkgfHwgXG4gICAgICAgICgoaW5ncmVkaWVudCBhcyBzdHJpbmcpPy50eXBlID8gKGluZ3JlZGllbnQgYXMgc3RyaW5nKS50eXBlLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoY29ycmVsYXRpb24udG9Mb3dlckNhc2UoKSkgOiBmYWxzZSlcbiAgICAgICk7XG4gICAgICBcbiAgICAgIC8vIENoZWNrIGlmIGluZ3JlZGllbnQgbmFtZSBtYXRjaGVzIGFueSBoZXJiIHJlY29tbWVuZGF0aW9uXG4gICAgICBjb25zdCBtYXRjaGVzSGVyYiA9IGhlcmJSZWNvbW1lbmRhdGlvbnMuc29tZShoZXJiID0+IFxuICAgICAgICAoaW5ncmVkaWVudCBhcyBzdHJpbmcpPy5uYW1lLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoaGVyYi50b0xvd2VyQ2FzZSgpKVxuICAgICAgKTtcbiAgICAgIFxuICAgICAgcmV0dXJuIG1hdGNoZXNOdXRyaXRpb25hbCB8fCBtYXRjaGVzSGVyYjtcbiAgICB9KTtcbiAgICBcbiAgICAvLyBBZGQgbWF0Y2hpbmcgaW5ncmVkaWVudHMgdG8gdGhlIHJlc3VsdCwgd2l0aCBhIHNjb3JlIGJhc2VkIG9uIGNoYWtyYSBlbmVyZ3lcbiAgICBtYXRjaGluZ0luZ3JlZGllbnRzLmZvckVhY2goaW5ncmVkaWVudCA9PiB7XG4gICAgICBjb25zdCByZWNvbW1lbmRhdGlvbktleSA9IChpbmdyZWRpZW50IGFzIHN0cmluZyk/LnR5cGUgPyBgJHsoaW5ncmVkaWVudCBhcyBzdHJpbmcpLnR5cGUudG9Mb3dlckNhc2UoKX1zYCA6ICdvdGhlcnMnO1xuICAgICAgXG4gICAgICBpZiAoIXJlc3VsdFtyZWNvbW1lbmRhdGlvbktleV0pIHtcbiAgICAgICAgcmVzdWx0W3JlY29tbWVuZGF0aW9uS2V5XSA9IFtdO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBDcmVhdGUgcmVjb21tZW5kYXRpb24gd2l0aCBjaGFrcmEtYmFzZWQgc2NvcmVcbiAgICAgIGNvbnN0IHJlY29tbWVuZGF0aW9uOiBJbmdyZWRpZW50UmVjb21tZW5kYXRpb24gPSB7XG4gICAgICAgIC4uLihpbmdyZWRpZW50IGFzIG9iamVjdCksXG4gICAgICAgIG1hdGNoU2NvcmU6IGVuZXJneSAvIDEwLCAvLyBOb3JtYWxpemUgdG8gMC0xIHJhbmdlXG4gICAgICAgIHJlY29tbWVuZGF0aW9uczogW1xuICAgICAgICAgIGBTdXBwb3J0cyAke2NoYWtyYX0gY2hha3JhIGVuZXJneWAsXG4gICAgICAgICAgLi4uKG51dHJpdGlvbmFsQ29ycmVsYXRpb25zLmZpbHRlcihjb3JyID0+IFxuICAgICAgICAgICAgKGluZ3JlZGllbnQgYXMgc3RyaW5nKT8ubmFtZT8udG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhjb3JyLnRvTG93ZXJDYXNlKCkpIHx8XG4gICAgICAgICAgICAoKGluZ3JlZGllbnQgYXMgc3RyaW5nKT8udHlwZSA/IChpbmdyZWRpZW50IGFzIHN0cmluZykudHlwZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKGNvcnIudG9Mb3dlckNhc2UoKSkgOiBmYWxzZSlcbiAgICAgICAgICApIHx8IFtdKVxuICAgICAgICBdXG4gICAgICB9IGFzIEluZ3JlZGllbnRSZWNvbW1lbmRhdGlvbjtcbiAgICAgIFxuICAgICAgLy8gT25seSBhZGQgaWYgbm90IGFscmVhZHkgcHJlc2VudFxuICAgICAgaWYgKCFyZXN1bHRbcmVjb21tZW5kYXRpb25LZXldPy5zb21lKHJlYyA9PiByZWMubmFtZSA9PT0gKGluZ3JlZGllbnQgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pPy5uYW1lKSkge1xuICAgICAgICByZXN1bHRbcmVjb21tZW5kYXRpb25LZXldPy5wdXNoKHJlY29tbWVuZGF0aW9uKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG4gIFxuICAvLyBBcHBseSBsaW1pdCB0byBlYWNoIGNhdGVnb3J5XG4gIE9iamVjdC5rZXlzKHJlc3VsdCkuZm9yRWFjaChrZXkgPT4ge1xuICAgIGlmIChyZXN1bHRba2V5XT8ubGVuZ3RoID4gbGltaXQpIHtcbiAgICAgIHJlc3VsdFtrZXldID0gcmVzdWx0W2tleV0/LnNsaWNlKDAsIGxpbWl0KTtcbiAgICB9XG4gIH0pO1xuICBcbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuLy8gSGVscGVyIGZ1bmN0aW9uIHRvIGNoZWNrIGlmIGFuIGluZ3JlZGllbnQgaXMgVmVudXMtYXNzb2NpYXRlZFxuZnVuY3Rpb24gaXNWZW51c0Fzc29jaWF0ZWRJbmdyZWRpZW50KGluZ3JlZGllbnROYW1lOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgLy8gQ2hlY2sgaWYgdGhlIGluZ3JlZGllbnQgYXBwZWFycyBpbiBWZW51cydzIGZvb2QgYXNzb2NpYXRpb25zXG4gIGlmICh2ZW51c0RhdGEuRm9vZEFzc29jaWF0aW9ucykge1xuICAgIGZvciAoY29uc3QgZm9vZCBvZiB2ZW51c0RhdGEuRm9vZEFzc29jaWF0aW9ucykge1xuICAgICAgaWYgKGluZ3JlZGllbnROYW1lLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoZm9vZC50b0xvd2VyQ2FzZSgpKSB8fCBcbiAgICAgICAgICBmb29kLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoaW5ncmVkaWVudE5hbWUudG9Mb3dlckNhc2UoKSkpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIFxuICAvLyBDaGVjayBpZiB0aGUgaW5ncmVkaWVudCBhcHBlYXJzIGluIFZlbnVzJ3MgaGVyYmFsIGFzc29jaWF0aW9uc1xuICBpZiAodmVudXNEYXRhLkhlcmJhbEFzc29jaWF0aW9ucz8uSGVyYnMpIHtcbiAgICBmb3IgKGNvbnN0IGhlcmIgb2YgdmVudXNEYXRhLkhlcmJhbEFzc29jaWF0aW9ucy5IZXJicykge1xuICAgICAgaWYgKGluZ3JlZGllbnROYW1lLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoaGVyYi50b0xvd2VyQ2FzZSgpKSB8fCBcbiAgICAgICAgICBoZXJiLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoaW5ncmVkaWVudE5hbWUudG9Mb3dlckNhc2UoKSkpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIFxuICAvLyBDaGVjayBpZiB0aGUgaW5ncmVkaWVudCBhcHBlYXJzIGluIFZlbnVzJ3MgaGVyYiBhc3NvY2lhdGlvbnNcbiAgLy8gTm90ZTogSGVyYmFsQXNzb2NpYXRpb25zIG9ubHkgaGFzIEhlcmJzLCBGbG93ZXJzLCBXb29kcywgU2NlbnRzIC0gU3BpY2VzIG5vdCBhdmFpbGFibGVcbiAgaWYgKHZlbnVzRGF0YS5IZXJiYWxBc3NvY2lhdGlvbnM/LkhlcmJzKSB7XG4gICAgZm9yIChjb25zdCBoZXJiIG9mIHZlbnVzRGF0YS5IZXJiYWxBc3NvY2lhdGlvbnMuSGVyYnMpIHtcbiAgICAgIGlmIChpbmdyZWRpZW50TmFtZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKGhlcmIudG9Mb3dlckNhc2UoKSkgfHwgXG4gICAgICAgICAgaGVyYi50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKGluZ3JlZGllbnROYW1lLnRvTG93ZXJDYXNlKCkpKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICBcbiAgLy8gQ2hlY2sgaWYgdGhlIGluZ3JlZGllbnQgYXBwZWFycyBpbiBWZW51cydzIGZsb3dlciBhc3NvY2lhdGlvbnNcbiAgaWYgKHZlbnVzRGF0YS5IZXJiYWxBc3NvY2lhdGlvbnM/LkZsb3dlcnMpIHtcbiAgICBmb3IgKGNvbnN0IGZsb3dlciBvZiB2ZW51c0RhdGEuSGVyYmFsQXNzb2NpYXRpb25zLkZsb3dlcnMpIHtcbiAgICAgIGlmIChpbmdyZWRpZW50TmFtZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKGZsb3dlci50b0xvd2VyQ2FzZSgpKSB8fCBcbiAgICAgICAgICBmbG93ZXIudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhpbmdyZWRpZW50TmFtZS50b0xvd2VyQ2FzZSgpKSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgXG4gIC8vIENoZWNrIGFnYWluc3Qgem9kaWFjLXNwZWNpZmljIFZlbnVzIGluZ3JlZGllbnRzXG4gIGlmICh2ZW51c0RhdGEuUGxhbmV0U3BlY2lmaWM/LlpvZGlhY1RyYW5zaXQgJiYgdHlwZW9mIHZlbnVzRGF0YS5QbGFuZXRTcGVjaWZpYy5ab2RpYWNUcmFuc2l0ID09PSAnb2JqZWN0Jykge1xuICAgIGZvciAoY29uc3Qgem9kaWFjIGluIHZlbnVzRGF0YS5QbGFuZXRTcGVjaWZpYy5ab2RpYWNUcmFuc2l0KSB7XG4gICAgICBjb25zdCB0cmFuc2l0RGF0YSA9IHZlbnVzRGF0YS5QbGFuZXRTcGVjaWZpYy5ab2RpYWNUcmFuc2l0W3pvZGlhY107XG4gICAgICBpZiAodHJhbnNpdERhdGEuSW5ncmVkaWVudHMpIHtcbiAgICAgICAgZm9yIChjb25zdCBpbmdyZWRpZW50IG9mIHRyYW5zaXREYXRhLkluZ3JlZGllbnRzKSB7XG4gICAgICAgICAgaWYgKGluZ3JlZGllbnROYW1lLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoaW5ncmVkaWVudC50b0xvd2VyQ2FzZSgpKSB8fCBcbiAgICAgICAgICAgICAgaW5ncmVkaWVudC50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKGluZ3JlZGllbnROYW1lLnRvTG93ZXJDYXNlKCkpKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgXG4gIHJldHVybiBmYWxzZTtcbn1cblxuLyoqXG4gKiBEZXRlcm1pbmVzIGlmIGFuIGluZ3JlZGllbnQgaXMgYXNzb2NpYXRlZCB3aXRoIE1hcnMgYmFzZWQgb24gTWFycyBkYXRhXG4gKi9cbmZ1bmN0aW9uIGlzTWFyc0Fzc29jaWF0ZWRJbmdyZWRpZW50KGluZ3JlZGllbnROYW1lOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgLy8gTm9ybWFsaXplIHRoZSBpbmdyZWRpZW50IG5hbWUgZm9yIGNvbXBhcmlzb25cbiAgY29uc3Qgbm9ybWFsaXplZE5hbWUgPSBpbmdyZWRpZW50TmFtZS50b0xvd2VyQ2FzZSgpO1xuICBcbiAgLy8gQ2hlY2sgaWYgaXQncyBpbiBNYXJzIGZvb2QgYXNzb2NpYXRpb25zXG4gIGlmIChtYXJzRGF0YS5Gb29kQXNzb2NpYXRpb25zKSB7XG4gICAgZm9yIChjb25zdCBmb29kIG9mIG1hcnNEYXRhLkZvb2RBc3NvY2lhdGlvbnMpIHtcbiAgICAgIGlmIChub3JtYWxpemVkTmFtZS5pbmNsdWRlcyhmb29kLnRvTG93ZXJDYXNlKCkpIHx8IGZvb2QudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhub3JtYWxpemVkTmFtZSkpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIFxuICAvLyBDaGVjayBpZiBpdCdzIGluIE1hcnMgaGVyYmFsIGFzc29jaWF0aW9uc1xuICBpZiAobWFyc0RhdGEuSGVyYmFsQXNzb2NpYXRpb25zPy5IZXJicykge1xuICAgIGZvciAoY29uc3QgaGVyYiBvZiBtYXJzRGF0YS5IZXJiYWxBc3NvY2lhdGlvbnMuSGVyYnMpIHtcbiAgICAgIGlmIChub3JtYWxpemVkTmFtZS5pbmNsdWRlcyhoZXJiLnRvTG93ZXJDYXNlKCkpIHx8IGhlcmIudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhub3JtYWxpemVkTmFtZSkpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIFxuICAvLyBDaGVjayBhbGwgem9kaWFjIHRyYW5zaXRzIGZvciBpbmdyZWRpZW50c1xuICBpZiAobWFyc0RhdGEuUGxhbmV0U3BlY2lmaWM/LlpvZGlhY1RyYW5zaXQgJiYgdHlwZW9mIG1hcnNEYXRhLlBsYW5ldFNwZWNpZmljLlpvZGlhY1RyYW5zaXQgPT09ICdvYmplY3QnKSB7XG4gICAgZm9yIChjb25zdCBzaWduIGluIG1hcnNEYXRhLlBsYW5ldFNwZWNpZmljLlpvZGlhY1RyYW5zaXQpIHtcbiAgICAgIGNvbnN0IHRyYW5zaXQgPSBtYXJzRGF0YS5QbGFuZXRTcGVjaWZpYy5ab2RpYWNUcmFuc2l0W3NpZ25dO1xuICAgICAgaWYgKHRyYW5zaXQuSW5ncmVkaWVudHMpIHtcbiAgICAgICAgZm9yIChjb25zdCBpbmdyZWRpZW50IG9mIHRyYW5zaXQuSW5ncmVkaWVudHMpIHtcbiAgICAgICAgICBpZiAobm9ybWFsaXplZE5hbWUuaW5jbHVkZXMoaW5ncmVkaWVudC50b0xvd2VyQ2FzZSgpKSB8fCBpbmdyZWRpZW50LnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMobm9ybWFsaXplZE5hbWUpKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgXG4gIHJldHVybiBmYWxzZTtcbn1cblxuLyoqXG4gKiBDYWxjdWxhdGUgVmVudXMgaW5mbHVlbmNlIHNjb3JlIGZvciBhbiBpbmdyZWRpZW50XG4gKiBAcGFyYW0gaW5ncmVkaWVudCBUaGUgaW5ncmVkaWVudCB0byBjYWxjdWxhdGUgVmVudXMgaW5mbHVlbmNlIGZvclxuICogQHBhcmFtIHpvZGlhY1NpZ24gQ3VycmVudCB6b2RpYWMgc2lnbiBWZW51cyBpcyBpblxuICogQHBhcmFtIGlzVmVudXNSZXRyb2dyYWRlIFdoZXRoZXIgVmVudXMgaXMgcmV0cm9ncmFkZVxuICogQHJldHVybnMgU2NvcmUgcmVwcmVzZW50aW5nIFZlbnVzIGluZmx1ZW5jZSAoaGlnaGVyIGlzIHN0cm9uZ2VyKVxuICovXG5mdW5jdGlvbiBjYWxjdWxhdGVWZW51c0luZmx1ZW5jZShcbiAgaW5ncmVkaWVudDogSW5ncmVkaWVudCwgXG4gIHpvZGlhY1NpZ24/OiBzdHJpbmcsXG4gIGlzVmVudXNSZXRyb2dyYWRlID0gZmFsc2Vcbik6IG51bWJlciB7XG4gIGxldCBzY29yZSA9IDA7XG4gIFxuICAvLyBCYXNlIHNjb3JlIGZvciBWZW51cyBhc3NvY2lhdGlvblxuICBpZiAoaXNWZW51c0Fzc29jaWF0ZWRJbmdyZWRpZW50KChpbmdyZWRpZW50IGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KT8ubmFtZSkpIHtcbiAgICBzY29yZSArPSAyLjA7XG4gIH1cbiAgXG4gIC8vIENoZWNrIGVsZW1lbnRhbCBwcm9wZXJ0aWVzIGFsaWdubWVudCB3aXRoIFZlbnVzXG4gIGlmIChpbmdyZWRpZW50LmVsZW1lbnRhbFByb3BlcnRpZXMpIHtcbiAgICAvLyBWZW51cyBmYXZvcnMgV2F0ZXIgYW5kIEVhcnRoIGVsZW1lbnRzXG4gICAgc2NvcmUgKz0gKGluZ3JlZGllbnQuZWxlbWVudGFsUHJvcGVydGllcy5XYXRlciB8fCAwKSAqIDEuNTtcbiAgICBzY29yZSArPSAoaW5ncmVkaWVudC5lbGVtZW50YWxQcm9wZXJ0aWVzLkVhcnRoIHx8IDApICogMS44O1xuICAgIC8vIExlc3NlciBhZmZpbml0aWVzIHdpdGggQWlyIGFuZCBGaXJlXG4gICAgc2NvcmUgKz0gKGluZ3JlZGllbnQuZWxlbWVudGFsUHJvcGVydGllcy5BaXIgfHwgMCkgKiAwLjg7XG4gICAgc2NvcmUgKz0gKGluZ3JlZGllbnQuZWxlbWVudGFsUHJvcGVydGllcy5GaXJlIHx8IDApICogMC41O1xuICB9XG4gIFxuICAvLyBDaGVjayBmbGF2b3IgcHJvZmlsZSBhbGlnbm1lbnQgd2l0aCBWZW51cyBwcmVmZXJlbmNlc1xuICBjb25zdCBmbGF2b3JQcm9maWxlID0gKGluZ3JlZGllbnQgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pPy5mbGF2b3JQcm9maWxlO1xuICBpZiAoZmxhdm9yUHJvZmlsZSkge1xuICAgIC8vIFZlbnVzIGZhdm9ycyBzd2VldCwgcmljaCwgY3JlYW15IGZsYXZvcnNcbiAgICBpZiAoZmxhdm9yUHJvZmlsZS5zd2VldCkge1xuICAgICAgc2NvcmUgKz0gZmxhdm9yUHJvZmlsZS5zd2VldCAqIDIuMDtcbiAgICB9XG4gICAgXG4gICAgaWYgKGZsYXZvclByb2ZpbGUudW1hbWkpIHtcbiAgICAgIHNjb3JlICs9IGZsYXZvclByb2ZpbGUudW1hbWkgKiAxLjU7XG4gICAgfVxuICAgIFxuICAgIGlmIChmbGF2b3JQcm9maWxlLmNyZWFteSB8fCBmbGF2b3JQcm9maWxlLnJpY2gpIHtcbiAgICAgIHNjb3JlICs9ICgoZmxhdm9yUHJvZmlsZS5jcmVhbXkgfHwgMCkgKyAoZmxhdm9yUHJvZmlsZS5yaWNoIHx8IDApKSAqIDEuNztcbiAgICB9XG4gICAgXG4gICAgLy8gVmVudXMgYXBwcmVjaWF0ZXMgYXJvbWF0aWMsIGZyYWdyYW50IHF1YWxpdGllc1xuICAgIGlmIChmbGF2b3JQcm9maWxlLmFyb21hdGljIHx8IGZsYXZvclByb2ZpbGUuZnJhZ3JhbnQpIHtcbiAgICAgIHNjb3JlICs9ICgoZmxhdm9yUHJvZmlsZS5hcm9tYXRpYyB8fCAwKSArIChmbGF2b3JQcm9maWxlLmZyYWdyYW50IHx8IDApKSAqIDEuNjtcbiAgICB9XG4gICAgXG4gICAgLy8gVmVudXMgaXMgbGVzcyBpbnRlcmVzdGVkIGluIGJpdHRlciBvciBleGNlc3NpdmVseSBzcGljeSBmbGF2b3JzXG4gICAgaWYgKGZsYXZvclByb2ZpbGUuYml0dGVyKSB7XG4gICAgICBzY29yZSAtPSBmbGF2b3JQcm9maWxlLmJpdHRlciAqIDAuNTtcbiAgICB9XG4gICAgXG4gICAgaWYgKGZsYXZvclByb2ZpbGUuc3BpY3kgJiYgZmxhdm9yUHJvZmlsZS5zcGljeSA+IDAuNykge1xuICAgICAgc2NvcmUgLT0gKGZsYXZvclByb2ZpbGUuc3BpY3kgLSAwLjcpICogMC44O1xuICAgIH1cbiAgfVxuICBcbiAgLy8gQ2hlY2sgdGV4dHVyZSBhbGlnbm1lbnQgd2l0aCBWZW51cyBwcmVmZXJlbmNlc1xuICBjb25zdCB0ZXh0dXJlID0gKGluZ3JlZGllbnQgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pPy50ZXh0dXJlO1xuICBpZiAodGV4dHVyZSkge1xuICAgIC8vIFZlbnVzIGZhdm9ycyBzbW9vdGgsIGNyZWFteSwgbHVzY2lvdXMgdGV4dHVyZXNcbiAgICBjb25zdCB2ZW51c1RleHR1cmVzID0gWydzbW9vdGgnLCAnY3JlYW15JywgJ3ZlbHZldHknLCAnc29mdCcsICd0ZW5kZXInLCAnanVpY3knLCAnYnV0dGVyeSddO1xuICAgIGNvbnN0IHRleHR1cmVNYXRjaCA9IHZlbnVzVGV4dHVyZXMuZmlsdGVyKHZlbnVzVGV4dHVyZSA9PiBcbiAgICAgIEFycmF5LmlzQXJyYXkodGV4dHVyZSkgPyB0ZXh0dXJlLmluY2x1ZGVzKHZlbnVzVGV4dHVyZSkgOiB0ZXh0dXJlLmluY2x1ZGVzICYmIHRleHR1cmUuaW5jbHVkZXModmVudXNUZXh0dXJlKVxuICAgICkubGVuZ3RoO1xuICAgIFxuICAgIHNjb3JlICs9IHRleHR1cmVNYXRjaCAqIDAuNTtcbiAgfVxuICBcbiAgLy8gQ2hlY2sgY3VsaW5hcnkgdGVjaG5pcXVlIGFsaWdubWVudFxuICBjb25zdCBjdWxpbmFyeVVzZXMgPSAoaW5ncmVkaWVudCBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPik/LmN1bGluYXJ5VXNlcztcbiAgaWYgKHZlbnVzRGF0YS5QbGFuZXRTcGVjaWZpYz8uQ3VsaW5hcnlUZWNobmlxdWVzICYmIGN1bGluYXJ5VXNlcykge1xuICAgIC8vIENoZWNrIGZvciBhZXN0aGV0aWMgcHJlc2VudGF0aW9uIHRlY2huaXF1ZXNcbiAgICBpZiAoXG4gICAgICBjdWxpbmFyeVVzZXMuaW5jbHVkZXMoJ2dhcm5pc2gnKSB8fCBcbiAgICAgIGN1bGluYXJ5VXNlcy5pbmNsdWRlcygncGxhdGluZycpXG4gICAgKSB7XG4gICAgICBzY29yZSArPSAxLjg7XG4gICAgfVxuICAgIFxuICAgIC8vIENoZWNrIGZvciBiYWxhbmNlIGFuZCBoYXJtb255IGluIGZsYXZvciBwYWlyaW5nc1xuICAgIGNvbnN0IGhhcm1vbnlQYWlyaW5ncyA9IChpbmdyZWRpZW50IGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KT8uaGFybW9ueVBhaXJpbmdzO1xuICAgIGlmIChoYXJtb255UGFpcmluZ3MgJiYgaGFybW9ueVBhaXJpbmdzLmxlbmd0aCA+IDMpIHtcbiAgICAgIHNjb3JlICs9IDEuNTtcbiAgICB9XG4gICAgXG4gICAgLy8gU3dlZXQgYW5kIGluZHVsZ2VudCBwcmVwYXJhdGlvbiB0ZWNobmlxdWVzXG4gICAgaWYgKFxuICAgICAgY3VsaW5hcnlVc2VzLmluY2x1ZGVzKCdkZXNzZXJ0JykgfHwgXG4gICAgICBjdWxpbmFyeVVzZXMuaW5jbHVkZXMoJ2Jha2luZycpIHx8XG4gICAgICBjdWxpbmFyeVVzZXMuaW5jbHVkZXMoJ2NvbmZlY3Rpb24nKVxuICAgICkge1xuICAgICAgc2NvcmUgKz0gMS4yO1xuICAgIH1cbiAgICBcbiAgICAvLyBDaGVjayBmb3IgZnJhZ3JhbmNlIGFuZCBhcm9tYSBlbmhhbmNlbWVudFxuICAgIGNvbnN0IGFyb21hdGljUHJvcGVydGllcyA9IChpbmdyZWRpZW50IGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KT8uYXJvbWF0aWNQcm9wZXJ0aWVzO1xuICAgIGlmIChcbiAgICAgIGFyb21hdGljUHJvcGVydGllcyB8fCBcbiAgICAgIChmbGF2b3JQcm9maWxlPy5hcm9tYXRpYyAmJiBmbGF2b3JQcm9maWxlLmFyb21hdGljID4gMC43KVxuICAgICkge1xuICAgICAgc2NvcmUgKz0gMS42O1xuICAgIH1cbiAgICBcbiAgICAvLyBDaGVjayBmb3IgdGV4dHVyYWwgY29udHJhc3QgdGVjaG5pcXVlc1xuICAgIGlmIChcbiAgICAgIGN1bGluYXJ5VXNlcy5pbmNsdWRlcygnY3Jpc3B5JykgfHwgXG4gICAgICBjdWxpbmFyeVVzZXMuaW5jbHVkZXMoJ2NydW5jaHknKSB8fCBcbiAgICAgICh0ZXh0dXJlICYmICgoQXJyYXkuaXNBcnJheSh0ZXh0dXJlKSAmJiB0ZXh0dXJlLmluY2x1ZGVzKCdjb250cmFzdCcpKSB8fCAodGV4dHVyZS5pbmNsdWRlcyAmJiB0ZXh0dXJlLmluY2x1ZGVzKCdjb250cmFzdCcpKSkpXG4gICAgKSB7XG4gICAgICBzY29yZSArPSAxLjM7XG4gICAgfVxuICB9XG4gIFxuICAvLyBab2RpYWMgc2lnbi1zcGVjaWZpYyBwcmVmZXJlbmNlc1xuICBpZiAoem9kaWFjU2lnbiAmJiB2ZW51c0RhdGEuUGxhbmV0U3BlY2lmaWM/LlpvZGlhY1RyYW5zaXQpIHtcbiAgICBjb25zdCB0cmFuc2l0RGF0YSA9IHZlbnVzRGF0YS5QbGFuZXRTcGVjaWZpYy5ab2RpYWNUcmFuc2l0W3pvZGlhY1NpZ25dO1xuICAgIFxuICAgIC8vIENoZWNrIGZvb2QgZm9jdXMgYWxpZ25tZW50XG4gICAgLy8gRXh0cmFjdCB0cmFuc2l0IGRhdGEgd2l0aCBzYWZlIHByb3BlcnR5IGFjY2Vzc1xuICAgIGNvbnN0IHRyYW5zaXREYXRhQW55ID0gdHJhbnNpdERhdGEgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj47XG4gICAgY29uc3QgZm9vZEZvY3VzUHJvcGVydHkgPSB0cmFuc2l0RGF0YUFueT8uRm9vZEZvY3VzO1xuICAgIFxuICAgIGlmIChmb29kRm9jdXNQcm9wZXJ0eSkge1xuICAgICAgY29uc3QgZm9vZEZvY3VzID0gZm9vZEZvY3VzUHJvcGVydHkudG9Mb3dlckNhc2UoKTtcbiAgICAgIGNvbnN0IGluZ3JlZGllbnROYW1lID0gKGluZ3JlZGllbnQgYXMgc3RyaW5nKT8ubmFtZS50b0xvd2VyQ2FzZSgpO1xuICAgICAgXG4gICAgICAvLyBEaXJlY3Qga2V5d29yZHMgbWF0Y2hcbiAgICAgIGNvbnN0IGtleXdvcmRzID0gZm9vZEZvY3VzLnNwbGl0KC9bXFxzLDtdKy8pLmZpbHRlcihrID0+IGsubGVuZ3RoID4gMyk7XG4gICAgICBmb3IgKGNvbnN0IGtleXdvcmQgb2Yga2V5d29yZHMpIHtcbiAgICAgICAgY29uc3QgZGVzY3JpcHRpb24gPSAoaW5ncmVkaWVudCBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPik/LmRlc2NyaXB0aW9uO1xuICAgICAgICBjb25zdCBjdWxpbmFyeVVzZXMgPSAoaW5ncmVkaWVudCBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPik/LmN1bGluYXJ5VXNlcztcbiAgICAgICAgaWYgKGluZ3JlZGllbnROYW1lLmluY2x1ZGVzKGtleXdvcmQpIHx8IFxuICAgICAgICAgICAgKGRlc2NyaXB0aW9uICYmIGRlc2NyaXB0aW9uLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoa2V5d29yZCkpIHx8XG4gICAgICAgICAgICAoY3VsaW5hcnlVc2VzICYmIGN1bGluYXJ5VXNlcy5zb21lKCh1c2U6IHN0cmluZykgPT4gdXNlLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoa2V5d29yZCkpKSkge1xuICAgICAgICAgIHNjb3JlICs9IDIuMDtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICAvLyBDaGVjayBFbGVtZW50cyBhbGlnbm1lbnRcbiAgICAvLyBFeHRyYWN0IHRyYW5zaXQgZGF0YSB3aXRoIHNhZmUgcHJvcGVydHkgYWNjZXNzIGZvciBlbGVtZW50c1xuICAgIGNvbnN0IHRyYW5zaXRFbGVtZW50cyA9IHRyYW5zaXREYXRhQW55Py5FbGVtZW50cztcbiAgICBcbiAgICBpZiAodHJhbnNpdEVsZW1lbnRzICYmIGluZ3JlZGllbnQuZWxlbWVudGFsUHJvcGVydGllcykge1xuICAgICAgZm9yIChjb25zdCBlbGVtZW50IGluIHRyYW5zaXRFbGVtZW50cykge1xuICAgICAgICBpZiAoaW5ncmVkaWVudC5lbGVtZW50YWxQcm9wZXJ0aWVzW2VsZW1lbnRdKSB7XG4gICAgICAgICAgc2NvcmUgKz0gdHJhbnNpdEVsZW1lbnRzW2VsZW1lbnRdICogaW5ncmVkaWVudC5lbGVtZW50YWxQcm9wZXJ0aWVzW2VsZW1lbnRdICogMC43O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIC8vIENoZWNrIGluZ3JlZGllbnQgYWxpZ25tZW50IHdpdGggdHJhbnNpdCBwcmVmZXJlbmNlc1xuICAgIGlmICh0cmFuc2l0RGF0YS5JbmdyZWRpZW50cykge1xuICAgICAgY29uc3QgdHJhbnNpdEluZ3JlZGllbnRzID0gdHJhbnNpdERhdGEuSW5ncmVkaWVudHMubWFwKGkgPT4gaS50b0xvd2VyQ2FzZSgpKTtcbiAgICAgIFxuICAgICAgLy8gRGlyZWN0IGluZ3JlZGllbnQgbWF0Y2hcbiAgICAgIGlmICh0cmFuc2l0SW5ncmVkaWVudHMuc29tZShpID0+IChpbmdyZWRpZW50IGFzIHN0cmluZyk/Lm5hbWUudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhpKSB8fCBpLmluY2x1ZGVzKChpbmdyZWRpZW50IGFzIHN0cmluZyk/Lm5hbWUudG9Mb3dlckNhc2UoKSkpKSB7XG4gICAgICAgIHNjb3JlICs9IDMuMDtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gQ2F0ZWdvcnkgbWF0Y2hcbiAgICAgIGlmIChpbmdyZWRpZW50LmNhdGVnb3J5ICYmIHRyYW5zaXRJbmdyZWRpZW50cy5pbmNsdWRlcyhpbmdyZWRpZW50LmNhdGVnb3J5LnRvTG93ZXJDYXNlKCkpKSB7XG4gICAgICAgIHNjb3JlICs9IDIuMDtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gUmVsYXRlZCBpbmdyZWRpZW50IG1hdGNoXG4gICAgICBjb25zdCByZWxhdGVkSW5ncmVkaWVudHMgPSAoaW5ncmVkaWVudCBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPik/LnJlbGF0ZWRJbmdyZWRpZW50cztcbiAgICAgIGlmIChyZWxhdGVkSW5ncmVkaWVudHMpIHtcbiAgICAgICAgY29uc3QgcmVsYXRlZE1hdGNoZXMgPSByZWxhdGVkSW5ncmVkaWVudHMuZmlsdGVyKChyZWxhdGVkOiBzdHJpbmcpID0+IFxuICAgICAgICAgIHRyYW5zaXRJbmdyZWRpZW50cy5zb21lKGkgPT4gcmVsYXRlZC50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKGkpIHx8IGkuaW5jbHVkZXMocmVsYXRlZC50b0xvd2VyQ2FzZSgpKSlcbiAgICAgICAgKS5sZW5ndGg7XG4gICAgICAgIFxuICAgICAgICBzY29yZSArPSByZWxhdGVkTWF0Y2hlcyAqIDAuNztcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gQ29tcGxlbWVudGFyeSBpbmdyZWRpZW50cyBtYXRjaFxuICAgICAgY29uc3QgY29tcGxlbWVudGFyeUluZ3JlZGllbnRzID0gKGluZ3JlZGllbnQgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pPy5jb21wbGVtZW50YXJ5SW5ncmVkaWVudHM7XG4gICAgICBpZiAoY29tcGxlbWVudGFyeUluZ3JlZGllbnRzKSB7XG4gICAgICAgIGNvbnN0IGNvbXBsZW1lbnRhcnlNYXRjaGVzID0gY29tcGxlbWVudGFyeUluZ3JlZGllbnRzLmZpbHRlcigoY29tcGxlbWVudDogc3RyaW5nKSA9PiBcbiAgICAgICAgICB0cmFuc2l0SW5ncmVkaWVudHMuc29tZShpID0+IGNvbXBsZW1lbnQudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhpKSB8fCBpLmluY2x1ZGVzKGNvbXBsZW1lbnQudG9Mb3dlckNhc2UoKSkpXG4gICAgICAgICkubGVuZ3RoO1xuICAgICAgICBcbiAgICAgICAgc2NvcmUgKz0gY29tcGxlbWVudGFyeU1hdGNoZXMgKiAwLjU7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIFxuICAvLyBWZW51cyB0ZW1wZXJhbWVudCBiYXNlZCBvbiBzaWduIHR5cGVcbiAgaWYgKHpvZGlhY1NpZ24pIHtcbiAgICBjb25zdCBlYXJ0aFNpZ25zID0gWyd0YXVydXMnLCAndmlyZ28nLCAnY2Fwcmljb3JuJ107XG4gICAgY29uc3QgYWlyU2lnbnMgPSBbJ2dlbWluaScsICdsaWJyYScsICdhcXVhcml1cyddO1xuICAgIGNvbnN0IHdhdGVyU2lnbnMgPSBbJ2NhbmNlcicsICdzY29ycGlvJywgJ3Bpc2NlcyddO1xuICAgIGNvbnN0IGZpcmVTaWducyA9IFsnYXJpZXMnLCAnbGVvJywgJ3NhZ2l0dGFyaXVzJ107XG4gICAgY29uc3QgbG93ZXJTaWduID0gem9kaWFjU2lnbi50b0xvd2VyQ2FzZSgpO1xuICAgIFxuICAgIC8vIEVhcnRoIFZlbnVzXG4gICAgaWYgKGVhcnRoU2lnbnMuaW5jbHVkZXMobG93ZXJTaWduKSAmJiAodmVudXNEYXRhLlBsYW5ldFNwZWNpZmljPy5DdWxpbmFyeVRlbXBlcmFtZW50IGFzIHN0cmluZyk/LkVhcnRoVmVudXMpIHtcbiAgICAgIGNvbnN0IGVhcnRoVmVudXMgPSAodmVudXNEYXRhLlBsYW5ldFNwZWNpZmljLkN1bGluYXJ5VGVtcGVyYW1lbnQgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pLkVhcnRoVmVudXM7XG4gICAgICBcbiAgICAgIC8vIENoZWNrIGZvciBzZW5zdWFsLCByaWNoIGluZ3JlZGllbnRzXG4gICAgICBpZiAoZmxhdm9yUHJvZmlsZT8ucmljaCA+IDAuNSB8fCBcbiAgICAgICAgICBmbGF2b3JQcm9maWxlPy51bWFtaSA+IDAuNSB8fFxuICAgICAgICAgIGN1bGluYXJ5VXNlcz8uaW5jbHVkZXMoJ2NvbWZvcnQgZm9vZCcpKSB7XG4gICAgICAgIHNjb3JlICs9IDIuMDtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gRm9vZCBmb2N1cyBhbGlnbm1lbnRcbiAgICAgIC8vIEV4dHJhY3QgZWFydGggdmVudXMgZGF0YSB3aXRoIHNhZmUgcHJvcGVydHkgYWNjZXNzXG4gICAgICBjb25zdCBlYXJ0aFZlbnVzQW55ID0gZWFydGhWZW51cyBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPjtcbiAgICAgIGNvbnN0IGVhcnRoVmVudXNGb29kRm9jdXMgPSBlYXJ0aFZlbnVzQW55Py5Gb29kRm9jdXM7XG4gICAgICBcbiAgICAgIGlmIChlYXJ0aFZlbnVzRm9vZEZvY3VzKSB7XG4gICAgICAgIGNvbnN0IGZvY3VzS2V5d29yZHMgPSBlYXJ0aFZlbnVzRm9vZEZvY3VzLnRvTG93ZXJDYXNlKCkuc3BsaXQoL1tcXHMsO10rLykuZmlsdGVyKGsgPT4gay5sZW5ndGggPiAzKTtcbiAgICAgICAgY29uc3QgZGVzY3JpcHRpb24gPSAoaW5ncmVkaWVudCBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPik/LmRlc2NyaXB0aW9uO1xuICAgICAgICBpZiAoZm9jdXNLZXl3b3Jkcy5zb21lKGtleXdvcmQgPT4gXG4gICAgICAgICAgICAoaW5ncmVkaWVudCBhcyBzdHJpbmcpPy5uYW1lLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoa2V5d29yZCkgfHwgXG4gICAgICAgICAgICAoZGVzY3JpcHRpb24gJiYgZGVzY3JpcHRpb24udG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhrZXl3b3JkKSkpKSB7XG4gICAgICAgICAgc2NvcmUgKz0gMS41O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIEVsZW1lbnRzIGFsaWdubWVudFxuICAgICAgLy8gRXh0cmFjdCBlYXJ0aCB2ZW51cyBlbGVtZW50cyB3aXRoIHNhZmUgcHJvcGVydHkgYWNjZXNzXG4gICAgICBjb25zdCBlYXJ0aFZlbnVzRWxlbWVudHMgPSBlYXJ0aFZlbnVzQW55Py5FbGVtZW50cztcbiAgICAgIFxuICAgICAgaWYgKGVhcnRoVmVudXNFbGVtZW50cyAmJiBpbmdyZWRpZW50LmVsZW1lbnRhbFByb3BlcnRpZXMpIHtcbiAgICAgICAgZm9yIChjb25zdCBlbGVtZW50IGluIGVhcnRoVmVudXNFbGVtZW50cykge1xuICAgICAgICAgIGlmIChpbmdyZWRpZW50LmVsZW1lbnRhbFByb3BlcnRpZXNbZWxlbWVudF0pIHtcbiAgICAgICAgICAgIHNjb3JlICs9IGVhcnRoVmVudXNFbGVtZW50c1tlbGVtZW50XSAqIGluZ3JlZGllbnQuZWxlbWVudGFsUHJvcGVydGllc1tlbGVtZW50XSAqIDEuMDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgLy8gQWlyIFZlbnVzXG4gICAgaWYgKGFpclNpZ25zLmluY2x1ZGVzKGxvd2VyU2lnbikgJiYgKHZlbnVzRGF0YS5QbGFuZXRTcGVjaWZpYz8uQ3VsaW5hcnlUZW1wZXJhbWVudCBhcyBzdHJpbmcpPy5BaXJWZW51cykge1xuICAgICAgY29uc3QgYWlyVmVudXMgPSAodmVudXNEYXRhLlBsYW5ldFNwZWNpZmljLkN1bGluYXJ5VGVtcGVyYW1lbnQgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pLkFpclZlbnVzO1xuICAgICAgXG4gICAgICAvLyBDaGVjayBmb3IgbGlnaHQsIGRlbGljYXRlIGluZ3JlZGllbnRzXG4gICAgICBpZiAoKHRleHR1cmUgJiYgKChBcnJheS5pc0FycmF5KHRleHR1cmUpICYmIHRleHR1cmUuaW5jbHVkZXMoJ2xpZ2h0JykpIHx8ICh0ZXh0dXJlLmluY2x1ZGVzICYmIHRleHR1cmUuaW5jbHVkZXMoJ2xpZ2h0JykpKSkgfHwgXG4gICAgICAgICAgKHRleHR1cmUgJiYgKChBcnJheS5pc0FycmF5KHRleHR1cmUpICYmIHRleHR1cmUuaW5jbHVkZXMoJ2NyaXNwJykpIHx8ICh0ZXh0dXJlLmluY2x1ZGVzICYmIHRleHR1cmUuaW5jbHVkZXMoJ2NyaXNwJykpKSkgfHxcbiAgICAgICAgICBmbGF2b3JQcm9maWxlPy5saWdodCA+IDAuNSkge1xuICAgICAgICBzY29yZSArPSAyLjA7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIEZvb2QgZm9jdXMgYWxpZ25tZW50XG4gICAgICAvLyBFeHRyYWN0IGFpciB2ZW51cyBkYXRhIHdpdGggc2FmZSBwcm9wZXJ0eSBhY2Nlc3NcbiAgICAgIGNvbnN0IGFpclZlbnVzQW55ID0gYWlyVmVudXMgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj47XG4gICAgICBjb25zdCBhaXJWZW51c0Zvb2RGb2N1cyA9IGFpclZlbnVzQW55Py5Gb29kRm9jdXM7XG4gICAgICBcbiAgICAgIGlmIChhaXJWZW51c0Zvb2RGb2N1cykge1xuICAgICAgICBjb25zdCBmb2N1c0tleXdvcmRzID0gYWlyVmVudXNGb29kRm9jdXMudG9Mb3dlckNhc2UoKS5zcGxpdCgvW1xccyw7XSsvKS5maWx0ZXIoayA9PiBrLmxlbmd0aCA+IDMpO1xuICAgICAgICBjb25zdCBkZXNjcmlwdGlvbiA9IChpbmdyZWRpZW50IGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KT8uZGVzY3JpcHRpb247XG4gICAgICAgIGlmIChmb2N1c0tleXdvcmRzLnNvbWUoa2V5d29yZCA9PiBcbiAgICAgICAgICAgIChpbmdyZWRpZW50IGFzIHN0cmluZyk/Lm5hbWUudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhrZXl3b3JkKSB8fCBcbiAgICAgICAgICAgIChkZXNjcmlwdGlvbiAmJiBkZXNjcmlwdGlvbi50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKGtleXdvcmQpKSkpIHtcbiAgICAgICAgICBzY29yZSArPSAxLjU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gRWxlbWVudHMgYWxpZ25tZW50XG4gICAgICAvLyBFeHRyYWN0IGFpciB2ZW51cyBlbGVtZW50cyB3aXRoIHNhZmUgcHJvcGVydHkgYWNjZXNzXG4gICAgICBjb25zdCBhaXJWZW51c0VsZW1lbnRzID0gYWlyVmVudXNBbnk/LkVsZW1lbnRzO1xuICAgICAgXG4gICAgICBpZiAoYWlyVmVudXNFbGVtZW50cyAmJiBpbmdyZWRpZW50LmVsZW1lbnRhbFByb3BlcnRpZXMpIHtcbiAgICAgICAgZm9yIChjb25zdCBlbGVtZW50IGluIGFpclZlbnVzRWxlbWVudHMpIHtcbiAgICAgICAgICBpZiAoaW5ncmVkaWVudC5lbGVtZW50YWxQcm9wZXJ0aWVzW2VsZW1lbnRdKSB7XG4gICAgICAgICAgICBzY29yZSArPSBhaXJWZW51c0VsZW1lbnRzW2VsZW1lbnRdICogaW5ncmVkaWVudC5lbGVtZW50YWxQcm9wZXJ0aWVzW2VsZW1lbnRdICogMS4wO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICAvLyBXYXRlciBWZW51c1xuICAgIGlmICh3YXRlclNpZ25zLmluY2x1ZGVzKGxvd2VyU2lnbikgJiYgKHZlbnVzRGF0YS5QbGFuZXRTcGVjaWZpYz8uQ3VsaW5hcnlUZW1wZXJhbWVudCBhcyBzdHJpbmcpPy5XYXRlclZlbnVzKSB7XG4gICAgICBjb25zdCB3YXRlclZlbnVzID0gKHZlbnVzRGF0YS5QbGFuZXRTcGVjaWZpYy5DdWxpbmFyeVRlbXBlcmFtZW50IGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KS5XYXRlclZlbnVzO1xuICAgICAgXG4gICAgICAvLyBDaGVjayBmb3IgbW9pc3QsIGp1aWN5IGluZ3JlZGllbnRzXG4gICAgICBpZiAoKHRleHR1cmUgJiYgKChBcnJheS5pc0FycmF5KHRleHR1cmUpICYmIHRleHR1cmUuaW5jbHVkZXMoJ2p1aWN5JykpIHx8ICh0ZXh0dXJlLmluY2x1ZGVzICYmIHRleHR1cmUuaW5jbHVkZXMoJ2p1aWN5JykpKSkgfHwgXG4gICAgICAgICAgKHRleHR1cmUgJiYgKChBcnJheS5pc0FycmF5KHRleHR1cmUpICYmIHRleHR1cmUuaW5jbHVkZXMoJ3RlbmRlcicpKSB8fCAodGV4dHVyZS5pbmNsdWRlcyAmJiB0ZXh0dXJlLmluY2x1ZGVzKCd0ZW5kZXInKSkpKSB8fFxuICAgICAgICAgIGZsYXZvclByb2ZpbGU/Lmp1aWN5ID4gMC41KSB7XG4gICAgICAgIHNjb3JlICs9IDIuMDtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gRm9vZCBmb2N1cyBhbGlnbm1lbnRcbiAgICAgIC8vIEV4dHJhY3Qgd2F0ZXIgdmVudXMgZGF0YSB3aXRoIHNhZmUgcHJvcGVydHkgYWNjZXNzXG4gICAgICBjb25zdCB3YXRlclZlbnVzQW55ID0gd2F0ZXJWZW51cyBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPjtcbiAgICAgIGNvbnN0IHdhdGVyVmVudXNGb29kRm9jdXMgPSB3YXRlclZlbnVzQW55Py5Gb29kRm9jdXM7XG4gICAgICBcbiAgICAgIGlmICh3YXRlclZlbnVzRm9vZEZvY3VzKSB7XG4gICAgICAgIGNvbnN0IGZvY3VzS2V5d29yZHMgPSB3YXRlclZlbnVzRm9vZEZvY3VzLnRvTG93ZXJDYXNlKCkuc3BsaXQoL1tcXHMsO10rLykuZmlsdGVyKGsgPT4gay5sZW5ndGggPiAzKTtcbiAgICAgICAgICAgICAgLy8gRXh0cmFjdCBpbmdyZWRpZW50IGRhdGEgd2l0aCBzYWZlIHByb3BlcnR5IGFjY2Vzc1xuICAgICAgY29uc3QgaW5ncmVkaWVudERhdGEgPSBpbmdyZWRpZW50IGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+O1xuICAgICAgY29uc3QgaW5ncmVkaWVudE5hbWUgPSBpbmdyZWRpZW50RGF0YT8ubmFtZT8udG9Mb3dlckNhc2UoKSB8fCAnJztcbiAgICAgIGNvbnN0IGluZ3JlZGllbnREZXNjcmlwdGlvbiA9IGluZ3JlZGllbnREYXRhPy5kZXNjcmlwdGlvbj8udG9Mb3dlckNhc2UoKSB8fCAnJztcbiAgICAgIFxuICAgICAgaWYgKGZvY3VzS2V5d29yZHMuc29tZShrZXl3b3JkID0+IFxuICAgICAgICAgIGluZ3JlZGllbnROYW1lLmluY2x1ZGVzKGtleXdvcmQpIHx8IFxuICAgICAgICAgIGluZ3JlZGllbnREZXNjcmlwdGlvbi5pbmNsdWRlcyhrZXl3b3JkKSkpIHtcbiAgICAgICAgICBzY29yZSArPSAxLjU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gRWxlbWVudHMgYWxpZ25tZW50XG4gICAgICAvLyBFeHRyYWN0IHdhdGVyIHZlbnVzIGVsZW1lbnRzIHdpdGggc2FmZSBwcm9wZXJ0eSBhY2Nlc3NcbiAgICAgIGNvbnN0IHdhdGVyVmVudXNFbGVtZW50cyA9IHdhdGVyVmVudXNBbnk/LkVsZW1lbnRzO1xuICAgICAgXG4gICAgICBpZiAod2F0ZXJWZW51c0VsZW1lbnRzICYmIGluZ3JlZGllbnQuZWxlbWVudGFsUHJvcGVydGllcykge1xuICAgICAgICBmb3IgKGNvbnN0IGVsZW1lbnQgaW4gd2F0ZXJWZW51c0VsZW1lbnRzKSB7XG4gICAgICAgICAgaWYgKGluZ3JlZGllbnQuZWxlbWVudGFsUHJvcGVydGllc1tlbGVtZW50XSkge1xuICAgICAgICAgICAgc2NvcmUgKz0gd2F0ZXJWZW51c0VsZW1lbnRzW2VsZW1lbnRdICogaW5ncmVkaWVudC5lbGVtZW50YWxQcm9wZXJ0aWVzW2VsZW1lbnRdICogMS4wO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICAvLyBGaXJlIFZlbnVzXG4gICAgaWYgKGZpcmVTaWducy5pbmNsdWRlcyhsb3dlclNpZ24pICYmICh2ZW51c0RhdGEuUGxhbmV0U3BlY2lmaWM/LkN1bGluYXJ5VGVtcGVyYW1lbnQgYXMgc3RyaW5nKT8uRmlyZVZlbnVzKSB7XG4gICAgICBjb25zdCBmaXJlVmVudXMgPSAodmVudXNEYXRhLlBsYW5ldFNwZWNpZmljLkN1bGluYXJ5VGVtcGVyYW1lbnQgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pLkZpcmVWZW51cztcbiAgICAgIFxuICAgICAgLy8gQ2hlY2sgZm9yIHZpYnJhbnQsIHNwaWN5IGluZ3JlZGllbnRzXG4gICAgICBpZiAoZmxhdm9yUHJvZmlsZT8uc3BpY3kgPiAwLjMgfHwgXG4gICAgICAgICAgZmxhdm9yUHJvZmlsZT8udmlicmFudCA+IDAuNSB8fFxuICAgICAgICAgIGN1bGluYXJ5VXNlcz8uaW5jbHVkZXMoJ3N0aW11bGF0aW5nJykpIHtcbiAgICAgICAgc2NvcmUgKz0gMi4wO1xuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBGb29kIGZvY3VzIGFsaWdubWVudFxuICAgICAgLy8gRXh0cmFjdCBmaXJlIHZlbnVzIGRhdGEgd2l0aCBzYWZlIHByb3BlcnR5IGFjY2Vzc1xuICAgICAgY29uc3QgZmlyZVZlbnVzQW55ID0gZmlyZVZlbnVzIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+O1xuICAgICAgY29uc3QgZmlyZVZlbnVzRm9vZEZvY3VzID0gZmlyZVZlbnVzQW55Py5Gb29kRm9jdXM7XG4gICAgICBcbiAgICAgIGlmIChmaXJlVmVudXNGb29kRm9jdXMpIHtcbiAgICAgICAgY29uc3QgZm9jdXNLZXl3b3JkcyA9IGZpcmVWZW51c0Zvb2RGb2N1cy50b0xvd2VyQ2FzZSgpLnNwbGl0KC9bXFxzLDtdKy8pLmZpbHRlcihrID0+IGsubGVuZ3RoID4gMyk7XG4gICAgICAgIC8vIEV4dHJhY3QgaW5ncmVkaWVudCBkYXRhIHdpdGggc2FmZSBwcm9wZXJ0eSBhY2Nlc3NcbiAgICAgICAgY29uc3QgaW5ncmVkaWVudERhdGEgPSBpbmdyZWRpZW50IGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+O1xuICAgICAgICBjb25zdCBpbmdyZWRpZW50TmFtZSA9IGluZ3JlZGllbnREYXRhPy5uYW1lPy50b0xvd2VyQ2FzZSgpIHx8ICcnO1xuICAgICAgICBjb25zdCBpbmdyZWRpZW50RGVzY3JpcHRpb24gPSBpbmdyZWRpZW50RGF0YT8uZGVzY3JpcHRpb24/LnRvTG93ZXJDYXNlKCkgfHwgJyc7XG4gICAgICAgIFxuICAgICAgICBpZiAoZm9jdXNLZXl3b3Jkcy5zb21lKGtleXdvcmQgPT4gXG4gICAgICAgICAgICBpbmdyZWRpZW50TmFtZS5pbmNsdWRlcyhrZXl3b3JkKSB8fCBcbiAgICAgICAgICAgIGluZ3JlZGllbnREZXNjcmlwdGlvbi5pbmNsdWRlcyhrZXl3b3JkKSkpIHtcbiAgICAgICAgICBzY29yZSArPSAxLjU7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gRWxlbWVudHMgYWxpZ25tZW50XG4gICAgICAvLyBFeHRyYWN0IGZpcmUgdmVudXMgZWxlbWVudHMgd2l0aCBzYWZlIHByb3BlcnR5IGFjY2Vzc1xuICAgICAgY29uc3QgZmlyZVZlbnVzRWxlbWVudHMgPSBmaXJlVmVudXNBbnk/LkVsZW1lbnRzO1xuICAgICAgXG4gICAgICBpZiAoZmlyZVZlbnVzRWxlbWVudHMgJiYgaW5ncmVkaWVudC5lbGVtZW50YWxQcm9wZXJ0aWVzKSB7XG4gICAgICAgIGZvciAoY29uc3QgZWxlbWVudCBpbiBmaXJlVmVudXNFbGVtZW50cykge1xuICAgICAgICAgIGlmIChpbmdyZWRpZW50LmVsZW1lbnRhbFByb3BlcnRpZXNbZWxlbWVudF0pIHtcbiAgICAgICAgICAgIHNjb3JlICs9IGZpcmVWZW51c0VsZW1lbnRzW2VsZW1lbnRdICogaW5ncmVkaWVudC5lbGVtZW50YWxQcm9wZXJ0aWVzW2VsZW1lbnRdICogMS4wO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC8vIFJldHJvZ3JhZGUgbW9kaWZpZXJzXG4gIGlmIChpc1ZlbnVzUmV0cm9ncmFkZSAmJiB2ZW51c0RhdGEuUGxhbmV0U3BlY2lmaWM/LlJldHJvZ3JhZGUpIHtcbiAgICAvLyBJbmNyZWFzZSBzY29yZSBmb3IgcHJlc2VydmVkIG9yIGRyaWVkIGhlcmJzIGR1cmluZyByZXRyb2dyYWRlXG4gICAgY29uc3QgcHJlc2VydmF0aW9uTWV0aG9kcyA9IChpbmdyZWRpZW50IGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KT8ucHJlc2VydmF0aW9uX21ldGhvZHM7XG4gICAgY29uc3QgY2F0ZWdvcmllcyA9IChpbmdyZWRpZW50IGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KT8uY2F0ZWdvcmllcztcbiAgICBpZiAoXG4gICAgICAocHJlc2VydmF0aW9uTWV0aG9kcyAmJiBwcmVzZXJ2YXRpb25NZXRob2RzLmluY2x1ZGVzKCdkcmllZCcpKSB8fCBcbiAgICAgIChpbmdyZWRpZW50IGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KS5jYXRlZ29yeSA9PT0gJ2hlcmInIHx8XG4gICAgICAoY2F0ZWdvcmllcyAmJiBjYXRlZ29yaWVzLmluY2x1ZGVzKCdwcmVzZXJ2ZWQnKSlcbiAgICApIHtcbiAgICAgIHNjb3JlICo9IDEuNTtcbiAgICB9IGVsc2Uge1xuICAgICAgc2NvcmUgKj0gMC44OyAvLyBTbGlnaHRseSByZWR1Y2Ugb3RoZXIgaW5ncmVkaWVudHNcbiAgICB9XG4gICAgXG4gICAgLy8gTm9zdGFsZ2lhIGZvb2RzIGdldCBhIGJvb3N0IGR1cmluZyByZXRyb2dyYWRlXG4gICAgLy8gRXh0cmFjdCBpbmdyZWRpZW50IGRhdGEgd2l0aCBzYWZlIHByb3BlcnR5IGFjY2VzcyBmb3IgY3VsdHVyYWwgc2lnbmlmaWNhbmNlXG4gICAgY29uc3QgaW5ncmVkaWVudERhdGEgPSBpbmdyZWRpZW50IGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+O1xuICAgIGNvbnN0IGN1bHR1cmFsU2lnbmlmaWNhbmNlID0gaW5ncmVkaWVudERhdGE/LmN1bHR1cmFsX3NpZ25pZmljYW5jZTtcbiAgICBjb25zdCBjdWx0dXJhbFNpZ25pZmljYW5jZUFycmF5ID0gQXJyYXkuaXNBcnJheShjdWx0dXJhbFNpZ25pZmljYW5jZSkgPyBjdWx0dXJhbFNpZ25pZmljYW5jZSA6IFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICh0eXBlb2YgY3VsdHVyYWxTaWduaWZpY2FuY2UgPT09ICdzdHJpbmcnID8gW2N1bHR1cmFsU2lnbmlmaWNhbmNlXSA6IFtdKTtcbiAgICBcbiAgICBpZiAoY3VsdHVyYWxTaWduaWZpY2FuY2VBcnJheS5pbmNsdWRlcygndHJhZGl0aW9uYWwnKSB8fFxuICAgICAgICBjdWx0dXJhbFNpZ25pZmljYW5jZUFycmF5LmluY2x1ZGVzKCdub3N0YWxnaWMnKSkge1xuICAgICAgc2NvcmUgKz0gMS44O1xuICAgIH1cbiAgICBcbiAgICAvLyBDaGVjayByZXRyb2dyYWRlIGZvb2QgZm9jdXNcbiAgICAvLyBFeHRyYWN0IHJldHJvZ3JhZGUgZGF0YSB3aXRoIHNhZmUgcHJvcGVydHkgYWNjZXNzXG4gICAgY29uc3QgcmV0cm9ncmFkZURhdGEgPSB2ZW51c0RhdGEuUGxhbmV0U3BlY2lmaWMuUmV0cm9ncmFkZSBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPjtcbiAgICBjb25zdCByZXRyb0Zvb2RGb2N1cyA9IHJldHJvZ3JhZGVEYXRhPy5Gb29kRm9jdXM7XG4gICAgXG4gICAgaWYgKHJldHJvRm9vZEZvY3VzKSB7XG4gICAgICBjb25zdCByZXRyb0ZvY3VzID0gcmV0cm9Gb29kRm9jdXMudG9Mb3dlckNhc2UoKTtcbiAgICAgIC8vIEV4dHJhY3QgaW5ncmVkaWVudCBkYXRhIHdpdGggc2FmZSBwcm9wZXJ0eSBhY2Nlc3NcbiAgICAgIGNvbnN0IGluZ3JlZGllbnREYXRhID0gaW5ncmVkaWVudCBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPjtcbiAgICAgIGNvbnN0IGluZ3JlZGllbnROYW1lID0gaW5ncmVkaWVudERhdGE/Lm5hbWU/LnRvTG93ZXJDYXNlKCkgfHwgJyc7XG4gICAgICBjb25zdCBpbmdyZWRpZW50RGVzYyA9IGluZ3JlZGllbnREYXRhPy5kZXNjcmlwdGlvbj8udG9Mb3dlckNhc2UoKSB8fCAnJztcbiAgICAgIFxuICAgICAgLy8gQ2hlY2sgZm9yIGtleXdvcmQgbWF0Y2hlc1xuICAgICAgY29uc3QgcmV0cm9LZXl3b3JkcyA9IHJldHJvRm9jdXMuc3BsaXQoL1tcXHMsO10rLykuZmlsdGVyKGsgPT4gay5sZW5ndGggPiAzKTtcbiAgICAgIGZvciAoY29uc3Qga2V5d29yZCBvZiByZXRyb0tleXdvcmRzKSB7XG4gICAgICAgIGlmIChpbmdyZWRpZW50TmFtZS5pbmNsdWRlcyhrZXl3b3JkKSB8fCBpbmdyZWRpZW50RGVzYy5pbmNsdWRlcyhrZXl3b3JkKSkge1xuICAgICAgICAgIHNjb3JlICs9IDEuNztcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICAgICAgICAvLyBDaGVjayByZXRyb2dyYWRlIGVsZW1lbnRzXG4gICAgICAvLyBFeHRyYWN0IHJldHJvZ3JhZGUgZWxlbWVudHMgd2l0aCBzYWZlIHByb3BlcnR5IGFjY2Vzc1xuICAgICAgY29uc3QgcmV0cm9ncmFkZUVsZW1lbnRzID0gcmV0cm9ncmFkZURhdGE/LkVsZW1lbnRzO1xuICAgICAgXG4gICAgICBpZiAocmV0cm9ncmFkZUVsZW1lbnRzICYmIGluZ3JlZGllbnQuZWxlbWVudGFsUHJvcGVydGllcykge1xuICAgICAgICBcbiAgICAgICAgZm9yIChjb25zdCBlbGVtZW50IGluIHJldHJvZ3JhZGVFbGVtZW50cykge1xuICAgICAgICAgIGlmIChpbmdyZWRpZW50LmVsZW1lbnRhbFByb3BlcnRpZXNbZWxlbWVudF0pIHtcbiAgICAgICAgICAgIHNjb3JlICs9IHJldHJvZ3JhZGVFbGVtZW50c1tlbGVtZW50XSAqIFxuICAgICAgICAgICAgICAgICAgICAgaW5ncmVkaWVudC5lbGVtZW50YWxQcm9wZXJ0aWVzW2VsZW1lbnRdICogMC45O1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICB9XG4gIFxuICAvLyBMdW5hciBwaGFzZSBjb25uZWN0aW9ucyB3aXRoIFZlbnVzXG4gIC8vIEV4dHJhY3QgcGxhbmV0YXJ5IGRhdGEgd2l0aCBzYWZlIHByb3BlcnR5IGFjY2Vzc1xuICBjb25zdCB2ZW51c0RhdGFBbnkgPSB2ZW51c0RhdGEgYXMgTHVuYXJQaGFzZTtcbiAgY29uc3QgbHVuYXJDb25uZWN0aW9uID0gdmVudXNEYXRhQW55Py5MdW5hckNvbm5lY3Rpb247XG4gIFxuICBpZiAobHVuYXJDb25uZWN0aW9uKSB7XG4gICAgLy8gVGhpcyB3b3VsZCBiZSBjaGVja2VkIGFnYWluc3QgdGhlIGN1cnJlbnQgbHVuYXIgcGhhc2UgaW4gYSBmdWxsIGltcGxlbWVudGF0aW9uXG4gIH1cblxuICByZXR1cm4gc2NvcmU7XG59XG5cbi8vIEVuaGFuY2UgaW5ncmVkaWVudCBzY29yaW5nIHdpdGggVmVudXMgaW5mbHVlbmNlXG5mdW5jdGlvbiBfZW5oYW5jZVZlbnVzSW5ncmVkaWVudFNjb3JpbmcoXG4gIGluZ3JlZGllbnQ6IEluZ3JlZGllbnQsXG4gIGFzdHJvU3RhdGU6IEFzdHJvbG9naWNhbFN0YXRlLFxuICBzY29yZTogbnVtYmVyXG4pOiBudW1iZXIge1xuICAvLyBPbmx5IGFwcGx5IFZlbnVzIHNjb3JpbmcgaWYgVmVudXMgaXMgYWN0aXZlXG4gIGlmICghYXN0cm9TdGF0ZS5hY3RpdmVQbGFuZXRzPy5pbmNsdWRlcygnVmVudXMnKSkge1xuICAgIHJldHVybiBzY29yZTtcbiAgfVxuICBcbiAgLy8gR2V0IGN1cnJlbnQgem9kaWFjIHNpZ25cbiAgY29uc3Qgem9kaWFjU2lnbiA9IGFzdHJvU3RhdGUuem9kaWFjU2lnbiBhcyBzdHJpbmcgfCB1bmRlZmluZWQ7XG4gIFxuICAvLyBDaGVjayBpZiBWZW51cyBpcyByZXRyb2dyYWRlXG4gIC8vIEV4dHJhY3QgYXN0cm9sb2dpY2FsIHN0YXRlIHdpdGggc2FmZSBwcm9wZXJ0eSBhY2Nlc3NcbiAgY29uc3QgYXN0cm9TdGF0ZURhdGEgPSBhc3Ryb1N0YXRlIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+O1xuICBjb25zdCByZXRyb2dyYWRlQXJyYXkgPSBBcnJheS5pc0FycmF5KGFzdHJvU3RhdGVEYXRhPy5yZXRyb2dyYWRlKSA/IGFzdHJvU3RhdGVEYXRhLnJldHJvZ3JhZGUgOiBbXTtcbiAgY29uc3QgaXNWZW51c1JldHJvZ3JhZGUgPSByZXRyb2dyYWRlQXJyYXkuaW5jbHVkZXMoJ1ZlbnVzJykgfHwgZmFsc2U7XG4gIFxuICAvLyBDYWxjdWxhdGUgVmVudXMgaW5mbHVlbmNlIHNjb3JlXG4gIGNvbnN0IHZlbnVzSW5mbHVlbmNlID0gY2FsY3VsYXRlVmVudXNJbmZsdWVuY2UoaW5ncmVkaWVudCwgem9kaWFjU2lnbiwgaXNWZW51c1JldHJvZ3JhZGUpO1xuICBcbiAgLy8gQXBwbHkgVmVudXMgaW5mbHVlbmNlIHRvIHRoZSBiYXNlIHNjb3JlICh3ZWlnaHQgaXQgYXBwcm9wcmlhdGVseSlcbiAgcmV0dXJuIHNjb3JlICsgKHZlbnVzSW5mbHVlbmNlICogMC4zKTtcbn1cblxuLy8gRW5oYW5jZWQgZnVuY3Rpb24gdG8gYm9vc3QgVmVudXMtcnVsZWQgaW5ncmVkaWVudHMgYmFzZWQgb24gZGV0YWlsZWQgVmVudXMgZGF0YVxuZnVuY3Rpb24gZW5oYW5jZVZlbnVzSW5ncmVkaWVudEJhdGNoKGluZ3JlZGllbnRzOiBJbmdyZWRpZW50W10sIGFzdHJvU3RhdGU6IEFzdHJvbG9naWNhbFN0YXRlKTogdm9pZCB7XG4gIC8vIENoZWNrIGlmIFZlbnVzIGlzIGFjdGl2ZVxuICBjb25zdCBpc1ZlbnVzQWN0aXZlID0gYXN0cm9TdGF0ZS5hY3RpdmVQbGFuZXRzPy5pbmNsdWRlcygnVmVudXMnKTtcbiAgaWYgKCFpc1ZlbnVzQWN0aXZlKSB7XG4gICAgcmV0dXJuOyAvLyBTa2lwIFZlbnVzIHNjb3JpbmcgaWYgVmVudXMgaXMgbm90IGFjdGl2ZVxuICB9XG4gIFxuICAvLyBHZXQgY3VycmVudCB6b2RpYWMgc2lnblxuICBjb25zdCB6b2RpYWNTaWduID0gYXN0cm9TdGF0ZS56b2RpYWNTaWduIGFzIHN0cmluZyB8IHVuZGVmaW5lZDtcbiAgXG4gIC8vIENoZWNrIGlmIFZlbnVzIGlzIHJldHJvZ3JhZGVcbiAgLy8gRXh0cmFjdCBhc3Ryb2xvZ2ljYWwgc3RhdGUgd2l0aCBzYWZlIHByb3BlcnR5IGFjY2VzcyBmb3IgYmF0Y2ggcHJvY2Vzc2luZ1xuICBjb25zdCBhc3Ryb1N0YXRlRGF0YSA9IGFzdHJvU3RhdGUgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj47XG4gIGNvbnN0IHJldHJvZ3JhZGVBcnJheSA9IEFycmF5LmlzQXJyYXkoYXN0cm9TdGF0ZURhdGE/LnJldHJvZ3JhZGUpID8gYXN0cm9TdGF0ZURhdGEucmV0cm9ncmFkZSA6IFtdO1xuICBjb25zdCBpc1ZlbnVzUmV0cm9ncmFkZSA9IHJldHJvZ3JhZGVBcnJheS5pbmNsdWRlcygnVmVudXMnKSB8fCBmYWxzZTtcbiAgXG4gIC8vIEFkZCBhIFwidmVudXNTY29yZVwiIHByb3BlcnR5IHRvIGVhY2ggaW5ncmVkaWVudCBmb3Igc29ydGluZ1xuICBpbmdyZWRpZW50cy5mb3JFYWNoKGluZ3JlZGllbnQgPT4ge1xuICAgIC8vIFVzZSBvdXIgY29tcHJlaGVuc2l2ZSBWZW51cyBpbmZsdWVuY2UgY2FsY3VsYXRpb25cbiAgICBjb25zdCB2ZW51c1Njb3JlID0gY2FsY3VsYXRlVmVudXNJbmZsdWVuY2UoaW5ncmVkaWVudCwgem9kaWFjU2lnbiwgaXNWZW51c1JldHJvZ3JhZGUpO1xuICAgIFxuICAgIC8vIFN0b3JlIHRoZSBWZW51cyBzY29yZSB3aXRoIHRoZSBpbmdyZWRpZW50XG4gICAgKGluZ3JlZGllbnQgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pLnZlbnVzU2NvcmUgPSB2ZW51c1Njb3JlO1xuICB9KTtcbiAgXG4gIC8vIFNvcnQgaW5ncmVkaWVudHMgYnkgVmVudXMgc2NvcmVcbiAgaW5ncmVkaWVudHMuc29ydCgoYSwgYikgPT4ge1xuICAgIGNvbnN0IGFTY29yZSA9IChhIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KS52ZW51c1Njb3JlIHx8IDA7XG4gICAgY29uc3QgYlNjb3JlID0gKGIgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pLnZlbnVzU2NvcmUgfHwgMDtcbiAgICByZXR1cm4gYlNjb3JlIC0gYVNjb3JlO1xuICB9KTtcbn1cblxuLyoqXG4gKiBDYWxjdWxhdGVzIGEgTWFycyBpbmZsdWVuY2Ugc2NvcmUgZm9yIGFuIGluZ3JlZGllbnRcbiAqL1xuZnVuY3Rpb24gY2FsY3VsYXRlTWFyc0luZmx1ZW5jZShcbiAgaW5ncmVkaWVudDogSW5ncmVkaWVudCwgXG4gIHpvZGlhY1NpZ24/OiBzdHJpbmcsXG4gIGlzTWFyc1JldHJvZ3JhZGUgPSBmYWxzZVxuKTogbnVtYmVyIHtcbiAgbGV0IHNjb3JlID0gMDtcbiAgXG4gIC8vIEdldCB0aGUgbmFtZSBpbiBsb3dlcmNhc2UgZm9yIGNvbXBhcmlzb25cbiAgY29uc3QgbmFtZSA9IChpbmdyZWRpZW50IGFzIHN0cmluZyk/Lm5hbWUudG9Mb3dlckNhc2UoKTtcbiAgXG4gIC8vIE1hdGNoIHdpdGggTWFycyBmb29kIGFzc29jaWF0aW9uc1xuICBpZiAobWFyc0RhdGEuRm9vZEFzc29jaWF0aW9ucykge1xuICAgIGZvciAoY29uc3QgZm9vZCBvZiBtYXJzRGF0YS5Gb29kQXNzb2NpYXRpb25zKSB7XG4gICAgICBpZiAobmFtZS5pbmNsdWRlcyhmb29kLnRvTG93ZXJDYXNlKCkpIHx8IGZvb2QudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhuYW1lKSkge1xuICAgICAgICBzY29yZSArPSAxLjU7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICBcbiAgLy8gTWF0Y2ggd2l0aCBNYXJzIGhlcmIgYXNzb2NpYXRpb25zIChzdHJvbmdlciBhZmZpbml0eSlcbiAgaWYgKG1hcnNEYXRhLkhlcmJhbEFzc29jaWF0aW9ucz8uSGVyYnMpIHtcbiAgICBmb3IgKGNvbnN0IGhlcmIgb2YgbWFyc0RhdGEuSGVyYmFsQXNzb2NpYXRpb25zLkhlcmJzKSB7XG4gICAgICBpZiAobmFtZS5pbmNsdWRlcyhoZXJiLnRvTG93ZXJDYXNlKCkpIHx8IGhlcmIudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhuYW1lKSkge1xuICAgICAgICBzY29yZSArPSAyLjA7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICBcbiAgLy8gRmxhdm9yIHByb2ZpbGUgYWxpZ25tZW50XG4gIC8vIEV4dHJhY3QgaW5ncmVkaWVudCBkYXRhIHdpdGggc2FmZSBwcm9wZXJ0eSBhY2Nlc3MgZm9yIGZsYXZvciBwcm9maWxlXG4gIGNvbnN0IGluZ3JlZGllbnREYXRhID0gaW5ncmVkaWVudCBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPjtcbiAgY29uc3QgaW5ncmVkaWVudEZsYXZvclByb2ZpbGUgPSBpbmdyZWRpZW50RGF0YT8uZmxhdm9yUHJvZmlsZTtcbiAgXG4gIGlmIChtYXJzRGF0YS5GbGF2b3JQcm9maWxlcyAmJiBpbmdyZWRpZW50Rmxhdm9yUHJvZmlsZSkge1xuICAgIGZvciAoY29uc3QgZmxhdm9yIGluIG1hcnNEYXRhLkZsYXZvclByb2ZpbGVzKSB7XG4gICAgICBpZiAoaW5ncmVkaWVudEZsYXZvclByb2ZpbGVbZmxhdm9yXSkge1xuICAgICAgICAvLyBIaWdoZXIgc2NvcmUgd2hlbiBib3RoIGhhdmUgaGlnaCB2YWx1ZXMgZm9yIHNhbWUgZmxhdm9yXG4gICAgICAgIHNjb3JlICs9IG1hcnNEYXRhLkZsYXZvclByb2ZpbGVzW2ZsYXZvcl0gKiBpbmdyZWRpZW50Rmxhdm9yUHJvZmlsZVtmbGF2b3JdO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICBcbiAgLy8gRWxlbWVudGFsIGFsaWdubWVudFxuICBpZiAoKGluZ3JlZGllbnQgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pPy5lbGVtZW50YWxQcm9wZXJ0aWVzKSB7XG4gICAgLy8gTWFycyBpcyBwcmltYXJpbHkgRmlyZSwgc2Vjb25kYXJpbHkgV2F0ZXJcbiAgICBjb25zdCBmaXJlU2NvcmUgPSAoaW5ncmVkaWVudCBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPik/LmVsZW1lbnRhbFByb3BlcnRpZXMuRmlyZSB8fCAwO1xuICAgIGNvbnN0IHdhdGVyU2NvcmUgPSAoaW5ncmVkaWVudCBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPik/LmVsZW1lbnRhbFByb3BlcnRpZXMuV2F0ZXIgfHwgMDtcbiAgICBcbiAgICBzY29yZSArPSBmaXJlU2NvcmUgKiAxLjU7IC8vIFByaW1hcnkgZWxlbWVudCBnZXRzIGhpZ2hlciB3ZWlnaHRcbiAgICBzY29yZSArPSB3YXRlclNjb3JlICogMC44OyAvLyBTZWNvbmRhcnkgZWxlbWVudFxuICB9XG4gIFxuICAvLyBab2RpYWMgc2lnbiBzcGVjaWZpYyBib29zdFxuICBpZiAoem9kaWFjU2lnbiAmJiBtYXJzRGF0YS5QbGFuZXRTcGVjaWZpYz8uWm9kaWFjVHJhbnNpdCkge1xuICAgIGNvbnN0IHRyYW5zaXQgPSBtYXJzRGF0YS5QbGFuZXRTcGVjaWZpYy5ab2RpYWNUcmFuc2l0W3pvZGlhY1NpZ25dO1xuICAgIFxuICAgIC8vIENoZWNrIGlmIGluZ3JlZGllbnQgaXMgaW4gdGhlIHRyYW5zaXQncyBpbmdyZWRpZW50IGxpc3RcbiAgICBpZiAodHJhbnNpdCAmJiB0cmFuc2l0LkluZ3JlZGllbnRzKSB7XG4gICAgICBmb3IgKGNvbnN0IHRyYW5zaXRJbmdyZWRpZW50IG9mIHRyYW5zaXQuSW5ncmVkaWVudHMpIHtcbiAgICAgICAgaWYgKG5hbWUuaW5jbHVkZXModHJhbnNpdEluZ3JlZGllbnQudG9Mb3dlckNhc2UoKSkgfHwgXG4gICAgICAgICAgICB0cmFuc2l0SW5ncmVkaWVudC50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKG5hbWUpKSB7XG4gICAgICAgICAgc2NvcmUgKz0gMi41OyAvLyBTdHJvbmcgYm9vc3QgZm9yIGV4YWN0IGluZ3JlZGllbnQgbWF0Y2ggaW4gY3VycmVudCB6b2RpYWNcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICAvLyBDaGVjayBlbGVtZW50IGFsaWdubWVudCB3aXRoIHRyYW5zaXRcbiAgICBpZiAodHJhbnNpdCAmJiB0cmFuc2l0LkVsZW1lbnRzICYmIChpbmdyZWRpZW50IGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KT8uZWxlbWVudGFsUHJvcGVydGllcykge1xuICAgICAgZm9yIChjb25zdCBlbGVtZW50IGluIHRyYW5zaXQuRWxlbWVudHMpIHtcbiAgICAgICAgY29uc3QgZWxlbVZhbHVlID0gZWxlbWVudCBhcyBrZXlvZiBFbGVtZW50YWxQcm9wZXJ0aWVzO1xuICAgICAgICBpZiAoKGluZ3JlZGllbnQgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pPy5lbGVtZW50YWxQcm9wZXJ0aWVzW2VsZW1WYWx1ZV0pIHtcbiAgICAgICAgICBzY29yZSArPSB0cmFuc2l0LkVsZW1lbnRzW2VsZW1lbnRdICogKGluZ3JlZGllbnQgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pPy5lbGVtZW50YWxQcm9wZXJ0aWVzW2VsZW1WYWx1ZV0gKiAxLjI7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgXG4gIC8vIE1hcnMgcmV0cm9ncmFkZSBlZmZlY3RzXG4gIGlmIChpc01hcnNSZXRyb2dyYWRlICYmIG1hcnNEYXRhLlBsYW5ldFNwZWNpZmljPy5SZXRyb2dyYWRlKSB7XG4gICAgLy8gRHVyaW5nIHJldHJvZ3JhZGUsIE1hcnMgZW1waGFzaXplcyBkcmllZCBoZXJicyBhbmQgc3BpY2VzXG4gICAgLy8gRXh0cmFjdCBpbmdyZWRpZW50IGRhdGEgd2l0aCBzYWZlIHByb3BlcnR5IGFjY2VzcyBmb3IgdHlwZVxuICAgIGNvbnN0IGluZ3JlZGllbnREYXRhID0gaW5ncmVkaWVudCBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPjtcbiAgICBjb25zdCBpbmdyZWRpZW50VHlwZSA9IGluZ3JlZGllbnREYXRhPy50eXBlIHx8IGluZ3JlZGllbnREYXRhPy5jYXRlZ29yeSB8fCAnJztcbiAgICBcbiAgICBpZiAoaW5ncmVkaWVudFR5cGUgPT09ICdzcGljZScgfHwgaW5ncmVkaWVudFR5cGUgPT09ICdoZXJiJyB8fCBpbmdyZWRpZW50VHlwZSA9PT0gJ3NlYXNvbmluZycpIHtcbiAgICAgIHNjb3JlICs9IDEuNTtcbiAgICB9XG4gICAgXG4gICAgLy8gRm9jdXMgc2hpZnRzIHRvIHRyYWRpdGlvbmFsIHVzZXNcbiAgICAvLyBFeHRyYWN0IGluZ3JlZGllbnQgZGF0YSB3aXRoIHNhZmUgcHJvcGVydHkgYWNjZXNzIGZvciB0cmFkaXRpb25hbCBwcm9wZXJ0eVxuICAgIGNvbnN0IGluZ3JlZGllbnRUcmFkaXRpb25hbCA9IGluZ3JlZGllbnREYXRhPy50cmFkaXRpb25hbDtcbiAgICBpZiAoaW5ncmVkaWVudFRyYWRpdGlvbmFsKSB7XG4gICAgICBzY29yZSArPSAxLjI7XG4gICAgfVxuICB9XG4gIFxuICAvLyBBZGp1c3QgZm9yIE1hcnMgdGVtcGVyYW1lbnQgYmFzZWQgb24gZG9taW5hbnQgZWxlbWVudFxuICBpZiAoKGluZ3JlZGllbnQgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pPy5lbGVtZW50YWxQcm9wZXJ0aWVzKSB7XG4gICAgY29uc3QgZmlyZURvbWluYW50ID0gKChpbmdyZWRpZW50IGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KT8uZWxlbWVudGFsUHJvcGVydGllcy5GaXJlIHx8IDApID4gMC42O1xuICAgIGNvbnN0IHdhdGVyRG9taW5hbnQgPSAoKGluZ3JlZGllbnQgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pPy5lbGVtZW50YWxQcm9wZXJ0aWVzLldhdGVyIHx8IDApID4gMC42O1xuICAgIFxuICAgIC8vIEV4dHJhY3QgTWFycyB0ZW1wZXJhbWVudCBkYXRhIHdpdGggc2FmZSBwcm9wZXJ0eSBhY2Nlc3NcbiAgICBjb25zdCBtYXJzVGVtcGVyYW1lbnQgPSBtYXJzRGF0YS5QbGFuZXRTcGVjaWZpYz8uQ3VsaW5hcnlUZW1wZXJhbWVudCBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPjtcbiAgICBjb25zdCBmaXJlTWFycyA9IG1hcnNUZW1wZXJhbWVudD8uRmlyZU1hcnM7XG4gICAgY29uc3Qgd2F0ZXJNYXJzID0gbWFyc1RlbXBlcmFtZW50Py5XYXRlck1hcnM7XG4gICAgXG4gICAgaWYgKGZpcmVEb21pbmFudCAmJiBmaXJlTWFycykge1xuICAgICAgc2NvcmUgKz0gMS41O1xuICAgIH0gZWxzZSBpZiAod2F0ZXJEb21pbmFudCAmJiB3YXRlck1hcnMpIHtcbiAgICAgIHNjb3JlICs9IDEuMztcbiAgICB9XG4gIH1cbiAgXG4gIHJldHVybiBzY29yZTtcbn1cblxuLyoqXG4gKiBBcHBseSBNYXJzLXNwZWNpZmljIHNjb3JpbmcgdG8gYSBjb2xsZWN0aW9uIG9mIGluZ3JlZGllbnRzXG4gKi9cbmZ1bmN0aW9uIGVuaGFuY2VNYXJzSW5ncmVkaWVudFNjb3JpbmcoaW5ncmVkaWVudHM6IEluZ3JlZGllbnRbXSwgYXN0cm9TdGF0ZTogQXN0cm9sb2dpY2FsU3RhdGUpOiB2b2lkIHtcbiAgLy8gR2V0IE1hcnMgc3RhdHVzIGluZm8gZnJvbSBhc3RybyBzdGF0ZVxuICAvLyBFeHRyYWN0IGFzdHJvbG9naWNhbCBzdGF0ZSB3aXRoIHNhZmUgcHJvcGVydHkgYWNjZXNzIGZvciBNYXJzIHJldHJvZ3JhZGVcbiAgY29uc3QgYXN0cm9TdGF0ZURhdGEgPSBhc3Ryb1N0YXRlIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+O1xuICBjb25zdCByZXRyb2dyYWRlQXJyYXkgPSBBcnJheS5pc0FycmF5KGFzdHJvU3RhdGVEYXRhPy5yZXRyb2dyYWRlKSA/IGFzdHJvU3RhdGVEYXRhLnJldHJvZ3JhZGUgOiBbXTtcbiAgY29uc3QgaXNNYXJzUmV0cm9ncmFkZSA9IHJldHJvZ3JhZGVBcnJheS5pbmNsdWRlcygnTWFycycpIHx8IGZhbHNlO1xuICBjb25zdCB6b2RpYWNTaWduID0gYXN0cm9TdGF0ZS56b2RpYWNTaWduO1xuICBcbiAgLy8gQ29tcHV0ZSBNYXJzIGluZmx1ZW5jZSBmb3IgZWFjaCBpbmdyZWRpZW50XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgaW5ncmVkaWVudHMubGVuZ3RoOyBpKyspIHtcbiAgICBjb25zdCBpbmdyZWRpZW50ID0gaW5ncmVkaWVudHNbaV07XG4gICAgXG4gICAgLy8gT25seSBwcm9jZXNzIGlmIGl0IGhhcyBuZWNlc3NhcnkgZGF0YVxuICAgIC8vIEV4dHJhY3QgaW5ncmVkaWVudCBkYXRhIHdpdGggc2FmZSBwcm9wZXJ0eSBhY2Nlc3NcbiAgICBjb25zdCBpbmdyZWRpZW50RGF0YSA9IGluZ3JlZGllbnQgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj47XG4gICAgY29uc3QgaW5ncmVkaWVudE5hbWUgPSBpbmdyZWRpZW50RGF0YT8ubmFtZTtcbiAgICBjb25zdCBpbmdyZWRpZW50TWF0Y2hTY29yZSA9IGluZ3JlZGllbnREYXRhPy5tYXRjaFNjb3JlO1xuICAgIFxuICAgIGlmICghaW5ncmVkaWVudE5hbWUgfHwgIWluZ3JlZGllbnRNYXRjaFNjb3JlKSBjb250aW51ZTtcbiAgICBcbiAgICAvLyBDYWxjdWxhdGUgTWFycyBpbmZsdWVuY2VcbiAgICBjb25zdCBtYXJzSW5mbHVlbmNlID0gY2FsY3VsYXRlTWFyc0luZmx1ZW5jZShcbiAgICAgIGluZ3JlZGllbnQsXG4gICAgICB6b2RpYWNTaWduLFxuICAgICAgaXNNYXJzUmV0cm9ncmFkZVxuICAgICk7XG4gICAgXG4gICAgLy8gQXBwbHkgTWFycyBib29zdCB0byBtYXRjaCBzY29yZVxuICAgIGlmIChtYXJzSW5mbHVlbmNlID4gMCkge1xuICAgICAgLy8gSW5jbHVkZSB0aGUgb3JpZ2luYWwgc2NvcmUsIGFkZCB0aGUgTWFycyBpbmZsdWVuY2VcbiAgICAgIGluZ3JlZGllbnREYXRhLm1hdGNoU2NvcmUgPSAoaW5ncmVkaWVudERhdGEubWF0Y2hTY29yZSB8fCAwKSArIChtYXJzSW5mbHVlbmNlICogMS44KTtcbiAgICAgIFxuICAgICAgLy8gQWRkIGEgZmxhZyBvciBkYXRhIHBvaW50IHRvIGluZGljYXRlIE1hcnMgaW5mbHVlbmNlIHdhcyBhcHBsaWVkXG4gICAgICBpZiAoIWluZ3JlZGllbnREYXRhLmluZmx1ZW5jZXMpIHtcbiAgICAgICAgaW5ncmVkaWVudERhdGEuaW5mbHVlbmNlcyA9IHt9O1xuICAgICAgfVxuICAgICAgaW5ncmVkaWVudERhdGEuaW5mbHVlbmNlcy5tYXJzID0gbWFyc0luZmx1ZW5jZTtcbiAgICB9XG4gIH1cbiAgXG4gIC8vIFJlLXNvcnQgdGhlIGluZ3JlZGllbnRzIGJhc2VkIG9uIHRoZSB1cGRhdGVkIHNjb3Jlc1xuICBpbmdyZWRpZW50cy5zb3J0KChhLCBiKSA9PiB7XG4gICAgY29uc3QgYURhdGEgPSBhIGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+O1xuICAgIGNvbnN0IGJEYXRhID0gYiBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPjtcbiAgICByZXR1cm4gKGJEYXRhLm1hdGNoU2NvcmUgfHwgMCkgLSAoYURhdGEubWF0Y2hTY29yZSB8fCAwKTtcbiAgfSk7XG59XG5cbi8vIEFkZCB0aGUgbmV3IGZ1bmN0aW9uIGZvciBNZXJjdXJ5IGFzc29jaWF0ZWQgaW5ncmVkaWVudHNcbmZ1bmN0aW9uIGlzTWVyY3VyeUFzc29jaWF0ZWRJbmdyZWRpZW50KGluZ3JlZGllbnROYW1lOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgaWYgKCFpbmdyZWRpZW50TmFtZSkgcmV0dXJuIGZhbHNlO1xuICBcbiAgY29uc3QgbG93ZXJJbmdyZWRpZW50ID0gaW5ncmVkaWVudE5hbWUudG9Mb3dlckNhc2UoKTtcbiAgXG4gIC8vIENoZWNrIGRpcmVjdCBNZXJjdXJ5IGZvb2QgYXNzb2NpYXRpb25zXG4gIGlmIChtZXJjdXJ5RGF0YS5Gb29kQXNzb2NpYXRpb25zICYmIG1lcmN1cnlEYXRhLkZvb2RBc3NvY2lhdGlvbnMuc29tZShmb29kID0+IFxuICAgICAgZm9vZC50b0xvd2VyQ2FzZSgpID09PSBsb3dlckluZ3JlZGllbnQgfHwgXG4gICAgICBsb3dlckluZ3JlZGllbnQuaW5jbHVkZXMoZm9vZC50b0xvd2VyQ2FzZSgpKSB8fFxuICAgICAgZm9vZC50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKGxvd2VySW5ncmVkaWVudClcbiAgICApKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgXG4gIC8vIENoZWNrIE1lcmN1cnkgaGVyYiBhc3NvY2lhdGlvbnNcbiAgaWYgKG1lcmN1cnlEYXRhLkhlcmJhbEFzc29jaWF0aW9ucz8uSGVyYnMgJiYgbWVyY3VyeURhdGEuSGVyYmFsQXNzb2NpYXRpb25zLkhlcmJzLnNvbWUoaGVyYiA9PiBcbiAgICAgIGhlcmIudG9Mb3dlckNhc2UoKSA9PT0gbG93ZXJJbmdyZWRpZW50IHx8IFxuICAgICAgbG93ZXJJbmdyZWRpZW50LmluY2x1ZGVzKGhlcmIudG9Mb3dlckNhc2UoKSkgfHxcbiAgICAgIGhlcmIudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhsb3dlckluZ3JlZGllbnQpXG4gICAgKSkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIFxuICAvLyBDaGVjayBmb3IgTWVyY3VyeSBlbGVtZW50YWwgY29ubmVjdGlvbiB0aHJvdWdoIGZsYXZvciBwcm9maWxlXG4gIC8vIE1lcmN1cnkgZW1waGFzaXplcyBjb21wbGV4aXR5LCB2YXJpZXR5LCBtdWx0aXBsZSBpbmdyZWRpZW50cywgYW5kIGNvbnRyYXN0aW5nIGZsYXZvcnNcbiAgY29uc3QgbWVyY3VyeUZsYXZvclNpZ25hbHMgPSBbXG4gICAgJ21peGVkJywgJ2JsZW5kJywgJ2luZnVzZWQnLCAnY29tcGxleCcsICdsYXllcmVkJywgJ2Fyb21hdGljJywgXG4gICAgJ2hlcmInLCAnbWludCcsICdhbmlzZScsICdmZW5uZWwnLCAnZGlsbCcsICdsaWdodCcsICdjaXRydXMnLFxuICAgICd2YXJpZWQnLCAnZnVzaW9uJywgJ211bHRpJywgJ2ZyZXNoJywgJ3N0aW11bGFudCcsICd0ZWEnLFxuICAgICdzZWVkcycsICdudXRzJywgJ2dyYWluJ1xuICBdO1xuICBcbiAgaWYgKG1lcmN1cnlGbGF2b3JTaWduYWxzLnNvbWUoc2lnbmFsID0+IGxvd2VySW5ncmVkaWVudC5pbmNsdWRlcyhzaWduYWwpKSkge1xuICAgIHJldHVybiB0cnVlO1xuICB9XG4gIFxuICAvLyBNZXJjdXJ5IGlzIGFzc29jaWF0ZWQgd2l0aCBBaXIgYW5kIEVhcnRoIGVsZW1lbnRzXG4gIC8vIExpZ2h0ZXIgaW5ncmVkaWVudHMgKEFpcikgYW5kIGdyb3VuZGluZyBpbmdyZWRpZW50cyAoRWFydGgpXG4gIGlmIChsb3dlckluZ3JlZGllbnQuaW5jbHVkZXMoJ2FpcicpIHx8IGxvd2VySW5ncmVkaWVudC5pbmNsdWRlcygnbGlnaHQnKSB8fCBcbiAgICAgIGxvd2VySW5ncmVkaWVudC5pbmNsdWRlcygncHVmZicpIHx8IGxvd2VySW5ncmVkaWVudC5pbmNsdWRlcygnY3Jpc3AnKSB8fFxuICAgICAgbG93ZXJJbmdyZWRpZW50LmluY2x1ZGVzKCdlYXJ0aCcpIHx8IGxvd2VySW5ncmVkaWVudC5pbmNsdWRlcygncm9vdCcpIHx8XG4gICAgICBsb3dlckluZ3JlZGllbnQuaW5jbHVkZXMoJ3R1YmVyJykpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICBcbiAgLy8gQ2hlY2sgTWVyY3VyeSBab2RpYWNUcmFuc2l0IGluZ3JlZGllbnQgYXNzb2NpYXRpb25zIGluIGN1cnJlbnQgc2lnblxuICAvLyBUaGlzIGlzIGEgbW9yZSBkeW5hbWljIHdheSB0byBjaGVjayBmb3IgdHJhbnNpZW50IGFzc29jaWF0aW9uc1xuICBjb25zdCBjdXJyZW50Wm9kaWFjU2lnbiA9ICdhcmllcyc7IC8vIFVzZSBmYWxsYmFjayBvciBpbXBsZW1lbnQgZ2V0Q3VycmVudFpvZGlhY1NpZ24gZnVuY3Rpb25cbiAgaWYgKGN1cnJlbnRab2RpYWNTaWduICYmIG1lcmN1cnlEYXRhLlBsYW5ldFNwZWNpZmljPy5ab2RpYWNUcmFuc2l0Py5bY3VycmVudFpvZGlhY1NpZ25dPy5JbmdyZWRpZW50cykge1xuICAgIGNvbnN0IHRyYW5zaXRJbmdyZWRpZW50cyA9IG1lcmN1cnlEYXRhLlBsYW5ldFNwZWNpZmljLlpvZGlhY1RyYW5zaXRbY3VycmVudFpvZGlhY1NpZ25dLkluZ3JlZGllbnRzO1xuICAgIGlmICh0cmFuc2l0SW5ncmVkaWVudHMuc29tZShpbmdyZWRpZW50ID0+IFxuICAgICAgICBpbmdyZWRpZW50LnRvTG93ZXJDYXNlKCkgPT09IGxvd2VySW5ncmVkaWVudCB8fFxuICAgICAgICBsb3dlckluZ3JlZGllbnQuaW5jbHVkZXMoaW5ncmVkaWVudC50b0xvd2VyQ2FzZSgpKSB8fFxuICAgICAgICBpbmdyZWRpZW50LnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMobG93ZXJJbmdyZWRpZW50KVxuICAgICAgKSkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9XG4gIFxuICByZXR1cm4gZmFsc2U7XG59XG5cbi8vIEFkZCB0aGUgZnVuY3Rpb24gdG8gY2FsY3VsYXRlIE1lcmN1cnkgaW5mbHVlbmNlIG9uIGluZ3JlZGllbnRzXG5mdW5jdGlvbiBjYWxjdWxhdGVNZXJjdXJ5SW5mbHVlbmNlKFxuICBpbmdyZWRpZW50OiBJbmdyZWRpZW50LCBcbiAgem9kaWFjU2lnbj86IHN0cmluZyxcbiAgaXNNZXJjdXJ5UmV0cm9ncmFkZSA9IGZhbHNlXG4pOiBudW1iZXIge1xuICBsZXQgc2NvcmUgPSAwO1xuICBcbiAgLy8gQmFzZSBzY29yZSBmb3IgTWVyY3VyeS1ydWxlZCBpbmdyZWRpZW50c1xuICBpZiAoKGluZ3JlZGllbnQgYXMgc3RyaW5nKT8uYXN0cm9sb2dpY2FsUHJvZmlsZT8ucnVsaW5nUGxhbmV0cz8uaW5jbHVkZXMoJ01lcmN1cnknKSkge1xuICAgIHNjb3JlICs9IDMuMDsgLy8gU3Ryb25nIGJhc2VsaW5lIGZvciBNZXJjdXJ5LXJ1bGVkIGluZ3JlZGllbnRzXG4gIH1cbiAgXG4gIC8vIE1lcmN1cnkgZm9vZCBhc3NvY2lhdGlvbnNcbiAgaWYgKG1lcmN1cnlEYXRhLkZvb2RBc3NvY2lhdGlvbnMpIHtcbiAgICBmb3IgKGNvbnN0IGZvb2Qgb2YgbWVyY3VyeURhdGEuRm9vZEFzc29jaWF0aW9ucykge1xuICAgICAgaWYgKChpbmdyZWRpZW50IGFzIHN0cmluZyk/Lm5hbWUudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyhmb29kLnRvTG93ZXJDYXNlKCkpIHx8XG4gICAgICAgICAgZm9vZC50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKChpbmdyZWRpZW50IGFzIHN0cmluZyk/Lm5hbWUudG9Mb3dlckNhc2UoKSkpIHtcbiAgICAgICAgc2NvcmUgKz0gMi4wO1xuICAgICAgICBicmVhaztcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgXG4gIC8vIE1lcmN1cnkgaGVyYiBhc3NvY2lhdGlvbnNcbiAgLy8gRXh0cmFjdCBpbmdyZWRpZW50IGRhdGEgd2l0aCBzYWZlIHByb3BlcnR5IGFjY2VzcyBmb3IgdHlwZVxuICBjb25zdCBpbmdyZWRpZW50RGF0YSA9IGluZ3JlZGllbnQgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj47XG4gIGNvbnN0IGluZ3JlZGllbnRUeXBlID0gaW5ncmVkaWVudERhdGE/LnR5cGUgfHwgaW5ncmVkaWVudERhdGE/LmNhdGVnb3J5IHx8ICcnO1xuICBcbiAgaWYgKG1lcmN1cnlEYXRhLkhlcmJhbEFzc29jaWF0aW9ucz8uSGVyYnMgJiYgXG4gICAgICAoaW5ncmVkaWVudFR5cGUgPT09ICdoZXJiJyB8fCBpbmdyZWRpZW50VHlwZSA9PT0gJ3NwaWNlJykpIHtcbiAgICBmb3IgKGNvbnN0IGhlcmIgb2YgbWVyY3VyeURhdGEuSGVyYmFsQXNzb2NpYXRpb25zLkhlcmJzKSB7XG4gICAgICBpZiAoKGluZ3JlZGllbnQgYXMgc3RyaW5nKT8ubmFtZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKGhlcmIudG9Mb3dlckNhc2UoKSkgfHxcbiAgICAgICAgICBoZXJiLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoKGluZ3JlZGllbnQgYXMgc3RyaW5nKT8ubmFtZS50b0xvd2VyQ2FzZSgpKSkge1xuICAgICAgICBzY29yZSArPSAyLjU7IC8vIEhpZ2hlciBzY29yZSBmb3IgZGlyZWN0IE1lcmN1cnkgaGVyYiBhc3NvY2lhdGlvbnNcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIFxuICAvLyBFbGVtZW50YWwgYWZmaW5pdGllcyBiYXNlZCBvbiBNZXJjdXJ5J3MgZWxlbWVudHNcbiAgaWYgKChpbmdyZWRpZW50IGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KT8uZWxlbWVudGFsUHJvcGVydGllcykge1xuICAgIC8vIE1lcmN1cnkncyBwcmltYXJ5IGVsZW1lbnRzIGFyZSBBaXIgYW5kIEVhcnRoXG4gICAgc2NvcmUgKz0gKChpbmdyZWRpZW50IGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KT8uZWxlbWVudGFsUHJvcGVydGllcy5BaXIgfHwgMCkgKiAyLjA7XG4gICAgc2NvcmUgKz0gKChpbmdyZWRpZW50IGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KT8uZWxlbWVudGFsUHJvcGVydGllcy5FYXJ0aCB8fCAwKSAqIDEuODtcbiAgfVxuICBcbiAgLy8gQWRkIHNjb3JlcyBiYXNlZCBvbiB6b2RpYWMgc2lnbiBpZiBwcm92aWRlZFxuICBpZiAoem9kaWFjU2lnbikge1xuICAgIGNvbnN0IGxvd2VyU2lnbiA9IHpvZGlhY1NpZ24udG9Mb3dlckNhc2UoKTtcbiAgICBcbiAgICAvLyBCb29zdCBpZiBpbmdyZWRpZW50IGhhcyBhZmZpbml0eSB3aXRoIHRoZSBjdXJyZW50IHNpZ25cbiAgICBpZiAoKGluZ3JlZGllbnQgYXMgc3RyaW5nKT8uYXN0cm9sb2dpY2FsUHJvZmlsZT8uc2lnbkFmZmluaXRpZXM/LmluY2x1ZGVzKGxvd2VyU2lnbikpIHtcbiAgICAgIHNjb3JlICs9IDEuNTtcbiAgICB9XG4gICAgXG4gICAgLy8gQ2hlY2sgTWVyY3VyeSdzIHpvZGlhYyB0cmFuc2l0IGRhdGEgZm9yIHRoaXMgc2lnblxuICAgIGNvbnN0IG1lcmN1cnlUcmFuc2l0ID0gbWVyY3VyeURhdGEuUGxhbmV0U3BlY2lmaWM/LlpvZGlhY1RyYW5zaXQ/Llt6b2RpYWNTaWduXTtcbiAgICBpZiAobWVyY3VyeVRyYW5zaXQpIHtcbiAgICAgIC8vIEJvb3N0IGZvciBpbmdyZWRpZW50cyBtYXRjaGluZyB0cmFuc2l0IGluZ3JlZGllbnRzXG4gICAgICBpZiAobWVyY3VyeVRyYW5zaXQuSW5ncmVkaWVudHMgJiYgbWVyY3VyeVRyYW5zaXQuSW5ncmVkaWVudHMuc29tZSh0cmFuc2l0SW5ncmVkaWVudCA9PiBcbiAgICAgICAgICAoaW5ncmVkaWVudCBhcyBzdHJpbmcpPy5uYW1lLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXModHJhbnNpdEluZ3JlZGllbnQudG9Mb3dlckNhc2UoKSkgfHxcbiAgICAgICAgICB0cmFuc2l0SW5ncmVkaWVudC50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKChpbmdyZWRpZW50IGFzIHN0cmluZyk/Lm5hbWUudG9Mb3dlckNhc2UoKSlcbiAgICAgICAgKSkge1xuICAgICAgICBzY29yZSArPSAyLjU7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIEVsZW1lbnQgYWxpZ25tZW50IHdpdGggTWVyY3VyeSBpbiB0aGlzIHNpZ25cbiAgICAgIGlmIChtZXJjdXJ5VHJhbnNpdC5FbGVtZW50cyAmJiAoaW5ncmVkaWVudCBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPik/LmVsZW1lbnRhbFByb3BlcnRpZXMpIHtcbiAgICAgICAgZm9yIChjb25zdCBlbGVtZW50IGluIG1lcmN1cnlUcmFuc2l0LkVsZW1lbnRzKSB7XG4gICAgICAgICAgY29uc3QgZWxlbUtleSA9IGVsZW1lbnQgYXMga2V5b2YgRWxlbWVudGFsUHJvcGVydGllcztcbiAgICAgICAgICBpZiAoKGluZ3JlZGllbnQgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pPy5lbGVtZW50YWxQcm9wZXJ0aWVzW2VsZW1LZXldKSB7XG4gICAgICAgICAgICBzY29yZSArPSBtZXJjdXJ5VHJhbnNpdC5FbGVtZW50c1tlbGVtZW50XSAqIChpbmdyZWRpZW50IGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KT8uZWxlbWVudGFsUHJvcGVydGllc1tlbGVtS2V5XSAqIDEuMjtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gICAgXG4gICAgLy8gU3BlY2lhbCBzY29yaW5nIGZvciBNZXJjdXJ5IGluIGl0cyBkb21pY2lsZSBzaWduc1xuICAgIGlmIChsb3dlclNpZ24gPT09ICdnZW1pbmknIHx8IGxvd2VyU2lnbiA9PT0gJ3ZpcmdvJykge1xuICAgICAgaWYgKChpbmdyZWRpZW50IGFzIHN0cmluZyk/LmFzdHJvbG9naWNhbFByb2ZpbGU/LnJ1bGluZ1BsYW5ldHM/LmluY2x1ZGVzKCdNZXJjdXJ5JykpIHtcbiAgICAgICAgc2NvcmUgKz0gMi4wOyAvLyBFeHRyYSBib29zdCBmb3IgTWVyY3VyeSBydWxpbmcgd2hlbiBNZXJjdXJ5IGlzIGluIGRvbWljaWxlXG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIFNwZWNpYWwgaGFuZGxpbmcgZm9yIEdlbWluaSAoQWlyKSBhbmQgVmlyZ28gKEVhcnRoKVxuICAgICAgaWYgKGxvd2VyU2lnbiA9PT0gJ2dlbWluaScgJiYgKGluZ3JlZGllbnQgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pPy5lbGVtZW50YWxQcm9wZXJ0aWVzPy5BaXIpIHtcbiAgICAgICAgc2NvcmUgKz0gKGluZ3JlZGllbnQgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pPy5lbGVtZW50YWxQcm9wZXJ0aWVzLkFpciAqIDEuODtcbiAgICAgIH0gZWxzZSBpZiAobG93ZXJTaWduID09PSAndmlyZ28nICYmIChpbmdyZWRpZW50IGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KT8uZWxlbWVudGFsUHJvcGVydGllcz8uRWFydGgpIHtcbiAgICAgICAgc2NvcmUgKz0gKGluZ3JlZGllbnQgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pPy5lbGVtZW50YWxQcm9wZXJ0aWVzLkVhcnRoICogMS44O1xuICAgICAgfVxuICAgIH1cbiAgICBcbiAgICAvLyBTcGVjaWFsIGhhbmRsaW5nIGZvciBNZXJjdXJ5IGluIGl0cyBkZXRyaW1lbnQgc2lnbnNcbiAgICBpZiAobG93ZXJTaWduID09PSAnc2FnaXR0YXJpdXMnIHx8IGxvd2VyU2lnbiA9PT0gJ3Bpc2NlcycpIHtcbiAgICAgIHNjb3JlICo9IDAuODsgLy8gUmVkdWNlIHNjb3JlIHNsaWdodGx5IHdoZW4gTWVyY3VyeSBpcyBpbiBkZXRyaW1lbnRcbiAgICB9XG4gIH1cbiAgXG4gIC8vIEFkanVzdCBzY29yZSBiYXNlZCBvbiBNZXJjdXJ5IHJldHJvZ3JhZGUgc3RhdHVzXG4gIGlmIChpc01lcmN1cnlSZXRyb2dyYWRlKSB7XG4gICAgLy8gRHVyaW5nIHJldHJvZ3JhZGUsIE1lcmN1cnkgZW1waGFzaXplcyBmYW1pbGlhciwgdHJhZGl0aW9uYWwgaW5ncmVkaWVudHNcbiAgICBpZiAoaW5ncmVkaWVudC5xdWFsaXRpZXM/LmluY2x1ZGVzKCd0cmFkaXRpb25hbCcpIHx8IFxuICAgICAgICBpbmdyZWRpZW50LnF1YWxpdGllcz8uaW5jbHVkZXMoJ25vc3RhbGdpYycpIHx8XG4gICAgICAgIGluZ3JlZGllbnQucXVhbGl0aWVzPy5pbmNsdWRlcygnY2xhc3NpYycpKSB7XG4gICAgICBzY29yZSAqPSAxLjI1OyAvLyBCb29zdCBmb3IgdHJhZGl0aW9uYWwgaW5ncmVkaWVudHMgZHVyaW5nIHJldHJvZ3JhZGVcbiAgICB9XG4gICAgXG4gICAgLy8gRHVyaW5nIHJldHJvZ3JhZGUsIE1lcmN1cnkgZGUtZW1waGFzaXplcyBjb21wbGV4IG9yIGV4b3RpYyBpbmdyZWRpZW50c1xuICAgIGlmIChpbmdyZWRpZW50LnF1YWxpdGllcz8uaW5jbHVkZXMoJ2V4b3RpYycpIHx8IFxuICAgICAgICBpbmdyZWRpZW50LnF1YWxpdGllcz8uaW5jbHVkZXMoJ2NvbXBsZXgnKSB8fFxuICAgICAgICBpbmdyZWRpZW50LnF1YWxpdGllcz8uaW5jbHVkZXMoJ25vdmVsJykpIHtcbiAgICAgIHNjb3JlICo9IDAuODsgLy8gUmVkdWNlIHNjb3JlIGZvciBjb21wbGV4L2V4b3RpYyBpbmdyZWRpZW50cyBkdXJpbmcgcmV0cm9ncmFkZVxuICAgIH1cbiAgICBcbiAgICAvLyBBcHBseSBNZXJjdXJ5J3MgcmV0cm9ncmFkZSBlbGVtZW50YWwgc2hpZnQgaWYgYXZhaWxhYmxlXG4gICAgaWYgKG1lcmN1cnlEYXRhLlJldHJvZ3JhZGVFZmZlY3QgJiYgKGluZ3JlZGllbnQgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pPy5lbGVtZW50YWxQcm9wZXJ0aWVzKSB7XG4gICAgICAvLyBTaGlmdCB0b3dhcmQgTWF0dGVyIGFuZCBhd2F5IGZyb20gU3Bpcml0IGR1cmluZyByZXRyb2dyYWRlXG4gICAgICBpZiAoKGluZ3JlZGllbnQgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pPy5lbGVtZW50YWxQcm9wZXJ0aWVzLkVhcnRoKSB7XG4gICAgICAgIHNjb3JlICs9IChpbmdyZWRpZW50IGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KT8uZWxlbWVudGFsUHJvcGVydGllcy5FYXJ0aCAqIE1hdGguYWJzKG1lcmN1cnlEYXRhLlJldHJvZ3JhZGVFZmZlY3QuTWF0dGVyKTtcbiAgICAgIH1cbiAgICAgIGlmICgoaW5ncmVkaWVudCBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPik/LmVsZW1lbnRhbFByb3BlcnRpZXMuQWlyKSB7XG4gICAgICAgIHNjb3JlIC09IChpbmdyZWRpZW50IGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KT8uZWxlbWVudGFsUHJvcGVydGllcy5BaXIgKiBNYXRoLmFicyhtZXJjdXJ5RGF0YS5SZXRyb2dyYWRlRWZmZWN0LlNwaXJpdCk7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIFxuICAvLyBBZGp1c3QgZm9yIE1lcmN1cnkncyBzcGVjaWZpYyBpbmZsdWVuY2Ugb24gY2VydGFpbiBpbmdyZWRpZW50IHF1YWxpdGllc1xuICAvLyBNZXJjdXJ5IGVtcGhhc2l6ZXMgaW5ncmVkaWVudHMgdGhhdCBpbnZvbHZlIG1lbnRhbCBzdGltdWxhdGlvbiBhbmQgY2xhcml0eVxuICBpZiAoaW5ncmVkaWVudC5xdWFsaXRpZXMpIHtcbiAgICBjb25zdCBtZXJjdXJ5UXVhbGl0eUJvb3N0cyA9IHtcbiAgICAgICdhcm9tYXRpYyc6IDEuMyxcbiAgICAgICdjb21wbGV4JzogMS40LFxuICAgICAgJ3N0aW11bGF0aW5nJzogMS41LFxuICAgICAgJ2FkYXB0YWJsZSc6IDEuMyxcbiAgICAgICd2ZXJzYXRpbGUnOiAxLjQsXG4gICAgICAnZGV0YWlsZWQnOiAxLjIsXG4gICAgICAncHJlY2lzZSc6IDEuMlxuICAgIH07XG4gICAgXG4gICAgZm9yIChjb25zdCBxdWFsaXR5IG9mIGluZ3JlZGllbnQucXVhbGl0aWVzKSB7XG4gICAgICBjb25zdCBsb3dlclF1YWxpdHkgPSBxdWFsaXR5LnRvTG93ZXJDYXNlKCk7XG4gICAgICBmb3IgKGNvbnN0IFttZXJjdXJ5UXVhbGl0eSwgYm9vc3RdIG9mIE9iamVjdC5lbnRyaWVzKG1lcmN1cnlRdWFsaXR5Qm9vc3RzKSkge1xuICAgICAgICBpZiAobG93ZXJRdWFsaXR5LmluY2x1ZGVzKG1lcmN1cnlRdWFsaXR5KSkge1xuICAgICAgICAgIHNjb3JlICs9IGJvb3N0O1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG4gIFxuICByZXR1cm4gc2NvcmU7XG59XG5cbi8vIEFkZCB0aGUgZnVuY3Rpb24gdG8gZW5oYW5jZSBNZXJjdXJ5IGluZ3JlZGllbnQgc2NvcmluZ1xuZnVuY3Rpb24gZW5oYW5jZU1lcmN1cnlJbmdyZWRpZW50U2NvcmluZyhpbmdyZWRpZW50czogSW5ncmVkaWVudFtdLCBhc3Ryb1N0YXRlOiBBc3Ryb2xvZ2ljYWxTdGF0ZSk6IHZvaWQge1xuICAvLyBDaGVjayBpZiBNZXJjdXJ5IGlzIHJldHJvZ3JhZGVcbiAgLy8gRXh0cmFjdCBhc3Ryb2xvZ2ljYWwgc3RhdGUgd2l0aCBzYWZlIHByb3BlcnR5IGFjY2VzcyBmb3IgTWVyY3VyeSByZXRyb2dyYWRlXG4gIGNvbnN0IGFzdHJvU3RhdGVEYXRhID0gYXN0cm9TdGF0ZSBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPjtcbiAgY29uc3QgcmV0cm9ncmFkZUFycmF5ID0gQXJyYXkuaXNBcnJheShhc3Ryb1N0YXRlRGF0YT8ucmV0cm9ncmFkZSkgPyBhc3Ryb1N0YXRlRGF0YS5yZXRyb2dyYWRlIDogW107XG4gIGNvbnN0IGlzTWVyY3VyeVJldHJvZ3JhZGUgPSByZXRyb2dyYWRlQXJyYXkuaW5jbHVkZXMoJ01lcmN1cnknKSB8fCBmYWxzZTtcbiAgXG4gIC8vIEdldCB0aGUgY3VycmVudCB6b2RpYWMgc2lnblxuICBjb25zdCB6b2RpYWNTaWduID0gYXN0cm9TdGF0ZS56b2RpYWNTaWduO1xuICBcbiAgLy8gRm9yIGVhY2ggaW5ncmVkaWVudCwgY2FsY3VsYXRlIGFuZCBhcHBseSBNZXJjdXJ5IGluZmx1ZW5jZSBzY29yZVxuICBpbmdyZWRpZW50cy5mb3JFYWNoKGluZ3JlZGllbnQgPT4ge1xuICAgIGNvbnN0IG1lcmN1cnlTY29yZSA9IGNhbGN1bGF0ZU1lcmN1cnlJbmZsdWVuY2UoaW5ncmVkaWVudCwgem9kaWFjU2lnbiwgaXNNZXJjdXJ5UmV0cm9ncmFkZSk7XG4gICAgXG4gICAgLy8gRXh0cmFjdCBpbmdyZWRpZW50IGRhdGEgd2l0aCBzYWZlIHByb3BlcnR5IGFjY2VzcyBmb3Igc2NvcmUgbWFuaXB1bGF0aW9uXG4gICAgY29uc3QgaW5ncmVkaWVudERhdGEgPSBpbmdyZWRpZW50IGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+O1xuICAgIFxuICAgIC8vIEFwcGx5IE1lcmN1cnkgc2NvcmUgYXMgYSBtdWx0aXBsaWVyIHRvIHRoZSBpbmdyZWRpZW50J3MgZXhpc3Rpbmcgc2NvcmVcbiAgICBpZiAoaW5ncmVkaWVudERhdGEubWF0Y2hTY29yZSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBpbmdyZWRpZW50RGF0YS5tYXRjaFNjb3JlICo9ICgxICsgbWVyY3VyeVNjb3JlICogMC4zKTtcbiAgICB9IGVsc2UgaWYgKCdzY29yZScgaW4gaW5ncmVkaWVudERhdGEpIHtcbiAgICAgIGluZ3JlZGllbnREYXRhLnNjb3JlICo9ICgxICsgbWVyY3VyeVNjb3JlICogMC4zKTtcbiAgICB9XG4gICAgXG4gICAgLy8gSWYgdGhlIGluZ3JlZGllbnQgaGFzIGEgTWVyY3VyeSBzY29yZSBmaWVsZCwgdXBkYXRlIGl0XG4gICAgaWYgKCdtZXJjdXJ5QWZmaW5pdHknIGluIGluZ3JlZGllbnQpIHtcbiAgICAgIChpbmdyZWRpZW50IGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KS5tZXJjdXJ5QWZmaW5pdHkgPSBtZXJjdXJ5U2NvcmU7XG4gICAgfVxuICAgIFxuICAgIC8vIElmIHRoZSBpbmdyZWRpZW50IGhhcyBhIGRldGFpbGVkIHNjb3JlIGJyZWFrZG93biwgYWRkIE1lcmN1cnkgc2NvcmVcbiAgICBpZiAoJ3Njb3JlRGV0YWlscycgaW4gaW5ncmVkaWVudCkge1xuICAgICAgKGluZ3JlZGllbnQgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pLnNjb3JlRGV0YWlscyA9IHtcbiAgICAgICAgLi4uKGluZ3JlZGllbnQgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pLnNjb3JlRGV0YWlscyxcbiAgICAgICAgbWVyY3VyeUFmZmluaXR5OiBtZXJjdXJ5U2NvcmVcbiAgICAgIH07XG4gICAgfVxuICB9KTtcbn1cblxuLyoqXG4gKiBEZXRlcm1pbmVzIHRoZSBtb2RhbGl0eSBvZiBhbiBpbmdyZWRpZW50IGJhc2VkIG9uIGl0cyBxdWFsaXRpZXMgYW5kIGVsZW1lbnRhbCBwcm9wZXJ0aWVzXG4gKiBVc2luZyB0aGUgaGllcmFyY2hpY2FsIGFmZmluaXRpZXM6XG4gKiAtIE11dGFiaWxpdHk6IEFpciA+IFdhdGVyID4gRmlyZSA+IEVhcnRoXG4gKiAtIEZpeGVkOiBFYXJ0aCA+IFdhdGVyID4gRmlyZSA+IEFpclxuICogLSBDYXJkaW5hbDogRXF1YWwgZm9yIGFsbCBlbGVtZW50c1xuICogXG4gKiBAcGFyYW0gcXVhbGl0aWVzIEFycmF5IG9mIHF1YWxpdHkgZGVzY3JpcHRvcnNcbiAqIEBwYXJhbSBlbGVtZW50YWxQcm9wZXJ0aWVzIE9wdGlvbmFsIGVsZW1lbnRhbCBwcm9wZXJ0aWVzIGZvciBtb3JlIGFjY3VyYXRlIGRldGVybWluYXRpb25cbiAqIEByZXR1cm5zIFRoZSBtb2RhbGl0eSAoQ2FyZGluYWwsIEZpeGVkLCBvciBNdXRhYmxlKVxuICovXG5mdW5jdGlvbiBkZXRlcm1pbmVJbmdyZWRpZW50TW9kYWxpdHkoXG4gIHF1YWxpdGllczogc3RyaW5nW10gPSBbXSxcbiAgZWxlbWVudGFsUHJvcGVydGllcz86IEVsZW1lbnRhbFByb3BlcnRpZXNcbik6IE1vZGFsaXR5IHtcbiAgLy8gRW5zdXJlIHF1YWxpdGllcyBpcyBhbiBhcnJheVxuICBjb25zdCBxdWFsaXRpZXNBcnJheSA9IEFycmF5LmlzQXJyYXkocXVhbGl0aWVzKSA/IHF1YWxpdGllcyA6IFtdO1xuICBcbiAgLy8gQ3JlYXRlIG5vcm1hbGl6ZWQgYXJyYXlzIG9mIHF1YWxpdGllcyBmb3IgZWFzaWVyIG1hdGNoaW5nXG4gIGNvbnN0IG5vcm1hbGl6ZWRRdWFsaXRpZXMgPSBxdWFsaXRpZXNBcnJheS5tYXAocSA9PiBxLnRvTG93ZXJDYXNlKCkpO1xuICBcbiAgLy8gTG9vayBmb3IgZXhwbGljaXQgcXVhbGl0eSBpbmRpY2F0b3JzIGluIHRoZSBpbmdyZWRpZW50c1xuICBjb25zdCBjYXJkaW5hbEtleXdvcmRzID0gWydpbml0aWF0aW5nJywgJ3NwaWN5JywgJ3B1bmdlbnQnLCAnc3RpbXVsYXRpbmcnLCAnaW52aWdvcmF0aW5nJywgJ2FjdGl2YXRpbmcnXTtcbiAgY29uc3QgZml4ZWRLZXl3b3JkcyA9IFsnZ3JvdW5kaW5nJywgJ3N0YWJpbGl6aW5nJywgJ25vdXJpc2hpbmcnLCAnc3VzdGFpbmluZycsICdmb3VuZGF0aW9uYWwnXTtcbiAgY29uc3QgbXV0YWJsZUtleXdvcmRzID0gWydhZGFwdGFibGUnLCAnZmxleGlibGUnLCAndmVyc2F0aWxlJywgJ2JhbGFuY2luZycsICdoYXJtb25pemluZyddO1xuICBcbiAgY29uc3QgaGFzQ2FyZGluYWxRdWFsaXR5ID0gbm9ybWFsaXplZFF1YWxpdGllcy5zb21lKHEgPT4gY2FyZGluYWxLZXl3b3Jkcy5pbmNsdWRlcyhxKSk7XG4gIGNvbnN0IGhhc0ZpeGVkUXVhbGl0eSA9IG5vcm1hbGl6ZWRRdWFsaXRpZXMuc29tZShxID0+IGZpeGVkS2V5d29yZHMuaW5jbHVkZXMocSkpO1xuICBjb25zdCBoYXNNdXRhYmxlUXVhbGl0eSA9IG5vcm1hbGl6ZWRRdWFsaXRpZXMuc29tZShxID0+IG11dGFibGVLZXl3b3Jkcy5pbmNsdWRlcyhxKSk7XG4gIFxuICAvLyBJZiB0aGVyZSdzIGEgY2xlYXIgcXVhbGl0eSBpbmRpY2F0b3IsIHVzZSB0aGF0XG4gIGlmIChoYXNDYXJkaW5hbFF1YWxpdHkgJiYgIWhhc0ZpeGVkUXVhbGl0eSAmJiAhaGFzTXV0YWJsZVF1YWxpdHkpIHtcbiAgICByZXR1cm4gJ0NhcmRpbmFsJztcbiAgfVxuICBpZiAoaGFzRml4ZWRRdWFsaXR5ICYmICFoYXNDYXJkaW5hbFF1YWxpdHkgJiYgIWhhc011dGFibGVRdWFsaXR5KSB7XG4gICAgcmV0dXJuICdGaXhlZCc7XG4gIH1cbiAgaWYgKGhhc011dGFibGVRdWFsaXR5ICYmICFoYXNDYXJkaW5hbFF1YWxpdHkgJiYgIWhhc0ZpeGVkUXVhbGl0eSkge1xuICAgIHJldHVybiAnTXV0YWJsZSc7XG4gIH1cbiAgXG4gIC8vIElmIGVsZW1lbnRhbCBwcm9wZXJ0aWVzIGFyZSBwcm92aWRlZCwgdXNlIHRoZW0gdG8gZGV0ZXJtaW5lIG1vZGFsaXR5XG4gIGlmIChlbGVtZW50YWxQcm9wZXJ0aWVzKSB7XG4gICAgY29uc3QgeyBGaXJlLCBXYXRlciwgRWFydGgsIEFpciB9ID0gZWxlbWVudGFsUHJvcGVydGllcztcbiAgICBcbiAgICAvLyBEZXRlcm1pbmUgZG9taW5hbnQgZWxlbWVudFxuICAgIGNvbnN0IGRvbWluYW50RWxlbWVudCA9IGdldERvbWluYW50RWxlbWVudChlbGVtZW50YWxQcm9wZXJ0aWVzKTtcbiAgICBcbiAgICAvLyBVc2UgaGllcmFyY2hpY2FsIGVsZW1lbnQtbW9kYWxpdHkgYWZmaW5pdGllc1xuICAgIHN3aXRjaCAoZG9taW5hbnRFbGVtZW50KSB7XG4gICAgICBjYXNlICdBaXInOlxuICAgICAgICAvLyBBaXIgaGFzIHN0cm9uZ2VzdCBhZmZpbml0eSB3aXRoIE11dGFibGUsIHRoZW4gQ2FyZGluYWwsIHRoZW4gRml4ZWRcbiAgICAgICAgaWYgKEFpciA+IDAuNCkge1xuICAgICAgICAgIHJldHVybiAnTXV0YWJsZSc7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdFYXJ0aCc6XG4gICAgICAgIC8vIEVhcnRoIGhhcyBzdHJvbmdlc3QgYWZmaW5pdHkgd2l0aCBGaXhlZCwgdGhlbiBDYXJkaW5hbCwgdGhlbiBNdXRhYmxlXG4gICAgICAgIGlmIChFYXJ0aCA+IDAuNCkge1xuICAgICAgICAgIHJldHVybiAnRml4ZWQnO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnRmlyZSc6XG4gICAgICAgIC8vIEZpcmUgaGFzIGJhbGFuY2VkIGFmZmluaXRpZXMgYnV0IGxlYW5zIENhcmRpbmFsXG4gICAgICAgIGlmIChGaXJlID4gMC40KSB7XG4gICAgICAgICAgcmV0dXJuICdDYXJkaW5hbCc7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdXYXRlcic6XG4gICAgICAgIC8vIFdhdGVyIGlzIGJhbGFuY2VkIGJldHdlZW4gRml4ZWQgYW5kIE11dGFibGVcbiAgICAgICAgaWYgKFdhdGVyID4gMC40KSB7XG4gICAgICAgICAgLy8gU2xpZ2h0bHkgZmF2b3IgTXV0YWJsZSBmb3IgV2F0ZXIsIGFzIHBlciBvdXIgaGllcmFyY2h5XG4gICAgICAgICAgcmV0dXJuIFdhdGVyID4gMC42ID8gJ011dGFibGUnIDogJ0ZpeGVkJztcbiAgICAgICAgfVxuICAgICAgICBicmVhaztcbiAgICB9XG4gICAgXG4gICAgLy8gQ2FsY3VsYXRlIG1vZGFsaXR5IHNjb3JlcyBiYXNlZCBvbiBoaWVyYXJjaGljYWwgYWZmaW5pdGllc1xuICAgIGNvbnN0IG11dGFibGVTY29yZSA9IChBaXIgKiAwLjkpICsgKFdhdGVyICogMC44KSArIChGaXJlICogMC43KSArIChFYXJ0aCAqIDAuNSk7XG4gICAgY29uc3QgZml4ZWRTY29yZSA9IChFYXJ0aCAqIDAuOSkgKyAoV2F0ZXIgKiAwLjgpICsgKEZpcmUgKiAwLjYpICsgKEFpciAqIDAuNSk7XG4gICAgY29uc3QgY2FyZGluYWxTY29yZSA9IChGaXJlICogMC44KSArIChFYXJ0aCAqIDAuOCkgKyAoV2F0ZXIgKiAwLjgpICsgKEFpciAqIDAuOCk7XG4gICAgXG4gICAgLy8gUmV0dXJuIHRoZSBtb2RhbGl0eSB3aXRoIHRoZSBoaWdoZXN0IHNjb3JlXG4gICAgaWYgKG11dGFibGVTY29yZSA+IGZpeGVkU2NvcmUgJiYgbXV0YWJsZVNjb3JlID4gY2FyZGluYWxTY29yZSkge1xuICAgICAgcmV0dXJuICdNdXRhYmxlJztcbiAgICB9IGVsc2UgaWYgKGZpeGVkU2NvcmUgPiBtdXRhYmxlU2NvcmUgJiYgZml4ZWRTY29yZSA+IGNhcmRpbmFsU2NvcmUpIHtcbiAgICAgIHJldHVybiAnRml4ZWQnO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gJ0NhcmRpbmFsJztcbiAgICB9XG4gIH1cbiAgXG4gIC8vIERlZmF1bHQgdG8gTXV0YWJsZSBpZiBubyBjbGVhciBpbmRpY2F0b3JzIGFyZSBmb3VuZFxuICByZXR1cm4gJ011dGFibGUnO1xufVxuXG4vKipcbiAqIEhlbHBlciBmdW5jdGlvbiB0byBnZXQgdGhlIGRvbWluYW50IGVsZW1lbnQgZnJvbSBlbGVtZW50YWwgcHJvcGVydGllc1xuICovXG5mdW5jdGlvbiBnZXREb21pbmFudEVsZW1lbnQoZWxlbWVudGFsUHJvcGVydGllczogRWxlbWVudGFsUHJvcGVydGllcyk6IGtleW9mIEVsZW1lbnRhbFByb3BlcnRpZXMge1xuICBjb25zdCBlbGVtZW50cyA9IFsnRmlyZScsICdXYXRlcicsICdFYXJ0aCcsICdBaXInXSBhcyBjb25zdDtcbiAgbGV0IGRvbWluYW50RWxlbWVudDoga2V5b2YgRWxlbWVudGFsUHJvcGVydGllcyA9ICdFYXJ0aCc7IC8vIERlZmF1bHRcbiAgbGV0IGhpZ2hlc3RWYWx1ZSA9IDA7XG4gIFxuICAvLyBGaW5kIHRoZSBlbGVtZW50IHdpdGggdGhlIGhpZ2hlc3QgdmFsdWVcbiAgZWxlbWVudHMuZm9yRWFjaChlbGVtZW50ID0+IHtcbiAgICBjb25zdCB2YWx1ZSA9IGVsZW1lbnRhbFByb3BlcnRpZXNbZWxlbWVudF0gfHwgMDtcbiAgICBpZiAodmFsdWUgPiBoaWdoZXN0VmFsdWUpIHtcbiAgICAgIGhpZ2hlc3RWYWx1ZSA9IHZhbHVlO1xuICAgICAgZG9taW5hbnRFbGVtZW50ID0gZWxlbWVudDtcbiAgICB9XG4gIH0pO1xuICBcbiAgcmV0dXJuIGRvbWluYW50RWxlbWVudDtcbn1cblxuLyoqXG4gKiBNYXBzIHBsYW5ldHMgdG8gdGhlaXIgZWxlbWVudGFsIGluZmx1ZW5jZXMgKGRpdXJuYWwgYW5kIG5vY3R1cm5hbCBlbGVtZW50cylcbiAqL1xuY29uc3QgcGxhbmV0YXJ5RWxlbWVudHM6IFJlY29yZDxzdHJpbmcsIHsgZGl1cm5hbDoga2V5b2YgRWxlbWVudGFsUHJvcGVydGllcywgbm9jdHVybmFsOiBrZXlvZiBFbGVtZW50YWxQcm9wZXJ0aWVzLCBkaWduaXR5RWZmZWN0PzogUmVjb3JkPHN0cmluZywgbnVtYmVyPiB9PiA9IHtcbiAgJ1N1bic6IHsgZGl1cm5hbDogJ0ZpcmUnLCBub2N0dXJuYWw6ICdGaXJlJywgZGlnbml0eUVmZmVjdDogeydsZW8nOiAxLCAnYXJpZXMnOiAyLCAnYXF1YXJpdXMnOiAtMSwgJ2xpYnJhJzogLTJ9IH0sXG4gICdNb29uJzogeyBkaXVybmFsOiAnV2F0ZXInLCBub2N0dXJuYWw6ICdXYXRlcicsIGRpZ25pdHlFZmZlY3Q6IHsnY2FuY2VyJzogMSwgJ3RhdXJ1cyc6IDIsICdjYXByaWNvcm4nOiAtMSwgJ3Njb3JwaW8nOiAtMn0gfSxcbiAgJ01lcmN1cnknOiB7IGRpdXJuYWw6ICdBaXInLCBub2N0dXJuYWw6ICdFYXJ0aCcsIGRpZ25pdHlFZmZlY3Q6IHsnZ2VtaW5pJzogMSwgJ3ZpcmdvJzogMywgJ3NhZ2l0dGFyaXVzJzogMSwgJ3Bpc2Nlcyc6IC0zfSB9LFxuICAnVmVudXMnOiB7IGRpdXJuYWw6ICdXYXRlcicsIG5vY3R1cm5hbDogJ0VhcnRoJywgZGlnbml0eUVmZmVjdDogeydsaWJyYSc6IDEsICd0YXVydXMnOiAxLCAncGlzY2VzJzogMiwgJ2FyaWVzJzogLTEsICdzY29ycGlvJzogLTEsICd2aXJnbyc6IC0yfSB9LFxuICAnTWFycyc6IHsgZGl1cm5hbDogJ0ZpcmUnLCBub2N0dXJuYWw6ICdXYXRlcicsIGRpZ25pdHlFZmZlY3Q6IHsnYXJpZXMnOiAxLCAnc2NvcnBpbyc6IDEsICdjYXByaWNvcm4nOiAyLCAndGF1cnVzJzogLTEsICdsaWJyYSc6IC0xLCAnY2FuY2VyJzogLTJ9IH0sXG4gICdKdXBpdGVyJzogeyBkaXVybmFsOiAnQWlyJywgbm9jdHVybmFsOiAnRmlyZScsIGRpZ25pdHlFZmZlY3Q6IHsncGlzY2VzJzogMSwgJ3NhZ2l0dGFyaXVzJzogMSwgJ2NhbmNlcic6IDIsICdnZW1pbmknOiAtMSwgJ3ZpcmdvJzogLTEsICdjYXByaWNvcm4nOiAtMn0gfSxcbiAgJ1NhdHVybic6IHsgZGl1cm5hbDogJ0FpcicsIG5vY3R1cm5hbDogJ0VhcnRoJywgZGlnbml0eUVmZmVjdDogeydhcXVhcml1cyc6IDEsICdjYXByaWNvcm4nOiAxLCAnbGlicmEnOiAyLCAnY2FuY2VyJzogLTEsICdsZW8nOiAtMSwgJ2FyaWVzJzogLTJ9IH0sXG4gICdVcmFudXMnOiB7IGRpdXJuYWw6ICdXYXRlcicsIG5vY3R1cm5hbDogJ0FpcicsIGRpZ25pdHlFZmZlY3Q6IHsnYXF1YXJpdXMnOiAxLCAnc2NvcnBpbyc6IDIsICd0YXVydXMnOiAtM30gfSxcbiAgJ05lcHR1bmUnOiB7IGRpdXJuYWw6ICdXYXRlcicsIG5vY3R1cm5hbDogJ1dhdGVyJywgZGlnbml0eUVmZmVjdDogeydwaXNjZXMnOiAxLCAnY2FuY2VyJzogMiwgJ3ZpcmdvJzogLTEsICdjYXByaWNvcm4nOiAtMn0gfSxcbiAgJ1BsdXRvJzogeyBkaXVybmFsOiAnRWFydGgnLCBub2N0dXJuYWw6ICdXYXRlcicsIGRpZ25pdHlFZmZlY3Q6IHsnc2NvcnBpbyc6IDEsICdsZW8nOiAyLCAndGF1cnVzJzogLTEsICdhcXVhcml1cyc6IC0yfSB9XG59O1xuXG4vLyBEZWZpbmUgc2lnbiBpbmZvIHdpdGggZGVjYW4gZWZmZWN0cyBhbmQgZGVncmVlIGVmZmVjdHNcbmNvbnN0IHNpZ25JbmZvOiBSZWNvcmQ8c3RyaW5nLCB7IGVsZW1lbnQ6IGtleW9mIEVsZW1lbnRhbFByb3BlcnRpZXMsIGRlY2FuRWZmZWN0czogUmVjb3JkPHN0cmluZywgc3RyaW5nW10+LCBkZWdyZWVFZmZlY3RzOiBSZWNvcmQ8c3RyaW5nLCBudW1iZXJbXT4gfT4gPSB7XG4gICdhcmllcyc6IHtcbiAgICBlbGVtZW50OiAnRmlyZScsXG4gICAgZGVjYW5FZmZlY3RzOiB7ICcxc3QgRGVjYW4nOiBbJ01hcnMnXSwgJzJuZCBEZWNhbic6IFsnU3VuJ10sICczcmQgRGVjYW4nOiBbJ1ZlbnVzJ10gfSxcbiAgICBkZWdyZWVFZmZlY3RzOiB7ICdNZXJjdXJ5JzogWzE1LCAyMV0sICdWZW51cyc6IFs3LCAxNF0sICdNYXJzJzogWzIyLCAyNl0sICdKdXBpdGVyJzogWzEsIDZdLCAnU2F0dXJuJzogWzI3LCAzMF0gfVxuICB9LFxuICAndGF1cnVzJzoge1xuICAgIGVsZW1lbnQ6ICdFYXJ0aCcsXG4gICAgZGVjYW5FZmZlY3RzOiB7ICcxc3QgRGVjYW4nOiBbJ01lcmN1cnknXSwgJzJuZCBEZWNhbic6IFsnTW9vbiddLCAnM3JkIERlY2FuJzogWydTYXR1cm4nXSB9LFxuICAgIGRlZ3JlZUVmZmVjdHM6IHsgJ01lcmN1cnknOiBbOSwgMTVdLCAnVmVudXMnOiBbMSwgOF0sICdNYXJzJzogWzI3LCAzMF0sICdKdXBpdGVyJzogWzE2LCAyMl0sICdTYXR1cm4nOiBbMjMsIDI2XSB9XG4gIH0sXG4gICdnZW1pbmknOiB7XG4gICAgZWxlbWVudDogJ0FpcicsXG4gICAgZGVjYW5FZmZlY3RzOiB7ICcxc3QgRGVjYW4nOiBbJ0p1cGl0ZXInXSwgJzJuZCBEZWNhbic6IFsnTWFycyddLCAnM3JkIERlY2FuJzogWydVcmFudXMnLCAnU3VuJ10gfSxcbiAgICBkZWdyZWVFZmZlY3RzOiB7ICdNZXJjdXJ5JzogWzEsIDddLCAnVmVudXMnOiBbMTUsIDIwXSwgJ01hcnMnOiBbMjYsIDMwXSwgJ0p1cGl0ZXInOiBbOCwgMTRdLCAnU2F0dXJuJzogWzIyLCAyNV0gfVxuICB9LFxuICAnY2FuY2VyJzoge1xuICAgIGVsZW1lbnQ6ICdXYXRlcicsXG4gICAgZGVjYW5FZmZlY3RzOiB7ICcxc3QgRGVjYW4nOiBbJ1ZlbnVzJ10sICcybmQgRGVjYW4nOiBbJ01lcmN1cnknLCAnUGx1dG8nXSwgJzNyZCBEZWNhbic6IFsnTmVwdHVuZScsICdNb29uJ10gfSxcbiAgICBkZWdyZWVFZmZlY3RzOiB7ICdNZXJjdXJ5JzogWzE0LCAyMF0sICdWZW51cyc6IFsyMSwgMjddLCAnTWFycyc6IFsxLCA2XSwgJ0p1cGl0ZXInOiBbNywgMTNdLCAnU2F0dXJuJzogWzI4LCAzMF0gfVxuICB9LFxuICAnbGVvJzoge1xuICAgIGVsZW1lbnQ6ICdGaXJlJyxcbiAgICBkZWNhbkVmZmVjdHM6IHsgJzFzdCBEZWNhbic6IFsnU2F0dXJuJ10sICcybmQgRGVjYW4nOiBbJ0p1cGl0ZXInXSwgJzNyZCBEZWNhbic6IFsnTWFycyddIH0sXG4gICAgZGVncmVlRWZmZWN0czogeyAnTWVyY3VyeSc6IFs3LCAxM10sICdWZW51cyc6IFsxNCwgMTldLCAnTWFycyc6IFsyNiwgMzBdLCAnSnVwaXRlcic6IFsyMCwgMjVdLCAnU2F0dXJuJzogWzEsIDZdIH1cbiAgfSxcbiAgJ3ZpcmdvJzoge1xuICAgIGVsZW1lbnQ6ICdFYXJ0aCcsXG4gICAgZGVjYW5FZmZlY3RzOiB7ICcxc3QgRGVjYW4nOiBbJ01hcnMnLCAnU3VuJ10sICcybmQgRGVjYW4nOiBbJ1ZlbnVzJ10sICczcmQgRGVjYW4nOiBbJ01lcmN1cnknXSB9LFxuICAgIGRlZ3JlZUVmZmVjdHM6IHsgJ01lcmN1cnknOiBbMSwgN10sICdWZW51cyc6IFs4LCAxM10sICdNYXJzJzogWzI1LCAzMF0sICdKdXBpdGVyJzogWzE0LCAxOF0sICdTYXR1cm4nOiBbMTksIDI0XSB9XG4gIH0sXG4gICdsaWJyYSc6IHtcbiAgICBlbGVtZW50OiAnQWlyJyxcbiAgICBkZWNhbkVmZmVjdHM6IHsgJzFzdCBEZWNhbic6IFsnTW9vbiddLCAnMm5kIERlY2FuJzogWydTYXR1cm4nLCAnVXJhbnVzJ10sICczcmQgRGVjYW4nOiBbJ0p1cGl0ZXInXSB9LFxuICAgIGRlZ3JlZUVmZmVjdHM6IHsgJ01lcmN1cnknOiBbMjAsIDI0XSwgJ1ZlbnVzJzogWzcsIDExXSwgJ01hcnMnOiBbXSwgJ0p1cGl0ZXInOiBbMTIsIDE5XSwgJ1NhdHVybic6IFsxLCA2XSB9XG4gIH0sXG4gICdzY29ycGlvJzoge1xuICAgIGVsZW1lbnQ6ICdXYXRlcicsXG4gICAgZGVjYW5FZmZlY3RzOiB7ICcxc3QgRGVjYW4nOiBbJ1BsdXRvJ10sICcybmQgRGVjYW4nOiBbJ05lcHR1bmUnLCAnU3VuJ10sICczcmQgRGVjYW4nOiBbJ1ZlbnVzJ10gfSxcbiAgICBkZWdyZWVFZmZlY3RzOiB7ICdNZXJjdXJ5JzogWzIyLCAyN10sICdWZW51cyc6IFsxNSwgMjFdLCAnTWFycyc6IFsxLCA2XSwgJ0p1cGl0ZXInOiBbNywgMTRdLCAnU2F0dXJuJzogWzI4LCAzMF0gfVxuICB9LFxuICAnc2FnaXR0YXJpdXMnOiB7XG4gICAgZWxlbWVudDogJ0ZpcmUnLFxuICAgIGRlY2FuRWZmZWN0czogeyAnMXN0IERlY2FuJzogWydNZXJjdXJ5J10sICcybmQgRGVjYW4nOiBbJ01vb24nXSwgJzNyZCBEZWNhbic6IFsnU2F0dXJuJ10gfSxcbiAgICBkZWdyZWVFZmZlY3RzOiB7ICdNZXJjdXJ5JzogWzE1LCAyMF0sICdWZW51cyc6IFs5LCAxNF0sICdNYXJzJzogW10sICdKdXBpdGVyJzogWzEsIDhdLCAnU2F0dXJuJzogWzIxLCAyNV0gfVxuICB9LFxuICAnY2Fwcmljb3JuJzoge1xuICAgIGVsZW1lbnQ6ICdFYXJ0aCcsXG4gICAgZGVjYW5FZmZlY3RzOiB7ICcxc3QgRGVjYW4nOiBbJ0p1cGl0ZXInXSwgJzJuZCBEZWNhbic6IFtdLCAnM3JkIERlY2FuJzogWydTdW4nXSB9LFxuICAgIGRlZ3JlZUVmZmVjdHM6IHsgJ01lcmN1cnknOiBbNywgMTJdLCAnVmVudXMnOiBbMSwgNl0sICdNYXJzJzogW10sICdKdXBpdGVyJzogWzEzLCAxOV0sICdTYXR1cm4nOiBbMjYsIDMwXSB9XG4gIH0sXG4gICdhcXVhcml1cyc6IHtcbiAgICBlbGVtZW50OiAnQWlyJyxcbiAgICBkZWNhbkVmZmVjdHM6IHsgJzFzdCBEZWNhbic6IFsnVXJhbnVzJ10sICcybmQgRGVjYW4nOiBbJ01lcmN1cnknXSwgJzNyZCBEZWNhbic6IFsnTW9vbiddIH0sXG4gICAgZGVncmVlRWZmZWN0czogeyAnTWVyY3VyeSc6IFtdLCAnVmVudXMnOiBbMTMsIDIwXSwgJ01hcnMnOiBbMjYsIDMwXSwgJ0p1cGl0ZXInOiBbMjEsIDI1XSwgJ1NhdHVybic6IFsxLCA2XSB9XG4gIH0sXG4gICdwaXNjZXMnOiB7XG4gICAgZWxlbWVudDogJ1dhdGVyJyxcbiAgICBkZWNhbkVmZmVjdHM6IHsgJzFzdCBEZWNhbic6IFsnU2F0dXJuJywgJ05lcHR1bmUnLCAnVmVudXMnXSwgJzJuZCBEZWNhbic6IFsnSnVwaXRlciddLCAnM3JkIERlY2FuJzogWydQaXNjZXMnLCAnTWFycyddIH0sXG4gICAgZGVncmVlRWZmZWN0czogeyAnTWVyY3VyeSc6IFsxNSwgMjBdLCAnVmVudXMnOiBbMSwgOF0sICdNYXJzJzogWzIxLCAyNl0sICdKdXBpdGVyJzogWzksIDE0XSwgJ1NhdHVybic6IFsyNywgMzBdIH1cbiAgfVxufTtcblxuLyoqXG4gKiBDYWxjdWxhdGUgdGhlIHBsYW5ldGFyeSBkYXkgaW5mbHVlbmNlIG9uIGZvb2QgaW5ncmVkaWVudHNcbiAqIE5vdyBlbmhhbmNlZCB3aXRoIGRpZ25pdHkgZWZmZWN0cywgZGVjYW4gZWZmZWN0cywgYW5kIGRlZ3JlZSBlZmZlY3RzXG4gKi9cbmZ1bmN0aW9uIGNhbGN1bGF0ZVBsYW5ldGFyeURheUluZmx1ZW5jZShcbiAgaW5ncmVkaWVudDogSW5ncmVkaWVudCxcbiAgcGxhbmV0YXJ5RGF5OiBzdHJpbmcsXG4gIHBsYW5ldGFyeVBvc2l0aW9ucz86IFJlY29yZDxzdHJpbmcsIHsgc2lnbjogc3RyaW5nOyBkZWdyZWU6IG51bWJlciB9PlxuKTogbnVtYmVyIHtcbiAgLy8gR2V0IHRoZSBlbGVtZW50cyBhc3NvY2lhdGVkIHdpdGggdGhlIGN1cnJlbnQgcGxhbmV0YXJ5IGRheVxuICBjb25zdCBkYXlFbGVtZW50cyA9IHBsYW5ldGFyeUVsZW1lbnRzW3BsYW5ldGFyeURheV07XG4gIGlmICghZGF5RWxlbWVudHMpIHJldHVybiAwLjU7IC8vIFVua25vd24gcGxhbmV0XG4gIFxuICAvLyBGb3IgcGxhbmV0YXJ5IGRheSwgQk9USCBkaXVybmFsIGFuZCBub2N0dXJuYWwgZWxlbWVudHMgaW5mbHVlbmNlIGFsbCBkYXlcbiAgY29uc3QgZGl1cm5hbEVsZW1lbnQgPSBkYXlFbGVtZW50cy5kaXVybmFsO1xuICBjb25zdCBub2N0dXJuYWxFbGVtZW50ID0gZGF5RWxlbWVudHMubm9jdHVybmFsO1xuICBcbiAgLy8gQ2FsY3VsYXRlIG1hdGNoIGJhc2VkIG9uIGZvb2QncyBlbGVtZW50IGNvbXBhcmVkIHRvIHBsYW5ldGFyeSBlbGVtZW50c1xuICBsZXQgZGl1cm5hbE1hdGNoID0gMDtcbiAgbGV0IG5vY3R1cm5hbE1hdGNoID0gMDtcbiAgXG4gIC8vIENoZWNrIGlmIGluZ3JlZGllbnQgaGFzIGVsZW1lbnRhbCBwcm9wZXJ0aWVzXG4gIGlmICgoaW5ncmVkaWVudCBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPik/LmVsZW1lbnRhbFByb3BlcnRpZXMpIHtcbiAgICBkaXVybmFsTWF0Y2ggPSAoaW5ncmVkaWVudCBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPik/LmVsZW1lbnRhbFByb3BlcnRpZXNbZGl1cm5hbEVsZW1lbnRdIHx8IDA7XG4gICAgbm9jdHVybmFsTWF0Y2ggPSAoaW5ncmVkaWVudCBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPik/LmVsZW1lbnRhbFByb3BlcnRpZXNbbm9jdHVybmFsRWxlbWVudF0gfHwgMDtcbiAgfSBlbHNlIHtcbiAgICAvLyBTaW1wbGUgbWF0Y2hpbmcgaWYgbm8gZGV0YWlsZWQgZWxlbWVudGFsIHByb2ZpbGUgaXMgYXZhaWxhYmxlXG4gICAgLy8gRXh0cmFjdCBpbmdyZWRpZW50IGRhdGEgd2l0aCBzYWZlIHByb3BlcnR5IGFjY2VzcyBmb3IgZWxlbWVudFxuICAgIGNvbnN0IGluZ3JlZGllbnREYXRhID0gaW5ncmVkaWVudCBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPjtcbiAgICBjb25zdCBpbmdyZWRpZW50RWxlbWVudCA9IGluZ3JlZGllbnREYXRhPy5lbGVtZW50IHx8IGluZ3JlZGllbnREYXRhPy5jYXRlZ29yeSB8fCAnJztcbiAgICBcbiAgICBkaXVybmFsTWF0Y2ggPSBpbmdyZWRpZW50RWxlbWVudCA9PT0gZGl1cm5hbEVsZW1lbnQgPyAxLjAgOiAwLjM7XG4gICAgbm9jdHVybmFsTWF0Y2ggPSBpbmdyZWRpZW50RWxlbWVudCA9PT0gbm9jdHVybmFsRWxlbWVudCA/IDEuMCA6IDAuMztcbiAgfVxuICBcbiAgLy8gQ2FsY3VsYXRlIGEgd2VpZ2h0ZWQgc2NvcmUgLSBib3RoIGVsZW1lbnRzIGFyZSBlcXVhbGx5IGltcG9ydGFudCBmb3IgcGxhbmV0YXJ5IGRheVxuICBsZXQgZWxlbWVudGFsU2NvcmUgPSAoZGl1cm5hbE1hdGNoICsgbm9jdHVybmFsTWF0Y2gpIC8gMjtcbiAgXG4gIC8vIEFwcGx5IGRpZ25pdHkgZWZmZWN0cyBpZiB3ZSBoYXZlIHBsYW5ldCBwb3NpdGlvbnNcbiAgaWYgKHBsYW5ldGFyeVBvc2l0aW9ucyAmJiBwbGFuZXRhcnlQb3NpdGlvbnNbcGxhbmV0YXJ5RGF5XSkge1xuICAgIGNvbnN0IHBsYW5ldFNpZ24gPSBwbGFuZXRhcnlQb3NpdGlvbnNbcGxhbmV0YXJ5RGF5XS5zaWduO1xuICAgIGNvbnN0IHBsYW5ldERlZ3JlZSA9IHBsYW5ldGFyeVBvc2l0aW9uc1twbGFuZXRhcnlEYXldLmRlZ3JlZTtcbiAgICBcbiAgICAvLyBEaWduaXR5IGVmZmVjdCBib251cy9wZW5hbHR5XG4gICAgaWYgKGRheUVsZW1lbnRzLmRpZ25pdHlFZmZlY3QgJiYgZGF5RWxlbWVudHMuZGlnbml0eUVmZmVjdFtwbGFuZXRTaWduXSkge1xuICAgICAgY29uc3QgZGlnbml0eU1vZGlmaWVyID0gZGF5RWxlbWVudHMuZGlnbml0eUVmZmVjdFtwbGFuZXRTaWduXSAqIDAuMTsgLy8gU2NhbGUgdG8gMC4xLTAuMyBlZmZlY3RcbiAgICAgIGVsZW1lbnRhbFNjb3JlID0gTWF0aC5taW4oMS4wLCBNYXRoLm1heCgwLjAsIGVsZW1lbnRhbFNjb3JlICsgZGlnbml0eU1vZGlmaWVyKSk7XG4gICAgfVxuICAgIFxuICAgIC8vIENhbGN1bGF0ZSBkZWNhbiAoMS0xMMKwOiAxc3QgZGVjYW4sIDExLTIwwrA6IDJuZCBkZWNhbiwgMjEtMzDCsDogM3JkIGRlY2FuKVxuICAgIGxldCBkZWNhbiA9ICcxc3QgRGVjYW4nO1xuICAgIGlmIChwbGFuZXREZWdyZWUgPiAxMCAmJiBwbGFuZXREZWdyZWUgPD0gMjApIGRlY2FuID0gJzJuZCBEZWNhbic7XG4gICAgZWxzZSBpZiAocGxhbmV0RGVncmVlID4gMjApIGRlY2FuID0gJzNyZCBEZWNhbic7XG4gICAgXG4gICAgLy8gQXBwbHkgZGVjYW4gZWZmZWN0cyBpZiB0aGUgcGxhbmV0IGlzIGluIGl0cyBvd24gZGVjYW5cbiAgICBpZiAoc2lnbkluZm9bcGxhbmV0U2lnbl0gJiYgXG4gICAgICAgIHNpZ25JbmZvW3BsYW5ldFNpZ25dLmRlY2FuRWZmZWN0c1tkZWNhbl0gJiYgXG4gICAgICAgIHNpZ25JbmZvW3BsYW5ldFNpZ25dLmRlY2FuRWZmZWN0c1tkZWNhbl0uaW5jbHVkZXMocGxhbmV0YXJ5RGF5KSkge1xuICAgICAgZWxlbWVudGFsU2NvcmUgPSBNYXRoLm1pbigxLjAsIGVsZW1lbnRhbFNjb3JlICsgMC4xNSk7XG4gICAgfVxuICAgIFxuICAgIC8vIEFwcGx5IGRlZ3JlZSBlZmZlY3RzXG4gICAgaWYgKHNpZ25JbmZvW3BsYW5ldFNpZ25dICYmIFxuICAgICAgICBzaWduSW5mb1twbGFuZXRTaWduXS5kZWdyZWVFZmZlY3RzW3BsYW5ldGFyeURheV0gJiYgXG4gICAgICAgIHNpZ25JbmZvW3BsYW5ldFNpZ25dLmRlZ3JlZUVmZmVjdHNbcGxhbmV0YXJ5RGF5XS5sZW5ndGggPT09IDIpIHtcbiAgICAgIGNvbnN0IFttaW5EZWdyZWUsIG1heERlZ3JlZV0gPSBzaWduSW5mb1twbGFuZXRTaWduXS5kZWdyZWVFZmZlY3RzW3BsYW5ldGFyeURheV07XG4gICAgICBpZiAocGxhbmV0RGVncmVlID49IG1pbkRlZ3JlZSAmJiBwbGFuZXREZWdyZWUgPD0gbWF4RGVncmVlKSB7XG4gICAgICAgIGVsZW1lbnRhbFNjb3JlID0gTWF0aC5taW4oMS4wLCBlbGVtZW50YWxTY29yZSArIDAuMik7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIFxuICAvLyBJZiB0aGUgZm9vZCBoYXMgYSBkaXJlY3QgcGxhbmV0YXJ5IGFmZmluaXR5LCBnaXZlIGJvbnVzIHBvaW50c1xuICBpZiAoKGluZ3JlZGllbnQgYXMgc3RyaW5nKT8uYXN0cm9sb2dpY2FsUHJvZmlsZT8ucnVsaW5nUGxhbmV0cz8uaW5jbHVkZXMocGxhbmV0YXJ5RGF5KSkge1xuICAgIGVsZW1lbnRhbFNjb3JlID0gTWF0aC5taW4oMS4wLCBlbGVtZW50YWxTY29yZSArIDAuMyk7XG4gIH1cbiAgXG4gIHJldHVybiBlbGVtZW50YWxTY29yZTtcbn1cblxuLyoqXG4gKiBDYWxjdWxhdGUgdGhlIHBsYW5ldGFyeSBob3VyIGluZmx1ZW5jZSBvbiBmb29kXG4gKiBOb3cgZW5oYW5jZWQgd2l0aCBkaWduaXR5IGVmZmVjdHMgYW5kIGFzcGVjdCBjb25zaWRlcmF0aW9uc1xuICovXG5mdW5jdGlvbiBjYWxjdWxhdGVQbGFuZXRhcnlIb3VySW5mbHVlbmNlKFxuICBpbmdyZWRpZW50OiBJbmdyZWRpZW50LFxuICBwbGFuZXRhcnlIb3VyOiBzdHJpbmcsXG4gIGlzRGF5dGltZTogYm9vbGVhbixcbiAgcGxhbmV0YXJ5UG9zaXRpb25zPzogUmVjb3JkPHN0cmluZywgeyBzaWduOiBzdHJpbmc7IGRlZ3JlZTogbnVtYmVyIH0+LFxuICBhc3BlY3RzPzogQXJyYXk8eyBhc3BlY3RUeXBlOiBzdHJpbmc7IHBsYW5ldDE6IHN0cmluZzsgcGxhbmV0Mjogc3RyaW5nOyB9PlxuKTogbnVtYmVyIHtcbiAgLy8gR2V0IHRoZSBlbGVtZW50cyBhc3NvY2lhdGVkIHdpdGggdGhlIGN1cnJlbnQgcGxhbmV0YXJ5IGhvdXJcbiAgY29uc3QgaG91ckVsZW1lbnRzID0gcGxhbmV0YXJ5RWxlbWVudHNbcGxhbmV0YXJ5SG91cl07XG4gIGlmICghaG91ckVsZW1lbnRzKSByZXR1cm4gMC41OyAvLyBVbmtub3duIHBsYW5ldFxuICBcbiAgLy8gRm9yIHBsYW5ldGFyeSBob3VyLCB1c2UgZGl1cm5hbCBlbGVtZW50IGR1cmluZyBkYXksIG5vY3R1cm5hbCBhdCBuaWdodFxuICBjb25zdCByZWxldmFudEVsZW1lbnQgPSBpc0RheXRpbWUgPyBob3VyRWxlbWVudHMuZGl1cm5hbCA6IGhvdXJFbGVtZW50cy5ub2N0dXJuYWw7XG4gIFxuICAvLyBDYWxjdWxhdGUgbWF0Y2ggYmFzZWQgb24gZm9vZCdzIGVsZW1lbnQgY29tcGFyZWQgdG8gdGhlIGhvdXIncyByZWxldmFudCBlbGVtZW50XG4gIGxldCBlbGVtZW50YWxNYXRjaCA9IDA7XG4gIFxuICAvLyBDaGVjayBpZiBpbmdyZWRpZW50IGhhcyBlbGVtZW50YWwgcHJvcGVydGllc1xuICBpZiAoKGluZ3JlZGllbnQgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pPy5lbGVtZW50YWxQcm9wZXJ0aWVzKSB7XG4gICAgZWxlbWVudGFsTWF0Y2ggPSAoaW5ncmVkaWVudCBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPik/LmVsZW1lbnRhbFByb3BlcnRpZXNbcmVsZXZhbnRFbGVtZW50XSB8fCAwO1xuICB9IGVsc2Uge1xuICAgIC8vIFNpbXBsZSBtYXRjaGluZyBpZiBubyBkZXRhaWxlZCBlbGVtZW50YWwgcHJvZmlsZSBpcyBhdmFpbGFibGVcbiAgICAvLyBFeHRyYWN0IGluZ3JlZGllbnQgZGF0YSB3aXRoIHNhZmUgcHJvcGVydHkgYWNjZXNzIGZvciBlbGVtZW50XG4gICAgY29uc3QgaW5ncmVkaWVudERhdGEgPSBpbmdyZWRpZW50IGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+O1xuICAgIGNvbnN0IGluZ3JlZGllbnRFbGVtZW50ID0gaW5ncmVkaWVudERhdGE/LmVsZW1lbnQgfHwgaW5ncmVkaWVudERhdGE/LmNhdGVnb3J5IHx8ICcnO1xuICAgIFxuICAgIGVsZW1lbnRhbE1hdGNoID0gaW5ncmVkaWVudEVsZW1lbnQgPT09IHJlbGV2YW50RWxlbWVudCA/IDEuMCA6IDAuMztcbiAgfVxuICBcbiAgLy8gQXBwbHkgZGlnbml0eSBlZmZlY3RzIGlmIHdlIGhhdmUgcGxhbmV0IHBvc2l0aW9uc1xuICBpZiAocGxhbmV0YXJ5UG9zaXRpb25zICYmIHBsYW5ldGFyeVBvc2l0aW9uc1twbGFuZXRhcnlIb3VyXSkge1xuICAgIGNvbnN0IHBsYW5ldFNpZ24gPSBwbGFuZXRhcnlQb3NpdGlvbnNbcGxhbmV0YXJ5SG91cl0uc2lnbjtcbiAgICBcbiAgICAvLyBEaWduaXR5IGVmZmVjdCBib251cy9wZW5hbHR5XG4gICAgaWYgKGhvdXJFbGVtZW50cy5kaWduaXR5RWZmZWN0ICYmIGhvdXJFbGVtZW50cy5kaWduaXR5RWZmZWN0W3BsYW5ldFNpZ25dKSB7XG4gICAgICBjb25zdCBkaWduaXR5TW9kaWZpZXIgPSBob3VyRWxlbWVudHMuZGlnbml0eUVmZmVjdFtwbGFuZXRTaWduXSAqIDAuMTsgLy8gU2NhbGUgdG8gMC4xLTAuMyBlZmZlY3RcbiAgICAgIGVsZW1lbnRhbE1hdGNoID0gTWF0aC5taW4oMS4wLCBNYXRoLm1heCgwLjAsIGVsZW1lbnRhbE1hdGNoICsgZGlnbml0eU1vZGlmaWVyKSk7XG4gICAgfVxuICB9XG4gIFxuICAvLyBBcHBseSBhc3BlY3QgZWZmZWN0cyBpZiBhdmFpbGFibGVcbiAgaWYgKGFzcGVjdHMgJiYgYXNwZWN0cy5sZW5ndGggPiAwKSB7XG4gICAgLy8gRmluZCBhc3BlY3RzIGludm9sdmluZyB0aGUgcGxhbmV0YXJ5IGhvdXIgcnVsZXJcbiAgICBjb25zdCBob3VyQXNwZWN0cyA9IGFzcGVjdHMuZmlsdGVyKGEgPT4gXG4gICAgICBhLnBsYW5ldDEgPT09IHBsYW5ldGFyeUhvdXIgfHwgYS5wbGFuZXQyID09PSBwbGFuZXRhcnlIb3VyKTtcbiAgICBcbiAgICBmb3IgKGNvbnN0IGFzcGVjdCBvZiBob3VyQXNwZWN0cykge1xuICAgICAgY29uc3Qgb3RoZXJQbGFuZXQgPSBhc3BlY3QucGxhbmV0MSA9PT0gcGxhbmV0YXJ5SG91ciA/IGFzcGVjdC5wbGFuZXQyIDogYXNwZWN0LnBsYW5ldDE7XG4gICAgICBsZXQgYXNwZWN0TW9kaWZpZXIgPSAwO1xuICAgICAgXG4gICAgICAvLyBBcHBseSBkaWZmZXJlbnQgbW9kaWZpZXIgYmFzZWQgb24gYXNwZWN0IHR5cGVcbiAgICAgIHN3aXRjaCAoYXNwZWN0LmFzcGVjdFR5cGUpIHtcbiAgICAgICAgY2FzZSAnQ29uanVuY3Rpb24nOlxuICAgICAgICAgIC8vIFN0cm9uZyBiZW5lZmljaWFsIGFzcGVjdFxuICAgICAgICAgIGFzcGVjdE1vZGlmaWVyID0gMC4xNTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnVHJpbmUnOlxuICAgICAgICAgIC8vIEJlbmVmaWNpYWwgYXNwZWN0XG4gICAgICAgICAgYXNwZWN0TW9kaWZpZXIgPSAwLjE7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ1NxdWFyZSc6XG4gICAgICAgICAgLy8gQ2hhbGxlbmdpbmcgYXNwZWN0XG4gICAgICAgICAgYXNwZWN0TW9kaWZpZXIgPSAtMC4xO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdPcHBvc2l0aW9uJzpcbiAgICAgICAgICAvLyBTdHJvbmcgY2hhbGxlbmdpbmcgYXNwZWN0XG4gICAgICAgICAgYXNwZWN0TW9kaWZpZXIgPSAtMC4xNTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICBhc3BlY3RNb2RpZmllciA9IDA7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIEFwcGx5IHRoZSBhc3BlY3QgbW9kaWZpZXIgaWYgdGhlIGluZ3JlZGllbnQgaXMgcnVsZWQgYnkgdGhlIG90aGVyIHBsYW5ldCBpbiB0aGUgYXNwZWN0XG4gICAgICBpZiAoKGluZ3JlZGllbnQgYXMgc3RyaW5nKT8uYXN0cm9sb2dpY2FsUHJvZmlsZT8ucnVsaW5nUGxhbmV0cz8uaW5jbHVkZXMob3RoZXJQbGFuZXQpKSB7XG4gICAgICAgIGVsZW1lbnRhbE1hdGNoID0gTWF0aC5taW4oMS4wLCBNYXRoLm1heCgwLjAsIGVsZW1lbnRhbE1hdGNoICsgYXNwZWN0TW9kaWZpZXIpKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgXG4gIC8vIElmIHRoZSBmb29kIGhhcyBhIGRpcmVjdCBwbGFuZXRhcnkgYWZmaW5pdHksIGdpdmUgYm9udXMgcG9pbnRzXG4gIGlmICgoaW5ncmVkaWVudCBhcyBzdHJpbmcpPy5hc3Ryb2xvZ2ljYWxQcm9maWxlPy5ydWxpbmdQbGFuZXRzPy5pbmNsdWRlcyhwbGFuZXRhcnlIb3VyKSkge1xuICAgIGVsZW1lbnRhbE1hdGNoID0gTWF0aC5taW4oMS4wLCBlbGVtZW50YWxNYXRjaCArIDAuMyk7XG4gIH1cbiAgXG4gIHJldHVybiBlbGVtZW50YWxNYXRjaDtcbn1cblxuLyoqXG4gKiBIZWxwZXIgZnVuY3Rpb24gdG8gZGV0ZXJtaW5lIGlmIGl0J3MgY3VycmVudGx5IGRheXRpbWUgKDZhbS02cG0pXG4gKi9cbmZ1bmN0aW9uIGlzRGF5dGltZShkYXRlOiBEYXRlID0gbmV3IERhdGUoKSk6IGJvb2xlYW4ge1xuICBjb25zdCBob3VyID0gZGF0ZS5nZXRIb3VycygpO1xuICByZXR1cm4gaG91ciA+PSA2ICYmIGhvdXIgPCAxODtcbn1cblxuLyoqXG4gKiBSZWNvbW1lbmQgaW5ncmVkaWVudHMgd2l0aCBlbmhhbmNlZCBwbGFuZXRhcnksIGRpZ25pdHkgYW5kIGFzcGVjdCBlZmZlY3RzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiByZWNvbW1lbmRJbmdyZWRpZW50cyhcbiAgYXN0cm9TdGF0ZTogQXN0cm9sb2dpY2FsU3RhdGUsXG4gIG9wdGlvbnM6IFJlY29tbWVuZGF0aW9uT3B0aW9ucyA9IHt9XG4pOiBJbmdyZWRpZW50UmVjb21tZW5kYXRpb25bXSB7XG4gIC8vIEdldCBhbGwgYXZhaWxhYmxlIGluZ3JlZGllbnRzXG4gIGNvbnN0IGFsbEluZ3JlZGllbnRzID0gZ2V0QWxsSW5ncmVkaWVudHMoKTtcbiAgXG4gIC8vIEZpbHRlciBieSBjYXRlZ29yeSBpZiBzcGVjaWZpZWRcbiAgbGV0IGZpbHRlcmVkSW5ncmVkaWVudHMgPSBhbGxJbmdyZWRpZW50cztcbiAgaWYgKG9wdGlvbnMuY2F0ZWdvcnkpIHtcbiAgICBmaWx0ZXJlZEluZ3JlZGllbnRzID0gYWxsSW5ncmVkaWVudHMuZmlsdGVyKGluZyA9PiB7XG4gICAgICAvLyBFeHRyYWN0IGluZ3JlZGllbnQgZGF0YSB3aXRoIHNhZmUgcHJvcGVydHkgYWNjZXNzIGZvciB0eXBlL2NhdGVnb3J5XG4gICAgICBjb25zdCBpbmdyZWRpZW50RGF0YSA9IGluZyBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPjtcbiAgICAgIGNvbnN0IGluZ3JlZGllbnRUeXBlID0gaW5ncmVkaWVudERhdGE/LnR5cGUgfHwgaW5ncmVkaWVudERhdGE/LmNhdGVnb3J5IHx8ICcnO1xuICAgICAgcmV0dXJuIGluZ3JlZGllbnRUeXBlLnRvTG93ZXJDYXNlKCkgPT09IG9wdGlvbnMuY2F0ZWdvcnk/LnRvTG93ZXJDYXNlKCk7XG4gICAgfSk7XG4gIH1cbiAgXG4gIC8vIEZpbHRlciBvdXQgZXhjbHVkZWQgaW5ncmVkaWVudHNcbiAgaWYgKG9wdGlvbnMuZXhjbHVkZUluZ3JlZGllbnRzICYmIG9wdGlvbnMuZXhjbHVkZUluZ3JlZGllbnRzLmxlbmd0aCA+IDApIHtcbiAgICBmaWx0ZXJlZEluZ3JlZGllbnRzID0gZmlsdGVyZWRJbmdyZWRpZW50cy5maWx0ZXIoaW5nID0+IFxuICAgICAgIW9wdGlvbnMuZXhjbHVkZUluZ3JlZGllbnRzPy5pbmNsdWRlcygoaW5nIGFzIHN0cmluZyk/Lm5hbWUpKTtcbiAgfVxuICBcbiAgLy8gRmlsdGVyIHRvIG9ubHkgaW5jbHVkZSBzcGVjaWZpYyBpbmdyZWRpZW50c1xuICBpZiAob3B0aW9ucy5pbmNsdWRlT25seSAmJiBvcHRpb25zLmluY2x1ZGVPbmx5Lmxlbmd0aCA+IDApIHtcbiAgICBmaWx0ZXJlZEluZ3JlZGllbnRzID0gZmlsdGVyZWRJbmdyZWRpZW50cy5maWx0ZXIoaW5nID0+IFxuICAgICAgb3B0aW9ucy5pbmNsdWRlT25seT8uaW5jbHVkZXMoKGluZyBhcyBzdHJpbmcpPy5uYW1lKSk7XG4gIH1cbiAgXG4gIC8vIEV4dHJhY3Qga2V5IGFzdHJvbG9naWNhbCBpbmZvcm1hdGlvblxuICAvLyBFeHRyYWN0IGFzdHJvbG9naWNhbCBzdGF0ZSB3aXRoIHNhZmUgcHJvcGVydHkgYWNjZXNzXG4gIGNvbnN0IGFzdHJvU3RhdGVEYXRhID0gYXN0cm9TdGF0ZSBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPjtcbiAgY29uc3QgdGltZXN0YW1wID0gYXN0cm9TdGF0ZURhdGE/LnRpbWVzdGFtcCB8fCBuZXcgRGF0ZSgpO1xuICBjb25zdCBGaXJlID0gYXN0cm9TdGF0ZURhdGE/LkZpcmUgfHwgMC41O1xuICBjb25zdCBXYXRlciA9IGFzdHJvU3RhdGVEYXRhPy5XYXRlciB8fCAwLjU7XG4gIGNvbnN0IEFpciA9IGFzdHJvU3RhdGVEYXRhPy5BaXIgfHwgMC41O1xuICBjb25zdCBFYXJ0aCA9IGFzdHJvU3RhdGVEYXRhPy5FYXJ0aCB8fCAwLjU7XG4gIGNvbnN0IHpvZGlhY1NpZ24gPSBhc3Ryb1N0YXRlRGF0YT8uem9kaWFjU2lnbiB8fCAnJztcbiAgY29uc3QgcGxhbmV0YXJ5QWxpZ25tZW50ID0gYXN0cm9TdGF0ZURhdGE/LnBsYW5ldGFyeUFsaWdubWVudCB8fCB7fTtcbiAgY29uc3QgYXNwZWN0cyA9IGFzdHJvU3RhdGVEYXRhPy5hc3BlY3RzIHx8IFtdO1xuICBjb25zdCBsdW5hclBoYXNlID0gYXN0cm9TdGF0ZURhdGE/Lmx1bmFyUGhhc2UgfHwgJyc7XG4gIFxuICAvLyBHZXQgcGxhbmV0YXJ5IGRheSBhbmQgaG91ciBmb3IgY3VycmVudCB0aW1lXG4gIGNvbnN0IGRhdGUgPSB0aW1lc3RhbXAgaW5zdGFuY2VvZiBEYXRlID8gdGltZXN0YW1wIDogbmV3IERhdGUodGltZXN0YW1wKTtcbiAgY29uc3QgcGxhbmV0YXJ5Q2FsY3VsYXRvciA9IHtcbiAgICBjYWxjdWxhdGVQbGFuZXRhcnlEYXk6IChkYXRlOiBEYXRlKSA9PiB7XG4gICAgICBjb25zdCBkYXlzID0gWydTdW4nLCAnTW9vbicsICdNYXJzJywgJ01lcmN1cnknLCAnSnVwaXRlcicsICdWZW51cycsICdTYXR1cm4nXTtcbiAgICAgIHJldHVybiBkYXlzW2RhdGUuZ2V0RGF5KCldO1xuICAgIH0sXG4gICAgY2FsY3VsYXRlUGxhbmV0YXJ5SG91cjogKGRhdGU6IERhdGUpID0+IHtcbiAgICAgIC8vIFRoaXMgaXMgYSBzaW1wbGlmaWVkIGNhbGN1bGF0aW9uXG4gICAgICBjb25zdCBob3VycyA9IFtcbiAgICAgICAgJ1N1bicsICdWZW51cycsICdNZXJjdXJ5JywgJ01vb24nLCAnU2F0dXJuJywgJ0p1cGl0ZXInLCAnTWFycycsXG4gICAgICAgICdTdW4nLCAnVmVudXMnLCAnTWVyY3VyeScsICdNb29uJywgJ1NhdHVybicsICdKdXBpdGVyJywgJ01hcnMnLFxuICAgICAgICAnU3VuJywgJ1ZlbnVzJywgJ01lcmN1cnknLCAnTW9vbicsICdTYXR1cm4nLCAnSnVwaXRlcicsICdNYXJzJyxcbiAgICAgICAgJ1N1bicsICdWZW51cycsICdNZXJjdXJ5JywgJ01vb24nXG4gICAgICBdO1xuICAgICAgcmV0dXJuIGhvdXJzW2RhdGUuZ2V0SG91cnMoKV07XG4gICAgfSxcbiAgICBpc0RheXRpbWU6IGlzRGF5dGltZVxuICB9O1xuICBcbiAgY29uc3QgcGxhbmV0YXJ5RGF5ID0gcGxhbmV0YXJ5Q2FsY3VsYXRvci5jYWxjdWxhdGVQbGFuZXRhcnlEYXkoZGF0ZSk7XG4gIGNvbnN0IHBsYW5ldGFyeUhvdXIgPSBwbGFuZXRhcnlDYWxjdWxhdG9yLmNhbGN1bGF0ZVBsYW5ldGFyeUhvdXIoZGF0ZSk7XG4gIGNvbnN0IGlzRGF5dGltZU5vdyA9IHBsYW5ldGFyeUNhbGN1bGF0b3IuaXNEYXl0aW1lKGRhdGUpO1xuICBcbiAgLy8gQ3JlYXRlIGVsZW1lbnRhbCBwcm9wZXJ0aWVzIG9iamVjdCBmb3IgdGhlIGN1cnJlbnQgc3lzdGVtIHN0YXRlXG4gIGNvbnN0IHN5c3RlbUVsZW1lbnRhbFByb3BzOiBFbGVtZW50YWxQcm9wZXJ0aWVzID0geyBGaXJlLCBXYXRlciwgQWlyLCBFYXJ0aCB9O1xuICBcbiAgY29uc3QgcmVjb21tZW5kYXRpb25zOiBJbmdyZWRpZW50UmVjb21tZW5kYXRpb25bXSA9IFtdO1xuICBcbiAgLy8gQ2FsY3VsYXRlIHNjb3JlcyBmb3IgZWFjaCBpbmdyZWRpZW50XG4gIGZvciAoY29uc3QgaW5ncmVkaWVudCBvZiBmaWx0ZXJlZEluZ3JlZGllbnRzKSB7XG4gICAgLy8gQ2FsY3VsYXRlIGVsZW1lbnRhbCBtYXRjaCAoNDUlIHdlaWdodClcbiAgICBjb25zdCBlbGVtZW50YWxTY29yZSA9IGNhbGN1bGF0ZUVsZW1lbnRhbFNjb3JlKChpbmdyZWRpZW50IGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KT8uZWxlbWVudGFsUHJvcGVydGllcywgc3lzdGVtRWxlbWVudGFsUHJvcHMpO1xuICAgIFxuICAgIC8vIENhbGN1bGF0ZSBwbGFuZXRhcnkgZGF5IGluZmx1ZW5jZSB3aXRoIGVuaGFuY2VkIGRpZ25pdHkgZWZmZWN0cyAoMzUlIHdlaWdodClcbiAgICBjb25zdCBwbGFuZXRhcnlEYXlTY29yZSA9IGNhbGN1bGF0ZVBsYW5ldGFyeURheUluZmx1ZW5jZShcbiAgICAgIGluZ3JlZGllbnQsIFxuICAgICAgcGxhbmV0YXJ5RGF5LCBcbiAgICAgIHBsYW5ldGFyeUFsaWdubWVudFxuICAgICk7XG4gICAgXG4gICAgLy8gQ2FsY3VsYXRlIHBsYW5ldGFyeSBob3VyIGluZmx1ZW5jZSB3aXRoIGVuaGFuY2VkIGRpZ25pdHkgYW5kIGFzcGVjdCBlZmZlY3RzICgyMCUgd2VpZ2h0KVxuICAgIGNvbnN0IHBsYW5ldGFyeUhvdXJTY29yZSA9IGNhbGN1bGF0ZVBsYW5ldGFyeUhvdXJJbmZsdWVuY2UoXG4gICAgICBpbmdyZWRpZW50LCBcbiAgICAgIHBsYW5ldGFyeUhvdXIsIFxuICAgICAgaXNEYXl0aW1lTm93LFxuICAgICAgcGxhbmV0YXJ5QWxpZ25tZW50LFxuICAgICAgYXNwZWN0c1xuICAgICk7XG4gICAgXG4gICAgLy8gQXBwbHkgc3RhbmRhcmRpemVkIHdlaWdodGluZ1xuICAgIGNvbnN0IHRvdGFsU2NvcmUgPSAoXG4gICAgICBlbGVtZW50YWxTY29yZSAqIDAuNDUgKyBcbiAgICAgIHBsYW5ldGFyeURheVNjb3JlICogMC4zNSArIFxuICAgICAgcGxhbmV0YXJ5SG91clNjb3JlICogMC4yMFxuICAgICk7XG4gICAgXG4gICAgLy8gR2VuZXJhdGUgaW5ncmVkaWVudC1zcGVjaWZpYyByZWNvbW1lbmRhdGlvbnMgYmFzZWQgb24gcGxhbmV0YXJ5IGluZmx1ZW5jZXNcbiAgICBjb25zdCBpbmdyZWRpZW50UmVjb21tZW5kYXRpb25zID0gZ2VuZXJhdGVSZWNvbW1lbmRhdGlvbnNGb3JJbmdyZWRpZW50KFxuICAgICAgaW5ncmVkaWVudCwgXG4gICAgICBwbGFuZXRhcnlEYXksIFxuICAgICAgcGxhbmV0YXJ5SG91ciwgXG4gICAgICBpc0RheXRpbWVOb3csXG4gICAgICBwbGFuZXRhcnlBbGlnbm1lbnQsXG4gICAgICBhc3BlY3RzXG4gICAgKTtcbiAgICBcbiAgICAvLyBBZGQgdG8gcmVjb21tZW5kYXRpb25zIGxpc3RcbiAgICAvLyBBcHBseSBQYXR0ZXJuIEw6IEludGVyZmFjZSBwcm9wZXJ0eSBtYXBwaW5nIGZvciBJbmdyZWRpZW50UmVjb21tZW5kYXRpb24gY29tcGF0aWJpbGl0eVxuICAgIGNvbnN0IGluZ3JlZGllbnREYXRhID0gaW5ncmVkaWVudCBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPjtcbiAgICBjb25zdCBpbmdyZWRpZW50UmVjb21tZW5kYXRpb246IEluZ3JlZGllbnRSZWNvbW1lbmRhdGlvbiA9IHtcbiAgICAgIG5hbWU6IGluZ3JlZGllbnREYXRhPy5uYW1lIHx8ICcnLFxuICAgICAgdHlwZTogaW5ncmVkaWVudERhdGE/LnR5cGUgfHwgJycsXG4gICAgICBjYXRlZ29yeTogaW5ncmVkaWVudERhdGE/LmNhdGVnb3J5LFxuICAgICAgZWxlbWVudGFsUHJvcGVydGllczogaW5ncmVkaWVudERhdGE/LmVsZW1lbnRhbFByb3BlcnRpZXMsXG4gICAgICBxdWFsaXRpZXM6IGluZ3JlZGllbnREYXRhPy5xdWFsaXRpZXMsXG4gICAgICBtYXRjaFNjb3JlOiB0b3RhbFNjb3JlLFxuICAgICAgbW9kYWxpdHk6IGluZ3JlZGllbnREYXRhPy5tb2RhbGl0eSxcbiAgICAgIHJlY29tbWVuZGF0aW9uczogaW5ncmVkaWVudFJlY29tbWVuZGF0aW9ucyxcbiAgICAgIGRlc2NyaXB0aW9uOiBpbmdyZWRpZW50RGF0YT8uZGVzY3JpcHRpb24sXG4gICAgICB0b3RhbFNjb3JlLFxuICAgICAgZWxlbWVudGFsU2NvcmU6IGVsZW1lbnRhbFNjb3JlICogMC40NSxcbiAgICAgIGFzdHJvbG9naWNhbFNjb3JlOiAocGxhbmV0YXJ5RGF5U2NvcmUgKiAwLjM1KSArIChwbGFuZXRhcnlIb3VyU2NvcmUgKiAwLjIwKSxcbiAgICAgIHNlYXNvbmFsU2NvcmU6IGluZ3JlZGllbnREYXRhPy5zZWFzb25hbFNjb3JlLFxuICAgICAgZGlldGFyeTogaW5ncmVkaWVudERhdGE/LmRpZXRhcnlcbiAgICB9O1xuICAgIFxuICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKGluZ3JlZGllbnRSZWNvbW1lbmRhdGlvbik7XG4gIH1cbiAgXG4gIC8vIFNvcnQgYnkgbWF0Y2ggc2NvcmUgKGhpZ2hlc3QgZmlyc3QpXG4gIHJlY29tbWVuZGF0aW9ucy5zb3J0KChhLCBiKSA9PiBiLm1hdGNoU2NvcmUgLSBhLm1hdGNoU2NvcmUpO1xuICBcbiAgLy8gQXBwbHkgbGltaXQgaWYgc3BlY2lmaWVkXG4gIGNvbnN0IGxpbWl0ID0gb3B0aW9ucy5saW1pdCB8fCAxMDtcbiAgcmV0dXJuIHJlY29tbWVuZGF0aW9ucy5zbGljZSgwLCBsaW1pdCk7XG59XG5cbi8qKlxuICogR2VuZXJhdGUgZW5oYW5jZWQgcmVjb21tZW5kYXRpb25zIGZvciBhbiBpbmdyZWRpZW50IGJhc2VkIG9uIHBsYW5ldGFyeSBpbmZsdWVuY2VzXG4gKi9cbmZ1bmN0aW9uIGdlbmVyYXRlUmVjb21tZW5kYXRpb25zRm9ySW5ncmVkaWVudChcbiAgaW5ncmVkaWVudDogSW5ncmVkaWVudCxcbiAgcGxhbmV0YXJ5RGF5OiBzdHJpbmcsXG4gIHBsYW5ldGFyeUhvdXI6IHN0cmluZyxcbiAgaXNEYXl0aW1lOiBib29sZWFuLFxuICBwbGFuZXRhcnlQb3NpdGlvbnM/OiBSZWNvcmQ8c3RyaW5nLCB7IHNpZ246IHN0cmluZzsgZGVncmVlOiBudW1iZXIgfT4sXG4gIGFzcGVjdHM/OiBBcnJheTx7IGFzcGVjdFR5cGU6IHN0cmluZzsgcGxhbmV0MTogc3RyaW5nOyBwbGFuZXQyOiBzdHJpbmc7IH0+XG4pOiBzdHJpbmdbXSB7XG4gIGNvbnN0IHJlY3M6IHN0cmluZ1tdID0gW107XG4gIFxuICAvLyBCYXNpYyByZWNvbW1lbmRhdGlvbiBiYXNlZCBvbiBwbGFuZXRhcnkgZGF5XG4gIGlmIChwbGFuZXRhcnlFbGVtZW50c1twbGFuZXRhcnlEYXldKSB7XG4gICAgY29uc3QgZGF5RWxlbWVudHMgPSBwbGFuZXRhcnlFbGVtZW50c1twbGFuZXRhcnlEYXldO1xuICAgIHJlY3MucHVzaChgJHsoaW5ncmVkaWVudCBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPik/Lm5hbWV9IHdvcmtzIHdlbGwgb24gJHtwbGFuZXRhcnlEYXl9J3MgZGF5IHdpdGggaXRzICR7ZGF5RWxlbWVudHMuZGl1cm5hbH0gYW5kICR7ZGF5RWxlbWVudHMubm9jdHVybmFsfSBpbmZsdWVuY2VzLmApO1xuICB9XG4gIFxuICAvLyBUaW1lLXNwZWNpZmljIHJlY29tbWVuZGF0aW9uIGJhc2VkIG9uIHBsYW5ldGFyeSBob3VyXG4gIGlmIChwbGFuZXRhcnlFbGVtZW50c1twbGFuZXRhcnlIb3VyXSkge1xuICAgIGNvbnN0IGhvdXJFbGVtZW50ID0gaXNEYXl0aW1lIFxuICAgICAgPyBwbGFuZXRhcnlFbGVtZW50c1twbGFuZXRhcnlIb3VyXS5kaXVybmFsIFxuICAgICAgOiBwbGFuZXRhcnlFbGVtZW50c1twbGFuZXRhcnlIb3VyXS5ub2N0dXJuYWw7XG4gICAgXG4gICAgcmVjcy5wdXNoKGBEdXJpbmcgdGhlIGN1cnJlbnQgaG91ciBvZiAke3BsYW5ldGFyeUhvdXJ9LCAkeyhpbmdyZWRpZW50IGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KT8ubmFtZX0ncyAke2hvdXJFbGVtZW50fSBwcm9wZXJ0aWVzIGFyZSBlbmhhbmNlZC5gKTtcbiAgfVxuICBcbiAgLy8gQWRkIGRpZ25pdHkgZWZmZWN0IHJlY29tbWVuZGF0aW9ucyBpZiBwbGFuZXQgaXMgaW4gZGlnbmlmaWVkIG9yIGRlYmlsaXRhdGVkIHNpZ25cbiAgaWYgKHBsYW5ldGFyeVBvc2l0aW9ucykge1xuICAgIC8vIENoZWNrIGRheSBwbGFuZXQgZGlnbml0eVxuICAgIGlmIChwbGFuZXRhcnlFbGVtZW50c1twbGFuZXRhcnlEYXldPy5kaWduaXR5RWZmZWN0ICYmIFxuICAgICAgICBwbGFuZXRhcnlQb3NpdGlvbnNbcGxhbmV0YXJ5RGF5XSkge1xuICAgICAgY29uc3QgZGF5U2lnbiA9IHBsYW5ldGFyeVBvc2l0aW9uc1twbGFuZXRhcnlEYXldLnNpZ247XG4gICAgICBjb25zdCBkYXlEaWduaXR5ID0gcGxhbmV0YXJ5RWxlbWVudHNbcGxhbmV0YXJ5RGF5XS5kaWduaXR5RWZmZWN0Py5bZGF5U2lnbl07XG4gICAgICBcbiAgICAgIGlmIChkYXlEaWduaXR5ICYmIGRheURpZ25pdHkgPiAwICYmIChpbmdyZWRpZW50IGFzIHN0cmluZyk/LmFzdHJvbG9naWNhbFByb2ZpbGU/LnJ1bGluZ1BsYW5ldHM/LmluY2x1ZGVzKHBsYW5ldGFyeURheSkpIHtcbiAgICAgICAgcmVjcy5wdXNoKGAke3BsYW5ldGFyeURheX0gaXMgJHtkYXlEaWduaXR5ID4gMSA/ICdleGFsdGVkJyA6ICdkaWduaWZpZWQnfSBpbiAke2RheVNpZ259LCBzdHJlbmd0aGVuaW5nICR7KGluZ3JlZGllbnQgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pPy5uYW1lfSdzIHByb3BlcnRpZXMuYCk7XG4gICAgICB9IGVsc2UgaWYgKGRheURpZ25pdHkgJiYgZGF5RGlnbml0eSA8IDAgJiYgKGluZ3JlZGllbnQgYXMgc3RyaW5nKT8uYXN0cm9sb2dpY2FsUHJvZmlsZT8ucnVsaW5nUGxhbmV0cz8uaW5jbHVkZXMocGxhbmV0YXJ5RGF5KSkge1xuICAgICAgICByZWNzLnB1c2goYCR7cGxhbmV0YXJ5RGF5fSBpcyAke2RheURpZ25pdHkgPCAtMSA/ICdpbiBmYWxsJyA6ICdpbiBkZXRyaW1lbnQnfSBpbiAke2RheVNpZ259LCByZXF1aXJpbmcgY2FyZWZ1bCBwcmVwYXJhdGlvbiBvZiAkeyhpbmdyZWRpZW50IGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KT8ubmFtZX0uYCk7XG4gICAgICB9XG4gICAgfVxuICAgIFxuICAgIC8vIENoZWNrIGhvdXIgcGxhbmV0IGRpZ25pdHlcbiAgICBpZiAocGxhbmV0YXJ5RWxlbWVudHNbcGxhbmV0YXJ5SG91cl0/LmRpZ25pdHlFZmZlY3QgJiYgXG4gICAgICAgIHBsYW5ldGFyeVBvc2l0aW9uc1twbGFuZXRhcnlIb3VyXSkge1xuICAgICAgY29uc3QgaG91clNpZ24gPSBwbGFuZXRhcnlQb3NpdGlvbnNbcGxhbmV0YXJ5SG91cl0uc2lnbjtcbiAgICAgIGNvbnN0IGhvdXJEaWduaXR5ID0gcGxhbmV0YXJ5RWxlbWVudHNbcGxhbmV0YXJ5SG91cl0uZGlnbml0eUVmZmVjdD8uW2hvdXJTaWduXTtcbiAgICAgIFxuICAgICAgaWYgKGhvdXJEaWduaXR5ICYmIGhvdXJEaWduaXR5ID4gMCAmJiAoaW5ncmVkaWVudCBhcyBzdHJpbmcpPy5hc3Ryb2xvZ2ljYWxQcm9maWxlPy5ydWxpbmdQbGFuZXRzPy5pbmNsdWRlcyhwbGFuZXRhcnlIb3VyKSkge1xuICAgICAgICByZWNzLnB1c2goYER1cmluZyB0aGlzIGhvdXIsICR7cGxhbmV0YXJ5SG91cn0ncyBkaWduaXR5IGluICR7aG91clNpZ259IGVuaGFuY2VzICR7KGluZ3JlZGllbnQgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pPy5uYW1lfSdzIGZsYXZvciBwcm9maWxlLmApO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICBcbiAgLy8gQWRkIGFzcGVjdC1iYXNlZCByZWNvbW1lbmRhdGlvbnNcbiAgaWYgKGFzcGVjdHMgJiYgYXNwZWN0cy5sZW5ndGggPiAwKSB7XG4gICAgY29uc3QgcmVsZXZhbnRBc3BlY3RzID0gYXNwZWN0cy5maWx0ZXIoYXNwZWN0ID0+IFxuICAgICAgKGFzcGVjdC5wbGFuZXQxID09PSBwbGFuZXRhcnlEYXkgfHwgYXNwZWN0LnBsYW5ldDIgPT09IHBsYW5ldGFyeURheSkgfHxcbiAgICAgIChhc3BlY3QucGxhbmV0MSA9PT0gcGxhbmV0YXJ5SG91ciB8fCBhc3BlY3QucGxhbmV0MiA9PT0gcGxhbmV0YXJ5SG91cikpO1xuICAgIFxuICAgIGZvciAoY29uc3QgYXNwZWN0IG9mIHJlbGV2YW50QXNwZWN0cykge1xuICAgICAgaWYgKGFzcGVjdC5hc3BlY3RUeXBlID09PSAnQ29uanVuY3Rpb24nKSB7XG4gICAgICAgIGNvbnN0IHBsYW5ldHMgPSBbYXNwZWN0LnBsYW5ldDEsIGFzcGVjdC5wbGFuZXQyXTtcbiAgICAgICAgaWYgKHBsYW5ldHMuaW5jbHVkZXMocGxhbmV0YXJ5RGF5KSB8fCBwbGFuZXRzLmluY2x1ZGVzKHBsYW5ldGFyeUhvdXIpKSB7XG4gICAgICAgICAgY29uc3Qgb3RoZXJQbGFuZXQgPSBwbGFuZXRzLmZpbmQocCA9PiBwICE9PSBwbGFuZXRhcnlEYXkgJiYgcCAhPT0gcGxhbmV0YXJ5SG91cik7XG4gICAgICAgICAgaWYgKG90aGVyUGxhbmV0ICYmIChpbmdyZWRpZW50IGFzIHN0cmluZyk/LmFzdHJvbG9naWNhbFByb2ZpbGU/LnJ1bGluZ1BsYW5ldHM/LmluY2x1ZGVzKG90aGVyUGxhbmV0KSkge1xuICAgICAgICAgICAgcmVjcy5wdXNoKGBUaGUgY29uanVuY3Rpb24gYmV0d2VlbiAke2FzcGVjdC5wbGFuZXQxfSBhbmQgJHthc3BlY3QucGxhbmV0Mn0gc3Ryb25nbHkgZW5oYW5jZXMgJHsoaW5ncmVkaWVudCBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPik/Lm5hbWV9J3MgcXVhbGl0aWVzLmApO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmIChhc3BlY3QuYXNwZWN0VHlwZSA9PT0gJ1RyaW5lJykge1xuICAgICAgICBjb25zdCBwbGFuZXRzID0gW2FzcGVjdC5wbGFuZXQxLCBhc3BlY3QucGxhbmV0Ml07XG4gICAgICAgIGlmIChwbGFuZXRzLmluY2x1ZGVzKHBsYW5ldGFyeURheSkgfHwgcGxhbmV0cy5pbmNsdWRlcyhwbGFuZXRhcnlIb3VyKSkge1xuICAgICAgICAgIGNvbnN0IG90aGVyUGxhbmV0ID0gcGxhbmV0cy5maW5kKHAgPT4gcCAhPT0gcGxhbmV0YXJ5RGF5ICYmIHAgIT09IHBsYW5ldGFyeUhvdXIpO1xuICAgICAgICAgIGlmIChvdGhlclBsYW5ldCAmJiAoaW5ncmVkaWVudCBhcyBzdHJpbmcpPy5hc3Ryb2xvZ2ljYWxQcm9maWxlPy5ydWxpbmdQbGFuZXRzPy5pbmNsdWRlcyhvdGhlclBsYW5ldCkpIHtcbiAgICAgICAgICAgIHJlY3MucHVzaChgVGhlIGhhcm1vbmlvdXMgdHJpbmUgYmV0d2VlbiAke2FzcGVjdC5wbGFuZXQxfSBhbmQgJHthc3BlY3QucGxhbmV0Mn0gY3JlYXRlcyBhIGZsb3dpbmcgZW5lcmd5IGZvciAkeyhpbmdyZWRpZW50IGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KT8ubmFtZX0uYCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG4gIFxuICAvLyBEaXJlY3QgcGxhbmV0YXJ5IGFmZmluaXR5IHJlY29tbWVuZGF0aW9uXG4gIGlmICgoaW5ncmVkaWVudCBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPik/LmFzdHJvbG9naWNhbFByb2ZpbGU/LnJ1bGluZ1BsYW5ldHMpIHtcbiAgICBjb25zdCBydWxpbmdQbGFuZXRzID0gKGluZ3JlZGllbnQgYXMgUmVjb3JkPHN0cmluZywgdW5rbm93bj4pPy5hc3Ryb2xvZ2ljYWxQcm9maWxlLnJ1bGluZ1BsYW5ldHM7XG4gICAgaWYgKHJ1bGluZ1BsYW5ldHMuaW5jbHVkZXMocGxhbmV0YXJ5RGF5KSkge1xuICAgICAgcmVjcy5wdXNoKGAkeyhpbmdyZWRpZW50IGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KT8ubmFtZX0gaXMgZXNwZWNpYWxseSBwb3RlbnQgdG9kYXkgYXMgaXQncyBydWxlZCBieSAke3BsYW5ldGFyeURheX0uYCk7XG4gICAgfVxuICAgIGlmIChydWxpbmdQbGFuZXRzLmluY2x1ZGVzKHBsYW5ldGFyeUhvdXIpKSB7XG4gICAgICByZWNzLnB1c2goYFRoaXMgaXMgYW4gb3B0aW1hbCBob3VyIHRvIHdvcmsgd2l0aCAkeyhpbmdyZWRpZW50IGFzIFJlY29yZDxzdHJpbmcsIHVua25vd24+KT8ubmFtZX0gZHVlIHRvICR7cGxhbmV0YXJ5SG91cn0ncyBpbmZsdWVuY2UuYCk7XG4gICAgfVxuICB9XG4gIFxuICByZXR1cm4gcmVjcztcbn1cblxuLy8gLi4uIGV4aXN0aW5nIGNvZGUgLi4uXG5cbi8vIEF0IHRoZSB0b3Agb2YgdGhlIGZpbGUsIGFkZCB0aGUgcmUtZXhwb3J0XG5leHBvcnQgdHlwZSB7IEVuaGFuY2VkSW5ncmVkaWVudFJlY29tbWVuZGF0aW9uIH0gZnJvbSAnLi9yZWNvbW1lbmRhdGlvbi9pbmdyZWRpZW50UmVjb21tZW5kYXRpb24nO1xuXG4vLyAuLi4gZXhpc3RpbmcgY29kZSAuLi5cblxuLy8gLi4uIGV4aXN0aW5nIGNvZGUgLi4uXG4vLyAuLi4gZXhpc3RpbmcgY29kZSAuLi4iXSwidmVyc2lvbiI6M30=