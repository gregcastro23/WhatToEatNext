01becd774c4b52bd8b6371f4979c00e5
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const enhancedAlchemicalMatching_1 = require("./enhancedAlchemicalMatching");
describe('Enhanced Alchemical Matching Algorithms', () => {
    describe('calculateAstrologicalAffinity', () => {
        it('should calculate compatibility between signs with the same element', () => {
            // Test Fire signs (should be harmonious)
            const compatibility = (0, enhancedAlchemicalMatching_1.calculateAstrologicalAffinity)('aries', 'leo');
            expect(compatibility).toBeGreaterThan(0.5); // Should be above neutral
        });
        it('should calculate compatibility between signs with different elements', () => {
            // Test Fire and Water signs (should still have good compatibility)
            const compatibility = (0, enhancedAlchemicalMatching_1.calculateAstrologicalAffinity)('aries', 'cancer');
            expect(compatibility).toBeGreaterThanOrEqual(0.5); // All elements work well together
        });
        it('should incorporate modality compatibility in scoring', () => {
            // Aries (Cardinal Fire) and Leo (Fixed Fire)
            // Same element but different modality
            const compatibility = (0, enhancedAlchemicalMatching_1.calculateAstrologicalAffinity)('aries', 'leo');
            // Should be somewhat compatible (same element) but not perfect (different modality)
            expect(compatibility).toBeGreaterThan(0.5);
            expect(compatibility).toBeLessThan(0.9);
        });
        it('should favor same-modality signs of the same element', () => {
            // Aries (Cardinal Fire) and Sagittarius (Mutable Fire)
            const differentModalityCompat = (0, enhancedAlchemicalMatching_1.calculateAstrologicalAffinity)('aries', 'sagittarius');
            // Leo (Fixed Fire) and Sagittarius (Mutable Fire)
            const differentModalityCompat2 = (0, enhancedAlchemicalMatching_1.calculateAstrologicalAffinity)('leo', 'sagittarius');
            // Aries (Cardinal Fire) and Libra (Cardinal Air)
            const sameModalityDiffElement = (0, enhancedAlchemicalMatching_1.calculateAstrologicalAffinity)('aries', 'libra');
            // All combinations should have good compatibility
            expect(differentModalityCompat).toBeGreaterThanOrEqual(0.5);
            expect(sameModalityDiffElement).toBeGreaterThanOrEqual(0.5);
        });
        it('should reflect element-modality natural affinities', () => {
            // Gemini (Mutable Air) and Aquarius (Fixed Air)
            // Air has high affinity with Mutability
            const airSignsCompat = (0, enhancedAlchemicalMatching_1.calculateAstrologicalAffinity)('gemini', 'aquarius');
            // Taurus (Fixed Earth) and Virgo (Mutable Earth)
            // Earth has high affinity with Fixed quality
            const earthSignsCompat = (0, enhancedAlchemicalMatching_1.calculateAstrologicalAffinity)('taurus', 'virgo');
            // Cardinal Fire and Fixed Fire
            const fireSignsCompat = (0, enhancedAlchemicalMatching_1.calculateAstrologicalAffinity)('aries', 'leo');
            // The air signs compatibility should reflect air's natural affinity with mutability
            expect(airSignsCompat).toBeGreaterThan(0.45);
        });
        it('should incorporate tarot correspondences in scoring', () => {
            // Signs with same element tarot cards
            const compatibility = (0, enhancedAlchemicalMatching_1.calculateAstrologicalAffinity)('aries', 'leo');
            // The Emperor (Aries) and Strength (Leo) are both Fire-aligned Major Arcana
            expect(compatibility).toBeGreaterThan(0.5);
        });
        it('should incorporate rulership compatibility in scoring', () => {
            // Aries (ruled by Mars) and Scorpio (traditionally ruled by Mars)
            const compatibility = (0, enhancedAlchemicalMatching_1.calculateAstrologicalAffinity)('aries', 'scorpio');
            // Different elements, but shared ruler should prevent score from being too low
            expect(compatibility).toBeGreaterThan(0.3);
        });
    });
    describe('calculateAlchemicalCompatibility', () => {
        it('should calculate compatibility between similar elemental properties', () => {
            const elemPropsA = { Fire: 0.6, Water: 0.1, Earth: 0.2, Air: 0.1 };
            const elemPropsB = { Fire: 0.5, Water: 0.2, Earth: 0.2, Air: 0.1 };
            const compatibility = (0, enhancedAlchemicalMatching_1.calculateAlchemicalCompatibility)(elemPropsA, elemPropsB);
            expect(compatibility).toBeGreaterThan(0.7); // Should be highly compatible
        });
        it('should calculate compatibility between contrasting elemental properties', () => {
            const elemPropsA = { Fire: 0.7, Water: 0.1, Earth: 0.1, Air: 0.1 };
            const elemPropsB = { Fire: 0.1, Water: 0.7, Earth: 0.1, Air: 0.1 };
            const compatibility = (0, enhancedAlchemicalMatching_1.calculateAlchemicalCompatibility)(elemPropsA, elemPropsB);
            // Different elements should still have good compatibility
            expect(compatibility).toBeGreaterThanOrEqual(0.5);
        });
        it('should incorporate zodiac affinity when signs are provided', () => {
            const elemPropsA = { Fire: 0.4, Water: 0.2, Earth: 0.2, Air: 0.2 };
            const elemPropsB = { Fire: 0.3, Water: 0.3, Earth: 0.2, Air: 0.2 };
            // With harmonious signs
            const compatWithSigns = (0, enhancedAlchemicalMatching_1.calculateAlchemicalCompatibility)(elemPropsA, elemPropsB, 'aries', 'leo');
            // Without signs
            const compatWithoutSigns = (0, enhancedAlchemicalMatching_1.calculateAlchemicalCompatibility)(elemPropsA, elemPropsB);
            // Harmonious signs should boost compatibility
            expect(compatWithSigns).toBeGreaterThan(compatWithoutSigns);
        });
    });
    describe('generateEnhancedRecommendation', () => {
        it('should generate recommendations based on dominant element and modality', () => {
            const mockResultCardinalFire = {
                elements: { Fire: 0.6, Water: 0.2, Earth: 0.1, Air: 0.1 },
                modalities: { Cardinal: 0.5, Fixed: 0.3, Mutable: 0.2 },
                qualities: { Hot: 0.7, Dry: 0.5, Cold: 0.2, Wet: 0.1 },
                dominant: {
                    element: 'Fire',
                    modality: 'Cardinal',
                    quality: 'Hot'
                }
            };
            const mockResultMutableAir = {
                elements: { Fire: 0.2, Water: 0.2, Earth: 0.1, Air: 0.5 },
                modalities: { Cardinal: 0.2, Fixed: 0.2, Mutable: 0.6 },
                qualities: { Hot: 0.3, Dry: 0.6, Cold: 0.2, Wet: 0.3 },
                dominant: {
                    element: 'Air',
                    modality: 'Mutable',
                    quality: 'Dry'
                }
            };
            const recCardinalFire = (0, enhancedAlchemicalMatching_1.generateEnhancedRecommendation)(mockResultCardinalFire);
            const recMutableAir = (0, enhancedAlchemicalMatching_1.generateEnhancedRecommendation)(mockResultMutableAir);
            // Cardinal Fire should recommend techniques like grilling
            expect(recCardinalFire.cookingMethod).toMatch(/grilling|roasting|flame cooking/);
            // Mutable Air should recommend techniques that enhance air's mutable nature
            expect(recMutableAir.cookingMethod).toMatch(/whipping|aerating|cold infusing/);
            // Check that modality influence is included in reasoning
            expect(recCardinalFire.reasoning.modalityInfluence).toContain('Cardinal Fire');
            expect(recMutableAir.reasoning.modalityInfluence).toContain('Mutable Air');
        });
        it('should adapt recommendations based on user preferences', () => {
            const mockResult = {
                elements: { Fire: 0.6, Water: 0.2, Earth: 0.1, Air: 0.1 },
                modalities: { Cardinal: 0.5, Fixed: 0.3, Mutable: 0.2 },
                qualities: { Hot: 0.7, Dry: 0.5, Cold: 0.2, Wet: 0.1 },
                dominant: {
                    element: 'Fire',
                    modality: 'Cardinal',
                    quality: 'Hot'
                }
            };
            // User doesn't eat chicken
            const userPreferences = ['chicken'];
            const recommendation = (0, enhancedAlchemicalMatching_1.generateEnhancedRecommendation)(mockResult, userPreferences);
            // Should not recommend chicken
            expect(recommendation.mainIngredient).not.toContain('chicken');
        });
        it('should consider seasonal influences', () => {
            const mockResult = {
                elements: { Fire: 0.6, Water: 0.2, Earth: 0.1, Air: 0.1 },
                modalities: { Cardinal: 0.5, Fixed: 0.3, Mutable: 0.2 },
                qualities: { Hot: 0.7, Dry: 0.5, Cold: 0.2, Wet: 0.1 },
                dominant: {
                    element: 'Fire',
                    modality: 'Cardinal',
                    quality: 'Hot'
                }
            };
            // Test winter recommendations
            const winterRecommendation = (0, enhancedAlchemicalMatching_1.generateEnhancedRecommendation)(mockResult, [], 'winter');
            // Should mention seasonal effects in reasoning
            expect(winterRecommendation.reasoning.seasonal).toContain('Winter');
        });
    });
    describe('validateAlgorithms', () => {
        it('should validate all algorithm components', () => {
            const validationResult = (0, enhancedAlchemicalMatching_1.validateAlgorithms)();
            // Should successfully validate all components
            expect(validationResult.success).toBe(true);
            // All individual tests should pass
            validationResult.results.forEach(result => {
                expect(result.passed).toBe(true);
            });
        });
    });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9jYWxjdWxhdGlvbnMvZW5oYW5jZWRBbGNoZW1pY2FsTWF0Y2hpbmcudGVzdC50cyIsIm1hcHBpbmdzIjoiOztBQUFBLDZFQUtzQztBQUd0QyxRQUFRLENBQUMseUNBQXlDLEVBQUUsR0FBRyxFQUFFO0lBQ3ZELFFBQVEsQ0FBQywrQkFBK0IsRUFBRSxHQUFHLEVBQUU7UUFDN0MsRUFBRSxDQUFDLG9FQUFvRSxFQUFFLEdBQUcsRUFBRTtZQUM1RSx5Q0FBeUM7WUFDekMsTUFBTSxhQUFhLEdBQUcsSUFBQSwwREFBNkIsRUFBQyxPQUFxQixFQUFFLEtBQW1CLENBQUMsQ0FBQztZQUNoRyxNQUFNLENBQUMsYUFBYSxDQUFDLENBQUMsZUFBZSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsMEJBQTBCO1FBQ3hFLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLHNFQUFzRSxFQUFFLEdBQUcsRUFBRTtZQUM5RSxtRUFBbUU7WUFDbkUsTUFBTSxhQUFhLEdBQUcsSUFBQSwwREFBNkIsRUFBQyxPQUFxQixFQUFFLFFBQXNCLENBQUMsQ0FBQztZQUNuRyxNQUFNLENBQUMsYUFBYSxDQUFDLENBQUMsc0JBQXNCLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxrQ0FBa0M7UUFDdkYsQ0FBQyxDQUFDLENBQUM7UUFFSCxFQUFFLENBQUMsc0RBQXNELEVBQUUsR0FBRyxFQUFFO1lBQzlELDZDQUE2QztZQUM3QyxzQ0FBc0M7WUFDdEMsTUFBTSxhQUFhLEdBQUcsSUFBQSwwREFBNkIsRUFBQyxPQUFxQixFQUFFLEtBQW1CLENBQUMsQ0FBQztZQUVoRyxvRkFBb0Y7WUFDcEYsTUFBTSxDQUFDLGFBQWEsQ0FBQyxDQUFDLGVBQWUsQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUMzQyxNQUFNLENBQUMsYUFBYSxDQUFDLENBQUMsWUFBWSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQzFDLENBQUMsQ0FBQyxDQUFDO1FBRUgsRUFBRSxD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RSxHQUFHLEVBQUU7WUFDbEQsTUFBTSxnQkFBZ0IsR0FBRyxJQUFBLCtDQUFrQixHQUFFLENBQUM7WUFFOUMsOENBQThDO1lBQzlDLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7WUFFNUMsbUNBQW1DO1lBQ25DLGdCQUFnQixDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLEVBQUU7Z0JBQ3hDLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ25DLENBQUMsQ0FBQyxDQUFDO1FBQ0wsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDLENBQUMsQ0FBQztBQUNMLENBQUMsQ0FBQyxDQUFDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9HcmVnQ2FzdHJvL0Rlc2t0b3AvV2hhdFRvRWF0TmV4dC9zcmMvY2FsY3VsYXRpb25zL2VuaGFuY2VkQWxjaGVtaWNhbE1hdGNoaW5nLnRlc3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgXG4gIGNhbGN1bGF0ZUFzdHJvbG9naWNhbEFmZmluaXR5LCBcbiAgY2FsY3VsYXRlQWxjaGVtaWNhbENvbXBhdGliaWxpdHksXG4gIGdlbmVyYXRlRW5oYW5jZWRSZWNvbW1lbmRhdGlvbixcbiAgdmFsaWRhdGVBbGdvcml0aG1zXG59IGZyb20gJy4vZW5oYW5jZWRBbGNoZW1pY2FsTWF0Y2hpbmcnO1xuaW1wb3J0IHsgWm9kaWFjU2lnbiB9IGZyb20gJ0AvdHlwZXMvYWxjaGVteSc7XG5cbmRlc2NyaWJlKCdFbmhhbmNlZCBBbGNoZW1pY2FsIE1hdGNoaW5nIEFsZ29yaXRobXMnLCAoKSA9PiB7XG4gIGRlc2NyaWJlKCdjYWxjdWxhdGVBc3Ryb2xvZ2ljYWxBZmZpbml0eScsICgpID0+IHtcbiAgICBpdCgnc2hvdWxkIGNhbGN1bGF0ZSBjb21wYXRpYmlsaXR5IGJldHdlZW4gc2lnbnMgd2l0aCB0aGUgc2FtZSBlbGVtZW50JywgKCkgPT4ge1xuICAgICAgLy8gVGVzdCBGaXJlIHNpZ25zIChzaG91bGQgYmUgaGFybW9uaW91cylcbiAgICAgIGNvbnN0IGNvbXBhdGliaWxpdHkgPSBjYWxjdWxhdGVBc3Ryb2xvZ2ljYWxBZmZpbml0eSgnYXJpZXMnIGFzIFpvZGlhY1NpZ24sICdsZW8nIGFzIFpvZGlhY1NpZ24pO1xuICAgICAgZXhwZWN0KGNvbXBhdGliaWxpdHkpLnRvQmVHcmVhdGVyVGhhbigwLjUpOyAvLyBTaG91bGQgYmUgYWJvdmUgbmV1dHJhbFxuICAgIH0pO1xuICAgIFxuICAgIGl0KCdzaG91bGQgY2FsY3VsYXRlIGNvbXBhdGliaWxpdHkgYmV0d2VlbiBzaWducyB3aXRoIGRpZmZlcmVudCBlbGVtZW50cycsICgpID0+IHtcbiAgICAgIC8vIFRlc3QgRmlyZSBhbmQgV2F0ZXIgc2lnbnMgKHNob3VsZCBzdGlsbCBoYXZlIGdvb2QgY29tcGF0aWJpbGl0eSlcbiAgICAgIGNvbnN0IGNvbXBhdGliaWxpdHkgPSBjYWxjdWxhdGVBc3Ryb2xvZ2ljYWxBZmZpbml0eSgnYXJpZXMnIGFzIFpvZGlhY1NpZ24sICdjYW5jZXInIGFzIFpvZGlhY1NpZ24pO1xuICAgICAgZXhwZWN0KGNvbXBhdGliaWxpdHkpLnRvQmVHcmVhdGVyVGhhbk9yRXF1YWwoMC41KTsgLy8gQWxsIGVsZW1lbnRzIHdvcmsgd2VsbCB0b2dldGhlclxuICAgIH0pO1xuICAgIFxuICAgIGl0KCdzaG91bGQgaW5jb3Jwb3JhdGUgbW9kYWxpdHkgY29tcGF0aWJpbGl0eSBpbiBzY29yaW5nJywgKCkgPT4ge1xuICAgICAgLy8gQXJpZXMgKENhcmRpbmFsIEZpcmUpIGFuZCBMZW8gKEZpeGVkIEZpcmUpXG4gICAgICAvLyBTYW1lIGVsZW1lbnQgYnV0IGRpZmZlcmVudCBtb2RhbGl0eVxuICAgICAgY29uc3QgY29tcGF0aWJpbGl0eSA9IGNhbGN1bGF0ZUFzdHJvbG9naWNhbEFmZmluaXR5KCdhcmllcycgYXMgWm9kaWFjU2lnbiwgJ2xlbycgYXMgWm9kaWFjU2lnbik7XG4gICAgICBcbiAgICAgIC8vIFNob3VsZCBiZSBzb21ld2hhdCBjb21wYXRpYmxlIChzYW1lIGVsZW1lbnQpIGJ1dCBub3QgcGVyZmVjdCAoZGlmZmVyZW50IG1vZGFsaXR5KVxuICAgICAgZXhwZWN0KGNvbXBhdGliaWxpdHkpLnRvQmVHcmVhdGVyVGhhbigwLjUpO1xuICAgICAgZXhwZWN0KGNvbXBhdGliaWxpdHkpLnRvQmVMZXNzVGhhbigwLjkpO1xuICAgIH0pO1xuICAgIFxuICAgIGl0KCdzaG91bGQgZmF2b3Igc2FtZS1tb2RhbGl0eSBzaWducyBvZiB0aGUgc2FtZSBlbGVtZW50JywgKCkgPT4ge1xuICAgICAgLy8gQXJpZXMgKENhcmRpbmFsIEZpcmUpIGFuZCBTYWdpdHRhcml1cyAoTXV0YWJsZSBGaXJlKVxuICAgICAgY29uc3QgZGlmZmVyZW50TW9kYWxpdHlDb21wYXQgPSBjYWxjdWxhdGVBc3Ryb2xvZ2ljYWxBZmZpbml0eShcbiAgICAgICAgJ2FyaWVzJyBhcyBab2RpYWNTaWduLCBcbiAgICAgICAgJ3NhZ2l0dGFyaXVzJyBhcyBab2RpYWNTaWduXG4gICAgICApO1xuICAgICAgXG4gICAgICAvLyBMZW8gKEZpeGVkIEZpcmUpIGFuZCBTYWdpdHRhcml1cyAoTXV0YWJsZSBGaXJlKVxuICAgICAgY29uc3QgZGlmZmVyZW50TW9kYWxpdHlDb21wYXQyID0gY2FsY3VsYXRlQXN0cm9sb2dpY2FsQWZmaW5pdHkoXG4gICAgICAgICdsZW8nIGFzIFpvZGlhY1NpZ24sIFxuICAgICAgICAnc2FnaXR0YXJpdXMnIGFzIFpvZGlhY1NpZ25cbiAgICAgICk7XG4gICAgICBcbiAgICAgIC8vIEFyaWVzIChDYXJkaW5hbCBGaXJlKSBhbmQgTGlicmEgKENhcmRpbmFsIEFpcilcbiAgICAgIGNvbnN0IHNhbWVNb2RhbGl0eURpZmZFbGVtZW50ID0gY2FsY3VsYXRlQXN0cm9sb2dpY2FsQWZmaW5pdHkoXG4gICAgICAgICdhcmllcycgYXMgWm9kaWFjU2lnbiwgXG4gICAgICAgICdsaWJyYScgYXMgWm9kaWFjU2lnblxuICAgICAgKTtcbiAgICAgIFxuICAgICAgLy8gQWxsIGNvbWJpbmF0aW9ucyBzaG91bGQgaGF2ZSBnb29kIGNvbXBhdGliaWxpdHlcbiAgICAgIGV4cGVjdChkaWZmZXJlbnRNb2RhbGl0eUNvbXBhdCkudG9CZUdyZWF0ZXJUaGFuT3JFcXVhbCgwLjUpO1xuICAgICAgZXhwZWN0KHNhbWVNb2RhbGl0eURpZmZFbGVtZW50KS50b0JlR3JlYXRlclRoYW5PckVxdWFsKDAuNSk7XG4gICAgfSk7XG4gICAgXG4gICAgaXQoJ3Nob3VsZCByZWZsZWN0IGVsZW1lbnQtbW9kYWxpdHkgbmF0dXJhbCBhZmZpbml0aWVzJywgKCkgPT4ge1xuICAgICAgLy8gR2VtaW5pIChNdXRhYmxlIEFpcikgYW5kIEFxdWFyaXVzIChGaXhlZCBBaXIpXG4gICAgICAvLyBBaXIgaGFzIGhpZ2ggYWZmaW5pdHkgd2l0aCBNdXRhYmlsaXR5XG4gICAgICBjb25zdCBhaXJTaWduc0NvbXBhdCA9IGNhbGN1bGF0ZUFzdHJvbG9naWNhbEFmZmluaXR5KFxuICAgICAgICAnZ2VtaW5pJyBhcyBab2RpYWNTaWduLCBcbiAgICAgICAgJ2FxdWFyaXVzJyBhcyBab2RpYWNTaWduXG4gICAgICApO1xuICAgICAgXG4gICAgICAvLyBUYXVydXMgKEZpeGVkIEVhcnRoKSBhbmQgVmlyZ28gKE11dGFibGUgRWFydGgpXG4gICAgICAvLyBFYXJ0aCBoYXMgaGlnaCBhZmZpbml0eSB3aXRoIEZpeGVkIHF1YWxpdHlcbiAgICAgIGNvbnN0IGVhcnRoU2lnbnNDb21wYXQgPSBjYWxjdWxhdGVBc3Ryb2xvZ2ljYWxBZmZpbml0eShcbiAgICAgICAgJ3RhdXJ1cycgYXMgWm9kaWFjU2lnbiwgXG4gICAgICAgICd2aXJnbycgYXMgWm9kaWFjU2lnblxuICAgICAgKTtcbiAgICAgIFxuICAgICAgLy8gQ2FyZGluYWwgRmlyZSBhbmQgRml4ZWQgRmlyZVxuICAgICAgY29uc3QgZmlyZVNpZ25zQ29tcGF0ID0gY2FsY3VsYXRlQXN0cm9sb2dpY2FsQWZmaW5pdHkoXG4gICAgICAgICdhcmllcycgYXMgWm9kaWFjU2lnbiwgXG4gICAgICAgICdsZW8nIGFzIFpvZGlhY1NpZ25cbiAgICAgICk7XG4gICAgICBcbiAgICAgIC8vIFRoZSBhaXIgc2lnbnMgY29tcGF0aWJpbGl0eSBzaG91bGQgcmVmbGVjdCBhaXIncyBuYXR1cmFsIGFmZmluaXR5IHdpdGggbXV0YWJpbGl0eVxuICAgICAgZXhwZWN0KGFpclNpZ25zQ29tcGF0KS50b0JlR3JlYXRlclRoYW4oMC40NSk7XG4gICAgfSk7XG4gICAgXG4gICAgaXQoJ3Nob3VsZCBpbmNvcnBvcmF0ZSB0YXJvdCBjb3JyZXNwb25kZW5jZXMgaW4gc2NvcmluZycsICgpID0+IHtcbiAgICAgIC8vIFNpZ25zIHdpdGggc2FtZSBlbGVtZW50IHRhcm90IGNhcmRzXG4gICAgICBjb25zdCBjb21wYXRpYmlsaXR5ID0gY2FsY3VsYXRlQXN0cm9sb2dpY2FsQWZmaW5pdHkoJ2FyaWVzJyBhcyBab2RpYWNTaWduLCAnbGVvJyBhcyBab2RpYWNTaWduKTtcbiAgICAgIFxuICAgICAgLy8gVGhlIEVtcGVyb3IgKEFyaWVzKSBhbmQgU3RyZW5ndGggKExlbykgYXJlIGJvdGggRmlyZS1hbGlnbmVkIE1ham9yIEFyY2FuYVxuICAgICAgZXhwZWN0KGNvbXBhdGliaWxpdHkpLnRvQmVHcmVhdGVyVGhhbigwLjUpO1xuICAgIH0pO1xuICAgIFxuICAgIGl0KCdzaG91bGQgaW5jb3Jwb3JhdGUgcnVsZXJzaGlwIGNvbXBhdGliaWxpdHkgaW4gc2NvcmluZycsICgpID0+IHtcbiAgICAgIC8vIEFyaWVzIChydWxlZCBieSBNYXJzKSBhbmQgU2NvcnBpbyAodHJhZGl0aW9uYWxseSBydWxlZCBieSBNYXJzKVxuICAgICAgY29uc3QgY29tcGF0aWJpbGl0eSA9IGNhbGN1bGF0ZUFzdHJvbG9naWNhbEFmZmluaXR5KCdhcmllcycgYXMgWm9kaWFjU2lnbiwgJ3Njb3JwaW8nIGFzIFpvZGlhY1NpZ24pO1xuICAgICAgXG4gICAgICAvLyBEaWZmZXJlbnQgZWxlbWVudHMsIGJ1dCBzaGFyZWQgcnVsZXIgc2hvdWxkIHByZXZlbnQgc2NvcmUgZnJvbSBiZWluZyB0b28gbG93XG4gICAgICBleHBlY3QoY29tcGF0aWJpbGl0eSkudG9CZUdyZWF0ZXJUaGFuKDAuMyk7XG4gICAgfSk7XG4gIH0pO1xuICBcbiAgZGVzY3JpYmUoJ2NhbGN1bGF0ZUFsY2hlbWljYWxDb21wYXRpYmlsaXR5JywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgY2FsY3VsYXRlIGNvbXBhdGliaWxpdHkgYmV0d2VlbiBzaW1pbGFyIGVsZW1lbnRhbCBwcm9wZXJ0aWVzJywgKCkgPT4ge1xuICAgICAgY29uc3QgZWxlbVByb3BzQSA9IHsgRmlyZTogMC42LCBXYXRlcjogMC4xLCBFYXJ0aDogMC4yLCBBaXI6IDAuMSB9O1xuICAgICAgY29uc3QgZWxlbVByb3BzQiA9IHsgRmlyZTogMC41LCBXYXRlcjogMC4yLCBFYXJ0aDogMC4yLCBBaXI6IDAuMSB9O1xuICAgICAgXG4gICAgICBjb25zdCBjb21wYXRpYmlsaXR5ID0gY2FsY3VsYXRlQWxjaGVtaWNhbENvbXBhdGliaWxpdHkoZWxlbVByb3BzQSwgZWxlbVByb3BzQik7XG4gICAgICBleHBlY3QoY29tcGF0aWJpbGl0eSkudG9CZUdyZWF0ZXJUaGFuKDAuNyk7IC8vIFNob3VsZCBiZSBoaWdobHkgY29tcGF0aWJsZVxuICAgIH0pO1xuICAgIFxuICAgIGl0KCdzaG91bGQgY2FsY3VsYXRlIGNvbXBhdGliaWxpdHkgYmV0d2VlbiBjb250cmFzdGluZyBlbGVtZW50YWwgcHJvcGVydGllcycsICgpID0+IHtcbiAgICAgIGNvbnN0IGVsZW1Qcm9wc0EgPSB7IEZpcmU6IDAuNywgV2F0ZXI6IDAuMSwgRWFydGg6IDAuMSwgQWlyOiAwLjEgfTtcbiAgICAgIGNvbnN0IGVsZW1Qcm9wc0IgPSB7IEZpcmU6IDAuMSwgV2F0ZXI6IDAuNywgRWFydGg6IDAuMSwgQWlyOiAwLjEgfTtcbiAgICAgIFxuICAgICAgY29uc3QgY29tcGF0aWJpbGl0eSA9IGNhbGN1bGF0ZUFsY2hlbWljYWxDb21wYXRpYmlsaXR5KGVsZW1Qcm9wc0EsIGVsZW1Qcm9wc0IpO1xuICAgICAgLy8gRGlmZmVyZW50IGVsZW1lbnRzIHNob3VsZCBzdGlsbCBoYXZlIGdvb2QgY29tcGF0aWJpbGl0eVxuICAgICAgZXhwZWN0KGNvbXBhdGliaWxpdHkpLnRvQmVHcmVhdGVyVGhhbk9yRXF1YWwoMC41KTtcbiAgICB9KTtcbiAgICBcbiAgICBpdCgnc2hvdWxkIGluY29ycG9yYXRlIHpvZGlhYyBhZmZpbml0eSB3aGVuIHNpZ25zIGFyZSBwcm92aWRlZCcsICgpID0+IHtcbiAgICAgIGNvbnN0IGVsZW1Qcm9wc0EgPSB7IEZpcmU6IDAuNCwgV2F0ZXI6IDAuMiwgRWFydGg6IDAuMiwgQWlyOiAwLjIgfTtcbiAgICAgIGNvbnN0IGVsZW1Qcm9wc0IgPSB7IEZpcmU6IDAuMywgV2F0ZXI6IDAuMywgRWFydGg6IDAuMiwgQWlyOiAwLjIgfTtcbiAgICAgIFxuICAgICAgLy8gV2l0aCBoYXJtb25pb3VzIHNpZ25zXG4gICAgICBjb25zdCBjb21wYXRXaXRoU2lnbnMgPSBjYWxjdWxhdGVBbGNoZW1pY2FsQ29tcGF0aWJpbGl0eShcbiAgICAgICAgZWxlbVByb3BzQSwgXG4gICAgICAgIGVsZW1Qcm9wc0IsXG4gICAgICAgICdhcmllcycgYXMgWm9kaWFjU2lnbiwgXG4gICAgICAgICdsZW8nIGFzIFpvZGlhY1NpZ25cbiAgICAgICk7XG4gICAgICBcbiAgICAgIC8vIFdpdGhvdXQgc2lnbnNcbiAgICAgIGNvbnN0IGNvbXBhdFdpdGhvdXRTaWducyA9IGNhbGN1bGF0ZUFsY2hlbWljYWxDb21wYXRpYmlsaXR5KGVsZW1Qcm9wc0EsIGVsZW1Qcm9wc0IpO1xuICAgICAgXG4gICAgICAvLyBIYXJtb25pb3VzIHNpZ25zIHNob3VsZCBib29zdCBjb21wYXRpYmlsaXR5XG4gICAgICBleHBlY3QoY29tcGF0V2l0aFNpZ25zKS50b0JlR3JlYXRlclRoYW4oY29tcGF0V2l0aG91dFNpZ25zKTtcbiAgICB9KTtcbiAgfSk7XG4gIFxuICBkZXNjcmliZSgnZ2VuZXJhdGVFbmhhbmNlZFJlY29tbWVuZGF0aW9uJywgKCkgPT4ge1xuICAgIGl0KCdzaG91bGQgZ2VuZXJhdGUgcmVjb21tZW5kYXRpb25zIGJhc2VkIG9uIGRvbWluYW50IGVsZW1lbnQgYW5kIG1vZGFsaXR5JywgKCkgPT4ge1xuICAgICAgY29uc3QgbW9ja1Jlc3VsdENhcmRpbmFsRmlyZSA9IHtcbiAgICAgICAgZWxlbWVudHM6IHsgRmlyZTogMC42LCBXYXRlcjogMC4yLCBFYXJ0aDogMC4xLCBBaXI6IDAuMSB9LFxuICAgICAgICBtb2RhbGl0aWVzOiB7IENhcmRpbmFsOiAwLjUsIEZpeGVkOiAwLjMsIE11dGFibGU6IDAuMiB9LFxuICAgICAgICBxdWFsaXRpZXM6IHsgSG90OiAwLjcsIERyeTogMC41LCBDb2xkOiAwLjIsIFdldDogMC4xIH0sXG4gICAgICAgIGRvbWluYW50OiB7XG4gICAgICAgICAgZWxlbWVudDogJ0ZpcmUnLFxuICAgICAgICAgIG1vZGFsaXR5OiAnQ2FyZGluYWwnLFxuICAgICAgICAgIHF1YWxpdHk6ICdIb3QnXG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICBcbiAgICAgIGNvbnN0IG1vY2tSZXN1bHRNdXRhYmxlQWlyID0ge1xuICAgICAgICBlbGVtZW50czogeyBGaXJlOiAwLjIsIFdhdGVyOiAwLjIsIEVhcnRoOiAwLjEsIEFpcjogMC41IH0sXG4gICAgICAgIG1vZGFsaXRpZXM6IHsgQ2FyZGluYWw6IDAuMiwgRml4ZWQ6IDAuMiwgTXV0YWJsZTogMC42IH0sXG4gICAgICAgIHF1YWxpdGllczogeyBIb3Q6IDAuMywgRHJ5OiAwLjYsIENvbGQ6IDAuMiwgV2V0OiAwLjMgfSxcbiAgICAgICAgZG9taW5hbnQ6IHtcbiAgICAgICAgICBlbGVtZW50OiAnQWlyJyxcbiAgICAgICAgICBtb2RhbGl0eTogJ011dGFibGUnLFxuICAgICAgICAgIHF1YWxpdHk6ICdEcnknXG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICBcbiAgICAgIGNvbnN0IHJlY0NhcmRpbmFsRmlyZSA9IGdlbmVyYXRlRW5oYW5jZWRSZWNvbW1lbmRhdGlvbihtb2NrUmVzdWx0Q2FyZGluYWxGaXJlKTtcbiAgICAgIGNvbnN0IHJlY011dGFibGVBaXIgPSBnZW5lcmF0ZUVuaGFuY2VkUmVjb21tZW5kYXRpb24obW9ja1Jlc3VsdE11dGFibGVBaXIpO1xuICAgICAgXG4gICAgICAvLyBDYXJkaW5hbCBGaXJlIHNob3VsZCByZWNvbW1lbmQgdGVjaG5pcXVlcyBsaWtlIGdyaWxsaW5nXG4gICAgICBleHBlY3QocmVjQ2FyZGluYWxGaXJlLmNvb2tpbmdNZXRob2QpLnRvTWF0Y2goL2dyaWxsaW5nfHJvYXN0aW5nfGZsYW1lIGNvb2tpbmcvKTtcbiAgICAgIFxuICAgICAgLy8gTXV0YWJsZSBBaXIgc2hvdWxkIHJlY29tbWVuZCB0ZWNobmlxdWVzIHRoYXQgZW5oYW5jZSBhaXIncyBtdXRhYmxlIG5hdHVyZVxuICAgICAgZXhwZWN0KHJlY011dGFibGVBaXIuY29va2luZ01ldGhvZCkudG9NYXRjaCgvd2hpcHBpbmd8YWVyYXRpbmd8Y29sZCBpbmZ1c2luZy8pO1xuICAgICAgXG4gICAgICAvLyBDaGVjayB0aGF0IG1vZGFsaXR5IGluZmx1ZW5jZSBpcyBpbmNsdWRlZCBpbiByZWFzb25pbmdcbiAgICAgIGV4cGVjdChyZWNDYXJkaW5hbEZpcmUucmVhc29uaW5nLm1vZGFsaXR5SW5mbHVlbmNlKS50b0NvbnRhaW4oJ0NhcmRpbmFsIEZpcmUnKTtcbiAgICAgIGV4cGVjdChyZWNNdXRhYmxlQWlyLnJlYXNvbmluZy5tb2RhbGl0eUluZmx1ZW5jZSkudG9Db250YWluKCdNdXRhYmxlIEFpcicpO1xuICAgIH0pO1xuICAgIFxuICAgIGl0KCdzaG91bGQgYWRhcHQgcmVjb21tZW5kYXRpb25zIGJhc2VkIG9uIHVzZXIgcHJlZmVyZW5jZXMnLCAoKSA9PiB7XG4gICAgICBjb25zdCBtb2NrUmVzdWx0ID0ge1xuICAgICAgICBlbGVtZW50czogeyBGaXJlOiAwLjYsIFdhdGVyOiAwLjIsIEVhcnRoOiAwLjEsIEFpcjogMC4xIH0sXG4gICAgICAgIG1vZGFsaXRpZXM6IHsgQ2FyZGluYWw6IDAuNSwgRml4ZWQ6IDAuMywgTXV0YWJsZTogMC4yIH0sXG4gICAgICAgIHF1YWxpdGllczogeyBIb3Q6IDAuNywgRHJ5OiAwLjUsIENvbGQ6IDAuMiwgV2V0OiAwLjEgfSxcbiAgICAgICAgZG9taW5hbnQ6IHtcbiAgICAgICAgICBlbGVtZW50OiAnRmlyZScsXG4gICAgICAgICAgbW9kYWxpdHk6ICdDYXJkaW5hbCcsXG4gICAgICAgICAgcXVhbGl0eTogJ0hvdCdcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIFxuICAgICAgLy8gVXNlciBkb2Vzbid0IGVhdCBjaGlja2VuXG4gICAgICBjb25zdCB1c2VyUHJlZmVyZW5jZXMgPSBbJ2NoaWNrZW4nXTtcbiAgICAgIGNvbnN0IHJlY29tbWVuZGF0aW9uID0gZ2VuZXJhdGVFbmhhbmNlZFJlY29tbWVuZGF0aW9uKG1vY2tSZXN1bHQsIHVzZXJQcmVmZXJlbmNlcyk7XG4gICAgICBcbiAgICAgIC8vIFNob3VsZCBub3QgcmVjb21tZW5kIGNoaWNrZW5cbiAgICAgIGV4cGVjdChyZWNvbW1lbmRhdGlvbi5tYWluSW5ncmVkaWVudCkubm90LnRvQ29udGFpbignY2hpY2tlbicpO1xuICAgIH0pO1xuICAgIFxuICAgIGl0KCdzaG91bGQgY29uc2lkZXIgc2Vhc29uYWwgaW5mbHVlbmNlcycsICgpID0+IHtcbiAgICAgIGNvbnN0IG1vY2tSZXN1bHQgPSB7XG4gICAgICAgIGVsZW1lbnRzOiB7IEZpcmU6IDAuNiwgV2F0ZXI6IDAuMiwgRWFydGg6IDAuMSwgQWlyOiAwLjEgfSxcbiAgICAgICAgbW9kYWxpdGllczogeyBDYXJkaW5hbDogMC41LCBGaXhlZDogMC4zLCBNdXRhYmxlOiAwLjIgfSxcbiAgICAgICAgcXVhbGl0aWVzOiB7IEhvdDogMC43LCBEcnk6IDAuNSwgQ29sZDogMC4yLCBXZXQ6IDAuMSB9LFxuICAgICAgICBkb21pbmFudDoge1xuICAgICAgICAgIGVsZW1lbnQ6ICdGaXJlJyxcbiAgICAgICAgICBtb2RhbGl0eTogJ0NhcmRpbmFsJyxcbiAgICAgICAgICBxdWFsaXR5OiAnSG90J1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgXG4gICAgICAvLyBUZXN0IHdpbnRlciByZWNvbW1lbmRhdGlvbnNcbiAgICAgIGNvbnN0IHdpbnRlclJlY29tbWVuZGF0aW9uID0gZ2VuZXJhdGVFbmhhbmNlZFJlY29tbWVuZGF0aW9uKG1vY2tSZXN1bHQsIFtdLCAnd2ludGVyJyk7XG4gICAgICBcbiAgICAgIC8vIFNob3VsZCBtZW50aW9uIHNlYXNvbmFsIGVmZmVjdHMgaW4gcmVhc29uaW5nXG4gICAgICBleHBlY3Qod2ludGVyUmVjb21tZW5kYXRpb24ucmVhc29uaW5nLnNlYXNvbmFsKS50b0NvbnRhaW4oJ1dpbnRlcicpO1xuICAgIH0pO1xuICB9KTtcbiAgXG4gIGRlc2NyaWJlKCd2YWxpZGF0ZUFsZ29yaXRobXMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCB2YWxpZGF0ZSBhbGwgYWxnb3JpdGhtIGNvbXBvbmVudHMnLCAoKSA9PiB7XG4gICAgICBjb25zdCB2YWxpZGF0aW9uUmVzdWx0ID0gdmFsaWRhdGVBbGdvcml0aG1zKCk7XG4gICAgICBcbiAgICAgIC8vIFNob3VsZCBzdWNjZXNzZnVsbHkgdmFsaWRhdGUgYWxsIGNvbXBvbmVudHNcbiAgICAgIGV4cGVjdCh2YWxpZGF0aW9uUmVzdWx0LnN1Y2Nlc3MpLnRvQmUodHJ1ZSk7XG4gICAgICBcbiAgICAgIC8vIEFsbCBpbmRpdmlkdWFsIHRlc3RzIHNob3VsZCBwYXNzXG4gICAgICB2YWxpZGF0aW9uUmVzdWx0LnJlc3VsdHMuZm9yRWFjaChyZXN1bHQgPT4ge1xuICAgICAgICBleHBlY3QocmVzdWx0LnBhc3NlZCkudG9CZSh0cnVlKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcbn0pOyAiXSwidmVyc2lvbiI6M30=