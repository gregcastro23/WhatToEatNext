9845955462aad28d368358c7fdde5afe
"use strict";
/**
 * Unused Export Analyzer
 * Perfect Codebase Campaign - Phase 3 Implementation
 *
 * Analyzes unused exports across the codebase and provides prioritization
 * for transformation into enterprise intelligence systems.
 */
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.UnusedExportAnalyzer = exports.TransformationComplexity = exports.FileCategory = exports.FilePriority = void 0;
const fs = __importStar(require("fs"));
const path = __importStar(require("path"));
const glob_1 = require("glob");
var FilePriority;
(function (FilePriority) {
    FilePriority["HIGH"] = "HIGH";
    FilePriority["MEDIUM"] = "MEDIUM";
    FilePriority["LOW"] = "LOW"; // External/test files
})(FilePriority || (exports.FilePriority = FilePriority = {}));
var FileCategory;
(function (FileCategory) {
    FileCategory["RECIPE"] = "RECIPE";
    FileCategory["CORE"] = "CORE";
    FileCategory["EXTERNAL"] = "EXTERNAL";
    FileCategory["TEST"] = "TEST";
    FileCategory["UTILITY"] = "UTILITY";
})(FileCategory || (exports.FileCategory = FileCategory = {}));
var TransformationComplexity;
(function (TransformationComplexity) {
    TransformationComplexity["SIMPLE"] = "SIMPLE";
    TransformationComplexity["MODERATE"] = "MODERATE";
    TransformationComplexity["COMPLEX"] = "COMPLEX";
    TransformationComplexity["VERY_COMPLEX"] = "VERY_COMPLEX";
})(TransformationComplexity || (exports.TransformationComplexity = TransformationComplexity = {}));
class UnusedExportAnalyzer {
    constructor(srcPath = 'src') {
        this.srcPath = srcPath;
        this.excludePatterns = [
            '**/node_modules/**',
            '**/*.test.ts',
            '**/*.test.tsx',
            '**/*.spec.ts',
            '**/*.spec.tsx',
            '**/dist/**',
            '**/build/**',
            '**/*.d.ts'
        ];
        this.priorityPatterns = {
            [FilePriority.HIGH]: [
                '**/data/recipes/**',
                '**/components/recipe/**',
                '**/services/recipe/**',
                '**/utils/recipe/**',
                '**/hooks/recipe/**'
            ],
            [FilePriority.MEDIUM]: [
                '**/components/**',
                '**/services/**',
                '**/utils/**',
                '**/hooks/**',
                '**/contexts/**',
                '**/providers/**'
            ],
            [FilePriority.LOW]: [
                '**/types/**',
                '**/constants/**',
                '**/config/**',
                '**/lib/**'
            ]
        };
    }
    /**
     * Analyze unused exports across the codebase
     */
    async analyzeUnusedExports() {
        console.log('ðŸ” Starting unused export analysis...');
        const files = await this.getAllSourceFiles();
        const fileAnalyses = [];
        for (const filePath of files) {
            try {
                const analysis = await this.analyzeFile(filePath);
                if (analysis.unusedExports.length > 0) {
                    fileAnalyses.push(analysis);
                }
            }
            catch (error) {
                console.warn(`âš ï¸  Failed to analyze ${filePath}:`, error);
            }
        }
        return this.categorizeAndSummarize(fileAnalyses);
    }
    /**
     * Get all source files for analysis
     */
    async getAllSourceFiles() {
        const patterns = [
            `${this.srcPath}/**/*.ts`,
            `${this.srcPath}/**/*.tsx`,
            `${this.srcPath}/**/*.js`,
            `${this.srcPath}/**/*.jsx`
        ];
        const files = [];
        for (const pattern of patterns) {
            const matches = await (0, glob_1.glob)(pattern, {
                ignore: this.excludePatterns,
                absolute: true
            });
            files.push(...matches);
        }
        return [...new Set(files)]; // Remove duplicates
    }
    /**
     * Analyze a single file for unused exports
     */
    async analyzeFile(filePath) {
        const content = await fs.promises.readFile(filePath, 'utf-8');
        const unusedExports = await this.findUnusedExports(filePath, content);
        const priority = this.determinePriority(filePath);
        const category = this.determineCategory(filePath);
        const safetyScore = this.calculateSafetyScore(filePath, content, unusedExports);
        const transformationCandidates = this.identifyTransformationCandidates(unusedExports);
        return {
            filePath,
            priority,
            unusedExports,
            safetyScore,
            transformationCandidates,
            category
        };
    }
    /**
     * Find unused exports in a file
     */
    async findUnusedExports(filePath, content) {
        const exports = this.extractExports(content);
        const unusedExports = [];
        for (const exportInfo of exports) {
            const usageCount = await this.countUsages(exportInfo.exportName, filePath);
            if (usageCount === 0) {
                unusedExports.push({
                    ...exportInfo,
                    usageCount,
                    complexity: this.calculateComplexity(content, exportInfo)
                });
            }
        }
        return unusedExports;
    }
    /**
     * Extract export information from file content
     */
    extractExports(content) {
        const exports = [];
        const lines = content.split('\n');
        lines.forEach((line, index) => {
            // Named exports
            const namedExportMatch = line.match(/export\s+(?:const|let|var|function|class|interface|type|enum)\s+(\w+)/);
            if (namedExportMatch) {
                exports.push({
                    filePath: '',
                    exportName: namedExportMatch[1],
                    exportType: this.determineExportType(line),
                    lineNumber: index + 1,
                    isDefault: false
                });
            }
            // Default exports
            const defaultExportMatch = line.match(/export\s+default\s+(?:(?:const|let|var|function|class)\s+)?(\w+)/);
            if (defaultExportMatch) {
                exports.push({
                    filePath: '',
                    exportName: defaultExportMatch[1] || 'default',
                    exportType: this.determineExportType(line),
                    lineNumber: index + 1,
                    isDefault: true
                });
            }
            // Export destructuring
            const destructuringMatch = line.match(/export\s*\{\s*([^}]+)\s*\}/);
            if (destructuringMatch) {
                const exportNames = destructuringMatch[1].split(',').map(name => name.trim());
                exportNames.forEach(name => {
                    const cleanName = name.split(' as ')[0].trim();
                    exports.push({
                        filePath: '',
                        exportName: cleanName,
                        exportType: 'variable',
                        lineNumber: index + 1,
                        isDefault: false
                    });
                });
            }
        });
        return exports;
    }
    /**
     * Determine export type from line content
     */
    determineExportType(line) {
        if (line.includes('function'))
            return 'function';
        if (line.includes('class'))
            return 'class';
        if (line.includes('interface'))
            return 'interface';
        if (line.includes('type'))
            return 'type';
        if (line.includes('const'))
            return 'const';
        return 'variable';
    }
    /**
     * Count usages of an export across the codebase
     */
    async countUsages(exportName, excludeFilePath) {
        const files = await this.getAllSourceFiles();
        let usageCount = 0;
        for (const filePath of files) {
            if (filePath === excludeFilePath)
                continue;
            try {
                const content = await fs.promises.readFile(filePath, 'utf-8');
                // Check for import statements
                const importRegex = new RegExp(`import.*\\b${exportName}\\b.*from`, 'g');
                const importMatches = content.match(importRegex) || [];
                usageCount += importMatches.length;
                // Check for direct usage (more complex analysis would be needed for complete accuracy)
                const usageRegex = new RegExp(`\\b${exportName}\\b`, 'g');
                const usageMatches = content.match(usageRegex) || [];
                // Subtract import matches to avoid double counting
                usageCount += Math.max(0, usageMatches.length - importMatches.length);
            }
            catch (error) {
                // Skip files that can't be read
                continue;
            }
        }
        return usageCount;
    }
    /**
     * Calculate complexity score for an export
     */
    calculateComplexity(content, exportInfo) {
        const lines = content.split('\n');
        const startLine = exportInfo.lineNumber - 1;
        // Simple heuristic: count lines of the export definition
        let complexity = 1;
        let braceCount = 0;
        let inExport = false;
        for (let i = startLine; i < lines.length; i++) {
            const line = lines[i];
            if (!inExport && line.includes('export')) {
                inExport = true;
            }
            if (inExport) {
                complexity++;
                braceCount += (line.match(/\{/g) || []).length;
                braceCount -= (line.match(/\}/g) || []).length;
                if (braceCount === 0 && line.includes('}')) {
                    break;
                }
                if (line.includes(';') && braceCount === 0) {
                    break;
                }
            }
        }
        return Math.min(complexity, 100); // Cap at 100
    }
    /**
     * Determine file priority based on path patterns
     */
    determinePriority(filePath) {
        const relativePath = path.relative(process.cwd(), filePath);
        for (const [priority, patterns] of Object.entries(this.priorityPatterns)) {
            for (const pattern of patterns) {
                if (this.matchesPattern(relativePath, pattern)) {
                    return priority;
                }
            }
        }
        return FilePriority.LOW;
    }
    /**
     * Determine file category
     */
    determineCategory(filePath) {
        const relativePath = path.relative(process.cwd(), filePath);
        if (relativePath.includes('/recipe'))
            return FileCategory.RECIPE;
        if (relativePath.includes('/test') || relativePath.includes('.test.') || relativePath.includes('.spec.')) {
            return FileCategory.TEST;
        }
        if (relativePath.includes('/components') || relativePath.includes('/services') || relativePath.includes('/hooks')) {
            return FileCategory.CORE;
        }
        if (relativePath.includes('/types') || relativePath.includes('/constants') || relativePath.includes('/config')) {
            return FileCategory.EXTERNAL;
        }
        return FileCategory.UTILITY;
    }
    /**
     * Calculate safety score for transformation
     */
    calculateSafetyScore(filePath, content, unusedExports) {
        let score = 100; // Start with perfect score
        // Reduce score based on file complexity
        const lines = content.split('\n').length;
        if (lines > 500)
            score -= 20;
        else if (lines > 200)
            score -= 10;
        // Reduce score based on number of unused exports
        if (unusedExports.length > 10)
            score -= 20;
        else if (unusedExports.length > 5)
            score -= 10;
        // Reduce score for critical files
        if (filePath.includes('/core/') || filePath.includes('/critical/')) {
            score -= 15;
        }
        // Increase score for test files (safer to transform)
        if (filePath.includes('/test/') || filePath.includes('.test.')) {
            score += 10;
        }
        return Math.max(0, Math.min(100, score));
    }
    /**
     * Identify transformation candidates
     */
    identifyTransformationCandidates(unusedExports) {
        return unusedExports.map(exportInfo => {
            const intelligenceSystemName = this.generateIntelligenceSystemName(exportInfo);
            const transformationComplexity = this.assessTransformationComplexity(exportInfo);
            const safetyScore = this.calculateTransformationSafetyScore(exportInfo);
            const estimatedBenefit = this.calculateEstimatedBenefit(exportInfo);
            return {
                export: exportInfo,
                intelligenceSystemName,
                transformationComplexity,
                safetyScore,
                estimatedBenefit
            };
        });
    }
    /**
     * Generate intelligence system name
     */
    generateIntelligenceSystemName(exportInfo) {
        const baseName = exportInfo.exportName.replace(/([A-Z])/g, '_$1').toUpperCase();
        return `${baseName}_INTELLIGENCE_SYSTEM`;
    }
    /**
     * Assess transformation complexity
     */
    assessTransformationComplexity(exportInfo) {
        if (exportInfo.complexity < 5)
            return TransformationComplexity.SIMPLE;
        if (exportInfo.complexity < 15)
            return TransformationComplexity.MODERATE;
        if (exportInfo.complexity < 30)
            return TransformationComplexity.COMPLEX;
        return TransformationComplexity.VERY_COMPLEX;
    }
    /**
     * Calculate transformation safety score
     */
    calculateTransformationSafetyScore(exportInfo) {
        let score = 90; // Start high for unused exports
        // Reduce for complex exports
        if (exportInfo.complexity > 20)
            score -= 20;
        else if (exportInfo.complexity > 10)
            score -= 10;
        // Increase for simple types
        if (exportInfo.exportType === 'interface' || exportInfo.exportType === 'type') {
            score += 10;
        }
        return Math.max(0, Math.min(100, score));
    }
    /**
     * Calculate estimated benefit of transformation
     */
    calculateEstimatedBenefit(exportInfo) {
        let benefit = 50; // Base benefit
        // Higher benefit for functions and classes (more transformable)
        if (exportInfo.exportType === 'function' || exportInfo.exportType === 'class') {
            benefit += 30;
        }
        // Higher benefit for complex exports (more intelligence potential)
        benefit += Math.min(20, exportInfo.complexity);
        return Math.min(100, benefit);
    }
    /**
     * Categorize and summarize analysis results
     */
    categorizeAndSummarize(fileAnalyses) {
        const highPriorityFiles = fileAnalyses.filter(f => f.priority === FilePriority.HIGH);
        const mediumPriorityFiles = fileAnalyses.filter(f => f.priority === FilePriority.MEDIUM);
        const lowPriorityFiles = fileAnalyses.filter(f => f.priority === FilePriority.LOW);
        const totalUnusedExports = fileAnalyses.reduce((sum, f) => sum + f.unusedExports.length, 0);
        const totalTransformationCandidates = fileAnalyses.reduce((sum, f) => sum + f.transformationCandidates.length, 0);
        const recipeFiles = fileAnalyses.filter(f => f.category === FileCategory.RECIPE).length;
        const coreFiles = fileAnalyses.filter(f => f.category === FileCategory.CORE).length;
        const externalFiles = fileAnalyses.filter(f => f.category === FileCategory.EXTERNAL).length;
        const averageSafetyScore = fileAnalyses.reduce((sum, f) => sum + f.safetyScore, 0) / fileAnalyses.length;
        return {
            totalFiles: fileAnalyses.length,
            totalUnusedExports,
            highPriorityFiles,
            mediumPriorityFiles,
            lowPriorityFiles,
            summary: {
                recipeFiles,
                coreFiles,
                externalFiles,
                totalTransformationCandidates,
                averageSafetyScore,
                estimatedIntelligenceSystems: totalTransformationCandidates
            }
        };
    }
    /**
     * Check if path matches pattern
     */
    matchesPattern(filePath, pattern) {
        const regex = new RegExp(pattern.replace(/\*\*/g, '.*').replace(/\*/g, '[^/]*'));
        return regex.test(filePath);
    }
    /**
     * Generate detailed report
     */
    generateReport(analysis) {
        const report = [
            '# Unused Export Analysis Report',
            '',
            '## Summary',
            `- Total files analyzed: ${analysis.totalFiles}`,
            `- Total unused exports: ${analysis.totalUnusedExports}`,
            `- Recipe files: ${analysis.summary.recipeFiles}`,
            `- Core files: ${analysis.summary.coreFiles}`,
            `- External files: ${analysis.summary.externalFiles}`,
            `- Transformation candidates: ${analysis.summary.totalTransformationCandidates}`,
            `- Average safety score: ${analysis.summary.averageSafetyScore.toFixed(1)}`,
            '',
            '## Priority Breakdown',
            `- High priority files: ${analysis.highPriorityFiles.length}`,
            `- Medium priority files: ${analysis.mediumPriorityFiles.length}`,
            `- Low priority files: ${analysis.lowPriorityFiles.length}`,
            '',
            '## Top Transformation Candidates',
            ''
        ];
        // Add top candidates from each priority level
        const topCandidates = [
            ...analysis.highPriorityFiles.slice(0, 5),
            ...analysis.mediumPriorityFiles.slice(0, 5),
            ...analysis.lowPriorityFiles.slice(0, 5)
        ];
        topCandidates.forEach(file => {
            report.push(`### ${file.filePath}`);
            report.push(`- Priority: ${file.priority}`);
            report.push(`- Safety Score: ${file.safetyScore}`);
            report.push(`- Unused Exports: ${file.unusedExports.length}`);
            report.push(`- Transformation Candidates: ${file.transformationCandidates.length}`);
            report.push('');
        });
        return report.join('\n');
    }
}
exports.UnusedExportAnalyzer = UnusedExportAnalyzer;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9zZXJ2aWNlcy9jYW1wYWlnbi9VbnVzZWRFeHBvcnRBbmFseXplci50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7OztHQU1HOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUVILHVDQUF5QjtBQUN6QiwyQ0FBNkI7QUFDN0IsK0JBQTRCO0FBK0M1QixJQUFZLFlBSVg7QUFKRCxXQUFZLFlBQVk7SUFDdEIsNkJBQWEsQ0FBQTtJQUNiLGlDQUFpQixDQUFBO0lBQ2pCLDJCQUFXLENBQUEsQ0FBUSxzQkFBc0I7QUFDM0MsQ0FBQyxFQUpXLFlBQVksNEJBQVosWUFBWSxRQUl2QjtBQUVELElBQVksWUFNWDtBQU5ELFdBQVksWUFBWTtJQUN0QixpQ0FBaUIsQ0FBQTtJQUNqQiw2QkFBYSxDQUFBO0lBQ2IscUNBQXFCLENBQUE7SUFDckIsNkJBQWEsQ0FBQTtJQUNiLG1DQUFtQixDQUFBO0FBQ3JCLENBQUMsRUFOVyxZQUFZLDRCQUFaLFlBQVksUUFNdkI7QUFFRCxJQUFZLHdCQUtYO0FBTEQsV0FBWSx3QkFBd0I7SUFDbEMsNkNBQWlCLENBQUE7SUFDakIsaURBQXFCLENBQUE7SUFDckIsK0NBQW1CLENBQUE7SUFDbkIseURBQTZCLENBQUE7QUFDL0IsQ0FBQyxFQUxXLHdCQUF3Qix3Q0FBeEIsd0JBQXdCLFFBS25DO0FBRUQsTUFBYSxvQkFBb0I7SUFLL0IsWUFBWSxVQUFrQixLQUFLO1FBQ2pDLElBQUksQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDO1FBQ3ZCLElBQUksQ0FBQyxlQUFlLEdBQUc7WUFDckIsb0JBQW9CO1lBQ3BCLGNBQWM7WUFDZCxlQUFlO1lBQ2YsY0FBYztZQUNkLGVBQWU7WUFDZixZQUFZO1lBQ1osYUFBYTtZQUNiLFdBQVc7U0FDWixDQUFDO1FBRUYsSUFBSSxDQUFDLGdCQUFnQixHQUFHO1lBQ3RCLENBQUMsWUFBWSxDQUFDLElBQUksQ0FBQyxFQUFFO2dCQUNuQixvQkFBb0I7Z0JBQ3BC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Q0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQztTQUN6QyxDQUFDO1FBRUYsYUFBYSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsRUFBRTtZQUMzQixNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUM7WUFDcEMsTUFBTSxDQUFDLElBQUksQ0FBQyxlQUFlLElBQUksQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDO1lBQzVDLE1BQU0sQ0FBQyxJQUFJLENBQUMsbUJBQW1CLElBQUksQ0FBQyxXQUFXLEVBQUUsQ0FBQyxDQUFDO1lBQ25ELE1BQU0sQ0FBQyxJQUFJLENBQUMscUJBQXFCLElBQUksQ0FBQyxhQUFhLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQztZQUM5RCxNQUFNLENBQUMsSUFBSSxDQUFDLGdDQUFnQyxJQUFJLENBQUMsd0JBQXdCLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQztZQUNwRixNQUFNLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDO1FBQ2xCLENBQUMsQ0FBQyxDQUFDO1FBRUgsT0FBTyxNQUFNLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0lBQzNCLENBQUM7Q0FDRjtBQXZlRCxvREF1ZUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9zZXJ2aWNlcy9jYW1wYWlnbi9VbnVzZWRFeHBvcnRBbmFseXplci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFVudXNlZCBFeHBvcnQgQW5hbHl6ZXJcbiAqIFBlcmZlY3QgQ29kZWJhc2UgQ2FtcGFpZ24gLSBQaGFzZSAzIEltcGxlbWVudGF0aW9uXG4gKiBcbiAqIEFuYWx5emVzIHVudXNlZCBleHBvcnRzIGFjcm9zcyB0aGUgY29kZWJhc2UgYW5kIHByb3ZpZGVzIHByaW9yaXRpemF0aW9uXG4gKiBmb3IgdHJhbnNmb3JtYXRpb24gaW50byBlbnRlcnByaXNlIGludGVsbGlnZW5jZSBzeXN0ZW1zLlxuICovXG5cbmltcG9ydCAqIGFzIGZzIGZyb20gJ2ZzJztcbmltcG9ydCAqIGFzIHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgeyBnbG9iIH0gZnJvbSAnZ2xvYic7XG5cbmV4cG9ydCBpbnRlcmZhY2UgVW51c2VkRXhwb3J0IHtcbiAgZmlsZVBhdGg6IHN0cmluZztcbiAgZXhwb3J0TmFtZTogc3RyaW5nO1xuICBleHBvcnRUeXBlOiAnZnVuY3Rpb24nIHwgJ2NsYXNzJyB8ICdpbnRlcmZhY2UnIHwgJ3R5cGUnIHwgJ2NvbnN0JyB8ICd2YXJpYWJsZSc7XG4gIGxpbmVOdW1iZXI6IG51bWJlcjtcbiAgaXNEZWZhdWx0OiBib29sZWFuO1xuICBjb21wbGV4aXR5OiBudW1iZXI7XG4gIHVzYWdlQ291bnQ6IG51bWJlcjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBGaWxlQW5hbHlzaXMge1xuICBmaWxlUGF0aDogc3RyaW5nO1xuICBwcmlvcml0eTogRmlsZVByaW9yaXR5O1xuICB1bnVzZWRFeHBvcnRzOiBVbnVzZWRFeHBvcnRbXTtcbiAgc2FmZXR5U2NvcmU6IG51bWJlcjtcbiAgdHJhbnNmb3JtYXRpb25DYW5kaWRhdGVzOiBUcmFuc2Zvcm1hdGlvbkNhbmRpZGF0ZVtdO1xuICBjYXRlZ29yeTogRmlsZUNhdGVnb3J5O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFRyYW5zZm9ybWF0aW9uQ2FuZGlkYXRlIHtcbiAgZXhwb3J0OiBVbnVzZWRFeHBvcnQ7XG4gIGludGVsbGlnZW5jZVN5c3RlbU5hbWU6IHN0cmluZztcbiAgdHJhbnNmb3JtYXRpb25Db21wbGV4aXR5OiBUcmFuc2Zvcm1hdGlvbkNvbXBsZXhpdHk7XG4gIHNhZmV0eVNjb3JlOiBudW1iZXI7XG4gIGVzdGltYXRlZEJlbmVmaXQ6IG51bWJlcjtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBBbmFseXNpc1Jlc3VsdCB7XG4gIHRvdGFsRmlsZXM6IG51bWJlcjtcbiAgdG90YWxVbnVzZWRFeHBvcnRzOiBudW1iZXI7XG4gIGhpZ2hQcmlvcml0eUZpbGVzOiBGaWxlQW5hbHlzaXNbXTtcbiAgbWVkaXVtUHJpb3JpdHlGaWxlczogRmlsZUFuYWx5c2lzW107XG4gIGxvd1ByaW9yaXR5RmlsZXM6IEZpbGVBbmFseXNpc1tdO1xuICBzdW1tYXJ5OiBBbmFseXNpc1N1bW1hcnk7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQW5hbHlzaXNTdW1tYXJ5IHtcbiAgcmVjaXBlRmlsZXM6IG51bWJlcjtcbiAgY29yZUZpbGVzOiBudW1iZXI7XG4gIGV4dGVybmFsRmlsZXM6IG51bWJlcjtcbiAgdG90YWxUcmFuc2Zvcm1hdGlvbkNhbmRpZGF0ZXM6IG51bWJlcjtcbiAgYXZlcmFnZVNhZmV0eVNjb3JlOiBudW1iZXI7XG4gIGVzdGltYXRlZEludGVsbGlnZW5jZVN5c3RlbXM6IG51bWJlcjtcbn1cblxuZXhwb3J0IGVudW0gRmlsZVByaW9yaXR5IHtcbiAgSElHSCA9ICdISUdIJywgICAgIC8vIFJlY2lwZSBidWlsZGluZyBmaWxlc1xuICBNRURJVU0gPSAnTUVESVVNJywgLy8gQ29yZSBzeXN0ZW0gZmlsZXNcbiAgTE9XID0gJ0xPVycgICAgICAgIC8vIEV4dGVybmFsL3Rlc3QgZmlsZXNcbn1cblxuZXhwb3J0IGVudW0gRmlsZUNhdGVnb3J5IHtcbiAgUkVDSVBFID0gJ1JFQ0lQRScsXG4gIENPUkUgPSAnQ09SRScsXG4gIEVYVEVSTkFMID0gJ0VYVEVSTkFMJyxcbiAgVEVTVCA9ICdURVNUJyxcbiAgVVRJTElUWSA9ICdVVElMSVRZJ1xufVxuXG5leHBvcnQgZW51bSBUcmFuc2Zvcm1hdGlvbkNvbXBsZXhpdHkge1xuICBTSU1QTEUgPSAnU0lNUExFJyxcbiAgTU9ERVJBVEUgPSAnTU9ERVJBVEUnLFxuICBDT01QTEVYID0gJ0NPTVBMRVgnLFxuICBWRVJZX0NPTVBMRVggPSAnVkVSWV9DT01QTEVYJ1xufVxuXG5leHBvcnQgY2xhc3MgVW51c2VkRXhwb3J0QW5hbHl6ZXIge1xuICBwcml2YXRlIHJlYWRvbmx5IHNyY1BhdGg6IHN0cmluZztcbiAgcHJpdmF0ZSByZWFkb25seSBleGNsdWRlUGF0dGVybnM6IHN0cmluZ1tdO1xuICBwcml2YXRlIHJlYWRvbmx5IHByaW9yaXR5UGF0dGVybnM6IFJlY29yZDxGaWxlUHJpb3JpdHksIHN0cmluZ1tdPjtcblxuICBjb25zdHJ1Y3RvcihzcmNQYXRoOiBzdHJpbmcgPSAnc3JjJykge1xuICAgIHRoaXMuc3JjUGF0aCA9IHNyY1BhdGg7XG4gICAgdGhpcy5leGNsdWRlUGF0dGVybnMgPSBbXG4gICAgICAnKiovbm9kZV9tb2R1bGVzLyoqJyxcbiAgICAgICcqKi8qLnRlc3QudHMnLFxuICAgICAgJyoqLyoudGVzdC50c3gnLFxuICAgICAgJyoqLyouc3BlYy50cycsXG4gICAgICAnKiovKi5zcGVjLnRzeCcsXG4gICAgICAnKiovZGlzdC8qKicsXG4gICAgICAnKiovYnVpbGQvKionLFxuICAgICAgJyoqLyouZC50cydcbiAgICBdO1xuXG4gICAgdGhpcy5wcmlvcml0eVBhdHRlcm5zID0ge1xuICAgICAgW0ZpbGVQcmlvcml0eS5ISUdIXTogW1xuICAgICAgICAnKiovZGF0YS9yZWNpcGVzLyoqJyxcbiAgICAgICAgJyoqL2NvbXBvbmVudHMvcmVjaXBlLyoqJyxcbiAgICAgICAgJyoqL3NlcnZpY2VzL3JlY2lwZS8qKicsXG4gICAgICAgICcqKi91dGlscy9yZWNpcGUvKionLFxuICAgICAgICAnKiovaG9va3MvcmVjaXBlLyoqJ1xuICAgICAgXSxcbiAgICAgIFtGaWxlUHJpb3JpdHkuTUVESVVNXTogW1xuICAgICAgICAnKiovY29tcG9uZW50cy8qKicsXG4gICAgICAgICcqKi9zZXJ2aWNlcy8qKicsXG4gICAgICAgICcqKi91dGlscy8qKicsXG4gICAgICAgICcqKi9ob29rcy8qKicsXG4gICAgICAgICcqKi9jb250ZXh0cy8qKicsXG4gICAgICAgICcqKi9wcm92aWRlcnMvKionXG4gICAgICBdLFxuICAgICAgW0ZpbGVQcmlvcml0eS5MT1ddOiBbXG4gICAgICAgICcqKi90eXBlcy8qKicsXG4gICAgICAgICcqKi9jb25zdGFudHMvKionLFxuICAgICAgICAnKiovY29uZmlnLyoqJyxcbiAgICAgICAgJyoqL2xpYi8qKidcbiAgICAgIF1cbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEFuYWx5emUgdW51c2VkIGV4cG9ydHMgYWNyb3NzIHRoZSBjb2RlYmFzZVxuICAgKi9cbiAgYXN5bmMgYW5hbHl6ZVVudXNlZEV4cG9ydHMoKTogUHJvbWlzZTxBbmFseXNpc1Jlc3VsdD4ge1xuICAgIGNvbnNvbGUubG9nKCfwn5SNIFN0YXJ0aW5nIHVudXNlZCBleHBvcnQgYW5hbHlzaXMuLi4nKTtcbiAgICBcbiAgICBjb25zdCBmaWxlcyA9IGF3YWl0IHRoaXMuZ2V0QWxsU291cmNlRmlsZXMoKTtcbiAgICBjb25zdCBmaWxlQW5hbHlzZXM6IEZpbGVBbmFseXNpc1tdID0gW107XG4gICAgXG4gICAgZm9yIChjb25zdCBmaWxlUGF0aCBvZiBmaWxlcykge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgYW5hbHlzaXMgPSBhd2FpdCB0aGlzLmFuYWx5emVGaWxlKGZpbGVQYXRoKTtcbiAgICAgICAgaWYgKGFuYWx5c2lzLnVudXNlZEV4cG9ydHMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIGZpbGVBbmFseXNlcy5wdXNoKGFuYWx5c2lzKTtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS53YXJuKGDimqDvuI8gIEZhaWxlZCB0byBhbmFseXplICR7ZmlsZVBhdGh9OmAsIGVycm9yKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5jYXRlZ29yaXplQW5kU3VtbWFyaXplKGZpbGVBbmFseXNlcyk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGFsbCBzb3VyY2UgZmlsZXMgZm9yIGFuYWx5c2lzXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGdldEFsbFNvdXJjZUZpbGVzKCk6IFByb21pc2U8c3RyaW5nW10+IHtcbiAgICBjb25zdCBwYXR0ZXJucyA9IFtcbiAgICAgIGAke3RoaXMuc3JjUGF0aH0vKiovKi50c2AsXG4gICAgICBgJHt0aGlzLnNyY1BhdGh9LyoqLyoudHN4YCxcbiAgICAgIGAke3RoaXMuc3JjUGF0aH0vKiovKi5qc2AsXG4gICAgICBgJHt0aGlzLnNyY1BhdGh9LyoqLyouanN4YFxuICAgIF07XG5cbiAgICBjb25zdCBmaWxlczogc3RyaW5nW10gPSBbXTtcbiAgICBmb3IgKGNvbnN0IHBhdHRlcm4gb2YgcGF0dGVybnMpIHtcbiAgICAgIGNvbnN0IG1hdGNoZXMgPSBhd2FpdCBnbG9iKHBhdHRlcm4sIHsgXG4gICAgICAgIGlnbm9yZTogdGhpcy5leGNsdWRlUGF0dGVybnMsXG4gICAgICAgIGFic29sdXRlOiB0cnVlIFxuICAgICAgfSk7XG4gICAgICBmaWxlcy5wdXNoKC4uLm1hdGNoZXMpO1xuICAgIH1cblxuICAgIHJldHVybiBbLi4ubmV3IFNldChmaWxlcyldOyAvLyBSZW1vdmUgZHVwbGljYXRlc1xuICB9XG5cbiAgLyoqXG4gICAqIEFuYWx5emUgYSBzaW5nbGUgZmlsZSBmb3IgdW51c2VkIGV4cG9ydHNcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgYW5hbHl6ZUZpbGUoZmlsZVBhdGg6IHN0cmluZyk6IFByb21pc2U8RmlsZUFuYWx5c2lzPiB7XG4gICAgY29uc3QgY29udGVudCA9IGF3YWl0IGZzLnByb21pc2VzLnJlYWRGaWxlKGZpbGVQYXRoLCAndXRmLTgnKTtcbiAgICBjb25zdCB1bnVzZWRFeHBvcnRzID0gYXdhaXQgdGhpcy5maW5kVW51c2VkRXhwb3J0cyhmaWxlUGF0aCwgY29udGVudCk7XG4gICAgY29uc3QgcHJpb3JpdHkgPSB0aGlzLmRldGVybWluZVByaW9yaXR5KGZpbGVQYXRoKTtcbiAgICBjb25zdCBjYXRlZ29yeSA9IHRoaXMuZGV0ZXJtaW5lQ2F0ZWdvcnkoZmlsZVBhdGgpO1xuICAgIGNvbnN0IHNhZmV0eVNjb3JlID0gdGhpcy5jYWxjdWxhdGVTYWZldHlTY29yZShmaWxlUGF0aCwgY29udGVudCwgdW51c2VkRXhwb3J0cyk7XG4gICAgY29uc3QgdHJhbnNmb3JtYXRpb25DYW5kaWRhdGVzID0gdGhpcy5pZGVudGlmeVRyYW5zZm9ybWF0aW9uQ2FuZGlkYXRlcyh1bnVzZWRFeHBvcnRzKTtcblxuICAgIHJldHVybiB7XG4gICAgICBmaWxlUGF0aCxcbiAgICAgIHByaW9yaXR5LFxuICAgICAgdW51c2VkRXhwb3J0cyxcbiAgICAgIHNhZmV0eVNjb3JlLFxuICAgICAgdHJhbnNmb3JtYXRpb25DYW5kaWRhdGVzLFxuICAgICAgY2F0ZWdvcnlcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEZpbmQgdW51c2VkIGV4cG9ydHMgaW4gYSBmaWxlXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGZpbmRVbnVzZWRFeHBvcnRzKGZpbGVQYXRoOiBzdHJpbmcsIGNvbnRlbnQ6IHN0cmluZyk6IFByb21pc2U8VW51c2VkRXhwb3J0W10+IHtcbiAgICBjb25zdCBleHBvcnRzID0gdGhpcy5leHRyYWN0RXhwb3J0cyhjb250ZW50KTtcbiAgICBjb25zdCB1bnVzZWRFeHBvcnRzOiBVbnVzZWRFeHBvcnRbXSA9IFtdO1xuXG4gICAgZm9yIChjb25zdCBleHBvcnRJbmZvIG9mIGV4cG9ydHMpIHtcbiAgICAgIGNvbnN0IHVzYWdlQ291bnQgPSBhd2FpdCB0aGlzLmNvdW50VXNhZ2VzKGV4cG9ydEluZm8uZXhwb3J0TmFtZSwgZmlsZVBhdGgpO1xuICAgICAgaWYgKHVzYWdlQ291bnQgPT09IDApIHtcbiAgICAgICAgdW51c2VkRXhwb3J0cy5wdXNoKHtcbiAgICAgICAgICAuLi5leHBvcnRJbmZvLFxuICAgICAgICAgIHVzYWdlQ291bnQsXG4gICAgICAgICAgY29tcGxleGl0eTogdGhpcy5jYWxjdWxhdGVDb21wbGV4aXR5KGNvbnRlbnQsIGV4cG9ydEluZm8pXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB1bnVzZWRFeHBvcnRzO1xuICB9XG5cbiAgLyoqXG4gICAqIEV4dHJhY3QgZXhwb3J0IGluZm9ybWF0aW9uIGZyb20gZmlsZSBjb250ZW50XG4gICAqL1xuICBwcml2YXRlIGV4dHJhY3RFeHBvcnRzKGNvbnRlbnQ6IHN0cmluZyk6IE9taXQ8VW51c2VkRXhwb3J0LCAndXNhZ2VDb3VudCcgfCAnY29tcGxleGl0eSc+W10ge1xuICAgIGNvbnN0IGV4cG9ydHM6IE9taXQ8VW51c2VkRXhwb3J0LCAndXNhZ2VDb3VudCcgfCAnY29tcGxleGl0eSc+W10gPSBbXTtcbiAgICBjb25zdCBsaW5lcyA9IGNvbnRlbnQuc3BsaXQoJ1xcbicpO1xuXG4gICAgbGluZXMuZm9yRWFjaCgobGluZSwgaW5kZXgpID0+IHtcbiAgICAgIC8vIE5hbWVkIGV4cG9ydHNcbiAgICAgIGNvbnN0IG5hbWVkRXhwb3J0TWF0Y2ggPSBsaW5lLm1hdGNoKC9leHBvcnRcXHMrKD86Y29uc3R8bGV0fHZhcnxmdW5jdGlvbnxjbGFzc3xpbnRlcmZhY2V8dHlwZXxlbnVtKVxccysoXFx3KykvKTtcbiAgICAgIGlmIChuYW1lZEV4cG9ydE1hdGNoKSB7XG4gICAgICAgIGV4cG9ydHMucHVzaCh7XG4gICAgICAgICAgZmlsZVBhdGg6ICcnLFxuICAgICAgICAgIGV4cG9ydE5hbWU6IG5hbWVkRXhwb3J0TWF0Y2hbMV0sXG4gICAgICAgICAgZXhwb3J0VHlwZTogdGhpcy5kZXRlcm1pbmVFeHBvcnRUeXBlKGxpbmUpLFxuICAgICAgICAgIGxpbmVOdW1iZXI6IGluZGV4ICsgMSxcbiAgICAgICAgICBpc0RlZmF1bHQ6IGZhbHNlXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBEZWZhdWx0IGV4cG9ydHNcbiAgICAgIGNvbnN0IGRlZmF1bHRFeHBvcnRNYXRjaCA9IGxpbmUubWF0Y2goL2V4cG9ydFxccytkZWZhdWx0XFxzKyg/Oig/OmNvbnN0fGxldHx2YXJ8ZnVuY3Rpb258Y2xhc3MpXFxzKyk/KFxcdyspLyk7XG4gICAgICBpZiAoZGVmYXVsdEV4cG9ydE1hdGNoKSB7XG4gICAgICAgIGV4cG9ydHMucHVzaCh7XG4gICAgICAgICAgZmlsZVBhdGg6ICcnLFxuICAgICAgICAgIGV4cG9ydE5hbWU6IGRlZmF1bHRFeHBvcnRNYXRjaFsxXSB8fCAnZGVmYXVsdCcsXG4gICAgICAgICAgZXhwb3J0VHlwZTogdGhpcy5kZXRlcm1pbmVFeHBvcnRUeXBlKGxpbmUpLFxuICAgICAgICAgIGxpbmVOdW1iZXI6IGluZGV4ICsgMSxcbiAgICAgICAgICBpc0RlZmF1bHQ6IHRydWVcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIEV4cG9ydCBkZXN0cnVjdHVyaW5nXG4gICAgICBjb25zdCBkZXN0cnVjdHVyaW5nTWF0Y2ggPSBsaW5lLm1hdGNoKC9leHBvcnRcXHMqXFx7XFxzKihbXn1dKylcXHMqXFx9Lyk7XG4gICAgICBpZiAoZGVzdHJ1Y3R1cmluZ01hdGNoKSB7XG4gICAgICAgIGNvbnN0IGV4cG9ydE5hbWVzID0gZGVzdHJ1Y3R1cmluZ01hdGNoWzFdLnNwbGl0KCcsJykubWFwKG5hbWUgPT4gbmFtZS50cmltKCkpO1xuICAgICAgICBleHBvcnROYW1lcy5mb3JFYWNoKG5hbWUgPT4ge1xuICAgICAgICAgIGNvbnN0IGNsZWFuTmFtZSA9IG5hbWUuc3BsaXQoJyBhcyAnKVswXS50cmltKCk7XG4gICAgICAgICAgZXhwb3J0cy5wdXNoKHtcbiAgICAgICAgICAgIGZpbGVQYXRoOiAnJyxcbiAgICAgICAgICAgIGV4cG9ydE5hbWU6IGNsZWFuTmFtZSxcbiAgICAgICAgICAgIGV4cG9ydFR5cGU6ICd2YXJpYWJsZScsXG4gICAgICAgICAgICBsaW5lTnVtYmVyOiBpbmRleCArIDEsXG4gICAgICAgICAgICBpc0RlZmF1bHQ6IGZhbHNlXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIGV4cG9ydHM7XG4gIH1cblxuICAvKipcbiAgICogRGV0ZXJtaW5lIGV4cG9ydCB0eXBlIGZyb20gbGluZSBjb250ZW50XG4gICAqL1xuICBwcml2YXRlIGRldGVybWluZUV4cG9ydFR5cGUobGluZTogc3RyaW5nKTogVW51c2VkRXhwb3J0WydleHBvcnRUeXBlJ10ge1xuICAgIGlmIChsaW5lLmluY2x1ZGVzKCdmdW5jdGlvbicpKSByZXR1cm4gJ2Z1bmN0aW9uJztcbiAgICBpZiAobGluZS5pbmNsdWRlcygnY2xhc3MnKSkgcmV0dXJuICdjbGFzcyc7XG4gICAgaWYgKGxpbmUuaW5jbHVkZXMoJ2ludGVyZmFjZScpKSByZXR1cm4gJ2ludGVyZmFjZSc7XG4gICAgaWYgKGxpbmUuaW5jbHVkZXMoJ3R5cGUnKSkgcmV0dXJuICd0eXBlJztcbiAgICBpZiAobGluZS5pbmNsdWRlcygnY29uc3QnKSkgcmV0dXJuICdjb25zdCc7XG4gICAgcmV0dXJuICd2YXJpYWJsZSc7XG4gIH1cblxuICAvKipcbiAgICogQ291bnQgdXNhZ2VzIG9mIGFuIGV4cG9ydCBhY3Jvc3MgdGhlIGNvZGViYXNlXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGNvdW50VXNhZ2VzKGV4cG9ydE5hbWU6IHN0cmluZywgZXhjbHVkZUZpbGVQYXRoOiBzdHJpbmcpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgIGNvbnN0IGZpbGVzID0gYXdhaXQgdGhpcy5nZXRBbGxTb3VyY2VGaWxlcygpO1xuICAgIGxldCB1c2FnZUNvdW50ID0gMDtcblxuICAgIGZvciAoY29uc3QgZmlsZVBhdGggb2YgZmlsZXMpIHtcbiAgICAgIGlmIChmaWxlUGF0aCA9PT0gZXhjbHVkZUZpbGVQYXRoKSBjb250aW51ZTtcblxuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgY29udGVudCA9IGF3YWl0IGZzLnByb21pc2VzLnJlYWRGaWxlKGZpbGVQYXRoLCAndXRmLTgnKTtcbiAgICAgICAgXG4gICAgICAgIC8vIENoZWNrIGZvciBpbXBvcnQgc3RhdGVtZW50c1xuICAgICAgICBjb25zdCBpbXBvcnRSZWdleCA9IG5ldyBSZWdFeHAoYGltcG9ydC4qXFxcXGIke2V4cG9ydE5hbWV9XFxcXGIuKmZyb21gLCAnZycpO1xuICAgICAgICBjb25zdCBpbXBvcnRNYXRjaGVzID0gY29udGVudC5tYXRjaChpbXBvcnRSZWdleCkgfHwgW107XG4gICAgICAgIHVzYWdlQ291bnQgKz0gaW1wb3J0TWF0Y2hlcy5sZW5ndGg7XG5cbiAgICAgICAgLy8gQ2hlY2sgZm9yIGRpcmVjdCB1c2FnZSAobW9yZSBjb21wbGV4IGFuYWx5c2lzIHdvdWxkIGJlIG5lZWRlZCBmb3IgY29tcGxldGUgYWNjdXJhY3kpXG4gICAgICAgIGNvbnN0IHVzYWdlUmVnZXggPSBuZXcgUmVnRXhwKGBcXFxcYiR7ZXhwb3J0TmFtZX1cXFxcYmAsICdnJyk7XG4gICAgICAgIGNvbnN0IHVzYWdlTWF0Y2hlcyA9IGNvbnRlbnQubWF0Y2godXNhZ2VSZWdleCkgfHwgW107XG4gICAgICAgIC8vIFN1YnRyYWN0IGltcG9ydCBtYXRjaGVzIHRvIGF2b2lkIGRvdWJsZSBjb3VudGluZ1xuICAgICAgICB1c2FnZUNvdW50ICs9IE1hdGgubWF4KDAsIHVzYWdlTWF0Y2hlcy5sZW5ndGggLSBpbXBvcnRNYXRjaGVzLmxlbmd0aCk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAvLyBTa2lwIGZpbGVzIHRoYXQgY2FuJ3QgYmUgcmVhZFxuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gdXNhZ2VDb3VudDtcbiAgfVxuXG4gIC8qKlxuICAgKiBDYWxjdWxhdGUgY29tcGxleGl0eSBzY29yZSBmb3IgYW4gZXhwb3J0XG4gICAqL1xuICBwcml2YXRlIGNhbGN1bGF0ZUNvbXBsZXhpdHkoY29udGVudDogc3RyaW5nLCBleHBvcnRJbmZvOiBPbWl0PFVudXNlZEV4cG9ydCwgJ3VzYWdlQ291bnQnIHwgJ2NvbXBsZXhpdHknPik6IG51bWJlciB7XG4gICAgY29uc3QgbGluZXMgPSBjb250ZW50LnNwbGl0KCdcXG4nKTtcbiAgICBjb25zdCBzdGFydExpbmUgPSBleHBvcnRJbmZvLmxpbmVOdW1iZXIgLSAxO1xuICAgIFxuICAgIC8vIFNpbXBsZSBoZXVyaXN0aWM6IGNvdW50IGxpbmVzIG9mIHRoZSBleHBvcnQgZGVmaW5pdGlvblxuICAgIGxldCBjb21wbGV4aXR5ID0gMTtcbiAgICBsZXQgYnJhY2VDb3VudCA9IDA7XG4gICAgbGV0IGluRXhwb3J0ID0gZmFsc2U7XG5cbiAgICBmb3IgKGxldCBpID0gc3RhcnRMaW5lOyBpIDwgbGluZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGNvbnN0IGxpbmUgPSBsaW5lc1tpXTtcbiAgICAgIFxuICAgICAgaWYgKCFpbkV4cG9ydCAmJiBsaW5lLmluY2x1ZGVzKCdleHBvcnQnKSkge1xuICAgICAgICBpbkV4cG9ydCA9IHRydWU7XG4gICAgICB9XG4gICAgICBcbiAgICAgIGlmIChpbkV4cG9ydCkge1xuICAgICAgICBjb21wbGV4aXR5Kys7XG4gICAgICAgIGJyYWNlQ291bnQgKz0gKGxpbmUubWF0Y2goL1xcey9nKSB8fCBbXSkubGVuZ3RoO1xuICAgICAgICBicmFjZUNvdW50IC09IChsaW5lLm1hdGNoKC9cXH0vZykgfHwgW10pLmxlbmd0aDtcbiAgICAgICAgXG4gICAgICAgIGlmIChicmFjZUNvdW50ID09PSAwICYmIGxpbmUuaW5jbHVkZXMoJ30nKSkge1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBpZiAobGluZS5pbmNsdWRlcygnOycpICYmIGJyYWNlQ291bnQgPT09IDApIHtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBNYXRoLm1pbihjb21wbGV4aXR5LCAxMDApOyAvLyBDYXAgYXQgMTAwXG4gIH1cblxuICAvKipcbiAgICogRGV0ZXJtaW5lIGZpbGUgcHJpb3JpdHkgYmFzZWQgb24gcGF0aCBwYXR0ZXJuc1xuICAgKi9cbiAgcHJpdmF0ZSBkZXRlcm1pbmVQcmlvcml0eShmaWxlUGF0aDogc3RyaW5nKTogRmlsZVByaW9yaXR5IHtcbiAgICBjb25zdCByZWxhdGl2ZVBhdGggPSBwYXRoLnJlbGF0aXZlKHByb2Nlc3MuY3dkKCksIGZpbGVQYXRoKTtcblxuICAgIGZvciAoY29uc3QgW3ByaW9yaXR5LCBwYXR0ZXJuc10gb2YgT2JqZWN0LmVudHJpZXModGhpcy5wcmlvcml0eVBhdHRlcm5zKSkge1xuICAgICAgZm9yIChjb25zdCBwYXR0ZXJuIG9mIHBhdHRlcm5zKSB7XG4gICAgICAgIGlmICh0aGlzLm1hdGNoZXNQYXR0ZXJuKHJlbGF0aXZlUGF0aCwgcGF0dGVybikpIHtcbiAgICAgICAgICByZXR1cm4gcHJpb3JpdHkgYXMgRmlsZVByaW9yaXR5O1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIEZpbGVQcmlvcml0eS5MT1c7XG4gIH1cblxuICAvKipcbiAgICogRGV0ZXJtaW5lIGZpbGUgY2F0ZWdvcnlcbiAgICovXG4gIHByaXZhdGUgZGV0ZXJtaW5lQ2F0ZWdvcnkoZmlsZVBhdGg6IHN0cmluZyk6IEZpbGVDYXRlZ29yeSB7XG4gICAgY29uc3QgcmVsYXRpdmVQYXRoID0gcGF0aC5yZWxhdGl2ZShwcm9jZXNzLmN3ZCgpLCBmaWxlUGF0aCk7XG5cbiAgICBpZiAocmVsYXRpdmVQYXRoLmluY2x1ZGVzKCcvcmVjaXBlJykpIHJldHVybiBGaWxlQ2F0ZWdvcnkuUkVDSVBFO1xuICAgIGlmIChyZWxhdGl2ZVBhdGguaW5jbHVkZXMoJy90ZXN0JykgfHwgcmVsYXRpdmVQYXRoLmluY2x1ZGVzKCcudGVzdC4nKSB8fCByZWxhdGl2ZVBhdGguaW5jbHVkZXMoJy5zcGVjLicpKSB7XG4gICAgICByZXR1cm4gRmlsZUNhdGVnb3J5LlRFU1Q7XG4gICAgfVxuICAgIGlmIChyZWxhdGl2ZVBhdGguaW5jbHVkZXMoJy9jb21wb25lbnRzJykgfHwgcmVsYXRpdmVQYXRoLmluY2x1ZGVzKCcvc2VydmljZXMnKSB8fCByZWxhdGl2ZVBhdGguaW5jbHVkZXMoJy9ob29rcycpKSB7XG4gICAgICByZXR1cm4gRmlsZUNhdGVnb3J5LkNPUkU7XG4gICAgfVxuICAgIGlmIChyZWxhdGl2ZVBhdGguaW5jbHVkZXMoJy90eXBlcycpIHx8IHJlbGF0aXZlUGF0aC5pbmNsdWRlcygnL2NvbnN0YW50cycpIHx8IHJlbGF0aXZlUGF0aC5pbmNsdWRlcygnL2NvbmZpZycpKSB7XG4gICAgICByZXR1cm4gRmlsZUNhdGVnb3J5LkVYVEVSTkFMO1xuICAgIH1cblxuICAgIHJldHVybiBGaWxlQ2F0ZWdvcnkuVVRJTElUWTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDYWxjdWxhdGUgc2FmZXR5IHNjb3JlIGZvciB0cmFuc2Zvcm1hdGlvblxuICAgKi9cbiAgcHJpdmF0ZSBjYWxjdWxhdGVTYWZldHlTY29yZShmaWxlUGF0aDogc3RyaW5nLCBjb250ZW50OiBzdHJpbmcsIHVudXNlZEV4cG9ydHM6IFVudXNlZEV4cG9ydFtdKTogbnVtYmVyIHtcbiAgICBsZXQgc2NvcmUgPSAxMDA7IC8vIFN0YXJ0IHdpdGggcGVyZmVjdCBzY29yZVxuXG4gICAgLy8gUmVkdWNlIHNjb3JlIGJhc2VkIG9uIGZpbGUgY29tcGxleGl0eVxuICAgIGNvbnN0IGxpbmVzID0gY29udGVudC5zcGxpdCgnXFxuJykubGVuZ3RoO1xuICAgIGlmIChsaW5lcyA+IDUwMCkgc2NvcmUgLT0gMjA7XG4gICAgZWxzZSBpZiAobGluZXMgPiAyMDApIHNjb3JlIC09IDEwO1xuXG4gICAgLy8gUmVkdWNlIHNjb3JlIGJhc2VkIG9uIG51bWJlciBvZiB1bnVzZWQgZXhwb3J0c1xuICAgIGlmICh1bnVzZWRFeHBvcnRzLmxlbmd0aCA+IDEwKSBzY29yZSAtPSAyMDtcbiAgICBlbHNlIGlmICh1bnVzZWRFeHBvcnRzLmxlbmd0aCA+IDUpIHNjb3JlIC09IDEwO1xuXG4gICAgLy8gUmVkdWNlIHNjb3JlIGZvciBjcml0aWNhbCBmaWxlc1xuICAgIGlmIChmaWxlUGF0aC5pbmNsdWRlcygnL2NvcmUvJykgfHwgZmlsZVBhdGguaW5jbHVkZXMoJy9jcml0aWNhbC8nKSkge1xuICAgICAgc2NvcmUgLT0gMTU7XG4gICAgfVxuXG4gICAgLy8gSW5jcmVhc2Ugc2NvcmUgZm9yIHRlc3QgZmlsZXMgKHNhZmVyIHRvIHRyYW5zZm9ybSlcbiAgICBpZiAoZmlsZVBhdGguaW5jbHVkZXMoJy90ZXN0LycpIHx8IGZpbGVQYXRoLmluY2x1ZGVzKCcudGVzdC4nKSkge1xuICAgICAgc2NvcmUgKz0gMTA7XG4gICAgfVxuXG4gICAgcmV0dXJuIE1hdGgubWF4KDAsIE1hdGgubWluKDEwMCwgc2NvcmUpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBJZGVudGlmeSB0cmFuc2Zvcm1hdGlvbiBjYW5kaWRhdGVzXG4gICAqL1xuICBwcml2YXRlIGlkZW50aWZ5VHJhbnNmb3JtYXRpb25DYW5kaWRhdGVzKHVudXNlZEV4cG9ydHM6IFVudXNlZEV4cG9ydFtdKTogVHJhbnNmb3JtYXRpb25DYW5kaWRhdGVbXSB7XG4gICAgcmV0dXJuIHVudXNlZEV4cG9ydHMubWFwKGV4cG9ydEluZm8gPT4ge1xuICAgICAgY29uc3QgaW50ZWxsaWdlbmNlU3lzdGVtTmFtZSA9IHRoaXMuZ2VuZXJhdGVJbnRlbGxpZ2VuY2VTeXN0ZW1OYW1lKGV4cG9ydEluZm8pO1xuICAgICAgY29uc3QgdHJhbnNmb3JtYXRpb25Db21wbGV4aXR5ID0gdGhpcy5hc3Nlc3NUcmFuc2Zvcm1hdGlvbkNvbXBsZXhpdHkoZXhwb3J0SW5mbyk7XG4gICAgICBjb25zdCBzYWZldHlTY29yZSA9IHRoaXMuY2FsY3VsYXRlVHJhbnNmb3JtYXRpb25TYWZldHlTY29yZShleHBvcnRJbmZvKTtcbiAgICAgIGNvbnN0IGVzdGltYXRlZEJlbmVmaXQgPSB0aGlzLmNhbGN1bGF0ZUVzdGltYXRlZEJlbmVmaXQoZXhwb3J0SW5mbyk7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIGV4cG9ydDogZXhwb3J0SW5mbyxcbiAgICAgICAgaW50ZWxsaWdlbmNlU3lzdGVtTmFtZSxcbiAgICAgICAgdHJhbnNmb3JtYXRpb25Db21wbGV4aXR5LFxuICAgICAgICBzYWZldHlTY29yZSxcbiAgICAgICAgZXN0aW1hdGVkQmVuZWZpdFxuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZSBpbnRlbGxpZ2VuY2Ugc3lzdGVtIG5hbWVcbiAgICovXG4gIHByaXZhdGUgZ2VuZXJhdGVJbnRlbGxpZ2VuY2VTeXN0ZW1OYW1lKGV4cG9ydEluZm86IFVudXNlZEV4cG9ydCk6IHN0cmluZyB7XG4gICAgY29uc3QgYmFzZU5hbWUgPSBleHBvcnRJbmZvLmV4cG9ydE5hbWUucmVwbGFjZSgvKFtBLVpdKS9nLCAnXyQxJykudG9VcHBlckNhc2UoKTtcbiAgICByZXR1cm4gYCR7YmFzZU5hbWV9X0lOVEVMTElHRU5DRV9TWVNURU1gO1xuICB9XG5cbiAgLyoqXG4gICAqIEFzc2VzcyB0cmFuc2Zvcm1hdGlvbiBjb21wbGV4aXR5XG4gICAqL1xuICBwcml2YXRlIGFzc2Vzc1RyYW5zZm9ybWF0aW9uQ29tcGxleGl0eShleHBvcnRJbmZvOiBVbnVzZWRFeHBvcnQpOiBUcmFuc2Zvcm1hdGlvbkNvbXBsZXhpdHkge1xuICAgIGlmIChleHBvcnRJbmZvLmNvbXBsZXhpdHkgPCA1KSByZXR1cm4gVHJhbnNmb3JtYXRpb25Db21wbGV4aXR5LlNJTVBMRTtcbiAgICBpZiAoZXhwb3J0SW5mby5jb21wbGV4aXR5IDwgMTUpIHJldHVybiBUcmFuc2Zvcm1hdGlvbkNvbXBsZXhpdHkuTU9ERVJBVEU7XG4gICAgaWYgKGV4cG9ydEluZm8uY29tcGxleGl0eSA8IDMwKSByZXR1cm4gVHJhbnNmb3JtYXRpb25Db21wbGV4aXR5LkNPTVBMRVg7XG4gICAgcmV0dXJuIFRyYW5zZm9ybWF0aW9uQ29tcGxleGl0eS5WRVJZX0NPTVBMRVg7XG4gIH1cblxuICAvKipcbiAgICogQ2FsY3VsYXRlIHRyYW5zZm9ybWF0aW9uIHNhZmV0eSBzY29yZVxuICAgKi9cbiAgcHJpdmF0ZSBjYWxjdWxhdGVUcmFuc2Zvcm1hdGlvblNhZmV0eVNjb3JlKGV4cG9ydEluZm86IFVudXNlZEV4cG9ydCk6IG51bWJlciB7XG4gICAgbGV0IHNjb3JlID0gOTA7IC8vIFN0YXJ0IGhpZ2ggZm9yIHVudXNlZCBleHBvcnRzXG5cbiAgICAvLyBSZWR1Y2UgZm9yIGNvbXBsZXggZXhwb3J0c1xuICAgIGlmIChleHBvcnRJbmZvLmNvbXBsZXhpdHkgPiAyMCkgc2NvcmUgLT0gMjA7XG4gICAgZWxzZSBpZiAoZXhwb3J0SW5mby5jb21wbGV4aXR5ID4gMTApIHNjb3JlIC09IDEwO1xuXG4gICAgLy8gSW5jcmVhc2UgZm9yIHNpbXBsZSB0eXBlc1xuICAgIGlmIChleHBvcnRJbmZvLmV4cG9ydFR5cGUgPT09ICdpbnRlcmZhY2UnIHx8IGV4cG9ydEluZm8uZXhwb3J0VHlwZSA9PT0gJ3R5cGUnKSB7XG4gICAgICBzY29yZSArPSAxMDtcbiAgICB9XG5cbiAgICByZXR1cm4gTWF0aC5tYXgoMCwgTWF0aC5taW4oMTAwLCBzY29yZSkpO1xuICB9XG5cbiAgLyoqXG4gICAqIENhbGN1bGF0ZSBlc3RpbWF0ZWQgYmVuZWZpdCBvZiB0cmFuc2Zvcm1hdGlvblxuICAgKi9cbiAgcHJpdmF0ZSBjYWxjdWxhdGVFc3RpbWF0ZWRCZW5lZml0KGV4cG9ydEluZm86IFVudXNlZEV4cG9ydCk6IG51bWJlciB7XG4gICAgbGV0IGJlbmVmaXQgPSA1MDsgLy8gQmFzZSBiZW5lZml0XG5cbiAgICAvLyBIaWdoZXIgYmVuZWZpdCBmb3IgZnVuY3Rpb25zIGFuZCBjbGFzc2VzIChtb3JlIHRyYW5zZm9ybWFibGUpXG4gICAgaWYgKGV4cG9ydEluZm8uZXhwb3J0VHlwZSA9PT0gJ2Z1bmN0aW9uJyB8fCBleHBvcnRJbmZvLmV4cG9ydFR5cGUgPT09ICdjbGFzcycpIHtcbiAgICAgIGJlbmVmaXQgKz0gMzA7XG4gICAgfVxuXG4gICAgLy8gSGlnaGVyIGJlbmVmaXQgZm9yIGNvbXBsZXggZXhwb3J0cyAobW9yZSBpbnRlbGxpZ2VuY2UgcG90ZW50aWFsKVxuICAgIGJlbmVmaXQgKz0gTWF0aC5taW4oMjAsIGV4cG9ydEluZm8uY29tcGxleGl0eSk7XG5cbiAgICByZXR1cm4gTWF0aC5taW4oMTAwLCBiZW5lZml0KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDYXRlZ29yaXplIGFuZCBzdW1tYXJpemUgYW5hbHlzaXMgcmVzdWx0c1xuICAgKi9cbiAgcHJpdmF0ZSBjYXRlZ29yaXplQW5kU3VtbWFyaXplKGZpbGVBbmFseXNlczogRmlsZUFuYWx5c2lzW10pOiBBbmFseXNpc1Jlc3VsdCB7XG4gICAgY29uc3QgaGlnaFByaW9yaXR5RmlsZXMgPSBmaWxlQW5hbHlzZXMuZmlsdGVyKGYgPT4gZi5wcmlvcml0eSA9PT0gRmlsZVByaW9yaXR5LkhJR0gpO1xuICAgIGNvbnN0IG1lZGl1bVByaW9yaXR5RmlsZXMgPSBmaWxlQW5hbHlzZXMuZmlsdGVyKGYgPT4gZi5wcmlvcml0eSA9PT0gRmlsZVByaW9yaXR5Lk1FRElVTSk7XG4gICAgY29uc3QgbG93UHJpb3JpdHlGaWxlcyA9IGZpbGVBbmFseXNlcy5maWx0ZXIoZiA9PiBmLnByaW9yaXR5ID09PSBGaWxlUHJpb3JpdHkuTE9XKTtcblxuICAgIGNvbnN0IHRvdGFsVW51c2VkRXhwb3J0cyA9IGZpbGVBbmFseXNlcy5yZWR1Y2UoKHN1bSwgZikgPT4gc3VtICsgZi51bnVzZWRFeHBvcnRzLmxlbmd0aCwgMCk7XG4gICAgY29uc3QgdG90YWxUcmFuc2Zvcm1hdGlvbkNhbmRpZGF0ZXMgPSBmaWxlQW5hbHlzZXMucmVkdWNlKChzdW0sIGYpID0+IHN1bSArIGYudHJhbnNmb3JtYXRpb25DYW5kaWRhdGVzLmxlbmd0aCwgMCk7XG5cbiAgICBjb25zdCByZWNpcGVGaWxlcyA9IGZpbGVBbmFseXNlcy5maWx0ZXIoZiA9PiBmLmNhdGVnb3J5ID09PSBGaWxlQ2F0ZWdvcnkuUkVDSVBFKS5sZW5ndGg7XG4gICAgY29uc3QgY29yZUZpbGVzID0gZmlsZUFuYWx5c2VzLmZpbHRlcihmID0+IGYuY2F0ZWdvcnkgPT09IEZpbGVDYXRlZ29yeS5DT1JFKS5sZW5ndGg7XG4gICAgY29uc3QgZXh0ZXJuYWxGaWxlcyA9IGZpbGVBbmFseXNlcy5maWx0ZXIoZiA9PiBmLmNhdGVnb3J5ID09PSBGaWxlQ2F0ZWdvcnkuRVhURVJOQUwpLmxlbmd0aDtcblxuICAgIGNvbnN0IGF2ZXJhZ2VTYWZldHlTY29yZSA9IGZpbGVBbmFseXNlcy5yZWR1Y2UoKHN1bSwgZikgPT4gc3VtICsgZi5zYWZldHlTY29yZSwgMCkgLyBmaWxlQW5hbHlzZXMubGVuZ3RoO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHRvdGFsRmlsZXM6IGZpbGVBbmFseXNlcy5sZW5ndGgsXG4gICAgICB0b3RhbFVudXNlZEV4cG9ydHMsXG4gICAgICBoaWdoUHJpb3JpdHlGaWxlcyxcbiAgICAgIG1lZGl1bVByaW9yaXR5RmlsZXMsXG4gICAgICBsb3dQcmlvcml0eUZpbGVzLFxuICAgICAgc3VtbWFyeToge1xuICAgICAgICByZWNpcGVGaWxlcyxcbiAgICAgICAgY29yZUZpbGVzLFxuICAgICAgICBleHRlcm5hbEZpbGVzLFxuICAgICAgICB0b3RhbFRyYW5zZm9ybWF0aW9uQ2FuZGlkYXRlcyxcbiAgICAgICAgYXZlcmFnZVNhZmV0eVNjb3JlLFxuICAgICAgICBlc3RpbWF0ZWRJbnRlbGxpZ2VuY2VTeXN0ZW1zOiB0b3RhbFRyYW5zZm9ybWF0aW9uQ2FuZGlkYXRlc1xuICAgICAgfVxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2sgaWYgcGF0aCBtYXRjaGVzIHBhdHRlcm5cbiAgICovXG4gIHByaXZhdGUgbWF0Y2hlc1BhdHRlcm4oZmlsZVBhdGg6IHN0cmluZywgcGF0dGVybjogc3RyaW5nKTogYm9vbGVhbiB7XG4gICAgY29uc3QgcmVnZXggPSBuZXcgUmVnRXhwKHBhdHRlcm4ucmVwbGFjZSgvXFwqXFwqL2csICcuKicpLnJlcGxhY2UoL1xcKi9nLCAnW14vXSonKSk7XG4gICAgcmV0dXJuIHJlZ2V4LnRlc3QoZmlsZVBhdGgpO1xuICB9XG5cbiAgLyoqXG4gICAqIEdlbmVyYXRlIGRldGFpbGVkIHJlcG9ydFxuICAgKi9cbiAgZ2VuZXJhdGVSZXBvcnQoYW5hbHlzaXM6IEFuYWx5c2lzUmVzdWx0KTogc3RyaW5nIHtcbiAgICBjb25zdCByZXBvcnQgPSBbXG4gICAgICAnIyBVbnVzZWQgRXhwb3J0IEFuYWx5c2lzIFJlcG9ydCcsXG4gICAgICAnJyxcbiAgICAgICcjIyBTdW1tYXJ5JyxcbiAgICAgIGAtIFRvdGFsIGZpbGVzIGFuYWx5emVkOiAke2FuYWx5c2lzLnRvdGFsRmlsZXN9YCxcbiAgICAgIGAtIFRvdGFsIHVudXNlZCBleHBvcnRzOiAke2FuYWx5c2lzLnRvdGFsVW51c2VkRXhwb3J0c31gLFxuICAgICAgYC0gUmVjaXBlIGZpbGVzOiAke2FuYWx5c2lzLnN1bW1hcnkucmVjaXBlRmlsZXN9YCxcbiAgICAgIGAtIENvcmUgZmlsZXM6ICR7YW5hbHlzaXMuc3VtbWFyeS5jb3JlRmlsZXN9YCxcbiAgICAgIGAtIEV4dGVybmFsIGZpbGVzOiAke2FuYWx5c2lzLnN1bW1hcnkuZXh0ZXJuYWxGaWxlc31gLFxuICAgICAgYC0gVHJhbnNmb3JtYXRpb24gY2FuZGlkYXRlczogJHthbmFseXNpcy5zdW1tYXJ5LnRvdGFsVHJhbnNmb3JtYXRpb25DYW5kaWRhdGVzfWAsXG4gICAgICBgLSBBdmVyYWdlIHNhZmV0eSBzY29yZTogJHthbmFseXNpcy5zdW1tYXJ5LmF2ZXJhZ2VTYWZldHlTY29yZS50b0ZpeGVkKDEpfWAsXG4gICAgICAnJyxcbiAgICAgICcjIyBQcmlvcml0eSBCcmVha2Rvd24nLFxuICAgICAgYC0gSGlnaCBwcmlvcml0eSBmaWxlczogJHthbmFseXNpcy5oaWdoUHJpb3JpdHlGaWxlcy5sZW5ndGh9YCxcbiAgICAgIGAtIE1lZGl1bSBwcmlvcml0eSBmaWxlczogJHthbmFseXNpcy5tZWRpdW1Qcmlvcml0eUZpbGVzLmxlbmd0aH1gLFxuICAgICAgYC0gTG93IHByaW9yaXR5IGZpbGVzOiAke2FuYWx5c2lzLmxvd1ByaW9yaXR5RmlsZXMubGVuZ3RofWAsXG4gICAgICAnJyxcbiAgICAgICcjIyBUb3AgVHJhbnNmb3JtYXRpb24gQ2FuZGlkYXRlcycsXG4gICAgICAnJ1xuICAgIF07XG5cbiAgICAvLyBBZGQgdG9wIGNhbmRpZGF0ZXMgZnJvbSBlYWNoIHByaW9yaXR5IGxldmVsXG4gICAgY29uc3QgdG9wQ2FuZGlkYXRlcyA9IFtcbiAgICAgIC4uLmFuYWx5c2lzLmhpZ2hQcmlvcml0eUZpbGVzLnNsaWNlKDAsIDUpLFxuICAgICAgLi4uYW5hbHlzaXMubWVkaXVtUHJpb3JpdHlGaWxlcy5zbGljZSgwLCA1KSxcbiAgICAgIC4uLmFuYWx5c2lzLmxvd1ByaW9yaXR5RmlsZXMuc2xpY2UoMCwgNSlcbiAgICBdO1xuXG4gICAgdG9wQ2FuZGlkYXRlcy5mb3JFYWNoKGZpbGUgPT4ge1xuICAgICAgcmVwb3J0LnB1c2goYCMjIyAke2ZpbGUuZmlsZVBhdGh9YCk7XG4gICAgICByZXBvcnQucHVzaChgLSBQcmlvcml0eTogJHtmaWxlLnByaW9yaXR5fWApO1xuICAgICAgcmVwb3J0LnB1c2goYC0gU2FmZXR5IFNjb3JlOiAke2ZpbGUuc2FmZXR5U2NvcmV9YCk7XG4gICAgICByZXBvcnQucHVzaChgLSBVbnVzZWQgRXhwb3J0czogJHtmaWxlLnVudXNlZEV4cG9ydHMubGVuZ3RofWApO1xuICAgICAgcmVwb3J0LnB1c2goYC0gVHJhbnNmb3JtYXRpb24gQ2FuZGlkYXRlczogJHtmaWxlLnRyYW5zZm9ybWF0aW9uQ2FuZGlkYXRlcy5sZW5ndGh9YCk7XG4gICAgICByZXBvcnQucHVzaCgnJyk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gcmVwb3J0LmpvaW4oJ1xcbicpO1xuICB9XG59Il0sInZlcnNpb24iOjN9