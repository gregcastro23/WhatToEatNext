01a911ea2ce55826ba9f46e6c569a589
"use strict";
/**
 * Linting Alerting System with Performance Monitoring
 *
 * Provides real-time alerting for linting regression detection
 * with performance monitoring and automated response capabilities.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.LintingAlertingSystem = void 0;
const child_process_1 = require("child_process");
const fs_1 = require("fs");
class LintingAlertingSystem {
    configFile = '.kiro/metrics/alerting-config.json';
    historyFile = '.kiro/metrics/alerting-history.json';
    suppressionFile = '.kiro/metrics/alert-suppressions.json';
    config;
    lastAlertTime = new Map();
    suppressedAlerts = new Set();
    constructor() {
        this.config = this.loadConfiguration();
        this.loadSuppressions();
    }
    /**
     * Process alerts and trigger appropriate responses
     */
    async processAlerts(alerts, metrics) {
        if (!this.config.enabled) {
            return;
        }
        console.log(`🚨 Processing ${alerts.length} alerts...`);
        // Filter alerts based on cooldown and suppression
        const activeAlerts = this.filterActiveAlerts(alerts);
        // Process performance monitoring
        const performanceEvents = await this.monitorPerformance(metrics);
        // Send alerts through configured channels
        for (const alert of activeAlerts) {
            await this.sendAlert(alert);
            this.updateAlertHistory(alert);
        }
        // Process performance events
        for (const event of performanceEvents) {
            await this.processPerformanceEvent(event);
        }
        // Trigger auto-responses if configured
        if (this.config.autoResponse.enabled) {
            await this.triggerAutoResponses(activeAlerts, performanceEvents);
        }
        console.log(`✅ Processed ${activeAlerts.length} active alerts and ${performanceEvents.length} performance events`);
    }
    /**
     * Monitor performance metrics and detect issues
     */
    async monitorPerformance(metrics) {
        if (!this.config.performanceMonitoring.enabled) {
            return [];
        }
        const events = [];
        const thresholds = this.config.performanceMonitoring.thresholds;
        for (const threshold of thresholds) {
            const value = this.getPerformanceMetricValue(metrics, threshold.metric);
            if (this.isThresholdExceeded(value, threshold)) {
                const event = {
                    id: `perf-${threshold.metric}-${Date.now()}`,
                    timestamp: new Date(),
                    type: 'threshold_exceeded',
                    metric: threshold.metric,
                    value,
                    threshold: threshold.threshold,
                    impact: this.calculateImpact(threshold.severity),
                    autoResponseTriggered: false
                };
                events.push(event);
                console.log(`⚠️ Performance threshold exceeded: ${threshold.metric} = ${value} > ${threshold.threshold}`);
            }
        }
        return events;
    }
    /**
     * Send alert through configured channels
     */
    async sendAlert(alert) {
        for (const channel of this.config.channels) {
            if (channel.severityFilter.includes(alert.severity)) {
                await this.sendAlertToChannel(alert, channel);
            }
        }
    }
    /**
     * Send alert to specific channel
     */
    async sendAlertToChannel(alert, channel) {
        try {
            switch (channel.type) {
                case 'console':
                    this.sendConsoleAlert(alert);
                    break;
                case 'file':
                    await this.sendFileAlert(alert, channel.config);
                    break;
                case 'kiro':
                    await this.sendKiroAlert(alert, channel.config);
                    break;
                case 'webhook':
                    await this.sendWebhookAlert(alert, channel.config);
                    break;
            }
        }
        catch (error) {
            console.error(`Failed to send alert to ${channel.type}:`, error);
        }
    }
    /**
     * Send console alert
     */
    sendConsoleAlert(alert) {
        const icon = this.getSeverityIcon(alert.severity);
        const timestamp = alert.timestamp.toISOString();
        console.log(`${icon} [${alert.severity.toUpperCase()}] ${timestamp}`);
        console.log(`   Metric: ${alert.metric}`);
        console.log(`   Value: ${alert.currentValue} (threshold: ${alert.threshold})`);
        console.log(`   Message: ${alert.message}`);
        console.log('');
    }
    /**
     * Send file alert
     */
    async sendFileAlert(alert, config) {
        const alertFile = config.file || '.kiro/metrics/alerts.log';
        const timestamp = alert.timestamp.toISOString();
        const logEntry = `[${timestamp}] ${alert.severity.toUpperCase()}: ${alert.message} (${alert.metric}: ${alert.currentValue}/${alert.threshold})\n`;
        try {
            // Append to file
            (0, child_process_1.execSync)(`echo "${logEntry}" >> "${alertFile}"`);
        }
        catch (error) {
            console.error('Failed to write alert to file:', error);
        }
    }
    /**
     * Send Kiro alert (integration with Kiro system)
     */
    async sendKiroAlert(alert, config) {
        // Create Kiro notification file
        const kiroAlert = {
            id: alert.id,
            timestamp: alert.timestamp,
            type: 'linting_alert',
            severity: alert.severity,
            title: `Linting ${alert.severity.toUpperCase()}: ${alert.metric}`,
            message: alert.message,
            data: {
                metric: alert.metric,
                currentValue: alert.currentValue,
                threshold: alert.threshold
            },
            actions: this.generateKiroActions(alert)
        };
        const kiroFile = '.kiro/notifications/linting-alerts.json';
        (0, fs_1.writeFileSync)(kiroFile, JSON.stringify(kiroAlert, null, 2));
    }
    /**
     * Send webhook alert
     */
    async sendWebhookAlert(alert, config) {
        if (!config.url) {
            console.warn('Webhook URL not configured');
            return;
        }
        const payload = {
            alert_id: alert.id,
            timestamp: alert.timestamp,
            severity: alert.severity,
            metric: alert.metric,
            current_value: alert.currentValue,
            threshold: alert.threshold,
            message: alert.message,
            source: 'linting-excellence-dashboard'
        };
        try {
            // Use curl for webhook (Node.js fetch might not be available)
            const curlCommand = `curl -X POST "${config.url}" \
        -H "Content-Type: application/json" \
        -d '${JSON.stringify(payload)}'`;
            (0, child_process_1.execSync)(curlCommand, { stdio: 'pipe' });
        }
        catch (error) {
            console.error('Failed to send webhook alert:', error);
        }
    }
    /**
     * Process performance event and trigger responses
     */
    async processPerformanceEvent(event) {
        console.log(`📊 Performance event: ${event.type} for ${event.metric}`);
        // Log performance event
        const performanceLog = `.kiro/metrics/performance-events.log`;
        const logEntry = `[${event.timestamp.toISOString()}] ${event.type.toUpperCase()}: ${event.metric} = ${event.value} (threshold: ${event.threshold}, impact: ${event.impact})\n`;
        try {
            (0, child_process_1.execSync)(`echo "${logEntry}" >> "${performanceLog}"`);
        }
        catch (error) {
            console.error('Failed to log performance event:', error);
        }
        // Update performance history
        this.updatePerformanceHistory(event);
    }
    /**
     * Trigger automatic responses based on alerts and performance events
     */
    async triggerAutoResponses(alerts, events) {
        const actions = this.config.autoResponse.actions;
        for (const action of actions) {
            if (this.shouldTriggerAction(action, alerts, events)) {
                await this.executeAutoResponse(action);
            }
        }
    }
    /**
     * Execute automatic response action
     */
    async executeAutoResponse(action) {
        console.log(`🤖 Executing auto-response: ${action.action}`);
        try {
            switch (action.action) {
                case 'enableCache':
                    await this.enableLintingCache();
                    break;
                case 'reduceBatchSize':
                    await this.reduceBatchSize(action.parameters.newSize || 10);
                    break;
                case 'skipNonCritical':
                    await this.skipNonCriticalRules();
                    break;
                case 'emergencyStop':
                    await this.emergencyStop();
                    break;
            }
        }
        catch (error) {
            console.error(`Failed to execute auto-response ${action.action}:`, error);
        }
    }
    /**
     * Filter alerts based on cooldown and suppression
     */
    filterActiveAlerts(alerts) {
        return alerts.filter(alert => {
            // Check suppression
            if (this.suppressedAlerts.has(alert.metric)) {
                return false;
            }
            // Check cooldown
            const lastAlert = this.lastAlertTime.get(alert.metric);
            if (lastAlert) {
                const cooldownMs = this.config.regressionDetection.cooldownPeriod * 60 * 1000;
                if (Date.now() - lastAlert.getTime() < cooldownMs) {
                    return false;
                }
            }
            return true;
        });
    }
    /**
     * Generate Kiro-specific actions for alerts
     */
    generateKiroActions(alert) {
        const actions = [];
        if (alert.metric === 'parserErrors' && alert.currentValue > 0) {
            actions.push({
                type: 'command',
                label: 'Fix Parser Errors',
                command: 'yarn tsc --noEmit',
                description: 'Run TypeScript compiler to identify syntax errors'
            });
        }
        if (alert.metric === 'explicitAnyErrors' && alert.currentValue > 100) {
            actions.push({
                type: 'campaign',
                label: 'Start Explicit Any Campaign',
                campaign: 'explicit-any-elimination',
                description: 'Launch systematic explicit any type elimination'
            });
        }
        if (alert.metric === 'importOrderIssues' && alert.currentValue > 50) {
            actions.push({
                type: 'command',
                label: 'Fix Import Order',
                command: 'yarn lint:fix',
                description: 'Automatically organize imports with enhanced rules'
            });
        }
        return actions;
    }
    // Auto-response implementations
    async enableLintingCache() {
        console.log('🚀 Enabling ESLint caching for improved performance');
        // Cache is already enabled in eslint.config.cjs, this is a no-op
    }
    async reduceBatchSize(newSize) {
        console.log(`📉 Reducing batch size to ${newSize} for better performance`);
        // This would integrate with campaign system batch processing
    }
    async skipNonCriticalRules() {
        console.log('⚡ Temporarily skipping non-critical rules for performance');
        // This would create a temporary ESLint config with reduced rules
    }
    async emergencyStop() {
        console.log('🛑 Emergency stop triggered - halting linting operations');
        // This would stop any running linting campaigns
    }
    // Helper methods
    loadConfiguration() {
        try {
            if ((0, fs_1.existsSync)(this.configFile)) {
                return JSON.parse((0, fs_1.readFileSync)(this.configFile, 'utf8'));
            }
        }
        catch (error) {
            console.warn('Error loading alerting configuration:', error);
        }
        // Return default configuration
        return {
            enabled: true,
            channels: [
                {
                    type: 'console',
                    config: {},
                    severityFilter: ['warning', 'error', 'critical']
                },
                {
                    type: 'file',
                    config: { file: '.kiro/metrics/alerts.log' },
                    severityFilter: ['error', 'critical']
                },
                {
                    type: 'kiro',
                    config: {},
                    severityFilter: ['critical']
                }
            ],
            regressionDetection: {
                enabled: true,
                sensitivity: 'medium',
                cooldownPeriod: 15 // 15 minutes
            },
            performanceMonitoring: {
                enabled: true,
                thresholds: [
                    {
                        metric: 'duration',
                        threshold: 30000,
                        severity: 'warning',
                        message: 'Linting duration exceeds 30 seconds'
                    },
                    {
                        metric: 'memory',
                        threshold: 512,
                        severity: 'warning',
                        message: 'Memory usage exceeds 512MB'
                    },
                    {
                        metric: 'cacheHitRate',
                        threshold: 0.5,
                        severity: 'warning',
                        message: 'Cache hit rate below 50%'
                    }
                ]
            },
            autoResponse: {
                enabled: true,
                actions: [
                    {
                        trigger: 'performance_degradation',
                        action: 'enableCache',
                        parameters: {}
                    },
                    {
                        trigger: 'memory_exceeded',
                        action: 'reduceBatchSize',
                        parameters: { newSize: 10 }
                    }
                ]
            }
        };
    }
    loadSuppressions() {
        try {
            if ((0, fs_1.existsSync)(this.suppressionFile)) {
                const suppressions = JSON.parse((0, fs_1.readFileSync)(this.suppressionFile, 'utf8'));
                this.suppressedAlerts = new Set(suppressions);
            }
        }
        catch (error) {
            console.warn('Error loading alert suppressions:', error);
        }
    }
    updateAlertHistory(alert) {
        this.lastAlertTime.set(alert.metric, alert.timestamp);
        // Store in history file
        try {
            const history = this.loadAlertHistory();
            history.alerts.push(alert);
            // Keep only last 1000 alerts
            if (history.alerts.length > 1000) {
                history.alerts.splice(0, history.alerts.length - 1000);
            }
            (0, fs_1.writeFileSync)(this.historyFile, JSON.stringify(history, null, 2));
        }
        catch (error) {
            console.error('Error updating alert history:', error);
        }
    }
    updatePerformanceHistory(event) {
        try {
            const history = this.loadAlertHistory();
            history.performanceEvents.push(event);
            // Keep only last 500 performance events
            if (history.performanceEvents.length > 500) {
                history.performanceEvents.splice(0, history.performanceEvents.length - 500);
            }
            (0, fs_1.writeFileSync)(this.historyFile, JSON.stringify(history, null, 2));
        }
        catch (error) {
            console.error('Error updating performance history:', error);
        }
    }
    loadAlertHistory() {
        try {
            if ((0, fs_1.existsSync)(this.historyFile)) {
                return JSON.parse((0, fs_1.readFileSync)(this.historyFile, 'utf8'));
            }
        }
        catch (error) {
            console.warn('Error loading alert history:', error);
        }
        return {
            alerts: [],
            suppressedAlerts: [],
            resolvedAlerts: [],
            performanceEvents: []
        };
    }
    getPerformanceMetricValue(metrics, metric) {
        switch (metric) {
            case 'duration':
                return metrics.performanceMetrics.lintingDuration;
            case 'memory':
                return metrics.performanceMetrics.memoryUsage;
            case 'cacheHitRate':
                return metrics.performanceMetrics.cacheHitRate;
            case 'filesPerSecond':
                return metrics.performanceMetrics.filesProcessed / (metrics.performanceMetrics.lintingDuration / 1000);
            default:
                return 0;
        }
    }
    isThresholdExceeded(value, threshold) {
        if (threshold.metric === 'cacheHitRate') {
            return value < threshold.threshold; // Cache hit rate should be above threshold
        }
        return value > threshold.threshold; // Other metrics should be below threshold
    }
    calculateImpact(severity) {
        switch (severity) {
            case 'critical':
                return 'high';
            case 'error':
                return 'medium';
            default:
                return 'low';
        }
    }
    shouldTriggerAction(action, alerts, events) {
        switch (action.trigger) {
            case 'performance_degradation':
                return events.some(e => e.type === 'threshold_exceeded' && e.impact === 'high');
            case 'memory_exceeded':
                return events.some(e => e.metric === 'memory' && e.type === 'threshold_exceeded');
            case 'critical_alert':
                return alerts.some(a => a.severity === 'critical');
            default:
                return false;
        }
    }
    getSeverityIcon(severity) {
        switch (severity) {
            case 'critical':
                return '🚨';
            case 'error':
                return '❌';
            case 'warning':
                return '⚠️';
            case 'info':
                return 'ℹ️';
            default:
                return '📋';
        }
    }
}
exports.LintingAlertingSystem = LintingAlertingSystem;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9zZXJ2aWNlcy9saW50aW5nL0xpbnRpbmdBbGVydGluZ1N5c3RlbS50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7O0dBS0c7OztBQUVILGlEQUF5QztBQUN6QywyQkFBNkQ7QUEwRDdELE1BQWEscUJBQXFCO0lBQ2YsVUFBVSxHQUFHLG9DQUFvQyxDQUFDO0lBQ2xELFdBQVcsR0FBRyxxQ0FBcUMsQ0FBQztJQUNwRCxlQUFlLEdBQUcsdUNBQXVDLENBQUM7SUFFbkUsTUFBTSxDQUFpQjtJQUN2QixhQUFhLEdBQXNCLElBQUksR0FBRyxFQUFFLENBQUM7SUFDN0MsZ0JBQWdCLEdBQWdCLElBQUksR0FBRyxFQUFFLENBQUM7SUFFbEQ7UUFDRSxJQUFJLENBQUMsTUFBTSxHQUFHLElBQUksQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1FBQ3ZDLElBQUksQ0FBQyxnQkFBZ0IsRUFBRSxDQUFDO0lBQzFCLENBQUM7SUFFRDs7T0FFRztJQUNILEtBQUssQ0FBQyxhQUFhLENBQUMsTUFBZSxFQUFFLE9BQXVCO1FBQzFELElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sRUFBRTtZQUN4QixPQUFPO1NBQ1I7UUFFRCxPQUFPLENBQUMsR0FBRyxDQUFDLGlCQUFpQixNQUFNLENBQUMsTUFBTSxZQUFZLENBQUMsQ0FBQztRQUV4RCxrREFBa0Q7UUFDbEQsTUFBTSxZQUFZLEdBQUcsSUFBSSxDQUFDLGtCQUFrQixDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBRXJELGlDQUFpQztRQUNqQyxNQUFNLGlCQUFpQixHQUFHLE1BQU0sSUFBSSxDQUFDLGtCQUFrQixDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBRWpFLDBDQUEwQztRQUMxQyxLQUFLLE1BQU0sS0FBSyxJQUFJLFlBQVksRUFBRTtZQUNoQyxNQUFNLElBQUksQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLENBQUM7WUFDNUIsSUFBSSxDQUFDLGtCQUFrQixDQUFDLEtBQUss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TSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxRQUFRLEtBQUssVUFBVSxDQUFDLENBQUM7WUFDckQ7Z0JBQ0UsT0FBTyxLQUFLLENBQUM7U0FDaEI7SUFDSCxDQUFDO0lBRU8sZUFBZSxDQUFDLFFBQWdCO1FBQ3RDLFFBQVEsUUFBUSxFQUFFO1lBQ2hCLEtBQUssVUFBVTtnQkFDYixPQUFPLElBQUksQ0FBQztZQUNkLEtBQUssT0FBTztnQkFDVixPQUFPLEdBQUcsQ0FBQztZQUNiLEtBQUssU0FBUztnQkFDWixPQUFPLElBQUksQ0FBQztZQUNkLEtBQUssTUFBTTtnQkFDVCxPQUFPLElBQUksQ0FBQztZQUNkO2dCQUNFLE9BQU8sSUFBSSxDQUFDO1NBQ2Y7SUFDSCxDQUFDO0NBQ0Y7QUE5aEJELHNEQThoQkMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9zZXJ2aWNlcy9saW50aW5nL0xpbnRpbmdBbGVydGluZ1N5c3RlbS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIExpbnRpbmcgQWxlcnRpbmcgU3lzdGVtIHdpdGggUGVyZm9ybWFuY2UgTW9uaXRvcmluZ1xuICogXG4gKiBQcm92aWRlcyByZWFsLXRpbWUgYWxlcnRpbmcgZm9yIGxpbnRpbmcgcmVncmVzc2lvbiBkZXRlY3Rpb25cbiAqIHdpdGggcGVyZm9ybWFuY2UgbW9uaXRvcmluZyBhbmQgYXV0b21hdGVkIHJlc3BvbnNlIGNhcGFiaWxpdGllcy5cbiAqL1xuXG5pbXBvcnQgeyBleGVjU3luYyB9IGZyb20gJ2NoaWxkX3Byb2Nlc3MnO1xuaW1wb3J0IHsgd3JpdGVGaWxlU3luYywgcmVhZEZpbGVTeW5jLCBleGlzdHNTeW5jIH0gZnJvbSAnZnMnO1xuaW1wb3J0IHsgTGludGluZ01ldHJpY3MsIEFsZXJ0LCBBbGVydFRocmVzaG9sZCB9IGZyb20gJy4vTGludGluZ1ZhbGlkYXRpb25EYXNoYm9hcmQnO1xuXG5leHBvcnQgaW50ZXJmYWNlIEFsZXJ0aW5nQ29uZmlnIHtcbiAgZW5hYmxlZDogYm9vbGVhbjtcbiAgY2hhbm5lbHM6IEFsZXJ0Q2hhbm5lbFtdO1xuICByZWdyZXNzaW9uRGV0ZWN0aW9uOiB7XG4gICAgZW5hYmxlZDogYm9vbGVhbjtcbiAgICBzZW5zaXRpdml0eTogJ2xvdycgfCAnbWVkaXVtJyB8ICdoaWdoJztcbiAgICBjb29sZG93blBlcmlvZDogbnVtYmVyOyAvLyBtaW51dGVzXG4gIH07XG4gIHBlcmZvcm1hbmNlTW9uaXRvcmluZzoge1xuICAgIGVuYWJsZWQ6IGJvb2xlYW47XG4gICAgdGhyZXNob2xkczogUGVyZm9ybWFuY2VUaHJlc2hvbGRbXTtcbiAgfTtcbiAgYXV0b1Jlc3BvbnNlOiB7XG4gICAgZW5hYmxlZDogYm9vbGVhbjtcbiAgICBhY3Rpb25zOiBBdXRvUmVzcG9uc2VBY3Rpb25bXTtcbiAgfTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBBbGVydENoYW5uZWwge1xuICB0eXBlOiAnY29uc29sZScgfCAnZmlsZScgfCAnd2ViaG9vaycgfCAna2lybyc7XG4gIGNvbmZpZzogUmVjb3JkPHN0cmluZywgYW55PjtcbiAgc2V2ZXJpdHlGaWx0ZXI6ICgnaW5mbycgfCAnd2FybmluZycgfCAnZXJyb3InIHwgJ2NyaXRpY2FsJylbXTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBQZXJmb3JtYW5jZVRocmVzaG9sZCB7XG4gIG1ldHJpYzogJ2R1cmF0aW9uJyB8ICdtZW1vcnknIHwgJ2NhY2hlSGl0UmF0ZScgfCAnZmlsZXNQZXJTZWNvbmQnO1xuICB0aHJlc2hvbGQ6IG51bWJlcjtcbiAgc2V2ZXJpdHk6ICd3YXJuaW5nJyB8ICdlcnJvcicgfCAnY3JpdGljYWwnO1xuICBtZXNzYWdlOiBzdHJpbmc7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQXV0b1Jlc3BvbnNlQWN0aW9uIHtcbiAgdHJpZ2dlcjogc3RyaW5nO1xuICBhY3Rpb246ICdlbmFibGVDYWNoZScgfCAncmVkdWNlQmF0Y2hTaXplJyB8ICdza2lwTm9uQ3JpdGljYWwnIHwgJ2VtZXJnZW5jeVN0b3AnO1xuICBwYXJhbWV0ZXJzOiBSZWNvcmQ8c3RyaW5nLCBhbnk+O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEFsZXJ0SGlzdG9yeSB7XG4gIGFsZXJ0czogQWxlcnRbXTtcbiAgc3VwcHJlc3NlZEFsZXJ0czogQWxlcnRbXTtcbiAgcmVzb2x2ZWRBbGVydHM6IEFsZXJ0W107XG4gIHBlcmZvcm1hbmNlRXZlbnRzOiBQZXJmb3JtYW5jZUV2ZW50W107XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUGVyZm9ybWFuY2VFdmVudCB7XG4gIGlkOiBzdHJpbmc7XG4gIHRpbWVzdGFtcDogRGF0ZTtcbiAgdHlwZTogJ2RlZ3JhZGF0aW9uJyB8ICdpbXByb3ZlbWVudCcgfCAndGhyZXNob2xkX2V4Y2VlZGVkJztcbiAgbWV0cmljOiBzdHJpbmc7XG4gIHZhbHVlOiBudW1iZXI7XG4gIHRocmVzaG9sZDogbnVtYmVyO1xuICBpbXBhY3Q6ICdsb3cnIHwgJ21lZGl1bScgfCAnaGlnaCc7XG4gIGF1dG9SZXNwb25zZVRyaWdnZXJlZDogYm9vbGVhbjtcbn1cblxuZXhwb3J0IGNsYXNzIExpbnRpbmdBbGVydGluZ1N5c3RlbSB7XG4gIHByaXZhdGUgcmVhZG9ubHkgY29uZmlnRmlsZSA9ICcua2lyby9tZXRyaWNzL2FsZXJ0aW5nLWNvbmZpZy5qc29uJztcbiAgcHJpdmF0ZSByZWFkb25seSBoaXN0b3J5RmlsZSA9ICcua2lyby9tZXRyaWNzL2FsZXJ0aW5nLWhpc3RvcnkuanNvbic7XG4gIHByaXZhdGUgcmVhZG9ubHkgc3VwcHJlc3Npb25GaWxlID0gJy5raXJvL21ldHJpY3MvYWxlcnQtc3VwcHJlc3Npb25zLmpzb24nO1xuICBcbiAgcHJpdmF0ZSBjb25maWc6IEFsZXJ0aW5nQ29uZmlnO1xuICBwcml2YXRlIGxhc3RBbGVydFRpbWU6IE1hcDxzdHJpbmcsIERhdGU+ID0gbmV3IE1hcCgpO1xuICBwcml2YXRlIHN1cHByZXNzZWRBbGVydHM6IFNldDxzdHJpbmc+ID0gbmV3IFNldCgpO1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuY29uZmlnID0gdGhpcy5sb2FkQ29uZmlndXJhdGlvbigpO1xuICAgIHRoaXMubG9hZFN1cHByZXNzaW9ucygpO1xuICB9XG5cbiAgLyoqXG4gICAqIFByb2Nlc3MgYWxlcnRzIGFuZCB0cmlnZ2VyIGFwcHJvcHJpYXRlIHJlc3BvbnNlc1xuICAgKi9cbiAgYXN5bmMgcHJvY2Vzc0FsZXJ0cyhhbGVydHM6IEFsZXJ0W10sIG1ldHJpY3M6IExpbnRpbmdNZXRyaWNzKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgaWYgKCF0aGlzLmNvbmZpZy5lbmFibGVkKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc29sZS5sb2coYPCfmqggUHJvY2Vzc2luZyAke2FsZXJ0cy5sZW5ndGh9IGFsZXJ0cy4uLmApO1xuXG4gICAgLy8gRmlsdGVyIGFsZXJ0cyBiYXNlZCBvbiBjb29sZG93biBhbmQgc3VwcHJlc3Npb25cbiAgICBjb25zdCBhY3RpdmVBbGVydHMgPSB0aGlzLmZpbHRlckFjdGl2ZUFsZXJ0cyhhbGVydHMpO1xuICAgIFxuICAgIC8vIFByb2Nlc3MgcGVyZm9ybWFuY2UgbW9uaXRvcmluZ1xuICAgIGNvbnN0IHBlcmZvcm1hbmNlRXZlbnRzID0gYXdhaXQgdGhpcy5tb25pdG9yUGVyZm9ybWFuY2UobWV0cmljcyk7XG4gICAgXG4gICAgLy8gU2VuZCBhbGVydHMgdGhyb3VnaCBjb25maWd1cmVkIGNoYW5uZWxzXG4gICAgZm9yIChjb25zdCBhbGVydCBvZiBhY3RpdmVBbGVydHMpIHtcbiAgICAgIGF3YWl0IHRoaXMuc2VuZEFsZXJ0KGFsZXJ0KTtcbiAgICAgIHRoaXMudXBkYXRlQWxlcnRIaXN0b3J5KGFsZXJ0KTtcbiAgICB9XG4gICAgXG4gICAgLy8gUHJvY2VzcyBwZXJmb3JtYW5jZSBldmVudHNcbiAgICBmb3IgKGNvbnN0IGV2ZW50IG9mIHBlcmZvcm1hbmNlRXZlbnRzKSB7XG4gICAgICBhd2FpdCB0aGlzLnByb2Nlc3NQZXJmb3JtYW5jZUV2ZW50KGV2ZW50KTtcbiAgICB9XG4gICAgXG4gICAgLy8gVHJpZ2dlciBhdXRvLXJlc3BvbnNlcyBpZiBjb25maWd1cmVkXG4gICAgaWYgKHRoaXMuY29uZmlnLmF1dG9SZXNwb25zZS5lbmFibGVkKSB7XG4gICAgICBhd2FpdCB0aGlzLnRyaWdnZXJBdXRvUmVzcG9uc2VzKGFjdGl2ZUFsZXJ0cywgcGVyZm9ybWFuY2VFdmVudHMpO1xuICAgIH1cbiAgICBcbiAgICBjb25zb2xlLmxvZyhg4pyFIFByb2Nlc3NlZCAke2FjdGl2ZUFsZXJ0cy5sZW5ndGh9IGFjdGl2ZSBhbGVydHMgYW5kICR7cGVyZm9ybWFuY2VFdmVudHMubGVuZ3RofSBwZXJmb3JtYW5jZSBldmVudHNgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBNb25pdG9yIHBlcmZvcm1hbmNlIG1ldHJpY3MgYW5kIGRldGVjdCBpc3N1ZXNcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgbW9uaXRvclBlcmZvcm1hbmNlKG1ldHJpY3M6IExpbnRpbmdNZXRyaWNzKTogUHJvbWlzZTxQZXJmb3JtYW5jZUV2ZW50W10+IHtcbiAgICBpZiAoIXRoaXMuY29uZmlnLnBlcmZvcm1hbmNlTW9uaXRvcmluZy5lbmFibGVkKSB7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuXG4gICAgY29uc3QgZXZlbnRzOiBQZXJmb3JtYW5jZUV2ZW50W10gPSBbXTtcbiAgICBjb25zdCB0aHJlc2hvbGRzID0gdGhpcy5jb25maWcucGVyZm9ybWFuY2VNb25pdG9yaW5nLnRocmVzaG9sZHM7XG5cbiAgICBmb3IgKGNvbnN0IHRocmVzaG9sZCBvZiB0aHJlc2hvbGRzKSB7XG4gICAgICBjb25zdCB2YWx1ZSA9IHRoaXMuZ2V0UGVyZm9ybWFuY2VNZXRyaWNWYWx1ZShtZXRyaWNzLCB0aHJlc2hvbGQubWV0cmljKTtcbiAgICAgIFxuICAgICAgaWYgKHRoaXMuaXNUaHJlc2hvbGRFeGNlZWRlZCh2YWx1ZSwgdGhyZXNob2xkKSkge1xuICAgICAgICBjb25zdCBldmVudDogUGVyZm9ybWFuY2VFdmVudCA9IHtcbiAgICAgICAgICBpZDogYHBlcmYtJHt0aHJlc2hvbGQubWV0cmljfS0ke0RhdGUubm93KCl9YCxcbiAgICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCksXG4gICAgICAgICAgdHlwZTogJ3RocmVzaG9sZF9leGNlZWRlZCcsXG4gICAgICAgICAgbWV0cmljOiB0aHJlc2hvbGQubWV0cmljLFxuICAgICAgICAgIHZhbHVlLFxuICAgICAgICAgIHRocmVzaG9sZDogdGhyZXNob2xkLnRocmVzaG9sZCxcbiAgICAgICAgICBpbXBhY3Q6IHRoaXMuY2FsY3VsYXRlSW1wYWN0KHRocmVzaG9sZC5zZXZlcml0eSksXG4gICAgICAgICAgYXV0b1Jlc3BvbnNlVHJpZ2dlcmVkOiBmYWxzZVxuICAgICAgICB9O1xuICAgICAgICBcbiAgICAgICAgZXZlbnRzLnB1c2goZXZlbnQpO1xuICAgICAgICBjb25zb2xlLmxvZyhg4pqg77iPIFBlcmZvcm1hbmNlIHRocmVzaG9sZCBleGNlZWRlZDogJHt0aHJlc2hvbGQubWV0cmljfSA9ICR7dmFsdWV9ID4gJHt0aHJlc2hvbGQudGhyZXNob2xkfWApO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBldmVudHM7XG4gIH1cblxuICAvKipcbiAgICogU2VuZCBhbGVydCB0aHJvdWdoIGNvbmZpZ3VyZWQgY2hhbm5lbHNcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgc2VuZEFsZXJ0KGFsZXJ0OiBBbGVydCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGZvciAoY29uc3QgY2hhbm5lbCBvZiB0aGlzLmNvbmZpZy5jaGFubmVscykge1xuICAgICAgaWYgKGNoYW5uZWwuc2V2ZXJpdHlGaWx0ZXIuaW5jbHVkZXMoYWxlcnQuc2V2ZXJpdHkpKSB7XG4gICAgICAgIGF3YWl0IHRoaXMuc2VuZEFsZXJ0VG9DaGFubmVsKGFsZXJ0LCBjaGFubmVsKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU2VuZCBhbGVydCB0byBzcGVjaWZpYyBjaGFubmVsXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIHNlbmRBbGVydFRvQ2hhbm5lbChhbGVydDogQWxlcnQsIGNoYW5uZWw6IEFsZXJ0Q2hhbm5lbCk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICBzd2l0Y2ggKGNoYW5uZWwudHlwZSkge1xuICAgICAgICBjYXNlICdjb25zb2xlJzpcbiAgICAgICAgICB0aGlzLnNlbmRDb25zb2xlQWxlcnQoYWxlcnQpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdmaWxlJzpcbiAgICAgICAgICBhd2FpdCB0aGlzLnNlbmRGaWxlQWxlcnQoYWxlcnQsIGNoYW5uZWwuY29uZmlnKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAna2lybyc6XG4gICAgICAgICAgYXdhaXQgdGhpcy5zZW5kS2lyb0FsZXJ0KGFsZXJ0LCBjaGFubmVsLmNvbmZpZyk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgJ3dlYmhvb2snOlxuICAgICAgICAgIGF3YWl0IHRoaXMuc2VuZFdlYmhvb2tBbGVydChhbGVydCwgY2hhbm5lbC5jb25maWcpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKGBGYWlsZWQgdG8gc2VuZCBhbGVydCB0byAke2NoYW5uZWwudHlwZX06YCwgZXJyb3IpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBTZW5kIGNvbnNvbGUgYWxlcnRcbiAgICovXG4gIHByaXZhdGUgc2VuZENvbnNvbGVBbGVydChhbGVydDogQWxlcnQpOiB2b2lkIHtcbiAgICBjb25zdCBpY29uID0gdGhpcy5nZXRTZXZlcml0eUljb24oYWxlcnQuc2V2ZXJpdHkpO1xuICAgIGNvbnN0IHRpbWVzdGFtcCA9IGFsZXJ0LnRpbWVzdGFtcC50b0lTT1N0cmluZygpO1xuICAgIFxuICAgIGNvbnNvbGUubG9nKGAke2ljb259IFske2FsZXJ0LnNldmVyaXR5LnRvVXBwZXJDYXNlKCl9XSAke3RpbWVzdGFtcH1gKTtcbiAgICBjb25zb2xlLmxvZyhgICAgTWV0cmljOiAke2FsZXJ0Lm1ldHJpY31gKTtcbiAgICBjb25zb2xlLmxvZyhgICAgVmFsdWU6ICR7YWxlcnQuY3VycmVudFZhbHVlfSAodGhyZXNob2xkOiAke2FsZXJ0LnRocmVzaG9sZH0pYCk7XG4gICAgY29uc29sZS5sb2coYCAgIE1lc3NhZ2U6ICR7YWxlcnQubWVzc2FnZX1gKTtcbiAgICBjb25zb2xlLmxvZygnJyk7XG4gIH1cblxuICAvKipcbiAgICogU2VuZCBmaWxlIGFsZXJ0XG4gICAqL1xuICBwcml2YXRlIGFzeW5jIHNlbmRGaWxlQWxlcnQoYWxlcnQ6IEFsZXJ0LCBjb25maWc6IFJlY29yZDxzdHJpbmcsIGFueT4pOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBhbGVydEZpbGUgPSBjb25maWcuZmlsZSB8fCAnLmtpcm8vbWV0cmljcy9hbGVydHMubG9nJztcbiAgICBjb25zdCB0aW1lc3RhbXAgPSBhbGVydC50aW1lc3RhbXAudG9JU09TdHJpbmcoKTtcbiAgICBjb25zdCBsb2dFbnRyeSA9IGBbJHt0aW1lc3RhbXB9XSAke2FsZXJ0LnNldmVyaXR5LnRvVXBwZXJDYXNlKCl9OiAke2FsZXJ0Lm1lc3NhZ2V9ICgke2FsZXJ0Lm1ldHJpY306ICR7YWxlcnQuY3VycmVudFZhbHVlfS8ke2FsZXJ0LnRocmVzaG9sZH0pXFxuYDtcbiAgICBcbiAgICB0cnkge1xuICAgICAgLy8gQXBwZW5kIHRvIGZpbGVcbiAgICAgIGV4ZWNTeW5jKGBlY2hvIFwiJHtsb2dFbnRyeX1cIiA+PiBcIiR7YWxlcnRGaWxlfVwiYCk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byB3cml0ZSBhbGVydCB0byBmaWxlOicsIGVycm9yKTtcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogU2VuZCBLaXJvIGFsZXJ0IChpbnRlZ3JhdGlvbiB3aXRoIEtpcm8gc3lzdGVtKVxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBzZW5kS2lyb0FsZXJ0KGFsZXJ0OiBBbGVydCwgY29uZmlnOiBSZWNvcmQ8c3RyaW5nLCBhbnk+KTogUHJvbWlzZTx2b2lkPiB7XG4gICAgLy8gQ3JlYXRlIEtpcm8gbm90aWZpY2F0aW9uIGZpbGVcbiAgICBjb25zdCBraXJvQWxlcnQgPSB7XG4gICAgICBpZDogYWxlcnQuaWQsXG4gICAgICB0aW1lc3RhbXA6IGFsZXJ0LnRpbWVzdGFtcCxcbiAgICAgIHR5cGU6ICdsaW50aW5nX2FsZXJ0JyxcbiAgICAgIHNldmVyaXR5OiBhbGVydC5zZXZlcml0eSxcbiAgICAgIHRpdGxlOiBgTGludGluZyAke2FsZXJ0LnNldmVyaXR5LnRvVXBwZXJDYXNlKCl9OiAke2FsZXJ0Lm1ldHJpY31gLFxuICAgICAgbWVzc2FnZTogYWxlcnQubWVzc2FnZSxcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgbWV0cmljOiBhbGVydC5tZXRyaWMsXG4gICAgICAgIGN1cnJlbnRWYWx1ZTogYWxlcnQuY3VycmVudFZhbHVlLFxuICAgICAgICB0aHJlc2hvbGQ6IGFsZXJ0LnRocmVzaG9sZFxuICAgICAgfSxcbiAgICAgIGFjdGlvbnM6IHRoaXMuZ2VuZXJhdGVLaXJvQWN0aW9ucyhhbGVydClcbiAgICB9O1xuICAgIFxuICAgIGNvbnN0IGtpcm9GaWxlID0gJy5raXJvL25vdGlmaWNhdGlvbnMvbGludGluZy1hbGVydHMuanNvbic7XG4gICAgd3JpdGVGaWxlU3luYyhraXJvRmlsZSwgSlNPTi5zdHJpbmdpZnkoa2lyb0FsZXJ0LCBudWxsLCAyKSk7XG4gIH1cblxuICAvKipcbiAgICogU2VuZCB3ZWJob29rIGFsZXJ0XG4gICAqL1xuICBwcml2YXRlIGFzeW5jIHNlbmRXZWJob29rQWxlcnQoYWxlcnQ6IEFsZXJ0LCBjb25maWc6IFJlY29yZDxzdHJpbmcsIGFueT4pOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBpZiAoIWNvbmZpZy51cmwpIHtcbiAgICAgIGNvbnNvbGUud2FybignV2ViaG9vayBVUkwgbm90IGNvbmZpZ3VyZWQnKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBjb25zdCBwYXlsb2FkID0ge1xuICAgICAgYWxlcnRfaWQ6IGFsZXJ0LmlkLFxuICAgICAgdGltZXN0YW1wOiBhbGVydC50aW1lc3RhbXAsXG4gICAgICBzZXZlcml0eTogYWxlcnQuc2V2ZXJpdHksXG4gICAgICBtZXRyaWM6IGFsZXJ0Lm1ldHJpYyxcbiAgICAgIGN1cnJlbnRfdmFsdWU6IGFsZXJ0LmN1cnJlbnRWYWx1ZSxcbiAgICAgIHRocmVzaG9sZDogYWxlcnQudGhyZXNob2xkLFxuICAgICAgbWVzc2FnZTogYWxlcnQubWVzc2FnZSxcbiAgICAgIHNvdXJjZTogJ2xpbnRpbmctZXhjZWxsZW5jZS1kYXNoYm9hcmQnXG4gICAgfTtcblxuICAgIHRyeSB7XG4gICAgICAvLyBVc2UgY3VybCBmb3Igd2ViaG9vayAoTm9kZS5qcyBmZXRjaCBtaWdodCBub3QgYmUgYXZhaWxhYmxlKVxuICAgICAgY29uc3QgY3VybENvbW1hbmQgPSBgY3VybCAtWCBQT1NUIFwiJHtjb25maWcudXJsfVwiIFxcXG4gICAgICAgIC1IIFwiQ29udGVudC1UeXBlOiBhcHBsaWNhdGlvbi9qc29uXCIgXFxcbiAgICAgICAgLWQgJyR7SlNPTi5zdHJpbmdpZnkocGF5bG9hZCl9J2A7XG4gICAgICBcbiAgICAgIGV4ZWNTeW5jKGN1cmxDb21tYW5kLCB7IHN0ZGlvOiAncGlwZScgfSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBzZW5kIHdlYmhvb2sgYWxlcnQ6JywgZXJyb3IpO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBQcm9jZXNzIHBlcmZvcm1hbmNlIGV2ZW50IGFuZCB0cmlnZ2VyIHJlc3BvbnNlc1xuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBwcm9jZXNzUGVyZm9ybWFuY2VFdmVudChldmVudDogUGVyZm9ybWFuY2VFdmVudCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnNvbGUubG9nKGDwn5OKIFBlcmZvcm1hbmNlIGV2ZW50OiAke2V2ZW50LnR5cGV9IGZvciAke2V2ZW50Lm1ldHJpY31gKTtcbiAgICBcbiAgICAvLyBMb2cgcGVyZm9ybWFuY2UgZXZlbnRcbiAgICBjb25zdCBwZXJmb3JtYW5jZUxvZyA9IGAua2lyby9tZXRyaWNzL3BlcmZvcm1hbmNlLWV2ZW50cy5sb2dgO1xuICAgIGNvbnN0IGxvZ0VudHJ5ID0gYFske2V2ZW50LnRpbWVzdGFtcC50b0lTT1N0cmluZygpfV0gJHtldmVudC50eXBlLnRvVXBwZXJDYXNlKCl9OiAke2V2ZW50Lm1ldHJpY30gPSAke2V2ZW50LnZhbHVlfSAodGhyZXNob2xkOiAke2V2ZW50LnRocmVzaG9sZH0sIGltcGFjdDogJHtldmVudC5pbXBhY3R9KVxcbmA7XG4gICAgXG4gICAgdHJ5IHtcbiAgICAgIGV4ZWNTeW5jKGBlY2hvIFwiJHtsb2dFbnRyeX1cIiA+PiBcIiR7cGVyZm9ybWFuY2VMb2d9XCJgKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGxvZyBwZXJmb3JtYW5jZSBldmVudDonLCBlcnJvcik7XG4gICAgfVxuICAgIFxuICAgIC8vIFVwZGF0ZSBwZXJmb3JtYW5jZSBoaXN0b3J5XG4gICAgdGhpcy51cGRhdGVQZXJmb3JtYW5jZUhpc3RvcnkoZXZlbnQpO1xuICB9XG5cbiAgLyoqXG4gICAqIFRyaWdnZXIgYXV0b21hdGljIHJlc3BvbnNlcyBiYXNlZCBvbiBhbGVydHMgYW5kIHBlcmZvcm1hbmNlIGV2ZW50c1xuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyB0cmlnZ2VyQXV0b1Jlc3BvbnNlcyhhbGVydHM6IEFsZXJ0W10sIGV2ZW50czogUGVyZm9ybWFuY2VFdmVudFtdKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgYWN0aW9ucyA9IHRoaXMuY29uZmlnLmF1dG9SZXNwb25zZS5hY3Rpb25zO1xuICAgIFxuICAgIGZvciAoY29uc3QgYWN0aW9uIG9mIGFjdGlvbnMpIHtcbiAgICAgIGlmICh0aGlzLnNob3VsZFRyaWdnZXJBY3Rpb24oYWN0aW9uLCBhbGVydHMsIGV2ZW50cykpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5leGVjdXRlQXV0b1Jlc3BvbnNlKGFjdGlvbik7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEV4ZWN1dGUgYXV0b21hdGljIHJlc3BvbnNlIGFjdGlvblxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBleGVjdXRlQXV0b1Jlc3BvbnNlKGFjdGlvbjogQXV0b1Jlc3BvbnNlQWN0aW9uKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc29sZS5sb2coYPCfpJYgRXhlY3V0aW5nIGF1dG8tcmVzcG9uc2U6ICR7YWN0aW9uLmFjdGlvbn1gKTtcbiAgICBcbiAgICB0cnkge1xuICAgICAgc3dpdGNoIChhY3Rpb24uYWN0aW9uKSB7XG4gICAgICAgIGNhc2UgJ2VuYWJsZUNhY2hlJzpcbiAgICAgICAgICBhd2FpdCB0aGlzLmVuYWJsZUxpbnRpbmdDYWNoZSgpO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdyZWR1Y2VCYXRjaFNpemUnOlxuICAgICAgICAgIGF3YWl0IHRoaXMucmVkdWNlQmF0Y2hTaXplKGFjdGlvbi5wYXJhbWV0ZXJzLm5ld1NpemUgfHwgMTApO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdza2lwTm9uQ3JpdGljYWwnOlxuICAgICAgICAgIGF3YWl0IHRoaXMuc2tpcE5vbkNyaXRpY2FsUnVsZXMoKTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnZW1lcmdlbmN5U3RvcCc6XG4gICAgICAgICAgYXdhaXQgdGhpcy5lbWVyZ2VuY3lTdG9wKCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoYEZhaWxlZCB0byBleGVjdXRlIGF1dG8tcmVzcG9uc2UgJHthY3Rpb24uYWN0aW9ufTpgLCBlcnJvcik7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEZpbHRlciBhbGVydHMgYmFzZWQgb24gY29vbGRvd24gYW5kIHN1cHByZXNzaW9uXG4gICAqL1xuICBwcml2YXRlIGZpbHRlckFjdGl2ZUFsZXJ0cyhhbGVydHM6IEFsZXJ0W10pOiBBbGVydFtdIHtcbiAgICByZXR1cm4gYWxlcnRzLmZpbHRlcihhbGVydCA9PiB7XG4gICAgICAvLyBDaGVjayBzdXBwcmVzc2lvblxuICAgICAgaWYgKHRoaXMuc3VwcHJlc3NlZEFsZXJ0cy5oYXMoYWxlcnQubWV0cmljKSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIENoZWNrIGNvb2xkb3duXG4gICAgICBjb25zdCBsYXN0QWxlcnQgPSB0aGlzLmxhc3RBbGVydFRpbWUuZ2V0KGFsZXJ0Lm1ldHJpYyk7XG4gICAgICBpZiAobGFzdEFsZXJ0KSB7XG4gICAgICAgIGNvbnN0IGNvb2xkb3duTXMgPSB0aGlzLmNvbmZpZy5yZWdyZXNzaW9uRGV0ZWN0aW9uLmNvb2xkb3duUGVyaW9kICogNjAgKiAxMDAwO1xuICAgICAgICBpZiAoRGF0ZS5ub3coKSAtIGxhc3RBbGVydC5nZXRUaW1lKCkgPCBjb29sZG93bk1zKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEdlbmVyYXRlIEtpcm8tc3BlY2lmaWMgYWN0aW9ucyBmb3IgYWxlcnRzXG4gICAqL1xuICBwcml2YXRlIGdlbmVyYXRlS2lyb0FjdGlvbnMoYWxlcnQ6IEFsZXJ0KTogYW55W10ge1xuICAgIGNvbnN0IGFjdGlvbnMgPSBbXTtcbiAgICBcbiAgICBpZiAoYWxlcnQubWV0cmljID09PSAncGFyc2VyRXJyb3JzJyAmJiBhbGVydC5jdXJyZW50VmFsdWUgPiAwKSB7XG4gICAgICBhY3Rpb25zLnB1c2goe1xuICAgICAgICB0eXBlOiAnY29tbWFuZCcsXG4gICAgICAgIGxhYmVsOiAnRml4IFBhcnNlciBFcnJvcnMnLFxuICAgICAgICBjb21tYW5kOiAneWFybiB0c2MgLS1ub0VtaXQnLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ1J1biBUeXBlU2NyaXB0IGNvbXBpbGVyIHRvIGlkZW50aWZ5IHN5bnRheCBlcnJvcnMnXG4gICAgICB9KTtcbiAgICB9XG4gICAgXG4gICAgaWYgKGFsZXJ0Lm1ldHJpYyA9PT0gJ2V4cGxpY2l0QW55RXJyb3JzJyAmJiBhbGVydC5jdXJyZW50VmFsdWUgPiAxMDApIHtcbiAgICAgIGFjdGlvbnMucHVzaCh7XG4gICAgICAgIHR5cGU6ICdjYW1wYWlnbicsXG4gICAgICAgIGxhYmVsOiAnU3RhcnQgRXhwbGljaXQgQW55IENhbXBhaWduJyxcbiAgICAgICAgY2FtcGFpZ246ICdleHBsaWNpdC1hbnktZWxpbWluYXRpb24nLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ0xhdW5jaCBzeXN0ZW1hdGljIGV4cGxpY2l0IGFueSB0eXBlIGVsaW1pbmF0aW9uJ1xuICAgICAgfSk7XG4gICAgfVxuICAgIFxuICAgIGlmIChhbGVydC5tZXRyaWMgPT09ICdpbXBvcnRPcmRlcklzc3VlcycgJiYgYWxlcnQuY3VycmVudFZhbHVlID4gNTApIHtcbiAgICAgIGFjdGlvbnMucHVzaCh7XG4gICAgICAgIHR5cGU6ICdjb21tYW5kJyxcbiAgICAgICAgbGFiZWw6ICdGaXggSW1wb3J0IE9yZGVyJyxcbiAgICAgICAgY29tbWFuZDogJ3lhcm4gbGludDpmaXgnLFxuICAgICAgICBkZXNjcmlwdGlvbjogJ0F1dG9tYXRpY2FsbHkgb3JnYW5pemUgaW1wb3J0cyB3aXRoIGVuaGFuY2VkIHJ1bGVzJ1xuICAgICAgfSk7XG4gICAgfVxuICAgIFxuICAgIHJldHVybiBhY3Rpb25zO1xuICB9XG5cbiAgLy8gQXV0by1yZXNwb25zZSBpbXBsZW1lbnRhdGlvbnNcbiAgcHJpdmF0ZSBhc3luYyBlbmFibGVMaW50aW5nQ2FjaGUoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc29sZS5sb2coJ/CfmoAgRW5hYmxpbmcgRVNMaW50IGNhY2hpbmcgZm9yIGltcHJvdmVkIHBlcmZvcm1hbmNlJyk7XG4gICAgLy8gQ2FjaGUgaXMgYWxyZWFkeSBlbmFibGVkIGluIGVzbGludC5jb25maWcuY2pzLCB0aGlzIGlzIGEgbm8tb3BcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgcmVkdWNlQmF0Y2hTaXplKG5ld1NpemU6IG51bWJlcik6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnNvbGUubG9nKGDwn5OJIFJlZHVjaW5nIGJhdGNoIHNpemUgdG8gJHtuZXdTaXplfSBmb3IgYmV0dGVyIHBlcmZvcm1hbmNlYCk7XG4gICAgLy8gVGhpcyB3b3VsZCBpbnRlZ3JhdGUgd2l0aCBjYW1wYWlnbiBzeXN0ZW0gYmF0Y2ggcHJvY2Vzc2luZ1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBza2lwTm9uQ3JpdGljYWxSdWxlcygpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zb2xlLmxvZygn4pqhIFRlbXBvcmFyaWx5IHNraXBwaW5nIG5vbi1jcml0aWNhbCBydWxlcyBmb3IgcGVyZm9ybWFuY2UnKTtcbiAgICAvLyBUaGlzIHdvdWxkIGNyZWF0ZSBhIHRlbXBvcmFyeSBFU0xpbnQgY29uZmlnIHdpdGggcmVkdWNlZCBydWxlc1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBlbWVyZ2VuY3lTdG9wKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnNvbGUubG9nKCfwn5uRIEVtZXJnZW5jeSBzdG9wIHRyaWdnZXJlZCAtIGhhbHRpbmcgbGludGluZyBvcGVyYXRpb25zJyk7XG4gICAgLy8gVGhpcyB3b3VsZCBzdG9wIGFueSBydW5uaW5nIGxpbnRpbmcgY2FtcGFpZ25zXG4gIH1cblxuICAvLyBIZWxwZXIgbWV0aG9kc1xuICBwcml2YXRlIGxvYWRDb25maWd1cmF0aW9uKCk6IEFsZXJ0aW5nQ29uZmlnIHtcbiAgICB0cnkge1xuICAgICAgaWYgKGV4aXN0c1N5bmModGhpcy5jb25maWdGaWxlKSkge1xuICAgICAgICByZXR1cm4gSlNPTi5wYXJzZShyZWFkRmlsZVN5bmModGhpcy5jb25maWdGaWxlLCAndXRmOCcpKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS53YXJuKCdFcnJvciBsb2FkaW5nIGFsZXJ0aW5nIGNvbmZpZ3VyYXRpb246JywgZXJyb3IpO1xuICAgIH1cbiAgICBcbiAgICAvLyBSZXR1cm4gZGVmYXVsdCBjb25maWd1cmF0aW9uXG4gICAgcmV0dXJuIHtcbiAgICAgIGVuYWJsZWQ6IHRydWUsXG4gICAgICBjaGFubmVsczogW1xuICAgICAgICB7XG4gICAgICAgICAgdHlwZTogJ2NvbnNvbGUnLFxuICAgICAgICAgIGNvbmZpZzoge30sXG4gICAgICAgICAgc2V2ZXJpdHlGaWx0ZXI6IFsnd2FybmluZycsICdlcnJvcicsICdjcml0aWNhbCddXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICB0eXBlOiAnZmlsZScsXG4gICAgICAgICAgY29uZmlnOiB7IGZpbGU6ICcua2lyby9tZXRyaWNzL2FsZXJ0cy5sb2cnIH0sXG4gICAgICAgICAgc2V2ZXJpdHlGaWx0ZXI6IFsnZXJyb3InLCAnY3JpdGljYWwnXVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgdHlwZTogJ2tpcm8nLFxuICAgICAgICAgIGNvbmZpZzoge30sXG4gICAgICAgICAgc2V2ZXJpdHlGaWx0ZXI6IFsnY3JpdGljYWwnXVxuICAgICAgICB9XG4gICAgICBdLFxuICAgICAgcmVncmVzc2lvbkRldGVjdGlvbjoge1xuICAgICAgICBlbmFibGVkOiB0cnVlLFxuICAgICAgICBzZW5zaXRpdml0eTogJ21lZGl1bScsXG4gICAgICAgIGNvb2xkb3duUGVyaW9kOiAxNSAvLyAxNSBtaW51dGVzXG4gICAgICB9LFxuICAgICAgcGVyZm9ybWFuY2VNb25pdG9yaW5nOiB7XG4gICAgICAgIGVuYWJsZWQ6IHRydWUsXG4gICAgICAgIHRocmVzaG9sZHM6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICBtZXRyaWM6ICdkdXJhdGlvbicsXG4gICAgICAgICAgICB0aHJlc2hvbGQ6IDMwMDAwLCAvLyAzMCBzZWNvbmRzXG4gICAgICAgICAgICBzZXZlcml0eTogJ3dhcm5pbmcnLFxuICAgICAgICAgICAgbWVzc2FnZTogJ0xpbnRpbmcgZHVyYXRpb24gZXhjZWVkcyAzMCBzZWNvbmRzJ1xuICAgICAgICAgIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgbWV0cmljOiAnbWVtb3J5JyxcbiAgICAgICAgICAgIHRocmVzaG9sZDogNTEyLCAvLyA1MTIgTUJcbiAgICAgICAgICAgIHNldmVyaXR5OiAnd2FybmluZycsXG4gICAgICAgICAgICBtZXNzYWdlOiAnTWVtb3J5IHVzYWdlIGV4Y2VlZHMgNTEyTUInXG4gICAgICAgICAgfSxcbiAgICAgICAgICB7XG4gICAgICAgICAgICBtZXRyaWM6ICdjYWNoZUhpdFJhdGUnLFxuICAgICAgICAgICAgdGhyZXNob2xkOiAwLjUsIC8vIDUwJVxuICAgICAgICAgICAgc2V2ZXJpdHk6ICd3YXJuaW5nJyxcbiAgICAgICAgICAgIG1lc3NhZ2U6ICdDYWNoZSBoaXQgcmF0ZSBiZWxvdyA1MCUnXG4gICAgICAgICAgfVxuICAgICAgICBdXG4gICAgICB9LFxuICAgICAgYXV0b1Jlc3BvbnNlOiB7XG4gICAgICAgIGVuYWJsZWQ6IHRydWUsXG4gICAgICAgIGFjdGlvbnM6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICB0cmlnZ2VyOiAncGVyZm9ybWFuY2VfZGVncmFkYXRpb24nLFxuICAgICAgICAgICAgYWN0aW9uOiAnZW5hYmxlQ2FjaGUnLFxuICAgICAgICAgICAgcGFyYW1ldGVyczoge31cbiAgICAgICAgICB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHRyaWdnZXI6ICdtZW1vcnlfZXhjZWVkZWQnLFxuICAgICAgICAgICAgYWN0aW9uOiAncmVkdWNlQmF0Y2hTaXplJyxcbiAgICAgICAgICAgIHBhcmFtZXRlcnM6IHsgbmV3U2l6ZTogMTAgfVxuICAgICAgICAgIH1cbiAgICAgICAgXVxuICAgICAgfVxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIGxvYWRTdXBwcmVzc2lvbnMoKTogdm9pZCB7XG4gICAgdHJ5IHtcbiAgICAgIGlmIChleGlzdHNTeW5jKHRoaXMuc3VwcHJlc3Npb25GaWxlKSkge1xuICAgICAgICBjb25zdCBzdXBwcmVzc2lvbnMgPSBKU09OLnBhcnNlKHJlYWRGaWxlU3luYyh0aGlzLnN1cHByZXNzaW9uRmlsZSwgJ3V0ZjgnKSk7XG4gICAgICAgIHRoaXMuc3VwcHJlc3NlZEFsZXJ0cyA9IG5ldyBTZXQoc3VwcHJlc3Npb25zKTtcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS53YXJuKCdFcnJvciBsb2FkaW5nIGFsZXJ0IHN1cHByZXNzaW9uczonLCBlcnJvcik7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSB1cGRhdGVBbGVydEhpc3RvcnkoYWxlcnQ6IEFsZXJ0KTogdm9pZCB7XG4gICAgdGhpcy5sYXN0QWxlcnRUaW1lLnNldChhbGVydC5tZXRyaWMsIGFsZXJ0LnRpbWVzdGFtcCk7XG4gICAgXG4gICAgLy8gU3RvcmUgaW4gaGlzdG9yeSBmaWxlXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGhpc3RvcnkgPSB0aGlzLmxvYWRBbGVydEhpc3RvcnkoKTtcbiAgICAgIGhpc3RvcnkuYWxlcnRzLnB1c2goYWxlcnQpO1xuICAgICAgXG4gICAgICAvLyBLZWVwIG9ubHkgbGFzdCAxMDAwIGFsZXJ0c1xuICAgICAgaWYgKGhpc3RvcnkuYWxlcnRzLmxlbmd0aCA+IDEwMDApIHtcbiAgICAgICAgaGlzdG9yeS5hbGVydHMuc3BsaWNlKDAsIGhpc3RvcnkuYWxlcnRzLmxlbmd0aCAtIDEwMDApO1xuICAgICAgfVxuICAgICAgXG4gICAgICB3cml0ZUZpbGVTeW5jKHRoaXMuaGlzdG9yeUZpbGUsIEpTT04uc3RyaW5naWZ5KGhpc3RvcnksIG51bGwsIDIpKTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgdXBkYXRpbmcgYWxlcnQgaGlzdG9yeTonLCBlcnJvcik7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSB1cGRhdGVQZXJmb3JtYW5jZUhpc3RvcnkoZXZlbnQ6IFBlcmZvcm1hbmNlRXZlbnQpOiB2b2lkIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgaGlzdG9yeSA9IHRoaXMubG9hZEFsZXJ0SGlzdG9yeSgpO1xuICAgICAgaGlzdG9yeS5wZXJmb3JtYW5jZUV2ZW50cy5wdXNoKGV2ZW50KTtcbiAgICAgIFxuICAgICAgLy8gS2VlcCBvbmx5IGxhc3QgNTAwIHBlcmZvcm1hbmNlIGV2ZW50c1xuICAgICAgaWYgKGhpc3RvcnkucGVyZm9ybWFuY2VFdmVudHMubGVuZ3RoID4gNTAwKSB7XG4gICAgICAgIGhpc3RvcnkucGVyZm9ybWFuY2VFdmVudHMuc3BsaWNlKDAsIGhpc3RvcnkucGVyZm9ybWFuY2VFdmVudHMubGVuZ3RoIC0gNTAwKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgd3JpdGVGaWxlU3luYyh0aGlzLmhpc3RvcnlGaWxlLCBKU09OLnN0cmluZ2lmeShoaXN0b3J5LCBudWxsLCAyKSk7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHVwZGF0aW5nIHBlcmZvcm1hbmNlIGhpc3Rvcnk6JywgZXJyb3IpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgbG9hZEFsZXJ0SGlzdG9yeSgpOiBBbGVydEhpc3Rvcnkge1xuICAgIHRyeSB7XG4gICAgICBpZiAoZXhpc3RzU3luYyh0aGlzLmhpc3RvcnlGaWxlKSkge1xuICAgICAgICByZXR1cm4gSlNPTi5wYXJzZShyZWFkRmlsZVN5bmModGhpcy5oaXN0b3J5RmlsZSwgJ3V0ZjgnKSk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUud2FybignRXJyb3IgbG9hZGluZyBhbGVydCBoaXN0b3J5OicsIGVycm9yKTtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHtcbiAgICAgIGFsZXJ0czogW10sXG4gICAgICBzdXBwcmVzc2VkQWxlcnRzOiBbXSxcbiAgICAgIHJlc29sdmVkQWxlcnRzOiBbXSxcbiAgICAgIHBlcmZvcm1hbmNlRXZlbnRzOiBbXVxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIGdldFBlcmZvcm1hbmNlTWV0cmljVmFsdWUobWV0cmljczogTGludGluZ01ldHJpY3MsIG1ldHJpYzogc3RyaW5nKTogbnVtYmVyIHtcbiAgICBzd2l0Y2ggKG1ldHJpYykge1xuICAgICAgY2FzZSAnZHVyYXRpb24nOlxuICAgICAgICByZXR1cm4gbWV0cmljcy5wZXJmb3JtYW5jZU1ldHJpY3MubGludGluZ0R1cmF0aW9uO1xuICAgICAgY2FzZSAnbWVtb3J5JzpcbiAgICAgICAgcmV0dXJuIG1ldHJpY3MucGVyZm9ybWFuY2VNZXRyaWNzLm1lbW9yeVVzYWdlO1xuICAgICAgY2FzZSAnY2FjaGVIaXRSYXRlJzpcbiAgICAgICAgcmV0dXJuIG1ldHJpY3MucGVyZm9ybWFuY2VNZXRyaWNzLmNhY2hlSGl0UmF0ZTtcbiAgICAgIGNhc2UgJ2ZpbGVzUGVyU2Vjb25kJzpcbiAgICAgICAgcmV0dXJuIG1ldHJpY3MucGVyZm9ybWFuY2VNZXRyaWNzLmZpbGVzUHJvY2Vzc2VkIC8gKG1ldHJpY3MucGVyZm9ybWFuY2VNZXRyaWNzLmxpbnRpbmdEdXJhdGlvbiAvIDEwMDApO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuIDA7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBpc1RocmVzaG9sZEV4Y2VlZGVkKHZhbHVlOiBudW1iZXIsIHRocmVzaG9sZDogUGVyZm9ybWFuY2VUaHJlc2hvbGQpOiBib29sZWFuIHtcbiAgICBpZiAodGhyZXNob2xkLm1ldHJpYyA9PT0gJ2NhY2hlSGl0UmF0ZScpIHtcbiAgICAgIHJldHVybiB2YWx1ZSA8IHRocmVzaG9sZC50aHJlc2hvbGQ7IC8vIENhY2hlIGhpdCByYXRlIHNob3VsZCBiZSBhYm92ZSB0aHJlc2hvbGRcbiAgICB9XG4gICAgcmV0dXJuIHZhbHVlID4gdGhyZXNob2xkLnRocmVzaG9sZDsgLy8gT3RoZXIgbWV0cmljcyBzaG91bGQgYmUgYmVsb3cgdGhyZXNob2xkXG4gIH1cblxuICBwcml2YXRlIGNhbGN1bGF0ZUltcGFjdChzZXZlcml0eTogc3RyaW5nKTogJ2xvdycgfCAnbWVkaXVtJyB8ICdoaWdoJyB7XG4gICAgc3dpdGNoIChzZXZlcml0eSkge1xuICAgICAgY2FzZSAnY3JpdGljYWwnOlxuICAgICAgICByZXR1cm4gJ2hpZ2gnO1xuICAgICAgY2FzZSAnZXJyb3InOlxuICAgICAgICByZXR1cm4gJ21lZGl1bSc7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICByZXR1cm4gJ2xvdyc7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzaG91bGRUcmlnZ2VyQWN0aW9uKGFjdGlvbjogQXV0b1Jlc3BvbnNlQWN0aW9uLCBhbGVydHM6IEFsZXJ0W10sIGV2ZW50czogUGVyZm9ybWFuY2VFdmVudFtdKTogYm9vbGVhbiB7XG4gICAgc3dpdGNoIChhY3Rpb24udHJpZ2dlcikge1xuICAgICAgY2FzZSAncGVyZm9ybWFuY2VfZGVncmFkYXRpb24nOlxuICAgICAgICByZXR1cm4gZXZlbnRzLnNvbWUoZSA9PiBlLnR5cGUgPT09ICd0aHJlc2hvbGRfZXhjZWVkZWQnICYmIGUuaW1wYWN0ID09PSAnaGlnaCcpO1xuICAgICAgY2FzZSAnbWVtb3J5X2V4Y2VlZGVkJzpcbiAgICAgICAgcmV0dXJuIGV2ZW50cy5zb21lKGUgPT4gZS5tZXRyaWMgPT09ICdtZW1vcnknICYmIGUudHlwZSA9PT0gJ3RocmVzaG9sZF9leGNlZWRlZCcpO1xuICAgICAgY2FzZSAnY3JpdGljYWxfYWxlcnQnOlxuICAgICAgICByZXR1cm4gYWxlcnRzLnNvbWUoYSA9PiBhLnNldmVyaXR5ID09PSAnY3JpdGljYWwnKTtcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGdldFNldmVyaXR5SWNvbihzZXZlcml0eTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICBzd2l0Y2ggKHNldmVyaXR5KSB7XG4gICAgICBjYXNlICdjcml0aWNhbCc6XG4gICAgICAgIHJldHVybiAn8J+aqCc7XG4gICAgICBjYXNlICdlcnJvcic6XG4gICAgICAgIHJldHVybiAn4p2MJztcbiAgICAgIGNhc2UgJ3dhcm5pbmcnOlxuICAgICAgICByZXR1cm4gJ+KaoO+4jyc7XG4gICAgICBjYXNlICdpbmZvJzpcbiAgICAgICAgcmV0dXJuICfihLnvuI8nO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgcmV0dXJuICfwn5OLJztcbiAgICB9XG4gIH1cbn0iXSwidmVyc2lvbiI6M30=