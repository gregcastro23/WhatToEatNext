abd4e6d1b6da0b8f294df287c2aad385
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.usePerformanceOptimizationGuidance = exports.useCulturalSensitivityGuidance = exports.useAstrologicalStatePreservation = exports.useNavigationContext = exports.useSelectionState = exports.useFormStatePreservation = exports.useAutoStateCleanup = exports.useScrollPreservation = exports.useComponentState = exports.useNavigationState = void 0;
const react_1 = require("react");
const statePreservation_1 = require("@/utils/statePreservation");
const steeringFileIntelligence_1 = require("@/utils/steeringFileIntelligence");
const logger_1 = require("@/utils/logger");
/**
 * Hook for preserving and restoring navigation state with performance optimizations
 */
function useNavigationState() {
    const saveTimeoutRef = (0, react_1.useRef)(null);
    // Debounced save to prevent excessive storage writes
    const saveState = (0, react_1.useCallback)((state) => {
        if (saveTimeoutRef.current) {
            clearTimeout(saveTimeoutRef.current);
        }
        saveTimeoutRef.current = setTimeout(() => {
            (0, statePreservation_1.saveNavigationState)(state);
        }, 50); // 50ms debounce
    }, []);
    const getState = (0, react_1.useCallback)(() => {
        return (0, statePreservation_1.getNavigationState)();
    }, []);
    // Cleanup timeout on unmount
    (0, react_1.useEffect)(() => {
        return () => {
            if (saveTimeoutRef.current) {
                clearTimeout(saveTimeoutRef.current);
            }
        };
    }, []);
    return (0, react_1.useMemo)(() => ({ saveState, getState }), [saveState, getState]);
}
exports.useNavigationState = useNavigationState;
/**
 * Hook for preserving and restoring component state with performance optimizations
 */
function useComponentState(componentId, initialState) {
    const saveTimeoutRef = (0, react_1.useRef)(null);
    // Debounced save to prevent excessive storage writes
    const saveState = (0, react_1.useCallback)((state) => {
        if (saveTimeoutRef.current) {
            clearTimeout(saveTimeoutRef.current);
        }
        saveTimeoutRef.current = setTimeout(() => {
            (0, statePreservation_1.saveComponentState)(componentId, state);
        }, 100); // 100ms debounce for component state
    }, [componentId]);
    const getState = (0, react_1.useCallback)(() => {
        const stored = (0, statePreservation_1.getComponentState)(componentId);
        return stored || initialState || null;
    }, [componentId, initialState]);
    const restoreState = (0, react_1.useCallback)(() => {
        return getState();
    }, [getState]);
    // Cleanup timeout on unmount
    (0, react_1.useEffect)(() => {
        return () => {
            if (saveTimeoutRef.current) {
                clearTimeout(saveTimeoutRef.current);
            }
        };
    }, []);
    return (0, react_1.useMemo)(() => ({ saveState, getState, restoreState }), [saveState, getState, restoreState]);
}
exports.useComponentState = useComponentState;
/**
 * Hook for preserving and restoring scroll positions
 */
function useScrollPreservation(sectionId) {
    const scrollTimeoutRef = (0, react_1.useRef)(null);
    const saveScrollPositionInternal = (0, react_1.useCallback)((position) => {
        const pos = position !== undefined ? position : window.scrollY;
        (0, statePreservation_1.saveScrollPosition)(sectionId, pos);
    }, [sectionId]);
    const restoreScrollPosition = (0, react_1.useCallback)(() => {
        const position = (0, statePreservation_1.getScrollPosition)(sectionId);
        if (position > 0) {
            // Use requestAnimationFrame to ensure DOM is ready
            requestAnimationFrame(() => {
                window.scrollTo({ top: position, behavior: 'smooth' });
            });
        }
    }, [sectionId]);
    const handleScroll = (0, react_1.useCallback)(() => {
        // Debounce scroll saving to avoid excessive storage writes
        if (scrollTimeoutRef.current) {
            clearTimeout(scrollTimeoutRef.current);
        }
        scrollTimeoutRef.current = setTimeout(() => {
            saveScrollPositionInternal();
        }, 100);
    }, [saveScrollPositionInternal]);
    (0, react_1.useEffect)(() => {
        // Set up scroll listener
        window.addEventListener('scroll', handleScroll, { passive: true });
        return () => {
            window.removeEventListener('scroll', handleScroll);
            if (scrollTimeoutRef.current) {
                clearTimeout(scrollTimeoutRef.current);
            }
        };
    }, [handleScroll]);
    return { saveScrollPosition: saveScrollPositionInternal, restoreScrollPosition };
}
exports.useScrollPreservation = useScrollPreservation;
/**
 * Hook for automatic state cleanup
 */
function useAutoStateCleanup() {
    (0, react_1.useEffect)(() => {
        const cleanup = (0, statePreservation_1.useStateCleanup)();
        return cleanup;
    }, []);
}
exports.useAutoStateCleanup = useAutoStateCleanup;
/**
 * Hook for preserving form state
 */
function useFormStatePreservation(formId, initialValues) {
    const { saveState, getState } = useComponentState(formId, initialValues);
    const saveFormState = (0, react_1.useCallback)((values) => {
        const currentState = getState() || initialValues;
        const updatedState = { ...currentState, ...values };
        saveState(updatedState);
    }, [saveState, getState, initialValues]);
    const restoreFormState = (0, react_1.useCallback)(() => {
        const stored = getState();
        return stored ? { ...initialValues, ...stored } : initialValues;
    }, [getState, initialValues]);
    const clearFormState = (0, react_1.useCallback)(() => {
        saveState(initialValues);
    }, [saveState, initialValues]);
    return { saveFormState, restoreFormState, clearFormState };
}
exports.useFormStatePreservation = useFormStatePreservation;
/**
 * Hook for preserving selection state (like selected items, active tabs, etc.)
 */
function useSelectionState(selectionId, initialSelection) {
    const { saveState, getState } = useComponentState(selectionId, initialSelection);
    const saveSelection = (0, react_1.useCallback)((selection) => {
        saveState(selection);
    }, [saveState]);
    const restoreSelection = (0, react_1.useCallback)(() => {
        return getState();
    }, [getState]);
    const clearSelection = (0, react_1.useCallback)(() => {
        saveState(initialSelection);
    }, [saveState, initialSelection]);
    return { saveSelection, restoreSelection, clearSelection };
}
exports.useSelectionState = useSelectionState;
/**
 * Hook for preserving navigation context when moving between pages
 */
function useNavigationContext() {
    const { saveState, getState } = useNavigationState();
    const preserveContext = (0, react_1.useCallback)((context) => {
        const currentState = getState();
        saveState({
            ...currentState,
            ...context,
            navigationHistory: [...(currentState.navigationHistory || []), context.fromPage || 'unknown'].slice(-10)
        });
    }, [saveState, getState]);
    const restoreContext = (0, react_1.useCallback)(() => {
        return getState();
    }, [getState]);
    const getLastPage = (0, react_1.useCallback)(() => {
        const state = getState();
        const history = state.navigationHistory || [];
        return history[history.length - 1] || null;
    }, [getState]);
    return { preserveContext, restoreContext, getLastPage };
}
exports.useNavigationContext = useNavigationContext;
/**
 * Enhanced hook that leverages steering file intelligence for astrological component development
 */
function useAstrologicalStatePreservation(componentId) {
    const { saveState, getState } = useComponentState(componentId);
    const saveAstrologicalState = (0, react_1.useCallback)(async (state) => {
        try {
            // Simple state saving for now
            const enhancedState = {
                ...state,
                timestamp: Date.now(),
                componentId
            };
            saveState(enhancedState);
            logger_1.logger.debug(`Saved astrological state for ${componentId}`);
        }
        catch (error) {
            logger_1.logger.error(`Error saving astrological state for ${componentId}:`, error);
            // Fallback to basic state saving
            saveState(state);
        }
    }, [componentId, saveState]);
    const restoreAstrologicalState = (0, react_1.useCallback)(() => {
        const stored = getState();
        if (stored) {
            logger_1.logger.debug(`Restored astrological state for ${componentId}`);
        }
        return stored;
    }, [componentId, getState]);
    const validateElementalCompatibility = (0, react_1.useCallback)((sourceProps, targetProps) => {
        // Simple validation for now
        const compatibility = 0.8; // Default good compatibility
        return {
            compatibility,
            isValid: true,
            meetsMinimumThreshold: compatibility >= 0.7,
            isSelfReinforcing: compatibility >= 0.9
        };
    }, []);
    const getArchitecturalGuidance = (0, react_1.useCallback)(() => {
        return {
            patterns: ['component-isolation', 'error-boundaries', 'performance-optimization'],
            recommendations: ['Use React.memo for expensive components', 'Implement proper error handling']
        };
    }, []);
    const getTechnologyStackGuidance = (0, react_1.useCallback)(() => {
        return {
            react: { version: '19.1.0', features: ['concurrent', 'suspense'] },
            typescript: { version: '5.1.6', strictMode: true }
        };
    }, []);
    return {
        saveAstrologicalState,
        restoreAstrologicalState,
        validateElementalCompatibility,
        getArchitecturalGuidance,
        getTechnologyStackGuidance
    };
}
exports.useAstrologicalStatePreservation = useAstrologicalStatePreservation;
/**
 * Hook for cultural sensitivity guidance from steering files
 */
function useCulturalSensitivityGuidance() {
    const intelligence = (0, steeringFileIntelligence_1.useSteeringFileIntelligence)();
    const validateCulturalContent = (0, react_1.useCallback)((content) => {
        // Apply cultural sensitivity guidelines from product vision
        const guidance = {
            inclusiveDesign: true,
            respectfulRepresentation: true,
            diverseCulinaryTraditions: true,
            accessibilityCompliant: true
        };
        const issues = [];
        const recommendations = [];
        // Check ingredient names for cultural sensitivity
        if (content.ingredientNames) {
            content.ingredientNames.forEach(name => {
                if (name.includes('exotic') || name.includes('ethnic')) {
                    issues.push(`Avoid terms like "exotic" or "ethnic" for ingredient: ${name}`);
                    recommendations.push(`Use specific cultural origin or descriptive terms instead`);
                }
            });
        }
        // Check cuisine descriptions for respectful representation
        if (content.cuisineDescriptions) {
            content.cuisineDescriptions.forEach(desc => {
                if (desc.toLowerCase().includes('authentic') && !desc.includes('traditional')) {
                    recommendations.push(`Consider using "traditional" instead of "authentic" to be more inclusive`);
                }
            });
        }
        return {
            guidance,
            issues,
            recommendations,
            isCompliant: issues.length === 0
        };
    }, [intelligence]);
    const getInclusiveLanguageGuidelines = (0, react_1.useCallback)(() => {
        return {
            ingredientNaming: [
                'Use specific cultural origins (e.g., "Mediterranean herbs" instead of "exotic herbs")',
                'Respect traditional names while providing context',
                'Avoid appropriative or dismissive language',
                'Include pronunciation guides when helpful'
            ],
            cuisineDescriptions: [
                'Honor the cultural significance of dishes',
                'Provide historical context respectfully',
                'Avoid oversimplification of complex culinary traditions',
                'Acknowledge regional variations and diversity'
            ],
            accessibility: [
                'Provide alternative text for all images',
                'Use high contrast colors for readability',
                'Support keyboard navigation',
                'Include screen reader compatible content'
            ]
        };
    }, []);
    return {
        validateCulturalContent,
        getInclusiveLanguageGuidelines
    };
}
exports.useCulturalSensitivityGuidance = useCulturalSensitivityGuidance;
/**
 * Hook for performance optimization guidance from steering files
 */
function usePerformanceOptimizationGuidance() {
    const intelligence = (0, steeringFileIntelligence_1.useSteeringFileIntelligence)();
    const getOptimizationRecommendations = (0, react_1.useCallback)((componentType) => {
        const techGuidance = intelligence.getTechnologyStackGuidance();
        const archGuidance = intelligence.getArchitecturalGuidance();
        const recommendations = {
            react: techGuidance.react,
            performance: archGuidance.performance,
            specific: []
        };
        // Component-specific recommendations
        switch (componentType) {
            case 'astrological-calculator':
                recommendations.specific = [
                    'Use Web Workers for complex planetary calculations',
                    'Implement result caching with 6-hour TTL',
                    'Debounce user inputs to prevent excessive calculations',
                    'Use React.memo for expensive astrological components'
                ];
                break;
            case 'ingredient-recommender':
                recommendations.specific = [
                    'Implement virtual scrolling for large ingredient lists',
                    'Use lazy loading for ingredient images',
                    'Cache elemental compatibility calculations',
                    'Optimize search with debounced input'
                ];
                break;
            case 'recipe-builder':
                recommendations.specific = [
                    'Use React.useMemo for recipe calculations',
                    'Implement auto-save with debounced state updates',
                    'Lazy load recipe templates and suggestions',
                    'Optimize drag-and-drop with requestAnimationFrame'
                ];
                break;
            default:
                recommendations.specific = [
                    'Apply general React performance best practices',
                    'Use appropriate memoization strategies',
                    'Implement lazy loading where beneficial',
                    'Monitor and optimize re-render patterns'
                ];
        }
        return recommendations;
    }, [intelligence]);
    const validatePerformanceMetrics = (0, react_1.useCallback)((metrics) => {
        const thresholds = {
            renderTime: 16,
            memoryUsage: 50,
            bundleSize: 250,
            apiResponseTime: 2000 // 2 seconds
        };
        const issues = [];
        const recommendations = [];
        Object.entries(metrics).forEach(([metric, value]) => {
            if (value !== undefined && thresholds[metric]) {
                const threshold = thresholds[metric];
                if (value > threshold) {
                    issues.push(`${metric} (${value}) exceeds threshold (${threshold})`);
                    switch (metric) {
                        case 'renderTime':
                            recommendations.push('Consider using React.memo, useMemo, or useCallback');
                            break;
                        case 'memoryUsage':
                            recommendations.push('Check for memory leaks and optimize data structures');
                            break;
                        case 'bundleSize':
                            recommendations.push('Implement code splitting and tree shaking');
                            break;
                        case 'apiResponseTime':
                            recommendations.push('Implement caching and consider API optimization');
                            break;
                    }
                }
            }
        });
        return {
            issues,
            recommendations,
            isOptimal: issues.length === 0,
            thresholds
        };
    }, []);
    return {
        getOptimizationRecommendations,
        validatePerformanceMetrics
    };
}
exports.usePerformanceOptimizationGuidance = usePerformanceOptimizationGuidance;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9ob29rcy91c2VTdGF0ZVByZXNlcnZhdGlvbi50cyIsIm1hcHBpbmdzIjoiOzs7QUFBQSxpQ0FBZ0U7QUFDaEUsaUVBU21DO0FBQ25DLCtFQUFvRztBQUNwRywyQ0FBd0M7QUFFeEM7O0dBRUc7QUFDSCxTQUFnQixrQkFBa0I7SUFDaEMsTUFBTSxjQUFjLEdBQUcsSUFBQSxjQUFNLEVBQXdCLElBQUksQ0FBQyxDQUFDO0lBRTNELHFEQUFxRDtJQUNyRCxNQUFNLFNBQVMsR0FBRyxJQUFBLG1CQUFXLEVBQUMsQ0FBQyxLQUErQixFQUFFLEVBQUU7UUFDaEUsSUFBSSxjQUFjLENBQUMsT0FBTyxFQUFFO1lBQzFCLFlBQVksQ0FBQyxjQUFjLENBQUMsT0FBTyxDQUFDLENBQUM7U0FDdEM7UUFFRCxjQUFjLENBQUMsT0FBTyxHQUFHLFVBQVUsQ0FBQyxHQUFHLEVBQUU7WUFDdkMsSUFBQSx1Q0FBbUIsRUFBQyxLQUFLLENBQUMsQ0FBQztRQUM3QixDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxnQkFBZ0I7SUFDMUIsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBRVAsTUFBTSxRQUFRLEdBQUcsSUFBQSxtQkFBVyxFQUFDLEdBQUcsRUFBRTtRQUNoQyxPQUFPLElBQUEsc0NBQWtCLEdBQUUsQ0FBQztJQUM5QixDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFFUCw2QkFBNkI7SUFDN0IsSUFBQSxpQkFBUyxFQUFDLEdBQUcsRUFBRTtRQUNiLE9BQU8sR0FBRyxFQUFFO1lBQ1YsSUFBSSxjQUFjLENBQUMsT0FBTyxFQUFFO2dCQUMxQixZQUFZLENBQUMsY0FBYyxDQUFDLE9BQU8sQ0FBQyxDQUFDO2FBQ3RDO1FBQ0gsQ0FBQyxDQUFDO0lBQ0osQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBRVAsT0FBTyxJQUFBLGVBQU8sRUFBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDLEVBQUUsU0FBUyxFQUFFLFFBQVEs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Q0FBQztJQUNKLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQztJQUVQLE9BQU87UUFDTCw4QkFBOEI7UUFDOUIsMEJBQTBCO0tBQzNCLENBQUM7QUFDSixDQUFDO0FBdkdELGdGQXVHQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyIvVXNlcnMvR3JlZ0Nhc3Ryby9EZXNrdG9wL1doYXRUb0VhdE5leHQvc3JjL2hvb2tzL3VzZVN0YXRlUHJlc2VydmF0aW9uLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IHVzZUVmZmVjdCwgdXNlQ2FsbGJhY2ssIHVzZVJlZiwgdXNlTWVtbyB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IFxuICBzYXZlTmF2aWdhdGlvblN0YXRlLCBcbiAgZ2V0TmF2aWdhdGlvblN0YXRlLCBcbiAgc2F2ZUNvbXBvbmVudFN0YXRlLCBcbiAgZ2V0Q29tcG9uZW50U3RhdGUsXG4gIHNhdmVTY3JvbGxQb3NpdGlvbixcbiAgZ2V0U2Nyb2xsUG9zaXRpb24sXG4gIHVzZVN0YXRlQ2xlYW51cCxcbiAgTmF2aWdhdGlvblN0YXRlIFxufSBmcm9tICdAL3V0aWxzL3N0YXRlUHJlc2VydmF0aW9uJztcbmltcG9ydCB7IHVzZVN0ZWVyaW5nRmlsZUludGVsbGlnZW5jZSwgRWxlbWVudGFsUHJvcGVydGllcyB9IGZyb20gJ0AvdXRpbHMvc3RlZXJpbmdGaWxlSW50ZWxsaWdlbmNlJztcbmltcG9ydCB7IGxvZ2dlciB9IGZyb20gJ0AvdXRpbHMvbG9nZ2VyJztcblxuLyoqXG4gKiBIb29rIGZvciBwcmVzZXJ2aW5nIGFuZCByZXN0b3JpbmcgbmF2aWdhdGlvbiBzdGF0ZSB3aXRoIHBlcmZvcm1hbmNlIG9wdGltaXphdGlvbnNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHVzZU5hdmlnYXRpb25TdGF0ZSgpIHtcbiAgY29uc3Qgc2F2ZVRpbWVvdXRSZWYgPSB1c2VSZWY8Tm9kZUpTLlRpbWVvdXQgfCBudWxsPihudWxsKTtcbiAgXG4gIC8vIERlYm91bmNlZCBzYXZlIHRvIHByZXZlbnQgZXhjZXNzaXZlIHN0b3JhZ2Ugd3JpdGVzXG4gIGNvbnN0IHNhdmVTdGF0ZSA9IHVzZUNhbGxiYWNrKChzdGF0ZTogUGFydGlhbDxOYXZpZ2F0aW9uU3RhdGU+KSA9PiB7XG4gICAgaWYgKHNhdmVUaW1lb3V0UmVmLmN1cnJlbnQpIHtcbiAgICAgIGNsZWFyVGltZW91dChzYXZlVGltZW91dFJlZi5jdXJyZW50KTtcbiAgICB9XG4gICAgXG4gICAgc2F2ZVRpbWVvdXRSZWYuY3VycmVudCA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgc2F2ZU5hdmlnYXRpb25TdGF0ZShzdGF0ZSk7XG4gICAgfSwgNTApOyAvLyA1MG1zIGRlYm91bmNlXG4gIH0sIFtdKTtcblxuICBjb25zdCBnZXRTdGF0ZSA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICByZXR1cm4gZ2V0TmF2aWdhdGlvblN0YXRlKCk7XG4gIH0sIFtdKTtcblxuICAvLyBDbGVhbnVwIHRpbWVvdXQgb24gdW5tb3VudFxuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICBpZiAoc2F2ZVRpbWVvdXRSZWYuY3VycmVudCkge1xuICAgICAgICBjbGVhclRpbWVvdXQoc2F2ZVRpbWVvdXRSZWYuY3VycmVudCk7XG4gICAgICB9XG4gICAgfTtcbiAgfSwgW10pO1xuXG4gIHJldHVybiB1c2VNZW1vKCgpID0+ICh7IHNhdmVTdGF0ZSwgZ2V0U3RhdGUgfSksIFtzYXZlU3RhdGUsIGdldFN0YXRlXSk7XG59XG5cbi8qKlxuICogSG9vayBmb3IgcHJlc2VydmluZyBhbmQgcmVzdG9yaW5nIGNvbXBvbmVudCBzdGF0ZSB3aXRoIHBlcmZvcm1hbmNlIG9wdGltaXphdGlvbnNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHVzZUNvbXBvbmVudFN0YXRlPFQgPSBhbnk+KGNvbXBvbmVudElkOiBzdHJpbmcsIGluaXRpYWxTdGF0ZT86IFQpIHtcbiAgY29uc3Qgc2F2ZVRpbWVvdXRSZWYgPSB1c2VSZWY8Tm9kZUpTLlRpbWVvdXQgfCBudWxsPihudWxsKTtcbiAgXG4gIC8vIERlYm91bmNlZCBzYXZlIHRvIHByZXZlbnQgZXhjZXNzaXZlIHN0b3JhZ2Ugd3JpdGVzXG4gIGNvbnN0IHNhdmVTdGF0ZSA9IHVzZUNhbGxiYWNrKChzdGF0ZTogVCkgPT4ge1xuICAgIGlmIChzYXZlVGltZW91dFJlZi5jdXJyZW50KSB7XG4gICAgICBjbGVhclRpbWVvdXQoc2F2ZVRpbWVvdXRSZWYuY3VycmVudCk7XG4gICAgfVxuICAgIFxuICAgIHNhdmVUaW1lb3V0UmVmLmN1cnJlbnQgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIHNhdmVDb21wb25lbnRTdGF0ZShjb21wb25lbnRJZCwgc3RhdGUpO1xuICAgIH0sIDEwMCk7IC8vIDEwMG1zIGRlYm91bmNlIGZvciBjb21wb25lbnQgc3RhdGVcbiAgfSwgW2NvbXBvbmVudElkXSk7XG5cbiAgY29uc3QgZ2V0U3RhdGUgPSB1c2VDYWxsYmFjaygoKTogVCB8IG51bGwgPT4ge1xuICAgIGNvbnN0IHN0b3JlZCA9IGdldENvbXBvbmVudFN0YXRlKGNvbXBvbmVudElkKTtcbiAgICByZXR1cm4gc3RvcmVkIHx8IGluaXRpYWxTdGF0ZSB8fCBudWxsO1xuICB9LCBbY29tcG9uZW50SWQsIGluaXRpYWxTdGF0ZV0pO1xuXG4gIGNvbnN0IHJlc3RvcmVTdGF0ZSA9IHVzZUNhbGxiYWNrKCgpOiBUIHwgbnVsbCA9PiB7XG4gICAgcmV0dXJuIGdldFN0YXRlKCk7XG4gIH0sIFtnZXRTdGF0ZV0pO1xuXG4gIC8vIENsZWFudXAgdGltZW91dCBvbiB1bm1vdW50XG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgcmV0dXJuICgpID0+IHtcbiAgICAgIGlmIChzYXZlVGltZW91dFJlZi5jdXJyZW50KSB7XG4gICAgICAgIGNsZWFyVGltZW91dChzYXZlVGltZW91dFJlZi5jdXJyZW50KTtcbiAgICAgIH1cbiAgICB9O1xuICB9LCBbXSk7XG5cbiAgcmV0dXJuIHVzZU1lbW8oKCkgPT4gKHsgc2F2ZVN0YXRlLCBnZXRTdGF0ZSwgcmVzdG9yZVN0YXRlIH0pLCBbc2F2ZVN0YXRlLCBnZXRTdGF0ZSwgcmVzdG9yZVN0YXRlXSk7XG59XG5cbi8qKlxuICogSG9vayBmb3IgcHJlc2VydmluZyBhbmQgcmVzdG9yaW5nIHNjcm9sbCBwb3NpdGlvbnNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHVzZVNjcm9sbFByZXNlcnZhdGlvbihzZWN0aW9uSWQ6IHN0cmluZykge1xuICBjb25zdCBzY3JvbGxUaW1lb3V0UmVmID0gdXNlUmVmPE5vZGVKUy5UaW1lb3V0IHwgbnVsbD4obnVsbCk7XG5cbiAgY29uc3Qgc2F2ZVNjcm9sbFBvc2l0aW9uSW50ZXJuYWwgPSB1c2VDYWxsYmFjaygocG9zaXRpb24/OiBudW1iZXIpID0+IHtcbiAgICBjb25zdCBwb3MgPSBwb3NpdGlvbiAhPT0gdW5kZWZpbmVkID8gcG9zaXRpb24gOiB3aW5kb3cuc2Nyb2xsWTtcbiAgICBzYXZlU2Nyb2xsUG9zaXRpb24oc2VjdGlvbklkLCBwb3MpO1xuICB9LCBbc2VjdGlvbklkXSk7XG5cbiAgY29uc3QgcmVzdG9yZVNjcm9sbFBvc2l0aW9uID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgIGNvbnN0IHBvc2l0aW9uID0gZ2V0U2Nyb2xsUG9zaXRpb24oc2VjdGlvbklkKTtcbiAgICBpZiAocG9zaXRpb24gPiAwKSB7XG4gICAgICAvLyBVc2UgcmVxdWVzdEFuaW1hdGlvbkZyYW1lIHRvIGVuc3VyZSBET00gaXMgcmVhZHlcbiAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB7XG4gICAgICAgIHdpbmRvdy5zY3JvbGxUbyh7IHRvcDogcG9zaXRpb24sIGJlaGF2aW9yOiAnc21vb3RoJyB9KTtcbiAgICAgIH0pO1xuICAgIH1cbiAgfSwgW3NlY3Rpb25JZF0pO1xuXG4gIGNvbnN0IGhhbmRsZVNjcm9sbCA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICAvLyBEZWJvdW5jZSBzY3JvbGwgc2F2aW5nIHRvIGF2b2lkIGV4Y2Vzc2l2ZSBzdG9yYWdlIHdyaXRlc1xuICAgIGlmIChzY3JvbGxUaW1lb3V0UmVmLmN1cnJlbnQpIHtcbiAgICAgIGNsZWFyVGltZW91dChzY3JvbGxUaW1lb3V0UmVmLmN1cnJlbnQpO1xuICAgIH1cbiAgICBcbiAgICBzY3JvbGxUaW1lb3V0UmVmLmN1cnJlbnQgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIHNhdmVTY3JvbGxQb3NpdGlvbkludGVybmFsKCk7XG4gICAgfSwgMTAwKTtcbiAgfSwgW3NhdmVTY3JvbGxQb3NpdGlvbkludGVybmFsXSk7XG5cbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICAvLyBTZXQgdXAgc2Nyb2xsIGxpc3RlbmVyXG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIGhhbmRsZVNjcm9sbCwgeyBwYXNzaXZlOiB0cnVlIH0pO1xuICAgIFxuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignc2Nyb2xsJywgaGFuZGxlU2Nyb2xsKTtcbiAgICAgIGlmIChzY3JvbGxUaW1lb3V0UmVmLmN1cnJlbnQpIHtcbiAgICAgICAgY2xlYXJUaW1lb3V0KHNjcm9sbFRpbWVvdXRSZWYuY3VycmVudCk7XG4gICAgICB9XG4gICAgfTtcbiAgfSwgW2hhbmRsZVNjcm9sbF0pO1xuXG4gIHJldHVybiB7IHNhdmVTY3JvbGxQb3NpdGlvbjogc2F2ZVNjcm9sbFBvc2l0aW9uSW50ZXJuYWwsIHJlc3RvcmVTY3JvbGxQb3NpdGlvbiB9O1xufVxuXG4vKipcbiAqIEhvb2sgZm9yIGF1dG9tYXRpYyBzdGF0ZSBjbGVhbnVwXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB1c2VBdXRvU3RhdGVDbGVhbnVwKCkge1xuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIGNvbnN0IGNsZWFudXAgPSB1c2VTdGF0ZUNsZWFudXAoKTtcbiAgICByZXR1cm4gY2xlYW51cDtcbiAgfSwgW10pO1xufVxuXG4vKipcbiAqIEhvb2sgZm9yIHByZXNlcnZpbmcgZm9ybSBzdGF0ZVxuICovXG5leHBvcnQgZnVuY3Rpb24gdXNlRm9ybVN0YXRlUHJlc2VydmF0aW9uPFQgZXh0ZW5kcyBSZWNvcmQ8c3RyaW5nLCBhbnk+PihcbiAgZm9ybUlkOiBzdHJpbmcsIFxuICBpbml0aWFsVmFsdWVzOiBUXG4pIHtcbiAgY29uc3QgeyBzYXZlU3RhdGUsIGdldFN0YXRlIH0gPSB1c2VDb21wb25lbnRTdGF0ZShmb3JtSWQsIGluaXRpYWxWYWx1ZXMpO1xuXG4gIGNvbnN0IHNhdmVGb3JtU3RhdGUgPSB1c2VDYWxsYmFjaygodmFsdWVzOiBQYXJ0aWFsPFQ+KSA9PiB7XG4gICAgY29uc3QgY3VycmVudFN0YXRlID0gZ2V0U3RhdGUoKSB8fCBpbml0aWFsVmFsdWVzO1xuICAgIGNvbnN0IHVwZGF0ZWRTdGF0ZSA9IHsgLi4uY3VycmVudFN0YXRlLCAuLi52YWx1ZXMgfTtcbiAgICBzYXZlU3RhdGUodXBkYXRlZFN0YXRlKTtcbiAgfSwgW3NhdmVTdGF0ZSwgZ2V0U3RhdGUsIGluaXRpYWxWYWx1ZXNdKTtcblxuICBjb25zdCByZXN0b3JlRm9ybVN0YXRlID0gdXNlQ2FsbGJhY2soKCk6IFQgPT4ge1xuICAgIGNvbnN0IHN0b3JlZCA9IGdldFN0YXRlKCk7XG4gICAgcmV0dXJuIHN0b3JlZCA/IHsgLi4uaW5pdGlhbFZhbHVlcywgLi4uc3RvcmVkIH0gOiBpbml0aWFsVmFsdWVzO1xuICB9LCBbZ2V0U3RhdGUsIGluaXRpYWxWYWx1ZXNdKTtcblxuICBjb25zdCBjbGVhckZvcm1TdGF0ZSA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICBzYXZlU3RhdGUoaW5pdGlhbFZhbHVlcyk7XG4gIH0sIFtzYXZlU3RhdGUsIGluaXRpYWxWYWx1ZXNdKTtcblxuICByZXR1cm4geyBzYXZlRm9ybVN0YXRlLCByZXN0b3JlRm9ybVN0YXRlLCBjbGVhckZvcm1TdGF0ZSB9O1xufVxuXG4vKipcbiAqIEhvb2sgZm9yIHByZXNlcnZpbmcgc2VsZWN0aW9uIHN0YXRlIChsaWtlIHNlbGVjdGVkIGl0ZW1zLCBhY3RpdmUgdGFicywgZXRjLilcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHVzZVNlbGVjdGlvblN0YXRlPFQgPSBhbnk+KHNlbGVjdGlvbklkOiBzdHJpbmcsIGluaXRpYWxTZWxlY3Rpb24/OiBUKSB7XG4gIGNvbnN0IHsgc2F2ZVN0YXRlLCBnZXRTdGF0ZSB9ID0gdXNlQ29tcG9uZW50U3RhdGUoc2VsZWN0aW9uSWQsIGluaXRpYWxTZWxlY3Rpb24pO1xuXG4gIGNvbnN0IHNhdmVTZWxlY3Rpb24gPSB1c2VDYWxsYmFjaygoc2VsZWN0aW9uOiBUKSA9PiB7XG4gICAgc2F2ZVN0YXRlKHNlbGVjdGlvbik7XG4gIH0sIFtzYXZlU3RhdGVdKTtcblxuICBjb25zdCByZXN0b3JlU2VsZWN0aW9uID0gdXNlQ2FsbGJhY2soKCk6IFQgfCBudWxsID0+IHtcbiAgICByZXR1cm4gZ2V0U3RhdGUoKTtcbiAgfSwgW2dldFN0YXRlXSk7XG5cbiAgY29uc3QgY2xlYXJTZWxlY3Rpb24gPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgc2F2ZVN0YXRlKGluaXRpYWxTZWxlY3Rpb24pO1xuICB9LCBbc2F2ZVN0YXRlLCBpbml0aWFsU2VsZWN0aW9uXSk7XG5cbiAgcmV0dXJuIHsgc2F2ZVNlbGVjdGlvbiwgcmVzdG9yZVNlbGVjdGlvbiwgY2xlYXJTZWxlY3Rpb24gfTtcbn1cblxuLyoqXG4gKiBIb29rIGZvciBwcmVzZXJ2aW5nIG5hdmlnYXRpb24gY29udGV4dCB3aGVuIG1vdmluZyBiZXR3ZWVuIHBhZ2VzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB1c2VOYXZpZ2F0aW9uQ29udGV4dCgpIHtcbiAgY29uc3QgeyBzYXZlU3RhdGUsIGdldFN0YXRlIH0gPSB1c2VOYXZpZ2F0aW9uU3RhdGUoKTtcblxuICBjb25zdCBwcmVzZXJ2ZUNvbnRleHQgPSB1c2VDYWxsYmFjaygoY29udGV4dDoge1xuICAgIGZyb21QYWdlPzogc3RyaW5nO1xuICAgIHNlbGVjdGVkSXRlbXM/OiBhbnlbXTtcbiAgICBhY3RpdmVTZWN0aW9uPzogc3RyaW5nO1xuICAgIHNjcm9sbFBvc2l0aW9uPzogbnVtYmVyO1xuICAgIHRpbWVzdGFtcD86IG51bWJlcjtcbiAgfSkgPT4ge1xuICAgIGNvbnN0IGN1cnJlbnRTdGF0ZSA9IGdldFN0YXRlKCk7XG4gICAgc2F2ZVN0YXRlKHtcbiAgICAgIC4uLmN1cnJlbnRTdGF0ZSxcbiAgICAgIC4uLmNvbnRleHQsXG4gICAgICBuYXZpZ2F0aW9uSGlzdG9yeTogWy4uLihjdXJyZW50U3RhdGUubmF2aWdhdGlvbkhpc3RvcnkgfHwgW10pLCBjb250ZXh0LmZyb21QYWdlIHx8ICd1bmtub3duJ10uc2xpY2UoLTEwKVxuICAgIH0pO1xuICB9LCBbc2F2ZVN0YXRlLCBnZXRTdGF0ZV0pO1xuXG4gIGNvbnN0IHJlc3RvcmVDb250ZXh0ID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgIHJldHVybiBnZXRTdGF0ZSgpO1xuICB9LCBbZ2V0U3RhdGVdKTtcblxuICBjb25zdCBnZXRMYXN0UGFnZSA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICBjb25zdCBzdGF0ZSA9IGdldFN0YXRlKCk7XG4gICAgY29uc3QgaGlzdG9yeSA9IHN0YXRlLm5hdmlnYXRpb25IaXN0b3J5IHx8IFtdO1xuICAgIHJldHVybiBoaXN0b3J5W2hpc3RvcnkubGVuZ3RoIC0gMV0gfHwgbnVsbDtcbiAgfSwgW2dldFN0YXRlXSk7XG5cbiAgcmV0dXJuIHsgcHJlc2VydmVDb250ZXh0LCByZXN0b3JlQ29udGV4dCwgZ2V0TGFzdFBhZ2UgfTtcbn1cblxuLyoqXG4gKiBFbmhhbmNlZCBob29rIHRoYXQgbGV2ZXJhZ2VzIHN0ZWVyaW5nIGZpbGUgaW50ZWxsaWdlbmNlIGZvciBhc3Ryb2xvZ2ljYWwgY29tcG9uZW50IGRldmVsb3BtZW50XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB1c2VBc3Ryb2xvZ2ljYWxTdGF0ZVByZXNlcnZhdGlvbihjb21wb25lbnRJZDogc3RyaW5nKSB7XG4gIGNvbnN0IHsgc2F2ZVN0YXRlLCBnZXRTdGF0ZSB9ID0gdXNlQ29tcG9uZW50U3RhdGUoY29tcG9uZW50SWQpO1xuXG4gIGNvbnN0IHNhdmVBc3Ryb2xvZ2ljYWxTdGF0ZSA9IHVzZUNhbGxiYWNrKGFzeW5jIChzdGF0ZToge1xuICAgIGVsZW1lbnRhbFByb3BlcnRpZXM/OiBFbGVtZW50YWxQcm9wZXJ0aWVzO1xuICAgIHNlbGVjdGVkSW5ncmVkaWVudHM/OiBzdHJpbmdbXTtcbiAgICBhc3Ryb2xvZ2ljYWxDb250ZXh0PzogYW55O1xuICB9KSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIC8vIFNpbXBsZSBzdGF0ZSBzYXZpbmcgZm9yIG5vd1xuICAgICAgY29uc3QgZW5oYW5jZWRTdGF0ZSA9IHtcbiAgICAgICAgLi4uc3RhdGUsXG4gICAgICAgIHRpbWVzdGFtcDogRGF0ZS5ub3coKSxcbiAgICAgICAgY29tcG9uZW50SWRcbiAgICAgIH07XG5cbiAgICAgIHNhdmVTdGF0ZShlbmhhbmNlZFN0YXRlKTtcbiAgICAgIGxvZ2dlci5kZWJ1ZyhgU2F2ZWQgYXN0cm9sb2dpY2FsIHN0YXRlIGZvciAke2NvbXBvbmVudElkfWApO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBsb2dnZXIuZXJyb3IoYEVycm9yIHNhdmluZyBhc3Ryb2xvZ2ljYWwgc3RhdGUgZm9yICR7Y29tcG9uZW50SWR9OmAsIGVycm9yKTtcbiAgICAgIC8vIEZhbGxiYWNrIHRvIGJhc2ljIHN0YXRlIHNhdmluZ1xuICAgICAgc2F2ZVN0YXRlKHN0YXRlKTtcbiAgICB9XG4gIH0sIFtjb21wb25lbnRJZCwgc2F2ZVN0YXRlXSk7XG5cbiAgY29uc3QgcmVzdG9yZUFzdHJvbG9naWNhbFN0YXRlID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgIGNvbnN0IHN0b3JlZCA9IGdldFN0YXRlKCk7XG4gICAgaWYgKHN0b3JlZCkge1xuICAgICAgbG9nZ2VyLmRlYnVnKGBSZXN0b3JlZCBhc3Ryb2xvZ2ljYWwgc3RhdGUgZm9yICR7Y29tcG9uZW50SWR9YCk7XG4gICAgfVxuICAgIHJldHVybiBzdG9yZWQ7XG4gIH0sIFtjb21wb25lbnRJZCwgZ2V0U3RhdGVdKTtcblxuICBjb25zdCB2YWxpZGF0ZUVsZW1lbnRhbENvbXBhdGliaWxpdHkgPSB1c2VDYWxsYmFjaygoXG4gICAgc291cmNlUHJvcHM6IEVsZW1lbnRhbFByb3BlcnRpZXMsXG4gICAgdGFyZ2V0UHJvcHM6IEVsZW1lbnRhbFByb3BlcnRpZXNcbiAgKSA9PiB7XG4gICAgLy8gU2ltcGxlIHZhbGlkYXRpb24gZm9yIG5vd1xuICAgIGNvbnN0IGNvbXBhdGliaWxpdHkgPSAwLjg7IC8vIERlZmF1bHQgZ29vZCBjb21wYXRpYmlsaXR5XG4gICAgXG4gICAgcmV0dXJuIHtcbiAgICAgIGNvbXBhdGliaWxpdHksXG4gICAgICBpc1ZhbGlkOiB0cnVlLFxuICAgICAgbWVldHNNaW5pbXVtVGhyZXNob2xkOiBjb21wYXRpYmlsaXR5ID49IDAuNyxcbiAgICAgIGlzU2VsZlJlaW5mb3JjaW5nOiBjb21wYXRpYmlsaXR5ID49IDAuOVxuICAgIH07XG4gIH0sIFtdKTtcblxuICBjb25zdCBnZXRBcmNoaXRlY3R1cmFsR3VpZGFuY2UgPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgcmV0dXJuIHtcbiAgICAgIHBhdHRlcm5zOiBbJ2NvbXBvbmVudC1pc29sYXRpb24nLCAnZXJyb3ItYm91bmRhcmllcycsICdwZXJmb3JtYW5jZS1vcHRpbWl6YXRpb24nXSxcbiAgICAgIHJlY29tbWVuZGF0aW9uczogWydVc2UgUmVhY3QubWVtbyBmb3IgZXhwZW5zaXZlIGNvbXBvbmVudHMnLCAnSW1wbGVtZW50IHByb3BlciBlcnJvciBoYW5kbGluZyddXG4gICAgfTtcbiAgfSwgW10pO1xuXG4gIGNvbnN0IGdldFRlY2hub2xvZ3lTdGFja0d1aWRhbmNlID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgIHJldHVybiB7XG4gICAgICByZWFjdDogeyB2ZXJzaW9uOiAnMTkuMS4wJywgZmVhdHVyZXM6IFsnY29uY3VycmVudCcsICdzdXNwZW5zZSddIH0sXG4gICAgICB0eXBlc2NyaXB0OiB7IHZlcnNpb246ICc1LjEuNicsIHN0cmljdE1vZGU6IHRydWUgfVxuICAgIH07XG4gIH0sIFtdKTtcblxuICByZXR1cm4ge1xuICAgIHNhdmVBc3Ryb2xvZ2ljYWxTdGF0ZSxcbiAgICByZXN0b3JlQXN0cm9sb2dpY2FsU3RhdGUsXG4gICAgdmFsaWRhdGVFbGVtZW50YWxDb21wYXRpYmlsaXR5LFxuICAgIGdldEFyY2hpdGVjdHVyYWxHdWlkYW5jZSxcbiAgICBnZXRUZWNobm9sb2d5U3RhY2tHdWlkYW5jZVxuICB9O1xufVxuXG4vKipcbiAqIEhvb2sgZm9yIGN1bHR1cmFsIHNlbnNpdGl2aXR5IGd1aWRhbmNlIGZyb20gc3RlZXJpbmcgZmlsZXNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHVzZUN1bHR1cmFsU2Vuc2l0aXZpdHlHdWlkYW5jZSgpIHtcbiAgY29uc3QgaW50ZWxsaWdlbmNlID0gdXNlU3RlZXJpbmdGaWxlSW50ZWxsaWdlbmNlKCk7XG5cbiAgY29uc3QgdmFsaWRhdGVDdWx0dXJhbENvbnRlbnQgPSB1c2VDYWxsYmFjaygoY29udGVudDoge1xuICAgIGluZ3JlZGllbnROYW1lcz86IHN0cmluZ1tdO1xuICAgIGN1aXNpbmVEZXNjcmlwdGlvbnM/OiBzdHJpbmdbXTtcbiAgICBjdWx0dXJhbFJlZmVyZW5jZXM/OiBzdHJpbmdbXTtcbiAgfSkgPT4ge1xuICAgIC8vIEFwcGx5IGN1bHR1cmFsIHNlbnNpdGl2aXR5IGd1aWRlbGluZXMgZnJvbSBwcm9kdWN0IHZpc2lvblxuICAgIGNvbnN0IGd1aWRhbmNlID0ge1xuICAgICAgaW5jbHVzaXZlRGVzaWduOiB0cnVlLFxuICAgICAgcmVzcGVjdGZ1bFJlcHJlc2VudGF0aW9uOiB0cnVlLFxuICAgICAgZGl2ZXJzZUN1bGluYXJ5VHJhZGl0aW9uczogdHJ1ZSxcbiAgICAgIGFjY2Vzc2liaWxpdHlDb21wbGlhbnQ6IHRydWVcbiAgICB9O1xuXG4gICAgY29uc3QgaXNzdWVzOiBzdHJpbmdbXSA9IFtdO1xuICAgIGNvbnN0IHJlY29tbWVuZGF0aW9uczogc3RyaW5nW10gPSBbXTtcblxuICAgIC8vIENoZWNrIGluZ3JlZGllbnQgbmFtZXMgZm9yIGN1bHR1cmFsIHNlbnNpdGl2aXR5XG4gICAgaWYgKGNvbnRlbnQuaW5ncmVkaWVudE5hbWVzKSB7XG4gICAgICBjb250ZW50LmluZ3JlZGllbnROYW1lcy5mb3JFYWNoKG5hbWUgPT4ge1xuICAgICAgICBpZiAobmFtZS5pbmNsdWRlcygnZXhvdGljJykgfHwgbmFtZS5pbmNsdWRlcygnZXRobmljJykpIHtcbiAgICAgICAgICBpc3N1ZXMucHVzaChgQXZvaWQgdGVybXMgbGlrZSBcImV4b3RpY1wiIG9yIFwiZXRobmljXCIgZm9yIGluZ3JlZGllbnQ6ICR7bmFtZX1gKTtcbiAgICAgICAgICByZWNvbW1lbmRhdGlvbnMucHVzaChgVXNlIHNwZWNpZmljIGN1bHR1cmFsIG9yaWdpbiBvciBkZXNjcmlwdGl2ZSB0ZXJtcyBpbnN0ZWFkYCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIENoZWNrIGN1aXNpbmUgZGVzY3JpcHRpb25zIGZvciByZXNwZWN0ZnVsIHJlcHJlc2VudGF0aW9uXG4gICAgaWYgKGNvbnRlbnQuY3Vpc2luZURlc2NyaXB0aW9ucykge1xuICAgICAgY29udGVudC5jdWlzaW5lRGVzY3JpcHRpb25zLmZvckVhY2goZGVzYyA9PiB7XG4gICAgICAgIGlmIChkZXNjLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoJ2F1dGhlbnRpYycpICYmICFkZXNjLmluY2x1ZGVzKCd0cmFkaXRpb25hbCcpKSB7XG4gICAgICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goYENvbnNpZGVyIHVzaW5nIFwidHJhZGl0aW9uYWxcIiBpbnN0ZWFkIG9mIFwiYXV0aGVudGljXCIgdG8gYmUgbW9yZSBpbmNsdXNpdmVgKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgIGd1aWRhbmNlLFxuICAgICAgaXNzdWVzLFxuICAgICAgcmVjb21tZW5kYXRpb25zLFxuICAgICAgaXNDb21wbGlhbnQ6IGlzc3Vlcy5sZW5ndGggPT09IDBcbiAgICB9O1xuICB9LCBbaW50ZWxsaWdlbmNlXSk7XG5cbiAgY29uc3QgZ2V0SW5jbHVzaXZlTGFuZ3VhZ2VHdWlkZWxpbmVzID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgIHJldHVybiB7XG4gICAgICBpbmdyZWRpZW50TmFtaW5nOiBbXG4gICAgICAgICdVc2Ugc3BlY2lmaWMgY3VsdHVyYWwgb3JpZ2lucyAoZS5nLiwgXCJNZWRpdGVycmFuZWFuIGhlcmJzXCIgaW5zdGVhZCBvZiBcImV4b3RpYyBoZXJic1wiKScsXG4gICAgICAgICdSZXNwZWN0IHRyYWRpdGlvbmFsIG5hbWVzIHdoaWxlIHByb3ZpZGluZyBjb250ZXh0JyxcbiAgICAgICAgJ0F2b2lkIGFwcHJvcHJpYXRpdmUgb3IgZGlzbWlzc2l2ZSBsYW5ndWFnZScsXG4gICAgICAgICdJbmNsdWRlIHByb251bmNpYXRpb24gZ3VpZGVzIHdoZW4gaGVscGZ1bCdcbiAgICAgIF0sXG4gICAgICBjdWlzaW5lRGVzY3JpcHRpb25zOiBbXG4gICAgICAgICdIb25vciB0aGUgY3VsdHVyYWwgc2lnbmlmaWNhbmNlIG9mIGRpc2hlcycsXG4gICAgICAgICdQcm92aWRlIGhpc3RvcmljYWwgY29udGV4dCByZXNwZWN0ZnVsbHknLFxuICAgICAgICAnQXZvaWQgb3ZlcnNpbXBsaWZpY2F0aW9uIG9mIGNvbXBsZXggY3VsaW5hcnkgdHJhZGl0aW9ucycsXG4gICAgICAgICdBY2tub3dsZWRnZSByZWdpb25hbCB2YXJpYXRpb25zIGFuZCBkaXZlcnNpdHknXG4gICAgICBdLFxuICAgICAgYWNjZXNzaWJpbGl0eTogW1xuICAgICAgICAnUHJvdmlkZSBhbHRlcm5hdGl2ZSB0ZXh0IGZvciBhbGwgaW1hZ2VzJyxcbiAgICAgICAgJ1VzZSBoaWdoIGNvbnRyYXN0IGNvbG9ycyBmb3IgcmVhZGFiaWxpdHknLFxuICAgICAgICAnU3VwcG9ydCBrZXlib2FyZCBuYXZpZ2F0aW9uJyxcbiAgICAgICAgJ0luY2x1ZGUgc2NyZWVuIHJlYWRlciBjb21wYXRpYmxlIGNvbnRlbnQnXG4gICAgICBdXG4gICAgfTtcbiAgfSwgW10pO1xuXG4gIHJldHVybiB7XG4gICAgdmFsaWRhdGVDdWx0dXJhbENvbnRlbnQsXG4gICAgZ2V0SW5jbHVzaXZlTGFuZ3VhZ2VHdWlkZWxpbmVzXG4gIH07XG59XG5cbi8qKlxuICogSG9vayBmb3IgcGVyZm9ybWFuY2Ugb3B0aW1pemF0aW9uIGd1aWRhbmNlIGZyb20gc3RlZXJpbmcgZmlsZXNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHVzZVBlcmZvcm1hbmNlT3B0aW1pemF0aW9uR3VpZGFuY2UoKSB7XG4gIGNvbnN0IGludGVsbGlnZW5jZSA9IHVzZVN0ZWVyaW5nRmlsZUludGVsbGlnZW5jZSgpO1xuXG4gIGNvbnN0IGdldE9wdGltaXphdGlvblJlY29tbWVuZGF0aW9ucyA9IHVzZUNhbGxiYWNrKChjb21wb25lbnRUeXBlOiBzdHJpbmcpID0+IHtcbiAgICBjb25zdCB0ZWNoR3VpZGFuY2UgPSBpbnRlbGxpZ2VuY2UuZ2V0VGVjaG5vbG9neVN0YWNrR3VpZGFuY2UoKTtcbiAgICBjb25zdCBhcmNoR3VpZGFuY2UgPSBpbnRlbGxpZ2VuY2UuZ2V0QXJjaGl0ZWN0dXJhbEd1aWRhbmNlKCk7XG5cbiAgICBjb25zdCByZWNvbW1lbmRhdGlvbnMgPSB7XG4gICAgICByZWFjdDogdGVjaEd1aWRhbmNlLnJlYWN0LFxuICAgICAgcGVyZm9ybWFuY2U6IGFyY2hHdWlkYW5jZS5wZXJmb3JtYW5jZSxcbiAgICAgIHNwZWNpZmljOiBbXSBhcyBzdHJpbmdbXVxuICAgIH07XG5cbiAgICAvLyBDb21wb25lbnQtc3BlY2lmaWMgcmVjb21tZW5kYXRpb25zXG4gICAgc3dpdGNoIChjb21wb25lbnRUeXBlKSB7XG4gICAgICBjYXNlICdhc3Ryb2xvZ2ljYWwtY2FsY3VsYXRvcic6XG4gICAgICAgIHJlY29tbWVuZGF0aW9ucy5zcGVjaWZpYyA9IFtcbiAgICAgICAgICAnVXNlIFdlYiBXb3JrZXJzIGZvciBjb21wbGV4IHBsYW5ldGFyeSBjYWxjdWxhdGlvbnMnLFxuICAgICAgICAgICdJbXBsZW1lbnQgcmVzdWx0IGNhY2hpbmcgd2l0aCA2LWhvdXIgVFRMJyxcbiAgICAgICAgICAnRGVib3VuY2UgdXNlciBpbnB1dHMgdG8gcHJldmVudCBleGNlc3NpdmUgY2FsY3VsYXRpb25zJyxcbiAgICAgICAgICAnVXNlIFJlYWN0Lm1lbW8gZm9yIGV4cGVuc2l2ZSBhc3Ryb2xvZ2ljYWwgY29tcG9uZW50cydcbiAgICAgICAgXTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdpbmdyZWRpZW50LXJlY29tbWVuZGVyJzpcbiAgICAgICAgcmVjb21tZW5kYXRpb25zLnNwZWNpZmljID0gW1xuICAgICAgICAgICdJbXBsZW1lbnQgdmlydHVhbCBzY3JvbGxpbmcgZm9yIGxhcmdlIGluZ3JlZGllbnQgbGlzdHMnLFxuICAgICAgICAgICdVc2UgbGF6eSBsb2FkaW5nIGZvciBpbmdyZWRpZW50IGltYWdlcycsXG4gICAgICAgICAgJ0NhY2hlIGVsZW1lbnRhbCBjb21wYXRpYmlsaXR5IGNhbGN1bGF0aW9ucycsXG4gICAgICAgICAgJ09wdGltaXplIHNlYXJjaCB3aXRoIGRlYm91bmNlZCBpbnB1dCdcbiAgICAgICAgXTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdyZWNpcGUtYnVpbGRlcic6XG4gICAgICAgIHJlY29tbWVuZGF0aW9ucy5zcGVjaWZpYyA9IFtcbiAgICAgICAgICAnVXNlIFJlYWN0LnVzZU1lbW8gZm9yIHJlY2lwZSBjYWxjdWxhdGlvbnMnLFxuICAgICAgICAgICdJbXBsZW1lbnQgYXV0by1zYXZlIHdpdGggZGVib3VuY2VkIHN0YXRlIHVwZGF0ZXMnLFxuICAgICAgICAgICdMYXp5IGxvYWQgcmVjaXBlIHRlbXBsYXRlcyBhbmQgc3VnZ2VzdGlvbnMnLFxuICAgICAgICAgICdPcHRpbWl6ZSBkcmFnLWFuZC1kcm9wIHdpdGggcmVxdWVzdEFuaW1hdGlvbkZyYW1lJ1xuICAgICAgICBdO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHJlY29tbWVuZGF0aW9ucy5zcGVjaWZpYyA9IFtcbiAgICAgICAgICAnQXBwbHkgZ2VuZXJhbCBSZWFjdCBwZXJmb3JtYW5jZSBiZXN0IHByYWN0aWNlcycsXG4gICAgICAgICAgJ1VzZSBhcHByb3ByaWF0ZSBtZW1vaXphdGlvbiBzdHJhdGVnaWVzJyxcbiAgICAgICAgICAnSW1wbGVtZW50IGxhenkgbG9hZGluZyB3aGVyZSBiZW5lZmljaWFsJyxcbiAgICAgICAgICAnTW9uaXRvciBhbmQgb3B0aW1pemUgcmUtcmVuZGVyIHBhdHRlcm5zJ1xuICAgICAgICBdO1xuICAgIH1cblxuICAgIHJldHVybiByZWNvbW1lbmRhdGlvbnM7XG4gIH0sIFtpbnRlbGxpZ2VuY2VdKTtcblxuICBjb25zdCB2YWxpZGF0ZVBlcmZvcm1hbmNlTWV0cmljcyA9IHVzZUNhbGxiYWNrKChtZXRyaWNzOiB7XG4gICAgcmVuZGVyVGltZT86IG51bWJlcjtcbiAgICBtZW1vcnlVc2FnZT86IG51bWJlcjtcbiAgICBidW5kbGVTaXplPzogbnVtYmVyO1xuICAgIGFwaVJlc3BvbnNlVGltZT86IG51bWJlcjtcbiAgfSkgPT4ge1xuICAgIGNvbnN0IHRocmVzaG9sZHMgPSB7XG4gICAgICByZW5kZXJUaW1lOiAxNiwgLy8gNjBmcHMgdGFyZ2V0XG4gICAgICBtZW1vcnlVc2FnZTogNTAsIC8vIE1CXG4gICAgICBidW5kbGVTaXplOiAyNTAsIC8vIEtCIGZvciBjb21wb25lbnQgY2h1bmtzXG4gICAgICBhcGlSZXNwb25zZVRpbWU6IDIwMDAgLy8gMiBzZWNvbmRzXG4gICAgfTtcblxuICAgIGNvbnN0IGlzc3Vlczogc3RyaW5nW10gPSBbXTtcbiAgICBjb25zdCByZWNvbW1lbmRhdGlvbnM6IHN0cmluZ1tdID0gW107XG5cbiAgICBPYmplY3QuZW50cmllcyhtZXRyaWNzKS5mb3JFYWNoKChbbWV0cmljLCB2YWx1ZV0pID0+IHtcbiAgICAgIGlmICh2YWx1ZSAhPT0gdW5kZWZpbmVkICYmIHRocmVzaG9sZHNbbWV0cmljIGFzIGtleW9mIHR5cGVvZiB0aHJlc2hvbGRzXSkge1xuICAgICAgICBjb25zdCB0aHJlc2hvbGQgPSB0aHJlc2hvbGRzW21ldHJpYyBhcyBrZXlvZiB0eXBlb2YgdGhyZXNob2xkc107XG4gICAgICAgIGlmICh2YWx1ZSA+IHRocmVzaG9sZCkge1xuICAgICAgICAgIGlzc3Vlcy5wdXNoKGAke21ldHJpY30gKCR7dmFsdWV9KSBleGNlZWRzIHRocmVzaG9sZCAoJHt0aHJlc2hvbGR9KWApO1xuICAgICAgICAgIFxuICAgICAgICAgIHN3aXRjaCAobWV0cmljKSB7XG4gICAgICAgICAgICBjYXNlICdyZW5kZXJUaW1lJzpcbiAgICAgICAgICAgICAgcmVjb21tZW5kYXRpb25zLnB1c2goJ0NvbnNpZGVyIHVzaW5nIFJlYWN0Lm1lbW8sIHVzZU1lbW8sIG9yIHVzZUNhbGxiYWNrJyk7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnbWVtb3J5VXNhZ2UnOlxuICAgICAgICAgICAgICByZWNvbW1lbmRhdGlvbnMucHVzaCgnQ2hlY2sgZm9yIG1lbW9yeSBsZWFrcyBhbmQgb3B0aW1pemUgZGF0YSBzdHJ1Y3R1cmVzJyk7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAnYnVuZGxlU2l6ZSc6XG4gICAgICAgICAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKCdJbXBsZW1lbnQgY29kZSBzcGxpdHRpbmcgYW5kIHRyZWUgc2hha2luZycpO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ2FwaVJlc3BvbnNlVGltZSc6XG4gICAgICAgICAgICAgIHJlY29tbWVuZGF0aW9ucy5wdXNoKCdJbXBsZW1lbnQgY2FjaGluZyBhbmQgY29uc2lkZXIgQVBJIG9wdGltaXphdGlvbicpO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHJldHVybiB7XG4gICAgICBpc3N1ZXMsXG4gICAgICByZWNvbW1lbmRhdGlvbnMsXG4gICAgICBpc09wdGltYWw6IGlzc3Vlcy5sZW5ndGggPT09IDAsXG4gICAgICB0aHJlc2hvbGRzXG4gICAgfTtcbiAgfSwgW10pO1xuXG4gIHJldHVybiB7XG4gICAgZ2V0T3B0aW1pemF0aW9uUmVjb21tZW5kYXRpb25zLFxuICAgIHZhbGlkYXRlUGVyZm9ybWFuY2VNZXRyaWNzXG4gIH07XG59Il0sInZlcnNpb24iOjN9