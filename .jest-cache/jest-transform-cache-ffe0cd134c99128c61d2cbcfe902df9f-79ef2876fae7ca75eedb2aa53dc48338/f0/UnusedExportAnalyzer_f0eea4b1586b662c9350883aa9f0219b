b32f4451f27eca22812902b525fc5d7e
"use strict";
/**
 * Unused Export Analyzer
 * Perfect Codebase Campaign - Phase 3 Implementation
 *
 * Analyzes unused exports across the codebase and provides prioritization
 * for transformation into enterprise intelligence systems.
 */
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.UnusedExportAnalyzer = exports.TransformationComplexity = exports.FileCategory = exports.FilePriority = void 0;
const fs = __importStar(require("fs"));
const path = __importStar(require("path"));
const glob_1 = require("glob");
var FilePriority;
(function (FilePriority) {
    FilePriority["HIGH"] = "HIGH";
    FilePriority["MEDIUM"] = "MEDIUM";
    FilePriority["LOW"] = "LOW";
})(FilePriority || (exports.FilePriority = FilePriority = {}));
var FileCategory;
(function (FileCategory) {
    FileCategory["RECIPE"] = "RECIPE";
    FileCategory["CORE"] = "CORE";
    FileCategory["EXTERNAL"] = "EXTERNAL";
    FileCategory["TEST"] = "TEST";
    FileCategory["UTILITY"] = "UTILITY";
})(FileCategory || (exports.FileCategory = FileCategory = {}));
var TransformationComplexity;
(function (TransformationComplexity) {
    TransformationComplexity["SIMPLE"] = "SIMPLE";
    TransformationComplexity["MODERATE"] = "MODERATE";
    TransformationComplexity["COMPLEX"] = "COMPLEX";
    TransformationComplexity["VERY_COMPLEX"] = "VERY_COMPLEX";
})(TransformationComplexity || (exports.TransformationComplexity = TransformationComplexity = {}));
class UnusedExportAnalyzer {
    constructor(srcPath = 'src') {
        this.srcPath = srcPath;
        this.excludePatterns = [
            '**/node_modules/**',
            '**/*.test.ts',
            '**/*.test.tsx',
            '**/*.spec.ts',
            '**/*.spec.tsx',
            '**/dist/**',
            '**/build/**',
            '**/*.d.ts',
        ];
        this.priorityPatterns = {
            [FilePriority.HIGH]: [
                '**/data/recipes/**',
                '**/components/recipe/**',
                '**/services/recipe/**',
                '**/utils/recipe/**',
                '**/hooks/recipe/**',
            ],
            [FilePriority.MEDIUM]: [
                '**/components/**',
                '**/services/**',
                '**/utils/**',
                '**/hooks/**',
                '**/contexts/**',
                '**/providers/**',
            ],
            [FilePriority.LOW]: [
                '**/types/**',
                '**/constants/**',
                '**/config/**',
                '**/lib/**',
            ],
        };
    }
    /**
     * Analyze unused exports across the codebase
     */
    async analyzeUnusedExports() {
        console.log('🔍 Starting unused export analysis...');
        const files = await this.getAllSourceFiles();
        const fileAnalyses = [];
        for (const filePath of files) {
            try {
                const analysis = await this.analyzeFile(filePath);
                if (analysis.unusedExports.length > 0) {
                    fileAnalyses.push(analysis);
                }
            }
            catch (error) {
                console.warn(`⚠️  Failed to analyze ${filePath}:`, error);
            }
        }
        return this.categorizeAndSummarize(fileAnalyses);
    }
    /**
     * Get all source files for analysis
     */
    async getAllSourceFiles() {
        const patterns = [
            `${this.srcPath}/**/*.ts`,
            `${this.srcPath}/**/*.tsx`,
            `${this.srcPath}/**/*.js`,
            `${this.srcPath}/**/*.jsx`,
        ];
        const files = [];
        for (const pattern of patterns) {
            const matches = await (0, glob_1.glob)(pattern, {
                ignore: this.excludePatterns,
                absolute: true,
            });
            files.push(...matches);
        }
        return [...new Set(files)]; // Remove duplicates
    }
    /**
     * Analyze a single file for unused exports
     */
    async analyzeFile(filePath) {
        const content = await fs.promises.readFile(filePath, 'utf-8');
        const unusedExports = await this.findUnusedExports(filePath, content);
        const priority = this.determinePriority(filePath);
        const category = this.determineCategory(filePath);
        const safetyScore = this.calculateSafetyScore(filePath, content, unusedExports);
        const transformationCandidates = this.identifyTransformationCandidates(unusedExports);
        return {
            filePath,
            priority,
            unusedExports,
            safetyScore,
            transformationCandidates,
            category,
        };
    }
    /**
     * Find unused exports in a file
     */
    async findUnusedExports(filePath, content) {
        const exports = this.extractExports(content);
        const unusedExports = [];
        for (const exportInfo of exports) {
            const usageCount = await this.countUsages(exportInfo.exportName, filePath);
            if (usageCount === 0) {
                unusedExports.push({
                    ...exportInfo,
                    usageCount,
                    complexity: this.calculateComplexity(content, exportInfo),
                });
            }
        }
        return unusedExports;
    }
    /**
     * Extract export information from file content
     */
    extractExports(content) {
        const exports = [];
        const lines = content.split('\n');
        lines.forEach((line, index) => {
            // Named exports
            const namedExportMatch = line.match(/export\s+(?:const|let|var|function|class|interface|type|enum)\s+(\w+)/);
            if (namedExportMatch) {
                exports.push({
                    filePath: '',
                    exportName: namedExportMatch[1],
                    exportType: this.determineExportType(line),
                    lineNumber: index + 1,
                    isDefault: false,
                });
            }
            // Default exports
            const defaultExportMatch = line.match(/export\s+default\s+(?:(?:const|let|var|function|class)\s+)?(\w+)/);
            if (defaultExportMatch) {
                exports.push({
                    filePath: '',
                    exportName: defaultExportMatch[1] || 'default',
                    exportType: this.determineExportType(line),
                    lineNumber: index + 1,
                    isDefault: true,
                });
            }
            // Export destructuring
            const destructuringMatch = line.match(/export\s*\{\s*([^}]+)\s*\}/);
            if (destructuringMatch) {
                const exportNames = destructuringMatch[1]
                    .split(',')
                    .map(name => name.trim());
                exportNames.forEach(name => {
                    const cleanName = name.split(' as ')[0].trim();
                    exports.push({
                        filePath: '',
                        exportName: cleanName,
                        exportType: 'variable',
                        lineNumber: index + 1,
                        isDefault: false,
                    });
                });
            }
        });
        return exports;
    }
    /**
     * Determine export type from line content
     */
    determineExportType(line) {
        if (line.includes('function'))
            return 'function';
        if (line.includes('class'))
            return 'class';
        if (line.includes('interface'))
            return 'interface';
        if (line.includes('type'))
            return 'type';
        if (line.includes('const'))
            return 'const';
        return 'variable';
    }
    /**
     * Count usages of an export across the codebase
     */
    async countUsages(exportName, excludeFilePath) {
        const files = await this.getAllSourceFiles();
        let usageCount = 0;
        for (const filePath of files) {
            if (filePath === excludeFilePath)
                continue;
            try {
                const content = await fs.promises.readFile(filePath, 'utf-8');
                // Check for import statements
                const importRegex = new RegExp(`import.*\\b${exportName}\\b.*from`, 'g');
                const importMatches = content.match(importRegex) || [];
                usageCount += importMatches.length;
                // Check for direct usage (more complex analysis would be needed for complete accuracy)
                const usageRegex = new RegExp(`\\b${exportName}\\b`, 'g');
                const usageMatches = content.match(usageRegex) || [];
                // Subtract import matches to avoid double counting
                usageCount += Math.max(0, usageMatches.length - importMatches.length);
            }
            catch (error) {
                // Skip files that can't be read
                continue;
            }
        }
        return usageCount;
    }
    /**
     * Calculate complexity score for an export
     */
    calculateComplexity(content, exportInfo) {
        const lines = content.split('\n');
        const startLine = exportInfo.lineNumber - 1;
        // Simple heuristic: count lines of the export definition
        let complexity = 1;
        let braceCount = 0;
        let inExport = false;
        for (let i = startLine; i < lines.length; i++) {
            const line = lines[i];
            if (!inExport && line.includes('export')) {
                inExport = true;
            }
            if (inExport) {
                complexity++;
                braceCount += (line.match(/\{/g) || []).length;
                braceCount -= (line.match(/\}/g) || []).length;
                if (braceCount === 0 && line.includes('}')) {
                    break;
                }
                if (line.includes(';') && braceCount === 0) {
                    break;
                }
            }
        }
        return Math.min(complexity, 100); // Cap at 100
    }
    /**
     * Determine file priority based on path patterns
     */
    determinePriority(filePath) {
        const relativePath = path.relative(process.cwd(), filePath);
        for (const [priority, patterns] of Object.entries(this.priorityPatterns)) {
            for (const pattern of patterns) {
                if (this.matchesPattern(relativePath, pattern)) {
                    return priority;
                }
            }
        }
        return FilePriority.LOW;
    }
    /**
     * Determine file category
     */
    determineCategory(filePath) {
        const relativePath = path.relative(process.cwd(), filePath);
        if (relativePath.includes('/recipe'))
            return FileCategory.RECIPE;
        if (relativePath.includes('/test') ||
            relativePath.includes('.test.') ||
            relativePath.includes('.spec.')) {
            return FileCategory.TEST;
        }
        if (relativePath.includes('/components') ||
            relativePath.includes('/services') ||
            relativePath.includes('/hooks')) {
            return FileCategory.CORE;
        }
        if (relativePath.includes('/types') ||
            relativePath.includes('/constants') ||
            relativePath.includes('/config')) {
            return FileCategory.EXTERNAL;
        }
        return FileCategory.UTILITY;
    }
    /**
     * Calculate safety score for transformation
     */
    calculateSafetyScore(filePath, content, unusedExports) {
        let score = 100; // Start with perfect score
        // Reduce score based on file complexity
        const lines = content.split('\n').length;
        if (lines > 500)
            score -= 20;
        else if (lines > 200)
            score -= 10;
        // Reduce score based on number of unused exports
        if (unusedExports.length > 10)
            score -= 20;
        else if (unusedExports.length > 5)
            score -= 10;
        // Reduce score for critical files
        if (filePath.includes('/core/') || filePath.includes('/critical/')) {
            score -= 15;
        }
        // Increase score for test files (safer to transform)
        if (filePath.includes('/test/') || filePath.includes('.test.')) {
            score += 10;
        }
        return Math.max(0, Math.min(100, score));
    }
    /**
     * Identify transformation candidates
     */
    identifyTransformationCandidates(unusedExports) {
        return unusedExports.map(exportInfo => {
            const intelligenceSystemName = this.generateIntelligenceSystemName(exportInfo);
            const transformationComplexity = this.assessTransformationComplexity(exportInfo);
            const safetyScore = this.calculateTransformationSafetyScore(exportInfo);
            const estimatedBenefit = this.calculateEstimatedBenefit(exportInfo);
            return {
                export: exportInfo,
                intelligenceSystemName,
                transformationComplexity,
                safetyScore,
                estimatedBenefit,
            };
        });
    }
    /**
     * Generate intelligence system name
     */
    generateIntelligenceSystemName(exportInfo) {
        const baseName = exportInfo.exportName
            .replace(/([A-Z])/g, '_$1')
            .toUpperCase();
        return `${baseName}_INTELLIGENCE_SYSTEM`;
    }
    /**
     * Assess transformation complexity
     */
    assessTransformationComplexity(exportInfo) {
        if (exportInfo.complexity < 5)
            return TransformationComplexity.SIMPLE;
        if (exportInfo.complexity < 15)
            return TransformationComplexity.MODERATE;
        if (exportInfo.complexity < 30)
            return TransformationComplexity.COMPLEX;
        return TransformationComplexity.VERY_COMPLEX;
    }
    /**
     * Calculate transformation safety score
     */
    calculateTransformationSafetyScore(exportInfo) {
        let score = 90; // Start high for unused exports
        // Reduce for complex exports
        if (exportInfo.complexity > 20)
            score -= 20;
        else if (exportInfo.complexity > 10)
            score -= 10;
        // Increase for simple types
        if (exportInfo.exportType === 'interface' ||
            exportInfo.exportType === 'type') {
            score += 10;
        }
        return Math.max(0, Math.min(100, score));
    }
    /**
     * Calculate estimated benefit of transformation
     */
    calculateEstimatedBenefit(exportInfo) {
        let benefit = 50; // Base benefit
        // Higher benefit for functions and classes (more transformable)
        if (exportInfo.exportType === 'function' ||
            exportInfo.exportType === 'class') {
            benefit += 30;
        }
        // Higher benefit for complex exports (more intelligence potential)
        benefit += Math.min(20, exportInfo.complexity);
        return Math.min(100, benefit);
    }
    /**
     * Categorize and summarize analysis results
     */
    categorizeAndSummarize(fileAnalyses) {
        const highPriorityFiles = fileAnalyses.filter(f => f.priority === FilePriority.HIGH);
        const mediumPriorityFiles = fileAnalyses.filter(f => f.priority === FilePriority.MEDIUM);
        const lowPriorityFiles = fileAnalyses.filter(f => f.priority === FilePriority.LOW);
        const totalUnusedExports = fileAnalyses.reduce((sum, f) => sum + f.unusedExports.length, 0);
        const totalTransformationCandidates = fileAnalyses.reduce((sum, f) => sum + f.transformationCandidates.length, 0);
        const recipeFiles = fileAnalyses.filter(f => f.category === FileCategory.RECIPE).length;
        const coreFiles = fileAnalyses.filter(f => f.category === FileCategory.CORE).length;
        const externalFiles = fileAnalyses.filter(f => f.category === FileCategory.EXTERNAL).length;
        const averageSafetyScore = fileAnalyses.reduce((sum, f) => sum + f.safetyScore, 0) /
            fileAnalyses.length;
        return {
            totalFiles: fileAnalyses.length,
            totalUnusedExports,
            highPriorityFiles,
            mediumPriorityFiles,
            lowPriorityFiles,
            summary: {
                recipeFiles,
                coreFiles,
                externalFiles,
                totalTransformationCandidates,
                averageSafetyScore,
                estimatedIntelligenceSystems: totalTransformationCandidates,
            },
        };
    }
    /**
     * Check if path matches pattern
     */
    matchesPattern(filePath, pattern) {
        const regex = new RegExp(pattern.replace(/\*\*/g, '.*').replace(/\*/g, '[^/]*'));
        return regex.test(filePath);
    }
    /**
     * Generate detailed report
     */
    generateReport(analysis) {
        const report = [
            '# Unused Export Analysis Report',
            '',
            '## Summary',
            `- Total files analyzed: ${analysis.totalFiles}`,
            `- Total unused exports: ${analysis.totalUnusedExports}`,
            `- Recipe files: ${analysis.summary.recipeFiles}`,
            `- Core files: ${analysis.summary.coreFiles}`,
            `- External files: ${analysis.summary.externalFiles}`,
            `- Transformation candidates: ${analysis.summary.totalTransformationCandidates}`,
            `- Average safety score: ${analysis.summary.averageSafetyScore.toFixed(1)}`,
            '',
            '## Priority Breakdown',
            `- High priority files: ${analysis.highPriorityFiles.length}`,
            `- Medium priority files: ${analysis.mediumPriorityFiles.length}`,
            `- Low priority files: ${analysis.lowPriorityFiles.length}`,
            '',
            '## Top Transformation Candidates',
            '',
        ];
        // Add top candidates from each priority level
        const topCandidates = [
            ...analysis.highPriorityFiles.slice(0, 5),
            ...analysis.mediumPriorityFiles.slice(0, 5),
            ...analysis.lowPriorityFiles.slice(0, 5),
        ];
        topCandidates.forEach(file => {
            report.push(`### ${file.filePath}`);
            report.push(`- Priority: ${file.priority}`);
            report.push(`- Safety Score: ${file.safetyScore}`);
            report.push(`- Unused Exports: ${file.unusedExports.length}`);
            report.push(`- Transformation Candidates: ${file.transformationCandidates.length}`);
            report.push('');
        });
        return report.join('\n');
    }
}
exports.UnusedExportAnalyzer = UnusedExportAnalyzer;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL0dyZWdDYXN0cm8vRGVza3RvcC9XaGF0VG9FYXROZXh0L3NyYy9zZXJ2aWNlcy9jYW1wYWlnbi9VbnVzZWRFeHBvcnRBbmFseXplci50cyIsIm1hcHBpbmdzIjoiO0FBQUE7Ozs7OztHQU1HOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUVILHVDQUF5QjtBQUN6QiwyQ0FBNkI7QUFDN0IsK0JBQTRCO0FBcUQ1QixJQUFZLFlBSVg7QUFKRCxXQUFZLFlBQVk7SUFDdEIsNkJBQWEsQ0FBQTtJQUNiLGlDQUFpQixDQUFBO0lBQ2pCLDJCQUFXLENBQUE7QUFDYixDQUFDLEVBSlcsWUFBWSw0QkFBWixZQUFZLFFBSXZCO0FBRUQsSUFBWSxZQU1YO0FBTkQsV0FBWSxZQUFZO0lBQ3RCLGlDQUFpQixDQUFBO0lBQ2pCLDZCQUFhLENBQUE7SUFDYixxQ0FBcUIsQ0FBQTtJQUNyQiw2QkFBYSxDQUFBO0lBQ2IsbUNBQW1CLENBQUE7QUFDckIsQ0FBQyxFQU5XLFlBQVksNEJBQVosWUFBWSxRQU12QjtBQUVELElBQVksd0JBS1g7QUFMRCxXQUFZLHdCQUF3QjtJQUNsQyw2Q0FBaUIsQ0FBQTtJQUNqQixpREFBcUIsQ0FBQTtJQUNyQiwrQ0FBbUIsQ0FBQTtJQUNuQix5REFBNkIsQ0FBQTtBQUMvQixDQUFDLEVBTFcsd0JBQXdCLHdDQUF4Qix3QkFBd0IsUUFLbkM7QUFFRCxNQUFhLG9CQUFvQjtJQUsvQixZQUFZLFVBQWtCLEtBQUs7UUFDakMsSUFBSSxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUM7UUFDdkIsSUFBSSxDQUFDLGVBQWUsR0FBRztZQUNyQixvQkFBb0I7WUFDcEIsY0FBYztZQUNkLGVBQWU7WUFDZixjQUFjO1lBQ2QsZUFBZTtZQUNmLFlBQVk7WUFDWixhQUFhO1lBQ2IsV0FBVztTQUNaLENBQUM7UUFFRixJQUFJLENBQUMsZ0JBQWdCLEdBQUc7WUFDdEIsQ0FBQyxZQUFZLENBQUMsSUFBSSxDQUFDLEVBQUU7Z0JBQ25CLG9CQUFvQjtnQkFDcEIseUJBQXlCO2dCQUN6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QzNDLEdBQUcsUUFBUSxDQUFDLGdCQUFnQixDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDO1NBQ3pDLENBQUM7UUFFRixhQUFhLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxFQUFFO1lBQzNCLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxJQUFJLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQztZQUNwQyxNQUFNLENBQUMsSUFBSSxDQUFDLGVBQWUsSUFBSSxDQUFDLFFBQVEsRUFBRSxDQUFDLENBQUM7WUFDNUMsTUFBTSxDQUFDLElBQUksQ0FBQyxtQkFBbUIsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDLENBQUM7WUFDbkQsTUFBTSxDQUFDLElBQUksQ0FBQyxxQkFBcUIsSUFBSSxDQUFDLGFBQWEsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxDQUFDO1lBQzlELE1BQU0sQ0FBQyxJQUFJLENBQ1QsZ0NBQWdDLElBQUksQ0FBQyx3QkFBd0IsQ0FBQyxNQUFNLEVBQUUsQ0FDdkUsQ0FBQztZQUNGLE1BQU0sQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDbEIsQ0FBQyxDQUFDLENBQUM7UUFFSCxPQUFPLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDM0IsQ0FBQztDQUNGO0FBempCRCxvREF5akJDIiwibmFtZXMiOltdLCJzb3VyY2VzIjpbIi9Vc2Vycy9HcmVnQ2FzdHJvL0Rlc2t0b3AvV2hhdFRvRWF0TmV4dC9zcmMvc2VydmljZXMvY2FtcGFpZ24vVW51c2VkRXhwb3J0QW5hbHl6ZXIudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBVbnVzZWQgRXhwb3J0IEFuYWx5emVyXG4gKiBQZXJmZWN0IENvZGViYXNlIENhbXBhaWduIC0gUGhhc2UgMyBJbXBsZW1lbnRhdGlvblxuICpcbiAqIEFuYWx5emVzIHVudXNlZCBleHBvcnRzIGFjcm9zcyB0aGUgY29kZWJhc2UgYW5kIHByb3ZpZGVzIHByaW9yaXRpemF0aW9uXG4gKiBmb3IgdHJhbnNmb3JtYXRpb24gaW50byBlbnRlcnByaXNlIGludGVsbGlnZW5jZSBzeXN0ZW1zLlxuICovXG5cbmltcG9ydCAqIGFzIGZzIGZyb20gJ2ZzJztcbmltcG9ydCAqIGFzIHBhdGggZnJvbSAncGF0aCc7XG5pbXBvcnQgeyBnbG9iIH0gZnJvbSAnZ2xvYic7XG5cbmV4cG9ydCBpbnRlcmZhY2UgVW51c2VkRXhwb3J0IHtcbiAgZmlsZVBhdGg6IHN0cmluZztcbiAgZXhwb3J0TmFtZTogc3RyaW5nO1xuICBleHBvcnRUeXBlOlxuICAgIHwgJ2Z1bmN0aW9uJ1xuICAgIHwgJ2NsYXNzJ1xuICAgIHwgJ2ludGVyZmFjZSdcbiAgICB8ICd0eXBlJ1xuICAgIHwgJ2NvbnN0J1xuICAgIHwgJ3ZhcmlhYmxlJztcbiAgbGluZU51bWJlcjogbnVtYmVyO1xuICBpc0RlZmF1bHQ6IGJvb2xlYW47XG4gIGNvbXBsZXhpdHk6IG51bWJlcjtcbiAgdXNhZ2VDb3VudDogbnVtYmVyO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEZpbGVBbmFseXNpcyB7XG4gIGZpbGVQYXRoOiBzdHJpbmc7XG4gIHByaW9yaXR5OiBGaWxlUHJpb3JpdHk7XG4gIHVudXNlZEV4cG9ydHM6IFVudXNlZEV4cG9ydFtdO1xuICBzYWZldHlTY29yZTogbnVtYmVyO1xuICB0cmFuc2Zvcm1hdGlvbkNhbmRpZGF0ZXM6IFRyYW5zZm9ybWF0aW9uQ2FuZGlkYXRlW107XG4gIGNhdGVnb3J5OiBGaWxlQ2F0ZWdvcnk7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVHJhbnNmb3JtYXRpb25DYW5kaWRhdGUge1xuICBleHBvcnQ6IFVudXNlZEV4cG9ydDtcbiAgaW50ZWxsaWdlbmNlU3lzdGVtTmFtZTogc3RyaW5nO1xuICB0cmFuc2Zvcm1hdGlvbkNvbXBsZXhpdHk6IFRyYW5zZm9ybWF0aW9uQ29tcGxleGl0eTtcbiAgc2FmZXR5U2NvcmU6IG51bWJlcjtcbiAgZXN0aW1hdGVkQmVuZWZpdDogbnVtYmVyO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEFuYWx5c2lzUmVzdWx0IHtcbiAgdG90YWxGaWxlczogbnVtYmVyO1xuICB0b3RhbFVudXNlZEV4cG9ydHM6IG51bWJlcjtcbiAgaGlnaFByaW9yaXR5RmlsZXM6IEZpbGVBbmFseXNpc1tdO1xuICBtZWRpdW1Qcmlvcml0eUZpbGVzOiBGaWxlQW5hbHlzaXNbXTtcbiAgbG93UHJpb3JpdHlGaWxlczogRmlsZUFuYWx5c2lzW107XG4gIHN1bW1hcnk6IEFuYWx5c2lzU3VtbWFyeTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBBbmFseXNpc1N1bW1hcnkge1xuICByZWNpcGVGaWxlczogbnVtYmVyO1xuICBjb3JlRmlsZXM6IG51bWJlcjtcbiAgZXh0ZXJuYWxGaWxlczogbnVtYmVyO1xuICB0b3RhbFRyYW5zZm9ybWF0aW9uQ2FuZGlkYXRlczogbnVtYmVyO1xuICBhdmVyYWdlU2FmZXR5U2NvcmU6IG51bWJlcjtcbiAgZXN0aW1hdGVkSW50ZWxsaWdlbmNlU3lzdGVtczogbnVtYmVyO1xufVxuXG5leHBvcnQgZW51bSBGaWxlUHJpb3JpdHkge1xuICBISUdIID0gJ0hJR0gnLCAvLyBSZWNpcGUgYnVpbGRpbmcgZmlsZXNcbiAgTUVESVVNID0gJ01FRElVTScsIC8vIENvcmUgc3lzdGVtIGZpbGVzXG4gIExPVyA9ICdMT1cnLCAvLyBFeHRlcm5hbC90ZXN0IGZpbGVzXG59XG5cbmV4cG9ydCBlbnVtIEZpbGVDYXRlZ29yeSB7XG4gIFJFQ0lQRSA9ICdSRUNJUEUnLFxuICBDT1JFID0gJ0NPUkUnLFxuICBFWFRFUk5BTCA9ICdFWFRFUk5BTCcsXG4gIFRFU1QgPSAnVEVTVCcsXG4gIFVUSUxJVFkgPSAnVVRJTElUWScsXG59XG5cbmV4cG9ydCBlbnVtIFRyYW5zZm9ybWF0aW9uQ29tcGxleGl0eSB7XG4gIFNJTVBMRSA9ICdTSU1QTEUnLFxuICBNT0RFUkFURSA9ICdNT0RFUkFURScsXG4gIENPTVBMRVggPSAnQ09NUExFWCcsXG4gIFZFUllfQ09NUExFWCA9ICdWRVJZX0NPTVBMRVgnLFxufVxuXG5leHBvcnQgY2xhc3MgVW51c2VkRXhwb3J0QW5hbHl6ZXIge1xuICBwcml2YXRlIHJlYWRvbmx5IHNyY1BhdGg6IHN0cmluZztcbiAgcHJpdmF0ZSByZWFkb25seSBleGNsdWRlUGF0dGVybnM6IHN0cmluZ1tdO1xuICBwcml2YXRlIHJlYWRvbmx5IHByaW9yaXR5UGF0dGVybnM6IFJlY29yZDxGaWxlUHJpb3JpdHksIHN0cmluZ1tdPjtcblxuICBjb25zdHJ1Y3RvcihzcmNQYXRoOiBzdHJpbmcgPSAnc3JjJykge1xuICAgIHRoaXMuc3JjUGF0aCA9IHNyY1BhdGg7XG4gICAgdGhpcy5leGNsdWRlUGF0dGVybnMgPSBbXG4gICAgICAnKiovbm9kZV9tb2R1bGVzLyoqJyxcbiAgICAgICcqKi8qLnRlc3QudHMnLFxuICAgICAgJyoqLyoudGVzdC50c3gnLFxuICAgICAgJyoqLyouc3BlYy50cycsXG4gICAgICAnKiovKi5zcGVjLnRzeCcsXG4gICAgICAnKiovZGlzdC8qKicsXG4gICAgICAnKiovYnVpbGQvKionLFxuICAgICAgJyoqLyouZC50cycsXG4gICAgXTtcblxuICAgIHRoaXMucHJpb3JpdHlQYXR0ZXJucyA9IHtcbiAgICAgIFtGaWxlUHJpb3JpdHkuSElHSF06IFtcbiAgICAgICAgJyoqL2RhdGEvcmVjaXBlcy8qKicsXG4gICAgICAgICcqKi9jb21wb25lbnRzL3JlY2lwZS8qKicsXG4gICAgICAgICcqKi9zZXJ2aWNlcy9yZWNpcGUvKionLFxuICAgICAgICAnKiovdXRpbHMvcmVjaXBlLyoqJyxcbiAgICAgICAgJyoqL2hvb2tzL3JlY2lwZS8qKicsXG4gICAgICBdLFxuICAgICAgW0ZpbGVQcmlvcml0eS5NRURJVU1dOiBbXG4gICAgICAgICcqKi9jb21wb25lbnRzLyoqJyxcbiAgICAgICAgJyoqL3NlcnZpY2VzLyoqJyxcbiAgICAgICAgJyoqL3V0aWxzLyoqJyxcbiAgICAgICAgJyoqL2hvb2tzLyoqJyxcbiAgICAgICAgJyoqL2NvbnRleHRzLyoqJyxcbiAgICAgICAgJyoqL3Byb3ZpZGVycy8qKicsXG4gICAgICBdLFxuICAgICAgW0ZpbGVQcmlvcml0eS5MT1ddOiBbXG4gICAgICAgICcqKi90eXBlcy8qKicsXG4gICAgICAgICcqKi9jb25zdGFudHMvKionLFxuICAgICAgICAnKiovY29uZmlnLyoqJyxcbiAgICAgICAgJyoqL2xpYi8qKicsXG4gICAgICBdLFxuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogQW5hbHl6ZSB1bnVzZWQgZXhwb3J0cyBhY3Jvc3MgdGhlIGNvZGViYXNlXG4gICAqL1xuICBhc3luYyBhbmFseXplVW51c2VkRXhwb3J0cygpOiBQcm9taXNlPEFuYWx5c2lzUmVzdWx0PiB7XG4gICAgY29uc29sZS5sb2coJ/CflI0gU3RhcnRpbmcgdW51c2VkIGV4cG9ydCBhbmFseXNpcy4uLicpO1xuXG4gICAgY29uc3QgZmlsZXMgPSBhd2FpdCB0aGlzLmdldEFsbFNvdXJjZUZpbGVzKCk7XG4gICAgY29uc3QgZmlsZUFuYWx5c2VzOiBGaWxlQW5hbHlzaXNbXSA9IFtdO1xuXG4gICAgZm9yIChjb25zdCBmaWxlUGF0aCBvZiBmaWxlcykge1xuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgYW5hbHlzaXMgPSBhd2FpdCB0aGlzLmFuYWx5emVGaWxlKGZpbGVQYXRoKTtcbiAgICAgICAgaWYgKGFuYWx5c2lzLnVudXNlZEV4cG9ydHMubGVuZ3RoID4gMCkge1xuICAgICAgICAgIGZpbGVBbmFseXNlcy5wdXNoKGFuYWx5c2lzKTtcbiAgICAgICAgfVxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS53YXJuKGDimqDvuI8gIEZhaWxlZCB0byBhbmFseXplICR7ZmlsZVBhdGh9OmAsIGVycm9yKTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5jYXRlZ29yaXplQW5kU3VtbWFyaXplKGZpbGVBbmFseXNlcyk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGFsbCBzb3VyY2UgZmlsZXMgZm9yIGFuYWx5c2lzXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGdldEFsbFNvdXJjZUZpbGVzKCk6IFByb21pc2U8c3RyaW5nW10+IHtcbiAgICBjb25zdCBwYXR0ZXJucyA9IFtcbiAgICAgIGAke3RoaXMuc3JjUGF0aH0vKiovKi50c2AsXG4gICAgICBgJHt0aGlzLnNyY1BhdGh9LyoqLyoudHN4YCxcbiAgICAgIGAke3RoaXMuc3JjUGF0aH0vKiovKi5qc2AsXG4gICAgICBgJHt0aGlzLnNyY1BhdGh9LyoqLyouanN4YCxcbiAgICBdO1xuXG4gICAgY29uc3QgZmlsZXM6IHN0cmluZ1tdID0gW107XG4gICAgZm9yIChjb25zdCBwYXR0ZXJuIG9mIHBhdHRlcm5zKSB7XG4gICAgICBjb25zdCBtYXRjaGVzID0gYXdhaXQgZ2xvYihwYXR0ZXJuLCB7XG4gICAgICAgIGlnbm9yZTogdGhpcy5leGNsdWRlUGF0dGVybnMsXG4gICAgICAgIGFic29sdXRlOiB0cnVlLFxuICAgICAgfSk7XG4gICAgICBmaWxlcy5wdXNoKC4uLm1hdGNoZXMpO1xuICAgIH1cblxuICAgIHJldHVybiBbLi4ubmV3IFNldChmaWxlcyldOyAvLyBSZW1vdmUgZHVwbGljYXRlc1xuICB9XG5cbiAgLyoqXG4gICAqIEFuYWx5emUgYSBzaW5nbGUgZmlsZSBmb3IgdW51c2VkIGV4cG9ydHNcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgYW5hbHl6ZUZpbGUoZmlsZVBhdGg6IHN0cmluZyk6IFByb21pc2U8RmlsZUFuYWx5c2lzPiB7XG4gICAgY29uc3QgY29udGVudCA9IGF3YWl0IGZzLnByb21pc2VzLnJlYWRGaWxlKGZpbGVQYXRoLCAndXRmLTgnKTtcbiAgICBjb25zdCB1bnVzZWRFeHBvcnRzID0gYXdhaXQgdGhpcy5maW5kVW51c2VkRXhwb3J0cyhmaWxlUGF0aCwgY29udGVudCk7XG4gICAgY29uc3QgcHJpb3JpdHkgPSB0aGlzLmRldGVybWluZVByaW9yaXR5KGZpbGVQYXRoKTtcbiAgICBjb25zdCBjYXRlZ29yeSA9IHRoaXMuZGV0ZXJtaW5lQ2F0ZWdvcnkoZmlsZVBhdGgpO1xuICAgIGNvbnN0IHNhZmV0eVNjb3JlID0gdGhpcy5jYWxjdWxhdGVTYWZldHlTY29yZShcbiAgICAgIGZpbGVQYXRoLFxuICAgICAgY29udGVudCxcbiAgICAgIHVudXNlZEV4cG9ydHNcbiAgICApO1xuICAgIGNvbnN0IHRyYW5zZm9ybWF0aW9uQ2FuZGlkYXRlcyA9XG4gICAgICB0aGlzLmlkZW50aWZ5VHJhbnNmb3JtYXRpb25DYW5kaWRhdGVzKHVudXNlZEV4cG9ydHMpO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIGZpbGVQYXRoLFxuICAgICAgcHJpb3JpdHksXG4gICAgICB1bnVzZWRFeHBvcnRzLFxuICAgICAgc2FmZXR5U2NvcmUsXG4gICAgICB0cmFuc2Zvcm1hdGlvbkNhbmRpZGF0ZXMsXG4gICAgICBjYXRlZ29yeSxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIEZpbmQgdW51c2VkIGV4cG9ydHMgaW4gYSBmaWxlXG4gICAqL1xuICBwcml2YXRlIGFzeW5jIGZpbmRVbnVzZWRFeHBvcnRzKFxuICAgIGZpbGVQYXRoOiBzdHJpbmcsXG4gICAgY29udGVudDogc3RyaW5nXG4gICk6IFByb21pc2U8VW51c2VkRXhwb3J0W10+IHtcbiAgICBjb25zdCBleHBvcnRzID0gdGhpcy5leHRyYWN0RXhwb3J0cyhjb250ZW50KTtcbiAgICBjb25zdCB1bnVzZWRFeHBvcnRzOiBVbnVzZWRFeHBvcnRbXSA9IFtdO1xuXG4gICAgZm9yIChjb25zdCBleHBvcnRJbmZvIG9mIGV4cG9ydHMpIHtcbiAgICAgIGNvbnN0IHVzYWdlQ291bnQgPSBhd2FpdCB0aGlzLmNvdW50VXNhZ2VzKFxuICAgICAgICBleHBvcnRJbmZvLmV4cG9ydE5hbWUsXG4gICAgICAgIGZpbGVQYXRoXG4gICAgICApO1xuICAgICAgaWYgKHVzYWdlQ291bnQgPT09IDApIHtcbiAgICAgICAgdW51c2VkRXhwb3J0cy5wdXNoKHtcbiAgICAgICAgICAuLi5leHBvcnRJbmZvLFxuICAgICAgICAgIHVzYWdlQ291bnQsXG4gICAgICAgICAgY29tcGxleGl0eTogdGhpcy5jYWxjdWxhdGVDb21wbGV4aXR5KGNvbnRlbnQsIGV4cG9ydEluZm8pLFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gdW51c2VkRXhwb3J0cztcbiAgfVxuXG4gIC8qKlxuICAgKiBFeHRyYWN0IGV4cG9ydCBpbmZvcm1hdGlvbiBmcm9tIGZpbGUgY29udGVudFxuICAgKi9cbiAgcHJpdmF0ZSBleHRyYWN0RXhwb3J0cyhcbiAgICBjb250ZW50OiBzdHJpbmdcbiAgKTogT21pdDxVbnVzZWRFeHBvcnQsICd1c2FnZUNvdW50JyB8ICdjb21wbGV4aXR5Jz5bXSB7XG4gICAgY29uc3QgZXhwb3J0czogT21pdDxVbnVzZWRFeHBvcnQsICd1c2FnZUNvdW50JyB8ICdjb21wbGV4aXR5Jz5bXSA9IFtdO1xuICAgIGNvbnN0IGxpbmVzID0gY29udGVudC5zcGxpdCgnXFxuJyk7XG5cbiAgICBsaW5lcy5mb3JFYWNoKChsaW5lLCBpbmRleCkgPT4ge1xuICAgICAgLy8gTmFtZWQgZXhwb3J0c1xuICAgICAgY29uc3QgbmFtZWRFeHBvcnRNYXRjaCA9IGxpbmUubWF0Y2goXG4gICAgICAgIC9leHBvcnRcXHMrKD86Y29uc3R8bGV0fHZhcnxmdW5jdGlvbnxjbGFzc3xpbnRlcmZhY2V8dHlwZXxlbnVtKVxccysoXFx3KykvXG4gICAgICApO1xuICAgICAgaWYgKG5hbWVkRXhwb3J0TWF0Y2gpIHtcbiAgICAgICAgZXhwb3J0cy5wdXNoKHtcbiAgICAgICAgICBmaWxlUGF0aDogJycsXG4gICAgICAgICAgZXhwb3J0TmFtZTogbmFtZWRFeHBvcnRNYXRjaFsxXSxcbiAgICAgICAgICBleHBvcnRUeXBlOiB0aGlzLmRldGVybWluZUV4cG9ydFR5cGUobGluZSksXG4gICAgICAgICAgbGluZU51bWJlcjogaW5kZXggKyAxLFxuICAgICAgICAgIGlzRGVmYXVsdDogZmFsc2UsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBEZWZhdWx0IGV4cG9ydHNcbiAgICAgIGNvbnN0IGRlZmF1bHRFeHBvcnRNYXRjaCA9IGxpbmUubWF0Y2goXG4gICAgICAgIC9leHBvcnRcXHMrZGVmYXVsdFxccysoPzooPzpjb25zdHxsZXR8dmFyfGZ1bmN0aW9ufGNsYXNzKVxccyspPyhcXHcrKS9cbiAgICAgICk7XG4gICAgICBpZiAoZGVmYXVsdEV4cG9ydE1hdGNoKSB7XG4gICAgICAgIGV4cG9ydHMucHVzaCh7XG4gICAgICAgICAgZmlsZVBhdGg6ICcnLFxuICAgICAgICAgIGV4cG9ydE5hbWU6IGRlZmF1bHRFeHBvcnRNYXRjaFsxXSB8fCAnZGVmYXVsdCcsXG4gICAgICAgICAgZXhwb3J0VHlwZTogdGhpcy5kZXRlcm1pbmVFeHBvcnRUeXBlKGxpbmUpLFxuICAgICAgICAgIGxpbmVOdW1iZXI6IGluZGV4ICsgMSxcbiAgICAgICAgICBpc0RlZmF1bHQ6IHRydWUsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBFeHBvcnQgZGVzdHJ1Y3R1cmluZ1xuICAgICAgY29uc3QgZGVzdHJ1Y3R1cmluZ01hdGNoID0gbGluZS5tYXRjaCgvZXhwb3J0XFxzKlxce1xccyooW159XSspXFxzKlxcfS8pO1xuICAgICAgaWYgKGRlc3RydWN0dXJpbmdNYXRjaCkge1xuICAgICAgICBjb25zdCBleHBvcnROYW1lcyA9IGRlc3RydWN0dXJpbmdNYXRjaFsxXVxuICAgICAgICAgIC5zcGxpdCgnLCcpXG4gICAgICAgICAgLm1hcChuYW1lID0+IG5hbWUudHJpbSgpKTtcbiAgICAgICAgZXhwb3J0TmFtZXMuZm9yRWFjaChuYW1lID0+IHtcbiAgICAgICAgICBjb25zdCBjbGVhbk5hbWUgPSBuYW1lLnNwbGl0KCcgYXMgJylbMF0udHJpbSgpO1xuICAgICAgICAgIGV4cG9ydHMucHVzaCh7XG4gICAgICAgICAgICBmaWxlUGF0aDogJycsXG4gICAgICAgICAgICBleHBvcnROYW1lOiBjbGVhbk5hbWUsXG4gICAgICAgICAgICBleHBvcnRUeXBlOiAndmFyaWFibGUnLFxuICAgICAgICAgICAgbGluZU51bWJlcjogaW5kZXggKyAxLFxuICAgICAgICAgICAgaXNEZWZhdWx0OiBmYWxzZSxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICByZXR1cm4gZXhwb3J0cztcbiAgfVxuXG4gIC8qKlxuICAgKiBEZXRlcm1pbmUgZXhwb3J0IHR5cGUgZnJvbSBsaW5lIGNvbnRlbnRcbiAgICovXG4gIHByaXZhdGUgZGV0ZXJtaW5lRXhwb3J0VHlwZShsaW5lOiBzdHJpbmcpOiBVbnVzZWRFeHBvcnRbJ2V4cG9ydFR5cGUnXSB7XG4gICAgaWYgKGxpbmUuaW5jbHVkZXMoJ2Z1bmN0aW9uJykpIHJldHVybiAnZnVuY3Rpb24nO1xuICAgIGlmIChsaW5lLmluY2x1ZGVzKCdjbGFzcycpKSByZXR1cm4gJ2NsYXNzJztcbiAgICBpZiAobGluZS5pbmNsdWRlcygnaW50ZXJmYWNlJykpIHJldHVybiAnaW50ZXJmYWNlJztcbiAgICBpZiAobGluZS5pbmNsdWRlcygndHlwZScpKSByZXR1cm4gJ3R5cGUnO1xuICAgIGlmIChsaW5lLmluY2x1ZGVzKCdjb25zdCcpKSByZXR1cm4gJ2NvbnN0JztcbiAgICByZXR1cm4gJ3ZhcmlhYmxlJztcbiAgfVxuXG4gIC8qKlxuICAgKiBDb3VudCB1c2FnZXMgb2YgYW4gZXhwb3J0IGFjcm9zcyB0aGUgY29kZWJhc2VcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgY291bnRVc2FnZXMoXG4gICAgZXhwb3J0TmFtZTogc3RyaW5nLFxuICAgIGV4Y2x1ZGVGaWxlUGF0aDogc3RyaW5nXG4gICk6IFByb21pc2U8bnVtYmVyPiB7XG4gICAgY29uc3QgZmlsZXMgPSBhd2FpdCB0aGlzLmdldEFsbFNvdXJjZUZpbGVzKCk7XG4gICAgbGV0IHVzYWdlQ291bnQgPSAwO1xuXG4gICAgZm9yIChjb25zdCBmaWxlUGF0aCBvZiBmaWxlcykge1xuICAgICAgaWYgKGZpbGVQYXRoID09PSBleGNsdWRlRmlsZVBhdGgpIGNvbnRpbnVlO1xuXG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCBjb250ZW50ID0gYXdhaXQgZnMucHJvbWlzZXMucmVhZEZpbGUoZmlsZVBhdGgsICd1dGYtOCcpO1xuXG4gICAgICAgIC8vIENoZWNrIGZvciBpbXBvcnQgc3RhdGVtZW50c1xuICAgICAgICBjb25zdCBpbXBvcnRSZWdleCA9IG5ldyBSZWdFeHAoXG4gICAgICAgICAgYGltcG9ydC4qXFxcXGIke2V4cG9ydE5hbWV9XFxcXGIuKmZyb21gLFxuICAgICAgICAgICdnJ1xuICAgICAgICApO1xuICAgICAgICBjb25zdCBpbXBvcnRNYXRjaGVzID0gY29udGVudC5tYXRjaChpbXBvcnRSZWdleCkgfHwgW107XG4gICAgICAgIHVzYWdlQ291bnQgKz0gaW1wb3J0TWF0Y2hlcy5sZW5ndGg7XG5cbiAgICAgICAgLy8gQ2hlY2sgZm9yIGRpcmVjdCB1c2FnZSAobW9yZSBjb21wbGV4IGFuYWx5c2lzIHdvdWxkIGJlIG5lZWRlZCBmb3IgY29tcGxldGUgYWNjdXJhY3kpXG4gICAgICAgIGNvbnN0IHVzYWdlUmVnZXggPSBuZXcgUmVnRXhwKGBcXFxcYiR7ZXhwb3J0TmFtZX1cXFxcYmAsICdnJyk7XG4gICAgICAgIGNvbnN0IHVzYWdlTWF0Y2hlcyA9IGNvbnRlbnQubWF0Y2godXNhZ2VSZWdleCkgfHwgW107XG4gICAgICAgIC8vIFN1YnRyYWN0IGltcG9ydCBtYXRjaGVzIHRvIGF2b2lkIGRvdWJsZSBjb3VudGluZ1xuICAgICAgICB1c2FnZUNvdW50ICs9IE1hdGgubWF4KDAsIHVzYWdlTWF0Y2hlcy5sZW5ndGggLSBpbXBvcnRNYXRjaGVzLmxlbmd0aCk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAvLyBTa2lwIGZpbGVzIHRoYXQgY2FuJ3QgYmUgcmVhZFxuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gdXNhZ2VDb3VudDtcbiAgfVxuXG4gIC8qKlxuICAgKiBDYWxjdWxhdGUgY29tcGxleGl0eSBzY29yZSBmb3IgYW4gZXhwb3J0XG4gICAqL1xuICBwcml2YXRlIGNhbGN1bGF0ZUNvbXBsZXhpdHkoXG4gICAgY29udGVudDogc3RyaW5nLFxuICAgIGV4cG9ydEluZm86IE9taXQ8VW51c2VkRXhwb3J0LCAndXNhZ2VDb3VudCcgfCAnY29tcGxleGl0eSc+XG4gICk6IG51bWJlciB7XG4gICAgY29uc3QgbGluZXMgPSBjb250ZW50LnNwbGl0KCdcXG4nKTtcbiAgICBjb25zdCBzdGFydExpbmUgPSBleHBvcnRJbmZvLmxpbmVOdW1iZXIgLSAxO1xuXG4gICAgLy8gU2ltcGxlIGhldXJpc3RpYzogY291bnQgbGluZXMgb2YgdGhlIGV4cG9ydCBkZWZpbml0aW9uXG4gICAgbGV0IGNvbXBsZXhpdHkgPSAxO1xuICAgIGxldCBicmFjZUNvdW50ID0gMDtcbiAgICBsZXQgaW5FeHBvcnQgPSBmYWxzZTtcblxuICAgIGZvciAobGV0IGkgPSBzdGFydExpbmU7IGkgPCBsaW5lcy5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3QgbGluZSA9IGxpbmVzW2ldO1xuXG4gICAgICBpZiAoIWluRXhwb3J0ICYmIGxpbmUuaW5jbHVkZXMoJ2V4cG9ydCcpKSB7XG4gICAgICAgIGluRXhwb3J0ID0gdHJ1ZTtcbiAgICAgIH1cblxuICAgICAgaWYgKGluRXhwb3J0KSB7XG4gICAgICAgIGNvbXBsZXhpdHkrKztcbiAgICAgICAgYnJhY2VDb3VudCArPSAobGluZS5tYXRjaCgvXFx7L2cpIHx8IFtdKS5sZW5ndGg7XG4gICAgICAgIGJyYWNlQ291bnQgLT0gKGxpbmUubWF0Y2goL1xcfS9nKSB8fCBbXSkubGVuZ3RoO1xuXG4gICAgICAgIGlmIChicmFjZUNvdW50ID09PSAwICYmIGxpbmUuaW5jbHVkZXMoJ30nKSkge1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGxpbmUuaW5jbHVkZXMoJzsnKSAmJiBicmFjZUNvdW50ID09PSAwKSB7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gTWF0aC5taW4oY29tcGxleGl0eSwgMTAwKTsgLy8gQ2FwIGF0IDEwMFxuICB9XG5cbiAgLyoqXG4gICAqIERldGVybWluZSBmaWxlIHByaW9yaXR5IGJhc2VkIG9uIHBhdGggcGF0dGVybnNcbiAgICovXG4gIHByaXZhdGUgZGV0ZXJtaW5lUHJpb3JpdHkoZmlsZVBhdGg6IHN0cmluZyk6IEZpbGVQcmlvcml0eSB7XG4gICAgY29uc3QgcmVsYXRpdmVQYXRoID0gcGF0aC5yZWxhdGl2ZShwcm9jZXNzLmN3ZCgpLCBmaWxlUGF0aCk7XG5cbiAgICBmb3IgKGNvbnN0IFtwcmlvcml0eSwgcGF0dGVybnNdIG9mIE9iamVjdC5lbnRyaWVzKHRoaXMucHJpb3JpdHlQYXR0ZXJucykpIHtcbiAgICAgIGZvciAoY29uc3QgcGF0dGVybiBvZiBwYXR0ZXJucykge1xuICAgICAgICBpZiAodGhpcy5tYXRjaGVzUGF0dGVybihyZWxhdGl2ZVBhdGgsIHBhdHRlcm4pKSB7XG4gICAgICAgICAgcmV0dXJuIHByaW9yaXR5IGFzIEZpbGVQcmlvcml0eTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBGaWxlUHJpb3JpdHkuTE9XO1xuICB9XG5cbiAgLyoqXG4gICAqIERldGVybWluZSBmaWxlIGNhdGVnb3J5XG4gICAqL1xuICBwcml2YXRlIGRldGVybWluZUNhdGVnb3J5KGZpbGVQYXRoOiBzdHJpbmcpOiBGaWxlQ2F0ZWdvcnkge1xuICAgIGNvbnN0IHJlbGF0aXZlUGF0aCA9IHBhdGgucmVsYXRpdmUocHJvY2Vzcy5jd2QoKSwgZmlsZVBhdGgpO1xuXG4gICAgaWYgKHJlbGF0aXZlUGF0aC5pbmNsdWRlcygnL3JlY2lwZScpKSByZXR1cm4gRmlsZUNhdGVnb3J5LlJFQ0lQRTtcbiAgICBpZiAoXG4gICAgICByZWxhdGl2ZVBhdGguaW5jbHVkZXMoJy90ZXN0JykgfHxcbiAgICAgIHJlbGF0aXZlUGF0aC5pbmNsdWRlcygnLnRlc3QuJykgfHxcbiAgICAgIHJlbGF0aXZlUGF0aC5pbmNsdWRlcygnLnNwZWMuJylcbiAgICApIHtcbiAgICAgIHJldHVybiBGaWxlQ2F0ZWdvcnkuVEVTVDtcbiAgICB9XG4gICAgaWYgKFxuICAgICAgcmVsYXRpdmVQYXRoLmluY2x1ZGVzKCcvY29tcG9uZW50cycpIHx8XG4gICAgICByZWxhdGl2ZVBhdGguaW5jbHVkZXMoJy9zZXJ2aWNlcycpIHx8XG4gICAgICByZWxhdGl2ZVBhdGguaW5jbHVkZXMoJy9ob29rcycpXG4gICAgKSB7XG4gICAgICByZXR1cm4gRmlsZUNhdGVnb3J5LkNPUkU7XG4gICAgfVxuICAgIGlmIChcbiAgICAgIHJlbGF0aXZlUGF0aC5pbmNsdWRlcygnL3R5cGVzJykgfHxcbiAgICAgIHJlbGF0aXZlUGF0aC5pbmNsdWRlcygnL2NvbnN0YW50cycpIHx8XG4gICAgICByZWxhdGl2ZVBhdGguaW5jbHVkZXMoJy9jb25maWcnKVxuICAgICkge1xuICAgICAgcmV0dXJuIEZpbGVDYXRlZ29yeS5FWFRFUk5BTDtcbiAgICB9XG5cbiAgICByZXR1cm4gRmlsZUNhdGVnb3J5LlVUSUxJVFk7XG4gIH1cblxuICAvKipcbiAgICogQ2FsY3VsYXRlIHNhZmV0eSBzY29yZSBmb3IgdHJhbnNmb3JtYXRpb25cbiAgICovXG4gIHByaXZhdGUgY2FsY3VsYXRlU2FmZXR5U2NvcmUoXG4gICAgZmlsZVBhdGg6IHN0cmluZyxcbiAgICBjb250ZW50OiBzdHJpbmcsXG4gICAgdW51c2VkRXhwb3J0czogVW51c2VkRXhwb3J0W11cbiAgKTogbnVtYmVyIHtcbiAgICBsZXQgc2NvcmUgPSAxMDA7IC8vIFN0YXJ0IHdpdGggcGVyZmVjdCBzY29yZVxuXG4gICAgLy8gUmVkdWNlIHNjb3JlIGJhc2VkIG9uIGZpbGUgY29tcGxleGl0eVxuICAgIGNvbnN0IGxpbmVzID0gY29udGVudC5zcGxpdCgnXFxuJykubGVuZ3RoO1xuICAgIGlmIChsaW5lcyA+IDUwMCkgc2NvcmUgLT0gMjA7XG4gICAgZWxzZSBpZiAobGluZXMgPiAyMDApIHNjb3JlIC09IDEwO1xuXG4gICAgLy8gUmVkdWNlIHNjb3JlIGJhc2VkIG9uIG51bWJlciBvZiB1bnVzZWQgZXhwb3J0c1xuICAgIGlmICh1bnVzZWRFeHBvcnRzLmxlbmd0aCA+IDEwKSBzY29yZSAtPSAyMDtcbiAgICBlbHNlIGlmICh1bnVzZWRFeHBvcnRzLmxlbmd0aCA+IDUpIHNjb3JlIC09IDEwO1xuXG4gICAgLy8gUmVkdWNlIHNjb3JlIGZvciBjcml0aWNhbCBmaWxlc1xuICAgIGlmIChmaWxlUGF0aC5pbmNsdWRlcygnL2NvcmUvJykgfHwgZmlsZVBhdGguaW5jbHVkZXMoJy9jcml0aWNhbC8nKSkge1xuICAgICAgc2NvcmUgLT0gMTU7XG4gICAgfVxuXG4gICAgLy8gSW5jcmVhc2Ugc2NvcmUgZm9yIHRlc3QgZmlsZXMgKHNhZmVyIHRvIHRyYW5zZm9ybSlcbiAgICBpZiAoZmlsZVBhdGguaW5jbHVkZXMoJy90ZXN0LycpIHx8IGZpbGVQYXRoLmluY2x1ZGVzKCcudGVzdC4nKSkge1xuICAgICAgc2NvcmUgKz0gMTA7XG4gICAgfVxuXG4gICAgcmV0dXJuIE1hdGgubWF4KDAsIE1hdGgubWluKDEwMCwgc2NvcmUpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBJZGVudGlmeSB0cmFuc2Zvcm1hdGlvbiBjYW5kaWRhdGVzXG4gICAqL1xuICBwcml2YXRlIGlkZW50aWZ5VHJhbnNmb3JtYXRpb25DYW5kaWRhdGVzKFxuICAgIHVudXNlZEV4cG9ydHM6IFVudXNlZEV4cG9ydFtdXG4gICk6IFRyYW5zZm9ybWF0aW9uQ2FuZGlkYXRlW10ge1xuICAgIHJldHVybiB1bnVzZWRFeHBvcnRzLm1hcChleHBvcnRJbmZvID0+IHtcbiAgICAgIGNvbnN0IGludGVsbGlnZW5jZVN5c3RlbU5hbWUgPVxuICAgICAgICB0aGlzLmdlbmVyYXRlSW50ZWxsaWdlbmNlU3lzdGVtTmFtZShleHBvcnRJbmZvKTtcbiAgICAgIGNvbnN0IHRyYW5zZm9ybWF0aW9uQ29tcGxleGl0eSA9XG4gICAgICAgIHRoaXMuYXNzZXNzVHJhbnNmb3JtYXRpb25Db21wbGV4aXR5KGV4cG9ydEluZm8pO1xuICAgICAgY29uc3Qgc2FmZXR5U2NvcmUgPSB0aGlzLmNhbGN1bGF0ZVRyYW5zZm9ybWF0aW9uU2FmZXR5U2NvcmUoZXhwb3J0SW5mbyk7XG4gICAgICBjb25zdCBlc3RpbWF0ZWRCZW5lZml0ID0gdGhpcy5jYWxjdWxhdGVFc3RpbWF0ZWRCZW5lZml0KGV4cG9ydEluZm8pO1xuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBleHBvcnQ6IGV4cG9ydEluZm8sXG4gICAgICAgIGludGVsbGlnZW5jZVN5c3RlbU5hbWUsXG4gICAgICAgIHRyYW5zZm9ybWF0aW9uQ29tcGxleGl0eSxcbiAgICAgICAgc2FmZXR5U2NvcmUsXG4gICAgICAgIGVzdGltYXRlZEJlbmVmaXQsXG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEdlbmVyYXRlIGludGVsbGlnZW5jZSBzeXN0ZW0gbmFtZVxuICAgKi9cbiAgcHJpdmF0ZSBnZW5lcmF0ZUludGVsbGlnZW5jZVN5c3RlbU5hbWUoZXhwb3J0SW5mbzogVW51c2VkRXhwb3J0KTogc3RyaW5nIHtcbiAgICBjb25zdCBiYXNlTmFtZSA9IGV4cG9ydEluZm8uZXhwb3J0TmFtZVxuICAgICAgLnJlcGxhY2UoLyhbQS1aXSkvZywgJ18kMScpXG4gICAgICAudG9VcHBlckNhc2UoKTtcbiAgICByZXR1cm4gYCR7YmFzZU5hbWV9X0lOVEVMTElHRU5DRV9TWVNURU1gO1xuICB9XG5cbiAgLyoqXG4gICAqIEFzc2VzcyB0cmFuc2Zvcm1hdGlvbiBjb21wbGV4aXR5XG4gICAqL1xuICBwcml2YXRlIGFzc2Vzc1RyYW5zZm9ybWF0aW9uQ29tcGxleGl0eShcbiAgICBleHBvcnRJbmZvOiBVbnVzZWRFeHBvcnRcbiAgKTogVHJhbnNmb3JtYXRpb25Db21wbGV4aXR5IHtcbiAgICBpZiAoZXhwb3J0SW5mby5jb21wbGV4aXR5IDwgNSkgcmV0dXJuIFRyYW5zZm9ybWF0aW9uQ29tcGxleGl0eS5TSU1QTEU7XG4gICAgaWYgKGV4cG9ydEluZm8uY29tcGxleGl0eSA8IDE1KSByZXR1cm4gVHJhbnNmb3JtYXRpb25Db21wbGV4aXR5Lk1PREVSQVRFO1xuICAgIGlmIChleHBvcnRJbmZvLmNvbXBsZXhpdHkgPCAzMCkgcmV0dXJuIFRyYW5zZm9ybWF0aW9uQ29tcGxleGl0eS5DT01QTEVYO1xuICAgIHJldHVybiBUcmFuc2Zvcm1hdGlvbkNvbXBsZXhpdHkuVkVSWV9DT01QTEVYO1xuICB9XG5cbiAgLyoqXG4gICAqIENhbGN1bGF0ZSB0cmFuc2Zvcm1hdGlvbiBzYWZldHkgc2NvcmVcbiAgICovXG4gIHByaXZhdGUgY2FsY3VsYXRlVHJhbnNmb3JtYXRpb25TYWZldHlTY29yZShleHBvcnRJbmZvOiBVbnVzZWRFeHBvcnQpOiBudW1iZXIge1xuICAgIGxldCBzY29yZSA9IDkwOyAvLyBTdGFydCBoaWdoIGZvciB1bnVzZWQgZXhwb3J0c1xuXG4gICAgLy8gUmVkdWNlIGZvciBjb21wbGV4IGV4cG9ydHNcbiAgICBpZiAoZXhwb3J0SW5mby5jb21wbGV4aXR5ID4gMjApIHNjb3JlIC09IDIwO1xuICAgIGVsc2UgaWYgKGV4cG9ydEluZm8uY29tcGxleGl0eSA+IDEwKSBzY29yZSAtPSAxMDtcblxuICAgIC8vIEluY3JlYXNlIGZvciBzaW1wbGUgdHlwZXNcbiAgICBpZiAoXG4gICAgICBleHBvcnRJbmZvLmV4cG9ydFR5cGUgPT09ICdpbnRlcmZhY2UnIHx8XG4gICAgICBleHBvcnRJbmZvLmV4cG9ydFR5cGUgPT09ICd0eXBlJ1xuICAgICkge1xuICAgICAgc2NvcmUgKz0gMTA7XG4gICAgfVxuXG4gICAgcmV0dXJuIE1hdGgubWF4KDAsIE1hdGgubWluKDEwMCwgc2NvcmUpKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDYWxjdWxhdGUgZXN0aW1hdGVkIGJlbmVmaXQgb2YgdHJhbnNmb3JtYXRpb25cbiAgICovXG4gIHByaXZhdGUgY2FsY3VsYXRlRXN0aW1hdGVkQmVuZWZpdChleHBvcnRJbmZvOiBVbnVzZWRFeHBvcnQpOiBudW1iZXIge1xuICAgIGxldCBiZW5lZml0ID0gNTA7IC8vIEJhc2UgYmVuZWZpdFxuXG4gICAgLy8gSGlnaGVyIGJlbmVmaXQgZm9yIGZ1bmN0aW9ucyBhbmQgY2xhc3NlcyAobW9yZSB0cmFuc2Zvcm1hYmxlKVxuICAgIGlmIChcbiAgICAgIGV4cG9ydEluZm8uZXhwb3J0VHlwZSA9PT0gJ2Z1bmN0aW9uJyB8fFxuICAgICAgZXhwb3J0SW5mby5leHBvcnRUeXBlID09PSAnY2xhc3MnXG4gICAgKSB7XG4gICAgICBiZW5lZml0ICs9IDMwO1xuICAgIH1cblxuICAgIC8vIEhpZ2hlciBiZW5lZml0IGZvciBjb21wbGV4IGV4cG9ydHMgKG1vcmUgaW50ZWxsaWdlbmNlIHBvdGVudGlhbClcbiAgICBiZW5lZml0ICs9IE1hdGgubWluKDIwLCBleHBvcnRJbmZvLmNvbXBsZXhpdHkpO1xuXG4gICAgcmV0dXJuIE1hdGgubWluKDEwMCwgYmVuZWZpdCk7XG4gIH1cblxuICAvKipcbiAgICogQ2F0ZWdvcml6ZSBhbmQgc3VtbWFyaXplIGFuYWx5c2lzIHJlc3VsdHNcbiAgICovXG4gIHByaXZhdGUgY2F0ZWdvcml6ZUFuZFN1bW1hcml6ZShmaWxlQW5hbHlzZXM6IEZpbGVBbmFseXNpc1tdKTogQW5hbHlzaXNSZXN1bHQge1xuICAgIGNvbnN0IGhpZ2hQcmlvcml0eUZpbGVzID0gZmlsZUFuYWx5c2VzLmZpbHRlcihcbiAgICAgIGYgPT4gZi5wcmlvcml0eSA9PT0gRmlsZVByaW9yaXR5LkhJR0hcbiAgICApO1xuICAgIGNvbnN0IG1lZGl1bVByaW9yaXR5RmlsZXMgPSBmaWxlQW5hbHlzZXMuZmlsdGVyKFxuICAgICAgZiA9PiBmLnByaW9yaXR5ID09PSBGaWxlUHJpb3JpdHkuTUVESVVNXG4gICAgKTtcbiAgICBjb25zdCBsb3dQcmlvcml0eUZpbGVzID0gZmlsZUFuYWx5c2VzLmZpbHRlcihcbiAgICAgIGYgPT4gZi5wcmlvcml0eSA9PT0gRmlsZVByaW9yaXR5LkxPV1xuICAgICk7XG5cbiAgICBjb25zdCB0b3RhbFVudXNlZEV4cG9ydHMgPSBmaWxlQW5hbHlzZXMucmVkdWNlKFxuICAgICAgKHN1bSwgZikgPT4gc3VtICsgZi51bnVzZWRFeHBvcnRzLmxlbmd0aCxcbiAgICAgIDBcbiAgICApO1xuICAgIGNvbnN0IHRvdGFsVHJhbnNmb3JtYXRpb25DYW5kaWRhdGVzID0gZmlsZUFuYWx5c2VzLnJlZHVjZShcbiAgICAgIChzdW0sIGYpID0+IHN1bSArIGYudHJhbnNmb3JtYXRpb25DYW5kaWRhdGVzLmxlbmd0aCxcbiAgICAgIDBcbiAgICApO1xuXG4gICAgY29uc3QgcmVjaXBlRmlsZXMgPSBmaWxlQW5hbHlzZXMuZmlsdGVyKFxuICAgICAgZiA9PiBmLmNhdGVnb3J5ID09PSBGaWxlQ2F0ZWdvcnkuUkVDSVBFXG4gICAgKS5sZW5ndGg7XG4gICAgY29uc3QgY29yZUZpbGVzID0gZmlsZUFuYWx5c2VzLmZpbHRlcihcbiAgICAgIGYgPT4gZi5jYXRlZ29yeSA9PT0gRmlsZUNhdGVnb3J5LkNPUkVcbiAgICApLmxlbmd0aDtcbiAgICBjb25zdCBleHRlcm5hbEZpbGVzID0gZmlsZUFuYWx5c2VzLmZpbHRlcihcbiAgICAgIGYgPT4gZi5jYXRlZ29yeSA9PT0gRmlsZUNhdGVnb3J5LkVYVEVSTkFMXG4gICAgKS5sZW5ndGg7XG5cbiAgICBjb25zdCBhdmVyYWdlU2FmZXR5U2NvcmUgPVxuICAgICAgZmlsZUFuYWx5c2VzLnJlZHVjZSgoc3VtLCBmKSA9PiBzdW0gKyBmLnNhZmV0eVNjb3JlLCAwKSAvXG4gICAgICBmaWxlQW5hbHlzZXMubGVuZ3RoO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHRvdGFsRmlsZXM6IGZpbGVBbmFseXNlcy5sZW5ndGgsXG4gICAgICB0b3RhbFVudXNlZEV4cG9ydHMsXG4gICAgICBoaWdoUHJpb3JpdHlGaWxlcyxcbiAgICAgIG1lZGl1bVByaW9yaXR5RmlsZXMsXG4gICAgICBsb3dQcmlvcml0eUZpbGVzLFxuICAgICAgc3VtbWFyeToge1xuICAgICAgICByZWNpcGVGaWxlcyxcbiAgICAgICAgY29yZUZpbGVzLFxuICAgICAgICBleHRlcm5hbEZpbGVzLFxuICAgICAgICB0b3RhbFRyYW5zZm9ybWF0aW9uQ2FuZGlkYXRlcyxcbiAgICAgICAgYXZlcmFnZVNhZmV0eVNjb3JlLFxuICAgICAgICBlc3RpbWF0ZWRJbnRlbGxpZ2VuY2VTeXN0ZW1zOiB0b3RhbFRyYW5zZm9ybWF0aW9uQ2FuZGlkYXRlcyxcbiAgICAgIH0sXG4gICAgfTtcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVjayBpZiBwYXRoIG1hdGNoZXMgcGF0dGVyblxuICAgKi9cbiAgcHJpdmF0ZSBtYXRjaGVzUGF0dGVybihmaWxlUGF0aDogc3RyaW5nLCBwYXR0ZXJuOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgICBjb25zdCByZWdleCA9IG5ldyBSZWdFeHAoXG4gICAgICBwYXR0ZXJuLnJlcGxhY2UoL1xcKlxcKi9nLCAnLionKS5yZXBsYWNlKC9cXCovZywgJ1teL10qJylcbiAgICApO1xuICAgIHJldHVybiByZWdleC50ZXN0KGZpbGVQYXRoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZW5lcmF0ZSBkZXRhaWxlZCByZXBvcnRcbiAgICovXG4gIGdlbmVyYXRlUmVwb3J0KGFuYWx5c2lzOiBBbmFseXNpc1Jlc3VsdCk6IHN0cmluZyB7XG4gICAgY29uc3QgcmVwb3J0ID0gW1xuICAgICAgJyMgVW51c2VkIEV4cG9ydCBBbmFseXNpcyBSZXBvcnQnLFxuICAgICAgJycsXG4gICAgICAnIyMgU3VtbWFyeScsXG4gICAgICBgLSBUb3RhbCBmaWxlcyBhbmFseXplZDogJHthbmFseXNpcy50b3RhbEZpbGVzfWAsXG4gICAgICBgLSBUb3RhbCB1bnVzZWQgZXhwb3J0czogJHthbmFseXNpcy50b3RhbFVudXNlZEV4cG9ydHN9YCxcbiAgICAgIGAtIFJlY2lwZSBmaWxlczogJHthbmFseXNpcy5zdW1tYXJ5LnJlY2lwZUZpbGVzfWAsXG4gICAgICBgLSBDb3JlIGZpbGVzOiAke2FuYWx5c2lzLnN1bW1hcnkuY29yZUZpbGVzfWAsXG4gICAgICBgLSBFeHRlcm5hbCBmaWxlczogJHthbmFseXNpcy5zdW1tYXJ5LmV4dGVybmFsRmlsZXN9YCxcbiAgICAgIGAtIFRyYW5zZm9ybWF0aW9uIGNhbmRpZGF0ZXM6ICR7YW5hbHlzaXMuc3VtbWFyeS50b3RhbFRyYW5zZm9ybWF0aW9uQ2FuZGlkYXRlc31gLFxuICAgICAgYC0gQXZlcmFnZSBzYWZldHkgc2NvcmU6ICR7YW5hbHlzaXMuc3VtbWFyeS5hdmVyYWdlU2FmZXR5U2NvcmUudG9GaXhlZCgxKX1gLFxuICAgICAgJycsXG4gICAgICAnIyMgUHJpb3JpdHkgQnJlYWtkb3duJyxcbiAgICAgIGAtIEhpZ2ggcHJpb3JpdHkgZmlsZXM6ICR7YW5hbHlzaXMuaGlnaFByaW9yaXR5RmlsZXMubGVuZ3RofWAsXG4gICAgICBgLSBNZWRpdW0gcHJpb3JpdHkgZmlsZXM6ICR7YW5hbHlzaXMubWVkaXVtUHJpb3JpdHlGaWxlcy5sZW5ndGh9YCxcbiAgICAgIGAtIExvdyBwcmlvcml0eSBmaWxlczogJHthbmFseXNpcy5sb3dQcmlvcml0eUZpbGVzLmxlbmd0aH1gLFxuICAgICAgJycsXG4gICAgICAnIyMgVG9wIFRyYW5zZm9ybWF0aW9uIENhbmRpZGF0ZXMnLFxuICAgICAgJycsXG4gICAgXTtcblxuICAgIC8vIEFkZCB0b3AgY2FuZGlkYXRlcyBmcm9tIGVhY2ggcHJpb3JpdHkgbGV2ZWxcbiAgICBjb25zdCB0b3BDYW5kaWRhdGVzID0gW1xuICAgICAgLi4uYW5hbHlzaXMuaGlnaFByaW9yaXR5RmlsZXMuc2xpY2UoMCwgNSksXG4gICAgICAuLi5hbmFseXNpcy5tZWRpdW1Qcmlvcml0eUZpbGVzLnNsaWNlKDAsIDUpLFxuICAgICAgLi4uYW5hbHlzaXMubG93UHJpb3JpdHlGaWxlcy5zbGljZSgwLCA1KSxcbiAgICBdO1xuXG4gICAgdG9wQ2FuZGlkYXRlcy5mb3JFYWNoKGZpbGUgPT4ge1xuICAgICAgcmVwb3J0LnB1c2goYCMjIyAke2ZpbGUuZmlsZVBhdGh9YCk7XG4gICAgICByZXBvcnQucHVzaChgLSBQcmlvcml0eTogJHtmaWxlLnByaW9yaXR5fWApO1xuICAgICAgcmVwb3J0LnB1c2goYC0gU2FmZXR5IFNjb3JlOiAke2ZpbGUuc2FmZXR5U2NvcmV9YCk7XG4gICAgICByZXBvcnQucHVzaChgLSBVbnVzZWQgRXhwb3J0czogJHtmaWxlLnVudXNlZEV4cG9ydHMubGVuZ3RofWApO1xuICAgICAgcmVwb3J0LnB1c2goXG4gICAgICAgIGAtIFRyYW5zZm9ybWF0aW9uIENhbmRpZGF0ZXM6ICR7ZmlsZS50cmFuc2Zvcm1hdGlvbkNhbmRpZGF0ZXMubGVuZ3RofWBcbiAgICAgICk7XG4gICAgICByZXBvcnQucHVzaCgnJyk7XG4gICAgfSk7XG5cbiAgICByZXR1cm4gcmVwb3J0LmpvaW4oJ1xcbicpO1xuICB9XG59XG4iXSwidmVyc2lvbiI6M30=